/*!
 *
 * Bryntum Calendar 6.2.2
 *
 * Copyright(c) 2025 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 * Bryntum incorporates third-party code licensed under the MIT and Apache-2.0 licenses.
 * See the licenses below or visit https://bryntum.com/products/calendar/docs/guide/Calendar/licenses
 *
 * # Third Party Notices
 * 
 * Bryntum uses the following third party libraries:
 * 
 * * [Font Awesome 6 Free](https://fontawesome.com/license/free) (MIT/SIL OFL 1.1)
 * * [Roboto font](https://github.com/google/roboto) (Apache-2.0)
 * * [Styling Cross-Browser Compatible Range Inputs with Sass](https://github.com/darlanrod/input-range-sass) (MIT)
 * * [Tree Walker polyfill (only applies to Salesforce)](https://github.com/Krinkle/dom-TreeWalker-polyfill) (MIT)
 * * [chronograph](https://github.com/bryntum/chronograph) (MIT)
 * * [later.js](https://github.com/bunkat/later) (MIT)
 * * [Monaco editor (only used in our demos)](https://microsoft.github.io/monaco-editor) (MIT)
 * * Map/Set polyfill to fix performance issues for Salesforce LWS (MIT)
 * 
 * Note: the **chronograph** and **later.js** libraries are used in Bryntum Scheduler Pro and Bryntum Gantt, but they are
 * listed for all Bryntum products since the distribution contains trial versions of the thin bundles for all other
 * products. TreeWalker is only used in the LWC bundle for Salesforce. Roboto font is only used in the material theme.
 * 
 * ## Font Awesome 6 Free
 * 
 * [Font Awesome Free 6 by @fontawesome](https://fontawesome.com/)
 * 
 * Font Awesome Free is free, open source, and GPL friendly. You can use it for commercial projects, open source projects,
 * or really almost whatever you want.
 * 
 * [Full Font Awesome Free license](https://fontawesome.com/license/free)
 * 
 * ## Roboto font
 * 
 * [Apache License Version 2.0, January 2004](https://www.apache.org/licenses/LICENSE-2.0)
 * 
 * TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
 * 
 * 1. Definitions.
 * 
 * "License" shall mean the terms and conditions for use, reproduction, and distribution as defined by Sections 1 through 9
 * of this document.
 * 
 * "Licensor" shall mean the copyright owner or entity authorized by the copyright owner that is granting the License.
 * 
 * "Legal Entity" shall mean the union of the acting entity and all other entities that control, are controlled by, or are
 * under common control with that entity. For the purposes of this definition,
 * "control" means (i) the power, direct or indirect, to cause the direction or management of such entity, whether by
 * contract or otherwise, or (ii) ownership of fifty percent (50%) or more of the outstanding shares, or (iii) beneficial
 * ownership of such entity.
 * 
 * "You" (or "Your") shall mean an individual or Legal Entity exercising permissions granted by this License.
 * 
 * "Source" form shall mean the preferred form for making modifications, including but not limited to software source code,
 * documentation source, and configuration files.
 * 
 * "Object" form shall mean any form resulting from mechanical transformation or translation of a Source form, including
 * but not limited to compiled object code, generated documentation, and conversions to other media types.
 * 
 * "Work" shall mean the work of authorship, whether in Source or Object form, made available under the License, as
 * indicated by a copyright notice that is included in or attached to the work
 * (an example is provided in the Appendix below).
 * 
 * "Derivative Works" shall mean any work, whether in Source or Object form, that is based on (or derived from) the Work
 * and for which the editorial revisions, annotations, elaborations, or other modifications represent, as a whole, an
 * original work of authorship. For the purposes of this License, Derivative Works shall not include works that remain
 * separable from, or merely link (or bind by name) to the interfaces of, the Work and Derivative Works thereof.
 * 
 * "Contribution" shall mean any work of authorship, including the original version of the Work and any modifications or
 * additions to that Work or Derivative Works thereof, that is intentionally submitted to Licensor for inclusion in the
 * Work by the copyright owner or by an individual or Legal Entity authorized to submit on behalf of the copyright owner.
 * For the purposes of this definition, "submitted"
 * means any form of electronic, verbal, or written communication sent to the Licensor or its representatives, including
 * but not limited to communication on electronic mailing lists, source code control systems, and issue tracking systems
 * that are managed by, or on behalf of, the Licensor for the purpose of discussing and improving the Work, but excluding
 * communication that is conspicuously marked or otherwise designated in writing by the copyright owner as "Not a
 * Contribution."
 * 
 * "Contributor" shall mean Licensor and any individual or Legal Entity on behalf of whom a Contribution has been received
 * by Licensor and subsequently incorporated within the Work.
 * 
 * 2. Grant of Copyright License. Subject to the terms and conditions of this License, each Contributor hereby grants to
 *    You a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce,
 *    prepare Derivative Works of, publicly display, publicly perform, sublicense, and distribute the Work and such
 *    Derivative Works in Source or Object form.
 * 
 * 3. Grant of Patent License. Subject to the terms and conditions of this License, each Contributor hereby grants to You a
 *    perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 *    (except as stated in this section) patent license to make, have made, use, offer to sell, sell, import, and otherwise
 *    transfer the Work, where such license applies only to those patent claims licensable by such Contributor that are
 *    necessarily infringed by their Contribution(s) alone or by combination of their Contribution(s)
 *    with the Work to which such Contribution(s) was submitted. If You institute patent litigation against any entity (
 *    including a cross-claim or counterclaim in a lawsuit) alleging that the Work or a Contribution incorporated within
 *    the Work constitutes direct or contributory patent infringement, then any patent licenses granted to You under this
 *    License for that Work shall terminate as of the date such litigation is filed.
 * 
 * 4. Redistribution. You may reproduce and distribute copies of the Work or Derivative Works thereof in any medium, with
 *    or without modifications, and in Source or Object form, provided that You meet the following conditions:
 * 
 * (a) You must give any other recipients of the Work or Derivative Works a copy of this License; and
 * 
 * (b) You must cause any modified files to carry prominent notices stating that You changed the files; and
 * 
 * (c) You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark,
 * and attribution notices from the Source form of the Work, excluding those notices that do not pertain to any part of the
 * Derivative Works; and
 * 
 * (d) If the Work includes a "NOTICE" text file as part of its distribution, then any Derivative Works that You distribute
 * must include a readable copy of the attribution notices contained within such NOTICE file, excluding those notices that
 * do not pertain to any part of the Derivative Works, in at least one of the following places: within a NOTICE text file
 * distributed as part of the Derivative Works; within the Source form or documentation, if provided along with the
 * Derivative Works; or, within a display generated by the Derivative Works, if and wherever such third-party notices
 * normally appear. The contents of the NOTICE file are for informational purposes only and do not modify the License. You
 * may add Your own attribution notices within Derivative Works that You distribute, alongside or as an addendum to the
 * NOTICE text from the Work, provided that such additional attribution notices cannot be construed as modifying the
 * License.
 * 
 * You may add Your own copyright statement to Your modifications and may provide additional or different license terms and
 * conditions for use, reproduction, or distribution of Your modifications, or for any such Derivative Works as a whole,
 * provided Your use, reproduction, and distribution of the Work otherwise complies with the conditions stated in this
 * License.
 * 
 * 5. Submission of Contributions. Unless You explicitly state otherwise, any Contribution intentionally submitted for
 *    inclusion in the Work by You to the Licensor shall be under the terms and conditions of this License, without any
 *    additional terms or conditions. Notwithstanding the above, nothing herein shall supersede or modify the terms of any
 *    separate license agreement you may have executed with Licensor regarding such Contributions.
 * 
 * 6. Trademarks. This License does not grant permission to use the trade names, trademarks, service marks, or product
 *    names of the Licensor, except as required for reasonable and customary use in describing the origin of the Work and
 *    reproducing the content of the NOTICE file.
 * 
 * 7. Disclaimer of Warranty. Unless required by applicable law or agreed to in writing, Licensor provides the Work (and
 *    each Contributor provides its Contributions) on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 *    either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT,
 *    MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. You are solely responsible for determining the appropriateness
 *    of using or redistributing the Work and assume any risks associated with Your exercise of permissions under this
 *    License.
 * 
 * 8. Limitation of Liability. In no event and under no legal theory, whether in tort (including negligence), contract, or
 *    otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing,
 *    shall any Contributor be liable to You for damages, including any direct, indirect, special, incidental, or
 *    consequential damages of any character arising as a result of this License or out of the use or inability to use the
 *    Work (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or
 *    any and all other commercial damages or losses), even if such Contributor has been advised of the possibility of such
 *    damages.
 * 
 * 9. Accepting Warranty or Additional Liability. While redistributing the Work or Derivative Works thereof, You may choose
 *    to offer, and charge a fee for, acceptance of support, warranty, indemnity, or other liability obligations and/or
 *    rights consistent with this License. However, in accepting such obligations, You may act only on Your own behalf and
 *    on Your sole responsibility, not on behalf of any other Contributor, and only if You agree to indemnify, defend, and
 *    hold each Contributor harmless for any liability incurred by, or claims asserted against, such Contributor by reason
 *    of your accepting any such warranty or additional liability.
 * 
 * END OF TERMS AND CONDITIONS
 * 
 * APPENDIX: How to apply the Apache License to your work.
 * 
 * To apply the Apache License to your work, attach the following boilerplate notice, with the fields enclosed by
 * brackets "[]"
 * replaced with your own identifying information. (Don't include the brackets!)  The text should be enclosed in the
 * appropriate comment syntax for the file format. We also recommend that a file or class name and description of purpose
 * be included on the same "printed page" as the copyright notice for easier identification within third-party archives.
 * 
 * Copyright [yyyy] [name of copyright owner]
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the
 * License. You may obtain a copy of the License at
 * 
 * [APACHE LICENSE, VERSION 2.0](http://www.apache.org/licenses/LICENSE-2.0)
 * 
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "
 * AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 * 
 * ## Styling Cross-Browser Compatible Range Inputs with Sass
 * 
 * Github: [input-range-sass](https://github.com/darlanrod/input-range-sass)
 * 
 * Author: [Darlan Rod](https://github.com/darlanrod)
 * 
 * Version 1.4.1
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2016 Darlan Rod
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Tree Walker polyfill
 * 
 * The MIT License (MIT)
 * 
 * [Copyright 2013–2017 Timo Tijhof](https://github.com/Krinkle/dom-TreeWalker-polyfill)
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## chronograph
 * 
 * GitHub: [chronograph](https://github.com/bryntum/chronograph)
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2023 Bryntum
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## later.js
 * 
 * GitHub: [later.js](https://github.com/bunkat/later)
 * 
 * The MIT License (MIT)
 * 
 * Copyright © 2013 BunKat
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Monaco editor
 * 
 * GitHub: [Monaco editor](https://microsoft.github.io/monaco-editor) (MIT)
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2016 - present Microsoft Corporation
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Map/Set polyfill to fix performance issues for Salesforce LWS
 * 
 * Copyright © 2024 Certinia Inc.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).bryntum=e.bryntum||{},e.bryntum.calendar={}))}(this,(function(e){"use strict";const t="calendar",[n,r]=[self,self],{undefined:i,Map:a,Set:o}=n;function l(e,t){this.v=e,this.k=t}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function c(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new d(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function d(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return d=function(e){this.s=e,this.n=e.next},d.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new d(e)}function h(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){h(a,r,i,o,l,"next",e)}function l(e){h(a,r,i,o,l,"throw",e)}o(void 0)}))}}function v(e){return new l(e,0)}function g(e,t,n){return t=E(t),I(e,T()?Reflect.construct(t,n||[],E(e).constructor):t.apply(e,n))}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){return e.get(u(e,t))}function y(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function k(e,t,n){return e.set(u(e,t),n),n}function b(e,t,n){if(T())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&P(i,n.prototype),i}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function w(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=$(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function S(e,t,n){return(t=j(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=H(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},x.apply(null,arguments)}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}function R(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}function T(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(T=function(){return!!e})()}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function I(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function L(){L=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function s(e,t,n,r){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(t,n,r,i){var a=n&&n.prototype instanceof h?n:h,o=Object.create(a.prototype);return s(o,"_invoke",function(t,n,r){var i=1;return function(a,o){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===a)throw o;return{value:e,done:!0}}for(r.method=a,r.arg=o;;){var l=r.delegate;if(l){var s=C(l,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===i)throw i=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=3;var u=c(t,n,r);if("normal"===u.type){if(i=r.done?4:2,u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=4,r.method="throw",r.arg=u.arg)}}}(t,r,new S(i||[])),!0),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d={};function h(){}function f(){}function v(){}var g={};s(g,a,(function(){return this}));var m=Object.getPrototypeOf,p=m&&m(m(x([])));p&&p!==n&&r.call(p,a)&&(g=p);var y=v.prototype=h.prototype=Object.create(g);function k(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,a,o,l){var s=c(e[i],e,a);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,l)}),(function(e){n("throw",e,o,l)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,l)}))}l(s.arg)}var i;s(this,"_invoke",(function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}),!0)}function C(t,n){var r=n.method,i=t.i[r];if(i===e)return n.delegate=null,"throw"===r&&t.i.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var a=c(i,t.i,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,d;var o=a.arg;return o?o.done?(n[t.r]=o.value,n.next=t.n,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,d):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function w(e){this.tryEntries.push(e)}function D(t){var n=t[4]||{};n.type="normal",n.arg=e,t[4]=n}function S(e){this.tryEntries=[[-1]],e.forEach(w,this),this.reset(!0)}function x(t){if(null!=t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return f.prototype=v,s(y,"constructor",v),s(v,"constructor",f),f.displayName=s(v,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},k(b.prototype),s(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new b(u(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(y),s(y,l,"Generator"),s(y,a,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},t.values=x,S.prototype={constructor:S,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(e){o.type="throw",o.arg=t,n.next=e}for(var i=n.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a[4],l=this.prev,s=a[1],u=a[2];if(-1===a[0])return r("end"),!1;if(!s&&!u)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=l){if(l<s)return this.method="next",this.arg=e,r(s),!0;if(l<u)return r(u),!1}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var i=r;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var a=i?i[4]:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i[2],d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[2]===e)return this.complete(n[4],n[3]),D(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[0]===e){var r=n[4];if("throw"===r.type){var i=r.arg;D(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={i:x(t),r:n,n:r},"next"===this.method&&(this.arg=e),d}},t}function O(e,t,n,r){return O="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,r){var i,a=H(e,t);if(a){if((i=Object.getOwnPropertyDescriptor(a,t)).set)return i.set.call(r,n),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(r,t)){if(!i.writable)return!1;i.value=n,Object.defineProperty(r,t,i)}else S(r,t,n);return!0},O(e,t,n,r)}function P(e,t){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},P(e,t)}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,l=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return l}}(e,t)||$(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}function B(e,t,n,r){var i=x(E(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function V(e,t,n,r,i,a){return function(e,t,n,r,i){if(!O(e,t,n,r||e)&&i)throw new TypeError("failed to set property");return n}(E(a?e.prototype:e),t,n,r,i)}function N(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function z(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function $(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function U(e){return function(){return new G(e.apply(this,arguments))}}function G(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof l;Promise.resolve(s?o.v:o).then((function(n){if(s){var l="return"===t?"return":"next";if(!o.k||n.done)return r(l,n);n=e[l](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(a,o){var l={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=l:(t=n=l,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function Y(e){var t="function"==typeof a?new a:void 0;return Y=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return b(e,arguments,E(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),P(n,e)},Y(e)}G.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},G.prototype.next=function(e){return this._invoke("next",e)},G.prototype.throw=function(e){return this._invoke("throw",e)},G.prototype.return=function(e){return this._invoke("return",e)};var q,K=Object.create(null),X=["Array","Browser",["Css","CSSHelper"],"Date","Dom","Event","Function","Object","String","TimeZone","Version"].map((function(e){return Array.isArray(e)?e:[e,"".concat(e,"Helper")]})),Z=function(e){return Object.assign(Object.create(null),Object.fromEntries(e))},J=Z(X),Q=Z(X.map((function(e){var t=_(e,2),n=t[0];return[t[1],n]}))),ee=function(e){return function(t,n){throw new Error("Cannot ".concat(e,' "Helpers.').concat(n,'": object is readonly'))}},te=new Proxy(K,{defineProperty:ee("define property"),deleteProperty:ee("delete"),set:ee("assign"),get:function(e,t){var n=K[t];if(!n)throw new Error('Property not defined "Helpers.'.concat(t,'": ').concat(t in J?"import ".concat(J[t]," before using it"):"invalid helper name"));return n}});Object.defineProperty(K,"register",{value:function(e){var t=e.$name,n=Q[t];K[n]=e}}),X.forEach((function(e){return K[e[0]]=null}));var ne=function(){return w((function e(){m(this,e)}),null,[{key:"cacheFlags",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:navigator.platform,t=arguments.length>1&&arguments[1]!==i?arguments[1]:navigator.userAgent,n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isMobile=Boolean(t.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||"number"==typeof r.orientation),n._isWebkit=Boolean(t.match(/WebKit/)&&!t.match(/Edg/)),n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),n._safariVersion=n.getVersion(t,/Version\/(.*).Safari/),n._isAndroid=Boolean(t.match(/Android/g))}},{key:"supportsOverflowClip",get:function(){if(null==this._supportsOverflowClip){var e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip="clip"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow"),e.remove()}return this._supportsOverflowClip}},{key:"supportsSticky",get:function(){return!0}},{key:"getVersion",value:function(e,t){var n=e.match(t);return n?parseFloat(n[1]):0}},{key:"isTouchDevice",get:function(){return this._isTouchDevice===i&&(this._isTouchDevice=r.matchMedia("(any-pointer:coarse)").matches),this._isTouchDevice}},{key:"isHoverableDevice",get:function(){return this._isHoverableDevice===i&&(this._isHoverableDevice=r.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}},{key:"isBrowserEnv",get:function(){return void 0!==n}},{key:"isMac",get:function(){return this._isMac}},{key:"isWindows",get:function(){return this._isWindows}},{key:"isLinux",get:function(){return this._isLinux}},{key:"isAndroid",get:function(){return this._isAndroid}},{key:"isWebkit",get:function(){return this._isWebkit}},{key:"isChrome",get:function(){return this._isChrome}},{key:"chromeVersion",get:function(){return this._chromeVersion}},{key:"isFirefox",get:function(){return this._isFirefox}},{key:"firefoxVersion",get:function(){return this._firefoxVersion}},{key:"isSafari",get:function(){return this._isSafari}},{key:"safariVersion",get:function(){return this._safariVersion}},{key:"isMobileSafari",get:function(){return this._isMobileSafari}},{key:"isMobile",get:function(){return this._isMobile}},{key:"platform",get:function(){var e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}},{key:"supportsRandomUUID",get:function(){if(this._supportsRandomUUID===i)try{var e,t;this._supportsRandomUUID=Boolean((null===(e=(t=r.crypto).randomUUID)||void 0===e?void 0:e.call(t).length)>0)}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}},{key:"storageAvailable",get:function(){var e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}},{key:"setLocalStorageItem",value:function(e,t){this.storageAvailable&&localStorage.setItem(e,t)}},{key:"getLocalStorageItem",value:function(e){return this.storageAvailable&&localStorage.getItem(e)}},{key:"removeLocalStorageItem",value:function(e){this.storageAvailable&&localStorage.removeItem(e)}},{key:"ctrlKey",get:function(){return this.isMac?"metaKey":"ctrlKey"}},{key:"metaKey",get:function(){return this.isMac?"ctrlKey":"metaKey"}},{key:"searchParam",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=arguments.length>2&&arguments[2]!==i?arguments[2]:document.location.search,r=new RegExp("[?&]".concat(e,"=?([^&]*)")),a=n.match(r);return a&&a[1]||t}},{key:"getCookie",value:function(e){for(var t=encodeURIComponent(e)+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}return""}},{key:"download",value:function(e,t){var n=document.createElement("a");n.download=e,n.href=t||e,n.style.cssText="display:none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"downloadBlob",value:function(e,t){var n=r.URL.createObjectURL(e);this.download(t,n),r.URL.revokeObjectURL(n)}},{key:"queryString",get:function(){var e,t=new URL(r.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}},{key:"copyToClipboard",value:function(e){var t=!0,n=document.createElement("textarea");n.value=e,n.style.height=n.style.width=0,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){t=!1}return n.remove(),t}},{key:"isBryntumOnline",value:function(e){var t,n=this;return e=Array.isArray(e)?e:[e],Boolean(/^(www\.)?bryntum\.com$/.test(r.location.host)||(null===(t=e)||void 0===t?void 0:t.some((function(e){return null!=n.queryString[e]}))))}},{key:"isCSP",get:function(){var e=r.bryntum,t=r.document;return null==e.CSP&&(e.CSP=Boolean(t.querySelector('meta[http-equiv="Content-Security-Policy"]'))),e.CSP}}])}();S(ne,"$name","BrowserHelper"),S(ne,"supportsPointerEvents",Boolean(r.PointerEvent||r.MSPointerEvent)),S(ne,"supportsPointerEventConstructor","undefined"!=typeof PointerEvent),S(ne,"PointerEventConstructor",r.PointerEvent||r.CustomEvent),S(ne,"isPhone",null===(q=r.matchMedia)||void 0===q?void 0:q.call(r,"(max-height:414px) or (max-width:414px)").matches),te.register(ne),ne.isBrowserEnv&&ne.cacheFlags(),ne._$name="BrowserHelper";var re,ie,ae,oe,le=Object.prototype,se=le.hasOwnProperty,ue=le.propertyIsEnumerable,ce=le.toString,de=Object.isFrozen,he=/\s*<\s*/,fe=/\s*>\s*/,ve={},ge={},me=Object.freeze({}),pe=function(){function e(){m(this,e)}return w(e,null,[{key:"assign",value:function(e){for(var t,n,r=0;r<(arguments.length<=1?0:arguments.length-1);r++)if(t=r+1<1||arguments.length<=r+1?i:arguments[r+1])for(n in t)"__proto__"!==n&&"constructor"!==n&&(e[n]=t[n]);return e}},{key:"assignIf",value:function(e){for(var t,n,r=0;r<(arguments.length<=1?0:arguments.length-1);r++)if(t=r+1<1||arguments.length<=r+1?i:arguments[r+1])for(n in t)"__proto__"!==n&&"constructor"!==n&&(n in e&&e[n]!==i||(e[n]=t[n]));return e}},{key:"blend",value:function(t,n,r){t=t||{};var i,a,o,l=r=r||ve,s=l.clone,u=void 0===s?e.clone:s,c=l.merge,d=void 0===c?e.blend:c;if(Array.isArray(n)){if(n.length>1)return n.forEach((function(n){t=e.blend(t,n,r)})),t;n=n[0]}if(n)for(a in n)"__proto__"!==a&&"constructor"!==a&&((o=n[a])&&e.isObject(o)&&(i=t[a],r.key=a,i&&e.isObject(i)?(de(i)&&(t[a]=i=u(i,r)),o=d(i,o,r)):o=de(o)?o:u(o,r)),t[a]=o);return t}},{key:"clone",value:function(t,n){var r,i=t;if(t&&"object"===W(t)&&!(t instanceof Event))if(n&&"object"===W(n)&&n&&(n=null),e.isObject(t))if(t.skipClone)i=t;else for(r in i={},t)"__proto__"!==r&&"constructor"!==r&&(i[r]=e.clone(t[r]));else if(Array.isArray(t))for(i=[],r=t.length;r-- >0;)i[r]=e.clone(t[r]);else e.isDate(t)?i=new Date(t.getTime()):n&&(i=n(t));return i}},{key:"mergeUniformObjects",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];for(var l in o)if("__proto__"!==l&&"constructor"!==l){var s=o[l];s&&(this.isObject(s)?this.mergeUniformObjects(e[l]||(e[l]={}),s):Array.isArray(s)?(l in e||(e[l]=[]),this.mergeArrayOfIdentityObjects(e[l],s)):e[l]=this.clone(s))}}return e}},{key:"mergeArrayOfIdentityObjects",value:function(e,t){var n,r=this,i=D(t);try{var a=function(){var t=n.value;if(r.isObject(t)){var i=e.find((function(e){return e.id===t.id}));i?r.mergeUniformObjects(i,t):e.push(r.clone(t))}else e.push(t)};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}},{key:"createTruthyKeys",value:function(e){var t=Le.split(e),n=t&&{};if(t){var r,i=D(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;a&&(n[a]=!0)}}catch(e){i.e(e)}finally{i.f()}}return n}},{key:"getPath",value:function(e,t){return t.split(".").reduce((function(e,t){return(e||me)[t]}),e)}},{key:"getPathDefault",value:function(e,t,n){var r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=r.length-1;return r.reduce((function(e,t,r){return n&&!(t in e)&&(e[t]=r===i?n:{}),(e||me)[t]}),e)}},{key:"getPropertyDescriptor",value:function(t,n){for(var r=null,i=t;i&&!r&&!e.hasOwn(i,"isBase");i=Object.getPrototypeOf(i))r=Object.getOwnPropertyDescriptor(i,n);return r}},{key:"hasPath",value:function(e,t){return t.split(".").every((function(t){return!(!e||!(t in e))&&(e=e[t],!0)}))}},{key:"getTruthyKeys",value:function(e){var t;if("string"==typeof e)t=[e];else if(Array.isArray(e))t=e.slice();else if(t=[],e)for(var n in e)e[n]&&t.push(n);return t}},{key:"getTruthyValues",value:function(e){var t=[];if(e)for(var n in e)e[n]&&t.push(e[n]);return t}},{key:"isClass",value:function(e){var t;return"function"==typeof e&&(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e}},{key:"isDate",value:function(t){return Boolean(null==t?void 0:t.getUTCDate)&&"date"===e.typeOf(t)}},{key:"isPromise",value:function(e){if(null!=Promise&&Promise.resolve)return Promise.resolve(e)===e||"function"==typeof(null==e?void 0:e.then);throw new Error("Promise not supported in your environment")}},{key:"isEmpty",value:function(e){if(e&&"object"===W(e))for(var t in e)return!1;return!0}},{key:"isObject",value:function(t){var n=null==t?void 0:t.constructor;return Boolean(!n||"function"!=typeof n||e.hasOwn(t,"constructor")||ue.call(t,"constructor")?t&&"object"===W(t):(n===Object||n.getPrototypeOf&&n.prototype&&!Object.getPrototypeOf(n.prototype))&&t!==r)}},{key:"isInstantiated",value:function(t){return!!t&&("object"===W(t)&&!e.isObject(t))}},{key:"merge",value:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return e.blend(t,r)}},{key:"mergeItems",value:function(t,n,r){var i,o,l,s,u,c,d,h=(r=r||ve).merge,f=void 0===h?e.blend:h;if(t=t||{},Array.isArray(n))n.forEach((function(n){t=e.mergeItems(t,n,r)}));else if(n)for(u in n)if("__proto__"!==u&&"constructor"!==u){if(d=n[u],i=null,u.includes(">")){var v=_(u.split(fe),2);u=v[0],i=v[1],o=0}else if(u.includes("<")){var g=_(u.split(he),2);i=g[0],u=g[1],o=1}if(u in t)d&&t[u]&&f&&(r.key=u,d=f(t[u],d,r)),t[u]=d;else if(i){if(!s)for(var m in s=new a,l=0,t)s.set(m,l++);if(l=s.get(i),t[u]=d,null==l&&o)l=s.size;else{c=c||[],l=(l||0)+o;var p,y=D(s);try{for(y.s();!(p=y.n()).done;){var k=_(p.value,2),b=k[0],C=k[1];l<=C&&(c&&(c[s.size-C-1]=b),s.set(b,C+1))}}catch(e){y.e(e)}finally{y.f()}if(c)for(;c.length;){var w=c.pop(),S=t[w];delete t[w],t[w]=S}}s.set(u,l)}else{var x;t[u]=d,null===(x=s)||void 0===x||x.set(u,s.size)}}return t}},{key:"setPath",value:function(e,t,n){return t.split(".").reduce((function(e,t,r,i){return r===i.length-1?e[t]=n:(e[t]instanceof Object||(e[t]={}),e[t])}),e),e}},{key:"typeOf",value:function(e){var t,n;return null===e?n="null":e!=e?n="nan":"object"===(n=W(e))?e.isBase?n="instance":Array.isArray(e)?n="array":(n=ge[t=ce.call(e)])||(ge[t]=n=t.slice(8,-1).toLowerCase()):"function"===n&&e.isBase&&(n="class"),n}}])}();Object.defineProperty(pe,"hasOwn",{value:Object.hasOwn||function(e,t){return se.call(e,t)}}),pe._$name="Objects";var ye=/([a-z])([A-Z])/g,ke=/[\n\r]/g,be=/[.*+?^${}()|[\]\\]/g,Ce=/[&<]/,we=/(^[^a-z]+[^\w]+)/gi,De=/\s+/,Se=/^[^a-z]+|[^\w:.-]+/gi,xe=function(e,t){return ie[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10))},Ee=function(e,t){return re[t]},Re=function(e,t,n){return"".concat(t,"-").concat(n.toLowerCase())},Te=function(e,t,n){return"".concat(t," ").concat(n.toLowerCase())},Me=function(e){return e?"_x".concat(z(e).map((function(e){return e.charCodeAt(0).toString(16)})).join("")):"__blank__"},Fe={},Ae={},Ie=[],Le=function(){function e(){m(this,e)}return w(e,null,[{key:"circularReplacer",value:function(e,t){if(null!=t&&t.isBase)return t.id;if(t&&"object"===W(t)){for(;Ie.length&&Ie[Ie.length-1]!==this;)Ie.pop();if(Ie.includes(t))return"[Circular]";Ie.push(t)}return t}},{key:"capitalize",value:function(e){return e&&e[0].toUpperCase()+e.substr(1)}},{key:"uncapitalize",value:function(e){return e&&e[0].toLowerCase()+e.substr(1)}},{key:"hyphenate",value:function(e){var t=Fe[e];return t||(Fe[e]=e.replace(ye,Re))}},{key:"hyphenateAttributeName",value:function(e){return/^(data|aria)[A-Z]/.test(e)?e.replace(/^(data|aria)([A-Z])/,(function(e,t,n){return"".concat(t,"-").concat(n)})).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase():e}},{key:"separate",value:function(e){var t=Ae[e];return t||(Ae[e]=this.capitalize(e.replace(ye,Te)))}},{key:"createId",value:function(e){return String(e).replace(we,Me)}},{key:"makeValidDomId",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"";return null==e?null:String(e).replace(Se,t)}},{key:"escapeRegExp",value:function(e,t){var n=e.replace(be,"\\$&");return t!==i&&(n=new RegExp(n,t)),n}},{key:"decodeHtml",value:function(e){return e&&String(e).replace(oe,xe)}},{key:"encodeHtml",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"";return e&&String(e).replace(ae,Ee)}},{key:"encodeHtmlBR",value:function(t){var n;return null===(n=e.encodeHtml(t))||void 0===n?void 0:n.replace(ke,"<br>")}},{key:"isHtml",value:function(e){return"string"==typeof e&&Ce.test(e||"")}},{key:"initHtmlEntities",value:function(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};var t=Object.keys(e);re=e,ie=t.reduce((function(t,n){return t[e[n]]=n,t}),{}),ae=new RegExp("([".concat(t.map((function(e){return"[-]".includes(e)?"\\"+e:e})).join(""),"])"),"g"),oe=new RegExp("(".concat(Object.values(e).join("|"),"|&#[0-9]+;)"),"ig")}},{key:"safeJsonParse",value:function(e){var t=null;try{t=JSON.parse(e)}catch(e){}return t}},{key:"safeJsonStringify",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=arguments.length>2&&arguments[2]!==i?arguments[2]:null,r=null;try{"circular"===t&&(Ie.length=0,t=this.circularReplacer),r=JSON.stringify(e,t,n)}catch(e){}return r}},{key:"joinPaths",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"/";return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}},{key:"split",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:De,n=e;return"string"==typeof n&&(n=(n=e.trim())?n.split(t):[]),n}},{key:"xss",value:function(t){for(var n=[],r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=i.length;for(n[o]=t[o];o-- >0;)n[o]=t[o]+e.encodeHtml(i[o]);return n.join("")}},{key:"xssBR",value:function(t){for(var n=[],r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=i.length;for(n[o]=t[o];o-- >0;)n[o]=t[o]+e.encodeHtmlBR(i[o]);return n.join("")}},{key:"toJavaScriptValue",value:function(t,n){var i=pe.typeOf(t);if("boolean"===i||"string"===i||"number"===i||null===t)return e.safeJsonStringify(t);if(t===r)return"window";if("date"===i)return"new Date(".concat(t.getFullYear(),", ").concat(t.getMonth(),", ").concat(t.getDate(),", ").concat(t.getHours(),", ").concat(t.getMinutes(),", ").concat(t.getSeconds(),", ").concat(t.getMilliseconds(),")");if("array"===i)return"[".concat(t.map((function(t){return e.toJavaScriptValue(t,n)})),"]");if("object"===i||"instance"===i)return this.toJavaScriptString(t,n);if("function"===i){var a=t.toString();return a.match(/^async (\w+?)\(/)?a=a.replace(/^async (\w+?)\(/,"async function("):!a.startsWith("async(")&&a.match(/^(\w+?)\(/)&&(a=a.replace(/^(\w+?)\(/,"function(")),a}return"class"===i?t.toJavaScriptValue?t.toJavaScriptValue(n):Object.prototype.hasOwnProperty.call(t,"$name")?t.$name:t.name:void 0}},{key:"toJavaScriptString",value:function(t){var n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:{},a=null!==(n=r.level)&&void 0!==n?n:0;return"{\n"+Object.keys(t).map((function(n){return" ".repeat(2*(a+1))+(n.match(/[- *]/)?'"'.concat(n,'"'):n)+": ".concat(e.toJavaScriptValue(t[n],F(F({},r),{},{level:a+1})))})).join(",\n")+"\n"+" ".repeat(2*a)+"}"}},{key:"encodeAttributeSelector",value:function(e,t){return"[".concat(e,'="').concat(String(t).replace(/["\\]/g,"\\$&"),'"]')}},{key:"generateUUID",value:function(){var t;return ne.supportsRandomUUID?r.crypto.randomUUID():null!==(t=r.crypto)&&void 0!==t&&t.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^r.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})):"".concat(Date.now(),"-").concat(++e.fakeNodeUUIDIndex)}}])}();S(Le,"$name","StringHelper"),S(Le,"fakeNodeUUIDIndex",0),Le.initHtmlEntities(),te.register(Le),Le._$name="StringHelper";var Oe=Object.freeze([]),Pe=pe.hasOwn,_e=function(){var e=f(L().mark((function e(t,n){var r,i,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n,i=!1,a=!1,e.prev=3,l=c(t);case 5:return e.next=7,l.next();case 7:if(!(i=!(s=e.sent).done)){e.next=13;break}return r=s.value,e.abrupt("break",13);case 10:i=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),a=!0,o=e.t0;case 19:if(e.prev=19,e.prev=20,!i||null==l.return){e.next=24;break}return e.next=24,l.return();case 24:if(e.prev=24,!a){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])})));return function(t,n){return e.apply(this,arguments)}}(),He="1.01"===1.005.toFixed(2)?null:function(e,t){var n=e.toString().split("."),r=+(n[1]?n.join(".")+"1":n[0]);return e.toFixed.call(r,t)},Be=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"forEach",value:function(e,t){var n;if(e)if(Array.isArray(e))e.forEach(t);else for(n in e)t(e[n],n)}},{key:"transformArrayToNamedObject",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"ref",n={};return e.forEach((function(e,r){var i=null!=e[t]&&e[t].toString().length?e[t]:r;n[i]=e})),n}},{key:"transformNamedObjectToArray",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"ref";return Object.keys(e).filter((function(t){return e[t]})).map((function(n){var r=e[n];return r[t]=n,r}))}},{key:"isEqual",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];if(!(arguments.length>3&&arguments[3]!==i&&arguments[3])&&(null===e&&null!==t||e===i&&t!==i||null===t&&null!==e||t===i&&e!==i))return!1;if(null==e||null==t)return null==e&&null==t;if(e===t)return!0;var r=W(e);if(r===W(t)){switch(r){case"number":case"string":case"boolean":return e===t}switch(!0){case e.isModel&&t.isModel:return e.equals(t);case e.isBase&&t.isBase:return e===t;case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every((function(e,r){return Ve.isEqual(e,t[r],n)}));case"object"===r&&e.constructor.prototype===t.constructor.prototype:return n?Ve.isDeeplyEqual(e,t,n):te.String.safeJsonStringify(e,"circular")===te.String.safeJsonStringify(t,"circular")}}return String(e)===String(t)}},{key:"isDeeplyEqual",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:{};if(e===t)return!0;if(!e||!t)return!1;var r=Ve.keys(e,n.ignore),a=Ve.keys(t,n.ignore);if(r.length!==a.length)return!1;for(var o=0;o<r.length;o++){var l=r[o],s=a[o];if(l!==s)return!1;var u=e[l],c=t[s];if(!n.shouldEvaluate||!1!==n.shouldEvaluate(l,{value:u,object:e},{value:c,object:t})){if(n.evaluate){var d=n.evaluate(l,{value:u,object:e},{value:c,object:t});if(!1===d)return!1;if(!0===d)continue}if(!Ve.isEqual(u,c,n))return!1}}return!0}},{key:"isPartial",value:function(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!==e.indexOf(t)}},{key:"isLessThan",value:function(e,t){return e instanceof Date&&t instanceof Date?te.Date.isBefore(e,t):e<t}},{key:"isMoreThan",value:function(e,t){return e instanceof Date&&t instanceof Date?te.Date.isAfter(e,t):e>t}},{key:"first",value:function(e,n){var r,a=n;if(e)if(e[Symbol.iterator]){var o,l=D(e);try{for(l.s();!(o=l.n()).done;){a=o.value;break}}catch(e){l.e(e)}finally{l.f()}}else if(e[Symbol.asyncIterator])a=_e(e,n);else if(t.isObject(e))for(r in a===i&&(a=Oe),e){a=[r,e[r]];break}return a}},{key:"fork",value:function(e){var t,n,r;if(e&&e.constructor===Object)for(n in t=Object.create(e),e)(r=e[n])&&(r.constructor===Object?t[n]=Ve.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}},{key:"copyProperties",value:function(e,t,n){var r,i;for(i=0;i<n.length;i++)(r=n[i])in t&&(e[r]=t[r]);return e}},{key:"copyPropertiesIf",value:function(e,t,n){if(t){var r,i=D(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;!(a in e)&&a in t&&(e[a]=t[a])}}catch(e){i.e(e)}finally{i.f()}}return e}},{key:"copyPropertiesExcept",value:function(e,t,n){if(t)for(var r in t)null!=n&&n[r]||(e[r]=t[r]);return e}},{key:"entries",value:function(e,t){var n=[],r="function"==typeof t;if(e)for(var i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push([i,e[i]]);return n}},{key:"fromEntries",value:function(e,t){if(t=t||{},e)for(var n=0;n<e.length;++n)t[e[n][0]]=e[n][1];return t}},{key:"keys",value:function(e,t,n){var r=[],i="function"==typeof t;if(e){var a=0;for(var o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(o,a):o),++a)}return r}},{key:"values",value:function(e,t,n){var r=[],i="function"==typeof t;if(e){var a=0;for(var o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(e[o],a):e[o]),++a)}return r}},{key:"pathExists",value:function(e,t){return t.split(".").every((function(t){return!(!e||!(t in e))&&(e=e[t],!0)}))}},{key:"pathifyKeys",value:function(e,t){var n={};for(var r in e)if(Pe(e,r)){var i=null==t?void 0:t[r],a="object"===(null==i?void 0:i.type)||(null==i?void 0:i.complexMapping)||!Boolean(t);if(a&&Array.isArray(e[r]))n[r]=e[r].slice();else if(a&&e[r]instanceof Object){var o=this.pathifyKeys(e[r]);for(var l in o)n["".concat(r,".").concat(l)]=o[l]}else n[r]=e[r]}return n}},{key:"deletePath",value:function(e,t){t.split(".").reduce((function(e,t,n,r){if(null==e)return null;if(Pe(e,t)){if(n!==r.length-1)return e[t];delete e[t]}}),e)}},{key:"coerce",value:function(e,t){var n=pe.typeOf(e),r=pe.typeOf(t),a="string"==typeof e;if(n!==r)switch(r){case"string":return String(e);case"number":return Number(e);case"boolean":return!(a&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!a||e&&"null"!==e)&&null;case"undefined":return!(!a||e&&"undefined"!==e)&&i;case"date":return a&&isNaN(e)?te.Date.parse(e):Date(Number(e))}return e}},{key:"wrapProperty",value:function(e,t,n,r){for(var a=!(arguments.length>4&&arguments[4]!==i)||arguments[4],o={},l=Object.getPrototypeOf(e),s=Object.getOwnPropertyDescriptor(l,t);!s&&l&&a;)(l=Object.getPrototypeOf(l))&&(s=Object.getOwnPropertyDescriptor(l,t));s?(s.set?o.set=function(t){s.set.call(e,t),r&&r.call(e,s.get.call(e))}:o.set=r,s.get?o.get=function(){var t=s.get.call(e);return n&&(t=n.call(e,t)),t}:o.get=n):(o.set=function(n){e["_".concat(t)]=n,r&&r.call(e,n)},o.get=function(){var r=e["_".concat(t)];return n&&(r=n.call(e,r)),r}),Object.defineProperty(e,t,o)}},{key:"hookProperty",value:function(e,n,r){var i=t.getPropertyDescriptor(r.prototype,"value"),a=t.getPropertyDescriptor(e,n),o="_".concat(n),l=function(){return w((function e(){m(this,e)}),[{key:"value",get:function(){return a?a.get.call(this):this[o]},set:function(e){a?a.set.call(this,e):this[o]=e}}])}(),s=t.getPropertyDescriptor(l.prototype,"value");return Object.setPrototypeOf(r.prototype,l.prototype),Object.defineProperty(e,n,{configurable:!0,get:i.get||s.get,set:i.set||s.set}),function(){return delete e[n]}}},{key:"cleanupProperties",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return Object.entries(e).forEach((function(n){var r=_(n,2),a=r[0],o=r[1];t?o===i&&delete e[a]:null==o&&delete e[a]})),e}},{key:"removeAllProperties",value:function(e){return Object.keys(e).forEach((function(t){return delete e[t]})),e}},{key:"assertType",value:function(e,t,n){var r=pe.typeOf(e);if(null!=e&&r!==t)throw new Error('Incorrect type "'.concat(r,'" for ').concat(n,', expected "').concat(t,'"'))}},{key:"assertObject",value:function(e,t){Ve.assertType(e,"object",t)}},{key:"assertInstance",value:function(e,t){Ve.assertType(e,"instance",t)}},{key:"assertClass",value:function(e,t){Ve.assertType(e,"class",t)}},{key:"assertFunction",value:function(e,t){if("function"!=typeof e||e.isBase||e.$$name)throw new Error("Incorrect type for ".concat(t,', got "').concat(e,'" (expected a function)'))}},{key:"assertNumber",value:function(e,t,n){var r=Number(e);if("number"!=typeof e||isNaN(r)||n&&e<0)throw new Error("Incorrect type for ".concat(t,', got "').concat(e,'" (expected a ').concat(n?"positive ":"","Number)"))}},{key:"assertBoolean",value:function(e,t){Ve.assertType(e,"boolean",t)}},{key:"assertString",value:function(e,t){Ve.assertType(e,"string",t)}},{key:"assertArray",value:function(e,t){Ve.assertType(e,"array",t)}},{key:"toFixed",value:function(e,t){return He?He(e,t):e.toFixed(t)}},{key:"roundTo",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1;return Math.round(e/t)*t}},{key:"round",value:function(e,t){if(null==t)return e;var n=Math.pow(10,t);return Math.round(e*n)/n}},{key:"getMapPath",value:function(e,t,n){var r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=1===r.length,a=r[0],o=e.has(a)?e.get(a):e.set(a,i?n:{}).get(a);return i?o:Ve.getPathDefault(o,r.slice(1),n)}}])}(pe);S(Be,"$name","ObjectHelper"),te.register(Be);var Ve=Be;Be._$name="ObjectHelper";var Ne=function(){function e(){m(this,e)}return w(e,null,[{key:"setVersion",value:function(n,i){n=n.toLowerCase(),ze[n]={version:i,isNewerThan:function(t){return e.semanticCompareVersion(t,i,"<")},isOlderThan:function(t){return e.semanticCompareVersion(t,i,">")}};var a="";a="".concat(t,".");var o="".concat(a).concat(n).concat(i.replace(/\./g,"-"));if(ne.isBrowserEnv&&!r.bryntum.silenceBundleException)if(!0===r.bryntum[o]){if(!this.isTestEnv){var l=a||n;"core"===l&&(l="grid");var s=Le.capitalize(l);throw"schedulerpro"===l&&(s="SchedulerPro"),new Error("The Bryntum ".concat(s," bundle was loaded multiple times by the application.\n\n")+"Common reasons you are getting this error includes:\n\n* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)\n* Imports point to both sources and bundle\n* Imports do not use the shortest relative path, JS treats them as different files\n"+"* Cache busters differ between imports, JS treats ".concat(l,".module.js?1 and ").concat(l,".module.js?2 as different files\n")+"* Imports missing file type, verify they all end in .js\n\n"+"See https://bryntum.com/products/".concat(l,"/docs/guide/").concat(s,"/gettingstarted/es6bundle#troubleshooting for more information\n\n"))}r.BUNDLE_EXCEPTION=!0}else r.bryntum[o]=!0}},{key:"getVersion",value:function(e){if(e=e.toLowerCase(),!ze[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return ze[e].version}},{key:"semanticCompareVersion",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:"=";t=t||"";var r=(e=e||"").split(/[-.]/),a=t.split(/[-.]/),o=n.includes("<"),l=function(e,t){for(var n=["rc","beta","alpha"],r=e.map((function(e){if(n.includes(e))return-n.indexOf(e)-2;var t=Number.parseInt(e);return Number.isNaN(t)?-n.length:t}));r.length<t;)r.push(-1);return r},s=function(){for(var e=Math.max(r.length,a.length),t=l(r,e),n=l(a,e),i=0;i<e;i++)if(t[i]!==n[i])return o?t[i]<n[i]:t[i]>n[i];return!0};switch(n){case"=":return e===t;case"<=":case">=":return e===t||s();case"<":case">":return e!==t&&s()}return!1}},{key:"checkVersion",value:function(t,n,r){return e.semanticCompareVersion(ze.getVersion(t),n,r)}},{key:"deprecate",value:function(e,t,n){if(!ze.checkVersion(e,t,"<"))throw new Error("Deprecated API use. ".concat(n));console.warn("Deprecation warning: You are using a deprecated API which will change in v".concat(t,". ").concat(n))}},{key:"isTestEnv",get:function(){var e,t=Boolean(null===(e=r.bryntum)||void 0===e?void 0:e.isTestEnv);try{var n;return t||Boolean(null===(n=r.parent)||void 0===n||null===(n=n.bryntum)||void 0===n?void 0:n.isTestEnv)}catch(e){return t}}},{key:"isDebug",get:function(){return!1}}])}();S(Ne,"$name","VersionHelper");var ze=Ne;ne.isBrowserEnv&&(ze.isTestEnv&&(ne._isHoverableDevice=!0),r.bryntum=Object.assign(r.bryntum||{},{getVersion:ze.getVersion.bind(ze),checkVersion:ze.checkVersion.bind(ze),deprecate:ze.deprecate.bind(ze),license:"9867512b-2f0e-11f0-ab90-0aa8b363f5dd"})),te.register(Ne),Ne._$name="VersionHelper";var je={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1},We=function(){return w((function e(){m(this,e)}),null,[{key:"apply",value:function(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;var t=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,n,e.prototype),!0}},{key:"internalOverrideAll",value:function(e,t,n){var r=this;Reflect.ownKeys(n).forEach((function(i){if(t.includes(i)&&!je[i]){for(var a=Object.getOwnPropertyDescriptor(n,i),o=e,l=null;!l&&o;)(l=Object.getOwnPropertyDescriptor(o,i))||(o=Object.getPrototypeOf(o));l&&r.internalOverride(o,i,a,l)}}))}},{key:"internalOverride",value:function(e,t,n,r){(e._overridden=e._overridden||{})[t]=e[t],r.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:n.get}):e[t]=n.value}},{key:"shouldApplyOverride",value:function(e){var t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!Ne[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!Ne[t.product].isOlderThan(t.minVersion))}}])}();We._$name="Override";var $e=function(){function e(){m(this,e)}return w(e,[{key:"magnitudeCompare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"lexicalCompare",value:function(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}}],[{key:"clean",value:function(e){return e.reduce((function(e,t){return null===t||t===i||Array.isArray(t)&&0===t.length||""===t||e.push(t),e}),[])}},{key:"from",value:function(e,t,n){var r=[];if(e){var i,a=D(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;t&&!t(o)||r.push(n?n(o):o)}}catch(e){a.e(e)}finally{a.f()}}return r}},{key:"remove",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,l=!1;n=n[0]instanceof o?z(n[0]):n;for(var s=0;s<n.length;s++)a=n[s],-1!==(i=e.indexOf(a))&&(e.splice(i,1),l=!0);return l}},{key:"findInsertionIndex",value:function(e,t){var n,r,a=arguments.length>2&&arguments[2]!==i?arguments[2]:this.lexicalCompare,o=arguments.length>3?arguments[3]:i,l=t.length;return o<l&&(n=o>0?a(t[o-1],e):0,r=o<l-1?a(e,t[o]):0,n<1&&r<1)?o:this.binarySearch(t,e,a)}},{key:"findLast",value:function(e,t,n){for(var r=e.length-1;r>=0;r--)if(t.call(n,e[r],r,e))return e[r]}},{key:"binarySearch",value:function(e,t){var n,r,a=arguments.length>2&&arguments[2]!==i?arguments[2]:0,o=arguments.length>3&&arguments[3]!==i?arguments[3]:e.length,l=arguments.length>4&&arguments[4]!==i?arguments[4]:this.lexicalCompare,s=e.length;for(a instanceof Function?(l=a,a=0):o instanceof Function&&(l=o,o=s),--o;a<=o;)(r=l(t,e[n=a+o>>1]))>=0?a=n+1:r<0&&(o=n-1);return a}},{key:"fill",value:function(e){for(var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},n=arguments.length>2&&arguments[2]!==i?arguments[2]:null,r=[],a=Array.isArray(t)?t:[t],o=0;o<e;o++){var l,s=D(a);try{for(s.s();!(l=s.n()).done;){var u=l.value,c=Object.assign({},u);n&&n(c,o),r.push(c)}}catch(e){s.e(e)}finally{s.f()}}return r}},{key:"populate",value:function(e,t){for(var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=[],a=0;a<e;a++)r.push(t(a+(n?1:0)));return r}},{key:"include",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e.includes(o)||e.push(o)}}},{key:"unique",value:function(e){return z(new o(e))}},{key:"countUnique",value:function(e){var t,n=new a,r=D(e);try{for(r.s();!(t=r.n()).done;){var o=t.value,l=n.get(o);n.set(o,l===i?1:l+1)}}catch(e){r.e(e)}finally{r.f()}return z(n.entries()).map((function(e){var t=_(e,2);return{value:t[0],count:t[1]}}))}},{key:"allowNegative",value:function(e){return new Proxy(e,{get:function(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);var r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set:function(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);var i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,n,r):(e[i<0?e.length+i:i]=n,!0)}})}},{key:"delta",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];if(!t)return n?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};for(var r=[],a=[],l=new o,s=new o(t),u=0;u<e.length;u++){var c=e[u];s.has(c)?l.add(c):r.push(c)}for(var d=0;d<t.length;d++){var h=t[d];l.has(h)||a.push(h)}return n?{toAdd:r,toRemove:a,toKeep:l}:{onlyInA:r,onlyInB:a,inBoth:z(l)}}},{key:"asArray",value:function(e){return null==e?e:e instanceof o?Array.from(e):Array.isArray(e)?e:[e]}},{key:"identity",value:function(e){return e}},{key:"keyBy",value:function(t,n){var r=arguments.length>2&&arguments[2]!==i?arguments[2]:e.identity,a="string"==typeof n?function(e){return null==e?void 0:e[n]}:n,o="string"==typeof r?function(e){return null==e?void 0:e[r]}:r;return t.reduce((function(e,t){return e[a(t)]=o(t),e}),{})}},{key:"aggregate",value:function(e,t,n,r){var a=arguments.length>4&&arguments[4]!==i?arguments[4]:{},o=e.length,l=[];if(!o)return l;var s=e[0].length;a.targetArray=l,a.arrays=e;for(var u=0;u<s;u++)a.entryIndex=u,l.push(r(u,a));for(var c=0;c<o;c++){var d=e[c];a.rowIndex=c;for(var h=0;h<s;h++){a.entryIndex=h;var f=t(d[h],a);l[h]=n(l[h],f,c,h,a)}}return l}},{key:"groupBy",value:function(e,t){var n="string"==typeof t?function(e){return null==e?void 0:e[t]}:t;return e.reduce((function(e,t){var r=n(t);return(e[r]=e[r]||[]).push(t),e}),{})}},{key:"groupByIndexed",value:function(e,t){return e.reduce((function(e,n){var r=t(n),a=e.get(r);return a===i&&(a=new o,e.set(r,a)),a.add(n),e}),new a)}}])}();S($e,"$name","ArrayHelper"),te.register($e),$e._$name="ArrayHelper";var Ue,Ge=function(){return w((function e(){m(this,e)}),null,[{key:"animationFrame",value:function(){return new Promise((function(e){requestAnimationFrame(e)}))}},{key:"sleep",value:function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))}},{key:"waitFor",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:6e4,r=arguments.length>2&&arguments[2]!==i?arguments[2]:100,a=new Promise((function(i,a){var o;t=i;var l=function(){var t=e();if(t)return clearInterval(o),i(t),!0};l()||(o=setInterval(l,r),n&&setTimeout((function(){clearInterval(o),n>0?a():i()}),Math.abs(n)))}));return a.resolve=t,a}},{key:"yield",value:function(){return Promise.resolve()}}])}();Ge._$name="AsyncHelper";var Ye=["border-top-width","border-right-width","border-bottom-width","border-left-width"],qe=["margin-top","margin-right","margin-bottom","margin-left"],Ke=["padding-top","padding-right","padding-bottom","padding-left"],Xe="border-top-width",Ze="border-right-width",Je="border-bottom-width",Qe="border-left-width",et="padding-top",tt="padding-right",nt="padding-bottom",rt="padding-left",it=/^([trblc])(\d*)-([trblc])(\d*)$/i,at=/^([trblc])(\d*)$/i,ot=["top","right","bottom","left"],lt={t:0,r:1,b:2,l:3},st=["b-t","l-r","t-b","r-l"],ut={bt:1,tb:1,lr:2,rl:2},ct=Object.freeze([0,0]),dt=["width","height"],ht=function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e,n=arguments.length>2&&arguments[2]!==i?arguments[2]:e,r=arguments.length>3&&arguments[3]!==i?arguments[3]:t;return Array.isArray(e)?ht.apply(null,e):[e,t,n,r]},ft=function(e,t,n,r){return Array.isArray(e)?ht.apply(null,e):"number"==typeof e.top?[e.top,e.right,e.bottom,e.left]:[e,t,n,r]},vt=function(e,t){var n=it.exec(e),r=n[1],i=n[3],a=parseInt(n[2]||50),o=parseInt(n[4]||50),l=!t||1&lt[r]?a:100-a,s=!t||1&lt[i]?o:100-o;return{myAlignmentPoint:r+l,myEdge:r,myOffset:l,targetAlignmentPoint:i+s,targetEdge:i,targetOffset:s,startZone:lt[i],edgeAligned:ut[r+i]}},gt=function(e){return"".concat(ot[(lt[e.myEdge]+2)%4][0]).concat(e.myOffset,"-").concat(ot[(lt[e.targetEdge]+2)%4][0]).concat(e.targetOffset)},mt={hidden:1,clip:1},pt=function(){function e(t,n,r,a){var o=!(arguments.length>4&&arguments[4]!==i)||arguments[4];m(this,e),S(this,"isRectangle",!0),o&&(Be.assertNumber(t,"Rectangle.x"),Be.assertNumber(n,"Rectangle.y"),Be.assertNumber(r,"Rectangle.width",!0),Be.assertNumber(a,"Rectangle.height",!0));var l=this;r<0&&(t+=r,r=-r),a<0&&(n+=a,a=-a),l._x=t,l._y=n,l._width=r,l._height=a}return w(e,[{key:"roundPx",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:r.devicePixelRatio||1,t=this;return t._x=li.roundPx(t._x,e),t._y=li.roundPx(t._y,e),t._width=li.roundPx(t._width,e),t._height=li.roundPx(t._height,e),t}},{key:"$$name",get:function(){return this.constructor.$$name}},{key:"clone",value:function(){var t=this,n=new e(t.x,t.y,t.width,t.height,!1);return n.isAlignRectangle=t.isAlignRectangle,n.minHeight=t.minHeight,n.minWidth=t.minWidth,n}},{key:"contains",value:function(e){var t=this;return!!e.isRectangle&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}},{key:"exclude",value:function(){for(var e,t=this,n=t.clone(),r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o,l=D(Array.from(i).flat());try{for(l.s();!(o=l.n()).done;){var s,u,c;e=o.value;var d=void 0,h=void 0,f=[0,0,0,0];((d=e.x<=t.x)||e.right>=t.right)&&(null===(s=h=e.intersect(t))||void 0===s?void 0:s.height)>=t.height?f[d?3:1]=-h.width:((d=e.y<=t.y)||e.bottom>=t.bottom)&&(null===(u=h=e.intersect(t))||void 0===u?void 0:u.width)>=t.width&&(f[d?0:2]=-h.height),n=(c=n).inflate.apply(c,f)}}catch(e){l.e(e)}finally{l.f()}return n}},{key:"intersect",value:function(t){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this,o=Math.max(a.y,t.y),l=Math.min(a.right,t.right),s=Math.min(a.bottom,t.bottom),u=Math.max(a.x,t.x),c=r?s>=o&&l>=u:s>o&&l>u;return!!c&&(!!n||new e(u,o,l-u,s-o))}},{key:"equals",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1]?function(e){return Math.round(e)}:function(e){return e};return e.isRectangle&&t(e.x)===t(this.x)&&t(e.y)===t(this.y)&&t(e.width)===t(this.width)&&t(e.height)===t(this.height)}},{key:"translate",value:function(e,t){return this._x+=e||0,this._y+=t||0,this}},{key:"moveTo",value:function(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}},{key:"getDelta",value:function(e){return[e.x-this.x,e.y-this.y]}},{key:"center",get:function(){var e=new yt(this.x+this.width/2,this.y+this.height/2,0,0);return e.target=this.target,e}},{key:"x",get:function(){return this._x},set:function(e){var t=e-this._x;this._x=e,this._width-=t}},{key:"start",get:function(){return this.left}},{key:"left",get:function(){return this.x},set:function(e){this.x=e}},{key:"top",get:function(){return this.y},set:function(e){this.y=e}},{key:"y",get:function(){return this._y},set:function(e){var t=e-this._y;this._y=e,this._height-=t}},{key:"width",get:function(){return this._width},set:function(e){Be.assertNumber(e,"Rectangle.width",!this._allowNegative),this._width=e}},{key:"height",get:function(){return this._height},set:function(e){Be.assertNumber(e,"Rectangle.height",!this._allowNegative),this._height=e}},{key:"right",get:function(){return this._x+this._width},set:function(e){this._width=e-this._x}},{key:"end",get:function(){return this.right}},{key:"bottom",get:function(){return this._y+this._height},set:function(e){this._height=e-this._y}},{key:"getStart",value:function(e){return!(arguments.length>1&&arguments[1]!==i)||arguments[1]?e?this.right:this.left:this.top}},{key:"getEnd",value:function(e){return!(arguments.length>1&&arguments[1]!==i)||arguments[1]?e?this.left:this.right:this.bottom}},{key:"area",get:function(){return this.width*this.height}},{key:"minWidth",get:function(){return this._minWidth},set:function(e){var t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}},{key:"minHeight",get:function(){return this._minHeight},set:function(e){var t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}},{key:"adjust",value:function(e,t,n,r,i){var a=this;return a._allowNegative=i,a.x+=e,a.y+=t,a.width+=n,a.height+=r,a}},{key:"inflate",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e,n=arguments.length>2&&arguments[2]!==i?arguments[2]:e,r=arguments.length>3&&arguments[3]!==i?arguments[3]:t,a=_(ft(e,t,n,r),4);return e=a[0],t=a[1],n=a[2],r=a[3],this.adjust(-r,-e,t,n)}},{key:"deflate",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e,n=arguments.length>2&&arguments[2]!==i?arguments[2]:e,r=arguments.length>3&&arguments[3]!==i?arguments[3]:t,a=_(ft(e,t,n,r),4);return e=a[0],t=a[1],n=a[2],r=a[3],this.adjust(r,e,-t,-n)}},{key:"constrainTo",value:function(e,t){var n=this,r=n.height,i=n.y,a=n.minWidth||n.width,o=n.minHeight||n.height;if(n.height>=e.height){if(t&&o>e.height)return!1;n._y=e.y,n.height=e.height}if(n.width>=e.width){if(t&&a>e.width)return n.y=i,n.height=r,!1;n._x=e.x,n.width=e.width}return n.translate.apply(n,n.constrainVector=[Math.min(e.right-n.right,0),Math.min(e.bottom-n.bottom,0)]),n.translate(Math.max(e.x-n.x,0),Math.max(e.y-n.y,0)),n}},{key:"alignTo",value:function(t){var n,i,a,o,l=this.clone(),s=t.target,u=t.constrainTo,c=t.constrainPadding,d=t.inflate;if(s&&(s=s.isRectangle?s.clone():e.from(s.element?s.element:s),d&&s.inflate.apply(s,Array.isArray(d)?d:[d])),u){if(!u.isRectangle){o=u===r||u===document;var h="ignorePageScroll"in t?t.ignorePageScroll:!o;u=e.from(u.element?u.element:u,null,h)}c&&((c=ht(c))[0]=Math.min(c[0],s.top),c[1]=Math.min(c[1],u.right-s.right),c[2]=Math.min(c[2],u.bottom-s.bottom),c[3]=Math.min(c[3],s.left),u=u.deflate.apply(u.clone(),c))}var f,v=this,g=null==(f=t.offset)?ct:"number"==typeof f?[f,f]:f,m=t.align,p=t.axisLock,y=t.anchorSize,k=t.anchorPosition,b=t.matchSize,C=t.position,w=t.rtl,D=s&&s.width<2&&s.height<2,x=vt(m,w),E=u&&u.clone(),R=[],T=[{zone:i=x.startZone,align:m}],M=b&&dt[1&x.startZone],F=v[M];if(M&&p?l[M]="min"===b?Math.max(l.width,s[M]):s[M]:!x.edgeAligned&&b&&(l.width=s.width,l.height=s.height),u&&l.constrainTo(u),u&&null!=x.startZone)if(p)T.push({zone:i=(i+2)%4,align:gt(x)}),"flexible"===p&&(T.push({zone:i=(x.startZone+1)%4,align:st[i]}),T.push({zone:i=(i+2)%4,align:st[i]}));else for(var A=1;A<4;A++)T.push({zone:i=(i+1)%4,align:st[i]});if(k){var I=1&x.startZone?"y":"x";n=S(S({},I,k[I]),"edge",ot[(x.startZone+2)%4])}if(E&&s&&(E.adjust(-s.width,-s.height,s.width,s.height),s.constrainTo(E)),l.minWidth=v.minWidth,l.minHeight=v.minHeight,C)l.moveTo(C.x,C.y),l.translate.apply(l,g),u&&l.constrainTo(u);else{var L,O="c"===x.myEdge||"c"===x.targetEdge,P=y&&!O?[y[1]+g[0],y[1]+g[1]]:g,_=s.getAlignmentPoint(x.targetAlignmentPoint),H=s.getAlignmentPoint(x.targetAlignmentPoint,P),B=l.getAlignmentPoint(x.myAlignmentPoint),V=!D&&l.clone().translate(_[0]-B[0],_[1]-B[1]).intersect(s,!0);if(l.translate(H[0]-B[0],H[1]-B[1]),V)l.translate(-(H[0]-B[0]),-(H[1]-B[1])),B=l.getAlignmentPoint(x.myAlignmentPoint),l.translate(_[0]-B[0],_[1]-B[1]),(L=l).translate.apply(L,z(P)),u&&l.constrainTo(u),a=x.startZone;else if(u&&!u.contains(l)){var N,j,W=l.clone(),$=[];n=null,R[0]=N=u.clone(),N.bottom=s.y-P[1],R[1]=N=u.clone(),N.x=s.right+P[0],R[2]=N=u.clone(),N.y=s.bottom+P[1],R[3]=N=u.clone(),N.right=s.x-P[0];for(var U=0;U<T.length;U++){if(M&&2===U&&(l[M]=F),N=R[a=T[U].zone],(l=l.alignTo({target:s,offsets:P,align:T[U].align})).constrainTo(N,!0)&&($.push({result:l,zone:a}),!j||l.width<v.width||l.height<v.height)){l.align=T[U].align;break}if(!j||N.area>j.area){var G=l.clone();switch(a){case 0:G.moveTo(null,N.bottom-G.height);break;case 1:G.moveTo(N.left);break;case 2:G.moveTo(null,N.top);break;case 3:G.moveTo(N.right-G.width)}j={area:N.area,result:G,zone:a}}}$.length?($.length>1&&!p&&$.sort((function(e,t){return Math.sqrt(Math.pow(W.x-e.result.x,2)+Math.pow(W.y-e.result.y,2))-Math.sqrt(Math.pow(W.x-t.result.x,2)+Math.pow(W.y-t.result.y,2))})),l=$[0].result,a=$[0].zone):(l=j.result,a=j.zone,o&&l.constrainTo(u))}else a=x.startZone;if(l.overlap=V=!D&&l.intersect(s,!0),l.zone=a,y&&!V){if(!n){var Y=1&a,q=Y?"y":"x",K=Y?"bottom":"right",X=Math.max(s[q],l[q]),Z=X+(Math.min(s[K],l[K])-X)/2-y[0]/2,J=Z+y[0];J>l[K]&&(Z-=J-l[K]),Z<l[q]&&(Z+=l[q]-Z),n=S(S({},q,Z-l[q]),"edge",ot[(a+2)%4])}l.anchor=n}}return l}},{key:"getAlignmentPoint",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:ct;e=String(e);var n=this,r=at.exec(e)||it.exec(e),a=r&&r[1].toLowerCase(),o=r&&Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(a){case"t":return[n.x+n.width*o,n.y-t[1]];case"r":return[n.right+t[0],n.y+n.height*o];case"b":return[n.x+n.width*o,n.bottom+t[1]];case"l":return[n.x-t[0],n.y+n.height*o];case"c":return[n.x+n.width/2,n.y+n.height/2]}}},{key:"highlight",value:function(){var e=this,t=li.createElement({parent:document.body,style:"position:absolute;z-index:9999999;pointer-events:none;\n                            left:".concat(e.x,"px;top:").concat(e.y,"px;width:").concat(e.width,"px;height:").concat(e.height,"px")});return li.highlight(t).then((function(){return t.remove()}))}},{key:"visualize",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=Be.merge({style:F(F({width:"".concat(r.width,"px"),height:"".concat(r.height,"px"),pointerEvents:"none"},e.class?{}:{position:"absolute","z-index":9999999}),n?{insetInlineStart:r.x,top:r.y}:{left:0,top:0,transform:"translate(".concat(r.x,"px, ").concat(r.y,"px)")})},e);return t?a:li.createElement(a)}},{key:"toString",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:",";return["".concat(this.top,"px"),"".concat(this.right,"px"),"".concat(this.bottom,"px"),"".concat(this.left,"px")].join(e)}}],[{key:"from",value:function(t,n,a){var o,l;if("string"==typeof t?t=document.querySelector(t):(null===(o=t)||void 0===o?void 0:o.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(t=t.host||t.ownerDocument),"string"==typeof n&&(n=document.querySelector(n)),null==t||t.isRectangle)return t;if(t=t.element||t,a===i&&"boolean"==typeof n&&(a=n,n=null),null===(l=n)||void 0===l||!l.isRectangle)if(n){var s=n,u=s.scrollLeft,c=s.scrollTop;ne.isSafari&&n===document.body&&(u=c=0),n=e.from(n).translate(-u,-c)}else Ue||(Ue=new e(0,0,0,0)),n=Ue;var d=t===document||t===r,h=t===document.body&&0===document.body.offsetHeight,f=h&&t.getBoundingClientRect(),v=h?new e(f.left,f.top,f.width,document.body.parentElement.scrollHeight):d?new e(0,0,r.innerWidth,r.innerHeight):t.getBoundingClientRect(),g=a||d?[0,0]:[r.pageXOffset,r.pageYOffset];return new e(v.left+g[0]-n.x,v.top+g[1]-n.y,v.width,v.height)}},{key:"fromScreen",value:function(t,n){return e.from(t,n,!0)}},{key:"inner",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this.from(e,t,n);if(document.body.contains(e)){var a=li.getStyleValue(e,Ye);r.x+=parseFloat(a[Qe]),r.y+=parseFloat(a[Xe]),r.right-=parseFloat(a[Ze]),r.bottom-=parseFloat(a[Je])}return r}},{key:"content",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this.from(e,t,n);if(document.body.contains(e)){var a=li.getStyleValue(e,Ye),o=li.getStyleValue(e,Ke);r.x+=parseFloat(a[Qe])+parseFloat(o[rt]),r.y+=parseFloat(a[Xe])+parseFloat(o[et]),r.right-=parseFloat(a[Ze])+parseFloat(o[tt]),r.bottom-=parseFloat(a[Je])+parseFloat(o[nt])}return r}},{key:"client",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=arguments.length>3?arguments[3]:i,o=arguments.length>4?arguments[4]:i,l=!(arguments.length>5&&arguments[5]!==i)||arguments[5],s=this[l?"content":"inner"](e,t,r),u=li.scrollBarWidth;return u&&!e.classList.contains("b-hide-scroll")&&(e.scrollHeight>e.clientHeight&&!mt[li.getStyleValue(e,"overflow-y")]&&(n=l?parseFloat(li.getStyleValue(e,"padding-inline-end")):0,"rtl"===li.getStyleValue(e,"direction")?s.x+=n+Math.max(n,u):s.right+=n-Math.max(n,u)),e.scrollWidth>e.clientWidth&&!mt[li.getStyleValue(e,"overflow-x")]&&(n=l?parseFloat(li.getStyleValue(e,"padding-bottom")):0,s.bottom+=n-Math.max(n,u))),a&&this.clipStickies(s,e,t,r=!1,o),s}},{key:"clipStickies",value:function(t,n,r){var a=arguments.length>3&&arguments[3]!==i&&arguments[3],o=arguments.length>4?arguments[4]:i,l=z(n.children).filter((function(e){return"sticky"===li.getStyleValue(e,"position")}));if(o){var s=o&&e.from(o,r,a);l=l.filter((function(t){return!t.contains(o)&&s.intersect(e.from(t))}))}for(var u=0,c=l.length;u<c;u++){var d=l[u],h=this.fromScreen(d);0===parseFloat(li.getStyleValue(d,"left"))?t.x+=h.width:0===parseFloat(li.getStyleValue(d,"right"))?t.right-=h.width:0===parseFloat(li.getStyleValue(d,"top"))?t.y+=h.height:0===parseFloat(li.getStyleValue(d,"bottom"))&&(t.bottom-=h.height)}return t}},{key:"outer",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this.from(e,t,n);if(document.body.contains(e)){var a=li.getStyleValue(e,qe);r.x-=parseFloat(a["margin-left"]),r.y-=parseFloat(a["margin-top"]),r.right+=parseFloat(a["margin-right"]),r.bottom+=parseFloat(a["margin-bottom"])}return r}},{key:"union",value:function(){var t,n=arguments.length<=0?i:arguments[0],r=n.x,a=n.y,o=n.right,l=n.bottom;if(arguments.length>1)for(var s=1;s<arguments.length;s++)(t=s<0||arguments.length<=s?i:arguments[s]).x<r&&(r=t.x),t.y<a&&(a=t.y),t.right>o&&(o=t.right),t.bottom>l&&(l=t.bottom);return new e(r,a,o-r,l-a)}},{key:"$$name",get:function(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}}])}(),yt=function(e){function t(e,n){return m(this,t),g(this,t,[e,n,0,0])}return R(t,e),w(t,[{key:"constrain",value:function(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}},{key:"toArray",value:function(){return[this.x,this.y]}}],[{key:"from",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1]?"client":"screen";return e.changedTouches&&(e=e.changedTouches[0]),new this(e["".concat(t,"X")],e["".concat(t,"Y")])}}])}(pt);pt._$name="Rectangle";var kt=Symbol("value"),bt=Symbol("length"),Ct=function(){function e(){m(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.process(1,n)}return w(e,[{key:"clear",value:function(){for(var e in this)this[e]=!1;return this}},{key:"set",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.clear().process(1,t)}},{key:"isDomClassList",get:function(){return!0}},{key:"clone",value:function(){return new e(this)}},{key:"contains",value:function(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}},{key:"toString",value:function(){return this.length?"".concat(this.value," "):""}},{key:"toJSON",value:function(){return this.toString()}},{key:"trim",value:function(){return this.value}},{key:"isEqual",value:function(t){var n=e.normalize(t,"array"),r=n.length;if(this.length===r){for(var i=0;i<r;i++)if(!this[n[i]])return!1;return!0}return!1}},{key:"value",get:function(){var e,t=this[kt];return null==t&&(e=pe.getTruthyKeys(this),this[bt]=e.length,this[kt]=t=e.join(" ")),t},set:function(e){for(var t=this,n=Object.keys(t),r=n.length,i=0;i<r;i++)delete t[n[i]];e?t.process(1,[e]):delete t[kt]}},{key:"values",get:function(){return pe.getTruthyKeys(this)}},{key:"length",get:function(){return this.value?this[bt]:0}},{key:"process",value:function(t,n){for(var r,i,a=0;a<n.length;a++)if(n[a])if((r=n[a]).isDomClassList||pe.isObject(r))for(i in r)this[i]=t?r[i]:!r[i];else for(r=e.normalize(n[a],"array"),i=0;i<r.length;++i)this[r[i]]=t;return delete this[kt],this}},{key:"assign",value:function(e){for(var t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[kt]);return this}},{key:"assignTo",value:function(t){var n=t.nodeType===Element.ELEMENT_NODE?t.classList:t,r=e.from(n);r.add(this),n.value=r.value}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.process(1,t)}},{key:"remove",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.process(0,t)}},{key:"toggle",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:Boolean(!this[e]);if(t=Boolean(t),Boolean(this[e])!==t)return this[e]=t,delete this[kt],!0}},{key:"split",value:function(){return pe.getTruthyKeys(this)}},{key:"forEach",value:function(e){return pe.getTruthyKeys(this).forEach(e)}}],[{key:"change",value:function(t,n,r){var a=arguments.length>3&&arguments[3]!==i?arguments[3]:"string";r=e.normalize(r,"object");var o=e.normalize(t,"array").filter((function(e){return!r[e]}));if(n){n=e.normalize(n,"array");for(var l=0;l<n.length;++l)o.includes(n[l])||o.push(n[l])}return e.normalize(o,a)}},{key:"from",value:function(t,n){return t&&(t.isDomClassList?n=null==n||n:(n=null!=n?n:pe.isObject(t)&&!pe.isEmpty(t),t=new e(t)),t.value||n||(t=null)),t||(n?new e:null)}},{key:"normalize",value:function(e){var t,n,r,l,s=arguments.length>1&&arguments[1]!==i?arguments[1]:"string",u=W(e=e||""),c="array"===s,d=!c&&!("object"===s),h="string"===u;"object"===u&&(e.nodeType===Element.ELEMENT_NODE&&"function"==typeof e.getAttribute?(e=e.getAttribute("class")||"",h=!0):null!==(l=e)&&void 0!==l&&l.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof a?e=Array.from(e.keys()).filter((function(t){return e.get(t)})):e instanceof o?e=Array.from(e):Array.isArray(e)||(e=pe.getTruthyKeys(e)));for(h&&(e=Le.split(e)),n=e.length;n-- >0;)if((t=e[n]).length){if(t.includes(" ")){var f;(f=e).splice.apply(f,[n,1].concat(z(Le.split(t))))}}else e.splice(n,1);if(e=z(new o(e)),c)r=e;else if(d)r=e.join(" ");else for(r=Object.create(null),n=0;n<e.length;++n)r[e[n]]=!0;return r}}])}();Ct.prototype[kt]=null,Ct._$name="DomClassList";var wt=/,\s*/,Dt=Symbol("decompiled"),St=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,xt=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,Et=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,Rt=Object.prototype.hasOwnProperty,Tt=function(){function e(){m(this,e)}return w(e,null,[{key:"after",value:function(t,n,r,a,o){var l="string"==typeof r,s=!1!==(null==o?void 0:o.return),u=function(){for(var e,n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];var d=(e=u.$nextHook).call.apply(e,[t].concat(o)),h=null!=a&&a.isDestroyed?i:s?l?a[r].apply(a,[d].concat(o)):r.call.apply(r,[a,d].concat(o)):l?a[r].apply(a,o):r.call.apply(r,[a].concat(o));return h===i?d:h};return e.hookMethod(t,n,u)}},{key:"before",value:function(t,n,r,i){var a="string"==typeof r,o=function(){for(var e,n=arguments.length,l=new Array(n),s=0;s<n;s++)l[s]=arguments[s];var u=null!=i&&i.isDestroyed?0:a?i[r].apply(i,l):r.call.apply(r,[i].concat(l));return!1===u?u:(e=o.$nextHook).call.apply(e,[t].concat(l))};return e.hookMethod(t,n,o)}},{key:"curry",value:function(e){return function t(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return r.length>=e.length?e.apply(this,r):function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.apply(this,r.concat(n))}}}},{key:"bindAll",value:function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}},{key:"createInterceptor",value:function(e,t,n){return function(){for(var r=n||this,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return!1!==t.call.apply(t,[r].concat(a))&&e.call.apply(e,[r].concat(a))}}},{key:"createSequence",value:function(e,t,n,r){return function(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];var s=e.call.apply(e,[n=n||this].concat(o)),u=t.call.apply(t,[r||n].concat(o));return u===i?s:u}}},{key:"createThrottled",value:function(e,t,n,r,i){var a,o,l=-Number.MAX_VALUE,s=function(){o=0,l=performance.now(),a.push.apply(a,r),e.apply(n,a)},u=function(){for(var e=performance.now()-l,u=arguments.length,c=new Array(u),d=0;d<u;d++)c[d]=arguments[d];a=c,e>=t?(clearTimeout(o),s()):(o||(o=setTimeout(s,t-e)),i&&(a.push.apply(a,r),i.apply(n,a)))};return u.cancel=function(){return clearTimeout(o)},u}},{key:"createBuffered",value:function(e,t,n,r){var i,a,o=function(){a=0,l.isPending=!1,i.push.apply(i,r),e.apply(n,i)},l=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];i=n,a&&clearTimeout(a),l.isPending=!0,a=setTimeout(o,t)};return l.cancel=function(){l.isPending=!1,clearTimeout(a)},l}},{key:"decompile",value:function(e){if(!(Dt in e)){var t,n,r,i,a,o,l,s=e.toString(),u=St.exec(s);u?(r=[u[2]],i=u[3]):(u=xt.exec(s))?(r=(l=u[2].trim())?l.split(wt):[],i=u[3]):(u=Et.exec(s))&&(a=u[2],r=(l=u[3].trim())?l.split(wt):[],i=u[4]),i=null===(t=i)||void 0===t?void 0:t.trim(),e[Dt]=o=u&&{args:r,async:Boolean(u[1]),body:null!==(n=i)&&void 0!==n&&n.startsWith("{")?i.substring(1,i.length-1).trim():i},a&&(o.name=a)}return e[Dt]}},{key:"hookMethod",value:function(e,t,n){return n.$nextHook=e[t],e[t]=n,function(){if(Rt.call(e,t)){var r,i,a=e[t];if(a===n)(null===(i=Object.getPrototypeOf(e))||void 0===i?void 0:i[t])===n.$nextHook?delete e[t]:e[t]=n.$nextHook;else for(;r=null===(o=a)||void 0===o?void 0:o.$nextHook;a=r){var o;if(r===n){a.$nextHook=n.$nextHook;break}}}}}},{key:"noThrow",value:function(e,t,n){var r=e[t];e[t]=function(){try{for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return r.apply(e,i)}catch(e){return null==n?void 0:n(e)}}}},{key:"returnTrue",value:function(){return!0}},{key:"animate",value:function(e,t,n){var a=this,o=arguments.length>3&&arguments[3]!==i?arguments[3]:"linear",l=!1,s=new Promise((function(i){var s=performance.now(),u=function(){var c=Math.min((performance.now()-s)/e,1),d=null!=n&&n.setTimeout?n:r;l||!1===t.call(n,a.easingFunctions[o](c))&&i(),l||1===c?d.requestAnimationFrame((function(){return i()})):d.requestAnimationFrame(u)};u()}));return s.cancel=function(){return l=!0,s.cancelled=!0,!1},s}}])}();S(Tt,"$name","FunctionHelper"),te.register(Tt);var Mt=.5,Ft=1.70158,At=7.5625,It=1.525,Lt=2/2.75,Ot=2.25/2.75,Pt=1/2.75,_t=1.5/2.75,Ht=2.5/2.75,Bt=2.625/2.75,Vt=.75,Nt=.9375,zt=.984375;Tt.easingFunctions={linear:function(e){return e},easeInQuad:function(e){return Math.pow(e,2)},easeOutQuad:function(e){return-(Math.pow(e-1,2)-1)},easeInOutQuad:function(e){return(e/=Mt)<1?Mt*Math.pow(e,2):-.5*((e-=2)*e-2)},easeInCubic:function(e){return Math.pow(e,3)},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeInOutCubic:function(e){return(e/=Mt)<1?Mt*Math.pow(e,3):Mt*(Math.pow(e-2,3)+2)},easeInQuart:function(e){return Math.pow(e,4)},easeOutQuart:function(e){return-(Math.pow(e-1,4)-1)},easeInOutQuart:function(e){return(e/=Mt)<1?Mt*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeInQuint:function(e){return Math.pow(e,5)},easeOutQuint:function(e){return Math.pow(e-1,5)+1},easeInOutQuint:function(e){return(e/=Mt)<1?Mt*Math.pow(e,5):Mt*(Math.pow(e-2,5)+2)},easeInSine:function(e){return 1-Math.cos(e*(Math.PI/2))},easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInExpo:function(e){return 0===e?0:Math.pow(2,10*(e-1))},easeOutExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},easeInOutExpo:function(e){return 0===e?0:1===e?1:(e/=Mt)<1?Mt*Math.pow(2,10*(e-1)):Mt*(2-Math.pow(2,-10*--e))},easeInCirc:function(e){return-(Math.sqrt(1-e*e)-1)},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return(e/=Mt)<1?-.5*(Math.sqrt(1-e*e)-1):Mt*(Math.sqrt(1-(e-=2)*e)+1)},easeOutBounce:function(e){return e<Pt?At*e*e:e<Lt?At*(e-=_t)*e+Vt:e<Ht?At*(e-=Ot)*e+Nt:At*(e-=Bt)*e+zt},easeInBack:function(e){return e*e*((Ft+1)*e-Ft)},easeOutBack:function(e){return(e-=1)*e*((Ft+1)*e+Ft)+1},easeInOutBack:function(e){var t=1.70158;return(e/=Mt)<1?Mt*(e*e*((1+(t*=It))*e-t)):Mt*((e-=2)*e*((1+(t*=It))*e+t)+2)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1},swingFromTo:function(e){var t=1.70158;return(e/=Mt)<1?Mt*(e*e*((1+(t*=It))*e-t)):Mt*((e-=2)*e*((1+(t*=It))*e+t)+2)},swingFrom:function(e){return e*e*((Ft+1)*e-Ft)},swingTo:function(e){return(e-=1)*e*((Ft+1)*e+Ft)+1},bounce:function(e){return e<Pt?At*e*e:e<Lt?At*(e-=_t)*e+Vt:e<Ht?At*(e-=Ot)*e+Nt:At*(e-=Bt)*e+zt},bouncePast:function(e){return e<Pt?At*e*e:e<Lt?2-(At*(e-=_t)*e+Vt):e<Ht?2-(At*(e-=Ot)*e+Nt):2-(At*(e-=Bt)*e+zt)},easeFromTo:function(e){return(e/=Mt)<1?Mt*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeFrom:function(e){return Math.pow(e,4)},easeTo:function(e){return Math.pow(e,.25)}},Tt._$name="FunctionHelper";var jt=Reflect.defineProperty,Wt=Reflect.getOwnPropertyDescriptor,$t=Object.prototype,Ut=$t.hasOwnProperty,Gt=$t.toString,Yt=Symbol("instanceProperties"),qt=Symbol("configuring"),Kt=Symbol("lazyConfigValues"),Xt=Gt.call(new Date),Zt=/\s+/,Jt=Object.hasOwn||function(e,t){return Ut.call(e,t)},Qt=function(e,t){return e===t||!(!e||!t||Gt.call(e)!==Xt||Gt.call(t)!==Xt)&&e.getTime()===t.getTime()},en=function(e,t){return e.setHours(0,0,0,0),t&&e.setDate(e.getDate()+t),e},tn={now:function(){return new Date},today:function(){return en(new Date)},tomorrow:function(){return en(new Date,1)},yesterday:function(){return en(new Date,-1)}},nn=function(e,t){return e[t]=1,e},rn=function(){function e(t){m(this,e);var n=this,r=t[0].toUpperCase()+t.substr(1);n.base=n,n.name=t,n.field="_"+t,n.capName=r,n.changer="change"+r,n.initializing="initializing"+r,n.updater="update"+r,n.updaterResult="".concat(t,"Updated")}return w(e,[{key:"descriptor",get:function(){var e=this._descriptor;return e&&Jt(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}},{key:"initDescriptor",get:function(){var e=this._initDescriptor;return e&&Jt(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}},{key:"convert",value:function(e,t){return e}},{key:"equal",value:function(e,t){return e===t}},{key:"extend",value:function(t){var n=Object.assign(Object.create(this),t),r=t.convert,i=t.equal,a=t.merge,o=e.convertMethods,l=e.equalityMethods;return"string"==typeof r&&!(n.convert=o[r])&&r.endsWith("[]")&&(n.convert=o[r]=e.makeArrayConvert(o[r.slice(0,-2)])),"string"==typeof i&&!(n.equal=l[i])&&i.endsWith("[]")&&(n.equal=l[i]=e.makeArrayEquals(l[i.slice(0,-2)])),"string"==typeof a&&(n.merge=e.mergeMethods[a]),n}},{key:"define",value:function(e){var t=this.name,n=Wt(e,t),r=this.descriptor;null!=n&&n.get&&((r=Object.assign({},r)).get=function(e,t){return function(){var n;return null===(n=this.configObserver)||void 0===n||n.get(e,this),t.call(this)}}(t,n.get)),jt(e,t,r)}},{key:"defineInitter",value:function(e,t){var n,r=this,i=r.name,o=e[Yt];o[i]||!(n=Wt(e,i))||"value"in n||(o[i]=n),jt(e,i,r.initDescriptor),r.lazy&&(e[Kt]||(e[Kt]=new a)).set(i,t)}},{key:"makeDescriptor",value:function(){var e=this.base,t=this.field,n=this.changer,r=this.updater,a=this.name,o=this.updaterResult;return e!==this?e.descriptor:{get:function(){var e;return null===(e=this.configObserver)||void 0===e||e.get(a,this),this[t]},set:function(e){var l,s,u,c=this,d=e,h=c.$meta.configs[a],f=c[t];if("string"==typeof e){var v,g=e;if(e.startsWith("up."))g=null===(v=c.owner)||void 0===v?void 0:v.resolveProperty(e.slice(3));else e.startsWith("this.")&&(g=c.resolveProperty(e.slice(5)));g!==i&&"function"!=typeof g&&(e=g)}(h.convert!==on&&(e=h.convert(e,c)),c[n]&&((l=(s=c[n](e,f))===i&&1)||(e=s,f=c[t])),l||(h.equal===ln?f===e:h.equal(f,e)))||(c[t]=e,l=2,c[o]=null===(u=c[r])||void 0===u?void 0:u.call(c,e,f));!l||c.isDestroyed||c.onConfigChange.$nullFn||c.onConfigChange({name:a,value:e,was:f,config:h,applied:l,origPassedValue:d})}}}},{key:"makeInitter",value:function(){var e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}},{key:"makeBasicInitter",value:function(){var e=this,t=e.initializing,n=e.name;return{configurable:!0,get:function(){var r=this;return e.removeInitter(r),r[t]=!0,r[n]=r[qt][n],r[t]=!1,r.configDone[n]=!0,r[n]},set:function(t){e.removeInitter(this),this.configDone[n]=!0,this[n]=t}}}},{key:"makeLazyInitter",value:function(){var e=this,t=e.initializing,n=e.name;return{configurable:!0,get:function(){var r=this,i=r[Kt].get(n);return e.removeInitter(r),r.isDestroying||(r[t]=!0,r[n]=i,r[t]=!1),r[n]},set:function(t){e.removeInitter(this),this[n]=t}}}},{key:"removeInitter",value:function(e){var t=this.name,n=e[Yt][t],r=e[Kt];n?jt(e,t,n):delete e[t],null!=r&&r.delete(t)&&!r.size&&delete e[Kt]}},{key:"setDefault",value:function(e,t){jt(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}},{key:"merge",value:function(e,t){if(t&&e&&pe.isObject(e)){if(t.isBase)return t.setConfig(e);pe.isObject(t)&&(e=pe.merge(pe.clone(t),e))}return e}}],[{key:"get",value:function(t,n){var r,i=this.cache,a=i[t]||(i[t]=new e(t)),o=a;return n&&((o=(r=e.makeCacheKey(t,n))&&i[r])||(o=a.extend(n),r&&(i[r]=o))),o}},{key:"makeArrayConvert",value:function(e){return function(t,n){var r=this;return null!=t&&(t=Array.isArray(t)?t.map((function(t,i){return e.call(r,t,n)})):[e.call(this,t,n)]),t}}},{key:"makeArrayEquals",value:function(e){return function(t,n){var r,i=t&&n&&t.length===(r=n.length);if(i&&Array.isArray(t)&&Array.isArray(n))if(e)for(;i&&r-- >0;)i=e(t[r],n[r]);else for(;i&&r-- >0;)i=t[r]===n[r];else i=e?e(t,n):t===n;return i}}},{key:"makeCacheKey",value:function(e,t){for(var n,r,i,a=Object.keys(t).sort(),o=a.length;o-- >0;)if(null==(i=t[n=a[o]])&&!1===i)a.splice(o,1);else{if("function"===(r=W(i)))return null;"string"===r?a[o]="".concat(n,':"').concat(i,'"'):"number"===r&&(a[o]="".concat(n,":").concat(i))}return a.length?"".concat(e,">").concat(a.join("|")):e}}])}(),an=rn.prototype,on=an.convert,ln=an.equal;rn.symbols={configuring:qt,instanceProperties:Yt,lazyConfigs:Kt},rn.cache=Object.create(null),rn.convertMethods={array:rn.makeArrayConvert(on),date:function(e,t){var n,r,i,a=e;if(tn[e])a=tn[e]();else if(null!=e){if("string"!=typeof e)n=new Date(e);else{if(i=this.formats){var o,l=D(i=i.flatMap((function(e){return e in t?t[e]:e})));try{for(l.s();!(o=l.n()).done&&!(n=(r=o.value)&&te.Date.parse(e,r)););}catch(e){l.e(e)}finally{l.f()}}n||(n=te.Date.parse(e))}if(isNaN(n)){if(this.strict)throw new Error("Invalid date: ".concat(e))}else a=n}return a},day:function(e,t){var n;return null===(n=e=rn.convertMethods.date.call(this,e,t))||void 0===n||n.setMinutes(0,0,0),e}},rn.equalityMethods={array:rn.makeArrayEquals(),date:Qt,day:Qt,strict:rn.equal=ln},rn.mergeMethods={distinct:function(e,t){var n,r,a=t?t.slice():[];if(null!=e)if(pe.isObject(e))if(t===i)a=e;else for(n in e)r=a.indexOf(n),e[n]?r<0&&a.push(n):r>-1&&a.splice(r,1);else Array.isArray(e)?e.forEach((function(e){return!a.includes(e)&&a.push(e)})):a.includes(e)||a.push(e);return a},merge:rn.merge=an.merge,classList:function(e,t){if("string"==typeof e){if(!e.length)return t;e=e.split(Zt)}return Array.isArray(e)&&(e=e.reduce(nn,{})),rn.merge(e,t)},objects:function(e,t){return!0===e?t||{}:rn.merge(e,t)},replace:function(e){return e},items:function(e,t,n,r){return r?pe.mergeItems(t,e,{merge:function(e,t){return an.merge(t,e)}}):an.merge(e,t)}},Object.assign(an,{_descriptor:null,_initDescriptor:null,date:!1,lazy:!1,nullify:!1,render:!1}),rn._$name="Config";var sn,un=function(){return w((function e(t,n,r,i){m(this,e);var a,o,l=this;for(a in l.destroyed=!1,l.mapFwd={},l.mapRev={},l.source=t,l.syncing=!1,l.target=n,l.sourceHook=te.Function.after(t,"onConfigChange",(function(e){return l.onConfigChange(e,!0)}),l,Sn),l.targetHook=null!=i&&i.oneway?null:te.Function.after(n,"onConfigChange",(function(e){return l.onConfigChange(e,!1)}),l,Sn),r)(o=r[a])&&("string"!=typeof o&&(o=a),l.mapFwd[a]=o,l.mapRev[o]=a);l.unbind=l.destroy.bind(l),l.unbind.binding=l}),[{key:"destroy",value:function(){var e,t;this.destroyed||(this.destroyed=!0,null===(e=this.sourceHook)||void 0===e||e.call(this),null===(t=this.targetHook)||void 0===t||t.call(this))}},{key:"onConfigChange",value:function(e,t){var n=this;(t?n.mapFwd:n.mapRev)[e.name]&&n.sync(t)}},{key:"sync",value:function(e){var t=this,n=_((e=!1!==e)?[t.source,t.target,t.mapFwd]:[t.target,t.source,t.mapRev],3),r=n[0],i=n[1],a=n[2];if(!t.syncing&&!r.isDestroying&&!i.isDestroying){var o,l,s,u,c,d,h=0;for(l in t.syncing=!0,a)u=a[l],(s=r[l])!==i[u]&&(++h,(o||(o={}))[c=u]=d=s);h>1?i.setConfig(o):h&&(i[c]=d),t.syncing=!1}}}])}(),cn=function(){return w((function e(t){m(this,e),t&&Object.assign(this,t)}),[{key:"getInherited",value:function(e){var t,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=this[e];e in this||((r=null===(t=this.super)||void 0===t?void 0:t.getInherited(e,n))||n)&&(this[e]=r=Object.create(r||null),hn(r,"$meta",{value:this}));return r}}])}(),dn=Object.getPrototypeOf,hn=Reflect.defineProperty,fn=function(e){return function(t,n){return e.call(t,n)}}(Object.prototype.hasOwnProperty),vn=Symbol("classMetaData"),gn=Symbol("mixinTag"),mn=Symbol("originalConfig"),pn=rn.symbols.configuring,yn=rn.symbols.instanceProperties,kn=rn.symbols.lazyConfigs,bn={merge:"replace",simple:!0},Cn=function(e){return te.Object.clone(e)},wn=function(){},Dn=function(e){return te.Object.isObject(e)},Sn={return:!1},xn={},En=Object.freeze({}),Rn=Object.freeze([]),Tn=/^(date|day)(\[])?$/,Mn=function(){function e(){m(this,e);var t=this,n=t.constructor;t.$meta.class!==n&&(n.$meta.initialized=!0),t.construct.apply(t,arguments),t.afterConstruct(),t.isConstructing=!1}return w(e,[{key:"isBase",get:function(){return!0}},{key:"construct",value:function(){null!==(arguments.length<=0?i:arguments[0])&&this.configure.apply(this,arguments),this.afterConfigure()}},{key:"destroy",value:function(){var e=this,t=e.id;for(var n in e.isDestroying=!0,e.destroy=wn,e.doDestroy(),Object.setPrototypeOf(e,null),e)"destroy"!==n&&"isDestroying"!==n&&delete e[n];delete e[mn],e.isDestroyed=!0,e.id=t}},{key:"_thisIsAUsedExpression",value:function(e){}},{key:"$$name",get:function(){return this.constructor.$$name}},{key:"startConfigure",value:function(e){}},{key:"finishConfigure",value:function(e){}},{key:"afterConfigure",value:function(){}},{key:"afterConstruct",value:function(){}},{key:"animateProperty",value:function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i?arguments[2]:1e3,a=arguments.length>3?arguments[3]:i,o=null==t,l=this[e]||0,s=(t||0)-l,u=Tt.animate(r,(function(t){return n[e]=l+s*t}),null,a);return o&&u.then((function(){return n[e]=null})),u}},{key:"callback",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:Rn,r=this.resolveCallback(e,"this"===t?this:t)||En,a=r.handler,o=r.thisObj;return null==a?void 0:a.apply(o,n)}},{key:"resolveProperty",value:function(t){for(var n=this;n;){if(e.hasConfigPath(n,t,!0))return te.Object.getPath(n,t);n=n.owner}return i}},{key:"resolveCallback",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this,r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];if(null!==(t=e)&&void 0!==t&&t.substring){if(e.endsWith("?")&&(r=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),n=this.owner;n&&!n[e];n=n.owner);if(!n)return}else e.startsWith("this.")&&(e=e.substring(5),n=this);if(!(n&&n instanceof Object))return;e=n[e]}if("function"==typeof e)return{handler:e,thisObj:n};if(r)throw new Error("No method named ".concat(e," on ").concat(n.$$name||"thisObj object"))}},{key:"bindCallback",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this;if(e){var n=this.resolveCallback(e,t),r=n.handler,a=n.thisObj;if(r)return r.bind(a)}}},{key:"delay",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:e.name||e;return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:r)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t,n)}},{key:"doDestroy",value:function(){var e=this,t=e.$meta.nullify;if(t)for(var n=0;n<t.length;++n)null!=e[t[n].field]&&(e[t[n].name]=null)}},{key:"destroyProperties",value:function(){for(var e,t=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var l,s;if((e=o[a])in t&&(!t[pn]||!t[pn][e]))null===(l=t[e])||void 0===l||null===(s=l.destroy)||void 0===s||s.call(l),delete t[e]}}},{key:"configure",value:function(){var e,t,n,r=arguments.length>0&&arguments[0]!==i?arguments[0]:{},a=this,o=a.$meta,l=(a.initialConfig=r).beforeConfigure,s=o.configs,u=a.getDefaultConfiguration();for(t in a.isConfiguring=!0,Object.assign(a,a.getProperties()),r)n=r[t],e=s[t],u[t]=e?e.merge(n,u[t],null,o):n;l&&(delete u.beforeConfigure,l(a,u)),a.setConfig(a[mn]=u,!0),a.isConfiguring=!1}},{key:"bindConfigs",value:function(e,t,n){var r=new un(this,e,t,n);return!1!==(null==n?void 0:n.sync)&&r.sync(),r.unbind}},{key:"getConfig",value:function(e){for(var t=this,n=this[e],r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i.length?[n].concat(z(i.map((function(e){return t[e]})))):n}},{key:"updateConfiguration",value:function(e){var t=this,n=t.configDone,r=t.$meta.configs,i=t[pn],a=t[kn];for(var o in t.recompose.suspend(),e){var l;if(n[o])t[o]=e[o];else null!==(l=r[o])&&void 0!==l&&l.lazy?a.set(o,e[o]):i[o]=e[o]}t.recompose.resume(),t.recompose.flush()}},{key:"setConfig",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=this,o=a[pn],l=o?a.configDone:a.configDone={},s=a.$meta.configs,u=a[kn];for(n in a[yn]={},a[pn]=o?Object.assign(Object.create(o),e):e,e)t=s[n]||rn.get(n),null!==e[n]||fn(e,n)||null===t.default?(null!=u&&u.has(n)||t.defineInitter(a,e[n]),r||(l[n]=!1)):l[n]=!0;for(n in r&&a.startConfigure(e),e){var c;l[n]||r&&null!==(c=s[n])&&void 0!==c&&c.lazy||(a[n]=e[n])}return o?a[pn]=o:delete a[pn],r&&a.finishConfigure(e),a}},{key:"hasConfig",value:function(e){var t,n=this,r=n[pn];return Boolean(null!=n["_"+e]||null!=(null===(t=n[kn])||void 0===t?void 0:t.get(e))||!n.configDone[e]&&r&&(null!=r[e]||fn(r,e)))}},{key:"peekConfig",value:function(e){var t=this,n=t[kn],r=t[pn];if(null!=n&&n.has(e))return n.get(e);if(r&&e in r){if(t.configDone[e])return t[e];if(null!=r[e]||fn(r,e))return r[e]}}},{key:"triggerConfig",value:function(e){var t=this,n=t.configDone,r=t[kn],i=t[pn],a=null!=r&&r.has(e)||i&&(null!=i[e]||fn(i,e))?!n[e]:null;return a&&t.getConfig(e),a}},{key:"triggerConfigs",value:function(e){var t,n=this,r=n.$meta.configs,i=n[kn],a=i?z(i.keys()).filter((function(t){return r[t].lazy===e})):Rn,o=D(a);try{for(o.s();!(t=o.n()).done;){var l=t.value;n.triggerConfig(l)}}catch(e){o.e(e)}finally{o.f()}return a.length?a:null}},{key:"onConfigChange",value:function(){}},{key:"config",get:function(){var e={},t=this[mn];for(var n in t)e[n]=t[n];return e}},{key:"getConfigValue",value:function(t,n){var r,i=this,a=i[kn];return null!==(r=i.$meta.configs[t])&&void 0!==r&&r.lazy?null!=a&&a.has(t)?e.processConfigValue(a.get(t),n):void 0:e.processConfigValue(i[t],n)}},{key:"preProcessCurrentConfigs",value:function(){}},{key:"getCurrentConfig",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this,n="all"===e.configs?t.config:Cn(t.initialConfig),r=e.skip||{},a=e.visited||(e.visited=new o),l=e.depth||(e.depth=0),s={};if(a.has(t))return i;for(var u in a.add(t),this.preProcessCurrentConfigs(n),n)if(!r[u]){var c=t.getConfigValue(u,F(F({},e),{},{depth:l+1}));c!==i&&(s[u]=c)}return s}},{key:"getConfigString",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return te.String.toJavaScriptString(this.getCurrentConfig(e))}},{key:"getTestCase",value:function(){}},{key:"downloadTestCase",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.output="return";var t=this.getTestCase(e);te.Browser.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}},{key:"getDefaultConfiguration",value:function(){var t=this.$meta,n=t.forkConfigs?e.fork(t.config):Object.create(t.config);if(Ne.isTestEnv&&te.Browser.isBrowserEnv&&n.testConfig&&r.__applyTestConfigs)for(var i in n.testConfig)n[i]=n.testConfig[i];return n}},{key:"getProperties",value:function(){for(var e=this.$meta.properties,t={},n=0;n<e.length;n++){var r=Object.getOwnPropertyDescriptor(e[n],"properties");Object.assign(t,r.get!==i?e[n].properties:Cn(r.value))}return t}},{key:"classHierarchy",value:function(e){var t=this.$meta.hierarchy,n=e?t.indexOf(e):0;return n>0?t.slice(n):t}},{key:"detachListeners",value:function(){var e=this.$detachers;if(e){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i,a=0,o=n.length;a<o;a++)if(i=e[n[a]])for(;i.length;)i.pop()()}}},{key:"trackDetacher",value:function(e,t){var n=this.$detachers||(this.$detachers={});(n[e]||(n[e]=[])).push(t)}},{key:"untrackDetachers",value:function(e){var t=this.$detachers;if(t)for(var n in t)for(var r=t[n],i=r.length;i-- >0;)r[i].eventer===e&&r.splice(i,1)}}],[{key:"isBase",get:function(){return!0}},{key:"declarable",get:function(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}},{key:"new",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new this(t=(t=t.filter((function(e){return e}))).length>1?this.mergeConfigs.apply(this,z(t)):t[0])}},{key:"destroy",value:function(){for(var e=function(t){null!=t&&t.destroy?t.destroy():Array.isArray(t)&&t.forEach(e)},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];e(n)}},{key:"$$name",get:function(){return fn(this,"$name")&&this.$name||fn(this,"_$name")&&this._$name||this.name}},{key:"hasConfigPath",value:function(e,t){return t.split(".").every((function(t){var n,r,a=null===(n=e)||void 0===n||null===(n=n.$meta)||void 0===n||null===(n=n.configs)||void 0===n?void 0:n[t];return!!(a&&a.descriptor.get===(null===(r=te.Object.getPropertyDescriptor(e,t))||void 0===r?void 0:r.get)?e.hasConfig(t):t in e)&&(e=e[t],Object!==i)}))}},{key:"processConfigValue",value:function(t,n){if(t===r)return r;if(Array.isArray(t))return t.map((function(t){return e.processConfigValue(t,n)}));if(t instanceof e){if(n.visited.has(t))return;return t.getCurrentConfig(n)}if(t instanceof HTMLElement||t instanceof DocumentFragment)return null;if(Dn(t)){var i={};for(var a in t)"owner"!==a&&(i[a]=e.processConfigValue(t[a],n));return i}return t}},{key:"initClass",value:function(){return this.$meta.class}},{key:"$meta",get:function(){if(!fn(this,vn)){var e=this[vn]=new cn;return e.class=this,this.setupClass(e),e}return this[vn]}},{key:"onClassMixedIn",value:function(){}},{key:"mergeConfigs",value:function(e){for(var t,n,r,i,a=this.$meta.configs,o=Cn(e)||{},l=arguments.length,s=new Array(l>1?l-1:0),u=1;u<l;u++)s[u-1]=arguments[u];for(n=0;n<s.length;++n)if(t=s[n])for(r in t)i=t[r],a[r]?i=a[r].merge(i,o[r]):o[r]&&i&&(i=rn.merge(i,o[r])),o[r]=i;return o}},{key:"mixin",value:function(){for(var e,t=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(e=0;e<r.length;++e){var a=r[e],o=a[gn]||(a[gn]=Symbol("mixinTag"));t[o]||((t=a(t))[o]=!0,fn(t,"onClassMixedIn")&&t.onClassMixedIn())}return t}},{key:"setupClass",value:function(e){var t,n=e.class,r=dn(n).$meta,i=n.$$name,a=r.names,o=n.prototype;if(hn(o,"$meta",{value:e}),Object.assign(e,{super:r,config:Object.create(r.config),configs:Object.create(r.configs),declarables:r.declarables,forkConfigs:r.forkConfigs,hierarchy:Object.freeze([].concat(z(r.hierarchy),[n])),names:a.includes(i)?a:Object.freeze([].concat(z(a),[i])),properties:r.properties,nullify:null===(t=r.nullify)||void 0===t?void 0:t.slice()}),a!==e.names){var l="is".concat(i),s=function(e){fn(e,l)||hn(e,l,{get:function(){return!0}})};s(o),s(n)}for(var u,c=0;c<e.declarables.length;++c)u=e.declarables[c],fn(n,u)&&n[xn[u]||(xn[u]="setup".concat(te.String.capitalize(u)))](n,e)}},{key:"setupConfigs",value:function(e,t,n){var r,a,o,l,s,u,c=e.config,d=e.configs,h=e.class,f=e.super,v=e.nullify;for(var g in t)s=t[g],n?(r=d[g])?s=r.merge(s,c[g],e,f):r=rn.get(g,bn):(a=o=l=i,s&&"object"===W(s)&&"$config"in s&&(o=s.$config,Tn.test(String(o))&&(o={type:o}),o&&(Dn(o)?o.type&&delete(o=F({convert:o.type,equal:o.type},o)).type:o=te.Object.createTruthyKeys(o)),a=(l="default"in s)?s.default:a,s="value"in s?s.value:null),(r=d[g])?(u=r.nullify,o&&(r=r.extend(o)),s=r.merge(s,c[g],e,f)):((r=rn.get(g,o)).define(h.prototype),l=!(r.field in h.prototype),u=!1),l&&r.setDefault(h,a),r.nullify&&!u&&(v||(v=e.nullify||(e.nullify=[]))).push(r)),s&&(Dn(s)||Array.isArray(s))&&!Object.isFrozen(s)&&(e.forkConfigs=!0),d[g]=r,c[g]=s}},{key:"setupConfigurable",value:function(e,t){e.setupConfigs(t,e.configurable,!1)}},{key:"setupDefaultConfig",value:function(e,t){e.setupConfigs(t,e.defaultConfig,!0)}},{key:"setupDeclarable",value:function(e,t){var n,r,i=e.declarable,a=t.declarables;for(r=0;r<i.length;++r)a.includes(i[r])||(n||(t.declarables=n=a=a.slice()),a.push(i[r]))}},{key:"setupProperties",value:function(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}},{key:"setupPrototypeProperties",value:function(e){Object.assign(e.prototype,e.prototypeProperties)}},{key:"fork",value:function(t){var n,r,i=t;if(t&&Dn(t)&&!Object.isFrozen(t))for(n in i=Object.create(t),t)(r=t[n])&&(Dn(r)?i[n]=e.fork(r):Array.isArray(r)&&(i[n]=r.slice()));return i}},{key:"getDefaultConfiguration",value:function(){return this.$meta.class.prototype.getDefaultConfiguration()}},{key:"applyDefaults",value:function(e){for(var t in e)this.$meta.config[t]=e[t]}},{key:"superclass",get:function(){return dn(this)}},{key:"isOfTypeName",value:function(e){return this.$meta.names.includes(e)}}])}(),Fn=Mn.prototype;Fn.onConfigChange.$nullFn=wn.$nullFn=!0,Mn[vn]=Fn.$meta=(sn={class:Mn,config:Object.freeze({}),configs:Object.create(null),declarables:Mn.declarable,forkConfigs:!1,hierarchy:Object.freeze([Mn]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null},new cn(sn)),Object.assign(Fn,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),Mn.emptyFn=wn,Ne.setVersion("core","6.2.2"),Mn._$name="Base";var An=Array.isArray,In=Object.prototype.hasOwnProperty,Ln={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},On=function(e,t){return t.prio-e.prio},Pn=function(e,t){if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[An(t)?"apply":"call"](e,t)}return e},_n=function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"eventsSuspended",null),e}return R(t,e),w(t,[{key:"destroy",value:function(){this.trigger("beforeDestroy"),B(t,"destroy",this,3)([])}},{key:"construct",value:function(e){var n;(this.configuredListeners=null===(n=e)||void 0===n?void 0:n.listeners)&&delete(e=pe.assign({},e)).listeners;for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];B(t,"construct",this,3)([e].concat(i)),this.processConfiguredListeners()}},{key:"processConfiguredListeners",value:function(){if(this.configuredListeners){var e=this,t=e.isConfiguring;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}},{key:"doDestroy",value:function(){this.trigger("destroy"),this.removeAllListeners(!1),B(t,"doDestroy",this,3)([])}},{key:"addListener",value:function(e,t,n){if(!An(e)){var a=this,o=a.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return a.addListener(S(S(S({},e,t),"detachable",!1!==t.detachable),"thisObj",n));t=e.thisObj=e.thisObj!==i?e.thisObj:t;var l=function(){if(!Ln[s]&&null!=e[s]){var n=s.toLowerCase(),l=null==o?void 0:o[n],u=a.eventListeners||(a.eventListeners={}),c=$e.asArray(e[s]);if(l){var d=l.product,h=l.invalidAsOfVersion,f=l.message;Ne.deprecate(d,h,f)}var v,g=D(c);try{var m=function(){var o,l=v.value,c=l.expires||e.expires,d={fn:"object"===W(l)?l.fn:l,thisObj:l.thisObj!==i?l.thisObj:t,args:l.args||e.args,prio:l.prio!==i?l.prio:e.prio!==i?e.prio:0,once:l.once!==i?l.once:e.once!==i&&e.once,buffer:l.buffer||e.buffer,throttle:l.throttle||e.throttle,$internal:e.$internal,catchAll:"catchAll"===s};if(c){var h=c.alt,f=h?c.delay:c,g=e.name||s,m=function(){a.un(n,d),h&&!d.called&&a.callback(h,t)};a.isDelayable?a.setTimeout({fn:m,name:g,cancelOutstanding:!0,delay:f}):r.setTimeout(m,f)}var p=u[n]||(u[n]=[]);p.$firing&&(u[n]=p=p.slice()),p.splice($e.findInsertionIndex(d,p,On,p.length),0,d),!a.onListen.$nullFn&&p.length<2&&a.onListen(n),null===(o=a.afterAddListener)||void 0===o||o.call(a,n,d)};for(g.s();!(v=g.n()).done;)m()}catch(e){g.e(e)}finally{g.f()}}};for(var s in e)l();e.relayAll&&a.relayAll(e.relayAll),t&&t!==a&&a.attachAutoDetacher(e,t);var u,c=!1!==e.detachable,d=e.name,h=e.expires||c||d?function(){a.isDestroyed||a.removeListener(e,t)}:null;return h&&(h.eventer=a,h.listenerName=d,d&&null!==(u=t)&&void 0!==u&&u.trackDetacher&&t.trackDetacher(d,h),e.expires&&a.delay(h,isNaN(e.expires)?e.expires.delay:e.expires,d),c)?h:void 0}for(var f=0,v=e.length;f<v;f++)this.addListener(e[f],t)}},{key:"on",value:function(e,t,n){return this.addListener(e,t,n)}},{key:"ion",value:function(e){return e.$internal=!0,this.on(e)}},{key:"un",value:function(){this.removeListener.apply(this,arguments)}},{key:"updateInternalListeners",value:function(e,t){null==t||t.detach(),e&&(e.detach=this.ion(e))}},{key:"listeners",get:function(){return this.eventListeners}},{key:"changeListeners",value:function(e){if(!this.isConfiguring){if(Array.isArray(e))for(var t=0,n=e[0],r=e.length;t<r;n=e[++t])"thisObj"in n||(e[t]=pe.assign({thisObj:this},n));else e&&!("thisObj"in e)&&(e=pe.assign({thisObj:this},e));return e}this.getConfig("internalListeners"),e&&this.on(e,this)}},{key:"updateListeners",value:function(e,t){t&&this.un(t),e&&this.on(e)}},{key:"removeListener",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e.thisObj,n=arguments.length>2?arguments[2]:i,r=this;if("string"==typeof e)return r.removeListener(S({},e,t),n);for(var a in e){var o=e[a];if(!Ln[a]&&null!=o){a=a.toLowerCase();var l=r.eventListeners,s=r.findListener(a,o,t);if(s>=0){var u,c=l[a];null===(u=r.afterRemoveListener)||void 0===u||u.call(r,a,c[s]),c.length>1?(c.$firing&&(l[a]=c=c.slice()),c.splice(s,1)):(delete l[a],r.onUnlisten.$nullFn||r.onUnlisten(a))}}}e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)}},{key:"findListener",value:function(e,t,n){var r,i=null===(r=this.eventListeners)||void 0===r?void 0:r[e],a=t.fn||t,o=t.thisObj||n;if(i)for(var l,s=0,u=i.length;s<u;s++)if((l=i[s]).fn===a&&l.thisObj===o)return s;return-1}},{key:"hasListener",value:function(e){var t;return Boolean(null===(t=this.eventListeners)||void 0===t?void 0:t[null==e?void 0:e.toLowerCase()])}},{key:"relayAll",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2];this.relayAllTargets||(this.relayAllTargets=[]);var r=this.relayAllTargets;e.ion({beforeDestroy:function(t){t.source===e&&r.filter((function(t){return t.through===e})).forEach((function(e){return $e.remove(r,e)}))}}),r.push({through:e,prefix:t,transformCase:n})}},{key:"removeAllListeners",value:function(){var e,t=!(arguments.length>0&&arguments[0]!==i)||arguments[0],n=this.eventListeners;for(var r in n){var a=n[r];for(e=a.length;e-- >0;){var o,l,s=a[e];if(!s.$internal||!t)this.removeListener(r,s),null===(o=s.thisObj)||void 0===o||null===(l=o.untrackDetachers)||void 0===l||l.call(o,this)}}}},{key:"relayEvents",value:function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i?arguments[2]:"",a=arguments.length>3?arguments[3]:i,o={detachable:!0,thisObj:this};return t.forEach((function(e){r&&(e=Le.capitalize(e)),o[e]=function(t){a&&(t=Object.assign({},t,{source:n}));for(var i=arguments.length,o=new Array(i>1?i-1:0),l=1;l<i;l++)o[l-1]=arguments[l];return n.trigger.apply(n,[r+e,t].concat(o))}})),e.on(o)}},{key:"onListen",value:function(){}},{key:"onUnlisten",value:function(){}},{key:"destructorInterceptor",value:function(){for(var e=this.autoDetachers,t=this.target,n=this.oldDestructor,r=0;r<e.length;r++){var i=e[r],a=i.dispatcher,o=i.config;a.isDestroyed||a.removeListener(o,t)}n.call(t)}},{key:"attachAutoDetacher",value:function(e,t){var n=this,r=e.thisObj||t,i="doDestroy"in r?"doDestroy":"destroy";if(i in r){var a=r.$autoDetachers;a||(r.$autoDetachers=a=[]),r.$oldDestructor||(r.$oldDestructor=r[i],r[i]=this.destructorInterceptor.bind({autoDetachers:a,oldDestructor:r.$oldDestructor,target:r})),a.push({config:e,dispatcher:this})}else r[i]=function(){n.removeListener(e)}}},{key:"detachAutoDetacher",value:function(e){var t=this,n=e.thisObj;n.$oldDestructor&&!n.isDestroying&&($e.remove(n.$autoDetachers,n.$autoDetachers.find((function(n){return n.config===e&&n.dispatcher===t}))),n.$autoDetachers.length||(n["doDestroy"in n?"doDestroy":"destroy"]=n.$oldDestructor,n.$oldDestructor=null))}},{key:"once",value:function(e,t){var n=this;return this.ion(S(S({},e,(function(e){return n.callback(t,n,[e])})),"once",!0))}},{key:"await",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{checkLog:!0,resetLog:!0,args:null,expires:null},n=this;!1===t&&(t={checkLog:!1});var r=t.args;return new Promise((function(i){var a;if(t.checkLog&&null!==(a=n._triggered)&&void 0!==a&&a[e]&&(i(),t.resetLog&&n.clearLog(e)),r)var o=n.on(S(S(S({},e,(function(){for(var a=arguments.length,l=new Array(a),s=0;s<a;s++)l[s]=arguments[s];("function"==typeof r?r.apply(void 0,l):Object.keys(r).every((function(e){return e in l[0]&&l[0][e]===r[e]})))&&(i.apply(void 0,l),t.resetLog&&n.clearLog(e),o())})),"expires",t.expires),"prio",-1e4));else n.on(S(S(S(S({},e,(function(){i.apply(void 0,arguments),t.resetLog&&n.clearLog(e)})),"expires",t.expires),"prio",-1e4),"once",!0))}))}},{key:"clearLog",value:function(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}},{key:"trigger",value:function(e,t){var n,r,i,a,o,l,s,u,c=this,d=e.toLowerCase(),h=c.eventsSuspended,f=c.relayAllTargets,v=c.callOnFunctions,g=null===(n=c.eventListeners)||void 0===n?void 0:n[d];if(c._triggered||(c._triggered={}),c._triggered[e]=!0,h)return h.shouldQueue&&h.queue.push(arguments),!0;null!==(r=c.eventListeners)&&void 0!==r&&r.catchall&&((s=g=g?g.slice():[]).push.apply(s,z(c.eventListeners.catchall)),g.sort(On));if(!g&&!f&&!v)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=c:(t=Object.create(t),Object.assign(t,{source:c}))):t={source:c},t.type!==d&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:function(){return d}}):t.type=d),t.eventName=e,!("bubbles"in t)&&null!==(i=c.bubbleEvents)&&void 0!==i&&i[e]&&(t.bubbles=c.bubbleEvents[e]),v){var m="on"+Le.capitalize(e);if(m in c){var p,y,k=!c[m]||c.callback(c[m],c,[t]);if(pe.isPromise(k)?(l||(l=[])).push(k):y=!1===k||y,!c.isDestroyed&&In.call(c,m)&&(null===(p=c.pluginFunctionChain)||void 0===p||!p[m])){var b=Object.getPrototypeOf(c);if(m in b){var C=b[m].call(c,t);if(pe.isPromise(C)?(l||(l=[])).push(C):y=!1===C||y,c.isDestroyed)return}}if(y)return!1}}if(g){var w=0,D=!1;for(g.$firing=!0;w<g.length&&!c.isDestroyed&&!D;w++){var S=g[w];if(!1!==u||S.$internal){var x=void 0,E=S.thisObj;if(!E||!E.isDestroyed){var R;if(S.called=!0,S.once&&c.removeListener(d,S),"string"==typeof S.fn){if(E&&(x=E[S.fn]),!x){var T=c.resolveCallback(S.fn);x=T.handler,E=T.thisObj}}else x=S.fn;if(S.buffer){if(!S.bufferFn){var M=Number(S.buffer);if("number"!=typeof M||isNaN(M))throw new Error('Incorrect type for buffer, got "'.concat(M,'" (expected a Number)'));S.bufferFn=Tt.createBuffered(x,M,E,S.args)}x=S.bufferFn}if(S.throttle){var F=Number(S.throttle);if("number"!=typeof F||isNaN(F))throw new Error('Incorrect type for throttle, got "'.concat(F,'" (expected a Number)'));S.throttledFn||(S.throttledFn=Tt.createThrottled(x,F,E,S.args)),x=S.throttledFn}var A=(R=x).call.apply(R,[E||c].concat(z(S.args||[]),[t]));!1!==u&&(u=A),S.$internal&&!1===A&&(D=!0),pe.isPromise(A)&&(A.$internal=S.$internal,(l||(l=[])).push(A))}}}if(g.$firing=!1,D)return!1}return null==f||f.forEach((function(n){var r=e;if(n.transformCase&&(r=Le.capitalize(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1})),t.bubbles&&c.owner&&!c.owner.isDestroyed?c.owner.trigger(e,t):null!==(o=l=null===(a=l)||void 0===a?void 0:a.filter((function(e){return!1!==u||e.$internal})))&&void 0!==o&&o.length?new Promise((function(e){Promise.allSettled(l).then((function(t){var n=!t.some((function(e){return"fulfilled"===e.status&&!1===e.value}));e(n)}))})):!1!==u}},{key:"suspendEvents",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}},{key:"resumeEvents",value:function(){var e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue)){var t,n=D(e.queue);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.trigger.apply(this,z(r))}}catch(e){n.e(e)}finally{n.f()}}return!Boolean(this.eventsSuspended)}}],[{key:"declarable",get:function(){return["deprecatedEvents"]}},{key:"setupDeprecatedEvents",value:function(e,t){var n=t.getInherited("deprecatedEvents"),r=e.deprecatedEvents;for(var i in r)n[i.toLowerCase()]=n[i]=r[i]}},{key:"configurable",get:function(){return{listeners:{value:null,$config:{merge:Pn}},internalListeners:{value:null,$config:{merge:Pn}},bubbleEvents:null}}},{key:"setupClass",value:function(e){B(t,"setupClass",this,2)([e]),t.prototype.onListen.$nullFn=!0,t.prototype.onUnlisten.$nullFn=!0}}])}(e||Mn),S(t,"$name","Events"),t},Hn=new a,Bn=function(e){return e.floating},Vn={touchend:1,pointerup:1},Nn={Meta:1,Control:1,Alt:1,Shift:1},zn=function(e){var t;(null===(t=Xn)||void 0===t?void 0:t.pointerId)===e.pointerId&&(Xn=null)},jn=function(e){var t=e.touches;if(Hn.clear(),t)for(var n=0;n<t.length;n++){var r=t.item(n);Hn.set(r.identifier,[r,e])}},Wn=new(function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"suspendFocusEvents",value:function(){Qn=!0}},{key:"resumeFocusEvents",value:function(){Qn=!1}},{key:"setupFocusListenersOnce",value:function(e,t){e&&!Wn.observedElements.has(e)&&(Wn.setupFocusListeners(e,t),Wn.observedElements.add(e))}},{key:"detachFocusListeners",value:function(e){e.$globalEventsDetacher&&(e.$globalEventsDetacher(),e.$globalEventsDetacher=null,Wn.observedElements.delete(e))}},{key:"setupFocusListeners",value:function(){var e,t,n,a,o=arguments.length>0&&arguments[0]!==i?arguments[0]:document,l=arguments.length>1?arguments[1]:i,s={element:o,fromGlobal:!0,touchstart:function(e){var r=e.touches;if(jn(e),2===r.length&&r[0].target.closest(".b-widget")&&r[1].target.closest(".b-widget"))return t=[r[0],r[1]],n=[(t[0].clientX+t[1].clientX)/2,(t[0].clientY+t[1].clientY)/2],void(a=li.elementFromPoint(n[0],n[1]));if(Un||1!==e.changedTouches.length)Un=null;else if(Un=e.changedTouches[0],!ne.isAndroid)var i=function(e){var t=e.clientX,n=e.clientY,r=e.type;(Vn[r]||!Un||Math.max(Math.abs(t-Un.clientX),Math.abs(n-Un.clientY))>5)&&(Gn=null,o(),clearTimeout(s))},o=l.on({element:document,touchmove:i,touchend:i,pointermove:i,pointerup:i,capture:!0}),s=setTimeout((function(){Gn=Un.identifier,o(),e.target.dispatchEvent(new MouseEvent("contextmenu",l.copyEvent({},e)))}),l.longPressTime)},touchmove:{passive:!1,handler:function(e){var r=e.touches;if(2===r.length&&t){var i=[r[0],r[1]],o=l.getDistanceBetween(t[0],t[1])-l.getDistanceBetween(i[0],i[1]),s=Math.abs(t[0].clientX-t[1].clientX)-Math.abs(i[0].clientX-i[1].clientX),u=Math.abs(t[0].clientY-t[1].clientY)-Math.abs(i[0].clientY-i[1].clientY);if(Math.abs(o)>2){var c={clientX:n[0],clientY:n[1],bubbles:!0};if(Wn.Widget.convertPinchToMousewheel){e.preventDefault(),e.stopImmediatePropagation();var d=new MouseEvent("wheel",F(F({},c),{},{ctrlKey:!0}));d.deltaY=u,d.deltaX=s,a.dispatchEvent(d)}var h=new MouseEvent("bryntum-pinch",c);h.deltaY=u,h.deltaX=s,h.touchMove=e,a.dispatchEvent(h)}t=i}}},touchend:{passive:!1,handler:function(e){jn(e),2!==e.touches.length&&(t=null),Un&&(e.changedTouches[0].identifier===Gn?(e.stopImmediatePropagation(),!1!==e.cancelable&&e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===Un.identifier&&Wn.trigger("globaltap",{event:e}),Un=null)}},touchcancel:{passive:!1,handler:jn},mousedown:{handler:function(e){Yn="mouse",Un||Wn.trigger("globaltap",{event:e}),Kn=e;var t=e.ctrlKey||e.altKey||e.shiftKey||e.metaKey;!qn&&t?qn=new KeyboardEvent("keydown",{key:e.ctrlKey?"Control":e.shiftKey?"Shift":e.altKey?"Alt":"Meta",ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey}):qn&&!t&&(qn=null)},passive:!1},mouseup:{handler:function(e){Wn.trigger("mouseup",{event:e}),Kn=null},passive:!1},pointerdown:{passive:!1,handler:function(e){Xn=e,li.setUsingKeyboard(o,!1)}},pointerup:{passive:!1,handler:zn},pointercancel:{passive:!1,handler:zn},keydown:function(e){var t=e.key,n=e.target;if(Yn="key",qn=e,Zn=n,!Nn[t]){if(o.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var r,i=D(o.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.matches(".b-outer")&&li.setUsingKeyboard(a,!0)}}catch(e){i.e(e)}finally{i.f()}}else li.setUsingKeyboard(o,!0);"Escape"===t&&Wn.Widget.queryAll((function(e){return e.isTooltip&&e.isVisible})).forEach((function(e){return e.hide()}))}},mouseenter:function(e){Zn=e.target},keypress:function(){Yn="key"},keyup:function(){qn=null},focusin:function(e){var t=Wn.Widget,n=e.target;if(!(null!=n&&n.shadowRoot||null!=n&&n._shadowRoot)){if(ne.supportsPointerEvents&&null!=n&&n.matches(":focus-visible")&&!bryntum.fromElement(n,(function(e){return e.isDestroying||e.isDestroyed}))){var r=n.matches("[class*=event-wrap],[class*=task-wrap]")?n.firstElementChild:n,i=pt.from(r).center;r.dispatchEvent(new PointerEvent("pointerover",{bubbles:!0,clientX:i.x,clientY:i.y,pointerType:"focus"}))}if(!(Qn||n&&!n.isConnected)){var a=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,o=n||document.body,l=t.fromElement(a),s=t.fromElement(o),u=li.getCommonAncestor(l,s),c=Boolean(a&&4&o.compareDocumentPosition(a)),d=t.query($n),h=null;if(h=o&&o!==document.body?li.getActiveElement(o):li.getActiveElement(document),d&&!d._isRevertingFocus&&(!s||!d.owns(s)&&!(4&d.element.compareDocumentPosition(s.element)&&s.up(Bn))))return d.focus();for(var f,v=er("focusout",a,n,l,s,c),g=l;g&&g!==u;g=f)if(f=g.owner,!g.isDestroying&&g.onFocusOut&&(g.onFocusOut(v),n&&h!==li.getActiveElement(n)))return;if(u&&n===u.element)!u.isDestroying&&li.getActiveElement(u)===o&&u.focusElement&&u.focusElement!==u.element&&(u.element.contains(h)&&!u.focusDescendant||u.setTimeout((function(){var e;return null===(e=u.focus)||void 0===e?void 0:e.call(u)}),0));else{v=er("focusin",o,a,l,s,c);for(var m=s;m&&m!==u;m=m.owner){var p,y;if(!m.isDestroying)null===(p=(y=m).onFocusIn)||void 0===p||p.call(y,v)}}var k=li.getCommonAncestor((null==a?void 0:a.nodeType)===Element.ELEMENT_NODE?a:null,o)||o.parentNode;k&&(v=er("focusmove",o,a,l,s,c,{bubbles:!0}),k.dispatchEvent(v))}}},focusout:function(e){if(!(Qn||e.relatedTarget&&Wn.Widget.fromElement(e.relatedTarget))){var t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;s.focusin({target:t,relatedTarget:e.target}),qn=Kn=null}},blur:{element:r,handler:function(e){e.target===r&&(qn=null,Kn=null)}},capture:!0,passive:!0};arguments.length>2&&arguments[2]!==i&&arguments[2]&&(null===(e=Jn)||void 0===e||e()),Jn=this.detachEvents=o.$globalEventsDetacher=l.on(s)}},{key:"activeTouches",get:function(){return Array.from(Hn.values())}},{key:"hasActiveTouches",get:function(){return Hn.size>0}},{key:"lastInteractionType",get:function(){return Yn}},{key:"shiftKeyDown",get:function(){var e;return Boolean(null===(e=qn)||void 0===e?void 0:e.shiftKey)}},{key:"ctrlKeyDown",get:function(){var e,t;return Boolean((null===(e=qn)||void 0===e?void 0:e.ctrlKey)||(null===(t=qn)||void 0===t?void 0:t.metaKey))}},{key:"altKeyDown",get:function(){var e;return Boolean(null===(e=qn)||void 0===e?void 0:e.altKey)}},{key:"currentOverElement",get:function(){return Zn}},{key:"isKeyDown",value:function(e){var t;return e?(null===(t=qn)||void 0===t?void 0:t.key)===e||!0===qn[(null==e?void 0:e.toLowerCase())+"Key"]:Boolean(qn)}},{key:"isMouseDown",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:0;return(null===(e=Kn)||void 0===e?void 0:e.button)===t}},{key:"currentMouseDown",get:function(){return Kn},set:function(e){Kn=e}},{key:"currentPointerDown",get:function(){return Xn},set:function(e){Xn=e}},{key:"currentTouch",get:function(){return Un},set:function(e){Un=e}},{key:"currentKeyDown",get:function(){return qn},set:function(e){qn=e}}])}(Mn.mixin(_n))),$n=function(e){return e.isTopModal};Wn.observedElements=new o;var Un,Gn,Yn,qn,Kn,Xn,Zn,Jn,Qn=!1;function er(e,t,n,r,i,a,o){var l=new CustomEvent(e,o);return Object.defineProperty(l,"_target",{get:function(){return t}}),Object.defineProperty(l,"relatedTarget",{get:function(){return n}}),l.fromWidget=r,l.toWidget=i,l.backwards=a,l}var tr=["clientX","clientY","pageX","pageY","screenX","screenY"],nr={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1,raw:1,fromGlobal:1},rr={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},ir={Control:"ctrl",Alt:"alt",Shift:"shift",Meta:"meta"},ar=/^(ctrl|shift|alt|meta)$/,or=["altKey","bubbles","button","buttons","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"],lr=Object.fromEntries("abcdefghijklmnopqrstuvwxyz".split("").map((function(e){return[e,e.toUpperCase()]}))),sr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){for(var n=0,r=e.length;n<r;++n)e.push(n?"".concat(e[n],"+").concat(t):t);return e}),[""])}("Ctrl","Alt","Meta","Shift"),ur=function(e){return sr[(e.ctrlKey&&1)|(e.altKey&&2)|(e.metaKey&&4)|(e.shiftKey&&8)]},cr=ne.isSafari,dr=new WeakMap,hr=function(e){return(null==e?void 0:e.nodeType)===Element.TEXT_NODE?e.parentElement:e},fr=function(){function e(){m(this,e)}return w(e,null,[{key:"normalizeEvent",value:function(e){return Be.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],tr)}},{key:"copyEvent",value:function(e,t){return Be.copyProperties(e,t,or)}},{key:"getXY",value:function(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}},{key:"getDistanceBetween",value:function(e,t,n){var r=vr.getXY(e),i=vr.getXY(t),a=r[0]-i[0],o=r[1]-i[1];return null!=n&&n.x?a:null!=n&&n.y?o:Math.sqrt(Math.pow(a,2)+Math.pow(o,2))}},{key:"getPagePoint",value:function(e){return new yt(e.pageX,e.pageY)}},{key:"getClientPoint",value:function(e){return new yt(e.clientX,e.clientY)}},{key:"addListener",value:function(e,t,n,r){return r=e.nodeType?"string"==typeof t?Object.assign(S({element:e},t,n),r):Object.assign({element:e},t):e,vr.on(r)}},{key:"on",value:function(e){var t=e.element,n=e.thisObj,r=[];for(var i in e)if(!nr[i]){var a=e[i];"object"!==W(a)&&(a={handler:a});var o=a.element||t;r.push(vr.addElementListener(o,i,a,e))}var l=function(){for(var e,t=0;t<r.length;t++)e=r[t],vr.removeEventListener(e[0],e[1],e[2]);r.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=Tt.createInterceptor(n.doDestroy,l,n)),l}},{key:"addElementListener",value:function(e,t,n,a){var o=vr.createHandler(e,t,n,a),l=o.spec,s=n.expires||a.expires,u=null!=l.capture||null!=l.passive?{capture:l.capture,passive:l.passive}:i;if(e.addEventListener(t,o,u),s){var c=n.thisObj||a.thisObj,d=null!=c&&c.isDelayable?c:r,h=s.alt,f=h?s.delay:s,v=o.spec;v.expires=s,v.timerId=d["number"==typeof f?"setTimeout":"requestAnimationFrame"]((function(){v.timerId=null,vr.removeEventListener(e,t,o),h&&!o.called&&("string"==typeof h?c[h]:h).call(c)}),f,"listener-timer-".concat(performance.now()))}return[e,t,o,u]}},{key:"getComposedPathTarget",value:function(e){var t;return e.composedPath()[0]||(null===(t=e.path)||void 0===t?void 0:t[0])}},{key:"fixEvent",value:function(e,t){var n;if(e.isBryntumEvent)return e;if(dr.has(e))return dr.get(e);var r=e.ctrlKey,a=e.metaKey,o=e.type,l=e.target,s=this.getComposedPathTarget(e),u="open"===(null==s||null===(n=s.getRootNode)||void 0===n||null===(n=n.call(s))||void 0===n?void 0:n.mode),c={set:function(e,t,n){var r;return t in e&&null!==(r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),"type"))&&void 0!==r&&r.set?Reflect.set(e,t,n):(c[t]=n,!0)},get:function(e,t){if(Be.hasOwn(c,t))return c[t];switch(t){case"fixed":case"isBryntumEvent":return!0;case"key":return rr[e.key]||e.key;case"code":return" "!==e.key||e.code?e.code:"Space";case"ctrlKey":return ne.isMac&&a!==r?a:r;case"metaKey":return ne.isMac&&a!==r?r:a;case"virtualKey":return function(e){var t=[ur(e)],n=e.code,r=e.key;return t[t[0]?1:0]=null!=n&&n.includes("Numpad")?n:lr[r]||r,t.join("+")}(d);case"virtualModKeys":return ur(d);case"borderOffsetX":return isNaN(e.offsetX)?i:e.offsetX+(cr?0:parseInt(l.ownerDocument.defaultView.getComputedStyle(hr(l)).getPropertyValue("border-left-width")));case"borderOffsetY":return isNaN(e.offsetY)?i:e.offsetY+(cr?0:parseInt(l.ownerDocument.defaultView.getComputedStyle(hr(l)).getPropertyValue("border-top-width")));case"target":return u?s:hr(e.target);case"relatedTarget":return hr(e.relatedTarget);case"originalTarget":return l;case"deepTarget":return s;case"currentTarget":return c.delegatedTarget||e.currentTarget;case"browserEvent":return e;default:if(t in c)return c[t];var n=Reflect.get(e,t);return"function"==typeof n?n.bind(e):n}},has:function(e,t){return t in e||t in c}},d=new Proxy(e,c);if(dr.set(e,d),o.startsWith("touch")&&this.normalizeEvent(d),!t)switch(o){case"keydown":Wn.currentKeyDown=d;break;case"mousedown":Wn.currentMouseDown=d;break;case"pointerdown":Wn.currentPointerDown=d;break;case"touchstart":Wn.currentTouch=d}return d}},{key:"createHandler",value:function(e,t,n,i){var a=n.delay||i.delay,o=n.throttled||i.throttled,l=n.block||i.block,s="once"in n?n.once:i.once,u="capture"in n?n.capture:i.capture,c="passive"in n?n.passive:i.passive,d="delegate"in n?n.delegate:i.delegate,h="fromGlobal"in n?n.fromGlobal:i.fromGlobal,f=n.handler,v=n.expires,g=n.thisObj||i.thisObj,m=function(e){var t;if(!(vr.playingDemo&&e.isTrusted||null!=g&&g.isDestroyed)){m.called=!0;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t="string"==typeof f?g[f]:f).call.apply(t,[g,vr.fixEvent(e,h)].concat(r))}};if(l){var p,y,k=m;m=function(e){var t=performance.now();if(!p||e.target!==y||t-p>l){y=e.target,p=t;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];k.apply(void 0,[e].concat(r))}}}if(null!=a){var b=m,C=null!=g&&g.setTimeout?g:r;m=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];C.setTimeout((function(){b.apply(void 0,t)}),a)}}if(null!=o){var w,D=o;o.buffer&&(w=function(e){return o.alt.call(vr,vr.fixEvent(e,h))},D=o.buffer),m=null!=g&&g.isDelayable?g.throttle(m,{delay:D,throttled:w}):Tt.createThrottled(m,D,g,null,w)}if(s){var S=m;m=function(){vr.removeEventListener(e,t,m),S.apply(void 0,arguments)}}if(d){var x=m;m=function(e){var t,n,r=null===(t=(n=(e=vr.fixEvent(e,h)).target).closest)||void 0===t?void 0:t.call(n,d);if(r){e.delegatedTarget=r;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];x.apply(void 0,[e].concat(a))}}}return n.thisObj&&!1!==n.autoDetach&&(g.doDestroy=Tt.createInterceptor(g.doDestroy,(function(){return vr.removeEventListener(e,t,m)}),g)),m.spec={delay:a,throttled:o,block:l,once:s,thisObj:g,capture:u,expires:v,passive:c,delegate:d},m}},{key:"removeEventListener",value:function(e,t,n){var i=n.spec,a=i.expires,o=i.timerId,l=i.thisObj,s=i.capture;null!=a&&a.alt&&o&&(null!=l&&l.isDelayable?l:r)["number"==typeof a.delay?"clearTimeout":"cancelAnimationFrame"](o);e.removeEventListener(t,n,s)}},{key:"onTransitionEnd",value:function(e){var t,n,i=e.element,a=e.animationName,o=e.property,l=e.handler,s=e.mode,u=void 0===s?a?"animation":"transition":s,c=e.duration,d=void 0===c?li["get".concat("transition"===u?"Property":"").concat(Le.capitalize(u),"Duration")](i,o):c,h=e.timeout,f=e.thisObj,v=void 0===f?r:f,g=e.args,m=void 0===g?[]:g,p=e.timerSource,y=e.runOnDestroy,k=(p=p||(v.isDelayable?v:r)).isDelayable,b=performance.now(),C="transitionTimer".concat(b),w="timeoutTimer".concat(b),D=[i,o].concat(z(m)),x=function(){var e;(E(),v.isDestroyed)||(null!==(e=v.$meta)&&void 0!==e&&e.class.isBase?v.callback(l,v,D):l.apply(v,D))},E=vr.on(S({element:i},"".concat(u,"end"),(function(e){var r=e.animationName,l=e.propertyName;if(e.target===i&&(l===o||null!=r&&r.match(a))){if(t){var s,u,c,d;if(n)null===(c=(d=p).clearTimeout)||void 0===c||c.call(d,k?w:n);null===(s=(u=p).clearTimeout)||void 0===s||s.call(u,k?C:t),t=null}x()}})));return h&&(n=p.setTimeout(x,Math.max(h,(d||0)+100),w)),null!=d&&(t=p.setTimeout(x,d+50,C,y)),E}},{key:"waitForTransitionEnd",value:(t=f(L().mark((function t(n){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.handler=t,e.onTransitionEnd(n)})));case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})},{key:"createDblClickWrapper",value:function(e,t,n){var r,i,a;return function(){i||(i=vr.on({element:e,touchstart:function(e){r=e.changedTouches[0].identifier,e.preventDefault()},touchend:function(e){if(e.changedTouches[0].identifier===r){e.preventDefault(),clearTimeout(a),r=i=null;var o=pt.from(e.changedTouches[0].target,null,!0),l=e.changedTouches[0].pageX-o.x,s=e.changedTouches[0].pageY-o.y,u=Object.assign({browserEvent:e},e),c=new MouseEvent("dblclick",u);Object.defineProperties(c,{target:{value:e.target},offsetX:{value:l},offsetY:{value:s}}),"string"==typeof t&&(t=n[t]),t.call(n,c)}},once:!0}),a=setTimeout((function(){i(),r=i=null}),vr.dblClickTime))}}},{key:"toSpecialKey",value:function(e){var t=!1;return!0===e?t=arguments.length>1&&arguments[1]!==i?arguments[1]:"ctrlKey":"string"==typeof e&&(e=e.toLowerCase()).match(ar)&&(t="".concat(e,"Key")),t}},{key:"specialKeyFromEventKey",value:function(e){return ir[e]||"no-special-key"}}]);var t}();S(fr,"$name","EventHelper"),S(fr,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseenter:"MouseEnter",mouseleave:"MouseLeave",mousemove:"MouseMove",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"}),te.register(fr);var vr=fr;vr.longPressTime=700,vr.dblClickTime=300,ne.isTouchDevice&&vr.on({element:document,touchmove:function(e){e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),fr._$name="EventHelper";var gr={align:"t0-t0"},mr=Node.ELEMENT_NODE,pr=Node.TEXT_NODE,yr={text:1,password:1,date:1,search:1,email:1,number:1,time:1,"datetime-local":1,tel:1,url:1,month:1,week:1},kr=Be.isObject,br=/[+-]?\d*\.?\d+[eE]?-?\d*/g,Cr=br.source,wr=new RegExp("matrix\\((?:".concat(Cr,"),\\s?(?:").concat(Cr,"),\\s?(?:").concat(Cr,"),\\s?(?:").concat(Cr,"),\\s?(").concat(Cr,"),\\s?(").concat(Cr,")")),Dr=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),Sr=new RegExp("(?:".concat(wr.source,")|(?:").concat(Dr.source,")")),xr=new RegExp("translate(3d|X)?\\((".concat(Cr,")px(?:,\\s?(").concat(Cr,")px)?")),Er=new RegExp("translate(3d|Y)?\\((".concat(Cr,")px(?:,\\s?(").concat(Cr,")px)?")),Rr=/\s+/,Tr=/\s*;\s*/,Mr=/\s*:\s*/,Fr=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,Ar={},Ir={elementData:"",for:"htmlFor",retainElement:""},Lr={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},Or=[["f","focusable"],["n","natural"],["p","programmatic"],["t","tabbable"]],Pr={length:1,parentRule:1,style:1},_r={INPUT:1,TEXTAREA:1},Hr={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},Br=r,Vr=document,Nr=Object.freeze({}),zr=Array.prototype.slice,jr=Promise.resolve(),Wr=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],$r=function(e){return e._hidden},Ur=function(e,t,n){return"children"===n.key?Be.mergeItems(e,t,n):Be.blend(e,t,n)},Gr=function(e,t){if(e.isConnected){var n=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==n.getPropertyValue("display")&&(t||"hidden"!==n.getPropertyValue("visibility"))}},Yr=function(e){return e&&e.isConnected&&(e===Vr.body||Boolean(e.offsetParent)||(e.ownerDocument.defaultView&&"offsetParent"in e&&"fixed"!==li.getStyleValue(e,"position")?e.offsetParent:Yr(e.parentNode)))},qr=function(e){return e instanceof Node?e:"string"==typeof e?ui.createElementFromTemplate(e):ui.createElement(e)},Kr=Object.create(null),Xr=function(e,t){var n=Kr[e]||[Le.hyphenate(e),t];return Kr[e]||(Kr[n[0]]=Kr[e]=n),n},Zr=/b-slide-in-from-\w+/,Jr=function(e,t){if(e){var n=(e.ownerSVGElement||e)[t&&"static"!==li.getStyleValue(e,"position")?"offsetParent":"parentNode"]||Jr(e.target,t);return(null==n?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?n.host:n}},Qr=function(e){return(null==e?void 0:e.nodeType)===Node.ELEMENT_NODE},ei=function(){var e;return(null===(e=(arguments.length>0&&arguments[0]!==i?arguments[0]:Vr).getAnimations())||void 0===e?void 0:e.reduce((function(e,t){var n=t.effect;return"running"===t.playState&&n.getTiming().iterations!==1/0&&e.push(n.target),e}),[]))||[]};["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","insetBlockEnd","insetBlockStart","insetInlineEnd","insetInlineStart","marginTop","marginRight","marginBottom","marginLeft","marginInlineStart","marginInlineEnd","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing","insetInlineStart","insetBlockStart","insetInlineEnd","insetBlockEnd"].forEach((function(e){return Xr(e,!0)}));var ti,ni,ri,ii=null,ai=0,oi=null,li=function(){function e(){m(this,e)}return w(e,null,[{key:"devicePixelRatio",get:function(){var e,t=r.devicePixelRatio;if(null==t)for(var n=500;n>=50;n-=5)if(r.matchMedia((e=n/100,"(-webkit-min-device-pixel-ratio: ".concat(e,"),\n                (min--moz-device-pixel-ratio: ").concat(e,"),\n                (min-resolution: ").concat(e,"dppx)"))).matches){t=n/100;break}return t}},{key:"usingKeyboard",get:function(){return ui._usingKeyboard},set:function(e){return ui._usingKeyboard=e}},{key:"setUsingKeyboard",value:function(e,t){ui.setFocusRendition(e,t),ui._usingKeyboard=t}},{key:"setFocusRendition",value:function(e,t){var n;ui.enableKeyboardCssModifiers&&(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t?Array.from(e.children).forEach((function(e){var t;return(null===(t=e.matches)||void 0===t?void 0:t.call(e,".b-outer"))&&e.classList.add("b-using-keyboard")})):ui.removeClsGlobally(e,"b-using-keyboard"):null===(n=e.classList)||void 0===n||n.toggle("b-using-keyboard",t))}},{key:"findParent",value:function(e,t,n){return this.closest(null==e?void 0:e.parentNode,t,n)}},{key:"closest",value:function(e,t,n){if(e&&e!==n)return t(e)?e:this.closest(e.parentNode,t,n)}},{key:"slideIn",value:(l=f((function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1;return L().mark((function n(){var r,i,a;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r="b-slide-in-".concat(t>0?"next":"previous"),i=e.classList,(a=e.parentNode.classList).add("b-sliding-child-element"),i.add(r),n.next=5,fr.waitForTransitionEnd({element:e,animationName:Zr});case 5:i.remove(r),a.remove("b-sliding-child-element");case 7:case"end":return n.stop()}}),n)}))()})),function(e){return l.apply(this,arguments)})},{key:"getFocusability",value:function(e){var t,n="";if(e&&!e.hasAttribute("inert")){var r=e.nodeName,i=e.getAttribute("tabIndex");n=Hr[r]||("A"===r||"LINK"===r)&&e.href||"true"===e.contentEditable?"n":"","-1"===i?n+="fp":(n||null!=i)&&(n+="ft")}return Ar[n]||(Ar[n]=(t=n,Object.freeze(Object.fromEntries(Or.map((function(e){var n=_(e,2),r=n[0];return[n[1],t.includes(r)]}))))))}},{key:"isFocusable",value:function(e,t){return!(e&&!t&&(!ui.isVisible(e)||ui.Widget.fromElement(e,$r)))&&ui.getFocusability(e).focusable}},{key:"isEditable",value:function(e,t){return Boolean((e.isContentEditable||_r[e.nodeName])&&(!t||"INPUT"!==e.nodeName||yr[e.type.toLowerCase()])&&!(e.readOnly||e.disabled||e.closest("[inert]")))}},{key:"isTextualInput",value:function(e){return _r[e.nodeName]&&("INPUT"!==e.nodeName||yr[e.type.toLowerCase()])}},{key:"isInView",value:function(t){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],a=arguments.length>2?arguments[2]:i;if(!t||!Yr(Qr(t.target)?t.target:t))return!1;var o=(null==a?void 0:a.positioned)&&"fixed"!==e.getStyleValue(a.element,"position"),l=pt.from(r),s=n?"contains":"intersect",u=o&&a.element.offsetParent,c=o&&pt.from(u);if(l.height=Vr.scrollingElement.scrollHeight,t===Vr.body)return l;var d=this.getViewportIntersection(t,l,s);return d&&o&&d.translate(Vr.scrollingElement.scrollLeft,Vr.scrollingElement.scrollTop),o&&d?d.translate(-c.x+u.scrollLeft,-c.y+u.scrollTop):d}},{key:"getViewportIntersection",value:function(t,n,r){var i,a=Qr(t.target)?t.target:null,o=a||t,l=e.getVisibleViewport(Jr(o,1),n,o),s=pt.from(o,null,!0);return a&&(s.translate(t.offsetX+1,t.offsetY+1),s.height=s.width=0),null==l||null===(i=l[r])||void 0===i?void 0:i.call(l,s,!1,!0)}},{key:"getVisibleViewport",value:function(e,t,n){var r,i,a,o,l,s=Vr.fullscreenElement,u=t;for(l=e;!i&&l&&l!==Vr.body;l=Jr(l,1))if((r=i=l===s)||(r=("visible"!==(o=l.ownerDocument.defaultView.getComputedStyle(l)).overflowX||"visible"!==o.overflowY)&&"contents"!==o.display),r){var c,d=pt.client(l,null,!0,!1,n,!1);if(!d.height||!d.width)return!1;u=(null===(c=u)||void 0===c?void 0:c.intersect(d))||d,a=l}return a&&(u=pt.clipStickies(u,a,null,!0,n)),u}},{key:"isVisible",value:function(e){for(var t=!1;e;e=Jr(e)){if(e.nodeType===Element.DOCUMENT_NODE)return!0;if(e.nodeType===Element.ELEMENT_NODE){var n,r=null===(n=e.ownerDocument)||void 0===n?void 0:n.defaultView.getComputedStyle(e);if(t=t||"visible"===r.getPropertyValue("visibility"),Qr(e)&&!Gr(e,t))return!1}}return!1}},{key:"isDOMEvent",value:function(e){return e instanceof Event}},{key:"merge",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Be.blend(e,n,{merge:Ur})}},{key:"normalizeChildren",value:function(e,t,n){var r,i,a,o,l,s,u=null==e?void 0:e.children;if(null!=e&&null!==(r=e.syncOptions)&&void 0!==r&&r.ignoreRefs&&(n=!0),u&&!(e instanceof Node))if(Array.isArray(u))for(a=0;a<u.length;++a)ui.normalizeChildren(u[a],t,n);else for(o in l=u,e.children=u=[],l){var c;null!==(c=i=l[o])&&void 0!==c&&c.isWidget&&(i=i.element),(s=!o.startsWith("$")&&!ui.isElement(i))&&(null==t||t(o,!n)),i&&(i instanceof Node||(!1===i.reference?delete i.reference:s&&"string"!=typeof i&&(i.reference=o),ui.normalizeChildren(i,t,n)),u.push(i))}return e}},{key:"roundPx",value:function(e){var t=1/(arguments.length>1&&arguments[1]!==i?arguments[1]:r.devicePixelRatio||1);return Math.round(e/t)*t}},{key:"floorPx",value:function(e){var t=1/(arguments.length>1&&arguments[1]!==i?arguments[1]:r.devicePixelRatio||1);return Math.floor(e*t)/t}},{key:"isCustomElement",value:function(e){return Boolean(null==e?void 0:e.shadowRoot)}},{key:"elementFromPoint",value:function(e,t){var n=document.elementFromPoint(e,t);return ui.isCustomElement(n)&&(n=n.shadowRoot.elementFromPoint(e,t)||n),n}},{key:"childFromPoint",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:e,a=null==n?t:new pt(t,n,0,0),o=null;return Array.from(e.children).reverse().some((function(e){if(pt.from(e,r).contains(a))return o=e.children.length&&ui.childFromPoint(e,a,null,r)||e,!0})),o}},{key:"unitize",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:"px",r=_(Xr(e),2),a=r[0],o=r[1];return null!=t&&(t=String(t),t=o&&Fr.test(t)?t+n:t),[a,t]}},{key:"activeElement",get:function(){for(var e=document.activeElement;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}},{key:"getActiveElement",value:function(e){var t,n;null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element);for(var r=((null===(n=e)||void 0===n?void 0:n.getRootNode())||document).activeElement;null!==(i=r)&&void 0!==i&&i.shadowRoot;){var i;r=r.shadowRoot.activeElement}return r}},{key:"getRootElement",value:function(e){var t,n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e),r=n.nodeType;return r===Node.DOCUMENT_NODE?n.body:r===Node.DOCUMENT_FRAGMENT_NODE?n:e.ownerDocument.contains(e)?e.ownerDocument.body:null}},{key:"getOutermostElement",value:function(e){var t,n,r=null===(t=(n=e).getRootNode)||void 0===t?void 0:t.call(n);if(null!=r&&r.body)return null==r?void 0:r.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}},{key:"isValidFloatRootParent",value:function(e){var t;return"BODY"===(null===(t=e.tagName)||void 0===t?void 0:t.toUpperCase())||e.getRootNode().nodeType===Node.DOCUMENT_FRAGMENT_NODE}},{key:"getId",value:function(e){return e.id||(e.id="b-element-"+ ++ai)}},{key:"getCommonAncestor",value:function(e,t){if(e===t)return e;for(;e&&!(null!==(n=(r=e)[e.isWidget?"owns":"contains"])&&void 0!==n&&n.call(r,t)||e===t);){var n,r,i;e=Qr(e)?Jr(e):null!==(i=e.owner)&&void 0!==i&&i.isWidget&&e.owner!==e?e.owner:null}return e}},{key:"waitForSelector",value:function(t){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:5e3,r=arguments.length>2&&arguments[2]!==i?arguments[2]:100;if(null!=t){var a,o=null===(a=t.endsWith)||void 0===a?void 0:a.call(t,"?"),l=t.nodeType?t:document.querySelector(o?t.substring(0,t.length-1):t);if(o){if(!l)return;n>0&&(n=-n)}return l&&e.isVisible(l)&&!ei().some((function(e){return e.contains(l)}))&&e.isInView(l,!1)?l:Ge.waitFor((function(){var n=l||document.querySelector(t);if(n&&e.isVisible(n)&&!ei().some((function(e){return e.contains(n)}))&&e.isInView(n,!1))return n}),n,r)}}},{key:"getElement",value:function(e){return"string"==typeof e?Vr.querySelector(e):e}},{key:"setAttributes",value:function(e,t){var n=ui.getElement(e);if(n&&t)for(var r in t)null==t[r]?n.removeAttribute(r):n.setAttribute(r,t[r])}},{key:"toggleAttribute",value:function(e,t,n){var r=ui.getElement(e);r&&(r.toggleAttribute?r.toggleAttribute(t,n):null!=n?r[n?"setAttribute":"removeAttribute"](t,""):r.hasAttribute(t)?r.removeAttribute(t):r.setAttribute(t,""))}},{key:"addAttributeValue",value:function(e,t,n){var r,i=ui.getElement(e);i&&n&&i.setAttribute(t,z(new o(null===(r=i.getAttribute(t))||void 0===r?void 0:r.split(" ")).add(n)).join(" "))}},{key:"removeAttributeValue",value:function(e,t,n){var r=ui.getElement(e);if(r&&n){var i,a=new o(null===(i=r.getAttribute(t))||void 0===i?void 0:i.split(" "));a.delete(n),a.size?r.setAttribute(t,z(a).join(" ")):r.removeAttribute(t)}}},{key:"setLength",value:function(e,t,n){return n=1===arguments.length?"number"==typeof e?"".concat(e,"px"):null!=e?e:"":(e=ui.getElement(e)).style[t]="number"==typeof n?"".concat(n,"px"):null!=n?n:""}},{key:"percentify",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:2,n=Math.pow(10,t);return null==e||""===e||isNaN(e)?"":"".concat(Math.round(e*n)/n,"%")}},{key:"getChild",value:function(e,t){return e.querySelector(":scope>"+t)}},{key:"hasChild",value:function(e,t){return null!=ui.getChild(e,t)}},{key:"children",value:function(e,t){return(">"===t[0]||t.startsWith("# "))&&("#"===t[0]&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}},{key:"getChildElementCount",value:function(e){return e.childElementCount}},{key:"down",value:function(e,t){var n;return e?null!==(n=e.matches)&&void 0!==n&&n.call(e,t)?e:(t=":scope "+t,e.querySelector(t)):null}},{key:"isDescendant",value:function(e,t){var n=e.contains(t);if(!n&&t){var r=ui.getRootElement(e),i=ui.getRootElement(t);if(i&&r!==i&&i.host)return ui.isDescendant(r,i.host)}return n}},{key:"getEventElement",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"target";return!e||ui.isElement(e)?e:e[t]}},{key:"isElement",value:function(e){return(null==e?void 0:e.nodeType)===document.ELEMENT_NODE&&ui.isNode(e)}},{key:"isReactElement",value:function(e){var t;return Boolean(null===(t=r.bryntum)||void 0===t||null===(t=t.react)||void 0===t?void 0:t.isReactElement(e))}},{key:"handleReactElement",value:function(e,t){var n;return Boolean(null===(n=r.bryntum)||void 0===n||null===(n=n.react)||void 0===n?void 0:n.handleReactElement(e,t))}},{key:"handleReactHeaderElement",value:function(e,t,n){var i;return Boolean(null===(i=r.bryntum)||void 0===i||null===(i=i.react)||void 0===i?void 0:i.handleReactHeaderElement(e,t,n))}},{key:"isVueConfig",value:function(e){var t;return Boolean(null===(t=r.bryntum)||void 0===t||null===(t=t.vue)||void 0===t?void 0:t.isVueConfig(e))}},{key:"handleVueContent",value:function(e,t){var n;null===(n=r.bryntum)||void 0===n||null===(n=n.vue)||void 0===n||n.handleVueContent(e,t)}},{key:"isNode",value:function(e){return Boolean(e)&&"number"==typeof e.nodeType&&!kr(e)}},{key:"forEachSelector",value:function(e,t,n){if("string"==typeof e)throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");ui.children(e,t).forEach(n)}},{key:"forEachChild",value:function(e,t){Array.from(e.children).forEach(t)}},{key:"removeEachSelector",value:function(e,t){ui.forEachSelector(e,t,(function(e){return e.remove()}))}},{key:"removeClsGlobally",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){return ui.forEachSelector(e,"."+t,(function(e){return e.classList.remove(t)}))}))}},{key:"getAncestor",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:null,a=!1,o=e;for(t=$e.asArray(t);o=o.parentElement;){if(t.includes(o)){a=!0;break}if(r&&o===r)break;n=o}return a?n||e:null}},{key:"getParents",value:function(e){for(var t=[];e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}},{key:"makeValidId",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"";return Le.makeValidDomId(e,t)}},{key:"createElement",value:function(){var t,n,r,a,o,l,s,u,c,d,h,f,v,g,m=this,p=arguments.length>0&&arguments[0]!==i?arguments[0]:{},y=arguments.length>1?arguments[1]:i,k=y;if("boolean"==typeof k)throw new Error("Clean up");y&&(u=y.ignoreRefs,f=y.refOwner,v=y.refs,k=y.returnAll,g=y.syncIdField,u&&(l=!0,u="children"!==u)),"string"==typeof p.parent&&(p.parent=document.getElementById(p.parent));var b=p.parent||p.nextSibling&&p.nextSibling.parentNode,C=p.dataset,w=p.html,D=p.reference,S=p.syncOptions,x=p.text;if(S&&(g=S.syncIdField||g,(s=S.ignoreRefs)&&(l=!0,u="children"!==s,y=F(F({},y),{},{ignoreRefs:!0}))),u&&(f=null),a=p.ns?Vr.createElementNS(p.ns,p.tag||"svg"):Vr.createElement(p.tag||"div"),null!=x?ui.setInnerText(a,x):null!=w&&(w instanceof DocumentFragment?a.appendChild(w):a.innerHTML=w),p.tooltip&&ui.Widget.attachTooltip(a,p.tooltip),p.style&&ui.applyStyle(a,p.style),C)for(d in C)null!=(h=C[d])&&(a.dataset[d]=h);b&&this.addChild(b,a,p.nextSibling),f&&(a.$refOwnerId=f.id),D&&!u&&(f?(a.$reference=D,f.attachRef(D,a,p)):(v||((y=Object.assign({},y)).refs=v={}),v[D]=a,a.setAttribute("data-reference",D)));var E=p.className||p.class,R=Object.keys(p);for(E&&a.setAttribute("class",Ct.normalize(E)),o=0;o<R.length;++o)d=R[o],h=p[d],null!=(c=Ir[d])?a[c||d]=h:!Lr[d]&&d&&null!=h&&a.setAttribute(d,h);p["aria-hidden"]||"role"in p||p.tabIndex||p.alt||e.isFocusable(a,!0)||a.htmlFor||a.setAttribute("role","presentation"),null===(t=y)||void 0===t||null===(n=t.callback)||void 0===n||n.call(t,{action:"newElement",domConfig:p,targetElement:a,syncId:f?D:y.syncIdField&&(null===(r=p.dataset)||void 0===r?void 0:r[y.syncIdField])}),!0===k?y.returnAll=k=[a]:Array.isArray(k)&&k.push(a),p.children&&(g&&(a.syncIdMap={}),$e.asArray(p.children).forEach((function(e){if(e)if("string"==typeof e){var t=document.createTextNode(e);f&&(t.$refOwnerId=f.id),a.appendChild(t)}else if(m.isReactElement(e)){var n,r;null===(n=y)||void 0===n||null===(r=n.reactCallback)||void 0===r||r.call(n,{jsx:e,domConfig:p,targetElement:a})}else if(isNaN(e.nodeType)){var i,o,s;e.parent=a,!e.ns&&p.ns&&(e.ns=p.ns);var u=ui.createElement(e,F(F({},y),{},{ignoreRefs:null!==(i=null===(o=p.syncOptions)||void 0===o?void 0:o.ignoreRef)&&void 0!==i?i:l})),c=null===(s=e.dataset)||void 0===s?void 0:s[g];null!=c&&(a.syncIdMap[c]=u),delete e.parent}else a.appendChild(e)}))),a.lastDomConfig=p;var T=v||k||a;return p.replaceElement&&p.replaceElement.replaceWith(T),T}},{key:"createElementFromTemplate",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:Nr,r=n.array,a=n.raw,o=n.fragment;if(ui.supportsTemplate){if((ti||(ti=Vr.createElement("template"))).innerHTML=e,t=ti.content,o)return t.cloneNode(!0)}else if(t=(ni||(ni=new DOMParser)).parseFromString(e,"text/html").body,o){var l=t.childNodes;for(t=document.createDocumentFragment();l.length;)t.appendChild(l[0]);return t}return 1!==(t=a?t.childNodes:t.children).length||r?zr.call(t):t[0]}},{key:"triggerMouseEvent",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"contextmenu",n=arguments.length>2&&arguments[2]!==i?arguments[2]:{},r=this.isInView(e),a=null==r?void 0:r.center;if(r){var o=new MouseEvent(t,F({clientX:a.x,clientY:a.y,offsetX:r.width/2,offsetY:r.height/2,bubbles:!0},n));return e.dispatchEvent(o),o}}},{key:"insertFirst",value:function(e,t){return t&&t.nodeType!==mr&&t.tag&&(t=ui.createElement(t)),e.insertBefore(t,e.firstElementChild)}},{key:"insertBefore",value:function(e,t,n){return t&&t.nodeType!==mr&&t.tag&&(t=ui.createElement(t)),n?e.insertBefore(t,n):ui.insertFirst(e,t)}},{key:"insertAt",value:function(e,t,n){var r=Array.from(e.children);if(n>=r.length)return ui.append(e,t);var i=r[n];return ui.insertBefore(e,t,i)}},{key:"append",value:function(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((function(e){return qr(e)}))),e.append)e.append.apply(e,z(t));else{var n=document.createDocumentFragment();t.forEach((function(e){n.appendChild(e)})),e.appendChild(n)}return t}return e.appendChild(qr(t))}},{key:"getTranslateX",value:function(e){var t=e.style.transform,n=xr.exec(t);return n?parseFloat(n[2]):(n=Sr.exec(t)||Sr.exec(ui.getStyleValue(e,"transform")))?parseFloat(n[1]||n[3]):0}},{key:"getTranslateY",value:function(e){var t=e.style.transform,n=Er.exec(t);if(n){var r=parseFloat(n["Y"===n[1]?2:3]);return isNaN(r)?0:r}return(n=Sr.exec(t)||Sr.exec(ui.getStyleValue(e,"transform")))?parseFloat(n[2]||n[4]):0}},{key:"getTranslateXY",value:function(e){return[ui.getTranslateX(e),ui.getTranslateY(e)]}},{key:"getOffsetX",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}},{key:"getOffsetY",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}},{key:"getOffsetXY",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;return[ui.getOffsetX(e,t),ui.getOffsetY(e,t)]}},{key:"getPageX",value:function(e){return e.getBoundingClientRect().left+Br.pageXOffset}},{key:"getPageY",value:function(e){return e.getBoundingClientRect().top+Br.pageYOffset}},{key:"getExtremalSizePX",value:function(e,t){var n=Le.hyphenate(t),r=n.split("-")[1],i=ui.getStyleValue(e,n);return i=/%/.test(i)?e.parentElement?parseInt(ui.getStyleValue(e.parentElement,r),10):NaN:parseInt(i,10)}},{key:"setScale",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:t,r=ui.getStyleValue(e,"transform").split(/,\s*/);r.length>1?(r[0].startsWith("matrix3d")?(r[0]="matrix3d(".concat(t),r[5]=n):(r[0]="matrix(".concat(t),r[3]=n),e.style.transform=r.join(",")):e.style.transform="scale(".concat(t,", ").concat(n,")")}},{key:"setTranslateX",value:function(e,t){var n=ui.getStyleValue(e,"transform").split(/,\s*/);t=ui.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?12:4]=t,e.style.transform=n.join(",")):e.style.transform="translateX(".concat(t,"px)")}},{key:"setTranslateY",value:function(e,t){var n=ui.getStyleValue(e,"transform").split(/,\s*/);t=ui.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?13:5]=t,e.style.transform=n.join(",")+")"):e.style.transform="translateY(".concat(t,"px)")}},{key:"setTop",value:function(e,t){ui.setLength(e,"top",t)}},{key:"setLeft",value:function(e,t){ui.setLength(e,"left",t)}},{key:"setTopLeft",value:function(e,t,n){ui.setLength(e,"top",t),ui.setLength(e,"left",n)}},{key:"setTopInsetInlineStart",value:function(e,t,n){ui.setLength(e,"top",t),ui.setLength(e,"inset-inline-start",n)}},{key:"setRect",value:function(e,t){var n=t.x,r=t.y,i=t.width,a=t.height;ui.setTopInsetInlineStart(e,r,n),ui.setLength(e,"width",i),ui.setLength(e,"height",a)}},{key:"setTranslateXY",value:function(e,t,n){if(null==t)return ui.setTranslateY(e,n);if(null==n)return ui.setTranslateX(e,t);t=ui.roundPx(t),n=ui.roundPx(n);var r=ui.getStyleValue(e,"transform").split(/,\s*/),i=r[0].startsWith("matrix3d");r.length>1?(r[i?12:4]=t,r[i?13:5]=n,e.style.transform=r.join(",")+")"):e.style.transform="translate(".concat(t,"px, ").concat(n,"px)")}},{key:"addTranslateX",value:function(e,t){ui.setTranslateX(e,ui.getTranslateX(e)+t)}},{key:"addTranslateY",value:function(e,t){ui.setTranslateY(e,ui.getTranslateY(e)+t)}},{key:"addLeft",value:function(e,t){ui.setLeft(e,ui.getOffsetX(e)+t)}},{key:"addTop",value:function(e,t){ui.setTop(e,ui.getOffsetY(e)+t)}},{key:"alignTo",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:gr,r=arguments.length>3?arguments[3]:i,a=arguments.length>4&&arguments[4]!==i?arguments[4]:"translate";t=t instanceof pt?t:pt.from(t,!0);var o=pt.from(e,!0);r&&(o.roundPx(),t.roundPx());var l=o.alignTo(Object.assign(n,{target:t}));if("topInset"===a){var s=[parseInt(e.style.insetInlineStart||0,10),parseInt(e.style.top||0,10)];ui.setTopInsetInlineStart(e,s[1]+l.y-o.y,s[0]+l.x-o.x)}else if("topLeft"===a){var u=[parseInt(e.style.left||0,10),parseInt(e.style.top||0,10)];ui.setTopLeft(e,u[1]+l.y-o.y,u[0]+l.x-o.x)}else{var c=ui.getTranslateXY(e);ui.setTranslateXY(e,c[0]+l.x-o.x,c[1]+l.y-o.y)}}},{key:"getStyleValue",value:function(e,t,n,r){var i=n?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){var a,o={},l=D(t);try{for(l.s();!(a=l.n()).done;){var s=a.value;o[s]=i.getPropertyValue(Le.hyphenate(s))}}catch(e){l.e(e)}finally{l.f()}return o}return i.getPropertyValue(Le.hyphenate(t))}},{key:"getEdgeSize",value:function(e,t,n){for(var r="border"===t?"-width":"",i={raw:{}},a=0,o=["top","right","bottom","left"];a<o.length;a++){var l=o[a];n&&!n.includes(l[0])||(i[l]=parseFloat(i.raw[l]=ui.getStyleValue(e,"".concat(t,"-").concat(l).concat(r))))}return i.width=(i.left||0)+(i.right||0),i.height=(i.top||0)+(i.bottom||0),i}},{key:"parseStyle",value:function(e){if("string"==typeof e){var t=e.split(Tr);e={};for(var n=0,r=t.length;n<r;n++){var i=t[n].split(Mr);e[i[0]]=i[1]}}return e||{}}},{key:"applyStyle",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];if("string"==typeof t)n?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){var r,a;for(r in n&&(e.style.cssText=""),t.style&&"string"!=typeof t.style&&(t=Be.assign({},t,t.style)),t)if(!Pr[r]){var o=_(ui.unitize(r,t[r]),2);r=o[0],null==(a=o[1])?e.style.removeProperty(r):e.style.setProperty(r,a)}"string"==typeof t.style&&(e.style.cssText+=t.style)}}},{key:"getCSSText",value:function(e){if("string"==typeof e)return e;var t="";for(var n in e)Pr[n]||(t+="".concat(Le.hyphenate(n),":").concat(e[n],";"));return t}},{key:"assignClasses",value:function(e,t){Be.forEach(t,(function(t,n){return e.classList.toggle(n,Boolean(t))}))}},{key:"toggleClasses",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:null;if(t=$e.asArray(t),!0===r)(n=e.classList).add.apply(n,z(t));else if(!1===r){var a;(a=e.classList).remove.apply(a,z(t))}else t.forEach((function(t){return e.classList.toggle(t)}))}},{key:"addTemporaryClass",value:function(e,t,n){var a=arguments.length>3&&arguments[3]!==i?arguments[3]:r,o=arguments.length>4&&arguments[4]!==i?arguments[4]:t;n>0&&(e.classList.add(t),a===r?a.setTimeout((function(){return null==e?void 0:e.classList.remove(t)}),n):a.setTimeout({fn:function(t){return e.classList.remove(t)},delay:n,name:o,args:[t],cancelOutstanding:!0}))}},{key:"getPropertyTransitionDuration",value:function(e,t){var n,i=r.getComputedStyle(e),a=i.transitionProperty.split(", "),o=i.transitionDuration.split(", "),l=a.indexOf(Le.hyphenate(t));return-1!==l&&(n=1e3*parseFloat(o[l])),n}},{key:"getAnimationDuration",value:function(e){return 1e3*parseFloat(ui.getStyleValue(e,"animation-duration"))}},{key:"highlight",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:r;return e instanceof pt?e.highlight():new Promise((function(n){t.setTimeout((function(){e.classList.add("b-fx-highlight"),t.setTimeout((function(){e.classList.remove("b-fx-highlight"),n()}),2e3)}),0)}))}},{key:"scrollBarWidth",get:function(){if(null===ii){var e=ri||(ri=ui.createElement({parent:Vr.documentElement,className:"b-scrollbar-measure-element",style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==Vr.documentElement&&Vr.documentElement.appendChild(e),ii=e.offsetWidth,Vr.documentElement.style.setProperty("--b-scrollbar-width","".concat(ii,"px"))}return ii}},{key:"scrollBarPadElement",get:function(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}},{key:"scrollLimit",get:function(){for(var t=e.createElement({parent:document.body,style:"position:absolute; left:-999px; top:0; width:5px; height:5px",children:[{style:"position:absolute; width:1px; height:1px"}]}),n=t.firstElementChild,r=0,i=2e7;i>1e6&&(n.style.transform="translateY(".concat(i,"px)"),t.style.lineHeight="".concat(r=1-r),!(t.scrollHeight>=i));)i-=1e6;return Object.defineProperty(e,"scrollLimit",{value:i}),t.remove(),i}},{key:"resetScrollBarWidth",value:function(){ii=null}},{key:"measureText",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3&&arguments[3]!==i?arguments[3]:i,a=ui.getMeasureElement(t,r);a[n?"innerHTML":"innerText"]=e;var o=a.clientWidth;return a.className="",o}},{key:"measureSize",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2];if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){var r,a=null===(r=e.includes)||void 0===r?void 0:r.call(e,"%"),o=ui.getMeasureElement(t,a?t.parentNode:i),l=o.parentElement;o.innerHTML="",a&&(l.style.display="contents"),o.style.minWidth=o.style.maxWidth=ui.setLength(e);var s=n?o.offsetWidth:o.getBoundingClientRect().width;return l.style.display="",o.style.minWidth=o.style.maxWidth=o.className="",s}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}},{key:"getMeasureElement",value:function(e,t){t=t||Vr.body;var n=Br.getComputedStyle(e),r=t.offScreenDiv=t.offScreenDiv||ui.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return Wr.forEach((function(e){r.style[e]!==n[e]&&(r.style[e]=n[e])})),r.className=e.className,r.parentElement.parentElement!==t&&t.appendChild(r.parentElement),r}},{key:"stripTags",value:function(e){return(ui.$domParser||(ui.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}},{key:"sync",value:function(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=ui.createElementFromTemplate(e)}return ui.performSync(e,t),t}},{key:"performSync",value:function(e,t){return e.outerHTML!==t.outerHTML&&(ui.syncAttributes(e,t),ui.syncContent(e,t),ui.syncChildren(e,t),!0)}},{key:"getSyncAttributes",value:function(e){for(var t={},n=[],r=0;r<e.attributes.length;r++){var i=e.attributes[r];if(i.specified){var a=i.name.toLowerCase();t[a]=i.value,n.push(a)}}return{attributes:t,names:n}}},{key:"syncAttributes",value:function(e,t){var n=ui.getSyncAttributes(e),r=n.attributes,i=n.names,a=ui.getSyncAttributes(t),o=a.attributes,l=a.names,s=i.includes("dataset"),u=i.filter((function(e){return!l.includes(e)})),c=l.filter((function(e){return!(i.includes(e)||s&&e.startsWith("data-"))})),d=i.filter((function(e){return l.includes(e)}));if(u.length>0)for(var h=0;h<u.length;h++){var f=u[h];"style"===f?ui.applyStyle(t,r.style,!0):"dataset"===f?Object.assign(t.dataset,r.dataset):t.setAttribute(f,r[f])}if(c.length>0)for(var v=0;v<c.length;v++)t.removeAttribute(c[v]);if(d.length>0)for(var g=0;g<d.length;g++){var m=d[g];if("style"===m)ui.applyStyle(t,r.style,!0);else if("dataset"===m)Object.assign(t.dataset,r.dataset);else if("class"!==m||!r.class.isDomClassList&&"object"!==W(r.class))o[m]!==r[m]&&t.setAttribute(m,r[m]);else{var p=void 0;(p=r.class.isDomClassList?r.class:new Ct(r.class)).isEqual(o.class)||t.setAttribute("class",p)}}}},{key:"syncContent",value:function(e,t){0===ui.getChildElementCount(e)&&(t.innerText=e.innerText)}},{key:"setInnerText",value:function(e,t){var n=e.firstChild;(null==n?void 0:n.nodeType)===Element.TEXT_NODE?n.data=t:e.textContent=t}},{key:"syncChildren",value:function(e,t){for(var n=zr.call(e.childNodes),r=zr.call(t.childNodes);n.length;){var i=n.shift(),a=r.shift();if(i&&i.nodeType!==pr&&i.nodeType!==mr)throw new Error("Source node type ".concat(i.nodeType," not supported by DomHelper.sync()"));if(a&&a.nodeType!==pr&&a.nodeType!==mr)throw new Error("Target node type ".concat(a.nodeType," not supported by DomHelper.sync()"));if(a)if(i.nodeType===a.nodeType)i.nodeType===pr?a.data=i.data:i.tagName===a.tagName?this.performSync(i,a):(t.insertBefore(i,a),a.remove());else{if(i.nodeType!==pr||a.nodeType!==mr){var o=i.parentElement||i;throw new Error("Currently no support for transforming nodeType.\n".concat(o.outerHTML))}t.innerText=i.data.trim()}else t.appendChild(i)}r.forEach((function(e){e.remove()}))}},{key:"syncClassList",value:function(e,t){var n,r=e.classList,i="string"==typeof t,a=i?t.split(Rr):Ct.normalize(t,"array"),o=a.length,l=r.length!==o;for(n=0;!l&&n<o;n++)l=!r.contains(a[n]);return l&&(e.className=i?t:a.join(" ")),l}},{key:"updateClassList",value:function(e,t){var n,r,i=e.classList,a=!1;for(n in t)r=Boolean(t[n]),i.contains(n)!==r&&(i[r?"add":"remove"](n),a=!0);return a}},{key:"setTheme",value:function(t,n){t=t.toLowerCase();var r=document.head,i=ui.getThemeInfo(n).name.toLowerCase(),a=r.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),o=0;if(i===t)return jr;ui.removeEachSelector(r,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");var l={theme:t,prev:i};function s(n,r,s){var u=e.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:n.href.replace(i,t),nextSibling:n});u.addEventListener("load",(function(){delete u.dataset.loading,oi=null,++o===a.length&&(a.forEach((function(e){return e.remove()})),Wn.trigger("theme",l),r(l))})),u.addEventListener("error",(function(e){delete u.dataset.loading,s(e)}))}if(a.length)return new Promise((function(e,t){a.forEach((function(n,r){s(n,e,t,a.length)}))}));var u=r.querySelector("#bryntum-theme:not([data-loading])")||r.querySelector('[href*="'.concat(i,'.css"]:not([data-loading])'));if(null==u||!u.href.includes("".concat(i,".css")))throw new Error("Theme link for ".concat(i," not found"));return a=[u],new Promise((function(e,t){return s(u,e,t)}))}},{key:"themeInfo",get:function(){return e.getThemeInfo()}},{key:"getThemeInfo",value:function(e){if(!oi){var t=ui.createElement({parent:document.body,className:"b-theme-info"}),n=ui.getStyleValue(t,"content",!1,":before");if(n)try{oi=JSON.parse(n.replace(/^["']|["']$|\\/g,""))}catch(e){oi=null}oi=oi||(e?{name:e}:null),t.remove()}return oi}},{key:"transition",value:(n=f((function(e){var t=e.element,n=e.selector,i=void 0===n?"[data-dom-transition]":n,l=e.duration,s=e.action,u=e.thisObj,c=void 0===u?this:u,d=e.addTransition,h=void 0===d?{}:d,f=e.removeTransition,v=void 0===f?{}:f;return L().mark((function e(){var n,u,d,f,g,m,p,y,k,b,C,w,S,x,E,R,T,M,F,A,I,O,P,H,B,V,N,z,j,W,$,U,G,Y,q,K,X,Z,J,Q,ee,te,ne,re,ie,ae,oe,le,se,ue,ce,de;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new o,u=!t.style.height,d=Array.from(t.querySelectorAll(i)),f=new a(d.map((function(e){for(var r=0,i=e.parentElement;i&&i!==t;)r++,i=i.parentElement;e.$depth=r,e.scrollHeight>e.offsetHeight&&"auto"===getComputedStyle(e).overflow&&(e.$scrollTop=e.scrollTop,n.add(e));var a=e.parentElement,o=pt.from(e,t),l=pt.from(e,a),s=getComputedStyle(a),u=parseFloat(s.borderLeftWidth);return u&&(o.left-=u,l.left-=u),[e.id,{element:e,globalBounds:o,localBounds:l,depth:r,parentElement:a}]}))),u&&(t.style.height=t.offsetHeight+"px"),s.call(c),g=Array.from(t.querySelectorAll(i)),m=new a(g.map((function(e){var n=pt.from(e,t),i=pt.from(e,e.parentElement),a=r.getComputedStyle(e.parentElement),o=parseFloat(a.borderLeftWidth);return o&&(n.left-=o,i.left-=o),[e.id,{element:e,globalBounds:n,localBounds:i}]}))),p=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"],t.classList.add("b-dom-transition-snapshot"),y=D(f);try{for(y.s();!(k=y.n()).done;)b=_(k.value,2),C=b[0],w=b[1],(S=m.get(C))?(x=S.element,E=x.style,R=x.parentElement,T=parseInt(ui.getStyleValue(x,"zIndex")),M=w.globalBounds,F=w.localBounds,A=w.depth,I=w.parentElement,O=I!==R,Be.copyProperties(x.$initial={parentElement:R},E,p),P=void 0,O?(S.bounds=S.globalBounds,P=M,t.appendChild(x)):(S.bounds=S.localBounds,P=F,I.appendChild(x)),H="hidden",n.has(x)&&(x.$scrollPlaceholder=ui.createElement({parent:x,style:{height:x.scrollHeight}}),H="auto"),B={position:"absolute",top:"".concat(P.top,"px"),left:"".concat(P.left,"px"),width:"".concat(P.width,"px"),height:"".concat(P.height,"px"),minWidth:0,minHeight:0,margin:0,zIndex:A+(T||0),overflow:H},"preserve-padding"!==x.dataset.domTransition&&(B.padding=0),Object.assign(E,B),S.processed=!0):(V=w.element,N=w.localBounds,z=w.depth,j=w.parentElement,V.$initial={removed:!0},Object.assign(V.style,{position:"absolute",top:"".concat(N.top,"px"),left:"".concat(N.left,"px"),width:"".concat(N.width,"px"),height:"".concat(N.height,"px"),minWidth:0,minHeight:0,padding:0,margin:0,zIndex:z,overflow:"hidden"}),j.appendChild(V),m.set(C,{element:V,bounds:N,removed:!0,processed:!0}),g.push(V))}catch(e){y.e(e)}finally{y.f()}W=D(m);try{for(W.s();!($=W.n()).done;)U=_($.value,2),(G=U[1]).processed||(Y=G.element,q=Y.style,K=Y.parentElement,X=G.bounds=G.localBounds,Y.classList.add("b-dom-transition-adding"),Be.copyProperties(Y.$initial={parentElement:K},q,p),Object.assign(q,{position:"absolute",top:h.top?0:"".concat(X.top,"px"),left:h.left?0:"".concat(X.left,"px"),width:h.width?0:"".concat(X.width,"px"),height:h.height?0:"".concat(X.height,"px"),opacity:h.opacity?0:null,zIndex:K.$depth+1,overflow:"hidden"}))}catch(e){W.e(e)}finally{W.f()}Z=D(n);try{for(Z.s();!(J=Z.n()).done;)(Q=J.value).scrollTop=Q.$scrollTop}catch(e){Z.e(e)}finally{Z.f()}t.classList.add("b-dom-transition"),t.firstElementChild.offsetWidth,ee=D(m);try{for(ee.s();!(te=ee.n()).done;)ne=_(te.value,2),re=ne[1],ie=re.element,ae=re.bounds,re.removed?Object.assign(ie.style,{top:v.top?0:"".concat(ae.top,"px"),left:v.left?0:"".concat(ae.left,"px"),width:v.width?0:"".concat(ae.width,"px"),height:v.height?0:"".concat(ae.height,"px"),opacity:v.opacity?0:ie.$initial.opacity}):Object.assign(ie.style,{top:"".concat(ae.top,"px"),left:"".concat(ae.left,"px"),width:"".concat(ae.width,"px"),height:"".concat(ae.height,"px"),opacity:ie.$initial.opacity})}catch(e){ee.e(e)}finally{ee.f()}return e.next=17,Ge.sleep(l);case 17:for(t.classList.remove("b-dom-transition","b-dom-transition-snapshot"),oe=0,le=g;oe<le.length;oe++)(se=le[oe]).$initial&&(se.$initial.removed?se.remove():(Be.copyProperties(se.style,se.$initial,p),se.$scrollPlaceholder&&(se.$scrollPlaceholder.remove(),delete se.$scrollPlaceholder),se.classList.remove("b-dom-transition-adding"),se.$initial.parentElement.appendChild(se)));u&&(t.style.height=""),ue=D(n);try{for(ue.s();!(ce=ue.n()).done;)(de=ce.value).scrollTop=de.$scrollTop,delete de.$scrollTop}catch(e){ue.e(e)}finally{ue.f()}case 22:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"loadScript",value:(t=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=document.createElement("script");r.src=t,r.onload=e,r.onerror=n,document.head.appendChild(r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"isNamedColor",value:function(e){return e&&!/^(#|hsl|rgb|hwb|lab|lch|oklab|oklch)/.test(e)}},{key:"createColorStyle",value:function(e){return null!=e&&e.length?this.isNamedColor(e)?"var(--cal-color-".concat(e,")"):e:""}},{key:"NodeFilter",get:function(){return NodeFilter}},{key:"addChild",value:function(e,t,n){e.insertBefore(t,n)}},{key:"cloneStylesIntoShadowRoot",value:function(e,t){return new Promise((function(n,r){t&&e.querySelectorAll('style, link[rel="stylesheet"]').forEach((function(e){return e.remove()}));var i=document.querySelectorAll('link[rel="stylesheet"]'),a=0;i.forEach((function(t){var o=t.cloneNode();o.addEventListener("load",(function(){(a+=1)===i.length&&n()})),o.addEventListener("error",(function(e){r(o.href)})),e.appendChild(o)})),document.querySelectorAll("style").forEach((function(t){var n=t.cloneNode();n.innerHTML=t.innerHTML,e.appendChild(n)})),i.length||n()}))}}]);var t,n,l}();S(li,"_usingKeyboard",!1),S(li,"enableKeyboardCssModifiers",!0),S(li,"$name","DomHelper"),te.register(li);var si,ui=li,ci=function(){return ui.isTouchEvent=!1},di=function(){ui.isTouchEvent=!0,clearTimeout(si),si=setTimeout(ci,400)};Vr.addEventListener("touchstart",di,!0),Vr.addEventListener("touchend",di,!0),ui.canonicalStyles=Kr,ui.supportsTemplate="content"in Vr.createElement("template"),ui.elementPropKey="$bryntum",ui.numberRe=br,Node.prototype.closest=function(e){var t;return null===(t=this.parentNode)||void 0===t?void 0:t.closest(e)},r.addEventListener("resize",(function(){return ii=null})),li._$name="DomHelper";var hi={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3,SHOW_ALL:4294967295,SHOW_ELEMENT:1,SHOW_ATTRIBUTE:2,SHOW_TEXT:4,SHOW_CDATA_SECTION:8,SHOW_ENTITY_REFERENCE:16,SHOW_ENTITY:32,SHOW_PROCESSING_INSTRUCTION:64,SHOW_COMMENT:128,SHOW_DOCUMENT:256,SHOW_DOCUMENT_TYPE:512,SHOW_DOCUMENT_FRAGMENT:1024,SHOW_NOTATION:2048},fi=Object.create||function(e){function t(){}return t.prototype=e,new t},vi={first:"firstChild",last:"lastChild",next:"firstChild",previous:"lastChild"},gi={next:"nextSibling",previous:"previousSibling"},mi=vi.toString,pi=function(e,t){return mi.call(e).toLowerCase()==="[object "+t.toLowerCase()+"]"},yi=function(e,t){return 1<<t.nodeType-1&e.whatToShow?null===e.filter?hi.FILTER_ACCEPT:e.filter.acceptNode(t):hi.FILTER_SKIP},ki=function(e,t){var n,r,i,a,o;for(r=e.currentNode[vi[t]];null!==r;){if((a=yi(e,r))===hi.FILTER_ACCEPT)return e.currentNode=r,r;if(a!==hi.FILTER_SKIP||null===(n=r[vi[t]]))for(;null!==r;){if(null!==(o=r[vi[t]])){r=o;break}if(null===(i=r.parentNode)||i===e.root||i===e.currentNode)return null;r=i}else r=n}return null},bi=function(e,t){var n,r,i;if((n=e.currentNode)===e.root)return null;for(;;){for(i=n[gi[t]];null!==i;){if((r=yi(e,n=i))===hi.FILTER_ACCEPT)return e.currentNode=n,n;i=n[vi[t]],r===hi.FILTER_REJECT&&(i=n[gi[t]])}if(null===(n=n.parentNode)||n===e.root)return null;if(yi(e,n)===hi.FILTER_ACCEPT)return null}},Ci=function(e,t){if(e===t)return null;if(null!==e.nextSibling)return e.nextSibling;for(;null!==e.parentNode;){if((e=e.parentNode)===t)return null;if(null!==e.nextSibling)return e.nextSibling}return null},wi=function(){return w((function e(t,n,r){m(this,e);var i=this,a=!1;if(!t||!t.nodeType)throw new Error("DOMException: NOT_SUPPORTED_ERR");i.root=t,i.whatToShow=Number(n)||0,i.currentNode=t,pi(r,"function")?(i.filter=fi(hi),i.filter.acceptNode=function(e){if(a)throw new Error("DOMException: INVALID_STATE_ERR");a=!0;var t=r(e);return a=!1,t}):i.filter=null}),[{key:"parentNode",value:function(){for(var e=this.currentNode;null!==e&&e!==this.root;)if(null!==(e=e.parentNode)&&yi(this,e)===hi.FILTER_ACCEPT)return this.currentNode=e,e;return null}},{key:"firstChild",value:function(){return ki(this,"first")}},{key:"lastChild",value:function(){return ki(this,"last")}},{key:"previousSibling",value:function(){return bi(this,"previous")}},{key:"nextSibling",value:function(){return bi(this,"next")}},{key:"previousNode",value:function(){var e,t,n;for(e=this.currentNode;e!==this.root;){for(n=e.previousSibling;null!==n;){for(t=yi(this,e=n);t!==hi.FILTER_REJECT&&null!==e.lastChild;)e=e.lastChild,t=yi(this,e);if(t===hi.FILTER_ACCEPT)return this.currentNode=e,e;n=e.previousSibling}if(e===this.root||null===e.parentNode)return null;if(e=e.parentNode,yi(this,e)===hi.FILTER_ACCEPT)return this.currentNode=e,e}return null}},{key:"nextNode",value:function(){var e,t,n;for(e=this.currentNode,t=hi.FILTER_ACCEPT;;){for(;t!==hi.FILTER_REJECT&&null!==e.firstChild;)if(e=e.firstChild,(t=yi(this,e))===hi.FILTER_ACCEPT)return this.currentNode=e,e;if(null===(n=Ci(e,this.root)))return null;if((t=yi(this,e=n))===hi.FILTER_ACCEPT)return this.currentNode=e,e}}}])}();function Di(e,t,n){return t=t===i?hi.SHOW_ALL:t,n&&pi(n.acceptNode,"function")?n=n.acceptNode:pi(n,"function")||(n=null),new wi(e,t,n)}var Si,xi=[],Ei={},Ri=Array.prototype.slice;function Ti(e){var t;if(1===e.nodeType){t=document.createElement(e.tagName),li.syncAttributes(e,t);var n=Mi(e.childNodes);$e.asArray(n).forEach((function(e){return t.appendChild(e)}))}return 3===e.nodeType&&(t=document.createTextNode(e.wholeText)),t}function Mi(e){if(e instanceof Node)return Ti(e);for(var t=[],n=0,r=e.length;n<r;n++)t.push(Ti(e[n]));return t}li.supportsTemplate=!1;var Fi=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:li}}},{key:"getRootElement",value:function(e){var t,n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return(null==n?void 0:n.body)||(null==n?void 0:n.querySelector(".bryntum-root-element"))||(null==n?void 0:n.firstChild)||n||e.ownerDocument.body}},{key:"getChildElementCount",value:function(e){return e.children.length}},{key:"createElementFromTemplate",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:Ei,r=n.array,a=n.raw,o=n.fragment;if(t=(Si||(Si=new DOMParser)).parseFromString(e,"text/html").body,o){var l=t?t.childNodes:xi;t=document.createDocumentFragment();for(var s=0,u=l.length;s<u;s++)t.appendChild(Mi(l[s]));return t}return Mi(t=1!==(t=a?t.childNodes:t.children).length||r?Ri.call(t):t[0])}},{key:"isDOMEvent",value:function(e){return e&&"stopImmediatePropagation"in e}},{key:"NodeFilter",get:function(){return hi}},{key:"addChild",value:function(e,t,n){e===document.body||e===document.documentElement?e.appendChild(t):this._overridden.addChild.call(this,e,t,n)}}])}();We.apply(Fi);var Ai=Node.prototype.contains;Node.prototype.contains=function(e){return e===this||Ai.apply(this,arguments)};var Ii=function(){return w((function e(){m(this,e)}),null,[{key:"insertRule",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:document.head,n=this.getStyleSheet(t),r=n.cssRules,a=r.length,o="string"==typeof e;if((o?[e]:e).forEach((function(e,t){return n.insertRule(e,t)})),r.length>a)return o?r[0]:Array.from(r).slice(0,e.length)}},{key:"findRule",value:function(e){var t,n="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),(function(r){if(t=Array.prototype.find.call(r.sheet.rules||r.sheet.cssRules,(function(t){return n?e(t):t.selectorText===e})))return!0})),t}},{key:"getStyleSheet",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:document.head;return e.$bryntumStylesheet||(e.$bryntumStylesheet=li.createElement({tag:"style",type:"text/css",parent:e}).sheet),e.$bryntumStylesheet}},{key:"getCSSVersion",value:function(){return getComputedStyle(document.documentElement).getPropertyValue("--bryntum-version").replace(/[" ]/gm,"")}}])}();S(Ii,"$name","CSSHelper"),te.register(Ii),Ii._$name="CSSHelper";var Li,Oi=Reflect.defineProperty;Li=ne.isBrowserEnv?r.performance:{now:function(){return(new Date).getTime()}};var Pi=null;if(Ne.isTestEnv){var _i=r.bryntum||(r.bryntum={});Pi=_i.globalDelays={timeouts:new a,intervals:new a,animationFrames:new a,idleCallbacks:new a,isEmpty:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];return Pi.timeouts.size+Pi.animationFrames.size+Pi.idleCallbacks.size+(e?Pi.intervals.size:0)===0},getFiltered:function(e){var t=e.ignoreTimeouts,n=void 0===t?[]:t,r=e.maxDelay,i=void 0===r?5e3:r,a=e.includeIntervals,o=[],l=["timeouts","animationFrames","idleCallbacks"];void 0!==a&&a&&l.push("intervals");for(var s=0,u=l;s<u.length;s++){var c,d=u[s],h=D(Pi[d].entries());try{for(h.s();!(c=h.n()).done;){var f=_(c.value,2)[1];n.includes(f.name)||Number.isInteger(f.delay)&&!(f.delay<i)||o.push(f)}}catch(e){h.e(e)}finally{h.f()}}return o}}}var Hi=Promise.resolve(),Bi=Object.freeze([]),Vi=function(){},Ni=Object.freeze({}),zi=r.queueMicrotask,ji=function(e,t,n,r){var i="string"==typeof t,a=(null==r?void 0:r.appendArgs)||Bi,o=function(){n.timerId=null,n.lastCallTime=Li.now();var r,o=n.args;(n.args=null,i)?(r=e)[t].apply(r,z(o).concat(z(a))):t.call.apply(t,[e].concat(z(o),z(a)));n.called=!0,++n.calls};return e=(null==r?void 0:r.thisObj)||e,n.lastCallTime=-9e9,n.calls=0,n.suspended=null==r?void 0:r.suspended,n.invoker=o,o.wrapFn=n,o.fn=t,o.this=e,o},Wi=function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:"clearTimeout";return t.cancel=function(){t.isPending&&(e[n](t.timerId),t.args=t.timerId=null)},t.flush=function(){t.isPending&&(e[n](t.timerId),t.timerId=null,t.invoker())},t.now=function(){t.cancel();for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.args=n,t.invoker()},t.resume=function(e){var n=t.suspended;t.suspended=e||n<1?0:n-1},t.suspend=function(){++t.suspended},t.immediate=!1,t.suspended=t.suspended?1:0,t.timerId=null,Oi(t,"isPending",{get:function(){return null!==t.timerId}}),t},$i=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){B(t,"doDestroy",this,3)([]),this.clearDelayables()}},{key:"clearDelayables",value:function(){var e=this,t=[e.idleCallbackIds,e.animationFrameIds,e.intervalIds,e.timeoutMap,e.timeoutIds,e.microtasksPending],n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],l=t[5];e.idleCallbackIds=e.animationFrameIds=e.intervalIds=e.timeoutMap=e.timeoutIds=e.microtasksPending=null,null==o||o.forEach((function(e,t){var n;"function"==typeof e&&e(),clearTimeout(t),null===(n=Pi)||void 0===n||n.timeouts.delete(t)})),null==a||a.forEach((function(e,t){return clearTimeout(t)})),null==i||i.forEach((function(e){var t;clearInterval(e),null===(t=Pi)||void 0===t||t.intervals.delete(e)})),null==r||r.forEach((function(e){var t;cancelAnimationFrame(e),null===(t=Pi)||void 0===t||t.animationFrames.delete(e)})),null==n||n.forEach((function(e){var t;cancelIdleCallback(e),null===(t=Pi)||void 0===t||t.idleCallbacks.delete(e)})),null==l||l.forEach((function(e){return e.cancel()}))}},{key:"hasTimeout",value:function(e){var t;return Boolean(null===(t=this.timeoutMap)||void 0===t?void 0:t.has(e))}},{key:"asap",value:function(e,t){var n=this,r=function(){if(!r.suspended){r.called=!1;for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];r.args=t,r.immediate?i():r.isPending||(r.timerId=n.queueMicrotask(i))}},i=ji(n,e,r,t);return Wi(n,r,"cancelMicrotask")}},{key:"queueMicrotask",value:function(e,t,n){var r,i;n||!t||Array.isArray(t)||(n=t,t=null),n=n||Ni,t=t||n.args||Bi;var o=this,l="string"==typeof e,s=l?e:e.name,u=o.microtasksPending||(o.microtasksPending=new a),c=function(){return u.delete(r)},d=function(){i===u.get(r)&&(u.delete(r),l?!o.isDestroyed&&o[e].apply(o,z(t)):e.apply(o,t))};return o.isDestroying&&!n.runOnDestroy?Vi:(r=n.cancelOutstanding?s||e:c,c.taskDef=i={key:r,name:s,fn:e,args:t,options:n,cancel:c,wrapFn:d},zi?zi(d):Hi.then(d),u.set(r,i),c)}},{key:"cancelMicrotask",value:function(e){null==e||e()}},{key:"setTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=e.fn,r=e.delay,i=e.name,o=e.runOnDestroy,l=e.cancelOutstanding,s=e.args;if(arguments.length>1||"function"==typeof arguments[0]){var u=Array.prototype.slice.call(arguments);n=u[0],r=u[1],i=u[2],o=u[3],l=u[4]}"string"==typeof n?i=n:i||(i=n.name||n),l&&this.clearTimeout(i);var c=this,d=c.timeoutIds||(c.timeoutIds=new a),h=c.timeoutMap||(c.timeoutMap=new a),f=setTimeout((function(){var e;"string"==typeof n&&(n=c[i]),null==d||d.delete(f),null==h||h.delete(i),null===(e=Pi)||void 0===e||e.timeouts.delete(f),n.apply(c,s)}),r);return d.set(f,!o||n),null===(t=Pi)||void 0===t||t.timeouts.set(f,{fn:n,delay:r,name:i}),i&&h.set(i,f),f}))},{key:"clearTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n,r=e;if("string"==typeof r){if(!this.timeoutMap)return;r=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(r),null===(t=this.timeoutIds)||void 0===t||t.delete(r),null===(n=Pi)||void 0===n||n.timeouts.delete(r)}))},{key:"clearInterval",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n;clearInterval(e),null===(t=this.intervalIds)||void 0===t||t.delete(e),null===(n=Pi)||void 0===n||n.intervals.delete(e)}))},{key:"setInterval",value:function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){var r,i=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new o)).add(i),null===(r=Pi)||void 0===r||r.intervals.set(i,{fn:e,delay:t,name:n}),i}))},{key:"requestAnimationFrame",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:[],r=arguments.length>2&&arguments[2]!==i?arguments[2]:this,a=this.animationFrameIds||(this.animationFrameIds=new o),l=requestAnimationFrame((function(){var t;null===(t=Pi)||void 0===t||t.animationFrames.delete(l),a.delete(l)&&e.apply(r,n)}));return a.add(l),null===(t=Pi)||void 0===t||t.animationFrames.set(l,{fn:e,extraArgs:n,thisObj:r}),l}))},{key:"requestIdleCallback",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:[],r=arguments.length>2&&arguments[2]!==i?arguments[2]:this,a=this.idleCallbackIds||(this.idleCallbackIds=new o),l=requestIdleCallback((function(){var t;null===(t=Pi)||void 0===t||t.idleCallbacks.delete(l),a.delete(l)&&e.apply(r,n)}));return a.add(l),null===(t=Pi)||void 0===t||t.idleCallbacks.set(l,{fn:e,extraArgs:n,thisObj:r}),l}))},{key:"createOnFrame",value:function(e){var t,n=this,r=arguments.length>1&&arguments[1]!==i?arguments[1]:[],a=arguments.length>2&&arguments[2]!==i?arguments[2]:this,o=arguments.length>3?arguments[3]:i,l=function(){for(var i=arguments.length,l=new Array(i),s=0;s<i;s++)l[s]=arguments[s];null!=t&&o&&(n.cancelAnimationFrame(t),t=null),null==t&&(t=n.requestAnimationFrame((function(){"string"==typeof e&&(e=a[e]),t=null,l.push.apply(l,z(r)),e.apply(a,l)})))};return l.cancel=function(){return n.cancelAnimationFrame(t)},l}},{key:"cancelAnimationFrame",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n;cancelAnimationFrame(e),null===(t=this.animationFrameIds)||void 0===t||t.delete(e),null===(n=Pi)||void 0===n||n.animationFrames.delete(e)}))},{key:"cancelIdleCallback",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n;cancelIdleCallback(e),null===(t=this.idleCallbackIds)||void 0===t||t.delete(e),null===(n=Pi)||void 0===n||n.idleCallbacks.delete(e)}))},{key:"nextAnimationFrame",value:(n=f(L().mark((function e(){var t=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return t.requestAnimationFrame(e)})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"buffer",value:function(e,t){var n=this,r=t;t&&"number"!=typeof t?r=t.delay:t=null;var i=function(){if(!i.suspended){var e=i.delay;i.cancel(),i.called=!1;for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];i.args=r,i.immediate||!e?a():i.timerId=n.setTimeout(a,e)}},a=ji(this,e,i,t);return i.delay=r,Wi(this,i)}},{key:"raf",value:function(e,t){var n=this,r=t;t&&"boolean"!=typeof t?r=t.cancelOutstanding:t=null;var i=function(){if(!i.suspended){(i.cancelOutstanding||i.immediate)&&i.cancel(),i.called=!1;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.args=t,i.immediate?a():i.isPending||(i.timerId=n.requestAnimationFrame(a))}},a=ji(this,e,i,t);return i.cancelOutstanding=r,i.raf=!0,Wi(this,i,"cancelAnimationFrame")}},{key:"idle",value:function(e,t){var n=this,r=t;t&&"boolean"!=typeof t?r=t.cancelOutstanding:t=null;var i=function(){if(!i.suspended){(i.cancelOutstanding||i.immediate)&&i.cancel(),i.called=!1;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.args=t,i.immediate?a():i.isPending||(i.timerId=n.requestIdleCallback(a))}},a=ji(this,e,i,t);return i.cancelOutstanding=r,this.setTimeout((function(){return n.idleCallbackIds.delete(i.timerId)&&i.now()}),100),Wi(this,i,"cancelIdleCallback")}},{key:"throttle",value:function(e,t){var n,r=t;t&&"number"!=typeof t?(r=t.delay,n=t.throttled):t=null;var i=this,a=function(){if(!a.suspended){for(var e=a.delay,t=Li.now()-a.lastCallTime,r=arguments.length,l=new Array(r),s=0;s<r;s++)l[s]=arguments[s];a.args=l,a.immediate||t>=e?(i.clearTimeout(a.timerId),o()):(a.isPending||(a.timerId=i.setTimeout(o,e-t),a.called=!1),n&&(n.wrapFn.args=l,n()))}},o=ji(i,e,a,t);return a.delay=r,n&&(n=ji(i,n,(function(){}),t)),Wi(i,a)}},{key:"widgetClass",get:function(){}}],[{key:"declarable",get:function(){return["delayable"]}},{key:"setupDelayable",value:function(e){e.setupDelayableMethods(e.delayable)}},{key:"setupDelayableMethods",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=e.static,r=t||this.prototype;n&&delete e.static;var a=function(t){var n=e[t],i=t+"Now",a=W(n);r[i]||(r[i]=r[t]),"number"===a?n={type:"buffer",delay:n}:"string"===a&&(n={type:n}),Oi(r,t,{get:function(){var e=this,r=function(){return e[i].apply(e,arguments)},a=e[n.type](r,n);return Oi(e,t,{value:a,configurable:!0,writable:!0}),r.methodName=t,a}})};for(var o in e)a(o)}}]);var n}(e||Mn),S(t,"$name","Delayable"),t},Ui={pageXOffset:0,pageYOffset:0},Gi="onMouseMove",Yi="onMouseUp",qi="onDocumentClick",Ki="onTouchMove",Xi="onTouchEnd",Zi="onKeyDown",Ji="onKeyDownUp",Qi=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)([e]),n.initListeners(),n.isContainerDrag?n.initContainerDrag():n.initTranslateDrag(),n.onScrollManagerScrollCallback=n.onScrollManagerScrollCallback.bind(n)}},{key:"doDestroy",value:function(){this.reset(!0),B(t,"doDestroy",this,3)([])}},{key:"initListeners",value:function(){var e=this,t=e.outerElement,n={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),fr.on(n)}},{key:"getMouseMoveListenerTarget",value:function(e){var t=e.getRootNode(),n=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"closed"===t.mode&&(n=e.closest(".b-outer")||n),n}},{key:"isRTL",get:function(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}},{key:"onPointerDown",value:function(e){var t=this;if(!(0!==e.button||t.context||t.disabled||t.isElementDraggable&&!t.isElementDraggable(e.target,e))&&(t.startEvent=e,t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e))){var n=r;t.blurDetacher=fr.on({element:n,blur:t.onWindowBlur,thisObj:t});var i={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:Zi,keyup:Ji};if("touch"===e.pointerType?(t.touchStartTimer=t.setTimeout((function(){return t.touchStartTimer=null}),t.touchStartDelay,"touchStartDelay"),i.touchmove={handler:Ki,passive:!1},i.touchend=i.pointerup=Xi):(i.pointermove=Gi,i.pointerup=Yi),t.dragListenersDetacher=fr.on(i),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){var a=pt.from(t.dragWithin,t.outerElement);t.minY=a.top,t.maxY=a.bottom,t.minX=a.left,t.maxX=a.right}}}},{key:"internalMove",value:(o=f(L().mark((function e(n){var r,i,a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.scrollInitiated){e.next=2;break}return e.abrupt("return");case 2:if(a=(i=this).context,o=fr.getDistanceBetween(i.startEvent,n),!(i.touchStartTimer&&o>i.dragThreshold)){e.next=6;break}return i.abort(!0),e.abrupt("return");case 6:if(i.touchStartTimer||null==a||!a.element||!(a.started||o>=i.dragThreshold)||(null===(r=n.target)||void 0===r?void 0:r.nodeType)!==Node.ELEMENT_NODE){e.next=30;break}if(a.started){e.next=29;break}if(c=fr.getXY(i.startEvent),d=fr.getXY(n),h=Math.abs(c[0]-d[0])>=Math.abs(c[1]-d[1])?"horizontal":"vertical",a.beforeDragStartFired||!1!==i.trigger("beforeDragStart",{context:a,event:n,initialDirection:h})){e.next=11;break}return e.abrupt("return",i.abort());case 11:if(a.beforeDragStartFired=!0,!(Math.abs(fr.getDistanceBetween(i.startEvent,n,{x:i.lockY,y:i.lockX}))<i.dragThreshold)){e.next=14;break}return e.abrupt("return");case 14:if(i.isContainerDrag?i.startContainerDrag(n):i.startTranslateDrag(n),null!==(l=a.dragProxy)&&void 0!==l&&null!==(s=l.closest)&&void 0!==s&&s.call(l,".b-float-root")&&(a.dragProxy.style.fontSize=li.getStyleValue(a.element,"fontSize")),a.started=t.dragging=!0,null===(u=i.scrollManager)||void 0===u||u.startMonitoring(Be.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),a.outermostEl=li.getOutermostElement(n.target),a.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&li.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach((function(e){return e.classList.add(i.dropTargetCls)})),f=i.trigger("dragStart",{context:a,event:n,initialDirection:h}),!Be.isPromise(f)){e.next=25;break}return e.next=25,f;case 25:i.onKeyDownUp(n),a.moveUnblocked=!0,i.isContainerDrag?i.onContainerDragStarted(n):i.onTranslateDragStarted(n),i.trigger("afterDragStart",{context:a,event:n,initialDirection:h});case 29:a.moveUnblocked?i._cachedMouseEvent?(i.update(n),i.update(i._cachedMouseEvent),delete i._cachedMouseEvent):i.update(n):i._cachedMouseEvent=n;case 30:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"onScrollManagerScrollCallback",value:function(e){var t,n=this.lastMouseMoveEvent;null!==(t=this.context)&&void 0!==t&&t.element&&n&&(n.isScroll=!0,this.update(n,e))}},{key:"onTouchMove",value:function(e){var t;1===(null===(t=e.changedTouches)||void 0===t?void 0:t.length)&&(this.context&&!this.touchStartTimer&&e.preventDefault(),this.internalMove(e))}},{key:"onMouseMove",value:function(e){this.internalMove(e)}},{key:"update",value:function(e,t){var n=this,r=document.scrollingElement||document.body,i=n.context,a=n.getMouseMoveEventTarget(e);if("touchmove"===e.type){var o=e.changedTouches[0];a=li.getRootElement(e.target).getRootNode().elementFromPoint(o.clientX+r.scrollLeft,o.clientY+r.scrollTop)}i.target=a;var l,s=n.allowDropOutside||!n.dragWithin||n.dragWithin.contains(e.target);s&&n.dropTargetSelector&&(s=s&&Boolean(null===(l=a)||void 0===l?void 0:l.closest(n.dropTargetSelector)));n.isContainerDrag?n.updateContainerProxy(e,t):n.updateTranslateProxy(e,t),i.valid=s,n.trigger("drag",{context:i,event:e}),n.isContainerDrag&&n.updateContainerDrag(e,t),i.valid=i.valid&&s;var u,c=D(n.draggedElements);try{for(c.s();!(u=c.n()).done;){u.value.classList.toggle(n.invalidCls,!i.valid)}}catch(e){c.e(e)}finally{c.f()}e&&(n.lastMouseMoveEvent=e)}},{key:"draggedElements",get:function(){var e,t=this.context;return[t.dragProxy||t.element].concat(z(null!==(e=t.relatedElements)&&void 0!==e?e:[]))}},{key:"abort",value:(a=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0];return L().mark((function n(r,a){var o,l;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:l=(o=e).context,null===(r=o.scrollManager)||void 0===r||null===(a=r.stopMonitoring)||void 0===a||a.call(r),o.removeListeners(),null!=l&&l.started&&!l.aborted?(l.element.getBoundingClientRect(),l.valid=!1,o.isContainerDrag?o.abortContainerDrag(i,i,t):o.abortTranslateDrag(i,i,t),l.aborted=!0):o.reset(!0);case 4:case"end":return n.stop()}}),n)}))()})),function(){return a.apply(this,arguments)})},{key:"removeListeners",value:function(){var e,t;null===(e=this.dragListenersDetacher)||void 0===e||e.call(this),null===(t=this.blurDetacher)||void 0===t||t.call(this)}},{key:"reset",value:function(e){var n=this,r=n.context;if(null!=r&&r.started){var i,a,o=D(n.draggedElements);try{for(o.s();!(i=o.n()).done;){i.value.classList.remove(n.invalidCls)}}catch(e){o.e(e)}finally{o.f()}if(r.outermostEl.classList.remove("b-draghelper-active"),n.isContainerDrag)r.dragProxy.remove(),null===(a=n.floatRootOwner)||void 0===a||a.element.classList.remove("b-dragging-child");else n.cleanUp();n.dropTargetSelector&&n.dropTargetCls&&li.getRootElement(n.outerElement).querySelectorAll(n.dropTargetSelector).forEach((function(e){return e.classList.remove(n.dropTargetCls)}))}n.removeListeners(),e||n.trigger("reset"),n.context=n.lastMouseMoveEvent=null,t.dragging=!1}},{key:"onTouchEnd",value:function(e){li.getOutermostElement(e.target).classList.remove("b-no-touch-scroll"),this.onMouseUp(e)}},{key:"onDocumentClick",value:function(e){e.stopPropagation()}},{key:"onMouseUp",value:function(e){var t,n=this,r=n.context;(n.removeListeners(),r)&&(null===(t=n.scrollManager)||void 0===t||t.stopMonitoring(),r.started?r.moveUnblocked?(e.stopPropagation(),r.finalizing=!0,n.isContainerDrag?n.finishContainerDrag(e):n.finishTranslateDrag(e),fr.on({element:document,thisObj:n,click:qi,capture:!0,expires:n.clickSwallowDuration,once:!0})):n.ion({drag:function(){n.onMouseUp(e)},once:!0}):n.reset(!0))}},{key:"onKeyDown",value:function(e){var t;null!==(t=this.context)&&void 0!==t&&t.started&&"Escape"===e.key&&(e.stopImmediatePropagation(),this.abort()),this.onKeyDownUp(e)}},{key:"onKeyDownUp",value:function(e){var t;null===(t=this.context)||void 0===t||t.element.classList.toggle("b-drag-copy",e[ne.ctrlKey]||e[ne.metaKey])}},{key:"onWindowBlur",value:function(){this.context&&!this.context.finalizing&&this.abort()}},{key:"createProxy",value:function(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);var t=e.cloneNode(!0);return t.removeAttribute("id"),t}},{key:"isContainerDrag",get:function(){return"container"===this.mode}},{key:"animateProxyTo",value:(n=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:{align:"c-c"};return L().mark((function r(){var a,o,l,s;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.context,o=t.draggedElements,l=a.element,s=e.isRectangle?e:pt.from(e),o.forEach((function(e){e.classList.add("b-drag-final-transition"),li.alignTo(e,s,n,i,i,"inset"===t.positioning?"topInset":"translate")})),r.next=4,fr.waitForTransitionEnd({element:l,property:"all",thisObj:t,once:!0});case 4:o.forEach((function(e){return e.classList.remove("b-drag-final-transition")}));case 5:case"end":return r.stop()}}),r)}))()})),function(e){return n.apply(this,arguments)})},{key:"isDragging",get:function(){var e;return Boolean(null===(e=this.context)||void 0===e?void 0:e.started)}},{key:"getMouseMoveEventTarget",value:function(e){return e.isScroll?li.elementFromPoint(e.clientX,e.clientY):e.target}}],[{key:"defaultConfig",get:function(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,target:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:200,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,externalDropTargetSelector:null,testConfig:{clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null,resolveTargetElement:null,disabled:!1}}}]);var n,a,o}(Mn.mixin(_n,(function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"initContainerDrag",value:function(){var e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}},{key:"grabContainerDrag",value:function(e){var t=this;if(!t.ignoreSelector||!e.target.closest(t.ignoreSelector)){var n=li.getAncestor(e.target,t.containers,t.outerElement);if(n){var r=n.getBoundingClientRect();t.context={element:n,position:li.getStyleValue(n,"position"),valid:!0,action:"container",offsetX:e.pageX-r.left,offsetY:e.pageY-r.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}},{key:"startContainerDrag",value:function(e){var t=this,n=t.context,r=t.floatRootOwner,i=n.element,a=i.cloneNode(!0),o=null==r?void 0:r.element.closest(".b-outer");a.classList.add(t.dragProxyCls,t.draggingCls),((null==r?void 0:r.floatRoot)||li.getRootElement(i)).appendChild(a),n.dragProxy=a,n.dragging=i,i.classList.add(t.dropPlaceholderCls),r&&r.element.classList.add("b-dragging-child"),o&&(a.style.zIndex=r.floatRootMaxZIndex+1)}},{key:"onContainerDragStarted",value:function(e){var t=this,n=t.context,r=n.element,i=n.dragProxy,a=r.getBoundingClientRect();if(t.autoSizeClonedTarget)i.style.width=a.width+"px",i.style.height=a.height+"px",li.setTranslateXY(n.dragProxy,a.left,a.top);else if(t.useCenteredCursor){var o=i.getBoundingClientRect();Object.assign(n,{offsetX:o.width/2,offsetY:o.height/2}),li.setTranslateXY(i,e.clientX,e.clientY)}}},{key:"updateContainerDrag",value:function(e){var t,n=this,r=n.context,i=r.targetElement;if(r.started&&i){var a=li.getAncestor(i,n.containers),o=null===(t=r.dragging)||void 0===t?void 0:t.contains(li.getActiveElement(r.dragging));a&&li.isDescendant(r.element,a)||(o&&Wn.suspendFocusEvents(),r.valid&&(a||n.containers.some((function(e){return e.contains(i)})))?(a||(a=n.containers.find((function(e){return e.contains(i)})).lastElementChild),n.moveNextTo(a,e)):n.revertPosition(),o&&Wn.resumeFocusEvents(),e.preventDefault())}}},{key:"finishContainerDrag",value:function(e){var t=this,n=t.context,r=n.dragging,a=n.dragProxy,o=n.valid,l=n.draggedTo,s=n.insertBefore,u=n.originalPosition;r&&(n.valid=Boolean(o&&(l||t.externalDropTargetSelector&&e.target.closest(t.externalDropTargetSelector))&&(r!==s||u.parent!==l)),n.finalize=function(){!(arguments.length>0&&arguments[0]!==i?arguments[0]:n.valid)&&t.context&&t.revertPosition(),r.classList.remove(t.dropPlaceholderCls),a.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async||n.finalize())}},{key:"abortContainerDrag",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.context;a.dragging&&(a.dragging.classList.remove(r.dropPlaceholderCls),a.dragProxy.remove(),r.revertPosition()),n||r.trigger(e?"drop":"abort",{context:a,event:t}),r.reset()}},{key:"updateContainerProxy",value:function(e){var t,n,r,i=this,a=i.context,o=a.dragProxy,l=e.pageX-a.offsetX,s=e.pageY-a.offsetY;if("number"==typeof i.minX&&(l=Math.max(i.minX,l)),"number"==typeof i.maxX&&(l=Math.min(i.maxX-o.offsetWidth,l)),"number"==typeof i.minY&&(s=Math.max(i.minY,s)),"number"==typeof i.maxY&&(s=Math.min(i.maxY-o.offsetHeight,s)),i.lockX?li.setTranslateY(o,s):i.lockY?li.setTranslateX(o,l):li.setTranslateXY(o,l,s),"touchmove"===e.type){var u=e.changedTouches[0];r=li.elementFromPoint(u.clientX,u.clientY)}else r=e.target;a.targetElement=(null===(t=i.resolveTargetElement)||void 0===t?void 0:t.call(i,r))||r,null!==(n=a.targetElement.nextElementSibling)&&void 0!==n&&n.matches(".".concat(i.dropPlaceholderCls))||(a.insertBefore=a.targetElement.nextElementSibling)}},{key:"moveNextTo",value:function(e,t){var n=this.context,r=n.dragging,i=e.parentElement;if(e!==r){var a=pt.from(e).center.x;if(this.isRTL&&t.pageX>a||!this.isRTL&&t.pageX<a){var o=e.previousElementSibling;i.insertBefore(r,e),n.insertBefore=e,o!==r&&this.trigger("itemMove",{context:n,event:t})}else e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,i.insertBefore(r,e.nextElementSibling),this.trigger("itemMove",{context:n,event:t})):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(i.appendChild(r),this.trigger("itemMove",{context:n,event:t}),n.insertBefore=null);n.draggedTo=i}}},{key:"revertPosition",value:function(){var e=this.context,t=e.dragging,n=e.originalPosition,r=n.parent,i=n.next;n.parent===t.parent&&n.prev===t.previousElementSibling&&n.next===t.nextElementSibling||(i?r.insertBefore(t,i):r.appendChild(t),this.trigger("itemMove",{context:e})),e.draggedTo=null}}])}(e||Mn),S(t,"$name","DragHelperContainer"),t}),(function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"initTranslateDrag",value:function(){var e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=function(t){return t.closest(e.targetSelector)})}},{key:"grabTranslateDrag",value:function(e){var t=this.getTarget(e);return!!t&&(this.context={valid:!0,element:t,position:li.getStyleValue(t,"position"),startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}},{key:"getTarget",value:function(e){var t=this.targetSelector,n=this.target;if(t)return e.target.closest(t);var r=n.isWidget?n.element:n;return r.contains(e.target)?r:null}},{key:"getX",value:function(e){return"absolute"===this.positioning?parseFloat(e.style.left,10):"inset"===this.positioning?parseFloat(getComputedStyle(e).insetInlineStart,10):li.getTranslateX(e)}},{key:"getY",value:function(e){return"absolute"===this.positioning?parseFloat(e.style.top,10):"inset"===this.positioning?parseFloat(getComputedStyle(e).top,10):li.getTranslateY(e)}},{key:"getXY",value:function(e){if("absolute"===this.positioning)return[e.offsetLeft,e.offsetTop];if("inset"===this.positioning){var t=getComputedStyle(e);return[parseFloat(t.insetInlineStart,10),parseFloat(t.top,10)]}return li.getTranslateXY(e)}},{key:"setXY",value:function(e,t,n){this.skipUpdatingElement||("absolute"===this.positioning?(e.style.left=t+"px",e.style.top=n+"px"):"inset"===this.positioning?(e.style.insetInlineStart=t+"px",e.style.top=n+"px"):li.setTranslateXY(e,t,n))}},{key:"startTranslateDrag",value:function(e){var t=this,n=t.context,r=t.outerElement,i=t.proxySelector,a=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body,o=n.dragProxy||n.element,l=o,s=o.parentElement;if(t.cloneTarget){var u=i?o.querySelector(i):o,c=pt.from(u,pt.outer(a)),d=c.width,h=c.height,f=c.x,v=c.y;t.isRTL&&o.style.insetInlineStart&&(f=pt.outer(a).right-pt.from(o).right),o=t.createProxy(o);var g=f,m=v;if(t.autoSizeClonedTarget&&(o.style.width="".concat(d,"px"),o.style.height="".concat(h,"px")),o.classList.add(t.dragProxyCls,t.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),a.appendChild(o),!t.autoSizeClonedTarget||i){var p=o.getBoundingClientRect(),y=a.getBoundingClientRect(),k=y.x,b=y.y,C=e.clientX-k,w=e.clientY-b+(a!==document.body?document.body.getBoundingClientRect().y:0);g=C-p.width/2,m=w-p.height/2,n.startPageX=e.pageX,n.startPageY=e.pageY}t.setXY(o,g,m),l.classList.add("b-drag-original"),t.hideOriginalElement&&l.classList.add("b-hidden")}o.classList.add(t.draggingCls);var D=t.getX(o),S=t.getY(o);Object.assign(n,{element:o,grabbed:l,grabbedParent:s,grabbedNextSibling:o.nextElementSibling,elementStartX:D,elementStartY:S,elementX:"inset"===t.positioning?D:li.getOffsetX(o,a||r),elementY:"inset"===t.positioning?S:li.getOffsetY(o,a||r),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||a===r}),a&&(n.parentElement=o.parentElement,a!==o.parentElement&&a.appendChild(o),t.updateTranslateProxy(e))}},{key:"onTranslateDragStarted",value:function(){var e,t=this,n=t.context,r=n.relatedElements;if(t.unifiedProxy&&n.element.classList.add("b-drag-main","b-drag-unified-proxy"),(null===(e=r)||void 0===e?void 0:e.length)>0){n.relatedElStartPos=[],n.relatedElDragFromPos=[];var i=t.proxySelector,a=[n.elementStartX,n.elementStartY],o=a[0],l=a[1];n.originalRelatedElements=r,r=n.relatedElements=r.map((function(e,r){var a=i?e.querySelector(i):e,s=pt.from(a,t.dragWithin),u=s.x,c=s.y,d=s.width,h=s.height,f=t.cloneTarget?t.createProxy(e):e;return f.classList.add(t.draggingCls),f.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(f,u,c),t.dragWithin.appendChild(f),f.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(f.style.width="".concat(d,"px"),f.style.height="".concat(h,"px")),t.hideOriginalElement&&e.classList.add("b-hidden"),e.classList.add("b-drag-original")),n.relatedElStartPos[r]=n.relatedElDragFromPos[r]=t.getXY(f),t.unifiedProxy&&(f.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),o+=t.unifiedOffset,l+=t.unifiedOffset,t.setXY(f,o,l),n.relatedElDragFromPos[r]=[o,l],f.style.zIndex=100-r),f})),t.unifiedProxy&&r&&r.length>0&&fr.onTransitionEnd({element:r[0],property:"transform",handler:function(){r.forEach((function(e){return e.classList.remove("b-drag-unified-animation")}))},thisObj:t,once:!0})}}},{key:"applyConstraints",value:function(e,t,n){var i=this,a=i.constrain,o=i.dragWithin,l=o===document.body?r:Ui,s=l.pageXOffset,u=l.pageYOffset;if(o&&a){var c=new pt(t,n,e.offsetWidth,e.offsetHeight),d=pt.from(o);"fixed"!==i.context.position&&(d.height=o.scrollHeight,d.width=o.scrollWidth,d.moveTo(0,0));var h=c.constrainTo(d);t=h.x,n=h.y}return"number"==typeof i.minX&&(t=Math.max(i.minX+s,t)),"number"==typeof i.maxX&&(t=Math.min(i.maxX+s,t)),"number"==typeof i.minY&&(n=Math.max(i.minY+u,n)),"number"==typeof i.maxY&&(n=Math.min(i.maxY+u,n)),{constrainedX:t,constrainedY:n}}},{key:"updateTranslateProxy",value:function(e,t){var n=this,r=n.lockX,a=n.lockY,o=n.context,l=o.dragProxy||o.element,s=o.relatedElements,u=o.relatedElDragFromPos,c=n.isRTL&&"inset"===n.positioning?-1:1;o.scrollManagerElementContainsDragProxy&&t&&(o.scrollX=t.getRelativeLeftScroll(l),o.scrollY=t.getRelativeTopScroll(l)),o.pageX=e.pageX,o.pageY=e.pageY,o.clientX=e.clientX,o.clientY=e.clientY;var d=o.elementStartX+(e.pageX-o.startPageX+o.scrollX)*c,h=o.elementStartY+e.pageY-o.startPageY+o.scrollY;if(n.snapCoordinates){var f=n.snapCoordinates({element:l,newX:d,newY:h});d=f.x,h=f.y}var v=n.applyConstraints(l,d,h),g=v.constrainedX,m=v.constrainedY;if((o.started||g!==d||m!==h)&&n.setXY(l,r?i:g,a?i:m),s){var p=r?0:g-o.elementStartX,y=a?0:m-o.elementStartY;s.forEach((function(e,t){var r=_(u[t],2),i=r[0],a=r[1];n.setXY(e,i+p,a+y)}))}o.newX=g,o.newY=m}},{key:"finishTranslateDrag",value:(a=f(L().mark((function e(t){var n,r,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).context,a=t.target,o=!n.lockX&&Math.round(r.newX)!==Math.round(r.elementStartX),l=!n.lockY&&Math.round(r.newY)!==Math.round(r.elementStartY),s=r.dragProxy||r.element,u=r.relatedElements,n.ignoreSamePositionDrop&&!o&&!l){e.next=22;break}if(!1!==r.valid){e.next=7;break}return e.next=5,n.abortTranslateDrag(!0,t);case 5:e.next=20;break;case 7:if(!(c=!n.allowDropOutside&&pt.from(n.dragWithin||n.outerElement))||!("number"!=typeof n.minX&&!0!==n.minX&&t.pageX<c.left||"number"!=typeof n.maxX&&!0!==n.maxX&&t.pageX>c.right||"number"!=typeof n.minY&&!0!==n.minY&&t.pageY<c.top||"number"!=typeof n.maxY&&!0!==n.maxY&&t.pageY>c.bottom)){e.next=13;break}return e.next=11,n.abortTranslateDrag(!0,t);case 11:e.next=20;break;case 13:return r.finalize=f((function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:r.valid;return L().mark((function i(){return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!r.finalized){i.next=3;break}return console.warn("DragHelper: Finalizing already finalized drag"),i.abrupt("return");case 3:if(r.finalized=!0,e||!n.context){i.next=7;break}return i.next=7,n.abortTranslateDrag(!0,null,!0);case 7:n.isDestroyed||(n.trigger("dropFinalized",{context:r,event:t,target:a}),n.reset()),n.cloneTarget||s.parentElement===r.grabbedParent||[s].concat(z(u||[])).forEach((function(e){return e.style.transform=""}));case 9:case"end":return i.stop()}}),i)}))()})),r.async=!1,e.next=17,n.trigger("drop",{context:r,event:t,target:a});case 17:if(r.async){e.next=20;break}return e.next=20,r.finalize();case 20:e.next=23;break;case 22:n.abortTranslateDrag(!1,t);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"abortTranslateDrag",value:(n=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=arguments.length>1&&arguments[1]!==i?arguments[1]:null,r=arguments.length>2&&arguments[2]!==i&&arguments[2];return L().mark((function i(a,o){var l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=(l=e).cloneTarget,u=l.context,c=l.proxySelector,d=l.dragWithin,h=l.draggingCls,f=u.relatedElements,v=u.relatedElStartPos,g=u.grabbed,m=u.dragProxy||u.element,u.valid=!1,null===(a=l.scrollManager)||void 0===a||a.stopMonitoring(),!u.aborted){i.next=6;break}return console.warn("DragHelper: Aborting already aborted drag"),i.abrupt("return");case 6:if(p=u.elementStartX,y=u.elementStartY,k=p!==l.getX(m)||y!==l.getY(m),!m||!u.started){i.next=21;break}if(!s&&d&&d!==u.grabbedParent&&u.grabbedParent.insertBefore(m,u.grabbedNextSibling),s&&c&&(b=g.querySelector(c)||g,C=pt.from(b),w=C.x,D=C.y,p=w,y=D),m.classList.add("b-aborting"),l.setXY(m,p,y),null==f||f.forEach((function(e,t){e.classList.remove(h),e.classList.add("b-aborting"),l.setXY(e,v[t][0],v[t][1])})),r||l.trigger(t?"drop":"abort",{context:u,event:n}),!m.isConnected||l.isDestroying||!k){i.next=20;break}if(S="inset"===l.positioning?"inset":"transform",!m.getAnimations().length){i.next=20;break}return i.next=20,fr.waitForTransitionEnd({element:m,property:li.getPropertyTransitionDuration(m,S)?S:"all",thisObj:l,once:!0,timeout:300,runOnDestroy:!0});case 20:l.isDestroyed||l.trigger("abortFinalized",{context:u,event:n});case 21:null!==(o=l.context)&&void 0!==o&&o.started&&l.reset();case 22:case"end":return i.stop()}}),i)}))()})),function(){return n.apply(this,arguments)})},{key:"cleanUp",value:function(){var e,t=this,n=t.context,r=t.cloneTarget,i=t.draggingCls,a=t.dragProxyCls,o=n.dragProxy||n.element,l=n.relatedElements,s=n.originalRelatedElements,u=n.grabbed,c=r&&(t.removeProxyAfterDrop||!n.valid),d=[i,"b-aborting",a,"b-drag-main","b-drag-unified-proxy"];(e=o.classList).remove.apply(e,d),c&&o.remove(),null==l||l.forEach((function(e){var t;c?e.remove():(t=e.classList).remove.apply(t,d)})),u.classList.remove("b-drag-original","b-hidden"),null==s||s.forEach((function(e){return e.classList.remove("b-hidden","b-drag-original")}))}}],[{key:"configurable",get:function(){return{positioning:null,skipUpdatingElement:null}}}]);var n,a}($i(e||Mn)),S(t,"$name","DragHelperTranslate"),t})));Qi._$name="DragHelper";var ea=Array.prototype.slice,ta=Object.freeze([]),na=Object.freeze({}),ra=/[&<]/,ia=Object.getPrototypeOf,aa=Object.prototype.toString,oa=Be.isEqual,la=Be.isObject,sa={parent:1,elementData:1,ns:1,syncOptions:1},ua=function(){return{ignore:sa,refsFound:new o}},ca={class:1,className:1,classname:1},da={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},ha={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1,retainChildren:1},fa=function(){function e(){m(this,e)}return w(e,null,[{key:"checkEquality",value:function(t,n,r,o){if(t===n)return!0;if(null==t)return null==n;if(!t||!n)return!1;var l=W(t);if(l!==W(n)||da[l])return!1;var s,u,c,d,h,f,v=r.equalityCache||(r.equalityCache=new a),g=Boolean(o);if((s=(v=v.get(t)||v.set(t,new a).get(t)).get(n))===i){if(s=!0,ia(t)!==ia(n)||t instanceof Node)s=!1;else if(Array.isArray(t)){if((u=t.length)!==n.length)s=!1;else for(;u-- >0;)if(!e.checkEquality(t[u],n[u],r,g)){s=!1;break}}else{var m;for(h in(d=null===(m=t.syncOptions)||void 0===m?void 0:m.ignoreRefs)&&(g=!0,o="children"!==d),c=r.ignore||na,n)if(!(c[h]||h in t||o&&"reference"===h)){s=!1;break}if(s)if("[object Date]"===aa.call(n))s=t.getTime()===n.getTime();else if(li.isReactElement(t)||li.isReactElement(n)||li.isVueConfig(t)||li.isVueConfig(n))s=!1;else for(h in t)if(!(c[h]||o&&"reference"===h)){if(!(h in n)){s=!1;break}if(f=t[h],!e.checkEquality(f,n[h],r,g)){s=!1;break}}}var p;if(!o&&la(t)&&t.reference)null===(p=r.refsFound)||void 0===p||p.add(t.reference);v.set(n,s)}return s}},{key:"sync",value:function(t){var n,r,i,a,o=t,l=t.refOwner,s=null==l?void 0:l.byRef,u=ua(),c=t.affected;if("string"==typeof c&&(c=[c]),t=F(F({},t),{},{checkEqualityOptions:u}),l){if(l.byRef={},c)for(r in s)c.includes(r)||(l.byRef[r]=s[r]);t.refsWas=s}if(o.changed=e.performSync(t,t.targetElement),l)for(c||(c=Object.keys(s)),n=0;n<c.length;++n){var d,h;if(i=s[r=c[n]],u.refsFound.has(r)||i.retainElement)l.byRef[r]=i;else a=i.lastDomConfig,null===(d=(h=i).blur)||void 0===d||d.call(h),i.remove(),l.detachRef(r,i,a)}return t.targetElement}},{key:"performSync",value:function(t,n){var r=t.domConfig,i=t.callback,a=n.lastDomConfig;return(t.configEquality||e.checkEquality)(r,a,t.checkEqualityOptions,t.ignoreRefs)?(null==i||i({action:"none",domConfig:r,targetElement:n}),!1):(r?(r.onlyChildren||(e.syncAttributes(r,n,t),e.syncContent(r,n)),r.keepChildren||e.syncChildren(t,n)):(n.innerHTML=null,n.syncIdMap=null),n.lastDomConfig=null!=r&&r.onlyChildren&&a?F(F({},a),{},{children:r.children}):r,!0)}},{key:"syncDataset",value:function(e,t){var n,r,i,a,o=t.lastDomConfig,l=e===o,s=Object.keys(e.dataset),u=o&&o.dataset&&Object.keys(o.dataset),c=$e.delta(s,u);for(r=0;r<c.onlyInA.length;r++)n=c.onlyInA[r],null!=(a=e.dataset[n])&&t.setAttribute("data-".concat(Le.hyphenate(n)),a);for(r=0;r<c.inBoth.length;r++)n=c.inBoth[r],a=e.dataset[n],(l||a!=o.dataset[n])&&(i="data-".concat(Le.hyphenate(n)),null==a?t.removeAttribute(i):t.setAttribute(i,a));for(r=0;r<c.onlyInB.length;r++)t.removeAttribute("data-".concat(Le.hyphenate(c.onlyInB[r])))}},{key:"addCls",value:function(e,t){var n=t.lastDomConfig;(e=Ct.normalize(e,"array")).forEach((function(e){t.classList.add(e),function(e,t){var n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){var i=r.split(" ");i.includes(e)||(i.push(e),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)||r.push(e):r.isDomClassList?r.add(e):Be.isObject(r)&&(r[e]=1)}(e,n)}))}},{key:"removeCls",value:function(e,t){var n=t.lastDomConfig;(e=Ct.normalize(e,"array")).forEach((function(e){t.classList.remove(e),function(e,t){var n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){var i=r.split(" ");i.includes(e)&&(i.splice(i.indexOf(e),1),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)&&r.splice(r.indexOf(e),1):r.isDomClassList?r.remove(e):Be.isObject(r)&&delete r[e]}(e,n)}))}},{key:"syncClassList",value:function(e,t,n){var r,i,a,o,l,s,u=e.className||e.class,c=!1;if(n){for(i=Ct.normalize(t,"array"),u=Ct.normalize(u,"object"),s=Ct.normalize(n.className||n.class,"object"),l=[],a=0,o=i.length;a<o;++a)u[r=i[a]]||!(r in s)?(s[r]=1,l.push(r)):c=!0;for(r in u)s[r]||(l.push(r),c=!0);if(!c)return;u=l.join(" ")}else u=Ct.normalize(u);t.setAttribute("class",u)}},{key:"getSyncAttributes",value:function(e){var t={},n=[];return e&&Object.keys(e).forEach((function(r){if(!ha[r]){var i=r.toLowerCase();t[i]=e[r],n.push(i)}})),{attributes:t,names:n}}},{key:"syncAttributes",value:function(t,n,r){var i,a,o=n.lastDomConfig,l=t===o,s=e.getSyncAttributes(t),u=s.attributes,c=s.names,d=l?s:e.getSyncAttributes(o),h=d.attributes,f=d.names,v=l?{onlyInA:ta,onlyInB:ta,inBoth:c}:$e.delta(c,f),g=v.onlyInA,m=v.onlyInB,p=v.inBoth,y=!1;for(a=0;a<g.length;a++){var k=u[i=g[a]];"style"===i&&null!=k?li.applyStyle(n,k,!0):"dataset"===i?e.syncDataset(t,n):ca[i]?(e.syncClassList(t,n),y=!0):null!=k&&n.setAttribute(i,k)}for(a=0;a<p.length;a++){var b=u[i=p[a]],C=h[i];null==b?n.removeAttribute(i):"style"===i?r.strict?l?e.syncStyles(n,b):oa(b,C,!0)||e.syncStyles(n,b,C):!l&&oa(b,C,!0)||li.applyStyle(n,b,!0):"dataset"===i?e.syncDataset(t,n):ca[i]?(e.syncClassList(t,n,r.strict&&n.lastDomConfig),y=!0):(l||b!==C)&&n.setAttribute(i,b)}for(a=0;a<m.length;a++)i=m[a],ca[i]&&y||n.removeAttribute(i)}},{key:"syncStyles",value:function(e,t,n){var r,i,a;if(n){if(r={},t=li.parseStyle(t),n=li.parseStyle(n),t)for(i in t)a=t[i],n[i]!==a&&(r[i]=a);for(i in n)i in t||(r[i]="")}else r=t;li.applyStyle(e,r)}},{key:"syncContent",value:function(e,t){var n=e.html,r=e.text,i=null!=r?r:n;if(t.didSetTextContent=!1,e.elementData&&(t.elementData=e.elementData),i instanceof DocumentFragment)1===t.childNodes.length&&0===li.getChildElementCount(t)&&1===i.childNodes.length&&0===li.getChildElementCount(i)?li.setInnerText(t,i.firstChild.data):(t.innerHTML="",t.appendChild(i));else if(null!=n&&ra.test(n))t.innerHTML=String(n);else if(null!=i){var a,o=t.lastDomConfig;(null!=o&&null!==(a=o.children)&&void 0!==a&&a.length||null!=o&&o.html&&ra.test(t.lastDomConfig.html))&&(t.innerHTML=""),li.setInnerText(t,String(i)),t.didSetTextContent=!0}}},{key:"insertTextNode",value:function(e,t,n,r){var a=arguments.length>4&&arguments[4]!==i?arguments[4]:null,o=document.createTextNode(e);t.insertBefore(o,a),r&&(o.$refOwnerId=r.id),null==n||n({action:"newNode",domConfig:e,targetElement:o})}},{key:"insertElement",value:function(t,n,r,i,a,o,l){var s,u=l.ns?document.createElementNS(l.ns,t.tag||"svg"):document.createElement(t.tag||"div");t.elementData&&(u.elementData=t.elementData),n.insertBefore(u,r),e.performSync(l,u),null!=o&&(a[o]=u),"role"in t||t.tabIndex||t["aria-hidden"]||t.alt||li.isFocusable(u,!0)||u.htmlFor||u.setAttribute("role","presentation"),i&&(u.$refOwnerId=i.id,o&&(u.$reference=o,i.attachRef(o,u,t))),null===(s=l.callback)||void 0===s||s.call(l,{action:"newElement",domConfig:t,targetElement:u,syncId:o})}},{key:"syncChildren",value:function(t,n){var r,i,a,o,l,s=t.domConfig,u=t.syncIdField,c=t.callback,d=t.releaseThreshold,h=t.configEquality,f=t.ns,v=t.refOwner,g=t.refsWas,m=t.strict,p=t.checkEqualityOptions,y=t.ignoreRefs,k=null,b=s.syncOptions||{};if(!(null!==(r=s.html)&&void 0!==r?r:s.text)){(y=Boolean(null!==(i=b.ignoreRefs)&&void 0!==i?i:y))&&(v=g=null),"strict"in b&&(m=b.strict);var C=v?v.byRef:{},w=ea.call(s.children||[]),D=ea.call(n.childNodes),S=g||n.syncIdMap||{},x=n.releasedIdMap||{},E=function(e){for(;D.length&&D[0].parentNode!==n;)D.shift();return(e?D.shift():D[0])||null};u=b.syncIdField||u,m=b.strict||m,c=b.callback||c,h=b.configEquality||h,d="releaseThreshold"in b?b.releaseThreshold:d,u&&(n.syncIdMap=C);for(var R={checkEqualityOptions:p||ua(),ignoreRefs:y,refOwner:v,refsWas:g,strict:m,syncIdField:u,releaseThreshold:d,callback:c,configEquality:h};w.length;){var T=w.shift();if(l=null,T)if(li.isReactElement(T)||li.isVueConfig(T))c({jsx:T,targetElement:n,domConfig:s});else if(Array.isArray(T))this.syncChildren(F(F({},t),{},{domConfig:F(F({},t.domConfig),{},{children:T})}),n);else if(T instanceof Node)T!==(o=E())&&n.insertBefore(T,o),(a=D.indexOf(T))>-1&&D.splice(a,1);else{var M="string"==typeof T;if(R.domConfig=T,R.ns=T.ns||f,!M){if(v?l=T.reference:u&&T.dataset&&(l=T.dataset[u]),null!=l&&!T.unmatched){var A=S[l]||x[l];if(A){var I=A.lastDomConfig;if(A.retainElement&&"prevent-release"!==A.retainElement);else if(e.performSync(R,A)){var L;null===(L=c)||void 0===L||L({action:"reuseOwnElement",domConfig:T,targetElement:A,lastDomConfig:I,syncId:l})}T.retainElement&&(A.retainElement=!0),C[l]=A,$e.remove(D,A),delete x[l],A.isReleased=!1,o=E(),(A.parentNode!==n||m&&A.nextSibling!==o)&&n.insertBefore(A,o)}else m?e.insertElement(T,n,E(),v,C,l,R):(w.push(T),T.unmatched=!0);continue}T.unmatched&&delete T.unmatched}for(var O=null,P=null,_=void 0;!P&&(_=E(!0));){if(v){if(_.$refOwnerId!==v.id)continue;if(_.$reference){if(!m)continue;O=_;break}P=_}else _.retainElement||(P=_);P||(k||(k=[])).push(_)}if(O||!P)M?e.insertTextNode(T,n,c,v,O):e.insertElement(T,n,O,v,C,l,R);else if(M||P.nodeType!==Node.ELEMENT_NODE||(T.tag||"div").toLowerCase()!==P.tagName.toLowerCase())if(M&&P.nodeType===Node.TEXT_NODE)P.data=T;else{var H,B;M?e.insertTextNode(T,n,c,v,P):e.insertElement(T,n,P,v,C,l,R),null===(H=(B=P).blur)||void 0===H||H.call(B),P.remove()}else{var V,N,z=P.lastDomConfig,j=e.performSync(R,P);if(u&&null!=(null==z||null===(V=z.dataset)||void 0===V?void 0:V[u])){var W=z.dataset[u];delete x[W],delete S[W]}null!=l&&(C[l]=P),P.isReleased=!1,j&&(null===(N=c)||void 0===N||N({action:"reuseElement",domConfig:T,targetElement:P,lastDomConfig:z,syncId:l}))}}}if(!(n.didSetTextContent&&1===D.length&&D[0].nodeType===Node.TEXT_NODE||s.retainChildren)){for(;o=E(!0);)v&&(o.$refOwnerId!==v.id||o.$reference)||(k||(k=[])).push(o);k&&e.syncChildrenCleanup(n,k,C,c,v,d,u)}}}},{key:"syncChildrenCleanup",value:function(e,t,n,r,i,a,o){var l,s,u=0,c=D(t);try{for(c.s();!(s=c.n()).done;){var d,h=s.value,f=h.lastDomConfig;if(h.nodeType!==Element.TEXT_NODE)if(h.retainElement)o&&f&&(n[h.dataset[o]]=h);else if(!i&&o&&(null==a||u<a))h.isReleased||(h.className="b-released",h.isReleased=!0,null!=f&&f.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[f.dataset[o]]=h),null==r||r({action:"releaseElement",domConfig:f,lastDomConfig:f,targetElement:h}),f&&(f.isReleased=!0,f.className&&(f.className="b-released"),f.class&&(f.class="b-released"),f.style&&(f.style=null))),u++;else null===(d=h.blur)||void 0===d||d.call(h),h.remove(),i&&(l=h.$reference)&&i.detachRef(l,h,f),e.releasedIdMap&&o&&null!=f&&f.dataset&&delete e.releasedIdMap[f.dataset[o]],null==r||r({action:"removeElement",domConfig:h.lastDomConfig,lastDomConfig:h.lastDomConfig,targetElement:h});else h.remove()}}catch(e){c.e(e)}finally{c.f()}}},{key:"removeChild",value:function(e,t){if(e.contains(t)){var n=e.syncIdMap;if(n){var r=Object.values(n).indexOf(t);r>-1&&delete n[Object.keys(n)[r]]}e.removeChild(t)}}},{key:"addChild",value:function(e,t,n){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[n]=t}},{key:"getChild",value:function(e,t){var n,r=D(String(t).split("."));try{for(r.s();!(n=r.n()).done;){var i,a=n.value;if(!(e=null===(i=e)||void 0===i||null===(i=i.syncIdMap)||void 0===i?void 0:i[a]))return null}}catch(e){r.e(e)}finally{r.f()}return e}}])}();fa._$name="DomSync";var va=function(){function e(){m(this,e)}return w(e,null,[{key:"init",value:function(){var e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=function(t){return e.map((function(e){var n=t+Le.capitalize(e);return"moz"===t&&(n=n.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(n="mozCancelFullScreen")),n}))};this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];var n=["fullscreenchange","fullscreenerror"],r=function(e){return n.map((function(t){return e+Le.capitalize(t)}))};this.events="fullscreenEnabled"in document&&n||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullscreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}},{key:"enabled",get:function(){return Boolean(this.functions[0]&&document[this.functions[0]])}},{key:"request",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.functions[1]&&(null==t?void 0:t[this.functions[1]]()));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"exit",value:(t=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.functions[2]&&document[this.functions[2]]());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isFullscreen",get:function(){return Boolean(this.element)}},{key:"element",get:function(){return this.functions[3]&&document[this.functions[3]]}},{key:"onFullscreenChange",value:function(e){this.events[0]&&document.addEventListener(this.events[0],e)}},{key:"unFullscreenChange",value:function(e){this.events[0]&&document.removeEventListener(this.events[0],e)}},{key:"onInternalFullscreenChange",value:function(t){var n=r.bryntum,i=e.element;if(!(e.isFullscreen&&n._floatRoot||!e.isFullscreen&&!n._floatRoot)){var a,o;if(i){if(!i.closest(".b-floatroot"))(a=li.getRootElement(i).floatRoot)&&(n._floatRoot=a,n._oldParent=a.parentElement,o=i)}else o=(a=n._floatRoot)&&n._oldParent,n._oldParent=n._floatRoot=null;if(o){var l=Array.from(a.querySelectorAll(".b-widget")).map((function(e){return Lo.fromElement(e)}));l.forEach((function(e){var t;return null===(t=e.beforeFloatReparent)||void 0===t?void 0:t.call(e)})),o.appendChild(a),l.forEach((function(e){var t;return null===(t=e.afterFloatReparent)||void 0===t?void 0:t.call(e)}))}Wn.trigger("fullScreenChange",{event:t})}}}]);var t,n}();va.init(),va._$name="Fullscreen";var ga=null,ma=[],pa=function(e){var t;return e.nodeType===e.ELEMENT_NODE&&"absolute"===(null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(e).getPropertyValue("position"))},ya=function(){function e(){m(this,e)}return w(e,null,[{key:"addResizeListener",value:function(e,t){var n=this;if(e!==document&&e!==r||(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)n.hasWindowResizeListener||(r.addEventListener("resize",n.onWindowResize),n.hasWindowResizeListener=!0);else if(r.ResizeObserver)n.resizeObserver||(n.resizeObserver=new ResizeObserver(n.onElementResize)),n.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");var i=_(li.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0}),3),a=i[0],o=i[1],l=i[2];o.scrollLeft=o.scrollTop=l.scrollLeft=l.scrollTop=1e6,o.addEventListener("scroll",n.onSizeMonitorScroll,!0),l.addEventListener("scroll",n.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((function(e){var t,n=[],r=[],i=D(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;"childList"===a.type&&(n.push.apply(n,a.addedNodes),r.push.apply(r,a.removedNodes))}}catch(e){i.e(e)}finally{i.f()}var l=[].concat(z(n.filter((function(e){return!r.includes(e)}))),z(r.filter((function(e){return!n.includes(e)}))));0!==l.length&&(l.length>0&&l.every(pa)||o.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=a}e._bResizemonitor.handlers.push(t)}},{key:"removeResizeListener",value:function(e,t){if(e){e!==document&&e!==r||(e=document.body);var n=e._bResizemonitor,i=0;n&&n.handlers&&($e.remove(n.handlers,t),i=n.handlers.length),i||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}},{key:"onElementResize",value:function(e){var t,n=D(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.target,a=i._bResizemonitor,o=r.contentRect||i.getBoundingClientRect();if(Yr(i)&&(!a.rectangle||o.width!==a.rectangle.width||o.height!==a.rectangle.height)){var l=a.rectangle;a.rectangle=o;var s,u=D(a.handlers);try{for(u.s();!(s=u.n()).done;){(0,s.value)(i,l,o)}}catch(e){u.e(e)}finally{u.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"onSizeMonitorScroll",value:function(t){var n;if(t.target.isConnected||null!==(n=document.body)&&void 0!==n&&n.contains(t.target)){t.stopImmediatePropagation();var r=t.target.parentNode,i=r.parentNode,a=i._bResizemonitor,o=i.getBoundingClientRect();a.rectangle&&o.width===a.rectangle.width&&o.height===a.rectangle.height||(ma.push([i,a.rectangle,o]),a.rectangle=o,ga||(ga=requestAnimationFrame(e.fireResizeEvents))),r.firstChild.scrollLeft=r.firstChild.scrollTop=r.childNodes[1].scrollTop=r.childNodes[1].scrollLeft=1e6}}},{key:"onWindowResize",value:function(e){var t=document.body,n=t._bResizemonitor,r=n.rectangle;n.rectangle=document.documentElement.getBoundingClientRect();var i,a=D(n.handlers);try{for(a.s();!(i=a.n()).done;){(0,i.value)(t,r,n.rectangle)}}catch(e){a.e(e)}finally{a.f()}}},{key:"fireResizeEvents",value:function(){for(var e=0,t=ma;e<t.length;e++){var n,r=t[e],i=D(r[0]._bResizemonitor.handlers);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[0].offsetParent&&a.apply(this,r)}}catch(e){i.e(e)}finally{i.f()}}ga=null,ma.length=0}},{key:"removeGlobalListeners",value:function(){r.removeEventListener("resize",this.onWindowResize)}}])}();ya._$name="ResizeMonitor";var ka=Be.getPathDefault(r,"bryntum.idCounts",Object.create(null)),ba=function(){return w((function e(){m(this,e)}),null,[{key:"generateId",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"generatedId";return e+(ka[e]=(ka[e]||0)+1)}},{key:"reset",value:function(e){ka[e]=0}}])}();ba._$name="IdHelper";var Ca={},wa=function(){return w((function e(){m(this,e)}),null,[{key:"get",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:Ca,n=e._domData||(e._domData={});return t===Ca?n:n[t]}},{key:"remove",value:function(e,t){var n=e._domData,r=null==n?void 0:n[t];return null==n||delete n[t],r}},{key:"set",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:Ca;return n===Ca?e._domData=n=t:(e._domData||(e._domData={}))[t]=n,n}},{key:"assign",value:function(e,t){Object.assign(e._domData||(e._domData={}),t)}}])}();wa._$name="DomDataStore";var Da={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:ne.supportsOverflowClip?"clip":"hidden"},Sa="b-widget-scroller",xa={block:"nearest"},Ea=Promise.resolve(),Ra=function(e){return new Promise((function(t){return fr.on({element:e===document.documentElement?r:e,scroll:t,once:!0})}))},Ta={x:1},Ma={auto:1,scroll:1},Fa={true:1,auto:1},Aa={overflowX:"auto",overflowY:"auto"},Ia={start:"top",end:"bottom"},La={start:"end",end:"start",top:"bottom",bottom:"top"},Oa=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isRTL",get:function(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}},{key:"syncOverflowState",value:function(){var e=this,t=e.hasOverflowX,n=e.hasOverflowY,r=e.element,i=e.hasOverflowX=r.scrollWidth>r.clientWidth,a=e.hasOverflowY=r.scrollHeight>r.clientHeight;if(t!==i||n!==a){var o=new Ct(r.classList,{"b-horizontal-overflow":i,"b-vertical-overflow":a});li.syncClassList(r,o),e.isConfiguring||e.trigger("overflowChange",{x:i,y:a})}}},{key:"hasOverflow",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"y",t=this,n=t["overflow".concat(e.toUpperCase())],r=t["overflow".concat("y"===e?"x":"y")];if(!li.scrollBarWidth||!Fa[n]||"hidden-scroll"===r){var a="y"===e?"Height":"Width";return t["scroll".concat(a)]>t["client".concat(a)]}return t["hasOverflow".concat(e.toUpperCase())]}},{key:"hasScrollbar",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"y",t=this.element;if(t&&li.scrollBarWidth){var n="y"===e,r=n?"Width":"Height",a=t["client".concat(r)],o=parseInt(li.getStyleValue(t,"border".concat(n?"Left":"Top","Width")))+parseInt(li.getStyleValue(t,"border".concat(n?"Right":"Bottom","Width"))),l=t["offset".concat(r)]-o-a;return Math.abs(l-li.scrollBarWidth)<2}}},{key:"addPartner",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:Ta,n=this;"string"==typeof t&&(t=S({},t,1)),n.partners||(n.partners={}),n.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=n.x),t.y&&(e.y=n.y),e.isPartneredWith(n)||e.addPartner(n,t)}},{key:"eachPartner",value:function(e){var t=this.partners;t&&Object.values(t).forEach(e)}},{key:"removePartner",value:function(e){e&&this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}},{key:"isPartneredWith",value:function(e){var t;return Boolean(null===(t=this.partners)||void 0===t?void 0:t[e.id])}},{key:"clearPartners",value:function(){var e=this;this.partners&&Object.values(this.partners).forEach((function(t){return t.scroller.removePartner(e)}))}},{key:"scrollIntoView",value:(a=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:xa;return L().mark((function r(){var i,a,o,l,s,u,c;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=t,a=e.isRectangle,o=a?e:pt.from(e),l=i.getDeltaTo(e,n),s=l.xDelta,u=l.yDelta,c=i.scrollBy(s,u,n),(n.highlight||n.focus)&&c.then((function(){var t,r;e=a?o.translate(-s,-u):null!==(t=null===(r=n.elementAfterScroll)||void 0===r?void 0:r.call(n))&&void 0!==t?t:e,n.highlight&&(isNaN(n.highlight)?(i.widget||i).callback(n.highlight,null,[e]):li.highlight(e,i)),n.focus&&e.focus({preventScroll:!0})})),r.abrupt("return",c);case 3:case"end":return r.stop()}}),r)}))()})),function(e){return a.apply(this,arguments)})},{key:"scrollBy",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:0,t=arguments.length>1&&arguments[1]!==i?arguments[1]:0,n=arguments.length>2&&arguments[2]!==i?arguments[2]:xa,r=this,a="object"===W(n)?n.animate:n,o=Math.abs(e),l=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=n.silent);var s=a&&("number"==typeof a?a:"number"==typeof a.duration?a.duration:300);if(s&&(o>10||l>10)){var u=r.x,c=r.y,d=u,h=c;return Math.max(o,l)<50&&(s=Math.min(s,500)),r.scrollAnimation=Tt.animate(s,(function(i){var a=1===i;if(e){var o;if(Math.abs(r.x-d)>1&&!n.force)return null===(o=r.scrollAnimation)||void 0===o?void 0:o.cancel();r.x=Math.max(u+(a?e:Math.round(e*i)),0)}if(t){var l;if(Math.abs(r.y-h)>1&&!n.force)return null===(l=r.scrollAnimation)||void 0===l?void 0:l.cancel();r.y=Math.max(c+(a?t:Math.round(t*i)),0)}d=r.x,h=r.y}),r,a.easing),r.element.classList.add("b-scrolling"),r.scrollAnimation.then((function(){r.isDestroyed||(r.element.classList.remove("b-scrolling"),r.scrollAnimation=null)})),r.scrollAnimation}if(e||t){var f=r.x,v=r.y;if(Math.round(o)>=1&&(r.x+=e),Math.round(l)>=1&&(r.y+=t),r.x!==f||r.y!==v)return Ra(r.element)}return Ea}},{key:"scrollTo",value:(r=f(L().mark((function e(t,n,r){var i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.x,a=this.y,o=null==t?0:t-i,l=null==n?0:n-a,this.scrollingToCenter=null==r?void 0:r.scrollingToCenter,e.abrupt("return",this.scrollBy(o,l,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"doDestroy",value:function(){var e,n,r=this;r._element&&(r._element.removeEventListener("scroll",r.scrollHandler),null===(n=r.wheelListenerRemover)||void 0===n||n.call(r),r._contentElement&&ya.removeResizeListener(r.contentElement,r.resizeHandler),ya.removeResizeListener(r._element,r.resizeHandler));null===(e=r.scrollAnimation)||void 0===e||e.cancel(),Object.values(r.partners||{}).forEach((function(e){return e.scroller.removePartner(r)})),B(t,"doDestroy",this,3)([])}},{key:"onElMutation",value:function(e){var t=this,n=_(li.getTranslateXY(t.element),2),r=n[0],i=n[1];if(t._x!==-r||t.y!==-i){var a=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(a,"target",{get:function(){return t.element}}),t.onScroll(a)}}},{key:"onElResize",value:function(){var e=this,t=e.widget;null!=t&&t.isAnimating?-1===t.findListener("animationend","onElResize",e)&&t.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}},{key:"onScroll",value:function(e){var t,n=this,r=n.element;null!==(t=n.widget)&&void 0!==t&&t.isDestroyed||(n.positionDirty=!0,r.classList.contains("b-scrolling")||r.classList.add("b-scrolling"),e.widget=n.widget,e.scrollingToCenter=n.scrollingToCenter,n.silent||n.trigger("scroll",e),n.syncPartners(),n.controllingPartner=null,n.onScrollEnd(e))}},{key:"syncPartners",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.propagateSync,n=this;n.partners&&Object.values(n.partners).forEach((function(r){var i=r.axes,a=r.scroller;(a!==n.controllingPartner||e)&&a.sync(n,i)&&t&&a.syncPartners(e,t)}))}},{key:"onScrollEnd",value:function(e){var t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.scrollingToCenter=!1,t.controllingPartner=null,t.element.classList.remove("b-scrolling")}},{key:"getDeltaTo",value:function(e,t){var n=this;if(!n.viewport)return{xDelta:0,yDelta:0};var r=n.x,i=n.y,a=n.scrollWidth,o=n.scrollHeight,l=n.isRTL,s=e instanceof pt?e:pt.from(e),u=t.block||"nearest",c=n.viewport,d=function(e){var t,n,r,i;if(e)if("number"==typeof e)t=n=r=i=e;else{var a,o,l,s;t=null!==(a=e.top)&&void 0!==a?a:0,n=null!==(o=e.bottom)&&void 0!==o?o:0,r=null!==(l=e.start)&&void 0!==l?l:0,i=null!==(s=e.end)&&void 0!==s?s:0}else t=n=r=i=0;return{top:t,bottom:n,start:r,end:i}}(t.edgeOffset);t.maxWidth&&(s.x<c.x?(s.x=s.right-t.maxWidth,d.start=0):(s.width=Math.min(s.width,t.maxWidth),d.end=0)),t.maxHeight&&(s.y<c.y?(s.y=s.bottom-t.maxHeight,d.top=0):(s.height=Math.min(s.height,t.maxHeight),d.bottom=0));var h="start"===u||"end"===u,f=h?S(S({},u,d[u]),La[u],0):c.width>=s.width+(d.start+d.end)?d:{start:0,end:0},v=h?S(S({},Ia[u],d[Ia[u]]),La[Ia[u]],0):c.height>=s.height+(d.top+d.bottom)?d:{top:0,bottom:0},g=new pt(l?c.right+r-a:c.x-r,c.y-i,a,o),m=s.clone().adjust(-f.start,-v.top,f.end,v.bottom,!0).constrainTo(g),p=m.clone(),y=n.isRTL?-1:1,k=0,b=0;if("start"===u)p.moveTo(c.x+(n.isRTL?c.width-p.width:0),c.y),k=m.x-p.x,b=m.y-p.y;else if("end"===u)p.moveTo(c.x+(n.isRTL?0:c.width-p.width),c.bottom-p.height),k=m.x-p.x,b=m.y-p.y;else if("center"===u){var C=c.center;p.moveTo(C.x-p.width/2,C.y-p.height/2),k=k||m.x-p.x,b=b||m.y-p.y}else p.width>c.width?k=p.x-c.x:p.right>c.right?k=p.right-c.right:p.x<c.x&&(k=p.x-c.x),p.height>c.height?b=p.y-c.y:p.bottom>c.bottom?b=p.bottom-c.bottom:p.y<c.y&&(b=p.y-c.y);return k=y*Math.round(k),b=Math.round(b),!1!==t.constrainToScrollable&&(k=Math.max(Math.min(k,Math.max(n.maxX-r,0)),-r),b=Math.max(Math.min(b,Math.max(n.maxY-i,0)),-i)),{xDelta:!1===t.x?0:k,yDelta:!1===t.y?0:b}}},{key:"viewport",get:function(){var e=this,t=this.stickies?$e.asArray(this.stickies).flatMap((function(t){return"string"==typeof t?Array.from(e.element.querySelectorAll(t)):t})):null,n=pt.client(this.element);return t?n.exclude(t.map((function(e){return pt.from(e)}))):n}},{key:"updateWidget",value:function(e){this.rtlSource=this.owner=e}},{key:"updateElement",value:function(e,n){var r=this;if(r===t._globalScroller)return r._element=e,void(r.positionDirty=!0);var i=r.scrollHandler||(r.scrollHandler=r.onScroll.bind(r)),a=r.resizeHandler||(r.resizeHandler=r.onElResize.bind(r));if(n){var o;if(wa.remove(n,"scroller"),r.translate)null===(o=r.mutationObserver)||void 0===o||o.disconnect();else n.removeEventListener("scroll",i),n.classList.remove(Sa),n.style.overflowX=n.style.overflowY="";ya.removeResizeListener(n,a)}if(e){if(wa.set(e,"scroller",r),r.translate){if(r.mutationObserver||(r.mutationObserver=new MutationObserver(r.mutationHandler||(r.mutationHandler=r.onElMutation.bind(r)))),r._x=r._y=0,document.contains(e)){var l=_(li.getTranslateXY(e),2),s=l[0],u=l[1];r._x=-s,r._y=-u}r.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",i),e.classList.add(Sa);ya.addResizeListener(e,a),r.widget||(r.rtlSource={get rtl(){return"rtl"===li.getStyleValue(e,"direction")}}),r.isRTL&&e.classList.add("b-rtl"),r.positionDirty&&(r.updateOverflowX(r.overflowX),r.updateOverflowY(r.overflowY)),r.syncOverflowState(),r.isConfiguring&&(r._x&&r.updateX(r._x),r._y&&r.updateY(r._y))}r.positionDirty=!0}},{key:"unsynced",get:function(){var e=this,t=_(e.xy,2),n=t[0],r=t[1];return e._x!==n||e._y!==r}},{key:"xy",get:function(){var e,t,n=this.element;if(n)if(this.translate){var r=_(li.getTranslateXY(n),2);e=-(e=r[0]),t=-(t=r[1])}else e=Math.abs(n.scrollLeft),t=n.scrollTop;return[e,t]}},{key:"refreshPosition",value:function(){var e=this,t=_(e.xy,2),n=t[0],r=t[1];e._x=n,e._y=r,e.positionDirty=!1}},{key:"fixPositionSync",value:function(){var e=this,t=e.element,n=e.xy,r=e._x,i=e._y;e.positionDirty||r===n[0]&&i===n[1]||(e.translate?(li.setTranslateX(t,-r),li.setTranslateY(t,-i)):t.scrollTo({behavior:"instant",left:e.isRTL?-r:r,top:i}))}},{key:"x",get:function(){return this.positionDirty&&this.refreshPosition(),this._x}},{key:"scrollLeft",get:function(){return this.x*(this.isRTL?-1:1)}},{key:"changeX",value:function(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}},{key:"updateContentElement",value:function(e){e&&(e="string"==typeof e?this.element.querySelector(e):e,ya.addResizeListener(e,this.resizeHandler))}},{key:"updateX",value:function(e){var t,n=this,r=n.behavior,i=n.element;!i||null!==(t=n.widget)&&void 0!==t&&t.isConfiguring||(e=Math.round(e),n.trigger("scrollStart",{x:e}),n.translate?li.setTranslateX(i,-e):r?i.scrollTo({behavior:r,left:n.isRTL?-e:e}):i.scrollLeft=n.isRTL?-e:e),n.positionDirty=!0}},{key:"sync",value:function(e,t){var n=this,r=t.x,i=t.y,a=!1;return r&&n.x!==e.x&&(n.controllingPartner=e,n.x=e.x,a=!0),i&&n.y!==e.y&&(n.controllingPartner=e,n.y=e.y,a=!0),a}},{key:"y",get:function(){return this.positionDirty&&this.refreshPosition(),this._y}},{key:"changeY",value:function(e){if(!this.isConfiguring||e)return e;this._y=e}},{key:"updateY",value:function(e){var t=this,n=t.behavior,r=t.element,i=t.widget;!r||null!=i&&i.isConfiguring||(t.trigger("scrollStart",{y:e}),t.translate?li.setTranslateY(r,-e):n?r.scrollTo({behavior:n,top:e}):r.scrollTop=e),t.positionDirty=!0}},{key:"maxX",get:function(){return this.scrollWidth-this.clientWidth}},{key:"maxY",get:function(){return this.scrollHeight-this.clientHeight}},{key:"lastScrollLeft",get:function(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}},{key:"updateOverflowX",value:function(e,t){var n=this,r=n.element,i=n.translate,a=r.style,o=r.classList;("hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"!==e||i)||(Ma[n.overflowY]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll"));i||(a.overflowX=Da[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}},{key:"updateOverflowY",value:function(e,t){var n=this,r=n.element,i=n.translate,a=r.style,o=r.classList;("hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"!==e||i)||(Ma[n.overflowX]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll"));i||(a.overflowY=Da[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}},{key:"enableWheel",value:function(){this.wheelListenerRemover||(this.wheelListenerRemover=fr.on({element:this.element,wheel:"onWheel",thisObj:this}))}},{key:"onWheel",value:function(e){var t=this,n=t.overflowX,r=t.overflowY,i=e.deltaX,a=e.deltaY,o=Math.abs(i)-Math.abs(a);"hidden-scroll"===n&&Ma[r]&&o>0?t.x+=i:"hidden-scroll"===r&&Ma[n]&&o<0&&(t.y+=a)}},{key:"scrollWidth",get:function(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollWidth)&&void 0!==e?e:0},set:function(e){var t=this,n=t.element,r=t.isRTL,i=t.widthStretcher;i&&null==e?(i.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),i||(i=t.widthStretcher=li.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",role:null,retainElement:!0})),i.style.transform="translateX(".concat((e-1)*(r?-1:1),"px)"),n&&!n.contains(i)&&n.insertBefore(i,n.firstElementChild)),n.style.setProperty("--scroll-width",li.setLength(e)),!1!==t.propagate&&t.eachPartner((function(t){var n=t.scroller;n.propagate=!1,n.scrollWidth=e,delete n.propagate})),t.positionDirty=!0,t.syncOverflowState()}},{key:"scrollHeight",get:function(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollHeight)&&void 0!==e?e:0},set:function(e){var t=this,n=t.stretcher||(t.stretcher=li.createElement({className:"b-scroller-stretcher",role:null}));n.style.transform="translateY(".concat(e-1,"px)"),t.element&&t.element.lastChild!==n&&t.element.appendChild(n),t.positionDirty=!0,t.syncOverflowState()}},{key:"clientWidth",get:function(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientWidth)||0}},{key:"clientHeight",get:function(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientHeight)||0}},{key:"id",get:function(){return this._id||(this._id=ba.generateId(this.widget?"".concat(this.widget.id,"-"):"scroller-")),this._id}},{key:"preProcessCurrentConfigs",value:function(e){B(t,"preProcessCurrentConfigs",this,3)([]),delete e.widget,delete e.element}}],[{key:"configurable",get:function(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,behavior:null,x:0,y:0,rtlSource:null,propagateSync:null,stickies:null}}},{key:"delayable",get:function(){return{onScrollEnd:{type:"buffer",delay:100}}}},{key:"scrollIntoView",value:(n=f((function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:xa,r=arguments.length>2&&arguments[2]!==i&&arguments[2];return L().mark((function i(){var a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,S,x,E,R,T;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:a=pt.from(e),o="object"===W(n)?n.animate:n,l=t._globalScroller||(t._globalScroller=new t),s=[],l.rtlSource={rtl:r},u=0,c=0,n.maxWidth&&(a.width=Math.min(a.width,n.maxWidth),n.maxWidth=null),n.maxHeight&&(a.height=Math.min(a.height,n.maxHeight),n.maxHeight=null),h=e.parentNode;case 6:if(h.nodeType!==Node.ELEMENT_NODE){i.next=14;break}if(h!==document.body||h===document.scrollingElement){i.next=9;break}return i.abrupt("continue",11);case 9:f=h===document.scrollingElement?Aa:h.ownerDocument.defaultView.getComputedStyle(h),v=wa.get(h,"scroller"),(!1!==n.y&&(null!=v&&v.hasOverflowY||Ma[f.overflowY]&&h.scrollHeight>h.clientHeight)||!1!==n.x&&(null!=v&&v.hasOverflowX||Ma[f.overflowX]&&h.scrollWidth>h.clientWidth))&&(g=l,v?g=v:(l.element=h,l.positionDirty=!0),m=g.getDeltaTo(a,n),p=m.xDelta,y=m.yDelta,(p||y)&&(s.push({element:h,x:h.scrollLeft,y:h.scrollTop,xDelta:p,yDelta:y}),a.translate(-p,-y),u+=p,c+=y));case 11:h=h.parentNode,i.next=6;break;case 14:if(s.length)if(k=Math.abs(u),b=Math.abs(c),(C=o&&("number"==typeof o?o:"number"==typeof o.duration?o.duration:300))&&(k>10||b>10))Math.max(k,b)<50&&(C=Math.min(C,500)),(d=l.scrollAnimation=Tt.animate(C,(function(e){var t,n=1===e,i=D(s);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.element,u=a.x,c=a.y,d=a.xDelta,h=a.yDelta;l.element=o,d&&(l.x=Math[r?"min":"max"](u+(n?d:Math.round(d*e)),0)),h&&(l.y=Math.max(c+(n?h:Math.round(h*e)),0))}}catch(e){i.e(e)}finally{i.f()}}),null,o.easing)).then((function(){l.scrollAnimation=null}));else if(k>=1||b>=1){w=D(s);try{for(w.s();!(S=w.n()).done;)x=S.value,E=x.element,R=x.xDelta,T=x.yDelta,E.scrollTop+=T,E.scrollLeft+=R}catch(e){w.e(e)}finally{w.f()}d=Ra(s[s.length-1].element)}if(!n.highlight&&!n.focus){i.next=20;break}return i.next=18,d;case 18:n.highlight&&(isNaN(n.highlight)?l.callback(n.highlight,null,[e]):li.highlight(e,l)),n.focus&&e.focus({preventScroll:!0});case 20:return i.abrupt("return",d);case 21:case"end":return i.stop()}}),i)}))()})),function(e){return n.apply(this,arguments)})}]);var n,r,a}($i(_n(Mn)));Oa._$name="Scroller";var Pa=function(){function e(){m(this,e)}return w(e,null,[{key:"mergeLocales",value:function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){Object.keys(t).forEach((function(n){"object"===W(t[n])?e[n]=F(F({},e[n]),t[n]):e[n]=t[n]}))})),e}},{key:"trimLocale",value:function(e,t){var n=function(t,n){e[t]&&(n?e[t][n]&&delete e[t][n]:delete e[t])};Object.keys(t).forEach((function(e){Object.keys(t[e]).length>0?Object.keys(t[e]).forEach((function(t){return n(e,t)})):n(e)}))}},{key:"normalizeLocale",value:function(e,t){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if("string"==typeof e){if(!t)throw new Error('"config" parameter can not be empty');t.locale?t.name=e||t.name:t.localeName=e}else t=e;var n={};if(t.name||t.locale)n=Object.assign({localeName:t.name},t.locale),t.desc&&(n.localeDesc=t.desc),t.code&&(n.localeCode=t.code),t.path&&(n.localePath=t.path);else{if(!t.localeName)throw new Error('"config" parameter doesn\'t have "localeName" property');n=Object.assign({},t)}for(var r=0,i=["name","desc","code","path"];r<i.length;r++){var a=i[r];n[a]&&delete n[a]}if(!n.localeName)throw new Error("Locale name can not be empty");return n}},{key:"locales",get:function(){return e.global.bryntum.locales||{}},set:function(t){e.global.bryntum.locales=t}},{key:"localeName",get:function(){return e.global.bryntum.locale||"En"},set:function(t){e.global.bryntum.locale=t||e.localeName}},{key:"locale",get:function(){return e.localeName&&this.locales[e.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}},{key:"publishLocale",value:function(t,n){var r=e.global.bryntum.locales,i=e.normalizeLocale(t,n),a=i.localeName;return r[a]&&!0!==n?r[a]=this.mergeLocales(r[a]||{},i||{}):r[a]=i,r[a]}},{key:"global",get:function(){return r}}])}();S(Pa,"skipLocaleIntegrityCheck",!1),Pa.global.bryntum=Pa.global.bryntum||{},Pa.global.bryntum.locales=Pa.global.bryntum.locales||{},Pa._$name="LocaleHelper";Pa.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week",None:"None",previous:"Previous",next:"Next",to:"to",at:"At",on:"On",editing:function(e){return"Editing ".concat(e)},settings:"Settings",close:"Close",go:"Go",save:"Save",cancel:"Cancel",revert:"Revert"},CheckboxGroup:{wrongNbrOfOptionsSelected:function(e){return"Select exactly ".concat(e)},tooFewOptionsSelected:function(e){return"Select at least ".concat(e)},tooManyOptionsSelected:function(e){return"Select no more than ".concat(e)}},CodeEditor:{apply:"Apply",autoApply:"Auto apply",downloadCode:"Download code",editor:"Code editor",viewer:"Code viewer"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:function(e){return"Add ".concat(e)}},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:function(e){return"Value must be less than or equal to ".concat(e.max)},rangeUnderflow:function(e){return"Value must be greater than or equal to ".concat(e.min)},stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:function(e){return"Invalid date input, expected format is "+e}},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},Hint:{dontShowAgain:"Don't show again"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:function(e){return"of ".concat(e.lastPage)},summaryTemplate:function(e){return"Displaying records ".concat(e.start," - ").concat(e.end," of ").concat(e.allCount)}},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},TabPanel:{containsInvalidFields:"Tab contains invalid fields"},Toolbar:{showOverflowingItems:"Show overflowing items",scrollForMore:"Scroll for more"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater or equals",isLessThanOrEqualTo:"less or equals",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",timeEquals:"time equals",timeDoesNotEqual:"time does not equal",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select property",selectAnOperator:"Select operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectValue:"Select value",selectOneOrMoreValues:"Select value(s)",enterAValue:"Enter value",enterANumber:"Enter number",selectADate:"Select date",selectATime:"Select time"},FieldFilterPickerGroup:{addFilter:"Add filter",applyCond:function(e){return e?"Skip filter (currently applied)":"Apply filter (currently skipped)"}},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"emillisecond",plural:"ems",abbrev:"ems"},{single:"second",plural:"seconds",abbrev:"s"},{single:"esecond",plural:"eseconds",abbrev:"es"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"eminute",plural:"eminutes",abbrev:"emin"},{single:"hour",plural:"hours",abbrev:"h"},{single:"ehour",plural:"ehours",abbrev:"eh"},{single:"day",plural:"days",abbrev:"d"},{single:"eday",plural:"edays",abbrev:"ed"},{single:"week",plural:"weeks",abbrev:"w"},{single:"eweek",plural:"eweeks",abbrev:"ew"},{single:"month",plural:"months",abbrev:"mon"},{single:"emonth",plural:"emonths",abbrev:"emon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"equarter",plural:"equarters",abbrev:"eq"},{single:"year",plural:"years",abbrev:"yr"},{single:"eyear",plural:"eyears",abbrev:"eyr"},{single:"decade",plural:"decades",abbrev:"dec"},{single:"edecade",plural:"edecades",abbrev:"edec"}],unitAbbreviations:[["mil"],["emil"],["s","sec"],["es","esec"],["m","min"],["em","emin"],["h","hr"],["eh","ehr"],["d"],["ed"],["w","wk"],["ew","ewk"],["mo","mon","mnt","M"],["emo","emon","emnt"],["q","quar","qrt"],["eq","equar","eqrt"],["y","yr"],["ey","eyr"],["dec"],["edec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:function(e){var t="th";["11","12","13"].find((function(t){return e.endsWith(t)}))||(t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th");return e+t},decade:function(e){var t="number"==typeof e?e:e.getFullYear();return"".concat(t-t%10,"s")}}});var _a=/^(\w+)=(.*)$/,Ha=function(e){var t,n={},r=D(e.split("&"));try{for(r.s();!(t=r.n()).done;){var i=t.value,a=_(_a.exec(i),3),o=a[0],l=a[1],s=a[2],u=decodeURIComponent(l),c=decodeURIComponent(s);if(o){var d=n[u];d?(Array.isArray(d)||(d=n[u]=[d]),d.push(c)):n[u]=c}}}catch(e){r.e(e)}finally{r.f()}return n},Ba=function(){function e(){m(this,e)}return w(e,null,[{key:"get",value:function(e,t){return this.fetch(e,t)}},{key:"post",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:{};return n=pe.assign({},n),t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},n))}},{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t,n){var r;if(n=pe.merge({},e.DEFAULT_FETCH_OPTIONS,n),"undefined"!=typeof AbortController&&(r=n.abortController=new AbortController,n.signal=r.signal),n.queryParams){var i=Object.entries(n.queryParams);if(i.length){var a=!1;if(n.headers&&!0===n.addQueryParamsToBody){var o;switch(new Headers(n.headers).get("Content-Type")){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData}if(o){var l=n.body||(n.body=new o);l instanceof o&&(i.forEach((function(e){var t=_(e,2),n=t[0],r=t[1];return l.set(n,r)})),a=!0)}}a||(t+=(t.includes("?")?"&":"?")+i.map((function(e){var t=_(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(encodeURIComponent(r))})).join("&"))}}var s=new Promise((function(e,r){fetch(t,n).then((function(t){n.parseJson?t.json().then((function(n){t.parsedJson=n,e(t)})).catch((function(e){t.parsedJson=null,t.error=e,r(t)})):e(t)})).catch((function(e){e.stack=s.stack,r(e)}))}));return s.stack=(new Error).stack,s.abort=function(){var e;null===(e=r)||void 0===e||e.abort(new DOMException("User aborted request","AbortError")),this.aborted=!0},s}))},{key:"mockUrl",value:function(t,n){var r=this;(r.mockAjaxMap||(r.mockAjaxMap={}))[t]=n,e.originalFetch||(e.originalFetch=e.fetch,e.fetch=r.mockAjaxFetch.bind(r))}},{key:"mockAjaxFetch",value:(t=f(L().mark((function t(n,r){var i,a,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.split("?"),a=this.mockAjaxMap[i[0]],o=null,!a){t.next=12;break}if("function"!=typeof a){t.next=7;break}return t.next=6,a(i[0],i[1]&&Ha(i[1]),r);case 6:a=t.sent;case 7:try{o=(null==r?void 0:r.parseJson)&&JSON.parse(a.responseText)}catch(e){o=null,a.error=e}return a=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:n,parsedJson:o,text:function(){return new Promise((function(e){e(a.responseText)}))},json:function(){return new Promise((function(e){e(o)}))}},a),t.abrupt("return",new Promise((function(e,t){a.synchronous?e(a):setTimeout((function(){e(a)}),"delay"in a?a.delay:100)})));case 12:return t.abrupt("return",e.originalFetch(n,r));case 13:case"end":return t.stop()}}),t,this)}))),function(e,n){return t.apply(this,arguments)})}]);var t}();S(Ba,"DEFAULT_FETCH_OPTIONS",{}),Ba._$name="AjaxHelper";var Va=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(B(t,"construct",this,3)(r),ne.isBrowserEnv){var a,o=document.querySelector("script[data-default-locale]");o?e.applyLocale(o.dataset.defaultLocale):null!==(a=e.locale)&&void 0!==a&&a.localeName&&e.applyLocale(e.locale.localeName)}}},{key:"locales",get:function(){return Pa.locales},set:function(e){Pa.locales=e}},{key:"locale",get:function(){return Pa.locale},set:function(e){this.applyLocale(e)}},{key:"localeCode",get:function(){var e,t;return null!==(e=null===(t=this.locale)||void 0===t?void 0:t.localeCode)&&void 0!==e?e:"en-US"}},{key:"applyLocale",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this;if("string"==typeof e)if("object"!==W(t)){if(!(n=a.locales[e])){if(r)return!0;throw new Error('Locale "'.concat(e,'" is not published. Publish with LocaleHelper.publishLocale() before applying.'))}}else n=Pa.publishLocale(e,t);else n=Pa.publishLocale(e);if(a.locale.localeName&&a.locale.localeName===n.localeName&&!0!==t)return a.locale;n.oldLocaleName=a.locale.localeName,n.oldLocaleCode=a.locale.localeCode,Pa.localeName=n.localeName;var o=function(){a.trigger("locale",n)};return n.localePath?new Promise((function(e,t){a.loadLocale(n.localePath).then((function(t){t.text().then((function(t){new Function(t)(),ne.isBrowserEnv&&(n=a.locales[n.localeName])&&delete n.localePath,o(),e(n)}))})).catch((function(e){return t(e)}))})):(o(),n)}},{key:"loadLocale",value:function(e){return Ba.get(e)}},{key:"throwOnMissingLocale",get:function(){return this._throwOnMissingLocale},set:function(e){this._throwOnMissingLocale=e}}],[{key:"defaultConfig",get:function(){return{throwOnMissingLocale:Ne.isTestEnv}}}])}(_n(Mn)),Na=new Va,za=Object.getPrototypeOf(Object),ja=/L{.*?}/g,Wa=/L{(.*?)}/g,$a=/((.*?)\.)?(.+)/g,Ua=function(e){return e.replace(/\[\[(\d+)]]/gm,"{$1}")},Ga=Object.freeze(Object.create(null)),Ya=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];B(t,"construct",this,3)([e].concat(r)),Na.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}},{key:"localeClass",get:function(){return this._localeClass||null}},{key:"localizeProperty",value:function(e){var n,r,a,o=this,l=pe.getPath(o,e),s=(null===(n=o.$meta.configs[e])||void 0===n?void 0:n.localeKey)||(null===(r=o.fieldMap)||void 0===r||null===(r=r[e])||void 0===r?void 0:r.defaultValue);if(s){if(!(a=t.localize(s,o,o.localeClass||o))||e in(o.initialConfig||Ga)||e in(o.originalData||Ga))return l;pe.setPath(o.isColumn?o.data:o,e,a)}else"string"==typeof l&&(o.originalLocales=o.originalLocales||{},(a=pe.getPath(o.originalLocales,e))===i&&(pe.setPath(o.originalLocales,e,l),a=l),a&&pe.setPath(o,e,a=o.optionalL(a,o)));return a||l}},{key:"updateLocalization",value:function(){var e,t;!1!==this.localizable&&(null===(e=this.localizableProperties)||void 0===e||e.forEach(this.localizeProperty,this),null===(t=this.trigger)||void 0===t||t.call(this,"localized"))}},{key:"L",value:function(e,n){var r=arguments.length>2&&arguments[2]!==i?arguments[2]:this.localeClass,a=this.constructor;return r&&t.clsName(r)!==t.clsName(a)?t.L(e,n,r,a):t.L(e,n,a)}},{key:"optionalL",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this,n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=Na.throwOnMissingLocale;Na.throwOnMissingLocale=r&&ja.test(e)&&!n;var a=this.L(e,t);return Na.throwOnMissingLocale=r,a}},{key:"localeManager",get:function(){return Na}},{key:"localeHelper",get:function(){return Pa}}],[{key:"configurable",get:function(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}},{key:"clsName",value:function(e){var t,n;return"string"==typeof e?e:e===za?"Object":e.$$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$$name)||(null===(n=e.prototype)||void 0===n?void 0:n.name)}},{key:"parseLocaleString",value:function(e){var t,n,r=[];if(null!==(t=e)&&void 0!==t&&t.includes("L{"))for(e=e.replace(/{(\d+)}/gm,"[[$1]]"),Wa.lastIndex=0;null!=(n=Wa.exec(e));){$a.lastIndex=0;var a=$a.exec(n[1]);r.push({match:Ua(n[0]),localeKey:Ua(a[3]),localeClass:a[2]})}return r.length>0?r:[{match:e,localeKey:e,localeClass:i}]}},{key:"getTranslation",value:function(e,n,r){var i,a,o=this,l=Na.locale,s=null;if(l){var u,c=D(this.parseLocaleString(e));try{var d=function(){var c=u.value,d=c.match,h=c.localeKey,f=c.localeClass,v=function(t){var i,a=null===(i=l[t])||void 0===i?void 0:i[h];return a&&(s="function"==typeof a?null!=n?a(n):a:"object"===W(a)||e===d?a:(s||e).replace(d,a),"string"==typeof a&&a.includes("L{")&&(s=o.getTranslation(a,n,r))),a},g=!1;for(a=r;a&&(i=t.clsName(a))&&!(g=v(i))&&"string"!=typeof a;a=Object.getPrototypeOf(a));!g&&f&&v(f)};for(c.s();!(u=c.n()).done;)d()}catch(e){c.e(e)}finally{c.f()}}return s}},{key:"localize",value:function(e){for(var n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:i,a=arguments.length,o=new Array(a>2?a-2:0),l=2;l<a;l++)o[l-2]=arguments[l];0===(null===(n=o)||void 0===n?void 0:n.length)&&(o=[this]);var s=null;return o.some((function(n){return null!=(s=t.getTranslation(e,r,n))})),s}},{key:"L",value:function(e){for(var n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:i,a=arguments.length,o=new Array(a>2?a-2:0),l=2;l<a;l++)o[l-2]=arguments[l];0===(null===(n=o)||void 0===n?void 0:n.length)&&(o=[this]);var s=this.localize.apply(this,[e,r].concat(z(o)));if(null==s&&Na.throwOnMissingLocale&&e.includes("L{"))throw new Error("Localization is not found for '".concat(e,"' in '").concat(o.map((function(e){return t.clsName(e)})).join(", "),"'. ").concat(Na.locale.localeName?"Locale : ".concat(Na.locale.localeName):""));return null!=s?s:e}},{key:"optionalL",value:function(e){for(var n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:i,a=arguments.length,o=new Array(a>2?a-2:0),l=2;l<a;l++)o[l-2]=arguments[l];var s=Na.throwOnMissingLocale;Na.throwOnMissingLocale=s&&ja.test(e),0===(null===(n=o)||void 0===n?void 0:n.length)&&(o=[this]);var u=t.L.apply(t,[e,r].concat(z(o)));return Na.throwOnMissingLocale=s,u}}])}(e||Mn),S(t,"$name","Localizable"),t},qa=Reflect.defineProperty,Ka=Symbol("owner"),Xa=/[\s,]+/,Za=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"declarable",get:function(){return["factoryable","alias","type"]}},{key:"register",value:function(e,t){for(var n,a,o,l=arguments.length>2&&arguments[2]!==i?arguments[2]:r.__BRYNTUM_EXAMPLE||(null===(n=r.DocsBrowser)||void 0===n?void 0:n.isDocsBrowser),s=this.initClass().factoryable,u=s.caseless,c=s.registry,d=Le.split(e,Xa),h=0;h<d.length;++h){if(o=d[h],a=u?o.toLowerCase():o,!l&&a in c)throw new Error('Type "'.concat(o,'" already registered with ').concat(s.class.name," factory"));c[o]=c[a]=t.initClass()}}},{key:"isA",value:function(e,t){return this.isType(e,t,!0)}},{key:"isType",value:function(e,t,n){var r=this.factoryable,i=r.caseless,a=r.registry[i?t.toLowerCase():t];return!!a&&(n?e instanceof a:e.constructor===a)}},{key:"setupAlias",value:function(e){e.register(e.alias,e)}},{key:"setupFactoryable",value:function(e,t){var n=t.super.class,r=e.factoryable;(r=F({caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type"},r)).class=e,r.registry=Object.create(null),r.extends&&!Array.isArray(r.extends)&&(r.extends=[r.extends]),qa(e,"factoryable",{get:function(){return r}})}},{key:"setupType",value:function(e,t){var n=e.type;e.register(n,e,t.replaceType),qa(e.prototype,"type",{get:function(){return n},set:function(e){if(e!==n)throw new Error("Can not mutate `type` config to different value")}})}},{key:"create",value:function(e,t){return this.reconfigure(null,e,t)}},{key:"reconfigure",value:function(e,t,n){var r,i,a,o,l,s,u,c,d,h=this,f=h.factoryable,v=f.typeKey,g=n;if(n&&!Be.isClass(n)&&(g=null,"function"===(u=W(n))?s=n:"string"===u?g=n:Be.isObject(n)?(r=n.cleanup,i=n.defaults,o=n.owner,s=n.setup,g=n.type,c=n.transform):o=n),c&&(t="string"==typeof c?o[c](t):c(t)),"string"==typeof(d=t))t={};else if(t){if(!0===t&&(t={}),!Be.isObject(t)){var m;if(o&&t!==e&&(null==e?void 0:e[Ka])===o)"string"==typeof r?o[r](e):null===(m=r)||void 0===m||m(e),e.destroy();return t}d=t[v]}if(d=d&&h.resolveType(d),e){if(t&&(!d||e.constructor===d))return v in t&&delete(t=Be.assign({},t))[v],e.setConfig(t),e;var p;if(o&&e[Ka]===o)"string"==typeof r?o[r](e):null===(p=r)||void 0===p||p(e),e.destroy()}if(t){if(i){if(!(a=d)){if(!(a=i[v]||g||f.defaultType))throw new Error("No default mergeType defined for ".concat(f.class.name," factory"));a=h.resolveType(a)}a&&(t=a.mergeConfigs(i,t))}if(s){if(null===(l="string"==typeof s?o[s](t,d,i):s(t,d,i)))return l;t=l||t}if(!d){if(!(d=t[v]||g||f.defaultType))throw new Error("No default type defined for ".concat(f.class.name," factory"));d=h.resolveType(d)}i&&!a&&(t=d.mergeConfigs(i,t)),v in t&&delete(t=Be.assign({},t))[v],t=new d(t),o&&(t[Ka]=o)}return t||null}},{key:"resolveType",value:function(e,t){if("string"!=typeof e)return e;var n,r=this.factoryable,i=r.extends,a=r.registry[r.caseless?e.toLowerCase():e];for(n=0;!a&&i&&n<i.length;++n)a=i[n].resolveType(e,!0);if(!a&&!t)throw new Error('Invalid type name "'.concat(e,'" passed to ').concat(r.class.name," factory"));return a}}])}(e||Mn),S(t,"$name","Factoryable"),t},Ja=Be.getPathDefault(r,"bryntum.idCounts",Object.create(null)),Qa={string:1,number:1},eo=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){this.constructor.unregisterInstance(this),B(t,"doDestroy",this,3)([])}},{key:"changeId",value:function(e){return(this.hasGeneratedId=!e)?this.generateAutoId():e}},{key:"updateId",value:function(e,t){var n=this,r=n.constructor;t&&r.unregisterInstance(n,t),n.hasGeneratedId&&!1===r.identifiable.registerGeneratedId||r.registerInstance(n,e)}},{key:"generateAutoId",value:function(){return this.constructor.generateId("b-".concat(this.$$name.toLowerCase(),"-"))}}],[{key:"declarable",get:function(){return["identifiable"]}},{key:"configurable",get:function(){return{id:""}}},{key:"setupIdentifiable",value:function(e,t){var n=e.identifiable;n.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get:function(){return n}})}},{key:"all",get:function(){return Object.values(this.identifiable.idMap)}},{key:"generateId",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"generatedId";return e+(Ja[e]=(Ja[e]||0)+1)}},{key:"registerInstance",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e.id,n=this.identifiable.idMap;if(t in n&&!this.disableThrow)throw new Error("Id "+t+" already in use");n[t]=e}},{key:"unregisterInstance",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e.id,n=this.identifiable.idMap;Qa[W(e)]?delete n[e]:n[t]===e&&delete n[t]}},{key:"getById",value:function(e){var t=this.identifiable.idMap;if(t)return t[e]}},{key:"registeredInstances",get:function(){var e=this.identifiable.idMap;return e?Object.values(e):[]}}])}(e||Mn),S(t,"$name","Identifiable"),t},to=/\/[^/]+\//,no={},ro=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"widgetClass",get:function(){}},{key:"keyMapElement",get:function(){return this.element}},{key:"keyMapSubComponents",get:function(){return this.features}},{key:"addKeyBinding",value:function(e,t){var n=this.keyMap,r=this.mergeKeyMaps(S({},e,null==n?void 0:n[e]),S({},e,t))[e];n?n[e]=r:this.keyMap=S({},e,r)}},{key:"removeKeyBinding",value:function(e,t){var n,r=null===(n=this.keyMap)||void 0===n?void 0:n[e];if(r){var i=0;Array.isArray(r)?(i=r.findIndex((function(e){return e===t||e.handler===t})))>-1&&r.splice(i,1):r!==t&&r.handler!==t||delete this.keyMap[e]}}},{key:"matchKeyMapEntry",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.keyMap,n=this.input,r=e.altKey,a=e.ctrlKey,o=e.metaKey,l=e.shiftKey,s=e.target;return!(1!==e.key.length||r||a||o||l||n&&e.composedPath().includes(n)||!li.isEditable(s,!0))||(t&&!e.handled&&e.key!==i?Be.keys(t).find((function(t){var n="+"===t?[]:t.toLowerCase().split("+"),i=t.endsWith("+")?"+":n.pop(),s="space"===i?" ":i,u=n.includes("alt"),c=n.includes("ctrl"),d=n.includes("meta"),h=n.includes("shift"),f=to.test(s)&&(no[s]||(no[s]=new RegExp(s.substring(1,s.length-1))));return(f?f.test(e.key.toLowerCase()):s===e.key.toLowerCase())&&(u?r:!r)&&(c?a:!a)&&(d?o:!o)&&(h?l:!l)})):void 0)}},{key:"performKeyMapAction",value:(n=f(L().mark((function e(t){var n,r,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,S;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).keyMap,a=!1,!r||t.handled||t.key===i){e.next=72;break}if(c=n.matchKeyMapEntry(t),!r[c]){e.next=46;break}d=$e.asArray(r[c]),t.fromKeyMap=!0,t.widget=this,h=D(d),e.prev=9,h.s();case 11:if((f=h.n()).done){e.next=37;break}if(o=f.value,u=!0,!Be.isObject(o)){e.next=19;break}if(o.handler){e.next=17;break}return e.abrupt("continue",35);case 17:!1===o.preventDefault&&(u=!1),o=o.handler;case 19:if("string"!=typeof o){e.next=32;break}if(g=n.resolveKeyMapAction(o),m=g.thisObj,p=g.handler,!1===(null===(v=m.isActionAvailable)||void 0===v?void 0:v.call(m,{key:c,action:o,event:t,actionName:o.split(".").pop()}))){e.next=30;break}if(y=p.call(m,t),!Be.isPromise(y)){e.next=27;break}return e.next=26,y;case 26:y=e.sent;case 27:if(!1===y){e.next=30;break}return a=!0,e.abrupt("break",37);case 30:e.next=35;break;case 32:if(!1===o.call(n,t)){e.next=35;break}return a=!0,e.abrupt("break",37);case 35:e.next=11;break;case 37:e.next=42;break;case 39:e.prev=39,e.t0=e.catch(9),h.e(e.t0);case 42:return e.prev=42,h.f(),e.finish(42);case 45:a&&(u&&t.preventDefault(),t.handled=!0);case 46:if(a){e.next=72;break}if(!(s=Be.getTruthyKeys(r.delegate))){e.next=71;break}k=D(s),e.prev=49,k.s();case 51:if((b=k.n()).done){e.next=63;break}if(l=b.value,l=Be.getPath(n,l),a=null===(C=l)||void 0===C||null===(w=C.performKeyMapAction)||void 0===w?void 0:w.call(C,t),!Be.isPromise(a)){e.next=59;break}return e.next=58,a;case 58:a=e.sent;case 59:if(!a){e.next=61;break}return e.abrupt("break",63);case 61:e.next=51;break;case 63:e.next=68;break;case 65:e.prev=65,e.t1=e.catch(49),k.e(e.t1);case 68:return e.prev=68,k.f(),e.finish(68);case 71:a||null===(S=n.defaultKeyHandler)||void 0===S||S.call(n,t);case 72:return e.abrupt("return",a);case 73:case"end":return e.stop()}}),e,this,[[9,39,42,45],[49,65,68,71]])}))),function(e){return n.apply(this,arguments)})},{key:"resolveKeyMapAction",value:function(e){var t=this,n=t.keyMapSubComponents;if(e.startsWith("up.")||e.startsWith("this."))return t.resolveCallback(e);if(n&&e.includes(".")){var r=_(e.split("."),2),i=r[0],a=r[1];if(i&&a)return{thisObj:n[i],handler:n[i][a]}}return{thisObj:t,handler:t[e]}}},{key:"updateKeyMap",value:function(e){var t,n=this,r=Be.keys(e);null===(t=n.keyMapDetacher)||void 0===t||t.call(n),n.keyMapDetacher=r.length?fr.on({element:n.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:n}):null}},{key:"keyMapOnKeyDown",value:function(e){this.performKeyMapAction(e)}},{key:"mergeKeyMaps",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:null,r={};e&&Be.assign(r,e);var a=function(){if(!t[o])return 1;var i=$e.asArray(null==e?void 0:e[o]),a=[];if(null!=i&&i.length&&a.push.apply(a,z(i)),null==i||!i.some((function(e){var t=e.handler?e.handler:e;return"string"==typeof t&&t.startsWith(n+".")}))){var l,s=D($e.asArray(t[o]));try{for(s.s();!(l=s.n()).done;){var u=l.value;Be.isObject(u)&&u.handler?a.push(Be.assignIf({handler:(n?n+".":"")+u.handler},u)):"function"==typeof u?a.push(u):a.push((n?n+".":"")+u)}}catch(e){s.e(e)}finally{s.f()}a.sort((function(e,t){var n=(e.weight||0)-(t.weight||0);return 0===n&&null!=i&&i.length?i.indexOf(e)-i.indexOf(t):n}))}r[o]=a};for(var o in t)a();return r}}]);var n}(e||Mn),S(t,"$name","KeyMap"),S(t,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),t},io=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"widgetClass",get:function(){}},{key:"isRTL",get:function(){return this.rtl}},{key:"updateRtl",value:function(e){var t=this.element;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}},{key:"startConfigure",value:function(e){var n;if(null===(n=B(t,"startConfigure",this,3))||void 0===n||n([arguments]),!e.floating&&null==e.rtl){var r,i=this,a=e.rootElement||e.forElement||(null===(r=i.parent)||void 0===r?void 0:r.contentElement)||(i.floating?i.floatRoot:i.changeElementRef(i.getRenderContext(e)[0]||e.adopt));if(a)e.rtl=1===a.nodeType&&"rtl"===getComputedStyle(a).getPropertyValue("direction");else{var o=e.owner||e.parent;e.rtl=o?o[o.isConfiguring?"peekConfig":"getConfig"]("rtl"):"rtl"===getComputedStyle(document.body).getPropertyValue("direction")}e.rtl&&(i.configDone.rtl=!1)}}},{key:"render",value:function(){for(var e,n,r,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];(null===(e=B(t,"render",this,3))||void 0===e||e(a),(ne.isChrome&&ne.chromeVersion<87||ne.isFirefox&&ne.firefoxVersion<66||ne.isSafari&&ne.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),"rtl"===getComputedStyle(this.element).direction||null!==(n=this.owner)&&void 0!==n&&n.rtl)&&(this.rtl=!0,null===(r=this.childItems)||void 0===r||r.forEach((function(e){return e.rtl=!0})))}}])}(e||Mn),S(t,"$name","RTL"),S(t,"configurable",{rtl:null}),t},ao=Object.freeze({highlight:!1,onlyName:!1}),oo=Object.freeze([]),lo=Object.freeze({sync:!1}),so=[],uo=["clip","display","opacity"],co="highlightExternalChange",ho=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,fo=Symbol("renderConfigObserver"),vo=/<div|<button|<input|<p|<br|<li/,go=function(e,t,n,r){var i,a=(null==n?void 0:n.listeners)||(null==n?void 0:n.internalListeners);if(a=(null===(i=a)||void 0===i?void 0:i.on)||a){var o=fr.on(Be.assign({element:t,thisObj:e},a));r?(e._refListeners||(e._refListeners=Object.create(null)))[r]=o:n.listeners={on:a,un:o}}},mo=function(e,t){return e&&t&&t[Be.keys(e)[0]]?rn.merge(e,t):e},po=function(e){e.isVisible&&e.triggerPaint()},yo=/^:not\((.+)\)$/,ko=/absolute|fixed/i,bo=function(e){return null!=e.scale},Co=Be.hasOwn,wo=Reflect.defineProperty,Do=function(e){return parseFloat(e)*(e.endsWith("ms")?1:1e3)},So=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],xo={configurable:!0,value:!1},Eo=/(?:L\{([ \w.]+?)\})/,Ro=/^([trblc])(\d*)-([trblc])(\d*)$/i,To=function(e,t){return Ro.test(e)&&(e={align:e}),Ro.test(t)&&(t={align:t}),rn.merge(e,t)},Mo=/^[\w.]+$/,Fo={1:"maxHeight",2:"height",4:"maxWidth",8:"width"},Ao=function(e){return!e.isRipple&&!e.closest((function(e){return e.isMessageDialog||e.isSharedTooltip}))},Io=function(e){return"contents"===li.getStyleValue(e,"display")?Io(e.parentNode):e},Lo=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateWeight",value:function(){var e,t;this.isPainted&&(null===(e=this.parent)||void 0===e||null===(t=e.onChildWeightChange)||void 0===t||t.call(e,this))}},{key:"isA",value:function(e){return this.isType(e,!0)}},{key:"isType",value:function(e,n){return t.isType(this,e,n)}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this,a=n.domSyncCallback,o=t.recomposeAsync;if(null!=o&&null==n.recomposeAsync&&(n.recomposeAsync=o),!r.bryntum.cssVersion){var l=r.bryntum.cssVersion=Ii.getCSSVersion(),s=Ne.getVersion("core");l&&l!==s&&console.warn("CSS version ".concat(l," doesn't match bundle version ").concat(s,"!")+"\nMake sure you have imported css from the appropriate product version.")}n.configureAriaDescription=e.ariaDescription,n._isAnimatingCounter=0,n.alignmentChanges=0,n.byRef=Object.create(null),n.onTargetResize=n.onTargetResize.bind(n),n.onFullscreenChange=n.onFullscreenChange.bind(n),n.domSyncCallback=a.$nullFn?null:a.bind(n),n._isUserAction=!1;for(var u=arguments.length,c=new Array(u>1?u-1:0),d=1;d<u;d++)c[d-1]=arguments[d];B(t,"construct",this,3)([e].concat(c)),n.finalizeInit()}},{key:"startConfigure",value:function(e){B(t,"startConfigure",this,3)([e]),this.getConfig("element")}},{key:"finalizeInit",value:function(){var e,t=this,n=t.adopt,r=t.insertBefore||t.appendTo||t.insertFirst||n,i=t.element.classList;(t.getConfig("html","content"),r)&&(n&&(i.remove("b-hidden"),t._hidden=!1),t.owner||null!==(e=r.nodeType?r:document.getElementById(r))&&void 0!==e&&e.isConnected?t.render():(t.onFirstResizeAfterConnect=t.onFirstResizeAfterConnect.bind(t),ya.addResizeListener(r,t.onFirstResizeAfterConnect)));i.remove("b-initializing")}},{key:"onFirstResizeAfterConnect",value:function(e){ya.removeResizeListener(e,this.onFirstResizeAfterConnect),this.isDestroyed||this.rendered||this.render()}},{key:"doDestroy",value:function(){var e,n,r=this,i=r.preExistingElements,a=r.element,o=r.adopt,l=r._refListeners,s=r._rootElement,u=r.eventRoot,c=r.ownedWidgets,d=r.parent;if(r.updateOwner(null,r.owner),va.element===a&&va.exit(),l&&(Object.values(l,(function(e){return e()})),r._refListeners=null),a){var h,f=!r._tooltip&&s&&(null===(h=t.Tooltip)||void 0===h?void 0:h.getSharedTooltip(s,u,!0));if((null==f?void 0:f.owner)===r&&(f.owner=null,f.hide()),r.onExitFullscreen(),r.clearTimeout("scrollListenerTimeout"),r.clearTimeout("resizeListenerTimeout"),r.removeTransientListeners(),r.floating||r.positioned||r.positionable?r.isPainted&&r.hide(!1):r.revertFocus(),ya.removeResizeListener(a.parentElement,r.onParentElementResize),ya.removeResizeListener(a,r.onElementResize),o){for(var v=Array.from(a.childNodes),g=0,m=v.length;g<m;g++){var p=v[g];i.includes(p)||p===r.floatRoot||p.remove()}a.className=r.adoptedElementClassName,a.style.cssText=r.adoptedElementCssText}}null===(e=r.connectedObserver)||void 0===e||e.disconnect(),(null==d?void 0:d.isContainer)&&!d.isDestroying&&(null===(n=d._items)||void 0===n?void 0:n.includes(r))&&d.remove(r),B(t,"doDestroy",this,3)([]),c&&Object.values(c).forEach((function(e){var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),u&&Promise.resolve().then((function(){Object.values(t.identifiable.idMap).some(Ao)||Wn.detachFocusListeners(u)})),o||a.remove()}},{key:"assignValueDefaults",get:function(){return ao}},{key:"valueName",get:function(){return this.name||this.ref||this.id}},{key:"getValueName",value:function(e){return(e=e&&"object"===W(e)?e.onlyName:e)?this.name:this.valueName}},{key:"assignFieldValue",value:function(e,t,n){var r=this,i=r.defaultBindProperty;i in r&&(r[i]=n)}},{key:"assignValue",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:ao,n=this,r=n[co],a=n.getValueName(t);!a||e&&!(a in e)||(!1===t.highlight&&(n[co]=!1),n.assignFieldValue(e,a,e?e[a]:null),n[co]=r)}},{key:"gatherValue",value:function(e){var n=this,r=n.defaultBindProperty;n.constructor!==t&&r in n&&(e[n.name||n.ref||n.id]=n[r])}},{key:"gatherValues",value:function(e){this.eachWidget((function(t){return t.gatherValue(e)}),!1)}},{key:"addToOverflowMenu",value:function(e,t,n){var r=this.ensureOverflowTwin(t,n);return e.items.push(r),r}},{key:"twinForwardEventPairs",get:function(){var e=this._twinForwardEvents;return e?Be.entries(e):oo}},{key:"configureOverflowTwin",value:function(e){var t,n,r=this,i=r.twinSyncConfigs,a=Be.clone(r.initialConfig);if(delete a.id,delete a.listeners,delete a.internalListeners,delete a.parent,a.hidden=!1,a.type=r.type,a._overflowTwinOrigin=r,a.owner=r.owner,r.twinForwardEventPairs.forEach((function(e){var t=_(e,1)[0];delete a["on".concat(Le.capitalize(t))]})),i)for(t in i)(n=i[t])&&(delete a[t],a["string"==typeof n?n:t]=r[t]);return e&&(a="function"==typeof e?e(a)||a:Be.assign(a,e)),a}},{key:"createOverflowTwin",value:function(e){var n=this,r=n.configureOverflowTwin(e),i=t.create(r),a=n.twinSyncConfigs;return a&&n.bindConfigs(i,a,lo),n.twinForwardEventPairs.forEach((function(e){var t=_(e,2),r=t[0],a=t[1];i.ion(S({},r,(function(e){n.overflowTwin===e.source&&(delete(e=Be.assign({},e)).source,n.trigger("string"==typeof a?a:e.eventName,e))})))})),i}},{key:"ensureOverflowTwin",value:function(e,t){var n=this.overflowTwin;return n||(this.overflowTwin=n=this.createOverflowTwin(e),null==t||t(n)),n}},{key:"isComposable",get:function(){return!this.compose.$nullFn}},{key:"adoptElement",value:function(e){var n=this,r="string"==typeof e?document.getElementById(e):e,i=t.fromElement(r);i&&i.adopt&&i!==n&&(("string"==typeof i.adopt?document.getElementById(i.adopt):i.adopt)===r&&i.destroy());return n.preExistingElements=Array.from(r.childNodes),n.adoptedElementClassName=r.className,n.adoptedElementCssText=r.style.cssText,r.lastDomConfig=null,r.$refOwnerId=n.id,r.className=r.style.cssText="",r}},{key:"addRefAccessor",value:function(e,t){var n=this.constructor.prototype;wo(n,t,{writable:!0,value:null}),wo(n,e,{get:function(){return this.recompose.flush(),this[t]},set:function(e){this[t]=e}})}},{key:"attachRef",value:function(e,t,n){var r=this,i="_"+e;t.dataset&&(t.dataset.ownerCmp=r.id),r.isComposable&&(i in r||r.addRefAccessor(e,i),go(r,t,n,e)),r.byRef[e]=t,r[e]=t}},{key:"detachRef",value:function(e,t,n){var r=this,i=r._refListeners;null!=i&&i[e]&&(i[e](),delete i[e]),r[e]=null,delete r.byRef[e]}},{key:"afterRecompose",value:function(){}},{key:"compose",value:function(){var e=this.widgetClassList;return{class:F({},Ct.normalize(e,"object"))}}},{key:"doCompose",value:function(){var e,n,r,i,a=this,o=a.$meta,l=o.hierarchy,s=o.renderConfigs||o.getInherited("renderConfigs"),u=o.composers,c=null;if(a.recompose.suspend(),!u){for(o.composers=u=[],r=l.indexOf(t);r<l.length;++r)i=l[r].prototype,Co(i,"compose")&&u.push(i);Co(s,fo)||(s[fo]={get:function(e){"element"!==e&&(s[e]=!0)}})}for(a.configObserver=s[fo],r=0;r<u.length;++r)e=u[r].compose.call(a,c),c=c?li.merge(c,e):e;return Co(a,"compose")&&li.merge(c,a.compose(c)),a.configObserver=null,li.normalizeChildren(c,(function(e,t){t&&((n="_"+e)in a||a.addRefAccessor(e,n))}))}},{key:"element",get:function(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}},{key:"domSyncCallback",value:function(e){}},{key:"changeElement",value:function(e){var t=this,n=t.isComposable,r=t.adopt;return t.id=t.id||(null==r?void 0:r.id)||null,r?e=t.adoptElement(r):n&&(e=t.doCompose()),"string"==typeof e?e=li.createElementFromTemplate(e):Be.isObject(e)?(e=li.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume()):li.isReactElement(t.peekConfig("html"))||li.isVueConfig(t.peekConfig("html"))?e=document.createElement("div"):1!==e.nodeType&&(e=li.createElementFromTemplate(t.template(t))),!e.id&&(e.id=t.id),t.elementAttributes&&li.setAttributes(e,t.elementAttributes),e}},{key:"updateElement",value:function(e){var n=this,r=n.isComposable;n.adopt&&(n._hidden=!0,r&&n.recomposeNow()),r&&go(n,e,e.lastDomConfig);var i=e.className,a=n.contentElement,o=n.contentElementCls,l=n.isComposable,s=a!==e,u=!l&&e.querySelectorAll("[data-reference]"),c=l?[]:n.widgetClassList,d=(s||!l)&&n.uiClasses;if(i&&c.unshift(i),n._hidden&&c.push("b-hidden","b-hide-mode-".concat(n.hideMode)),n._readOnly&&c.push("b-readonly"),c.push("b-initializing"),Tt.noThrow(e,"remove"),d?(null!=o&&o.value&&(d=d.slice()).push(o.value),d=d.join(" ")):d=null==o?void 0:o.value,d&&(s?a.className+=" "+d:c.push(d)),!n.parent){var h=n.defaultCls,f=t.outerCls;c.push.apply(c,z(h?f.filter((function(e){return!(e in h)||h[e]})):f))}if(e.className=c.join(" "),u)for(var v,g=0;g<u.length;++g)v=u[g],n.attachRef(v.getAttribute("data-reference"),v),v.removeAttribute("data-reference");n.scaleToFitWidth||n.getConfig("monitorResize"),n.getConfig("role","ariaLabel","ariaDescription"),n._html&&n.getConfig("htmlMutationObserver"),n.owner&&!n._owner&&n.updateOwner(n.owner),li.isVueConfig(n._html)&&li.handleVueContent(n,n.html),n.trigger("elementCreated",{element:e})}},{key:"localizeText",value:function(e){return e.match(Eo)?this.L(e,this):e}},{key:"updateAriaDescription",value:function(e){var t=this,n=t.ariaElement,r="".concat(t.id,"-aria-desc-el");e?((t._ariaDescEl||(t._ariaDescEl=li.createElement({className:"b-aria-desc-element",id:r,parent:n}))).innerText=t.localizeText(e),li.addAttributeValue(n,"aria-describedBy",r)):li.removeAttributeValue(n,"aria-describedBy",r)}},{key:"updateAriaLabel",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"",t=this.labelledElement||this.ariaElement;t&&li.setAttributes(t,{"aria-label":e?this.localizeText(e):null})}},{key:"updateAriaHasPopup",value:function(e){var t,n;e?null===(t=this.ariaElement)||void 0===t||t.setAttribute("aria-haspopup",e):null===(n=this.ariaElement)||void 0===n||n.removeAttribute("aria-haspopup")}},{key:"updateAriaLive",value:function(e){li.setAttributes(this.ariaElement,{"aria-live":e})}},{key:"updateRole",value:function(e){var t,n;e?null===(t=this.ariaElement)||void 0===t||t.setAttribute("role",e):null===(n=this.ariaElement)||void 0===n||n.removeAttribute("role")}},{key:"ownersRole",get:function(){var e,t=this.role;"presentation"===t&&(t=null===(e=this.query((function(e){return"presentation"!==e.role})))||void 0===e?void 0:e.role);return t}},{key:"ariaElement",get:function(){this.getConfig("element");var e=this._ariaElement;return e.nodeType===Node.ELEMENT_NODE?e:Be.getPath(this,e)}},{key:"isCollapsified",value:function(e){var t=e.collapsed,n=e.alt,r=this.collapsify,i=null==r;return n?"overlay"===r||i&&t:!1===r||"hide"===r||i&&!t}},{key:"recompose",value:(c=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.recomposeInternal());case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"recomposeInternal",value:(u=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={targetElement:(t=this).element,domConfig:t.doCompose(),refOwner:t,callback:t.domSyncCallback,strict:!0},!t.transitionRecompose){e.next=11;break}return t.isTransitioningDom=!0,e.next=5,li.transition(Be.assign({element:t.element,action:function(){fa.sync(n)}},t.transitionRecompose));case 5:if(!t.isDestroyed){e.next=7;break}return e.abrupt("return");case 7:t.isTransitioningDom=!1,t.trigger("transitionedRecompose"),e.next=12;break;case 11:fa.sync(n);case 12:n.changed&&(t.afterRecompose(),t.trigger("recompose")),t.resumeRecompose();case 14:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"resumeRecompose",value:function(){this.recompose.resume()}},{key:"changeElementRef",value:function(e){if("string"==typeof e){var t=e;if(!(e=document.getElementById(t)))throw new Error("No element found with id '".concat(t,"'"))}return e}},{key:"changeAppendTo",value:function(e){return this.changeElementRef(e)}},{key:"updateAppendTo",value:function(e){!this.isConfiguring&&e&&this.render()}},{key:"changeInsertBefore",value:function(e){return this.changeElementRef(e)}},{key:"updateInsertBefore",value:function(e){!this.isConfiguring&&e&&this.render()}},{key:"changeInsertFirst",value:function(e){return this.changeElementRef(e)}},{key:"updateInsertFirst",value:function(e){!this.isConfiguring&&e&&this.render()}},{key:"getRenderContext",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this,t=(arguments.length>1?arguments[1]:i)||e.appendTo,n=e.insertFirst,r=e.insertBefore;return n&&(r=(t=n).firstChild),r&&(t=r.parentElement),[t,r||i]}},{key:"render",value:function(e){var n,r,a=!(arguments.length>1&&arguments[1]!==i)||arguments[1],o=this,l=o.element,s=_(o.getRenderContext(o,e),2),u=s[0],c=s[1];(o.emptyCache(),o.syncElement&&o.currentElement?li.sync(l,o.currentElement):(null==u||u.insertBefore(l,c),o.currentElement=l),null!==(n=l.parentElement)&&void 0!==n&&n.closest(".b-widget"))&&(r=l.classList).remove.apply(r,z(t.outerCls));B(t,"render",this,3)([u,a]),o.rendered=!0,o.getConfig("role"),a&&(o.getConfig("contentRange"),o.triggerPaint()),o.setupFocusListeners()}},{key:"template",value:function(e){var t,n=e.tag,r=e.html,i=e.htmlCls,a=e.name,o=this;"string"==typeof r&&Mo.test(r)&&o.resolveCallback(r,o,!1)&&(r=o.callback(r,o,[o]));var l=null!==(t=r)&&void 0!==t&&t.call?r.call(o,o):r;return"<".concat(n,' class="').concat(l?i:"",'" ').concat(a?'data-name="'.concat(a,'"'):"",">").concat(l||"","</").concat(n,">")}},{key:"updateRecomposeAsync",value:function(e){this.recompose.immediate=!e}},{key:"onConfigChange",value:function(e){var t,n=e.name;this._element&&!this.isDestroying&&null!==(t=this.$meta.renderConfigs)&&void 0!==t&&t[n]&&this.recompose()}},{key:"preProcessCurrentConfigs",value:function(e){B(t,"preProcessCurrentConfigs",this,3)([e]),delete e.parent}},{key:"getConfigValue",value:function(e,n){return"style"===e?this._style:B(t,"getConfigValue",this,3)([e,n])}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return(null==e?void 0:e.depth)>0&&(n.type=this.type),n}},{key:"dataset",get:function(){var e;return(null===(e=this.element)||void 0===e?void 0:e.dataset)||oo}},{key:"changeDataset",value:function(e){Be.assign(this.dataset,e)}},{key:"updateParent",value:function(e){var n,r=this._element;r&&(n=r.classList)[e?"remove":"add"].apply(n,z(t.outerCls))}},{key:"constrainTo",get:function(){var e,t=this._constrainTo;if(t=t===i?r:(null===(e=t)||void 0===e?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?t.host||t.ownerDocument:t,this.positioned){var n=this.element.offsetParent;if(n&&"hidden"===li.getStyleValue(n,"overflow"))t=pt.from(n).moveTo(0,0);else if(t&&!t.isRectangle){var a=t===document||t===r;t=pt.from(t,n),a&&t.translate(r.pageXOffset,r.pageYOffset)}}return t}},{key:"updateCentered",value:function(e){var t=this,n=t.element,r=t._anchorElement;if(e&&!t.floating&&!t.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(n.classList.add("b-centered"),n.style.transform=n.style.left=n.style.insetInlineStart=n.style.right=n.style.top="",null==r||r.classList.add("b-hide-display"),n.classList.remove("b-anchored")):n.classList.remove("b-centered")}},{key:"contentElement",get:function(){return this.element}},{key:"contentRange",get:function(){var e=this,t=e._contentRange||(e._contentRange=new Range);return t.collapsed&&(e.initializingHtml&&e.adopt?t.setStart(e.contentElement,0):t.selectNodeContents(e.contentElement)),t}},{key:"fixRefOwnerId",value:function(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;for(var r=e.childNodes,i=r.length;i-- >0;)this.fixRefOwnerId(r[i],t,n)}}},{key:"placement",get:function(){var e,t,n,r=this.element;if(null!=r&&r.offsetParent&&!ko.test(li.getStyleValue(r,"position"))){var i,a=r.nextElementSibling,o=r.previousElementSibling,l=!a&&o;if(t=li.getStyleValue(r.parentElement,"flex-direction"))t=t.startsWith("row")?"h":"v";else n=(e=null===(i=a||o)||void 0===i?void 0:i.getBoundingClientRect())&&r.getBoundingClientRect(),t=e&&Math.abs(e.top-n.top)<Math.abs(e.left-n.left)?"h":"v";t+="h"===t?l?"r":"l":l?"b":"t"}return t}},{key:"updateId",value:function(e,n){if(B(t,"updateId",this,3)([e,n]),n){var r=this.byRef,i=this.element;for(var a in r)r[a].dataset&&(r[a].dataset.ownerCmp=e);i.id=e,this.fixRefOwnerId(i,e,n)}}},{key:"style",get:function(){var e=this.element;return(null==e?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}},{key:"updateStyle",value:function(e){this.element&&li.applyStyle(this.element,e)}},{key:"updateTitle",value:function(e){this.titleElement&&(this.titleElement.innerHTML=e)}},{key:"beforeAlignTo",value:function(e){}},{key:"alignTo",value:function(e){var t,n,i,a=this,o=a.lastAlignSpec,l=a.element,s=l.offsetParent,u=l.style,c=l.classList;if(o&&(o.monitorIntersection&&a.intersectionObserver.unobserve(o.target),isFinite(o.zone)&&l.classList.remove(So[o.zone])),!e)return a.removeTransientListeners(),void(a.anchor=a.lastAlignSpec=null);a.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||"Point"===e.$$name)&&(e={target:e}),a.releaseSizeConstraints();var d=a.scrollable,h=a.constrainTo,f=li.measureSize(li.getStyleValue(l,"minHeight"),l),v=li.measureSize(li.getStyleValue(l,"minWidth"),l),g=a.positioned&&"fixed"!==li.getStyleValue(l,"position"),m=a.scale||1,p=e.target,y=e.realignEvent||function(e){if(null!=e&&e.target){var t=e.target.ownerSVGElement,n=null==t?void 0:t.getBoundingClientRect();if(t)return{target:e.target.ownerSVGElement,offsetX:e.clientX-n.x,offsetY:e.clientY-n.y};var r=e.offsetX,i=e.offsetY,a=Io(e.target);if("contents"===li.getStyleValue(e.target,"display")){var o=a.getBoundingClientRect(a);r-=o.x,i-=o.y}return{target:Io(e.target),offsetX:r,offsetY:i}}}(e.domEvent||e.event||((null==p||null===(t=p.target)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE?p:null)),k=(null==y||null===(n=y.target)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE,b=k?y.target:null!=p&&p.isRectangle?p:(null==p?void 0:p.element)||p,C=(null==b?void 0:b.nodeType)===Element.ELEMENT_NODE;e=e.realignTarget?Be.clone(e):Be.merge({aligningToEvent:k,aligningToElement:C,constrainTo:h,align:"b-t",axisLock:a.axisLock,anchor:a.anchor},a.align,e),k&&(e.domEvent=y);var w=e.minWidth||v,D=e.minHeight||f;if(a.lastAlignSpec=e,C&&(e.target=e.anchoredTo=b,Yr(b instanceof SVGElement?b.closest("svg"):b))){if((e=Object.create(e)).target=a.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?pt.from(b,g?s:null,!g):li.isInView(k?y:b,!1,a)),!e.target){var S=a.hide();return a.isDestroyed||(a.lastAlignSpec.targetOutOfView=!0),S}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1)}if(e.anchor&&(e.anchorSize=a.anchorSize,l.contains(a.anchorPathElement)||l.appendChild(a.anchorElement)),"string"==typeof e.offset){var x=l.querySelector(e.offset),E=pt.from(x).getAlignmentPoint(e.align),R=pt.from(l).getAlignmentPoint(e.align);e.offset=[R[0]-E[0],R[1]-E[1]]}a.isAligning=!0,a.trigger("beforeAlign",e);var T=pt.from(l,g?s:null,!0),M=T.width,F=T.height;T.isAlignRectangle=!0,w&&(T.minWidth=w*m),D&&(T.minHeight=D*m),a.isAligning=!1,e.rtl=a.rtl,(e.align.includes("s")||e.align.includes("e"))&&(a.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));var A=a.lastAlignSpec.result=T.alignTo(e),I=A.align,L=A.anchor,O=A.x,P=A.y,_=A.width,H=A.height,B=A.overlap;if(a.lastAlignSpec.zone=A.zone,H!=F){var V=H<F;a.alignmentChanges=a.alignmentChanges|(V?1:2),u[a.alignedHeightStyle=Fo[3&a.alignmentChanges]]="".concat(H/m,"px"),V&&!a._minHeight&&f&&(u.minHeight="".concat(Math.min(H,f)/m,"px")),d&&(d.overflowY=V)}if(_!=M){var N=_<M;a.alignmentChanges=a.alignmentChanges|(N?4:8),u[a.alignedWidthStyle=Fo[12&a.alignmentChanges]]="".concat(_/m,"px"),N&&!a._minWidth&&v&&(u.minWidth="".concat(Math.min(_,v)/m,"px")),d&&(d.overflowX=N)}if(I&&a.alignmentChanges){var z=pt.from(l,g?s:null,!0);e.align=I;var j=a.lastAlignSpec.result=z.alignTo(e);L=j.anchor,O=j.x,P=j.y,_=j.width,H=j.height}if(a.centered||a.setXY(O,P),!A.overlap&&isFinite(A.zone)&&c.add(So[A.zone]),null!==(i=L)&&void 0!==i&&i.edge){var W,$=L.edge,U=a.anchorElement,G=a.masked,Y=U.style,q=U.firstChild.style,K=pt.from(l),X=[];"top"===$||"bottom"===$?(X[0]=L.x,X[1]="top"===$?1:K.height-1):(X[0]="left"===$?1:K.width-1,X[1]=L.y),Y.display="none",G&&(G.element.style.display="none");var Z=li.childFromPoint.apply(li,[l].concat(X));if((null!==(W=Z)&&void 0!==W&&W.matches(":focus")||Z===Wn.currentOverElement)&&l.compareDocumentPosition(Z)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(Z=Z.parentNode),Z&&Z!==document){for(var J=li.getStyleValue(Z,"background-color");J.match(ho)&&"absolute"!==li.getStyleValue(Z,"position")&&(Z=Z.parentNode)!==document;)J=li.getStyleValue(Z,"background-color");J.match(ho)?a.anchorPathElement.setAttribute("fill",a.defaultAnchorBackgroundColor):a.anchorPathElement.setAttribute("fill",J)}Y.transform=Y.display="",G&&(G.element.style.display=""),"left"!==$&&"right"!==$||($="left"===$?a.rtl?"end":"start":a.rtl?"start":"end"),U.className="b-anchor b-anchor-".concat($),L.x&&(L.x/=m),L.y&&(L.y/=m),q.left="".concat(L.x||0,"px"),q.translate="0 ".concat(L.y||0,"px"),c.add("b-anchored")}else a._anchorElement&&(a.anchorElement.classList.add("b-hide-display"),c.remove("b-anchored"));if(!C){u.pointerEvents="none";var Q=li.elementFromPoint(O,P);a.owns(Q)||(a.lastAlignSpec.anchoredTo=Q),u.pointerEvents=""}if(("realign"===a.scrollAction&&C||"hide"===a.scrollAction)&&!a.documentScrollListener){if(a.clearTimeout("scrollListenerTimeout"),e.monitorTargetMutation&&!a.targetObserver)(a.targetObserver||(a.targetObserver=new MutationObserver(a.onTargetParentMutation.bind(a)))).observe(li.getRootElement(b),{childList:!0,attributes:!0,subtree:!0});a.setTimeout((function(){var e=C?b:a.lastAlignSpec.anchoredTo,t=e?li.getRootElement(e):null;a.documentScrollListener=fr.addListener({element:document,scroll:"doHideOrRealign",transitionend:"realignOnTransitionEnd",capture:!0,thisObj:a}),null!=t&&t.mode&&(a.targetRootScrollListener=fr.addListener({element:t,scroll:"doHideOrRealign",transitionend:"realignOnTransitionEnd",capture:!0,thisObj:a}))}),"hide"===a.scrollAction?a.ignoreScrollDuration:0,"scrollListenerTimeout")}if(C&&(e.monitorResize&&!a.observedTargetEl&&(ya.addResizeListener(b,a.onTargetResize),a.observedTargetEl=b),e.monitorIntersection&&!(B||b.contains(l)||b.ownerSVGElement)&&a.intersectionObserver.observe(b)),!ne.isAndroid&&!a.observedConstrainEl){var ee=null!=h&&h.isRectangle?r:h;a.clearTimeout("resizeListenerTimeout"),a.setTimeout((function(){a.observedConstrainEl=ee||r,ya.addResizeListener(a.observedConstrainEl,a.onAlignConstraintChange)}),a.ignoreScrollDuration,"resizeListenerTimeout")}}},{key:"onTargetParentMutation",value:function(e){var t,n=this.element,r=this.lastAlignSpec;null!=r&&r.aligningToElement&&(null!==(t=r.target)&&void 0!==t&&t.isConnected?e.some((function(e){var t=e.target;return t.contains(r.target)&&!n.contains(t)}))&&this.realign():this.hide())}},{key:"intersectionObserver",get:function(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionChange.bind(this),{root:ne.isSafari?this.rootElement:this.rootElement.ownerDocument}))}},{key:"onTargetIntersectionChange",value:function(e){if(!this.isDestroyed){var t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}},{key:"onTargetResize",value:function(){var e=this.lastAlignSpec;if(e){var t=e.targetRect,n=t.width,r=t.height,i=e.target.getBoundingClientRect(),a=i.width,o=i.height;a===n&&o===r||this.onAlignConstraintChange.apply(this,arguments)}}},{key:"onAlignTargetOutOfView",value:function(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}},{key:"onAlignConstraintChange",value:function(e,t,n){var r=n.height,i=this.contentElement.style,a=i.overflowY;this.setTimeout(this.realign,50),t&&r>t.height&&(i.overflowY="hidden",this.requestAnimationFrame((function(){return i.overflowY=a})))}},{key:"realign",value:function(){var e=this,t=e.lastAlignSpec;if((e.floating||e.positioned)&&t&&e.isVisible){if(t.aligningToElement){var n=t.target.contains(this.element),r=li.isInView(t.target,!1,e);if(!(t.allowTargetOut||Yr(t.target)&&r))return e.hide(),void(e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0));t.realignEvent=t.domEvent,t.realignTarget=n||t.aligningToEvent?null:r}li.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(t)}}},{key:"rectangle",value:function(e,t,n){return this.rectangleOf("element",e,t,n)}},{key:"rectangleOf",value:function(e,t,n,r){var a;return"string"!=typeof t?(r=n,n=t,t=""):"border"===t&&(t=""),"boolean"==typeof n&&(r=n,n=i),"element"!==e&&n===i&&(n=this.element),n=null!==(a=n)&&void 0!==a&&a.isWidget?n.element:n,"string"==typeof e&&(e=this[e]),pt[t||"from"](e,n,r)}},{key:"releaseSizeConstraints",value:function(){var e=this,t=e.scrollable,n=e.element,r=e.alignmentChanges,i=n.style;e.centered||li.setTopInsetInlineStart(n,0,0),12&r&&(li.setLength(n,e.alignedWidthStyle,e["_last".concat(Le.capitalize(e.alignedWidthStyle))]||""),i.minWidth=e._minWidth||"",t&&(t.overflowY=t.config.overflowY)),3&r&&(li.setLength(n,e.alignedHeightStyle,e["_last".concat(Le.capitalize(e.alignedHeightStyle))]||""),i.minHeight=e._minHeight||"",t&&(t.overflowX=t.config.overflowX)),e.alignmentChanges=0}},{key:"toFront",value:function(){var e=this.element,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null,n=document.createDocumentFragment();if(this.containsFocus){for(var r,i=e.nextSibling;i;i=r){var a,o;r=i.nextSibling,t.contains(i)&&null!==(a=(o=i).matches)&&void 0!==a&&a.call(o,".b-floating,.b-positioned")&&!this.owns(i)&&n.appendChild(i)}n.childElementCount&&t.insertBefore(n,e)}else e.nextElementSibling&&t.appendChild(e)}},{key:"updateRef",value:function(e){this.element.dataset.ref=e}},{key:"overflowElement",get:function(){return this.contentElement}},{key:"maxHeightElement",get:function(){return this.element}},{key:"changeAlign",value:function(e){return"string"==typeof e?{align:e}:e}},{key:"changeScrollable",value:function(e,t){return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):null==t||t.destroy(),e}},{key:"html",get:function(){return this.isConfiguring?this.content||this._html:this.contentElement.innerHTML}},{key:"changeHtml",value:function(e){return!e||"object"!==W(e)||li.isVueConfig(e)||li.isReactElement(e)||Array.isArray(e)||(e=[e]),e}},{key:"updateHtml",value:function(e){var t=this;t.noChildElements="string"==typeof e&&!vo.test(e),t.initializingElement||t.insertContent(e,!(t.initializingHtml&&t.adopt))}},{key:"changeHtmlMutationObserver",value:function(e,t){var n=this,r=n.contentElement;if(null==t||t.disconnect(),e){var i=new MutationObserver((function(){n.updatingHtml?n.updatingHtml=!1:n._html=r.innerHTML}));return i.observe(r,e),i}}},{key:"updateContent",value:function(e){this.initializingElement||this.insertContent(e)}},{key:"insertContent",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=this,o=a.element,l=a.contentElement,s=a.htmlCls,u=a.contentRange,c=a.autoClose,d=r&&l===o&&a._anchorElement;if(li.isReactElement(e))return li.handleReactElement(a,e);if(li.isVueConfig(e))return li.handleVueContent(a,e);(a.updatingHtml=!0,a.getConfig("htmlMutationObserver"),d&&o.removeChild(d),s&&s.values.forEach((function(t){return o.classList[e?"add":"remove"](t)})),a.autoClose=!1,e)?("object"===W(e)?(n=document.createDocumentFragment(),Array.isArray(e)?fa.sync({domConfig:{children:e,onlyChildren:!0},targetElement:n}):fa.sync({domConfig:F(F({},e),{},{onlyChildren:!0}),targetElement:n})):r?(l.innerHTML=e,t=!0):(u.deleteContents(),u.insertNode(u.createContextualFragment(e)),t=!0),t||(r?(l.innerHTML="",l.appendChild(n)):o.isConnected?u.insertNode(n):l.insertBefore(n,l.firstChild))):r||!o.isConnected?l.innerHTML="":u.deleteContents();a.autoClose=c,d&&o.appendChild(d),a.contentRangeStartOffset=u.startOffset,a.contentRangeEndOffset=u.endOffset,l.classList.toggle("b-no-child-elements",a.noChildElements),a.isComposable&&a.recompose(),!a.floating&&!a.positioned||a.isAligning||a.realign()}},{key:"onThemeChange",value:function(){var e;this._anchorSize=null,null!==(e=this.anchorElement)&&void 0!==e&&e.offsetParent&&this.realign()}},{key:"anchorSize",get:function(){var e=this,t=this._anchorSize;if(!t){var n=parseFloat(li.getStyleValue(e.element,"border-top-width")),r=li.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,a=i.className,o=i.firstElementChild,l=e.anchorPathElement=o.lastElementChild,s=e._hidden;i.className="b-anchor b-anchor-top";var u=li.getStyleValue(e.contentElement,"background-color");u.match(ho)&&(u=li.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=u,t=o.getBoundingClientRect();var c=_(t=e._anchorSize=[t.width,t.height],2),d=c[0],h=c[1];i.className=a,o.setAttribute("height",h+n),o.setAttribute("width",d),l.setAttribute("d","M0,".concat(h,"L").concat(d/2,",0.5L").concat(d,",").concat(h)),n&&(l.setAttribute("stroke-width",n),l.setAttribute("stroke",r)),t[1]-=n,s&&e.syncHiddenCls(),e.themeChangeListener||(e.themeChangeListener=Wn.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}},{key:"anchorElement",get:function(){var e=this;if(!e._anchorElement){var t=e.floating||e.positioned,n="".concat(e.id,"-shadow-filter");e._anchorElement=li.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:n,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,S({tag:"path"},t?"filter":"","url(#".concat(n,")"))]}]})}return e._anchorElement}},{key:"updateAnchor",value:function(e){var t;null===(t=this._anchorElement)||void 0===t||t.classList.toggle("b-hide-display",!e)}},{key:"changeDraggable",value:function(e,t){var n,r=this;if(null==t||null===(n=t.destroy)||void 0===n||n.call(t),e){var a="object"===W(e)?e:{};r.draggableHandleSelector=a.handleSelector,delete a.handleSelector,e=new Qi(Be.merge({name:"widget",target:r,floatRootOwner:r,rtlSource:r,positioning:r.floating?"inset":"",dragWithin:r.floating?i:r.element.parentNode,internalListeners:{beforeDragStart:r.onBeforeDragStart,dragStart:r.onWidgetDragStart,thisObj:r}},a))}return e}},{key:"onBeforeDragStart",value:function(){var e=this;if(e.validateDragStartEvent(e.draggable.startEvent)){var t=e.x,n=e.y,r=e.element;return r.classList.remove("b-centered"),e.alignTo(),e.centered&&li.setTopInsetInlineStart(r,n,t),!0}return!1}},{key:"validateDragStartEvent",value:function(e){var t=li.elementFromPoint(e.clientX,e.clientY),n=this.draggableHandleSelector,r=this.draggableBlacklistSelector;if(r&&t.closest(r))return!1;if(n){var i,a=null===(i=yo.exec(n))||void 0===i?void 0:i[1];if(a&&t.closest(a))return!1;if(!t.closest("".concat(n)))return!1}return!0}},{key:"setStyle",value:function(e,t){return li.applyStyle(this.element,Be.isObject(e)?e:S({},e,t)),this}},{key:"changeFloating",value:function(e){return Boolean(e)}},{key:"changePositioned",value:function(e){return Boolean(e)}},{key:"updatePositionable",value:function(e){this.element.classList.toggle("b-positionable",Boolean(e)),e&&(this.innerItem=!1)}},{key:"updatePositioned",value:function(e){var t=this.element;t.classList.toggle("b-positioned",Boolean(e)),e&&(this.innerItem=!1),t[e?"setAttribute":"removeAttribute"]("tabindex",e?"-1":i)}},{key:"getXY",value:function(){var e=this.element;return[li.getPageX(e),li.getPageY(e)]}},{key:"setXY",value:function(e,t){var n=this,r=n.element;if(n.floating||n.positioned){if(null!=e?n._x=e:e=n._x,null!=t?n._y=t:t=n._y,"fixed"===li.getStyleValue(r,"position")){var i=r.getBoundingClientRect(),a=_(li.getTranslateXY(r),2),o=a[0],l=a[1],s=e-i.x,u=t-i.y;li.setTranslateXY(r,o+s,l+u)}else n.rtl?li.setTopInsetInlineStart(r,t,r.offsetParent.offsetWidth-r.offsetWidth-e-1):li.setTopInsetInlineStart(r,t,e);n.isConstructing?n.centered=!1:r.classList.remove("b-centered")}}},{key:"setPos",value:function(e,t){var n=this,r=n.positionable,i=_(li.unitize(e,null!=t?t:""),2);e=i[0],t=i[1],n.element.style[e]=t,null==n.top&&null==n.right&&null==n.bottom&&null==n.left?"after"!==r&&"before"!==r||(n.positionable=null):r||(n.positionable="before")}},{key:"updateBottom",value:function(e){this.setPos("bottom",e)}},{key:"updateLeft",value:function(e){this.setPos("inset-inline-start",e)}},{key:"updateRight",value:function(e){this.setPos("inset-inline-end",e)}},{key:"updateTop",value:function(e){this.setPos("top",e)}},{key:"x",get:function(){return this.getXY()[0]}},{key:"changeX",value:function(e){this.setXY(e)}},{key:"y",get:function(){return this.getXY()[1]}},{key:"changeY",value:function(e){this.setXY(null,e)}},{key:"width",get:function(){var e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}},{key:"changeWidth",value:function(e){var t=this;if(li.setLength(t.element,"width",e),t._lastWidth=e,t._flex=null,t.element.style.flex="",!t.monitorResize)return e;t._oldWidth=t._width,t._width=null}},{key:"clearWidthCache",value:function(){this._width=null}},{key:"maxWidth",get:function(){return li.measureSize(this.element.style.maxWidth,this.element)}},{key:"updateMaxWidth",value:function(e){this._lastMaxWidth=e,li.setLength(this.element,"maxWidth",e)}},{key:"minWidth",get:function(){return li.measureSize(this.element.style.minWidth,this.element)}},{key:"updateMinWidth",value:function(e){li.setLength(this.element,"minWidth",e)}},{key:"updateFlex",value:function(e){this.getConfig("width"),"number"!=typeof e&&isNaN(e)||(e="".concat(e," ").concat(e)),this.element.style.flex=e,this.element.style.width=""}},{key:"updateAlignSelf",value:function(e){this.element.style.alignSelf=e}},{key:"updateMargin",value:function(e){this.element.style.margin=this.parseTRBL(e).join(" ")}},{key:"updateTextAlign",value:function(e,t){t&&this.element.classList.remove("b-text-align-".concat(t)),this.element.classList.add("b-text-align-".concat(e))}},{key:"height",get:function(){var e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}},{key:"changeHeight",value:function(e){li.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}},{key:"maxHeight",get:function(){return li.measureSize(this.maxHeightElement.style.maxHeight,this.element)}},{key:"updateMaxHeight",value:function(e){this._lastMaxHeight=e,li.setLength(this.maxHeightElement,"maxHeight",e)}},{key:"minHeight",get:function(){return li.measureSize(this.element.style.minHeight,this.element)}},{key:"updateMinHeight",value:function(e){li.setLength(this.element,"minHeight",e)}},{key:"updateDisabled",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1?arguments[1]:i,n=this,r=n.element,a=n.focusElement,o=n.ariaElement;n.trigger("beforeUpdateDisabled",{disabled:e}),e&&(n.revertFocus(),!n._disabled!=!e)||(r&&(r.classList[e?"add":"remove"]("b-disabled"),"inert"===e?r.inert=!0:"inert"===t&&(r.inert=!1),a&&(a.disabled=e),o&&o.setAttribute("aria-disabled",Boolean(e))),n.onDisabled(e))}},{key:"onDisabled",value:function(e){}},{key:"disable",value:function(){this.disabled=!0}},{key:"enable",value:function(){this.disabled=!1}},{key:"requestFullscreen",value:function(){var e=this,t=va.request(e.floating?e.floatRoot:e.element);return va.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),t}},{key:"exitFullscreen",value:function(){return va.exit()}},{key:"onFullscreenChange",value:function(){va.isFullscreen||this.onExitFullscreen()}},{key:"onExitFullscreen",value:function(){va.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}},{key:"tooltip",get:function(){var e=this;if(e._tooltip)return e._tooltip;var n,r=null===(n=t.Tooltip)||void 0===n?void 0:n.getSharedTooltip(e.rootElement,e.eventRoot);return r&&r.activeTarget===e._element&&r.isVisible?r:void 0}},{key:"changeTooltip",value:function(e,n){var r,i=this,a=i.element;if(e){if(!i.preventTooltipOnTouch||!ne.isTouchDevice){var o=(null==n?void 0:n.isTooltip)||e.newInstance||e.items||e.bbar||e.tbar;e.isTooltip||"Object"===e.constructor.name||(e={html:"string"==typeof e?e:i.placeholder,textContent:!0}),o?(e.type="tooltip",e.forElement||(e.forElement=a),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),r=e=t.reconfigure(n,e,i),i.detachListeners("tooltipValueListener"),i.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:i})):(a.dataset.btip=!0,i.tipConfig=e)}}else if(n){if(null!=e||!n.isTooltip)return void(n.html=null);n.destroy()}else delete a.dataset.btip;return e&&!i.ariaLabel&&i.tooltipText&&a.setAttribute("aria-label",i.localizeText(i.tooltipText)),r}},{key:"onTooltipValueChange",value:function(e){var t=e.value,n=e.source;this.ariaDescription="string"==typeof t?t:n.contentElement.innerText}},{key:"tooltipText",get:function(){var e=this._tooltip;return e?e.isTooltip?e.contentElement.innerText:"string"==typeof e?e:e.html:this.tipConfig?this.tipConfig.html:void 0}},{key:"isVisible",get:function(){var e,t=this;return Boolean(!t._hidden&&(e=this.element)&&!t.isDestroying&&e.isConnected&&(!t.requireSize||Yr(e))&&(!t.parent||t.parent.isVisible))}},{key:"isVisibleForValidation",get:function(){var e,t=this,n=t.element;return Boolean(n&&(!t._hidden||t.tab&&!t.tab.hidden)&&!t.isDestroying&&n.isConnected&&(!(e=t.containingWidget)||e.isVisibleForValidation))}},{key:"whenVisible",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this,r=arguments.length>2?arguments[2]:i,o=arguments.length>3&&arguments[3]!==i?arguments[3]:e.toString(),l=this;l.isVisible&&l.isPainted?(null===(t=l.toCallWhenVisible)||void 0===t||t.delete(o),l.callback(e,n,r)):(l.toCallWhenVisible||(l.toCallWhenVisible=new a)).set(o,{callback:e,thisObj:n,args:r})}},{key:"focus",value:function(){var e;null===(e=this.focusableElement)||void 0===e||e.focus({preventScroll:!0})}},{key:"focusability",get:function(){return li.getFocusability(this.focusElement)}},{key:"focusableElement",get:function(){var e=this,t=!e.isDestroying&&e.isVisible&&!e.disabled&&e.focusElement;return(t===document.body||(null==t?void 0:t.offsetParent))&&t}},{key:"focusElement",get:function(){}},{key:"isFocusable",get:function(){return Boolean(this.focusableElement)}},{key:"isTabbable",get:function(){return this.focusability.tabbable},set:function(e){var t=this.focusability,n=this.focusElement,r=_(t.natural?[!e&&"-1",e]:[e&&"0",!e],2),i=r[0],a=r[1];n&&!e!=!t.tabbable&&(a&&n.removeAttribute("tabIndex"),i&&n.setAttribute("tabIndex",i))}},{key:"show",value:(s=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=t.align,r=t.animate,a=void 0===r||r;return L().mark((function t(r){var i,o,l,s,u,c,d,h;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(i=e).element,l=i.floating,s=o.style,u=a&&i.showAnimation,!(h=!i.isVisible)){t.next=8;break}if(h=i.trigger("beforeShow"),!Be.isPromise(h)){t.next=8;break}return t.next=7,h;case 7:h=t.sent;case 8:if(!1===h||!1===(null===(r=i.internalBeforeShow)||void 0===r?void 0:r.call(i))){t.next=12;break}return t.abrupt("return",new Promise((function(e){if(i.cancelHideShowAnimation(),i.updateCentered(i._centered),l){var t=i.floatRoot;t.contains(o)||(i.rendered?t.appendChild(i.element):i.render(t,!1)),s.transform.includes("scale")&&(i.scale=null,s.transform=s.transformOrigin="");var r=i.closest(bo);if(r){var a=r.scale;i.scale=a,s.transform="scale(".concat(a,")"),s.transformOrigin="0 0"}}if(i._hidden=!1,i.syncHiddenCls(),l&&!Gr(o))return i.hide(!1),e();if(i.onConfigChange({name:"hidden",value:!1,was:!0,config:i.$meta.configs.hidden}),i.afterShow(n,u?null:e),u){c=Object.keys(u)[0],d=u[c];var h=i.currentAnimation={showing:!0,styleProp:c,resolve:e};i.isAnimating=!0,s.transition="none",s[c]=d.from,li.getStyleValue(o,c),i.currentAnimation.detacher=fr.onTransitionEnd({element:o,property:c,duration:Do(d.duration)+20,handler:function(){return i.afterHideShowAnimate(h)},thisObj:i}),s.transition="".concat(c," ").concat(d.duration," ease ").concat(d.delay),s[c]=d.to}})));case 12:return t.abrupt("return",Promise.resolve());case 13:case"end":return t.stop()}}),t)}))()})),function(){return s.apply(this,arguments)})},{key:"showBy",value:(l=f(L().mark((function e(t,n,r){var i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this,((a=Array.isArray(t))||"number"==typeof t)&&(o=a?t:[t,n],t=Object.assign({target:new yt(o[0]+1,o[1]+1),matchSize:!1,align:"t0-b0"},a?n:r)),i.requireSize=!0,!i.isVisible){e.next=8;break}li.addTemporaryClass(i.element,"b-realigning",300,i),i.alignTo(t),e.next=9;break;case 8:return e.abrupt("return",i.show({align:t}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"afterShow",value:function(e,t){var n,r,i=this;i.trigger("show"),i._configuredAnchorState=i.anchor,null===(n=i.owner)||void 0===n||null===(r=n.onChildShow)||void 0===r||r.call(n,i),i.triggerPaint(),(i.floating||i.positioned)&&(e?i.alignTo(e):i.centered?i.alignTo({target:i.constrainTo,align:"c-c"}):i.forElement&&i.alignTo(i.forElement)),null==t||t()}},{key:"onChildHide",value:function(e){var t=this.ariaElement,n=e.ownersRole;if(e.floating&&t)if("tooltip"===n){var r=e.titleElement,i=r&&li.getId(r),a=li.getId(e.contentElement);i&&li.removeAttributeValue(t,"aria-describedby",i),li.removeAttributeValue(t,"aria-describedby",a)}else this.ariaHasPopup=null,li.removeAttributeValue(t,"aria-controls",li.getId(e.ariaElement||e.element))}},{key:"onChildShow",value:function(e){var t=this.ariaElement,n=e.ownersRole;if(e.floating&&t)if("tooltip"===n){var r=e.titleElement,i=r&&li.getId(r),a=li.getId(e.contentElement);i&&li.addAttributeValue(t,"aria-describedby",i),li.addAttributeValue(t,"aria-describedby",a)}else this.ariaHasPopup=n,li.addAttributeValue(t,"aria-controls",li.getId(e.ariaElement||e.element))}},{key:"triggerPaint",value:function(){var e=this,n=e.element,i=e.toCallWhenVisible,a=!e.isPainted;if(e.isVisible){var o;if(a&&(e.getConfig("scrollable",e.floating||e.positioned?"draggable":null),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),ya.addResizeListener(n.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&n.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),n.firstChild),e.onConnectedCallback&&r.ResizeObserver&&(e.connectedObserver=new ResizeObserver((function(){e.isElementConnected&&!n.isConnected?(e.onConnectedCallback(!1),e.isElementConnected=!1):!e.isElementConnected&&n.isConnected&&(e.onConnectedCallback(!0,null==e.isElementConnected),e.isElementConnected=!0)})),e.connectedObserver.observe(n))),e.eachWidget(po,!1),a&&(e.getConfig("tooltip"),!t.Ripple&&t.RippleClass&&(t.Ripple=new t.RippleClass({rootElement:e.rootElement})),r.DocsBrowser&&e.floating&&e.closest((function(e){var t;return null===(t=e.element)||void 0===t?void 0:t.closest(".fiddlePanelResult,.b-owned-by-fiddle")}))&&n.classList.add("b-owned-by-fiddle")),e.isPainted=!0,a&&e.triggerConfigs("paint"),e.onInternalPaint({firstPaint:a}),e.trigger("paint",{firstPaint:a}),null===(o=e.afterInternalPaint)||void 0===o||o.call(e,{firstPaint:a}),null!=i&&i.size){var l,s=D(i.values());try{for(s.s();!(l=s.n()).done;){var u=l.value,c=u.callback,d=u.thisObj,h=u.args;e.callback(c,d,h)}}catch(e){s.e(e)}finally{s.f()}i.clear()}a&&e.monitorResize&&!e.scaleToFitWidth&&ya.onElementResize([{target:n}]),e.hasPainted=!0}}},{key:"onInternalPaint",value:function(){}},{key:"cancelHideShowAnimation",value:function(){var e=this,t=e.currentAnimation,n=e.element;t&&(e.isAnimating=!1,n.classList.contains("b-hiding")&&(n.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),n.style.transition=n.style[t.styleProp]="",e.currentAnimation=null,e.trigger("".concat(t.showing?"show":"hide","AnimationEnd")))}},{key:"afterHideShowAnimate",value:function(e){var t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}},{key:"suspendVisibility",value:function(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",xo)}},{key:"resumeVisibility",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0];--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}},{key:"hide",value:function(){var e=this,t=!(arguments.length>0&&arguments[0]!==i)||arguments[0];return new Promise((function(n){var r=e;if(r._hidden||!1===r.trigger("beforeHide",{animate:t}))n(!1);else{var i=r.element,a=r.lastAlignSpec,o=i.style,l=t&&r.hideAnimation;if(r.clearTimeout("scrollListenerTimeout"),r.clearTimeout("resizeListenerTimeout"),r._hidden=!0,a&&(a.targetOutOfView=null,a.monitorIntersection&&(r.intersectionObserver.takeRecords(),r.intersectionObserver.unobserve(a.target))),r.onConfigChange({name:"hidden",value:!0,was:!1,config:r.$meta.configs.hidden}),!i)return void n();if(i.matches(":focus-within")&&r.revertFocus(!0),r.isDestroyed)return void n();if(r.cancelHideShowAnimation(),l){var s=Object.keys(l)[0],u=l[s];if(Number(getComputedStyle(r.element)[s])!==u.to){var c=r.currentAnimation={hiding:!0,styleProp:s,resolve:n};i.classList.add("b-hiding"),r.isAnimating=!0,r.currentAnimation.detacher=fr.onTransitionEnd({element:i,property:s,duration:Do(u.duration)+20,handler:function(){return r.afterHideShowAnimate(c)},thisObj:r}),o[s]=u.from,li.getStyleValue(i,s),o.transition="".concat(s," ").concat(u.duration," ease ").concat(u.delay),o[s]=u.to}else r.syncHiddenCls()}else r.syncHiddenCls();r.ownedWidgets&&Object.values(r.ownedWidgets).forEach((function(e){var n;return e.floating&&(null===(n=e.hide)||void 0===n?void 0:n.call(e,t))})),r.afterHide(!l&&n,l)}}))}},{key:"realignOnTransitionEnd",value:function(e){this.doHideOrRealign(e)}},{key:"doHideOrRealign",value:function(e){var t=e.target,n=e.type,i=e.isTrusted,a=this,o=a.lastAlignSpec,l=a.element,s=null==o?void 0:o.anchoredTo,u=null==o?void 0:o.target,c=null==o?void 0:o.position,d=li.getActiveElement(a);if(i&&Yr(l)&&(!t||!("scroll"===n&&!li.isVisible(t)||l.contains(t)||t.nodeType===Element.ELEMENT_NODE&&a.owns(t)||t.nodeType===Element.DOCUMENT_NODE&&l.contains(d)&&li.isTextualInput(d)&&r.innerHeight<document.body.offsetHeight))){if(o.aligningToElement){var h=li.isInView(u,!1,a);if(h&&h.equals(o.targetRect))return}var f="hide"===a.scrollAction&&a.getXY();if(a.scrollRealigning="scroll"===n,a.realign(),a.scrollRealigning=!1,!a.isDestroyed&&Gr(l)&&"hide"===a.scrollAction){var v=_(a.getXY(),2),g=v[0],m=v[1],p=g!==f[0]||m!==f[1];(null!=o&&o.aligningToEvent||(p||"Point"===(null==u?void 0:u.$$name)||c)&&(!s||!Yr(s)||t&&li.isDescendant(t,s)))&&a.hide()}}}},{key:"afterHide",value:function(){var e,t,n=arguments.length>0&&arguments[0]!==i?arguments[0]:null,r=arguments.length>1&&arguments[1]!==i?arguments[1]:this.hideAnimation,a=this;a._anchor=a._configuredAnchorState,a.removeTransientListeners(),r||a.afterHideAnimation(),a.trigger("hide"),null===(e=a.owner)||void 0===e||null===(t=e.onChildHide)||void 0===t||t.call(e,a),n&&n()}},{key:"removeTransientListeners",value:function(){var e,t,n=this,r=n.targetObserver;n.clearTimeout("resizeListenerTimeout"),n.clearTimeout("scrollListenerTimeout"),r&&(r.disconnect(),delete n.targetObserver),n.documentScrollListener=null===(e=n.documentScrollListener)||void 0===e?void 0:e.call(n),n.targetRootScrollListener=null===(t=n.targetRootScrollListener)||void 0===t?void 0:t.call(n),n.observedTargetEl&&(ya.removeResizeListener(n.observedTargetEl,n.onTargetResize),n.observedTargetEl=!1),n.observedConstrainEl&&(ya.removeResizeListener(n.observedConstrainEl,n.onAlignConstraintChange),n.observedConstrainEl=!1)}},{key:"afterHideAnimation",value:function(){var e=this,t=e.element;!e.hasOwnProperty("_hideMode")&&e.floating&&e.floatRoot.contains(t)?t.remove():e.syncHiddenCls(),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}},{key:"changeHidden",value:function(e){var t,n=this;return n.isConfiguring?(t=Boolean(e),n.syncHiddenCls(t)):(n.trigger("beforeChangeHidden",{hidden:e}),e?n.hide():n.show()),t}},{key:"syncHiddenCls",value:function(){for(var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this._hidden,t=this.element,n=this.hideMode,r={"b-hidden":e},a=0,o=uo;a<o.length;a++){var l=o[a];r["b-hide-mode-".concat(l)]=l===n&&(e||"display"!==l)}li.assignClasses(t,r)}},{key:"assignedId",get:function(){return this.hasGeneratedId?null:this.id}},{key:"owner",get:function(){return this.parent||this._owner||this.containingWidget}},{key:"changeOwner",value:function(e){if(!this.parent)return e}},{key:"updateOwner",value:function(e,t){var n=this,r=n.id;t&&t.ownedWidgets&&delete t.ownedWidgets[r],e&&e!==n.parent&&((e.ownedWidgets||(e.ownedWidgets={}))[r]=n)}},{key:"containingWidget",get:function(){var e=this.parent;if(!e){var n,r,i=(null===(n=this.forElement)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE?this.forElement:null===(r=this.element)||void 0===r?void 0:r.parentNode;e=(null==i?void 0:i.closest(".b-widget"))&&t.fromElement(i)}return e}},{key:"previousSibling",get:function(){return this.getSibling(-1)}},{key:"nextSibling",get:function(){return this.getSibling(1)}},{key:"getSibling",value:function(e){var n,r,i=this,a=i.parent,o=a?a.childItems:Array.from(null!==(n=null===(r=i.element.parentElement)||void 0===r?void 0:r.querySelectorAll(".b-widget"))&&void 0!==n?n:[]);return a?o[o.indexOf(i)+e]:t.fromElement(o[o.indexOf(i.element)+e])}},{key:"up",value:function(e,t,n){var r,i=this.owner;return e?null==i||null===(r=i.closest)||void 0===r?void 0:r.call(i,e,t,n):i}},{key:"closest",value:function(e,n,r){for(var i=W(r),a="number"===i,o="string"===i,l=this,s=1;l;l=l.owner,s++){if(t.widgetMatches(l,e,n))return l;if(a&&s>=r)return;if(o&&t.widgetMatches(l,r,n))return;if(l===r)return}}},{key:"owns",value:function(e,n){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=e.getAttribute("owned-by")?t.getById(e.getAttribute("owned-by")):t.fromElement(e)}for(;e;){if(e.isHint||e===this||n&&this.ownedWidgets&&Object.values(this.ownedWidgets).some((function(t){return t.owns(e,!0)})))return!0;e=e.owner}}return!1}},{key:"eachAncestor",value:function(e){for(var t=this.owner;t;){if(!1===e(t))return!1;t=t.owner}return!0}},{key:"changeMaximizeOnMobile",value:function(e){var t=this;if(t.floating&&ne.isMobile){var n=t.initialConfig;e?(t.centered=t.modal=!1,t.maximized=!0):(t.centered=n.centered,t.modal=n.modal,t.maximized=n.maximized)}}},{key:"changeMonitorResize",value:function(e,t){var n=!this.scaleToFitWidth&&Boolean(e);if(n!==Boolean(t))return n}},{key:"updateMonitorResize",value:function(e){var t=this;Co(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),ya[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}},{key:"changeReadOnly",value:function(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}},{key:"updateReadOnly",value:function(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((function(t){t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)}),!1),this.trigger("readOnly",{readOnly:e}))}},{key:"eachWidget",value:function(e){for(var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=arguments.length>2?arguments[2]:i,r=n?this.childItemsOrderedByRelevance:this.childItems,a=(null==r?void 0:r.length)||0,o={},l=0;l<a;l++){var s=r[l];if(o.down=t,!1===e(s,o))return!1;if(o.down&&s.eachWidget&&!1===s.eachWidget(e,t,n))return!1}return!0}},{key:"queryAll",value:function(e){var t=[];return this.eachWidget((function(n){e(n)&&t.push(n)})),t}},{key:"query",value:function(e,t){var n=null;return this.eachWidget((function(t){if(e(t))return n=t,!1}),!0,t),n}},{key:"getWidgetByRef",value:function(e){var n,r;return e instanceof t?e:(null==this||null===(n=this.widgetMap)||void 0===n?void 0:n[e])||(null==this||null===(r=this.owner)||void 0===r?void 0:r.getWidgetByRef(e))}},{key:"onFocusIn",value:function(e){var t=this,n=t.element;t.containsFocus=!0,t.focusInEvent=e,(t.floating||t.positioned)&&t.toFront(),n.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),n.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=fr.on({element:n,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}},{key:"onFocusOut",value:function(e){var t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}},{key:"captureFocus",value:function(){var e=this,t=li.getActiveElement(e),n=e.contains(t)&&e.captureFocusItem(t);return function(r,i){n&&!e.isDestroying&&((li.getActiveElement(e)!==t||i)&&n(r))}}},{key:"captureFocusItem",value:function(e){var t=this;return function(){var n=!(arguments.length>0&&arguments[0]!==i)||arguments[0];t.contains(e)&&(n?e.focus():e.focus({preventScroll:!0}))}}},{key:"contains",value:function(e,t){var n=this.element;if(e&&n)return e.isWidget&&(e=e.element),n.contains(e)&&(!t||n!==e)}},{key:"revertFocus",value:function(e){var t,n,r=this,i=li.getActiveElement(r),a=null===(t=r.focusInEvent)||void 0===t?void 0:t.relatedTarget;(e||r.containsFocus&&(null===(n=a)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE&&r.element.contains(i))&&(a&&li.isFocusable(a)||(a=r.getFocusRevertTarget()),r._isRevertingFocus=!0,a&&li.isFocusable(a)?(a._isRevertingFocus=!0,a.focus({preventScroll:!0}),a._isRevertingFocus=!1):null==i||i.blur(),r._isRevertingFocus=!1)}},{key:"getFocusRevertTarget",value:function(){var e=this,n=e.owner,r=e.focusInEvent,i=r&&r.backwards?1:-1,a=r&&r.relatedTarget,o=a&&t.fromElement(a);if(n&&!n.isDestroyed&&(!a||!li.isFocusable(a)||o&&!o.isFocusable)){var l;if(a=null,n.eachWidget){var s=[];if(n.eachWidget((function(t){(t===e||t.isFocusable)&&s.push(t)}),!1),s.length>1){var u=s.indexOf(e);a=s[u+i]||s[u-i]}}!a&&n.isFocusable&&(a=n),a=a?a.focusElement:null===(l=n.getFocusRevertTarget)||void 0===l?void 0:l.call(n)}return a}},{key:"getStaticWidgetClasses",value:function(e,t){var n,r,i,a,o,l=new Ct,s=this.$meta.hierarchy;for(r=s.indexOf(e);r<s.length;++r){var u;n=s[r],null!==(u=o=Reflect.getOwnPropertyDescriptor(n.prototype,"widgetClass"))&&void 0!==u&&u.get?a=o.get.call(this):(((i=Co(n,"$$name")||Co(n,"$name")||Co(n,"_$name")?n.$$name:n.name).length<3||i.includes("$"))&&console.warn('Class "'.concat(i,'" extending "').concat(n.$name,'" should have "$name" static getter with no less than 3 chars.')),a="b-".concat(i.toLowerCase())),a&&l.add(t?a+t:a)}return l}},{key:"rootUiClass",get:function(){return t}},{key:"staticClassList",get:function(){var e=this.$meta,n=e.staticClassList;return n||(e.staticClassList=n=this.getStaticWidgetClasses(t),ne.isTouchDevice&&n.add("b-touch")),n}},{key:"uiClasses",get:function(){return this.getConfig("ui"),this._uiClasses}},{key:"uiClassList",get:function(){return this.getConfig("ui"),this._uiClassList}},{key:"widgetClassList",get:function(){var e=this,t=e.cls,n=e.defaultCls,r=e.uiClasses,i=e.staticClassList;(n||t)&&(i=i.clone(),n&&i.assign(n),t&&i.assign(t));var a=i.values;return r&&a.push.apply(a,z(r)),e.floating&&a.push("b-floating"),"hide"===e.collapsify&&a.push("b-collapsify-hide"),a}},{key:"changeCls",value:function(e){return Ct.from(e)}},{key:"updateCls",value:function(e,t){if(!this.isConfiguring&&!this.isComposable){var n=this.element;t&&Be.getTruthyKeys(t).forEach((function(e){return n.classList.remove(e)})),e.assignTo(n)}}},{key:"changeContentElementCls",value:function(e){return Ct.from(e)}},{key:"changeHtmlCls",value:function(e){return Ct.from(e)}},{key:"changeDefaultCls",value:function(e){return Ct.from(e,!0)}},{key:"updateHideMode",value:function(){this.hasPainted&&this.syncHiddenCls()}},{key:"changeUi",value:function(e){return Ct.from(e)}},{key:"updateUi",value:function(e){var t,n,r,i=null;if(e){var a=this.getStaticWidgetClasses(this.rootUiClass);for(r in e)if(e[r])for(n in a)a[n]&&((i||(i=new Ct))["".concat(n,"-ui-").concat(r)]=1)}this._uiClasses=null===(t=i)||void 0===t?void 0:t.values,this._uiClassList=i}},{key:"fromCache",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i?arguments[2]:this.element;if(!r)return null;var a=this;return null!==(t=a.cache)&&void 0!==t&&t[e]?a.cache[e]:(a.cache||(a.cache={}),a.cache[e]=n?li.children(r,e):r.querySelector(e))}},{key:"emptyCache",value:function(){this.cache&&(this.cache={})}},{key:"changeMasked",value:function(e,n){var r;if("trial"!==(null===(r=this.masked)||void 0===r?void 0:r.type)){if(!0!==e&&""!==e||(e=" "),n&&!n.isDestroyed)"string"==typeof e?(n.text=e,e=n):e?(n.setConfig(e),e=n):n.destroy();else if(e){var i=t.resolveType("mask");(e=i.mergeConfigs(this.maskDefaults,e)).owner=this,e=i.mask(e)}return e||null}}},{key:"onMaskAutoClose",value:function(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}},{key:"mask",value:function(e){return this.masked=e,this.masked}},{key:"unmask",value:function(){this.masked=null}},{key:"onInternalResize",value:function(e,t,n,r,i){this._width=e.offsetWidth,this._height=e.offsetHeight}},{key:"onElementResize",value:function(e,t){var n,r=this,i=r.element,a=null!==(n=r._width)&&void 0!==n?n:r._oldWidth,o=r._height,l=i.offsetWidth,s=i.offsetHeight;r.floating&&t&&r.onFloatingWidgetResize.apply(r,arguments),r.suspendResizeMonitor||a===l&&o===s||(r.onInternalResize(i,l,s,a,o),r.trigger("resize",{width:l,height:s,oldWidth:a,oldHeight:o}))}},{key:"onFloatingWidgetResize",value:function(e,t,n){var r=this,i=r.lastAlignSpec,a=r.constrainTo;if(r.isVisible&&i&&i.target){var o=!t||n.height!==t.height,l=!t||n.width!==t.width,s=a&&!pt.from(a).contains(pt.from(r.element,null,!0));(o&&2!==i.zone||l&&1!==i.zone||s)&&r.requestAnimationFrame((function(){return r.realign()}))}}},{key:"updateScale",value:function(){var e=this,t=e.element,n=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";var r=pt.client(n).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(r,1):r;t.style.transform="scale(".concat(i,")"),t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&r>1&&(e.width=e.configuredWidth*r)}},{key:"onParentElementResize",value:function(e){this.updateScale()}},{key:"parseTRBL",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"px";if("number"==typeof(e=e||0))return["".concat(e).concat(t),"".concat(e).concat(t),"".concat(e).concat(t),"".concat(e).concat(t)];var n=e.split(" "),r=n.length;return 1===r?n[1]=n[2]=n[3]=n[0]:2===r?(n[2]=n[0],n[3]=n[1]):3===r&&(n[3]=n[1]),[isFinite(n[0])?"".concat(n[0]).concat(t):n[0],isFinite(n[1])?"".concat(n[1]).concat(t):n[2],isFinite(n[2])?"".concat(n[2]).concat(t):n[3],isFinite(n[3])?"".concat(n[3]).concat(t):n[4]]}},{key:"documentRoot",get:function(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.documentRoot)||this.element.getRootNode()}},{key:"eventRoot",get:function(){var e,t;return null!==(e=this.element)&&void 0!==e&&e.isConnected?li.getRootElement(this.element):(null===(t=this.owner)||void 0===t?void 0:t.eventRoot)||this._rootElement}},{key:"rootElement",get:function(){var e=this;if(!e._rootElement){var t,n,r=(null===(t=e.owner)||void 0===t?void 0:t.rootElement)||li.getRootElement(e.forElement||(null!==(n=e.element)&&void 0!==n&&n.isConnected?e.element:e.getRenderContext()[0]||e.element));r||(r=document.body),e._rootElement=r}return e._rootElement}},{key:"floatRoot",get:function(){var e=this.rootElement,n=e.floatRoot;if(n)e.contains(n)||e.appendChild(n);else{var i,a=t.outerCls,o=null===(i=li.getThemeInfo(null,e))||void 0===i?void 0:i.name;if(!li.isValidFloatRootParent(e))throw new Error("Attaching float root to wrong root");o&&a.push("b-theme-".concat(o.toLowerCase())),n=e.floatRoot=li.createElement({className:"b-float-root ".concat(a.join(" ")),parent:e}),so.push(n),ne.isAndroid&&(n.style.height="100dvh",fr.on({element:r,orientationchange:function(){return n.style.height="".concat(screen.height,"px")},thisObj:this})),Wn.ion({theme:function(e){var t=e.theme,r=e.prev;n.classList.add("b-theme-".concat(t.toLowerCase())),n.classList.remove("b-theme-".concat(r.toLowerCase()))}})}return n.classList.toggle("b-rtl",Boolean(this.rtl)),n}},{key:"floatRootMaxZIndex",get:function(){var e=1;return Array.from(this.floatRoot.children).forEach((function(t){var n=parseInt(getComputedStyle(t).zIndex||0,10);n>e&&(e=n)})),e}},{key:"focusVisible",get:function(){return li.getActiveElement(this.element).matches(":focus-visible")}},{key:"isAnimating",get:function(){return this._isAnimatingCounter>0},set:function(e){var t=this,n=t._isAnimatingCounter;t._isAnimatingCounter=Math.max(0,n+(e?1:-1)),0===n&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):1!==n||e||(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}},{key:"waitForAnimations",value:(o=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAnimating){e.next=3;break}return e.next=3,this.await("animationEnd",{checkLog:!1});case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"executeAndAwaitAnimations",value:(n=f(L().mark((function e(t,n){var r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getAnimations({subtree:!0}),e.next=3,n();case 3:if(i=t.getAnimations({subtree:!0}),a=$e.delta(r,i).onlyInB,!(o=a.filter((function(e){return e.effect.getTiming().iterations!==1/0}))).length){e.next=7;break}return e.next=7,Promise.allSettled(o.map((function(e){return e.finished})));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"triggerFieldChange",value:function(e){var t,n=this;!(arguments.length>1&&arguments[1]!==i)||arguments[1]?this.trigger("change",e):e.source=this,null===(t=this.eachAncestor)||void 0===t||t.call(this,(function(t){var r,i;if(null===(r=t.onFieldChange)||void 0===r||r.call(t,e),null!==(i=t.isolateFieldChange)&&void 0!==i&&i.call(t,n))return!1}))}},{key:"isolateFieldChange",value:function(e){return this.isolateFields}},{key:"setupFocusListeners",value:function(){Wn.setupFocusListenersOnce(this.eventRoot,fr)}},{key:"changeDock",value:function(e){return"start"===e?"left":"end"===e?"right":e}},{key:"updateRtl",value:function(e){B(t,"updateRtl",this,3)([e]),this.eachWidget((function(t){"rtl"in t.initialConfig||(t.rtl=e)})),this.ownedWidgets&&Object.values(this.ownedWidgets).forEach((function(t){"rtl"in t.initialConfig||(t.rtl=e)}))}},{key:"scrollAction",get:function(){var e=this._scrollAction;return!e&&this.anchor&&(e="realign"),e}},{key:"announceAriaLive",value:function(e){var t;null!==(t=this.element)&&void 0!==t&&t.isConnected&&(this.ariaLiveEl||(this.ariaLiveEl=li.createElement({parent:this.element,class:"b-arialive-el","aria-live":"polite"})),this.ariaLiveEl.textContent=(null==e?void 0:e.text)||e)}}],[{key:"mergeCls",value:function(e,t){return t&&e?e=new Ct(t).assign("string"==typeof e?new Ct(e):e):e&&!e.isDomClassList&&(e=new Ct(e)),e}},{key:"configurable",get:function(){return{element:!0,callOnFunctions:!0,hideMode:{$config:null,default:"display"},id:null,html:{$config:"lazy",value:null},content:{$config:"lazy",value:null},cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},floating:null,positionable:null,positioned:null,draggable:{$config:["lazy","nullify"],value:null},align:{$config:{merge:To},value:"t-b"},centered:null,constrainTo:i,anchor:null,owner:{$config:["lazy","nullify"],value:null},scrollAction:null,hideAnimation:{$config:{merge:mo},value:null},showAnimation:{$config:{merge:mo},value:null},top:null,right:null,bottom:null,left:null,x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:Oa,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription","dataset.text"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:{lazy:!0,default:null},value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaLive:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50},maximizeOnMobile:null,twinForwardEvents:{$config:{merge:"classList"},value:null},twinSyncConfigs:{$config:{merge:"classList"},value:["disabled"]}}}},{key:"prototypeProperties",get:function(){return{hasGeneratedId:!1,hasPainted:!1,innerItem:!0}}},{key:"declarable",get:function(){return["renderConfigs"]}},{key:"delayable",get:function(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}},{key:"factoryable",get:function(){return{defaultType:"widget"}}},{key:"identifiable",get:function(){return{}}},{key:"all",get:function(){return B(t,"all",this)}},{key:"recomposeAsync",get:function(){return t._recomposeAsync},set:function(e){if(t._recomposeAsync=e,null!=e)for(var n=t.all,r=0;r<n.length;++r)n[r].isComposable&&(n[r].recomposeAsync=e)}},{key:"setupRenderConfigs",value:function(e,t){var n=t.getInherited("renderConfigs"),r=e.renderConfigs;if(r){if(Array.isArray(r)){var i,a=D(r);try{for(a.s();!(i=a.n()).done;){n[i.value]=!0}}catch(e){a.e(e)}finally{a.f()}}else Be.assign(n,r);n[fo]=null}}},{key:"weightSortFn",value:function(e,t){var n=e.weight,r=t.weight;return"string"==typeof n||"string"==typeof r?String(n).localeCompare(String(r)):(null!=n?n:Number.MAX_SAFE_INTEGER)-(null!=r?r:Number.MAX_SAFE_INTEGER)}},{key:"focusVisible",get:function(){return li.getActiveElement().matches(":focus-visible")}},{key:"floatRoots",get:function(){return so}},{key:"removeFloatRoot",value:function(e){so.splice(so.indexOf(e),1)}},{key:"outerCls",get:function(){var e=["b-outer"],t=ne.platform;return t&&e.push("b-".concat(t)),ne.isTouchDevice&&e.push("b-touch-events"),ne.isMobile&&e.push("b-mobile"),li.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),ne.isChrome?e.push("b-chrome"):ne.isSafari?e.push("b-safari"):ne.isFirefox&&e.push("b-firefox"),ne.isPhone&&e.push("b-phone"),r.ResizeObserver||e.push("b-no-resizeobserver"),e}},{key:"query",value:function(e){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=t.identifiable.idMap;for(var a in r)if(t.widgetMatches(r[a],e,n))return r[a];return null}},{key:"queryAll",value:function(e){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=t.identifiable.idMap,a=[];for(var o in r)t.widgetMatches(r[o],e,n)&&a.push(r[o]);return a}},{key:"fromElement",value:function(e,n,r){var i=W(n);e&&!e.nodeType&&(e=e.target),("number"===i||n&&n.nodeType===Element.ELEMENT_NODE)&&(r=n,n=null);var a,o,l,s=e,u=0;for("number"!=typeof r&&(a=r,r=Number.MAX_VALUE),"string"===i&&(n=n.toLowerCase());s&&s.nodeType===Element.ELEMENT_NODE&&u<r&&s!==a;){if(o=s.dataset&&s.dataset.ownerCmp||s.id){if(l=t.getById(o)){if(!n)return l;if("function"===i){if(n(l))return l}else if(t.widgetMatches(l,n,!0))return l}u++}s=Jr(s)}return null}},{key:"fromSelector",value:function(e){var n=document.querySelector(e);return n?t.fromElement(n):null}},{key:"widgetMatches",value:function(e,n,r){return"*"===n||("function"==typeof n?n(e):t.isType(e,n,r))}},{key:"attachTooltip",value:function(e,n){return"string"==typeof n&&(n={html:n}),t.create(Object.assign({forElement:e},n),"tooltip"),e}},{key:"append",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:{};return(n instanceof HTMLElement||"string"==typeof n)&&(n={appendTo:n}),$e.asArray(e).map((function(e){return t.create(Be.assign({},n,e))}))}}]);var n,o,l,s,u,c}(Mn.mixin(Ya,_n,$i,eo,Za,ro,io));S(Lo,"$name","Widget"),S(Lo,"type","widget"),S(Lo,"convertPinchToMousewheel",!0);var Oo=Lo.prototype;["compose","domSyncCallback"].forEach((function(e){return Oo[e].$nullFn=!0})),Lo.initClass(),li.Widget=Lo,Wn.Widget=Lo,Object.assign(r.bryntum||(r.bryntum={}),{Widget:Lo,get:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:r.$0;return e.nodeType?Lo.fromElement(e):Lo.getById(e)},query:Lo.query,queryAll:Lo.queryAll,fromElement:Lo.fromElement,fromSelector:Lo.fromSelector}),Lo._$name="Widget";var Po=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"contentElement",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.contentElement}},{key:"onChildAdd",value:function(e){}},{key:"onChildRemove",value:function(e){}},{key:"renderChildren",value:function(){var e=this,t=e.owner,n=e.itemCls,r=t.contentElement,i=t.items,a=t.itemCls,o=null==i?void 0:i.length;if(o){t.textContent=!1;for(var l,s,u=0;u<o;u++){var c=i[u],d=c.element,h=c.positionable,f=d.classList;d.dataset.itemIndex=u,f.contains("b-outer")&&f.remove.apply(f,z(Lo.outerCls)),n&&f.add(n),a&&f.add(a),s=r,h&&((s=(l=t.getPositionableLocation(h))[0])||(s=l[1].parentElement,c.insertBefore=l[1])),c.render(s,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}},{key:"removeChild",value:function(e){var t=this,n=e.element,r=t.owner,i=t.itemCls,a=r.contentElement,o=r.itemCls;a.contains(n)&&n.remove(),delete n.dataset.itemIndex,i&&n.classList.remove(i),o&&n.classList.remove(o),t.fixChildIndices(),t.syncChildCount()}},{key:"appendChild",value:function(e){var t=e.element,n=this.owner,r=this.itemCls,i=n.contentElement,a=n.itemCls;t.dataset.itemIndex=n.indexOfChild(e),n.textContent=!1,r&&t.classList.add(r),a&&t.classList.add(a),e.render(i,Boolean(n.isPainted)),this.syncChildCount()}},{key:"insertChild",value:function(e,t){var n=this,r=e.element,i=n.owner,a=n.itemCls,o=i.contentElement,l=li.getChild(o,'[data-item-index="'.concat(t,'"]')),s=i.itemCls;i.textContent=!1,a&&r.classList.add(a),s&&r.classList.add(s);var u=o.contains(r);o.insertBefore(r,l),u||e.render(null,Boolean(i.isPainted)),n.fixChildIndices(),n.syncChildCount()}},{key:"fixChildIndices",value:function(){this.owner.items.forEach((function(e,t){e.element.dataset.itemIndex=t}))}},{key:"syncChildCount",value:function(){var e,t=this.owner,n=t.items.length;null===(e=t.contentElement)||void 0===e||e.classList[1===n?"add":"remove"]("b-single-child")}},{key:"syncConfigLater",value:function(e){var t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}},{key:"syncConfigStyle",value:function(e){var t=e.name,n=e.style,r=e.classes,i=e.map,a=this,o="b-box-".concat(t,"-"),l=a.contentElement,s=a[t],u=(null==i?void 0:i[s])||s;if(l){if(r){var c=l.classList;r.forEach((function(e){e!==u&&c.remove(o+e)})),r.includes(u)&&(c.add(o+u),u="")}l.style[n]=u}else a.syncConfigLater(t)}},{key:"syncPendingConfigs",value:function(){var e,t=this,n=t.pendingConfigs;if(n)for(t.pendingConfigs=null;e=n.pop();)t[t.$meta.configs[e].updater](t[e])}}])}(Mn.mixin(_n,Za));S(Po,"type","default"),S(Po,"configurable",{owner:null,containerCls:"b-auto-container",itemCls:null}),S(Po,"factoryable",{defaultType:"default"}),Po.initClass(),Po._$name="Layout";var _o=0,Ho=function(e){return e.ripple},Bo=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]),fr.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}},{key:"onRippleControllingEvent",value:function(e){var t,n=this;n.show();var r=li.getStyleValue(n.circleElement,"animationName");n.hide(),null===(t=n.listenerDetacher)||void 0===t||t.call(n),r&&"none"!==r&&(n.listenerDetacher=fr.on({mousedown:{element:n.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:n.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:n.circleElement,handler:"onAnimationEnd"},thisObj:n}),"mousedown"===e.type&&(n.onMousedown(e),Wn.ion({theme:"onRippleControllingEvent",thisObj:this})))}},{key:"onTouchStart",value:function(e){_o=performance.now(),this.handleTriggerEvent(e)}},{key:"onMousedown",value:function(e){performance.now()-_o>200&&this.handleTriggerEvent(e)}},{key:"handleTriggerEvent",value:function(e){var t=Lo.fromElement(e.target,Ho);if(t){var n=t.ripple,r=n.delegate?e.target.closest(n.delegate):t.focusElement||t.element;if(r){var i=Be.assign({event:e,target:r,radius:this.radius},n);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}},{key:"ripple",value:function(e){var t=e.event,n=e.point,r=void 0===n?fr.getClientPoint(t):n,i=e.target,a=void 0===i?t.target:i,o=e.clip,l=void 0===o?a:o,s=e.radius,u=void 0===s?this.radius:s,c=e.color,d=void 0===c?this.color:c;this.clip=l;var h=this,f=(l=pt.from(l,null,!0)).getDelta(r),v=h.rippleElement.style,g=h.circleElement,m=li.getStyleValue(a,"border-radius");h.hide(),v.transform="translateX(".concat(f[0],"px) translateY(").concat(f[1],"px)"),v.height=v.width="".concat(u,"px"),h.element.style.borderRadius=m,g.setAttribute("r",u),g.setAttribute("fill",d),h.showBy({target:l,align:"c-c",matchSize:!0})}},{key:"onAnimationEnd",value:function(e){"b-ripple-expand"===e.animationName&&this.hide()}}],[{key:"defaultConfig",get:function(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}}])}(Lo);S(Bo,"$name","Ripple"),S(Bo,"type","ripple"),Lo.RippleClass=Bo,Bo._$name="Ripple";var Vo,No,zo=Object.prototype.toString,jo=zo.call(new Date),Wo=new Date,$o=36e5,Uo=function(e,t){return isNaN(e)||null==e?t:e},Go=/([ES]){([^}]+)}/g,Yo=function(e){var t="th";["11","12","13"].find((function(t){return e.endsWith(t)}))||(t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th");return e+t},qo=function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:Dl;return r[e]=r[e]||S({},e,1),r[t]=r[t]||S({},t,1),r[e][t]=n,r[t][e]=1/n,r},Ko=function(e,t,n){return(ol[e]||(ol[e]=new Intl.DateTimeFormat(nl,t))).format(n)},Xo=function(e,t,n){var r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=Ko(e,t,n);return/am|pm/i.test(a)&&(a=a.replace(/^0/,""),r&&(a=a.replace(/:00/,""))),a},Zo=function(e){return e>=0?e:e+7},Jo=/([^\w])(S+)/gm,Qo=function(e,t){return t+"SSS"},el=/[:.\-/\s]/,tl=/^(?:יום |ال)/,nl="en-US",rl=Yo,il={},al={},ol={},ll={},sl={},ul="AM",cl="PM",dl=$o,hl=function(e){var t=fl[e];if(!t)throw new Error("Only international formats should be used here");if(al[e]!==i)return al[e];var n=new Intl.DateTimeFormat(nl,t).formatToParts(new Date(2001,1,2,3,4,5,6)).map((function(e){var n=e.type,r=t[n];return"literal"===n?e.value.replace(/,/g,""):"day"===n?"numeric"===r?"D":"DD":"month"===n?"short"===r?"MMM":"long"===r?"MMMM":"numeric"===r?"M":"MM":"year"===n?"numeric"===r?"YYYY":"YY":void 0})).join("");return al[e]=n},fl={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},vl={M:function(e){return e.getMonth()+1},Mo:function(e){return rl(vl.M(e).toString())},MM:function(e){return(e.getMonth()+1).toString().padStart(2,"0")},MMM:function(e){return Ko("MMM",{month:"short"},e)},MMMM:function(e){return Ko("MMMM",{month:"long"},e)},DC:function(e){return Pl.localize("L{decade}",e)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},Qo:function(e){return rl(vl.Q(e).toString())},D:function(e){return e.getDate()},Do:function(e){return rl(vl.D(e).toString())},DD:function(e){return e.getDate().toString().padStart(2,"0")},DDD:function(e){return Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/Dl.day.millisecond)},DDDo:function(e){return rl(vl.DDD(e).toString())},DDDD:function(e){return vl.DDD(e).toString().padStart(3,"0")},d:function(e){return e.getDay()},do:function(e){return rl(e.getDay().toString())},d1:function(e){return Ko("d1",{weekday:"narrow"},e).substr(0,1)},dd:function(e){return vl.ddd(e).substring(0,2)},ddd:function(e){var t;return Vo=Ko("ddd",{weekday:"short"},e),No=null===(t=Vo.match(tl))||void 0===t?void 0:t[0],Vo.substring(No?No.length:0)},dddd:function(e){var t;return Vo=Ko("dddd",{weekday:"long"},e),No=null===(t=Vo.match(tl))||void 0===t?void 0:t[0],Vo.substring(No?No.length:0)},u:function(e){var t=(ol.u||(ol.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}))).formatToParts(e);return"".concat(t[4].value).concat(t[2].value).concat(t[0].value,"Z")},uu:function(e){var t=(ol.uu||(ol.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))).formatToParts(e);return"".concat(t[4].value).concat(t[2].value).concat(t[0].value,"T").concat(t[6].value).concat(t[8].value).concat(t[10].value,"Z")},e:function(e){return e.getDay()},E:function(e){return e.getDay()+1},W:function(e){return Pl.getWeekNumber(e)[1]},Wo:function(e){return rl(vl.W(e).toString())},WW:function(e){return vl.W(e).toString().padStart(2,"0")},Wp:function(e){return"".concat(Pl.localize("L{Week}")," ").concat(vl.W(e))},WWp:function(e){return"".concat(Pl.localize("L{Week}")," ").concat(vl.WW(e))},Wp0:function(e){return"".concat(Pl.localize("L{Week}")[0]).concat(vl.W(e))},WWp0:function(e){return"".concat(Pl.localize("L{Week}")[0]).concat(vl.WW(e))},Y:function(e){return e.getFullYear()},YY:function(e){return(e.getFullYear()%100).toString().padStart(2,"0")},YYYY:function(e){return e.getFullYear()},A:function(e){return(e.getHours()<12?ul:cl).toLocaleUpperCase()},a:function(e){return(e.getHours()<12?ul:cl).toLocaleLowerCase()},H:function(e){return e.getHours()},HH:function(e){return e.getHours().toString().padStart(2,"0")},h:function(e){return e.getHours()%12||12},hh:function(e){return vl.h(e).toString().padStart(2,"0")},k:function(e){return e.getHours()||24},kk:function(e){return vl.k(e).toString().padStart(2,"0")},K:function(e){return Xo("K",{hour:"numeric"},e)},KK:function(e){return Xo("KK",{hour:"2-digit"},e)},m:function(e){return e.getMinutes()},mm:function(e){return vl.m(e).toString().padStart(2,"0")},s:function(e){return e.getSeconds()},ss:function(e){return vl.s(e).toString().padStart(2,"0")},S:function(e){return Math.floor(e.getMilliseconds()/100).toString()},SS:function(e){return Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0")},SSS:function(e){return e.getMilliseconds().toString().padStart(3,"0")},z:function(e){return Ko("z",{timeZoneName:"short"},e)},zz:function(e){return Ko("zz",{timeZoneName:"long"},e)},Z:function(e){return _l.getGMTOffset(e)},LT:function(e){return Xo("LT",{hour:"2-digit",minute:"2-digit"},e)},LST:function(e){return Xo("LST",{hour:"numeric",minute:"2-digit"},e,!0)},LTS:function(e){return Xo("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e)},L:function(e){return Ko("L",{year:"numeric",month:"2-digit",day:"2-digit"},e)},l:function(e){return Ko("l",fl.l,e)},LL:function(e){return Ko("LL",{year:"numeric",month:"long",day:"numeric"},e)},ll:function(e){return Ko("ll",fl.ll,e)},LLL:function(e){return Ko("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e)},lll:function(e){return Ko("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e)},LLLL:function(e){return Ko("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e)},llll:function(e){return Ko("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)}},gl=Object.keys(vl).sort((function(e,t){return t.length-e.length})),ml="^(?:".concat(gl.join("|"),")"),pl=function(){return{}},yl=function(e){return function(e){return Al.test(e)}(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))}},kl={YYYY:function(e){var t=parseInt(e);return{year:t>=1e3&&t<=9999?t:NaN}},Y:function(e){return{year:parseInt(e)}},YY:function(e){var t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},M:function(e){return{month:parseInt(e)-1}},MM:function(e){return{month:parseInt(e)-1}},Mo:function(e){return{month:parseInt(e)-1}},MMM:function(e){for(var t=(e||"").toLowerCase(),n=0,r=Object.entries(Pl._monthShortNamesIndex);n<r.length;n++){var i=_(r[n],2),a=i[0],o=i[1];if(t.startsWith(a))return{month:o.value}}},MMMM:function(e){for(var t=(e||"").toLowerCase(),n=0,r=Object.entries(Pl._monthNamesIndex);n<r.length;n++){var i=_(r[n],2),a=i[0],o=i[1];if(t.startsWith(a))return{month:o.value}}},DD:function(e){return{date:parseInt(e)}},D:function(e){return{date:parseInt(e)}},Do:function(e){return{date:parseInt(e)}},DDD:pl,DDDo:pl,DDDD:pl,d:pl,do:pl,d1:pl,dd:pl,ddd:pl,dddd:pl,Q:pl,Qo:pl,W:pl,Wo:pl,WW:pl,e:pl,E:pl,HH:function(e){return{hours:parseInt(e)}},hh:function(e){return{hours:parseInt(e)}},mm:function(e){return{minutes:parseInt(e)}},H:function(e){return{hours:parseInt(e)}},m:function(e){return{minutes:parseInt(e)}},ss:function(e){return{seconds:parseInt(e)}},s:function(e){return{seconds:parseInt(e)}},S:yl,SS:yl,SSS:yl,A:function(e){return{amPm:e.toLowerCase()}},a:function(e){return{amPm:e.toLowerCase()}},L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:function(){return hl("l")}},ll:{type:"dynamic",parser:function(){return hl("ll")}},Z:function(e){if(!e||!Il.test(e)&&"Z"!==e)return null;var t=0;if("Z"!==e){var n=Il.exec(e);if(n)t=("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0));else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},bl=Object.keys(kl).sort((function(e,t){return t.length-e.length})),Cl=new RegExp("(".concat(bl.join("|"),")")),wl=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),Dl={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:87648,minute:5258880,second:315532800,millisecond:3155328e5},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/87648,year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/5258880,year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/315532800,year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/3155328e5,year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},Sl={ms:"millisecond",milliseconds:"millisecond",ems:"emillisecond",emilliseconds:"emillisecond",s:"second",seconds:"second",es:"esecond",eseconds:"esecond",m:"minute",mi:"minute",min:"minute",minutes:"minute",em:"eminute",emi:"eminute",emin:"eminute",eminutes:"eminute",h:"hour",hours:"hour",eh:"ehour",ehours:"ehour",d:"day",days:"day",ed:"eday",edays:"eday",w:"week",weeks:"week",ew:"eweek",eweeks:"eweek",M:"month",mo:"month",mon:"month",months:"month",EM:"emonth",eM:"emonth",emo:"emonth",emon:"emonth",emonths:"emonth",q:"quarter",quarters:"quarter",eq:"equarter",equarters:"equarter",y:"year",years:"year",ey:"eyear",eyears:"eyear",dec:"decade",decades:"decade",edec:"edecade",edecades:"edecade"},xl=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,El=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,Rl=["millisecond","emillisecond","second","esecond","minute","eminute","hour","ehour","day","eday","week","eweek","month","emonth","quarter","equarter","year","eyear","decade","edecade"],Tl=[["ms","mil"],["ems","emil"],["s","sec"],["es","esec"],["m","min"],["em","emin"],["h","hr"],["eh","ehr"],["d"],["ed"],["w","wk"],["ew","ewk"],["mo","mon","mnt","M"],["emo","emon","emnt"],["q","quar","qrt"],["eq","equar","eqrt"],["y","yr"],["ey","eyr"],["dec"],["edec"]],Ml=["decade","year","month","week","day","hour","minute","second","millisecond"],Fl=["milliseconds","seconds","minutes","hours","date","month","year"],Al=/^[0-9]+$/,Il=/([+-])(\d\d):*(\d\d)*$/,Ll={millisecond:{magnitude:0,smaller:i,greater:"second"},second:{magnitude:2,smaller:"millisecond",greater:"minute"},minute:{magnitude:4,smaller:"second",greater:"hour"},hour:{magnitude:6,smaller:"minute",greater:"day"},day:{magnitude:8,smaller:"hour",greater:"week"},week:{magnitude:10,smaller:"day",greater:"month"},month:{magnitude:12,smaller:"week",greater:"quarter"},quarter:{magnitude:14,smaller:"month",greater:"year"},year:{magnitude:16,smaller:"quarter",greater:"decade"},decade:{magnitude:18,smaller:"year"},emillisecond:{magnitude:1,smaller:i,greater:"esecond"},esecond:{magnitude:3,smaller:"emillisecond",greater:"eminute"},eminute:{magnitude:5,smaller:"esecond",greater:"ehour"},ehour:{magnitude:7,smaller:"eminute",greater:"eday"},eday:{magnitude:9,smaller:"ehour",greater:"eweek"},eweek:{magnitude:11,smaller:"eday",greater:"emonth"},emonth:{magnitude:12,smaller:"eweek",greater:"equarter"},equarter:{magnitude:14,smaller:"emonth",greater:"eyear"},eyear:{magnitude:16,smaller:"equarter",greater:"edecade"},edecade:{magnitude:18,smaller:"eyear"}},Ol={round:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1;return Math.round(e/t)*t},floor:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1;return Math.floor(e/t)*t},ceil:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1;return Math.ceil(e/t)*t}};qo("edecade","millisecond",31104e7),qo("eyear","millisecond",31104e6),qo("equarter","millisecond",7776e6),qo("emonth","millisecond",2592e6),qo("eweek","millisecond",6048e5),qo("eday","millisecond",864e5),qo("ehour","millisecond",36e5),qo("eminute","millisecond",6e4),qo("esecond","millisecond",1e3),qo("emillisecond","millisecond",1e3);var Pl=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultFormat",get:function(){return _l._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"},set:function(e){_l._defaultFormat=e}},{key:"defaultParseFormat",get:function(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"},set:function(e){this._defaultParseFormat=e}},{key:"today",get:function(){return t.clearTime(new Date,!1)}},{key:"tomorrow",get:function(){return t.add(t.today,1,"day")}},{key:"yesterday",get:function(){return t.add(t.today,-1,"day")}},{key:"buildParser",value:function(e){var t=this,n=e.split(Cl),r=[];return 1===n.length||wl.test(e)?[]:(n.reduce((function(n,i,a,o){if(0!==a||""!==i)if(Cl.test(i)){var l=(t.localize("L{parsers}")||{})[i]||kl[i];if("Z"===i&&a<o.length-2)throw new Error("Invalid format ".concat(e," TimeZone (Z) must be last token"));var s="function"==typeof l||"string"==typeof l?l:l.parser();if("string"==typeof s){var u=_l.buildParser(s),c=u.pop();delete c.last,r.push.apply(r,z(u)),n=c}else n.pattern=i,n.fn=s}else n.splitter=i,r.push(n),n={};else Object.prototype.hasOwnProperty.call(n,"pattern")&&r.push(n);return n}),{}),r[r.length-1].last=!0,r)}},{key:"makeKey",value:function(e){if(10===e.length)return e;e.getTime&&(e=e.getTime());var t=sl[Math.trunc(e/dl)];if(t)return t;Wo.setTime(e);var n=Wo.getMonth()+1,r=Wo.getDate();return sl[Math.trunc(e/dl)]="".concat(Wo.getFullYear(),"-").concat(n<10?"0"+n:n,"-").concat(r<10?"0"+r:r)}},{key:"parseKey",value:function(e){var t="-"===(null==e?void 0:e[0]),n=_l.parse(t?e.slice(1):e,"YYYY-MM-DD");return t&&n.setFullYear(-n.getFullYear()),n}},{key:"parse",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:_l.defaultParseFormat,n=arguments.length>2&&arguments[2]!==i&&arguments[2];if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;var r={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(Jo,Qo);var a=ll[t],o=null;if(a||(a=ll[t]=_l.buildParser(t)),e.includes(" ")&&(e=e.replace(/\s/g," ")),a.reduce((function(e,t){if(!t.last){var i,a,o;if("T"===t.splitter&&-1===e.indexOf("T"))i=e.indexOf(" ");else{var l,s=e.indexOf("+"),u=t.splitter;!n&&el.test(u)&&(u=el),i=""!==t.splitter?e.search("string"==typeof u?Le.escapeRegExp(u):u):(null===(l=t.pattern)||void 0===l?void 0:l.length)||-1,s>-1&&i>s&&(i=-1)}if(-1===i||"SSS"===t.pattern&&e.match(/^\d+Z$/)){var c=e.split(/([Z\-+])/);1===c.length?(a=e,o=""):(a=c[0],o="".concat(c[1]).concat(c[2]))}else a=e.substring(0,i)||e,o=e.substring(i+t.splitter.length);if(t.fn){var d=t.fn(a);d?Object.assign(r,d):o=a+o}return o}Object.assign(r,t.fn(e))}),e),r.year&&!r.date&&(r.date=1),r.date>31||r.month>12)return null;var l=_l.create(r,n);return l?o=l:!n&&e.length>3&&(o=new Date(e)).getFullYear()<1900&&(o=null),o}},{key:"create",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=F({},e),r=isNaN(n.year)||t&&(isNaN(n.month)||isNaN(n.date)),a=!1;if(!r){var o=!0;Fl.forEach((function(e){e in n&&!isNaN(n[e])||(n[e]=0),o=o&&null===n[e]})),r=o}if(r)return null;if("am"===n.amPm?n.hours=n.hours%12:"pm"===n.amPm&&(n.hours=n.hours%12+12),"timeZone"in n&&(a=!0,n.minutes-=n.timeZone),t&&(null==n.year||null==n.month||null==n.date))return null;var l=[Uo(n.year,2020),Uo(n.month,0),Uo(n.date,1),n.hours,n.minutes,n.seconds,n.milliseconds];return a?new Date(Date.UTC.apply(Date,l)):b(Date,l)}},{key:"toUTC",value:function(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}},{key:"format",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:_l.defaultFormat;if(!e||isNaN(e))return null;if("function"==typeof t)return t(e);var n=il[t],r="";if(!n){n=il[t]=[];for(var a=0;a<t.length;a++){var o=t.slice(a).match(ml),l=null==o?void 0:o[0];if(l){var s=(this.localize("L{formats}")||{})[l]||vl[l];n.push(s),a+=l.length-1}else if("{"===t[a]){var u=t.indexOf("}",a+1);-1===u?(n.push(t.substr(a+1)),a=t.length):(n.push(t.substring(a+1,u)),a=u)}else n.push(t[a])}}return n.forEach((function(t){r+="string"==typeof t?t:t(e)})),r}},{key:"formatRange",value:function(e,n){return n.replace(Go,(function(n,r,i){return t.format(e["S"===r?0:1],i)}))}},{key:"asMilliseconds",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;return"string"==typeof e&&(t=e,e=1),_l.as("millisecond",e,t)}},{key:"asMonths",value:function(e){var t=_l.as("ms",_l.daysInMonth(e),"day"),n=(e.valueOf()-_l.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+n}},{key:"monthsToDate",value:function(e){var t=Math.floor(e),n=e-t,r=new Date(0,t),i=_l.as("ms",_l.daysInMonth(r),"days");return r.setTime(r.getTime()+n*i),r}},{key:"formatDelta",value:function(e,t){var n,r,i=", ";"boolean"==typeof t?n=t:t&&(n=t.abbrev,i=t.unitSeparator||i);var a=this.getDelta(e,t),o=[],l=(null==t?void 0:t.separator)||(n?"":" ");for(r in a)o.push("".concat(a[r]).concat(l).concat(r));return!1===(null==t?void 0:t.asString)?o:o.join(i)}},{key:"getDelta",value:function(e,t){var n,r,i,a,o,l,s;"boolean"==typeof t?n=t:t&&(n=t.abbrev,a=_l.normalizeUnit(t.precision),l=t.maxUnit,s=!n&&t.ignoreLocale);var u,c={},d=n?_l.getShortNameOfUnit:_l.getLocalizedNameOfUnit,h=D(l?Ml.slice(Ml.indexOf(l)):Ml);try{for(h.s();!(u=h.n()).done&&(o=u.value,r=_l.as(o,e),i=a===o,((r=Math[i?"round":"floor"](r))||i&&!c.length)&&(c[s?o:d.call(_l,o,1!==r)]=r,e-=_l.as("ms",r,o)),!i&&e););}catch(e){h.e(e)}finally{h.f()}return c}},{key:"as",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:"ms";return"string"==typeof t&&(t=_l.parseDuration(t)),"object"===W(t)&&(n=t.unit,t=t.magnitude),e!==n&&n&&e?(e=_l.normalizeUnit(e))===(n=_l.normalizeUnit(n))?t:Ll[n].magnitude>Ll[e].magnitude?t*Math.abs(Dl[n][e]):t/Math.abs(Dl[e][n]):t}},{key:"formatContainsHourInfo",value:function(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}},{key:"is24HourFormat",value:function(e){return _l.format(_l.getTime(13,0,0),e).includes("13")}},{key:"add",value:function(e,n){var r,a=arguments.length>2&&arguments[2]!==i?arguments[2]:"ms",o=!(arguments.length>3&&arguments[3]!==i)||arguments[3];if(r="string"==typeof e?_l.parse(e):o?new Date(e.getTime()):e,"string"==typeof n){var l=t.parseDuration(n);n=l.magnitude,a=l.unit}else n&&"object"===W(n)&&(a=n.unit,n=n.magnitude);if(!a||0===n)return r;switch(a=_l.normalizeUnit(a)){case"millisecond":r.setTime(r.getTime()+n);break;case"second":r.setTime(r.getTime()+1e3*n);break;case"minute":r.setTime(r.getTime()+6e4*n);break;case"hour":r.setTime(r.getTime()+36e5*n);break;case"day":n%1==0?(r.setDate(r.getDate()+n),23===r.getHours()&&0===e.getHours()&&r.setHours(r.getHours()+1)):r.setTime(r.getTime()+864e5*n);break;case"week":r.setDate(r.getDate()+7*n);break;case"month":var s=r.getDate();s>28&&(s=Math.min(s,_l.getLastDateOfMonth(_l.add(_l.getFirstDateOfMonth(r),n,"month")).getDate())),r.setDate(s),r.setMonth(r.getMonth()+n);break;case"quarter":_l.add(r,3*n,"month",!1);break;case"year":_l.add(r,12*n,"month",!1);break;case"decade":r.setFullYear(r.getFullYear()+10*n)}return r}},{key:"diff",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:"ms",a=!(arguments.length>3&&arguments[3]!==i)||arguments[3];if(r=_l.normalizeUnit(r),!e||!t)return 0;switch(r){case"year":n=_l.diff(e,t,"month")/12;break;case"quarter":n=_l.diff(e,t,"month")/3;break;case"month":0===(n=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth()))&&a&&(n=_l.diff(e,t,"day",a)/_l.daysInMonth(e));break;case"week":n=_l.diff(e,t,"day")/7;break;case"day":var o=e.getTimezoneOffset()-t.getTimezoneOffset();n=(t-e+60*o*1e3)/864e5;break;case"hour":n=(t-e)/36e5;break;case"minute":n=(t-e)/6e4;break;case"second":n=(t-e)/1e3;break;case"millisecond":n=t-e}return a?n:Math.round(n)}},{key:"startOf",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"day",n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=arguments.length>3&&arguments[3]!==i?arguments[3]:_l.weekStartDay;if(!e)return null;switch(t=_l.normalizeUnit(t),n&&(e=_l.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth(3*(_l.get(e,"quarter")-1),1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":var a=e.getDay()-r;return a<0&&(a+=7),e.setDate(e.getDate()-a),e.setHours(0,0,0,0),e;case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}},{key:"endOf",value:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}},{key:"clone",value:function(e){return new Date(e.getTime())}},{key:"clearTime",value:function(e){return e?((!(arguments.length>1&&arguments[1]!==i)||arguments[1])&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}},{key:"midnight",value:function(e,t){var n=_l.clearTime(e);return t&&n<e&&(n=_l.add(n,1,"d")),n}},{key:"isMidnight",value:function(e){return _l.midnight(e).getTime()===e.getTime()}},{key:"getTimeOfDay",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"ms",n=e.getHours()*Dl.hour.millisecond+e.getMinutes()*Dl.minute.millisecond+e.getSeconds()*Dl.second.millisecond+e.getMilliseconds();return"ms"===t?n:_l.as(t,n,"ms")}},{key:"set",value:function(e,t,n){if(!t)return e;if("string"==typeof t)switch(_l.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort((function(e,t){var n=e[0],r=t[0],i=Ll["date"===r?"day":r];return Ll["date"===n?"day":n].magnitude-i.magnitude})).forEach((function(t){var n=_(t,2),r=n[0],i=n[1];_l.set(e,r,i)}));return e}},{key:"setDateToMidday",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return _l.set(_l.clearTime(e,t),"hour",12)}},{key:"constrain",value:function(e,t,n){return null!=t&&(e=_l.max(e,t)),null==n?e:_l.min(e,n)}},{key:"getTime",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:0,n=arguments.length>2&&arguments[2]!==i?arguments[2]:0,r=arguments.length>3&&arguments[3]!==i?arguments[3]:0;return e instanceof Date&&(r=e.getMilliseconds(),n=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,n,r)}},{key:"copyTimeValues",value:function(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}},{key:"combineDateAndTime",value:function(e,n){return t.copyTimeValues(new Date(e),n)}},{key:"isDSTEnabled",get:function(){var e=(new Date).getFullYear(),t=new Date(e,0,1),n=new Date(e,6,1);return t.getTimezoneOffset()!==n.getTimezoneOffset()}},{key:"isDST",value:function(e){var t=e.getFullYear(),n=new Date(t,0,1),r=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(n.getTimezoneOffset(),r.getTimezoneOffset())}},{key:"isBefore",value:function(e,t){return e<t}},{key:"isAfter",value:function(e,t){return e>t}},{key:"isEqual",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:null;return null===n?e&&t&&e.getTime()===t.getTime():_l.startOf(e,n)-_l.startOf(t,n)==0}},{key:"compare",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:null;return n&&(e=_l.startOf(e,n),t=_l.startOf(t,n)),e<t?-1:e>t?1:0}},{key:"clamp",value:function(e,t,n){if(!isNaN(e))return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),new Date(e)}},{key:"isSameDate",value:function(e,t){return 0===_l.compare(e,t,"d")}},{key:"isSameTime",value:function(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()&&e.getMilliseconds()===t.getMilliseconds()}},{key:"isStartOf",value:function(e,t){return _l.isEqual(e,_l.startOf(e,t))}},{key:"betweenLesser",value:function(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}},{key:"betweenLesserEqual",value:function(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}},{key:"intersectSpans",value:function(e,t,n,r){return _l.betweenLesser(e,n,r)||_l.betweenLesser(n,e,t)}},{key:"compareUnits",value:function(e,t){var n=Ll[_l.normalizeUnit(e)],r=Ll[_l.normalizeUnit(t)];return Math.sign(((null==n?void 0:n.magnitude)||0)-((null==r?void 0:r.magnitude)||0))}},{key:"timeSpanContains",value:function(e,t,n,r){return n-e>=0&&t-r>=0}},{key:"amIndicator",get:function(){return ul}},{key:"pmIndicator",get:function(){return cl}},{key:"weekStartDay",get:function(){return null==_l._weekStartDay&&(_l._weekStartDay=this.localize("L{weekStartDay}")||0),_l._weekStartDay}},{key:"nonWorkingDays",get:function(){return F({},this.localize("L{nonWorkingDays}"))}},{key:"nonWorkingDaysAsArray",get:function(){return Object.keys(this.nonWorkingDays).map(Number)}},{key:"weekends",get:function(){return F({},this.localize("L{weekends}"))}},{key:"get",value:function(e,t){switch(_l.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return vl.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}},{key:"daysInYear",value:function(e){var t=e.getFullYear(),n=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",n)}},{key:"daysInMonth",value:function(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}},{key:"hoursInDay",value:function(e){var t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=new Date(t,n,r+1)-new Date(t,n,r);return this.as("hour",i)}},{key:"getNormalizedUnitDuration",value:function(e,t){var n;switch(t){case"month":n=_l.asMilliseconds(_l.daysInMonth(e),"day");break;case"year":n=_l.asMilliseconds(_l.daysInYear(e),"day");break;case"day":n=_l.asMilliseconds(_l.hoursInDay(e),"hour");break;default:n=_l.asMilliseconds(t)}return n}},{key:"getFirstDateOfMonth",value:function(e){return new Date(e.getFullYear(),e.getMonth(),1)}},{key:"getLastDateOfMonth",value:function(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}},{key:"min",value:function(e,t){return e.getTime()<t.getTime()?e:t}},{key:"max",value:function(e,t){return e.getTime()>t.getTime()?e:t}},{key:"getNext",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:1,r=arguments.length>3&&arguments[3]!==i?arguments[3]:_l.weekStartDay;if("week"===t){var a=_l.clone(e),o=a.getDay();return _l.startOf(a,"day",!1),_l.add(a,r-o+7*(n-(r<=o?0:1)),"day",!1),a.getDay()!==r&&_l.add(a,1,"hour"),a}return _l.startOf(_l.add(e,n,t),t,!1)}},{key:"isValidDate",value:function(e){return _l.isDate(e)&&!isNaN(e)}},{key:"isDate",value:function(e){return e&&zo.call(e)===jo}},{key:"getStartOfNextDay",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=_l.add(n?e:_l.clearTime(e,t),1,"day");if(r.getDate()===e.getDate()){var a=_l.add(_l.clearTime(e,t),2,"day").getTimezoneOffset(),o=e.getTimezoneOffset();r=_l.add(r,o-a,"minute")}return r}},{key:"getEndOfPreviousDay",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1]?e:_l.clearTime(e,!0);return t-e?t:_l.add(t,-1,"day")}},{key:"getWeekDescription",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:e,r=e.getMonth()===n.getMonth()?t.format(e,"MMMM"):"".concat(t.format(e,"MMM")," - ").concat(t.format(n,"MMM")),a=t.getWeekNumber(e);return"".concat(a[1],", ").concat(r," ").concat(a[0])}},{key:"getWeekNumber",value:function(e){var n,r,a,o=arguments.length>1&&arguments[1]!==i?arguments[1]:t.weekStartDay,l=new Date(e.getFullYear(),0,1),s=new Date(e.getFullYear(),11,31),u=Zo(l.getDay()-o),c=Zo(s.getDay()-o),d=(n=e,r=l,Math.floor((n.getTime()-r.getTime()-(n.getTimezoneOffset()-r.getTimezoneOffset())*Dl.minute.millisecond)/Dl.day.millisecond)+1);if(a=u<4?Math.floor((d+u-1)/7)+1:Math.floor((d+u-1)/7)){var h=e.getFullYear();return 53===a&&c<3&&(h++,a=1),[h,a]}var f=t.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,f]}},{key:"getDateFromISOWeek",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:1,r=new Date(e,0,1+7*(t-1)),a=r.getDay(),o=n-(0===a?7:a);return r.setDate(r.getDate()+o),r}},{key:"formatCount",value:function(e,t){return t=_l.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}},{key:"getUnitToBaseUnitRatio",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];return(e=_l.normalizeUnit(e))===(t=_l.normalizeUnit(t))?1:Dl[e]&&Dl[e][t]&&(n||Dl[e][t]>0)?1/_l.as(t,1,e):Dl[t]&&Dl[t][e]&&(n||Dl[t][e]>0)?_l.as(e,1,t):-1}},{key:"getShortNameOfUnit",value:function(e){return e=_l.parseTimeUnit(e),_l.unitLookup[e].abbrev}},{key:"getLocalizedNameOfUnit",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=e.charAt(0)===e.charAt(0).toUpperCase();return e=_l.normalizeUnit(e),e=_l.parseTimeUnit(e),e=_l.unitLookup[e][t?"plural":"single"],n&&(e=Le.capitalize(e)),e}},{key:"normalizeUnit",value:function(e){if(!e)return null;var t=e.toLowerCase();return"date"===t||Rl.includes(t)?t:Sl[e]||Sl[t]}},{key:"getUnitByName",value:function(e){return _l.normalizeUnit(e)||_l.normalizeUnit(_l.parseTimeUnit(e))}},{key:"getDurationInUnit",value:function(e,t,n,r){return _l.diff(e,t,n,r)}},{key:"doesUnitsAlign",value:function(e,t){return!(e!==t&&"week"===t)}},{key:"getSmallerUnit",value:function(e){var t,n;e=_l.normalizeUnit(e);var r=null===(t=Ll[e])||void 0===t?void 0:t.smaller;return Rl[null===(n=Ll[r])||void 0===n?void 0:n.magnitude]||null}},{key:"getLargerUnit",value:function(e){var t,n;e=_l.normalizeUnit(e);var r=null===(t=Ll[e])||void 0===t?void 0:t.greater;return Rl[null===(n=Ll[r])||void 0===n?void 0:n.magnitude]||null}},{key:"round",value:function(e,t,n,r){return _l.snap("round",e,t,n,r)}},{key:"floor",value:function(e,t,n,r){return _l.snap("floor",e,t,n,r)}},{key:"ceil",value:function(e,t,n,r){return _l.snap("ceil",e,t,n,r)}},{key:"snap",value:function(e,t,n,r){var a=arguments.length>4&&arguments[4]!==i?arguments[4]:_l.weekStartDay,o=Ol[e];if("string"==typeof n&&(n=_l.parseDuration(n)),pe.isObject(n)){var l=n.magnitude||n.increment;switch(n.unit){case"week":if(!r){var s=t.getDay();r=_l.add(_l.clearTime(t),s>=a?a-s:-(s-a+7),"day")}return _l[e](t,"".concat(7*l," days"),r);case"month":var u;return t=_l.asMonths(t),u=r?(r=_l.asMonths(r))+o(t-r,l):o(t,l),_l.monthsToDate(u);case"quarter":return _l[e](t,"".concat(3*l," months"),r);case"year":return _l[e](t,"".concat(12*l," months"),r);case"decade":return _l[e](t,"".concat(10*l," years"),r)}n=_l.as("ms",l,n.unit)}var c=1e3*t.getTimezoneOffset()*60;if(r){var d=1e3*r.getTimezoneOffset()*60,h=t-r+d-c,f=new Date(r.getTime()+o(h,n)),v=d-1e3*f.getTimezoneOffset()*60;return v&&_l.add(f,-v,"ms",!1),new Date(f)}return new Date(o(t.valueOf()-c,n)+c)}},{key:"parseDuration",value:function(e){var t,n=arguments.length>2?arguments[2]:i,r=(!(arguments.length>1&&arguments[1]!==i)||arguments[1]?xl:El).exec(e);if(null==e||!r)return null;var a,o,l=(a=null===(t=r[1])||void 0===t?void 0:t.replace(",","."),o=parseFloat(a),isNaN(o)?null:o),s=_l.parseTimeUnit(r[2])||n;return s?{magnitude:l,unit:s}:null}},{key:"parseTimeUnit",value:function(e){var t=null==e?null:_l.durationRegEx.exec(e)||_l.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(var n=0;n<Rl.length;n++)if(t[n+1])return Rl[n]}},{key:"getGMTOffset",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:new Date;if(e){var t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}}},{key:"fillDayNames",value:function(){var e=new Date("2000-01-01T12:00:00"),t=_l._dayNames||[],n=_l._dayShortNames||[];t.length=0,n.length=0;for(var r=2;r<9;r++)e.setDate(r),t.push(_l.format(e,"dddd")),n.push(_l.format(e,"ddd"));_l._dayNames=t,_l._dayShortNames=n}},{key:"getDayNames",value:function(){return _l._dayNames}},{key:"getDayName",value:function(e){return _l._dayNames[e]}},{key:"getDayShortNames",value:function(){return _l._dayShortNames}},{key:"getDayShortName",value:function(e){return _l._dayShortNames[e]}},{key:"fillMonthNames",value:function(){var e=new Date("2000-01-15T12:00:00"),t=_l._monthNames||[],n=_l._monthShortNames||[],r={},i={};t.length=0,n.length=0;for(var a=0;a<12;a++){e.setMonth(a);var o=_l.format(e,"MMMM");t.push(o);var l=_l.format(e,"MMM");n.push(l),r[o.toLowerCase()]={name:o,value:a},i[l.toLowerCase()]={name:l,value:a}}_l._monthNames=t,_l._monthShortNames=n,_l._monthNamesIndex=r,_l._monthShortNamesIndex=i}},{key:"getMonthShortNames",value:function(){return _l._monthShortNames}},{key:"getMonthShortName",value:function(e){return _l._monthShortNames[e]}},{key:"getMonthNames",value:function(){return _l._monthNames}},{key:"getMonthName",value:function(e){return _l._monthNames[e]}},{key:"locale",get:function(){return nl},set:function(e){nl=e,ol={},il={},al={}}},{key:"setupDurationRegEx",value:function(){for(var e=arguments.length>0&&arguments[0]!==i?arguments[0]:[],t=arguments.length>1&&arguments[1]!==i?arguments[1]:[],n=this,r={},a="",o=0;o<t.length;o++){var l=t[o],s=e[o];s.canonicalUnitName=Rl[o],r[s.single]=r[s.single.toUpperCase()]=r[s.canonicalUnitName]=r[s.canonicalUnitName.toUpperCase()]=s,a+="".concat(o?"|":"","(");for(var u=0;u<l.length;u++)a+="".concat(l[u],"|");if("en-US"!==(nl=n.localize("L{locale}")||"en-US"))for(var c=Tl[o],d=0;d<c.length;d++)a+="".concat(c[d],"|");a+="".concat(s.single,"|").concat(s.plural,"|").concat(s.canonicalUnitName,"|").concat(s.canonicalUnitName,"s)")}n.unitLookup=r,n.durationRegEx=new RegExp("^(?:".concat(a,")$"))}},{key:"applyLocale",value:function(){var e=this,t=e.localize("L{unitAbbreviations}")||[],n=e.unitNames=e.localize("L{unitNames}"),r=new Date(2020,6,15,6),i=Math.abs(r.getTimezoneOffset()%60);if("unitNames"!==n){nl=e.localize("L{locale}")||"en-US";var a=ol.a||(ol.a=new Intl.DateTimeFormat(nl,{hour:"numeric",hourCycle:"h12"}));ul=a.formatToParts(r)[2].value,cl=a.formatToParts(new Date(2020,6,15,18))[2].value,rl="en-US"===nl?Yo:e.localize("L{ordinalSuffix}")||rl,il={},al={},ll={},ol={},sl={},dl=6e4*(!i||i>30?60-i:i),_l._weekStartDay=null,_l.setupDurationRegEx(n,t),_l.fillDayNames(),_l.fillMonthNames()}}}])}(Ya());S(Pl,"MS_PER_DAY",864e5),S(Pl,"$name","DateHelper"),te.register(Pl);var _l=Pl;_l.useIntlFormat=Ko,Na.ion({locale:"applyLocale",prio:1e3,thisObj:_l}),Na.locale&&_l.applyLocale();var Hl=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isDateSet",get:function(){return!0}},{key:"add",value:function(e){return e=Pl.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),B(t,"add",this,3)([e])}},{key:"delete",value:function(e){return e=Pl.makeKey(e),this.has(e)&&this.generation++,B(t,"delete",this,3)([e])}},{key:"has",value:function(e){return B(t,"has",this,3)([Pl.makeKey(e)])}},{key:"clear",value:function(){return this.size&&this.generation++,B(t,"clear",this,3)([])}},{key:"equals",value:function(e){return Array.isArray(e)&&(e=new t(e)),e.size===this.size&&z(this).every((function(t){return e.has(t)}))}},{key:"dates",get:function(){return z(this).sort().map((function(e){return Pl.parseKey(e)}))}}])}(Y(o));Pl.DateSet=Hl,Pl._$name="DateHelper";var Bl=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Vl=null;var Nl=function(){return w((function e(t){m(this,e),this.formatter=t}),[{key:"format",value:function(e){return this.formatter.defaultFormat(e)}},{key:"parse",value:function(e,t){return this.formatter.defaultParse(e,t)}},{key:"resolvedOptions",value:function(){return null}}])}(),zl=function(){return w((function e(t){m(this,e);var n=this,r=n.constructor.standardOptions;if(n.cacheKey=Vl,Vl=null,n.initialize(),null===t)n.formatter=new Nl(n);else{n.configure(t);for(var i=0,a=Object.entries(n.resolvedOptions());i<a.length;i++){var o=_(a[i],2),l=o[0],s=o[1];null!=s&&r.includes(l)&&(n[l]=s)}}}),[{key:"parser",get:function(){return e=this,t=new this.constructor.Parser(this),Object.defineProperty(e,"parser",{value:t}),t;var e,t}},{key:"defaultFormat",value:function(e){return null==e?e:String(e)}},{key:"defaultParse",value:function(e){return e}},{key:"format",value:function(e){return null==e?e:this.formatter.format(e)}},{key:"parse",value:function(e,t){return null==e?e:this.parser.parse(e,t)}},{key:"parseStrict",value:function(e){return this.parse(e,!0)}},{key:"resolvedOptions",value:function(){return this.formatter.resolvedOptions()}}],[{key:"get",value:function(e){if(null==e)return this.NULL;if(e instanceof this)return e;var t="string"==typeof e?e:JSON.stringify(e),n=this.cache,r=n.get(t);return r||(Vl=t,r=new this(e),n.set(t,r)),r}},{key:"cache",get:function(){return Bl(this,"_cache")&&this._cache||(this._cache=new a)}},{key:"NULL",get:function(){return Bl(this,"_null")?this._null:this._null=new this(null)}}])}();S(zl,"standardOptions",Object.freeze([])),zl._$name="Formatter";var jl=Le.escapeRegExp,Wl=/[\d+-]/g,$l=function(e,t){return new Intl.NumberFormat(e||i,t)},Ul=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,Gl=function(){return w((function e(t){m(this,e);var n=this,r=t.locale,i=$l(r,{maximumFractionDigits:3}),a=t.is.currency?n._decodeStyle(r,{style:"currency",currency:t.currency,currencyDisplay:t.currencyDisplay}):null,o=t.is.percent?n._decodeStyle(r,{style:"percent"}):null,l=i.format(1.2).replace(Wl,"")[0],s=i.format(1e9).replace(Wl,"")[0]||"";Object.assign(n,{currency:a,decimal:l,formatter:t,grouper:s,percent:o}),n.decimal=l,n.decimalRe=jl(l,"g"),n.grouper=s,n.stripRe=new RegExp("(?:\\s+|".concat(jl(s),")")+(a?"|(?:".concat(jl(a.text),")"):"")+(o?"|(?:".concat(jl(o.text),")"):""),"g")}),[{key:"decimalPlaces",value:function(e){var t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}},{key:"parse",value:function(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace("−","-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}},{key:"_decodeStyle",value:function(e,t){var n=$l(e,t),r=$l(e,Object.assign(n.resolvedOptions(),{style:"decimal"})),i=n.format(0),a=r.format(0);return{suffix:i.startsWith(a),text:i.replace(a,"").trim()}}}])}(),Yl=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"decimalSeparator",void 0),S(e,"groupSeparator",void 0),e}return R(t,e),w(t,[{key:"initialize",value:function(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}},{key:"truncator",get:function(){var e=this.maximumFractionDigits+(this.is.percent?2:1),t=Math.min(20,e);return this.as({style:"decimal",maximumFractionDigits:t,minimumFractionDigits:t},"truncator")}},{key:"configure",value:function(e){var n=t.decimalSeparator,r=t.groupSeparator;Object.assign(this,F(F({},n?{decimalSeparator:n}:{}),r?{groupSeparator:r}:{})),"string"!=typeof e?Object.assign(this,e):this.template=e;var i=this,a={},o=i.locale?Na.locales[i.locale]||Object.values(Na.locales).find((function(e){return e.localeCode===i.locale})):Na.locale,l=null==o?void 0:o.NumberFormat,s=i.template,u=i.constructor.standardOptions;if(l)for(var c in l)null==i[c]&&"function"!=typeof l[c]&&(i[c]=l[c]);if(s){var d=Ul.exec(s),h=d[2],f=d[4];i.useGrouping=Boolean(d[3]),i.style=d[1]?"currency":d[6]?"percent":"decimal",h&&(i.integer=+h),"*"===f?i.fraction=[0,20]:null!=f&&(i.fraction=[d[5].length,f.length])}i._minMax("fraction",!0,!0),i._minMax("integer",!0,!1),i._minMax("significant",!1,!0);var v,g=D(u);try{for(g.s();!(v=g.n()).done;){var m=v.value;null!=i[m]&&(a[m]=i[m])}}catch(e){g.e(e)}finally{g.f()}if(i.is.from=i.from&&i.from.is,i.is[i.style]=!(i.is.null=!1),i.formatter=$l(i.locale,a),i.decimalSeparator||i.groupSeparator){var p,y,k=i.getLocaleSeparators(),b=k.groupSeparator,C=k.decimalSeparator;i.separatorRegex=new RegExp("[".concat(b).concat(C,"]"),"g"),i.separatorReplace=S(S({},b,null!==(p=i.groupSeparator)&&void 0!==p?p:b),C,null!==(y=i.decimalSeparator)&&void 0!==y?y:C)}}},{key:"as",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:null,r=this.resolvedOptions()||{template:"9.*"},a=this._as,o=n&&a[n];return o||("string"==typeof e?r.style=e:Object.assign(r,e),r.from=this,o=new t(r)),n&&(a[n]=o),o}},{key:"defaultParse",value:function(e,t){return null==e?e:t?Number(e):parseFloat(e)}},{key:"getLocaleSeparators",value:function(){var e,t=".",n=",",r=D(this.formatter.formatToParts(1234567.89));try{for(r.s();!(e=r.n()).done;){var i=e.value;"decimal"===i.type&&(t=i.value),"group"===i.type&&(n=i.value)}}catch(e){r.e(e)}finally{r.f()}return{decimalSeparator:t,groupSeparator:n}}},{key:"format",value:function(e){var n=this,r=n.separatorRegex,i=n.separatorReplace;if("string"==typeof e){var a=Number(e);e=isNaN(a)?n.parse(e):a}return e=B(t,"format",this,3)([e]),r&&(e=String(e).replace(r,(function(e){return i[e]}))),e}},{key:"round",value:function(e){return this.parse(this.format(e))}},{key:"truncate",value:function(e){var t,n=this,r=n.maximumFractionDigits+(n.is.percent?2:0),i=n.truncator,a=n.parse(e);return i&&((t=(a=i.format(a)).indexOf(i.parser.decimal))>-1&&a.length-t-1>r&&(a=a.slice(0,t+r+1)),a=i.parse(a)),a}},{key:"resolvedOptions",value:function(){var e=B(t,"resolvedOptions",this,3)([]);for(var n in e)e[n]===i&&(e[n]=this[n]);return e}},{key:"_minMax",value:function(e,t,n){var r=this,i=r[e];if(null!=i){var a=Le.capitalize(e),o="maximum".concat(a,"Digits"),l="minimum".concat(a,"Digits");"number"==typeof i?(t&&(r[l]=i),n&&(r[o]=i)):(r[l]=i[0],r[o]=i[1])}}}])}(zl);S(Yl,"$name","NumberFormat"),S(Yl,"decimalSeparator",void 0),S(Yl,"groupSeparator",void 0),S(Yl,"standardOptions",["currency","currencyDisplay","locale","maximumFractionDigits","minimumFractionDigits","minimumIntegerDigits","maximumSignificantDigits","minimumSignificantDigits","style","useGrouping"]),Yl.Parser=Gl,Object.assign(Yl.prototype,{currency:null,currencyDisplay:"symbol",fraction:null,from:null,integer:null,locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,significant:null,style:"decimal",template:null,useGrouping:!0}),zl.number=function(e,t){return Yl.get(e).format(t)},Na.ion({locale:function(){return Yl.cache.clear()}}),Yl._$name="NumberFormat";var ql=function(){function e(t,n){m(this,e),"number"==typeof t||null===t?(this._magnitude=t,this._unit=n):("string"==typeof t&&Object.assign(this,Pl.parseDuration(t)),"object"===W(t)&&(this.magnitude=t.magnitude,this.unit=t.unit))}return w(e,[{key:"negate",value:function(){return new e(-this.magnitude,this.unit)}},{key:"magnitude",get:function(){return this._magnitude},set:function(e){this._magnitude="number"==typeof e&&e}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=Pl.parseTimeUnit(e)}},{key:"isValid",get:function(){return null!=this._magnitude&&Boolean(Pl.normalizeUnit(this._unit))}},{key:"milliseconds",get:function(){return this.isValid?Math.round(Pl.asMilliseconds(this._magnitude,this._unit)):0}},{key:"isEqual",value:function(e){return Boolean(e)&&null!=this._magnitude&&null!=e._magnitude&&this.milliseconds===e.milliseconds}},{key:"toString",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:10,n=this,r=e?"getShortNameOfUnit":"getLocalizedNameOfUnit",a=e?"":" ";return n.isValid?"".concat(Yl.get("9."+"#".repeat(t)).format(n._magnitude)).concat(a).concat(Pl[r](n._unit,1!==Math.abs(n._magnitude))):""}},{key:"toJSON",value:function(){return this.toString()}},{key:"valueOf",value:function(){return this.milliseconds}},{key:"add",value:function(t){return new e({unit:this.unit,magnitude:Pl.as(this.unit,this.milliseconds+new e({magnitude:t.magnitude,unit:t.unit||this.unit}).milliseconds)})}},{key:"diff",value:function(t){return new e({unit:this.unit,magnitude:Pl.as(this.unit,this.milliseconds-t.milliseconds)})}}],[{key:"from",value:function(t){return null==t?null:t.isDuration?t:new e(t)}}])}();ql._$name="Duration";var Kl=function(e,t){return null==e?void 0:e[t]},Xl=/^is(this|next|last)(week|month|year)$/i,Zl=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],Jl=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){"function"==typeof e&&(e={filterBy:e}),e.type?"date"===e.type&&null!=e.value?Array.isArray(e.value)?e.value=e.value.map((function(e){return e instanceof Date?e:new Date(e)})):e.value=new Date(e.value):"duration"===e.type&&null!=e.value&&(Array.isArray(e.value)?e.value=e.value.map((function(e){return e.isDuration?e:new ql(e)})):e.value=new ql(e.value)):Pl.isDate(e.value)||Array.isArray(e.value)&&e.value.every(Pl.isDate)?e.type="date":e.value instanceof ql&&(e.type="duration"),B(t,"construct",this,3)([e])}},{key:"id",get:function(){return this._id||(this.internal?this._id=t.generateId("b-internal-".concat(this.property,"-filter-")):this._id=this.property&&"".concat(this.property,"-").concat(this.operator)||t.generateId("b-filter-")),this._id},set:function(e){this._id=e}},{key:"onChange",value:function(e){var t,n=this;n.isConfiguring||null===(t=n.owner)||void 0===t||!t.onFilterChanged||n.owner.isConfiguring||n.owner.onFilterChanged(n,e)}},{key:"filterBy",get:function(){return this._filterBy||this.defaultFilterBy},set:function(e){this._filterBy=e}},{key:"defaultFilterBy",value:function(e){var t,n=this;return t=e.isModel?e.getValue(n.property):n._propertyItems.length>1?n._propertyItems.reduce(Kl,e):e[n.property],n[n.operator](n.convert(t))}},{key:"updateProperty",value:function(e){this._propertyItems=e.split("."),this.onChange("property")}},{key:"value",get:function(){return this._value},set:function(e){var t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&"string"==typeof e[0])?t._filterValue=e.map((function(e){return t.convert(e)})):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?t._filterValue=e.map((function(e){return null==e?void 0:e.toLowerCase()})):t.caseSensitive||"string"!=typeof e?t._filterValue=t.convert(e):t._filterValue=e.toLowerCase(),t.onChange("value")}},{key:"filterValue",get:function(){return this._filterValue}},{key:"operator",get:function(){var e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":"string"==typeof e.filterValue?"*":"="},set:function(e){this._operator=e,this.onChange("operator")}},{key:"convert",value:function(e){var t,n,r=this;"sameTime"===r.operator||"notSameTime"===r.operator||"string"==typeof r.filterValue&&e instanceof Date||("sameDay"!==r.operator&&"notSameDay"!==r.operator||(e=Pl.clearTime(e)),e=null!==(t=null===(n=e)||void 0===n?void 0:n.valueOf())&&void 0!==t?t:e);return e=r.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}},{key:"filter",value:function(e){return this.filterBy(e)}},{key:"startsWith",value:function(e){return String(e).startsWith(this.filterValue)}},{key:"endsWith",value:function(e){return String(e).endsWith(this.filterValue)}},{key:"isIncludedIn",value:function(e){return 0===this.filterValue.length||this.filterValue.includes(e)}},{key:"isNotIncludedIn",value:function(e){return!this.isIncludedIn(e)}},{key:"includes",value:function(e){return 0===this.filterValue.length||String(e).includes(this.filterValue)}},{key:"doesNotInclude",value:function(e){return!this.includes(e)}},{key:"sameTime",value:function(e){return null!=e&&Pl.isSameTime(e,this.filterValue)}},{key:"notSameTime",value:function(e){return!this.sameTime(e)}},{key:"sameDay",value:function(e){return e===this.filterValue}},{key:"notSameDay",value:function(e){return e!==this.filterValue}},{key:"=",value:function(e){return Be.isEqual(e,this.filterValue)}},{key:"!=",value:function(e){return!Be.isEqual(e,this.filterValue)}},{key:">",value:function(e){return Be.isMoreThan(e,this.filterValue)}},{key:">=",value:function(e){return Be.isMoreThan(e,this.filterValue)||Be.isEqual(e,this.filterValue)}},{key:"<",value:function(e){return Be.isLessThan(e,this.filterValue)}},{key:"<=",value:function(e){return Be.isLessThan(e,this.filterValue)||Be.isEqual(e,this.filterValue)}},{key:"*",value:function(e){return Be.isPartial(e,this.filterValue)}},{key:"between",value:function(e){var t=_(this._filterValue,2),n=t[0],r=t[1];return(Be.isMoreThan(e,n)||Be.isEqual(e,n))&&(Be.isLessThan(e,r)||Be.isEqual(e,r))}},{key:"notBetween",value:function(e){return!this.between(e)}},{key:"betweenLesser",value:function(e){var t=_(this._filterValue,2),n=t[0],r=t[1];return e>=n&&e<r}},{key:"empty",value:function(e){return e===i||null===e||0===String(e).length}},{key:"notEmpty",value:function(e){return!this.empty(e)}},{key:"isToday",value:function(e){return this.betweenLesser(e)}},{key:"isTomorrow",value:function(e){return this.betweenLesser(e)}},{key:"isYesterday",value:function(e){return this.betweenLesser(e)}},{key:"isThisWeek",value:function(e){return this.betweenLesser(e)}},{key:"isNextWeek",value:function(e){return this.betweenLesser(e)}},{key:"isLastWeek",value:function(e){return this.betweenLesser(e)}},{key:"isThisMonth",value:function(e){return this.betweenLesser(e)}},{key:"isNextMonth",value:function(e){return this.betweenLesser(e)}},{key:"isLastMonth",value:function(e){return this.betweenLesser(e)}},{key:"isThisYear",value:function(e){return this.betweenLesser(e)}},{key:"isNextYear",value:function(e){return this.betweenLesser(e)}},{key:"isLastYear",value:function(e){return this.betweenLesser(e)}},{key:"isYearToDate",value:function(e){return this.between(e)}},{key:"isTrue",value:function(e){return!0===e}},{key:"isFalse",value:function(e){return!1===e}},{key:"getState",value:function(){var e={caseSensitive:this.caseSensitive,disabled:this.disabled,id:this.id,internal:this.internal,operator:this.operator,property:this.property,type:this.type,value:this.value,columnOwned:this.columnOwned,filterBy:this.filterBy};return Be.cleanupProperties(e,!0),e.filterBy===this.defaultFilterBy&&delete e.filterBy,e}},{key:"setRelativeDateValues",value:function(){this._filterValue=t.getRelativeDateRange(this._operator).map((function(e){return e.valueOf()}))}},{key:"isNoOp",get:function(){var e;return("includes"===this.operator||"isIncludedIn"===this.operator)&&0===(null===(e=this.filterValue)||void 0===e?void 0:e.length)}}],[{key:"defaultConfig",get:function(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}},{key:"configurable",get:function(){return{property:null}}},{key:"getRelativeDateRange",value:function(e){var t,n,r,a,o,l,s,u=arguments.length>1&&arguments[1]!==i?arguments[1]:new Date;switch(e){case"isYearToDate":return[Pl.floor(u,"1 year"),u];case"isToday":return[t=Pl.floor(u,"1 day"),Pl.add(t,1,"day")];case"isYesterday":return t=Pl.floor(u,"1 day"),[Pl.add(t,-1,"day"),t];case"isTomorrow":return[n=Pl.getStartOfNextDay(u),Pl.add(n,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(!(r=e.toLowerCase().match(Xl)))throw new Error("Unrecognized relative date expression: ".concat(e));var c=_(r,3);return l=c[1],s=c[2],a="1 ".concat(s),o=Pl.floor(u,a),"next"===l?o=Pl.add(o,1,s):"last"===l&&(o=Pl.add(o,-1,s)),[o,Pl.add(o,1,s)]}}},{key:"generateFiltersFunction",value:function(e){if(!e||!e.length&&!e.count)return Tt.returnTrue;var t,n=D(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;"date"===r.type&&Zl.includes(r._operator)&&r.setRelativeDateValues()}}catch(e){n.e(e)}finally{n.f()}return function(t){var n,r=!0,i=D(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.disabled||(r=a.filter(t)),!r)break}}catch(e){i.e(e)}finally{i.f()}return r}}}])}(Mn.mixin(eo));S(Jl,"$name","CollectionFilter"),Jl._$name="CollectionFilter";var Ql=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){"function"==typeof e&&(e={sortFn:e}),B(t,"construct",this,3)([e])}},{key:"id",get:function(){return this._id||(this._id=this.property||ba.generateId("b-sorter"))},set:function(e){this._id=e}},{key:"sortFn",get:function(){return this._sortFn?this._sortFn:this.defaultSortFn},set:function(e){this._sortFn=e}},{key:"defaultSortFn",value:function(e,t){var n=this,r=n.convert,i=n.property,a=n.useLocaleSort,o=n.caseSensitive,l="desc"===n.direction.toLowerCase()?-1:1;if(e=e[i],t=t[i],r&&(e=r(e),t=r(t)),o||("string"==typeof e&&(e=e.toLowerCase()),"string"==typeof t&&(t=t.toLowerCase())),a&&null!=e&&null!=t&&"string"==typeof e){if(!0===a)return e.localeCompare(t);if("string"==typeof a)return e.localeCompare(t,a);if("object"===W(a))return e.localeCompare(t,a.locale,a)}return(e>t?1:e<t?-1:0)*l}}],[{key:"defaultConfig",get:function(){return{property:null,caseSensitive:!0,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}},{key:"generateSortFunction",value:function(e,t){var n=e.isCollection?e.values:e,r=n.length;return function(e,i){var a,o,l;for(o=0;o<r;++o)if(a=(l=n[o]).sortFn(e,i,l.direction))return a;return t?t(e,i):0}}}])}(Mn);Ql._$name="CollectionSorter";var es=function(){return 0},ts=function(e,t){return t-e},ns=Symbol("filteredIndicesProperty"),rs=Object.freeze([]),is=Object.freeze({action:"sort",added:rs,removed:rs,replaced:rs}),as=Object.freeze({action:"filter",added:rs,removed:rs,replaced:rs}),os={string:1,number:1};function ls(e,t,n,r){if(!1!==t.unique)t.set(n,e),r&&t.count++;else{var i=t.get(n);i||(i=new o,t.set(n,i)),i.add(e)}}function ss(e,t,n,r){for(var a=arguments.length>4&&arguments[4]!==i&&arguments[4],o=0;o<e.length;o++){var l=e[o];if(l)for(var s=0;s<r;s++){var u=n[s],c=l[u],d=t[u];c!==i&&ls(l,d,c,!a&&d.onDuplicate)}}}var us=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"_sortFunction",null),S(e,"_addedValues",null),e}return R(t,e),w(t,[{key:"isCollection",get:function(){return!0}},{key:"construct",value:function(e){this.generation=0,this._values=[],B(t,"construct",this,3)([e])}},{key:"doDestroy",value:function(){var e;B(t,"doDestroy",this,3)([]);var n=this;n._values.length=0,n.isFiltered&&(n._filteredValues.length=0,n.filters.destroy()),null===(e=n._sorters)||void 0===e||e.destroy()}},{key:"clear",value:function(){var e=this,t=e._values.filter((function(e){return e}));e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}},{key:"equals",value:function(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){var n=this.values;return t&&(e=e.map(t),n=n.map(t)),$e.delta(e,n).inBoth.length===this.count}return!1}},{key:"replaceValues",value:function(e){var t,n,r=e.values,a=e.filteredValues,o=e.silent,l=void 0!==o&&o,s=e.isNewDataset,u=void 0!==s&&s,c=this;c.isFiltered&&!u?(Boolean(a)?r&&(t=c._values,c._values=r.slice()):(a=r.slice(),r=null),n=c._filteredValues,c._filteredValues=a.slice()):(t=c._values,c._values=r.slice(),a=null,c.isFiltered&&u&&c.autoFilter?(c._filterFunction=null,c._filteredValues=c._values.filter(c.filterFunction)):c._filteredValues&&(c._filteredValues.length=0));c._indicesInvalid=!0,c._addedValues=i,c.generation++,l||c.trigger("change",{action:"replaceValues",replacedValues:t,replacedFilteredValues:n,values:r,filteredValues:a})}},{key:"values",get:function(){return this.isFiltered?this._filteredValues:this._values},set:function(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}},{key:"filteredValues",get:function(){return this._filteredValues}},{key:Symbol.iterator,value:function(){return this.values[Symbol.iterator]()}},{key:"forEach",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}},{key:"map",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}},{key:"reduce",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:[];return(this.isFiltered&&!t?this._filteredValues:this._values).reduce(e,n)}},{key:"find",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}},{key:"first",get:function(){return this.values[0]}},{key:"last",get:function(){return this.values[this.count-1]}},{key:"allValues",get:function(){return this._values}},{key:"addedValues",get:function(){return this._addedValues}},{key:"match",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n._values,a=[];return n.forEach((function(i){var o=e.get(i.id,!0);if(o){var l=n.indexOf(i,!0),s=r[l];r[l]=o,n.removeFromIndices(s),n.addToIndices(o)}else t&&a.push(i)})),a.length&&n.remove(a),n.isFiltered&&(n._filteredValues=n._values.filter(n.filterFunction)),a}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];1===t.length?this.splice.apply(this,[this._values.length,null].concat(t)):this.splice(this._values.length,null,t)}},{key:"remove",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];1===t.length?this.splice.apply(this,[0].concat(t)):this.splice(0,t)}},{key:"move",value:function(e,t){for(e=$e.asArray(e);e.length&&e[0]===t;)e.shift();if(e.length){var n=this,r=n._values,i=n.indexOf(e[0],!0);if(1!==e.length||r[i+1]!==t){n.suspendEvents(),n.remove(e),n.resumeEvents();var a=t?n.indexOf(t,!0):r.length;if(-1===a)throw new Error("Collection move beforeItem parameter must be present in Collection");return r.splice.apply(r,[a,0].concat(z(e))),n._indicesInvalid=1,n.trigger("change",{action:"move",items:e,from:i,to:a}),a}}}},{key:"splice",value:function(){for(var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:0,n=arguments.length>1?arguments[1]:i,r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];var s,u,c=this,d=c.idProperty,h=c._values,f={},v=[],g=[],m=c.totalCount;if(1===(null===(e=a)||void 0===e?void 0:e.length)&&Array.isArray(a[0])&&(a=a[0]),!1!==c.trigger("beforeSplice",{index:t,toRemove:n,toAdd:a})){if(a)if(m&&a.length){var p=c.indices[d];s=[];for(var y=0;y<a.length;y++){var k=a[y],b=k[d],C=p.get(b),w=C?h.indexOf(C):-1;f[b]=!0,-1!==w?h[w]!==k&&(g.push([h[w],k]),h[w]=k):s.push(k)}}else s=a;if(n){if("number"==typeof n){n=Math.min(n,h.length-t);for(var S=t;n;--n){f[h[S][d]]?(t++,S++):(v.push(h[S]),h.splice(S,1),u=!0)}}else{var x,E=0===s.length,R=(n=$e.asArray(n)).reduce((function(e,t){var n="number"==typeof t,r=n?t:c.indexOf(t,!0);return E&&(null!=x&&r!==x+1||n)&&(E=!1),r>=0&&r<m&&e.push(r),x=r,e}),[]).sort(ts);if(E)R.length&&(v.push.apply(v,n),h.splice(R[R.length-1],R.length),u=!0);else for(var T=0;T<R.length;T++){var M=R[T];if(-1!==M)f[h[M][d]]||(v.unshift(h[M]),h.splice(M,1),u=!0)}}v.length&&!c._indicesInvalid&&v.forEach(c.removeFromIndices,c)}if(s.length){h.splice.apply(h,[Math.min(t,h.length),0].concat(z(s))),u=!0,c._indicesInvalid||s.forEach(c.addToIndices,c),c._addedValues||(c._addedValues=new o);var F,A=D(s);try{for(A.s();!(F=A.n()).done;){var I=F.value;c._addedValues.add(I)}}catch(e){A.e(e)}finally{A.f()}}if(v.length&&c._addedValues){var L,O=D(v);try{for(O.s();!(L=O.n()).done;){var P=L.value;c._addedValues.delete(P)}}catch(e){O.e(e)}finally{O.f()}}if(g.length&&!c._indicesInvalid&&g.forEach((function(e){c.removeFromIndices(e[0]),c.addToIndices(e[1])})),u||g.length){if(c.isSorted)c.onSortersChanged();else if(c.isFiltered){var _;if(c.autoFilter)c.onFiltersChanged({action:"splice",oldCount:1});else(_=c._filteredValues).splice.apply(_,[Math.min(t,c._filteredValues.length),0].concat(z(s)))}c.generation++,c.trigger("change",{action:"splice",removed:v,added:s,replaced:g,oldCount:m})}else c.trigger("noChange",{index:t,toRemove:n,toAdd:a})}}},{key:"changeId",value:function(e,t){var n=this,r=n.idProperty,i=os[W(e)]?e:e[r],a=n.get(i);if(a){var o=n.get(t);if(o&&a!==o)throw new Error("Attempt to set item ".concat(i," to already existing member's id ").concat(t));n.removeIndexEntry(e,r,i),n.addIndexEntry(e,r,t),a[r]=t}}},{key:"get",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.getBy(this.idProperty,e,t)}},{key:"getAt",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}},{key:"getBy",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];return this.findItem(e,t,this.isFiltered&&n)}},{key:"count",get:function(){return this.values.length}},{key:"totalCount",get:function(){return this._values.length}},{key:"updateIdProperty",value:function(e){this.addIndex({property:e,unique:!0})}},{key:"changeSorters",value:function(e){return new t({values:$e.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}},{key:"addSorter",value:function(e){var t=e instanceof Ql?e:new Ql(e);return this.sorters.add(t),t}},{key:"isSorted",get:function(){var e;return Boolean(null===(e=this._sorters)||void 0===e?void 0:e.count)}},{key:"onSortersChanged",value:function(){var e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",is)}},{key:"sortFunction",get:function(){return this._sortFunction||(this.isSorted?this._sortFunction=Ql.generateSortFunction(this.sorters.values):this._sortFunction=es),this._sortFunction}},{key:"filters",get:function(){return this._filters||(this._filters=new t({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}},{key:"addFilter",value:function(e){var t=e instanceof Jl?e:new Jl(e);return this.filters.add(t),t}},{key:"removeFilter",value:function(e){var t=this.filters;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}},{key:"clearFilters",value:function(){this.filters.clear()}},{key:"isFiltered",get:function(){return Boolean(this._filters&&this._filters.count)}},{key:"onFiltersChanged",value:function(e){var t=e.action,n=e.removed,r=this,i=e.oldCount||"clear"===t&&n.length?r._filteredValues:r._values;r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction),r._indicesInvalid=!0;var a=$e.delta(r._filteredValues,i,!0),o=a.toAdd,l=a.toRemove;r.trigger("change",F(F({},as),{},{added:o,removed:l}))}},{key:"filterFunction",get:function(){return this._filterFunction||(this.isFiltered?this._filterFunction=Jl.generateFiltersFunction(this.filters.values):this._filterFunction=Tt.returnTrue),this._filterFunction}},{key:"changeExtraKeys",value:function(e){return $e.asArray(e).map((function(e){return"string"==typeof e?{property:e,unique:!0}:e}))}},{key:"updateExtraKeys",value:function(e){for(var t=0;t<e.length;t++)this.addIndex(e[t])}},{key:"addIndex",value:function(e){var t=this;e&&((t._indices||(t._indices={}))[e.property]=new a,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}},{key:"findIndex",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this.findItem(e,t,n);return r?(this.isFiltered&&!n?this._filteredValues:this._values).indexOf(r):-1}},{key:"findItem",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.isFiltered,o=a&&!n?r.indices[ns][e]:r.indices[e];if(o){var l,s=null!==(l=o.get(t))&&void 0!==l?l:"string"==typeof t&&t.length&&!isNaN(t)&&o.get(Number(t))||null;if(null!=s)return s}else for(var u=a&&!n?r._filteredValues:r._values,c=u.length,d=0;d<c;d++){var h=u[d];if(h[e]==t)return h}return null}},{key:"removeIndex",value:function(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some((function(e){return e.dependentOn}))}},{key:"indexOf",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.findIndex(this.idProperty,os[W(e)]?e:e[this.idProperty],t)}},{key:"includes",value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return Array.isArray(e)?e.some((function(e){return t.includes(e)})):Boolean(this.findItem(this.idProperty,os[W(e)]?e:e[this.idProperty],n))}},{key:"indices",get:function(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}},{key:"invalidateIndices",value:function(){this._indicesInvalid=!0}},{key:"rebuildIndices",value:function(){var e,t=this,n=t.isFiltered,r=t._indices||(t._indices={}),i=Object.keys(r),l=i.length,s=t._values,u=!1;n&&(e=r[ns]={});for(var c=0;c<l;c++){var d=r[i[c]];if(d.clear(),d.onDuplicate&&(d.count=0,u=!0),n){var h=e[i[c]];h?h.clear():(h=e[i[c]]=new a).unique=d.unique}}if(ss(s,r,i,l),u)for(var f=0;f<l;f++){var v=r[i[f]];if(v.onDuplicate&&v.count>v.size)for(var g=new o,m=0;m<s.length;m++){var p=s[m],y=p[i[f]];g.has(y)&&v.onDuplicate(p,y,v),g.add(y)}}n&&ss(t._filteredValues,e,i,l,!0),t._indicesInvalid=!1}},{key:"getIndices",value:function(e){var t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[ns][e]),t}},{key:"addToIndices",value:function(e){var t=this;Object.keys(this.indices).forEach((function(n){t.addIndexEntry(e,n,e[n])}))}},{key:"removeFromIndices",value:function(e){var t=this;Object.keys(this.indices).forEach((function(n){t.removeIndexEntry(e,n,e[n])}))}},{key:"removeIndexEntry",value:function(e,t,n){this.getIndices(t).forEach((function(t){return function(e,t,n){!1!==t.unique?t.delete(n):t.has(n)&&(t.get(n).delete(e),t.get(n).size||t.delete(n))}(e,t,n)}))}},{key:"addIndexEntry",value:function(e,t,n){this.getIndices(t).forEach((function(t){return ls(e,t,n)}))}},{key:"onItemMutation",value:function(e,t){var n=this;!n._indicesInvalid&&Object.keys(n.indices).length>1&&Object.keys(t).forEach((function(r){if(n.indices[r]){var i=t[r],a=i.value,o=i.oldValue;n.removeIndexEntry(e,r,o),n.addIndexEntry(e,r,a)}if(n.hasCompositeIndex){var l=Object.values(n.indices).find((function(e){var t;return null===(t=e.dependentOn)||void 0===t?void 0:t[r]}));if(l){var s={};for(var u in l.dependentOn){var c;s[u]=(null===(c=t[u])||void 0===c?void 0:c.oldValue)||e[u]}var d=e.buildIndexKey(s);n.removeIndexEntry(e,l.property,d),n.addIndexEntry(e,l.property,e[l.property])}}}))}}],[{key:"configurable",get:function(){return{idProperty:"id",extraKeys:null,autoFilter:!0,sorters:{$config:["lazy"],value:[]}}}}])}(Mn.mixin(_n));us._$name="Collection";var cs=new WeakMap,ds=function(e){if(e&&"object"===W(e)){var t=cs.get(e);t===i&&(t=Symbol("bscik"),cs.set(e,t)),e=t}return e},hs=function(){return w((function e(t){m(this,e);var n=this;n.generation=0,n.items=new o,n.idMap={},n.idProperty="id",t&&(t.idProperty&&(n.idProperty=t.idProperty),t.values&&(n.values=t.values))}),[{key:"get",value:function(e){return this.idMap[ds(e)]}},{key:"count",get:function(){return this.items.size}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];1===t.length&&Array.isArray(t[0])&&(t=t[0]);for(var r=this,i=r.items,a=r.idMap,o=r.idProperty,l=t.length,s=0;s<l;s++){var u=t[s],c=os[W(u)]?u:ds(u[o]),d=a[c];null==d?(a[c]=u,i.add(u),r.generation++):d!==u&&(a[c]=u,i.delete(d),i.add(u))}}},{key:"at",value:function(e){var t,n;e<0&&(e+=this.count);var r,i=D(this.items);try{for(i.s();!(r=i.n()).done;)if(t=r.value,!e--){n=t;break}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"remove",value:function(e){e=$e.asArray(e);for(var t=this.items,n=this.idMap,r=this.idProperty,i=e.length,a=0;a<i;a++){var o=e[a],l=os[W(o)]?o:ds(o[r]),s=n[l];null!=s&&(t.delete(s),delete n[l],this.generation++)}}},{key:"clear",value:function(){this.items.clear(),this.idMap={},this.generation++}},{key:"countOf",value:function(e){var t,n=0,r=D(this.items);try{for(r.s();!(t=r.n()).done;)e(t.value)&&++n}catch(e){r.e(e)}finally{r.f()}return n}},{key:"changeId",value:function(e,t){var n=this,r=n.idMap,i=n.idProperty,a=os[W(e)]?e:ds(e[i]),o=n.get(a);if(o){var l=n.get(t);if(l&&o!==l)throw new Error("Attempt to set item ".concat(a," to already existing member's id ").concat(t));o[i]=t,delete r[a],r[t]=o}}},{key:"filter",value:function(e,t){var n=this.items,r=[],i=0;return n.forEach((function(a){e.call(t,a,i++,n)&&r.push(a)})),r}},{key:"includes",value:function(e){var t=os[W(e)]?e:ds(e[this.idProperty]);return Boolean(this.idMap[t])}},{key:"map",value:function(e,t){var n=this.items,r=new Array(n.size),i=0;return n.forEach((function(a){r[i]=e.call(t,a,i++,n)})),r}},{key:"forEach",value:function(e,t){return this.items.forEach(e,t)}},{key:"find",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:0;r<0&&(r+=this.countOf(e));var a,o=D(this.items);try{for(o.s();!(a=o.n()).done;)if(e(t=a.value)&&!r--){n=t;break}}catch(e){o.e(e)}finally{o.f()}return n}},{key:Symbol.iterator,value:function(){return this.items[Symbol.iterator]()}},{key:"indexOf",value:function(e,t){var n,r,i=-1,a=D(this.items);try{for(a.s();!(r=a.n()).done;)if(n=r.value,(!t||t(n))&&(++i,n===e))return i}catch(e){a.e(e)}finally{a.f()}return-1}},{key:"values",get:function(){return z(this.items)},set:function(e){e=$e.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}},{key:"first",get:function(){var e,t=D(this.items);try{for(t.s();!(e=t.n()).done;){return e.value}}catch(e){t.e(e)}finally{t.f()}return null}},{key:"last",get:function(){var e,t=null,n=D(this.items);try{for(n.s();!(e=n.n()).done;){t=e.value}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"sort",value:function(e){this.values=this.values.sort(e)}},{key:"some",value:function(e,t){return this.values.some(e,t)}}])}();hs._$name="Bag";var fs=function(e){return e.element.classList.contains("b-visible")},vs=function(e){return!fs(e)&&e.isVisible},gs=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"destroy",value:function(){"trial"!==this.type&&B(t,"destroy",this,3)([])}},{key:"compose",value:function(){var e=this.icon,t=this.maxProgress,n=this.mode,r=this.progress,i=this.showDelay,a=this.text,o=this.html;return{class:S({"b-mask":1,"b-delayed-show":i,"b-progress":t,"b-prevent-transitions":!this.useTransition},"b-mask-".concat(n),1),children:{maskContent:{class:"b-mask-content",children:{progressElement:t?{class:"b-mask-progress-bar",style:{width:"".concat(Math.max(0,Math.min(100,Math.round(r/t*100))),"%")}}:null,maskText:{class:"b-mask-text",html:"".concat(e?"".concat('<i class="b-mask-icon '.concat(e,'"></i>')):"").concat(a||o||"")}}}},listeners:{mousedown:"onMaskMouseDown",capture:!0}}}},{key:"onMaskMouseDown",value:function(e){e.preventDefault()}},{key:"generateAutoId",value:function(){var e=this.type;return"mask".concat("string"==typeof e?e.trim():"","-").concat(t.counter++)}},{key:"updateAutoClose",value:function(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}},{key:"updateCover",value:function(){this.syncCover()}},{key:"syncCover",value:function(){var e,t;null===(e=this.owner)||void 0===e||null===(t=e.syncMaskCover)||void 0===t||t.call(e,this)}},{key:"error",set:function(e){this.setConfig(F(F({},this.errorDefaults),{},{text:e}))}},{key:"onOwnerResize",value:function(){this.syncCover()}},{key:"updateOwner",value:function(e){this.detachListeners("cover"),null==e||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}},{key:"updateShowDelay",value:function(e){var t=this.delayedShow;t.delay=e,e||t.flush()}},{key:"changeTarget",value:function(e){return e===i?e=document.body:"string"==typeof e&&(e=this.owner[e]),e}},{key:"updateTarget",value:function(e,n){var r=this,i=r.id,a=r.element,o=n&&t.get(n);n&&(n[i]===r&&delete n[i],$e.remove(o,r),t.sync(n)),e?(e[i]||(e[i]=r),a.parentNode!==e&&e.appendChild(a),$e.include(t.get(e),r),t.sync(e)):a.remove()}},{key:"deferredClose",value:function(){var e,t=this,n=t.owner;t.close().then((function(){var e;return null==n||null===(e=n.onMaskAutoClose)||void 0===e?void 0:e.call(n,t)})),null==n||null===(e=n.onMaskAutoClosing)||void 0===e||e.call(n,t)}},{key:"delayedShow",value:function(){this.element.classList.remove("b-delayed-show")}},{key:"updateHidden",value:function(e,n){var r;null===(r=B(t,"updateHidden",this,3))||void 0===r||r([e,n]),e&&this.element.classList.remove("b-visible"),t.sync(this.target)}},{key:"afterShow",value:function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];null===(e=B(t,"afterShow",this,3))||void 0===e||e(r),t.sync(this.target)}},{key:"afterHide",value:function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];null===(e=B(t,"afterHide",this,3))||void 0===e||e(r),this.element.classList.remove("b-visible"),t.sync(this.target)}},{key:"close",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hide();case 2:this.destroy();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"get",value:function(e){return wa.get(e,"masks")||wa.set(e,"masks",[])}},{key:"getActive",value:function(e){return t.get(e).find(fs)||null}},{key:"getPending",value:function(e){return t.get(e).filter(vs).sort(Lo.weightSortFn)}},{key:"mask",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:document.body;return t.new({target:n},e)}},{key:"mergeConfigs",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n=n.map((function(e){return"string"==typeof e?{text:e}:e})),B(t,"mergeConfigs",this,2)(n)}},{key:"sync",value:function(e){var n,r,i=t.getActive(e),a=!i&&t.getPending(e)[0]||null,o=i||a,l=(null==o?void 0:o.mode)||"",s=l.endsWith("blur")?"b-masked-".concat(l):"";a&&(n=a.element.classList,a.showDelay&&!e.classList.contains("b-masked")&&(n.add("b-delayed-show"),a.delayedShow()),n.add("b-visible")),e.classList.toggle("b-masked",Boolean(o));var u,c=D(e.children);try{for(c.s();!(u=c.n()).done;){var d;if(!(n=u.value.classList).contains("b-mask"))(r=Array.from(n).filter((function(e){return e.startsWith("b-masked-")&&s!==e}))).length&&(d=n).remove.apply(d,z(r)),s&&n.add(s)}}catch(e){c.e(e)}finally{c.f()}}},{key:"unmask",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:document.body,r=t.get(n),a=r.length;return a?null===(e=r[a-1])||void 0===e?void 0:e.close():null}},{key:"unmaskAll",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:document.body;return t.get(e).filter((function(e){return!fs(e)})).forEach((function(e){return e.destroy()})),t.unmask(e)}}]);var n}(Lo);S(gs,"$name","Mask"),S(gs,"type","mask"),S(gs,"configurable",{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,target:{$config:"nullify",value:i},text:null,type:null,showDelay:null,useTransition:!1}),S(gs,"delayable",{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}}),S(gs,"counter",0),gs.initClass(),gs._$name="Mask";var ms=Object.freeze({}),ps=Array.isArray,ys=function(e){return e.weight},ks=function(e){return e&&!e.hidden},bs=function(e){return e.isFocusable},Cs=["display","flex-direction"],ws={default:1,box:1},Ds=Symbol("options"),Ss=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"startConfigure",value:function(e){var n=e.items||e.lazyItems;(this.hasItems=Boolean(n&&(ps(n)?n:Object.keys(n)).length))||(this.initialItems=!1),B(t,"startConfigure",this,3)([e])}},{key:"firstItem",get:function(){return this.getAt(0)}},{key:"lastItem",get:function(){return this.getAt(-1)}},{key:"getPositionableItems",value:function(e,t){var n,r=(null===(n=this._items)||void 0===n?void 0:n.filter((function(t){return e?t.positionable===e:t.positionable})))||[];return t?Object.fromEntries(r.map((function(e,t){return["$".concat(e.positionable).concat(t),e.element]}))):r}},{key:"getPositionableLocation",value:function(e){return[this.contentElement]}},{key:"getAt",value:function(e){return this.ensureItems().at(e)}},{key:"remove",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0;1===t.length&&(ps(t[0])?t=t[0]:r=!1);for(var i=this,a=i._items,o=[],l=0;l<t.length;l++){var s=t[l];a.includes(s)&&(a.remove(s),i.layout.removeChild(s),o.push(s),i.onChildRemove(s))}return r?o:o[0]}},{key:"removeAll",value:function(){return this.remove(this.items)}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i,a,o=this,l=o.ensureItems(),s=[],u=!0;for(1===t.length&&(ps(t[0])?t=t[0]:u=!1),i=0;i<t.length;i++){var c;(r=t[i]).isWidget?r.parent=o:r=o.createWidget(r),null!=(null===(c=r)||void 0===c?void 0:c.weight)?(a=$e.findInsertionIndex(r,l.values,Lo.weightSortFn),s.push(o.insert(r,a))):r&&(l.includes(r)||(l.add(r),o.onChildAdd(r),o.layout.appendChild(r),s.push(r)))}return u?s:s[0]}},{key:"ensureItems",value:function(){var e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}},{key:"insert",value:function(e,t){var n=this,r=n.ensureItems();e instanceof Lo?e.parent=n:e=n.createWidget(e),r.includes(t)&&(t=n.indexOfChild(t)-1),t=Math.min(t,r.count);var i=r.values;if(i.includes(e)){var a,o=i.indexOf(e);i.splice(o,1),i.splice(t,0,e),r.values=i,n.syncChildCount(),null===(a=n.onChildMove)||void 0===a||a.call(n,e),n.layout.insertChild(e,t<o?t:t+1)}else i.splice(t,0,e),r.values=i,n.onChildAdd(e),n.layout.insertChild(e,t);return e}},{key:"indexOfChild",value:function(e){return this.items.indexOf(e)}},{key:"changeLazyItems",value:function(e){this.items=e,this.layout.renderChildren()}},{key:"onChildWeightChange",value:function(e){if(this.items.length>1){var t,n=this.lastItem;this._items.sort(Lo.weightSortFn);var r=this.items;this.contentElement.insertBefore(e.element,(null===(t=r[r.indexOf(e)+1])||void 0===t?void 0:t.element)||n.element.nextSibling)}}},{key:"changeItems",value:function(e,t){var n=this,r=[],i=new hs;return ps(e)?n.processItemsArray(e,r):e&&n.processItemsObject(e,n.namedItems,r),r.some(ys)&&r.sort(Lo.weightSortFn),i.add(r),t&&t.forEach((function(e){n.remove(e),i.includes(e)||e._createdBy!==n||e.destroy()})),i}},{key:"afterConstruct",value:function(){var e=this.rtl,t=this.contentElement.classList;t.toggle("b-rtl",!0===e),t.toggle("b-ltr",!1===e)}},{key:"updateRtl",value:function(e){B(t,"updateRtl",this,3)([e]);var n=this.contentElement;n&&(n.classList.toggle("b-rtl",!0===e),n.classList.toggle("b-ltr",!1===e))}},{key:"updateItems",value:function(e,t){var n=this,r=0;e.forEach((function(e){n.onChildAdd(e),t&&!t.temporary&&n.layout.insertChild(e,r),++r})),this.initialItems=!1}},{key:"updateHideWhenEmpty",value:function(){this.syncChildCount(this.rendered)}},{key:"items",get:function(){var e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new hs,e._items.temporary=!0}return e._items.values}},{key:"processItemsArray",value:function(e,t){var n,r,i=e.length;for(n=0;n<i;n++){var a;if((r=e[n])instanceof Lo)r.parent=this,(a=r.element.classList).remove.apply(a,z(Lo.outerCls));else r=this.createWidget(r);r&&((r.ref||r.id)&&this.addDescendant(r),t.push(r))}}},{key:"processItemsObject",value:function(e,t){var n,r,a=arguments.length>2&&arguments[2]!==i?arguments[2]:[];for(r in e)(n=e[r])&&(t&&r in t&&(n="object"===W(n)?Be.merge(Be.clone(t[r]),n):t[r]),n&&(n instanceof Lo?n.parent=this:(n instanceof Object&&(n.ref=r),n=this.createWidget(n)),n&&(n.ref=r,this.addDescendant(n),a.push(n))));return a}},{key:"onChildAdd",value:function(e){var t=this;if(e.innerItem&&t.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),t.onChildAddLayout(e),e.ref||e.id)for(var n=t;n;n=n.parent)n.addDescendant(e);t.syncChildCount(!0),!t.onConfigChange.$nullFn&&t.onConfigChange({name:"items",config:t.$meta.configs.items})}},{key:"onChildAddLayout",value:function(e){e.innerItem&&this.layout.onChildAdd(e)}},{key:"onChildHide",value:function(e){var n;B(t,"onChildHide",this,3)([e]),null!==(n=this._items)&&void 0!==n&&n.includes(e)&&this.syncChildCount(!0)}},{key:"onChildShow",value:function(e){var n;B(t,"onChildShow",this,3)([e]),null!==(n=this._items)&&void 0!==n&&n.includes(e)&&this.syncChildCount(!0)}},{key:"syncChildCount",value:function(e){if(!this.isConfiguring&&!this.isDestroying){var t=this,n=t.items,r=t.hasItems,i=n.filter(ks),a=i.length;if(t.visibleChildCount=a,t.hideWhenEmpty&&e){var o=Boolean(!a);Boolean(t._hidden)!==o&&(t.hidden=o)}n.forEach((function(e){return e.element.classList.remove("b-last-visible-child","b-first-visible-child")})),a&&(i[0].element.classList.add("b-first-visible-child"),i[a-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(t.childItems.length),t.contentElement.classList[a?"remove":"add"]("b-no-visible-children"),t.isComposable?r!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}},{key:"syncFlexDirection",value:function(){var e=this,t=e.contentElement,n=e.flexColCls,r=e.flexRowCls,i=new Ct(t.className),a=li.getStyleValue(t,Cs);i[r]=i[n]=0,"flex"===a.display&&(i["row"===a["flex-direction"]?r:n]=1),li.syncClassList(t,i)}},{key:"addDescendant",value:function(e){var t=e.ref||e.id,n=this._widgetMap||(this._widgetMap={});n[t]||(n[t]=e)}},{key:"cleanupWidgetMap",value:function(e){var t=new a,n=e.ref||e.id;n&&t.set(n,e),e.eachWidget((function(e){var n=e.ref||e.id;n&&t.set(n,e)}));for(var r=this;r;r=r.parent){var i,o=D(t);try{for(o.s();!(i=o.n()).done;){var l=_(i.value,2),s=l[0],u=l[1];r.widgetMap[s]===u&&delete r.widgetMap[s]}}catch(e){o.e(e)}finally{o.f()}}}},{key:"onChildRemove",value:function(e){var t=this;t.cleanupWidgetMap(e),t.layout.onChildRemove(e),t.syncChildCount(!0),!t.onConfigChange.$nullFn&&t.onConfigChange({name:"items",config:t.$meta.configs.items})}},{key:"widgetMap",get:function(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}},{key:"changeRecord",value:function(e){return this._record=null==e?ms:null,e}},{key:"updateRecord",value:function(e){var t,n=this;null===(t=n.recordUpdateDetacher)||void 0===t||t.call(n),n.trigger("beforeSetRecord",{record:e}),n.clearError(),n._hasChanges=!1,n.setValues(e,{onlyName:n.strictRecordMapping,highlight:Boolean(n.$highlight)}),n.autoUpdateFields&&null!=e&&e.firstStore&&(n.recordUpdateDetacher=e.firstStore.ion({update:n.onRecordUpdated,thisObj:n}))}},{key:"setRecord",value:function(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}},{key:"onRecordUpdated",value:function(e){e.record===this.record&&this.setValues(this.record,!0,!0)}},{key:"shouldUpdateRecordOnAction",value:function(e,t){return e&&(t.userAction||!this.autoUpdateUserChangesOnly)}},{key:"onFieldChange",value:function(e){var t=this,n=e.source,r=t.hasChanges,i=t.isSettingValues,a=t.initialValues;if(!i){if(!t.isConfiguring&&t.autoUpdateRecord&&t.shouldUpdateRecordOnAction(t.record,e)){var o=t.strictRecordMapping,l=t.record,s=n.name,u=n.ref,c=n.isValid,d=void 0===c||c,h=n[n.defaultBindProperty||"value"],f=o?s:s||u;l&&f&&d&&(l.isModel?l.setValue(f,h):l[f]=h)}if(a){var v=n.getValueName(a[Ds]);v&&((t.changeSet||(t.changeSet={}))[v]=!Be.isEqual(n.value,a[v]),t._hasChanges=Boolean(t.changeSet&&Object.values(t.changeSet).some((function(e){return e}))))}t.hasChanges!==r&&t.trigger("dirtyStateChange",{dirty:t.hasChanges})}}},{key:"hasChanges",get:function(){return Boolean(this._hasChanges)}},{key:"getValues",value:function(e){var t={};return this.eachWidget((function(n,r){n.isolateFields?r.down=!1:!("name"in n)||e&&!e(n)||(t[n.name]=n.value)}),!0),t}},{key:"values",get:function(){var e={};return this.gatherValue(e),e},set:function(e){this.assignValue(e)}},{key:"isSettingValues",get:function(){return Boolean(this.assigningValues)}},{key:"assigningValues",get:function(){var e;return this._assigningValues||(null===(e=this.parent)||void 0===e?void 0:e.assigningValues)},set:function(e){this._assigningValues=e}},{key:"assignValue",value:function(e,n){B(t,"assignValue",this,3)([e,n]),this.isolateFields||this.setValues(e,n)}},{key:"gatherValue",value:function(e){B(t,"gatherValue",this,3)([e]),this.isolateFields||this.gatherValues(e)}},{key:"setValues",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.assignValueDefaults,n=this;n.assigningValues=t,n.initialValues={optionsProp:t},n.eachWidget((function(r){var i=r.getValueName(t);!i||e&&!(i in e)||(n.initialValues[i]=(null==e?void 0:e[i])||null),r.assignValue(e,t)}),!1),n.assigningValues=!1}},{key:"hasNoChildren",get:function(){var e=this,t=e.initialConfig,n=t.items,r=t.lazyItems,i=n&&(ps(n)?n:Be.values(n)),a=r&&(ps(r)?r:Be.values(r)),o=e.isConfiguring?a||i:e.items;return!(null!=o&&o.filter(ks).length)}},{key:"afterRecompose",value:function(){B(t,"afterRecompose",this,3)([]),this.realign()}},{key:"updateTextContent",value:function(e){var t=this;if(!t.isComposable){var n=Boolean(e&&t.hasNoChildren),r=t.contentElement.classList;n!==r.contains("b-text-content")&&(r[n?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}}},{key:"updateLayoutStyle",value:function(e){li.applyStyle(this.contentElement,e)}},{key:"updateElement",value:function(e){if(B(t,"updateElement",this,3)(arguments),e){var n=this.contentElement.classList,r=this.layout.containerCls;n.add("b-content-element"),r&&n.add(r)}}},{key:"onInternalPaint",value:function(){var e;null===(e=B(t,"onInternalPaint",this,3))||void 0===e||e(arguments),this.getConfig("contentElMutationObserver")}},{key:"changeContentElMutationObserver",value:function(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){var n=this,r=n.element,i=n.contentElement;(e=new MutationObserver((function(e){return n.onContentElMutation(e)}))).observe(i,{attributes:!0}),i!==r&&e.observe(r,{attributes:!0}),n.syncFlexDirection()}return e}},{key:"onContentElMutation",value:function(e){var t=this;ws[this.layout.type]&&!this.textContent&&this.isVisible&&e.some((function(e){return t.contentElement.contains(e.target)}))&&this.syncFlexDirection()}},{key:"changeLayout",value:function(e,t){return Po.reconfigure(t,e,{owner:this,defaults:{owner:this}})}},{key:"childItems",get:function(){return this.items}},{key:"childItemsOrderedByRelevance",get:function(){return this.items}},{key:"getWidgetById",value:function(e){return this.widgetMap[e]}},{key:"processWidgetConfig",value:function(e){}},{key:"setupWidgetConfig",value:function(e,t){var n=this;"string"==typeof e?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&("checkbox"===t&&ne.isMobile&&Lo.resolveType("slidetoggle",!0)&&(t=e.type="slidetoggle"),t=Lo.resolveType(t,!0));for(var r=(e=(t||Lo).mergeConfigs(n.defaults,e,{parent:n})).parent;r;r=r.parent)if(!1===r.processWidgetConfig(e))return null;return!1===n.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}},{key:"createWidget",value:function(e){var t=Lo.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}},{key:"updateDefaults",value:function(e,t){if(!this.isConfiguring&&e){var n=Object.entries(e);this.eachWidget((function(e){n.forEach((function(n){var r=_(n,2),i=r[0],a=r[1];t&&e[i]!==t[i]||(e[i]=a)}))}),!1)}}},{key:"render",value:function(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),B(t,"render",this,3)(arguments)}},{key:"focusElement",get:function(){var e=this.defaultFocus;if("string"==typeof e)return this.element.querySelector(e);var n=e&&this.query(e);return e&&n||(n=this.query(bs,!0)),n?n.focusElement:B(t,"focusElement",this,1)}},{key:"doDestroy",value:function(){var e;null===(e=this._items)||void 0===e||e.forEach((function(e){var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),this.layout.destroy(),B(t,"doDestroy",this,3)([])}},{key:"isValid",get:function(){var e=!0;return this.eachWidget((function(t){"isValid"in t&&t.isVisibleForValidation&&!t.isValid&&(e=!1)}),!0),e}},{key:"clearError",value:function(){this.eachWidget((function(e){var t;return null===(t=e.clearError)||void 0===t?void 0:t.call(e)}))}}],[{key:"configurable",get:function(){return{items:null,lazyItems:{$config:["lazy"],value:null},tabBarItems:null,defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:{$config:"lazy",value:null},overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateUserChangesOnly:!0,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}},{key:"prototypeProperties",get:function(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}}])}(Lo);S(Ss,"$name","Container"),S(Ss,"type","container"),Ss.initClass(),Ss._$name="Container";var xs=function(){return w((function e(t){var n=this;m(this,e),this.promise=new Promise((function(e,t){n.resolve=e,n.reject=t})),t&&t(this)}),[{key:"catch",value:function(e){return this.promise=this.promise.catch(e),this}},{key:"finally",value:function(e){return this.promise=this.promise.finally(e),this}},{key:"then",value:function(){var e;return this.promise=(e=this.promise).then.apply(e,arguments),this}}],[{key:"new",value:function(e){return new this(e)}}])}();xs._$name="Promissory";var Es=Be.assign,Rs=function(){return performance.now()},Ts={start:!1},Ms=/^[.\d]+([^\d].*)?$/,Fs=function(e){var t=e.$bryntum||(e.$bryntum={});return t.transitions||(t.transitions=Object.create(null))},As=function(e,t){var n;"string"==typeof e&&(t=null===(n=Ms.exec(e))||void 0===n?void 0:n[1],e=parseFloat(e));return e&&e*("s"===t||!t&&e<10?1e3:1)},Is=function(e){var t=Be.values(Fs(e)).filter((function(e){return null==e.completed})).map((function(e){return e.toString()}));e.style.transition=t.join(", ")},Ls=function(e){return function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=g(this,t,[].concat(r))).id=++Os,e}return R(t,e),w(t,[{key:"start",value:function(){this.startTime=Rs()}},{key:"delay",get:function(){var e,t,n;return As(null!==(e=null!==(t=this._delay)&&void 0!==t?t:null===(n=this.owner)||void 0===n?void 0:n.delay)&&void 0!==e?e:0,this.unit)},set:function(e){this._delay=e}},{key:"duration",get:function(){var e,t=this.owner,n=this.unit;return As(null!==(e=this._duration)&&void 0!==e?e:t?t.duration:_s.defaultDuration,n)},set:function(e){this._duration=e}},{key:"elapsed",get:function(){return Rs()-this.startTime}},{key:"remaining",get:function(){return this.duration-this.elapsed}},{key:"retain",get:function(){var e,t;return null!==(e=this._retain)&&void 0!==e?e:null===(t=this.owner)||void 0===t?void 0:t.retain},set:function(e){this._retain=e}},{key:"timing",get:function(){var e,t;return null!==(e=this._timing)&&void 0!==e?e:null===(t=this.owner)||void 0===t?void 0:t.timing},set:function(e){this._timing=e}},{key:"unit",get:function(){var e,t;return null!==(e=this._unit)&&void 0!==e?e:null===(t=this.owner)||void 0===t?void 0:t.unit},set:function(e){this._unit=e}}],[{key:"prototypeProperties",get:function(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}}])}(e)},Os=0,Ps=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]);var e=this,n=e.element,r=e.transitions,i=e.property,a=_(li.unitize(i,e.to),2);i=a[0],e.to=a[1],e.from=li.unitize(i,e.from)[1],e.promissory=new xs,e.property=i;var o=r[i];r[i]=e;var l=e.from;o&&(e.from=o.to,l=null,o.destroy()),null===l&&(l=e.getCurrentStyleValue(),o||(e.from=l)),n.style[i]=l,e.getCurrentStyleValue()}},{key:"doDestroy",value:function(){var e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),B(t,"doDestroy",this,3)([])}},{key:"promise",get:function(){var e;return null===(e=this.promissory)||void 0===e?void 0:e.promise}},{key:"transitions",get:function(){return Fs(this.element)}},{key:"clearStyle",value:function(){this.setStyle("")}},{key:"finish",value:function(e){var t=this,n=t.transitions,r=t.promissory,i=t.property;r&&(t.completed=e,t.promissory=null,r.resolve(e),n[i]===t?(delete n[i],e||(Is(t.element),t.clearStyle())):t.completed=!1)}},{key:"getCurrentStyleValue",value:function(){return li.getStyleValue(this.element,this.property)}},{key:"revert",value:function(){var e=this.duration,n=this.elapsed,r=this.element,i=this.from;return new t({element:r,property:this.property,retain:this._retain,timing:this._timing,duration:Math.round(Math.min(e,n)),reverting:this,to:i,unit:"ms"})}},{key:"setStyle",value:function(e){this.element.style[this.property]=e}},{key:"start",value:function(){var e=this,n=e.delay,r=e.duration,i=e.element,a=e.property;fr.onTransitionEnd({element:i,property:a,duration:n+r+20,thisObj:e.owner,handler:function(){var t;return null===(t=e.finish)||void 0===t?void 0:t.call(e,!0)}}),B(t,"start",this,3)([]),e.setStyle(e.to)}},{key:"toString",value:function(){var e=this.delay,t=this.duration,n=this.property,r=this.timing;return"".concat(n," ").concat(t,"ms ").concat(r||"ease-in-out").concat(e?" ".concat(e,"ms"):"")}}],[{key:"prototypeProperties",get:function(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}}])}(Mn.mixin(Ls));S(Ps,"$name","AnimatorTransition"),Ps.initClass();var _s=function(e){function t(e){var n,r;m(this,t);var i,a,o,l,s=r=g(this,t,[null]),u=[],c={};if(Array.isArray(e))s.items=e;else for(o in e)(t.specialPropsRe.test(o)?s:c)[o]=e[o];return Be.keys(c).forEach((function(e){null!=(l=c[e])&&!1!==l&&l==l&&((a=t.fx[e])?((l=Es(s.defaults,a(l,s,e))).owner=s,i=new t(l)):((l=Es(s.defaults,"object"===W(l)?l:{to:l})).owner=s,l.property=e,i=new Ps(l)),u.push(i))})),null===(n=s.items)||void 0===n||n.forEach((function(e){Be.isInstantiated(e)?e.owner=s:((e=Es(s.defaults,e)).owner=s,e=new t(e)),u.push(e)})),s.items=u,s.promise=(1===u.length?u[0].promise:Promise.all(u.map((function(e){return e.promise})))).then((function(e){var t;return null===(t=s.finish)||void 0===t||t.call(s,e),s.completed||!1})),r}return R(t,e),w(t,[{key:"doDestroy",value:function(){this.items.forEach((function(e){return e.destroy()})),B(t,"doDestroy",this,3)([])}},{key:"defaults",get:function(){return{element:this.element}}},{key:"retain",get:function(){var e=this._retain,t=this.finalize,n=this.owner;return null!=e?e:!t&&(!n||n.retain)},set:function(e){V(t,"retain",e,this,1,1)}},{key:"done",value:function(){return this.promise}},{key:"finish",value:function(e){var t,n,r=this,i=r.items;for(Is(r.element),r.completed="boolean"==typeof e?e:!e.some((function(e){return!e})),null===(t=r.prefinalize)||void 0===t||t.call(r,r.completed,r);i.length;)i.pop().destroy();null===(n=r.finalize)||void 0===n||n.call(r,r.completed,r)}},{key:"revert",value:function(e){var n,r=this,i=r.reverting,a=!e||null===(n=e.start)||void 0===n||n,o=r.defaults;return i&&(i.finalize&&(o.finalize=i.finalize),i.prefinalize&&(o.prefinalize=i.prefinalize),o.retain=i._retain),o=new t(o=Es(o,e,{items:r.items.map((function(e){return e.revert(Ts)})),reverting:r})),a&&o.start(),o}},{key:"start",value:function(){var e=this.element,n=this.items;return B(t,"start",this,3)([]),n.length&&(Is(e),n.forEach((function(e){return e.start()}))),this}}],[{key:"prototypeProperties",get:function(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}},{key:"register",value:function(e,n){Be.isObject(e)?Be.entries(e).forEach((function(e){return t.register.apply(t,z(e))})):(t.fx[e]=n,t[e]=function(n){return li.isElement(n)?n=S({element:n},e,{}):delete(n=S({element:n.element},e,n))[e].element,t.run(n)})}},{key:"run",value:function(e){return new t(e).start()}}])}(Mn.mixin(Ls));S(_s,"$name","Animator"),_s.initClass().Transition=Ps,_s.specialPropsRe=new RegExp("^(?:".concat(Object.keys(_s.prototypeProperties).concat(Object.keys(_s.superclass.prototypeProperties)).map((function(e){return"_"===e[0]?e.substr(1):e})).join("|"),")$")),_s.defaultDuration=200,_s.fx={},_s.register({puff:function(e){return!0===e?e={}:"object"!==W(e)?e={transform:"scale(".concat(e,")")}:e.scale&&((e=Be.clone(e)).transform="scale(".concat(e.scale,")"),delete e.scale),Es({opacity:0,transform:"scale(8)"},e)}}),_s._$name="Animator";var Hs=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;null===(e=this.mousedownRemover)||void 0===e||e.call(this),this.cancel(),B(t,"doDestroy",this,3)([])}},{key:"cancel",value:function(){var e,t,n,r=this;null===(e=r.activeElement)||void 0===e||e.classList.remove(r.pressedCls),r.activeElement=null,null===(t=r.acceleration)||void 0===t||t.cancel(),r.activeListenerRemover=null===(n=r.activeListenerRemover)||void 0===n?void 0:n.call(r),r.clearTimeout(r.autoRepeatTimer),r.clearTimeout(r.repeatTimer)}},{key:"updateElement",value:function(e){var t;null===(t=this.mousedownRemover)||void 0===t||t.call(this),this.mousedownRemover=fr.on({element:e,mousedown:"onMouseDown",thisObj:this})}},{key:"onMouseDown",value:function(e){var t=this,n=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),n&&(t.activeElement=n,t.triggerEvent=e,n.classList.add(t.pressedCls),t.activeListenerRemover=fr.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:n,handler:"onTargetMouseMove"},mouseleave:{element:n,handler:"onTargetMouseLeave"},mouseenter:{element:n,handler:"onTargetMouseEnter"},thisObj:t}),t.autoRepeatTimer=t.setTimeout("startAutoRepeat",t.delay))}},{key:"onMouseUp",value:function(){this.cancel()}},{key:"onTargetMouseLeave",value:function(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}},{key:"onTargetMouseEnter",value:function(e){var t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}},{key:"onTargetMouseMove",value:function(e){this.triggerEvent=e}},{key:"startAutoRepeat",value:function(){var e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=Tt.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}},{key:"nextTick",value:function(e){this.interval=this.startInterval-this.accelerationDelta*e}},{key:"fireClick",value:function(){var e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}],[{key:"configurable",get:function(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}}])}(Mn.mixin($i));Hs._$name="ClickRepeater";var Bs=/^(?:undefined|null|LEFT|RIGHT)$/,Vs={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},Ns=function(e){var t=null==e?void 0:e.toUpperCase();return[t,"LEFT"===t||"RIGHT"===t]},zs=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){var e=this.rotate;return{class:S(S({},"b-rotate-".concat((e||"").toLowerCase()),e),"b-rotate-vertical",e)}}},{key:"syncRotationToDock",value:function(e){if(Bs.test(String(this.rotate))){var t=_(Ns(e),2),n=t[0],r=t[1];this.rotate=r?this.invertRotate?Vs[n]:n:null}}},{key:"widgetClass",get:function(){return null}}],[{key:"configurable",get:function(){return{rotate:null,invertRotate:null}}}])}(e||Mn),S(t,"$name","Rotatable"),t},js=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){var e=this.align;return{tag:null!=this.href?"a":"button",class:S(S({},"b-align-".concat(e||"end"),1),"b-icon",1),listeners:{click:"onInternalClick"}}}},{key:"focusElement",get:function(){return this.element}},{key:"panel",get:function(){var e,t;if(null!==(e=this.parent)&&void 0!==e&&e.isPanel&&null!==(t=this.element)&&void 0!==t&&t.parentNode.matches(".b-panel-header"))return this.parent}},{key:"changeAlign",value:function(e){return e}},{key:"onInternalClick",value:function(e){var t=this,n=t.handler,r=t.panel,i={domEvent:e,tool:t};t.disabled||(t.trigger("click",i),t.isDestroyed||(t.trigger("action",i),t.isDestroyed||!1===(null==r?void 0:r.trigger("toolClick",i))||n&&t.callback(n,r,[e,r,t])))}},{key:"onInternalKeyDown",value:function(e){"Enter"===(e.key.trim()||e.code)&&e.stopPropagation()}},{key:"updateDisabled",value:function(e,n){var r;B(t,"updateDisabled",this,3)([e,n]),e&&(null===(r=this.repeat)||void 0===r||r.cancel())}},{key:"changeRepeat",value:function(e,t){return null==t||t.destroy(),e&&Hs.new({element:this.element},e)}},{key:"changeTooltip",value:function(e,n){var r=this,i=(null==e?void 0:e.html)||e;return r.ariaLabel||r.text||"string"!=typeof i||(r.ariaLabel=r.optionalL(i,r)),B(t,"changeTooltip",this,3)([e,n])}}])}(Lo.mixin(zs));S(js,"$name","Tool"),S(js,"type","tool"),S(js,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null,role:""}),js.initClass(),js._$name="Tool";var Ws=/right/i,$s=function(e){return(e.collapsed||e.collapsing)&&"top"===e.owner.expandedHeaderDock&&e.owner.collapsible.direction.match(Ws)?"start":"end"},Us=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){var e=this.collapsed,t=this.direction;return{"aria-label":this.L("L{PanelCollapser.".concat(e?"Expand":"Collapse","}")),class:S(S({},"b-icon-collapse-".concat(t),1),"b-collapsed",e)}}},{key:"changeAutoAlign",value:function(e){return!0===e?$s:e}},{key:"syncAutoAlign",value:function(){var e=this.autoAlign;e&&(this.align=e(this))}},{key:"updateAutoAlign",value:function(){this.syncAutoAlign()}},{key:"updateCollapsed",value:function(){this.syncAutoAlign()}},{key:"updateCollapsing",value:function(){this.syncAutoAlign()}},{key:"updateDirection",value:function(){this.syncAutoAlign()}}],[{key:"configurable",get:function(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}}])}(js);S(Us,"$name","CollapseTool"),S(Us,"type","collapsetool"),Us.initClass(),Us._$name="CollapseTool";var Gs=/^(?:UP|DOWN|LEFT|RIGHT)$/,Ys=/^(left|top)$/i,qs={},Ks=/^b-dock-(top|left|right|bottom)$/,Xs="b-panel-collapse-revealer",Zs=/^(?:left|right)$/i,Js="b-collapse-unflex",Qs=Math.round,eu=["up","down","left","right"].reduce((function(e,t){return e[t.toUpperCase()]=e[t]=t,e}),{}),tu={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},nu={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},ru={h:"w",w:"h"},iu={up:"top",right:"right",down:"bottom",left:"left"},au={top:!1,right:!0,bottom:!1,left:!0},ou={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},lu={top:function(e){return"translate(0, -".concat(Qs(e.height||0),"px)")},bottom:function(e){return"translate(0, ".concat(Qs(e.height||0),"px)")},right:function(e){return"translate(".concat(Qs(e.width||0),"px, 0)")},left:function(e){return"translate(-".concat(Qs(e.width||0),"px, 0)")}},su=0,uu=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"collapsing",get:function(){return"collapsing"===this.collapsingExpanding}},{key:"collapsingExpanding",get:function(){var e,t=null===(e=this.currentOperation)||void 0===e?void 0:e.collapsing;return null==t?null:t?"collapsing":"expanding"}},{key:"currentDock",get:function(){var e,t;return null!==(e=null===(t=this.panel)||void 0===t||null===(t=t.header)||void 0===t||null===(t=t.dock)||void 0===t?void 0:t.toLowerCase())&&void 0!==e?e:"top"}},{key:"expanding",get:function(){return"expanding"===this.collapsingExpanding}},{key:"collapseTool",get:function(){var e;return null===(e=this.panel)||void 0===e||null===(e=e.tools)||void 0===e?void 0:e.collapse}},{key:"collapseDim",get:function(){return Zs.test(this.collapseDir)?"width":"height"}},{key:"getCollapseDir",value:function(e){var t=this.direction,n=this.panel;if(!t||Gs.test(t)){var r,i=null==n?void 0:n.placement;if(i)t=nu[i];else t=ou[(null==n||null===(r=n.header)||void 0===r?void 0:r.dock)||"top"]}return e?eu[t]:t}},{key:"collapseDir",get:function(){return this.getCollapseDir(!0)}},{key:"collapseDock",get:function(){return this.collapseInfo[0]}},{key:"collapseInfo",get:function(){var e=this.panel,t=e.hasHeader&&e.expandedHeaderDock,n=iu[this.collapseDir],r=!1;return t&&((r=au[n]!==au[t])||(n=t)),[n,r]}},{key:"toolsConfig",get:function(){var e=this.direction,t=this.tool;return t&&{collapse:Be.assign({direction:e.toLowerCase()},t)}}},{key:"beforeCollapse",value:function(e){var t=this.panel;t.element.matches(":focus-within")&&t.revertFocus(!0)}},{key:"changeTool",value:function(e){var t=this,n=t.panel;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={collapse:e}}},{key:"collapse",value:function(e){var t,n,r=this,i=r.panel,a={id:++su,completed:!1,panel:i},o=r.currentOperation;return e=null==e||e,Be.isObject(e)&&(a.collapsed=!0,Be.assign(a,e),e=a.collapsed,delete a.collapsed),a.collapsing=e,a.previous=null!=o?o:null,e!==r.collapsed?o?o.collapsing!==e&&(a.animation=o.animation.revert({finalize:function(){var e;null===(e=r.collapseFinalize)||void 0===e||e.call(r,a,!0)}}),a.collapsing=e,o=a):(a.animation=Be.clone(("animation"in a?a:r).animation),!1!==r.beforeCollapse(a)&&(a.animation&&(a.animation.finalize=function(e){var t;return null===(t=r.collapseFinalize)||void 0===t?void 0:t.call(r,a,e)}),i.changingCollapse=!0,r[e?"collapseBegin":"expandBegin"](a),a.animation?o=a:(a.completed=!0,r[e?"collapseEnd":"expandEnd"](a)),i.changingCollapse=!1,a.animation||r.onComplete(e?"collapse":"expand"))):o&&o.collapsing!==e&&(r[e?"expandRevert":"collapseRevert"](a),a.animation=o.animation.revert({finalize:function(){var e;null===(e=r.collapseFinalize)||void 0===e||e.call(r,a,!1)}}),o=a),r.currentOperation=o,null!==(t=null===(n=o)||void 0===n||null===(n=n.animation)||void 0===n?void 0:n.done())&&void 0!==t?t:Promise.resolve(e===r.collapsed)}},{key:"collapseFinalize",value:function(e,t){var n=this,r=n.currentOperation,i=n.panel,a=i.collapsed?"expand":"collapse";r===e&&(n.currentOperation=null,e.completed=t,i.changingCollapse=!0,n[a+"End"](e),i.changingCollapse=!1,t&&n.onComplete(a))}},{key:"applyHeaderDock",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n.currentDock,a=n.panel,o=a.header,l=e?n.collapseDock:a.expandedHeaderDock;l!==r&&a.hasHeader&&(a.header=o?"string"==typeof o?{title:o}:Be.clone(a.header):{},a.header.dock=l,t&&a.recompose.flush())}},{key:"composeHeader",value:function(e){var t=this.panel,n=e.class,r=t.expandedHeaderDock||Object.keys(n).filter((function(e){return n[e]&&Ks.test(e)})).map((function(e){return Ks.exec(e)[1][0]}));return n[Xs]=1,n["b-collapsible-".concat(r[0]).concat(this.collapseDir[0])]=1,e}},{key:"composeTitle",value:function(e){return e.class[Xs]=1,e}},{key:"collapseBegin",value:function(e){var t,n=this,r=e.animation,i=n.collapseDim,a=n.collapseTool,o=n.panel,l=o.element,s=o.placement,u=_(n.collapseInfo,2),c=u[0],d=u[1],h=null==a?void 0:a.element.classList,f=!s||"h"===s[0]&&"width"===i||"v"===s[0]&&"height"===i;n.configuredWidth=o._lastWidth,n.configuredHeight=o._lastHeight,n.transverseCollapse=d,n.applyHeaderDock(!0);var v=o.rectangle(),g=n.lockInnerSize().moveTo(0,0),m=g.clone(),p=tu[c],y=null===(t=o.headerElement)||void 0===t?void 0:t.getBoundingClientRect(),k=Qs((null==y?void 0:y[i])||0);l.classList.toggle(Js,f),r?(m[p[0]]=m[p[1]],l.classList.add("b-collapsing"),null==h||h.add("b-collapsed","b-collapsing"),a&&(a.collapsing=!0),h&&(h.remove("b-collapsed"),o.rectangle(),h.remove("b-collapsing"),h.add("b-collapsed")),r.element=l,r.retain=!0,r[i]={from:Qs(v[i]),to:k},r.items=[{element:n.innerElement,retain:!1,clip:{from:"rect(".concat(g,")"),to:"rect(".concat(m,")")}}],d&&r.items.push({element:o.headerElement,duration:r.duration,retain:!1,transform:{from:lu[c](y),to:"translate(0, 0)"}}),e.animation=_s.run(r)):(l.style[i]="".concat(k,"px"),a&&(h.add("b-collapsing","b-collapsed"),a.rectangle(),h.remove("b-collapsing")))}},{key:"collapseEnd",value:function(e){var t=this,n=t.collapseTool;t.panel.isDestroyed||(t.panel.element.classList.remove("b-collapsing"),n&&(n.collapsing=!1),e.completed?t.collapsed=!0:(t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1)))}},{key:"collapseRevert",value:function(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.remove("b-collapsed")}},{key:"expandBegin",value:function(e){var t=this,n=e.animation,r=t.collapseDim,i=t.collapseTool,a=t.panel,o=_(t.collapseInfo,2),l=o[0],s=o[1],u=a.element,c=u.classList,d=c.contains(Js),h=a.rectangle();c.remove("b-collapsed","b-collapsing"),a.element.style[r]="",t.restoreConfiguredSize(),t.lockInnerSize(!1);var f=a.rectangle(),v=t.lockInnerSize().moveTo(0,0),g=v.clone(),m=tu[t.collapseDock];null==i||i.element.classList.remove("b-collapsed"),n&&(g[m[0]]=g[m[1]],c.add("b-collapsed","b-expanding"),d&&c.add(Js),n.element=u,n[r]={from:Qs(h[r]),to:Qs(f[r])},n.items=[{element:t.innerElement,retain:!1,clip:{from:"rect(".concat(g,")"),to:"rect(".concat(v,")")}}],s&&n.items.push({element:a.headerElement,duration:n.duration,retain:!1,transform:{from:"translate(0, 0)",to:lu[l](h)}}),e.animation=_s.run(n))}},{key:"expandEnd",value:function(e){var t=this;t.panel.element.classList.remove("b-expanding"),e.completed&&(t.collapsed=!1,t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}},{key:"expandRevert",value:function(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.add("b-collapsed")}},{key:"innerElement",get:function(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}},{key:"innerSizeElement",get:function(){return this.transverseCollapse?this.panel.element:this.innerElement}},{key:"supportAxis",get:function(){var e=this._supportAxis,t=!0===e;return(t||null==e)&&(e=this.collapseDim[0],(t||"absolute"===li.getStyleValue(this.panel.element,"position"))&&(e+=ru[e])),e||""}},{key:"lockInnerSize",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this,n=t.innerElement,r=t.panel,a=e?t.supportAxis:"",o=r.element,l=r.headerElement,s=e&&l&&pt.from(l,o),u=e&&pt.from(t.innerSizeElement,o),c=n.style;return l&&(l.style.minWidth=a.includes("w")?"".concat(s.width,"px"):"",l.style.minHeight=a.includes("h")?"".concat(s.height,"px"):""),c.width=e?"".concat(u.width,"px"):"",c.height=e?"".concat(u.height,"px"):"",n.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),u}},{key:"onCollapseClick",value:function(e){var t=!this.collapsing&&(!!this.expanding||!this.collapsed);e.altKey&&(t={animation:null,collapsed:t}),this.collapse(t)}},{key:"onComplete",value:function(e){var t,n;null===(t=this.panel)||void 0===t||null===(n=t.trigger)||void 0===n||n.call(t,e)}},{key:"onPanelHeaderClick",value:function(e){var t=e.event;0===t.button&&this.panel.collapsed&&t.target.classList.contains(Xs)&&this.onRevealerClick()}},{key:"onPanelConfigChange",value:function(e){var t=e.name,n=e.value,r=this,i=r.panel;"collapsed"===t?i.isPainted&&(r.collapsed=n):"header"!==t||i.changingCollapse||r.syncDirection()}},{key:"onPanelPaint",value:function(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}},{key:"onRevealerClick",value:function(){this.panel._collapse({collapsed:!1})}},{key:"restoreConfiguredSize",value:function(e){var t=this.configuredHeight,n=this.configuredWidth,r=this.panel;e=null!=e?e:"wh",r.element.classList.remove(Js),null!=n&&e.includes("w")&&(r.width=n),null!=t&&e.includes("h")&&(r.height=t)}},{key:"splitHeaderItems",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:qs,n=t.as,r=t.dock;return null===(e=this.panel)||void 0===e?void 0:e.splitHeaderItems({as:n,dock:r,alt:!0})}},{key:"syncDirection",value:function(){var e=this,t=e.direction;t&&!Gs.test(t)||(e.direction=e.getCollapseDir())}},{key:"changeCollapsed",value:function(e){return Boolean(e)}},{key:"updateCollapsed",value:function(e){var t=this.collapseTool,n=this.panel;n&&(n.collapsed=e,n.element.classList[e?"add":"remove"]("b-collapsed")),t&&(t.collapsed=e)}},{key:"updateDirection",value:function(e){var t=this.collapseTool,n=this.panel;t&&(t.direction=eu[e]),null!=n&&n.rendered&&n.recompose()}},{key:"updatePanel",value:function(e){var t,n=this;n.syncDirection(),null===(t=n.panelChangeDetacher)||void 0===t||t.call(n),n.panelChangeDetacher=e&&Tt.after(e,"onConfigChange","onPanelConfigChange",n,{return:!1})}},{key:"wrapCollapser",value:function(e,t){var n,r=this,i=_(r.collapseInfo,2),a=i[0];if(!i[1])return[e,t];var o=r.collapseDir,l=r.panel,s=l.expandedHeaderDock,u=l.header,c=l.uiClassList,d=null===(n=l.tools)||void 0===n?void 0:n.recollapse,h=_(r.splitHeaderItems({as:"element",dock:a}),2),f=h[0],v=h[1],g=l.hasHeader?l.title||(null==u?void 0:u.title)||" ":null,m=g&&{tag:"header",class:new Ct(F(F({},c),{},S(S(S({},"b-dock-".concat(s),1),"b-panel-header",1),"b-panel-collapser-header",1)),null==u?void 0:u.cls),style:null==u?void 0:u.style,children:[].concat(z(f),[{reference:"collapserTitleElement",html:g,class:F(F({},c),{},S(S({},"b-align-".concat((null==u?void 0:u.titleAlign)||"start"),1),"b-header-title",1))}],z(v))};return d&&(d.direction=o),["collapseWrapElement",{class:F(F({},c),{},S(S(S(S(S({},"b-panel-collapser-header-".concat(s),1),"b-panel-collapser-".concat(o),1),"b-".concat(au[s]?"h":"v","box"),1),"b-panel-collapser",1),"b-box-center",1)),children:Ys.test(s)?S({collapserHeaderElement:m},e,t):S(S({},e,t),"collapserHeaderElement",m)}]}}],[{key:"configurable",get:function(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler:function(e){var t;null===(t=this.collapsible)||void 0===t||t.onCollapseClick(e)}}}}},{key:"factoryable",get:function(){return{defaultType:"inline"}}}])}(Mn.mixin(Za));S(uu,"$name","PanelCollapser"),S(uu,"type","inline"),uu.maps={clipByDock:tu,dockByDirection:iu,dockIsHorz:au},uu.initClass(),uu._$name="PanelCollapser";var cu=Symbol("pendingCreate"),du=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"proxy",get:function(){var e=this,t=null;return e.proxyable&&(t=new Proxy(e.instances,{get:function(t,n){return e.get(n)},set:function(t,n,r){return e.set(n,r),!0},deleteProperty:function(t,n){return e.set(n,null),!0}})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}},{key:"target",get:function(){return this.proxy||this.object}},{key:"define",value:function(e,t){var n=this,r=n.transform,i=r?r(t,e):t,a=Be.isInstantiated(i);n.instances[e]=cu,a||n.setDefaults(e,i),n.defineProp(e,!0),a&&n.set(e,i)}},{key:"defineProp",value:function(e,t){var n=this,r=n.object;n.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(r):r,e,{configurable:!t,enumerable:!0,get:function(){return n.get(e)},set:function(t){return n.set(e,t)}})}},{key:"flush",value:function(){var e=this;try{var t;for(var n in e.updating=!0,e.defaults)e.get(n);e.afterConfigureOwner=null===(t=e.afterConfigureOwner)||void 0===t?void 0:t.call(e)}finally{e.updating=!1}}},{key:"get",value:function(e){var t=this.defaults,n=this.instances;return n[e]===cu&&this.set(e,cu),n[e]||t[e]&&null}},{key:"set",value:function(e,t){var n=this,r=n.cleanup,i=n.configName,a=n.defaults,o=n.factory,l=n.instances,s=n.owner,u=n.setup,c=n.transform,d=n.updating,h=s&&i&&!d,f=l[e]===cu?null:l[e],v=o.reconfigure(f,t===cu?{}:t||null,{cleanup:r&&function(t){return r(t,e)},defaults:a[e]||n.setDefaults(e,{}),owner:n.owner,setup:u&&function(t,n,r){return u(t,e,n,r)},transform:c&&function(t){return c(t,e)}});if(v!==f){var g,m=h&&F({},l);if(l[e]=v,v)n.defineProp(e),null===(g=n.created)||void 0===g||g.call(n,v,e);else delete n.object[e],delete l[e];h&&s.onConfigChange({name:i,config:s.$meta.configs[i],value:n.target,was:m})}}},{key:"setDefaults",value:function(e,t){var n=this.defaults,r=this.factory,i=this.inferType,a=this.instances,o=this.owner,l=this.ownerName,s=r.factoryable.typeKey;return t=!0===t?{}:Be.assign({},t),("name"===i||!0===i&&!t[s])&&(t[s]=e),l&&(t[l]=o),t.beforeConfigure=function(t){a[e]=t},n[e]=t}},{key:"update",value:function(e){var t,n,r=this,i=r.owner;try{if(r.updating=!0,e)for(t in e)n=e[t],r.defaults[t]?r.set(t,n):n&&r.define(t,n);else for(t in r.instances)r.set(t,null)}finally{r.updating=!1}i&&(i.isConfiguring?r.afterConfigureOwner||(r.afterConfigureOwner=Tt.before(i,"afterConfigure","flush",r)):r.flush())}}],[{key:"prototypeProperties",get:function(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null,transform:null}}},{key:"properties",get:function(){return{defaults:{},instances:{},object:Object.create({})}}}])}(Mn);du.initClass(),du._$name="DynamicObject";var hu=function(){return w((function e(){m(this,e)}),[{key:"data",get:function(){return Object.create(null)}},{key:"keys",get:function(){return[]}},{key:"clear",value:function(){}},{key:"getItem",value:function(e){return null}},{key:"removeItem",value:function(e){}},{key:"setItem",value:function(e,t){}}])}();hu._$name="StateStorage";var fu=function(e){function t(e){var n;return m(this,t),(n=g(this,t)).prefix=e.prefix||"",n}return R(t,e),w(t,[{key:"isLocal",get:function(){return!0}},{key:"data",get:function(){var e,t=gu(),n=D(this.keys);try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r]=this.getItem(r)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"keys",get:function(){return mu(this.prefix,this.prefix.length)}},{key:"clear",value:function(){var e,t=D(mu(this.prefix));try{for(t.s();!(e=t.n()).done;){var n=e.value;localStorage.removeItem(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"getItem",value:function(e){var t=localStorage.getItem(this.prefix+e);return null===t?t:JSON.parse(t)}},{key:"removeItem",value:function(e){return localStorage.removeItem(this.prefix+e)}},{key:"setItem",value:function(e,t){return localStorage.setItem(this.prefix+e,JSON.stringify(t))}}])}(hu),vu=function(e){function t(){var e;return m(this,t),(e=g(this,t)).clear(),e}return R(t,e),w(t,[{key:"isMemory",get:function(){return!0}},{key:"data",get:function(){return Be.clone(this._data)}},{key:"keys",get:function(){return Object.keys(this._data)}},{key:"clear",value:function(){this._data=gu()}},{key:"getItem",value:function(e){return e in this._data?this._data[e]:null}},{key:"removeItem",value:function(e){delete this._data[e]}},{key:"setItem",value:function(e,t){this._data[e]=t}}])}(hu),gu=function(){return Object.create(null)},mu=function(e){for(var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:0,r=[],a=localStorage.length,o=0;o<a;++o)(t=localStorage.key(o)).startsWith(e)&&r.push(t.slice(n));return r},pu=new hu,yu={local:fu,memory:vu},ku=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){self.writeStatefuls.flush(),B(t,"doDestroy",this,3)([])}},{key:"data",get:function(){return this.storage.data},set:function(e){if(e)for(var t in e)this.setValue(t,e[t]);else this.clear()}},{key:"clear",value:function(){return this.storage.clear(),this}},{key:"changeStorage",value:function(e){if(null==e)e=pu;else{if("string"==typeof e){if(!yu[e])throw new Error('Invalid storage type "'.concat(e,'" (expected one of: "').concat(Object.keys(yu).join('", "'),'")'));e=yu[e]}Be.isClass(e)&&(e=new e(this))}return e}},{key:"saveStateful",value:function(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}},{key:"writeStatefuls",value:function(){var e=this,t=e.pendingSaves,n=null==t?void 0:t.length,r=[],i=[];if(e.pendingSaves=null,n){for(var a,o,l,s=0;s<n;++s){var u=_(t[s],2);o=u[0],a=u[1],!o.isDestroying&&o.isSaveStatePending&&(l=o.saveState(F(F({},a),{},{immediate:!0})))&&(r.push(l),i.push(o))}r.length&&e.trigger("save",{stateIds:r,saved:i})}}},{key:"getValue",value:function(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}},{key:"setValue",value:function(e,t){var n=this,r=n.storage,i=n.getValue(e);return null!=t?(r.setItem(e,t),n.trigger("set",{key:e,value:t,was:i})):null!==i&&(r.removeItem(e),n.trigger("remove",{key:e,was:i})),n}}],[{key:"configurable",get:function(){return{prefix:"bryntum-state:",storage:"local"}}},{key:"delayable",get:function(){return{writeStatefuls:50}}},{key:"instance",get:function(){return this._instance},set:function(e){null==e?e=bu:(("string"==typeof e||Be.isClass(e)||e instanceof hu)&&(e={storage:e}),Be.isObject(e)&&(e=new t(e))),this._instance=e}},{key:"setup",value:function(e){return this.instance=e,this.instance}}])}(Mn.mixin($i,_n));S(ku,"$name","StateProvider");var bu=new ku({storage:pu});ku._instance=bu,ku._$name="StateProvider";var Cu=/boolean|number|string/,wu=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]),this.stateProvider&&this.loadState()}},{key:"finalizeInit",value:function(){this.stateProvider&&this.loadState(),B(t,"finalizeInit",this,3)([])}},{key:"isStateful",get:function(){return!0}},{key:"isStatefulActive",get:function(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}},{key:"state",get:function(){return this._state=this.getState()},set:function(e){this._state=e,e&&!1!==this.trigger("beforeStateApply",{state:e})&&this.applyState(e)}},{key:"updateStatefulEvents",value:function(e){var t=this,n={name:"statefulEvents",thisObj:t};if(t.detachListeners(n.name),e&&("string"==typeof e?e=Le.split(e):Array.isArray(e)||(e=Be.getTruthyKeys(e)),e.length)){var r,i,a=D(e);try{for(a.s();!(i=a.n()).done;){n[i.value]="onStatefulEvent"}}catch(e){a.e(e)}finally{a.f()}null===(r=t.ion)||void 0===r||r.call(t,n)}}},{key:"statefulId",get:function(){var e=this,t=e.responsiveState,n=e.stateId;return null==n&&!1===e.hasGeneratedId&&!1!==e.stateful&&(n=e.id),n&&t&&(n="".concat(n,"[").concat(t,"]")),n}},{key:"statefulness",get:function(){var e=this.stateful;return Array.isArray(e)?Be.createTruthyKeys(e):e}},{key:"stateProvider",get:function(){var e;return null!==(e=this._stateProvider)&&void 0!==e?e:this._stateId&&ku.instance}},{key:"applyState",value:function(e){(e=this.pruneState(e))&&this.setConfig(e)}},{key:"getState",value:function(){var e,t,n=this,r=n.initialConfig,i=n.statefulness,a=n.isConstructing,o=n.$meta.configs,l=a?Object.assign(Object.create(n.$meta.config),r):n,s=null;if(i)for(e in s={},i)if(i[e]){var u;if(null!==(u=t=l[e])&&void 0!==u&&u.isStateful)t=t.state;else if(!a&&(Be.isDate(t)&&(t=Pl.format(t,"YYYY-MM-DDTHH:mm:ssZ")),o[e].equal(t,null==r?void 0:r[e])||!Cu.test(W(t))))continue;s[e]=t}return s}},{key:"loadState",value:function(e,t){"boolean"==typeof e&&(t=e,e=null);var n=this,r=n.statefulLoaded;if(n.isStatefulActive&&(t||!r)){var i=n.loadStatefulData(e||(e=n.statefulId));!r&&e&&(n.defaultState=n.state,n.statefulLoaded=!0),i&&(n.state=i)}}},{key:"loadStatefulData",value:function(e){var t;return(e=this.isStatefulActive?e||this.statefulId:null)&&(null===(t=this.stateProvider)||void 0===t?void 0:t.getValue(e))}},{key:"resetDefaultState",value:function(){this.defaultState&&(this.state=this.defaultState)}},{key:"resumeStateful",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];this.statefulSuspended=e?0:Math.max(this.statefulSuspended-1,0)}},{key:"saveState",value:function(e){e="string"==typeof e?{id:e}:e||{};var t=this,n=t.stateProvider,r=e.id||t.isStatefulActive&&t.statefulId;if(r&&n){if(e.immediate){t.isSaveStatePending=!1;var i=t.state;!1!==t.trigger("beforeStateSave",{state:i})&&n.setValue(r,i)}else t.isSaveStatePending||(t.isSaveStatePending=!0,n.saveStateful(t,e));return r}}},{key:"suspendStateful",value:function(){++this.statefulSuspended}},{key:"onConfigChange",value:function(e){var n=e.name,r=e.value,i=e.was,a=e.config;if(B(t,"onConfigChange",this,3)([{name:n,value:r,was:i,config:a}]),!this.isConstructing&&this.isStatefulActive&&this.statefulId){var o=this.stateful;(Array.isArray(o)?o.includes(n):null==o?void 0:o[n])&&this.saveState()}}},{key:"onStatefulEvent",value:function(){this.isConstructing||this.saveState()}},{key:"pruneState",value:function(e){var t=this.statefulness;if(t){var n={};for(var r in e)t[r]&&(n[r]=e[r]);e=n}return e}},{key:"widgetClass",get:function(){}}])}((e||Mn).mixin(_n)),S(t,"$name","State"),S(t,"configurable",{stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),S(t,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),t},Du=[],Su={},xu={align:1,weight:1},Eu=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"byWeightSortFn",value:function(e,t){return(e.weight||0)-(t.weight||0)}},{key:"byWeightReverseSortFn",value:function(e,t){return(t.weight||0)-(e.weight||0)}},{key:"gatherTools",value:function(){var e,t,n,r,a=arguments.length>0&&arguments[0]!==i?arguments[0]:Su,o=a.align,l=a.alt,s=a.refs,u=this.collapsed,c=this.tools,d={collapsed:u,alt:l},h=[];for(e in c){var f,v,g,m;(null!==(f=null!==(v=null===(g=r=c[e])||void 0===g||null===(g=g.align)||void 0===g?void 0:g.align)&&void 0!==v?v:null===(m=r)||void 0===m?void 0:m.align)&&void 0!==f?f:"end")===o&&r.isCollapsified(d)&&h.push(r)}if(h.sort(this["end"===o?"byWeightReverseSortFn":"byWeightSortFn"]),s){var p="widget"===s,y={};for(t=0;t<h.length;++t)y[(n=h[t]).ref]=p?n:n.element;h=y}return h}},{key:"getEndTools",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:Su,t=e.alt,n=e.refs;return this.gatherTools({align:"end",alt:t,refs:n})}},{key:"getStartTools",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:Su,t=e.alt,n=e.refs;return this.gatherTools({align:"start",alt:t,refs:n})}},{key:"childItems",get:function(){return[].concat(z(this.getStartTools()),z(this._items||Du),z(this.getEndTools()))}},{key:"changeTools",value:function(e,t){var n=this,r=n.$tools||(n.$tools=new du({configName:"tools",factory:Lo,inferType:!1,owner:n,created:function(e){var t,i;e.innerItem=!1,null===(t=e.syncRotationToDock)||void 0===t||t.call(e,null===(i=n.header)||void 0===i?void 0:i.dock),Tt.after(e,"onConfigChange",(function(e,t){var i=t.name;xu[i]&&n.onConfigChange({name:"tools",value:r.target})})),n.onChildAdd(e)},setup:function(e,t){return(e=Be.merge({},n.toolDefaults["*"],n.toolDefaults[t],e)).parent=n,e.ref=t,e}}));if(r.update(e),!t)return r.target}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}}])}(e||Lo),S(t,"$name","Toolable"),t},Ru=["b-hbox","b-vbox"],Tu={name:"align",style:"alignItems"},Mu={name:"contentAlign",style:"alignContent"},Fu={name:"direction",style:"flexDirection"},Au={name:"justify",style:"justifyContent",classes:["stretch"]},Iu={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}},Lu=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"vertical",get:function(){return!1===this.horizontal},set:function(e){return this.horizontal=!e}},{key:"updateAlign",value:function(){this.syncConfigStyle(Tu)}},{key:"updateContentAlign",value:function(){this.syncConfigStyle(Mu)}},{key:"updateDirection",value:function(){this.syncConfigStyle(Fu)}},{key:"updateHorizontal",value:function(){var e,t=this,n=null===(e=t.contentElement)||void 0===e?void 0:e.classList,r=Number(t.vertical);n?(n.remove(Ru[1-r]),n.add(Ru[r])):t.syncConfigLater("horizontal"),t.syncDirection()}},{key:"updateJustify",value:function(){this.syncConfigStyle(Au)}},{key:"updateReverse",value:function(){this.syncDirection()}},{key:"updateWrap",value:function(){this.syncConfigStyle(Iu)}},{key:"syncDirection",value:function(){var e=this,t=e.reverse;e.direction=t?"".concat(e.vertical?"column":"row").concat(t?"-reverse":""):null}},{key:"changeGap",value:function(e){return"number"==typeof e&&(e="".concat(e,"px")),e}},{key:"updateGap",value:function(e){this.syncConfigStyle({name:"gap",style:"gap"})}}])}(Po);S(Lu,"$name","Box"),S(Lu,"type","box"),S(Lu,"alias","hbox"),S(Lu,"configurable",{containerCls:"b-box-container",itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null,gap:null}),Lu.initClass(),Lu._$name="Box";var Ou=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Lu);S(Ou,"$name","VBox"),S(Ou,"type","vbox"),S(Ou,"configurable",{horizontal:!1}),Ou.initClass(),Ou._$name="VBox";var Pu=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){var e=this.badge;return{dataset:{badge:e},class:{"b-badge":null!=e&&""!==e}}}}],[{key:"configurable",get:function(){return{badge:null}}}])}(e||Mn),S(t,"$name","Badge"),t},_u=/(?:^|\s)b-icon-/,Hu=/(?:^|\s)b-fa-/,Bu=["items","type","widgets","html","listeners"],Vu=Symbol("defaultListener"),Nu=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"construct",this,3)(n),this.ion({hide:"onInternalHide"})}},{key:"twinSyncConfigs",get:function(){var e={onAction:"onItem",onClick:"onItem"};return this.toggleable&&!this.hasConfig("menu")&&(e.pressed="checked"),e}},{key:"updateElement",value:function(e,n){var r,i,a=this,o=a.constructor,l=B(t,"updateElement",this,3)([e,n]),s=a.peekConfig("menu"),u=!!s&&(s.isWidget?s.role:(null===(r=o.resolveType(s.type))||void 0===r||null===(r=r.configurable)||void 0===r?void 0:r.role)||(null===(i=o.configurable.menuDefaults)||void 0===i?void 0:i.type)||"menu");return a.ariaHasPopup=u,l}},{key:"compose",value:function(){var e=this.color,t=this.href,n=this.icon,r=this.iconAlign,i=this.pressed,a=this.pressedIcon,o=this.target,l=this.text,s=this.toggleable,u=this.toggleGroup,c=this.menuIcon,d=this.behaviorType,h=this.tabIndex,f=this.pressedCls,v=this.split,g=this.hasConfig("menu"),m=i&&a?a:n,p="object"===W(l);return S(S(S(S({tag:t?"a":"button",href:t,target:o,tabIndex:h,type:d,class:F(S(S(S(S(S(S({},"b-icon-align-".concat(r),n),e,Boolean(e)),"b-pressed",i&&s),"b-text",Boolean(l)),"b-has-menu",g),"b-splitbutton",v),i&&f?Object.fromEntries(f.split(" ").map((function(e){return[e,1]}))):{})},s&&!g?"aria-pressed":"",i),"dataset",{group:u}),"listeners",{click:"onInternalClick",mousedown:"onInternalMousedown"}),"children",{iconElement:null!=n&&n.includes("/")?{"aria-hidden":!0,src:n,tag:"img",class:{"b-button-icon":1,"b-button-image":1}}:(n||a)&&{"aria-hidden":!0,tag:"i",class:F(F({},Ct.normalize(m,"object")),{},{"b-button-icon":1,"b-icon":_u.test(m),"b-fa":Hu.test(m)})},label:l&&this.ariaLabel!==l&&S(S({tag:"label",for:this.id},p?"children":"text",p?$e.asArray(l):l),"class",{"b-button-custom-content":p}),menuIconElement:g&&c&&{tag:"i",class:S({"b-icon":_u.test(c),"b-fa":Hu.test(c),"b-button-menu-icon":1},c,1)}})}},{key:"onInternalHide",value:function(){var e;null===(e=this._menu)||void 0===e||e.hide()}},{key:"childItems",get:function(){return this._menu&&[this.menu]}},{key:"onFocusOut",value:function(e){var n;B(t,"onFocusOut",this,3)([e]),null===(n=this.menu)||void 0===n||n.hide()}},{key:"focusElement",get:function(){return this.element}},{key:"changeText",value:function(e){return null==e?"":e}},{key:"changeToggleable",value:function(e){return e===i&&(e=Boolean(this.toggleGroup||this.config.menu)),e}},{key:"changeMenu",value:function(e,t){var n=this,r=n.element;return e?(e.isWidget?(e.forElement=r,e.owner=n,e.constrainTo=n.rootElement):("object"!==W(e)||Bu.some((function(t){return t in e}))||(e={lazyItems:e}),e=Lo.reconfigure(t,e?Be.merge({owner:n,constrainTo:n.rootElement,forElement:r},n.menuDefaults,e):null,n)),e.align.constrainPadding=10,n.detachListeners(Vu),e.ion({name:Vu,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):null==t||t.destroy(),e}},{key:"onMenuBeforeShow",value:function(e){var t=e.source;return this.trigger("beforeShowMenu",{menu:t})}},{key:"onMenuShow",value:function(){this.ariaElement.setAttribute("aria-expanded",!0)}},{key:"onMenuHide",value:function(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}},{key:"updateMenu",value:function(e){this.toggleable=Boolean(e)}},{key:"updatePressed",value:function(e){var t=this;t.toggleable&&!t.isConfiguring&&(e&&li.forEachSelector(t.rootElement,"button[data-group=".concat(t.toggleGroup,"]"),(function(e){e!==t.element&&(Lo.getById(e.id).pressed=!1)})),t.toggleMenu(!t.split&&e),t.trigger("toggle",{pressed:e,userAction:Boolean(t.triggeredByEvent)}))}},{key:"configureOverflowTwin",value:function(e){var n=this,r=B(t,"configureOverflowTwin",this,3)([e]),i=n.menu;return r.type=Lo.resolveType("menuitem"),i?r.menu=n.constructor.mergeConfigs(r.menu,{type:"menu",items:i.items.map((function(e){return e.ensureOverflowTwin()}))}):n.toggleable&&(r.checked=n.pressed),r.text||(r.text=n.text||n.tooltipText),r}},{key:"onInternalMousedown",value:function(e){var t;(ne.isSafari||null!==(t=this._menu)&&void 0!==t&&t.containsFocus&&this.pressed)&&e.preventDefault()}},{key:"changeTooltip",value:function(e,n){var r=this,i=(null==e?void 0:e.html)||e;return r.ariaLabel||r.text||"string"!=typeof i||(r.ariaLabel=r.optionalL(i,r)),B(t,"changeTooltip",this,3)([e,n])}},{key:"onArrowDown",value:function(){if(!this.menu)return!1;this.toggleMenu(!0)}},{key:"onInternalClick",value:function(e){var t=this,n={event:e};if(!t.disabled)if(t.split&&e.target.closest(".b-button-menu-icon")){var r;t.toggleMenu(!(null!==(r=t._menu)&&void 0!==r&&r.isVisible))}else{if(t.triggeredByEvent=e,t.toggleable){var i=t.toggleGroup&&t.pressed&&!t.supportsUnpressing;if(i&&!t.supportsPressedClick)return;if(i||t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",n),t.isDestroyed||t.trigger("action",n),t.href||(e.preventDefault(),e.stopPropagation()),t.triggeredByEvent=null}}},{key:"toggle",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:!this.pressed;!1!==this.trigger("beforeToggle",{pressed:e,userAction:Boolean(this.triggeredByEvent)})&&(this.pressed=e)}},{key:"toggleMenu",value:function(e){if(e){var t,n,r=this.menu;if(r)r.owner=this,r.forElement=this.element,r.initialConfig.minWidth||(r.minWidth=this.width),r.align.minHeight=null!==(t=r._minHeight)&&void 0!==t?t:100,r.align.minWidth=null!==(n=r._minWidth)&&void 0!==n?n:100,r.show()}else{var i;null===(i=this._menu)||void 0===i||i.hide()}}}],[{key:"configurable",get:function(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,pressedCls:null,iconAlign:"start",behaviorType:"button",text:{value:null,$config:null,default:""},color:null,toggleable:i,pressed:!1,toggleGroup:null,supportsPressedClick:!1,supportsUnpressing:!1,ripple:{radius:75},twinForwardEvents:{item:"action"},twinSyncConfigs:null,localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,tabIndex:null,defaultBindProperty:null,split:null,keyMap:{ArrowDown:"onArrowDown"},role:""}}}])}(Lo.mixin(Pu,zs));S(Nu,"$name","Button"),S(Nu,"type","button"),Nu.initClass(),Nu._$name="Button";var zu={refs:"element"},ju=function(e){return e.element.style.margin=""},Wu=function(e){return e.isToolbar},$u=function(e){return e[0]+(e[1].minifiable?0:9e9)},Uu={hidden:!1,width:""},Gu=F(F({},Uu),{},{flex:""}),Yu={flex:1,hidden:1,maxWidth:1,minWidth:1,width:1,disabled:1},qu=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],Ku={delay:0,startRate:40,endRate:200,accelerateDuration:500},Xu={menu:1,pressed:1},Zu=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateEnableReordering",value:function(e){var t,n=this;e?n.dragHelper=new Qi({name:"itemReorder",mode:"container",lockY:!0,dragThreshold:10,targetSelector:".b-widget",floatRootOwner:n,rtlSource:n,outerElement:n.contentElement,containers:[n.contentElement],internalListeners:{beforeDragStart:n.onBeforeDragStart,dragstart:n.onDragStart,itemMove:n.onItemMove,drop:n.onDrop,thisObj:n}}):null===(t=n.dragHelper)||void 0===t||t.destroy()}},{key:"compose",value:function(){var e=this,t=e.axisProps,n=e.dock,r=e.getEndTools(zu),i=e.getStartTools(zu);return{class:S(S(S({},"b-dock-".concat(n),1),"b-".concat(n,"-toolbar"),1),"b-".concat(t.box),1),children:F(F({},i),{},{toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}}},r)}}},{key:"axisProps",get:function(){return qu[this.layout.horizontal?0:1]}},{key:"contentElement",get:function(){return this.toolbarContent}},{key:"overflowMenuButton",get:function(){var e;return null===(e=this.tools)||void 0===e?void 0:e.overflowMenuButton}},{key:"overflowType",get:function(){var e=this.overflow;return"string"==typeof e?e:null==e?void 0:e.type}},{key:"onChildAdd",value:function(e){var n;B(t,"onChildAdd",this,3)([e]),this.processAddedLeafItem(e),null===(n=e.syncRotationToDock)||void 0===n||n.call(e,this.dock)}},{key:"onChildRemove",value:function(e){B(t,"onChildRemove",this,3)([e]),this.syncOverflowVisibility()}},{key:"processAddedLeafItem",value:function(e){var t=this;Tt.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget((function(e){return t.processAddedLeafItem(e)}))}},{key:"onInternalPaint",value:function(e){var n,r=e.firstPaint;null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n(arguments),r&&this.getConfig("overflow")}},{key:"updateDock",value:function(e){var t=this,n=t.layout,r=n.vertical;if(n.vertical=Ns(e)[1],!t.initialItems){r!==n.vertical&&t.updateOverflow(t.overflow);var i,a=D(t.childItems);try{for(a.s();!(i=a.n()).done;){var o,l=i.value;null===(o=l.syncRotationToDock)||void 0===o||o.call(l,e)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"updateOverflow",value:function(e,t){var n,r,i=this,a=i.axisProps,o=i.contentElement,l=i.overflowType,s=a.flexDir,u=null===(n=i.overflowMenuButton)||void 0===n?void 0:n._menu,c={};if(u&&(e?null==u||u.removeAll():u.eachWidget((function(e){e._overflowTwinOrigin.overflowTwin=null}))),"menu"===t?c.overflowMenuButton=null:"scroll"===t&&(c.overflowScrollStart=c.overflowScrollEnd=null),"menu"===l)null===(r=i.scrollable)||void 0===r||r.destroy(),o.style.overflow=o.style.overflowX=o.style.overflowY="",c.overflowMenuButton={cls:S({},"b-".concat(s,"-menu"),1)};else if("scroll"===l){var d="object"===W(e)&&(null==e?void 0:e.repeat)||Ku;i.scrollable=S(S(S({},a.overflow,"hidden-scroll"),"element",o),"internalListeners",{scroll:"onContentScroll",thisObj:i}),c.overflowScrollStart={repeat:d,invertRotate:!0,cls:S({},"b-".concat(s,"-start-scroller"),1)},c.overflowScrollEnd={repeat:d,invertRotate:!0,cls:S({},"b-".concat(s,"-end-scroller"),1)}}i.tools=c,l?(o.classList.add("b-overflow"),i.monitorResize=!0,i.syncOverflowVisibility()):(o.classList.remove("b-overflow"),i.monitorResize=!1)}},{key:"onContentScroll",value:function(){this.syncScrollerState()}},{key:"onStartScrollClick",value:function(){this.scrollable[this.axisProps.pos]-=2}},{key:"onEndScrollClick",value:function(){this.scrollable[this.axisProps.pos]+=2}},{key:"onInternalResize",value:function(){B(t,"onInternalResize",this,3)(arguments),this.isPainted&&this.syncOverflowVisibility()}},{key:"syncOverflowVisibility",value:function(){var e,n,r,i,a,o,l,s,u,c,d,h=this,f=h.overflowType,v=h.contentElement,g=h.isVisible,m=h.axisProps,p=m.clientSizeProp,y=m.edgeProp,k=m.sizeProp,b=h.tools,C=b.overflowMenuButton,w=b.overflowScrollStart,S=b.overflowScrollEnd,x=h.rtl&&h.layout.horizontal,E="menu"===f,R=function(){return Math.ceil(v[p]+(!w||w.hidden?0:w.rectangle("outer")[k])+(!S||S.hidden?0:S.rectangle("outer")[k]))},T=function(){if(0===d.length)return 0;var e=d[d.length-1].rectangle(v);return Math.floor(x?v[p]-e.left:e[y])};if(g&&f&&0!==h.items.length){if(h.inSyncOverflowVisibility=!0,null==C||C.hide(),h.eachWidget((function(e,t){o=e.minifiable,u=e.overflowable,u=o?u||o:u,e.floating?t.down=!1:(t.down=!u,e.innerItem&&(e._toolbarOverflow&&(e.hidden=e._toolbarOverflow=!1),e._toolbarMinified&&(e.minified=e._toolbarMinified=!1),e.isVisible&&(o&&(l||(l=[])).push(e),u&&(d||(d=[])).push(e))))})),d&&(e=R(),n=T()),d&&n>e)if(E){for(;n>e&&(i=null===(M=l)||void 0===M?void 0:M.pop());){var M;a=n,i._toolbarMinified=!0,i.minified=!0,a-=n=T(),(s||(s=[])).push([i,a])}if(n>e){C.show(),e=R();var F,A=D(t.getEvictionList(d));try{for(A.s();!(F=A.n()).done;)r=F.value,n>e&&((i=r[1])._toolbarOverflowWidth=i.width,i._toolbarOverflow=!0,i.hidden=!0,d.splice(d.indexOf(i),1),(c||(c=[])).push(r),n=T())}catch(e){A.e(e)}finally{A.f()}if(c){for(c.sort((function(e,t){return e[0]-t[0]})).forEach((function(e,t){return c[t]=e[1]}));null!==(I=s)&&void 0!==I&&I.length;){var I,L=_(s.pop(),2);i=L[0],n+(a=L[1])<=e&&!i._toolbarOverflow&&(n+=a,i.minified=i._toolbarMinified=!1)}h.syncOverflowMenuButton(c)}else C.hide()}}else S.show(),w.show(),h.syncScrollerState();else E||(null==S||S.hide(),null==w||w.hide());h.inSyncOverflowVisibility=!1}}},{key:"syncOverflowMenuButton",value:function(e){var t,n,r=this,i=r.axisProps,a=r.overflowMenuButton,o={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:i.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}},l=D(e);try{for(l.s();!(n=l.n()).done;){var s=n.value;r.overflowItemFilter(s)&&s.addToOverflowMenu(o,r.horizontal?Gu:Uu,ju)}}catch(e){l.e(e)}finally{l.f()}if(o.items.forEach((function(e){var t=e._overflowTwinOrigin,n=t.parent.indexOfChild(t);t.parent!==r&&(n=r.indexOfChild(t.parent)+n/1e5),e.weight=n})),null!==(t=a._menu)&&void 0!==t&&t.isMenu){var u=a.menu,c=$e.delta(o.items,u.items,!0),d=c.toAdd,h=c.toRemove;u.remove(h),u.add(d)}else a.menu=o}},{key:"syncScrollerState",value:function(){var e=this,t=e.axisProps,n=e.scrollable,r=e.tools,i=r.overflowScrollStart,a=r.overflowScrollEnd,o=n[t.pos],l=n[t.max];i.disabled=!o,a.disabled=Math.abs(Math.ceil(o))>=Math.abs(l)}},{key:"overflowItemFilter",value:function(e){var t=this.overflow.filter;return Boolean(t?t.call(this,e):li.getChildElementCount(e.element))}},{key:"onLeafItemConfigChange",value:function(e,t){var n=t.name,r=t.value,i=this,a=i.up(Wu),o=a.hasConfig("overflow"),l=i.overflowTwin;!o||null!=a&&a.inSyncOverflowVisibility||"hidden"===n&&r===i._toolbarOverflow||!Yu[n]&&(null!=i._width&&!i.monitorResize||i._flex&&!String(i._flex).endsWith("auto"))||(l&&!Xu[n]&&(l[n]=r),null!=a&&a.isPainted&&"overflowMenuButton"!==i.ref&&((i.isTextField||i.isSlider||i.isCheckbox)&&"value"===n&&(i.containsFocus||null!=l&&l.containsFocus)||a.syncOverflowVisibility()))}},{key:"createWidget",value:function(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});var n=B(t,"createWidget",this,3)([e]);return this.widgetCls&&n.element.classList.add(this.widgetCls),n}},{key:"onBeforeDragStart",value:function(e){var t=e.context,n=e.event,r=t.item=this.items[t.element.dataset.itemIndex];return t.oldIndex=Number.parseInt(r.element.dataset.itemIndex,10),this.trigger("beforeItemDragStart",{item:r,domEvent:n})}},{key:"onDragStart",value:function(e){var t=e.context,n=e.event,i=t.item;t.dragProxy.style.backgroundColor=r.getComputedStyle(this.element).backgroundColor,this.trigger("itemDragStart",{item:i,domEvent:n})}},{key:"onItemMove",value:function(e){var t=e.context,n=e.event,r=t.item,i=Array.from(r.element.parentElement.children).indexOf(r.element);this.insert(r,i),this.trigger("itemDragMove",{item:r,domEvent:n})}},{key:"onDrop",value:function(e){var t=e.context,n=e.event,r=t.item,i=t.valid;this.trigger("itemDrop",{item:r,domEvent:n,valid:i})}},{key:"doDestroy",value:function(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}}],[{key:"getEvictionList",value:function(e){var t=e.filter((function(e){return"none"!==e.overflowable}));return t.forEach((function(e,n){return t[n]=[n,e]})),t.sort((function(e,t){return $u(t)-$u(e)})),t}}])}(Ss.mixin(Eu));S(Zu,"$name","Toolbar"),S(Zu,"type","toolbar"),S(Zu,"delayable",{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}),S(Zu,"configurable",{role:"toolbar",defaultType:"button",dock:"top",layout:{type:"box"},enableReordering:null,overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,ariaLabel:"L{Toolbar.showOverflowingItems}",defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,ariaLabel:"L{Toolbar.scrollForMore}",defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,ariaLabel:"L{Toolbar.scrollForMore}",defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}),S(Zu,"prototypeProperties",{flexRowCls:"b-hbox",flexColCls:"b-vbox"}),Zu.initClass(),Zu._$name="Toolbar";var Ju=function(e){return e.classList.contains("b-focus-trap")||e.classList.contains("b-hidden")||!li.getFocusability(e).focusable?li.NodeFilter.FILTER_SKIP:li.NodeFilter.FILTER_ACCEPT},Qu=[],ec={},tc=[Qu,Qu],nc=function(e,t,n){var r=e.vertical;return delete e.vertical,F(F({},e),{},{class:F(F({},t),{},S(S(S({},"b-".concat(r?"v":"h","box"),1),"b-box-center",1),"b-panel-bar-wrap",!n))})},rc=function(e,t){var n={vertical:arguments.length>2&&arguments[2]!==i&&arguments[2],children:e?[e]:[]};return t&&(n.tag=t),n},ic=function(e,t){null!=e&&e.classList?null==e||e.classList.add(t):null!=e&&e.class&&("string"==typeof e.class&&(e.class=S({},e.class,1)),e.class[t]=1)},ac={dock:1,hidden:1,weight:1},oc={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},lc={header:1,"pre-header":1},sc={top:"up",right:"right",bottom:"down",left:"left"},uc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"bodyWrapRootElement",get:function(){return this[this._bodyWrapRootName]}},{key:"changeFooter",value:function(e){return e&&("start"===e.dock?e.dock="left":"end"===e.dock&&(e.dock="right")),e}},{key:"compose",value:function(){var e,t=this,n=t.collapsible,r=t.focusable,i=t.revealed,a=t.tools,o=t.role,l=t.floating,s=t.composeHeader(),u=t.getPositionableItems("after",!0),c=t.getPositionableItems("before",!0),d=(null==s?void 0:s.class["b-dock-left"])||(null==s?void 0:s.class["b-dock-right"]),h=null==s||null===(e=s.children)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.id,f=t.composeBody(),v="bodyWrapElement";if(n){var g=_(n.wrapCollapser(v,f),2);v=g[0],f=g[1]}t._bodyWrapRootName=v;var m={role:o&&"element"===t._ariaElement?o:l?"dialog":"region",tabIndex:(l||t.peekConfig("positioned"))&&!1!==r?-1:r?0:null,class:S(S(S(S(S(S(S({},"b-panel-collapsible-".concat(null==n?void 0:n.type),n),"b-panel-collapse-".concat(null==n?void 0:n.collapseDir),n),"b-".concat(d?"h":"v","box"),1),"b-panel-collapsible",n),"b-panel-has-header",s),"b-panel-has-tools",a?1:0),"b-panel-overlay-revealed",i),children:F(F(F({topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-top-focus-trap":1}}},c),{},S({headerElement:s},v,f),u),{},{bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}})};return h&&(m["aria-labelledby"]=h),m}},{key:"updateElement",value:function(){this.getConfig("drawer"),B(t,"updateElement",this,3)(arguments)}},{key:"updateDrawer",value:function(e){var t,n=e.side,r=void 0===n?"end":n,i=e.inline,a=this,o=a.element,l=a.rtl,s=a.getRenderContext()[0]||(i?document.body:null),u=a.parent||s&&!i?"positioned":"floating";r="start"===r?l?"right":"left":"end"===r?l?"left":"right":r,a.updateConfiguration(S(S(S({forElement:null,closable:!1,align:null,autoShow:!1,monitorResize:!1,centered:!1,anchor:!1,hidden:!1,draggable:!1,appendTo:s||(null===(t=a.owner)||void 0===t?void 0:t.floatRoot)||a.floatRoot,hideMode:"collapse",trapFocus:!0},u,!i),"collapsed","object"!==W(e)||!("collapsed"in e)||e.collapsed),"collapsible",F(F({},e),{},{type:i?"inline":"overlay",direction:sc[r||"end"]}))),o.classList.add("b-drawer-panel"),o.classList.remove("b-popup"),o.style.setProperty("--b-drawer-size",li.setLength(null==e?void 0:e.size)),a.ion({thisObj:a,reveal:function(){return a.trigger("show")},unreveal:function(){return a.trigger("hide")}})}},{key:"isVisible",get:function(){return this.drawer?!this.collapsible.collapsed||this.revealed:B(t,"isVisible",this,1)}},{key:"hide",value:function(){var e=this;if(!e.drawer)return B(t,"hide",this,3)(arguments);if(!1!==e.trigger("beforeHide")){var n="inline"===e.collapsible.type?e.collapse():e.collapsible.toggleReveal(!1);return e.trigger("hide"),n}}},{key:"show",value:function(){var e=this;if(!e.drawer)return B(t,"show",this,3)(arguments);if(!1!==e.trigger("beforeShow")){var n="inline"===e.collapsible.type?e.expand():e.collapsible.toggleReveal(!0);return e.afterShow(),e.focus(),n}}},{key:"showBy",value:function(){return this.drawer?this.show():B(t,"showBy",this,3)(arguments)}},{key:"composeBody",value:function(){var e,t,n,r,i,a,o,l,s,u=this,c=u.bodyCls,d=u.bodyConfig,h=u.bodyWrapTag,f=u.footer,v=u.uiClassList,g=Be.values(u.strips,(function(e,t){return!oc[null==t?void 0:t.dock]})).sort(u.byWeightSortFn),m={top:null,right:null,bottom:null,left:null};for(f&&(i=f.dock||"bottom",g.unshift({dock:i,element:{tag:"footer",reference:"footerElement",html:"string"==typeof f?f:f.html,class:F(F({},v),{},S(S({},"b-dock-".concat(i),1),"".concat(f.cls||""),1))}})),c&&(d[o="className"]||(o="class"),d[o]=new Ct(d[o]).assign(c)),a=g.length;a-- >0;){n=g[a];var p=_(oc[n.dock],2);l=p[0],r=p[1],s?s.vertical!==l&&(s=rc(nc(s,v),"",l)):s=rc(d,h,l),s.children[r?"unshift":"push"](n.element),m[n.dock]=n}ic(m.top,"b-innermost"),ic(m.right,"b-innermost"),ic(m.bottom,"b-innermost"),ic(m.left,"b-innermost");var y=nc(s||rc(d,h),v,!0);return y.class["".concat(null===(e=u.layout)||void 0===e?void 0:e.containerCls,"-panel")]=Boolean(null===(t=u.layout)||void 0===t?void 0:t.containerCls),y.class["b-panel-body-wrap"]=1,y.class["b-".concat(u.$$name.toLowerCase(),"-body-wrap")]=1,y}},{key:"hasHeader",get:function(){if(!1===this.header)return!1;var e=this.header,t=this.title,n=this.tools,r=this.parent,i=this.maximizable||Object.values(n||{}).some((function(e){return!e.hidden}));return e||!(null!=r&&r.suppressChildHeaders)&&(t||i)}},{key:"rootUiClass",get:function(){return t}},{key:"changeHeader",value:function(e){return"string"==typeof e?{title:e}:e}},{key:"composeHeader",value:function(e){var n,r=this;if(r.hasHeader||e){var i,a,o=r.header||{},l=o.dock||"top",s=_(r.splitHeaderItems({as:"element",dock:l}),2),u=s[0],c=s[1],d=r.$meta.hierarchy,h=r.composeTitle(o),f=new Ct(F(S({},"b-dock-".concat(l),1),r.uiClassList),o.cls);for(i=d.indexOf(t);i<d.length;++i)"Grid"!==(a=d[i].$$name)&&(f["b-".concat(a.toLowerCase(),"-header")]=1);var v=F(F({},o),{},{tag:"header",class:f,children:[].concat(z(u),[h],z(c))});return(null===(n=r.collapsible)||void 0===n?void 0:n.composeHeader(v))||v}}},{key:"composeTitle",value:function(e){var t,n=this.title||e.title,r={reference:"titleElement",id:"".concat(this.id,"-panel-title"),"aria-live":"polite",class:F(S(S({},"b-align-".concat(e.titleAlign||"start"),1),"b-header-title",1),this.uiClassList)};if(n)if(Be.isObject(n))Be.merge(r,n);else{var i=e.iconCls;i?r.children=[{tag:"i",class:"b-panel-title-icon "+i},n]:r.html=n}return(null===(t=this.collapsible)||void 0===t?void 0:t.composeTitle(r))||r}},{key:"updateTitle",value:function(){}},{key:"afterRecompose",value:function(){var e;B(t,"afterRecompose",this,3)([]);var n=this,r=n.headerElement;null===(e=n._headerClickDetacher)||void 0===e||e.call(n),n._headerClickDetacher=r&&fr.on({element:r,click:function(e){var t;return null===(t=n.trigger)||void 0===t?void 0:t.call(n,"panelHeaderClick",{event:e})}})}},{key:"onPanelHeaderClick",value:function(e){var t;null===(t=this.collapsible)||void 0===t||t.onPanelHeaderClick(e)}},{key:"onInternalPaint",value:function(){var e;B(t,"onInternalPaint",this,3)(arguments),null===(e=this.collapsible)||void 0===e||e.onPanelPaint(this)}},{key:"splitHeaderItems",value:function(){var e,t,n,r=arguments.length>0&&arguments[0]!==i?arguments[0]:ec,a=r.as,o=r.dock,l=r.alt,s=this,u="element"===a,c=s.collapsed,d=s.getEndTools({alt:l}),h=s.getStartTools({alt:l}),f=Be.values(s.strips,(function(e,t){return!lc[null==t?void 0:t.dock]&&t.isCollapsified({collapsed:c,alt:l})})),v=tc;if(f.length+d.length+h.length){for(v=[t=[].concat(z(h),z(f.filter((function(e){return"pre-header"===e.dock})).sort(s.byWeightSortFn))),e=[].concat(z(f.filter((function(e){return"header"===e.dock})).sort(s.byWeightReverseSortFn)),z(d))],n=0;n<t.length;++n){var g,m;o&&(null===(g=(m=t[n]).syncRotationToDock)||void 0===g||g.call(m,o)),u&&(t[n]=t[n].element)}for(n=0;n<e.length;++n){var p,y;o&&(null===(p=(y=e[n]).syncRotationToDock)||void 0===p||p.call(y,o)),u&&(e[n]=e[n].element)}}return v}},{key:"bodyConfig",get:function(){var e=this,n=e.bodyTag,r=Be.merge({reference:"bodyElement",className:F(F({},e.getStaticWidgetClasses(t,"-content")),{},{"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren})},e._bodyConfig);return n&&(r.tag=n),r},set:function(e){this._bodyConfig=e}},{key:"changeBodyCls",value:function(e){return Ct.from(e)}},{key:"changeTbar",value:function(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}},{key:"changeBbar",value:function(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}},{key:"childItems",get:function(){var e,t=this,n=Be.values(t.strips,(function(e,t){return!oc[null==t?void 0:t.dock]})).sort(t.byWeightSortFn),r=_(t.splitHeaderItems(),2),i=r[0],a=r[1],o=_((null===(e=t.collapsible)||void 0===e?void 0:e.splitHeaderItems())||tc,2),l=o[0],s=o[1];return[].concat(z(i),z(l),z(a),z(s),z(n.filter((function(e){return oc[e.dock][1]}))),z(t.items),z(n.filter((function(e){return!oc[e.dock][1]})).reverse()))}},{key:"childItemsOrderedByRelevance",get:function(){var e,t=this,n=Be.values(t.strips,(function(e,t){return!oc[null==t?void 0:t.dock]})).sort(t.byWeightSortFn),r=_(t.splitHeaderItems(),2),i=r[0],a=r[1],o=_((null===(e=t.collapsible)||void 0===e?void 0:e.splitHeaderItems())||tc,2),l=o[0],s=o[1];return[].concat(z(t.items),z(n.filter((function(e){return!oc[e.dock][1]})).reverse()),z(i),z(l),z(a),z(s),z(n.filter((function(e){return oc[e.dock][1]}))))}},{key:"changeStrips",value:function(e,t){var n=this,r=n.$strips||(n.$strips=new du({configName:"strips",factory:Lo,inferType:!1,owner:n,created:function(e){var t,i=e.dock;if(!lc[i]&&!oc[i])throw new Error('Invalid dock value "'.concat(i,'"; must be: top, left, right, bottom, header, or pre-header'));Tt.after(e,"onConfigChange",(function(e,t){var i=t.name;ac[i]&&n.onConfigChange({name:"strips",value:r.target})})),e.innerItem=!1,n.onChildAdd(e),e.parent=n,null===(t=e.layout)||void 0===t||t.renderChildren(),e.hasItems&&(n.hasItems=!0)},setup:function(e,t){return(e=Be.merge(Be.clone(n.stripDefaults["*"]),n.stripDefaults[t],e)).parent=n,e.ref=t,e},transform:function(e){return Array.isArray(e)&&(e={items:e}),e||null}}));if(r.update(e),!t)return r.target}},{key:"collapsing",get:function(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsing}},{key:"collapsingExpanding",get:function(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsingExpanding}},{key:"expanding",get:function(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.expanding}},{key:"changeCollapsed",value:function(e){var t=this,n=t.collapsible;if(t.recompose.flush(),e=Boolean(e),!n||t.changingCollapse||!t.isPainted)return e;null==n||n.collapse({animation:null,collapsed:e})}},{key:"changeCollapsible",value:function(e,t){var n=this;return n.getConfig("tools"),e&&(!0===e?e={}:"string"==typeof e&&(e=S({},oc[e]?"direction":"type",e))),uu.reconfigure(t,e,{owner:n,defaults:{panel:n},cleanup:function(){n.collapsed&&!e&&(t.collapse({animation:null,collapsed:!1}),n._collapsed=1)}})}},{key:"updateCollapsible",value:function(e){var t=this,n=null==e?void 0:e.toolsConfig;t.tools={collapse:(null==n?void 0:n.collapse)||null,recollapse:(null==n?void 0:n.recollapse)||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),1===t.collapsed&&(t.collapsed=!0)}},{key:"_collapse",value:function(e,t){var n;return!0!==t&&t!==i&&(!1===t?e.collapsed=!e.collapsed:"number"==typeof t?e.animation={duration:t}:null===t?e.animation=t:!0===t||("animation"in t?Be.merge(e,t):e.animation=t)),null===(n=this.collapsible)||void 0===n?void 0:n.collapse(e)}},{key:"collapse",value:function(e){return this.collapsePanel(e)}},{key:"expand",value:function(e){return this.expandPanel(e)}},{key:"collapsePanel",value:function(e){return this._collapse({collapsed:!0},e)}},{key:"expandPanel",value:function(e){return this._collapse({collapsed:!1},e)}},{key:"toggleCollapsed",value:function(e,t){return"boolean"==typeof e?e?this.collapse(t):this.expand(t):this.collapsed?this.expand(t):this.collapse(t)}},{key:"expandedHeaderDock",get:function(){var e,t,n;return null!==(e=null!==(t=this._expandedHeaderDock)&&void 0!==t?t:null===(n=this.initialConfig.header)||void 0===n?void 0:n.dock)&&void 0!==e?e:"top"},set:function(e){this._expandedHeaderDock=null==e?void 0:e.toLowerCase()}},{key:"updateHeader",value:function(e){this.changingCollapse||(this.expandedHeaderDock=null==e?void 0:e.dock)}},{key:"updateTrapFocus",value:function(e){var t,n=this,r=n.element,i=r.classList,a="before"===e,o="after"===e;i.toggle("b-focus-trapped",e&&!a&&!o),i.toggle("b-focus-trapped-before",a),i.toggle("b-focus-trapped-after",o),n.focusTrapListener=null===(t=n.focusTrapListener)||void 0===t?void 0:t.call(n),n[e?"addKeyBinding":"removeKeyBinding"]("shift+Tab","trapTabOut"),e&&(n.focusTrapListener=fr.on({element:r,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:n}),n.treeWalker||(n.treeWalker=n.setupTreeWalker(r,li.NodeFilter.SHOW_ELEMENT,Ju)))}},{key:"setupTreeWalker",value:function(e,t,n){return document.createTreeWalker(e,t,n)}},{key:"trapTabOut",value:function(e){if(e.target!==this.element)return!1;e.preventDefault(),this.bottomFocusTrap.focus()}},{key:"onFocusTrapped",value:function(e){var t=this,n=e.target,r=t.treeWalker,i=n===t.bottomFocusTrap,a=n===t.topFocusTrap;!1!==t.trigger("focusTrap",{target:n,bottom:i,top:a})&&(a||i)&&(i||e.relatedTarget===t.element&&e.shiftKey?(r.currentNode=t.topFocusTrap,r.nextNode()):(r.currentNode=t.bottomFocusTrap,r.previousNode()),t.requestAnimationFrame((function(){return r.currentNode.focus()})))}},{key:"focusElement",get:function(){return this.hasItems&&(B(t,"focusElement",this,1)||this.element)}},{key:"contentElement",get:function(){return this.element&&this.bodyElement}},{key:"getPositionableLocation",value:function(e){var t,n;return"before"===e?n=this.headerElement||this.bodyWrapRootElement:"after"===e?n=this.bottomFocusTrap:t=this.contentElement,[t,n]}},{key:"widgetClassList",get:function(){var e,n=this,r=B(t,"widgetClassList",this,1);n.hasHeader&&r.push("b-panel-has-header","b-header-dock-".concat((null===(e=n.header)||void 0===e?void 0:e.dock)||"top"));return n.tbar&&r.push("b-panel-has-top-toolbar"),n.bbar&&r.push("b-panel-has-bottom-toolbar"),r}}],[{key:"configurable",get:function(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:null,drawer:{$config:"lazy",value:null}}}}])}(Ss.mixin(wu,Eu));S(uc,"$name","Panel"),S(uc,"type","panel"),uc.initClass(),uc._$name="Panel";var cc={topStart:"top-start",topEnd:"top-end",bottomEnd:"bottom-end",bottomStart:"bottom-start",top:"top",end:"end",bottom:"bottom",start:"start"},dc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){if(B(t,"construct",this,3)([e]),!this.element)throw new Error("ElementResizeHelper: `element` is required.")}},{key:"updateElement",value:function(e){var t;"static"===r.getComputedStyle(e).position&&console.warn("ElementResizeHelper: `element` must be positioned (absolute or relative) for resizing to work."),null===(t=this.pointerDownListeners)||void 0===t||t.call(this),this.pointerDownListeners=fr.on({element:e,pointerdown:"onResizePointerDown",delegate:".b-resize-grip",thisObj:this})}},{key:"updateHandles",value:function(e){var t=this.element;for(var n in li.removeEachSelector(t,".b-resize-grip"),e)if(!1!==e[n]){var r=document.createElement("div");r.className="b-resize-grip b-resize-grip-".concat(cc[n]),t.appendChild(r)}}},{key:"onResizePointerDown",value:function(e){var t,n=this,i=n.element;if(n.handleType=e.target.className.replace("b-resize-grip b-resize-grip-","").trim(),0===e.button&&!1!==n.trigger("beforeResizeStart",{element:i,handle:n.handleType})){e.preventDefault();var a=r.getComputedStyle(i),o=i.getBoundingClientRect(),l=parseFloat(a.top)||0,s=parseFloat(a.insetInlineStart)||0;n.initialX=e.clientX,n.initialY=e.clientY,n.initialTop=l,n.initialStart=s,n.initialWidth=o.width,n.initialHeight=o.height,n.trigger("resizeStart",{element:i,handle:n.handleType}),null===(t=n.removeMoveListeners)||void 0===t||t.call(n),n.removeMoveListeners=fr.on({element:document.body,pointermove:"onResizePointerMove",thisObj:n}),n.removeDocUpListeners=fr.on({element:document,pointerup:"onResizePointerUp",capture:!0,thisObj:n,once:!0})}}},{key:"onResizePointerMove",value:function(e){var t=this,n=t.element,r=t.handleType,i=t.rtl,a=t.minHeight,o=t.minWidth,l=t.initialStart,s=t.initialTop,u=t.initialWidth,c=t.initialHeight,d=t.initialX,h=t.initialY,f=t.maxWidth,v=t.maxHeight,g=e.clientX-d,m=e.clientY-h,p=u-(o||1),y=i?-1:1,k=e.shiftKey,b=l,C=s,w=u,D=c;if(r.includes("start")?(b=l+Math.min(g,p)*y,w=u-g*y):r.includes("end")&&(w=u+g*y),r.includes("top")?(C=s+Math.min(m,c-(a||1)),D=c-m):r.includes("bottom")&&(D=c+m),k){var S=u/c;Math.abs(g)>Math.abs(m)?D=w/S:w=D*S}null!==o&&(w=Math.max(w,o)),null!==f&&(w=Math.min(w,f||document.body.offsetWidth)),null!==a&&(D=Math.max(D,a)),null!==v&&(D=Math.min(D,v||document.body.offsetWidth)),(!i||!r.includes("start")||w>o)&&(n.style.insetInlineStart=Math.max(b,0)+"px"),n.style.top=C+"px",n.style.width=w+"px",n.style.height=D+"px"}},{key:"onResizePointerUp",value:function(e){var t,n;null===(t=this.removeDocUpListeners)||void 0===t||t.call(this),null===(n=this.removeMoveListeners)||void 0===n||n.call(this),this.removeMoveListeners=null,this.removeDocUpListeners=null}},{key:"isResizing",get:function(){return Boolean(this.removeMoveListeners)}},{key:"doDestroy",value:function(){this.onResizePointerUp(),this.pointerDownListeners(),li.removeEachSelector(this.element,".b-resize-grip"),B(t,"doDestroy",this,3)([])}}])}(Mn.mixin(_n));S(dc,"configurable",{element:null,minWidth:50,maxWidth:null,minHeight:50,maxHeight:null,rtl:null,handles:{topStart:!0,top:!0,topEnd:!0,end:!0,bottomEnd:!0,bottom:!0,bottomStart:!0,start:!0}}),dc._$name="ElementResizeHelper";var hc=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateResizable",value:function(e){var t=this;if(e){var n="object"===W(e)?e:{};t.resizeHelper=new dc(Be.assign({element:t.element,internalListeners:{resizeStart:t.onResizeStart,thisObj:t}},n))}else{var r;null===(r=t.resizeHelper)||void 0===r||r.destroy()}}},{key:"onResizeStart",value:function(){this.alignTo(null)}},{key:"doDestroy",value:function(){var e;null===(e=this.resizeHelper)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"updateRtl",value:function(e){B(t,"updateRtl",this,3)([e]),this.resizeHelper&&(this.resizeHelper.rtl=e)}}])}(e||Mn),S(t,"$name","Resizable"),S(t,"configurable",{resizable:null}),t},fc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"finalizeInit",value:function(){var e=this,n=e.forElement;e.anchoredTo=n,e.initialAnchor=e.anchor,n&&!1!==e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),fr.on(S(S(S({element:n},2===e.showOnClick?"contextmenu":"click","onElementUserAction"),"thisObj",e),"capture",!0))),B(t,"finalizeInit",this,3)([]),!e.autoShow||n&&!li.isVisible(n)||(!0===e.autoShow?e.show():e.setTimeout((function(){return e.show()}),e.autoShow))}},{key:"onInternalPaint",value:function(e){var n,r=e.firstPaint;null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n(arguments);var i=this;r&&i.headerElement&&fr.on({element:i.headerElement,dblclick:i.onHeaderDblClick,thisObj:i})}},{key:"doDestroy",value:function(){this.syncModalMask(),B(t,"doDestroy",this,3)([])}},{key:"compose",value:function(){var e=this.hasNoChildren,t=this.textContent;return{class:{"b-text-popup":Boolean(t&&e)}}}},{key:"close",value:function(){var e=this;if(!this._hidden){var t=this.trigger("beforeClose");if(Be.isPromise(t))return t.then((function(t){!1!==t&&e.doClose()})),t;if(!1===t)return t}this.doClose()}},{key:"doClose",value:function(){var e=this,t=e.closeAction;if(!e._hidden||"destroy"===t){var n;e.modal&&"destroy"===t&&e.revertFocus(),e.unmask();var r,i=e.items.length&&(null===(n=e.items.find((function(e){return e.errorTip})))||void 0===n?void 0:n.errorTip);if(i)null===(r=i.pointerOverOutDetacher)||void 0===r||r.call(i),i.hide();return e[t]()}}},{key:"toggleMaximized",value:function(){this.maximized=!this.maximized}},{key:"updateMaximized",value:function(e){e=Boolean(e),this.element.classList.toggle("b-maximized",Boolean(e)),this.draggable&&(this.draggable.disabled=e)}},{key:"onInternalKeyDown",value:function(e){var t=this;"Escape"===e.key&&t.closeOnEscape&&(e.stopImmediatePropagation(),t.floating||t.positioned?t.close(!0):t.collapsible&&(t.revealed?t.collapsible.toggleReveal():t.collapse()))}},{key:"onDocumentMouseDown",value:function(e){var n=e.event,r=this,i=r.owner,a=n.target;if(r.isVisible){if("touchend"!==n.type&&null!=i&&i.isButton&&i._menu===r&&i.element.contains(a))return n.preventDefault(),!1;if(r.modal&&a===t.modalMask)n.preventDefault(),r.modal.closeOnMaskTap?r.close():r.containsFocus||r.focus();else if(!r.owns(a,!0)&&r.autoClose&&"mousedown"===n.type)if(r.containsFocus){var o=li.getActiveElement(r.element);fr.on(S({element:document,once:!0,expires:100},n.type,(function(e){e.defaultPrevented&&li.getActiveElement(r.element)===o&&r.close()})))}else r.close()}}},{key:"isTopModal",get:function(){return!this._isRevertingFocus&&li.isVisible(t.modalMask)&&this.element.previousElementSibling===t.modalMask}},{key:"onFocusIn",value:function(e){var n=li.getActiveElement(this);B(t,"onFocusIn",this,3)([e]),li.getActiveElement(this)===n&&e.target===this.element&&this.focus()}},{key:"onFocusOut",value:function(e){r.visualViewport&&r.visualViewport.height<document.documentElement.clientHeight-1||this.modal||!this.autoClose||this.close(),B(t,"onFocusOut",this,3)([e])}},{key:"afterShow",value:function(){var e=this;(e.autoClose||e.modal)&&e.addDocumentMouseDownListener(),B(t,"afterShow",this,3)(arguments),e.toFront()}},{key:"toFront",value:function(){this.floating&&(B(t,"toFront",this,3)([]),this.syncModalMask()),this.focusOnToFront&&!this.containsFocus&&this.focus()}},{key:"addDocumentMouseDownListener",value:function(){this.mouseDownRemover||(this.mouseDownRemover=Wn.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}},{key:"updateModal",value:function(e){var t=this;e?(t.element.setAttribute("aria-modal",!0),t.floating=!0,"number"==typeof t._x||"number"==typeof t._y||t.hasConfig("centered")||(t.centered=!0,t.anchor=!1)):t.element.removeAttribute("aria-modal")}},{key:"syncModalMask",value:function(){var e=this,n=e.modal,r=e.element;if(n&&e.isVisible)e.modalMask.classList.remove("b-hide-display"),e.modalMask.classList.toggle("b-modal-transparent",Boolean(n.transparent)),r.classList.add("b-modal"),e.modalMask.setAttribute("owned-by",e.id);else if(e.isPainted){r.classList.remove("b-modal");var i=e.floatRoot.querySelectorAll(".b-modal"),a=i.length?t.fromElement(i[i.length-1],"popup"):null;a?a.syncModalMask():t.modalMask.classList.add("b-hide-display")}}},{key:"afterHide",value:function(){var e,n=this;B(t,"afterHide",this,3)(arguments),null===(e=n.mouseDownRemover)||void 0===e||e.call(n),n.mouseDownRemover=null,n.syncModalMask()}},{key:"onElementUserAction",value:function(e){var t=this.showOnClick;"number"==typeof t&&t!==e.button||(2===e.button&&e.preventDefault(),this.show())}},{key:"onHeaderDblClick",value:function(){this.maximizable&&this.toggleMaximized()}},{key:"updateClosable",value:function(e){this.tools.close.hidden=!e}},{key:"updateMaximizable",value:function(e){this.tools.maximize.hidden=!e}},{key:"modalMask",get:function(){var e=t.modalMask;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}}],[{key:"modalMask",get:function(){return this._modalMask||(this._modalMask=li.createElement({className:"b-modal-mask b-hide-display"}),fr.on({element:this._modalMask,wheel:function(e){return e.preventDefault()}})),this._modalMask}}])}(uc.mixin(hc));S(fc,"$name","Popup"),S(fc,"type","popup"),S(fc,"configurable",{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,draggable:!0,draggableBlacklistSelector:"button,.b-field-inner,.b-gridbase,.b-calendarmixin,.b-resize-grip",hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog",closeOnEscape:!0}),fc.initClass(),fc._$name="Popup";var vc={left:!0,right:!0,top:!0,bottom:!0,transform:!0},gc={true:1,false:1},mc=Promise.resolve(),pc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConfigure",value:function(){var e=this;e.forSelector&&(e.showOnHover=!1!==e.showOnHover,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),B(t,"afterConfigure",this,3)([]),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=fr.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}},{key:"doDestroy",value:function(){var e;null===(e=this.pointerOverOutDetacher)||void 0===e||e.call(this),B(t,"doDestroy",this,3)([])}},{key:"focusOnToFront",get:function(){var e;return"focus"!==(null===(e=this.triggeredByEvent)||void 0===e?void 0:e.pointerType)&&(B(t,"focusOnToFront",this,1)&&li.usingKeyboard)},set:function(e){V(t,"focusOnToFront",e,this,1,1)}},{key:"focusElement",get:function(){var e=B(t,"focusElement",this,1);if(e!==this.element)return e}},{key:"anchorToTarget",get:function(){return this._anchorToTarget&&!this.trackMouse}},{key:"anchor",get:function(){return B(t,"anchor",this,1)&&!this.trackMouse},set:function(e){V(t,"anchor",e,this,1,1)}},{key:"onDocumentMouseDown",value:function(e){var n,r=e.event,i=this,a=i.triggeredByEvent;if(a&&li.isTouchEvent&&(r.pageX===a.pageX&&r.pageY===a.pageY&&null!==(n=i.activeTarget)&&void 0!==n&&n.contains(r.target)&&performance.now()-a.timeStamp<500))return;i.abortDelayedShow(),B(t,"onDocumentMouseDown",this,3)([{event:r}])}},{key:"internalOnPointerOver",value:function(e){var t,n=this,r=e.target,i=e.relatedTarget,a=n.forElement,o=n.forSelector,l=n.activeTarget;if(!(n.disabled||n.owner&&!n.owner.showTooltipWhenDisabled&&n.owner.disabled||n.allowOver&&n.element.contains(r))){if(o){var s=e.target.closest("[data-btip]");if(s&&!s.matches(o))return void(l&&n.handleForElementOut());if(t=n.filterTarget(e),!this.hasTimeout("hide")&&null!=l&&l.contains(r)&&l.contains(i)&&t===l)return;if(t&&(null==i?void 0:i.closest(o))===t&&!i.dataset.btip)return}else{if(a.contains(i))return;t=a}t?n.handleForElementOver(e,t):l&&n.handleForElementOut()}}},{key:"filterTarget",value:function(e){return e.target.closest(this.forSelector)}},{key:"realignOnTransitionEnd",value:function(e){var n=this,r=t.currentOverElement;if(vc[e.propertyName]){var i;if(n.allowOver&&n.element.contains(r))return;null!==(i=n.activeTarget)&&void 0!==i&&i.contains(r)&&!n.trackMouse&&n.realign()}}},{key:"handleForElementOver",value:(o=f(L().mark((function e(t,n){var r,i,a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).activeTarget,a=r.hideOnDelegateChange,o=r.anchorToTarget,s=(l=n!==i)&&a,!1!==r.trigger("pointerOver",{event:t,target:n})){e.next=5;break}r.internalOnPointerOut(t),e.next=32;break;case 5:if(r.triggeredByEvent=t,!r.hasTimeout("hide")){e.next=10;break}if(r.abortDelayedHide(),l){e.next=10;break}return e.abrupt("return");case 10:if(!a&&r.element.classList.contains("b-hiding")&&r.cancelHideShowAnimation(),!r._hidden&&s&&r.hide(!1),r.activeTarget&&r.hasTimeout("show")&&r.clearTimeout("show"),r.activeTarget=n,r.activeTarget===n){e.next=17;break}return r.internalOnPointerOut(t),e.abrupt("return");case 17:if(!r.isVisible){e.next=30;break}if(r.lastAlignSpec=null,u=r.updateContent(),!pe.isPromise(u)||r.loadingMsg){e.next=23;break}return e.next=23,u;case 23:if(!1!==r.trigger("beforeShow")){e.next=25;break}return e.abrupt("return",r.hide());case 25:r.alignTo(S(S({},o?"target":"position",o?n:"mouse"),"overlap",!(o&&r.anchor))),r.trigger("show"),r.afterShowByTarget(),e.next=32;break;case 30:r.activeTarget=n,r.delayShow(n);case 32:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"delayShow",value:(n=f(L().mark((function e(t){var n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=(r=this).currentAnimation)&&void 0!==n&&n.showing&&r.cancelHideShowAnimation(),r.isVisible||r.hasTimeout("show")){e.next=16;break}if(r.hoverDelay&&!(r.forSelector&&Date.now()-r.lastHidden<r.quickShowInterval)){e.next=11;break}if(i=r.updateContent(),!pe.isPromise(i)||r.loadingMsg){e.next=8;break}return e.next=8,i;case 8:r.showByTarget(t),e.next=14;break;case 11:r.addDocumentMouseDownListener(),r.listeningForMouseMove||r.anchorToTarget||(r.mouseMoveRemover=fr.on({element:r.rootElement,mousemove:"onMouseMove",thisObj:r})),r.setTimeout(f(L().mark((function e(){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.activeTarget!==t||!t.isConnected){e.next=6;break}if(n=r.updateContent(),!pe.isPromise(n)||r.loadingMsg){e.next=5;break}return e.next=5,n;case 5:r.showByTarget(t);case 6:case"end":return e.stop()}}),e)}))),r.triggeredByEvent&&"pointerover"!==r.triggeredByEvent.type?0:r.hoverDelay,"show");case 14:e.next=17;break;case 16:r.isVisible&&r.showByTarget(t);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"changeAllowOver",value:function(e){return this.inAfterShow||(this.configuredAllowOver=e),e}},{key:"updateAllowOver",value:function(e){var t,n=this,r=n.element;(r.classList.toggle("b-allow-over",Boolean(e)),e)?n.allowOverlisteners=fr.on({element:r,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:n}):null===(t=n.allowOverlisteners)||void 0===t||t.call(n)}},{key:"updateContent",value:function(){var e=this;if(e.getHtml){var t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}},{key:"hasContent",get:function(){return Boolean(li.isVueConfig(this._html)||li.isReactElement(this._html)||""!==this._html&&"string"==typeof this.html&&this.html.length||this.items.length)}},{key:"internalBeforeShow",value:function(){var e=this;return(!e.isSharedTooltip||!Qi.dragging)&&((e.updateContentOnMouseMove||e.hasContent)&&!e.disabled)}},{key:"showAsyncMessage",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.optionalL(this.loadingMsg);e&&(this.html='\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    '.concat(Le.encodeHtml(e),"\n                </div>\n            "))}},{key:"showByTarget",value:function(e){var t,n=this,r=n.anchorToTarget;n.mouseMoveRemover=null===(t=n.mouseMoveRemover)||void 0===t?void 0:t.call(n),n.showBy(S(S({},r?"target":"position",r?e:"mouse"),"overlap",!(r&&n.anchor)))}},{key:"afterShowByTarget",value:function(){var e=this,t=e.dismissDelay,n=e.activeTarget,r=li.getActiveElement(e.activeTarget);e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.element.parentNode&&e.toFront(),e.mouseMoveRemover||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=fr.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.describedElement=null!=n&&n.contains(r)?r:null,e.inAfterShow=!0,e.allowOver=e.allowOver||0!=e.configuredAllowOver&&e.childItems.some((function(e){return e.isVisible&&!e.disabled&&e.focusElement})),e.inAfterShow=!1}},{key:"changeActiveTarget",value:function(e,t){var n=this;if(e){if(!n.isConfiguring&&!1===n.trigger("overTarget",{newTarget:e,lastTarget:t}))return}else n.trigger("targetOut",{lastTarget:t});return e}},{key:"updateDescribedElement",value:function(e,t){var n=this.titleElement,r=n&&li.getId(n),i=li.getId(this.contentElement);e&&e.getAttribute("aria-label")!==this.html&&(r&&li.addAttributeValue(e,"aria-describedby",r),li.addAttributeValue(e,"aria-describedby",i)),t&&(r&&li.removeAttributeValue(t,"aria-describedby",r),li.removeAttributeValue(t,"aria-describedby",i))}},{key:"internalOnPointerOut",value:function(e){var t,n=this,r="pointerover"===e.type?e.target:e.relatedTarget;n.allowOver&&(n.element.contains(r)||n.owns(r,!0))||n.element.contains(r)&&null!==(t=n.activeTarget)&&void 0!==t&&t.contains(r)||n.activeTarget&&!n.activeTarget.contains(r)&&n.handleForElementOut()}},{key:"handleForElementOut",value:function(){var e=this,t=e.hideDelay;if(!1===e.trigger("pointerOut"))return e.activeTarget=null,!0;e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}},{key:"show",value:function(e){var n=this;!e&&n.forElement&&n.anchorToTarget&&!n.forSelector?n.showByTarget(n.forElement):B(t,"show",this,3)(arguments),n.isVisible?n.afterShowByTarget():n.activeTarget=null}},{key:"hoverDelay",get:function(){var e;return"focus"===(null===(e=this.triggeredByEvent)||void 0===e?void 0:e.pointerType)?0:this._hoverDelay}},{key:"hideDelay",get:function(){var e;return"focus"===(null===(e=this.triggeredByEvent)||void 0===e?void 0:e.pointerType)?0:!!this.autoHide&&this._hideDelay}},{key:"hide",value:function(){var e,n,r=this;if(r.abortDelayedShow(),r._hidden)return mc;r.abortDelayedHide();var i=B(t,"hide",this,3)(arguments);return r.lastHidden=Date.now(),r.activeTarget=null,null===(e=r.mouseMoveRemover)||void 0===e||e.call(r),r.mouseMoveRemover=null,null===(n=r.transitionEndDetacher)||void 0===n||n.call(r),r.transitionEndDetacher=null,r.describedElement=null,i}},{key:"abortDelayedShow",value:function(){var e,t,n,r=this;r.hasTimeout("show")&&(null===(e=r.mouseDownRemover)||void 0===e||e.call(r),r.mouseDownRemover=null,r.clearTimeout("show"),null===(t=r.mouseMoveRemover)||void 0===t||t.call(r),r.mouseMoveRemover=null,null===(n=r.transitionEndDetacher)||void 0===n||n.call(r),r.transitionEndDetacher=null)}},{key:"abortDelayedHide",value:function(){this.clearTimeout("hide")}},{key:"realign",value:function(){var e=this,n=e.lastAlignSpec;e.isConfiguring||e.isVisible||null==n||!n.targetOutOfView||(n.allowTargetOut||li.isInView(n.target,!1,e))&&(e.show(),n.targetOutOfView=!1),B(t,"realign",this,3)([])}},{key:"alignTo",value:function(e){var n,i=this,a=(i.mouseOffsetX||1)*(i.rtl?-1:1),o=i.mouseOffsetY||1,l=Math.max(Math.min(a,5),0),s=Math.max(Math.min(o,5),0);i.isVisible&&(i.anchorToTarget||"mouse"!==e.position||(n=new yt(i.triggeredByEvent.pageX-r.scrollX,i.triggeredByEvent.pageY-r.scrollY),e.position=new yt(n.x+(a||1)-(a<0?i.width:0),n.y+(o||1)-(o<0?i.height:0))),!e||i.triggeredByEvent&&i.element.contains(i.triggeredByEvent.target)||e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),B(t,"alignTo",this,3)([e]),n&&i.lastAlignSpec.result.inflate(s,l).contains(n)&&(i.lastAlignSpec.position="mouse",i.mouseOffsetY=-o,i.mouseOffsetX=-a,i.realign(),i.mouseOffsetY=o,i.mouseOffsetX=a))}},{key:"html",get:function(){return B(t,"html",this,1)},set:function(e){V(t,"html",e,this,1,1),this.isVisible&&this.realign()}},{key:"changeHtml",value:function(e){var t=this;return pe.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((function(n){e.target===t.activeTarget&&(t.html=n)}))):("object"!==W(e)&&(e=null!=e?t.optionalL(String(e)):""),e)}},{key:"updateHtml",value:function(e,n){var r=this,i=""===e;i&&!li.isVueConfig(e)||(B(t,"updateHtml",this,3)([e,n]),r.hasContent?pe.isPromise(e)||r.trigger("innerHtmlUpdate",{value:e}):i=!0),i&&r.hide()}},{key:"onMouseMove",value:function(e){var t=this,n=t.forElement,r=t.activeTarget,i=t.hasTimeout("hide"),a=e.target;if(t.triggeredByEvent=e,!t._hidden){var o,l=!(null==r?void 0:r.contains(a))&&t.forSelector&&r&&!i&&a.nodeType===Node.ELEMENT_NODE&&!a.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(a)),s=null!=n&&n.document?n.document.documentElement:n,u=s&&(s.contains?s.contains(a):16&s.compareDocumentPosition(a));if(l&&(o=t.handleForElementOut()),o||!i||u){if(t.dismissDelay&&!i&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:r,activeTarget:r,event:e}]),!t.html))return void t.hide();t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}},{key:"onElementUserAction",value:function(e){var t=this.showOnClick;"number"==typeof t&&t!==e.button||(2===e.button&&e.preventDefault(),this.internalOnPointerOver(e))}},{key:"onOwnElementMouseEnter",value:function(e){this.abortDelayedHide()}}],[{key:"configurable",get:function(){return{autoHide:!0,mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:function(){return!1}}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:null,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,draggable:!1,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:{$config:{equal:function(e,t){return null==e&&null==t||e===t}},value:null},testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null},role:"tooltip",describedElement:null}}},{key:"getSharedTooltip",value:function(e,n,r){var i,o=null===(i=n.bryntum)||void 0===i||null===(i=i.tooltip)||void 0===i?void 0:i.get(t);if(!o&&!r){var l;null!==(l=n.bryntum)&&void 0!==l&&l.tooltip||Be.setPath(n,"bryntum.tooltip",new a);var s=n.bryntum.tooltip;s.set(t,!0),o=new t({forElement:n,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isSharedTooltip:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver:function(e){var t=e.target;if(!o.isOverflowDetail){for(var n in o.resetCfg)"listeners"===n?o.un(o.resetCfg[n].set):"html"!==n&&(o[n]=o.resetCfg[n].was);o.resetCfg={};var r=Lo.getById(t.id),i=(null==r?void 0:r.tipConfig)||o.gatherDataConfigs(t);if(r&&r.element!==t||!r&&t.matches(".b-widget")||null!=r&&r.disabled&&!r.showTooltipWhenDisabled)return!1;for(var a in o._owner=r,o.element.classList.toggle("b-target-disabled",Boolean(null==r?void 0:r.disabled)),i)o.resetCfg[a]={set:i[a],was:o[a]},"listeners"===a?o.ion(i[a]):o[a]=i[a]}},hide:function(e){e.source.owner=null}},gatherDataConfigs:function(e){var t=e.dataset,n={};for(var r in t)if(r.startsWith("btip"))if(r.length>4){var i=Le.uncapitalize(r.substr(4));if(i in o.getDefaultConfiguration()){var a=t[r];n[i]=gc[a]?"true"===a:isNaN(a)?a:parseInt(a,10)}}else n.html=t[r];return e.hasAttribute("aria-label")&&!n.html?n.html=Le.encodeHtml(o.optionalL(e.getAttribute("aria-label"))):e.hasAttribute("aria-labelledby")&&(n.html=Le.encodeHtml(o.optionalL(document.getElementById(e.getAttribute("aria-labelledby").textContent)))),n},filterTarget:function(e){var n=e.target;o.isOverflowDetail=!1;var r=n.closest(o.forSelector);if(r)return r;if(t.showOverflow&&n.closest(".b-widget"))for(;(null===(i=n)||void 0===i?void 0:i.nodeType)===Element.ELEMENT_NODE;){var i;if("ellipsis"===li.getStyleValue(n,"text-overflow")&&n.clientWidth<n.scrollWidth)return o.html=Le.encodeHtml(n.textContent),o.isOverflowDetail=!0,n;n=n.parentNode}}}),fr.on({element:n,mouseenter:function(e){return t.currentOverElement=e.target},keydown:function(e){return t.currentOverElement=e.target},capture:!0,thisObj:o}),s.set(t,o)}return o}},{key:"encodeConfig",value:function(e){var t={};if("string"==typeof e)t.btip=e;else for(var n in e)t["btip".concat("html"===n?"":Le.capitalize(n))]=e[n];return t}}]);var n,o}(fc);S(pc,"$name","Tooltip"),S(pc,"type","tooltip"),pc.initClass(),Object.defineProperty(Lo,"tooltip",{get:function(){return pc.getSharedTooltip(document.body,document.body)}}),Lo.Tooltip=pc,pc._$name="Tooltip";var yc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;null===(e=this.tooltip)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"updateElement",value:function(e){fr.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}},{key:"changeTooltip",value:function(e){return pc.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}},{key:"getResourceAvatar",value:function(e){var t=this;if(Array.isArray(e))return e.map((function(e){return t.getResourceAvatar(e)}));var n=e.initials,r=e.color,a=e.iconCls,o=e.imageUrl,l=e.defaultImageUrl,s=e.dataset,u=void 0===s?{}:s,c=e.resourceRecord,d=e.alt,h=void 0===d?Le.encodeHtml(null==c?void 0:c.name):d,f=this.getImageConfig(n,r,o,l,u,h)||this.getIconConfig(a,u,h)||this.getResourceInitialsConfig(n,r,u,h),v=this.size;return Object.assign(f.style,F({},v?{height:v,width:v}:i)),f}},{key:"getImageConfig",value:function(e,n,r,i,a,o){if(r=t.failedUrls.has(r)?i:r||i)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:o,"aria-label":o,elementData:{defaultImageUrl:i,imageUrl:r,initials:e,color:n,dataset:a},src:r,dataset:a}}},{key:"getIconConfig",value:function(e,t,n){if(e)return e&&{tag:"i",style:{},"aria-label":n,class:S({"b-resource-avatar":1,"b-resource-icon":1},e,1),dataset:t}}},{key:"getResourceInitialsConfig",value:function(e,t,n,r){var a=li.isNamedColor(t)&&t,o=!a&&t,l=this.size;return{tag:"div","aria-label":r,class:S({"b-resource-avatar":1,"b-resource-initials":1},"".concat(this.colorPrefix).concat(a),a),style:F({backgroundColor:o||null},l?{height:l,width:l}:i),text:e,dataset:n}}},{key:"onImageErrorEvent",value:function(e){var n=e.target;if(n.matches(".b-resource-avatar")&&n.isConnected){var r=n.elementData,i=r.defaultImageUrl,a=r.initials,o=r.color,l=r.imageUrl,s=r.dataset;if(i&&!n.src.endsWith(i.replace(/^[./]*/gm,"")))n.src=i;else{var u=n.parentElement,c=Array.from(u.childNodes).indexOf(n),d=this.getResourceInitialsConfig(a,o,s,n.alt),h=li.createElement(d);n.$refOwnerId&&(h.$refOwnerId=n.$refOwnerId),h.elementData=n.elementData,h.lastDomConfig=d,u.lastDomConfig&&(u.lastDomConfig.children[c]=d),u.replaceChild(h,n)}t.failedUrls.add(l)}}}],[{key:"configurable",get:function(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}},{key:"failedUrls",get:function(){return this._failedUrls||(this._failedUrls=new o)}}])}(Mn);S(yc,"$name","AvatarRendering"),yc._$name="AvatarRendering";var kc=function(){return w((function e(){m(this,e)}),[{key:"getImageConfig",value:function(){var e=this._overridden.getImageConfig.apply(this,arguments);return e&&(e.style["max-width"]="unset"),e}}])}();S(kc,"target",{class:yc}),We.apply(kc);var bc=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:ne}}},{key:"supportsPointerEvents",get:function(){return"onpointerdown"in HTMLElement.prototype}}])}();We.apply(bc),Object.defineProperty(ne,"queryString",{get:function(){if(r.location.href){var e,t=new URL(r.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}return{}}});var Cc=function(){return w((function e(){m(this,e)}),[{key:"onMouseDown",value:function(e){this._overridden.onMouseDown.apply(this,arguments),this.eventTarget=e.target}},{key:"fireClick",value:function(){var e,t=this;null===(e=t.eventTarget)||void 0===e||e.dispatchEvent(new MouseEvent("click",fr.copyEvent({},t.triggerEvent))),t.repeatTimer=t.setTimeout(t.fireClick,t.interval)}}],[{key:"target",get:function(){return{class:Hs}}}])}();We.apply(Cc);var wc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onConfigChange",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i,a;(B(t,"onConfigChange",this,3)(n),this.isConfiguring)||(null===(i=this.client)||void 0===i||null===(a=i.afterPluginConfigChange)||void 0===a||a.call(i,F({plugin:this},n[0])))}},{key:"updateClient",value:function(e){this.owner||(this.owner=e)}},{key:"updateKeyMap",value:function(e){var t=this.client;t.keyMap=t.mergeKeyMaps(t.keyMap,e,Le.uncapitalize(this.constructor.$name))}},{key:"enabled",get:function(){return!this.disabled}},{key:"getFocusRevertTarget",value:function(){var e;return null===(e=this.client)||void 0===e?void 0:e.getFocusRevertTarget()}},{key:"construct",value:function(){for(var e=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a,o=r[0],l=r[1];1===r.length?Be.isObject(o)&&(o=(l=o).client):delete(l=Be.assign({},l)).client,e.client=o,B(t,"construct",this,3)([l]),e.applyPluginConfig(o),(a=e.clientListeners)&&((a=Be.assign({},a)).thisObj=e,o.ion(a))}},{key:"applyPluginConfig",value:function(e){var t=this,n=t.pluginConfig||t.constructor.pluginConfig;if(n){var r=n.assign,i=n.chain,a=n.after,o=n.before,l=n.override;r&&t.applyAssign(e,r),(i||a)&&t.applyChain(e,i||a),o&&t.applyChain(e,o,!1),l&&t.applyOverride(e,l)}}},{key:"applyAssign",value:function(e,t){var n=this;t.forEach((function(t){return n.assign(e,t)}))}},{key:"applyChain",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2];if(Array.isArray(t)){var r,a=D(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.chain(e,o,o,n)}}catch(e){a.e(e)}finally{a.f()}}else for(var l in t)this.chain(e,l,t[l],n)}},{key:"applyOverride",value:function(e,t){var n=this;n.overridden||(n.overridden={}),t.forEach((function(t){if(!n[t])throw new Error("Trying to chain fn ".concat(e.$$name,"#").concat(t,", but plugin fn ").concat(n.$$name,"#").concat(t," does not exist"));"function"==typeof e[t]&&(n.overridden[t]=e[t].bind(e)),e[t]=n[t].bind(n)}))}},{key:"assign",value:function(e,t){var n=this,r=function(e,t){var n=Be.getPropertyDescriptor(e,t);return n&&(n.get||n.set)?n:null}(n,t);r?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(n),set:r.set&&r.set.bind(n)}):e[t]=n[t].bind(n)}},{key:"chain",value:function(e,t,n){var r=!(arguments.length>3&&arguments[3]!==i)||arguments[3],a=0;"object"===W(t)&&(t=t.fn),"object"===W(n)&&(a=n.prio||0,n=n.fn);var o=this,l=e.pluginFunctionChain||(e.pluginFunctionChain={}),s=o[n]&&o[n].bind(o),u=o.functionChainRunner;if(!s)throw new Error("Trying to chain fn ".concat(e.$$name,"#").concat(n,", but plugin fn ").concat(o.$$name,"#").concat(n," does not exist"));if(!l[t]){var c=e[t];c&&((c=c.bind(e)).$this=e,c.$prio=0),l[t]=c?[c]:[],e[t]=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return u(l[t],n)}}s.$this=o,s.$prio=a,l[t][r?"push":"unshift"](s),l[t].$sorted=!1}},{key:"functionChainRunner",value:function(e,t){var n,r,i;for(e.$sorted||(e.sort((function(e,t){return t.$prio-e.$prio})),e.$sorted=!0),r=0;r<e.length&&((n=e[r]).$this.isDestroyed||!1!==(i=n.apply(void 0,z(t))));r++);return i}},{key:"doDisable",value:function(e){var t,n,r,i=this,a=i.constructor,o="featureClass"in a?a.featureClass:"b-".concat(a.$$name.toLowerCase()),l=Le.uncapitalize(a.$$name);o&&(null===(t=i.client)||void 0===t||null===(t=t._element)||void 0===t||t.classList[e?"remove":"add"](o));i.isConfiguring||(e?i.trigger("disable"):i.trigger("enable"),null===(n=(r=i.client).syncSplits)||void 0===n||n.call(r,(function(t){var n=t.features[l];n&&(n.disabled=e)})))}},{key:"updateDisabled",value:function(e){this.doDisable(e)}},{key:"throwOverrideIsMissing",value:function(e){throw new Error("Trying to override fn ".concat(e.plugIntoName,"#").concat(e.fnName,", but plugin fn ").concat(e.pluginName,"#").concat(e.fnName," does not exist"))}},{key:"rootElement",get:function(){return this.client.rootElement}},{key:"state",get:function(){var e,t=this;return null===(e=this.constructor.stateProperties)||void 0===e?void 0:e.reduce((function(e,n){return e[n]=t[n],e}),{})}}],[{key:"initPlugins",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];this.initPlugin(e,o)}}},{key:"initPlugin",value:function(e,t,n){var r=e.plugins||(e.plugins={}),i=[e];return n&&i.push(n),r[t.$$name]=b(t,i)}}])}(Mn.mixin(_n,Ya));S(wc,"$name","InstancePlugin"),S(wc,"configurable",{disabled:!1,client:null,keyMap:null}),S(wc,"properties",{clientListeners:null}),wc._$name="InstancePlugin";var Dc=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"plugins",get:function(){return this._plugins||(this._plugins={}),this._plugins},set:function(e){e&&(Array.isArray(e)||(e=[e]),wc.initPlugins.apply(wc,[this].concat(z(e)))),this.initPlugins()}},{key:"initPlugins",value:function(){}},{key:"addPlugins",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];wc.initPlugins.apply(wc,[this].concat(t))}},{key:"addPlugin",value:function(e,t){return wc.initPlugin(this,e,t)}},{key:"hasPlugin",value:function(e){return null!=this.getPlugin(e)}},{key:"getPlugin",value:function(e){var t;return"function"==typeof e&&(e=e.$$name),null===(t=this.plugins)||void 0===t?void 0:t[e]}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","Pluggable"),t},Sc=Symbol("STM_PROP"),xc={parentIndex:1,orderedParentIndex:1},Ec=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"joinStore",value:function(e){this.stm||(this.stm=e.stm)}},{key:"unjoinStore",value:function(e){var n,r=arguments.length>1&&arguments[1]!==i&&arguments[1];this.stm===e.stm&&(this.stm=null),null===(n=B(t,"unjoinStore",this,3))||void 0===n||n([e,r])}},{key:"stm",get:function(){return this[Sc]},set:function(e){this[Sc]=e}},{key:"beforeChronoFieldSet",value:function(e,t){var n,r=this;return r.inSetting||null===(n=r.stm)||void 0===n||!n.enabled||xc[e]||r.constructor.nonPersistableFields[e]||!r.getFieldDefinition(e)?null:S({},e,{value:t,oldValue:r.graph.activeTransaction.readCurrentOrProposedOrPrevious(r.$[e])})}},{key:"afterChronoFieldSet",value:function(e,t,n){n&&this.afterSet(e,t,!1,!1,n,!0)}},{key:"shouldRecordFieldChange",value:function(e,t,n){var r=this.firstStore;return!(this.constructor.nonPersistableFields[e]||null==t&&null==n||t===n||t instanceof Date&&n instanceof Date&&t.getTime()===n.getTime()||"id"===e||"$PhantomId"===e||"parentId"===e&&r&&r.oldIdMap[t]===r.getById(n))}},{key:"afterSet",value:function(e,t,n,r,i,a){var o=this,l=this.stm,s=this.constructor.nonPersistableFields;if(null!=l&&l.isBase&&l.shouldRecordAction&&!xc[e]&&!s[e]&&i){var u,c=Object.keys(i).reduce((function(e,t){var n=i[t],r=n.value,a=n.oldValue;return o.shouldRecordFieldChange(t,a,r)&&(u=!0,e[0][t]=r,e[1][t]=a),e}),[{},{}]),d=_(c,2),h=d[0],f=d[1];u&&l.onModelUpdate(this,h,f,a)}}},{key:"beforeInsertChild",value:function(e){var n,r=this,o=(null===(n=B(t,"beforeInsertChild",this,3))||void 0===n?void 0:n([e]))||[],l=this.stm;return null!=l&&l.enabled&&o.push(e.reduce((function(e,t){return t.root===r.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:i}),e}),new a)),o}},{key:"afterInsertChild",value:function(e,n,r,i,a){var o,l=this.stm;if(null!=l&&l.shouldRecordAction){var s=r.pop();i&&l.onModelInsertChild(this,e,i,s,a)}null===(o=B(t,"afterInsertChild",this,3))||void 0===o||o([e,n,r,i])}},{key:"beforeRemoveChild",value:function(e,n){var r=B(t,"beforeRemoveChild",this,1)?B(t,"beforeRemoveChild",this,3)([e,n]):[],i=this.stm;return null!=i&&i.shouldRecordAction&&!n&&r.push(e.reduce((function(e,t){return e.set(t,{parentIndex:t.parentIndex,orderedParentIndex:t.orderedParentIndex}),e}),new a)),r}},{key:"afterRemoveChild",value:function(e,n,r){var i,a=this.stm;if(null!=a&&a.shouldRecordAction&&!r){var o=n.pop();e&&e.length&&a.onModelRemoveChild(this,e,o)}null===(i=B(t,"afterRemoveChild",this,3))||void 0===i||i([e,n,r])}}],[{key:"defaultConfig",get:function(){return{stm:null}}}])}(e||Mn),S(t,"$name","ModelStm"),t},Rc={includeFilteredOutRecords:!1},Tc=function(e){return"boolean"==typeof(e=e||!1)&&(e={includeFilteredOutRecords:e}),e||Rc},Mc=function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=g(this,t,[].concat(r))).children&&(e.orderedChildren=e.orderedChildren||[]),e}return R(t,e),w(t,[{key:"ingestChildren",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.stores,n=this.inProcessChildren,r=this.constructor,a=null==t?void 0:t[0];if(!0===e)return!!n||[];if(e){var o,l=$e.asArray(e);if(!l.length)return[];var s=l.length,u=[];l=null!==(o=null==a?void 0:a.cloneImmutable(l))&&void 0!==o?o:l;for(var c,d=0;d<s;d++){var h,f;c=(c=l[d]).isModel?c:null!==(h=null==a?void 0:a.createRecord(c,!1,!0))&&void 0!==h?h:new r(c,null,null,!0),c=null!==(f=null==a?void 0:a.processRecord(c))&&void 0!==f?f:c,u.push(c)}if(!0===this.children&&a){var v=a.createSorterFn(a.sorters);u.sort(v)}return u}}},{key:"processChildren",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.stores,t=this,n=t.meta;t.inProcessChildren=!0;var r=t.ingestChildren(t.data[t.constructor.childrenField],e);if(r){var a=t.constructor.convertEmptyParentToLeaf;if(!0===a||a.onLoad?r.length:Array.isArray(r)){if(n.isLeaf=!1,!0===t.children)t.children=[];else if(0===r.length)return void(t.children=r);t.insertChild(r)}else!0===r?(n.isLeaf=!1,t.children=!0):t.remoteChildCount>0?n.isLeaf=!1:t.isRoot||(n.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)}t.inProcessChildren=!1}},{key:"ancestorsExpanded",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.firstStore,t=this.parent;return null==e||!e.isTree||(!t||t.isExpanded(e)&&t.ancestorsExpanded(e))}},{key:"isExpanded",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.firstStore,t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}},{key:"expanded",get:function(){return this.data.expanded}},{key:"childLevel",get:function(){for(var e=this,t=-1;e&&!e.isRoot;)++t,e=e.parent;return t}},{key:"isLeaf",get:function(){return!1!==this.meta.isLeaf&&!this.isRoot}},{key:"isParent",get:function(){return!this.isLeaf}},{key:"isLoaded",get:function(){return this.isParent&&Array.isArray(this.children)}},{key:"hierarchyModificationDataToWrite",get:function(){var e=this,t=this.constructor.parentIdField,n=[t,"parentIndex","orderedParentIndex"].reduce((function(n,r){if(r in e.meta.modified){var i,a=e.constructor.getFieldDefinition(r);if(r===t)n[null!==(i=null==a?void 0:a.dataSource)&&void 0!==i?i:t]=e.getFieldPersistentValue(r);else a.persist&&(n[a.dataSource]=e.getFieldPersistentValue(r))}return n}),{});return Object.keys(n).length>0?n:null}},{key:"descendantCount",get:function(){return this.getDescendantCount()}},{key:"visibleDescendantCount",get:function(){return this.getDescendantCount(!0)}},{key:"getDescendantCount",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.firstStore,n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this.children;return n&&this.unfilteredChildren&&(r=this.unfilteredChildren),!r||!Array.isArray(r)||e&&!this.isExpanded(t)?0:r.reduce((function(r,i){return r+i.getDescendantCount(e,t,n)}),r.length)}},{key:"allChildren",get:function(){return this.getAllChildren(!1)}},{key:"allUnfilteredChildren",get:function(){return this.getAllChildren(!0)}},{key:"getAllChildren",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=e&&this.unfilteredChildren||this.children;return t&&!0!==t?t.reduce((function(t,n){return t.push(n),t.push.apply(t,e?n.allUnfilteredChildren:n.allChildren),t}),[]):[]}},{key:"firstChild",get:function(){var e=this.children;return(null==e?void 0:e.length)&&e[0]||null}},{key:"lastChild",get:function(){var e=this.children;return(null==e?void 0:e.length)&&e[e.length-1]||null}},{key:"previousSiblingsTotalCount",get:function(){for(var e=this.previousSibling,t=this.parentIndex;e;)t+=e.descendantCount,e=e.previousSibling;return t}},{key:"previousOrderedSibling",get:function(){var e,t;return null!==(e=null===(t=this.parent)||void 0===t?void 0:t.orderedChildren[this.orderedParentIndex-1])&&void 0!==e?e:null}},{key:"nextOrderedSibling",get:function(){var e,t;return null!==(e=null===(t=this.parent)||void 0===t?void 0:t.orderedChildren[this.orderedParentIndex+1])&&void 0!==e?e:null}},{key:"root",get:function(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.root)||this}},{key:"parentId",get:function(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null},set:function(e){this.setParentId(e)}},{key:"setParentId",value:function(e){var t=this,n=t.firstStore;if(n){var r=t.parent,i=null===e?n.rootNode:n.getById(e);i!==r&&(r||i)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:i?i.appendChild(t):r.removeChild(t))}else t.setData(t.constructor.parentIdField,e)}},{key:"getChildren",value:function(e){return e.includeFilteredOutRecords?this.unfilteredChildren||this.children:e.useOrderedTree?this.orderedChildren:this.children}},{key:"traverse",value:function(e,t,n){n=Tc(n);var r=this,i=r.getChildren(n);t||e.call(r,r);for(var a=0,o=null==i?void 0:i.length;a<o;a++)i[a].traverse(e,!1,n)}},{key:"traverseBefore",value:function(e,t,n){n=Tc(n);for(var r=this,i=r.getChildren(n),a=0,o=null==i?void 0:i.length;a<o;a++)i[a].traverse(e,!1,n);t||e.call(r,r)}},{key:"traverseWhile",value:function(e,t,n){n=Tc(n);var r=this,i=t||!1!==e.call(r,r);if(i){var a=r.getChildren(n);null!=a&&a.length&&(i=a.every((function(t){return t.traverseWhile(e,!1,n)})))}return i}},{key:"bubble",value:function(e){var t=this;for(arguments.length>1&&arguments[1]!==i&&arguments[1]||e.call(t,t);t.parent;)t=t.parent,e.call(t,t)}},{key:"bubbleWhile",value:function(e){var t=this,n=!0;for(arguments.length>1&&arguments[1]!==i&&arguments[1]||(n=e.call(t,t));n&&t.parent;)t=t.parent,n=e.call(t,t);return n}},{key:"contains",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:i;return e&&"object"===W(e)&&(e=e.id),!this.traverseWhile((function(t){return t.id!=e}),t,n)}},{key:"getTopParent",value:function(e){var t;return e?(t=[],this.bubbleWhile((function(e){return t.push(e),e.parent&&!e.parent.isRoot}))):(t=null,this.bubbleWhile((function(e){return t=e,e.parent&&!e.parent.isRoot}))),t}},{key:"appendChild",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:{};return this.insertChild(e,null,t,n)}},{key:"insertChild",value:function(e){var t,n,r,a,o,l,s,u,c,d,h=arguments.length>1&&arguments[1]!==i?arguments[1]:null,f=arguments.length>2&&arguments[2]!==i&&arguments[2],v=arguments.length>3&&arguments[3]!==i?arguments[3]:{},g=this,m=Array.isArray(e);"number"==typeof h&&(h=null!==(u=null===(c=g.children)||void 0===c?void 0:c[h])&&void 0!==u?u:null);if(g.isLinked&&!g.meta.isFillingFromMaster)return g.$original.insertChild(e,null===(d=h)||void 0===d?void 0:d.$original,f,v);if(e=$e.asArray(e),!f&&!1===(null===(t=g.stores)||void 0===t?void 0:t.every((function(t){return!1!==t.trigger("beforeAdd",{records:e,parent:g})}))))return null;e=g.ingestChildren(e);var p=null!==(n=null!==(r=null===(a=h)||void 0===a?void 0:a.parentIndex)&&void 0!==r?r:null===(o=g.children)||void 0===o?void 0:o.length)&&void 0!==n?n:0,y=null===(l=g.beforeInsertChild)||void 0===l?void 0:l.call(g,e),k=g.internalAppendInsert(e,h,f,v);return k.length&&g.convertToParent(f),null===(s=g.afterInsertChild)||void 0===s||s.call(g,p,e,y,k,v.orderedBeforeNode),m||!k?k:k[0]}},{key:"convertToParent",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.isLeaf;t.meta.isLeaf=!1,t.children||(t.children=[]),!n||t.root.isLoading||e||t.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}},{key:"signalNodeChanged",value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.stores;null==n||n.forEach((function(n){n.trigger("update",{record:t,records:[t],changes:e}),n.trigger("change",{action:"update",record:t,records:[t],changes:e})}))}},{key:"tryInsertChild",value:function(){return this.insertChild.apply(this,arguments)}},{key:"internalAppendInsert",value:function(e,t,n,r){var i,a,o,l,s,u=this,c=u.stores,d=u.root,h=u.children,f=d.firstStore,v=u.constructor.parentIdField,g=u.id,m={};if(!d.isLoading&&f)for(s=[],o=0;o<e.length;o++){var p=e[o];m[p.id]=p.root===d,s[o]=p.parentIndex}if(t&&t.parent!==u&&(t=null),h){var y=t?t.parentIndex:h.length;if(h[a=y]===e[0]||h[a=y-1]===e[0])for(i=!0,o=0;i&&o<e.length;o++)e[o]!==h[a+o]&&(i=!1)}if(i)return e;for(o=0;o<e.length;o++){var k=e[o],b=k.parent;f&&!d.isLoading&&k.traverse((function(e){e.root===d&&(m[e.id]=!0)}));var C=Boolean(m[k.id]),w=b===u&&C;if(!1===(null==b?void 0:b.removeChild(k,C,n,F({isInserting:!0,skipIndexUpdate:w},r))))l||(e=e.slice(),l=!0),e.splice(o--,1);else{k.parent=u,k.setData("parentId",g);var D=k.meta;D.modified[v]!==g||b||(D.oldParentId=g),b&&(D.oldParentId=b.id)}}if(e.length){Array.isArray(h)||(u.children=[]),Array.isArray(u.orderedChildren)||(u.orderedChildren=[]);var x=u.addToChildren(t,e,r);null==c||c.forEach((function(t){t.isChained&&!t.isChainedTree||(e.forEach((function(e){return e.joinStore(t)})),t.onNodeAddChild(u,e,x,m,n),e.forEach((function(e,r){if(null!=e.meta.oldParentId&&(!u.inProcessChildren&&!u.isLoading||m[e.id])){var i=S(S({},v,g),u.getDataSource("parentIndex"),e.parentIndex),a={},o=e.meta,l=o.modified,c=o.oldParentId,d=s[r];if(delete e.meta.oldParentId,u.id!==c&&(a[v]={value:g,oldValue:c}),e.parentIndex!==d&&(a.parentIndex={value:e.parentIndex,oldValue:d}),l[v]===u.id?Reflect.deleteProperty(l,v):v in l||(l[v]=c),m[e.id]){var h=t.getById(c);h.isLeaf&&!n&&h.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[t])}e.afterChange(i,a)}e.traverse((function(e){e.ignoreBag||e.isLinked||t.updateModifiedBagForRecord(e)}))})))}))}return e}},{key:"removeChild",value:function(e){var t,n,r,a=arguments.length>1&&arguments[1]!==i&&arguments[1],o=arguments.length>2&&arguments[2]!==i&&arguments[2],l=arguments.length>3&&arguments[3]!==i?arguments[3]:{},s=this,u=[],c=s.isLeaf,d=s.children,h=s.stores;if(e=(e=$e.asArray(e)).filter((function(e){return e.parent===s})),null!==(t=s.firstStore)&&void 0!==t&&t.isChainedTree)return s.$original.removeChild(e.map((function(e){return e.$original})),a,o,l);if(!o&&h){var f,v=D(h);try{for(v.s();!(f=v.n()).done;){var g=f.value;if(!g.isChained&&!1===g.trigger("beforeRemove",{parent:s,records:e,isMove:a}))return!1}}catch(e){v.e(e)}finally{v.f()}}var m,p=null===(n=s.beforeRemoveChild)||void 0===n?void 0:n.call(s,e,a),y=D(e);try{var k=function(){var e=m.value,t=e.constructor.parentIdField,n=e.meta.modified,r=e.parent?e.parent.id:null;t in n||e.isLinked||(n[t]=r);var i=s.removeFromChildren(e,l);null==h||h.forEach((function(t){if(!t.isChained){var n=t.isRemoving;t.isRemoving=!0,u.push.apply(u,z(t.onNodeRemoveChild(s,[e],i,F({isMove:a,silent:o},l)))),t.isRemoving=n}})),a||(e.parent=e.parentIndex=e.unfilteredIndex=e.nextSibling=e.previousSibling=null,e.data[t]=null)};for(y.s();!(m=y.n()).done;)k()}catch(e){y.e(e)}finally{y.f()}return 0===(s.unfilteredChildren||d).length&&s.constructor.convertEmptyParentToLeaf.onRemove&&!s.isRoot&&(s.meta.isLeaf=!0),s.isLeaf===c||o||a||s.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),null===(r=s.afterRemoveChild)||void 0===r||r.call(s,e,p,a),u}},{key:"clearParentId",value:function(){var e=this,t=e.constructor.parentIdField;Reflect.deleteProperty(e.data,t),Reflect.deleteProperty(e.originalData,t),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,t)}},{key:"replaceChildren",value:function(e){return this.clearChildren(),this.data[this.constructor.childrenField]=e,this.processChildren(),this.children}},{key:"clearChildren",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.stores,r=t.unfilteredChildren||t.children;t.children=[],t.orderedChildren=[],r&&!0!==r&&n&&n.forEach((function(n){n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]);var a=t.constructor.convertEmptyParentToLeaf;(!0===a||a.onRemove)&&(t.meta.isLeaf=!0)}},{key:"clear",value:function(){var e,t=this,n=t.stores,r=null===(e=t.unfilteredChildren||t.children)||void 0===e?void 0:e.slice();if(t.isRoot&&r){var i,a=D(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(!o.isChained&&!1===o.trigger("beforeRemove",{parent:t,records:r,isMove:!1,removingAll:!0}))return!1}}catch(e){a.e(e)}finally{a.f()}t.children.length=t.orderedChildren.length=0,t.unfilteredChildren&&(t.unfilteredChildren.length=0),n.forEach((function(e){r.forEach((function(t){t.stores.includes(e)&&t.unjoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}},{key:"updateChildrenIndices",value:function(e,t){for(var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=null,a=0;a<e.length;a++){var o=e[a],l=o[t];if("parentIndex"===t||"orderedParentIndex"===t){if(l===i||n)o.setData(t,a);else if(l!==a){var s,u;null===(s=o.stores)||void 0===s||s.forEach((function(e){e.suspendSortOnUpdate(),e.suspendFilterOnUpdate()})),o.set(t,a,!0),null===(u=o.stores)||void 0===u||u.forEach((function(e){e.resumeSortOnUpdate(!1),e.resumeFilterOnUpdate(!1)}))}}else o[t]=a;"parentIndex"===t&&(o.previousSibling=r,r&&(r.nextSibling=o),a===e.length-1&&(o.nextSibling=null),r=o)}}},{key:"addToChildren",value:function(e,t){for(var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:{},a=this,o=[[a.children,"parentIndex",e],[a.unfilteredChildren,"unfilteredIndex",e],[a.orderedChildren,"orderedParentIndex",(null==r?void 0:r.orderedBeforeNode)===i?(null==r?void 0:r.orderedParentIndex)!==i?a.orderedChildren[null!==(n=r.orderedParentIndex.index)&&void 0!==n?n:r.orderedParentIndex]:e:null==r?void 0:r.orderedBeforeNode]],l=0,s=o;l<s.length;l++){var u=s[l],c=_(u,3),d=c[0],h=c[1],f=c[2];if(d){var v,g=void 0;f?-1===(g=d.indexOf(f))&&(g=d.length):g=d.length,u.push(g),d.splice.apply(d,[g,0].concat(z(t))),null!=r&&r.skipIndexUpdate||null!=r&&null!==(v=r[h])&&void 0!==v&&v.skip||a.updateChildrenIndices(d,h)}}return o[0][3]}},{key:"removeFromChildren",value:function(e,t){for(var n=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]],r=0,i=n;r<i.length;r++){var a=i[r],o=_(a,2),l=o[0],s=o[1];if(l){var u,c=l.indexOf(e);if(a.push(c),c>-1)l.splice(c,1),null!=t&&t.skipIndexUpdate||null!=t&&null!==(u=t[s])&&void 0!==u&&u.skip||this.updateChildrenIndices(l,s)}}return n[0][2]}},{key:"sortOrderedChildren",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=[];return this.isLeaf||(this.orderedChildren.sort((function(e,r){if(t){var i,a,o=(null!==(i=e.meta.modified.orderedParentIndex)&&void 0!==i?i:e.orderedParentIndex)-(null!==(a=r.meta.modified.orderedParentIndex)&&void 0!==a?a:r.orderedParentIndex);return 0!==o&&(n.push(e),n.push(r)),o}return e.orderedParentIndex-r.orderedParentIndex})),e&&this.orderedChildren.forEach((function(r){n.push.apply(n,z(r.sortOrderedChildren(e,t)))})),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new o(n)}},{key:"sortVisibleChildren",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=arguments.length>1?arguments[1]:i,n=this;n.isLeaf||(n.children.sort(t),e&&n.orderedChildren.forEach((function(n){return n.sortVisibleChildren(e,t)})),n.updateChildrenIndices(n.children,"parentIndex",!0))}},{key:"sortUnfilteredChildren",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=arguments.length>1?arguments[1]:i,n=this;!n.isLeaf&&n.unfilteredChildren&&(n.unfilteredChildren.sort(t),e&&n.orderedChildren.forEach((function(n){return n.sortUnfilteredChildren(e,t)})),n.updateChildrenIndices(n.unfilteredChildren,"unfilteredIndex",!0))}},{key:"unjoinStore",value:function(e){var n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=this;a.unfilteredChildren&&(a.children=a.unfilteredChildren.slice(),a.unfilteredChildren=null),null===(n=B(t,"unjoinStore",this,3))||void 0===n||n([e,r])}}],[{key:"convertEmptyParentToLeaf",get:function(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}},set:function(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}},{key:"parentIdField",get:function(){return this._parentIdField||"parentId"},set:function(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}}])}(e||Mn),S(t,"$name","TreeNode"),t},Fc={id:1,internalId:1,stores:1,unjoinedStores:1,parentIndex:1,parent:1,unfilteredChildren:1,children:1,orderedChildren:1,parentId:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},Ac={get:function(e,t){switch(t){case"proxyMeta":return this.proxyMeta;case"constructor":return e.constructor;case"setData":return this.setDataOverride;case"set":return this.setOverride;case"instanceMeta":return this.instanceMetaOverride}return Fc[t]?this.proxyMeta.data[t]:Reflect.get(e,t,this.proxyRecord)},set:function(e,t,n,r){return"parentId"===t?r.setParentId(n):Fc[t]?this.proxyMeta.data[t]=n:e[t]=n,!0},instanceMetaOverride:function(e){var t=this.proxyMeta,n=e.id||e,r=t.map||(t.map=Be.clone(t.originalRecord.instanceMeta(n)));return r[n]||(r[n]={})},setDataOverride:function(e,t){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:"parentId"===e?this.proxyMeta.data.parentId=t:this.proxyMeta.originalRecord.setData(e,t)},setOverride:function(e,t){if("parentIndex"===e)this.proxyMeta.data.parentIndex=t;else{for(var n,r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];(n=this.proxyMeta.originalRecord).set.apply(n,[e,t].concat(i))}}},Ic=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"link",value:function(){if(this.isLinked)return this.$original.link();var e=this,t=F(F({},Ac),{},{proxyMeta:{originalRecord:e,data:F({id:"".concat(e.id,"_link_").concat(e.constructor._internalIdCounter),internalId:e.constructor._internalIdCounter++,stores:[],unjoinedStores:[]},e.children?{unfilteredChildren:[],children:[],orderedChildren:[]}:{})}}),n=new Proxy(e,t);return t.proxyRecord=n,(e.meta.linkedRecords||(e.meta.linkedRecords=[])).push(n),n}},{key:"isLinked",get:function(){var e;return Boolean(null===(e=this.proxyMeta)||void 0===e?void 0:e.originalRecord)}},{key:"hasLinks",get:function(){return Boolean(!this.proxyMeta&&this.$links.length)}},{key:"removeLink",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=arguments.length>2&&arguments[2]!==i&&arguments[2];if(e.hasLinks){var r,a=D(e.$links.slice());try{for(a.s();!(r=a.n()).done;){var o=r.value;t?$e.include(t,o):o.remove(n)}}catch(e){a.e(e)}finally{a.f()}}else e.isLinked&&$e.remove(e.$original.$links,e)}},{key:"beforeRemove",value:function(e){this.removeLink(this,e)}},{key:"removeChild",value:function(e,n,r,i){if(null==i||!i.isInserting){var a,o=D(e=$e.asArray(e));try{for(o.s();!(a=o.n()).done;){var l=a.value;this.removeLink(l,null,r)}}catch(e){o.e(e)}finally{o.f()}}return B(t,"removeChild",this,3)([e,n,r,i])}},{key:"$originalId",get:function(){return this.$original.id}},{key:"$links",get:function(){var e;return null!==(e=this.meta.linkedRecords)&&void 0!==e?e:[]}}])}(e||Mn),S(t,"$name","ModelLink"),S(t,"isModel",!0),t},Lc=/^([A-Z]+)(?:F|f)ormula/,Oc=/^(.*)$/,Pc={this:1,data:1},_c=function(e){var t;return null===(t=e.fields)||void 0===t?void 0:t.reduce((function(t,n){n.persist&&(e.get(n.name)&&(t[n.name]=String(e.get(n.name))));return t}),{})},Hc=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"fieldMatchRE",/\$([a-zA-Z\-_]+)/g),S(e,"fieldDelimiterRE",/[^a-zA-Z\-$_]/),e}return R(t,e),w(t,[{key:"changeHeaders",value:function(e){return Be.clone(e)}},{key:"updateInputField",value:function(e,t){var n;return null===(n=this.inputListenerRemover)||void 0===n||n.call(this),e&&(this.inputListenerRemover=e.ion({thisObj:this,input:"onFieldInput",change:"onFieldChange"})),this.owner=e}},{key:"onFieldInput",value:function(){var e,t=this,n=t.inputField,r=(null===(e=t.store)||void 0===e?void 0:e.modelClass)||(t.record||n.record).constructor,i=t.fieldNames||(t.fieldNames=Object.keys(Pc).concat(Object.keys(r.fieldMap)));if(n.formulaProvider===t){var a,o,l,s=null===(a=n.getCurrentToken(t.fieldDelimiterRE))||void 0===a?void 0:a.token,u=null!=s&&s.startsWith("$")?s.substring(1):null,c=null===(o=n.value.matchAll(t.fieldMatchRE))||void 0===o||null===(l=o.reduce)||void 0===l?void 0:l.call(o,(function(e,t){var n=_(t,2)[1];return n===u?i.some((function(e){return e.startsWith(n)}))||e.push(n):Pc[n]||r.fieldMap[n]||e.push(n),e}),[]);null!=c&&c.length?n.setError("Undefined data field(s) ".concat(c.join(",")),!1,!0):n.clearError();var d=t.resolveCallback(t.handleFormulaInput,t,!1);null==d||d.handler.call(d.thisObj,n,this)}}},{key:"onFieldChange",value:function(){var e,t=this,n=t.inputField,r=n.value,i=t.formulaRE?null===(e=r.trim().match(t.formulaRE||t.constructor.formulaRE||Oc))||void 0===e?void 0:e[1]:r,a=t.resolveCallback(t.handleFormulaChange,t,!1);if(i&&a){var o=t.createFormula(i,t.record||n.record,t.store);null==a||a.handler.call(a.thisObj,t,o,n)}}},{key:"calculate",value:(r=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.callback(this.generateContent,this,[t]));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updatePrefix",value:function(e){this.formulaRE=new RegExp("^=".concat(e,"\\((.+)\\)$"))}},{key:"updateUrl",value:function(e){this.generateContent=e?this.getRemoteContent:null}},{key:"getRemoteContent",value:(n=f(L().mark((function e(t){var n,r,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=(r=this).method,o=r.headers,l=F({},r.body),Be.setPath(l,r.paramName,t),e.next=5,Ba.fetch(r.url,Be.assign({credentials:i,method:a,headers:o,body:JSON.stringify(l)},r.fetchOptions));case 5:if((s=e.sent).ok){e.next=9;break}return r.trigger("formulaNetworkError",{response:s,bubbles:!0}),e.abrupt("return","");case 9:return e.next=11,s.json();case 11:n=e.sent,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Error:",e.t0);case 17:return e.abrupt("return",Be.getPath(n,this.responseField));case 18:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e){return n.apply(this,arguments)})},{key:"createFormula",value:function(e,t,n){var r={formula:e.replaceAll(this.fieldMatchRE,(function(e,r){var i;switch(r){case"this":return JSON.stringify(_c(t));case"data":return JSON.stringify(n.allRecords.map((function(e){return _c(e)})));default:return null!==(i=t.get(r))&&void 0!==i?i:""}}))};return this.trigger("formulaChange",r),r.formula}},{key:"store",get:function(){var e;return this._store||(null===(e=this.record)||void 0===e?void 0:e.firstStore)}}],[{key:"get",value:function(e,t){var n,r=null===(n=this.map)||void 0===n?void 0:n.get(e);return r&&t&&(r=new r(t)),r}},{key:"initClass",value:function(){var e,n=t,r=this,i=r===n?"FORMULA":(null===(e=r.$name)||void 0===e||null===(e=e.match(Lc))||void 0===e?void 0:e[1])||r.formulaPrefix;if(i){r.formulaPrefix||(r.formulaPrefix=i),r.inputPrefixRE=new RegExp("^=".concat(i,"\\(.*")),r.formulaRE=new RegExp("^=".concat(i,"\\((.+)\\)")),(n.map||(n.map=new a)).set(i,r);var o=z(n.map.keys()).map((function(e){return e})).join("|");n.inputPrefixRE=new RegExp("^=(".concat(o,")\\(.*"))}return B(t,"initClass",this,2)([])}}]);var n,r}(Mn.mixin(Za,_n));S(Hc,"$name","FormulaProvider"),S(Hc,"type","formula"),S(Hc,"configurable",{callOnFunctions:!0,record:null,store:null,inputField:{$config:"nullify",value:null},handleFormulaInput:null,handleFormulaChange:null,url:null,method:"POST",fetchOptions:null,paramName:"prompt",responseField:"content",headers:{Accept:"application/json","Content-Type":"application/json"},generateContent:null,prefix:null}),S(Hc,"factoryable",{defaultType:"formula"}),Hc.initClass(),Hc._$name="FormulaProvider";var Bc=Reflect.getOwnPropertyDescriptor,Vc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=function(e,n){return t.compare(null==e?void 0:e[t.name],null==n?void 0:n[t.name])})}},{key:"changeFormulaProviders",value:function(e){var t=this;return new Proxy(F({},e),{set:function(e,n,r){var i=Reflect.set(e,n,r);return t.updateFormulaProviders(e),i}})}},{key:"updateFormulaProviders",value:function(e){this.inputPrefixRE=e?new RegExp("^=(".concat(Object.keys(e).join("|"),")\\(.*")):null}},{key:"getFormulaProvider",value:function(e){var t=this.formulaProviders[e];if(t){if(t.isFormulaProvider)return t;var n=t.instance;if(!n){var r=F(F({},t),{},{prefix:e});n=t.instance=Hc.get(e,r)||Hc.create(r)}return n}}},{key:"label",get:function(){return this._label||Le.separate(this.name)},set:function(e){this._label=e}},{key:"defineAccessor",value:function(e,t){var n=this.name,r=this.dataSource;!t&&n in e&&e.$meta.hierarchy.some((function(e){var t;return!1===(null===(t=Bc(e.prototype,n))||void 0===t?void 0:t.enumerable)}))||(this.formulaProviders&&e.$meta.class.addField("#".concat(n)),Reflect.defineProperty(e,n,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(n,r)}:function(){return this.batching&&n in this.meta.batchChanges?this.meta.batchChanges[n]:this.data[r]},set:function(e){var t=this.$meta.fields.map[n];t&&t.readOnly||this.set(n,e)}}))}},{key:"isEqual",value:function(e,t){return Be.isEqual(e,t)}},{key:"print",value:function(e){return null==e?this.nullText:this.printValue(e)}},{key:"printValue",value:function(e){return String(e)}},{key:"getCurrentConfig",value:function(){var e={};for(var t in this.constructor.prototypeProperties)e[t]=this[t];return delete e.isConstructing,e}},{key:"calculated",get:function(){return Boolean(this.calculate||this._calculated)},set:function(e){this._calculated=e}},{key:"calculate",get:function(){return this._calculate},set:function(e){"function"==typeof e&&(e={fn:e}),this._calculate=e}}])}(Mn.mixin(Za));S(Vc,"$name","DataField"),S(Vc,"type","auto"),S(Vc,"factoryable",{defaultType:"auto"}),S(Vc,"prototypeProperties",{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:i,persist:!0,readOnly:!1,internal:!1,calculated:!1,calculate:null,useProp:null,bypassEqualityOnSyncDataset:!1,complexMapping:null}),S(Vc,"configurable",{formulaProviders:null}),Vc._$name="DataField";var Nc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isEqual",value:function(e,t){return e===t}},{key:"getAt",value:function(e,t){return e.get(this.name)[t]}}])}(Vc);S(Nc,"$name","ArrayDataField"),S(Nc,"type","array"),S(Nc,"dataConstructor",Array),Nc.initClass(),Nc._$name="ArrayDataField";var zc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isEqual",value:function(e,n){return null==e&&null==n||B(t,"isEqual",this,3)([e,n])}},{key:"convert",value:function(e){var t;return null==e?this.nullable?e:this.nullValue:"false"!==(null===(t=e.toLowerCase)||void 0===t?void 0:t.call(e))&&Boolean(e)}}],[{key:"prototypeProperties",get:function(){return{nullValue:!1}}}])}(Vc);S(zc,"$name","BooleanDataField"),S(zc,"type","boolean"),S(zc,"dataConstructor",Boolean),S(zc,"alias","bool"),zc.initClass(),zc._$name="BooleanDataField";var jc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"convert",value:function(e){if(null==e)this.nullable||(e=this.nullValue);else if("now"===e)e=new Date;else if(!(e instanceof Date)){var t=e;(e=Pl.parse(e,this.format||Pl.defaultParseFormat))&&!isNaN(e)||(e=i,""!==t&&console.warn('Date parsing failed for "'.concat(this.name,'" field, input: ').concat(JSON.stringify(t),". ").concat(this.format?"Expected format: ".concat(this.format,"."):'You should configure your Model field with a "format" to specify how dates should be parsed. See docs for DateDataField here: https://bryntum.com/products/scheduler/docs/api/Core/data/field/DateDataField, and see https://bryntum.com/products/scheduler/docs/api/Core/helper/DateHelper for the different formats.','"')))}return e}},{key:"serialize",value:function(e){return e instanceof Date&&(e=Pl.format(e,this.format||Pl.defaultFormat)),e}},{key:"printValue",value:function(e){return Pl.format(e,this.format||Pl.defaultFormat)}}],[{key:"prototypeProperties",get:function(){return{format:null}}}])}(Vc);S(jc,"$name","DateDataField"),S(jc,"type","date"),S(jc,"dataConstructor",Date),jc.initClass(),jc._$name="DateDataField";var Wc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"convert",value:function(e){return null==e?this.nullable?e:this.nullValue:String(e)}}],[{key:"prototypeProperties",get:function(){return{nullValue:""}}}])}(Vc);S(Wc,"$name","StringDataField"),S(Wc,"type","string"),S(Wc,"dataConstructor",String),Wc.initClass(),Wc._$name="StringDataField";var $c=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isEqual",value:function(e,t){return 0===Pl.compareUnits(e,t)}}])}(Wc);S($c,"$name","DurationUnitDataField"),S($c,"type","durationunit"),$c.initClass(),$c._$name="DurationUnitDataField";var Uc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"convert",value:function(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}],[{key:"prototypeProperties",get:function(){return{nullValue:0,rounding:"round"}}}])}(Vc);S(Uc,"$name","IntegerDataField"),S(Uc,"type","integer"),S(Uc,"alias","int"),S(Uc,"dataConstructor",Number),Uc.initClass(),Uc._$name="IntegerDataField";var Gc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isEqual",value:function(e,t){return e&&t&&t instanceof e.constructor&&t.id==e.id}}],[{key:"prototypeProperties",get:function(){return{complexMapping:!0}}}])}(Vc);S(Gc,"$name","ModelDataField"),S(Gc,"type","model"),S(Gc,"configurable",{modelClass:null}),Gc.initClass(),Gc._$name="ModelDataField";var Yc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isEqual",value:function(e,n){return isNaN(Number(e))&&isNaN(Number(n))||B(t,"isEqual",this,3)([e,n])}},{key:"convert",value:function(e){if(null==e)return this.nullable?e:this.nullValue;if(e=Number(e),!isNaN(e)){var t=this.precision;return t?(t=Math.pow(10,t),e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}}}],[{key:"prototypeProperties",get:function(){return{nullValue:0,precision:null}}}])}(Vc);S(Yc,"$name","NumberDataField"),S(Yc,"type","number"),S(Yc,"alias","float"),S(Yc,"dataConstructor",Number),Yc.initClass(),Yc._$name="NumberDataField";var qc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"prototypeProperties",get:function(){return{complexMapping:!0}}}])}(Vc);S(qc,"$name","ObjectDataField"),S(qc,"type","object"),S(qc,"dataConstructor",Object),qc.initClass(),qc._$name="ObjectDataField";var Kc=function(e){return"string"==typeof e&&e.startsWith("_generated")},Xc=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"init",value:function(e,t,n){var r,i=this,a="".concat(i.name,"Store"),o={skipStack:!0,syncDataOnLoad:!0,useRawData:!1};if(i.store&&Be.assign(o,i.store),i.modelClass&&(o.modelClass=i.modelClass),null===(r=t["init".concat(Le.capitalize(a))])||void 0===r||r.call(t,o),!o.storeClass&&!i.storeClass)throw new Error("Field '".concat(i.name,"' with type 'store' must have a storeClass configured"));var l=t.meta[a]=new(o.storeClass||i.storeClass)(o);i.complexMapping?Be.setPath(e,i.dataSource,l):e[i.dataSource]=l,l.verifyNoGeneratedIds=!1,l.usesId=i.usesId||!l.count||!l.every((function(e){return e.hasGeneratedId})),l.$currentValue=i.getValue(l,t),l.ion({change:function(e){var n=e.action,r=i.getValue(l,t);if(!l.$isSettingStoreFieldData){var a=l.$preserveCurrentDataset;l.$preserveCurrentDataset=i.subStore&&("update"===n||"remove"===n||"add"===n),i.$isUpdatingRecord=!0,t.set(i.name,r),i.$isUpdatingRecord=!1,l.$preserveCurrentDataset=a}l.$currentValue=r}}),i.$chrono&&n(i,l)}},{key:"set",value:function(e,t,n){var r,i,a,o=this,l="".concat(o.name,"Store"),s=n.meta[l];if(null!==(r=e)&&void 0!==r&&r.isStore&&(e=e.$currentValue),!s)return n.meta.initableValues.set(o,e),!1;s.$isSettingStoreFieldData||(s.$isSettingStoreFieldData=!0,e=null!==(i=null===(a=n["process".concat(Le.capitalize(l),"Data")])||void 0===a?void 0:a.call(n,e,n))&&void 0!==i?i:e,s.$preserveCurrentDataset||(s.data=e),s.$isSettingStoreFieldData=!1,s.usesId=o.usesId||!s.count||!s.every((function(e){return e.hasGeneratedId})))}},{key:"serialize",value:function(e,t){var n=t.meta["".concat(this.name,"Store")];return this.$isUpdatingRecord?this.getValue(n,t):n.$currentValue}},{key:"getValue",value:function(e,t){var n="get".concat(Le.capitalize(this.name),"StoreValue");return t[n]?t[n](e):e.allRecords.map((function(t){var n=t.persistableData;return e.usesId||delete n.id,n}))}},{key:"isEqual",value:function(e,t){if(null==e&&null==t)return!0;if(null==e&&null!=t||null!=e&&null==t)return!1;if(e.isStore&&t.isStore)return Be.isDeeplyEqual(e.$currentValue,t.$currentValue);if(e.isStore&&t.isStore||!e.isStore&&!t.isStore)return Be.isEqual(e,t,!0);var n=(e.isStore?e:t).modelClass,r=n.$meta.fields.defs,a=e.isStore?e.$currentValue:t.$currentValue,o=e.isStore?t:e;if(a.length!==o.length)return!1;for(var l=0;l<r.length;l++){var s=r[l];if(s.persist)for(var u=0;u<a.length;u++){var c=a[u][s.dataSource],d=o[u][s.dataSource];if(c!==i&&d===i){if(s.dataSource===n.idField&&Kc(c))continue;if(s.defaultValue!==i&&Be.isEqual(s.defaultValue,c,!0))continue}if(!Be.isEqual(c,d,!0))return!1}}return!0}},{key:"getOldValue",value:function(e){var t=e.meta["".concat(this.name,"Store")];return t?Be.clone(t.$currentValue):null}},{key:"getAt",value:function(e,t){var n=e.meta["".concat(this.name,"Store")];return null==n?void 0:n.getAt(t)}}])}(Vc);S(Xc,"$name","StoreDataField"),S(Xc,"type","store"),Xc.initClass(),Xc._$name="StoreDataField";var Zc=/^(.*?)\.(.*)/,Jc=/(.*)\[(.*)]\.?(.*)/,Qc=Reflect.defineProperty,ed=Be.hasOwn,td=i,nd={children:1,data:1,meta:1},rd=["name","title","text","label","description"],id={boolean:1,number:1,date:1,object:1},ad={parentId:1,$PhantomId:2,id:3},od=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"id",get:function(){var e;return null!==(e=this._id)&&void 0!==e?e:this.getData("id")},set:function(e){this.set("id",e)}},{key:"indexPath",get:function(){var e=[],t=this,n=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[n--]=t.parentIndex+1;return e}},{key:"construct",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=arguments.length>1&&arguments[1]!==i?arguments[1]:null,a=arguments.length>2&&arguments[2]!==i?arguments[2]:null,o=arguments.length>3&&arguments[3]!==i&&arguments[3],l=arguments.length>4&&arguments[4]!==i&&arguments[4],s=arguments.length>5&&arguments[5]!==i&&arguments[5],u=this,c=u.constructor,d=u.fieldMap;if(u.meta=F(F({modified:{}},c.metaConfig),a),c.applyConfigs){var h={};u.useRawData&&u.useRawData.enabled||(n=F({},n));var f=u.getDefaultConfiguration();if(c.autoExposeFields)for(var v in f)v in n&&(n[v]!==i&&(h[v]=n[v]),delete n[v]);else for(var g in n)g in c.fieldMap||(n[g]===i?h[g]=f[g]:h[g]=n[g],delete n[g]);B(t,"construct",this,3)([h])}if(o||c.exposeProperties(n,s),!ed(c,"idFieldProcessed")){var m=u.meta.idField;m||c._assignedIdField&&(m=c.idField),m&&m!==d.id.dataSource&&c.addField({name:"id",dataSource:m,internal:!0}),c._idField=d.id.dataSource,c.idFieldProcessed=!0}u._internalId=t._internalIdCounter++,u.originalData||(u.originalData=n);var p,y=c.processData(n,!1,r,u,l);(u._id=d.id.complexMapping?Be.getPath(y,c._idField):y[c._idField],(null===(e=u.meta.initableValues)||void 0===e?void 0:e.size)&&u.assignInitables(),null!=u._id||c.allowNullId&&null===u._id||u.setData("id",u.generateId(r)),y[c.childrenField])&&u.processChildren(null!==(p=$e.asArray(r))&&void 0!==p?p:[]);u.generation=0}},{key:"isCreating",get:function(){return Boolean(this.meta.isCreating)},set:function(e){var t,n=this;Boolean(n.meta.isCreating)!==e&&(n.meta.isCreating=e,null===(t=n.stores)||void 0===t||t.forEach((function(t){return t.onIsCreatingToggle(n,e)})))}},{key:"equals",value:function(e){if(e instanceof this.constructor){for(var t=this.$meta.fields.defs,n=0,r=t.length;n<r;n++){var i=t[n],a=i.name;if("id"!==a&&!i.isEqual(this.getValue(a),e.getValue(a)))return!1}return!0}return!1}},{key:"allFields",get:function(){return this.$meta.fields.defs}},{key:"fieldMap",get:function(){return this.$meta.fields.map}},{key:"assignInitables",value:function(){var e,t=this.meta.initableValues,n=D(t);try{for(n.s();!(e=n.n()).done;){var r=_(e.value,2),i=r[0],a=r[1];!1!==i.set(a,this.data,this)&&t.delete(i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"fields",get:function(){return this.$meta.fields.defs}},{key:"getFieldDefinition",value:function(e){return this.constructor.getFieldDefinition(e)}},{key:"getFieldDefinitionFromDataSource",value:function(e){return this.$meta.fields.sources[e]}},{key:"fieldNames",get:function(){return Object.keys(this.data)}},{key:"getDataSource",value:function(e){var t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}},{key:"initRelations",value:function(){var e=this;e.constructor.exposedRelations&&e.stores.forEach((function(t){var n;t.modelRelations||t.initRelations();var r=[];null===(n=t.modelRelations)||void 0===n||n.forEach((function(t){r.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,r)}))}},{key:"initRelation",value:function(e){var t=this,n=t.get(e.foreignKey),r=n!==td&&"string"!=typeof e.foreignStore&&e.foreignStore.getById(n);return(t.meta.relationCache||(t.meta.relationCache={}))[e.relationName]=r||(null!=n?{id:n,placeHolder:!0}:null),r}},{key:"removeRelation",value:function(e){var t=e.relationName,n=e.foreignKey,r=e.nullFieldOnRemove;this.meta.relationCache[t]&&(delete this.meta.relationCache[t],r&&this.setData(n,null))}},{key:"getForeign",value:function(e){var t;return null===(t=this.meta.relationCache)||void 0===t?void 0:t[e]}},{key:"setForeign",value:function(e,n,r){var i=t.asId(n);return this.set(r.foreignKey,i)}},{key:"getRelationConfig",value:function(e){var t;return null===(t=this.firstStore)||void 0===t||null===(t=t.modelRelations)||void 0===t?void 0:t.find((function(t){return t.foreignKey===e}))}},{key:"flatGet",value:function(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:this.data[t]}},{key:"complexGet",value:function(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:Be.getPath(this.data,t)}},{key:"get",value:function(e){if(e){var t=this,n=t.fieldMap,r=n[e];if(!r){if(e.includes("[")){var i=_(e.match(Jc),4),a=i[1],o=i[2],l=i[3],s=n[a];if(null!=s&&s.getAt){t._thisIsAUsedExpression(t[a]);var u=s.getAt(t,o);return u&&l?u.isModel?u.getValue(l):u[l]:u}return null}if(e.includes(".")){var c=_(e.split(".",2),2),d=c[0],h=c[1],f=n[d];if(null!=f&&f.isStoreDataField){var v=t[d];return h in v.modelClass.fieldMap||!(h in v)?null==v?void 0:v.getDistinctValues(h):v[h]}return Be.hasPath(t.data,e)?t.complexGet(e,e):Be.getPath(t,e)}}return null!=r&&r.complexMapping?t.complexGet(e,r.dataSource):t.flatGet(e,(null==r?void 0:r.dataSource)||e)}}},{key:"getValue",value:function(e){if(e)return e in this&&!e.includes(".")?this[e]:this.get(e)}},{key:"setValue",value:function(e,t){e in this?this[e]=t:this.set(e,t)}},{key:"setData",value:function(e,t){var n=this.data,r=this.fieldMap;if("string"==typeof e){var i,a=r[e],o=null!==(i=null==a?void 0:a.dataSource)&&void 0!==i?i:e;null!=a&&a.set?a.set(t,this.data,this):null!=a&&a.complexMapping?Be.setPath(n,o,t):n[o]=t,"id"===a?this._id=t:"parentId"===e&&(n[this.constructor.parentIdField]=t)}else for(var l=Object.keys(e),s=0;s<l.length;s++){var u,c=l[s],d=r[c],h=null!==(u=null==d?void 0:d.dataSource)&&void 0!==u?u:c;null!=d&&d.set?d.set(t,this.data,this):h&&(null!=d&&d.complexMapping?Be.setPath(n,h,e[c]):n[h]=e[c],"id"===c?this._id=t:"parentId"===c&&(n[this.constructor.parentIdField]=t))}}},{key:"getData",value:function(e){var t,n=this.fieldMap[e],r=null!==(t=null==n?void 0:n.dataSource)&&void 0!==t?t:e;if(r)return null!=n&&n.complexMapping?Be.getPath(this.data,r):this.data[r]}},{key:"syncId",value:function(e){var t=this.id;if(t!==e){this._id=e,this.setData("id",e);var n={id:{value:e,oldValue:t}};this.afterChange(n,n)}}},{key:"set",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=arguments.length>4&&arguments[4]!==i&&arguments[4],o=arguments.length>5&&arguments[5]!==i&&arguments[5],l=!(arguments.length>6&&arguments[6]!==i)||arguments[6],s=this;if(!s.isBatchUpdating){var u,c=s.inSet(e,t,n,r,a,o,l);return null===(u=s.afterSet)||void 0===u||u.call(s,e,t,n,r,c),c}s.inBatchSet(e,t,n||s.$silenceBatch)}},{key:"updateDependentFieldValues",value:function(e){var t=this;if("object"===W(e))Object.keys(e).forEach((function(e){return t.updateDependentFieldValues(e)}));else{e.startsWith("#")&&(e=e.substring(0));for(var n=0,r=Object.entries(this.constructor.dependentFields||{});n<r.length;n++){var i=_(r[n],2),a=i[0];e in i[1]&&this.set(a,this.get("#".concat(a)))}}}},{key:"fieldToKeys",value:function(e,t){return"string"!=typeof e?Be.assign({},e):S({},e,t)}},{key:"inBatchSet",value:function(e,t,n){var r,i=this,a=i.meta,o=i.constructor,l=i.fieldMap,s={},u=!1;if("string"!=typeof e?Object.keys(i.fieldToKeys(e,t)).forEach((function(n){r=l[n]||Be,t=o.processField(n,e[n],i),r.isEqual(a.batchChanges[n],t)||(s[n]={value:t,oldValue:i.get(n)},a.batchChanges[n]=t,u=!0)})):(r=l[e]||Be).isEqual(a.batchChanges[e],t)||(s[e]={value:t,oldValue:i.get(e)},a.batchChanges[e]=t,u=!0),u&&(i.generation++,!n)){var c,d={action:"update",record:i,records:[i],changes:s};null===(c=i.stores)||void 0===c||c.forEach((function(e){return e.trigger("batchedUpdate",F({},d))})),i.forEachLinked((function(e,t){return e.trigger("batchedUpdate",F(F({},d),{},{record:t,records:[t]}))}))}}},{key:"inSet",value:function(e,t,n,r){var a,o,l=arguments.length>4&&arguments[4]!==i&&arguments[4],s=arguments.length>5&&arguments[5]!==i&&arguments[5],u=!(arguments.length>6&&arguments[6]!==i)||arguments[6],c=this,d=c.data,h=c.meta,f=c.fieldMap,v=c.constructor,g=v.prototype,m=v.childrenField,p=v.relations,y={},k=c.fieldToKeys(e,t),b=Object.keys(k).sort(v.fieldSorter),C=null===(a=c.stores)||void 0===a?void 0:a.some((function(e){return e.isSyncingDataOnLoad})),w=null===(o=c.stores)||void 0===o?void 0:o.some((function(e){return e.modificationsTracking>0}));if(!n&&u&&!c.triggerBeforeUpdate(k))return null;var D,x,E,R=!1;if("object"===W(e)&&1===Object.keys(e).length&&(t=Object.values(e)[0],e=Object.keys(e)[0]),"string"==typeof e&&(D=c.getFieldDefinition(e))&&D.formulaProviders){var T,M,F,A,I=null===(T=t)||void 0===T||null===(T=T.match(D.inputPrefixRE))||void 0===T?void 0:T[1];if(E="#".concat(e),!(x=null===(M=D.formulaProviders[I])||void 0===M?void 0:M.instance))x=null===(F=(A=D).getFormulaProvider)||void 0===F?void 0:F.call(A,I);b.push(E),k[E]=t}if(x){var L,O,P=x.formulaRE,H=P?null===(L=(O=t.trim()).match)||void 0===L||null===(L=L.call(O,P))||void 0===L?void 0:L[1]:t;if(H){var B,V,N=c.constructor,z=N.dependentFields||(N.dependentFields={}),j=x.createFormula(H,c,c.firstStore),$=x.calculate(j);null==H||null===(B=H.matchAll(x.fieldMatchRE))||void 0===B||null===(V=B.forEach)||void 0===V||V.call(B,(function(t){var n=_(t,2)[1];n!==e&&((z[e]||(z[e]={}))[n]=1)})),k[e]=$,h.pendingFormulae=(h.pendingFormulae||0)+1;try{var U;null===(U=$.then)||void 0===U||U.call($,(function(n){h.pendingFormulae=Math.max(0,h.pendingFormulae-1),c.set(S(S({},e,n),E,t))}))}catch(n){h.pendingFormulae=Math.max(0,h.pendingFormulae-1),c.firstStore.trigger("formulaError",{record:c,field:e,error:n,formula:t}),c.set(e,"")}}}c.inSetting=!0;for(var G=function(){var e,t=b[Y];if(t===m)return 0;if(t.includes("[")){var n=_(t.match(Jc),4),a=n[1],o=n[2],u=n[3],D=c.fieldMap[a];if(null!=D&&D.getAt){var S,x,E=null!==(S=D.getAt(c,o))&&void 0!==S?S:null===(x=D.onSubRecordMissingInSet)||void 0===x?void 0:x.call(D,c,o);if(null==E)throw new Error("The store field '".concat(a,"' does not contain a record at index ").concat(o," - can not set the data"));return E.isModel?E.set(u,k[t]):Be.setPath(E,u,k[t]),0}}var T=t.includes(".");if(p&&T){var M=_(t.match(Zc),3),F=M[1],A=M[2];if(p[F])return A.includes(".")?c[F].set(A,k[t]):c[F][A]=k[t],0}var I,L,O=f[t],P=O||Be,H=null==O?void 0:O.readOnly,B=null!==(e=null==O?void 0:O.dataSource)&&void 0!==e?e:t,V=!l&&!O&&t in g||(null==O?void 0:O.useProp),N=V?c[B]:null!=O&&O.complexMapping||T?Be.getPath(d,B):d[B],z=v.processField(t,k[t],c),j=k[t]={value:z},W=Be.isPromise(z),$=c.getRelationConfig(t);H||!(C&&null!=O&&O.bypassEqualityOnSyncDataset||!P.isEqual(N,z))||s&&z===i||(c.generation++,j.oldValue=null!==(I=null==O||null===(L=O.getOldValue)||void 0===L?void 0:L.call(O,c))&&void 0!==I?I:N,R=!0,t in h.modified&&P.isEqual(h.modified[t],z,!1,!0)?(Reflect.deleteProperty(h.modified,t),c.isReverting&&(c.data[B]=z)):c.ignoreBag||w?w&&Reflect.deleteProperty(h.modified,t):(t in h.modified||null==N&&null==z||W||c.storeFieldChange(t,N),j.oldValue===td&&Reflect.deleteProperty(j,"oldValue")),y[t]=j,c.applyValue(V,B,z,l,O),$&&!r&&(c.initRelation($),c.stores.forEach((function(e){return e.cacheRelatedRecord(c,z,$.relationName,j.oldValue)}))))},Y=0;Y<b.length;Y++)G();return R&&c.afterChange(k,y,n,r,l),c.updateDependentFieldValues(e),c.inSetting=!1,R?y:null}},{key:"applyValue",value:function(e,t,n,r,i){var a,o,l,s,u,c=this;if(((null===(a=i)||void 0===a?void 0:a.dataSource)||t)===c.constructor.idField&&(c.$isPhantom=!1,c._id=n),((null===(o=i)||void 0===o?void 0:o.dataSource)||t)===c.constructor.parentIdField)null!==(s=c.firstStore)&&void 0!==s&&s.tree&&(null===(u=c.parent)||void 0===u||!u.isRoot||null!=n&&c.firstStore.getById(n))&&(c.firstStore.getById(n)||c.firstStore.rootNode).insertChild(c,null,!1,{orderedParentIndex:{skip:!0}});else if(e){var d;c[(null===(d=i)||void 0===d?void 0:d.name)||t]=n}else if(null!==(l=i)&&void 0!==l&&l.set)i.set(n,c.data,c);else{var h,f=null===(h=i)||void 0===h?void 0:h.complexMapping;if(!i&&t.includes(".")){var v,g,m=t.split(".")[0];f=(null===(v=i=c.constructor.fieldMap[m])||void 0===v?void 0:v.complexMapping)||"object"===(null===(g=i)||void 0===g?void 0:g.type)}f?Be.setPath(c.data,t,n):c.data[t]=n}}},{key:"afterChange",value:function(e,t,n,r,i){var a=this.updateDependentFields(Object.keys(t));if(a&&Object.assign(t,a),this.stores){var o,l=D(this.stores);try{for(l.s();!(o=l.n()).done;){o.value.onModelChange(this,e,t,n,r,i)}}catch(e){l.e(e)}finally{l.f()}}this.forEachLinked((function(a,o){return a.onModelChange(o,e,t,n,r,i)}))}},{key:"updateDependentFields",value:function(e){var t=this,n={};return e.forEach((function(e){var r;null===(r=t.getFieldDefinition(e))||void 0===r||null===(r=r.dependentFields)||void 0===r||r.forEach((function(e){var r=t.fieldMap[e],i=t.refreshCalculatedField(r);n[e]=i}))})),Object.keys(n).length>0?this.set(n,i,!0):n}},{key:"refreshCalculatedField",value:function(e){var t,n=this;"string"==typeof e&&(e=n.getFieldDefinition(e));var r=null===(t=e.calculate)||void 0===t?void 0:t.fn.call(e,n);return Be.isPromise(r)&&(n.isConstructing?n.data[e.name]=r:n[e.name]=r,r.then((function(t){return n[e.name]=t}))),r}},{key:"forEachLinked",value:function(e){var t,n=D(this.$links);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=D(i.stores);try{for(a.s();!(r=a.n()).done;){e(r.value,i)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"isPersistable",get:function(){return!this.isBatchUpdating&&!this.isCreating}},{key:"isModified",get:function(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}},{key:"hasPersistableChanges",get:function(){return this.isPersistable&&!Be.isEmpty(this.rawModificationData)}},{key:"isFieldModified",value:function(e){return this.isModified&&e in this.meta.modified}},{key:"getUnmodified",value:function(e){return this.isModified?this.meta.modified[e]:this.get(e)}},{key:"getFieldPersistentValue",value:function(e){var t,n="string"==typeof e?this.getFieldDefinition(e):e,r=(null==n?void 0:n.name)||e;return n&&!n.persist||(t=this.getValue(r),null!=n&&n.serialize&&(t=n.serialize(t,this))),t}},{key:"modifications",get:function(){var e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}},{key:"rawModifications",get:function(){var e=this,t={};if(!e.isModified)return null;var n=!1;return Object.keys(e.meta.modified).forEach((function(r){var i=e.getFieldPersistentValue(r);i!==td&&(t[r]=i,n=!0)})),n?t:null}},{key:"modificationData",get:function(){var e=this.rawModificationData;return e&&Object.keys(e).length&&Be.setPath(e,this.constructor.idField,this.id),e}},{key:"rawModificationData",get:function(){var e=this,t=e.constructor.fieldMap,n={};if(!e.isModified)return null;var r=!1;return Object.keys(e.meta.modified).forEach((function(i){var a,o,l=t[i],s=null===(a=l)||void 0===a?void 0:a.dataSource;if(i.includes(".")){var u=i.match(Zc)[1];l=t[u],s=i}if(null!==(o=l)&&void 0!==o&&o.persist){var c=e.getFieldPersistentValue(i);c!==td&&(Be.setPath(n,s,c),r=!0)}})),r?n:null}},{key:"modificationDataToWrite",get:function(){var e=this,t=e.modificationData,n=e.constructor,r=null!=t?t:{},i=n.alwaysWriteFields,a=Boolean(t);return i.forEach((function(t){Be.setPath(r,t.dataSource,e.getFieldPersistentValue(t)),a=!0})),a&&!t&&Be.setPath(r,n.idField,e.id),a?r:null}},{key:"persistableData",get:function(){var e=this,t={};return e.fields.forEach((function(n){var r=e.getFieldPersistentValue(n);r!==td&&(null!=n&&n.complexMapping?Be.setPath(t,n.dataSource,r):t[n.dataSource]=r)})),t}},{key:"dataByFieldName",get:function(){var e=this.data;return this.fields.reduce((function(t,n){return Be.hasPath(e,n.dataSource)&&(t[n.name]=e[n.dataSource]),t}),{})}},{key:"isCommitting",get:function(){return Boolean(this.meta.committing)}},{key:"clearChanges",value:function(e){var t,n=this;this.internalClearChanges(e),null===(t=this.stores)||void 0===t||t.forEach((function(e){return e.trigger("clearChanges",{record:n})}))}},{key:"internalClearChanges",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:null,r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this,o=a.meta;if(n){var l=o.modified;for(var s in n)delete l[s];for(var u in l){var c,d;(null!==(c=l[u])&&void 0!==c&&c.isStore&&!l[u].changes||r&&(null===(d=a.getFieldDefinition(u))||void 0===d||!d.persist))&&delete l[u]}}else o.modified=Object.assign({},o.modifiedMaterialized),o.modifiedMaterialized=null;var h,f=Be.isEmpty(o.modified);(o.committing=!1,t)&&(null===(h=a.stores)||void 0===h||h.forEach((function(t){if(f&&t.modified.remove(a),t.added.remove(a),e){var n=t.collectDescendants(a).all;t.added.remove(n),f&&t.modified.remove(n)}})))}},{key:"storeFieldChange",value:function(e,t){var n,r=this.meta;(r.modified[e]=t,this.isBeingMaterialized)&&(r.modifiedMaterialized=null!==(n=r.modifiedMaterialized)&&void 0!==n?n:{},r.modifiedMaterialized[e]=t)}},{key:"revertChanges",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];this.isReverting=!0,this.set(this.meta.modified,td,e),this.isReverting=!1}},{key:"setByDataSource",value:function(e){var t=this.constructor.fieldDataSourceMap,n=Be.pathifyKeys(e,t),r={};for(var i in n){var a,o=t[i];r[null!==(a=null==o?void 0:o.name)&&void 0!==a?a:i]=n[i]}return this.set(r)}},{key:"applyChangeset",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"$PhantomId",n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=this,a=r.constructor,o=a.idField,l=a.fieldDataSourceMap,s=Be.pathifyKeys(e,l),u=Be.pathifyKeys(r.modificationData),c={},d=t in e&&!(o in e);for(var h in!d&&t in s&&delete s[t],s){var f,v=l[h],g=null!==(f=null==v?void 0:v.name)&&void 0!==f?f:h;(n||u[h]===s[h])&&(c[g]=s[h])}var m=r.set(c);return r.internalClearChanges(!1,!0,c),m?Object.entries(m).reduce((function(e,t){var n=_(t,2),r=n[0],i=n[1];return e[r]=i.value,e}),{}):{}}},{key:"internalId",get:function(){return this._internalId}},{key:"isPhantom",get:function(){return""===this.id||null==this.id||this.hasGeneratedId||Boolean(this.$isPhantom)}},{key:"isModel",get:function(){return!0}},{key:"hasGeneratedId",get:function(){return"string"==typeof this.id&&this.id.startsWith("_generated")}},{key:"generateId",value:function(){return this.constructor.generateId()}},{key:"json",get:function(){return Le.safeJsonStringify(this)}},{key:"toJSON",value:function(){var e=this.children,t=this.unfilteredChildren,n=this.persistableData;return(t||e)&&(n[this.constructor.childrenField]=(t||e).map((function(e){return e.toJSON()}))),n}},{key:"toString",value:function(){var e=this,t=rd.find((function(t){return t in e.constructor.fieldMap})),n=t?S(S({},e.constructor.idField,e.id),t,e[t]):e.data;return Le.safeJsonStringify(n)}},{key:"isBatchUpdating",get:function(){return Boolean(this.batching)}},{key:"hasBatchedChange",value:function(e){var t;return null===(t=this.meta)||void 0===t||null===(t=t.batchChanges)||void 0===t?void 0:t[e]}},{key:"beginBatch",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}},{key:"endBatch",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=this,a=r.constructor.parentIdField;if(r.batching&&(r.batching--,r.$silenceBatch&&r.$silenceBatch--,!(r.batching>0||Be.isEmpty(r.meta.batchChanges)))){var o=r.meta.batchChanges;r.meta.batchChanges=null,o[a]&&(o=F({},o),r.parentId=o[a],delete o[a]),r.set(o,td,e,!1,t,i,n)}}},{key:"cancelBatch",value:function(){if(this.batching){var e=this,t=e.meta.batchChanges,n={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){var r;Object.entries(t).forEach((function(t){var r=_(t,2),i=r[0],a=r[1];n[i]={oldValue:a,value:e[i]}}));var i={action:"update",record:e,records:[e],changes:n};null===(r=e.stores)||void 0===r||r.forEach((function(e){return e.trigger("batchedUpdate",F({},i))})),e.forEachLinked((function(e,t){return e.trigger("batchedUpdate",F(F({},i),{},{record:t,records:[t]}))}))}e.$silenceBatch&&e.$silenceBatch--}}},{key:"triggerBeforeUpdate",value:function(e){var t,n=this;return!(null!==(t=this.stores)&&void 0!==t&&t.some((function(t){return!1===t.trigger("beforeUpdate",{record:n,changes:e})})))}},{key:"copy",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:null,n=arguments.length>1?arguments[1]:i,r=this,a=Be.clone(r.data),o=r.constructor.idField,l=Be.isObject(n)?n.deep:n;if(t&&"object"===W(t)?(e=t[o],Object.assign(a,t)):e=t,l&&r.children?a.children=r.children.map((function(e){return e.copy(!1!==t&&i,n)})):(delete a.children,delete a.expanded),r.$meta.fields.initable.length>0){var s,u=r.toJSON(),c=D(r.$meta.fields.initable);try{for(c.s();!(s=c.n()).done;){var d=s.value;a[d.name]=u[d.name]}}catch(e){c.e(e)}finally{c.f()}}!1!==t&&(a[o]=e||r.generateId(r.firstStore));var h=new r.constructor(a,null,null,!1,!0);return h.originalInternalId=r.internalId,h.copyOf=r,h}},{key:"copyData",value:function(e,t,n){var r={},i=this.skipCopyFields||{};e.allFields.forEach((function(n){var a=n.name;a===e.constructor.idField||a in i||(r[a]=t?e.get(a):e.getValue(a))})),this.set(r,null,n)}},{key:"remove",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.parent,r=t.stores;if(n)n.removeChild(t,!1,e,{unfiltered:!0});else if(null!=r&&r.length&&!t.isSpecialRow){r.slice().forEach((function(n){return n.remove(t,e,!1,!0)}))}}},{key:"beforeRemove",value:function(e,n){return B(t,"beforeRemove",this,3)([e,n])}},{key:"isValid",get:function(){return!0}},{key:"firstStore",get:function(){var e;return null===(e=this.stores)||void 0===e?void 0:e[0]}},{key:"joinStore",value:function(e){var n,r,i=this;i.stores&&i.stores.includes(e)||(B(t,"joinStore",this,3)([e]),e.register(i),i.stores?i.stores.push(e):i.stores=[e],i.unjoinedStores&&i.unjoinedStores.includes(e)&&i.unjoinedStores.splice(i.unjoinedStores.indexOf(e),1),(null===(n=i.children)||void 0===n?void 0:n.length)&&i.children.forEach((function(t){return t.joinStore(e)})),i.constructor.exposedRelations&&i.initRelations(),!e.tree||i.isRoot||null!==(r=e.stm)&&void 0!==r&&r.isRestoring||(i.instanceMeta(e.id).collapsed=!i.expanded))}},{key:"unjoinStore",value:function(e){var n,r,a,o=arguments.length>1&&arguments[1]!==i&&arguments[1],l=this,s=l.stores;null!=s&&s.includes(e)&&(e.isDestroying||(e.unregister(l),l.unjoinedStores?l.unjoinedStores.push(e):l.unjoinedStores=[e]),null===(n=l.unfilteredChildren||l.children)||void 0===n||null===(r=n.forEach)||void 0===r||r.call(n,(function(t){return t.unjoinStore(e,o)})),s.splice(s.indexOf(e),1),null===(a=B(t,"unjoinStore",this,3))||void 0===a||a([e,o]),e.uncacheRelatedRecord(l),l.meta.map&&!e.stm&&delete l.meta.map[e.id])}},{key:"isPartOfStore",value:function(e){var t;return e?e.includes(this):(null===(t=this.stores)||void 0===t?void 0:t.length)>0}},{key:"isRemoved",get:function(){return!this.isPartOfStore()}},{key:"isEditable",value:function(e){var t=this.getFieldDefinition(e);return(null==t||!t.calculated)&&(this.readOnly?"readOnly"===e:!!t||i)}},{key:"instanceMeta",value:function(e){var t,n=this.meta,r=e.id||e;return(null===(t=n.map)||void 0===t?void 0:t[r])||this.setInstanceMeta(r,{})}},{key:"setInstanceMeta",value:function(e,t){var n=this.meta,r=e.id||e;return n.map||(n.map={}),n.map[r]=t}},{key:"isGroupHeader",get:function(){return"groupRowFor"in this.meta}},{key:"isGroupFooter",get:function(){return"groupFooterFor"in this.meta}},{key:"isSpecialRow",get:function(){var e;return Boolean(null===(e=this.meta)||void 0===e?void 0:e.specialRow)}},{key:"$original",get:function(){return this.isLinked?this.proxyMeta.originalRecord:this}},{key:"domId",get:function(){return"string"==typeof this.id?this.id.replace(/[ .]/g,"-"):this.id}},{key:"getCurrentConfig",value:function(e){var n=this.data,r=this.children,i=this.constructor,a=i.defaultValues,o=i.applyConfigs?B(t,"getCurrentConfig",this,3)([e]):{};if(o){var l,s=D(this.fields);try{for(s.s();!(l=s.n()).done;){var u=l.value;if(u.persist){var c=Be.getPath(n,u.dataSource);null==c||u.isEqual(c,a[u.name])||Be.setPath(o,u.dataSource,Mn.processConfigValue(c,e))}}}catch(e){s.e(e)}finally{s.f()}if(r)if(Array.isArray(r)){o.children=[];var d,h=D(r);try{for(h.s();!(d=h.n()).done;){var f=d.value;o.children.push(f.getCurrentConfig(e))}}catch(e){h.e(e)}finally{h.f()}}else o.children=r;this.hasGeneratedId&&delete o.id,delete o.parentId,delete o.parentIndex}return o}}],[{key:"declarable",get:function(){return["fields"]}},{key:"fields",get:function(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}},{key:"idField",get:function(){return this._idField},set:function(e){this._assignedIdField=!0,this._idField=e}},{key:"childrenField",get:function(){if(!this._childrenField){var e=this.fieldMap.children;this._childrenField=(null==e?void 0:e.dataSource)||"children"}return this._childrenField},set:function(e){this._childrenField=e}},{key:"processData",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=arguments.length>2?arguments[2]:i,l=arguments.length>3?arguments[3]:i,s=arguments.length>4?arguments[4]:i,u=this,c=u.$meta.fields,d=c.map,h=c.defaults,f=c.chronoProps,v=(a||{}).useRawData,g=void 0===v?{enabled:!1}:v,m=s||g.enabled?e:Be.clone(e),p=Boolean(l.$entity);if(l.isConstructing&&(l.data=m),p&&!r){n={};var y,k=D(f);try{for(k.s();!(y=k.n()).done;){var b=y.value;n[b.name]=l.createFieldIdentifier(b)}}catch(e){k.e(e)}finally{k.f()}Object.defineProperty(l,"$",{value:n,enumerable:!0,configurable:!0})}var C=r||g.disableDefaultValue||s;if(!C||!g.disableTypeConversion&&!s||p)for(t in d){var w=d[t],S=w.name,x=w.dataSource,E=x!==S,R=w.complexMapping,T=R?Be.getPath(m,x):m[x],M=T===i?R?Be.getPath(m,S):m[S]:i,F=T!==i,A=M!==i,I=!F&&A,L=F||A,O=!g.disableTypeConversion&&w.convert,P=I?M:T;if(!C&&x in h&&!L&&!w.fromData){var _=h[x];Array.isArray(_)?_=_.slice():_ instanceof Date?_=new Date(_):_&&"object"===W(_)&&(_=Be.clone(_)),R?Be.setPath(m,x,_):m[x]=_,P=_}if((I||O)&&(!C||L)&&!s&&!w.calculate){var H=O?w.convert(P,e,l):P;(H!==i||P!==i||F)&&(R?Be.setPath(m,x,H):m[x]=H,E&&delete m[S],P=H)}if(!r&&w.$chrono)(n[S]=l.createFieldIdentifier(w.$chrono)).DATA=P}return u.$meta.fields.calculated.forEach((function(e){var t=e.calculate;if(!e._cachedDependencies&&!t.dependsOn){e._cachedDependencies=!0;var n,r=new o,i=new Proxy(m,{get:function(e,t){return r.add(t),m[t]}});try{t.fn(i,l),t.dependsOn=Array.from(r),u.setupDependentCalcFields(e),n=0===r.size}catch(e){n=!0}n&&console.warn('Failed to auto-detect dependent fields for "'.concat(e.name,'" field. Add "dependentOn" in your calculate config.'))}m[e.name]=l.refreshCalculatedField(e)})),u.$meta.fields.initable.length&&u.initInitables(l,m,(function(e,t){(n[e.name]=l.createFieldIdentifier(e.$chrono)).DATA=t})),m}},{key:"setupClass",value:function(e){B(t,"setupClass",this,2)([e]),e.fields||this.setupFields(this,e)}},{key:"setupFields",value:function(e,n){var r,i,a,o,l,s=ed(e,"fields")&&e.fields,u=n.super.fields,c=n.fields={defs:null!==(r=null==u?void 0:u.defs.slice())&&void 0!==r?r:[],calculated:null!==(i=null==u?void 0:u.calculated.slice())&&void 0!==i?i:[],exposedData:!1,defaults:u?F({},u.defaults):{},exposed:Object.create(null!==(a=null==u?void 0:u.exposed)&&void 0!==a?a:null),ordinals:Object.create(null!==(o=null==u?void 0:u.ordinals)&&void 0!==o?o:null),map:u?F({},u.map):{},sources:u?F({},u.sources):{},chronoProps:[],subModels:[]};if(e!==t){var d=n;do{(d=d.super).fields.subModels.push(e)}while(d.class!==t)}if(ed(e,"defaults")&&Object.assign(c.defaults,e.defaults),ed(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),null!=s&&s.length&&s.map(e.addField,e),c.initable=c.defs.filter((function(e){return e.init})),null!==(l=e.$entity)&&void 0!==l&&l.allFields.size){var h,f=D(e.$entity.allFields.values());try{for(f.s();!(h=f.n()).done;){var v=h.value;c.map[v.name]||c.chronoProps.push(v)}}catch(e){f.e(e)}finally{f.f()}}e.exposeRelations()}},{key:"defaultValues",get:function(){return this.$meta.fields.defaults}},{key:"allFields",get:function(){return this.$meta.fields.defs}},{key:"fieldMap",get:function(){return this.$meta.fields.map}},{key:"fieldDataSourceMap",get:function(){return this.$meta.fields.sources}},{key:"exposeProperties",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n.$meta.fields,a=t?"exposed":"map";if(e&&n.autoExposeFields&&!r.exposedData){var o,l,s;for(o in e)r[a][o]||o===n.childrenField||(s=Be.typeOf(e[o]),l={name:o,dataSource:o,fromData:!0},id[s]&&(l.type=s),n.addField(l));r.exposedData=!0}n.exposeRelations()}},{key:"addField",value:function(e){if(null!=e){"string"==typeof e&&(e={name:e});var t,n,r,i=this.initClass(),a=i.$meta.fields,o=a.ordinals,l=a.calculated,s=a.subModels,u=a.exposed,c=e.name,d=a.map[c],h=e.dataSource||(e.dataSource=c);if(!d||e.type&&e.type!==d.type)e.model=i,t=Vc.create(e),e.model=null,t.definedBy=d?d.definedBy:i,t.ordinal=d?d.ordinal:o[c]=a.defs.length,null!==(r=t.calculate)&&void 0!==r&&r.dependsOn&&i.setupDependentCalcFields(t);else for(n in t=Object.create(d),e)"type"!==n&&(t[n]=e[n]);t.owner=i,a.defs[t.ordinal]=t,a.map[c]=t,a.sources[h]=t;var f,v=D(s);try{for(v.s();!(f=v.n()).done;){f.value.$meta.fields.map[c]=t}}catch(e){v.e(e)}finally{v.f()}return!1!==t.complexMapping&&h.includes(".")&&(t.complexMapping=!0),t.complexMapping?u[h.split(".")[0]]=!0:u[h]=!0,"defaultValue"in t&&(a.defaults[h]=t.defaultValue),nd[c]||t.defineAccessor(i.prototype),t.calculate&&l.push(t),i._nonPersistableFields=null,i._alwaysWriteFields=null,t}}},{key:"setupDependentCalcFields",value:function(e){var t=this,n=this.$meta.fields;e.calculate.dependsOn.forEach((function(r){if(!n.map[r])throw new Error('No "'.concat(r,'" field defined in ').concat(t.$name," class"));n.map[r].dependentFields=n.map[r].dependentFields||[],n.map[r].dependentFields.push(e.name)}))}},{key:"removeField",value:function(e){var t=this.initClass(),n=t.$meta.fields,r=n.map[e],i=n.ordinals,a=i[e];if(r){for(var o in n.defs.splice(a,1),delete i[e],delete n.defaults[e],delete n.exposed[e],delete n.map[e],delete n.sources[r.dataSource],i)i[o]>a&&--i[o];delete t.prototype[e]}}},{key:"exposeRelations",value:function(){var e=this;if(!ed(e,"exposedRelations")&&e.relations){e.exposedRelations=[];var t=function(t){var n=e.relations[t];n.relationName=t,e.exposedRelations.push(n),Reflect.ownKeys(e.prototype).includes(t)||Qc(e.prototype,t,{enumerable:!0,get:function(){return this.getForeign(t)},set:function(e){this.setForeign(t,e,n)}})};for(var n in e.relations)t(n)}}},{key:"initInitables",value:function(e,t,n){var r,o=e.meta.initableValues=new a,l=D(this.$meta.fields.initable);try{for(l.s();!(r=l.n()).done;){var s=r.value,u=Be.getPath(t,s.dataSource);u!==i&&o.set(s,u),!s.lazy&&s.init(t,e,n)}}catch(e){l.e(e)}finally{l.f()}}},{key:"autoExposeFields",get:function(){return!0}},{key:"fieldSorter",value:function(e,t){return(ad[e]||100)-(ad[t]||100)}},{key:"getFieldDefinition",value:function(e){var t=this.fieldMap[e];if(!t)if(e.includes("[")){var n,r=_(e.match(Jc),4),i=r[1],a=r[3],o=i.includes(".")?this.getFieldDefinition(i):this.fieldMap[i];if(null!=o&&o.isStoreDataField)return null===(n=o.modelClass)||void 0===n?void 0:n.getFieldDefinition(a)}else if(e.includes(".")){var l=_(e.split(".",2),2),s=l[0],u=l[1],c=this.fieldMap[s];if(null!=c&&c.isModelDataField&&c.modelClass)return c.modelClass.getFieldDefinition(u)}return t}},{key:"getFieldDataSource",value:function(e){var t;return(null===(t=this.getFieldDefinition(e))||void 0===t?void 0:t.dataSource)||e}},{key:"processField",value:function(e,t,n){var r=this.fieldMap[e];return null!=r&&r.convert?r.convert(t,this.data,n):t}},{key:"generateId",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.$$name;return"_generated".concat(e,"_").concat(Le.generateUUID())}},{key:"asId",value:function(e){return null!=e&&e.isModel?e.id:Be.isObject(e)?e[this.fieldMap.id.dataSource]:e}},{key:"nonPersistableFields",get:function(){var e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach((function(t){t.persist&&!t.calculated||(e._nonPersistableFields[t.name]=1)}))),e._nonPersistableFields}},{key:"alwaysWriteFields",get:function(){var e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=e.allFields.filter((function(e){return e.alwaysWrite}))),e._alwaysWriteFields}},{key:"toJavaScriptValue",value:function(e){var t=this.$meta.names,n=t[t.length-2],r=t[t.length-3];return"class ".concat(n," extends ").concat(r," { static fields = ").concat(Le.toJavaScriptValue(this.fields,e),"; }")}}])}(Mn.mixin(Ec,Mc,Ic));S(od,"$name","Model"),S(od,"relations",null),od._idField="id",od._internalIdCounter=1,od._assignedIdField=!1,od.exposeProperties(),od._$name="Model";var ld=function(){return w((function e(){m(this,e)}),null,[{key:"preWalk",value:function(e,t,n){for(var r,i,a=[e];a.length;)n(r=a.pop()),(i=t(r))&&a.push.apply(a,i.slice().reverse())}},{key:"walkWhile",value:function(e,t,n){for(var r,i,a=Array.isArray(e)?z(e):[e];a.length;){if(!n(r=a.pop()))return!1;i=t(r),Array.isArray(i)&&a.push.apply(a,z(i))}return!0}},{key:"preWalkWithParent",value:function(e,t,n){for(var r=[{node:e,parent:null}],i=function(){var e=r.pop(),i=e.parent,a=e.node;n(i,a);var o=t(a);Array.isArray(o)&&r.push.apply(r,z(o.slice().reverse().map((function(e){return{node:e,parent:a}}))))};r.length;)i()}},{key:"preWalkUnordered",value:function(e,t,n){for(var r,i,a=[e];a.length;)n(r=a.pop()),(i=t(r))&&a.push.apply(a,i)}},{key:"postWalk",value:function(e,t,n){for(var r,i,o=new a,l=[e];l.length;)r=l[l.length-1],o.has(r)?(n(r),l.pop()):((i=t(r))&&l.push.apply(l,z(i.slice().reverse())),o.set(r,r))}},{key:"prePostWalk",value:function(e,t,n,r){for(var i,o,l=new a,s=[e];s.length;)i=s[s.length-1],l.has(i)?(r(i),s.pop()):(n(i),(o=t(i))&&s.push.apply(s,z(o.slice().reverse())),l.set(i,i))}}])}();ld._$name="WalkHelper";var sd=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"add",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return 1===n.length&&Array.isArray(n[0])&&(n=n[0]),B(t,"add",this,3)(z(n.filter((function(e){return e.isPersistable}))))}}])}(hs);sd._$name="StoreBag";var ud=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"remove",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.storage;if(0===(e=$e.asArray(e).reduce((function(e,t){return(t=n.getById(t))&&e.push(t),e}),[])).length)return e;if(!n.tree&&!t&&!1===n.trigger("beforeRemove",{records:e}))return[];if(n.isRemoving=!0,n.isGrouped){var a,l=r.count,s=[],u=new o,c=D(e);try{for(c.s();!(a=c.n()).done;){var d=a.value,h=d.instanceMeta(n).groupParent;h.meta.collapsed&&s.push(d),$e.remove(h.groupChildren,d),$e.remove(h.unfilteredGroupChildren,d),h.meta.childCount--,u.add(h)}}catch(e){c.e(e)}finally{c.f()}var f,v=D(u);try{for(v.s();!(f=v.n()).done;){var g=f.value;g.groupChildren.length>0&&n.onModelChange(g,{},{})}}catch(e){v.e(e)}finally{v.f()}s.length&&r.trigger("change",{action:"splice",removed:s,added:[],replaced:[],oldCount:l})}else if(n.tree){var m=[],p=new o,y=e.length>1,k=e[0],b=y?i:r.indexOf(k),C=e.reduce((function(e,t){var n=t.parent;return n&&(e[n.id]||(e[n.id]=[n,[]]),e[n.id][1].push(t)),e}),{}),w=Array.from(Object.values(C));if(!t&&!1===n.trigger("beforeRemove",{records:e,isMove:!1,parent:y?i:k.parent}))return n.isRemoving=!1,[];n.suspendAutoCommit(),w.sort((function(e,t){return t[0].childLevel-e[0].childLevel}));for(var S=0,x=w;S<x.length;S++){var E=_(x[S],2),R=E[0],T=E[1];m.push.apply(m,z(R.removeChild(T,!1,!0,{skipIndexUpdate:!0}))),p.add(R)}var M,F=D(p);try{for(F.s();!(M=F.n()).done;){var A=M.value;m.includes(A)||(A.updateChildrenIndices(A.children,"parentIndex"),A.unfilteredChildren&&A.updateChildrenIndices(A.unfilteredChildren,"unfilteredIndex"),A.orderedChildren&&A.updateChildrenIndices(A.orderedChildren,"orderedParentIndex"))}}catch(e){F.e(e)}finally{F.f()}return t||(n.trigger("remove",{parent:y?i:k.parent,index:b,isChild:!0,allRecords:m,isMove:!1,records:e}),n.trigger("change",{action:"remove",records:e})),n.resumeAutoCommit(),n.isRemoving=!1,e}if(0===e.length)return n.isRemoving=!1,e;var I,L=D(e);try{for(L.s();!(I=L.n()).done;){I.value.beforeRemove(e)}}catch(e){L.e(e)}finally{L.f()}return t&&n.suspendEvents(),r.remove(e),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,e}},{key:"clear",value:function(){var e,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=this,r=n.storage;if(n.storage.totalCount||null!==(e=n.rootNode)&&void 0!==e&&null!==(e=e.unfilteredChildren)&&void 0!==e&&e.length){if(!t&&!1===n.trigger("beforeRemove",{records:r.allValues,removingAll:!0}))return null;if(n.rootNode)if(n.isChained&&!n.isChainedTree)for(var a,o=n.getAllDataRecords(),l=o.length-1;l>=0;l--)(a=o[l])&&!a.isDestroyed&&a.unjoinStore(n);else n.rootNode.clearChildren(t);else if(t)for(var s,u=n.registeredRecords,c=u.length-1;c>=0;c--)(s=u[c])&&!s.isDestroyed&&s.unjoinStore(n);t&&(n.removed.clear(),r.suspendEvents()),r.clear(),t&&r.resumeEvents(),n.added.clear(),n.modified.clear()}}},{key:"removeAll",value:function(){var e,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=this,r=n.storage;if(n.isRemoving=!0,t){r.suspendEvents();for(var a,o=n.registeredRecords,l=o.length-1;l>=0;l--)!(a=o[l])||a.isDestroyed||a.isRoot||a.unjoinStore(n)}return e=n.tree?!1!==n.rootNode.clear():null!==n.clear(),t&&r.resumeEvents(),n.isRemoving=!1,e}},{key:"add",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i?arguments[2]:{},o=this,l=o.storage;if(null!==(t=e=$e.asArray(e))&&void 0!==t&&t.length){if(o.tree=o.tree||Boolean(o.autoTree&&e[0].children),o.tree){var s,u=new a,c=o.modelClass.getFieldDataSource("parentIndex"),d=o.modelClass.getFieldDataSource("orderedParentIndex"),h=o.modelClass.parentIdField,f=[];return e.forEach((function(e){s=s||(!(c in e)&&d in e?d:c);var t=e[h];u.has(t)||u.set(t,{append:[],insert:[]});var n=u.get(t);!e.isModel&&s in e?n.insert.push(e):n.append.push(e)})),u.forEach((function(e,t){var i=e.append,a=e.insert,l=null==t?o.rootNode:o.getById(t);if(!l)throw new Error("Parent node with id ".concat(t," not found, cannot add children."));if(i.length&&f.push.apply(f,z(l.appendChild(i,n,r))),a.length){var u,c=D(a);try{for(c.s();!(u=c.n()).done;){var d=u.value;"orderedParentIndex"in d&&("orderedParentIndex"in r&&Be.isObject(r.orderedParentIndex)?r.orderedParentIndex.index=d.orderedParentIndex:r.orderedParentIndex=d.orderedParentIndex),f.push(l.insertChild(d,d[s],n,r))}}catch(e){c.e(e)}finally{c.f()}}})),o.isFiltered&&o.reapplyFilterOnAdd&&o.filter({silent:!0}),o.reapplySortersOnAdd&&!o.isSyncingDataOnLoad&&o.sort(),f}if(!n&&!1===o.trigger("beforeAdd",{records:e}))return null;if(o.tree=o.tree||Boolean(o.autoTree&&e[0].children),o.tree)return o.rootNode.appendChild(e);var v=o.processRecords(e);return n&&o.suspendEvents(),o.addingClean=r.clean,l.add(v),o.addingClean=!1,n&&o.resumeEvents(),o.autoCommit&&o.doAutoCommit(),v}}},{key:"cloneImmutable",value:function(e){return!this.useRawData.enabled||e[0].isModel||Object.isExtensible(e[0])||(e=Be.clone(e)),e}},{key:"processRecords",value:function(e,t){var n=this;return this.cloneImmutable(e).map((function(e){var r=n.processRecord(e.isModel?e:n.createRecord(e));return null==t||t.call(n,r),r}))}},{key:"insert",value:function(e,t){var n,r,a,o=arguments.length>2&&arguments[2]!==i&&arguments[2],l=this,s=l.storage,u=s.getAt(e),c=s.values,d=[];if(t=$e.asArray(t),l.tree){var h,f=l.rootNode;return f.insertChild(t,null===(h=f.children)||void 0===h?void 0:h[e],o)}if(!o&&!1===l.trigger("beforeAdd",{records:t}))return null;if(c[r=e]===t[0]||c[r=e-1]===t[0])for(n=!0,a=0;n&&a<t.length;a++)t[a]!==c[r+a]&&(n=!1);if(n)return null;var v=l.processRecords(t,(function(t){var n=s.indexOf(t);t.children&&t.children.length&&l.autoTree&&(l.tree=!0),n>-1&&(n<e&&u&&e--,d.push(n)),t.meta.previousIndex=n}));return l.suspendEvents(),l.storage.remove(d),l.resumeEvents(),o&&l.suspendEvents(),s.splice.apply(s,[e,0].concat(z(v))),o&&l.resumeEvents(),l.autoCommit&&l.doAutoCommit(),v}},{key:"move",value:function(e,t){this.isTree?t.parent.insertChild(e,t):this.storage.move(e,t)}},{key:"acceptChanges",value:function(){var e=this;e.added.forEach((function(e){return e.internalClearChanges(!0,!1)})),e.modified.forEach((function(e){return e.internalClearChanges(!0,!1)})),e.added.clear(),e.modified.clear(),e.removed.clear()}},{key:"commit",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this.changes;return!(!e&&!1===this.trigger("beforeCommit",{changes:t}))&&(this.acceptChanges(),e||this.trigger("commit",{changes:t}),t)}},{key:"revertChanges",value:function(){var e=this,t=e.changes;if(t){var n={action:"clearchanges",changes:t};e.add(e.removed.values,!0),e.remove(e.added.values,!0),e.modified.forEach((function(e){return e.revertChanges(!0)})),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",n),e.trigger("refresh",n)}}},{key:"changes",get:function(){var e=this,t=e.modified.values.filter((function(e){return e.rawModifications}));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}},{key:"hasChanges",get:function(){return Boolean(this.added.count||this.removed.count||this.modified.values.some((function(e){return e.rawModifications})))}},{key:"autoCommit",get:function(){return this._autoCommit},set:function(e){this._autoCommit=e,e&&this.hasChanges&&this.commit()}},{key:"suspendAutoCommit",value:function(){this.suspendCount++}},{key:"resumeAutoCommit",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0];this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}},{key:"doAutoCommit",value:function(){this.suspendCount<=0&&this.commit()}}],[{key:"defaultConfig",get:function(){return{autoCommit:!1}}},{key:"properties",get:function(){return{isRemoving:!1,suspendCount:0}}}])}(e||Mn),S(t,"$name","StoreCRUD"),t},cd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"applyChangesFromStore",value:function(e){var t=this,n=e.changes;n&&(n.added&&t.add(n.added),n.removed&&t.remove(n.removed.map((function(e){return e.id}))),n.modified&&n.modified.forEach((function(e){var n=t.getById(e.id);null==n||n.set(e.modifications)})))}},{key:"applyChangeset",value:function(e){var t,n,r=this,l=arguments.length>1&&arguments[1]!==i?arguments[1]:null,s=arguments.length>2&&arguments[2]!==i?arguments[2]:"$PhantomId",u=!(arguments.length>3&&arguments[3]!==i)||arguments[3],c=arguments.length>4&&arguments[4]!==i&&arguments[4],d=this,h=null!==(t=null==l?void 0:l(e,d))&&void 0!==t?t:e,f=h.$input||h,v=f.added,g=f.updated,m=f.modified,p=f.removed,y=null!==(n=null!=g?g:m)&&void 0!==n?n:[],k=d.modelClass.getFieldDataSource("id"),b=d.modelClass.getFieldDataSource("parentId"),C=c?new a:null,w=d.tree,S=[],x=[],E=new o,R=!1,T=[];if(d.trigger("startApplyChangeset"),d._groupVisibleRecordIds=[],d.isGrouped&&d.forEach((function(e){d._groupVisibleRecordIds.push(e.id)})),(null==v?void 0:v.length)>0){var M,F,A=[],I=[],L=D(v);try{for(L.s();!(F=L.n()).done;){var O=F.value,P=d.getById(O[s])||d.getById(Be.getPath(O,k));if(P)A.push(O),w&&E.add(P.parent);else d.removed.get(O[s])||d.removed.get(Be.getPath(O,k))||I.push(O)}}catch(e){L.e(e)}finally{L.f()}y.unshift.apply(y,A);var _=d.reapplySortersOnAdd;d.reapplySortersOnAdd=!1;var H=null!==(M=d.add(I,!1,{orderedParentIndex:{skip:!0},clean:u}))&&void 0!==M?M:[];if(S.push.apply(S,z(H)),d.reapplySortersOnAdd=_,w){var B,V=D(H);try{var N=function(){var e=B.value,t=e.parent;if(t.isRoot)return R=!0,T=[t],1;!t.isRoot&&T.every((function(e){return!e.contains(t)}))&&T.push(t),"orderedParentIndex"in e.originalData&&E.add(t)};for(V.s();!(B=V.n()).done&&!N(););}catch(e){V.e(e)}finally{V.f()}}var j,W=D(H);try{for(W.s();!(j=W.n()).done;){var $=j.value;null==C||C.set($.id,$.data),$.internalClearChanges()}}catch(e){W.e(e)}finally{W.f()}w&&E.forEach((function(e){e.updateChildrenIndices(e.orderedChildren,"orderedParentIndex",!0)}))}if((null==y?void 0:y.length)>0){var U,G=D(y);try{var Y=function(){var e,t,n=U.value,i=n[s],a=Be.getPath(n,k),o=Be.getPath(n,b),l=null!==(e=d.removed.get(i))&&void 0!==e?e:d.removed.get(a),u=null!==(t=null!=l?l:d.getById(i))&&void 0!==t?t:d.getById(a);if(u){var c,h=null!=o&&(null===(c=d.getById(o))||void 0===c?void 0:c.isLeaf);r.filterTreeHierarchyChanges(E,u,n);var f=u.applyChangeset(n,s);l&&k in f&&i&&d.onRecordIdChange({record:u,oldValue:i,value:a}),h&&d.toggleCollapse(u.parent,!1),w&&u.parent&&!R&&T.every((function(e){return!e.contains(u)}))&&(u.parent.isRoot?(R=!0,T=[u.parent]):T.push(u.parent)),null==C||C.set(a,f),x.push(u)}};for(G.s();!(U=G.n()).done;)Y()}catch(e){G.e(e)}finally{G.f()}}if((null==p?void 0:p.length)>0&&d.applyRemovals(p),"changes"===d.applyChangesetFilterSortTarget){var q,K=d.filterChangeset(S,x);(q=T).push.apply(q,z(K))}if(d.afterChangesetApplied(T),w&&d.isSorted&&d.reapplySortersOnAdd&&(null!=v&&v.length||null!=y&&y.length)){var X=new o;T.forEach((function(e){X.has(e)||(X.add(e),e.sortVisibleChildren(!1,d.sorterFn),e.sortUnfilteredChildren(!1,d.sorterFn))})),d.storage.replaceValues({values:d.collectDescendants(d.rootNode).visible,silent:!0}),d.afterPerformSort(!1)}return d._groupVisibleRecordIds=null,d.trigger("endApplyChangeset"),C}},{key:"afterChangesetApplied",value:function(e){var t=new o;e.forEach((function(e){t.has(e)||e.traverse((function(e){t.has(e)||(t.add(e),e.sortOrderedChildren(!1,!1),e.children&&e.updateChildrenIndices(e.children,"parentIndex",!0),e.unfilteredChildren&&e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0))}))}))}},{key:"applyRemovals",value:function(e){var t,n=this,r=n.removed,i=n.modelClass.idField,a=[],l=D(e);try{for(l.s();!(t=l.n()).done;){var s=t.value,u=Be.getPath(s,i);if(r.includes(u)){var c=r.get(u);c.internalClearChanges(!1,!0,null),c.$isPhantom=!0,r.remove(u)}else a.push(u)}}catch(e){l.e(e)}finally{l.f()}if(n.tree){var d=a.reduce((function(e,t){var r;n.getById(t)&&e.add(null!==(r=n.getById(t).parentNode)&&void 0!==r?r:n.rootNode);return e}),new o);d.forEach((function(e){return e.sortOrderedChildren(!1,!1)}))}n.remove(a);for(var h=0,f=a;h<f.length;h++){var v=f[h];r.remove(v)}}},{key:"filterChangeset",value:function(e,t){var n=this,r=n.isFiltered,a=n.tree,l=n.isGrouped,s=n.filtersFunction,u=n.isSorted?n.createSorterFn(n.sorters):i,c=n.storage,d=c.allValues,h=c.addedValues,f=c.isSorted,v=null!=u||f?null!=u?u:n.storage.sortFunction:null,g=new o;if(!r)return[];var m,p=!1;if(l&&(m=n.groupers,n.clearGroupers(!0)),a){var y,k=new o(t.filter(s)),b=D(e.filter(s));try{for(b.s();!(y=b.n()).done;){var C=y.value;k.add(C)}}catch(e){b.e(e)}finally{b.f()}k.forEach((function(e){return e.bubble((function(e){return k.add(e)}))})),k.delete(n.rootNode);var w,S=D($e.groupByIndexed(Array.from(k).filter((function(e){var t;return!(null!==(t=e.parent)&&void 0!==t&&null!==(t=t.children)&&void 0!==t&&t.includes(e))})),(function(e){return e.parent})));try{for(S.s();!(w=S.n()).done;){var x,E=_(w.value,2),R=E[0],T=E[1];if(R.unfilteredChildren)(x=R.children).push.apply(x,z(T)),g.add(R),n.traverseFilter(R,!1,T)}}catch(e){S.e(e)}finally{S.f()}}else if(v&&!l){var M,F=n.storage.filteredValues,A=h?F.findLastIndex((function(e){return!h.has(e)}))+1:F.length,I=F.slice(0,A),L=new o(t.filter(s)),O=D(F);try{for(O.s();!(M=O.n()).done;){var P=M.value;L.has(P)&&L.delete(P)}}catch(e){O.e(e)}finally{O.f()}var H,B=D(L);try{for(B.s();!(H=B.n()).done;){var V=H.value;I.push(V)}}catch(e){B.e(e)}finally{B.f()}I.sort(v),F.splice.apply(F,[0,A].concat(z(I))),p=!0}else{var N=t.filter((function(e){return s(e)&&!n.storage.includes(e)}));N.length>0&&(n.includeInSubset(d,n.storage.filteredValues,N),p=!0)}var j=new o(e.filter((function(e){return!s(e)})));if(j.size>0){if(a){var W,$=D(j);try{for($.s();!(W=$.n()).done;){var U=W.value;$e.remove(U.parent.children,U),g.add(U.parent)}}catch(e){$.e(e)}finally{$.f()}}else $e.remove(n.storage.filteredValues,j);p=!0}return m&&(n.group(m[0],null,!1,!0,!0),p=!1,n._idMap=null),a&&g.size>0?n.storage.replaceValues({values:n.collectDescendants(n.rootNode).visible,silent:!0}):p&&(n._idMap=null,n.trigger("refresh")),z(g)}},{key:"filterTreeHierarchyChanges",value:function(e,t,n){this.tree&&e.has(t.parent)&&(delete n.orderedParentIndex,delete n.parentIndex)}},{key:"includeInSubset",value:function(e,t,n){for(var r=new o(n),i=0,a=0,l=0===r.size;a<e.length&&!l;){for(var s=t[i],u=e[a];s!==u;)r.has(u)&&(t.splice(i,0,u),i++,r.delete(u),l=0===r.size),u=e[++a];r.has(s)&&r.delete(s),i<t.length&&i++}return t}}],[{key:"configurable",get:function(){return{applyChangesetFilterSortTarget:"changes"}}}])}(e||Mn),S(t,"$name","StoreChanges"),t},dd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateFilterParamName",value:function(e){this.remoteFilter=null!=e}},{key:"reapplyFilterOnAdd",get:function(){return this.storage.autoFilter},set:function(e){this.storage.autoFilter=e}},{key:"filters",get:function(){return this._filters||(this._filters=new us({extraKeys:["property"]}))},set:function(e){var t=this,n=t.filters;if(n.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(var r=0,i=Object.entries(e);r<i.length;r++){var a=i[r];"filterBy"===a[0]&&"function"==typeof a[1]?n.add(new Jl({filterBy:a[1]})):n.add(new Jl("Object"===a[1].constructor.name?Object.assign({property:a[0]},a[1]):{property:a[0],value:a[1]}))}else Array.isArray(e)?n.add.apply(n,z(e.map((function(e){return e instanceof Jl?e:new Jl(e)})))):e.isCollection?n.add.apply(n,z(e.values)):n.add(new Jl({filterBy:e}));n.forEach((function(e){return e.owner=t}))}}},{key:"filtersFunction",get:function(){var e=this,t=e.filters,n=e.isGrouped;if(!e._filtersFunction)if(t.count){var r=Jl.generateFiltersFunction(t);e._filtersFunction=function(e){return n&&e.isSpecialRow?e.groupChildren.some(r):!!e.isCreating||r(e)}}else e._filtersFunction=Tt.returnTrue;return e._filtersFunction},set:function(e){this._filtersFunction=e}},{key:"isFiltered",get:function(){return!!(this._filters||this.isConfiguring&&this.initialConfig.filters)&&this.filters.values.some((function(e){return!e.disabled}))}},{key:"isFilteredOut",value:function(e){return this.isFiltered&&!this.filtersFunction(e)}},{key:"traverseFilter",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:i,r=this,a=r.filtersFunction,o=!e.isRoot&&a(e),l=e.unfilteredChildren||e.children;return l&&l.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((function(e){return t?r.traverseFilter(e,t):a(e)||(null==n?void 0:n.has(e))})),r.isSorted&&e.children.sort(r.sorterFn),e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0),e.updateChildrenIndices(e.children,"parentIndex",!0),o||Boolean(e.children.length)):o}},{key:"traverseClearFilter",value:function(e){var t=this;e.unfilteredChildren&&(e.children=e.orderedChildren.slice(),e.unfilteredChildren=null),e.children&&(t.isSorted&&e.children.sort(t.sorterFn),e.children.forEach((function(e){return t.traverseClearFilter(e)})),e.updateChildrenIndices(e.children,"parentIndex",!0))}},{key:"latestFilterField",get:function(){return this.filters.last?this.filters.last.property:null}},{key:"addFilter",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this;if((e=e instanceof Jl?e:new Jl(e)).owner=n,n.filters.add(e),!t){if(n.remoteFilter)return n.filter().then((function(){return e}));n.filter()}return e}},{key:"filter",value:function(e){var t,n=this,r=!1;if(e){var i=W(e);if("object"===i&&("silent"in e||"replace"in e||e.filters)&&(r=e.silent,e.replace&&n.clearFilters(e.silent||0!==e.filters.length),t=e.internal,i=W(e=e.filters)),e){var a=n.isFiltered;if(n.isConfiguring=!0,Array.isArray(e))e.forEach((function(e){return n.addFilter(e,!0)}),n);else if("function"===i){var o=new Jl(e);o.internal=t,n.addFilter(o,!0)}else"string"===i?n.addFilter({property:e,value:arguments[1]},!0):n.addFilter(e,!0);if(n.isConfiguring=!1,!n.isFiltered&&!a)return null}}n.filtersFunction=null;var l=n.remoteFilter?n.performRemoteFilter(r):n.performFilter(r);return n._idMap=null,l}},{key:"suspendFilterOnUpdate",value:function(){this.filterBatching++}},{key:"resumeFilterOnUpdate",value:function(e){if(this.filterBatching--,this.filterBatching<0)throw new Error("No matching `startFilterBatching` call");0===this.filterBatching&&this.needsFiltering&&(this.needsFiltering=!1,this.performFilter(e))}},{key:"performFilter",value:function(e){var t=this;if(t.filterBatching>0)t.needsFiltering=!0;else{var n,r,i=t.storage,a=t.filters,o=t.rootNode,l=t.count;if(e||t.trigger("beforeFilter",{filters:a}),t.tree){var s=i.values;t.isFiltered?t.traverseFilter(o):t.traverseClearFilter(o);var u=t.collectDescendants(o).visible;i.replaceValues({values:u,silent:!0});var c=$e.delta(u,s,!0);n=c.toAdd,r=c.toRemove}else i.ion({change:function(e){var t=e.removed,i=e.added;r=t,n=i},once:!0}),t.isFiltered?(t.isGrouped&&t.includeCollapsed(),i.addFilter({id:"primary-filter",filterBy:t.filtersFunction}),t.isGrouped&&t.excludeCollapsed()):i.filters.clear();t.afterPerformFilter(e||t.isRemoteDataLoading?null:{action:"filter",filters:a,oldCount:l,added:n,removed:r,records:t.storage.values})}}},{key:"performRemoteFilter",value:(n=f(L().mark((function e(t){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=this).filters,a=r.count,e.next=3,null===(n=r.beforePerformFilter)||void 0===n?void 0:n.call(r,{filters:i,oldCount:a});case 3:if(e.t0=e.sent,!1!==e.t0){e.next=6;break}return e.abrupt("return");case 6:return r.currentPage=1,e.next=9,r.performDataRequest(t);case 9:if(e.t1=e.sent,!1!==e.t1){e.next=12;break}return e.abrupt("return");case 12:o=t?null:{action:"filter",filters:i,oldCount:a,records:r.storage.values},r.afterPerformFilter(o),r.trigger("refresh",o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildRemoteParams",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=arguments.length>1&&arguments[1]!==i&&arguments[1];null===(e=B(t,"buildRemoteParams",this,3))||void 0===e||e([n,r]);var a,o=this,l=o.filters;o.isFiltered&&(n[null!==(a=o.filterParamName)&&void 0!==a?a:"filters"]=r?o.encodeFilterParams(l):o.getFilterParams(l));return n}},{key:"afterPerformFilter",value:function(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}},{key:"getFilterParams",value:function(e){return e.values.filter((function(e){return!e.disabled})).map((function(e){return{field:e.property,operator:e.operator,value:e.value,caseSensitive:e.caseSensitive}}))}},{key:"triggerFilterEvent",value:function(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}},{key:"filterBy",value:function(e){return this.filter(e)}},{key:"removeFilter",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=this,a=e instanceof Jl?e:null!==(t=r.filters.get(e))&&void 0!==t?t:r.filters.getBy("property",e);if(a){var o;if(null===(o=r._filters)||void 0===o||o.remove(a),r._filtersFunction=null,!n){if(r.remoteFilter)return r.filter().then((function(){return a}));r.filter()}return a}}},{key:"clearFilters",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];if(this.filters.remove(this.filters.values.filter((function(e){return!e.internal}))),!e)return this.filter()}},{key:"convertFilterToString",value:function(e){var t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}},{key:"doDestroy",value:function(){var e;null===(e=this._filters)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}}],[{key:"defaultConfig",get:function(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}}]);var n}(e||Mn),S(t,"$name","StoreFilter"),S(t,"configurable",{remoteFilter:!1,filterParamName:null}),S(t,"properties",{filterBatching:0,needsFiltering:!1}),t},hd={add:1,replace:1},fd="!!novalue!!",vd=function(e,t){var n=e._groupValue,r=t._groupValue;return n<r?-1:n>r?1:0},gd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.ion({change:"onDataChanged",thisObj:this})}},{key:"GroupRow",get:function(){var e;return this._GroupRowClass||(this._GroupRowClass=(e=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isCollapsed",get:function(){return this.meta.collapsed}}])}(this.modelClass),S(e,"isSpecialRow",!0),S(e,"fields",[{name:"_groupValue"}]),e))}},{key:"updateGroupers",value:function(e){this.setGroupers(e)}},{key:"setGroupers",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:null,r=this,a=r.storage;return r._idMap=null,null!=e&&e.length?r._groupers=e.map((function(e){return r.createGrouper(e)})):r.groupers&&(delete r._groupers,r.includeCollapsed(),a.replaceValues({values:r.removeHeadersAndFooters(a._values),filteredValues:a.isFiltered?r.removeHeadersAndFooters(a._filteredValues):null,silent:!0}),t=r.group(null,null,null,!1,null==n?void 0:n.silent)),t}},{key:"createGrouper",value:function(e,t){if(!e||e.isGrouper)return e;"string"==typeof e&&(e=S({field:e},"boolean"==typeof t?"ascending":i,t));var n,r,a=e.field,o=null==a?void 0:a.indexOf("."),l=o>0,s=null==a?void 0:a.split("."),u=l?s[0]:a,c=l?(n=s)[(r=-1)<0?n.length+r:r]:a,d=l?a.slice(o+1):a;return F(F({isGrouper:!0},e),{},{complexMapping:l,rootFieldName:u,leafFieldName:c,fieldPath:d})}},{key:"unfilteredGroupRecords",get:function(){var e=this;if(e.isGrouped){var t,n=e.storage.generation;(null===(t=e._unfilteredGroupRecords)||void 0===t?void 0:t.generation)!==n&&(e._unfilteredGroupRecords=e.storage.allValues.filter((function(e){return e.isSpecialRow})),e._unfilteredGroupRecords.generation=n)}return e._unfilteredGroupRecords||[]}},{key:"getGroupHeaderForRecord",value:function(e){if(this.isGrouped)return e?"groupRowFor"in e.meta?e:e.instanceMeta(this).groupParent:this.groupRecords.last}},{key:"includeCollapsed",value:function(){var e,t=D(this.collapsedGroups);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.expand(this.getById(n),!1)}}catch(e){t.e(e)}finally{t.f()}}},{key:"excludeCollapsed",value:function(){var e,t=D(this.collapsedGroups);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.collapse(this.getById(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"onDataChange",value:function(e){var n,r=e.source,i=e.action;e.removed;var a=this,o=a.groupers;o&&(o.length?"splice"!==i&&"move"!==i||r.replaceValues(F(F({},a.prepareGroupRecords()),{},{silent:!0})):r.replaceValues({values:a.removeHeadersAndFooters(r._values),filteredValues:r.isFiltered?a.removeHeadersAndFooters(r._filteredValues):null,silent:!0})),null===(n=B(t,"onDataChange",this,3))||void 0===n||n(arguments)}},{key:"move",value:function(e,n){var r,a=this,o=this;if(o.isGrouped&&!o.tree){var l,s,u=n;if(null!==(l=n)&&void 0!==l&&l.isSpecialRow&&!(u=o.getPrev(n,!1,!1)))return;var c=o.getGroupHeaderForRecord(u),d=o.groupers[0].field,h=o.reapplyFilterOnUpdate,f="array"===o.modelClass.getFieldDefinition(d).type,v=c.meta.groupRowFor;if(o.reapplyFilterOnUpdate=!1,o.beginBatch(),e.forEach((function(e){if(f){var t=e.get(d)||[];if(t.includes(v))return;var n=e.instanceMeta(a).groupParent,o=c._groupValue;$e.remove(t,n),v=t.slice(),o===fd?v=i:Array.isArray(o)&&0===o.length?v=[]:v.push(o),r=!0}e.setValue(d,v)})),o.endBatch(),f&&!r)return;if(o.reapplyFilterOnUpdate=h,o.isFiltered&&null!==(s=n)&&void 0!==s&&s.isSpecialRow){var g=o.unfilteredGroupRecords,m=g.indexOf(c);n=g[m+1]}}B(t,"move",this,3)([e,n]),r&&o.group(o.groupers[0])}},{key:"collapse",value:function(e){var t=this,n=!1;return e&&(e=$e.asArray(e)).forEach((function(e){e&&!e.meta.collapsed&&(t.excludeGroupRecords(e),e.meta.collapsed=!0,t.collapsedGroups.add(e.id),t.trigger("toggleGroup",{groupRecord:e,collapse:!0}),n=!0)})),n}},{key:"expand",value:function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=!1;return e&&(e=$e.asArray(e)).forEach((function(e){null!=e&&e.meta.collapsed&&(t.includeGroupRecords(e),e.meta.collapsed=!1,n&&t.collapsedGroups.delete(e.id),n&&t.trigger("toggleGroup",{groupRecord:e,collapse:!1}),r=!0)})),r}},{key:"removeHeadersAndFooters",value:function(e){var t=this;return e.filter((function(e){return null!=e&&e.unfilteredGroupChildren&&(e.groupChildren.length=e.unfilteredGroupChildren.length=e.meta.childCount=0),!(null!=e&&e.isSpecialRow||null!=e&&e.isLinked&&e.instanceMeta(t).groupParent)||(t.unregister(e),!1)}))}},{key:"prepareGroupRecords",value:function(){var e,t=this,n=t.GroupRow,r=t.isFiltered,a=t.reapplyFilterOnUpdate,o=t.groupRecords,l=t.groupers[0],s=!1!==l.ascending?1:-1,u=l.field,c=l.fn,d=void 0===c?vd:c,h=l.leafFieldName,f="function"==typeof u,v=u===t.modelClass.idField,g=new us,m=t._groupVisibleRecordIds||[],p=function(e){var n=!r||t.filtersFunction(e);return a?n:n||m.includes(e.id)},y=Boolean(t.startGroupsCollapsed&&!(null!=o&&o.count));null==o||o.forEach((function(e){e.isCollapsed&&t.includeGroupRecords(e)}));var k=t.removeHeadersAndFooters(t.storage._values);if(t.sorters.length&&k.sort(t.sorterFn),r&&(t.filtersFunction=null),k.forEach((function(e){for(var r=e,a=f?u(e):e.getValue(u),l=$e.asArray(a==i?fd:a),s=Array.isArray(l)&&!l.length,c=s?1:l.length,d=0;d<c;d++){var m=s?[]:l[d],k="group-header-".concat("number"==typeof m?m:Le.createId(m)),b=g.get(k);if(b||(b=(null==o?void 0:o.get(k))||new n(S(S(S({},t.modelClass.idField,k),v?"":h,m),"_groupValue",m),t,{collapsed:y,specialRow:!0,groupRowFor:m,groupField:h,emptyArray:s}),g.add(b),b.meta.childCount=0,b.groupChildren=[],b.unfilteredGroupChildren=[],b.stores=[t]),t.register(b),d>0){var C=r.groupLinks||(r.groupLinks={});(e=C[m]||(C[m]=r.link())).stores=[t],t.register(e)}e.instanceMeta(t).groupParent=b,p(e)&&(b.groupChildren.push(e),b.meta.childCount++),b.unfilteredGroupChildren.push(e)}})),g._values.sort((function(e,t){return d(e,t)*s})),t.useGroupFooters)for(var b=0,C=g.count;b<C;b++){var w=g.values[b],D=w.meta.groupRowFor,x="group-footer-".concat("number"==typeof D?D:Le.createId(D)),E=t.getById(x)||new n(S(S(S({},t.modelClass.idField,x),v?"":h,D),"_groupValue",D),t,{specialRow:!0,groupFooterFor:D,groupRecord:w});E.stores=[t],t.register(E),E.groupChildren=w.groupChildren,g.splice(++b,0,E),C++,w.groupChildren.push(E),w.unfilteredGroupChildren.push(E),w.meta.childCount++}t._idMap=null;var R={values:g.reduce((function(e,t){return t.isGroupFooter||(e.push(t),t.meta.collapsed||e.push.apply(e,z(t.unfilteredGroupChildren))),e}),!1,[])};return r&&(R.filteredValues=R.values.filter(p)),null===(e=t.groupRecords)||void 0===e||e.forEach((function(e){g.includes(e)||e.destroy()})),t.groupRecords=g,R}},{key:"isGrouped",get:function(){var e;return Boolean(null===(e=this.groupers)||void 0===e?void 0:e.length)}},{key:"group",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=!(arguments.length>3&&arguments[3]!==i)||arguments[3],o=arguments.length>4&&arguments[4]!==i&&arguments[4],l=this,s=l.sorters,u=void 0===s?[]:s,c=l.createGrouper(e,t),d=!1;if(r)l.groupers.push(c);else if(e){var h,f;if(null==t&&!("ascending"in c))c.ascending=!c.fn||(null===(h=l.groupInfo)||void 0===h?void 0:h.field)!==c.field||(null===(f=l.groupInfo)||void 0===f?void 0:f.fn)!==c.fn||!l.groupInfo.ascending;l.groupInfo=n=c,l.groupers=[l.groupInfo],u.some((function(t){return t.field===e}))&&(l.sorters=u.filter((function(t){return t.field!==e})),d=!0)}else null===e&&null===t?(a=!0,d=!0):!d&&u.length&&a&&(d=!0);if(n){var v=l.modelClass.prototype;n.complexMapping&&!Object.prototype.hasOwnProperty.call(v,e)&&Object.defineProperty(v,e,{get:function(){return Be.getPath(this,e)}})}if(!1!==a){if(l.remoteSort&&!l.isRemoteDataLoading)return l.sort(null,null,!1,!d).then((function(){return l.onAfterGrouping(o,!d)}));l.sort(null,null,!1,!d)}l.onAfterGrouping(o,!d)}},{key:"onAfterGrouping",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];if(!e){var n=this,r=n.groupers||[];n.trigger("group",{isGrouped:n.isGrouped,groupers:r,records:n.storage.values}),t&&n.trigger("refresh",{action:"group",isGrouped:n.isGrouped,groupers:r,records:n.storage.values})}}},{key:"addGrouper",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return this.group(e,t,!0)}},{key:"removeGrouper",value:function(e){var t=this,n=t.groupers;if(n){var r=n.findIndex((function(t){return t.field===e}));return r>-1?(n.splice(r,1),n.length?t.group():t.clearGroupers()):void 0}}},{key:"clearGroupers",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];return this.setGroupers(null,{silent:e})}},{key:"isRecordInGroup",value:function(e,t){var n;if(!this.isGrouped)return!1;var r=null===(n=this.groupers[0])||void 0===n?void 0:n.field;return e.getValue(r)===t&&!e.isSpecialRow}},{key:"isInCollapsedGroup",value:function(e){var t=e.instanceMeta(this).groupParent;return null==t?void 0:t.meta.collapsed}},{key:"getGroupRecords",value:function(e){var t=this;return this.isGrouped?this.storage.values.filter((function(n){return t.isRecordInGroup(n,e)})):null}},{key:"getGroupTitles",value:function(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}},{key:"groupHeaderRecords",get:function(){return this.useGroupFooters?this.groupRecords.values.filter((function(e){return e.isGroupHeader})):this.groupRecords.values}},{key:"onDataChanged",value:function(e){var t=e.changes,n=e.action;this.isGrouped&&(!t&&hd[n]||t&&this.groupers.some((function(e){return e.rootFieldName in t})))&&this.sort()}},{key:"internalIncludeExcludeGroupRecords",value:function(e,t){var n=this,r=n.indexOf(e),i=n.allIndexOf(e),a=n.id,o=n.storage,l=o._filteredValues,s=o._values,u=e.meta,c=e.groupChildren,d=e.unfilteredGroupChildren;if(!(-1===i||u.collapsed&&!t||!u.collapsed&&t)){var h;if(d.forEach((function(e){return e.instanceMeta(a).hiddenByCollapse=!t})),t)l&&l.splice.apply(l,[r+1,0].concat(z(c.filter((function(e){return!n.isAvailable(e.id)}))))),(h=o._values).splice.apply(h,[i+1,0].concat(z(d.filter((function(e){return!n.isAvailable(e.id)})))));else l&&l.splice(r+1,c.length),s.splice(i+1,d.length);o._indicesInvalid=!0,n._idMap=null}}},{key:"excludeGroupRecords",value:function(e){this.internalIncludeExcludeGroupRecords(e,!1)}},{key:"includeGroupRecords",value:function(e){this.internalIncludeExcludeGroupRecords(e,!0)}},{key:"collectGroupRecords",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return(e?this.storage.allValues:this.storage.values).reduce((function(n,r){return r.isSpecialRow&&(t&&!r.isGroupFooter&&n.push(r),r.isGroupHeader&&n.push.apply(n,e?r.unfilteredGroupChildren:r.groupChildren)),n}),[])}}],[{key:"properties",get:function(){return{collapsedGroups:new o}}}])}(e||Mn),S(t,"$name","StoreGroup"),S(t,"configurable",{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}),t},md=Promise.resolve(),pd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"currentPage",get:function(){var e;return null!==(e=this._currentPage)&&void 0!==e?e:1},set:function(e){this.totalCount&&(e=Math.min(e,this.lastPage)),this._currentPage=e}},{key:"updatePageParamName",value:function(e){if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this.remotePaging=null!=e}},{key:"updatePageStartParamName",value:function(e){if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this.remotePaging=null!=e}},{key:"defaultPageParamName",get:function(){var e,t;return null!==(e=null!==(t=this.pageParamName)&&void 0!==t?t:this.pageStartParamName)&&void 0!==e?e:"page"}},{key:"updateRemotePaging",value:function(e){if(e&&this.tree)throw new Error("Paging cannot be supported for tree stores")}},{key:"updatePageSize",value:function(e){var t=this;!t.isConfiguring&&e&&(t.currentPage=t.currentPage?Math.min(t.currentPage,Math.floor((t.totalCount+e-1)/e)):1,t.loadPage(t.currentPage))}},{key:"isPaged",get:function(){return this.remotePaging}},{key:"pagedTotal",set:function(e){this.remoteTotal=e}},{key:"lastPage",get:function(){if(this.isPaged)return Math.floor((this.totalCount+this.pageSize-1)/this.pageSize)}},{key:"loadPage",value:(a=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:{};return L().mark((function r(){var i;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.getPagingParams(F(F({},n),{},{page:e})),r.next=3,t.trigger("beforeLoadPage",{params:n});case 3:if(r.t0=r.sent,!1!==r.t0){r.next=6;break}return r.abrupt("return",!1);case 6:return r.next=8,t.performDataRequest(!1,n,(function(){t.currentPage=e}));case 8:if(r.t1=r.sent,!1===r.t1){r.next=11;break}null===(i=t.trigger)||void 0===i||i.call(t,"loadPage",n);case 11:case"end":return r.stop()}}),r)}))()})),function(e){return a.apply(this,arguments)})},{key:"nextPage",value:(r=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.abrupt("return",n.isPaged&&n.currentPage!==n.lastPage?n.loadPage(n.currentPage+1,t):md);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"previousPage",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,t):md);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildRemoteParams",value:function(){var e,n,r=arguments.length>0&&arguments[0]!==i?arguments[0]:{},a=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.getPagingParams(null!==(e=null===(n=B(t,"buildRemoteParams",this,3))||void 0===n?void 0:n([r,a]))&&void 0!==e?e:r)}},{key:"getPagingParams",value:function(e){var t=this;if(t.isPaged){var n,r=null!==(n=e[t.defaultPageParamName])&&void 0!==n?n:t.currentPage;this.pageStartParamName&&(r=Math.max(0,r-1)*this.pageSize),e[t.defaultPageParamName]=r,e[t.pageSizeParamName]=t.pageSize}return e}}]);var n,r,a}(e||Mn),S(t,"$name","StorePaging"),S(t,"configurable",{pageSize:50,pageSizeParamName:"pageSize",pageParamName:null,pageStartParamName:null,remotePaging:!1}),t},yd=function(e){return function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"initProxy",value:function(){if(!r.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get:function(e,t){if(t in e)return e[t];if("$store"===t)return e;var n=e.getById(t);return n||isNaN(parseInt(t))||(n=e.getAt(parseInt(t))),n},set:function(e,t,n){return t in e||e.isDestroying||t.startsWith("_")?e[t]=n:e.add(F(S({},e.modelClass.idField,t),n)),!0},deleteProperty:function(e,t){return e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length)},has:function(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){var n=Le.safeJsonParse(t);t=null==n?void 0:n.id}return e.includes(t)}})}}],[{key:"configurable",get:function(){return{objectify:null}}}])}(e||Mn)},kd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"initRelations",value:function(e){var t=this,n=t.modelClass.exposedRelations;e&&t.modelRelations&&t.modelRelations.forEach((function(e){var t;return null===(t=e.storeDetacher)||void 0===t?void 0:t.call(e)})),t.modelRelations&&0!==t.modelRelations.length&&!e||t.isChained||(t.modelRelations=[],null==n||n.forEach((function(n){var r=F({},n),i=r.foreignStore,a=r.relationName,o=r.relatedCollectionName,l="string"==typeof i?t[i]:i;if(r.dependentStore=t,t.modelRelations.push(r),l){r.foreignStoreProperty=r.foreignStore,r.foreignStore=l;var s=l.dependentStoreConfigs;if(s.has(t)){var u=s.get(t);if(e){var c=u.find((function(e){return e.relationName===a}));c&&$e.remove(u,c)}u.push(r)}else s.set(t,[r]);o&&l.initRelationCollection(r,t),l.count>0&&l.updateDependentStores("dataset",l.records)}})))}},{key:"initRelationCollection",value:function(e,t){var n=this,r=e.relatedCollectionName;(n.collectionStores||(n.collectionStores={}))[r]={store:t,config:e},n[r+"Store"]||(n[r+"Store"]=t),n.allRecords.length&&n.initModelRelationCollection(r,n.allRecords)}},{key:"initModelRelationCollection",value:function(e,t){var n=this;t.forEach((function(t){t.traverse((function(t){var r=e in t?"$related".concat(Le.capitalize(e)):e;Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,e)},set:function(t){return n.setCollection(this,e,t)}})}))}))}},{key:"resetRelationCache",value:function(){this.relationCache={},this.forEach((function(e){return e.initRelations()}))}},{key:"updateRecordRelationCache",value:function(e,t){var n=this;null==t||t.forEach((function(t){var r=t.config,a=t.related?t.related.id:e.getValue(r.foreignKey);a!==i&&n.cacheRelatedRecord(e,a,r.relationName,a)}))}},{key:"getRelationCollection",value:function(e,t){var n,r=od.asId(t);return(null===(n=this.relationCache[e])||void 0===n?void 0:n[r])||[]}},{key:"getCollection",value:function(e,t){var n,r=this.collectionStores[t],i=r.config;return(null===(n=r.store.relationCache[i.relationName])||void 0===n?void 0:n[e.id])||[]}},{key:"setCollection",value:function(e,t,n){var r=this.collectionStores[t],i=r.config,a=r.store,o=((a.relationCache[i.relationName]||(a.relationCache[i.relationName]={}))[e.id]||[]).slice(),l=[],s=[];a.suspendEvents(),o.forEach((function(e){n.includes(e)||(e[i.foreignKey]=null,a.remove(e),s.push(e))})),n.forEach((function(t){t.isModel instanceof od?t.stores.includes(a)||(a.add(t),l.push(t)):(t=_(a.add(t),1)[0],l.push(t));t[i.foreignKey]=e.id})),a.resumeEvents(),s.length&&(a.trigger("remove",{records:s}),a.trigger("change",{action:"remove",records:s})),l.length&&(a.trigger("add",{records:l}),a.trigger("change",{action:"add",records:l}))}},{key:"cacheRelatedRecord",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:null,a=this,o=a.relationCache[n]||(a.relationCache[n]={});null!==r&&a.uncacheRelatedRecord(e,n,r),null!=t&&$e.include(o[t]||(o[t]=[]),e)}},{key:"uncacheRelatedRecord",value:function(e){var t=arguments.length>2&&arguments[2]!==i?arguments[2]:null,n=this;function r(t,r){var i=n.relationCache[t],a=null==i?void 0:i[r];if(a){var o=a.indexOf(e);o>=0&&a.splice(o,1),0===a.length&&delete i[r]}}null!=t?r(arguments.length>1&&arguments[1]!==i?arguments[1]:null,t):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((function(e){var t=_(e,2),n=t[0],i=t[1];return r(n,null==i?void 0:i.id)}))}},{key:"updateDependentStores",value:function(e,t,n){var r,i,a=this,o="dataset"===e;(a.dependentStoreConfigs.forEach((function(r){r.forEach((function(r){var i=r.dependentStore,l=r.relatedCollectionName,s=r.relationName,u=r.foreignKey,c=r.propagateRecordChanges,d=i.relationCache[s];if(o)l&&a.initModelRelationCollection(l,t),i.forEach((function(e){var t=e.initRelation(r);t&&i.cacheRelatedRecord(e,t.id,s,t.id)})),c&&i.totalCount&&i.trigger("refresh",{action:"relatedstoredataset",records:i.records});else{if("removeall"===e)return i.forEach((function(e){return e.removeRelation(r)})),void delete i.relationCache[s];"replace"===e&&(t=t.map((function(e){return e[1]})))}"add"!==e&&"replace"!==e||l&&a.initModelRelationCollection(l,t),o||t.forEach((function(t){var o=null==d?void 0:d[t.id];switch(e){case"remove":o&&o.forEach((function(e){return e.removeRelation(r)}));break;case"add":case"replace":i.forEach((function(e){e.getValue(u)==t.id&&(e.initRelation(r),i.cacheRelatedRecord(e,t.id,s))}))}!n&&null!=o&&o.length&&c&&o.forEach((function(e){return e.stores.forEach((function(n){return a.notifyRelatedStore(n,e,r.relationName,t)}))}))}))}))})),null!==(r=t)&&void 0!==r&&r.length)&&(null===(i=a.modelRelations)||void 0===i||i.forEach((function(e){e.propagateRecordChanges&&(o?e.foreignStore.totalCount&&e.foreignStore.trigger("refresh",{action:"relatedstoredataset",records:e.foreignStore.records}):t.forEach((function(t){var n,r=t[e.relationName];null==r||null===(n=r.stores)||void 0===n||n.forEach((function(n){a.notifyRelatedStore(n,r,e.relatedCollectionName,t)}))})))})))}},{key:"notifyRelatedStore",value:function(e,t,n,r){var i,a=r.meta;if(!this.isChained&&!e.isChained){var l=a._ignoreRelationUpdate,s=!1;null!==(i=l)&&void 0!==i&&i.size||(a._ignoreRelationUpdate=l=new o,s=!0),l.has(e)||(l.add(this).add(e),t.meta._ignoreRelationUpdate=l,e.onModelChange(t,S({},n,t[n]),S({},n,t[n]),!1,!0),s&&l.clear())}}},{key:"updateDependentRecordIds",value:function(e,t){var n;null===(n=this.dependentStoreConfigs)||void 0===n||n.forEach((function(n){n.forEach((function(n){var r,i=n.dependentStore,a=n.relationName,o=n.foreignKey,l=i.relationCache[a],s=null==l||null===(r=l[e])||void 0===r?void 0:r.slice();null==s||s.forEach((function(n){i.cacheRelatedRecord(n,t,a,e),n.meta._ignoreRelatedIdUpdate=!0,n.set(o,t,!1,!0),delete n.meta._ignoreRelatedIdUpdate}))}))}))}}])}(e||Mn),S(t,"$name","StoreRelation"),t},bd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"sum",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.storage.values;return t?t.reduce((function(t,n){if(n.isSpecialRow)return t;var r=Number(n.getValue(e));return isNaN(r)?t:t+r}),0):0}},{key:"min",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.storage.values;return null!=t&&t.length?t.reduce((function(t,n){var r=n.getValue(e);return"number"===W(null==r?void 0:r.valueOf())&&(r<t||null==t)&&(t=r),t}),t[0].getValue(e)):0}},{key:"max",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.storage.values;return null!=t&&t.length?t.reduce((function(t,n){var r=n.getValue(e);return"number"===W(null==r?void 0:r.valueOf())&&(r>t||null==t)&&(t=r),t}),t[0].getValue(e)):0}},{key:"average",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.storage.values;if(null==t||!t.length)return 0;var n=0,r=t.reduce((function(t,r){if(r.isSpecialRow)return t;var i=parseFloat(r.getValue(e));return isNaN(i)?t:(n++,t+i)}),0);return n>0?r/n:0}},{key:"groupSum",value:function(e,t){return this.sum(t,this.getGroupRecords(e))}}])}(e||Mn),S(t,"$name","StoreSum"),t},Cd=function(e,t){return String(e).toLowerCase().includes(t)},wd={string:Cd,number:function(e,t){return e===Number(t)},boolean:Cd,date:function(e,t){return e instanceof Date&&t instanceof Date?e-t==0:String(e.getMonth()+1).includes(t)||String(e.getDate()).includes(t)||String(e.getFullYear()).includes(t)},object:function(e,t){return e===t},undefined:function(e,t){return e===t}},Dd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"search",value:function(e){var t,n,r,a,o,l=arguments.length>1&&arguments[1]!==i?arguments[1]:null,s=arguments.length>2?arguments[2]:i,u=arguments.length>3?arguments[3]:i,c=this.isTree&&!u?this.rootNode.allChildren:this.getAllDataRecords(u),d=c.length,h=[];if(null==e)return[];for("string"==typeof e&&(e=e.toLowerCase()),l||(l=this.modelClass.allFields.map((function(e){return e.name}))),t=0;t<d;t++){r=c[t],n=0;var f,v=D(l);try{for(v.s();!(f=v.n()).done;){var g,m=f.value;o=(a=r.getValue(m))instanceof Date?"date":W(a);var p=null==s?void 0:s[n];p&&(a=p(a),o="string"),a&&null!==(g=wd[o])&&void 0!==g&&g(a,e)&&h.push({index:t,data:r,field:m,id:r.id}),n++}}catch(e){v.e(e)}finally{v.f()}}return h}},{key:"findByField",value:function(e,t){var n,r,a,l=arguments.length>2&&arguments[2]!==i&&arguments[2],s=arguments.length>3&&arguments[3]!==i&&arguments[3],u=this.getAllDataRecords(s),c=u.length,d=new o,h=[];for(null!=t&&(t=String(t).toLowerCase()),n=0;n<c;n++)if(a=(r=u[n]).getValue(e),!l||!d.has(a)){var f=a instanceof Date?"date":W(a);(null==t&&a===t||""===t&&""===a||t&&(0,wd[f])(a,t))&&(h.push({id:r.id,index:n,data:r}),l&&d.add(a))}return h}},{key:"find",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.getAllDataRecords(t).find(e)}},{key:"findRecord",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=function(n){return Be.isEqual(n[e],t)};return this.isTree?this.query(r,n)[0]:this.getAllDataRecords(n).find(r)}},{key:"query",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.getAllDataRecords(t).filter(e)}},{key:"some",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.getAllDataRecords(t).some(e)}}])}(e||Mn),S(t,"$name","StoreSearch"),t},Sd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isSorted",get:function(){return Boolean(this.sorters.length)||this.isGrouped}},{key:"changeSorters",value:function(e){var t=this;return e.map((function(e){return t.normalizeSorterConfig(e,!0)}))}},{key:"updateSortParamName",value:function(e){this.remoteSort=null!=e}},{key:"sort",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=arguments.length>3&&arguments[3]!==i&&arguments[3],o=this,l=o.allRecords,s=o.sorters?o.sorters.slice():[],u=null;if(e)if(Array.isArray(e))o.sorters=e.map((function(e){return o.normalizeSorterConfig(e,"string"==typeof e||t)}));else{var c=o.normalizeSorterConfig(e,t);r?(n=o.getCurrentSorterByField(c.field))?(u=n.ascending,n.ascending=c.ascending):o.sorters.push(c):o.sorters=[c]}return a||!1!==o.trigger("beforeSort",{sorters:o.sorters,records:l,currentSorters:s})?o.remoteSort?o.performRemoteSort(a):o.performSort(a):(o.sorters=s,null!==u&&(n.ascending=u),null)}},{key:"normalizeSorterConfig",value:function(e,t){var n,r={ascending:t};"object"===W(e)?(Be.assign(r,e),e.fn&&(delete r.fn,r.sortFn=e.fn),r.ascending=null!==(n=e.ascending)&&void 0!==n?n:t):"function"==typeof e?r.sortFn=e:r.field=e;if(null==r.ascending){var i=this.getCurrentSorterByField(r.field);r.ascending=!i||!i.ascending}if(null==r.sortFn){var a,o=null===(a=this.modelClass)||void 0===a||null===(a=a.$meta.fields.map[r.field])||void 0===a?void 0:a.compareItems;o&&(r.sortFn=o)}return r}},{key:"getCurrentSorterByField",value:function(e){return"string"==typeof e&&this.sorters.find((function(t){return t.field===e}))||null}},{key:"addSorter",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return this.sort(e,t,!0)}},{key:"removeSorter",value:function(e){var t=this.sorters.findIndex((function(t){return t.field===e||t.sortFn===e}));if(t>-1)return this.sorters.splice(t,1),this.sort()}},{key:"clearSorters",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];if(this.sorters.length)return this.sorters.length=0,this.sort(i,i,i,e)}},{key:"suspendSortOnUpdate",value:function(){"_reapplySortersSuspended"in this||(this._reapplySortersSuspended=0),this._reapplySortersSuspended++}},{key:"resumeSortOnUpdate",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this;t._reapplySortersSuspended&&(t._reapplySortersSuspended--,!t._reapplySortersSuspended&&t._shouldReapplySorters&&(e&&t.sort(),t._shouldReapplySorters=!1))}},{key:"createSorterFn",value:function(e){var t=this.useLocaleSort;return function(n,r){for(var i=0;i<e.length;i++){var a=e[i],o=a.field,l=a.ascending,s=void 0===l||l,u=a.useLocaleSort,c=void 0===u?t:u,d=a.caseSensitive,h=void 0===d||d,f=a.fn||a.sortFn,v=s?1:-1;if(f){var g=f.call(a,n,r);if(0===g)continue;if(null!==g)return g*v}var m=n.isModel?n.getValue(o):n[o],p=r.isModel?r.getValue(o):r[o];if(h||("string"==typeof m&&(m=m.toLowerCase()),"string"==typeof p&&(p=p.toLowerCase())),m!==p){if(null==m)return-v;if(null==p)return v;if(c&&"string"==typeof m){if(!0===c)return String(m).localeCompare(p)*v;if("string"==typeof c)return String(m).localeCompare(p,c)*v;if("object"===W(c))return String(m).localeCompare(p,c.locale,c)*v}if(m>p)return v;if(m<p)return-v}}return 0}}},{key:"sorterFn",get:function(){return this.createSorterFn(this.remoteSort?[{field:"_remoteSortIndex"}]:this.sorters)}},{key:"performSort",value:function(e){var t=this,n=t.rootNode,r=t.storage,i=t.sorterFn;t.tree?(!t.isChained&&n.traverse((function(e){e.isLoaded&&e.isParent&&(e.children.sort(i),e.updateChildrenIndices(e.children,"parentIndex",!0))})),r.replaceValues({values:t.collectDescendants(n).visible,silent:!0})):t.isGrouped?r.replaceValues(F(F({},t.prepareGroupRecords()),{},{silent:!0})):r.replaceValues({values:r.values.sort(i),silent:!0}),t.afterPerformSort(e||t.isRemoteDataLoading)}},{key:"performRemoteSort",value:(n=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.beforePerformSort)||void 0===n?void 0:n.call(this);case 2:if(e.t1=e.sent,e.t0=!1!==e.t1,!e.t0){e.next=9;break}return e.next=7,this.performDataRequest(t);case 7:e.t2=e.sent,e.t0=!1!==e.t2;case 9:if(!e.t0){e.next=11;break}this.afterPerformSort(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildRemoteParams",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=this.sorters,o=this.groupers,l=this.sortParamName,s=void 0===l?"sorters":l;return null===(e=B(t,"buildRemoteParams",this,3))||void 0===e||e([n,r]),o&&(a=o.concat(a)),a.length&&(n[s]=r?this.encodeSorterParams(a):this.getSorterParams(a)),n}},{key:"getSorterParams",value:function(e){return e.filter((function(e){return!e.sortFn})).map((function(e){return{field:e.field,ascending:e.ascending}}))}},{key:"afterPerformSort",value:function(e){if(!e){var t=this;t._idMap=null;var n={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",n),t.trigger("refresh",n)}}}],[{key:"defaultConfig",get:function(){return{useLocaleSort:null}}}]);var n}(e||Mn),S(t,"$name","StoreSort"),S(t,"configurable",{sorters:[],reapplySortersOnAdd:!1,reapplySortersOnUpdate:!1,remoteSort:!1,sortParamName:null}),t},xd=function(){return!0},Ed=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]);var n=this,r=n.masterStore;r&&(n.methodNamesToRelay.forEach((function(e){return n[e]=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n.relayToMaster(e,r)}})),n.removeAll=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];r.remove.apply(r,[n.getRange()].concat(t))},r.ion({name:"masterStoreListeners",changePreCommit:n.onMasterDataChangedPreCommit,change:n.onMasterDataChanged,prio:1,thisObj:n}),n.syncSort&&r.ion({sort:function(){return n.sort(r.sorters)},thisObj:n}),r.chainedStores||(r.chainedStores=[]),r.chainedStores.push(n),n.fillFromMaster())}},{key:"$master",get:function(){return this.masterStore||this}},{key:"isChained",get:function(){return Boolean(this.masterStore)}},{key:"chainedFilterFn",get:function(){return this._chainedFilterFn||xd},set:function(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}},{key:"methodNamesToRelay",get:function(){var e=this,t=Array.isArray(this.doRelayToMaster),n=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter((function(t){return!n||!e.dontRelayToMaster.includes(t)}))||[]}},{key:"updateChainedStores",value:function(){var e;null===(e=this.chainedStores)||void 0===e||e.forEach((function(e){return e.fillFromMaster()}))}},{key:"fillFromMaster",value:function(){var e=this,t=e.masterStore,n=e.isTree,r=t.isFiltered;if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(!e.isChainSuspended){var i,a=null;if(e.chainFilters&&r){var o=t.filters.values.filter((function(e){return!e.ignoreForChain}));o.length&&(a=Jl.generateFiltersFunction(o))}if(e.isChainedTree)return e.fillTreeFromMaster(a);if(i=t.allRecords.filter((function(n){if(!n.isSpecialRow&&(!e.ignoreLinkRecords||!n.isLinked)&&e.chainedFilterFn(n)&&(!a||a(n)))return!(e.excludeCollapsedRecords&&!n.ancestorsExpanded(t))})),e.masterStore.sorterFn&&r&&t.isSorted&&!t.remoteSort&&i.sort(t.sorterFn),n)if(e.idRegister={},e.internalIdRegister={},i.forEach((function(t){t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords){var l=e.getChildren(e.rootNode);i=e.doIncludeExclude(l,!0)}else i.forEach((function(t){return t.instanceMeta(e).collapsed=!1}));e.isFillingFromMaster=!0,e.data=i,e.isFillingFromMaster=!1}}},{key:"fillTreeFromMaster",value:function(e){var t=this,n=t.chainedFilterFn,r=t.masterStore.rootNode,i=[],a=t.treeLinkMap||{},o=t.idRegister={},l=t.internalIdRegister={};t.treeLinkMap={},ld.postWalk({children:r.unfilteredChildren||r.children},(function(e){return!e.isLeaf&&(e.unfilteredChildren||e.children)}),(function(r){var s;if(r.isLeaf&&(!e||e(r))&&n(r)||!r.isLeaf&&null!==(s=r.meta)&&void 0!==s&&null!==(s=s.tempChildren)&&void 0!==s&&s.length){var u,c=null===(u=r.parent)||void 0===u?void 0:u.meta,d=a[r.id],h=r.isLeaf&&d,f=h||r.link(),v=f.proxyMeta.data;t.treeLinkMap[r.id]=f,h?(v.parent=v.parentIndex=v.unfilteredIndex=v.parentId=v.children=v.orderedChildren=v.unfilteredChildren=null,o[f.id]=r,l[f.internalId]=r):d&&f.removeLink(f),c.tempChildren||(c.tempChildren=[]),c.tempChildren.push(f),r.isParent&&i.unshift(f)}})),t.isFillingFromMaster=!0;for(var s=i.length-1;s>=0;s--){var u=i[s],c=u.$original.meta;c.tempChildren&&(u.meta.isFillingFromMaster=!0,u.appendChild(c.tempChildren,!0),u.meta.isFillingFromMaster=!1,c.tempChildren=null)}t.data=r.meta.tempChildren||[],t.isFillingFromMaster=!1,r.meta.tempChildren=null}},{key:"commitToMaster",value:function(){var e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}},{key:"relayToMaster",value:function(e,t){var n;return(n=this.masterStore)[e].apply(n,z(t))}},{key:"onMasterDataChangedPreCommit",value:function(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}},{key:"onMasterDataChanged",value:function(e){var t,n=e.action,r=e.changes,i=e.isMove,a=this;a.$masterEventhandled?a.$masterEventhandled=!1:i&&"remove"===n||("update"!==n||"*"===a.chainedFields||null!==(t=a.chainedFields)&&void 0!==t&&t.some((function(e){return e in r}))||"isLeaf"in r||"parentId"in r)&&a.fillFromMaster()}},{key:"makeChained",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:xd,t=arguments.length>1?arguments[1]:i,n=arguments.length>2?arguments[2]:i;return Ne.deprecate("core","7.0.0","makeChained() deprecated in favor of chain() and chainTree()"),this.chain(e,t,n)}},{key:"chain",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:xd,n=arguments.length>1?arguments[1]:i,r=arguments.length>2?arguments[2]:i;if(this.isChained){var a=t;t=function(t){return a(t)&&e.chainedFilterFn(t)}}return new((null==r?void 0:r.storeClass)||this.constructor)(F(F({id:"".concat(this.id,"-chained-").concat(Le.generateUUID()),tree:!1,autoTree:!1},r||{}),{},{masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:n}))}},{key:"chainTree",value:function(e,t,n){if(!this.tree)throw new Error("chainTree only allowed on tree stores");return this.chain(e,t,F({tree:!0,isChainedTree:!0},n))}},{key:"doDestroy",value:function(){var e;this.detachListeners("masterStoreListeners"),null===(e=this.chainedStores)||void 0===e||e.forEach((function(e){return e.destroy()})),B(t,"doDestroy",this,3)([])}},{key:"suspendChain",value:function(){this.chainSuspended++}},{key:"resumeChain",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];this.chainSuspended&&! --this.chainSuspended&&e&&this.fillFromMaster()}},{key:"isChainSuspended",get:function(){return this.chainSuspended>0}}],[{key:"defaultConfig",get:function(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,syncSort:!0,ignoreLinkRecords:!1,chainFilters:null,chainSuspended:0}}},{key:"properties",get:function(){return{chainedStores:null,isChainedTree:null}}}])}(e||Mn),S(t,"$name","StoreChained"),t},Rd=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getState",value:function(){var e=this.sorters,t=this.groupers,n=this.filters,r={};return null!=e&&e.length&&(r.sorters=e.map((function(e){var t=Be.cleanupProperties(Be.clone(e));return delete t.fn,delete t.sortFn,t}))),null!=t&&t.length&&(r.groupers=t.map((function(e){var t=Be.cleanupProperties(Be.clone(e));return delete t.fn,t})),r.collapsedGroups=z(this.collapsedGroups)),null!=n&&n.values.length&&(r.filters=n.allValues.map((function(e){return e.getState()}))),r}},{key:"applyState",value:function(e){var t,n=this,r=e.sorters,i=void 0===r?[]:r,a=e.groupers,o=void 0===a?[]:a,l=e.filters,s=void 0===l?[]:l,u=n.sortParamName,c=n.filterParamName;(n.isSorted||0!==i.length||0!==o.length)&&(n.sorters=i.filter((function(e){return e.field||e.sortFn&&!u})),n.groupers=o.slice(),o.length?n.group():n.sort()),null===(t=e.collapsedGroups)||void 0===t||t.forEach((function(e){var t=n.getById(e);t&&n.collapse(t,!0)})),(n.isFiltered||0!==s.length)&&(n.filters=s.filter((function(e){return e.property||e.filterBy&&!c})),n.filter())}}])}(e||Mn),S(t,"$name","StoreState"),t},Td=function(e){return String(e).padStart(6,"0")},Md=function(){function e(t){m(this,e),this.value=t,this._padded=null}return w(e,[{key:"value",get:function(){return this._value},set:function(e){this._value=String(null!=e?e:"")}},{key:"append",value:function(t){var n=this.value;return e.from(n?"".concat(n,".").concat(t):t)}},{key:"isEqual",value:function(t){return!e.compare(this,t)}},{key:"match",value:function(e){var t=!1;if(e){var n=this.value,r="*"===e[0],i=e.endsWith("*"),a=e.length;t=r===i?n.indexOf(r?e.substr(1,a-2):e)>-1:r?n.endsWith(e.substr(1)):n.startsWith(e.substr(0,a-1))}return t}},{key:"toString",value:function(){return this.value}},{key:"toJSON",value:function(){return this.toString()}},{key:"valueOf",value:function(){var t;return null!==(t=this._padded)&&void 0!==t?t:this._padded=e.pad(this.value)}}],[{key:"from",value:function(t){return null==t||t instanceof e?t:new e(t)}},{key:"pad",value:function(t){return t instanceof e?t.valueOf():e.split(t).map(Td).join(".")}},{key:"split",value:function(e){var t,n;if(e||0===e)switch(W(e)){case"object":e=String(e);case"string":for(t=(n=e.split(".")).length;t-- >0;)n[t]=parseInt(n[t],10);break;case"number":n=[e]}return n||[]}},{key:"compare",value:function(t,n){return t===n?0:t&&n?(t=e.pad(t))<(n=e.pad(n))?-1:n<t?1:0:t?1:n?-1:0}}])}();Md._$name="Wbs";var Fd=Object.freeze([]),Ad=Symbol("StopBranch"),Id=Le.generateUUID(),Ld=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"StopBranch",get:function(){return Ad}},{key:"isTree",get:function(){var e,t;return null!==(e=this.tree)&&void 0!==e?e:null===(t=this.masterStore)||void 0===t?void 0:t.tree}},{key:"leaves",get:function(){var e=[];return this.isTree?this.traverse((function(t){t.isLeaf&&e.push(t)})):this.allRecords.forEach((function(t){t.isLeaf&&e.push(t),t.traverse((function(t){t.isLeaf&&e.push(t)}),!0)})),e}},{key:"loadChildren",value:(s=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"onNodeAddChild",value:function(e,t,n,r){var a,o,l=arguments.length>4&&arguments[4]!==i&&arguments[4],s=this,u=e===s.rootNode&&e.isLoading,c=s.storage,d=t[0].previousSibling,h=s.collectDescendants(t,i,i,{inCollapsedBranch:!(e.isExpanded(s)&&e.ancestorsExpanded(s)),applyFilter:s.isFiltered&&s.reapplyFilterOnAdd}),f=h.visible,v=h.all;if(!u&&v.length){var g,m=D(v);try{for(m.s();!(g=m.n()).done;){var p=g.value;s.modified.includes(p)||r[p.id]||(s.removed.includes(p)?s.removed.remove(p):p.isLinked||s.added.add(p))}}catch(e){m.e(e)}finally{m.f()}}if(u&&s.rootVisible&&(f.unshift(e),v.unshift(e)),f.length?(a=0!==n&&d?c.indexOf(d)+d.getDescendantCount(!0,s):c.indexOf(e),c.suspendEvents(),s.storage.splice(++a,0,f),c.resumeEvents(),s._idMap=null):s._allRecords=null,s.updateDependentStores("add",t),u&&f.length){if(s.sorters.length&&s.sort(null,null,!1,!0),null===(o=s.afterLoadData)||void 0===o||o.call(s),!l){var y={action:"dataset",data:s._data,records:f};s.trigger("refresh",y),s.trigger("change",y)}}else if(!l){var k={action:"add",parent:e,isChild:!0,isMove:r,records:t,allRecords:v,index:a};if(s.trigger("add",k),s.trigger("change",k),r&&Object.values(r).some((function(e){return e}))){var b={newParent:e,records:t.filter((function(e){return r[e.id]})),oldParents:t.map((function(e){return s.getById(e.meta.oldParentId)}))};s.trigger("move",b)}}}},{key:"onNodeRemoveChild",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:{isMove:!1,silent:!1,unfiltered:!1},a=this,o=a.storage,l=[],s=[],u=r.isMove,c=r.silent,d=r.unfiltered&&a.isFiltered;if(a.collectDescendants(t,l,s,{inCollapsedBranch:!(e.isExpanded(a)&&e.ancestorsExpanded(a)),unfiltered:d}),!u){var h,f=D(t);try{for(f.s();!(h=f.n()).done;){h.value.unjoinStore(a)}}catch(e){f.e(e)}finally{f.f()}var v,g=D(s);try{for(g.s();!(v=g.n()).done;){var m=v.value;m.stores.includes(a)&&m.unjoinStore(a),a.added.includes(m)?a.added.remove(m):m.isLinked||a.removed.add(m)}}catch(e){g.e(e)}finally{g.f()}a.modified.remove(s)}if(l.length?(n=o.indexOf(l[0]))>-1&&(o.suspendEvents(),o.splice(n,l.length),o.resumeEvents(),a._idMap=null):(n=-1,a._allRecords=null),!c&&(a.fireRemoveEventForMoveAction||!u)){var p={action:"remove",parent:e,isChild:!0,isMove:u,records:t,allRecords:s,index:n};a.trigger("remove",p),a.trigger("change",p)}return s}},{key:"collectDescendants",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:[],r=arguments.length>2&&arguments[2]!==i?arguments[2]:[],a=arguments.length>3&&arguments[3]!==i?arguments[3]:{},o=this,l=a.inCollapsedBranch,s=void 0!==l&&l,u=a.unfiltered,c=void 0!==u&&u,d=a.applyFilter,h=void 0!==d&&d,f=Array.isArray(e)?e:null!==(t=o.getChildren(e,c))&&void 0!==t?t:[];if(h)return{visible:!s&&f.flatMap((function(e){return o.collectVisibleNodeDescendantsFiltered(e)})),all:f.concat(f.flatMap((function(e){return e.allChildren})))};for(var v,g=0,m=f.length;g<m;g++)v=f[g],s||n.push(v),r.push(v),o.collectDescendants(v,n,r,{inCollapsedBranch:s||!v.isExpanded(o),unfiltered:c});return{visible:n,all:r}}},{key:"collectVisibleNodeDescendantsFiltered",value:function(e){var t=this,n=e.unfilteredChildren||e.children;if(!n||0===n.length||!e.isLeaf&&!e.isExpanded(this))return this.filtersFunction(e)?[e]:[];var r=n.flatMap((function(e){return t.collectVisibleNodeDescendantsFiltered(e)}));return r.length||this.filtersFunction(e)?[e].concat(z(r)):[]}},{key:"getChildren",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.isChained&&!n.isChainedTree,a=(t||r)&&e.unfilteredChildren||e.children;return null!=a&&a.length?r?a.filter(n.chainedFilterFn).sort(n.sorterFn):a:Fd}},{key:"internalToggleTreeSubRecords",value:function(e,t){var n=this,r=n.storage,i=r.indexOf(e),a=n.doIncludeExclude(n.getChildren(e),t);if(n.isFiltered&&t&&e.unfilteredChildren&&n.updateChildrenHiddenState(e),a.length&&!1!==i){if(r.suspendEvents(),t){r.splice.apply(r,[i+1,0].concat(z(a)));var o={action:"add",isExpand:!0,parent:e,records:a,index:i+1};n.trigger("add",o),n.trigger("change",o)}else{r.splice(i+1,a.length);var l={action:"remove",isCollapse:!0,parent:e,records:a,index:i+1};n.trigger("remove",l),n.trigger("change",l)}r.resumeEvents(),n._idMap=null}}},{key:"updateChildrenHiddenState",value:function(e){var t,n=this;null===(t=e.unfilteredChildren)||void 0===t||t.forEach((function(e){e.instanceMeta(n.id).hidden=!1,e.isLeaf||n.updateChildrenHiddenState(e)}))}},{key:"doIncludeExclude",value:function(e,t){for(var n=arguments.length>2&&arguments[2]!==i?arguments[2]:[],r=this,a=(null==e?void 0:e.length)||0,o=0;o<a;o++){var l=e[o];if(!r.isChained||r.chainedFilterFn(l)){var s=l.instanceMeta(r.id);!t&&s.hidden||n.push(l),s.hidden=!t,l.isExpanded(r)&&r.doIncludeExclude(r.getChildren(l),t,n)}}return n}},{key:"toggleCollapse",value:(l=f(L().mark((function e(t,n){var r,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(r=this).getById(t),o=a.instanceMeta(r),n===i&&(n=!o.collapsed),o.isLoadingChildren||a.isLeaf||a.isExpanded(r)!==n){e.next=28;break}if(r.trigger("beforeToggleNode",{record:a,collapse:n}),o.collapsed=n,!o.collapsed){e.next=10;break}return r.onNodeCollapse(a),e.abrupt("return",!0);case 10:if(r.onNodeExpand(a),l=!0,a.isLoaded){e.next=27;break}return o.isLoadingChildren=!0,e.prev=14,e.next=17,r.loadChildren(a);case 17:e.next=24;break;case 19:e.prev=19,e.t0=e.catch(14),o.collapsed=!0,l=!1,r.trigger("loadChildrenException",{record:a,exception:e.t0});case 24:return e.prev=24,o.isLoadingChildren=!1,e.finish(24);case 27:return e.abrupt("return",l);case 28:case"end":return e.stop()}}),e,this,[[14,19,24,27]])}))),function(e,t){return l.apply(this,arguments)})},{key:"onNodeCollapse",value:function(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}},{key:"onNodeExpand",value:function(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}},{key:"transformToTree",value:function(e){var t,n,r=this.modelClass,i=r.parentIdField,l=r.idField,s=r.childrenField,u=(null===(t=this.modelClass.fieldMap[i])||void 0===t?void 0:t.dataSource)||"parentId",c=new a,d=new o,h=[],f=D(e);try{for(f.s();!(n=f.n()).done;){var v=n.value,g=null==v?void 0:v[l];null!=g&&c.set(g,v)}}catch(e){f.e(e)}finally{f.f()}var m,p=function(e){var t=Object.assign({},e);return t[s]=[],c.set(t[l],t),d.add(e[l]),t},y=D(e);try{for(y.s();!(m=y.n()).done;){var k=m.value;if(k){var b=k[l],C=(k=d.has(b)?c.get(b):p(k))[u];if(null!=C){var w=c.get(C);w&&(w[s]||(w=p(w)),w[s].push(k))}else k[s]?h.push(k):null!=k[l]?h.push(p(k)):h.push(k)}}}catch(e){y.e(e)}finally{y.f()}return c.forEach((function(e){var t,n;null===(t=(n=e[s]).sort)||void 0===t||t.call(n,(function(e,t){return e.parentIndex-t.parentIndex}))})),h}},{key:"treeifyData",value:function(e,t,n){var r,o,l=this,s=arguments.length>3&&arguments[3]!==i&&arguments[3],u=arguments.length>4?arguments[4]:i,c=t.length,d=[],h=[],f={},v=function(){var e=t[r];e=e.field||e,t[r].call||(t[r]=function(t){return t[e]},t[r].fieldName=e),d[r]=new a};for(r=0;r<c;r++)v();ld.preWalkWithParent({isRoot:!0,id:this.rootNode.id,children:e},(function(e){return e.children}),(function(e,n){if(o=[],n.isLeaf){var i=function(){var e=t[r],i=u?u(e(n),e.fieldName):e(n),a=d[r],l=""===i?Id:i,s=$e.asArray(l)||[Id],c=[];if(s[0]===Ad)return 1;(o.length>0?o:[null]).forEach((function(t){for(var r=0,i=s.length;r<i;r++){var o,l=s[r],u="".concat((null!==(o=null==t?void 0:t.path)&&void 0!==o?o:"")+(null!=l&&l.isModel?l.id:l),"/"),d=Le.makeValidDomId("generated_".concat(u),"_"),h=a.get(d)||a.set(d,{id:d,key:s[r]===Id?"":l,path:u,readOnly:!0,children:[],generatedParent:!0,field:e.fieldName,firstGroupChild:n}).get(d);c.push(h),t&&!t.children.includes(h)&&t.children.push(h)}})),o=c};for(r=0;r<c&&!i();r++);o.length?o.forEach((function(e,t){return e.children.push(t?n.link():n)})):h.push(n)}}),!0),(n||s)&&d.forEach((function(e){return e.forEach((function(e,t,r){null==n||n(e),s&&(e=l.createRecord(e),r.set(t,e))}))})),f.children=[].concat(z(d[0].values()),h);var g=function(e){e.children&&(e.children.sort((function(e,n){if(e.isLeaf===n.isLeaf){if(e.isLeaf){for(var r,a=0;!r&&a<c;a++){var o=t[a](e),l=t[a](n);if(o===Ad||l===Ad)return e.isLeaf<n.isLeaf?-1:e.isLeaf>n.isLeaf?1:0;r=o<l?-1:l<o?1:0}return r}return"string"==typeof e.key&&"string"==typeof n.key?e.key.localeCompare(n.key,i,{numeric:!0}):e.key<n.key?-1:e.key>n.key?1:0}return e.isLeaf<n.isLeaf?-1:e.isLeaf>n.isLeaf?1:0})),e.children.forEach(g))};return g(f),f}},{key:"treeify",value:function(e,t){var n=arguments.length>3?arguments[3]:i;return this.treeifyData(this.rootNode.children,e,t,!1,n)}},{key:"treeifyFlatData",value:function(e){var t,n,r=this.modelClass,i=r.childrenField,a=r.parentIdField,o=(null===(t=this.modelClass.fieldMap[a])||void 0===t?void 0:t.dataSource)||"parentId",l=!1,s=!0,u=D(e);try{for(u.s();!(n=u.n()).done;){var c=n.value;if(null!=c&&c.isModel||Array.isArray(null==c?void 0:c[i])){s=!1;break}null!=(null==c?void 0:c[o])&&(l=!0)}}catch(e){u.e(e)}finally{u.f()}return s&&l&&(e=this.transformToTree(e)),e}},{key:"indent",value:(r=f(L().mark((function e(t){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,t=(t=Array.isArray(t)?t:[t]).filter((function(e){for(var n=Boolean(e.previousSibling);n&&!e.isRoot;)n=!t.includes(e.parent),e=e.parent;return n})),t.length&&!1!==n.trigger("beforeIndent",{records:t})){t.sort((function(e,t){return Md.compare(e.wbsCode,t.wbsCode)})),n.beginBatch(),r=D(t);try{for(r.s();!(i=r.n()).done;)a=i.value,(o=a.previousSibling).appendChild(a),n.toggleCollapse(o,!1)}catch(e){r.e(e)}finally{r.f()}n.endBatch(),n.trigger("indent",{records:t}),n.trigger("change",{action:"indent",records:t})}case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"outdent",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,t=(t=Array.isArray(t)?t:[t]).filter((function(e){for(var n=e.parent,r=n&&!n.isRoot;r&&!e.isRoot;)r=!t.includes(n),e=e.parent;return r})),t.length&&!1!==n.trigger("beforeOutdent",{records:t})){t.sort((function(e,t){return Md.compare(e.wbsCode,t.wbsCode)})),n.beginBatch(),r=D(t);try{for(r.s();!(i=r.n()).done;)a=i.value,o=a.parent,l=o.children.slice(o.children.indexOf(a)+1),o.parent.insertChild(a,o.nextSibling),a.appendChild(l),n.toggleCollapse(a,!1)}catch(e){r.e(e)}finally{r.f()}n.endBatch(),n.trigger("outdent",{records:t}),n.trigger("change",{action:"outdent",records:t})}case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]);var n,r,l,s}(e||Mn),S(t,"$name","StoreTree"),S(t,"StopBranch",Ad),S(t,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:!1,keepExpandedOnLoad:!1}),t},Od=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"syncDataset",value:function(e){var t,n,r,a,o,l=this,s=l.storage,u=null!==(t=null===(n=l.shouldSyncDataset)||void 0===n?void 0:n.call(l,{data:e,store:l,records:l.records}))&&void 0!==t?t:null===(r=l.project)||void 0===r||null===(a=r.shouldSyncDataset)||void 0===a?void 0:a.call(r,{data:e,store:l,records:l.records});if(!1!==u){l.trigger("startApplyChangeset"),l.isSyncingDataOnLoad=!0;var c=l.tree?l.syncTreeDataset(e,u):l.syncFlatDataset(e,u),d=c.toAdd,h=c.toRemove,f=c.toMove,v=c.updated,g=c.ids,m=null===(o=l.syncDataOnLoad)||void 0===o?void 0:o.threshold,p=!1;if(m&&("string"==typeof m&&(m=parseInt(m,10)/100*l.count),p=d.length+h.length+f.length+v.length>m),l.tree){if(d.length)l.add(d,p).forEach((function(e){return e.clearParentId()}));if(f.length){var y,k=D(f);try{for(k.s();!(y=k.n()).done;){var b=y.value,C=b.parent,w=b.node,S=b.index;l.getById(C.id).insertChild(w,S)}}catch(e){k.e(e)}finally{k.f()}}l.remove(h,p)}else p&&l.suspendEvents(),l.remove(h),l.add(d),p&&l.resumeEvents();m&&!p&&v.forEach((function(e){var t=e.record,n=e.toSet,r=e.wasSet;return l.onModelChange(t,n,r)})),l.$isSettingStoreFieldData||l.acceptChanges();var x={added:d,removed:h,updated:v,thresholdSurpassed:p};if(l.isFiltered&&!l.remoteFilter&&l.filter({silent:l.isRemoteDataLoading}),l.isGrouped)l.group(null,null,!1,!0,l.isRemoteDataLoading);else if(l.isSorted)l.remoteSort?s.replaceValues({values:s.values.sort(l.createSorterFn(l.sorters)),silent:!0}):l.sort();else if(l.reorderOnSync)if(l.tree){var E=!1,R=0;ld.preWalk(l.rootNode,(function(e){return Array.isArray(e.children)&&!E?e.children:null}),(function(e){e.id!==g[R++]&&(E=!0)})),E&&(l.sort((function(e,t){return g[e.id]-g[t.id]}),i,i,!0),l.clearSorters(!0),!p&&l.afterPerformSort())}else s.values.some((function(e,t){return g[e.id]!==t}))&&(s.replaceValues({values:s.values.sort((function(e,t){return g[e.id]-g[t.id]})),silent:!0}),!p&&l.afterPerformSort());p&&l.trigger("refresh",{action:"batch",data:e,records:s.values,syncInfo:x}),l.isSyncingDataOnLoad=!1,l.trigger("endApplyChangeset"),l.trigger("loadSync",x)}}},{key:"syncFlatDataset",value:function(e,t){if(!e)return{toRemove:this.records};var n=this,r=n.modelClass,i=r.idField,a=r.allFields,l=[],s=[],u=[],c={},d={},h=t instanceof o,f=n.syncDataOnLoad,v=f.threshold,g=f.keepMissingValues,m=0;if(e.forEach((function(e,r){var o=(e=e.isModel?e.data:e)[i],l=n.getById(o);if(!h||t.has(o))if(l){if(n.shouldSyncRecord?!1!==n.shouldSyncRecord({record:l,data:e,store:n}):e!==l.data){var f,p;if(null===(f=n.beforeSyncRecord)||void 0===f||f.call(n,{record:l,data:e}),!1===g){var y,k=D(a);try{for(k.s();!(y=k.n()).done;){var b=y.value;!(b.dataSource in e)&&b.dataSource in l.data&&(e[b.dataSource]=b.defaultValue)}}catch(e){k.e(e)}finally{k.f()}}var C=l.set(e,null,Boolean(v));C&&u.push({record:l,wasSet:C,toSet:e}),null===(p=n.afterSyncRecord)||void 0===p||p.call(n,{record:l,data:e})}}else s.push(n.processRecord(n.createRecord(e)));l&&m++,c[o]=1,d[o]=r})),m<n.allRecords.filter((function(e){return!e.isSpecialRow})).length)if(t){var p,y=D(t);try{for(y.s();!(p=y.n()).done;){var k=p.value;c[k]||l.push(n.getById(k))}}catch(e){y.e(e)}finally{y.f()}}else n.forEach((function(e){c[e.id]||l.push(e)}),n,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0});return{toAdd:s,toRemove:l,toMove:[],updated:u,ids:d}}},{key:"syncTreeDataset",value:function(e){var t,n=this;if(!e)return{toRemove:this.records};var r=this,a=r.modelClass,l=a.idField,s=a.parentIdField,u=a.childrenField,c=a.allFields,d=null!==(t=r.syncDataOnLoad)&&void 0!==t?t:{},h=d.keepMissingValues,f=d.threshold,v=[],g=[],m=[],p=[],y=new o,k={},b=0;return r.transformFlatData&&(e=r.treeifyFlatData(e)),ld.preWalkWithParent({isRoot:!0,id:r.rootNode.id,children:e},(function(e){return e.children}),(function(e,t){if(e){var a=r.resolveSyncNode(t),o=a.id,d=a.node;if(d){if(r.shouldSyncRecord?!1!==r.shouldSyncRecord({record:d,data:t,store:r}):t!==d.data){var v,C,w=d.children;if(d.parent.id!==e[l]&&m.push({node:d,parent:e,index:e[u].indexOf(t)}),d!==t){if(!0!==w&&!0===t[u]&&(d.clearChildren(),d.data[u]=d.children=!0,delete t[u],r.toggleCollapse(d,!0),v=!0),!1===h){var x,E=D(c);try{for(E.s();!(x=E.n()).done;){var R=x.value;"parentId"!==R.name&&!(R.dataSource in t)&&R.dataSource in d.data&&(t[R.dataSource]=R.defaultValue)}}catch(e){E.e(e)}finally{E.f()}}"boolean"==typeof t.expanded&&n.toggleCollapse(d,!t.expanded),C=d.set(t,null,Boolean(f))}C?p.push({record:d,wasSet:C,toSet:t}):v&&d.signalNodeChanged(S({},u,{value:!0,oldValue:w}))}y.add(d)}else t[s]=e[l],t.isModel?g.push(t):g.push(F(F({},t),Array.isArray(t[u])?{children:[]}:i));k[o]=b++}})),r.totalCount!==y.size&&r.traverse((function(e){y.has(e)||v.push(e)})),{toAdd:g,toRemove:v,toMove:m,updated:p,ids:k}}},{key:"resolveSyncNode",value:function(e){var t=e[this.modelClass.idField];return{id:t,node:this.getById(t)}}}],[{key:"configurable",get:function(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null,reorderOnSync:!0}}}])}(e||Mn),S(t,"$name","StoreSync"),t},Pd=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=g(this,t,[].concat(r))).name="RevisionException",e}return R(t,e),w(t)}(Y(Error));Pd._$name="RevisionException";var _d=function(){throw new Error("Abstract method call!")},Hd=function(){throw new Error("Method cannot be called at this state!")},Bd=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(e){_d()}},{key:"canRedo",value:function(e){_d()}},{key:"canCheckoutTo",value:function(e){_d()}},{key:"onUndo",value:function(e){_d()}},{key:"onRedo",value:function(e){_d()}},{key:"onCheckoutTo",value:function(e){_d()}},{key:"onCheckoutToHead",value:function(e){_d()}},{key:"onStartRevision",value:function(e,t){_d()}},{key:"onStartTemporaryRevision",value:function(e,t,n){_d()}},{key:"onStopRevision",value:function(e){_d()}},{key:"onStartTransaction",value:function(e){_d()}},{key:"onStopTransaction",value:function(e){_d()}},{key:"onStopTransactionDelayed",value:function(e){_d()}},{key:"onRejectTransaction",value:function(e){_d()}},{key:"onEnable",value:function(e){_d()}},{key:"onDisable",value:function(e){_d()}},{key:"onAutoRecordOn",value:function(e){_d()}},{key:"onAutoRecordOff",value:function(e){_d()}},{key:"onResetQueue",value:function(e){_d()}},{key:"onModelUpdate",value:function(e){_d()}},{key:"onStoreModelAdd",value:function(e){_d()}},{key:"onStoreModelInsert",value:function(e){_d()}},{key:"onStoreModelRemove",value:function(e){_d()}},{key:"onStoreModelRemoveAll",value:function(e){_d()}},{key:"onModelInsertChild",value:function(e){_d()}},{key:"onModelRemoveChild",value:function(e){_d()}}])}(Mn);Bd._$name="StateBase";var Vd=Symbol("STATE_PROP"),Nd=Symbol("STORES_PROP"),zd=Symbol("QUEUE_PROP"),jd=Symbol("POS_PROP"),Wd=Symbol("ACTION_QUEUE_PROP"),$d=Symbol("REVISION_NAMES_PROP"),Ud=Symbol("REVISION_QUEUE_PROP"),Gd=Symbol("REVISION_INDEX_PROP"),Yd=Symbol("CURRENT_REV_ID_PROP"),qd=Symbol("TRANSACTION_PROP"),Kd=Symbol("TRANSACTION_TIMER_PROP"),Xd=Symbol("AUTO_RECORD_PROP"),Zd=Symbol("IS_APPLYING_STASH");Object.freeze([Vd,Nd,zd,jd,Wd,$d,Ud,Gd,Yd,qd,Kd,Xd,Zd]);var Jd=new a,Qd=function(e,t){Jd.set(e,t)},eh=function(e){return"string"==typeof e&&(e=Jd.get(e)),e},th=function(e,t){var n,r=t.undo,i=t.redo,a=t.revision;return n=r&&!i?S(S({},zd,e[zd].slice(e.position)),jd,0):i&&!r?S({},zd,e[zd].slice(0,e.position)):S(S({},zd,[]),jd,0),a&&(n=Object.assign(null!=n?n:{},S(S(S({},$d,["base"]),Gd,0),Ud,[]))),[n,function(){e.notifyStoresAboutQueueReset(t)}]},nh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(){return!1}},{key:"canRedo",value:function(){return!1}},{key:"canCheckoutTo",value:function(){return!1}},{key:"onUndo",value:function(){Hd()}},{key:"onRedo",value:function(){Hd()}},{key:"onEnable",value:function(e){return e.autoRecord?"autoreadystate":"readystate"}},{key:"onDisable",value:function(){Hd()}},{key:"onAutoRecordOn",value:function(){return S({},Xd,!0)}},{key:"onAutoRecordOff",value:function(){return S({},Xd,!1)}},{key:"onStartTransaction",value:function(){Hd()}},{key:"onStopTransaction",value:function(){Hd()}},{key:"onStopTransactionDelayed",value:function(){Hd()}},{key:"onRejectTransaction",value:function(){Hd()}},{key:"onResetQueue",value:function(e,t){return th(e,t)}},{key:"onModelUpdate",value:function(){}},{key:"onModelInsertChild",value:function(){}},{key:"onModelRemoveChild",value:function(){}},{key:"onStoreModelAdd",value:function(){}},{key:"onStoreModelInsert",value:function(){}},{key:"onStoreModelRemove",value:function(){}},{key:"onStoreRemoveAll",value:function(){}}])}(Bd),rh=new nh;Qd("disabledstate",rh);var ih=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return this.constructor.name}},{key:"undo",value:function(){_d()}},{key:"redo",value:function(){_d()}},{key:"invert",value:function(){var e=new this.constructor(F(F({},this.initialConfig),{},{isUserInput:this.isUserInput,inversed:!0})),t=e.undo,n=e.redo;return e.undo=n,e.redo=t,e}}],[{key:"defaultConfig",get:function(){return{inversed:!1}}}])}(Mn),ah="AddAction",oh="InsertAction",lh="InsertChildAction",sh="RemoveAction",uh="RemoveAllAction",ch="RemoveChildAction",dh="UpdateAction",hh="EventUpdateAction";ih._$name="ActionBase";var fh=Symbol("MODEL_PROP"),vh=Symbol("NEW_DATA_PROP"),gh=Symbol("OLD_DATA_PROP"),mh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return dh}},{key:"model",get:function(){return this[fh]},set:function(e){this[fh]=e}},{key:"newData",get:function(){return this[vh]},set:function(e){this[vh]=F({},e)}},{key:"oldData",get:function(){return this[gh]},set:function(e){this[gh]=F({},e)}},{key:"undo",value:function(){var e=this.model,t=this.oldData;e.$&&Object.assign(e,t),e.set(t,null,null,null,Boolean(e.$))}},{key:"redo",value:function(){var e=this.model,t=this.newData;e.$&&Object.assign(e,t),e.set(t,null,null,null,Boolean(e.$))}}],[{key:"defaultConfig",get:function(){return{model:i,newData:i,oldData:i,isInitialUserAction:!1}}}])}(ih);S(mh,"$name","UpdateAction"),mh._$name="UpdateAction";var ph=Symbol("PARENT_MODEL_PROP"),yh=Symbol("CHILD_MODELS_PROP"),kh=Symbol("INSERT_INDEX_PROP"),bh=Symbol("ORDERED_PROP"),Ch=Symbol("CONTEXT_PROP"),wh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return lh}},{key:"parentModel",get:function(){return this[ph]},set:function(e){this[ph]=e}},{key:"childModels",get:function(){return this[yh]},set:function(e){this[yh]=e.slice(0)}},{key:"insertIndex",get:function(){return this[kh]},set:function(e){this[kh]=e}},{key:"orderedBeforeNode",get:function(){return this[bh]},set:function(e){this[bh]=e}},{key:"context",get:function(){return this[Ch]},set:function(e){this[Ch]=e}},{key:"stores",get:function(){return this[Nd]},set:function(e){this[Nd]=e}},{key:"undo",value:function(){var e,t=this.parentModel,n=this.context,r=this.childModels,i=new a,l=new o,s=D(r);try{for(s.s();!(e=s.n()).done;){var u=e.value,c=n.get(u);if(c){var d=i.get(c.parent);d||(d={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},i.set(c.parent,d)),c.parent===t?c.index>u.parentIndex?d.moveRight.push({parent:c.parent,model:u,index:c.index+1}):d.moveLeft.push({parent:c.parent,model:u,index:c.index}):d.moveFromAnotherParent.push({parent:c.parent,model:u,index:c.index})}else l.add(u)}}catch(e){s.e(e)}finally{s.f()}l.forEach((function(e){return e.parent.removeChild(e)}));var h,f=D(i.values());try{for(f.s();!(h=f.n()).done;){var v=h.value,g=v.moveRight,m=v.moveLeft;v.moveFromAnotherParent.forEach((function(e){e.parent.insertChild(e.model,e.index)})),m.sort((function(e,t){return e.index-t.index})),g.sort((function(e,t){return t.index-e.index}))}}catch(e){f.e(e)}finally{f.f()}var p,y=D(i.values());try{for(y.s();!(p=y.n()).done;){var k=p.value,b=k.moveRight;k.moveLeft.forEach((function(e){e.parent.insertChild(e.model,e.index)})),b.forEach((function(e){e.parent.insertChild(e.model,e.index)}))}}catch(e){y.e(e)}finally{y.f()}}},{key:"redo",value:function(){var e,t,n=this.parentModel,r=this.insertIndex,i=this.childModels,a=this.orderedBeforeNode,o=null===(e=n.children)||void 0===e?void 0:e[r];n.insertChild(i,o,!1,{orderedBeforeNode:null!=a?a:null==o||null===(t=o.previousSibling)||void 0===t?void 0:t.nextOrderedSibling})}}],[{key:"defaultConfig",get:function(){return{parentModel:i,childModels:i,insertIndex:i,orderedBeforeNode:i,context:i,stores:i}}}])}(ih);S(wh,"$name","InsertChildAction"),wh._$name="InsertChildAction";var Dh=Symbol("PARENT_MODEL_PROP"),Sh=Symbol("CHILD_MODELS_PROP"),xh=Symbol("CONTEXT_PROP"),Eh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return ch}},{key:"parentModel",get:function(){return this[Dh]},set:function(e){this[Dh]=e}},{key:"childModels",get:function(){return this[Sh]},set:function(e){this[Sh]=e.slice(0)}},{key:"context",get:function(){return this[xh]},set:function(e){this[xh]=e}},{key:"stores",get:function(){return this[Nd]},set:function(e){this[Nd]=e}},{key:"undo",value:function(){var e=this.parentModel,t=this.context,n=this.childModels;n.sort((function(e,n){return t.get(e).parentIndex-t.get(n).parentIndex})),n.forEach((function(n){var r=t.get(n);e.insertChild(n,r.parentIndex,i,{orderedParentIndex:r.orderedParentIndex})}))}},{key:"redo",value:function(){this.parentModel.removeChild(this.childModels)}}],[{key:"defaultConfig",get:function(){return{parentModel:i,childModels:i,context:i,stores:i}}}])}(ih);S(Eh,"$name","RemoveChildAction"),Eh._$name="RemoveChildAction";var Rh=Symbol("STORE_PROP"),Th=Symbol("MODEL_LIST_PROP"),Mh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return ah}},{key:"store",get:function(){return this[Rh]},set:function(e){this[Rh]=e}},{key:"modelList",get:function(){return this[Th]},set:function(e){this[Th]=e.slice(0)}},{key:"undo",value:function(){this.store.remove(this.modelList,this.silent)}},{key:"redo",value:function(){this.store.add(this.modelList,this.silent)}}],[{key:"defaultConfig",get:function(){return{store:i,modelList:i,silent:!1}}}])}(ih);S(Mh,"$name","AddAction"),Mh._$name="AddAction";var Fh=Symbol("STORE_PROP"),Ah=Symbol("MODEL_LIST_PROP"),Ih=Symbol("INSERT_INDEX_PROP"),Lh=Symbol("CONTEXT_PROP"),Oh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return oh}},{key:"store",get:function(){return this[Fh]},set:function(e){this[Fh]=e}},{key:"modelList",get:function(){return this[Ah]},set:function(e){this[Ah]=e.slice(0)}},{key:"insertIndex",get:function(){return this[Ih]},set:function(e){this[Ih]=e}},{key:"context",get:function(){return this[Lh]},set:function(e){this[Lh]=e}},{key:"undo",value:function(){var e=this.store,t=this.modelList,n=this.context,r=this.silent,a=this.reportUndoneRemoval;t.sort((function(e,t){var r=n.get(e),a=n.get(t);return r!==i&&a!==i?r-a:0})),t.forEach((function(t){var o=n.get(t);t._undoingInsertion=a,o!==i?e.insert(o,t,r):e.remove(t,r),t._undoingInsertion=!1}))}},{key:"redo",value:function(){var e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}],[{key:"defaultConfig",get:function(){return{store:i,modelList:i,insertIndex:i,context:i,silent:!1,reportUndoneRemoval:!0}}}])}(ih);S(Oh,"$name","InsertAction"),Oh._$name="InsertAction";var Ph=Symbol("STORE_PROP"),_h=Symbol("MODEL_LIST_PROP"),Hh=Symbol("CONTEXT_PROP"),Bh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return sh}},{key:"store",get:function(){return this[Ph]},set:function(e){this[Ph]=e}},{key:"modelList",get:function(){return this[_h]},set:function(e){this[_h]=e.slice(0)}},{key:"context",get:function(){return this[Hh]},set:function(e){this[Hh]=e}},{key:"undo",value:function(){var e=this.store,t=this.context,n=this.modelList,r=this.silent;n.sort((function(e,n){return t.get(e)-t.get(n)})),n.forEach((function(n){var i=t.get(n);e.insert(i,n,r)}))}},{key:"redo",value:function(){this.store.remove(this.modelList,this.silent)}}],[{key:"defaultConfig",get:function(){return{store:i,modelList:i,context:i,silent:!1}}}])}(ih);S(Bh,"$name","RemoveAction"),Bh._$name="RemoveAction";var Vh=Symbol("STORE_PROP"),Nh=Symbol("ALL_RECORDS_PROP"),zh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return uh}},{key:"store",get:function(){return this[Vh]},set:function(e){this[Vh]=e}},{key:"allRecords",get:function(){return this[Nh]},set:function(e){this[Nh]=e.slice(0)}},{key:"undo",value:function(){var e=this.store,t=this.allRecords,n=this.silent;e.add(t,n)}},{key:"redo",value:function(){this.store.removeAll(this.silent)}}],[{key:"defaultConfig",get:function(){return{store:i,allRecords:i,silent:!1}}}])}(ih);S(zh,"$name","RemoveAllAction"),zh._$name="RemoveAllAction";var jh=function(e,t,n,r){return new mh({model:e,newData:t,oldData:n,isInitialUserAction:r})},Wh=function(e,t,n,r,i,a){return new wh({parentModel:e,childModels:n,insertIndex:t,orderedBeforeNode:i,context:r,stores:a})},$h=function(e,t,n,r){return new Eh({parentModel:e,childModels:t,context:n,stores:r})},Uh=function(e,t,n){return new Mh({store:e,modelList:t,silent:n})},Gh=function(e,t,n,r,i){return new Oh({store:e,insertIndex:t,modelList:n,context:r,silent:i})},Yh=function(e,t,n,r){return new Bh({store:e,modelList:t,context:n,silent:r})},qh=function(e,t,n){return new zh({store:e,allRecords:t,silent:n})},Kh="DATA_CORRECTION",Xh="TEMPORARY",Zh="CONFLICT_RESOLUTION",Jh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){this[Wd]=[];for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"construct",this,3)(n)}},{key:"queue",get:function(){return this[Wd].slice(0)}},{key:"length",get:function(){return this[Wd].length}},{key:"filterUserInput",get:function(){return this.inputGeneration>0}},{key:"addAction",value:function(e){this[Wd].push(e)}},{key:"undo",value:function(){for(var e=this[Wd],t=e.length-1;t>=0;--t)e[t].undo()}},{key:"redo",value:function(){for(var e=this[Wd],t=0,n=e.length;t<n;++t)e[t].redo()}},{key:"mergeUpdateModelActions",value:function(){var e,t=this[Wd],n=new a,r=[],i=D(t);try{for(i.s();!(e=i.n()).done;){var o,l=e.value;if(l.isUpdateAction&&null!==(o=l.model)&&void 0!==o&&o.isModel){var s,u=null!==(s=l.isUserInput)&&void 0!==s?s:0,c=n.get(l.model);c||(c=[],n.set(l.model,c));var d=c[u];if(d)for(var h in l.oldData)l.newData.hasOwnProperty(h)&&(d.oldData.hasOwnProperty(h)||(d.oldData[h]=l.oldData[h]),d.newData[h]=l.newData[h]);else c[u]=l,r.push(l)}else{var f;if(r.push(l),l.isRemoveAction&&null!==(f=l.modelList)&&void 0!==f&&f.length){var v,g=D(l.modelList);try{for(g.s();!(v=g.n()).done;){var m=v.value;n.delete(m)}}catch(e){g.e(e)}finally{g.f()}}}}}catch(e){i.e(e)}finally{i.f()}this[Wd]=r,this.inputGeneration=Math.max.apply(Math,z(r.map((function(e){var t;return null!==(t=e.isUserInput)&&void 0!==t?t:0}))).concat([0]))}},{key:"mergeAddUpdateModelActions",value:function(){var e,t=this[Wd],n=new o,r=[],i=D(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.isAddAction||a.isInsertAction?a.modelList.forEach((function(e){return n.add(e)})):a.isInsertChildAction&&a.childModels.forEach((function(e){return n.add(e)})),(a.isUpdateAction||a.isEventUpdateAction)&&n.has(a.model)||r.push(a)}}catch(e){i.e(e)}finally{i.f()}this[Wd]=r,this.inputGeneration=Math.max.apply(Math,z(r.map((function(e){var t;return null!==(t=e.isUserInput)&&void 0!==t?t:0}))).concat([0]))}},{key:"invert",value:function(){var e=new this.constructor(F(F({},this.initialConfig),{},{title:this.title}));return e[Wd]=this[Wd].map((function(e){return function(e){return e.invert()}(e)})),e}},{key:"groupUserInput",value:function(){return this[Wd].reduce((function(e,t){var n,r=null!==(n=t.isUserInput)&&void 0!==n?n:"default";return e.has(r)||e.set(r,[]),e.get(r).push(t),e}),new a)}},{key:"getUserInput",value:function(e){var t,n=new a,r={},i=this.groupUserInput().get(null!=e?e:this.inputGeneration||"default"),o=function(e,t){return t in r?e in r[t]||(r[t][e]=[]):r[t]=S({},e,[]),r[t][e]},l=D(i);try{var s=function(){var e=t.value;switch(e.type){case ah:case oh:if(e.inversed){var r=o("removed",e.store.id);r.push.apply(r,z(e.modelList))}else{var i=o("added",e.store.id);i.push.apply(i,z(e.modelList))}break;case sh:case uh:if(e.inversed){var a=o("added",e.store.id);a.push.apply(a,z(e.modelList||e.allRecords))}else{var l=o("removed",e.store.id);l.push.apply(l,z(e.modelList||e.allRecords))}break;case lh:var s,u=function(e,t){var n;t.added.includes(e)?o("added",t.id).push(e):t.removed.includes(e)&&o("removed",t.id).push(e),null===(n=e.children)||void 0===n||n.forEach((function(e){return u(e,t)}))},c=D(e.stores);try{var d=function(){var t=s.value;e.childModels.forEach((function(e){return u(e,t)})),t.modified.forEach((function(e){var t=e.hierarchyModificationDataToWrite;t&&(n.has(e)?n.set(e,F(F({},n.get(e)),t)):n.set(e,t))}))};for(c.s();!(s=c.n()).done;)d()}catch(e){c.e(e)}finally{c.f()}break;case ch:var h,f=function(e,t){e.forEach((function(e){t.push(e),e.children&&f(e.children,t)}))},v=D(e.stores);try{for(v.s();!(h=v.n()).done;){var g=h.value;if(e.inversed){var m=o("added",g.id);f(e.childModels,m)}else{var p=o("removed",g.id);f(e.childModels,p)}}}catch(e){v.e(e)}finally{v.f()}break;case dh:case hh:n.has(e.model)?n.set(e.model,F(F({},n.get(e.model)),e.newData)):n.set(e.model,F({},e.newData))}};for(l.s();!(t=l.n()).done;)s()}catch(e){l.e(e)}finally{l.f()}if(n.size>0&&(r.updated=n),Object.keys(r).length>0)return r}},{key:"markCurrentTransactionContentUserInput",value:function(){var e=this.inputGeneration+1,t=this[Wd],n=!1;t.forEach((function(t){t.isUserInput!==i||t.isCalculated||(t.isUserInput=e,n=!0)})),n&&(this.inputGeneration=e)}},{key:"markCurrentTransactionContentCalculated",value:function(){var e=this.inputGeneration;this[Wd].forEach((function(t){t.isCalculated!==i||t.isUserInput||(t.isCalculated=e)}))}},{key:"normalizeUserInputGeneration",value:function(){var e=this;this[Wd].forEach((function(t){return t.isUserInput=e.inputGeneration}))}}],[{key:"configurable",get:function(){return{title:null,committed:!1,inputGeneration:0}}},{key:"from",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},n=new this(F(F(F({},this.initialConfig),t),{},{inputGeneration:e.reduce((function(e,t){var n;return Math.max(e,null!==(n=t.inputGeneration)&&void 0!==n?n:0)}),0),committed:!1}));return n[Wd]=e.flatMap((function(e){return e[Wd].filter((function(n){return e.inputGeneration>0?t.conflictResolutionFor?n.isUserInput===e.inputGeneration:n.isUserInput:n}))})),n}},{key:"createTransactionWithOriginalInput",value:function(e){var t=new this(F(F({},this.initialConfig),{},{title:e.title,committed:!1}));return t[Wd]=e[Wd].filter((function(e){return e.isUserInput?1===e.isUserInput:!e.isUserInput})),t}}])}(Mn);Jh._$name="Transaction";var Qh=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(e){return 0<e.position&&e.position<=e.length}},{key:"canRedo",value:function(e){return 0<=e.position&&e.position<e.length}},{key:"canCheckoutTo",value:function(e,t){return e.revisionsEnabled?!!e[$d].includes(t)||(console.warn("Revision is not found"),!1):(console.warn("Revisions are disabled"),!1)}},{key:"onUndo",value:function(e,t){var n=e.position,r=e[zd],i=Math.max(0,n-t);return[S(S({},Vd,"restoringstate"),jd,i),function(){e.notifyStoresAboutStateRestoringStart();for(var t=[];n!==i;){var a=r[--n];a.undo(),t.push(a)}return[e.autoRecord?"autoreadystate":"readystate",function(){e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:t})}]}]}},{key:"onRedo",value:function(e,t){var n=e.position,r=e[zd],i=Math.min(r.length,n+t);return[S(S({},Vd,"restoringstate"),jd,i),function(){e.notifyStoresAboutStateRestoringStart();var t=[];do{var a=r[n++];a.redo(),t.push(a)}while(n!==i);return[e.autoRecord?"autoreadystate":"readystate",function(){e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:t})}]}]}},{key:"onCheckoutTo",value:function(e,t){var n=e[$d].indexOf(t),r=Math.min(n,e[Gd]),i=Math.max(n,e[Gd]),a=n<e[Gd],o=e[Ud].slice(r,i);a&&(o=o.filter((function(e){return!e.conflictResolutionFor||e.type===Xh})).reverse(),e[Ud].filter((function(e,t){return t>=r&&e.dummy})).forEach((function(t){e[Ud].splice(e[Ud].indexOf(t),1),e[$d].splice(e[$d].indexOf(t.title),1)})));return[S(S({},Vd,"checkoutstate"),Gd,n),function(){e.notifyStoresAboutCheckoutStart();var t,n=D(o);try{for(n.s();!(t=n.n()).done;){t.value[a?"undo":"redo"]()}}catch(e){n.e(e)}finally{n.f()}}]}},{key:"onCheckoutToHead",value:function(e){Hd()}},{key:"onEnable",value:function(){Hd()}},{key:"onDisable",value:function(){return"disabledstate"}},{key:"onAutoRecordOn",value:function(){return S(S({},Vd,"autoreadystate"),Xd,!0)}},{key:"onAutoRecordOff",value:function(){Hd()}},{key:"onStartTransaction",value:function(e,t){var n=new Jh({title:t});return[S(S({},Vd,"recordingstate"),qd,n),function(){e.notifyStoresAboutStateRecordingStart(n)}]}},{key:"onStopTransaction",value:function(){Hd()}},{key:"onStopTransactionDelayed",value:function(){Hd()}},{key:"onRejectTransaction",value:function(){Hd()}},{key:"onResetQueue",value:function(e,t){return th(e,t)}},{key:"onModelUpdate",value:function(){}},{key:"onModelInsertChild",value:function(){}},{key:"onModelRemoveChild",value:function(){}},{key:"onStoreModelAdd",value:function(){}},{key:"onStoreModelInsert",value:function(){}},{key:"onStoreModelRemove",value:function(){}},{key:"onStoreRemoveAll",value:function(){}}])}(Bd),ef=new Qh;Qd("readystate",ef);var tf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(){return!1}},{key:"canRedo",value:function(){return!1}},{key:"canCheckoutTo",value:function(){return!1}},{key:"onEnable",value:function(){}},{key:"onDisable",value:function(e){var t=e[qd];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),S(S({},Vd,"disabledstate"),qd,null)}},{key:"onAutoRecordOn",value:function(e){return[S(S({},Vd,"autorecordingstate"),Xd,!0),function(){e.stopTransactionDelayed()}]}},{key:"onAutoRecordOff",value:function(){Hd()}},{key:"onStartTransaction",value:function(){Hd()}},{key:"onStopTransaction",value:function(e,t){var n=e[qd],r=e[zd],i=e[jd];return n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),r[i]=n,r.length=++i),[S(S(S({},Vd,"readystate"),jd,i),qd,null),function(){e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}},{key:"onRejectTransaction",value:function(e){var t=e[qd];return[S(S({},Vd,"restoringstate"),qd,null),function(){return t.length&&t.undo(),["readystate",function(){e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}]}]}},{key:"onStopTransactionDelayed",value:function(){Hd()}},{key:"onResetQueue",value:function(e,t){return th(e,t)}},{key:"onModelUpdate",value:function(e,t,n,r,i){e[qd].addAction(e.makeModelUpdateAction(t,n,r,i))}},{key:"onModelInsertChild",value:function(e,t,n,r,i,a){var o=e[qd],l=t.stores.filter((function(t){return e.stores.includes(t)}));o.addAction(e.makeModelInsertChildAction(t,n,r,i,a,l))}},{key:"onModelRemoveChild",value:function(e,t,n,r){var i=e[qd],a=t.stores.filter((function(t){return e.stores.includes(t)}));i.addAction(e.makeModelRemoveChildAction(t,n,r,a))}},{key:"onStoreModelAdd",value:function(e,t,n,r){e[qd].addAction(e.makeStoreModelAddAction(t,n,r))}},{key:"onStoreModelInsert",value:function(e,t,n,r,i,a){var o=e[qd],l=e.makeStoreModelInsertAction(t,n,r,i,a);l.reportUndoneRemoval=!e.revisionsEnabled,o.addAction(l)}},{key:"onStoreModelRemove",value:function(e,t,n,r,i){e[qd].addAction(e.makeStoreModelRemoveAction(t,n,r,i))}},{key:"onStoreRemoveAll",value:function(e,t,n,r){e[qd].addAction(e.makeStoreRemoveAllAction(t,n,r))}}])}(Bd),nf=new tf;Qd("recordingstate",nf);var rf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(){return!1}},{key:"canRedo",value:function(){return!1}},{key:"canCheckoutTo",value:function(){return!1}},{key:"onUndo",value:function(){Hd()}},{key:"onRedo",value:function(){Hd()}},{key:"onEnable",value:function(){Hd()}},{key:"onDisable",value:function(){Hd()}},{key:"onAutoRecordOn",value:function(){return S({},Xd,!0)}},{key:"onAutoRecordOff",value:function(){return S({},Xd,!1)}},{key:"onStartTransaction",value:function(){Hd()}},{key:"onStopTransaction",value:function(){Hd()}},{key:"onStopTransactionDelayed",value:function(){Hd()}},{key:"onRejectTransaction",value:function(){Hd()}},{key:"onQueueReset",value:function(){Hd()}},{key:"onModelUpdate",value:function(){}},{key:"onModelInsertChild",value:function(){}},{key:"onModelRemoveChild",value:function(){}},{key:"onStoreModelAdd",value:function(){}},{key:"onStoreModelInsert",value:function(){}},{key:"onStoreModelRemove",value:function(){}},{key:"onStoreRemoveAll",value:function(){}}])}(Bd);S(rf,"$name","RestoringStateClass");var af=new rf;Qd("restoringstate",af);var of=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onAutoRecordOn",value:function(){Hd()}},{key:"onAutoRecordOff",value:function(){return S(S({},Vd,"readystate"),Xd,!1)}},{key:"onStartTransaction",value:function(e,t){var n=new Jh({title:t});return[S(S({},Vd,"autorecordingstate"),qd,n),function(){e.notifyStoresAboutStateRecordingStart(n),e.stopTransactionDelayed()}]}},{key:"onModelUpdate",value:function(e,t,n,r){e.startTransaction(),e.onModelUpdate(t,n,r)}},{key:"onModelInsertChild",value:function(e,t,n,r,i){e.startTransaction(),e.onModelInsertChild(t,n,r,i)}},{key:"onModelRemoveChild",value:function(e,t,n,r){e.startTransaction(),e.onModelRemoveChild(t,n,r)}},{key:"onStoreModelAdd",value:function(e,t,n,r){e.startTransaction(),e.onStoreModelAdd(t,n,r)}},{key:"onStoreModelInsert",value:function(e,t,n,r,i,a){e.startTransaction(),e.onStoreModelInsert(t,n,r,i,a)}},{key:"onStoreModelRemove",value:function(e,t,n,r,i){e.startTransaction(),e.onStoreModelRemove(t,n,r,i)}},{key:"onStoreRemoveAll",value:function(e,t,n,r){e.startTransaction(),e.onStoreRemoveAll(t,n,r)}}])}(Qh),lf=new of;Qd("autoreadystate",lf);var sf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onDisable",value:function(e){var t=e[qd],n=e[Kd];return n&&this.clearTimeout(n),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),S(S(S({},Vd,"disabledstate"),qd,null),Kd,null)}},{key:"onAutoRecordOn",value:function(e){Hd()}},{key:"onAutoRecordOff",value:function(e){var t=e[Kd];return t&&this.clearTimeout(t),S(S(S({},Vd,"recordingstate"),Xd,!1),Kd,null)}},{key:"onStopTransaction",value:function(e,t){var n=e[qd],r=e[Kd],i=e[zd],a=e[jd];return r&&this.clearTimeout(r),n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),i[a]=n,i.length=++a),[S(S(S(S({},Vd,"autoreadystate"),jd,a),qd,null),Kd,null),function(){e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}},{key:"onStopTransactionDelayed",value:function(e){var t=e[Kd];return t&&this.clearTimeout(t),t=this.setTimeout((function(){e.stopTransaction()}),e.autoRecordTransactionStopTimeout),S(S({},Vd,uf),Kd,t)}},{key:"onResetQueue",value:function(e,t){return th(e,t)}},{key:"onRejectTransaction",value:function(e){var t=e[qd],n=e[Kd];return n&&this.clearTimeout(n),[S(S(S({},Vd,"restoringstate"),qd,null),Kd,null),function(){return t.length&&t.undo(),["autoreadystate",function(){e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}]}]}},{key:"onModelUpdate",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onModelUpdate",this,3)([e].concat(r)),e.stopTransactionDelayed()}},{key:"onModelInsertChild",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onModelInsertChild",this,3)([e].concat(r)),e.stopTransactionDelayed()}},{key:"onModelRemoveChild",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onModelRemoveChild",this,3)([e].concat(r)),e.stopTransactionDelayed()}},{key:"onStoreModelAdd",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onStoreModelAdd",this,3)([e].concat(r)),e.stopTransactionDelayed()}},{key:"onStoreModelInsert",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onStoreModelInsert",this,3)([e].concat(r)),e.stopTransactionDelayed()}},{key:"onStoreModelRemove",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onStoreModelRemove",this,3)([e].concat(r)),e.stopTransactionDelayed()}},{key:"onStoreRemoveAll",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"onStoreRemoveAll",this,3)([e].concat(r)),e.stopTransactionDelayed()}}])}(tf.mixin($i)),uf=new sf;Qd("autorecordingstate",uf);var cf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(e){return!1}},{key:"canRedo",value:function(e){return!1}},{key:"onUndo",value:function(e){Hd()}},{key:"onRedo",value:function(e){Hd()}},{key:"onStartRevision",value:function(e,t){var n=new Jh({title:t});return[S(S({},Vd,"revisionrecordingstate"),qd,n),function(){e.notifyStoresAboutRevRecordingStart()}]}},{key:"onStartTemporaryRevision",value:function(e,t,n){var r=new Jh({title:t});return n&&(r[Wd]=n[Wd].slice()),[S(S({},Vd,"temporaryrevisionrecordingstate"),qd,r),function(){e.notifyStoresAboutTempRevRecordingStart()}]}},{key:"onCheckoutToHead",value:function(e){return e.notifyStoresAboutCheckoutToHead({revision:e[$d][e[$d].length-1]}),e.autoRecord?"autoreadystate":"readystate"}},{key:"onStartTransaction",value:function(e){Hd()}},{key:"onStopTransaction",value:function(e){Hd()}},{key:"onStopTransactionDelayed",value:function(e){Hd()}},{key:"onRejectTransaction",value:function(e){Hd()}},{key:"onEnable",value:function(e){Hd()}},{key:"onDisable",value:function(e){Hd()}},{key:"onAutoRecordOn",value:function(e){Hd()}},{key:"onAutoRecordOff",value:function(e){Hd()}},{key:"onResetQueue",value:function(e){Hd()}},{key:"onModelUpdate",value:function(){}},{key:"onModelInsertChild",value:function(){}},{key:"onModelRemoveChild",value:function(){}},{key:"onStoreModelAdd",value:function(){}},{key:"onStoreModelInsert",value:function(){}},{key:"onStoreModelRemove",value:function(){}},{key:"onStoreRemoveAll",value:function(){}}])}(Qh),df=new cf;Qd("checkoutstate",df);var hf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(e){return!1}},{key:"canRedo",value:function(e){return!1}},{key:"canCheckoutTo",value:function(){return!1}},{key:"onUndo",value:function(e){Hd()}},{key:"onRedo",value:function(e){Hd()}},{key:"onCheckoutToHead",value:function(e){Hd()}},{key:"onStopRevision",value:function(e,t){var n=e[qd],r=e[Ud],i=e[$d],a=e[Gd]+1,o=Jh.createTransactionWithOriginalInput(n);return i.splice(a,0,o.title),r.splice(a-1,0,o),e.commitRevision(o.title),[S(S(S({},Vd,"checkoutstate"),Gd,a),qd,null),function(){e.notifyStoresAboutRevRecordingStop(o)}]}},{key:"onStartTransaction",value:function(e){Hd()}},{key:"onStopTransaction",value:function(e){Hd()}},{key:"onStopTransactionDelayed",value:function(e){Hd()}},{key:"onRejectTransaction",value:function(e){Hd()}},{key:"onEnable",value:function(e){Hd()}},{key:"onDisable",value:function(e){Hd()}},{key:"onAutoRecordOn",value:function(e){Hd()}},{key:"onAutoRecordOff",value:function(e){Hd()}},{key:"onResetQueue",value:function(e){Hd()}}])}(tf),ff=new hf;Qd("revisionrecordingstate",ff);var vf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"canUndo",value:function(e){return!1}},{key:"canRedo",value:function(e){return!1}},{key:"canCheckoutTo",value:function(){return!1}},{key:"onUndo",value:function(e){Hd()}},{key:"onRedo",value:function(e){Hd()}},{key:"onCheckoutToHead",value:function(e){Hd()}},{key:"onStopRevision",value:function(e,t){var n=e[qd];return[S(S({},Vd,"checkoutstate"),qd,null),function(){e.notifyStoresAboutTempRevRecordingStop(n)}]}},{key:"onStartTransaction",value:function(e){Hd()}},{key:"onStopTransaction",value:function(e){Hd()}},{key:"onStopTransactionDelayed",value:function(e){Hd()}},{key:"onRejectTransaction",value:function(e){Hd()}},{key:"onEnable",value:function(e){Hd()}},{key:"onDisable",value:function(e){Hd()}},{key:"onAutoRecordOn",value:function(e){Hd()}},{key:"onAutoRecordOff",value:function(e){Hd()}},{key:"onResetQueue",value:function(e){Hd()}}])}(tf),gf=new vf;Qd("temporaryrevisionrecordingstate",gf);var mf=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=e.state,o=t.call.apply(t,[e[Vd],e].concat(r));if("string"==typeof o)e[Vd]=eh(o);else if(o instanceof Bd)e[Vd]=o;else if(Array.isArray(o)){var l=_(o,2),s=l[0],u=l[1];"string"==typeof s?e[Vd]=eh(s):s instanceof Bd?e[Vd]=s:s&&"object"===W(s)&&((e=Object.assign(e,s))[Vd]=eh(e[Vd])),"function"==typeof u&&mf.apply(void 0,[e,u].concat(r))}else o&&"object"===W(o)&&((e=Object.assign(e,o))[Vd]=eh(e[Vd]));a!==ef&&a!==lf&&o!==ef&&o!==lf&&e.trigger("ready")},pf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){Object.assign(this,S(S(S(S(S(S(S(S(S({},Vd,ef),Nd,[]),zd,[]),jd,0),qd,null),Kd,null),Xd,!1),Zd,!1),"stashedTransactions",{}));for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"construct",this,3)(n)}},{key:"state",get:function(){return this[Vd]}},{key:"position",get:function(){return this[jd]}},{key:"length",get:function(){return this[zd].length}},{key:"stores",get:function(){return Array.from(this[Nd])}},{key:"hasStore",value:function(e){return this[Nd].includes(e)}},{key:"addStore",value:function(e){var t=this;this.hasStore(e)||(this[Nd].push(e),e.stm=this,e.forEach((function(e){return e.stm=t})),e.isTree&&(e.rootNode.stm=this))}},{key:"removeStore",value:function(e){this.hasStore(e)&&(this[Nd]=this[Nd].filter((function(t){return t!==e})),e.stm=null,e.forEach((function(e){return e.stm=null})))}},{key:"forEachStore",value:function(e){this[Nd].forEach((function(t){return e(t,t.id)}))}},{key:"disabled",get:function(){return this.state===rh},set:function(e){var t=this;t.disabled!==e&&(mf(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}},{key:"enabled",get:function(){return!this.disabled}},{key:"enable",value:function(){this.disabled=!1}},{key:"disable",value:function(){this.disabled=!0}},{key:"isReady",get:function(){return this.state===ef||this.state===lf}},{key:"waitForReadiness",value:function(){return this.await("ready",!1)}},{key:"isRecording",get:function(){return this.state===nf||this.state===uf}},{key:"isApplyingStash",get:function(){return this[Zd]}},{key:"shouldRecordAction",get:function(){return this.enabled&&(!this.isRestoringState||this.isApplyingStash)&&!this.isCheckingOut}},{key:"autoRecord",get:function(){return this[Xd]},set:function(e){var t=this;t.autoRecord!=e&&mf(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}},{key:"startTransaction",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null;mf(this,this.state.onStartTransaction,e)}},{key:"stopTransaction",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,t=this;t.autoRecord&&t.autoRecordMergeUpdateActions&&t.mergeTransactionUpdateActions(),t.mergeAddUpdateActions&&t.mergeTransactionAddUpdateActions(),mf(t,t.state.onStopTransaction,e)}},{key:"stopTransactionDelayed",value:function(){mf(this,this.state.onStopTransactionDelayed)}},{key:"rejectTransaction",value:function(){mf(this,this.state.onRejectTransaction)}},{key:"transaction",get:function(){return this[qd]}},{key:"queue",get:function(){return this[zd].map((function(e){return e.title}))}},{key:"rawQueue",get:function(){return this[zd]}},{key:"isRestoringState",get:function(){return this.state===af}},{key:"isRestoring",get:function(){return this.state===af||this.isApplyingStash||this.isNavigatingRevisions}},{key:"canUndo",get:function(){return this.state.canUndo(this)}},{key:"canRedo",get:function(){return this.state.canRedo(this)}},{key:"undo",value:(o=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:1;return L().mark((function n(){return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isReady){n.next=3;break}return n.next=3,e.waitForReadiness();case 3:mf(e,e.state.onUndo,t);case 4:case"end":return n.stop()}}),n)}))()})),function(){return o.apply(this,arguments)})},{key:"undoAll",value:(a=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return e.next=3,this.waitForReadiness();case 3:this.undo(this.length);case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"redo",value:(r=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:1;return L().mark((function n(){return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isReady){n.next=3;break}return n.next=3,e.waitForReadiness();case 3:mf(e,e.state.onRedo,t);case 4:case"end":return n.stop()}}),n)}))()})),function(){return r.apply(this,arguments)})},{key:"redoAll",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return e.next=3,this.waitForReadiness();case 3:this.redo(this.length);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"resetQueue",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{undo:!0,redo:!0,revision:!0};mf(this,this.state.onResetQueue,e)}},{key:"resetUndoQueue",value:function(){this.resetQueue({undo:!0})}},{key:"resetRedoQueue",value:function(){this.resetQueue({redo:!0})}},{key:"resetRevisionQueue",value:function(){this.resetQueue({revision:!0})}},{key:"notifyStoresAboutStateRecordingStart",value:function(e){var t=this;this.forEachStore((function(n){var r;return null===(r=n.onStmRecordingStart)||void 0===r?void 0:r.call(n,t,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}},{key:"notifyStoresAboutStateRecordingStop",value:function(e,t){var n=this;n.forEachStore((function(r){var i;return null===(i=r.onStmRecordingStop)||void 0===i?void 0:i.call(r,n,e,t)})),n.trigger("recordingStop",{stm:n,transaction:e,reason:t}),n.revisionsEnabled&&t.stop&&n.increaseRevision(Jh.from([e]))}},{key:"notifyStoresAboutStateRestoringStart",value:function(){var e=this;this.forEachStore((function(t){var n;return null===(n=t.onStmRestoringStart)||void 0===n?void 0:n.call(t,e)})),this.trigger("restoringStart",{stm:this})}},{key:"notifyStoresAboutStateRestoringStop",value:function(e){var t=e.cause,n=e.transactions,r=this;if(r.forEachStore((function(e){var t;return null===(t=e.onStmRestoringStop)||void 0===t?void 0:t.call(e,r)})),r.trigger("restoringStop",{stm:r,cause:t,transactions:n}),r.revisionsEnabled)if(r.asyncUndoRedo){r.trigger("increaseRevisionAsync",{callback:function(){var e=Jh.from(n);r.increaseRevision("undo"===t?e.invert():e)}})}else{var i=Jh.from(n);r.increaseRevision("undo"===t?i.invert():i)}}},{key:"notifyStoresAboutQueueReset",value:function(e){var t=this;this.forEachStore((function(n){var r;return null===(r=n.onStmQueueReset)||void 0===r?void 0:r.call(n,t,e)})),this.trigger("queueReset",{stm:this,options:e})}},{key:"notifyStoresAboutCheckoutStart",value:function(){this.trigger("checkoutStart",{stm:this})}},{key:"notifyStoresAboutRevRecordingStart",value:function(){this.trigger("revisionRecordingStart",{stm:this})}},{key:"notifyStoresAboutTempRevRecordingStart",value:function(){this.trigger("temporaryRevisionRecordingStart",{stm:this})}},{key:"notifyStoresAboutRevRecordingStop",value:function(e){this.trigger("revisionRecordingStop",{stm:this,revision:e.title})}},{key:"notifyStoresAboutTempRevRecordingStop",value:function(e){this.trigger("temporaryRevisionRecordingStop",{stm:this,revision:e.title})}},{key:"notifyStoresAboutCheckoutToHead",value:function(e){var t=e.revision;this.trigger("checkoutToHead",{stm:this,revision:t})}},{key:"onModelUpdate",value:function(e,t,n,r){mf(this,this.state.onModelUpdate,e,t,n,r)}},{key:"onModelInsertChild",value:function(e,t,n,r,i){mf(this,this.state.onModelInsertChild,e,t,n,r,i)}},{key:"onModelRemoveChild",value:function(e,t,n){mf(this,this.state.onModelRemoveChild,e,t,n)}},{key:"onStoreModelAdd",value:function(e,t,n){mf(this,this.state.onStoreModelAdd,e,t,n)}},{key:"onStoreModelInsert",value:function(e,t,n,r,i){mf(this,this.state.onStoreModelInsert,e,t,n,r,i)}},{key:"onStoreModelRemove",value:function(e,t,n,r){mf(this,this.state.onStoreModelRemove,e,t,n,r)}},{key:"onStoreRemoveAll",value:function(e,t,n){mf(this,this.state.onStoreRemoveAll,e,t,n)}},{key:"onUndoKeyPress",value:function(e){var t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}},{key:"stash",value:function(){var e=this;if(e.transaction){var t=ba.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[t]=e.transaction,e.rejectTransaction(),t}}},{key:"applyStash",value:function(e){var t=this,n=t.stashedTransactions[e];t[Zd]=!0,n&&(t.startTransaction(n.title),n.redo(),delete t.stashedTransactions[e]),t[Zd]=!1}},{key:"mergeTransactionUpdateActions",value:function(){(arguments.length>0&&arguments[0]!==i?arguments[0]:this.transaction).mergeUpdateModelActions()}},{key:"mergeTransactionAddUpdateActions",value:function(){(arguments.length>0&&arguments[0]!==i?arguments[0]:this.transaction).mergeAddUpdateModelActions()}},{key:"canCheckoutTo",value:function(e){return(this.isReady||this.state===df)&&this.state.canCheckoutTo(this,e)}},{key:"currentRevision",get:function(){if(this.revisionsEnabled)return this[$d][this[Gd]]}},{key:"lastRevision",get:function(){if(this.revisionsEnabled)return this[$d][this[$d].length-1]}},{key:"currentRevisionTransaction",get:function(){if(this.revisionsEnabled)return this[Ud][this[Gd]-1]}},{key:"lastCommittedRevision",get:function(){for(var e,t=this[Ud],n=t.length-1;n>=0;n--)if(t[n].committed){e=t[n];break}return e}},{key:"lastCommittedRevisionId",get:function(){var e,t;return null!==(e=null===(t=this.lastCommittedRevision)||void 0===t?void 0:t.title)&&void 0!==e?e:this[$d][0]}},{key:"localRevisions",get:function(){return this[Ud].slice(this[Ud].findIndex((function(e){return!e.committed})))}},{key:"isCheckingOut",get:function(){return this.state===df}},{key:"isRecordingRevision",get:function(){return this.state===ff}},{key:"isRecordingTemporaryRevision",get:function(){return this.state===gf}},{key:"isNavigatingRevisions",get:function(){return this.state===df||this.state===ff||this.state===gf}},{key:"initRevision",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this;n.revisionsEnabled&&(n.autoRecord=t,n[$d]=[e],n[Ud]=[],n[Gd]=0)}},{key:"increaseRevision",value:function(e,t){var n,r=this;if(!($d in r))throw new Error("Revisions should be initialized first with `project.initRevisions(<client id>)` call");if(r.revisionsEnabled){if(r.isNavigatingRevisions&&!e.type)throw new Pd("Cannot add new revision when in the checkout state");if(e[Wd].length||e.type){var i=ba.generateId(r.revisionLocalPrefix);if(e.title=i,!1!==r.trigger("beforeRevisionAdd",{localRevisionId:i})){var a=e.conflictResolutionFor&&r[Ud].find((function(t){return t.type===Xh&&t.conflictResolutionFor===e.conflictResolutionFor}));if(a?(r[$d].splice(r[$d].indexOf(a.title),1,i),r[Ud].splice(r[Ud].indexOf(a),1,e)):(r[$d].push(i),r[Ud].push(e)),e.conflictResolutionFor||(r[Gd]=r[$d].length-1),e.type!==Xh){e.filterUserInput&&(e.conflictResolutionFor||e.normalizeUserInputGeneration(),n=e.getUserInput()),!t&&r[Ud].length>r.revisionQueueMaxLength&&!e.type&&r.cleanUpRevisions();var o={localRevisionId:i,userInput:n};e.conflictResolutionFor&&(o.conflictResolutionFor=e.conflictResolutionFor,o.revisionChanges=t),r.trigger("revisionAdd",o)}}}}}},{key:"createDataCorrectionTransaction",value:function(){var e=new Jh({type:Kh});this.increaseRevision(e)}},{key:"createConflictResolutionRevision",value:function(e,t,n){var r=this.transaction;if(n=Be.clone(n),t){var i=this[Ud].find((function(e){return e.conflictResolutionFor===t}));i&&(i.conflictResolutionFor=e)}this.increaseRevision(Jh.from([r],{conflictResolutionFor:null!=e?e:r.title,type:Zh}),n)}},{key:"createTemporaryConflictResolutionRevision",value:function(e,t){var n=this.transaction;this.increaseRevision(Jh.from([n],{conflictResolutionFor:null!=e?e:n.title,type:Xh}),t)}},{key:"checkoutTo",value:function(e){if(!this.canCheckoutTo(e))return!1;mf(this,this.state.onCheckoutTo,e)}},{key:"checkoutToLastCommittedRevision",value:function(){this.checkoutTo(this.lastCommittedRevisionId)}},{key:"checkoutToHead",value:function(){this.checkoutTo(this[$d][this[$d].length-1]),mf(this,this.state.onCheckoutToHead)}},{key:"checkoutToNext",value:function(){return this[Gd]+1<this[$d].length&&this.checkoutTo(this[$d][this[Gd]+1])}},{key:"startRevision",value:function(e){mf(this,this.state.onStartRevision,e)}},{key:"stopRevision",value:function(){mf(this,this.state.onStopRevision)}},{key:"startTemporaryRevision",value:function(e,t){mf(this,this.state.onStartTemporaryRevision,e,t)}},{key:"stopTemporaryRevision",value:function(){mf(this,this.state.onStopRevision)}},{key:"commitRevision",value:function(e,t){for(var n=this[$d],r=this[Ud],i=r.find((function(t){return t.title===e})),a=r.indexOf(i)-1;a>=0;a--)if(!1===r[a].committed&&r[a].type!==Xh&&!r[a].conflictResolutionFor)throw new Pd("Cannot commit revision because it is preceded by an uncommitted rev id ".concat(r[a].title),r);if(t){if(n.includes(t))throw new Pd("Proposed revision id (".concat(t,") already exists"));i.title=n[n.indexOf(i.title)]=t,r.forEach((function(n){n.type===Xh&&n.conflictResolutionFor===e&&(n.conflictResolutionFor=t)}))}i.committed=!0}},{key:"cleanUpRevisions",value:function(){for(var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.revisionQueueCommittedMinLength,t=this[$d],n=this[Ud],r=[],a=0;a<n.length;a++){var o=n[a];if(!o.committed)break;r.push(o)}r.splice(Math.max(0,r.length-1-e),Math.min(r.length,e)),n.splice(0,r.length),t.splice(1,r.length)}},{key:"markCurrentTransactionContentUserInput",value:function(){(this.isRecording||this.isRecordingRevision||this.isRecordingTemporaryRevision)&&this.transaction.markCurrentTransactionContentUserInput()}},{key:"markCurrentTransactionContentCalculated",value:function(){(this.isRecording||this.isRecordingRevision||this.isRecordingTemporaryRevision)&&this.transaction.markCurrentTransactionContentCalculated()}}],[{key:"defaultConfig",get:function(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,autoRecordMergeUpdateActions:!0,mergeAddUpdateActions:!1,makeModelUpdateAction:jh,makeModelInsertChildAction:Wh,makeModelRemoveChildAction:$h,makeStoreModelAddAction:Uh,makeStoreModelInsertAction:Gh,makeStoreModelRemoveAction:Yh,makeStoreRemoveAllAction:qh,getTransactionTitle:null,revisionsEnabled:!1,asyncUndoRedo:!1,revisionLocalPrefix:"local-",revisionQueueMaxLength:20,revisionQueueCommittedMinLength:1}}}]);var n,r,a,o}(_n(Mn));S(pf,"$name","StateTrackingManager"),pf._$name="StateTrackingManager";var yf=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeStm",value:function(e,t){var n;return null!=t&&null!==(n=t.hasStore)&&void 0!==n&&n.call(t,this)&&t.removeStore(this),e&&(e.isStateTrackingManager||(e=new pf(e)),e.hasStore(this)||e.addStore(this)),e}},{key:"add",value:function(e){var n,r,a=arguments.length>1&&arguments[1]!==i&&arguments[1],o=arguments.length>2&&arguments[2]!==i?arguments[2]:{},l=this.stm;!this.tree&&null!=l&&l.shouldRecordAction?null!==(r=n=B(t,"add",this,3)([e,a,o]))&&void 0!==r&&r.length&&l.onStoreModelAdd(this,n,a):n=B(t,"add",this,3)([e,a,o]);return n}},{key:"insert",value:function(e,n){var r,o=this,l=arguments.length>2&&arguments[2]!==i&&arguments[2],s=this.stm;if(!this.tree&&null!=s&&s.shouldRecordAction){var u,c=(Array.isArray(n)?n:[n]).reduce((function(e,t){var n=t instanceof od?o.indexOf(t):i;return n!==i&&-1!==n&&e.set(t,n),e}),new a);null!==(u=r=B(t,"insert",this,3)([e,n]))&&void 0!==u&&u.length&&(e=this.indexOf(r[0]),s.onStoreModelInsert(this,e,r,c,l))}else r=B(t,"insert",this,3)([e,n,l]);return r}},{key:"remove",value:function(e){var n,r=this,o=arguments.length>1&&arguments[1]!==i&&arguments[1],l=arguments.length>2?arguments[2]:i,s=this.stm;if(!this.tree&&null!=s&&s.shouldRecordAction){var u,c=(Array.isArray(e)?e:[e]).map((function(e){return r.getById(e)})).filter((function(e){return Boolean(e)})).reduce((function(e,t){var n=r.indexOf(t);return n!==i&&-1!==n&&e.set(t,n),e}),new a);null!==(u=n=B(t,"remove",this,3)([e,o,l]))&&void 0!==u&&u.length&&s.onStoreModelRemove(this,n,c,o)}else n=B(t,"remove",this,3)([e,o,l]);return n}},{key:"removeAll",value:function(e){var n,r=this.stm;if(null!=r&&r.shouldRecordAction){var i=this.tree,a=this.rootNode,o=this.allRecords,l=o.length,s=i?a.children.slice():o.slice();n=B(t,"removeAll",this,3)([e]),l&&0===this.count&&r.onStoreRemoveAll(this,s,e)}else n=B(t,"removeAll",this,3)([e]);return n}},{key:"beforeApplyChangeset",value:function(){var e=this.stm,t=this.crudManager,n=!1,r=null;return null!=t&&t.applyingChangeset||null==e||!e.enabled||e.isNavigatingRevisions||(n=!0,e.isRecording&&(r=e.stash()),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),{shouldResume:n,transactionId:r}}},{key:"applyChangeset",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=this.beforeApplyChangeset(),o=a.shouldResume,l=a.transactionId,s=B(t,"applyChangeset",this,3)([e].concat(r));return this.afterApplyChangeset(o,l),s}},{key:"afterApplyChangeset",value:function(e,t){if(e){var n=this.stm;this.ignoreRemoteChangesInSTM?n.enable():n.stopTransaction(),n.applyStash(t)}}}])}(e||Mn),S(t,"$name","StoreStm"),S(t,"configurable",{stm:null,ignoreRemoteChangesInSTM:!1}),t},kf=["isReload"],bf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isLoading",get:function(){return this.client._isLoading||Object.values(this.loadQueue).some((function(e){return Be.isPromise(e)}))}},{key:"storage",get:function(){return this.client.storage}},{key:"totalCount",get:function(){return this._totalCount},set:function(e){this._totalCount=e}},{key:"setEstimatedTotalCount",value:function(e){this.totalCount=e}},{key:"afterConstruct",value:function(){var e=this,t=e.client;t.syncDataOnLoad&&(t.syncDataOnLoad=!1),e.storeListenersDetacher=t.ion({beforeAdd:"internalOnBeforeAdd",beforeRemove:"internalOnBeforeAdd",change:"internalOnChange",commit:"internalOnCommit",endApplyChangeset:"internalOnCommit",appliedCrudChangesToStore:"internalOnCommit",thisObj:e}),t.requestData||(t.requestData=e.requestData),t.autoLoad&&!t.readUrl&&this.requestAnimationFrame(this.doAutoLoad)}},{key:"updateAutoLoad",value:function(e){e&&!this.client.readUrl&&this.doAutoLoad()}},{key:"internalOnBeforeAdd",value:function(){if(this.isLoading)throw new Error("Removing or adding is not allowed when a lazy loaded Store is loading")}},{key:"internalOnChange",value:function(){this.$loadLock||!this.client.added.count&&!this.client.removed.count||(this.$loadLock=new xs)}},{key:"internalOnCommit",value:function(){!this.client.changes&&this.$loadLock&&(this.$loadLock.resolve(),this.$loadLock=null)}},{key:"performDataRequest",value:function(){return this.load()}},{key:"afterLoadData",value:function(){this.totalCount&&(this.storage.values.length=this.totalCount)}},{key:"setStoreData",value:function(e){null!=e&&e.length||!this.client.records.some(Boolean)||this.clear()}},{key:"clear",value:function(){this.totalCount=null,this.loadQueue={}}},{key:"requestData",value:(i=f((function(e){return e.startIndex,e.count,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))()})),function(e){return i.apply(this,arguments)})},{key:"lazyGetAt",value:function(e){return this.getAt(e)}},{key:"getAt",value:(r=f(L().mark((function e(t){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).loadQueue,a=r.totalCount,!(t<0||null!=a&&t>a)){e.next=3;break}return e.abrupt("return",null);case 3:if(!(o=r.getFromStorage(t))){e.next=6;break}return e.abrupt("return",o);case 6:return e.next=8,null===(n=r.$loadLock)||void 0===n?void 0:n.promise;case 8:if(!r.isDestroyed){e.next=10;break}return e.abrupt("return");case 10:if(!i[t]){e.next=15;break}return e.next=13,i[t];case 13:e.next=17;break;case 15:return e.next=17,r.doLazyLoad(r.calculateRange(t));case 17:return e.abrupt("return",r.getFromStorage(t));case 18:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getFromStorage",value:function(e){return this.storage.getAt(e)}},{key:"calculateRange",value:function(e){for(var t=this.totalCount,n=this.loadQueue,r=this.chunkSize,i=Math.max(0,e-r),a=(t?Math.min(e+r,t):e+r)-1,o=e,l=e;o>i&&!n[o-1]&&!this.getFromStorage(o-1);)o-=1;for(;l<a&&!n[l+1]&&!this.getFromStorage(l+1);)l+=1;return{startIndex:o,count:l-o+1}}},{key:"doLazyLoad",value:(n=f((function(e){var t=arguments,n=this,r=e.isReload,i=A(e,kf);return L().mark((function e(){var a,o,l,s,u,c,d,h,f,v,g,m;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n.triggerLazyLoadStart(t[0]),r&&n.clear(),o=(a=n).loadQueue,l=a.client,s=i.startIndex,u=i.count,c=s+u-1,d=l.requestData(l.readUrl?i:l.buildRemoteParams(i)),h=s;h<=c;h++)o[h]=d;return e.next=6,d;case 6:if(f=e.sent){e.next=9;break}return e.abrupt("return");case 9:for(v=f[a.totalCountProperty],g=f[a.dataProperty],m=s;m<=c;m++)o[m]=null;null!=v?a.totalCount=v:null==a.totalCount&&u>g.length&&a.setEstimatedTotalCount(s+g.length),a.addData(g,s,r),null!=a.totalCount&&(a.storage.values.length=a.totalCount),a.triggerLazyLoadEnd(t[0],g);case 15:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"addData",value:function(e,t,n){var r,i=this.client,a=this.storage;if(null!=e&&e.length)if(i.count&&!n||t){for(var o=e.length-1;o>=0;o--){var l=e[o],s=i.idRegister[l.id];s&&(s.setByDataSource(l,!0),s.internalClearChanges(!1,!0,l),e.splice(o,1))}if(e.length){var u=a.values,c=e.map((function(e){return i.processRecord(i.createRecord(e),!0)}));u.length<t&&(u.length=t),null==t&&(t=u.length),u.splice.apply(u,[t,c.length].concat(z(c))),i.joinRecordsToStore(c),null===(r=this.processAddedRecords)||void 0===r||r.call(this,c),i.updateDependentStores("add",c);var d,h=D(c);try{for(h.s();!(d=h.n()).done;){var f=d.value;i.idMap[f.id]={index:t,visibleIndex:t,record:f},t+=1,a.addToIndices(f)}}catch(e){h.e(e)}finally{h.f()}i.trigger("change",{action:"lazyload",records:c})}}else i.data=e}},{key:"checkDuplicates",value:function(e){var t,n=this.storage,r=D(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=n.indexOf(i.id);a>=0&&n.values.splice(a,1)}}catch(e){r.e(e)}finally{r.f()}}},{key:"triggerLazyLoadStart",value:function(e){var t=this;t.isLoading||(t.isConfiguring?t.delay((function(){return t.trigger("lazyLoadStarted",F({},e))}),0):t.client.trigger("lazyLoadStarted",F({},e))),t.client.trigger("beforeLazyLoad",F({},e))}},{key:"triggerLazyLoadEnd",value:function(e,t){this.isLoading||this.client.trigger("lazyLoadEnded"),this.client.trigger("afterLazyLoad",F(F({},e),{},{data:t}))}},{key:"load",value:function(e){return this._loadedOnce=!0,this.doLazyLoad({isReload:Object.keys(this.loadQueue).length,startIndex:0,count:this.chunkSize})}},{key:"doAutoLoad",value:function(){this._loadedOnce||this.load()}},{key:"destroy",value:function(){var e;null===(e=this.storeListenersDetacher)||void 0===e||e.call(this),this.clear(),B(t,"destroy",this,3)([])}}],[{key:"pluginConfig",get:function(){return{override:["updateAutoLoad","performDataRequest"],assign:["load","isLoading","lazyGetAt"],after:["afterLoadData"],before:["setStoreData","destroy"]}}},{key:"properties",get:function(){return{loadQueue:{}}}}]);var n,r,i}(wc.mixin($i));S(bf,"$name","StoreLazyLoadPlugin"),S(bf,"configurable",{totalCountProperty:"total",dataProperty:"data",chunkSize:100}),bf._$name="StoreLazyLoadPlugin";var Cf=["parent","isReload"],wf=function(e){var t,n;return null!==(t=null===(n=e.children)||void 0===n?void 0:n.reduce((function(e,t){var n;return e+(null!==(n=t.remoteChildCount)&&void 0!==n?n:0)+1}),0))&&void 0!==t?t:0},Df=function(e){return wf(e)>=e.remoteChildCount},Sf={splice:1,clear:1},xf={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},Ef=function(e,t){return"boolean"==typeof(t=t||!1)&&(t={includeFilteredOutRecords:t,includeCollapsedGroupRecords:!1}),t||xf},Rf=Symbol("useRawDataUnset"),Tf={enabled:!0,disableDuplicateIdCheck:!0,disableDefaultValue:!1,disableTypeConversion:!1},Mf={enabled:!0,disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},Ff=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return S(e=g(this,t,[].concat(r)),"crudManager",i),e.objectify?I(e,e.initProxy()):e}return R(t,e),w(t,[{key:"updateAutoLoad",value:function(e){!e||this.readUrl||this.lazyLoad||this.requestAnimationFrame(this.performDataRequest)}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};Object.assign(this,{added:new sd,removed:new sd,modified:new sd,idRegister:{},internalIdRegister:{},oldIdMap:{}}),B(t,"construct",this,3)([e]),this.initRelations()}},{key:"equals",value:function(e){return e.isStore&&e.$master===this.$master}},{key:"doDestroy",value:function(){var e,n,r,i,a=this,o=a.registeredRecords;null===(e=a.stm)||void 0===e||null===(n=e.removeStore)||void 0===n||n.call(e,a);for(var l,s=o.length-1;s>=0;s--){var u;null!==(u=l=o[s])&&void 0!==u&&u.isDestroyed||l.unjoinStore(a)}(null===(r=a._storage)||void 0===r||r.destroy(),a.isChained)?a.masterStore.isDestroying||$e.remove(a.masterStore.chainedStores,a):null===(i=a.rootNode)||void 0===i||i.destroy();B(t,"doDestroy",this,3)([])}},{key:"beginBatch",value:function(){this.suspendEvents()}},{key:"endBatch",value:function(){if(this.resumeEvents()){var e=this.storage.values;this.trigger("refresh",{action:"batch",data:e,records:e})}}},{key:"storage",get:function(){return this._storage||(this.storage={}),this._storage},set:function(e){var t=this;null!=e&&e.isCollection?t._storage=e:t._storage=new us(e),t._storage.autoFilter=t.reapplyFilterOnAdd;var n,r=D(t._storage);try{for(r.s();!(n=r.n()).done;){n.value.joinStore(t)}}catch(e){r.e(e)}finally{r.f()}t._storage.ion({change:"onDataChange",thisObj:t})}},{key:"allRecords",get:function(){var e,t=this;if((null===(e=t._allRecords)||void 0===e?void 0:e.generation)!==t.storage.generation){if(t.isTree){var n=t.collectDescendants(t.rootNode,i,i,{unfiltered:!0}).all;t.rootVisible&&n.unshift(t.rootNode),t._allRecords=n}else t._allRecords=t.isGrouped?t.collectGroupRecords(!0,!0):t.storage.allValues;t._allRecords.generation=t.storage.generation}return t._allRecords}},{key:"getAllDataRecords",value:function(e){var t=this;return t.tree?e?t.allRecords:t.rootNode.allChildren:t.isGrouped?t.collectGroupRecords(e,!1):(e?t.storage.allValues:t.storage.values).filter((function(e){return e}))}},{key:"onIsCreatingToggle",value:function(e,t){var n=this,r=e.isPersistable&&!t;n.added[r?"add":"remove"](e),r&&(n.trigger("addConfirmed",{record:e}),n.autoCommit&&n.doAutoCommit())}},{key:"joinRecordsToStore",value:function(e){for(var t=this.totalCount,n=0;n<e.length;n++){var r=e[n];r.setData("parentIndex",t+n-e.length),r.joinStore(this)}}},{key:"onDataChange",value:function(e){var n,r,i=e.source,a=e.action,o=e.added,l=e.removed,s=e.replaced,u=e.oldCount,c=e.items,d=e.from,h=e.to,f=this,v=Sf[a],g=v&&(null==o?void 0:o.length),m=v&&(null==l?void 0:l.length),p=i.generation,y=f.isFiltered&&!f.remoteFilter;if(f._idMap=null,g&&f.joinRecordsToStore(o),null==s||s.forEach((function(e){var t=_(e,2),n=t[0],r=t[1];n.unjoinStore(f,!0),r.joinStore(f)})),B(t,"onDataChange",this,3)(arguments),g&&i.generation!==p&&!y&&f.trigger("refresh",arguments[0]),!f.isTree){if(g){var k,b=D(o);try{for(b.s();!(k=b.n()).done;){var C=k.value;f.removed.includes(C)?f.removed.remove(C):f.addingClean||C.isLinked||f.added.add(C)}}catch(e){b.e(e)}finally{b.f()}(n=!f.remoteFilter&&f.isFiltered&&f.reapplyFilterOnAdd)&&f.filter({silent:!0}),(r=!f.remoteSort&&f.isSorted&&f.reapplySortersOnAdd)&&f.sort(null,null,!1,!0)}if(m){var w,S=D(l);try{for(S.s();!(w=S.n()).done;){var x=w.value;x.cancelBatch(),x.unjoinStore(f),f.added.includes(x)?(f.added.remove(x),x.isBeingMaterialized&&f.removed.add(x)):x._undoingInsertion||x.isCreating||x.isLinked||f.removed.add(x)}}catch(e){S.e(e)}finally{S.f()}f.modified.remove(l),(n=y)&&f.filter({silent:!0})}}switch(a){case"clear":f.relationCache={},f.updateDependentStores("removeall"),f.trigger("removeAll"),f.trigger("change",{action:"removeall"});break;case"splice":if(g){f.updateDependentStores("add",o);var E=o.reduce((function(e,t){var n=t.meta.previousIndex;return n>-1&&n<e&&(e=n),e}),o[0].meta.previousIndex),R={records:o,index:i.indexOf(o[0],!i.autoFilter)};E>-1&&(R.oldIndex=E),f.trigger("add",R),f.trigger("change",Object.assign({action:"add"},R)),n&&f.triggerFilterEvent({action:"filter",filters:f.filters,oldCount:u,records:f.storage.allValues}),r&&f.trigger("sort",{action:"sort",sorters:f.sorters,records:f.storage.allValues})}l.length&&(f.updateDependentStores("remove",l),f.trigger("remove",{records:l}),f.trigger("change",{action:"remove",records:l})),s.length&&(f.updateDependentStores("replace",s),f.trigger("replace",{records:s,all:f.records.length===s.length}),f.trigger("change",{action:"replace",replaced:s,all:f.records.length===s.length}));break;case"filter":(f.isGrouped||f.isSorted)&&f.performSort(!0);break;case"move":for(var T=Math.min(d,h),M=Math.min(f.storage.allValues.length-1,Math.max(d,h)),F=f.storage.allValues,A=T;A<=M;A++)F[A].setData("parentIndex",A);f.trigger("move",{records:c,from:d,to:h}),f.isFiltered&&f.performFilter(),f.trigger("change",{action:a,record:c[0],records:c,from:d,to:h})}}},{key:"onDataReplaced",value:function(e,t){for(var n,r=this,i=r.storage,a=i.allValues,o=Boolean(r.sorters.length>0),l=0;l<a.length;l++){var s;null===(s=a[l])||void 0===s||s.joinStore(r)}if(!r.remoteFilter&&r.isFiltered&&r.filter({silent:!0}),r.remoteSort?r.isGrouped&&i.replaceValues(F(F({},r.prepareGroupRecords()),{},{silent:!0})):(r.isGrouped&&r.group(null,null,!1,!o,!0),o&&r.sort(null,null,!1,!0)),!r.useRawData.disableDuplicateIdCheck){var u=r.idMap;if(Object.keys(u).length<i.values.length){var c=[];throw i.values.forEach((function(e){return u[e.id]?delete u[e.id]:c.push(e)})),new Error("Id collision on ".concat(c.map((function(e){return e.id}))))}}var d={action:e,data:t,records:i.values};r.updateDependentStores(e,d.records),null===(n=r.afterLoadData)||void 0===n||n.call(r),r.isRemoteDataLoading||r.trigger("refresh",d),r.trigger("change",d)}},{key:"onModelChange",value:function(e,t,n,r,i){var a,o=this,l={record:e,records:[e],changes:n,batch:null!=e.batching,fromRelationUpdate:i};if(o.storage.onItemMutation(e,n),"id"in n){var s=t.id,u=s.oldValue,c=s.value;o.updateDependentRecordIds(u,c),o.onRecordIdChange({record:e,oldValue:u,value:c})}else e.meta._ignoreRelatedIdUpdate||o.updateDependentStores("update",[e],r);var d=!e.ignoreBag&&!e.isLinked&&o.updateModifiedBagForRecord(e)&&!(null!==(a=e.meta)&&void 0!==a&&a.pendingFormulae);if(o.onUpdateRecord(e,n),!r){if("id"in n){var h=t.id,f=h.oldValue,v=h.value;o.trigger("idChange",{store:o,record:e,oldValue:f,value:v})}o.trigger("update",l),o.trigger("change",Object.assign({action:"update"},l))}o.autoCommit&&d&&o.doAutoCommit()}},{key:"updateModifiedBagForRecord",value:function(e){var t=this,n=t.modified,r=t.added;if(e.isModified&&!e.isRoot&&t.idRegister[e.id]){var i;if(n.includes(e)||r.includes(e)||(e.isPhantom?r.add(e):n.add(e)),e.isBeingMaterialized)t.modifiedMaterialized=null!==(i=t.modifiedMaterialized)&&void 0!==i?i:new o,t.modifiedMaterialized.add(e);return!0}return n.remove(e),!1}},{key:"idMap",get:function(){var e=this,t=!e._idMap,n=e._idMap||(e._idMap={});if(t){for(var r,i=e.storage.values,a=0,o=0;a<i.length;a++){var l;(r=i[a])&&(n[r.id]={index:a,visibleIndex:o,record:r}),null!==(l=r)&&void 0!==l&&l.isSpecialRow||o++}if(e.isFiltered)for(var s=0,u=e.storage._values.length;s<u;s++){var c=e.storage._values[s];c&&(c.id in n?n[c.id].unfilteredIndex=s:n[c.id]={index:-1,unfilteredIndex:s,record:c})}}return n}},{key:"changeModelClass",value:function(e){var t=this.fields;this.originalModelClass=e;var n=e;if(null!=t&&t.length){var r=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,null,[{key:"fields",get:function(){return t}}])}(e);n=r}else if(!this.preventSubClassingModel){var i=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(e);n=i}return n.initClass(),n}},{key:"$lazyLoadPluginClass",get:function(){return bf}},{key:"changeLazyLoad",value:function(e){var t,n=this,r=n.$lazyLoadPluginClass;n.isTree&&!r.isOfTypeName("DateStoreLazyLoadPlugin")&&(n.treeLazyLoadClass||(n.treeLazyLoadClass=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}((t=function(e){function t(){var e;return m(this,t),(e=g(this,t,arguments)).totalCount=0,e}return R(t,e),w(t,[{key:"load",value:function(){return this._loadedOnce=!0,this.doLazyLoad({parent:this.client.rootNode,isReload:Object.keys(this.loadQueue).length>0,startIndex:0})}},{key:"changeRemoteChildCount",value:function(e,t,n){var r=this;if(null!=e&&e.length)for(var i=e.map((function(e){var t,n,i;return null!==(t=e.parent)&&void 0!==t?t:r.client.getById(null!==(n=e.parentId)&&void 0!==n?n:null===(i=e.originalData)||void 0===i?void 0:i.parentId)}));i.length;){var a,o=i.shift();o&&(o.isRoot||i.push(o.parent),o.remoteChildCount=null!==(a=o.remoteChildCount?o.remoteChildCount+t:o.children.length)&&void 0!==a?a:0,null==n||n.add(o))}}},{key:"internalOnCommit",value:function(e){var n=this,r=e.changes;B(t,"internalOnCommit",this,3)([]);var i=new o;this.changeRemoteChildCount(r.added,1,i),this.changeRemoteChildCount(r.removed,-1,i),i.forEach((function(e){n.loadQueue[e.id]=Df(e)}))}},{key:"loadChildren",value:function(e){return this.doLazyLoad({parent:e,startIndex:0})}},{key:"getAt",value:function(e){var t=this,n=t.loadQueue,r=t.client.records[e];if(r){var i,a=r.parent;!(r.expanded&&r.remoteChildCount>0)||null!==(i=r.children)&&void 0!==i&&i.length||n[r.id]||t.doLazyLoad({parent:r,startIndex:0}),r!==a.lastChild||n[a.id]||t.doLazyLoad({startIndex:r.parentIndex+1,parent:a})}return r}},{key:"doLazyLoad",value:(n=f((function(e){var t=arguments,n=this,r=e.parent,i=e.isReload,a=A(e,Cf);return L().mark((function e(){var o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i&&n.clear(),l=(o=n).client,s=r.id,r.instanceMeta(l).isLoadingChildren=!0,o.triggerLazyLoadStart(t[0]),u=o.loadQueue[s]=l.requestData(F(F({},l.readUrl?a:l.buildRemoteParams(a)),{},{parentId:r.isRoot?"root":s,count:o.chunkSize})),e.next=7,u;case 7:if(c=e.sent,d=c[o.totalCountProperty],h=c[o.dataProperty],o.loadQueue[s]===u){e.next=12;break}return e.abrupt("return");case 12:r.isRoot&&d>=0&&(r.remoteChildCount=d),o.addData(h,r,i),o.totalCount=l.count,o.loadQueue[s]=Df(r),o.isLoading||null===(f=l.trigger)||void 0===f||f.call(l,"refresh",{action:"lazyload"}),o.triggerLazyLoadEnd(t[0],h),r.instanceMeta(l).isLoadingChildren=!1;case 20:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"addData",value:function(e,t,n){var r=this.client,i=this.loadQueue;if(n&&r.clear(!0),r.modelClass.fieldMap.remoteChildCount||r.modelClass.addField("remoteChildCount"),!e.length){var a=wf(t),o=t.remoteChildCount-a;0!==o&&(t.remoteChildCount=a,this.changeRemoteChildCount([t],o))}ld.preWalk({children:e},(function(e){var t=e.children;return null!=t&&t.length?t:null}),(function(e){var t=e.id,n=e.children;t&&e.remoteChildCount>0&&(!1!==e.expanded||null!=n&&n.length?null!=n&&n.length&&!i[t]&&Df(e)?i[t]=!0:n||(e.children=[]):e.children=!0)})),t.appendChild(e,!0),r.added.clear()}}],[{key:"pluginConfig",get:function(){var e,n,r={};for(var i in B(t,"pluginConfig",this))r[i]=z(B(t,"pluginConfig",this)[i]);r.override=null!==(e=r.override)&&void 0!==e?e:[],r.override.push("loadChildren","getAt");var a=null===(n=r.assign)||void 0===n?void 0:n.indexOf("lazyGetAt");return a>=0&&r.assign.splice(a,1),r}}]);var n}(r),S(t,"$name","TreeStoreLazyLoadPlugin"),S(t,"configurable",{chunkSize:50}),t))),r=n.treeLazyLoadClass);var i,a=n.getPlugin(r);if(e){var l=Be.isObject(e);return a?l&&Be.assign(a,e):a=n.addPlugin(r,l?e:null),a}return null===(i=a)||void 0===i||i.destroy(),!1}},{key:"changeId",value:function(e,n){return B(t,"changeId",this,3)([!0!==e&&e,n])}},{key:"updateId",value:function(e,n){var r=t.getById(e);r&&t.unregisterInstance(r),B(t,"updateId",this,3)([e,n])}},{key:"generateAutoId",value:function(){return t.generateId("store-")}},{key:"tree",get:function(){return this._tree},set:function(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}},{key:"autoTree",get:function(){return!1!==this.tree&&this._autoTree}},{key:"buildRootNode",value:function(){return{}}},{key:"rootNode",get:function(){return!this.isChainedTree&&this.masterStore?this.masterStore.rootNode:this._rootNode},set:function(e){var t,n=this,r=n._rootNode;e!==r&&(r&&(n.clear(!0),n.removed.clear()),e instanceof od?(e.instanceMeta(n).collapsed=!1,n._rootNode=e):n._rootNode=e=new n.modelClass(F(S({expanded:!0},n.modelClass.idField,"".concat(n.id,"-rootNode")),e),n,{isRoot:!0},!0),n._tree=!0,e.isRoot=!0,e.joinStore(n),(null!==(t=e.children)&&void 0!==t&&t.length||n.rootVisible)&&(e.isLoading=!0,n.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),n.trigger("rootChange",{oldRoot:r,rootNode:e}))}},{key:"data",get:function(){return this.getAllDataRecords(!0).map((function(e){return e.data}))},set:function(e){this.setStoreData(e)}},{key:"setStoreData",value:function(e){var t,n=this,r=n.modelClass,i=r.idField,a=r.childrenField;e&&!Array.isArray(e)&&(e=Be.transformNamedObjectToArray(e,i));var o,l=ld.walkWhile(null!=e?e:[],(function(e){return e[a]}),Object.isExtensible);(null!==(t=e)&&void 0!==t&&t.length&&!l&&(n.transformFlatData||n.useRawData.enabled)&&(n.transformFlatData&&(n.useRawData=n.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1}),e=Be.clone(e)),n.getConfig("plugins"),n.processConfiguredListeners(),!n.isChained||n.isChainedTree)&&(n.autoTree&&null!==(o=e)&&void 0!==o&&o.some((function(e){return e[a]}))&&(n.tree=!0));if(e&&(n.remoteSort||n.remoteFilter))for(var s=0;s<e.length;s++)e[s]._remoteSortIndex=s;n.syncDataOnLoad&&n._data?n.syncDataset(e):(n._data=e,n.tree?n.loadTreeData(e):n.loadData(e),n.added.clear(),n.removed.clear(),n.modified.clear())}},{key:"loadTreeData",value:function(e){var t=this,n=t.rootNode,r=new a;if(t.transformFlatData&&(e=t.treeifyFlatData(e)),n.isLoading=!0,t.records.length&&t.keepExpandedOnLoad&&t.traverse((function(e){e.isLeaf||r.set(e.id,e.instanceMeta(t).collapsed)})),e.sort((function(e,t){return e.parentIndex-t.parentIndex})),t.clear(!0),t.suspendEvents(!0),n.appendChild(e),r.forEach((function(e,n){var r=t.getById(n);r&&t.toggleCollapse(r,e)})),t.resumeEvents(),t.updateDependentStores("dataset",[n]),n.isLoading=!1,0===e.length){var i={action:"dataset",data:[],records:[]};t.trigger("refresh",i),t.trigger("change",i)}else t.isFiltered&&t.filter()}},{key:"loadData",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"dataset",n=this,r=n.storage,a=n.allowNoId,o=n.modelClass.fieldMap.id.dataSource,l=n.find((function(e){return e.isCreating}));l&&r.values.splice(n.records.indexOf(l),1);var s=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){var u=!(e[0]instanceof od),c=e.length,d=new Array(c);u&&n.modelClass.exposeProperties(e[0]);for(var h=0;h<c;h++){var f=e[h];if(u){var v,g=f[o];if(!a&&null==g)throw new Error("Id required but not found on row ".concat(h));s&&null!=g&&null!==(v=g.startsWith)&&void 0!==v&&v.call(g,"_generated")&&(console.warn("Generated id found in data: ".concat(g,". Generated ids are temporary and should be replaced with real ids by the backend")),s=!1),f=n.createRecord(f,!0)}n.isFillingFromMaster||(f=n.processRecord(f,!0)).setData("parentIndex",h),d[h]=f}n.clear(!0),r.replaceValues({values:d,isNewDataset:!0,silent:!0}),l&&!r.values.includes(l)&&r.values.push(l),n._data=e,n.onDataReplaced(t,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}},{key:"getRange",value:function(e,t){return(!(arguments.length>2&&arguments[2]!==i)||arguments[2]?this.storage.allValues:this.storage.values).slice(e,t)}},{key:"createRecord",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2];return new this._modelClass(e,this,null,t,!1,n)}},{key:"processRecord",value:function(e){return e}},{key:"refreshData",value:function(){this.filter(),this.sort()}},{key:"onRecordIdChange",value:function(e){var t=e.record,n=e.oldValue,r=e.value,i=this,a=i._idMap,o=i.idRegister,l=i.oldIdMap;if(i.storage._indicesInvalid=!0,l[n]=t,a&&!a[r]){var s=a[n];delete a[n],a[r]=s}i.added.changeId(n,r),i.removed.changeId(n,r),i.modified.changeId(n,r),delete o[n],o[r]=t,t.index=i.storage.indexOf(t)}},{key:"onUpdateRecord",value:function(e,t){var n,r,i=this,a=t.internalId,o=i.internalIdRegister,l=i.reapplyFilterOnUpdate,s=i.reapplySortersOnUpdate;a&&(this.storage._indicesInvalid=!0,delete o[a.oldValue],o[a.value]=e),(!0===l||null!==(n=l.fields)&&void 0!==n&&n.some((function(e){return e in t})))&&i.isFiltered&&(i.filterBatching||i.filter()),(!0===s||null!==(r=s.fields)&&void 0!==r&&r.some((function(e){return e in t})))&&i.isSorted&&(i._reapplySortersSuspended?i._shouldReapplySorters=!0:i.sort())}},{key:"useRawData",get:function(){var e;return this._useRawData===Rf?this.readUrl||null!==(e=this.crudManager)&&void 0!==e&&e.loadUrl?Mf:{enabled:!1}:this._useRawData}},{key:"changeUseRawData",value:function(e){return e===Rf?Rf:!0===e?Tf:e?Object.assign(e,{enabled:!0}):{enabled:!1}}},{key:"performDataRequest",value:(n=f(L().mark((function e(t,n,r){var i,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=(o=this).buildRemoteParams(n),e.t0=!t,!e.t0){e.next=13;break}return e.next=5,o.trigger("beforeRequest",{action:"read",params:l});case 5:if(e.t2=e.sent,e.t1=!1===e.t2,e.t1){e.next=12;break}return e.next=10,null===(i=o.trigger)||void 0===i?void 0:i.call(o,"requestData",l);case 10:e.t3=e.sent,e.t1=!1===e.t3;case 12:e.t0=e.t1;case 13:if(!e.t0){e.next=15;break}return e.abrupt("return",!1);case 15:if(!o.isDestroyed){e.next=17;break}return e.abrupt("return");case 17:if(!o.requestData){e.next=30;break}return e.next=20,o.requestData(l);case 20:if(c=e.sent,s=c.data,u=c.total,!o.isDestroyed){e.next=25;break}return e.abrupt("return");case 25:null==r||r(),o.data=s,null!=u&&(o.remoteTotal=u),e.next=31;break;case 30:null==r||r();case 31:return e.next=33,null===(a=o.trigger)||void 0===a?void 0:a.call(o,"afterRequest",{response:{data:s,total:u},params:l,action:"read"});case 33:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getCount",value:function(){var e,t,n=!(arguments.length>0&&arguments[0]!==i)||arguments[0],r=this,a=r.storage,o=r.groupRecords,l=r.isFiltered,s=r.isGrouped,u=r.isTree,c=r.rootNode;if("boolean"==typeof n)return Ne.deprecate("core","7.0.0","getCount(true/false) deprecated in favor of getCount(options)"),n?r.count:a.totalCount-((null==o?void 0:o.count)||0);if(n.all)return this.allRecords.length;"visibleData"in n||(n.visibleData=!0);var d,h=0,f=n.visibleData,v=n.headersFooters,g=n.filteredOut,m=n.collapsed,p=l?null!==(e=null==o?void 0:o.values.reduce((function(e,t){return e+(r.includes(t)?1:0)}),0))&&void 0!==e?e:0:null!==(t=null==o?void 0:o.count)&&void 0!==t?t:0,y=a.count-p;(f&&(h+=y),v&&s)&&(h+=l&&g?null!==(d=o.count)&&void 0!==d?d:0:p);if(g&&l&&(h+=u?c.getDescendantCount(!1,r,!0)-c.getDescendantCount(!1,r,!1):a.allValues.length-a.values.length),m)if(s){var k,b=0,C=D(r.collapsedGroups);try{for(C.s();!(k=C.n()).done;){var w=k.value;b+=o.get(w).groupChildren.length}}catch(e){C.e(e)}finally{C.f()}h+=b}else u&&(h+=c.descendantCount-y);return h}},{key:"count",get:function(){return this.storage.count}},{key:"originalCount",get:function(){var e;return Ne.deprecate("core","7.0.0","originalCount was deprecated in favor of getCount()"),this.storage.totalCount-((null===(e=this.groupRecords)||void 0===e?void 0:e.count)||0)}},{key:"allCount",get:function(){return Ne.deprecate("core","7.0.0","allCount was deprecated in favor of totalCount"),this.isTree?this.rootNode.descendantCount:this.storage.totalCount}},{key:"totalCount",get:function(){return this.isPaged&&"remoteTotal"in this?this.remoteTotal:this.getCount({all:!0})},set:function(e){this.isPaged&&(this.remoteTotal=e)}},{key:"records",get:function(){return this.storage.values}},{key:"first",get:function(){return this.storage.values[0]}},{key:"last",get:function(){return this.storage.values[this.storage.values.length-1]}},{key:"getAt",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.storage.getAt(e,t)}},{key:"register",value:function(e){var t=this;if(!t.useRawData.disableDuplicateIdCheck){var n=t.isTree&&t.idRegister[e.id];if(n&&n!==e)throw new Error("Id collision on ".concat(e.id))}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}},{key:"unregister",value:function(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}},{key:"registeredRecords",get:function(){return Object.values(this.idRegister)}},{key:"getById",value:function(e){var t,n;null!==(t=e)&&void 0!==t&&t.isModel&&(e=(n=e).id);var r=this.idRegister[e];if(n){var i;if(null!==(i=n)&&void 0!==i&&i.hasLinks&&!r){var a=this.storage.allValues;return n.$links.find((function(e){return a.includes(e)}))}return n}return r}},{key:"isAvailable",value:function(e){var t=this.getById(e);return t&&this.storage.includes(t)||!1}},{key:"getByInternalId",value:function(e){return this.internalIdRegister[e]}},{key:"includes",value:function(e){return this.isTree?null!=this.idRegister[od.asId(e)]:this.indexOf(e)>-1}},{key:"indexOf",value:function(e){var t,n=this,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=arguments.length>2&&arguments[2]!==i&&arguments[2];if(null!=e&&e.isModel&&(null===(t=e.stores)||void 0===t||!t.includes(this.$store||this))){var o=e.$links.find((function(e){return n.storage.allValues.includes(e)}));return o?this.indexOf(o,r):-1}if(this.isTree)return(a?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));var l=od.asId(e);if(null==l)return-1;var s=this.idMap[l];return s?s[r?"visibleIndex":"index"]:-1}},{key:"allIndexOf",value:function(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}},{key:"getDistinctValues",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=[],o={};return this.forEach((function(n){if(!n.isSpecialRow&&!n.isRoot){var r=(t=n.getValue(e))instanceof Date?t.getTime():t;o[r]===i?(a.push(t),o[r]={value:t,count:1}):o[r].count++}}),this,{includeCollapsedGroupRecords:!0,includeFilteredOutRecords:n}),r?Object.values(o):a}},{key:"getValueCount",value:function(e,t){var n=0;return this.forEach((function(r){Be.isEqual(r.getValue(e),t)&&n++})),n}},{key:"json",get:function(){return Le.safeJsonStringify(this)},set:function(e){"string"==typeof e&&(e=Le.safeJsonParse(e)),this.data=e}},{key:"formattedJSON",get:function(){return Le.safeJsonStringify(this,null,4)}},{key:"toJSON",value:function(){var e=this,t=e.modelClass.getFieldDefinition("expanded"),n=t.persistable,r=t.dataSource;return(e.isTree?e.rootNode.unfilteredChildren||e.rootNode.children||[]:e.allRecords).map((function(t){var i=t.toJSON();return e.tree&&t.isParent&&n&&(i[r]=t.isExpanded(e)),i}))}},{key:"preProcessCurrentConfigs",value:function(e){B(t,"preProcessCurrentConfigs",this,3)([e]),delete e.project}},{key:"getInlineData",value:function(e){var t,n=[];this.tree?null===(t=this.rootNode.children)||void 0===t||t.forEach((function(t){return n.push(t.getCurrentConfig(e))})):this.forEach((function(t){return n.push(t.getCurrentConfig(e))}));return n}},{key:"getCurrentConfig",value:function(e){var n,r=B(t,"getCurrentConfig",this,3)([e]),i=this.state;r&&(r.data&&(r.data=this.getInlineData(e)),delete r.project,delete r.stm,delete r.asyncEvents,(null===(n=r.modelClass)||void 0===n?void 0:n.$meta.hierarchy[r.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete r.modelClass,this.tree||delete r.tree,i&&Object.assign(r,i));return r}},{key:"forEach",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this,n=arguments.length>2?arguments[2]:i,r=this,a=function(n,r){if(n&&!n.isRoot&&!n.isSpecialRow)return e.call(t,n,r)};if(n=Ef(0,n),r.isTree)r.isChained&&(n=F(F({},n),{},{sorterFn:r.sorterFn})),r.rootNode.traverseWhile(a,!1,n);else{var o=n.includeFilteredOutRecords?r.storage.allValues:r.storage.values;if(r.isGrouped&&n.includeCollapsedGroupRecords)for(var l=0;l<o.length;l++){var s=o[l],u=n.includeFilteredOutRecords?s.unfilteredGroupChildren:s.groupChildren;if(u&&!0===s.meta.collapsed)for(var c=0;c<u.length;c++){if(!1===a(u[c],c))return}else if(!1===a(s,l))return}else for(var d=0;d<o.length;d++)if(!1===a(o[d],d))return}}},{key:"map",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this;return this.storage.values.map(e,t)}},{key:"flatMap",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this;return this.storage.values.flatMap(e,t)}},{key:"every",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this,n=arguments.length>2?arguments[2]:i;return this.storage[n?"allValues":"values"].every(e,t)}},{key:"reduce",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:[],n=arguments.length>2&&arguments[2]!==i?arguments[2]:this;return n!==this&&(e=e.bind(n)),this.storage.values.reduce(e,t,n)}},{key:Symbol.iterator,value:function(){return this.storage.values[Symbol.iterator]()}},{key:"traverse",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.rootNode,n=arguments.length>2&&arguments[2]!==i?arguments[2]:t===this.rootNode,r=arguments.length>3?arguments[3]:i,a=this;if(r=Ef(0,r),a.isTree){if("boolean"==typeof t&&(n=t,t=a.rootNode),a.isChained){var o=e;e=function(e){a.chainedFilterFn(e)&&o(e)}}t.traverse(e,n,r)}else a.forEach((function(t){return t.traverse(e,!1,r)}),a,r)}},{key:"traverseWhile",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.rootNode,n=arguments.length>2&&arguments[2]!==i?arguments[2]:t===this.rootNode,r=arguments.length>3?arguments[3]:i,a=this;if(r=Ef(0,r),a.isTree){if("boolean"==typeof t&&(n=t,t=a.rootNode),a.isChained){var o=e;e=function(e){a.chainedFilterFn(e)&&o(e)}}t.traverseWhile(e,n,r)}else{var l,s=D(a.storage);try{for(s.s();!(l=s.n()).done;){if(!1===l.value.traverse(e,!1,r))break}}catch(e){s.e(e)}finally{s.f()}}}},{key:"getNext",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.storage.values,o=r.indexOf(e);if(o>=a.length-1){if(!t)return null;o=-1}var l=a[o+1];return n&&l&&(l.isSpecialRow||"function"==typeof n&&n(l))?r.getNext(a[o+1],t,n):l}},{key:"getPrev",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.storage.values,o=r.indexOf(e);if(0===o){if(!t)return null;o=a.length}var l=a[o-1];return o>0&&n&&l&&(l.isSpecialRow||"function"==typeof n&&n(l))?r.getPrev(a[o-1],t,n):l}},{key:"getAdjacent",value:function(e){var t=arguments.length>2&&arguments[2]!==i&&arguments[2],n=arguments.length>3&&arguments[3]!==i&&arguments[3];return!(arguments.length>1&&arguments[1]!==i)||arguments[1]?this.getNext(e,t,n):this.getPrev(e,t,n)}},{key:"getNextLeaf",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this.leaves,r=this.getById(e),a=n.indexOf(r);if(a>=n.length-1){if(!t)return null;a=-1}return n[a+1]}},{key:"getPrevLeaf",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this.leaves,r=this.getById(e),a=n.indexOf(r);if(0===a){if(!t)return null;a=n.length}return n[a-1]}},{key:"getAdjacentLeaf",value:function(e){var t=arguments.length>2&&arguments[2]!==i&&arguments[2];return!(arguments.length>1&&arguments[1]!==i)||arguments[1]?this.getNextLeaf(e,t):this.getPrevLeaf(e,t)}}],[{key:"properties",get:function(){return{relationCache:{},dependentStoreConfigs:new a,addingClean:!1}}},{key:"defaultConfig",get:function(){return{fields:null,data:null,tree:null,callOnFunctions:!0,storage:null,allowNoId:!0,preventSubClassingModel:null,storeClass:null}}},{key:"identifiable",get:function(){return{registerGeneratedId:!1}}},{key:"from",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=arguments.length>2&&arguments[2]!==i?arguments[2]:null;return e&&!e.isStore&&("string"==typeof e?e=t.getStore(e):(Array.isArray(e)?(r&&(e=e.map((function(e){return e.isModel?e:r(e)}))),e=Be.assign({},n,{data:e})):e=Be.assign({},n,e),e=new t(e))),e}},{key:"getStore",value:function(e,n){if(e instanceof t)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){var r,i=e.map((function(e){return e instanceof od?r=e.constructor:"string"==typeof e&&(e={text:e}),e}));if(!r){var a=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(od);r=a}e={autoCreated:!0,data:i,modelClass:r,allowNoId:!0},n||(n=t)}return n?new n(e):void 0}},{key:"stores",get:function(){return t.registeredInstances}}]);var n}(Mn.mixin($i,eo,_n,Dc,wu,dd,cd,ud,kd,bd,Dd,Sd,gd,Ed,Rd,Ld,yf,Od,pd,yd));S(Ff,"$name","Store"),S(Ff,"configurable",{id:!0,modelClass:od,verifyNoGeneratedIds:!0,lazyLoad:null,autoLoad:null,useRawData:Rf,autoTree:!0}),Ff.initClass(),Ff._$name="Store";var Af=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateResponseTotalProperty",value:function(e){this.totalCountProperty=e}},{key:"updateResponseDataProperty",value:function(e){this.dataProperty=e}},{key:"requestData",value:(r=f(L().mark((function e(t){var n,r,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.lazyLoad,r=n.totalCountProperty,a=n.dataProperty,e.next=5,this.internalLoad(t,"",i,!1);case 5:return o=e.sent,e.abrupt("return",S(S({},r,o.json[r]),a,o.data));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(n=f(L().mark((function e(n){var r,i,a=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.client,i=r.params,n&&(r.params=F(F({},n),i)),!r.autoLoad||!r.isConstructing){e.next=5;break}return e.next=5,new Promise((function(e){return a.requestAnimationFrame(e)}));case 5:return e.next=7,B(t,"load",this,3)([]);case 7:n&&(r.params=i);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"pluginConfig",get:function(){var e={};for(var n in B(t,"pluginConfig",this))e[n]=z(B(t,"pluginConfig",this)[n]);return e.assign.push("updateResponseTotalProperty","updateResponseDataProperty"),e}}]);var n,r}(bf);S(Af,"$name","AjaxStoreLazyLoadPlugin"),Af._$name="AjaxStoreLazyLoad";var If=function(e,t){return Array.isArray(t[1])?t[1].forEach((function(n){return e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e},Lf=Promise.resolve(),Of=function(e){return String(e).padStart(2,"0")},Pf=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"modificationsTracking",0),e}return R(t,e),w(t,[{key:"suspendModificationsTracking",value:function(){this.modificationsTracking++}},{key:"resumeModificationsTracking",value:function(){this.modificationsTracking--}},{key:"afterConstruct",value:function(e){B(t,"afterConstruct",this,3)([e]),this.autoLoad&&this.readUrl&&this.load().catch((function(){}))}},{key:"$lazyLoadPluginClass",get:function(){return Af}},{key:"isLoading",get:function(){return B(t,"isLoading",this,1)||this._isLoading?2:!!this.loadTriggerPromise&&1}},{key:"isCommitting",get:function(){var e;return Boolean(null!==(e=this.commitPromise)&&void 0!==e?e:this.autoCommitTimeoutPromise)}},{key:"updateFilterParamName",value:function(e){B(t,"updateFilterParamName",this,3)([e]),this.remoteFilter=this.remoteFilter||this.restfulFilter}},{key:"updateRestfulFilter",value:function(e,t){this.remoteFilter=e||Boolean(this.filterParamName)||this.remoteFilter&&!t}},{key:"buildQueryString",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=e.includes("?"),a=Object.entries(Object.assign.apply(Object,[{}].concat(n))).reduce(If,[]).join("&");return a?(i?"&":"?")+a:""}},{key:"performRemoteSort",value:(u=f(L().mark((function e(n){var r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this).readUrl||r.isRemoteDataLoading){e.next=16;break}return r.isRemoteDataLoading=!0,e.next=5,null===(i=r.beforePerformSort)||void 0===i?void 0:i.call(r);case 5:if(e.t0=e.sent,!1!==e.t0){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,r.load();case 10:return a=e.sent,r.afterPerformSort(n),r.isRemoteDataLoading=!1,e.abrupt("return",a);case 16:B(t,"performSort",this,3)([n]);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"performRemoteFilter",value:(s=f(L().mark((function e(n){var r,i,a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=this).filterBatching>0)){e.next=4;break}return r.needsFiltering=!0,e.abrupt("return");case 4:if(!r.readUrl){e.next=23;break}return null===(i=r.loadingPromise)||void 0===i||i.abort(),r.isRemoteDataLoading=!0,o=r.count,l=r.filters,e.next=10,null===(a=r.beforePerformFilter)||void 0===a?void 0:a.call(r,{filters:l,oldCount:o});case 10:if(e.t0=e.sent,!1!==e.t0){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,r.load();case 15:return s=e.sent,u=n?null:{action:"filter",filters:l,oldCount:o,records:r.storage.values},r.afterPerformFilter(u),r.trigger("refresh",u),r.isRemoteDataLoading=!1,e.abrupt("return",s);case 23:B(t,"performRemoteFilter",this,3)([n]);case 24:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"encodeFilterParams",value:function(e){var t=this.getFilterParams(e);return JSON.stringify(t,(function(e,t){return""===e?t:this[e]instanceof Date?function(e){return"".concat(e.getFullYear(),"-").concat(Of(e.getMonth()+1),"-").concat(Of(e.getDate()),"T").concat(Of(e.getHours()),":").concat(Of(e.getMinutes()),":").concat(Of(e.getSeconds()),".").concat(e.getMilliseconds())}(this[e]):t}))}},{key:"encodeSorterParams",value:function(e){return JSON.stringify(this.getSorterParams(e))}},{key:"buildReadUrl",value:function(){var e=this.readUrl;return this.restfulFilter&&this.filters.count?(e.endsWith("/")?e:e+"/")+this.filters.first.value:e}},{key:"internalLoad",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:0;e=Be.assign({},this.params,e);var a=this,o={action:"read"+t,params:e,url:a.buildReadUrl()};if(a.buildRemoteParams(e,!0),!1===a.trigger("beforeLoad"+t,o))throw!1;return a.loadArgs=[o,e,t,n],!1===r?new Promise((function(e,t){return a.sendLoadRequest(e,t)})):a.loadTriggerPromise||(a.loadTriggerPromise=new Promise((function(e,t){a.setTimeout({delay:r,fn:"sendLoadRequest",args:[e,t],cancelOutstanding:!0})})))}},{key:"sendLoadRequest",value:(l=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=_((r=this).loadArgs,4),a=i[0],o=i[1],l=i[2],s=i[3],r.loadTriggerPromise=null,!a.url){e.next=59;break}return r._isLoading=!0,r.trigger("load".concat(l,"Start"),a),r.trigger("beforeRequest",a),u={parseJson:!0},r.headers&&(u.headers=Be.clone(r.headers)),r.useRestfulMethods&&(u.method=r.httpMethods.read,a.body&&(u.body=JSON.stringify(a.body))),e.prev=9,h=r.paramsInBody&&("POST"===(null===(c=u.method)||void 0===c?void 0:c.toUpperCase())||"PUT"===(null===(d=u.method)||void 0===d?void 0:d.toUpperCase()))&&null==u.body,f=a.url+(h?"":r.buildQueryString(a.url,o)),v=r.loadingPromise=Ba.get(f,Be.assign(u,r.fetchOptions,h?{body:JSON.stringify(o)}:null)),e.next=15,v;case 15:if(g=e.sent,!r.isDestroyed){e.next=18;break}return e.abrupt("return");case 18:if(m=r.transformLoadedData?r.transformLoadedData(g.parsedJson):g.parsedJson,p=Array.isArray(m),y=p||m&&!1!==Be.getPath(m,r.responseSuccessProperty),k=p?null:Be.getPath(m,r.responseTotalProperty),r.loadingPromise=null,r._isLoading=!1,a.response=g,a.json=m,!y){e.next=45;break}if(null!=k&&(r.remoteTotal=parseInt(k,10)),!r.isPaged||r.lazyLoad){e.next=31;break}if(!(r.remoteTotal>=0)){e.next=30;break}r.currentPage=r.pageStartParamName?o[r.pageStartParamName]/r.pageSize+1:o[r.defaultPageParamName],e.next=31;break;case 30:throw new Error("A paged store must receive its responseTotalProperty in each data packet");case 31:return a.data=p?m:Be.getPath(m,r.responseDataProperty),r.suspendModificationsTracking(),e.next=35,null==s?void 0:s(a);case 35:if(r.resumeModificationsTracking(),!r.isPartOfProjectRaw){e.next=41;break}return r.ignoreLoadPropagationChanges&&r.suspendModificationsTracking(),e.next=40,null===(b=r.getProject())||void 0===b?void 0:b.commitAsync();case 40:r.ignoreLoadPropagationChanges&&r.resumeModificationsTracking();case 41:!r.isDestroyed&&r.trigger("load"+l,a),t(a),e.next=48;break;case 45:Object.assign(a,{exception:!0,exceptionType:"server",error:null==m?void 0:m.error}),!r.isDestroyed&&r.trigger("exception",a),n(a);case 48:!r.isDestroyed&&r.trigger("afterRequest",a),e.next=59;break;case 51:e.prev=51,e.t0=e.catch(9),r._isLoading=!1,a.exception=!0,e.t0 instanceof Response?(a.exceptionType=e.t0.ok?"server":"network",a.response=e.t0,a.error=e.t0.error):(a.exceptionType="server",a.error=e.t0),!r.isDestroyed&&r.trigger("exception",a),n(a),!r.isDestroyed&&r.trigger("afterRequest",a);case 59:case"end":return e.stop()}}),e,this,[[9,51]])}))),function(e,t){return l.apply(this,arguments)})},{key:"load",value:(o=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this).isPaged){e.next=5;break}return e.abrupt("return",n.loadPage(n.currentPage||1,t));case 5:return e.abrupt("return",n.internalLoad(t,"",(function(e){n.data=e.data})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"loadChildren",value:(a=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readUrl?this.internalLoad(S({},this.parentIdParamName,t.id),"Children",(function(e){e.parentRecord=t,t.children.length&&t.clearChildren(!0),t.data[t.constructor.childrenField]=e.data,t.processChildren(t.stores)}),!1):this.immediatePromise);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadPage",value:(r=f((function(e){var n=this,r=arguments.length>1&&arguments[1]!==i?arguments[1]:{};return L().mark((function i(){return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n.readUrl){i.next=2;break}return i.abrupt("return",B(t,"loadPage",n,3)([e]));case 2:return r[n.defaultPageParamName]=null!=e?e:1,i.abrupt("return",n.internalLoad(r,"Page",(function(e){n.loadData(e.data,"pageLoad")})));case 4:case"end":return i.stop()}}),i)}))()})),function(e){return r.apply(this,arguments)})},{key:"commit",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearTimeout("autoCommit"),this.autoCommitTimeoutPromise=null,e.abrupt("return",this.queueCommit());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"queueCommit",value:function(){var e,t,n=this;return n.commitPromise?t=n.commitPromise.then((function(){return n.performCommit()})):(n._commitPromiseQueueLength=0,t=n.performCommit()),n._commitPromiseQueueLength+=1,n.commitPromise=null===(e=t)||void 0===e?void 0:e.finally((function(){n._commitPromiseQueueLength-=1,0===n._commitPromiseQueueLength&&(n.commitPromise=null)}))}},{key:"performCommit",value:function(){var e=this,t=e.changes,n=[];if(!t)return e.modified.count&&(e.modified.forEach((function(e){return e.internalClearChanges(!0,!1)})),e.modified.clear()),Lf;if(!1!==e.trigger("beforeCommit",{changes:t})){[].concat(z(t.added),z(t.modified),z(t.removed)).forEach((function(e){return e.meta.committing=!0})),e.trigger("commitStart",{changes:t});var r={action:"commit",exception:!1,changes:t},i=e.commitRemoved(r);return i&&n.push(i),(i=e.commitAdded(r))&&n.push(i),(i=e.commitModified(r))&&n.push(i),n.length?(i=1===n.length?n[0]:Promise.all(n),new Promise((function(n,a){i.then((function(){r.exception?(e.trigger("exception",r),a(r)):(e.trigger("commit",{changes:t}),n(r))})).catch((function(){a(r)}))}))):(e.modified.forEach((function(e){return e.internalClearChanges(!0,!1)})),e.modified.clear(),e.added.forEach((function(e){return e.internalClearChanges(!0,!1)})),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),Lf)}return Lf}},{key:"doAutoCommit",value:function(){var e=this;e.suspendCount<=0&&!e.hasTimeout("autoCommit")&&(e.autoCommitTimeoutPromise=new Promise((function(t){e.setTimeout({name:"autoCommit",fn:function(){e.autoCommitTimeoutPromise=null,e.commit().then().catch((function(e){var t=e.response;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e})),t()},delay:e.autoCommitTimeout})})))}},{key:"buildCommitUrl",value:function(e){return e+this.buildQueryString(e,this.params)}},{key:"commitAdded",value:function(e){var t=this,n=z(t.added);return n.length&&t.createUrl?new Promise((function(r){var i=n.map((function(e){return e.persistableData})),a={action:"create",params:t.params,url:t.buildCommitUrl(t.createUrl)};e.create=a,a.body={data:i},t.trigger("beforeRequest",a);var o=t.transformCreationData?t.transformCreationData(a.body):a.body;if(t.sendAsFormData){var l=new FormData;l.append("data",JSON.stringify(o.data)),o=l}var s={parseJson:!0};t.headers&&(s.headers=Be.clone(t.headers)),t.useRestfulMethods&&(s.method=t.httpMethods.create),Ba.post(a.url,o,Be.assign(s,t.fetchOptions)).then((function(o){if(!t.isDestroyed){var l=o.parsedJson,s=Array.isArray(l)||l&&!1!==l.success;if(e.response=o,a.json=l,a.response=o,s){var u=t.processReturnedData(l,n,i);t.added.remove(u),t.modified.add(u.filter((function(e){return e.meta.modified&&!Be.isEmpty(e.meta.modified)}))),t.trigger("commitAdded"),t.trigger("refresh",a),r(e)}else n.forEach((function(e){return e.meta.committing=!1})),e.exception=a.exception=!0,e.exceptionType=a.exceptionType="server",t.trigger("exception",a),r(e);t.trigger("afterRequest",a)}})).catch((function(i){n.forEach((function(e){return e.meta.committing=!1})),e.exception=a.exception=!0,i instanceof Response?(e.response=i,a.exceptionType=i.ok?"server":"network",a.response=i,a.error=i.error):(a.exceptionType="server",a.error=i),!t.isDestroyed&&t.trigger("exception",a),r(e),!t.isDestroyed&&t.trigger("afterRequest",a)}))})):null}},{key:"commitModified",value:function(e){var t=this,n=z(t.changes.modified),r=n.length&&t.updateUrl?new Promise((function(r){var i={action:"update",params:t.params,url:t.buildCommitUrl(t.updateUrl)},a=n.map((function(e){return t.writeAllFields?e.persistableData:e.modificationDataToWrite})).filter((function(e){return!Be.isEmpty(e)}));if(0===a.length)return t.modified.clear(),n.forEach((function(e){return e.meta.committing=!1})),void r();e.update=i,i.body={data:a},t.trigger("beforeRequest",i);var o=t.transformModificationData?t.transformModificationData(i.body):i.body;if(t.sendAsFormData){var l=new FormData;l.append("data",JSON.stringify(o.data)),o=l}var s={parseJson:!0};t.headers&&(s.headers=Be.clone(t.headers)),t.useRestfulMethods&&(s.method=t.httpMethods.update),Ba.post(i.url,o,Be.assign(s,t.fetchOptions)).then((function(o){if(!t.isDestroyed){var l=o.parsedJson,s=Array.isArray(l)||l&&!1!==l.success;e.response=o,i.json=l,i.response=o,s?(t.processReturnedData(l,n,a,!0,!0),t.trigger("commitModified"),t.trigger("refresh",i),r(e)):(n.forEach((function(e){return e.meta.committing=!1})),e.exception=i.exception=!0,i.exceptionType="server",t.trigger("exception",i),r(e)),t.trigger("afterRequest",i)}})).catch((function(a){n.forEach((function(e){return e.meta.committing=!1})),e.exception=i.exception=!0,a instanceof Response?(e.response=a,i.exceptionType=a.ok?"server":"network",i.response=a,i.error=a.error):(i.exceptionType="server",i.error=a),!t.isDestroyed&&t.trigger("exception",i),r(e),!t.isDestroyed&&t.trigger("afterRequest",i)}))})):null;return!n.length&&t.modified.count&&t.modified.clear(),r}},{key:"processReturnedData",value:function(e,t,n){var r=this,a=arguments.length>3&&arguments[3]!==i&&arguments[3];Array.isArray(e)||(e=Be.getPath(e,this.responseDataProperty));var o=t[0].constructor.idField,l=!e||e.length===t.length,s=[];return t.forEach((function(t,i){var u,c,d=a?null===(u=e)||void 0===u?void 0:u.find((function(e){return e[o]===t.id})):null===(c=e)||void 0===c?void 0:c[i];if(l||d){var h=t.modificationDataToWrite,f=a?n.find((function(e){return e.id===t.id})):n[i],v={};if(t.meta.committing=!1,d&&(t.syncId(d[o]),Object.assign(t.data,r.modelClass.processData(d,a,r,t))),h)for(var g in f)if(h[g]===f[g]){var m=t.getFieldDefinitionFromDataSource(g);null!=m&&m.persist&&(v[m.name]=1)}t.internalClearChanges(!0,!0,v,!0),s.push(t)}})),s}},{key:"commitRemoved",value:function(e){var t=this,n=t.removed,r=t.includeChildrenInRemoveRequest;return n.count&&t.deleteUrl?new Promise((function(i){var a;if(r)a=n.values;else{a=[];var o,l=D(n.values);try{for(l.s();!(o=l.n()).done;){var s,u,c=o.value,d=null!==(s=c.parentId)&&void 0!==s?s:null===(u=c.meta.modified)||void 0===u?void 0:u.parentId;null==d||d!==t.rootNode.id&&n.includes(d)||a.push(c)}}catch(e){l.e(e)}finally{l.f()}}var h={action:"delete",params:t.params,url:t.buildCommitUrl(t.deleteUrl),body:{ids:a.map((function(e){return e.id}))}};e.delete=h,t.trigger("beforeRequest",h);var f=t.transformRemovalData?t.transformRemovalData(h.body):h.body;if(t.sendAsFormData){var v=new FormData;v.append("id",JSON.stringify(f.ids)),f=v}var g={parseJson:!0};t.headers&&(g.headers=Be.clone(t.headers)),t.useRestfulMethods&&(g.method=t.httpMethods.delete),Ba.post(h.url,f,Be.assign(g,t.fetchOptions)).then((function(r){var a=r.parsedJson,o=Array.isArray(a)||a&&!1!==a.success;e.response=r,h.json=a,h.response=r,o?(n.forEach((function(e){return e.meta.committing=!1})),n.clear(),t.trigger("commitRemoved"),t.trigger("refresh",h),i(e)):(n.forEach((function(e){return e.meta.committing=!1})),e.exception=h.exception=!0,h.exceptionType="server",t.trigger("exception",h),i(e)),t.trigger("afterRequest",h)})).catch((function(r){n.forEach((function(e){return e.meta.committing=!1})),e.exception=h.exception=!0,r instanceof Response?(e.response=r,h.exceptionType=r.ok?"server":"network",h.response=r,h.error=r.error):(h.exceptionType="server",h.error=r),!t.isDestroyed&&t.trigger("exception",h),i(e),!t.isDestroyed&&t.trigger("afterRequest",h)}))})):null}}],[{key:"defaultConfig",get:function(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"},paramsInBody:Ne.checkVersion("core","6.0",">=")}}}]);var n,r,a,o,l,s,u}(Ff);S(Pf,"$name","AjaxStore"),S(Pf,"configurable",{responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",params:null,autoCommitTimeout:10,includeChildrenInRemoveRequest:!0,transformLoadedData:null,transformCreationData:null,transformModificationData:null,transformRemovalData:null,ignoreLoadPropagationChanges:!1,restfulFilter:!1}),Pf._$name="AjaxStore";var _f,Hf,Bf=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"hasLabel",get:function(){return Boolean(this.label)}},{key:"compose",value:function(){var e=this.hasLabel,t=this.labelPosition;return{class:S(S({},"b-label-".concat(t),e),"b-has-label",e)}}},{key:"changeLabel",value:function(e){return e||""}},{key:"setupLabel",value:function(e){return Be.assign({tag:"label",for:"".concat(this.id,"-input"),class:"b-label b-align-".concat(e.align||"start")},e)}},{key:"updateLabelWidth",value:function(e){this.labelElement&&(this.labelElement.style.flex="0 0 ".concat(li.setLength(e)),this.inputWrap&&(this.inputWrap.style.flexBasis=null==e?"":"auto"))}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","Labelable"),S(t,"configurable",{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}),t},Vf=function(){var e;return e=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"widgetClass",get:function(){}},{key:"doDestroy",value:function(){var e=this,n=e._rootElement&&e.constructor.getSharedErrorTooltip(e._rootElement,{doNotCreate:!0,cachePath:e.errorTooltipCachePath});B(t,"doDestroy",this,3)([]),(null==n?void 0:n.field)===e&&n.hide()}},{key:"errorTip",get:function(){return this.constructor.getSharedErrorTooltip(this.rootElement,{cachePath:this.errorTooltipCachePath,tooltipConfig:this.errorTooltipConfig})}},{key:"setError",value:function(e,t,n){var r=this,i=Object.keys(r.errors||{}).length;(r.errors||(r.errors={}))[e]=r.optionalL(e);var a=Object.keys(r.errors).length;if(a!==i&&r.trigger("validityChange",{valid:0===a,bubbles:!0}),t||r.syncInvalid(),n)var o=function(){r.clearError(e),l()},l=r.ion({keydown:o,focusOut:o})}},{key:"clearError",value:function(e,t){var n=this;n.errors&&Object.keys(n.errors).length>0&&(e?delete n.errors[e]:n.errors={},n.trigger("validityChange",{valid:0===Object.keys(n.errors).length,bubbles:!0})),t||n.syncInvalid()}},{key:"getErrors",value:function(){var e=this;if(!e.isValid){var t,n,r,i,a=e.validity,o=Be.keys(a).find((function(e){return"valid"!==e&&"customError"!==e&&a[e]})),l=e.errors&&Object.values(e.errors),s=null!==(t=null===(n=e.formatter)||void 0===n?void 0:n.is.percent)&&void 0!==t&&t;if((null===(r=i=null!=l&&l.length?l:a.customError?[e.input.validationMessage]:o?[e.L(o,{min:s?"".concat(100*e.min,"%"):e.min,max:s?"".concat(100*e.max,"%"):e.max})]:[e.L(e.invalidValueError)])||void 0===r?void 0:r.length)>0)return i}}},{key:"syncInvalid",value:function(){var e=this,t=e.isPainted;if(e.updatingInvalid=!0,t){var n=e.isValid,r=e.element,i=e.inputWrap;if(r.classList[n?"remove":"add"]("b-invalid"),n){var a=e.constructor.getSharedErrorTooltip(e.rootElement,{doNotCreate:!0,cachePath:this.errorTooltipCachePath});null!=a&&a.isVisible&&a.field===e&&a.hide()}else if(i){var o=e.errorTip;o&&(e.containsFocus||e.isVisible&&li.isDescendant(i,pc.currentOverElement))&&(o.activeTarget===i&&o.isVisible?o.onBeforeShow():(o.activeTarget=i,o.showBy(i)))}}e.updatingInvalid=!1}}],[{key:"errorTip",get:function(){return this.getSharedErrorTooltip(document.body)}},{key:"getSharedErrorTooltip",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=n.doNotCreate,a=n.cachePath,o=void 0===a?"errorTooltip":a,l=n.tooltipConfig,s=null===(t=e.bryntum)||void 0===t?void 0:t[o];return s||r||(e.bryntum=e.bryntum||{},s=pc.new({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},axisLock:"flexible",scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow:function(){var e=this,t=Lo.fromElement(e.activeTarget);if(t){var n=t.getErrors();if(n)return e.html=n.join("<br>"),e.field=t,!0}return!1}},l),e.bryntum[o]=s),s}}])}((arguments.length>0&&arguments[0]!==i?arguments[0]:Mn).mixin(Ya)),S(e,"$name","Validatable"),e},Nf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"inline",get:function(){var e;return null!==(e=this.owner.inline)&&void 0!==e?e:1===this.ensureItems().count}},{key:"changeCollapsed",value:function(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(Boolean(e))}},{key:"updateCollapsed",value:function(e){var t;this.collapser=null===(t=this.collapser)||void 0===t?void 0:t.destroy(),this.setCollapsedCls(e)}},{key:"updateCollapser",value:function(e,t){t&&null==t.completed&&(t.reverting&&e||t.destroy()),this.setOwnerCls("b-collapsing",e)}},{key:"collapsing",get:function(){var e=this.collapser;return null!=e&&e.collapsed}},{key:"collapsingExpanding",get:function(){return null!=this.collapser}},{key:"expanding",get:function(){var e=this.collapser;return null!=e&&!e.collapsed}},{key:"collapse",value:function(e){this.toggleCollapse(!0,e)}},{key:"expand",value:function(e){this.toggleCollapse(!1,e)}},{key:"setCollapsedCls",value:function(e){this.setOwnerCls("b-collapsed",e)}},{key:"setOwnerCls",value:function(e,t){var n;null===(n=this.owner)||void 0===n||null===(n=n.element)||void 0===n||n.classList[t?"add":"remove"](e)}},{key:"syncChildConfigs",value:function(){var e,t,n=this,r=n.owner,i=n.syncableConfigs;if(i)for(e in i)t=i[e](r),n.eachWidget((function(n){n[e]=t}),!1);r.afterSyncChildConfigs(n)}},{key:"syncContainer",value:function(){var e=this.inline,t=this.layout;this.autoLayout&&(t.horizontal=e,t.justify=e?"center":"stretch")}},{key:"toggleCollapse",value:function(e,t){var n=this,r=n.animation,i=n.collapser,a=n.inline,o=n.owner.containerWrapElement,l=function(t){t&&(n.element.style.height="",n.togglingCollapse=!0,n.collapsed=e,n.collapser=null)};if(null==e&&(e=!n.collapsed),!1!==t&&null!==t&&(o&&n.isVisible?(!0===t?t={}:"number"==typeof t&&(t={duration:t}),t=r||t?Be.merge({},r,t):null):t=null),t){if(i&&e!==i.collapsed)n.collapser=i.revert({finalize:l}),n.collapser.collapsed=e;else if(!i&&e!==n.collapsed){!e&&n.setCollapsedCls(!1);var s=n.element,u=s.getBoundingClientRect().height,c=a?1:u;!e&&n.setCollapsedCls(!0),s.style.height="".concat(u,"px"),n.collapser=_s.run(Be.merge(S({finalize:l,element:o},a?"opacity":"height",{from:e?c:0,to:e?0:c}),t)),n.collapser.collapsed=e}}else n.togglingCollapse=!0,n.collapsed=e}}],[{key:"configurable",get:function(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}},{key:"delayable",get:function(){return{syncChildConfigs:"raf"}}}])}(Ss);S(Nf,"$name","FieldContainer"),S(Nf,"type","fieldcontainer"),Nf.initClass(),Nf._$name="FieldContainer";var zf=function(e,t){return(e.weight||0)-(t.weight||0)},jf=function(e,t){return(t.weight||0)-(e.weight||0)},Wf=[],$f={align:!0,weight:!0},Uf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e,n,r,i=this,a=i.triggers;if(null===(e=i.inputListenerRemover)||void 0===e||e.call(i),null===(n=i.keyListenerRemover)||void 0===n||n.call(i),null===(r=i.container)||void 0===r||r.destroy(),B(t,"doDestroy",this,3)([]),a)for(var o=0,l=Object.values(a);o<l.length;o++){l[o].destroy()}}},{key:"childItems",get:function(){var e=this.container,t=this.triggers,n=t?Object.values(t):[];return e?[].concat(z(n),z(e.childItems)):n}},{key:"invalidValueError",get:function(){return"L{invalidValue}"}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};B(t,"construct",this,3)([e]);var n=this;n.keyStrokeChangeDelay&&(n.changeOnKeyStroke=n.buffer(n.internalOnChange,n.keyStrokeChangeDelay)),!n.ariaLabel&&n.placeholder&&n.updateAriaLabel(n.placeholder)}},{key:"changeKeyMap",value:function(e){var t=this,n={};for(var r in e&&(t._fieldKeyMap?Be.assign(n,t._fieldKeyMap):(t._fieldKeyMap=e,Be.assign(n,e))),t.triggers){var i;null!==(i=t.triggers[r])&&void 0!==i&&i.keyMap&&(n=t.mergeKeyMaps(n,t.triggers[r].keyMap,r))}return n}},{key:"keyMapSubComponents",get:function(){return this.triggers}},{key:"onFocusIn",value:function(e){var n=this;n.valueOnFocus=Be.clone(n.value),n.validOnFocus=!(n.errors&&Object.keys(n.errors).length),B(t,"onFocusIn",this,3)([e]),n.focusing=!0,n.syncInvalid(),n.focusing=!1}},{key:"onFocusOut",value:function(e){B(t,"onFocusOut",this,3)([e]),this.syncRequired(),this.onEditComplete()}},{key:"onEditComplete",value:function(){}},{key:"rootUiClass",get:function(){return t}},{key:"compose",value:function(){this.getConfig("clearable");var e=this,t=e.container,n=e.innerElements,r=e.label,i=e.labels,a=e.labelCls,o=e.readOnly,l=e.stepTriggers,s=e.triggers,u=e.required,c=e.showRequiredIndicator,d=Be.values(s,(function(e,t){return!t})),h=d.filter((function(e){return"start"===e.align})).sort(zf),f=d.filter((function(e){return"start"!==e.align})).sort(jf),v=e.setupLabel.bind(e),g=[].concat(z(h.map((function(e){return e.element}))),z(n),z(f.map((function(e){return e.element}))));return{class:{"b-has-step-triggers":l,"b-has-start-trigger":h.length,"b-no-input":!n.length,"b-readonly":o,"b-field-container":Boolean(t),"b-field-container-inline":null==t?void 0:t.inline,"b-required":Boolean(u&&c)},children:[].concat(z((i||Wf).filter((function(e){return e&&"end"!==e.align})).map(v)),[r?v({reference:"labelElement",class:"b-label b-align-start ".concat(a||""),html:r}):null,g.length?{class:"b-field-inner",reference:"inputWrap",children:g}:null],z((i||Wf).filter((function(e){return"end"===(null==e?void 0:e.align)})).map(v)),z(t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:Wf))}}},{key:"updateElement",value:function(e,n){var r,i=this,a=i.initialConfig.value,o=i.input;B(t,"updateElement",this,3)([e,n]),null!=a&&(i.value=a),i.syncEmpty(),i.updateInputReadOnly(i.inputReadOnly),i.syncInvalid();var l=o||i.focusElement;null===(r=i.keyListenerRemover)||void 0===r||r.call(i),i.keyListenerRemover=l&&fr.on({element:l,thisObj:i,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}},{key:"innerElements",get:function(){return[this.inputElement]}},{key:"inputElement",get:function(){var e=this.attributes,t=this.inputAttributes,n=this.id,r=this.inputCls,i=this.inputType,a=this.name,o=this.inputTag,l=Be.merge({reference:"input",tag:o,type:i,name:a||n,id:"".concat(n,"-input"),retainElement:"prevent-release",dataset:this.isPasswordField?null:{opIgnore:!0}},t);r&&(l.class=r);for(var s,u,c=e.length;c-- >0;)null!=(u=this[s=e[c]])&&(l[Le.hyphenateAttributeName(s)]=u);return l}},{key:"caretPos",get:function(){return this.textSelection[0]},set:function(e){this.textSelection=e}},{key:"focusElement",get:function(){return this.input}},{key:"textSelection",get:function(){var e,t=this.input;try{e=[t.selectionStart,t.selectionEnd,t.selectionDirection]}catch(r){var n;e=[e=(null===(n=t.value)||void 0===n?void 0:n.length)||0,e]}return e},set:function(e){"number"==typeof e?this.select(e,e):this.select.apply(this,z(e))}},{key:"hasTextSelection",get:function(){var e=_(this.textSelection,2),t=e[0],n=e[1];return t&&n-t>0}},{key:"getAfterValue",value:function(e){var t=_(this.textSelection,2),n=t[0],r=t[1],i=this.input.value;return"".concat(i.substr(0,n)).concat(e).concat(i.substr(r||n))}},{key:"select",value:function(e,t){var n=this.focusElement;if(n.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;n.setSelectionRange(e,t)}}},{key:"moveCaretToEnd",value:function(){var e=this.input;if(e.createTextRange){var t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}},{key:"selectAll",value:function(){this.focusElement.select()}},{key:"caretAtEnd",get:function(){return this.textSelection[1]===this.input.value.length}},{key:"caretAtStart",get:function(){return!this.textSelection[1]}},{key:"selectedAll",get:function(){var e=this.textSelection;return!e[0]&&e[1]===this.input.value.length}},{key:"syncEmpty",value:function(){var e,t=this.isEmptyInput,n=this.isEmpty,r=this.element,i=null===(e=this.triggers)||void 0===e?void 0:e.clear,a=t&&n;r&&(i&&i[a?"hide":"show"](),r.classList.toggle("b-empty",a))}},{key:"updateHint",value:function(){this.syncHint()}},{key:"updateHintHtml",value:function(){this.syncHint()}},{key:"syncHint",value:function(){var e=this,t=e.input,n=e.hint,r=e.hintHtml,i=null==t?void 0:t.parentElement;if(t){var a=r||n,o=e.hintElement||a&&(e.hintElement=li.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));o&&("function"==typeof a&&(a=a({source:e,value:e.value})),o.firstChild[r?"innerHTML":"textContent"]=a||""),e.element.classList[a?"remove":"add"]("b-field-no-hint")}}},{key:"updateInputTag",value:function(e){e&&e!==this.getDefaultConfiguration().inputTag&&(this.dontCache=!0)}},{key:"updateEditable",value:function(){this.syncInputReadOnly()}},{key:"syncInputReadOnly",value:function(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}},{key:"updateInputReadOnly",value:function(e){var t=this,n=t.input,r=t.inputListenerRemover;n&&(n.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==r?void 0:r():r||(t.inputListenerRemover=fr.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}},{key:"changeReadOnly",value:function(e){return Boolean(e)}},{key:"updateReadOnly",value:function(e){this.syncInputReadOnly()}},{key:"updateRequired",value:function(e){this.syncRequired()}},{key:"updateClearable",value:function(e){var t=this;t.getConfig("triggers"),t.triggers={clear:e&&Be.assign({cls:"b-icon-remove",weight:1e3,handler:t.clear},e)||null}}},{key:"changeTriggers",value:function(e,n){var r=this,i=r.$triggers||(r.$triggers=new du({configName:"triggers",factory:t.Trigger,inferType:!1,owner:r,created:function(e){Tt.after(e,"onConfigChange",(function(e,t){var n=t.name;$f[n]&&r.onConfigChange({name:"triggers",value:i.target})}))},setup:function(e,t){e.reference=e.ref=t,e.parent=r}}));if(e&&!r.stepTriggers&&(e.back||e.forward)&&(delete(e=Be.assign({},e)).back,delete e.forward),i.update(e),r.element&&(r.keyMap=r.keyMap),!n)return i.target}},{key:"updateInputWidth",value:function(e){this.input.style.width=li.setLength(e),this.element.classList.add("b-has-width")}},{key:"updateInputAlign",value:function(e){this.input.style.textAlign=e}},{key:"isValid",get:function(){var e=this;if(!e.disabled&&!e.skipValidation){if(e.syncRequired(),e.checkValidity&&e.callback(e.checkValidity,e,[e]),e.errors&&Object.keys(e.errors).length)return!1;var t=e.validity;if(t)return t.valid}return!0}},{key:"isClear",get:function(){return this.isEmpty&&this.isEmptyInput}},{key:"isEmpty",get:function(){var e=this.value;return null==e||""===e||e===this.nullValue}},{key:"isEmptyInput",get:function(){return!this.input||null==this.input.value||""===this.input.value}},{key:"validity",get:function(){var e=this.input;return null==e?void 0:e.validity}},{key:"setValue",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.value=t;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"changeValue",value:function(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}},{key:"updateValue",value:function(e,t){var n=this;n.isConfiguring||(n.syncRequired(),n.inputting||n.triggerChange()),n.inputting||(n._lastValue=e),n.syncInputFieldValue()}},{key:"hasChanged",value:function(e,t){return t!==e}},{key:"syncInputFieldValue",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.input,r=t.parent,a=t.inputValueAttr,o=t.inputValue;if(n&&!t.inputting&&n[a]!==o&&(n[a]=o,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(n.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),r){var l=r.assigningValues;!0!==l&&!1!==(null==l?void 0:l.highlight)||(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}},{key:"highlightChanged",value:function(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}},{key:"removeUpdatedCls",value:function(){this.input.classList.remove("b-field-updated")}},{key:"inputValue",get:function(){return null==this.value?"":this.value}},{key:"inputValueAttr",get:function(){return"value"}},{key:"supportsTextSelection",get:function(){var e=this.focusElement;return e&&li.isTextualInput(e)}},{key:"updatePlaceholder",value:function(e){this.ariaLabel||this.updateAriaLabel(e),this.input&&(null==e?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}},{key:"internalOnInputFocus",value:function(){this.autoSelect&&this.selectAll()}},{key:"internalOnChange",value:function(e){var t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}},{key:"triggerChange",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:Boolean(this._isUserAction),n=this,r=n.value,a=n._lastValue,o=n.isValid;n.syncHint(),n.triggerFieldChange({value:r,oldValue:a,event:e,userAction:t,valid:o}),"change"===n.defaultAction&&n.trigger("action",{value:r,oldValue:a,event:e,userAction:t,valid:o})}},{key:"fetchInputValue",value:function(){this.value=this.input[this.inputValueAttr]}},{key:"internalOnInput",value:function(e){var t,n=this;n.validateOnInput||n.errorTip.hide(),n.inputting=!0,n.fetchInputValue(),n.inputting=!1,n.trigger("input",{value:n.value,event:e}),null===(t=n.changeOnKeyStroke)||void 0===t||t.call(n,e)}},{key:"needsInputSync",get:function(){var e;return this.input[this.inputValueAttr]!==String(null!==(e=this.inputValue)&&void 0!==e?e:"")}},{key:"internalOnKeyEvent",value:function(e){var t=this,n=t.value,r=!1;if(t._isUserAction=!0,"keydown"===e.type&&"Escape"===e.key&&!t.readOnly&&!t.disabled){var i=t.isValid,a="initialValue"in t?t.initialValue:t.valueOnFocus,o=t.hasChanged(a,n),l=t.needsInputSync;t.revertOnEscape&&(!i||o||l)?(o&&(t.value=a),l&&t.syncInputFieldValue(!0),t.clearError(),r=(o||l)&&t.isValid||i!==t.validOnFocus):!t.isEmpty&&t.clearable&&t.revertOnEscape&&(t.clear(),e.stopPropagation())}t.isDestroyed||(r&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e})),t._isUserAction=!1}},{key:"clear",value:function(e){var t=this;t.isClear||(t.value=t.nullValue,t.clearError(),t.syncInvalid(),t.input&&li.isTextualInput(t.input)&&(t.input.value=""),t.trigger("clear",{event:e}),null==e||e.stopImmediatePropagation())}},{key:"onDisabled",value:function(){this.syncInvalid()}},{key:"syncRequired",value:function(){var e,t=this;t.isConfiguring||t.focusing&&!t.focusVisible||!t.required||!t.isEmpty||null!==(e=t.parent)&&void 0!==e&&e.isSettingValues?t.clearError("L{fieldRequired}",t.updatingInvalid):t.setError("L{fieldRequired}",t.updatingInvalid)}},{key:"containerCollapsed",get:function(){var e;return null===(e=this.container)||void 0===e?void 0:e.collapsed},set:function(e){var t=this.container;t&&(t.collapsed=e)}},{key:"afterSyncChildConfigs",value:function(e){}},{key:"changeContainer",value:function(e,t){e&&(Array.isArray(e)||!("type"in e)&&!("items"in e))&&(e={items:e});var n=this,r=e&&Be.merge({owner:n,layout:"box"},n.containerDefaults),i=Lo.reconfigure(t,e,{owner:n,defaults:r});if(!i||(i.autoLayout="box"===(null==r?void 0:r.layout),i!==t))return i;i.syncContainer()}},{key:"onConfigChange",value:function(e){var n;B(t,"onConfigChange",this,3)([e]),null!==(n=this.container)&&void 0!==n&&null!==(n=n.syncConfigTriggers)&&void 0!==n&&n[e.name]&&this.container.syncChildConfigs()}},{key:"assignValue",value:function(e,n){var r=this,i=r.container,a=r.containValues,o=r.getValueName(n),l=e&&o in e;r.assigningValue=!0,i&&!1!==a?e&&"nested"===a?l&&(e=Be.clone(e[o]),B(t,"assignValue",this,3)([S({},o,e&&!("value"in e)||e.value),n]),e&&delete e.value,i.assignValue(e,n)):(B(t,"assignValue",this,3)([e,n]),i.assignValue(e,n)):B(t,"assignValue",this,3)([e,n]),r.assigningValue=!1}},{key:"gatherValue",value:function(e){B(t,"gatherValue",this,3)([e]),this.gatherValues(e)}},{key:"gatherValues",value:function(e,t){var n=this,r=n.container,i=n.containValues,a=n.valueName,o=W(i);t=null!=t?t:a in e,r&&!1!==i&&("nested"===i?t&&(e[a]=F({value:e[a]},r.values)):(!0===i||null==i&&t||"string"===o&&n[i]||"function"===o&&i(n))&&r.gatherValues(e))}},{key:"updateContainer",value:function(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}}],[{key:"delayable",get:function(){return{highlightChanged:"raf"}}}]);var n}(Lo.mixin(Pu,Bf,Vf));S(Uf,"$name","Field"),S(Uf,"type","field"),S(Uf,"configurable",{role:null,defaultBindProperty:"value",skipValidation:null,placeholder:null,value:"",name:null,labels:null,required:null,showRequiredIndicator:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",stepTriggers:null,triggers:null,highlightExternalChange:!1,localizableProperties:["label","title","placeholder","labelWidth","hint"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","ariaLabel","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:function(e){return e.disabled}},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{},twinSyncConfigs:["value"],inputTag:{$config:null,value:"input",default:"input"}}),Uf.Trigger=(_f=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"field",get:function(){return this.parent}},{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.key&&(this.keyMap=S({},this.key,"onClick"))}},{key:"compose",value:function(){return{"aria-hidden":!0,class:S(S({},"b-align-".concat(this.align||"end"),1),"b-icon",1),listeners:{click:"onClick",mousedown:"onMousedown"}}}},{key:"changeAlign",value:function(e){return e}},{key:"onClick",value:function(e){var t=this,n=t.field;n.disabled||n.readOnly||(e.key&&e.preventDefault(),!1!==n.trigger("trigger",{trigger:t})&&t.handler&&(n._isUserAction=!0,n.callback(t.handler,n,[e,t]),n._isUserAction=!1))}},{key:"onMousedown",value:function(e){var t=this.field;!("key"in e)&&li.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((function(){return t.editable=!0}),500)),e.preventDefault(),li.getActiveElement(t.input)!==t.input&&t.focus()}}],[{key:"factoryable",get:function(){return{defaultType:Uf.Trigger,extends:null}}}])}(Lo),S(_f,"$name","FieldTrigger"),S(_f,"type","trigger"),S(_f,"configurable",{align:null,weight:null,role:null}),_f),Uf.SpinTrigger=(Hf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}},{key:"updateRepeat",value:function(e){var t;null===(t=this.clickRepeater)||void 0===t||t.destroy(),this.clickRepeater=e?Hs.new({element:this.element},e):null}},{key:"onClick",value:function(e){var t=this,n=t.field;n._isUserAction=!0,n.disabled||n.readOnly||(e.target===t.upButton?n.doSpinUp(e.shiftKey):e.target===t.downButton&&n.doSpinDown(e.shiftKey)),n._isUserAction=!1}},{key:"isFocusable",get:function(){return!this.disabled&&B(t,"isFocusable",this,1)}}])}(Uf.Trigger),S(Hf,"$name","SpinTrigger"),S(Hf,"type","spintrigger"),S(Hf,"configurable",{repeat:{$config:["nullify"],value:!0}}),Hf),Uf.Trigger.initClass(),Uf.SpinTrigger.initClass(),Lo.register(Uf.Trigger,"trigger"),Lo.register(Uf.SpinTrigger,"spintrigger"),Uf._$name="Field";var Gf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Po);S(Gf,"$name","Fit"),S(Gf,"type","fit"),S(Gf,"configurable",{containerCls:"b-fit-container",itemCls:"b-fit-item"}),Gf.initClass(),Gf._$name="Fit";var Yf=/>[ \t\r\n]+</g,qf=/\s\s+/g,Kf=function(){function e(){m(this,e)}return w(e,null,[{key:"tpl",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0,o=n.map((function(t,n){var r=e[n];return Array.isArray(t)?r+=t.reduce((function(e,t){return e+(("string"==typeof t?t.trim():t)+"\n")}),""):(t===i&&(t=""),r+="string"==typeof t?t.trim():t),a++,r})).join("");return a<=e.length&&(o+=e[e.length-1]),o.replace(Yf,"><").replace(qf," ").trim()}},{key:"docsTpl",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0,o=n.map((function(t,n){var r=e[n];return Array.isArray(t)?r+=t.reduce((function(e,t){return e+(("string"==typeof t?t.trim():t)+"\n")}),""):(t===i&&(t=""),r+="string"==typeof t?t.trim():t),a++,r})).join("");return a<=e.length&&(o+=e[e.length-1]),o.replace(Yf,"><").trim()}},{key:"repeat",value:function(t){return function(){return e.tpl.apply(e,arguments).repeat(t)}}},{key:"loop",value:function(e){}}])}();Kf._$name="TemplateHelper";var Xf,Zf,Jf=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"activeItem",get:function(){var e=this._activeItem;if(this.target.contains(e))return e;this._activeItem=null}},{key:"updateOwnerCmp",value:function(e){this.itemSelector||(this.itemSelector=".".concat(e.itemCls,":not([data-noselect])")),e.itemsFocusable||li.setAttributes(this.keyEventTarget,{"aria-activedescendant":"".concat(this.owner.id,"-active-descendant")})}},{key:"navigationEvent",get:function(){return this._navigationEvent},set:function(e){var t=this,n=this.owner;this._navigationEvent=n.navigationEvent=e,e&&Promise.resolve(1).then((function(){return t.navigationEvent=null}))}},{key:"onKeyDown",value:function(e){var t=this,n=t.ownerCmp,r=t.itemSelector,i=t.activeItem,a=t.itemsTabbable,o=e.target,l=t.firstItem,s=(e.key||"").trim()||e.code,u=t.constructor.getComposedKeyName(e),c=o.matches(r)||o===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.callback(t.processEvent,t.thisObj||n,[e])),e&&!t.disabled&&l&&t.target.offsetParent&&c){if(!a){if(null==t.inlineFlow){var d=t.itemContainer=l.parentNode,h=li.getStyleValue(d,"display"),f=li.getStyleValue(l,"position"),v=li.getStyleValue(l,"display"),g=li.getStyleValue(l,"float");t.columnCount||(t.columnCount=li.getStyleValue(d,"grid-template-columns").split(" ").length),t.inlineFlow="absolute"===f||"inline"===v||"inline-block"===v||"left"===g||"right"===g||"flex"===h&&"row"===li.getStyleValue(d,"flex-direction")||"grid"===h&&t.columnCount>1,t.columnCount>1&&(t.prevRowKey="ArrowUp",t.nextRowKey="ArrowDown")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,i&&!t.disabled)switch(s){case t.prevKey:if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;case t.prevRowKey:if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault();var m=Array.from(t.itemContainer.querySelectorAll(t.itemSelector));t.activeItem=m[Math.max(m.indexOf(i)-t.columnCount,0)],e.handled=!0;break;case t.nextRowKey:if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault();var p=Array.from(t.itemContainer.querySelectorAll(t.itemSelector));t.activeItem=p[Math.min(p.indexOf(i)+t.columnCount,p.length-1)],e.handled=!0;break;default:var y,k=null===(y=t.keys)||void 0===y?void 0:y[u];if(k&&!t.disabled){if(!1===t.callback(k,t.thisObj||n,[e,t,i]))return}else n.onInternalKeyDown&&n.onInternalKeyDown(e);if(li.getActiveElement(o)!==o&&e.preventDefault(),a)return}else{if(a)return;s!==t.nextKey&&s!==t.prevKey||(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==i&&t.triggerNavigate(e)}}},{key:"getDefaultNavigationItem",value:function(e){var t=this.target,n=this.itemSelector,r=this.prevKey,i=this.nextKey;return 4&t.compareDocumentPosition(e.target)&&e.key===r?t.querySelector("".concat(n,":last-of-type")):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector("".concat(n)):void 0}},{key:"navigatePrevious",value:function(e){var t=this,n=t.previous;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((function(){t.activeItem=n,t.triggerNavigate(e)}))}},{key:"navigateNext",value:function(e){var t=this,n=t.next;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((function(){t.activeItem=n,t.triggerNavigate(e)}))}},{key:"owner",get:function(){return this.ownerCmp}},{key:"firstItem",get:function(){return this.target.querySelector(this.itemSelector)}},{key:"previous",get:function(){return this.getAdjacent(-1)}},{key:"next",get:function(){return this.getAdjacent(1)}},{key:"getAdjacent",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:1,t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.activeItem,n=this.treeWalker;if(n.currentNode=t,n[e<0?"previousNode":"nextNode"](),n.currentNode!==this.activeItem)return n.currentNode}},{key:"onTargetFocusIn",value:function(e){var t=this,n=e.target,r=e.relatedTarget,i=t.owner,a=t.itemsTabbable,o=t.skipScrollIntoView,l=t.previousActiveItem;if(!n.matches(".b-focus-trap"))if(n.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=n,t.skipScrollIntoView=o,t.activeItem&&a&&t.triggerNavigate(e);else if(n===t.target){var s;if((r?n.compareDocumentPosition(r):0)&Node.DOCUMENT_POSITION_CONTAINED_BY)null===(s=i.previousSibling)||void 0===s||s.focus();else t.skipScrollIntoView=!0,t.activeItem=l&&t.target.contains(l)?l:0,t.skipScrollIntoView=o}}},{key:"onTargetFocusOut",value:function(e){var t=this,n=e.relatedTarget;null!=n&&n.matches(".b-focus-trap")||n&&t.target.contains(n)&&n.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}},{key:"onTargetMouseDown",value:function(e){var t=this,n=e.target.closest(t.itemSelector);t.navigationEvent=e,t.itemsTabbable?n===t.activeItem&&t.triggerNavigate(e):!1===t.ownerCmp.itemsFocusable?t.onFocusGesture(e):n&&(e.preventDefault(),n.focus({preventScroll:!0}))}},{key:"onTargetMouseover",value:function(e){var t=e.target;this.activeItem=t}},{key:"onTargetClick",value:function(e){var t,n=this,r=n.skipScrollIntoView;n.skipNextClick||null!==(t=n.navigationEvent)&&void 0!==t&&t.ignoreNavigation?n.skipNextClick=!1:n.disabled||(n.skipScrollIntoView=n.activateOnMouseover,n.processEvent&&(e=n.callback(n.processEvent,n.thisObj||n.ownerCmp,[e])),e&&(n.activeItem=e.target.closest(n.itemSelector),n.triggerNavigate(e)),n.skipScrollIntoView=r)}},{key:"onFocusGesture",value:function(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}},{key:"acceptNode",value:function(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?li.NodeFilter.FILTER_ACCEPT:li.NodeFilter.FILTER_SKIP}},{key:"changeActiveItem",value:function(e){var t;return null!=e&&(this.ownerCmp.getItem?e=this.ownerCmp.getItem(e):"number"==typeof e&&(e=this.target.querySelector(this.itemSelector+":nth-child(".concat(e+1,")")))),null!==(t=e)&&void 0!==t&&t.matches(this.itemSelector)?e:null}},{key:"updateActiveItem",value:function(e,t){var n=this,r=n.ownerCmp,i=t&&n.target.contains(t),a=e&&li.isFocusable(e)&&e!==li.getActiveElement(e),o=e===t&&i;if(o||(i&&(n.previousActiveItem=t),t&&(t.classList.remove(n.focusCls),t.removeAttribute("id"))),null!=e){var l;if(n.skipScrollIntoView)a&&e.focus({preventScroll:!0});else null===(l=r.scrollable)||void 0===l||l.scrollIntoView(e,{block:"nearest",focus:a,silent:n.scrollSilently});if(o)return;e.classList.contains(n.focusCls)||e.classList.add(n.focusCls),e.id="".concat(n.owner.id,"-active-descendant"),n._activeItem=e}else n._activeItem=null,t===li.getActiveElement(t)&&r.revertFocus()}},{key:"updateTarget",value:function(e,t){var n=this,r={element:e,thisObj:n,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:n.itemSelector}};n.itemsTabbable||n.itemsFocusable||(r.click="onTargetClick"),n.activateOnMouseover&&(r.mouseover={handler:"onTargetMouseover",delegate:n.itemSelector,delay:30}),Object.prototype.hasOwnProperty.call(n,"acceptNode")||(n.acceptNode=n.acceptNode.bind(n)),fr.on(r),n.treeWalker=n.setupTreeWalker(e,li.NodeFilter.SHOW_ELEMENT,n.acceptNode),n.keyEventTarget||(n.keyEventTarget=e),(n.targetMutationMonitor=new MutationObserver(n.onTargetChildListChange.bind(n))).observe(e,{childList:!0,subtree:!0})}},{key:"setupTreeWalker",value:function(e,t,n){return document.createTreeWalker(e,t,n)}},{key:"onTargetChildListChange",value:function(){var e,t=this,n=t.activeItem,r=t.datasetIdProperty;n&&(t.target.contains(n)?n.classList.contains(t.focusCls)||n.classList.add(t.focusCls):t.activeItem=t.target.querySelector("".concat(t.itemSelector,".").concat(t.focusCls,"[data-").concat(Le.hyphenate(r),'="').concat(n.dataset[r],'"]'))||(null===(e=t.target.querySelector("".concat(t.itemSelector,".").concat(t.focusCls)))||void 0===e?void 0:e[n.dataset.index])||null)}},{key:"updateKeyEventTarget",value:function(e){var t;null===(t=this.keyListenerRemover)||void 0===t||t.call(this),this.keyListenerRemover=fr.on({element:e,keydown:"onKeyDown",thisObj:this})}},{key:"triggerNavigate",value:function(e){var t,n={event:e,item:arguments.length>1&&arguments[1]!==i?arguments[1]:this.activeItem,oldItem:this.previousActiveItem};this.trigger("navigate",n),null===(t=this.ownerCmp)||void 0===t||t.trigger("navigate",n)}}],[{key:"configurable",get:function(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,activateOnMouseover:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",columnCount:null,testConfig:{scrollDuration:1}}}},{key:"factoryable",get:function(){return{defaultType:"navigator"}}},{key:"getComposedKeyName",value:function(e){var t=(e.key||"").trim()||e.code;return"".concat(e.ctrlKey?"CTRL+":"").concat(e.shiftKey?"SHIFT+":"").concat(e.altKey?"ALT+":"").concat(t)}}])}(Mn.mixin(_n,Za));S(Jf,"$name","Navigator"),S(Jf,"type","navigator"),Jf._$name="Navigator";var Qf=document.createRange(),ev=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n,r=this;Array.isArray(e)&&(e={items:e});for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];B(t,"construct",this,3)([e].concat(a));var l=r.element,s=l.classList;r.multiSelect&&s.add("b-multiselect"),null!==(n=r.store)&&void 0!==n&&n.count?r.refresh():s.add("b-empty"),fr.on({element:l,click:"onClick",thisObj:r})}},{key:"doDestroy",value:function(){var e;this.detachListeners("store"),null===(e=this.navigator)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"changeScrollable",value:function(e){return(e=B(t,"changeScrollable",this,3)([e]))&&this.title&&(e.stickies=".b-list-title"),e}},{key:"onFocusIn",value:function(e){var n;this.restoreActiveItem(null===(n=e._target)||void 0===n?void 0:n.closest(this.itemSelector)),B(t,"onFocusIn",this,3)([e])}},{key:"isVirtualized",get:function(){return"number"==typeof this.virtualize?this.store.count>this.virtualize:Boolean(this.virtualize)}},{key:"outOfViewTpl",value:function(e,t){return'<li class="b-list-item b-out-of-view" data-index="'.concat(t,'" aria-posinset="').concat(t+1,'" aria-setsize="').concat(this.store.count,'" data-id="').concat(Le.encodeHtml(e.id),'"></li>')}},{key:"onItemIntersection",value:function(e,t){if(t){var n=this,r=parseInt(e.dataset.index),i=n.store.getAt(r);i&&li.sync(n.callback(n.itemWrapperTpl,n,[i,r,n]),e),n.itemIntersectionObserver.unobserve(e)}}},{key:"contentTpl",value:function(){var e=this,t=Math.ceil(e.height/e.listItemHeight),n=e.store.records.map((function(n,r){return!e.isVirtualized||r<t?e.callback(e.itemWrapperTpl,e,[n,r,e]):e.outOfViewTpl(n,r)}));if(e.multiSelect&&!1!==e.selectAllItem&&n.unshift(e.selectAllItemTpl()),e.title){var r="".concat(e.id,"-title");n.unshift('<li id="'.concat(r,'" class="b-list-item b-list-title" data-noselect>').concat(Le.encodeHtml(e.title),"</li>")),e.element.setAttribute("aria-labelledby",r)}else e.element.removeAttribute("aria-labelledby");return e.emptyText&&0===e.store.count&&n.push('<li class="b-list-item b-empty-text">'.concat(e.L(e.emptyText),"</li>")),Kf.tpl(Xf||(Xf=N(["",""])),n)}},{key:"itemWrapperTpl",value:function(e,t,n){var r=n.selected,i=n.getItemStyle,a=n.store,o=n.tooltipTemplate,l=(null==o?void 0:o(e))||"",s=[].concat(z(a.excludeCollapsedRecords?["--tree-level:".concat(e.childLevel||0)]:[]),z(i?[n.callback(i,n,[e])]:[])).join(";"),u=s.length?'style="'.concat(s,'"'):"",c=n.callback(n.isSelectable,n,[e]);return a.isGrouped&&!e.isGroupHeader&&e.instanceMeta(a).groupParent.meta.collapsed?"":e.ancestorsExpanded(a)?Kf.tpl(Zf||(Zf=N(["<li ",' aria-posinset="','" aria-setsize="','" class="','" role="option" ',' aria-selected="','" data-index="','" ',' data-id="','" ',">","</li>"])),u,t+1,this.store.count,n.getItemClasses(e,t),l?'data-btip="'.concat(Le.encodeHtml(l),'"'):"",r.includes(e),t,c?"":"data-noselect",Le.encodeHtml(e.id),n.itemsFocusable?'tabindex="-1"':"",n.itemContentTpl(e,t)):""}},{key:"itemContentTpl",value:function(e,t){var n=this;if(e.isGroupHeader||e.isParent&&!1!==n.store.excludeCollapsedRecords){var r=n.groupHeaderTpl(e,e.isParent?n.callback(n.itemTpl,n,[e]):Le.capitalize(e.meta.groupRowFor));if(n.collapsibleGroups||e.isParent){var i=e.isParent?e.instanceMeta(n.store).collapsed:e.meta.collapsed,a=i?"right":"down";r+='<button aria-label="'.concat(n.L("L{PanelCollapser."+(i?"Expand":"Collapse")+"}"),'" class="b-button b-tool b-icon b-icon-collapse-').concat(a,' b-list-expander-icon" data-noselect></button>')}return r}return"".concat(n.itemIconTpl(e,t)).concat(n.callback(n.itemTpl,n,[e]))}},{key:"itemIconTpl",value:function(e,t){return this.multiSelect&&this.callback(this.isSelectable,this,[e])?'<i aria-hidden="true" role="presentation" class="b-selected-icon b-icon '.concat(this.selectIconCls,'"></i>'):""}},{key:"selectAllItemTpl",value:function(){var e=this.allSelected?"b-selected":"";return'<li class="'.concat(this.itemCls," b-select-all-item ").concat(e,'" data-select-all data-id="select-all" ').concat(this.itemsFocusable?'tabindex="-1"':"",">").concat(this.itemIconTpl({}),"<div>").concat(this.L("L{selectAll}"),"</div></li>")}},{key:"getItemClasses",value:function(e){var t,n,r=this,i=r.getItemCls,a=r.store,o=null===(t=r._navigator)||void 0===t?void 0:t.activeItem,l=(null==o?void 0:o.dataset.id)==e.id,s="groupRowFor"in e.meta?"b-list-item-group-header":a.excludeCollapsedRecords&&e.isParent?"b-list-item-tree-parent":"",u=r.selected.includes(e)||(null===(n=e.groupChildren)||void 0===n?void 0:n.every((function(e){return r.selected.includes(e)}))),c=i?this.callback(i,this,[e]):"";return"".concat(r.itemCls," ").concat(e.cls||""," ").concat(c," ").concat(u?r.selectedCls:""," ").concat(l?r.navigator.focusCls:""," ").concat(s)}},{key:"onBeforeStoreLoad",value:function(){this.mask(this.L("L{loading}"))}},{key:"onAfterStoreRequest",value:function(){this.unmask()}},{key:"onStoreChange",value:function(e){var t=e.source,n=e.action,r=e.records,i=e.record,a=e.changes,o=e.isCollapse,l=this,s=l.selected;switch(n){case"dataset":s.match(t.storage,!l._externallyOwnedSelection);break;case"remove":o||s.remove(r);break;case"clear":l.deselectAll();break;case"update":var u=a.id;return u&&li.setAttributes(l.contentElement.querySelector(Le.encodeAttributeSelector("data-id",u.oldValue)),{"data-id":u.value}),void l.refreshItem(i)}l.refresh()}},{key:"onStoreRefresh",value:function(){this._selected?this.refresh():this.getConfig("selected")}},{key:"refresh",value:function(){var e=this;if(e.isVisible&&e.store){var t,n=null===(t=e.navigator)||void 0===t?void 0:t.activeItem;e.itemIntersectionObserver&&(e.itemIntersectionObserver.disconnect(),e.itemIntersectionObserver=null),e.paintListener=null;var r=li.createElementFromTemplate(e.contentTpl(),{fragment:!0});if(e.clearItems().insertNode(r),e.element.classList.toggle("b-virtualized",e.isVirtualized),e.isVirtualized){var i;e.itemIntersectionObserver=new IntersectionObserver((function(t){var n,r=D(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.onItemIntersection(i.target,i.isIntersecting,i)}}catch(e){r.e(e)}finally{r.f()}}));var a,o=D(e.element.querySelectorAll(e.itemSelector));try{for(o.s();!(a=o.n()).done;){var l=a.value;e.itemIntersectionObserver.observe(l)}}catch(e){o.e(e)}finally{o.f()}e.listItemHeight=null===(i=e.element.children[0])||void 0===i?void 0:i.clientHeight}n&&e.restoreActiveItem(n),e.refreshCount=(e.refreshCount||0)+1,e.element.classList.toggle("b-empty",0===e.store.count),e.updateSelectAllState()}else e.paintListener||(e.paintListener=e.once("paint","refresh"))}},{key:"clearItems",value:function(){var e=this,t=e.contentElement,n=t.querySelector(e.itemSelector),r=t.lastChild;if(n){var i=t.querySelectorAll("".concat(e.itemSelector,":not(.b-mask)"));Qf.setStartBefore(n),Qf.setEndAfter(i[i.length-1]),Qf.deleteContents()}else r?(Qf.setStartAfter(r),Qf.setEndAfter(r)):(Qf.setStart(t,0),Qf.setEnd(t,0));return Qf}},{key:"refreshItem",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r],o=this,l=o.getItem(a);if(l){var s=o.store.indexOf(a),u=li.createElementFromTemplate(o.callback(o.itemWrapperTpl,o,[a,s,o]));li.sync(u,l)}}}},{key:"getItem",value:function(e){var t;if(null!=e)return"number"==typeof e?this.contentElement.querySelector('[data-index="'.concat(e<0?this.store.count+e:e,'"]')):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),null!=(null===(t=e)||void 0===t?void 0:t.id)&&(e=e.id),this.contentElement.querySelector(Le.encodeAttributeSelector("data-id",e)))}},{key:"getRecordFromElement",value:function(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}},{key:"updateItems",value:function(e){var t=this;this.store.data=$e.asArray(null!=e?e:[]).map((function(e){return"string"==typeof e?S({},t.displayField,e):e}))}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.navigator&&(this.navigator.disabled=e)}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this.refresh()}},{key:"updateTitle",value:function(){this.refresh()}},{key:"changeSelected",value:function(e,t){var n=this,r={change:"onInternalSelectionChange",thisObj:n};if(e){if(e.isCollection)n._externallyOwnedSelection=!0,e.ion(r);else if(n._externallyOwnedSelection=!1,e=$e.asArray(e).reduce((function(e,t){return(t=t.isModel?t:n.store.getById(t))&&n.callback(n.isSelectable,n,[t])&&e.push(t),e}),[]),t)t.splice(0,t.count,e),e=t,n.refresh();else{var i=e;(e=n._selected=new us({internalListeners:r})).add(i)}e!==t&&(null==t||t.un(r))}else null==t||t.destroy();return e}},{key:"updateSelected",value:function(e){e&&this.refresh()}},{key:"itemSelector",get:function(){return".".concat(this.itemCls)}},{key:"selected",get:function(){return this._selected}},{key:"updateMultiSelect",value:function(e,t){var n=this._selected;!e&&t&&(null==n?void 0:n.count)>1&&(n.suspendEvents(),this.deselect(n.allValues.slice(1)),n.resumeEvents()),this.isConfiguring||this.refresh()}},{key:"store",get:function(){return this.getConfig("items"),this._store}},{key:"changeStore",value:function(e){var t=this;if(e instanceof Ff||(Array.isArray(e)&&(e={data:e}),e=new Ff(e)),t.detachListeners("store"),e){var n={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(n.beforeLoad="onBeforeStoreLoad",n.afterRequest="onAfterStoreRequest"),e.isGrouped&&(t.element.classList.add("b-grouped"),n.groupchange="onStoreRefresh"),e.ion(n),e.tree&&e.traverse((function(t){t.isParent&&!t.expanded&&e.onNodeExpand(t)}))}return e}},{key:"updateStore",value:function(e){null!=e&&e.records.length&&this.getConfig("selected"),this.refresh()}},{key:"changeNavigator",value:function(e,t){var n,r=this,i=r.element;i&&((null===(n=e=Jf.reconfigure(t,e?Jf.mergeConfigs({ownerCmp:r,disabled:r.disabled,target:i,keyEventTarget:i,activateOnMouseover:r.activateOnMouseover},e):null,r))||void 0===n?void 0:n.keyEventTarget)!==i||r.itemsTabbable||(i.tabIndex=0));return e}},{key:"minAlignHeight",get:function(){var e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return e?Math.min(e.offsetTop+e.offsetHeight,t):0}},{key:"alignTo",value:function(){V(t,"minHeight",this.minAlignHeight,this,1,1);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"alignTo",this,3)(n)}},{key:"hide",value:function(){this.navigator&&(this.navigator.activeItem=null);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(t,"hide",this,3)(n)}},{key:"show",value:function(){var e=this,n=e.refreshCount,r=e.navigator.previousActiveItem;V(t,"minHeight",e._minHeight,this,1,1);var i=B(t,"show",this,3)(arguments);return e.refreshCount===n&&e.containsFocus&&e.restoreActiveItem(r,!0),i}},{key:"restoreActiveItem",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.navigator.previousActiveItem,t=arguments.length>1&&arguments[1]!==i?arguments[1]:"nearest",n=this,r=n.navigator,a=n.lastAlignSpec;if(null!=e){if("string"!=typeof t){var o=a?a.zone:1;t=1&o?"nearest":o?"start":"end"}(e=n.getItem(e))&&!n.disabled&&(n.scrollable.scrollIntoView(e,{block:t}),r.activeItem=e)}}},{key:"onClick",value:function(e){var t=e.target.closest(this.itemSelector);t?this.onItemClick(t,e):this.clearSelectionOnEmptySpaceClick&&this.deselectAll()}},{key:"onSpaceKey",value:function(e){var t=e.target.nodeName.toUpperCase();("INPUT"!==t&&"TEXTAREA"!==t||e.target.readOnly)&&this.onEnterKey(e)}},{key:"onEnterKey",value:function(e){var t=this.navigator.activeItem;t&&!this.disabled&&(e.target=t,this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}},{key:"onInternalKeyDown",value:function(e){var t=this;switch(e.key){case"ArrowLeft":t.collapseItem();break;case"ArrowRight":t.expandItem();break;case" ":t.onSpaceKey(e);break;case"Enter":t.onEnterKey(e)}}},{key:"collapseItem",value:function(){var e=this.navigator.activeItem;e&&this.toggleCollapse(this.getRecordFromElement(e),!0)}},{key:"expandItem",value:function(){var e=this.navigator.activeItem;e&&this.toggleCollapse(this.getRecordFromElement(e),!1)}},{key:"onItemClick",value:function(e,t){var n=this,r=n.allowGroupSelect,i=parseInt(e.dataset.index),a=n.store.getAt(i),o=null==a?void 0:a.isSpecialRow,l=e.contains(t.target.closest("[data-noselect]"));if(!n.disabled&&!1!==n.trigger("beforeItem",{item:e,record:a,index:i,event:t,userAction:!0})){if(n._isUserAction=!0,e.contains(t.target.closest("[data-select-all]")))n.onSelectAllClick(e,t);else{if(t.target.matches(".b-list-expander-icon"))return void n.toggleCollapse(a);if(a&&!l&&(!o||r)){var s=n.selected,u=a.instanceMeta(n.store).groupParent;if(n.multiSelect){var c=s.includes(a),d=a;if(n.toggleAllIfCtrlPressed&&t.ctrlKey?d=n.store.records:r&&o&&(c=!a.groupChildren.some((function(e){return!s.includes(e)})),e.classList.toggle("b-selected",!c),d=a.groupChildren),s[c?"remove":"add"](d),!o&&u&&r)n.getItem(u).classList.toggle("b-selected",u.groupChildren.every((function(e){return s.includes(e)})))}else s.splice(0,s.count,a)}}n.isDestroyed||(n.lastClicked=a,n.trigger("item",{item:e,record:a,index:i,event:t,userAction:!0}),n._isUserAction=!1)}}},{key:"onInternalSelectionChange",value:function(e){var t=e.action,n=e.removed,r=e.added;e.replaced;var i,a,o=this,l=o.selectedCls,s=o.unselectedCls;if("clear"===t){var u,c=D(o.element.querySelectorAll(".".concat(l)));try{for(c.s();!(u=c.n()).done;)(a=u.value).classList.remove(l),a.setAttribute("aria-selected",!1),s&&a.classList.remove(s)}catch(e){c.e(e)}finally{c.f()}}else if("replaceValues"!==t){var d,h=D(n);try{for(h.s();!(d=h.n()).done;)i=d.value,(a=o.getItem(i))&&(a.classList.remove(l),a.setAttribute("aria-selected",!1))}catch(e){h.e(e)}finally{h.f()}var f,v=D(r);try{for(v.s();!(f=v.n()).done;)i=f.value,(a=o.getItem(i))&&(a.classList.add(l),a.setAttribute("aria-selected",!0))}catch(e){v.e(e)}finally{v.f()}}o.selectAllItem&&o.updateSelectAllState(),o.trigger("selectionChange",{selected:o.selected.values})}},{key:"onSelectAllClick",value:function(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}},{key:"updateSelectAllState",value:function(){var e;null===(e=this.element.querySelector(".b-select-all-item"))||void 0===e||e.classList.toggle(this.selectedCls,this.allSelected)}},{key:"updateAllowGroupSelect",value:function(){this.refresh()}},{key:"allSelected",get:function(){var e=this.selected,t=this.store;return e.count&&(t.isFiltered?t.records.every((function(t){return e.includes(t)})):t.count===e.count)}},{key:"selectAll",value:function(e){var t=this;!t.multiSelect&&e||(t.selected.add(t.store.records),e&&!t.navigator.activeItem&&(t.navigator.activeItem=t.getItem(-1)))}},{key:"deselectAll",value:function(){this.selected.clear()}},{key:"select",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this.store,r=this.selected,a=n.modelClass;e=$e.asArray(e).reduce((function(e,t){return(t=n.getById(a.asId(t)))&&e.push(t),e}),[]),t&&r.count?r.splice(0,r.count,e):r.add(e)}},{key:"deselect",value:function(e){var t=this,n=this.store.modelClass;e=$e.asArray(e).reduce((function(e,r){return(r=t.selected.get(n.asId(r)))&&e.push(r),e}),[]),this.selected.remove(e)}},{key:"toggleCollapse",value:function(e,t){var n=this.store;e.isGroupHeader?(n[(t=t===i?!e.meta.collapsed:t)?"collapse":"expand"](e),this.refresh(),this.trigger("toggleGroup",{groupRecord:e,collapse:t})):e.isParent&&(t=t===i?!e.instanceMeta(n).collapsed:t,e.instanceMeta(n).collapsed=t,this.refresh(),this.trigger("toggleNode",{record:e,collapse:t}))}},{key:"updateCollapsibleGroups",value:function(e,t){if(t&&!e){var n=this.store;n.groupRecords.forEach((function(e){return n.expand(e)}))}this.refresh()}}])}(Lo);S(ev,"$name","List"),S(ev,"type","list"),S(ev,"configurable",{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:{value:{},$config:"lazy"},navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,collapsibleGroups:!1,selectAllItem:!1,itemTpl:function(e){var t=Le.encodeHtml(e.getValue(this.displayField));return null!=t&&""!==t||(t="&nbsp;"),t},tooltipTemplate:null,getItemStyle:null,getItemCls:null,groupHeaderTpl:function(e,t){var n=Le.encodeHtml(t);return null!=n&&""!==n||(n="&nbsp;"),"".concat((this.allowGroupSelect||e.isParent)&&this.isSelectable(e)?this.itemIconTpl(e):"").concat(n)},allowGroupSelect:!0,clearSelectionOnEmptySpaceClick:!1,selected:{$config:["nullify","lazy"],value:[]},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"},title:null,virtualize:null,listItemHeight:10,isSelectable:function(){return!0},emptyText:null}),ev.initClass(),ev.prototype.navigatorClass=Jf,ev._$name="List";var tv=function(){return!0},nv=function(e,t){return e.text.localeCompare(t.text)},rv=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onFocusIn",value:function(){var e;(B(t,"onFocusIn",this,3)(arguments),this.formulaProvider)&&(null===(e=this.fieldsList)||void 0===e||e.show())}},{key:"onFocusOut",value:function(){var e;null===(e=this.fieldsList)||void 0===e||e.hide(),B(t,"onFocusOut",this,3)(arguments)}},{key:"internalOnKeyEvent",value:function(e){var n=this,r=e.key,i=n.fieldsList;if("keydown"===e.type){if("Enter"!==e.key&&(n.lastKey=e.key),"Escape"===r&&null!=i&&i.isVisible)return e.stopImmediatePropagation(),void i.hide();n.formulaPrefix&&"ArrowDown"===r&&(e.preventDefault(),null!=i&&i.isVisible||n.showFieldsList())}B(t,"internalOnKeyEvent",this,3)(arguments)}},{key:"internalOnInput",value:function(){B(t,"internalOnInput",this,3)(arguments),this.checkForFormula()}},{key:"updateValue",value:function(){B(t,"updateValue",this,3)(arguments),this.checkForFormula()}},{key:"checkForFormula",value:function(){var e,t;this.formulaPrefix=null!==(e=this.dataField)&&void 0!==e&&e.inputPrefixRE?null===(t=this.value.match(this.dataField.inputPrefixRE))||void 0===t?void 0:t[1]:null}},{key:"updateFormulaPrefix",value:function(e,t){var n,r,i,a=this;(a.formulaProvider=e&&(null===(n=a.dataField)||void 0===n||null===(r=n.getFormulaProvider)||void 0===r?void 0:r.call(n,e)),t&&a.input.classList.toggle("b-".concat(t.toLowerCase(),"-input"),!1),a.formulaProvider)?(a.input.classList.toggle("b-".concat(e.toLowerCase(),"-input"),!0),a.formulaProvider.setConfig({inputField:a,store:a.formulaStore}),a.whenVisible("showFieldsList")):null===(i=a.fieldsList)||void 0===i||i.hide()}},{key:"formula",get:function(){var e=this.formulaProvider,t=this.value;if(e){var n=e.formulaRE;return n?t.match(n):t}return""}},{key:"showFieldsList",value:function(){var e,t=this,n=t.input,r=null===(e=t.name)||void 0===e?void 0:e.replace(/^#/,""),i=t.up("gridbase",!0),a=t.fieldsList;if(a)a.owner=t,a.widgetMap.fields.navigator.keyEventTarget=n;else{var o;t.fieldFilter=r&&new Jl((function(e){return e.id!==r}));var l=t.fieldNames;a=t.fieldsList=new uc({title:"Fields",cls:"b-formula-fieldlist",floating:!0,forElement:t.inputWrap,scrollAction:"realign",owner:t,autoShow:!1,align:{matchSize:"min",align:"t0-b0",axisLock:!0,minHeight:40*Math.min(3,l.length)},layoutStyle:{padding:0},layout:"fit",items:{fields:{type:"list",items:l,itemsFocusable:!1,scrollable:{overflowY:!0},navigator:{keyEventTarget:n,activateOnMouseover:!0},getItemCls:function(e){if("this"===e.id||"data"===e.id)return"b-special-field"},onItem:function(e){var n=e.event,r=e.record;"click"===n.type&&(t.lastKey=null),n.key&&("Enter"!==n.key||"ArrowDown"!==t.lastKey&&"ArrowUp"!==t.lastKey)?n.stopImmediatePropagation=function(){return delete n.stopImmediatePropagation}:t.selectField(r.id)}}}}),null!==(o=t.owner)&&void 0!==o&&o.cellEditorContext?(i.ion({cellMousedown:"onCellMousedown",cellClick:"onCellClick",thisObj:t,prio:99999}),t.record=t.owner.cellEditorContext.record):t.record||(t.record=t.formulaProvider.record)}a.show(),a.activeItem=null}},{key:"onCellMousedown",value:function(e){var t=e.event;this.fieldsList.isVisible&&(t.preventDefault(),t.stopImmediatePropagation())}},{key:"onCellClick",value:function(e){var t=e.event,n=e.column.field;if(this.fieldsList.isVisible)return t.stopImmediatePropagation(),this.selectField(n),!1}},{key:"selectField",value:function(e){var t,n=this,r=n.input,i=r.value.trim(),a=r.selectionStart,o=a>=i.length,l=i.endsWith(")")?i.length:i.length+2;if(a>((null===(t=n.formulaProvider.prefix)||void 0===t?void 0:t.length)||0)+1&&a<l){var s,u,c="".concat(o||null!==(s=i[a-1])&&void 0!==s&&s.match(/\s|\(/)?"":" ","$").concat(e).concat(o||null!==(u=i[a])&&void 0!==u&&u.match(/\s|\)$/)?"":" ");r.setRangeText(c,a,a),r.selectionStart=a+c.length,n.inputting=!0,n.fetchInputValue(),n.inputting=!1}}},{key:"fieldNames",get:function(){var e=this;if(!e._fields){var t,n=(null===(t=e.formulaStore)||void 0===t?void 0:t.modelClass)||e.record.constructor,r=n.fieldMap,i=e.fieldFilter;(e._fields=n.fields.map((function(e){var t="string"==typeof e?e:e.name;return{id:t,text:r[t].label}})).filter(i?Jl.generateFiltersFunction([i]):tv).sort(nv)).push({text:"Record",id:"this"},{text:"Store",id:"data"})}return e._fields}}])}(e),S(t,"$name","FormulaField"),S(t,"configurable",{dataField:null,formulaPrefix:null}),t},iv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){"hidden"===(null==e?void 0:e.inputType)&&(e.hidden=!0),B(t,"construct",this,3)(arguments)}},{key:"getCurrentToken",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:/\s/,t=this.input,n=t.value,r=t.selectionStart,a=r,o=r+1;if(!n.length||null==r)return null;for(;a>0&&!n[a-1].match(e);)a--;for(;o<n.length&&!n[o].match(e);)o++;return{token:n.substring(a,o),cursor:r,start:a,end:o}}}])}(Uf.mixin(rv));S(iv,"$name","TextField"),S(iv,"type","textfield"),S(iv,"alias","text"),S(iv,"configurable",{nullValue:""}),iv.initClass(),iv._$name="TextField";var av,ov=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;null===(e=this.globalTapListener)||void 0===e||e.call(this),B(t,"doDestroy",this,3)([])}},{key:"changeEditable",value:function(e){return ne.isMobile&&!0!==this.initialConfig.editable&&(e=!1),e}},{key:"updateEditable",value:function(e){var n,i,a=this,o=a.element,l=a.ariaElement,s=a.nonEditableClickTarget,u=a.triggers.expand,c=r.matchMedia("(max-width: 410px)").matches;B(t,"updateEditable",this,3)(arguments),o.classList.toggle("b-not-editable",!e),null===(n=a.globalTapListener)||void 0===n||n.call(a),null===(i=a.nonEditableClickTargetListener)||void 0===i||i.call(a),!1===e?(ne.isMobile&&c&&(null==u||u.hide()),null==l||l.removeAttribute("aria-autocomplete"),s&&(a.nonEditableClickTargetListener=fr.on({element:s,click:function(e){var t=s.getRootNode().elementFromPoint(e.clientX,e.clientY);e.originalTarget===s&&t===s&&a.onTriggerClick(e)},thisObj:a}))):(null==u||u.show(),null==l||l.setAttribute("aria-autocomplete","list"),a.globalTapListener=Wn.ion({globaltap:"showKeyboard",thisObj:a}))}},{key:"nonEditableClickTarget",get:function(){return this.input}},{key:"pickerAlignElement",get:function(){var e=this._pickerAlignElement;return e.nodeType===Node.ELEMENT_NODE?e:Be.getPath(this,e)}},{key:"changePicker",value:function(e,n){var r=this;return t.reconfigure(n,e?pe.merge({id:r.id+"-picker",owner:r,forElement:r.pickerAlignElement,align:{matchSize:null==e.width,anchor:r.overlayAnchor,target:r.pickerAlignElement}},e):null,r)}},{key:"updatePicker",value:function(e){var t=this;t.detachListeners("pickerField.picker"),e&&(e.ion({name:"pickerField.picker",thisObj:t,show:"onPickerShow",hide:"onPickerHide"}),li.setAttributes(t.ariaElement,{role:t.role,"aria-haspopup":e.ownersRole,"aria-controls":e.id,"aria-expanded":e.isVisible}))}},{key:"updateRole",value:function(e){this.isConfiguring&&"textbox"!==e||this.ariaElement.setAttribute("role",e)}},{key:"childItems",get:function(){var e=B(t,"childItems",this,1);return this._picker&&e.push(this.picker),e}},{key:"onEditComplete",value:function(){B(t,"onEditComplete",this,3)([]),this.hidePicker()}},{key:"onElementResize",value:function(e){var n=this;n.pickerVisible&&n.picker.requestAnimationFrame(n.picker.realign,null,n.picker),B(t,"onElementResize",this,3)([e])}},{key:"internalOnKeyEvent",value:function(e){var n,r=this,i=!0;if("keydown"===e.type&&!r.disabled&&!e.shiftKey&&!e.ctrlKey)if(r.pickerVisible){var a=r.picker;"Escape"===e.key?(e.preventDefault(),e.stopImmediatePropagation(),r.hidePicker(),i=!1):a.onInternalKeyDown?a.onInternalKeyDown(e):"ArrowDown"===e.key&&a.focusable&&a.focus()}else"ArrowDown"!==e.key||!r.picker||null!==(n=r.triggers)&&void 0!==n&&null!==(n=n.expand)&&void 0!==n&&n.keyMap||r.onTriggerKeyDown(e);i&&B(t,"internalOnKeyEvent",this,3)([e])}},{key:"onFocusIn",value:function(e){var n,r=this,i=null===(n=Wn.currentPointerDown)||void 0===n?void 0:n.target;B(t,"onFocusIn",this,3)([e]),!r.autoExpand||null!=i&&i.matches(".b-fieldtrigger")||(r.minChars=0,r.onTriggerClick(e))}},{key:"onTriggerClick",value:function(e){this.disabled||this.togglePicker("key"in e)}},{key:"onTriggerKeyDown",value:function(e){!1!==this.trigger("triggerKey",{event:e})&&(e.stopImmediatePropagation(),e.preventDefault(),this.onTriggerClick(e))}},{key:"showKeyboard",value:function(e){var t=e.event,n=this.input;li.isTouchEvent&&li.getActiveElement(n)===n&&t.target===n&&(Wn.suspendFocusEvents(),n.blur(),n.focus(),Wn.resumeFocusEvents())}},{key:"togglePicker",value:function(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}},{key:"showPicker",value:function(e){var t,n=this,r=n.picker;r&&(r.show(),null===(t=n.ariaElement)||void 0===t||t.setAttribute("aria-expanded",!0),r.isVisible&&e&&n.focusPicker())}},{key:"onPickerShow",value:function(){var e=this;e.pickerActiveDescendant&&e.ariaElement.setAttribute("aria-activedescendant",e.pickerActiveDescendant),e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=Wn.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=fr.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}},{key:"onPickerHide",value:function(){var e,t,n=this,r=n.ariaElement;n.pickerActiveDescendant=null==r?void 0:r.getAttribute("aria-activedescendant"),null==r||r.removeAttribute("aria-activedescendant"),null==r||r.setAttribute("aria-expanded",!1),n.pickerVisible=!1,n.element.classList.remove("b-open"),n.trigger("togglePicker",{show:!1}),null===(e=n.pickerTapOutRemover)||void 0===e||e.call(n),null===(t=n.pickerKeyDownRemover)||void 0===t||t.call(n)}},{key:"onPickerTapOut",value:function(e){var t=e.event;this.containsFocus||this.owns(t.target)||this.hidePicker()}},{key:"onPickerKeyDown",value:function(e){if("Tab"===e.key&&!this.picker.trapFocus){var t=li.getActiveElement(this.input),n=new KeyboardEvent("keydown",e);this.input.dispatchEvent(n),n.defaultPrevented&&e.preventDefault(),li.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}},{key:"hidePicker",value:function(){this.pickerVisible&&this.picker.hide()}},{key:"focusPicker",value:function(){}},{key:"focus",value:function(){var e=this.input;li.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((function(){return e.readOnly=!1}),500)),B(t,"focus",this,3)([])}}],[{key:"configurable",get:function(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}}])}(iv);S(ov,"$name","PickerField"),S(ov,"type","pickerfield"),ov._$name="PickerField";var lv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"itemContentTpl",value:function(e,t){var n=this;return Kf.tpl(av||(av=N(["","\n            ","\n            ",""])),n.iconTpl?this.iconTpl(e):"",n.itemTpl(e,t),n.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':"")}},{key:"onInternalKeyDown",value:function(e){var n=this,r=n.selected,i=r.generation;n.closable&&r.count&&("Delete"===e.key||"Backspace"===e.key)?(n.closeHandler?n.callback(n.closeHandler,n.owner,[r.values,{isKeyEvent:!0}]):n.store.remove(r.values),r.generation!==i&&e.stopImmediatePropagation()):B(t,"onInternalKeyDown",this,3)([e])}},{key:"updateClosable",value:function(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.isConfiguring||this.refresh()}},{key:"onClick",value:function(e){var n=this,r=e.target.closest(".".concat(n.itemCls));if(n.closable&&e.target.classList.contains("b-close-icon")){var i=n.store.getAt(parseInt(r.dataset.index));n.closeHandler?n.callback(n.closeHandler,n.owner,[[i]]):n.store.remove(i)}else B(t,"onClick",this,3)([e])}}])}(ev);S(lv,"$name","ChipView"),S(lv,"type","chipview"),S(lv,"configurable",{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}),lv.initClass(),lv._$name="ChipView";var sv="L{fieldRequired}",uv="L{validateFilter}",cv=/[\w\s]/,dv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)(arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}},{key:"startConfigure",value:function(e){this.usingRecordAsValue=null===e.valueField,B(t,"startConfigure",this,3)(arguments)}},{key:"afterConfigure",value:function(){B(t,"afterConfigure",this,3)([]);var e=this;Be.hasOwn(e,"_value")||(e._value=e.nullValue,e._lastValue=e._lastValue||e._value)}},{key:"childItems",get:function(){var e=this._chipView,n=B(t,"childItems",this,1);return e&&n.push(e),n}},{key:"innerElements",get:function(){var e,t=null===(e=this._chipView)||void 0===e?void 0:e.element,n=this.input,r=this.inputElement;return t&&fa.sync({targetElement:n,domConfig:r}),[t||r]}},{key:"updateInlinePicker",value:function(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}},{key:"hidePicker",value:function(){if(!this.inlinePicker)return B(t,"hidePicker",this,3)(arguments)}},{key:"changeChipStore",value:function(e){return!e||e instanceof Ff||(e=new Ff(Ff.mergeConfigs({storage:this.valueCollection},e))),e}},{key:"updateChipStore",value:function(e,t){null==t||t.destroy()}},{key:"changeChipView",value:function(e,t){var n=this;if(n.element.classList[e?"add":"remove"]("b-uses-chipview"),e){var r=n.input;return n.chipStore||(n.chipStore={}),hv.reconfigure(t,e,{defaults:{parent:n,insertBefore:r,store:n.chipStore,closable:!n.readOnly,label:n.label,ariaLabel:n.ariaLabel,navigator:{type:"combochipnavigator",disabled:n.readOnly,keyEventTarget:r}}})}null==t||t.destroy()}},{key:"updateChipView",value:function(e){var t,n=this;n._chipViewEventDetacher=null===(t=n._chipViewEventDetacher)||void 0===t?void 0:t.call(n),n.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(n.input),n._chipViewEventDetacher=fr.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:n}))}},{key:"updateMultiSelect",value:function(e,t){var n=this,r=n.input,i=n.element,a=!n.isConfiguring,o=n.value;if(i.classList[e?"add":"remove"]("b-multiselect"),e){var l=n.chipView,s=r.parentNode,u=null==l?void 0:l.element;u&&u!==s&&(s.insertBefore(u,r),u.appendChild(r),n.chipView.refresh(),i.classList.add("b-uses-chipview")),r.value="",a&&(o=$e.asArray(o))}else{var c,d=n._chipView,h=r.parentNode,f=null==d?void 0:d.element;if(f===h&&(f.parentNode.insertBefore(r,f),f.remove(),i.classList.remove("b-uses-chipview")),a&&"string"!=typeof o)o=null!==(c=o)&&void 0!==c&&c.length?o[0]:null}a&&(n.value=o),n.isConfiguring||n.updateEditable(n.editable,null)}},{key:"onChipViewMousedown",value:function(e){e.preventDefault(),this.containsFocus||this.focus()}},{key:"onChipClose",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{};(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}},{key:"updateFilterParamName",value:function(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}},{key:"updateHideTrigger",value:function(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}},{key:"updateKeyStrokeFilterDelay",value:function(e){this.filterOnInput.delay=e}},{key:"updateReadOnly",value:function(e){B(t,"updateReadOnly",this,3)(arguments),this._chipView&&(this._chipView.closable=!e)}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this._chipView&&(this._chipView.closable=!e)}},{key:"updateFilterOperator",value:function(e){this.primaryFilter&&(this.primaryFilter.operator=e)}},{key:"minChars",get:function(){var e;return null!==(e=this._minChars)&&void 0!==e?e:this.remoteFilter?4:1}},{key:"validateFilter",get:function(){return this._validateFilter&&!this.createOnUnmatched}},{key:"items",get:function(){return this.store.allRecords}},{key:"updateBuildItems",value:function(e){e&&(this.items=e.call(this))}},{key:"changeItems",value:function(e){var t,n=this;if(null==e){if(n.store&&!n.store.isItemStore)return;e=[]}if(!n.buildItems||null!==(t=e)&&void 0!==t&&t.length||(e=n.buildItems()),e instanceof Ff)n.store=e;else{var r,i,a=!("valueField"in n.initialConfig),o=n.displayField,l=n.valueField;Array.isArray(e)?i=e.map((function(e){var t=e;return e instanceof od?(r=e.constructor,a&&!l&&(n.valueField=l=r.idField)):"string"==typeof e||"number"==typeof e?(a&&!l&&(n.valueField=l=n.displayField),t=S(S({},l,e),o,e)):(a&&!l&&(n.valueField=l="value"),Array.isArray(e)&&(t=S(S({},l,e[0]),o,e[1]))),e.selected&&(n.value=t),t})):(a&&!l&&(n.valueField=l="value"),i=[],Object.entries(e).forEach((function(e){var t=_(e,2),n=t[0],r=t[1];i.push(S(S({},l,n),o,r))})));var s=l===o?{name:"value",dataSource:o}:l;if(!r){var u=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"idField",get:function(){return n.valueField},set:function(e){V(t,"idField",e,this,1)}},{key:"fields",get:function(){var e=[s,o];return n.localizeDisplayFields&&e.push("localeClass"),e}}])}(od);r=u}n.store?n.store.setConfig({modelClass:r,data:i}):n.store=new Ff({isItemStore:!0,data:i,idField:l,verifyNoGeneratedIds:!1,modelClass:r,useRawData:!1})}}},{key:"value",get:function(){var e=this,t=e.valueCollection,n=e.valueField;return null==n?e.multiSelect?t.values.slice():t.first:e.multiSelect?t.count?t.map((function(e){return e[n]})):e._unmatchedValue||[]:t.count?t.first[n]:e._unmatchedValue||e.nullValue},set:function(e){V(t,"value",e,this,1,1)}},{key:"needsInputSync",get:function(){return!this.usesChipView&&!this.editable}},{key:"changeValue",value:function(e,t){var n,r=this,i=r.multiSelect;if(r._unmatchedValue=null,e!==t){if(!i&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");var a;if(r.triggerConfig("items"),!r.inputting)null===(a=r._chipView)||void 0===a||a.selected.clear();r.store||(r.items=[]);var l=r.valueField,s=r.displayField,u=r.nullValue,c=r.store,d=r.valueCollection,h=r._picker,f=c.storage,v=null!==(n=r.hidePickerOnSelect)&&void 0!==n?n:!i,g=r._isUserAction||(null==h?void 0:h._isUserAction)||v&&r.pickerVisible||!1;if(e!=u&&null!=e){var m;if(!r.remoteFilter&&c.isAjaxStore&&!c.count)return c.ion({load:function(){return r.value=e},once:!0,thisObj:r}),void(r._unmatchedValue=e);var p=Array.isArray(e),y=p?e.slice():[e];if(r.remoteFilter){if(Be.isObject(e)||e.isModel)c.getById(e.id)?r.valueCollection.splice(0,r.valueCollection.count,c.getById(e.id)):(c.data=[e],r.valueCollection.splice(0,r.valueCollection.count,c.first));else{var k=r.isConfiguring;r.primaryFilter.setConfig({value:e,disabled:!1}),c.performRemoteFilter(!0).then((function(){if(!r.isDestroyed){var e=r.isConfiguring;r.isConfiguring=k,d.splice(0,d.count,c.allRecords),r.isConfiguring=e}}))}return}c.isFiltered?(c.isChained&&c.fillFromMaster(),r.primaryFilter.disabled=!0,c.filter()):c.isChained&&c.fillFromMaster();for(var b=0,C=y.length;b<C;b++){var w=y[b];if(w instanceof od)f.includes(w,!0)||c.add(w);else{var D=Be.isObject(w);D&&l&&(w=w[c.modelClass.fieldMap[l].dataSource]),(m=f.getBy(s,w)||f.getBy(l,w)||d.getBy(s,w)||d.getBy(l,w))instanceof o&&(m=z(m)[0]),m?(D&&m.set(y[b]),y[b]=m):(y.splice(b,1),C--,b--)}}var S=!y.length,x=d.generation;d.splice(0,d.count,y),S&&(r._value=p&&0===e.length?null:e,r._unmatchedValue=r._value),(S||d.generation===x)&&r.syncInputFieldValue(),r.syncEmpty(),S&&!r.isConfiguring&&r.triggerFieldChange({value:e,oldValue:t,userAction:g,valid:r.isValid})}else if(d.count)d.clear();else{var E=r._value;r._value=null,r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||r.triggerFieldChange({value:e,oldValue:E,userAction:g,valid:r.isValid})}r.remoteFilter||(r._lastValue=r._value)}else r.syncInputFieldValue(!0)}},{key:"hasChanged",value:function(e,n){return this.multiSelect?!Be.isEqual(e,n):B(t,"hasChanged",this,3)(arguments)}},{key:"onComboStoreChange",value:function(e){"filter"!==e.action&&this.syncInputFieldValue(!0)}},{key:"syncInputFieldValue",value:function(e){var n;this.usesChipView?null===(n=this.chipView)||void 0===n||n.refresh():B(t,"syncInputFieldValue",this,3)([e])}},{key:"usesChipView",get:function(){return Boolean(this.multiSelect&&this._chipView)}},{key:"isEmpty",get:function(){return 0===this.valueCollection.count&&!this._unmatchedValue}},{key:"inputValue",get:function(){var e=this,t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}},{key:"nonEditableClickTarget",get:function(){var e;return this.multiSelect&&(null===(e=this.chipView)||void 0===e?void 0:e.element)||B(t,"nonEditableClickTarget",this,1)}},{key:"changeValueCollection",value:function(e,t){if(null==t||t.destroy(),e)return e.isCollection||(e=new us({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}},{key:"changePrimaryFilter",value:function(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):("function"==typeof e&&(e={filterBy:e}),e=new Jl(F({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive},e))),e}},{key:"changeStore",value:function(e){var t=this,n=[],r=t.valueCollection,i=t.keyStrokeFilterDelay,a=t.filterParamName;if(!Array.isArray(e)){var o;if(e){if(e.isStore){var l=e.filters.get("primary");t.remoteFilter&&(e.filterParamName=a),o=e.remoteFilter,l?t.primaryFilter=l:n.push(t.primaryFilter)}else"string"==typeof e?e=Ff.getStore(e):(e=new(e.readUrl?Pf:Ff)(e),t.destroyStore=!0),(o=t.remoteFilter||e.restfulFilter)&&a&&(e.filterParamName=a,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),n.push(t.primaryFilter);if(t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),t.filterSelected){var s=function(e){return!t.containsFocus||!r.includes(e)};o?(e.storage.autoFilter=!0,e.storage.addFilter({id:"".concat(t.id,"-selected-filter"),filterBy:s})):(n.push(s),e.reapplyFilterOnAdd=!0)}r.addIndex({property:t.displayField,unique:!1}),r.addIndex({property:t.valueField,unique:!0}),n.forEach((function(t){return e.addFilter(t,!0)})),t.keyStrokeFilterDelay=o?Math.max(300,i||0):null!=i?i:10}return t.valueField!==t.displayField||t.peekConfig("multiSelect")||(t.nullValue=""),e}t.items=e}},{key:"updateStore",value:function(e,t){var n,r=this,i=r._picker;r.destroyStore&&t&&t.destroy(),i&&(i.store=e),e.storage.addIndex({property:r.displayField,unique:!1}),e.storage.addIndex({property:r.valueField,unique:!0}),n={filter:"onStoreFilter"},r.displayValueRenderer&&((n||(n={})).change="onComboStoreChange"),r.detachListeners("store"),(null==e?void 0:e.storage)&&r.valueCollection.match(e.storage),r.syncInputFieldValue(),n&&(n.name="store",n.thisObj=r,e.ion(n))}},{key:"remoteFilter",get:function(){var e;return Boolean(this.filterParamName||(null===(e=this._store)||void 0===e?void 0:e.restfulFilter))}},{key:"record",get:function(){return this.selected}},{key:"records",get:function(){return this.valueCollection.values.slice()}},{key:"selected",get:function(){var e=this.store;return this.multiSelect?this.valueCollection.values.slice().sort((function(t,n){return e.indexOf(t)-e.indexOf(n)}))[0]:this.valueCollection.first}},{key:"onEditComplete",value:function(){var e=this,n=e.valueCollection.count;B(t,"onEditComplete",this,3)([]),n&&(e.clearError(uv),e.syncInputFieldValue()),e.required&&!n&&e.setError(sv)}},{key:"onTriggerClick",value:function(e){var t=this,n="key"in e;if(!t.remoteFilter||!t.filterOnEnter)if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled){var r;switch(null===(r=t.triggerAction)||void 0===r?void 0:r.toLowerCase()){case"all":t.doFilter(null,n);break;case"last":t.doFilter(t.lastQuery,n);break;default:t.doFilter(t.input.value,n)}}}},{key:"internalOnInput",value:function(e){var t=this;t.clearWhenInputEmpty&&""===t.input.value&&t.clear(),t.syncEmpty(),t.syncInputWidth(),t.filterOnInput(e),t.trigger("input",{value:t.input.value,event:e})}},{key:"filterOnInput",value:function(e){var t=this,n=("input"===e.type?e.target:t.input).value,r=n.length;t.inputting=!0,t.inlinePicker||r>=t.minChars&&(!t.filterOnEnter||"Enter"===e.key)?t.doFilter(n):(t.validateFilter&&!t.remoteFilter&&t[r?"setError":"clearError"](uv),t.hidePicker()),t.inputting=!1}},{key:"syncInputWidth",value:function(){var e=this;if(e.usesChipView){var t=e.input,n=e._inputPadding||(e._inputPadding=li.getEdgeSize(t,"padding","lr")),r=t.value||"",i=li.measureText(r+"W",t,!1,e.element)+n.width;t.style.flex="1 1 ".concat(Math.ceil(i),"px")}}},{key:"doFilter",value:function(e,t){var n,r=this,i=r.store,a=r.picker,o=null==e||""===e;r.lastQuery=e,r.primaryFilter.setConfig({value:e,disabled:o}),r.remoteFilter&&i.clear(!0);var l=function(){var e=a.navigator,t=a.isVisible;i.count?!o&&e&&(e.activeItem=0):r.remoteFilter||o||(e&&(e.activeItem=null),r.editable&&r.validateFilter&&r.setError(uv)),t&&a.realign()};null===(n=r.filterPromise=i.filter())||void 0===n||n.then((function(){r.filterPromise=null,l()})),r.inlinePicker||(null!=a&&a.isVisible?0===a.lastAlignSpec.zone&&a.realign():r.showPicker(t)),r.filterPromise||l()}},{key:"onStoreFilter",value:function(e){var t=e.source,n=this,r=n._picker,i=null==r?void 0:r.element.dataset,a=t.count;n.remoteFilter&&(a?r&&(r.navigator.activeItem=0):n.validateFilter&&n.setError(uv),n.filterSelected&&n.valueCollection.count&&(t.storage.onFiltersChanged({action:"splice",oldCount:1}),r&&r.refresh())),i&&(n.createOnUnmatched&&!a&&null!=n.primaryFilter.value?i.addNewValue=n.L("L{addNewValue}")(n.primaryFilter.value):null==i||delete i.addNewValue)}},{key:"onValueCollectionChange",value:function(e){var t,n=e.source,r=this,i=r.multiSelect,a=r._picker,o=r.nullValue,l=null!==(t=r.hidePickerOnSelect)&&void 0!==t?t:!i,s=i?n.values.slice():n.first,u=n.values.slice(),c=r._isUserAction||(null==a?void 0:a._isUserAction)||l&&r.pickerVisible||!1,d=r._value;if(l&&r.hidePicker(),i&&r.clearTextOnSelection&&(r.input.value=""),!n.count&&r.required?r.setError(sv):(r.clearError(sv),r.clearError(uv)),r.validateFilter&&s&&r.clearError(uv),r.filterSelected){var h,f=null==a?void 0:a.navigator,v=Number(null==f||null===(h=f.activeItem)||void 0===h||null===(h=h.dataset)||void 0===h?void 0:h.index);r.remoteFilter?(r.store.storage.onFiltersChanged({action:"splice",oldCount:1}),r._picker&&r._picker.refresh()):r.store.filter(),isNaN(v)||(f.activeItem=Math.min(a.store.count,v))}r._value=o,r._lastValue=o;var g,m=r.cacheCurrentValue(r.value);(r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring)||(m===d||r.onConfigChange.$nullFn||r.onConfigChange({name:"value",value:m,was:d,config:r.$meta.configs.value}),r.triggerFieldChange({value:m,oldValue:d,userAction:c,valid:r.isValid}),null===(g=r.trigger)||void 0===g||g.call(r,"select",{record:s,records:u,userAction:c}),"select"===r.defaultAction&&r.trigger("action",{value:m,record:s,records:u,userAction:c}))}},{key:"cacheCurrentValue",value:function(e){return this._value=e}},{key:"onValueCollectionNoChange",value:function(e){var t=e.toAdd;!this.inlinePicker&&!this.multiSelect&&t.length&&this.pickerVisible&&(this.picker.hide(),this.syncInputFieldValue())}},{key:"showPicker",value:function(){var e=this,n=e.picker;if(!e.readOnly&&!e.inlinePicker){var r;if(n.multiSelect=e.multiSelect,B(t,"showPicker",this,3)(arguments),e.overlayAnchor&&!n.align.offset&&(n.align.offset=-n.anchorSize[1],n.realign()),n.restoreActiveItem)if(e.multiSelect)n.restoreActiveItem((null===(r=n.navigator)||void 0===r?void 0:r.previousActiveItem)||e.selected||0,!0);else n.restoreActiveItem(e.selected||0,!0);e.input.focus()}}},{key:"changePicker",value:function(e,t){if(e){var n,r=this,a=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width),o=ev.mergeConfigs(S(S(S({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,displayField:r.displayField,forElement:r.pickerAlignElement,emptyText:r.emptyText,align:{matchSize:null==a&&"min",anchor:r.overlayAnchor,target:r.pickerAlignElement,minHeight:r.inlinePicker?null:40*Math.min(3,r.store.count)}},r.listItemTpl?"itemTpl":i,r.listItemTpl),"width",a),"navigator",{keyEventTarget:r.input,activateOnMouseover:!r.inlinePicker}),e);r.inlinePicker&&Object.assign(o,{floating:!1,align:null,maxHeight:null,appendTo:r.element}),(e=ev.reconfigure(t,e?o:null,r)).element.classList.add("b-combo-picker"),e.ion({navigate:"onPickerNavigate",thisObj:r}),fr.on({element:e.element,pointerdown:function(e){return r.onPickerNavigate({event:e})},thisObj:r})}else null==t||t.destroy();return e}},{key:"onPickerNavigate",value:function(e){e.event.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}},{key:"onPickerHide",value:function(){var e=this;B(t,"onPickerHide",this,3)([]),e.multiSelect&&e.clearTextOnPickerHide&&!e.errors&&(e.input.value="")}},{key:"internalOnKeyEvent",value:(r=f(L().mark((function e(n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).input[r.inputValueAttr],a=i.length,o=n.key,l=n.type,s=r.primaryFilter,u=r.store,c=r.multiSelect,d=r.minChars,h=r._picker,f=r._chipView,"keydown"!==l||null==h||!h.isVisible||!h.navigator){e.next=16;break}if(!(g=h.navigator.activeItem)||!c||o!==r.multiValueSeparator){e.next=11;break}return r.input.value="",h.onItemClick(g,n),s.setConfig({value:"",disabled:!0}),u.filter(),h.hide(),n.preventDefault(),e.abrupt("return");case 11:if(g||!r.createOnUnmatched||!(c&&o===r.multiValueSeparator||"Enter"===o)){e.next=16;break}return n.preventDefault(),e.next=15,r.addNewRecord(i);case 15:return e.abrupt("return");case 16:r.editable?!f||f.selected.count||"keydown"!==l||"Backspace"!==o||a||(f.navigator.activeItem=r.valueCollection.count-1,n.stopImmediatePropagation()):"keydown"===l&&"Backspace"===o&&null!==(m=r.nonEditableFilterValue)&&void 0!==m&&m.length?(r.nonEditableFilterValue=r.nonEditableFilterValue.substring(0,r.nonEditableFilterValue.length-1),r.doFilter(r.nonEditableFilterValue),r.lastFilterKeypressTime=n.timeStamp):"keypress"===l&&1===o.length&&o.match(cv)&&((!r.lastFilterKeypressTime||n.timeStamp-r.lastFilterKeypressTime>r.nonEditableFilterTimeout)&&(r.nonEditableFilterValue=""),r.nonEditableFilterValue=(r.nonEditableFilterValue||"")+o,r.doFilter(r.nonEditableFilterValue),r.lastFilterKeypressTime=n.timeStamp),r.pickerVisible&&"Enter"===o&&r.primaryFilter.value===r.input.value&&(v=!0),B(t,"internalOnKeyEvent",this,3)(p),"keydown"===n.type&&"Enter"===o&&!v&&r.remoteFilter&&(a>=d?(n.stopPropagation(),r.filterOnInput.now(n)):a>0&&(n.stopPropagation(),r.setError("L{Field.tooShort}"+" (".concat(d,")"),!1,!0)));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"addNewRecord",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).store,i=n._picker,a=n.valueCollection,o=n.multiSelect,l=n.primaryFilter,s=r.remoteFilter&&r.autoCommit,!n.filterPromise){e.next=4;break}return e.next=4,n.filterPromise;case 4:if(s||(l.setConfig({value:"",disabled:!0}),r.filter()),n._isUserAction=!0,u=r.add(n.callback(n.createOnUnmatched,n,[t,n])),c=_(u,1),d=c[0],!r.isCommitting){e.next=19;break}return e.prev=8,e.next=11,r.autoCommitTimeoutPromise;case 11:return e.next=13,r.commitPromise;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(8),h=null===(f=e.t0.response)||void 0===f||null===(f=f.parsedJson)||void 0===f?void 0:f.error;case 18:d.isPhantom&&(n.clearError(),n.setError(h||"L{recordNotCommitted}",!1,!0),r.remove(d),r.removed.remove(d));case 19:s&&(l.setConfig({value:"",disabled:!0}),r.filter()),n.input.value="",r.includes(d)&&a.splice(o?a.count:0,o?0:a.count,d),null==i||i.hide(),n._isUserAction=!1;case 24:case"end":return e.stop()}}),e,this,[[8,15]])}))),function(e){return n.apply(this,arguments)})},{key:"changeCreateOnUnmatched",value:function(e){return!0===e&&(e=this.defaultRecordCreator),e}},{key:"defaultRecordCreator",value:function(e){return this.store.createRecord(S({},this.displayField,e))}},{key:"updateLocalizeDisplayFields",value:function(e){e?this.localizableProperties.push("store"):$e.remove(this.localizableProperties,"store")}},{key:"localizeProperty",value:function(e){return"store"===e?this.localizeStore():B(t,"localizeProperty",this,3)([e])}},{key:"localizeStore",value:function(){var e=this,t=e.displayField,n=e.localizedDisplayFieldsMap;n||(e.localizedDisplayFieldsMap=n=new a),!e.store&&e.buildItems&&(e.items=e.buildItems());var r,i=D(e.items);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.id){var l,s=n.get(o.id);!s&&null!==(l=o[t])&&void 0!==l&&l.startsWith("L{")&&(s=o[t],n.set(o.id,s)),s&&(o[t]=(o.localeClass||e).L(s))}}}catch(e){i.e(e)}finally{i.f()}e.sortItemsOnLocaleChange&&e.store.sort(),e.syncInputFieldValue()}},{key:"createOverflowTwin",value:function(e){return B(t,"createOverflowTwin",this,3)([F({store:this.store},e)])}}],[{key:"configurable",get:function(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:i,displayField:"text",clearWhenInputEmpty:null,pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:function(e){return e.map((function(e){return e.value}))},filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:"L{Combo.noResults}",value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,clearTextOnSelection:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0,nonEditableFilterTimeout:200},localizeDisplayFields:!1,buildItems:null,sortItemsOnLocaleChange:!1,nonEditableFilterTimeout:2e3}}},{key:"queryLast",get:function(){return"last"}}]);var n,r}(ov);S(dv,"$name","Combo"),S(dv,"type","combo"),S(dv,"alias","combobox,dropdown"),S(dv,"delayable",{filterOnInput:0});var hv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl:function(e){return Le.encodeHtml(e.getValue(this.owner.displayField))},scrollable:{overflowY:"auto"}}}}])}(lv);S(hv,"$name","ComboChipView"),S(hv,"type","combochipview");var fv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onTargetClick",value:function(e){var t=this,n=e.target.closest(t.itemSelector);n&&!e.target.classList.contains("b-close-icon")&&(e.shiftKey||n.contains(e.target.closest("[data-noselect]"))||t.ownerCmp.selected.clear(),t.inClickHandler=!0,t.activeItem=n,t.inClickHandler=!1)}},{key:"onKeyDown",value:function(e){"Enter"===e.key||e.target.selectionStart||e.target.selectionEnd||B(t,"onKeyDown",this,3)([e])}},{key:"updateActiveItem",value:function(e,n){var r=this.ownerCmp;B(t,"updateActiveItem",this,3)([e,n]),e&&!this.inClickHandler&&r.selected.add(r.getRecordFromElement(e))}},{key:"navigatePrevious",value:function(e){var n=this.ownerCmp;n.navigator.activeItem&&!e.shiftKey&&n.selected.clear(),this.previous?B(t,"navigatePrevious",this,3)([e]):this.activeItem=null}},{key:"navigateNext",value:function(e){var n=this.ownerCmp;n.navigator.activeItem&&!e.shiftKey&&n.selected.clear(),this.next?B(t,"navigateNext",this,3)([e]):this.activeItem=null}}],[{key:"configurable",get:function(){return{allowShiftKey:!0}}}])}(Jf);S(fv,"$name","ComboChipNavigator"),S(fv,"type","combochipnavigator"),dv.initClass(),hv.initClass(),fv.initClass(),dv._$name="Combo";var vv=function(){return w((function e(){m(this,e)}),[{key:"changePicker",value:function(e,t){var n=this._overridden.changePicker.call(this,e,t);return null==n||n.element.setAttribute("tabindex","-1"),n}}],[{key:"target",get:function(){return{class:dv}}}])}();We.apply(vv);var gv=Ct.prototype.process;Ct.prototype.process=function(e,t){return t=t.map((function(e){if("object"===W(e)&&"DOMTokenList"===e.constructor.name){var t={};return Array.from(e).forEach((function(e){return t[e]=1})),t}return e})),gv.call(this,e,t)};var mv=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:li}}},{key:"getActiveElement",value:function(e){var t,n,r;return null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element),null===(n=e)||void 0===n||null===(r=n.getRootNode)||void 0===r||null===(r=r.call(n))||void 0===r?void 0:r.activeElement}}])}();We.apply(mv);var pv=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:li}}},{key:"elementFromPoint",value:function(e,t){return document.elementsFromPoint(e,t)[0]}}])}();We.apply(pv);var yv=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:li}}},{key:"getCommonAncestor",value:function(e,t){var n=this._overridden.getCommonAncestor.call(this,e,t);return null!=n&&n.isConnected&&!n.parentElement&&(n=n.firstChild),n}}])}();We.apply(yv);var kv={auto:1,scroll:1},bv=function(e){var t=e.ownerSVGElement?e.ownerSVGElement.parentNode:e.parentNode||e.target;return(null==t?void 0:t.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?t.host:t},Cv=function(e){return kv[null==e?void 0:e.overflowX]||kv[null==e?void 0:e.overflowY]},wv=document.body,Dv=function(){return w((function e(){m(this,e)}),null,[{key:"getVisibleViewport",value:function(e,t,n){for(var r,i,a=[],o=t,l=e;l&&l!==wv;l=bv(l)){var s=(i=void 0,null==(r=l)||null===(i=r.ownerDocument)||void 0===i||null===(i=i.defaultView)||void 0===i?void 0:i.getComputedStyle(r));Cv(s)&&"contents"!==(null==s?void 0:s.display)&&a.unshift(pt.client(l,null,!0,!0,n))}for(var u=0,c=a.length;o&&u<c;u++)o=o.intersect(a[u]);return o}}])}();S(Dv,"target",{class:li}),We.apply(Dv);var Sv=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:li}}},{key:"isVisible",value:function(e){for(var t,n,r,i=e.ownerDocument;e;e=(r=e).parentNode||r.host){if(e===i)return!0;if(e.nodeType===Element.ELEMENT_NODE&&(n=void 0,"none"===(n=(t=e).ownerDocument.defaultView.getComputedStyle(t)).getPropertyValue("display")||"hidden"===n.getPropertyValue("visibility")))return!1;if(!e.parentNode&&e.isConnected)return!0}return!1}}])}();We.apply(Sv);var xv=function(){return w((function e(){m(this,e)}),[{key:"getMouseMoveListenerTarget",value:function(e){return li.getRootElement(e)}}])}();S(xv,"target",{class:Qi}),We.apply(xv);var Ev=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateSelector",value:function(e){this.treeWalker=document.createTreeWalker(this.element,NodeFilter.SHOW_ELEMENT,"string"==typeof e?function(t){var n;return null!==(n=t.matches)&&void 0!==n&&n.call(t,e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}:e)}},{key:"first",value:function(){return this.treeWalker.currentNode=this.element,this.treeWalker.firstChild()}},{key:"previous",value:function(e){return e&&(this.treeWalker.currentNode=e),this.treeWalker.previousNode()}},{key:"next",value:function(e){return e&&(this.treeWalker.currentNode=e),this.treeWalker.nextNode()}},{key:"last",value:function(){return this.treeWalker.currentNode=this.element,this.treeWalker.lastChild()}}],[{key:"getVisitor",value:function(e,n){var r=this.elementVisitorMap,i=r.get(e)||r.set(e,new a).get(e),o="string"==typeof n?n:n.toString();return i.get(o)||i.set(o,new t({element:e,selector:n})).get(o)}}])}(Mn);S(Ev,"$name","ElementVisitor"),S(Ev,"configurable",{element:null,selector:null}),S(Ev,"elementVisitorMap",new WeakMap),Ev._$name="ElementVisitor";var Rv=function(){return w((function e(){m(this,e)}),[{key:"updateSelector",value:function(e){this.treeWalker=Di(this.element,hi.SHOW_ELEMENT,"string"==typeof e?function(t){var n;return null!==(n=t.matches)&&void 0!==n&&n.call(t,e)?hi.FILTER_ACCEPT:hi.FILTER_SKIP}:e)}}],[{key:"target",get:function(){return{class:Ev}}}])}();We.apply(Rv);var Tv,Mv=/-/,Fv=Symbol("props"),Av={originalTarget:!0,explicitOriginalTarget:!0,rangeParent:!0},Iv=function(e){return e[Fv]?e:new Proxy(function(e){var t=Object.create(e),n=e.relatedTarget;n&&!n.nodeType&&Object.defineProperty(t,"relatedTarget",{get:function(){return null},configurable:!0});var r=Object.create(null);for(var i in e)Av[i]||"function"!=typeof e[i]&&(r[i]=e[i]);return t[Fv]=r,t}(e),{get:function(e,t){var n=function(e,t){return Object.hasOwn(e,t)?e:t in e[Fv]?e[Fv]:Object.getPrototypeOf(e)}(e,t),r=n[t];return"function"==typeof r?function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.call.apply(r,[n].concat(t))}:r}})},Lv=function(){return w((function e(){m(this,e)}),null,[{key:"getComposedPathTarget",value:function(e){if(null==Tv)try{e.composedPath()[0],Tv=!1}catch(e){Tv=!0}return Tv?e.path?e.path[0]:e.target:e.composedPath()[0]}},{key:"fixEvent",value:function(e){if((e=this._overridden.fixEvent.call(this,Iv(e))).target&&e.path&&Mv.test(e.target.tagName)){var t=e.path[0],n=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:function(){return t},configurable:!0}),Object.defineProperty(e,"originalTarget",{get:function(){return n},configurable:!0}))}return e}}])}();S(Lv,"target",{class:fr}),We.apply(Lv);var Ov=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:fr}}},{key:"addListener",value:function(e,t,n,r){return 11===(null==e?void 0:e.nodeType)&&r&&"capture"in r&&delete r.capture,this._overridden.addListener.call(this,e,t,n,r)}},{key:"addElementListener",value:function(e,t,n,r){return 11===(null==e?void 0:e.nodeType)&&n&&(delete n.capture,delete n.once,delete n.passive),this._overridden.addElementListener.call(this,e,t,n,r)}}])}();We.apply(Ov);var Pv=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:Uf}}},{key:"configurable",get:function(){var e=this._overridden.configurable;return e.autoComplete=null,e}}])}();We.apply(Pv);var _v=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:Wn}}},{key:"setupFocusListenersOnce",value:function(e,t){e!==document.body&&this._overridden.setupFocusListenersOnce.apply(this,arguments)}}])}();We.apply(_v),Object.defineProperty(va,"element",{get:function(){return null}});var Hv=function(){return w((function e(){m(this,e)}),[{key:"setupTreeWalker",value:function(){return Di.apply(void 0,arguments)}},{key:"acceptNode",value:function(e){var t;return e.offsetParent&&null!==(t=e.matches)&&void 0!==t&&t.call(e,this.itemSelector)?hi.FILTER_ACCEPT:hi.FILTER_SKIP}}],[{key:"target",get:function(){return{class:Jf}}}])}();We.apply(Hv);var Bv=function(){return w((function e(){m(this,e)}),null,[{key:"target",get:function(){return{class:pe}}},{key:"isObject",value:function(e){return e!==r&&this._overridden.isObject.call(this,e)}}])}();We.apply(Bv);var Vv=function(){return w((function e(){m(this,e)}),[{key:"setupTreeWalker",value:function(){return Di.apply(void 0,arguments)}}],[{key:"target",get:function(){return{class:uc}}}])}();We.apply(Vv);var Nv=Array.from(Array(24)).map((function(e,t){return{id:t,text:String(t+100).slice(1)}})),zv=Array.from(Array(60)).map((function(e,t){return{id:t,text:String(t+100).slice(1)}})),jv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"alignTo",value:function(){var e=this.widgetMap,n=this.owner.input,r=n.minute,i=n.second;return this.getConfig("is24Hour"),this.minimizeHeight&&(e.hour.maxHeight=e.second.maxHeight=e.minute.height),e.minute[r?"show":"hide"](),e.second[i?"show":"hide"](),B(t,"alignTo",this,3)(arguments)}},{key:"updateIs24Hour",value:function(e){this.widgetMap.hour.store.filter((function(t){return!!e||t.id<12}))}},{key:"updateStep",value:function(e){e=Pl.as("m",e.magnitude,e.unit);for(var t=[],n=0;n<60;n+=e)t.push({id:n,text:String(100+n).slice(1)});this.widgetMap.minute.store.data=t}},{key:"onSelectionChange",value:function(e){var t=e.source,n=_(e.selected,1)[0],r=this;r._isUserAction=t._isUserAction,t.navigator.activeItem=n,r.updatingValue||r.owner.input.setSubFieldValue(t.ref,n.id),r._isUserAction=!1}},{key:"triggerTimeChange",value:function(e){this.trigger("timeChange",{time:e})}},{key:"updateInitialValue",value:function(e){this.value=e}},{key:"changeValue",value:function(e){return e&&(e="string"==typeof e?Pl.parse(e,this.format):e),null!=e?e:Pl.getTime(0)}},{key:"updateValue",value:function(e){var t=this,n=t.widgetMap,r=n.hour,i=n.minute,a=n.second,o=e.getHours(),l=t.is24Hour?o:o%12,s=e.getMinutes(),u=e.getSeconds();t.updatingValue=!0,r.navigator.activeItem=new Number(l),r.select(l,!0),i.navigator.activeItem=new Number(s),i.select(s,!0),a.navigator.activeItem=new Number(u),a.select(u,!0),t.updatingValue=!1,i.store.filter(),a.store.filter(),t.isVisible&&t.triggerTimeChange(e)}},{key:"changeMin",value:function(e){return"string"==typeof e?Pl.parse(e,this.format):e}},{key:"updateMin",value:function(e){var t=this.widgetMap,n=t.hour,r=t.minute,i=t.second,a=this.owner,o=this.is24Hour;if(e){var l=e.getHours(),s=e.getMinutes(),u=e.getSeconds();n.store.filter({id:"min-filter",filterBy:function(e){var t=e.id;return!o&&a.value.getHours()>=12&&(t+=12),t>=l}}),r.store.filter({id:"min-filter",filterBy:function(e){var t=e.id;return a.value.getHours()!==l||t>=s}}),i.store.filter({id:"min-filter",filterBy:function(e){var t=e.id;return a.value.getMinutes()!==s||t>=u}})}else n.store.removeFilter("min-filter"),r.store.removeFilter("min-filter"),i.store.removeFilter("min-filter")}},{key:"changeMax",value:function(e){return"string"==typeof e?Pl.parse(e,this.format):e}},{key:"updateMax",value:function(e){var t=this.widgetMap,n=t.hour,r=t.minute,i=t.second;if(e){var a=e.getHours(),o=e.getMinutes(),l=e.getSeconds();n.store.filter({id:"max-filter",filterBy:function(e){return e.id<=a}}),r.store.filter({id:"max-filter",filterBy:function(e){return e.id<=o}}),i.store.filter({id:"max-filter",filterBy:function(e){return e.id<=l}})}else n.store.removeFilter("max-filter"),r.store.removeFilter("max-filter"),i.store.removeFilter("max-filter")}}])}(uc);S(jv,"$name","TimePicker"),S(jv,"type","timepicker"),S(jv,"configurable",{floating:!0,layout:"hbox",defaults:{type:"list",displayField:"id",itemTpl:function(e){var t=e.id,n="hour"!==this.ref||this.owner.is24Hour||t?t:12;return String(n+100).slice(1)},itemCls:"b-timepicker-item",itemsFocusable:!1,scrollable:{overflowY:"hidden-scroll"},onSelectionChange:"up.onSelectionChange",navigator:{activateOnMouseover:!0}},items:{hour:{items:Nv},minute:{items:[]},second:{hidden:!0,items:zv}},step:{magnitude:5,unit:"m"},autoShow:!1,trapFocus:!0,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,is24Hour:{$config:"lazy",value:null},initialValue:null}),jv.initClass(),jv._$name="TimePicker";var Wv=/\d+/,$v=/\d+(\D)\d+/,Uv=["hour","minute","second"],Gv=[3600,60,1],Yv=["getHours","getMinutes","getSeconds"],qv=function(e){function t(){var e,n;m(this,t);var r=n=g(this,t),i=r._root=r.attachShadow({mode:"open",delegatesFocus:!0});return r.internals_=null===(e=r.attachInternals)||void 0===e?void 0:e.call(r),r.byRef=Object.create(null),i.addEventListener("keydown",r.onKeyDown.bind(r)),i.addEventListener("focusin",r.onFocusIn.bind(r)),i.addEventListener("click",r.onClick.bind(r)),i.addEventListener("input",r.onInput.bind(r)),i.addEventListener("focusout",r.onFocusOut.bind(r)),n}return R(t,e),w(t,[{key:"connectedCallback",value:function(){var e,t=this;t.silentChangeValue=!0,t.owner=null===(e=t.elementData)||void 0===e?void 0:e.owner,t.createStructure(t.owner.format),t.updateValue(t._value),t.silentChangeValue=!1}},{key:"ingestDate",value:function(e){var t=new Date(e);return isNaN(t)&&(t=Pl.parse(e,this.owner.format)),t}},{key:"is24Hour",get:function(){return this.owner.is24Hour}},{key:"attributeChangedCallback",value:function(e,t,n){var r,i=this;switch(e){case"min":i.updateMin(n);break;case"max":i.updateMax(n);break;case"label":i._label=n,null===(r=i.inputs)||void 0===r||r.forEach((function(e){return e.setAttribute("aria-label",n)}));break;case"disabled":i.disabled=n;break;case"tabindex":i.tabIndex=Number(n)}}},{key:"updateMin",value:function(e){var t=null==e?null:Pl.getTime(this.ingestDate(e));this.minValue=t,this.minHour=(null==t?void 0:t.getHours())||0}},{key:"updateMax",value:function(e){var t=null==e?null:Pl.getTime(this.ingestDate(e));this.maxValue=t,this.maxHour=(null==t?void 0:t.getHours())||(this.is24Hour?23:11)}},{key:"onFocusIn",value:function(e){var t,n=this,r=e.target,i=n.getAriaLabel();"INPUT"===r.tagName&&(r.value="00".concat(r.value).slice(-2),null===(t=r.setSelectionRange)||void 0===t||t.call(r,0,2));n.setAttribute("aria-label",i),n._root.activeElement.setAttribute("aria-label",i),n._root.contains(e.relatedTarget)||Wn.isMouseDown()||n.focusField(0),e.stopImmediatePropagation()}},{key:"onClick",value:function(e){var t=e.target,n=this.owner;t===this.ampmButton&&(n.readOnly||(t.innerText=t.innerText===Pl.amIndicator?Pl.pmIndicator:Pl.amIndicator,this.onValueMutated(),e.stopPropagation()))}},{key:"onFocusOut",value:function(e){var t=e.target;this.onValueMutated(),this.isCleared||t===this.ampmButton||(t.value="0".concat(parseInt(t.value)).slice(-2))}},{key:"onKeyDown",value:function(e){var t,n,r,i,a=this,o=a.subfieldIndex,l=a.owner,s=l.editable,u=l.readOnly,c=Pl.amIndicator,d=Pl.pmIndicator,h=e.target,f=e.key;if(!(e.ctrlKey||e.cmdKey||e.metaKey||e.shiftKey&&"Tab"!==f&&1!==f.length))switch(f){case"Tab":a.inputs[e.shiftKey?0:a.inputs.length-1].focus();break;case" ":(h===a.ampmButton||u)&&e.stopImmediatePropagation();break;case"ArrowLeft":e.preventDefault(),e.stopPropagation(),o>0&&!e.altKe&&a.focusField(o-1);break;case":":if(h===a.ampmButton){e.preventDefault();break}case"ArrowRight":e.preventDefault(),e.stopPropagation(),o<a.inputs.length-1&&a.focusField(o+1);break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),u||a[a.owner.pickerVisible?"decrementSubfield":"incrementSubfield"](h);break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),u||a[a.owner.pickerVisible?"incrementSubfield":"decrementSubfield"](h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"Backspace":case"Delete":s&&!u||e.preventDefault();break;case"Escape":break;case null==c||null===(t=c[0])||void 0===t?void 0:t.toLocaleLowerCase():case null==c||null===(n=c[0])||void 0===n?void 0:n.toLocaleUpperCase():if(!u&&!a.is24Hour){e.preventDefault(),a.ampmButton.innerText=c,a.onValueMutated();break}case null==d||null===(r=d[0])||void 0===r?void 0:r.toLocaleLowerCase():case null==d||null===(i=d[0])||void 0===i?void 0:i.toLocaleUpperCase():if(e.preventDefault(),!u&&!a.is24Hour){e.preventDefault(),a.ampmButton.innerText=d,a.onValueMutated();break}default:e.preventDefault()}}},{key:"onInput",value:function(e){var t=e.target,n=this,r=t.value;if(1===r.length||2===r.length&&1===t.selectionStart&&1===t.selectionEnd)t.setSelectionRange(1,2);else{if(r){if(2===t.selectionEnd){var i=this.subfieldIndex;i<n.inputs.length-1&&n.focusField(i+1)}}else t.value="00",t.setSelectionRange(0,2);t!==n.hour||"00"!==r||n.is24Hour||(n.ampmButton.innerText=Pl.amIndicator),n.activeElement=t,n.onValueMutated(),n.activeElement=null}}},{key:"decrementSubfield",value:function(e){var t,n=this.subfieldIndex,r=this.step,i=this.isPM;if(e===this.ampmButton)e.innerText=i?Pl.amIndicator:Pl.pmIndicator;else{var a=this.getSubFieldValue(n),o=r<Gv[n-1]&&r>Gv[n+1]?r/Gv[n]:1,l=Math.floor(a/o)*o-o;0!==n||this.is24Hour||12!==a||(this.ampmButton.innerText=Pl.amIndicator),e.value=l}this.onValueMutated(),null===(t=e.setSelectionRange)||void 0===t||t.call(e,0,2)}},{key:"incrementSubfield",value:function(e){var t,n=this.subfieldIndex,r=this.step,i=this.is24Hour,a=this.isPM;if(e===this.ampmButton)e.innerText=a?Pl.amIndicator:Pl.pmIndicator;else{var o=this.inputs[n],l=this.getSubFieldValue(n),s=r<Gv[n-1]&&r>Gv[n+1]?r/Gv[n]:1,u=Math.floor(l/s)*s+s;if(0!==n||this.is24Hour||11!==l||(this.ampmButton.innerText=Pl.pmIndicator),0===n)if((a&&!i?l+12:l)===(this.maxHour||23))return;o.value=u}this.onValueMutated(),null===(t=e.setSelectionRange)||void 0===t||t.call(e,0,2)}},{key:"createStructure",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:this.owner.format,n=this,r=n._root,a=n.tabIndex,o=n.is24Hour,l=n.silentChangeValue,s=Pl.amIndicator,u=new Date(1970,0,1,1,2,3),c=Pl.format(u,t).trim(),d=n.delimiter=null===(e=c.match($v))||void 0===e?void 0:e[1],h=z(c.matchAll(new RegExp("\\d+".concat(d?"|\\".concat(d):"","|").concat(s,"|[^\\").concat(d,"\\d]+"),"g"))).map((function(e){return e[0]})),f=[];n.names=[],n.labelElId="".concat(n.owner.id,"-label-element"),n.silentChangeValue=!0,null!=a&&n.setAttribute("tabIndex",a);for(var v,g=0,m=0,p=0,y=h.length;m<y;m++){var k=h[m],b=m?59:o?23:11;k.trim()===s?(v=!0,n.names.push("".concat(Pl.amIndicator,"/").concat(Pl.pmIndicator)),f.push({tag:"button","aria-label":n.getAriaLabel(g),reference:"ampmButton",id:"am-pm",type:"button",text:s,dataset:{subfieldIndex:g++}})):k.match(Wv)?(n.names.push(Pl.getLocalizedNameOfUnit(Uv[p])),f.push({tag:"input","aria-label":n.getAriaLabel(g),id:Uv[p],reference:Uv[p++],size:2,maxlength:2,minlength:2,dataset:{subfieldIndex:g++,max:b}})):k===d?f.push({tag:"span",text:d,reference:"delimiter"}):f.push({reference:"junk",tag:"span",text:k.replaceAll(" "," ")})}"delimiter"===f[f.length-1].reference&&f.length--,o||v||(n.names.push("".concat(Pl.amIndicator,"/").concat(Pl.pmIndicator)),f.push({tag:"button",reference:"ampmButton",id:"am-pm",type:"button",text:s,dataset:{subfieldIndex:g++}})),n.silentChangeValue=l,f.push({tag:"style",text:"\n        :host {\n            display:flex\n        }\n        * {\n            font-size:inherit;\n            font-family:inherit;\n            color:inherit;\n            background-color:inherit\n        }\n        input,button {\n            padding:0;\n            margin:0;\n            border:0 none;\n            outline:0 none;\n            background-color:var(--timefield-input-background-color);\n            text-align:center\n        }\n        input {\n            width:2ch;\n        }\n        #am-pm {\n            margin-inline:5px\n        }\n        #am-pm:focus-visible {\n            outline:none;\n            background-color:var(--timefield-button-background-color)\n        }"}),fa.sync({targetElement:r,refOwner:n,domConfig:{onlyChildren:!0,children:f}}),n.inputs=z(r.querySelectorAll("input")),n.minute||(n.owner.step="1 h"),o?n.ampmButton=null:n.inputs.push(n.ampmButton)}},{key:"attachRef",value:function(e,t){this.byRef[e]=this[e]=t}},{key:"detachRef",value:function(e){this[e]=null,delete this.byRef[e]}},{key:"getAriaLabel",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.subfieldIndex,t=this.owner;return"".concat(t.ariaLabel||t.label||""," ").concat(this.innerText).concat(null!=e?" - ".concat(this.names[e]):"",".")}},{key:"getSubFieldValue",value:function(e){var t=this.date;return t?t[Yv[e]]():0}},{key:"setSubFieldValue",value:function(e,t,n){(e="number"==typeof e?this.inputs[e]:"string"==typeof e?this[e]:e)&&(t<10&&(e!==this.activeElement||2===e.value.length)&&(t="0".concat(t)),e.value!=t&&(e.value=t,n||this.onValueMutated()))}},{key:"value",get:function(){return this.date},set:function(e){var t=this._value;e=this._value=e?this.ingestDate(e):null,this.isConnected&&e-t&&this.updateValue(e,t)}},{key:"updateValue",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;if(Number(e)!=Number(t)){var n,r=this,a=r.ampmButton,o=r.getAriaLabel();if(e){var l=r.hour,s=r.minute,u=r.second,c=e.getHours();r.is24Hour?r.setSubFieldValue(l,c,!0):(a.innerText=c>11?Pl.pmIndicator:Pl.amIndicator,r.setSubFieldValue(l,c>12?c%12:c,!0)),s&&r.setSubFieldValue(s,e.getMinutes(),!0),u&&r.setSubFieldValue(u,e.getSeconds(),!0)}else r._value=Pl.clearTime(t),r.inputs.forEach((function(e){return e.value=""})),a&&(a.innerText=Pl.amIndicator);r.setAttribute("value",Pl.format(e,r.owner.format)),null===(n=r._root.activeElement)||void 0===n||n.setAttribute("aria-label",o),r.setAttribute("aria-label",o),r.silentChangeValue||r.owner.sycingInputFieldValue||r.dispatchEvent(new InputEvent("change"))}}},{key:"onValueMutated",value:function(){var e=this.date,t=this.minValue,n=this.maxValue,r=e?new Date(e):null;e&&(t&&Pl.getTime(r)<Pl.getTime(t)?(r.setHours(t.getHours(),t.getMinutes(),t.getSeconds()),this._value=null):n&&Pl.getTime(r)>Pl.getTime(n)&&(r.setHours(n.getHours(),n.getMinutes(),n.getSeconds()),this._value=null)),this.value=r}},{key:"disabled",set:function(e){e=Boolean(e),this._disabled!==e&&(this._disabled=e,e?this.setAttribute("disabled",!0):this.removeAttribute("disabled"))}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(e){this._tabIndex=e}},{key:"subfieldIndex",get:function(){var e=this.shadowRoot.activeElement;return e&&parseInt(e.dataset.subfieldIndex)}},{key:"isPM",get:function(){var e;return this.is24Hour?parseInt(this.hour.value||0)>11:(null===(e=this.ampmButton.firstChild)||void 0===e?void 0:e.data)===Pl.pmIndicator}},{key:"innerText",get:function(){return Pl.format(this.silentChangeValue?this._value:this.date,this.owner.format)||""}},{key:"date",get:function(){var e,t,n,r=this,i=r._value;if(!r.isConnected)return i||null;if(r.isCleared)return null;var a=new Date(r._value),o=parseInt((null===(e=r.hour)||void 0===e?void 0:e.value)||0),l=parseInt((null===(t=r.minute)||void 0===t?void 0:t.value)||0),s=parseInt((null===(n=r.second)||void 0===n?void 0:n.value)||0),u=o;if(!r.is24Hour){var c,d=(null===(c=r.ampmButton.firstChild)||void 0===c?void 0:c.data)===Pl.pmIndicator;12!==o||r.isPM?o<12&&d&&(u+=12):u=0}return a.setHours(u,l,s),a}},{key:"rawDate",get:function(){var e,t,n,r=new Date(this._value);return r.setHours(parseInt((null===(e=this.hour)||void 0===e?void 0:e.value)||0),parseInt((null===(t=this.minute)||void 0===t?void 0:t.value)||0),parseInt((null===(n=this.second)||void 0===n?void 0:n.value)||0)),r}},{key:"isCleared",get:function(){var e;return Boolean(!(null!==(e=this.inputs)&&void 0!==e&&e.map((function(e){return e.value.trim()})).join("")))}},{key:"focusField",value:function(e){var t,n=this.inputs[e];n&&(n.focus(),null===(t=n.setSelectionRange)||void 0===t||t.call(n,0,2))}}])}(Y(HTMLElement));S(qv,"formAssociated",!0),S(qv,"observedAttributes",["min","max","disabled","tabindex"]),"undefined"==typeof customElements||customElements.get("bry-time")||customElements.define("bry-time",qv);var Kv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"inputElement",get:function(){var e=B(t,"inputElement",this,1);return e.tag="bry-time",e.label=this.label,e.elementData={owner:this},e}},{key:"changePicker",value:function(e,t){var n=this,r=n.pickerWidth||(null==e?void 0:e.width);return jv.reconfigure(t,e,{owner:n,defaults:{step:n.step,value:n.value,forElement:n.pickerAlignElement,owner:n,is24Hour:n.is24Hour,align:{matchSize:null==r,anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},width:r,onTimeChange:function(e){var t=e.source,r=e.time;n._isUserAction=!0,t._isUserAction&&t.hide(),n.value=r,n.min&&!n.is24Hour&&n._picker.widgetMap.hour.store.filter(),n._isUserAction=!1}}})}},{key:"selectAll",value:function(){}},{key:"syncInputFieldValue",value:function(){var e=this;e.sycingInputFieldValue=!0,B(t,"syncInputFieldValue",this,3)(arguments),e.sycingInputFieldValue=!1,e.syncInvalid(),e.pickerVisible&&(e.picker.value=e.value)}},{key:"inputValue",get:function(){return this._value}},{key:"needsInputSync",get:function(){var e;return String(this.input[this.inputValueAttr])!==String(null!==(e=this.inputValue)&&void 0!==e?e:"")}},{key:"syncInputReadOnly",value:function(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly}},{key:"onBackClick",value:function(){var e=this,t=e.min;if(!e.readOnly&&e.value){var n=Pl.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e.value=n)}}},{key:"onForwardClick",value:function(){var e=this,t=e.max;if(!e.readOnly&&e.value){var n=Pl.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e.value=n)}}},{key:"isValid",get:function(){var e=this;e.clearError("L{minimumValueViolation}",!0),e.clearError("L{maximumValueViolation}",!0);var n=e.input.date;if(n){if(n=Pl.getTime(n),e._min&&Pl.getTime(e._min)>n)return e.setError("L{minimumValueViolation}",!0),!1;if(e._max&&Pl.getTime(e._max)<n)return e.setError("L{maximumValueViolation}",!0),!1}return B(t,"isValid",this,1)}},{key:"internalOnChange",value:function(e){var n=this;n.inputting=!0,n._value=n.input.date,n.pickerVisible&&(n.picker.value=n.input.date),B(t,"internalOnChange",this,3)(arguments),n.inputting=!1}},{key:"internalOnKeyEvent",value:function(e){if(this.pickerVisible&&("Escape"===e.key&&(this.value=this.pickerValueOnShow),"Enter"===e.key))return this.hidePicker(),void e.preventDefault();B(t,"internalOnKeyEvent",this,3)([e])}},{key:"hasChanged",value:function(e,n){return null!=e&&e.getTime&&null!=n&&n.getTime?this.keepDate?e-n!=0:!Pl.isSameTime(e,n):B(t,"hasChanged",this,3)([e,n])}},{key:"showPicker",value:function(){var e=this,n=e.picker,r=e.value;e.readOnly||(n.value=null,n.format=e.format,n.max=e.max,n.min=e.min,B(t,"showPicker",this,3)([]),n.value=e.pickerValueOnShow=r,r||(e.value=n.value))}},{key:"transformTimeValue",value:function(e){null!=e&&("string"==typeof e?(e=Pl.parse(e,this.format),this.keepDate&&e&&this.value&&(e=Pl.copyTimeValues(new Date(this.value),e))):e=new Date(e),Pl.isValidDate(e)?this.keepDate||(e=Pl.getTime(e)):e=null);var t={value:e};return this.trigger("transformTimeValue",t),e=t.value}},{key:"changeMin",value:function(e){return this.transformTimeValue(e)}},{key:"updateMin",value:function(e){var t=this.input;t&&(null==e?t.removeAttribute("min"):t.setAttribute("min",e)),this.syncInvalid()}},{key:"changeMax",value:function(e){return this.transformTimeValue(e)}},{key:"updateMax",value:function(e){var t=this.input;t&&(null==e?t.removeAttribute("max"):t.setAttribute("max",e)),this.syncInvalid()}},{key:"changeValue",value:function(e,n){var r=this,i=r.transformTimeValue(e);if(e&&!i||r.isRequired&&""===e)r.setError("L{invalidTime}");else{if(r.clearError("L{invalidTime}"),r.hasChanged(n,i))return B(t,"changeValue",this,3)([i,n]);r.inputting||r.syncInputFieldValue(!0)}}},{key:"updateValue",value:function(e,n){var r=this.triggers.expand;this.syncInputFieldValue(!0),r&&e&&(r.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),B(t,"updateValue",this,3)([e,n])}},{key:"changeStep",value:function(e,t){var n,r,i=W(e);return e?("number"===i?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===i&&(e=Pl.parseDuration(e)),null!==(n=e)&&void 0!==n&&n.unit&&null!==(r=e)&&void 0!==r&&r.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):{magnitude:5,unit:"minute"}}},{key:"updateStep",value:function(e){var t=this._picker;this.input.step=e&&Pl.as("s",e.magnitude,e.unit),t&&Pl.as("m",e)<30&&(t.step=e),this.syncInvalid()}},{key:"is24Hour",get:function(){return Pl.is24HourFormat(this.format)}},{key:"updateFormat",value:function(e,t){var n=this;if(!n.isConfiguring){n._format=t;var r=n.input,i=r.value;n._format=e,n.sycingInputFieldValue=!0,r.createStructure(e),r.updateValue(i,NaN),n.syncInputFieldValue(!0),n.sycingInputFieldValue=!1}}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this.input.isConnected&&this.input.createStructure(),this.syncInputFieldValue(!0)}}])}(ov);S(Kv,"$name","TimeField"),S(Kv,"type","timefield"),S(Kv,"alias","time"),S(Kv,"configurable",{inputElementTag:"bry-time",picker:{type:"timepicker",scrollAction:"realign",align:{align:"t0-b0",minHeight:200,axisLock:!0,matchSize:"min"}},role:"textbox",format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",key:" ",compose:function(){return{children:[{class:{"b-icon-clock-live":1}}]}}},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:{$config:null,default:!0},value:{$config:{equal:"date"},value:null},keepDate:!0}),S(Kv,"delayable",{syncInvalid:{type:"buffer",delay:300}}),Kv.initClass(),Kv._$name="TimeField";var Xv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changePicker",value:function(e,t){var n=this;return jv.reconfigure(t,e,{owner:n,defaults:{value:n.value,forElement:n.pickerAlignElement,owner:n,align:{anchor:n.overlayAnchor,target:n.pickerAlignElement},onTimeChange:function(e){var t=e.time;n._isUserAction=!0,n.value=t,n._isUserAction=!1}}})}},{key:"onBackClick",value:function(){var e=this,t=e.min;if(!e.readOnly&&e.value){var n=Pl.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e.value=n)}}},{key:"onForwardClick",value:function(){var e=this,t=e.max;if(!e.readOnly&&e.value){var n=Pl.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e.value=n)}}},{key:"isValid",get:function(){var e=this;e.clearError("L{minimumValueViolation}",!0),e.clearError("L{maximumValueViolation}",!0);var n=e.value;if(n){if(n=n.getTime(),e._min&&e._min.getTime()>n)return e.setError("L{minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<n)return e.setError("L{maximumValueViolation}",!0),!1}return B(t,"isValid",this,1)}},{key:"hasChanged",value:function(e,n){return null!=e&&e.getTime&&null!=n&&n.getTime?this.keepDate?e-n!=0:!Pl.isSameTime(e,n):B(t,"hasChanged",this,3)([e,n])}},{key:"showPicker",value:function(){var e=this,n=e.picker,r=e.value;e.readOnly||(n.value=r,n.format=e.format,n.maxTime=e.max,n.minTime=e.min,r||(e.value=n.value),B(t,"showPicker",this,3)([!0]))}},{key:"onPickerShow",value:function(){var e;B(t,"onPickerShow",this,3)([]),this.pickerKeyDownRemover=null===(e=this.pickerKeyDownRemover)||void 0===e?void 0:e.call(this)}},{key:"focusPicker",value:function(){this.picker.focus()}},{key:"transformTimeValue",value:function(e){null!=e&&("string"==typeof e?(e=Pl.parse(e,this.format),this.keepDate&&e&&this.value&&(e=Pl.copyTimeValues(new Date(this.value),e))):e=new Date(e),Pl.isValidDate(e)?this.keepDate||(e=Pl.getTime(e)):e=null);var t={value:e};return this.trigger("transformTimeValue",t),e=t.value}},{key:"changeMin",value:function(e){return this.transformTimeValue(e)}},{key:"updateMin",value:function(e){var t=this.input;t&&(null==e?t.removeAttribute("min"):t.min=e),this.syncInvalid()}},{key:"changeMax",value:function(e){return this.transformTimeValue(e)}},{key:"updateMax",value:function(e){var t=this.input;t&&(null==e?t.removeAttribute("max"):t.max=e),this.syncInvalid()}},{key:"changeValue",value:function(e,n){var r=this,i=r.transformTimeValue(e);if(e&&!i||r.isRequired&&""===e)r.setError("L{invalidTime}");else{if(r.clearError("L{invalidTime}"),r.hasChanged(n,i))return B(t,"changeValue",this,3)([i,n]);r.inputting||r.syncInputFieldValue(!0)}}},{key:"updateValue",value:function(e,n){var r=this.triggers.expand;r&&e&&(r.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),B(t,"updateValue",this,3)([e,n])}},{key:"changeStep",value:function(e,t){var n,r,i=W(e);return e?("number"===i?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===i&&(e=Pl.parseDuration(e)),null!==(n=e)&&void 0!==n&&n.unit&&null!==(r=e)&&void 0!==r&&r.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}},{key:"updateStep",value:function(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}},{key:"updateFormat",value:function(){this.syncInputFieldValue(!0)}},{key:"inputValue",get:function(){return Pl.format(this.value,this.format)}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this.syncInputFieldValue(!0)}}],[{key:"configurable",get:function(){return{picker:{type:"sftimepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:function(){return{children:[{class:{"b-icon-clock-live":1}}]}}},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:{$config:null,default:!0},value:null,keepDate:!0}}},{key:"setupClass",value:function(e){return e.replaceType=!0,B(t,"setupClass",this,2)([e])}}])}(ov);S(Xv,"$name","SFTimeField"),S(Xv,"type","timefield"),S(Xv,"alias","sftime"),S(Xv,"widgetClass",["b-sftimefield","b-timefield"]),Xv.initClass(),Xv._$name="SFTimeField";var Zv=function(e,t){var n=e.$toggleOrder;return(t.$toggleOrder||0)-(n||0)},Jv={click:"resetValueCache",beforeToggle:"onItemBeforeToggle",toggle:"onItemToggle"},Qv=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]),this.ion({change:"internalOnChange"})}},{key:"inputWrap",get:function(){return this.element}},{key:"isValid",get:function(){var e=B(t,"isValid",this,1),n=this,r=n.toggleable;return n.clearError("L{Field.fieldRequired}",!0),e&&!n.disabled&&(n.required&&!n.value||r&&n.pressed.length<r[0])&&(e=!1,n.setError("L{Field.fieldRequired}",!0)),n.checkValidity&&!1===n.callback(n.checkValidity,n,[n])&&(e=!1),e&&n.errors&&Object.keys(n.errors).length&&(e=!1),e}},{key:"pressed",get:function(){return this.items.filter((function(e){return e.pressed})).sort(Zv)}},{key:"internalOnChange",value:function(){this.syncInvalid()}},{key:"onChildAdd",value:function(e){B(t,"onChildAdd",this,3)([e]),e.ion(F(F({thisObj:this},Jv),{},{prio:1e4}))}},{key:"onChildRemove",value:function(e){e.un(F({thisObj:this},Jv)),B(t,"onChildRemove",this,3)([e])}},{key:"onItemBeforeToggle",value:function(e){var t=e.pressed,n=this.toggleable;return t||!n||this.pressed.length>n[0]}},{key:"onItemToggle",value:function(e){var t=this,n=(t.toggleCount||0)+1,r=t.toggleable;t.resetValueCache(),t.isSettingValue||t.toggleGroup&&!e.pressed||(r&&(e.source.$toggleOrder=n,t.toggleCount=n,t.isSettingValue=!0,t.pressed.slice(r[1]).forEach((function(e){return e.pressed=!1})),t.isSettingValue=!1),t.triggerFieldChange({value:t.value,userAction:!0,event:e}))}},{key:"resetValueCache",value:function(){this._value=null}},{key:"createWidget",value:function(e){var n=this;return n.constructor.resolveType(e.type||"button").isButton&&(n.color&&!e.color&&(e.color=n.color),!e.toggleGroup&&n.toggleGroup&&(e.toggleGroup=n.toggleGroup),n.toggleable&&(e.toggleable=!0)),n.columns&&(e.width="".concat(100/n.columns,"%")),e=B(t,"createWidget",this,3)([e]),n.relayEvents(e,["click","action","toggle"]),e}},{key:"changeToggleable",value:function(e){return!0===e?e=[0,1/0]:"number"==typeof e&&(e=[1,e]),e||null}},{key:"updateToggleable",value:function(e){e&&!this.isConstructing&&this.pressed.slice(e[1]).forEach((function(e){return e.pressed=!1}))}},{key:"changeToggleGroup",value:function(e,n){return!0===e?n||t.generateId("toggleGroup"):e}},{key:"updateRotate",value:function(e){this.eachWidget((function(t){!1!==t.rotate&&(t.rotate=e)}))}},{key:"valueAsArray",get:function(){var e=[];return this.items.forEach((function(t){t.pressed&&t.value!==i&&e.push(t.value)})),e}},{key:"value",get:function(){var e=this;return e._value||(e._value=e.valueAsArray.join(e.valueSeparator)),e._value},set:function(e){var t=this,n=t.value;null==e?e=[]:"string"==typeof e?e=e.split(t.valueSeparator):Array.isArray(e)||(e=[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach((function(t){t.value!==i&&(t.pressed=e.includes(t.value))})),t.isSettingValue=!1,t.isConfiguring||n===t.value||t.triggerFieldChange({value:t.value,userAction:Boolean(t._isUserAction)})}},{key:"validity",get:function(){return{}}},{key:"onDisabled",value:function(e){var t=this;this.syncInvalid(),this.items.forEach((function(n){return n.disabled=e||!n.ignoreParentReadOnly&&t.readOnly}))}},{key:"updateReadOnly",value:function(e){B(t,"updateReadOnly",this,3)([e]),this.updateDisabled(this.disabled)}},{key:"addToOverflowMenu",value:function(e,t,n){var r=this.toggleable;(this.toggleGroup||1===(null==r?void 0:r[0])&&1===r[1])&&(t=F(F({},t),{},{radio:!0})),this.items.forEach((function(r){return r.addToOverflowMenu(e,t,n)}))}},{key:"widgetClassList",get:function(){var e=B(t,"widgetClassList",this,1);return this.columns&&e.push("b-columned"),e}},{key:"updateUseGap",value:function(e){e||this.element.classList.add("b-no-gap")}}])}(Ss.mixin(zs,Vf));S(Qv,"$name","ButtonGroup"),S(Qv,"type","buttongroup"),S(Qv,"configurable",{defaultType:"button",cls:null,items:null,color:null,useGap:!1,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value",errorTooltipCachePath:"buttonGroupErrorTooltip",errorTooltipConfig:{forSelector:".b-buttongroup.b-invalid"},overflowable:!0,toggleable:null}),Qv.initClass(),Qv._$name="ButtonGroup";var eg=function(){return w((function e(){m(this,e)}),null,[{key:"getLocalizedFormatter",value:function(e){return"currency"!==(null==e?void 0:e.style)||e.currency||(e.currency=Na.locale.NumberFormat.currency),"string"==typeof e?Yl.get({locale:Na.localeCode,template:e}):null!=(null==e?void 0:e.locale)?Yl.get(e):Yl.get(Object.assign({},e,{locale:Na.localeCode}))}}])}();S(eg,"$name","NumberHelper"),eg._$name="NumberHelper";var tg=function(e){return e.ctrlKey&&e.preventDefault()},ng=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]);var n=this;n.input.addEventListener("dblclick",(function(){n.select()})),"number"==typeof n.changeOnSpin&&(n.bufferedSpinChange=n.buffer(n.triggerChange,n.changeOnSpin))}},{key:"acceptValue",value:function(e,t){var n=!isNaN(e);if(n&&!this.hasTextSelection){n=!1;var r=this.input.value,i=parseFloat(r);r!==t&&(n=!this.acceptValue(i,r))}return n}},{key:"okMax",value:function(e){return isNaN(this.max)||e<=this.max}},{key:"okMin",value:function(e){return isNaN(this.min)||e>=this.min}},{key:"internalOnKeyEvent",value:function(e){if("keydown"===e.type){var n,r=this,i=e.key;if("ArrowUp"===i)r.doSpinUp(e.shiftKey),n=!0;else if("ArrowDown"===i)r.doSpinDown(e.shiftKey),n=!0;else if(!e.altKey&&!e.ctrlKey&&i&&1===i.length){var a=r.getAfterValue(i),o=r.formatter.parseStrict(a);n=!(o===r.value||"-"===a&&(isNaN(r.min)||r.min<0))&&!r.acceptValue(o,a)}"Enter"===i&&r._changedBySilentSpin&&(r.triggerChange(e,!0),r._changedBySilentSpin=!1),n&&e.preventDefault()}B(t,"internalOnKeyEvent",this,3)([e])}},{key:"doSpinUp",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.formatter.is.percent?100:1,r=(e?t.largeStep:t.step)/n;if(!t.readOnly){var a=(t.value||0)+r;t.okMin(a)||(a=t.min),t.okMax(a)?t.applySpinChange(a):t.wrapAround&&(a=t.min,t.applySpinChange(a))}}},{key:"doSpinDown",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.formatter.is.percent?100:1,r=(e?t.largeStep:t.step)/n;if(!t.readOnly){var a=(t.value||0)-r;t.okMax(a)||(a=t.max),t.okMin(a)?t.applySpinChange(a):t.wrapAround&&(a=t.max-t.max%r,t.applySpinChange(a))}}},{key:"applySpinChange",value:function(e){var t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}},{key:"triggerChange",value:function(){this.silenceChange||B(t,"triggerChange",this,3)(arguments)}},{key:"onFocusOut",value:function(e){var n;B(t,"onFocusOut",this,3)(arguments);var r=this,i=r.input,a=i.value,o=r.formatter.truncate(a),l=isNaN(o)?a:r.formatValue(o);null===(n=r.triggers)||void 0===n||null===(n=n.spin)||void 0===n||null===(n=n.clickRepeater)||void 0===n||n.cancel(),r.lastTouchmove=null,a!==l&&(i.value=l),r._changedBySilentSpin&&(r.triggerChange(e,!0),r._changedBySilentSpin=!1)}},{key:"internalOnInput",value:function(e){var n,r=this,i=r.formatter,a=r.input,o=i.parser,l=i.maximumFractionDigits,s=a.value;if(null!==(n=e.data)&&void 0!==n&&n.length&&!isFinite(o.parse(s))&&"-"!==s){var u=r._lastValue||r.valueOnFocus;r.queueMicrotask((function(){r._value=NaN,r.value=u}))}else{var c=o.decimalPlaces(s);if(i.truncator&&c>l){var d,h=s,f=i.truncate(s);if(!isNaN(f)&&(h=r.formatValue(f),(d=o.decimalPlaces(h))<l&&(h+="0".repeat(l-d),d=l),d<c)){var v=s.length-r.caretPos;a.value=h,r.caretPos=h.length-v+1}}B(t,"internalOnInput",this,3)([e])}}},{key:"formatValue",value:function(e){return this.formatter.format(e)}},{key:"formatter",get:function(){var e;return null!==(e=this._formatter)&&void 0!==e?e:this._formatter=eg.getLocalizedFormatter(this.format)}},{key:"updateStep",value:function(e){var t,n=this;(n.element.classList.toggle("b-hide-spinner",!e),n._step=e,e&&ne.isMobile)?n.touchMoveListener||(n.touchMoveListener=fr.on({element:n.input,touchmove:"onInputSwipe",thisObj:n,throttled:{buffer:150,alt:tg}})):null===(t=n.touchMoveListener)||void 0===t||t.call(n)}},{key:"onInputSwipe",value:function(e){var t=this.lastTouchmove;if(t){var n=e.screenX-t.screenX,r=t.screenY-e.screenY,i=Math.abs(n)>Math.abs(r)?n:r;this["doSpin".concat(i>0?"Up":"Down")]()}e.preventDefault(),this.lastTouchmove=e}},{key:"changeLargeStep",value:function(e){return e||10*this.step}},{key:"validity",get:function(){var e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}},{key:"changeValue",value:function(e,n){var r,a=this;e||0===e?("number"!=typeof e&&(e="string"==typeof e?a.formatter.parse(e):Number(e),(r=isNaN(e))&&(e="")),!r&&a.format&&(e=a.formatter.round(e))):e=i;return B(t,"changeValue",this,3)([e,n])}},{key:"inputValue",get:function(){return null!=this.value?this.formatValue(this.value):""}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this._formatter=i,this.syncInputFieldValue()}}],[{key:"configurable",get:function(){return{wrapAround:null,min:null,max:null,step:1,largeStep:0,value:null,format:"",triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}}])}(Uf);S(ng,"$name","NumberField"),S(ng,"type","numberfield"),S(ng,"alias","number"),ng.initClass(),ng._$name="NumberField";var rg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.refresh()}},{key:"updateSeconds",value:function(e){this.widgetMap.second[e?"show":"hide"]()}},{key:"onFieldChange",value:function(){this.isConfiguring||this.isRefreshing||(this.value=this.pickerToTime())}},{key:"onAmPmButtonClick",value:function(e){var t=e.source;this._pm="pmButton"===t.ref,this._value&&(this.value=this.pickerToTime())}},{key:"onInternalKeyDown",value:function(e){var n,r=this;switch(e.key){case"Escape":return r.triggerTimeChange(r._initialValue),r.hide(),void e.preventDefault();case"Enter":return r.value=r.pickerToTime(),r.hide(),void e.preventDefault()}null===(n=B(t,"onInternalKeyDown",this,3))||void 0===n||n([e])}},{key:"pickerToTime",value:function(){var e=this,t=e._pm,n=e.widgetMap,r=n.hour,i=n.minute,a=n.second;r.format=e._is24Hour?"2>9":null;var o=r.value,l=new Date(e.value);return e._is24Hour||(t&&o<12&&(o+=12),t||12!==o||(o=0)),l.setHours(o),l.setMinutes(i.value),e.seconds&&l.setSeconds(a.value),e._min&&(l=Pl.max(e._min,l)),e._max&&(l=Pl.min(e._max,l)),l}},{key:"triggerTimeChange",value:function(e){this.trigger("timeChange",{time:e})}},{key:"updateInitialValue",value:function(e){this.value=e}},{key:"changeValue",value:function(e){return e&&(e="string"==typeof e?Pl.parse(e,this.format):e),this.isVisible||(this._initialValue=e),null!=e?e:Pl.getTime(0)}},{key:"updateValue",value:function(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}},{key:"updateFormat",value:function(e){this._is24Hour=Pl.is24HourFormat(e),this.refresh()}},{key:"changeMin",value:function(e){return"string"==typeof e?Pl.parse(e,this.format):e}},{key:"changeMax",value:function(e){return"string"==typeof e?Pl.parse(e,this.format):e}},{key:"refresh",value:function(){var e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;var t=e.widgetMap,n=t.hour,r=t.minute,i=t.second,a=t.amButton,o=t.pmButton,l=e.value,s=e._is24Hour,u=l.getHours(),c=e._pm=u>=12;e.element.classList[s?"add":"remove"]("b-24h"),n.min=s?0:1,n.max=s?23:12,n.value=s?u:u%12||12,r.value=l.getMinutes(),i.value=l.getSeconds(),a.pressed=!c,o.pressed=c,a.hidden=o.hidden=s,e.isRefreshing=!1}}}])}(uc);S(rg,"$name","SFTimePicker"),S(rg,"type","sftimepicker"),S(rg,"configurable",{floating:!0,layout:"hbox",items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9",wrapAround:!0},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9",wrapAround:!0},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9",wrapAround:!0},amPm:{type:"buttongroup",items:{amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}}}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),S(rg,"widgetClass",["b-sftimepicker","b-timepicker"]),rg.initClass(),rg._$name="SFTimePicker";var ig=function(){return w((function e(){m(this,e)}),[{key:"alignTo",value:function(e){var t,r,i=e.source,a=e.constrainTo;if(a===n||a===document||null!=a&&null!==(t=a.lastDomConfig)&&void 0!==t&&t.className.toString().includes("b-float-root")){var o=li.getRootElement(i.element).querySelector(".b-float-root");o&&(r=pt.from(o),e.constrainTo=o)}var l=this._overridden.alignTo.call(this,e);if(r){var s=r.x;l.translate(-s,0)}return l}}],[{key:"target",get:function(){return{class:pt}}}])}();We.apply(ig);var ag=function(){return w((function e(){m(this,e)}),[{key:"executeAndAwaitAnimations",value:(e=f(L().mark((function e(t,n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(t,n){return e.apply(this,arguments)})}],[{key:"target",get:function(){return{class:Lo}}}]);var e}();We.apply(ag);var og=Object.getOwnPropertyDescriptor(Lo.prototype,"floatRoot").get;Object.defineProperty(Lo.prototype,"floatRoot",{get:function(){var e,t=this.rootElement||(null===(e=this.owner)||void 0===e?void 0:e.rootElement),n=t.floatRoot;return n?li.getRootElement(n)!==t&&t.appendChild(n):n=og.call(this),n}});var lg=function(){return w((function e(){m(this,e)}),[{key:"setDragImage",value:function(){}}],[{key:"target",get:function(){return{class:Lo}}}])}();We.apply(lg);var sg=function(){return w((function e(){m(this,e)}),[{key:"toFront",value:function(){for(var e,t=this.element,n=this.floating?this.floatRoot:this.positioned?null==t?void 0:t.parentNode:null;t&&(e=t.nextSibling);)n.insertBefore(e,t)}}],[{key:"target",get:function(){return{class:Lo}}}])}();We.apply(sg);var ug=function(){return w((function e(){m(this,e)}),null,[{key:"global",get:function(){return self}}])}();S(ug,"target",{class:Pa}),We.apply(ug);var cg=function(){function e(t){if(m(this,e),t){if(t.isLocation)return t;if(t.nodeType===Node.ELEMENT_NODE){var n=Lo.fromElement(t,"gridbase"),r=n&&t.closest(n.focusableSelector);if(r){var i=r.parentNode.dataset;this.init({grid:n,rowIndex:n.store.includes(i.id)?n.store.indexOf(i.id):i.index||-1,columnId:r.dataset.columnId}),this.initialTarget=t}}else this.init(t)}}return w(e,[{key:"init",value:function(e){var t,n=this,r=n.grid=e.grid,i=r.store,a=r.columns,o=a.visibleColumns;if(e.target&&(n.actionTargets=[n._target=e.target]),e.record)n._id=e.record.id;else if("id"in e)n._id=e.id,null==e.id&&(n._rowIndex=-1);else{var l,s=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;n._rowIndex=Math.max(Math.min(Number(s),i.count-1),r.hideHeaders?0:-1),n._id=null===(l=i.records[n._rowIndex])||void 0===l?void 0:l.id}if("_rowIndex"in n||(n._rowIndex=i.indexOf(n.id)),n.isSpecialRow=null===(t=n.record)||void 0===t?void 0:t.isSpecialRow,"columnId"in e)n._column=a.getById(e.columnId);else if("field"in e)n._column=a.get(e.field);else{var u=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(u)?n._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(n._columnIndex=Math.min(Number(u),o.length-1),n._column=o[n._columnIndex])}"_columnIndex"in n||(n._columnIndex=o.indexOf(n._column))}},{key:"isLocation",get:function(){return!0}},{key:"equals",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this;return(null==e?void 0:e.isLocation)&&e.grid===n.grid&&(t?n.id===e.id&&n._column===e._column:e.record===n.record&&e.column===n.column&&e.target===n.target)}},{key:"rowIndex",get:function(){var e=this._id,t=this.grid.store;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}},{key:"visibleRowIndex",get:function(){var e=this.grid.rowManager,t=this.rowIndex;return-1===t?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}},{key:"isSelectable",get:function(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}},{key:"record",get:function(){var e;if(null!==(e=this._record)&&void 0!==e&&e.isModel)return this._record;if(this._rowIndex>-1){var t=this.grid.store;return t.includes(this._id)?t.getById(this._id):t.records[this._rowIndex]}}},{key:"id",get:function(){return this._id}},{key:"column",get:function(){var e=this.grid.columns.visibleColumns;return null!=e&&e.includes(this._column)?this._column:null==e?void 0:e[this.columnIndex]}},{key:"columnId",get:function(){var e;return null===(e=this.column)||void 0===e?void 0:e.id}},{key:"columnIndex",get:function(){var e;return Math.min(this._columnIndex,(null===(e=this.grid.columns.visibleColumns)||void 0===e?void 0:e.length)-1)}},{key:"move",value:function(t){var n=this,r=n.record,i=n.column,a=n.grid,o=a.store,l=a.columns.visibleColumns,s=new e,u=o.includes(r)?o.indexOf(r):n.rowIndex,c=l.includes(i)?l.indexOf(i):n.columnIndex,d=a.hideHeaders?0:-1,h=o.count-1,f=l.length-1,v=u===d,g=u===h,m=0===c,p=c===f;switch(t){case e.PREV_CELL:m?v||(c=f,u--):c--;break;case e.NEXT_CELL:p?g||(c=0,u++):c++;break;case e.UP:v||u--;break;case e.DOWN:g||(-1===u?u=a.rowManager.firstFullyVisibleRow.dataIndex:u++);break;case e.FIRST_COLUMN:c=0;break;case e.LAST_COLUMN:c=f;break;case e.FIRST_CELL:u=d,c=0;break;case e.LAST_CELL:u=h,c=f;break;case e.PREV_PAGE:u=Math.max(d,u-Math.floor(a.scrollable.clientHeight/a.rowHeight));break;case e.NEXT_PAGE:u=Math.min(h,u+Math.floor(a.scrollable.clientHeight/a.rowHeight))}return s.init({grid:a,rowIndex:u,columnIndex:c}),s}},{key:"cell",get:function(){var e,t=this,n=t.grid,r=t.id,i=t._cell;if(i)return i;if(null==r)return null===(e=n.columns.getById(t.columnId))||void 0===e?void 0:e.element;var a,o=t.row;return o?o.getCell(t.columnId)||o.getCell(null===(a=n.columns.getAt(t.columnIndex))||void 0===a?void 0:a.id):void 0}},{key:"$cellIndex",get:function(){return{rowIndex:this.rowIndex,columnIndex:this.columnIndex}}},{key:"row",get:function(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}},{key:"target",get:function(){var e=this.cell,t=this._target,n=this.grid.focusableFinder;if(e)return t||(n.currentNode=this.grid.focusableFinderCell=e,n.nextNode()||e)}},{key:"containsFocus",get:function(){var e=this.cell,t=e&&li.getActiveElement(e);return t&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY}},{key:"isActionable",get:function(){var e=this._target;return Boolean(this.containsFocus||e&&e!==this.cell)}},{key:"isColumnHeader",get:function(){return this.cell&&-1===this.rowIndex}},{key:"isCell",get:function(){return this.cell&&this.record}}])}();S(cg,"UP",1),S(cg,"NEXT_CELL",2),S(cg,"DOWN",3),S(cg,"PREV_CELL",4),S(cg,"FIRST_COLUMN",5),S(cg,"LAST_COLUMN",6),S(cg,"FIRST_CELL",7),S(cg,"LAST_CELL",8),S(cg,"PREV_PAGE",9),S(cg,"NEXT_PAGE",10),cg._$name="GridLocation";var dg=document.createRange(),hg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new cg({grid:e.grid,id:null,columnIndex:0})}),B(t,"construct",this,3)([e]),"position"===this.grid.positionMode&&(this.translateElements=this.positionElements)}},{key:"doDestroy",value:function(){var e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),B(t,"doDestroy",this,3)([])}},{key:"index",get:function(){return this._index},set:function(e){this._index=e}},{key:"dataIndex",get:function(){return this._dataIndex},set:function(e){var t=this;this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((function(n){n.dataset.index=e,n.ariaRowIndex=t.grid.hideHeaders?e+1:e+2})))}},{key:"id",get:function(){return this._id},set:function(e){var t=this,n={id:e},r=t.rowManager.idMap;t._id===e&&r[e]===t||(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement((function(t){wa.assign(t,n),t.dataset.id=e})),t.eachCell((function(e){return wa.assign(e,n)})))}},{key:"addElement",value:function(e,t){var n=this,r=n.dataIndex,i=t.firstElementChild;for(n._elements[e]=t,n._elementsArray.push(t),n._regions.push(e),wa.assign(t,{index:n.index}),n._cells[e]=[];i;){var a=i.dataset,o=a.column,l=a.columnId;n._cells[e].push(i),n._allCells.push(i),wa.set(i,{column:o,columnId:l,rowElement:i.parentNode,row:n}),i=i.nextElementSibling}t.dataset.index=r,t.ariaRowIndex=n.grid.hideHeaders?r+1:r+2,n.lastTop=null,null!==n.top&&n.translateElements(!0)}},{key:"getElement",value:function(e){return this._elements[e]}},{key:"getRectangle",value:function(e){return pt.from(this.getElement(e))}},{key:"eachElement",value:function(e){this._elementsArray.forEach(e)}},{key:"eachCell",value:function(e){this._allCells.forEach(e)}},{key:"elements",get:function(){return this._elements}},{key:"element",get:function(){var e=Object.keys(this._elements)[0];return this._elements[e]}},{key:"cells",get:function(){return this._allCells}},{key:"getCells",value:function(e){return this._cells[e]}},{key:"getCell",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this._allCells.find((function(n){var r=wa.get(n);return r.columnId==e||!t&&r.column==e}))}},{key:"removeElements",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((function(e){return e.remove()})),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}},{key:"height",get:function(){return this._height},set:function(e){this.cls["b-rowexpander-row-expanded"]||this.setProperty("--b-grid-row-height",e===this.grid.rowHeight?"":li.setLength(e)),this._height=e}},{key:"offsetHeight",get:function(){return this.height+this.grid._rowBorderHeight}},{key:"updateElementsHeight",value:function(e){var t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement((function(e){return e.style.height="".concat(t.offsetHeight,"px")})),t.lastHeight=t.height)}},{key:"addCls",value:function(e){this.updateCls(this.cls.add(e))}},{key:"removeCls",value:function(e){this.updateCls(this.cls.remove(e))}},{key:"toggleCls",value:function(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}},{key:"assignCls",value:function(e){this.updateCls(this.cls.assign(e))}},{key:"changeCls",value:function(e){return new Ct(e)}},{key:"updateCls",value:function(e){this.eachElement((function(t){return li.syncClassList(t,e)}))}},{key:"setAttribute",value:function(e,t){this.eachElement((function(n){return n.setAttribute(e,t)}))}},{key:"removeAttribute",value:function(e){this.eachElement((function(t){return t.removeAttribute(e)}))}},{key:"setProperty",value:function(e,t){this.eachElement((function(n){return n.style.setProperty(e,t)}))}},{key:"isFirst",get:function(){return 0===this.dataIndex}},{key:"top",get:function(){return this._top}},{key:"bottom",get:function(){return this._top+this._height+this.grid._rowBorderHeight}},{key:"setTop",value:function(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}},{key:"setBottom",value:function(e,t){this.setTop(e-this.offsetHeight,t)}},{key:"translate",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];return this.setTop(e,t),e+this.offsetHeight}},{key:"translateElements",value:function(e){var t=this,n=t.top,r=t._elementsArray;if(t.lastTop!==n){for(var i=0,a=r.length;i<a;i++)r[i].style.transform="translate(0,".concat(n,"px)");!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=n}}},{key:"positionElements",value:function(e){var t=this,n=t.top,r=t._elementsArray;if(t.lastTop!==n){for(var i=0,a=r.length;i<a;i++)r[i].style.top="".concat(n,"px");!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=n}}},{key:"offset",value:function(e){var t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}},{key:"renderPlaceholder",value:function(e,t,n,r,i){var a=this,o=a.rowManager,l=o.rowHeight;a.addCls("b-row-placeholder"),a.height!==l&&(a.height=l,a.updateElementsHeight(!0),o.bufferedTranslateFromRow(a)),a.dataIndex=e,t.then((function(t){t&&a.dataIndex===e&&a.grid.store.indexOf(t)===e&&a.render(e,t,n,r,i,!0)}))}},{key:"render",value:function(e,t){var n,r,a,o,l=!(arguments.length>2&&arguments[2]!==i)||arguments[2],s=arguments.length>3&&arguments[3]!==i&&arguments[3],u=arguments.length>4&&arguments[4]!==i&&arguments[4],c=arguments.length>5&&arguments[5]!==i&&arguments[5],d=this,h=d.cellContext,f=d.cls,v=d.elements,g=d.grid,m=d.rowManager,p=d.height,y=d._id,k=wa.get(d._elementsArray[0]),b=m._rowHeight,C=g.store,w=g.features.tree&&C.isTree,D=0;if(!t&&!1!==t){var S;if(null!=e)if((t=null===(S=C.lazyLoad)||void 0===S?void 0:S.getAt(e))&&!t.isModel)return d.renderPlaceholder(e,t,l,s,u);t||(t=C.getById(k.id),e=C.indexOf(t))}if(t){d.removeCls("b-row-placeholder");var x=null===(n=t)||void 0===n?void 0:n.cls,E=x?x.isDomClassList?x:new Ct(x):null;f.assign({"b-grid-row-updating":l&&g.transitionDuration&&!u,"b-selected":g.isSelected(null===(r=t)||void 0===r?void 0:r.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),d.lastRecordCls&&f.remove(d.lastRecordCls),E?(f.add(E),d.lastRecordCls=Object.assign({},E)):d.lastRecordCls=null,m.trigger("beforeRenderRow",{row:d,record:t,recordIndex:e,oldId:y}),g.beforeRenderRow({row:d,record:t,recordIndex:e,oldId:y,cls:f}),d.updateCls(f),l&&g.transitionDuration&&!u&&g.setTimeout((function(){d.isDestroyed||(f.remove("b-grid-row-updating"),d.updateCls(f))}),g.transitionDuration+50),d.id=t.id,d.dataIndex=e;var R=!g.fixedRowHeight&&g.getRowHeight(t)||b,T=d.maxRequestedHeight=null;if(w){var M=function(e){var n,r,i=v[e];(i.id="".concat(g.id,"-").concat(e,"-").concat(d.id),li.setAttributes(i,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(C))?li.setAttributes(i,{"aria-expanded":!0,"aria-owns":null!==(n=t.children)&&void 0!==n&&n.length?null===(r=t.children)||void 0===r?void 0:r.map((function(t){return"".concat(g.id,"-").concat(e,"-").concat(t.id)})).join(" "):null}):(t.isLeaf?i.removeAttribute("aria-expanded"):i.setAttribute("aria-expanded",!1),i.removeAttribute("aria-owns"))};for(var F in v)M(F)}for(h._record=t,h._id=t.id,h._rowIndex=e,D=0;D<g.columns.visibleColumns.length;D++){var A=g.columns.visibleColumns[D];h._columnId=A.id,h._column=A,h._columnIndex=D,h._cell=d.getCell(A.id,!0),h.height=R,h.maxRequestedHeight=T,h.updatingSingleRow=l,o=d.renderCell(h),m.fixedRowHeight||null!=o.height&&(T=Math.max(T,o.height),o.transient||(d.maxRequestedHeight=T))}var I=null!=T?T:R;d.height=null!==(a=g.processRowHeight(t,I))&&void 0!==a?a:I,d.updateElementsHeight(u),c&&p!==d.height&&m.bufferedTranslateFromRow(d,s),l&&!u&&(p!==d.height&&m.translateFromRow(d,s),m.trigger("updateRow",{row:d,record:t,recordIndex:e,oldId:y}),m.trigger("renderDone")),g.afterRenderRow({row:d,record:t,recordIndex:e,oldId:y,oldHeight:p,isExport:u}),m.trigger("renderRow",{row:d,record:t,recordIndex:e,oldId:y,isExport:u}),p&&d.height!==p&&m.trigger("rowRowHeight",{row:d,record:t,height:d.height,oldHeight:p}),d.forceInnerHTML=!1}}},{key:"renderCell",value:function(e){var t,n=this;e.isLocation||(e=new cg(e));var r=e,a=r.cell,o=r.record,l=e,s=l.grid,u=l.column,c=l.height,d=l.maxRequestedHeight,h=l.updatingSingleRow,f=void 0===h||h,v=l.isMeasuring,g=void 0!==v&&v,m=null===(t=s.features)||void 0===t?void 0:t.cellEdit,p=wa.get(a),y=p.rowElement,k=wa.get(y);if(o||(o=e._record=s.store.getById(k.id))){var b=u.getRawValue(o),C=o.fieldMap[u.field],w={configuredHeight:c,height:null,maxRequestedHeight:d},D=u.getCellClass(e),S={cellElement:a,cellCls:D,dataField:C,rowElement:y,value:b,record:o,column:u,size:w,grid:s,row:p.row,updatingSingleRow:f,isMeasuring:g,isExport:!1},x=u.renderer;u.readOnly||o.readOnly||s.readOnly?a.setAttribute("aria-readonly",!0):a.removeAttribute("aria-readonly"),s.beforeRenderCell(S),S.cellElement!==a&&(a=S.cellElement),li.syncClassList(a,D);var E=!0;pe.isPromise(b)||(x?(b=u.callback(x,u,[S]))===i&&(o.generatedParent&&u.rendererReturningContent?b="":!1===u.alwaysClearCell&&(E=!1)):C&&(b=C.print(b)));var R={cellContent:b,size:w,grid:s,isMeasuring:g,cellContext:e,cellElementData:p,rendererData:S,shouldSetContent:E,cellEdit:m,record:o,column:u,cellElement:a};return pe.isPromise(b)?(a.classList.add("b-loading-cell"),b.then((function(e){n.isDestroyed||(a.classList.remove("b-loading-cell"),s.getRecordFromElement(a)===o&&n.updateCellContent(F(F({},R),{},{cellContent:e})))})),w):this.updateCellContent(R)}}},{key:"updateCellContent",value:function(e){var t,n=e.cellContent,r=e.size,i=e.grid,a=e.isMeasuring,o=e.cellContext,l=e.cellElementData,s=e.rendererData,u=e.shouldSetContent,c=e.cellEdit,d=e.record,h=e.column,f=e.cellElement,v=null===(t=i.hasFrameworkRenderer)||void 0===t?void 0:t.call(i,{cellContent:n,column:h});v&&d.isSpecialRow&&(n="");var g,m=v&&!h.data.tree&&!d.isSpecialRow;if(u&&!m){var p,y=f;(null==c||null===(p=c.editorContext)||void 0===p?void 0:p.column)!==h||c.editor.isFinishing||(null!=c&&c.editorContext.equals(o)?y=this.moveContentFromCell(f,c.editor.element):y.classList.remove("b-editing"));var k=null!=n&&"object"===W(n),b="string"==typeof n,C=k||null==n?"":String(n);if(this.forceInnerHTML&&(y.innerHTML="",delete y._content,f.lastDomConfig=null),k||!h.htmlEncode||h.disableHtmlEncode?!h.autoSyncHtml||b&&!li.getChildElementCount(y)?k?(fa.sync({targetElement:y,domConfig:{onlyChildren:!0,children:$e.asArray(n)}}),delete y._content):y._content!==C&&(y.innerHTML=y._content=C):b?li.sync(C,y.firstElementChild):k&&(fa.sync({domConfig:n,targetElement:y}),delete y._content):(f._hasHtml?(y.innerText=C,f._hasHtml=!1):li.setInnerText(y,C),delete y._content),y!==f){for(var w=f.firstChild,D=0,S=z(y.childNodes);D<S.length;D++){var x=S[D];f.insertBefore(x,w)}f.classList.add("b-editing","b-focused")}}d.isSpecialRow||(null===(g=i.processCellContent)||void 0===g||g.call(i,{cellElementData:l,rendererData:s,rendererHtml:s.rendererHtml||n}));return h.autoHeight&&null==r.height&&(f.classList.add("b-measuring-auto-height"),r.height=Math.max(f.offsetHeight,i.rowHeight),f.classList.remove("b-measuring-auto-height")),a||this.rowManager.trigger("renderCell",s),h.afterRenderCell&&h.callback(h.afterRenderCell,h,[s]),r}},{key:"moveContentFromCell",value:function(e,t){t.parentNode||e.appendChild(t),dg.setStart(e,0),dg.setEndBefore(t);var n=document.createElement("div");return n.appendChild(dg.extractContents()),n.classList.add("b-editing"),n}}])}(Mn);S(hg,"$name","Row"),S(hg,"configurable",{cls:{$config:{equal:function(e,t){return(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)}}}}),hg.initClass(),hg._$name="Row";var fg=function(){return w((function e(){m(this,e)}),[{key:"moveContentFromCell",value:function(e,t){var n=e.childNodes,r=[];n.forEach((function(n){n!==t&&(r.push(n),e.removeChild(n))}));var i=document.createElement("div");return r.forEach((function(e){i.appendChild(e)})),i}}])}();S(fg,"target",{class:hg}),We.apply(fg);var vg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeMonitoring",value:function(e,t){return null==t||t.clear(),new a}},{key:"doDestroy",value:function(){this.stopMonitoring(),B(t,"doDestroy",this,3)([])}},{key:"isScrolling",get:function(){return 0!==Object.keys(this.activeScroll).length}},{key:"rtl",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.rtl}},{key:"startMonitoring",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this,n=t.element,r=t.direction,a=e.scrollables,o=void 0===a?[]:a,l=e.direction,s=void 0===l?r:l,u=e.callback,c=[];return o.length||o.push({element:n}),o.forEach((function(e){var r=e.element;"string"==typeof r?li.forEachSelector(n,r,(function(n){t.createMonitor(n,e.direction||s,e.callback||u),c.push(n)})):(t.createMonitor(r,e.direction||s,e.callback||u),c.push(r))})),function(){var e;null===(e=t.stopMonitoring)||void 0===e||e.call(t,c)}}},{key:"createMonitor",value:function(e,t,n){var r=this.monitoring;r.has(e)||r.set(e,new gg({scrollManager:this,element:e,direction:t,callback:n}))}},{key:"stopMonitoring",value:function(e){var t=this,n=t.monitoring;if(e=$e.asArray(e),n){if(!e)return void n.forEach((function(e){return t.stopMonitoring(e.element)}));e.forEach((function(e){var t=n.get(e);e.classList.remove("b-scrolling"),t&&(t.destroy(),n.delete(e))}))}}},{key:"requestScroll",value:function(e,t){var n=this.activeScroll;return(!(e in n)||n[e]===t)&&(n[e]=t,!0)}},{key:"releaseScroll",value:function(e){var t=this.activeScroll,n=void 0===t?{}:t;Object.keys(n).forEach((function(t){n[t]===e&&delete n[t]}))}},{key:"getRelativeScroll",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"left",n=0;return this.monitoring.forEach((function(r,i){li.isDescendant(i,e)&&(n+="left"===t?r.scrollRelativeLeft:r.scrollRelativeTop)})),n}}],[{key:"configurable",get:function(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}}])}(Mn.mixin($i,_n)),gg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=e.element,r=n.scrollLeft,i=n.scrollTop;Object.assign(e,{startScrollLeft:r,startScrollTop:i}),B(t,"construct",this,3)([e]),fr.on({element:n,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:this}),fr.on({element:n,pointerleave:"onPointerLeave",thisObj:this})}},{key:"doDestroy",value:function(){this.stopScroll(!0),B(t,"doDestroy",this,3)([])}},{key:"startScroll",value:function(){var e=this;e.pendingScrollFinalize&&(e.scrollManager.releaseScroll(e),e.pendingScrollFinalize=!1),e.scrolling=!0,e.performScroll()}},{key:"stopScroll",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,t=this,n=function(){t.pendingScrollFinalize=!1,t.isDestroyed||(t.scrollManager.releaseScroll(t),t.scrolling=!1)};t.scrollRequested&&(t.scrollManager.cancelAnimationFrame(t.frameId),t.scrollRequested=!1),t.scrollManager.clearTimeout(t.scrollTimeout),t.scrollTimeout=null,e||!t.ongoingScrollTop&&!t.ongoingScrollLeft?(t.ongoingScrollTop=t.ongoingScrollLeft=null,n()):(t.pendingScrollFinalize=!0,Promise.all([t.ongoingScrollTop,t.ongoingScrollLeft].filter(Boolean)).then((function(){return t.pendingScrollFinalize&&n()})))}},{key:"onPointerLeave",value:function(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}},{key:"onMouseMove",value:function(e){var t=this,n=t.scrollManager,r=t.element.getBoundingClientRect(),i=n.zoneWidth,a=n.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,"vertical"!==t.direction){var o=t.element,l=o.scrollLeft,s=o.scrollWidth,u=o.clientWidth;n.rtl?e.clientX<r.left+i&&s+l-u>=1?t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/a)-1:e.clientX>r.right-i&&l<0&&(t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/a)+1):e.clientX>r.right-i&&s-l-u>=1?t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/a)+1:e.clientX<r.left+i&&l>0&&(t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/a)-1)}if("horizontal"!==t.direction){var c=t.element,d=c.scrollTop,h=c.scrollHeight,f=c.clientHeight;e.clientY>r.bottom-i&&h-d-f>=1?t.scrollDeltaY=Math.round((i-(r.bottom-e.clientY))/a)+1:e.clientY<r.top+i&&d>0&&(t.scrollDeltaY=-Math.round((i+(r.top-e.clientY))/a)-1)}0===t.scrollDeltaX||n.requestScroll("horizontal",t)||(t.scrollDeltaX=0),0===t.scrollDeltaY||n.requestScroll("vertical",t)||(t.scrollDeltaY=0),0===t.scrollDeltaX&&0===t.scrollDeltaY?t.scrolling&&t.stopScroll():t.scrollTimeout||(t.scrollTimeout=n.setTimeout((function(){return t.startScroll()}),n.startScrollDelay))}},{key:"performScroll",value:function(){var e=this,t=e.element,n=e.scrollManager;if(e.scrolling&&!e.scrollRequested){if(0!==e.scrollDeltaX){var r=t.scrollLeft,i=Math.min(r+e.scrollDeltaX,t.scrollWidth-t.clientWidth);t.scrollLeft=i,t.scrollLeft!==r?e.ongoingScrollLeft=new Promise((function(r){return t.addEventListener("scroll",(function(t){var i;null===(i=n.trigger)||void 0===i||i.call(n,"scroll",{event:t,deltaY:e.scrollDeltaY,deltaX:e.scrollDeltaX}),r()}),{once:!0})})):(e.ongoingScrollLeft=null,e.scrollDeltaX=0)}if(0!==e.scrollDeltaY){var a=t.scrollTop,o=Math.min(a+e.scrollDeltaY,t.scrollHeight-t.clientHeight);t.scrollTop=o,t.scrollTop!==a?e.ongoingScrollTop=new Promise((function(r){return t.addEventListener("scroll",(function(t){var i;null===(i=n.trigger)||void 0===i||i.call(n,"scroll",{event:t,deltaY:e.scrollDeltaY,deltaX:e.scrollDeltaX}),r()}),{once:!0})})):(e.ongoingScrollTop=null,e.scrollDeltaY=0)}0!==e.scrollDeltaX||0!==e.scrollDeltaY?(e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame((function(){e.scrollRequested=!1,e.performScroll(e)}))):e.stopScroll()}}},{key:"onElementScroll",value:function(){var e;null===(e=this.config)||void 0===e||null===(e=e.callback)||void 0===e||e.call(this.thisObj||this.scrollManager,this)}},{key:"scrollLeft",get:function(){return this.element.scrollLeft}},{key:"scrollTop",get:function(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}},{key:"scrollRelativeLeft",get:function(){return this.scrollLeft-this.startScrollLeft}},{key:"scrollRelativeTop",get:function(){return this.scrollTop-this.startScrollTop}},{key:"getRelativeLeftScroll",value:function(e){return this.scrollManager.getRelativeScroll(e,"left")}},{key:"getRelativeTopScroll",value:function(e){return this.scrollManager.getRelativeScroll(e,"top")}}])}(Mn);vg._$name="ScrollManager";var mg=function(e){return"number"==typeof e||(null==e?void 0:e.endsWith("px"))},pg=/=>\s*['"]/,yg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"type",get:function(){return this.constructor.type}},{key:"construct",value:function(e,n,r){var i=this,a=null==r?void 0:r.isRoot;a||(i.masterStore=n,n&&(i._grid=Array.isArray(n)?n[0].grid:n.grid),i.localizableProperties=rn.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(i.localeClass=e.localeClass));for(var l=arguments.length,s=new Array(l>3?l-3:0),u=3;u<l;u++)s[u-3]=arguments[u];B(t,"construct",this,3)([e,n,r].concat(s));var c=i.grid;if(!a){if(i.isLeaf&&!("field"in i.data)&&(i.setData("field","_"+(i.type||"")+ ++t.emptyCount),i.noFieldSpecified=!0),i.width||i.flex||i.children||i.setData({width:t.defaultWidth,flex:null},null,!0),i.headerWidgets&&i.initHeaderWidgets(i.headerWidgets),i.isParent&&(i.meta.visibleChildren=new o,i.collapsible&&c.once("paint",(function(){return i.collapsible=!0}))),i.renderer){var d=i.renderer.toString();i.rendererReturningContent=d.includes("return ")||Boolean(d.match(pg))}!i.formula||i.field&&c.store.modelClass.getFieldDefinition(i.field)||console.warn('No Model field found for this Column´s field: "'.concat(i.field,'".'))}}},{key:"shouldSync",value:function(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}},{key:"isCollapsible",get:function(){var e;return(null===(e=this.children)||void 0===e?void 0:e.length)>1&&this.collapsible}},{key:"collapsed",get:function(){return this.get("collapsed")},set:function(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.grid.trigger("columnCollapseToggle",{column:this,collapsed:e})}},{key:"onCellFocus",value:function(e){var t=this;t.location=e,-1!==e.rowIndex&&t.updateCellAriaLabel(t.localizeProperty("cellAriaLabel"))}},{key:"updateHeaderAriaLabel",value:function(e){li.setAttributes(this.element,{"aria-label":e})}},{key:"updateCellAriaLabel",value:function(e){var t,n,r;null!==(t=this.location)&&void 0!==t&&t.isSpecialRow||null===(n=this.location)||void 0===n||!n.cell||(null!==(r=e)&&void 0!==r&&r.length||(e=this.location.column.text),li.setAttributes(this.location.cell,{"aria-label":e}))}},{key:"doDestroy",value:function(){var e,n;null===(e=this.data)||void 0===e||null===(e=e.editor)||void 0===e||null===(n=e.destroy)||void 0===n||n.call(e),this.destroyHeaderWidgets(),B(t,"doDestroy",this,3)([])}},{key:"headerWidgets",get:function(){return this.get("headerWidgets")},set:function(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}},{key:"initHeaderWidgets",value:function(e){this.destroyHeaderWidgets();var t,n=this.headerWidgetMap={},r=D(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=Lo.create(F({owner:this},i));a.element.classList.add("b-grid-headerwidget"),n[a.ref||a.id]=a}}catch(e){r.e(e)}finally{r.f()}}},{key:"destroyHeaderWidgets",value:function(){for(var e=0,t=Object.values(this.headerWidgetMap||{});e<t.length;e++){var n,r=t[e];null===(n=r.destroy)||void 0===n||n.call(r)}}},{key:"getCellClass",value:function(e){var n,r=e.record,i=e.column,a=i.cellCls,o=i.internalCellCls,l=i.grid,s=i.constructor,u=i.align,c=i.field,d=r.fieldMap[c],h=(null===(n=t.autoClsMap)||void 0===n?void 0:n.get(s))||s.generateAutoCls(),f=e.cell.classList.contains("b-editing"),v=S(S(S(S(S(S(S(S(S(S({},l.cellCls,l.cellCls),h,h),a,a),o,o),"b-cell-dirty",l.showDirty&&c&&!(null!=d&&d.calculated)&&r.isFieldModified(c)&&(i.compositeField||!1!==(null==d?void 0:d.persist))),"b-grid-cell-align-".concat(u),u),"b-selected",l.selectionMode.cell&&l.isCellSelected(e)),"b-focused",l.isFocused(e)),"b-auto-height",i.autoHeight),"b-editing",f);return r.isSpecialRow&&v["b-checkbox-selection"]&&(v["b-checkbox-selection"]=!1),v}},{key:"locked",get:function(){return"locked"===this.data.region},set:function(e){this.region=e?"locked":"normal"}},{key:"region",get:function(){return this.parent.isRoot?this.get("region"):this.parent.region},set:function(e){this.set("region",e)}},{key:"sortable",get:function(){var e=this.data.sortable;return!(!e||!(!this.noFieldSpecified&&this.field||e.sortFn))&&e},set:function(e){this.set("sortable",e)}},{key:"groupable",get:function(){return Boolean(!(this.noFieldSpecified||!this.field)&&this.data.groupable)},set:function(e){this.set("groupable",e)}},{key:"filterable",get:function(){return this.isLeaf&&this.data.filterable}},{key:"editor",get:function(){var e=this,t=e.grid,n=e.field,r=e.data.editor;if(r&&!r.isWidget){var i=t.processCellEditor({editor:r,field:e.field});i?r=i.editor:("string"==typeof r&&(r={type:r}),(r=Lo.create(Be.merge(e.defaultEditor,{owner:t,dataField:t.store.modelClass.getFieldDefinition(n),label:Le.encodeHtml(e.text)},r))).formulaStore=t.store,$e.remove(r.localizableProperties,"label")),!r.dontCache&&(e.data.editor=r)}return r},set:function(e){this.data.editor=e}},{key:"afterChange",value:function(){var e;if(B(t,"afterChange",this,3)(arguments),null!==(e=this.data.editor)&&void 0!==e&&e.isWidget){var n=this.editor,r=Le.encodeHtml(this.text);n.label!==r&&(n.label=r)}}},{key:"defaultEditor",get:function(){return{type:"textfield",name:this.field}}},{key:"getFilterableValue",value:function(e){return this.getRawValue(e)}},{key:"owner",get:function(){return this._owner||this.subGrid},set:function(e){this._owner=e}},{key:"grid",get:function(){var e;return this._grid||(null===(e=this.parent)||void 0===e?void 0:e.grid)}},{key:"subGrid",get:function(){var e;return this._subGrid||(null===(e=this.grid)||void 0===e?void 0:e.getSubGridFromColumn(this))},set:function(e){this._subGrid=e}},{key:"subGridElement",get:function(){return this.subGrid.element}},{key:"element",get:function(){return this.grid.getHeaderElement(this)}},{key:"previousVisibleSibling",get:function(){for(var e=this.region,t=this.previousSibling;t&&(t.hidden||t.region!==e);)t=t.previousSibling;return t}},{key:"nextVisibleSibling",get:function(){for(var e=this.region,t=this.nextSibling;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}},{key:"isLastInSubGrid",get:function(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}},{key:"allowDrag",get:function(){return!this.parent.isRoot||Boolean(this.nextVisibleSibling||this.previousVisibleSibling)}},{key:"textWrapper",get:function(){return li.getChild(this.element,".b-grid-header-text")}},{key:"textElement",get:function(){return li.down(this.element,".b-grid-header-text-content")}},{key:"contentElement",get:function(){return li.down(this.element,".b-grid-header-children")}},{key:"isSorted",get:function(){var e,t=this;return this.grid.store.sorters.some((function(e){return e.field===t.field}))||(null===(e=this.grid.store.groupers)||void 0===e?void 0:e.some((function(e){return e.field===t.field})))}},{key:"isFocusable",get:function(){var e;return this.isLeaf&&!(null!==(e=this.grid)&&void 0!==e&&e.hideHeaders)}},{key:"headerText",get:function(){return this.htmlEncodeHeaderText?Le.encodeHtml(this.text):this.text}},{key:"isVisible",get:function(){return!this.hidden&&(!this.parent||this.parent.isVisible)}},{key:"hide",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.parent;if(!n.hidden){if(n.hidden=!0,r&&!r.isRoot&&!r.isTogglingAll)r.children.some((function(e){return!0!==e.hidden}))||r.hidden||(e=!0,r.hide());n.isParent?n.children.forEach((function(e){return e.hide(!0,!0)})):r.isRoot||r.meta.visibleChildren[t?"add":"delete"](n),e||n.stores.forEach((function(e){return e.trigger("columnHide",{column:n})}))}}},{key:"show",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.parent;if(t.hidden){var r;if(t.hidden=!1,null!=n&&n.hidden&&n.show(),t.isParent)null===(r=t.meta.visibleChildren)||void 0===r||r.forEach((function(e){return e.show(!0)}));e||t.stores.forEach((function(e){return e.trigger("columnShow",{column:t})}))}}},{key:"toggle",value:function(e){return this.hidden&&e===i||!0===e?this.show():!this.hidden&&e===i||!1===e?this.hide():void 0}},{key:"toggleChildren",value:function(){var e,t,n=arguments.length>0&&arguments[0]!==i?arguments[0]:this.children,r=arguments.length>1&&arguments[1]!==i?arguments[1]:i,a=this;null===(e=a.grid.columns)||void 0===e||e.beginBatch(),a.isTogglingAll=!0,n.forEach((function(e){return e.toggle(r)})),a.isTogglingAll=!1,null===(t=a.grid.columns)||void 0===t||t.endBatch()}},{key:"onCollapseChange",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:i,t=this;if("toggleAll"===t.collapseMode)t.toggleChildren();else{var n,r,a=t.firstChild;null!=a.flex&&t.collapsed?(a.oldFlex=a.flex,a.width=a.element.offsetWidth):!t.collapsed&&a.oldFlex&&(a.flex=a.oldFlex,a.oldFlex=null),null===(n=t.grid.columns)||void 0===n||n.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach((function(t){return t.toggle(e)})),t.isTogglingAll=!1,null===(r=t.grid.columns)||void 0===r||r.endBatch()}}},{key:"collapsible",get:function(){return this.get("collapsible")},set:function(e){var t=this;if(t.set("collapsible",e),t.isParent){var n=t.headerWidgets,r=void 0===n?[]:n;if(e)r.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:"b-icon-collapse-".concat(t.grid.rtl?"right":"left"),pressedIcon:"b-icon-collapse-".concat(t.grid.rtl?"left":"right"),cls:"b-grid-header-collapse-button b-transparent",onToggle:function(e){var n=e.pressed;return t.collapsed=n}});else{var i=r.findIndex((function(e){return"collapseExpand"===e.ref}));i>-1&&r.splice(i,1)}t.headerWidgets=r,t.collapsed&&t.onCollapseChange(!1)}}},{key:"generateId",value:function(){var e,n,r,i=this.grid,a=[null!==(e=null===(n=this.field)||void 0===n?void 0:n.replace(/\./g,"-"))&&void 0!==e?e:"col"];i?(a.unshift(null!==(r=i.stateId)&&void 0!==r?r:i.id),i.generatedIdIndex||(i.generatedIdIndex=0),a.push(i.generatedIdIndex+=1)):(t.generatedIdIndex||(t.generatedIdIndex=0),a.push(t.generatedIdIndex+=1));return this.meta.generatedId=a.join("-")}},{key:"allIndex",get:function(){return this.masterStore.indexOf(this)}},{key:"measureSize",value:function(e){var t;return li.measureSize(e,null===(t=this.subGrid)||void 0===t?void 0:t.element)}},{key:"calcMinWidth",get:function(){var e=this.data,t=e.width,n=e.minWidth;return mg(t)&&mg(n)?Math.max(parseInt(t)||0,parseInt(n)||0):t}},{key:"width",get:function(){return this.data.width},set:function(e){var t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}},{key:"flex",get:function(){return this.data.flex},set:function(e){var t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}},{key:"calculateMinWidth",value:function(){var e=this,t=e.measureSize(e.width),n=e.measureSize(e.minWidth),r=0;return e.children&&(r=e.children.reduce((function(e,t){return e+t.calculateMinWidth()}),0)),Math.max(t,n,r)}},{key:"resizeToFitContent",value:function(e,t){var n,a=arguments.length>2&&arguments[2]!==i&&arguments[2],o=this,l=o.grid,s=o.element,u=o.fitMode,c=l.rowManager,d=l.$store.records,h=d.length;if(!(h<=0||"none"===o.fitMode||!o.fitMode||li.isVueConfig(o.data))){var f,v,g,m,p,y,k=_(c.rows,1)[0],b=l.beginGridMeasuring(),C=b.rowElement,w=b.cellElement,D=new cg({grid:l,column:o,id:null}),S=0,x={length:0,record:null};if(w._domData={columnId:o.id,row:k,rowElement:C},D._cell=w,D.updatingSingleRow=!0,D.isMeasuring=!0,w.innerHTML="",l.resizeToFitIncludesHeader&&!l.hideHeaders){if(!l.$headerPadding){var E=r.getComputedStyle(s);l.$headerPadding=parseInt(E.paddingLeft)}var R=s.querySelector(".b-grid-header-text-content");R.style.cssText="flex: none; width: auto",S=R.offsetWidth+(l.cellEllipsis?1:0)+2*l.$headerPadding+2,R.style.cssText=""}for(h>1e3?v=(f=Math.max(Math.min(c.topIndex+Math.round(c.rowCount/2)-500,h-1e3),0))+1e3:(f=0,v=h),g=f;g<v;g++){if(m=d[g],p=o.getRawValue(m),"value"===u)y=String(p).length;else if(D._record=m,D._id=m.id,D._rowIndex=g,k.renderCell(D),"textContent"===u)y=w.textContent.length;else{var T=w.offsetWidth+(l.cellEllipsis?1:0);T>S&&(S=T)}y>x.length&&(x={record:m,length:y,rowIndex:g})}if(null!==(n=l.features.summary)&&void 0!==n&&n.enabled){var M,F=null===(M=l.getFooterElement(o))||void 0===M?void 0:M.querySelector(".b-grid-summary-value");if(F){var A=F.scrollWidth+2*l.$headerPadding+2;A>S&&(S=A)}}if(x.length>0&&("value"===u||"textContent"===u)&&(D._record=x.record,D._id=x.record.id,D._rowIndex=x.rowIndex,k.renderCell(D),S=Math.max(S,w.offsetWidth)),Array.isArray(e)){var I=_(e,2);e=I[0],t=I[1]}return S=Math.max(S,e||0),S=Math.min(S,t||1e6),a||l.endGridMeasuring(),o.width=o.maxWidth?S=Math.min(S,o.maxWidth):S,S}}},{key:"getState",value:function(){var e=this,t=e.parentId,n={id:e.id,type:e.type,hidden:e.hidden,region:e.region,locked:e.locked,text:e.text};return e.noFieldSpecified||(n.field=e.field),null!=t&&(n.parentId=t),e.children||(n[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(n.collapsed=e.collapsed),n}},{key:"applyState",value:function(e){var t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=i:"flex"in e&&t.width&&(t.width=i),"region"in e&&(t.region=e.region),"text"in e&&(t.text=e.text),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden),"collapsed"in e&&(t.collapsed=e.collapsed)}},{key:"remove",value:function(){var e=this.subGrid,n=this.grid,r=e&&(null==n?void 0:n.focusedCell);(null==r?void 0:r.columnId)===this.id&&(n.owns(li.getActiveElement(n))?n.navigateRight():n._focusedCell=new cg({grid:n,rowIndex:r.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),B(t,"remove",this,3)([])}},{key:"getRawValue",value:function(e,t){return e.getValue(t?this.editorField:this.field)}},{key:"refreshCell",value:function(e){this.grid.rowManager.refreshCell(e,this.id)}},{key:"refreshCells",value:function(){this.grid.refreshColumn(this)}},{key:"refreshHeader",value:function(){this.grid.refreshHeader(this)}},{key:"clearCell",value:function(e){e.innerHTML="",delete e._content}},{key:"canEdit",value:function(e){return!this.readOnly&&this.editor&&!1!==e.isEditable(this.editorField)}},{key:"insertChild",value:function(e){return(e=Array.isArray(e)?e:[e]).forEach((function(e){var t=e.parent;null!=t&&t.collapsed&&e===t.firstChild&&t.children.length>1&&1===t.children.filter((function(e){return!e.hidden})).length&&(e.nextSibling.hidden=!1)})),this.sealed&&!this.inProcessChildren?null:B(t,"insertChild",this,3)(arguments)}},{key:"canFillValue",value:function(e){e.range;var t=e.record;e.cell;var n=e.value,r=e.enforceType,i=!this.readOnly&&!1!==t.isEditable(this.field);if(i&&r){var a,o=t.getFieldDefinition(this.field),l=null==o||null===(a=o.constructor)||void 0===a?void 0:a.dataConstructor;i=null==n||!o||"auto"===(null==o?void 0:o.type)||l&&(n instanceof l||W(n)===l.name.toLowerCase())}return i}},{key:"calculateFillValue",value:function(e){var t=e.value,n=e.record;e.fromCell;var r=e.range,i=e.horizontal,a=n.getFieldDefinition(this.field);return!i||1!==r.length||a&&"auto"!==(null==a?void 0:a.type)&&"string"!==(null==a?void 0:a.type)||(t=r[0].cell.innerText.trim()),t}},{key:"getCurrentConfig",value:function(e){var n,r=B(t,"getCurrentConfig",this,3)([e]);return null!==(n=this.sortable)&&void 0!==n&&n.originalSortFn&&(r.sortable=this.sortable.originalSortFn),r.headerRenderer===this.internalHeaderRenderer&&delete r.headerRenderer,delete r.ariaLabel,delete r.cellAriaLabel,delete r.disableRendererWarning,r}},{key:"visible",get:function(){return this.isVisible},set:function(e){this.hidden=!e}},{key:"readOnly",get:function(){var e,t=this.field,n=this.grid,r=Boolean(this.get("readOnly"));return t&&n&&(null===(e=n.store.modelClass.getFieldDefinition(t))||void 0===e?void 0:e.calculated)||r},set:function(e){this.set("readOnly",e)}},{key:"renderer",get:function(){var e;return(null===(e=this.data)||void 0===e?void 0:e.renderer)||this.defaultRenderer},set:function(e){this.set("renderer",e)}},{key:"hasSummary",get:function(){return this.sum||this.summaries}},{key:"editorField",get:function(){var e=this.field,t=e&&this.grid.store.modelClass.getFieldDefinition(e);return null!=t&&t.formulaProviders?"#".concat(e):e}}],[{key:"setupFields",value:function(e,t){var n=this;od.setupFields(e,t);var r=t.fields,i=r.map;r.defs.forEach((function(e,t){if(e.defaultValue&&r.defaults[e.name]!==e.defaultValue&&"string"==typeof e.defaultValue&&e.defaultValue.match(/^L\{/)){var a=F(F({},e),{},{defaultValue:r.defaults[e.name],definedBy:n,model:n,owner:n});r.defs[t]=a,i[e.name]=a}}))}},{key:"generateAutoCls",value:function(){for(var e=[],n=this;n!==t;n=n.superclass)n.type&&n.type!==n.superclass.type&&e.push("b-".concat(n.type.toLowerCase(),"-cell"));var r=e.join(" ");return(t.autoClsMap||(t.autoClsMap=new a)).set(this,r),r}},{key:"text",get:function(){return this.$meta.fields.defaults.text}}])}(od.mixin(_n,Ya));S(yg,"$name","Column"),S(yg,"type","column"),S(yg,"fields",["type","text","field","renderer","afterRenderCell","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{},convert:function(e,t,n){return Be.isObject(e)?Be.merge({},n.constructor.defaultValues.editor,e):e}},"cellEditor","finalizeCellEdit",{name:"managedCellEditing",defaultValue:!0},{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert:function(e,t,n){if(!e)return!1;if(!0===e)return!0;var r={};return"function"==typeof e?(r.originalSortFn=e,r.sortFn=e.bind(n)):"object"===W(e)&&(Object.assign(r,e),r.fn&&(r.sortFn=r.fn,delete r.fn)),r}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert:function(e,t,n){if(!e)return!1;if(!0===e)return!0;var r={columnOwned:!0};return"function"==typeof e?r.filterFn=e:"object"===W(e)&&Be.merge(r,n.constructor.defaultValues.filterable,e),r}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!0},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{Column.cellLabel}"},"vue","formula"]),S(yg,"autoExposeFields",!1),yg.emptyCount=0,yg.defaultWidth=100,yg.exposeProperties(),yg._$name="Column";var kg={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},bg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this,r=e.grid;r&&(r._columnStore=n,n.id="".concat(r.id,"-columns"),r.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:n})),B(t,"construct",this,3)([e]),n.ion({change:n.onStoreChange,sort:function(){return n.updateChainedStores()},thisObj:n,prio:1})}},{key:"doDestroy",value:function(){var e=[];this.isChained||this.traverse((function(t){return e.push(t)})),B(t,"doDestroy",this,3)([]),this.isChained||e.forEach((function(e){return e.destroy()}))}},{key:"chain",value:function(e,n,r){return B(t,"chain",this,3)([e,n,F(F({},r),{},{tree:null})])}},{key:"getById",value:function(e){return B(t,"getById",this,3)([e])||this.idRegister[e]}},{key:"forEach",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this;this.traverseWhile((function(n,r){return e.call(t,n,r)}),!0)}},{key:"totalFixedWidth",get:function(){var e,t=this,n=0,r=D(this);try{for(r.s();!(e=r.n()).done;){var i=e.value;i.hidden||(i.children?i.children.forEach((function(e){return n+=t.calculateFixedWidth(e)})):n+=this.calculateFixedWidth(i))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"hasFlex",get:function(){return this.visibleColumns.some((function(e){return e.flex}))}},{key:"calculateFixedWidth",value:function(e){return e.flex?e.measureSize(yg.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}},{key:"topColumns",get:function(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}},{key:"visibleColumns",get:function(){var e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((function(e){return e.isVisible&&(!e.subGrid||!e.subGrid.collapsed)})).sort(e.sorterFn)),e._visibleColumns}},{key:"onStoreChange",value:function(e){var t=e.action,n=e.changes;("update"!==t||"hidden"in n)&&this.clearCaches()}},{key:"clearSubGridCaches",value:function(e){e.subGrid.columns.clearCaches(),this.clearCaches()}},{key:"clearCaches",value:function(){var e;this._visibleColumns=null,null===(e=this.masterStore)||void 0===e||e.clearCaches()}},{key:"onMasterDataChanged",value:function(e){B(t,"onMasterDataChanged",this,3)([e]),("update"!==e.action||"hidden"in e.changes||"region"in e.changes)&&this.clearCaches()}},{key:"getAdjacentVisibleLeafColumn",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this.visibleColumns,a=e instanceof yg?e:this.getById(e),o=r.indexOf(a)+(t?1:-1);if(!r[o]){if(!n)return null;o=t?0:r.length-1}return r[o]}},{key:"bottomColumns",get:function(){return this.leaves}},{key:"get",value:function(e){return this.findRecord("field",e,!0)}},{key:"lookupStateColumns",value:function(e){var t=this.getById(e.id),n=e.field,r=e.type;return t||!n&&!r?[t]:this.query((function(e){return!(n&&e.field!==n||r&&e.type!==r)}))}},{key:"lookupStateColumn",value:function(e){return this.lookupStateColumns(e)[0]}},{key:"createRecord",value:function(e){var n,r=this.grid,i=void 0===r?{}:r,a=i.store,o=null==a||null===(n=a.modelClass)||void 0===n||null===(n=n.fieldMap)||void 0===n?void 0:n[e.field],l=this.modelClass;if(null!=o&&o.column&&(e=pe.merge({},o.column,e)),e.type&&!(l=t.getColumnClass(e.type)))throw new Error("Column type '".concat(e.type,"' not registered. Please make sure you have imported the column class."));e.locked&&(e.region="locked",delete e.locked);var s=new l(e,this);if(s.data.region||(s.data.region=i.defaultRegion||"normal"),this.autoAddField&&!s.noFieldSpecified&&a&&!o){var u=s.field;s.constructor.fieldType&&(u={name:s.field,type:s.constructor.fieldType}),a.modelClass.addField(u)}return s}},{key:"indexOf",value:function(e){if(null==e)return-1;var n=B(t,"indexOf",this,3)([e]);return n>-1?n:this.records.findIndex((function(t){return t.field===e}))}},{key:"removeAll",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],n=this;return n.some((function(e){return e.isTimeAxisColumn}))?n.remove(n.query((function(e){return!e.isTimeAxisColumn})),e):B(t,"removeAll",this,3)([e])}},{key:"usesAutoHeight",get:function(){return this.some((function(e){return e.autoHeight}))}},{key:"usesFlexAutoHeight",get:function(){return this.some((function(e){return e.autoHeight&&null!=e.flex}))}},{key:"resolveSyncNode",value:function(e){return e.id?B(t,"resolveSyncNode",this,3)([e]):e.field?{id:e.field,node:this.allRecords.find((function(t){return t.field===e.field}))}:e.type?{id:e.type,node:this.allRecords.find((function(t){return t.type===e.type}))}:{id:null,node:null}}},{key:"generateColumnForField",value:function(e,t){var n;"string"==typeof e&&this.grid&&(e=null===(n=this.grid.store)||void 0===n?void 0:n.modelClass.fieldMap[e]);var r=e.column||kg[e.type]||{};return"string"==typeof r&&(r={type:r}),r=Object.assign({text:e.text||Le.separate(e.name),field:e.name},t,r),null!=e.precision&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}],[{key:"registerColumnType",value:function(e){var n=arguments.length>1&&arguments[1]!==i&&arguments[1];e.simpleRenderer=n,(t.columnTypes||(t.columnTypes={}))[e.type]=e}},{key:"getColumnClass",value:function(e){return t.columnTypes&&t.columnTypes[e]}}])}(Ya(Ff));S(bg,"configurable",{modelClass:yg,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:[{field:"region"}],reapplySortersOnAdd:!0,useRawData:!1});bg.registerColumnType(yg,!0),bg._$name="ColumnStore";var Cg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"fields",get:function(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0},{name:"fixed",type:"boolean",internal:!0}]}}])}(od);Cg.exposeProperties(),Cg._$name="GridRowModel";var wg,Dg,Sg=function(e){var t=e.parentElement,n=e.cloneNode(!0);return n.classList.add("b-removing"),t.insertBefore(n,e),n},xg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){e.grid._rowManager=this,B(t,"construct",this,3)([e.grid,e])}},{key:"doDestroy",value:function(){this.removeAllRows(),B(t,"doDestroy",this,3)([])}},{key:"initWithHeight",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this;return n.autoHeight&&(e=n.store.count*n.preciseRowOffsetHeight),n.viewHeight=e,n.calculateRowCount(t),e}},{key:"reinitialize",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.storeCount&&(e=!0),e&&(t.topIndex=t.lastScrollTop=0),t.scrollTargetRecordId=null;var n=t.topRow;n&&(n.dataIndex=t.topIndex,n.setTop(t.calculateTop(t.topIndex),!0)),t.estimateTotalHeight(),t.renderFromRow(n)}},{key:"matchRowCount",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.rows,r=t.grid,a=t.rowClass,o=n.length,l=o-t.rowCount;if(l)if(l<0){for(var s=[],u=o,c=o?n[o-1].dataIndex+1:0;u<t.rowCount;u++,c++)s.push(a.new({cls:r.rowCls,rowManager:t,grid:r,index:u,dataIndex:c}));n.push.apply(n,s),t.trigger("addRows",{rows:s}),e||t.renderFromRow(n[Math.max(0,o-1)])}else{var d,h=null===(d=li.getActiveElement(r))||void 0===d?void 0:d.closest(".b-grid-cell"),f=n.splice(o-l,l);o!==l&&f.some((function(e){return e.cells.includes(h)}))&&n[n.length-1].cells[r.focusedCell.columnIndex].focus(),t.trigger("removeRows",{rows:f}),f.forEach((function(e){return e.destroy()})),!e&&n.length&&t.fillBelow(t.lastScrollTop)}}},{key:"calculateRowCount",value:function(){var e,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this,o=a.storeCount,l=Math.ceil(a.viewHeight/a.minRowOffsetHeight),s=l+a.prependRowBuffer+a.appendRowBuffer;if(null===(e=a.grid.columns)||void 0===e||!e.count||isNaN(l))return a.rowCount=0,0;if(s<a.rowCount&&!n)return a.rowCount;if(a.visibleRowCount=l,a.rowCount=Math.min(o,s),!t){var u;if(a.rows&&a.rowCount!==a.rows.length){if(a.matchRowCount(r),(null===(u=a.bottomRow)||void 0===u?void 0:u.dataIndex)>=o&&0!==a.topRow.dataIndex){var c,d=a.bottomRow.dataIndex-o+1,h=D(a.rows);try{for(h.s();!(c=h.n()).done;){c.value.dataIndex-=d}}catch(e){h.e(e)}finally{h.f()}a.topIndex-=d}}else a.rowCount||a.trigger("changeTotalHeight",{totalHeight:a.totalHeight});a.grid.toggleEmptyText()}return a.rowCount}},{key:"insert",value:function(e,t){var n,r;null===(n=wg)||void 0===n||n();var i,a=this,o=a.rows,l=a.rowCount,s=a.rowClass,u=a.grid,c=u.element,d=u.rowCls,h=(null===(r=o[e-1])||void 0===r?void 0:r.dataIndex)+1||0,f=[],v=Pl.as("ms",li.getStyleValue(u.element,"--row-splice-duration")),g=a.lastVisibleRow.index+1-e;if(t<0){var m;t=Math.abs(t);for(var p=h>=u.store.count?t:Math.min(t,g),y=o.slice(e,e+p),k=p?y[y.length-1].bottom-y[0].top:0,b=[],C=[],w=[],D=0,S=y.length;D<S;D++){var x=y[D]._elementsArray.map(Sg);C.push(s.new({rowManager:a,_elementsArray:x,grid:u})),b.push.apply(b,z(x))}for(var E=e;E<l;E++)w.push(o[E]),o[E].addCls("b-repositioning"),o[E].setTop(o[E].top+k);i=o.length>u.store.count,null===(m=b[0])||void 0===m||m.getBoundingClientRect(),c.classList.add("b-splicing-rows");for(var R=0,T=y.length;R<T;R++){var M;C[R].setTop((null===(M=o[e-1])||void 0===M?void 0:M.bottom)||0,!0)}wg=function(){Dg&&!a.isDestroyed&&(Dg=Dg(),wg=null,c.classList.remove("b-splicing-rows"),b.forEach((function(e){return e.remove()})),w.forEach((function(e){var t;return null===(t=e.removeCls)||void 0===t?void 0:t.call(e,"b-repositioning")})))}}else if(t>0){var F,A=[];t=a.grid.hasVerticalOverflow?Math.min(t,a.lastVisibleRow.index+1-e):Math.min(t,Math.ceil((a.grid.scrollable.clientHeight-((null===(F=o[e-1])||void 0===F?void 0:F.bottom)||0))/a.rowHeight));for(var I=e,L=h,O=0;O<t;O++,I++,L++){var P;f.push(s.new({cls:"".concat(d," b-adding"),rowManager:a,_top:(null===(P=o[e-1])||void 0===P?void 0:P.bottom)||0,grid:u,index:I,dataIndex:L}))}for(var _=e;_<a.rowCount;_++,I++,L++)A.push(o[_]),o[_].addCls("b-repositioning"),o[_].index=I,o[_].dataIndex=L;i=f.length,wg=function(){Dg&&!a.isDestroyed&&(Dg=Dg(),wg=null,c.classList.remove("b-splicing-rows"),f.forEach((function(e){return!e.isDestroyed&&e.removeCls("b-adding")})),A.forEach((function(e){var t;return null===(t=e.removeCls)||void 0===t?void 0:t.call(e,"b-repositioning")})))},o.splice.apply(o,[e,0].concat(f)),t>0&&(a.rowCount+=t,a.trigger("addRows",{rows:f})),c.classList.add("b-splicing-rows")}return Dg=fr.on({element:u.element,animationcancel:wg,transitioncancel:wg,once:!0,expires:{delay:v,alt:wg}}),a.renderFromRow(o[e],!0),i&&a.calculateRowCount(!1,!0,!0),a.estimateTotalHeight(),f}},{key:"removeAllRows",value:function(){var e=this,t=e.topRow,n=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach((function(e){return e.destroy()})),e.rows.length=0,e.idMap={},n}},{key:"setPosition",value:function(e){var t=this.topRow,n=e.topRowIndex,r=e.topRowTop;t&&(t.setTop(r),t.dataIndex=n)}},{key:"store",get:function(){return this.client.store}},{key:"storeCount",get:function(){var e=this.store,t=e.count,n=e.lazyLoad;return t&&n&&null==n.totalCount&&(t+=n.chunkSize),t}},{key:"rows",get:function(){return this._rows}},{key:"getRow",value:function(e){if(this.rowCount)return this.rows[e-this.topIndex]}},{key:"getRowById",value:function(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}},{key:"getRowFromElement",value:function(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}},{key:"getRowAt",value:function(e){return arguments.length>1&&arguments[1]!==i&&arguments[1]||(e-=pt.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=li.roundPx(e),this.rows.find((function(t){return e>=t.top&&e<t.bottom}))}},{key:"getRowFor",value:function(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}},{key:"getNextRow",value:function(e){var t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}},{key:"topRow",get:function(){return this.rows[0]}},{key:"bottomRow",get:function(){var e=Math.min(this.rowCount,this.storeCount);return this.rows[e-1]}},{key:"firstVisibleRow",get:function(){var e=Math.ceil(this.grid.scrollable.y);return this.rows.find((function(t){return t.bottom>e}))}},{key:"firstFullyVisibleRow",get:function(){var e=Math.ceil(this.grid.scrollable.y);return this.rows.find((function(t){return t.top>=e}))||this.rows.find((function(t){return t.top<e&&t.bottom>e}))}},{key:"lastVisibleRow",get:function(){var e=this.grid;return $e.findLast(this.rows,(function(t){return t.top<e.scrollable.y+e.bodyHeight}))}},{key:"lastFullyVisibleRow",get:function(){var e=this.grid;return $e.findLast(this.rows,(function(t){return t.bottom<e.scrollable.y+e.bodyHeight}))}},{key:"offsetRows",value:function(e){if(0!==e)for(var t=this.rows,n=t.length,r=0;r<n;r++)t[r].offset(e);this.trigger("offsetRows",{offset:e})}},{key:"prependBufferHeight",get:function(){return this.prependRowBuffer*this.rowOffsetHeight}},{key:"appendBufferHeight",get:function(){return this.appendRowBuffer*this.rowOffsetHeight}},{key:"rowHeight",get:function(){return this._rowHeight},set:function(e){var t=this,n=t.grid,r=t.fixedRowHeight,i=t.rowHeight;if(i!==e){if(Be.assertNumber(e,"rowHeight",!0),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){var a,o,l=n.scrollable.y,s=t.getRowAt(l,!0),u=s?s.top-l:0;r?(a=e,o=i):(o=a=t.averageRowHeight,t.clearKnownHeights(),a*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(a+n._rowBorderHeight),!0),t.refresh(),l*(a/o)!==l&&n.scrollRowIntoView(s.id,F(F({},n.defaultScrollOptions),{},{block:"start",edgeOffset:u}))}t.trigger("rowHeight",{height:e,oldHeight:i})}}},{key:"rowOffsetHeight",get:function(){return Math.floor(this.preciseRowOffsetHeight)}},{key:"preciseRowOffsetHeight",get:function(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}},{key:"minRowOffsetHeight",get:function(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}},{key:"allHeightsKnown",get:function(){return this.fixedRowHeight||this.heightMap.size>=this.storeCount}},{key:"storeKnownHeight",value:function(e,t){var n=this,r=n.heightMap;n.fixedRowHeight||(r.has(e)&&(n.totalKnownHeight-=r.get(e)),r.set(e,t),n.totalKnownHeight+=t,t<n.minRowHeight&&(n.minRowHeight=t),n.averageRowHeight=n.totalKnownHeight/r.size)}},{key:"getOffsetHeight",value:function(e){var t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}},{key:"invalidateKnownHeight",value:function(e){var t=this;if(!t.fixedRowHeight){var n=t.heightMap;(e=$e.asArray(e)).forEach((function(e){e&&n.has(e.id)&&(t.totalKnownHeight-=n.get(e.id),n.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/n.size}}},{key:"clearKnownHeights",value:function(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}},{key:"calculateTop",value:function(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;for(var t=this.store.storage,n=0,r=0;r<e;r++){var i=t.getAt(r);n+=this.getOffsetHeight(i)}return Math.floor(n)}},{key:"getRecordCoords",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.getRowById(e),o=r.client._bodyRectangle;if(t||(o=r.client.refreshBodyRectangle()),a)return new pt(o.x,t?Math.round(a.top):Math.round(a.top+o.y-r.client.scrollable.y),Math.max(o.width,0),a.offsetHeight);var l=r.store.indexOf(e);return-1!==l?r.getRecordCoordsByIndex(l,t,n):null}},{key:"getRecordCoordsByIndex",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=arguments.length>2&&arguments[2]!==i&&arguments[2],o=this,l=o.topRow,s=o.bottomRow,u=o.client._bodyRectangle,c=o.store.getAt(e).id,d=o.preciseRowOffsetHeight,h=l.dataIndex,f=s.dataIndex,v=Math.floor(null!==(t=o.heightMap.get(c))&&void 0!==t?t:d);if(o.allHeightsKnown&&!a){var g=o.calculateTop(e);n=r?g:g+u.y-o.client.scrollable.y}else{var m=e>f?{index:e-f-1,y:s.bottom,from:"bottomRow"}:e>h/2?{index:e-h,y:l.top,from:"topRow"}:{index:e,y:0,from:"top"},p=Math.floor(m.y+m.index*d);n=r?"topRow"===m.from?p+d-v:p:p+u.y-o.client.scrollable.y}var y=new pt(u.x,n,u.width,v);return y.virtual=!0,y.block=y.bottom<u.y?"start":y.y>u.bottom?"end":"nearest",y}},{key:"totalHeight",get:function(){return this._totalHeight}},{key:"forEach",value:function(e){this.rows.forEach(e)}},{key:Symbol.iterator,value:function(){return this.rows[Symbol.iterator]()}},{key:"refreshCell",value:function(e,t){var n=new cg({grid:this.grid,record:e,columnId:t});return Boolean(n.cell&&n.row.renderCell(n))}},{key:"returnToTop",value:function(){var e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}},{key:"renderFromRecord",value:function(e){var t=this.getRowById(e.id);t&&this.renderFromRow(t)}},{key:"renderFromRow",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,t=arguments.length>1?arguments[1]:i,n=this,r=n.rows,a=n.store,o=n.topIndex,l=n.topRow,s=n.storeCount,u=e?r.indexOf(e):0;if(0===n.calculateRowCount(!1,s<r.length&&!t,!0)||u>=r.length)n.estimateTotalHeight(!0);else{n.topIndex<o?(n.topRow.setTop(n.calculateTop(n.topIndex),!0),u=0,e=n.topRow):e&&r.indexOf(e)<0&&(e=r[u]||l);for(var c,d=e?e.dataIndex:r[0].dataIndex,h=s-d-1,f=Math.min(r.length-1,u+h),v=r.length-f-1,g=u>0?r[u-1].bottom:r[u].top,m=[],p=u;p<=f;p++)(c=r[p]).dataIndex=d,t?m[p]=g:c.setTop(g,!0),c.render(d,a.getAt(d++),!1),g+=c.offsetHeight;if(t){r[u].element.getBoundingClientRect();for(var y=u;y<=f;y++)r[y].setTop(m[y],!0)}for(;v-- >0;)n.displayRecordAtTop();n.bottomRow.bottom<n.viewHeight+n.lastScrollTop&&n.calculateRowCount(),n.estimateTotalHeight(!0),n.trigger("renderDone")}}},{key:"renderRows",value:function(e){var t,n=!1;(e=Array.from(e)).sort((function(e,t){return e.dataIndex-t.dataIndex}));var r,i=D(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;t=a.height,a.render(null,null,!1),n|=a.height!==t}}catch(e){i.e(e)}finally{i.f()}n&&this.translateFromRow(e[0]),this.trigger("renderDone")}},{key:"bufferedTranslateFromRow",value:function(){this.translateFromRow(this.topRow)}},{key:"translateFromRow",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=this,o=e.bottom;for(n=e.dataIndex+1,t=a.getRow(n);t;t=a.getRow(++n))o=t.translate(o);r||a.estimateTotalHeight(!0)}},{key:"refresh",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.topRow;!n&&!e||t.grid.refreshSuspended||(t.idMap={},t.renderFromRow(n),t.trigger("refresh"))}},{key:"jumpToPosition",value:function(e,t){var n=this,r=n.store,i=n.heightMap,a=n.storeCount;if(n.allHeightsKnown&&!n.fixedRowHeight){for(var o=e-n.prependBufferHeight,l=n.grid._rowBorderHeight,s=0,u=0;s<o;){var c=r.records[u];s+=i.get(c.id)+l,u++}var d=Math.max(Math.min(u,a-n.rowCount),0);n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=d,n.topRow.setTop(n.calculateTop(d),!1),n.refresh()}else{var h=n.preciseRowOffsetHeight,f=null==t?Math.floor(e/h)-n.prependRowBuffer:t-Math.floor(n.rowCount/2),v=Math.max(Math.min(f,a-n.rowCount),0),g=n.client.scrollable.y,m=Math.min(n.client._bodyRectangle.height+g+n.appendBufferHeight,n.totalHeight);if(n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=v,n.topRow.setTop(Math.floor(v*h),!1),n.refresh(),n.bottomRow.bottom<m)for(n.calculateRowCount(!1,!1,!1);n.bottomRow.bottom<m&&n._rows[n.prependRowBuffer].top<g&&n.bottomRow.dataIndex<a-1;)n.displayRecordAtBottom();n.estimateTotalHeight()}if(null!=t){var p=n.grid.scrollable,y=n.getRow(t),k=y&&pt.from(y._elementsArray[0]).center.y,b=p.viewport.center.y;y&&(p.y=e=Math.floor(p.y+(k-b)))}return e}},{key:"warpIfNeeded",value:function(e){var t,n=this,r={newScrollTop:e,deltaTop:e-n.lastScrollTop};Math.abs(r.deltaTop)>n.rowCount*n.rowOffsetHeight*3&&(n.scrollTargetRecordId&&(t=n.store.indexOf(n.scrollTargetRecordId)),n.grid.onFocusedRowDerender(),r.newScrollTop=n.jumpToPosition(e,t),r.deltaTop=0);return r}},{key:"updateRenderedRows",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this;if(0===r.rowCount)return 0;var a=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+r.viewHeight){var o=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=o.newScrollTop,o.deltaTop>0?r.fillBelow(o.newScrollTop):o.deltaTop<0&&r.fillAbove(o.newScrollTop),r.fixedRowHeight||n||r.correctError(o,e),a=r.estimateTotalHeight()}return a}},{key:"correctError",value:function(e,t){var n=this,r=0;(n.allHeightsKnown||e.deltaTop<0&&t<2*n.viewHeight||e.deltaTop>0&&t>n.totalHeight-2*n.viewHeight-3)&&(r=n.topRow.top-n.calculateTop(n.topRow.dataIndex)),r&&(n.offsetRows(-r),n.grid.scrollable.y=n.lastScrollTop=n.grid.scrollable.y-r)}},{key:"fillAbove",value:function(e){for(var t=this,n=t.rows,r=Math.min(t.prependRowBuffer,n.length-1);n[r].top>e&&t.topIndex>0;)t.displayRecordAtTop();t.trigger("renderDone")}},{key:"fillBelow",value:function(e){for(var t=this,n=t.rows,r=t.storeCount,i=n.length,a=Math.min(i-Math.min(t.appendRowBuffer,i-1),i-1),o=e+t.viewHeight;n[a].top<o&&t.bottomRow.dataIndex<r-1;)t.displayRecordAtBottom();t.trigger("renderDone")}},{key:"estimateTotalHeight",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;if(!t.grid.renderingRows){var n,r=t.bottomRow,a=t.storeCount,o=a-t.heightMap.size;if(t.fixedRowHeight)n=a*t.rowOffsetHeight;else{if(n=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+o*t.preciseRowOffsetHeight,r&&o){var l=r.bottom;(l>n||t.topIndex+t.rowCount>=a&&n>l&&l>0)&&(n=l,r.dataIndex<a-1&&(n+=(a-1-r.dataIndex)*t.preciseRowOffsetHeight))}n=Math.floor(n)}return n!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:n,immediate:e})&&(t._totalHeight=n),n}}},{key:"displayRecordAtTop",value:function(){var e,t=this,n=t.grid,r=t.topIndex-1,i=t.store.getAt(r),a=t.bottomRow,o=a.top;return t.trigger("beforeTranslateRow",{row:a,newRecord:i}),a.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),a._top=t.topRow.top-t.getOffsetHeight(i),a.estimatedTop=!t.fixedRowHeight,a.render(r,i,!1),a._top=o,a.setBottom(t.topRow.top),a.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),t.fixIndices(),a.offsetHeight}},{key:"displayRecordAtBottom",value:function(){var e,t=this,n=t.grid,r=t.topIndex+t.rowCount,i=t.store.getAt(r),a=t.topRow;return t.trigger("beforeTranslateRow",{row:a,newRecord:i}),a.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),a.dataIndex=r,a.setTop(t.bottomRow.bottom),a.render(r,i,!1),t.topIndex++,t._rows.push(t._rows.shift()),t.fixIndices(),a.offsetHeight}},{key:"fixIndices",value:function(){for(var e=0,t=this.rows,n=t.length;e<n;e++)t[e].index=e}}],[{key:"pluginConfig",get:function(){return{chain:["destroy"],assign:["topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}},{key:"defaultConfig",get:function(){return{rowClass:hg,prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}},{key:"properties",get:function(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new a,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}}])}(wc.mixin($i));S(xg,"delayable",{bufferedTranslateFromRow:"raf"}),xg.featureClass="",xg._$name="RowManager";var Eg={x:1},Rg=function(e){return e.isSubGrid},Tg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"addScroller",value:function(e){(this.xScrollers||(this.xScrollers=[])).push(e)}},{key:"addPartner",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:Eg,r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];if("string"==typeof n&&(n=S({},n,1)),n.x){e.owner.initScroll();for(var a=this.widget.items.filter(Rg),o=e.widget.items.filter(Rg),l=0,s=a.length;l<s;l++)a[l].scrollable.addPartner(o[l].scrollable,"x")}r&&li.scrollBarWidth&&e.isGridScroller&&(e.ion({overflowChange:"onPartnerOverflowChange",thisObj:this}),this.onPartnerOverflowChange({source:e,y:e.hasOverflowY})),B(t,"addPartner",this,3)([e,F(F({},n),{},{x:!1})])}},{key:"onPartnerOverflowChange",value:function(e){var t=e.source,n=e.y,r=this,i=r.hasOverflowY,a=n;i&&!a&&(t.overflowY="scroll"),!i&&a?r.overflowY="scroll":i||a||(r.overflowY=t.overflowY=!0),r.owner.refreshVirtualScrollbars()}},{key:"removePartner",value:function(e){li.scrollBarWidth&&e.isGridScroller&&e.un({overflowChange:"onPartnerOverflowChange",thisObj:this}),this.xScrollers.forEach((function(t,n){t.isDestroyed||t.removePartner(e.xScrollers[n])})),B(t,"removePartner",this,3)([e])}},{key:"updateOverflowX",value:function(e){var t,n=!1===e;null===(t=this.xScrollers)||void 0===t||t.forEach((function(e){return e.overflowX=n?"hidden":"hidden-scroll"})),this.widget.virtualScrollers.classList.toggle("b-hide-display",n)}},{key:"scrollIntoView",value:function(e,n){if(e.nodeType!==Element.ELEMENT_NODE||!this.element.contains(e))return B(t,"scrollIntoView",this,3)([e,n]);var r,i=D(this.xScrollers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.element.contains(e))return a.scrollIntoView(e,n)}}catch(e){i.e(e)}finally{i.f()}}},{key:"hasOverflow",value:function(){return"y"===(arguments.length>0&&arguments[0]!==i?arguments[0]:"y")&&this.scrollHeight>this.clientHeight}},{key:"x",get:function(){return this.xScrollers?this.xScrollers[0].x:0},set:function(e){this.xScrollers&&(this.xScrollers[0].x=e)}}])}(Oa);S(Tg,"$name","GridScroller"),Tg._$name="GridScroller";var Mg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"columns",get:function(){return this._columns||this.subGrid.columns},set:function(e){this._columns=e}},{key:"fixCellWidths",value:function(){var e,t=this,n=t.columns.hasFlex;t.columns.traverse((function(n){var r=t.getBarCellElement(n.id),i=li.setLength(n.width),a=li.setLength(n.minWidth),o=li.setLength(n.maxWidth);if(r){if(e=i,r.style.maxWidth=o,n.isParent&&null==n.width&&null==n.flex){var l=n.children.reduce((function(e,t){return e+(!t.hidden&&t.flex||0)}),0);r.style.flex=l>0?"".concat(l," 0 auto"):"",r.style.minWidth=null,l>0&&n.traverse((function(e){return e.data.minWidth=null}))}else if(parseInt(n.minWidth)>=0&&(r.style.minWidth=a),r.style.flex=r.style.flexBasis=r.style.width="",n.flex)!isNaN(parseInt(n.flex))&&n.children?r.style.flex="".concat(n.flex," 0 auto"):r.style.flex=n.flex;else if(parseInt(n.width)>=0){var s=n.parent;!t.isHeader||s.isRoot||s.width?r.style.flexBasis=e:r.style.width=i}n.height>=0&&(r.style.height=li.setLength(n.height))}})),t.scrollable.element.classList.toggle("b-has-flex",n)}},{key:"getLrPadding",value:function(e){if(!this.cellLrPadding){var t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}},{key:"getBarCellElement",value:function(e){return this.element.querySelector('[data-column-id="'.concat(e,'"]'))}}],[{key:"defaultConfig",get:function(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"},role:null}}}])}(Lo);S(Mg,"$name","Bar"),S(Mg,"type","gridbar"),Mg.initClass(),Mg._$name="Bar";var Fg,Ag,Ig=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"subGrid",get:function(){return this._subGrid},set:function(e){this._subGrid=this.owner=e}},{key:"region",get:function(){var e;return null===(e=this.subGrid)||void 0===e?void 0:e.region}},{key:"changeElement",value:function(e,n){var r=this.region;return this.getConfig("columns"),B(t,"changeElement",this,3)([{className:S({"b-grid-header-scroller":1},"b-grid-header-scroller-".concat(r),r),role:null,children:[{reference:"headersElement",className:S({"b-grid-headers":1},"b-grid-headers-".concat(r),r),dataset:{region:r,reference:"headersElement",maxDepth:this.maxDepth}}]},n])}},{key:"overflowElement",get:function(){return this.headersElement}},{key:"getColumnConfig",value:function(e){var t,n,r=this,i=e.id,a=e.align,o=e.resizable,l=e.isLeaf,s=e.isParent,u=e.isLastInSubGrid,c=e.cls,d=e.childLevel,h=e.field,f=e.tooltip,v=e.children,g=e.isFocusable,m=e.grid,p=null==m?void 0:m.focusedCell,y=-1===(null==p?void 0:p.rowIndex)&&(null==p?void 0:p.column)===e,k={};if(e.isVisible)return e.flex?k.flex=e.flex:e.width&&(k.width=li.setLength(e.width)),S(S(S({style:k,className:S(S(S(S(S(S(S(S(S({"b-grid-header":1,"b-grid-header-parent":s},"b-level-".concat(d),1),"b-depth-".concat(null!==(t=e.meta.depth)&&void 0!==t?t:0),1),"b-grid-header-align-".concat(a),a),"b-grid-header-resizable",o&&l),c,c),"b-collapsible",e.collapsible),"b-last-parent",s&&u),"b-last-leaf",l&&u),"b-header-widgets",null===(n=e.headerWidgets)||void 0===n?void 0:n.length),role:g?"columnheader":null,"aria-sort":"none","aria-label":e.ariaLabel},g?"tabIndex":"",y?0:-1),"dataset",F(F({},pc.encodeConfig(f)),{},S({columnId:i},h?"column":"",h))),"children",[{className:"b-grid-header-text",role:null,children:[S(S({},m&&g?"id":"","".concat(null==m?void 0:m.id,"-column-").concat(e.id)),"className",{"b-grid-header-text-content":1,"b-has-text":Boolean(e.text)})]},v?{className:"b-grid-header-children",children:v.map((function(e){return r.getColumnConfig(e)})),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}])}},{key:"calculateMinWidthForSafari",value:function(){var e=0;return this.columns.visibleColumns.forEach((function(t){e+=t.calculateMinWidth()})),e}},{key:"fixHeaderWidths",value:function(){this.fixCellWidths()}},{key:"refreshHeaders",value:function(){var e=this;e.columns.traverse((function(t){return e.refreshColumn(t)})),e.fixHeaderWidths()}},{key:"refreshColumn",value:function(e){var t=this.getBarCellElement(e.id);if(t){var n=e.headerText;if(e.headerRenderer&&(n=e.headerRenderer.call(e.thisObj||this,{column:e,headerElement:t}),li.isReactElement(n)))return li.handleReactHeaderElement(e,t,n);e.headerWidgetMap&&Object.values(e.headerWidgetMap).forEach((function(t){t.render(e.textWrapper)})),e.icon&&(n='<i class="'.concat(Le.encodeHtml(e.icon),'"></i>')+(n||""));var r=t.querySelector(".b-grid-header-text-content");r&&(r.innerHTML=n||"")}}},{key:"columns",get:function(){var e=this,n=B(t,"columns",this,1);return e.columnsDetacher||(e.columnsDetacher=n.ion({change:function(){e.initDepths()},thisObj:e}),e.initDepths()),n},set:function(e){V(t,"columns",e,this,1,1)}},{key:"initDepths",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.columns.topColumns,t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=this,r=0;null!=t&&t.meta&&t.meta.depth++;var a,o=D(e);try{for(o.s();!(a=o.n()).done;){var l=a.value,s=l.meta;s.depth=0,l.children&&(n.initDepths(l.children.filter(n.columns.chainedFilterFn),l),s.depth&&t&&(t.meta.depth+=s.depth)),s.depth>r&&(r=s.depth)}}catch(e){o.e(e)}finally{o.f()}return t||(n.maxDepth=r),r}},{key:"getHeader",value:function(e){return this.getBarCellElement(e)}},{key:"contentElement",get:function(){return this.element.firstElementChild}},{key:"refreshContent",value:function(){var e=this;fa.sync({domConfig:{children:e.columns.topColumns.map((function(t){return e.getColumnConfig(t)})),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}},{key:"onInternalPaint",value:function(e){e.firstPaint&&this.refreshContent()}}])}(Mg);S(Ig,"$name","Header"),S(Ig,"type","gridheader"),Ig.initClass(),Ig._$name="Header";var Lg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"subGrid",get:function(){return this._subGrid},set:function(e){this._subGrid=this.owner=e}},{key:"refreshContent",value:function(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}},{key:"onInternalPaint",value:function(e){e.firstPaint&&this.refreshContent()}},{key:"template",value:function(){var e=this.subGrid.region;return Kf.tpl(Fg||(Fg=N(['\n            <div class="b-grid-footer-scroller b-grid-footer-scroller-','" role="presentation">\n                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-','" data-region="','" role="presentation"></div>\n            </div>\n        '])),e,e,e)}},{key:"overflowElement",get:function(){return this.footersElement}},{key:"getFooter",value:function(e){return this.getBarCellElement(e)}},{key:"contentTemplate",value:function(){return this.columns.visibleColumns.map((function(e){return Kf.tpl(Ag||(Ag=N(['\n                <div\n                    class="b-grid-footer '," ",'"\n                    data-column="','" data-column-id="','" data-all-index="','"\n                    role="gridcell">\n                    ',"\n                </div>"])),e.align?"b-grid-footer-align-".concat(e.align):"",e.cls||"",e.field||"",e.id,e.allIndex,e.footerText||"")})).join("")}},{key:"fixFooterWidths",value:function(){this.fixCellWidths()}}])}(Mg);S(Lg,"$name","Footer"),S(Lg,"type","gridfooter"),Lg.initClass(),Lg._$name="Footer";var Og={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},Pg=["pageX","pageY","clientX","clientY","screenX","screenY"],_g={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1,Backspace:1,Delete:1};function Hg(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];null==e||e.classList.toggle("b-hover",t)}function Bg(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2];t&&e&&Hg(t.getCell(e),n)}var Vg=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"initInternalEvents",value:function(){for(var e=Object.keys(Og),t=e.length,n={element:this.bodyElement,thisObj:this},r=0;r<t;r++){var i=e[r];n[i]={handler:"handleEvent"},i.startsWith("touch")&&(n[i].passive=!1)}fr.on(n),fr.on({mouseenter:"onGridBodyMouseEnterOrLeave",mouseleave:"onGridBodyMouseEnterOrLeave",focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}},{key:"getCellDataFromEvent",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=e.target,a=r.classList.contains("b-grid-row"),o=r.closest(".b-grid-cell");if(o||!t||a||r.classList.contains("b-grid-subgrid")){if(a){var l;o=null===(l=li.childFromPoint(r,e.offsetX,e.offsetY-r.offsetHeight/2))||void 0===l?void 0:l.closest(".b-grid-cell")}}else{var s,u,c=n.columns,d=n.bodyContainer.getBoundingClientRect(),h=d.top,f=d.left,v=d.right,g=d.bottom,m=e.x,p=e.y;if(m>=f&&m<=v?p=s=Math.ceil(n["".concat(p<h?"first":"last","FullyVisibleRow")].element.getBoundingClientRect().y):p>=h&&p<=g&&(m=s=Math.ceil(c.visibleColumns[m<f?0:c.visibleColumns.length-1].element.getBoundingClientRect().x)),s!==i)o=null===(u=li.childFromPoint(r,e.offsetX,e.offsetY))||void 0===u?void 0:u.closest(".b-grid-cell")}if(o)return n.getCellDataFromElement(o)}},{key:"getCellDataFromElement",value:function(e){if(e=e.closest(".b-grid-cell")){var t=wa.get(e),n=t.id,r=t.columnId,i=this.store.getById(n),a=this.columns.getById(r);return i?{cellElement:e,cellData:t,columnId:r,id:n,record:i,column:a,cellSelector:{id:n,columnId:r}}:null}}},{key:"getHeaderDataFromEvent",value:function(e){var t=e.target.closest(".b-grid-header");if(t){var n=Be.assign({},t.dataset),r=n.columnId,i=this.columns.getById(r);return i?{headerElement:t,headerData:n,columnId:r,column:i}:null}}},{key:"handleEvent",value:function(e){!this.disabled&&Og[e.type]&&"focus"!==e.pointerType&&this[Og[e.type]](e)}},{key:"onElementTouchStart",value:function(e){var t=this;li.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((function(){t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime))}},{key:"onElementTouchMove",value:function(e){var t=this,n=t.lastTouchTarget,r=e.changedTouches[0],i=r.pageX,a=r.pageY,o=e.target.getRootNode().elementFromPoint(i,a);if(t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null),o!==n&&n){var l=new MouseEvent("mouseout",Be.copyProperties({relatedTarget:o,pointerType:"touch",bubbles:!0},r,Pg));l.preventDefault=function(){return e.preventDefault()},null==o||o.dispatchEvent(l);var s=new MouseEvent("mouseover",Be.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},r,Pg));s.preventDefault=function(){return e.preventDefault()},null==n||n.dispatchEvent(s)}t.lastTouchTarget=o}},{key:"onElementTouchEnd",value:function(e){var t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}},{key:"onElementLongPress",value:function(e){}},{key:"triggerCellMouseEvent",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.getCellDataFromEvent(t),r=arguments.length>3&&arguments[3]!==i?arguments[3]:"cell",a=this;if(n){var o,l=a.columns.getById(n.columnId),s={grid:a,record:n.record,column:l,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t};if(a.trigger(r+Le.capitalize(e),s),"cell"===r&&"click"===e)null===(o=l.onCellClick)||void 0===o||o.call(l,s)}}},{key:"onElementMouseDown",value:function(e){var t=this,n=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e,n),n&&!e.defaultPrevented&&t.onFocusGesture(e))}},{key:"isScrollbarOrRowBorderOrSplitterClick",value:function(e){var t=e.target,n=e.x,r=e.y;return!(!t.closest(".b-grid-splitter")&&!t.matches(".b-grid-row, .b-virtual-width"))||(t.matches(".b-vertical-overflow")?n>t.getBoundingClientRect().right-li.scrollBarWidth:t.matches(".b-horizontal-overflow")?r>t.getBoundingClientRect().bottom-li.scrollBarWidth-1:void 0)}},{key:"onElementMouseMove",value:function(e){this.mouseMoveEvent=e}},{key:"onElementMouseUp",value:function(e){}},{key:"onElementPointerDown",value:function(e){}},{key:"onElementPointerUp",value:function(e){}},{key:"onHandleElementClick",value:function(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}},{key:"onElementClick",value:function(e){var t=this,n=t.getCellDataFromEvent(e);if(n)return t.triggerCellMouseEvent("click",e,n);var r,i=null===(r=e.target)||void 0===r?void 0:r.closest(".b-grid-header"),a=i&&t.columns.getById(i.dataset.columnId);return a?t.trigger("headerClick",{domEvent:e,column:a}):void 0}},{key:"onFocusGesture",value:function(e){var t,n,i=this,a=i.navigationEvent,o=e.target,l=2===e.button,s=!l&&(null===(t=i.features.tree)||void 0===t||null===(t=t.treeColumn)||void 0===t||null===(n=t.isTreeExpanderIcon)||void 0===n?void 0:n.call(t,o)),u=!document.hasFocus()&&ne.isMac&&l;if(s||u)e.preventDefault();else{var c;i.navigationEvent=e;var d=new cg(o);if(l||null!==(c=i.focusedCell)&&void 0!==c&&c.equals(d)){var h={scroll:!1};r.TouchEvent&&e instanceof MouseEvent&&a instanceof TouchEvent&&o===a.target&&(h.doSelect=!1),i.focusCell(d,h)}}}},{key:"onElementDblClick",value:function(e){var t=e.target;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){var n=t.closest(".b-grid-header"),r=this.columns.getById(n.dataset.columnId);r.resizeToFitContent()&&this.trigger("columnResize",{column:r,domEvent:e})}}},{key:"shouldHover",value:function(e){return(Qi.dragging||"number"!=typeof e.buttons||0===e.buttons)&&"touch"!==e.pointerType}},{key:"onElementMouseOver",value:function(e){if(!this.scrolling){var t,n=this,r=n.hoveredCell,i=this.shouldHover(e),a=e.target.closest(".b-grid-cell");if(n._lastMouseOverOutEvent=e,!a&&e.target.classList.contains("b-grid-row"))a=null===(t=li.childFromPoint(e.target,e.offsetX,e.offsetY-2))||void 0===t?void 0:t.closest(".b-grid-cell");a&&(i&&(n.hoveredCell=a),r!==n.hoveredCell&&n.triggerCellMouseEvent("mouseOver",e)),n.trigger("mouseOver",{event:e})}}},{key:"onElementMouseOut",value:function(e){var t,n=this,r=e.target,i=e.relatedTarget,a=("number"!=typeof e.buttons||0===e.buttons)&&"touch"!==e.pointerType;n._lastMouseOverOutEvent=e,a&&i&&r.matches(".b-grid-cell")&&!r.contains(i)?i.matches(".b-grid-row")||(n.hoveredCell=i.closest(".b-grid-cell")):null!=i&&i.matches(".b-grid-row,.b-grid-cell")||null!==(t=n.hoveredCell)&&void 0!==t&&t.contains(i)||(n.hoveredCell=null),n.scrolling||((null==i?void 0:i.closest(".b-grid-cell"))!==(null==r?void 0:r.closest(".b-grid-cell"))&&null!=r&&r.closest(".b-grid-cell")&&n.triggerCellMouseEvent("mouseOut",e),n.trigger("mouseOut",{event:e}))}},{key:"updateHoveredCell",value:function(e,t){var n,r,i,a,o=this,l=o.selectionMode,s=l.rowNumber&&(null===(n=o.columns.find((function(e){return"rownumber"==e.type})))||void 0===n?void 0:n.id),u=l.checkbox&&(null===(r=o.checkboxSelectionColumn)||void 0===r?void 0:r.id);if(t){Hg(t,!1);var c,d=wa.get(t);if((i=d.row)&&!i.isDestroyed&&(Bg(s,i,!1),Bg(u,i,!1)),null!=d&&d.columnId)Hg(null===(c=o.columns.getById(d.columnId))||void 0===c?void 0:c.element,!1)}if(o._hoveredRow&&!o._hoveredRow.isDestroyed&&o.toggleRowHover(o._hoveredRow,!1),o._hoveredRow=null,e&&!o.scrolling){var h=wa.get(e);if(a=h.row)if(l.cell&&h.columnId!==s&&h.columnId!==u){var f=o.columns.getById(h.columnId);Hg(e),Bg(u,a),Bg(s,a),null!=f&&f.element&&!1!==f.headerHoverable&&Hg(f.element)}else o._hoveredRow=a,o.toggleRowHover(a,!0);else o.hoveredCell=null}if(a!==i){var v=o._lastMouseOverOutEvent;if(i&&!i.isDestroyed&&o.trigger("rowMouseLeave",{event:v,record:i.cellContext.record,cellElement:t}),a){var g=o.getCellDataFromEvent(v);o.triggerCellMouseEvent("mouseEnter",v,g,"row")}}}},{key:"toggleRowHover",value:function(e,t){this.hoverCls&&e.toggleCls(this.hoverCls,t)}},{key:"keyMapOnKeyDown",value:function(e){var n=this,r=e.browserEvent.target;if(n.element.contains(r)){var i,a=e.key.startsWith("Arrow"),o="Escape"===e.key||"F2"===e.key||"Tab"===e.key||"Enter"===e.key;if(n.onElementKeyDown(e),(_g[e.key]&&li.isEditable(r,!0)||null!==(i=n.focusedCell)&&void 0!==i&&i.containsFocus&&!o&&!a&&!n.matchKeyMapEntry(e))&&!r.getAttribute("readOnly")&&n.matchKeyMapEntry(e))return a||"Backspace"!==!e.key||e.preventDefault(),e.handled=!0,e.stopPropagation(),!1;B(t,"keyMapOnKeyDown",this,3)([e])}}},{key:"onElementKeyDown",value:function(e){if(!e.handled&&this.element.contains(e.target)){var t=this,n=t.focusedCell;if(null!=n&&n.isCell&&!n.isActionable){var r,i,a=e.target.closest(".b-grid-cell")?t.getCellDataFromEvent(e):t.getCellDataFromElement(n.cell);null==a||null===(r=(i=a.column).onCellKeyDown)||void 0===r||r.call(i,F(F({},a),{},{event:e}))}}}},{key:"undoRedoKeyPress",value:function(e){var t,n=this.store.stm;return!(!n||!this.enableUndoRedoKeys||null!==(t=this.features.cellEdit)&&void 0!==t&&t.isEditing)&&(n.onUndoKeyPress(e),!0)}},{key:"clickCellByKey",value:function(e){var t=this,n=t.focusedCell,r=null==n?void 0:n.cell,i=t.columns.getById(r.dataset.columnId);return!(null==n||!n.isCell||n.isActionable||!i.onCellClick)&&(i.onCellClick({grid:t,column:i,record:t.store.getById(n.id),cellElement:r,target:e.target,event:e}),!0)}},{key:"onElementKeyPress",value:function(e){}},{key:"onElementKeyUp",value:function(e){}},{key:"onElementContextMenu",value:function(e){var t=this,n=t.getCellDataFromEvent(e);n&&(t.triggerCellMouseEvent("contextMenu",e,n),li.isTouchEvent&&t.onFocusGesture(e))}},{key:"onGridBodyMouseEnterOrLeave",value:function(e){var t=e.target.classList.contains("b-grid-cell")&&this.getCellDataFromEvent(e);t&&this.triggerCellMouseEvent(e.type,e,t)}},{key:"onInternalResize",value:function(e,n,i,a,o){var l=this;l._devicePixelRatio&&l._devicePixelRatio!==r.devicePixelRatio&&li.resetScrollBarWidth(),l._devicePixelRatio=r.devicePixelRatio,l._bodyRectangle=pt.client(l.bodyContainer),B(t,"onInternalResize",this,3)(arguments),i!==o&&(l._bodyHeight=l.bodyContainer.offsetHeight,l.isPainted&&l.rowManager.initWithHeight(l._bodyHeight)),l.refreshVirtualScrollbars(),n!==a&&l.setTimeout((function(){l.isDestroyed||l.updateResponsive(n,a)}),0)}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,hoverCls:"b-hover",keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}}])}(e||Mn),S(t,"$name","GridElementEvents"),t},Ng=new a,zg=new a,jg="Grid",Wg={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},$g=/\$\d+$/,Ug=function(){return w((function e(){m(this,e)}),null,[{key:"registerFeature",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:null,r=arguments.length>3&&arguments[3]!==i?arguments[3]:null;r=(r=Le.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace($g,""),Array.isArray(n)||(n=[n||jg]),n.forEach((function(n){var i=Wg[n]||n,o=Ng.get(i)||new a,l=zg.get(i)||new a;o.set(r,e),l.set(e,t),Ng.set(i,o),zg.set(i,l)}))}},{key:"getTypeNameFeatures",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:jg,t=Wg[e]||e,n=Ng.get(t),r={};return n&&n.forEach((function(e,t){return r[t]=e})),r}},{key:"getTypeNameDefaultFeatures",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:jg,t=Wg[e]||e,n=Ng.get(t),r=zg.get(t),a={};return n&&r&&n.forEach((function(e,t){r.get(e)&&(a[t]=e)})),a}},{key:"getInstanceFeatures",value:function(e){var t=this;return e.$meta.names.reduce((function(e,n){return Object.assign(e,t.getTypeNameFeatures(n))}),{})}},{key:"getInstanceDefaultFeatures",value:function(e){var t=this;return e.$meta.names.reduce((function(e,n){return Object.entries(t.getTypeNameFeatures(n)).reduce((function(e,r){var i=_(r,2),a=i[0],o=i[1];return t.isDefaultFeatureForTypeName(o,n)?e[a]=o:delete e[a],e}),e)}),{})}},{key:"isDefaultFeatureForTypeName",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:jg,n=Wg[t]||t,r=zg.get(n);return r&&r.get(e)||!1}},{key:"isDefaultFeatureForInstance",value:function(e,t){for(var n=t.$meta.names.slice().reverse(),r=null,i=0,a=n.length;i<a&&null===r;++i){var o=zg.get(n[i]);o&&o.has(e)&&(r=o.get(e))}return r||!1}},{key:"reset",value:function(){Ng.clear(),zg.clear()}}])}(),Gg={string:1,object:1,function:1},Yg=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"features",get:function(){return this._features},set:function(e){var t=this,n=Ug.getInstanceDefaultFeatures(this);e=t._features=Be.merge({},this.constructor.configurable.features,Be.isObject(e)?e:{}),n&&Object.keys(n).forEach((function(t){t in e||(e[t]=!0)}));for(var i=Ug.getInstanceFeatures(this),a=0,o=Object.keys(e);a<o.length;a++){var l=o[a],s=e[l];if(s){var u=!r.__bryntum_code_editor_changed;if(Le.uncapitalize(l)!==l){var c="Invalid feature name '".concat(l,"', must start with a lowercase letter");if(u)throw new Error(c);console.error(c),t._errorDuringConfiguration=c}var d=i[l];if(!d){var h="Feature '".concat(l,"' not available, make sure you have imported it");if(u)throw new Error(h);return console.error(h),void(t._errorDuringConfiguration=h)}Reflect.defineProperty(e,l,t.createFeatureInitializer(e,l,d,s))}}}},{key:"createFeatureInitializer",value:function(e,t,n,r){var i=[this],a=n.prototype.construct;return!0===r&&(r={}),Gg[W(r)]&&(i[1]=r),{configurable:!0,get:function(){return delete e[t],n.prototype.construct=function(){e[t]=this;for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];a.apply(this,i),n.prototype.construct=a},b(n,i)}}}},{key:"hasFeature",value:function(e){if(this.features){var t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}},{key:"hasActiveFeature",value:function(e){var t;return Boolean(null===(t=this.features)||void 0===t||null===(t=t[e])||void 0===t?void 0:t.enabled)}},{key:"getConfigValue",value:function(e,n){if("features"===e){var r={};for(var i in this.features){var a,o,l=null===(a=this.features[i])||void 0===a||null===(o=a.getCurrentConfig)||void 0===o?void 0:o.call(a,n);l?Be.isEmpty(l)?Ug.isDefaultFeatureForInstance(this.features[i].constructor,this)||(r[i]=!0):r[i]=l:r[i]=!1}return r}return B(t,"getConfigValue",this,3)([e,n])}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","GridFeatures"),t},qg=Object.freeze({}),Kg=function(e){return this.focusableFinderCell.contains(e)?li.isFocusable(e)&&!e.disabled?li.NodeFilter.FILTER_ACCEPT:li.NodeFilter.FILTER_SKIP:li.NodeFilter.FILTER_REJECT},Xg=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getClosestBiggerLevel",value:function(e){var t=this,n=Object.keys(Be.assign({},t.responsiveLevels)),r=null,i=99995,a=null;return n.forEach((function(n){var o=t.responsiveLevels[n];if(["number","string"].includes(W(o))||(o=o.levelWidth),"*"===o)a=n;else if(e<o){var l=o-e;l<i&&(i=l,r=n)}})),r||a}},{key:"responsiveLevel",get:function(){return this.getClosestBiggerLevel(this.width)}},{key:"updateResponsive",value:function(e,t){var n=this,r=n.getClosestBiggerLevel(t),i=n.getClosestBiggerLevel(e);if(0===t||r!==i){var a=n.responsiveLevels[i];["number","string"].includes(W(a))||n.applyState(a),n.columns.forEach((function(e){var t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),n.element.classList.remove("b-responsive-"+r),n.element.classList.add("b-responsive-"+i),n.trigger("responsive",{level:i,width:e,oldLevel:r,oldWidth:t})}}},{key:"widgetClass",get:function(){}}],[{key:"defaultConfig",get:function(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}}])}(e||Mn),S(t,"$name","GridResponsive"),t},Zg=function(e){return!e.value},Jg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){"checked"in e&&((e=Be.assign({},e)).value=e.checked,delete e.checked),B(t,"construct",this,3)([e]),this.syncHasText()}},{key:"updateClearable",value:function(){}},{key:"updateEditable",value:function(){}},{key:"textLabelCls",get:function(){return"b-checkbox-label"}},{key:"innerElements",get:function(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:"".concat(this.id,"-input"),reference:"textLabel",html:this.text||"","aria-hidden":!this.text}]}},{key:"inputElement",get:function(){var e=B(t,"inputElement",this,1);return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}},{key:"checked",get:function(){return this.value},set:function(e){this.value=e}},{key:"syncHasText",value:function(){var e;this.element.classList[this.text?"add":"remove"]("b-text"),null===(e=this.textLabel)||void 0===e||e.setAttribute("aria-hidden",!this.text)}},{key:"updateText",value:function(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}},{key:"afterSyncChildConfigs",value:function(e){B(t,"afterSyncChildConfigs",this,3)([e]);var n=this.autoCollapse;n&&(n=!0===n?Zg:n,e.collapsed=n(this))}},{key:"assignFieldValue",value:function(e,t,n){this.value=n===this.checkedValue||n!==this.uncheckedValue&&null}},{key:"fetchInputValue",value:function(){this.readOnly||(this.value=this.input.checked)}},{key:"gatherValue",value:function(e){var t,n=this,r=n.value?n.checkedValue:n.uncheckedValue,a=r!==i,o=n.valueName;a&&(e[o]=r),n.gatherValues(e,a),!0===r&&(null===(t=e[o])||void 0===t?void 0:t.value)===r&&delete e[o].value}},{key:"changeValue",value:function(e){return"false"!==e&&Boolean(e)}},{key:"updateValue",value:function(e){var t,n=this,r=n.input.checked!==e;n.input.checked=e,null===(t=n.container)||void 0===t||t.syncChildConfigs(),!r||n.inputting||n.isConfiguring||(n.uncheckToggleGroupMembers(),n.triggerChange(!1,null))}},{key:"inputValueAttr",get:function(){return"checked"}},{key:"updateColor",value:function(e,t){var n=this.element.classList;t&&n.remove(t),e&&n.add(e)}},{key:"getToggleGroupRootElement",value:function(){var e,t=this.toggleGroupRootElement;return t&&"string"==typeof t&&this.element&&(e=this.element.closest(t)),e||this.rootElement}},{key:"getToggleGroupMembers",value:function(){var e=this,t=e.toggleGroup,n=e.input,r=e.type,i=[];return t&&li.forEachSelector(e.getToggleGroupRootElement(),"input[type=".concat(r,"][data-group=").concat(t,"]"),(function(e){if(e!==n){var t=Lo.fromElement(e);t&&i.push(t)}})),i}},{key:"uncheckToggleGroupMembers",value:function(e){var t=this;this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((function(e){e._propagatingUserActionFrom=t,e.checked=!1,e._propagatingUserActionFrom=null}))}},{key:"check",value:function(){this.checked=!0}},{key:"uncheck",value:function(){this.checked=!1}},{key:"toggle",value:function(){this.checked=!this.checked}},{key:"internalOnClick",value:function(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}},{key:"internalOnChange",value:function(e){var t=this;t.readOnly&&t.value!==t.input.checked?t.input.checked=t.value:(t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0,e),t.inputting=!1))}},{key:"updateInputReadOnly",value:function(e){}},{key:"triggerChange",value:function(e,t){var n=this,r=n.input.checked,i={checked:r,value:r,oldValue:!r,userAction:e,valid:!0,event:t};if(n._propagatingUserActionFrom&&(i.propagatingUserActionFrom=n._propagatingUserActionFrom),!(!r&&e&&n.toggleGroup&&n.getToggleGroupMembers().filter((function(e){return e.isVisible&&!e.disabled})).length||!1===n.trigger("beforeChange",i)))return n.triggerFieldChange(i,!1),e&&n.uncheckToggleGroupMembers(e),n.trigger("action",i),n.trigger("change",i),!0;n.input.checked=n._value=!r}},{key:"configureOverflowTwin",value:function(e){var n=this,r=B(t,"configureOverflowTwin",this,3)([e]);return r.type=Lo.resolveType("menuitem"),r.text||(r.text=n.label||n.text||n.tooltipText),r}}],[{key:"configurable",get:function(){return{inputType:"checkbox",autoCollapse:null,toggleGroupRootElement:null,containerDefaults:{syncableConfigs:{disabled:function(e){return e.disabled||!e.value}},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:!1,toggleGroup:null,localizableProperties:["label","text"],twinSyncConfigs:{value:"checked"}}}}])}(Uf);S(Jg,"$name","Checkbox"),S(Jg,"type","checkbox"),S(Jg,"alias","check"),Jg.initClass(),Jg._$name="Checkbox";var Qg=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)(arguments);var n=this,r=n.grid;n.internalCellCls="b-row-number-cell",n.externalHeaderRenderer=n.headerRenderer,n.setData("headerRenderer",n.internalHeaderRenderer),r&&(r.ion({bindStore:"bindStore",thisObj:n}),n.bindStore({store:r.store,initial:!0}),r.store.count&&!r.rendered&&r.ion({paint:"resizeToFitContent",thisObj:n,once:!0}))}},{key:"groupHeaderReserved",get:function(){return!0}},{key:"bindStore",value:function(e){var t=e.store,n=e.initial,r=this;r.detachListeners("grid"),t.ion(S(S({name:"grid"},"change".concat(r.grid.asyncEventSuffix),"onStoreChange"),"thisObj",r)),n||r.resizeToFitContent()||r.measureOnRender()}},{key:"onStoreChange",value:function(e){var t=e.action,n=e.isMove;if("dataset"===t||"add"===t||"remove"===t||"removeall"===t){if("remove"===t&&n)return;var r=this.resizeToFitContent();"dataset"===t&&!r&&this.grid.store.count&&this.measureOnRender()}}},{key:"measureOnRender",value:function(){this.grid.rowManager.ion({renderDone:function(){this.resizeToFitContent()},once:!0,thisObj:this})}},{key:"defaultRenderer",value:function(e){var t,n,r,i=e.record,a=e.grid,o=i.isSpecialRow?"":a.store.indexOf(i,!0)+1;null!==(t=a.splitFrom)&&void 0!==t&&t.isLockedRows&&(o+=null!==(n=null===(r=a.splitFrom.features.lockRows)||void 0===r?void 0:r.numberOfLockedRows)&&void 0!==n?n:0);return o}},{key:"resizeToFitContent",value:function(){var e,t=this,n=null===(e=t.grid.features.lockRows)||void 0===e?void 0:e.subViews,r=(null==n?void 0:n[1])===t.grid?n[0]:t.grid,i=r.element,a=r.store.count;if(a&&!t.hidden){var o=i.querySelector('.b-grid-cell[data-column-id="'.concat(t.id,'"]'));if(o){var l=o.isConnected?parseInt(li.getStyleValue(o,"padding-left")):t._cachedCellPadding||0,s=li.measureText(a,o);return t.width=Math.max(t.minWidth,s+2*l),t._cachedCellPadding=l,!0}}return!1}},{key:"flex",set:function(e){}},{key:"internalHeaderRenderer",value:function(e){var t,n=e.headerElement,r=e.column;return n.classList.add("b-rownumber-header"),(null===(t=r.externalHeaderRenderer)||void 0===t?void 0:t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))||r.headerText}}],[{key:"defaults",get:function(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,mergeable:!1,minWidth:50,width:50,align:"right",text:"#",ariaLabel:"L{RowNumberColumn.rowNumber}",editor:!1,readOnly:!0}}}])}(yg);S(Qg,"$name","RowNumberColumn"),S(Qg,"type","rownumber"),bg.registerColumnType(Qg,!0),Qg._$name="RowNumberColumn";var em={string:1,number:1},tm={dataset:1,batch:1},nm=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){this._selectedCells=[],this._selectedRows=[],B(t,"construct",this,3)([e]),null!=e&&e.selectedRecords&&(this.selectedRecords=e.selectedRecords)}},{key:"getDefaultGridSelection",value:function(e){return"GridSelection"===e.$name?e.configurable.selectionMode:e.superclass?this.getDefaultGridSelection(e.superclass):void 0}},{key:"changeSelectionMode",value:function(e){var t=this;return t.selectionMode?(Be.assign(t.selectionMode,e),t.selectionMode):(t.$defaultGridSelection=t.getDefaultGridSelection(t.constructor),new Proxy(e,{set:function(e,n,r){var i=Be.assign({},e);return e[n]=r,t.updateSelectionMode(e,i),!0}}))}},{key:"updateSelectionMode",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.$defaultGridSelection,r=this,a=r.columns,o=r.checkboxSelectionColumn,l={},s=r.features.rowReorder;for(var u in e)e[u]!=n[u]&&(l[u]=e[u]);if(l.column&&(e.cell=!0,e.multiSelect=!0),l.cell&&(e.checkboxOnly=!1),!1===l.cell&&(e.column=!1),l.alwaysMultiSelect&&(e.multiSelect=!0,e.deselectOnClick=!0),l.checkboxOnly&&(e.checkbox||(e.checkbox=!0),e.cell=!1),!1===l.checkbox&&(l.checkboxOnly=!1,l.showCheckAll=!1),l.showCheckAll&&(e.checkbox=e.checkbox||!0,e.multiSelect=!0),(l.includeChildren||l.includeParents||l.showCheckAllInGroupRows)&&(e.multiSelect=!0,r.features.group&&(e.includeParents=e.showCheckAllInGroupRows)),e.checkbox&&null!==(t=r.features.group)&&void 0!==t&&t.enabled&&"boolean"==typeof l.showCheckAllInGroupRows&&r.renderRows(),!1===l.multiSelect&&(e.column=e.showCheckAll=e.dragSelect=e.includeChildren=e.includeParents=e.alwaysMultiSelect=e.showCheckAllInGroupRows=!1),!1===l.deselectOnClick&&(e.alwaysMultiSelect=!1),l.dragSelect&&(null!=s&&s.enabled&&!0!==s.gripOnly&&(s.showGrip=s.gripOnly=!0),e.multiSelect=!0,r._selectionListenersDetachers={}),!1===l.dragSelect&&r._selectionListenersDetachers&&r.removeDragListeners(),r.isConfiguring||!n||l.cell===i&&l.deselectFilteredOutRecords===i&&l.multiSelect===i||r.deselectAll(),l.rowNumber){if(!a.findRecord("type","rownumber")){var c=r.isGanttBase?{type:"sequence",text:""}:{type:"rownumber"};a.insert(0,F(F({},c),"object"==W(e.rowNumber)?e.rowNumber:{})),r._selectionAddedRowNumberColumn=!0}}else!1===l.rowNumber&&r._selectionAddedRowNumberColumn&&(a.remove(a.findRecord("type","rownumber")),delete r._selectionAddedRowNumberColumn);(e.checkbox!==(null==n?void 0:n.checkbox)||e.checkbox&&e.showCheckAll!==(null==n?void 0:n.showCheckAll))&&(r.isConfiguring?r.shouldInitCheckboxSelection=!0:(n&&r.deselectAll(),r.initCheckboxSelection())),n&&e.checkbox&&n.checkbox&&e.checkboxIndex!==n.checkboxIndex&&o&&o.parent.insertChild(o,a.getAt(r.checkboxSelectionColumnInsertIndex)),r.trigger("selectionModeChange",Be.clone(e)),r.afterSelectionModeChange(e)}},{key:"afterConfigure",value:function(){var e=this;e.shouldInitCheckboxSelection&&(e.shouldInitCheckboxSelection=!1,e.initCheckboxSelection()),e.scrollManager.ion({scroll:function(t){var n=t.event;0!==t.deltaY&&e.onSelectionDrag(n)}}),B(t,"afterConfigure",this,3)([])}},{key:"initCheckboxSelection",value:function(){var e=this,t=e.selectionMode,n=e.columns,r=e.checkboxSelectionColumn,i=t.checkbox;if(r&&(e.checkboxSelectionColumn=null,n.remove(r),r.destroy()),i){var a,o,l=bg.getColumnClass("check"),s=!0===i?null:i;if(!l)throw new Error("CheckColumn must be imported for checkbox selection mode to work");var u=e.checkboxSelectionColumn=new l(Be.assign({id:"".concat(e.id,"-selection-column"),width:null!==(a=e.features.rowReorder)&&void 0!==a&&a.showGrip?"5em":"4em",field:null,sortable:!1,filterable:!1,groupable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:null===(o=e.items)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.region,showCheckAll:t.showCheckAll,draggable:!1,resizable:!1,ariaLabel:e.L("L{Checkbox.toggleSelection}"),widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},s),n,{isSelectionColumn:!0});u.meta.depth=0,u._grid=e;var c=u.renderer;u.setData("renderer",(function(t){t.value=e.isSelected(t.record),c.call(u,t)})),u.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e}),n.insert(e.checkboxSelectionColumnInsertIndex,u),n.acceptChanges()}}},{key:"checkboxSelectionColumnInsertIndex",get:function(){var e=this.columns,t=this.selectionMode.checkboxIndex;return t?"string"==typeof t&&(t=e.indexOf(e.getById(t))):t=e.indexOf(e.findRecord("type","rownumber"))+1,t}},{key:"beforeColumnsChange",value:function(){0===this.columns.count&&this.deselectAll(!1,!0)}},{key:"afterColumnsChange",value:function(e){var t=e.type,n=e.action,r=e.changes,i=e.columns,a=e.column,o=this._selectedCells;if(null!=o&&o.length&&(!i&&a&&(i=[a]),"move"===t||null!=r&&r.hidden||null!=r&&r.region||"add"===n||"remove"===n)){var l,s,u=o.map((function(e){return{id:e.id,columnId:e._column.id}}));("remove"===n||null!=r&&null!==(l=r.hidden)&&void 0!==l&&l.value)&&null!==(s=i)&&void 0!==s&&s.length&&(u=u.filter((function(e){return!i.some((function(t){return e.columnId===t.id}))}))),this.deselectAll(!1,!0),this.selectCells({cells:u,scrollIntoView:!1})}}},{key:"afterSelectionChange",value:function(){}},{key:"afterSelectionModeChange",value:function(){}},{key:"changeSelectedRecordCollection",value:function(e){return null!=e&&e.isCollection?(e.owner||(e.owner=this),e):us.new(e,{owner:this})}},{key:"updateSelectedRecordCollection",value:function(e){e.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}},{key:"onSelectedRecordCollectionChange",value:function(e){var t=this,n=e.added,r=void 0===n?[]:n,i=e.removed;this.selectedRecordCollection._fromSelection!==this&&(r=r.filter((function(e){return t.isSelectable(e)})),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:r,deselectedRecords:i}))}},{key:"changeSelectedRecordCollectionSilent",value:function(e){this.selectedRecordCollection._fromSelection=this;var t=e(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,t}},{key:"bindStore",value:function(e){var n;this.detachListeners("selectionStoreFilter"),e.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null===(n=B(t,"bindStore",this,3))||void 0===n||n([e])}},{key:"unbindStore",value:function(e){this.detachListeners("selectionStoreFilter"),B(t,"unbindStore",this,3)([e])}},{key:"onStoreFilter",value:function(e){var t=e.source,n=this,r=n.selectedRows.filter((function(e){return!(t.indexOf(e,!1,!0)>-1)})),i=n.prepareSelection(n.selectionMode.deselectFilteredOutRecords?r:[]);if(n.isCellSelectionMode){var a=n.prepareSelection(n._selectedCells.filter((function(e){return!t.records.includes(e.record)}))).deselectedCells;null!=a&&a.length&&(i.deselectedCells=(i.deselectedCells||[]).concat(a))}(i.deselectedCells.length||i.deselectedRecords.length)&&(n.performSelection(i,!1),n.updateCheckboxHeader())}},{key:"onStoreRecordIdChange",value:function(e){var n,r=e.record,i=e.oldValue;null===(n=B(t,"onStoreRecordIdChange",this,3))||void 0===n||n(arguments),this.selectedRecordCollection.get(i)===r&&this.selectedRecordCollection.rebuildIndices()}},{key:"onStoreRemove",value:function(e){var n,r=e.action,i=e.records,a=e.isCollapse;if(null===(n=B(t,"onStoreRemove",this,3))||void 0===n||n(arguments),!a&&"filter"!==r){var o=this,l=i.filter((function(e){return o.isSelected(e)})),s=o.prepareSelection(l);if(o.isCellSelectionMode){var u=o.prepareSelection(o.getSelectedCellsForRecords(i)).deselectedCells;null!=u&&u.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(u))}(l.length||s.deselectedCells.length)&&o.performSelection(s)}}},{key:"onStoreDataChange",value:function(e){var n,r,i=e.action,a=e.source,o=this,l=o.selectionMode;if(null===(n=B(t,"onStoreDataChange",this,3))||void 0===n||n(arguments),"pageLoad"===i)l.preserveSelectionOnPageChange||(r=o.prepareSelection(null,null,!0)),o.updateCheckboxHeader();else if(tm[i]){var s=[];if(!1===l.preserveSelectionOnDatasetChange)r=o.prepareSelection(null,null,!0);else{s.push.apply(s,z(o.changeSelectedRecordCollectionSilent((function(e){return e.match(a.storage)}))));var u,c=D(o._selectedCells);try{for(c.s();!(u=c.n()).done;){var d=u.value;a.getById(d.id)||s.push(d)}}catch(e){c.e(e)}finally{c.f()}r=o.prepareSelection(s)}}r&&(r.deselectAll||r.deselectedCells.length||r.deselectedRecords.length||r.selectedCells.length||r.selectedRecords.length)&&(o.performSelection(r,!1),o.updateCheckboxHeader())}},{key:"onStoreRemoveAll",value:function(){var e;null===(e=B(t,"onStoreRemoveAll",this,3))||void 0===e||e([]),this.performSelection(this.prepareSelection(null,null,!0),!1)}},{key:"onCheckChange",value:function(e){var t,n=e.checked,r=e.record,i=e.checkbox,a=this,o=a.selectionMode.multiSelect,l=!o&&n,s=l||n?null:[r],u=n?[r]:null;(a._isCheckboxSelecting=!0,r.isGroupHeader&&a.selectionMode.showCheckAllInGroupRows)&&(t=n?u:s).splice.apply(t,[0,1].concat(z(r.groupChildren)));n&&!Wn.shiftKeyDown&&(a._lastSelectionChecked=r),n&&o&&a._lastSelectionChecked&&Wn.shiftKeyDown?a.performSelection(a.internalSelectRange(a._lastSelectionChecked,r,!0)):!1===a.performSelection(a.prepareSelection(s,u,l,!0))&&(i.checked=!i.checked),a._isCheckboxSelecting=!1}},{key:"updateCheckboxHeader",value:function(){var e=this,t=e.selectionMode,n=e.checkboxSelectionColumn,r=e.store;if(t.checkbox&&n){var i;if(!e.hideHeaders&&!e._isCheckAllSelecting&&t.showCheckAll&&n.headerCheckbox){var a=e.isAllRecordsSelected();n.headerCheckbox.checked!==a&&(n.suspendEvents(),n.headerCheckbox.checked=a,n.resumeEvents())}if(t.showCheckAllInGroupRows&&null!==(i=r.groupRecords)&&void 0!==i&&i.count){var l=z(new o(e.selectedRecords.map((function(e){return e.instanceMeta(r).groupParent})))).filter((function(t){var n;return null==t||null===(n=t.groupChildren)||void 0===n?void 0:n.every((function(t){return e.isSelected(t)}))}));n.suspendEvents();var s,u=D(r.groupRecords);try{for(u.s();!(s=u.n()).done;){var c=s.value,d=e.getCell({record:c,column:n});d&&(d.widget.checked=l.includes(c))}}catch(e){u.e(e)}finally{u.f()}n.resumeEvents()}}}},{key:"isAllRecordsSelected",value:function(){var e=this;return this.store.count&&!this.store.some((function(t){return e.isSelectable(t)&&!e.isSelected(t)}))}},{key:"onCheckAllChange",value:function(e){var t=e.checked,n=this;n._isCheckboxSelecting=n._isCheckAllSelecting=!0,n[t?"selectAll":"deselectAll"](n.store.isPaged&&n.selectionMode.preserveSelectionOnPageChange),n._isCheckboxSelecting=n._isCheckAllSelecting=!1}},{key:"selectionDragMouseEventListenerElement",get:function(){return r}},{key:"onSelectionDrag",value:function(e){var t=this,n="scroll"===e.type,r=t._selectionStartCell,i=t.lastPointerMoveEvent;if((!n||t._isSelectionDragging)&&(Wn.isMouseDown()||t.onSelectionEnd(),r)){var a,o,l,s=t.items,u=t._lastSelectionDragRegion;if(n&&i){var c=document.elementFromPoint(i.clientX,i.clientY),d=null==c?void 0:c.closest(".b-grid-cell");d&&(o=t._lastSelectionDragRegion,l=t.normalizeCellContext({columnId:d.dataset.columnId,record:t.store.getById(d.parentElement.dataset.id)}))}else{var h,f;o=null===(h=a=t.getCellDataFromEvent(e,!0))||void 0===h?void 0:h.column.region,l=(null===(f=a)||void 0===f?void 0:f.cellSelector)&&t.normalizeCellContext(a.cellSelector),a&&(t.lastPointerMoveEvent=e)}if(l&&!l.equals(t._lastSelectionDragCell,!0)){if(t._isSelectionDragging||t.enableScrollingCloseToEdges(s),t._clearSelectionOnSelectionDrag&&!r.equals(l,!0)&&(t.deselectAll(),delete t._clearSelectionOnSelectionDrag),u&&o!==u){var v,g=t.subGrids[u],m=t.subGrids[o],p=g.scrollable,y=m.scrollable,k=s.indexOf(g)-s.indexOf(m)<0;if(y.x=k?0:y.maxX,k?p.x<p.maxX-1:p.x>1)return;var b=null===(v=t.scrollManager._activeScroll)||void 0===v?void 0:v.horizontal;b&&b.element!==y.element&&b.stopScroll(!0)}t._lastSelectionDragRegion=o,t._lastSelectionDragCell=l,t._isSelectionDragging=!0;var C=t._lastSelectionDragChange=t.internalSelectRange(r,l,t.isRowNumberSelecting(l)||t.isRowNumberSelecting(r));C.deselectedCells=C.deselectedCells.filter((function(e){return!t.isCellSelected(e)})),C.deselectedRecords=C.deselectedRecords.filter((function(e){return!t.isSelected(e)})),t.hoveredCell=null,t.refreshGridSelectionUI(C),t.trigger("dragSelecting",C)}}}},{key:"onSelectionEnd",value:function(){var e=this,t=e._lastSelectionDragChange;e._isSelectionDragging&&!e._selectionStartCell.equals(e._lastSelectionDragCell,!0)&&t&&e.performSelection(t,!1),e.disableScrollingCloseToEdges(e.items),e._isSelectionDragging=!1,e._lastSelectionDragChange=e._lastSelectionDragCell=e._lastSelectionDragRegion=null,e.removeDragListeners()}},{key:"removeDragListeners",value:function(){var e,t=this._selectionListenersDetachers;t&&(null===(e=t.selectiondrag)||void 0===e||e.call(t),delete this._selectionListenersDetachers.selectiondrag)}},{key:"onHandleElementClick",value:function(e){var n=this;n.selectionMode.rowNumber&&e.target.closest(".b-rownumber-header")?(e.handled=!0,n.store.count&&n.store.some((function(e){return!n.isSelected(e)}))?n.selectAll():n.deselectAll()):n.selectionMode.column&&e.target.matches(".b-grid-header-text-content,.b-grid-header-text")&&(e.handled=!0,n.selectColumn(e,e.ctrlKey)),B(t,"onHandleElementClick",this,3)([e])}},{key:"selectColumn",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.store,a=n.getHeaderDataFromEvent(e).columnId;if(0!==r.count){n._shiftSelectRange=null,e.shiftKey||(n._shiftSelectColumn=a);var o=e.shiftKey&&n._shiftSelectColumn||a,l=n.internalSelectRange(n.normalizeCellContext({id:r.first.id,columnId:o}),n.normalizeCellContext({id:r.last.id,columnId:a}));t&&!l.selectedCells.some((function(e){return!n.isCellSelected(e)}))&&(l.deselectedCells=l.selectedCells,l.selectedCells=[]),t||(l.deselectedCells=n._selectedCells),n.cleanSelectionChange(l),n.performSelection(l)}}},{key:"isSelected",value:function(e){var t,n,r=this;return this.selectionMode.showCheckAllInGroupRows&&null!==(t=e)&&void 0!==t&&t.isGroupHeader?e.groupChildren.every((function(e){return r.isSelected(e)})):(null!==(n=e)&&void 0!==n&&n.id&&(e=e.id),!!em[W(e)]&&this.selectedRows.some((function(t){return t.id===e})))}},{key:"isCellSelected",value:function(e,t){return e=this.normalizeCellContext(e),this.isCellSelectionMode&&this._selectedCells.some((function(t){return e.equals(t,!0)}))||t&&this.isSelected(e)}},{key:"isSelectable",value:function(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}},{key:"selectedRecord",get:function(){return this.selectedRecords[this.selectedRecords.length-1]||null},set:function(e){this.selectRow({record:e})}},{key:"selectedRecords",get:function(){return this.selectedRecordCollection.values},set:function(e){this.selectRows(e)}},{key:"selectedRows",get:function(){return z(this._selectedRows)},set:function(e){this.selectRows(e)}},{key:"spliceSelectedRecords",value:function(e,t,n){var r=this;if("number"==typeof t){var i=z(r.selectedRecords);i.splice.apply(i,[e,t].concat(z($e.asArray(n)))),r.performSelection(r.prepareSelection(null,i,!0,!0))}else r.performSelection(r.prepareSelection(t,n,!1,!0))}},{key:"selectRow",value:function(e){"number"!=typeof e&&"string"!=typeof e&&!e.isModel&&"record"in e||(e={records:[e]}),Be.assignIf(e,{scrollIntoView:!0}),this.selectRows(e)}},{key:"selectRows",value:function(e){(!e||Array.isArray(e)||e.isModel||"number"==typeof e||!("records"in e)&&!("record"in e))&&(e={records:$e.asArray(e)||[]});var t,n=this,r=n.store,i=[],a=e,o=a.records,l=void 0===o?e.record?[e.record]:[]:o,s=a.column,u=void 0===s?n.columns.visibleColumns[0]:s,c=a.scrollIntoView,d=a.addToSelection,h=void 0===d?arguments[1]:d,f=D(l);try{for(f.s();!(t=f.n()).done;){var v=t.value;(v=r.getById(v))&&i.push(v)}}catch(e){f.e(e)}finally{f.f()}if(h||(n._shiftSelectRange=null),n.performSelection(n.prepareSelection(null,i,!h,!0)),i.length&&c)return n.scrollRowIntoView(i[0].id,F(F({},c),{},{column:u}))}},{key:"selectAll",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this.store,n=(t.isGrouped?t.getAllDataRecords():t.records).filter((function(e){return!e.isSpecialRow}));this.performSelection(this.prepareSelection(null,n,!1,!0),!0,e)}},{key:"deselectAll",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this.store,r=e?(n.isGrouped?n.getAllDataRecords():n.records).filter((function(e){return!e.isSpecialRow})):null;this.performSelection(this.prepareSelection(r,null,!e),!0,t)}},{key:"deselectRow",value:function(e){this.deselectRows(e)}},{key:"deselectRows",value:function(e){var t=this.store,n=$e.asArray(e).map((function(e){return t.getById(e)})).filter((function(e){return e}));this.performSelection(this.prepareSelection(n))}},{key:"selectRange",value:function(e,t){var n=this,r=n.store,i=n.internalSelectRange(r.getById(e),r.getById(t),!0);n._shiftSelectRange=null,n.performSelection(i)}},{key:"selectedCell",get:function(){return this._selectedCells[this._selectedCells.length-1]},set:function(e){this.selectCells([e])}},{key:"selectedCells",get:function(){return z(this._selectedCells)},set:function(e){this.selectCells(e)}},{key:"selectedCellCSSSelector",get:function(){var e=this.selectedCell,t=e&&this.getRowById(e.id);return e&&t?"[data-index=".concat(t.dataIndex,"] [data-column-id=").concat(e.columnId,"]"):""}},{key:"selectCell",value:function(e){var t;return("id"in e||"row"in e||"record"in e||"rowIndex"in e)&&(e={cell:e},e=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},e)),null===(t=this.selectCells(e))||void 0===t?void 0:t[0]}},{key:"selectCells",value:function(e){Array.isArray(e)&&(e={cells:e});var t=this,n=e,r=n.cells,i=void 0===r?e.cell?[e.cell]:[]:r,a=n.scrollIntoView,o=void 0===a||a,l=n.addToSelection,s=void 0!==l&&l,u=n.silent,c=void 0!==u&&u,d=t.prepareSelection(null,i,!s);return s||(t._shiftSelectRange=null),t.performSelection(d,!0,c),o&&t.scrollRowIntoView(i[0].id,F(F({},o),{},{column:i[0].columnId})),t.isCellSelectionMode?d.selectedCells:d.selectedRecords}},{key:"deselectCell",value:function(e){var t;return null===(t=this.deselectCells([e]))||void 0===t?void 0:t[0]}},{key:"deselectCells",value:function(e){var t=this.prepareSelection(e);return this.performSelection(t),this.isCellSelectionMode?t.deselectedCells:t.deselectedRecords}},{key:"toggleSelection",value:function(e){var t=this,n=t._focusedCell,r=t.selectionMode,i=t.isRowNumberSelecting(n),a=t.isCellSelected(n,!0);if(!0===r.selectOnKeyboardNavigation||n.isActionable)return!1;t.performSelection(t.prepareSelection(a?n:null,a?null:n,!r.multiSelect,i)),e.preventDefault()}},{key:"selectCellRange",value:function(e,t){this.performSelection(this.internalSelectRange(e,t))}},{key:"getSelection",value:function(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}},{key:"cleanSelectionChange",value:function(e){var t,n,r=e.deselectedRecords,i=e.deselectedCells,a=e.selectedCells,o=e.deselectedCellRecords,l=null===(t=e.selectedRecords)||void 0===t?void 0:t.map((function(e){return e.id})),s=null===(n=e.selectedCellRecords)||void 0===n?void 0:n.map((function(e){return e.id}));return null!=r&&r.length&&null!=l&&l.length&&(e.deselectedRecords=r.filter((function(e){return!l.includes(e.id)}))),null!=i&&i.length&&null!=a&&a.length&&(e.deselectedCells=i.filter((function(e){return!a.some((function(t){return e.equals(t,!0)}))}))),o.length&&(s.length||null!=l&&l.length)&&(e.deselectedCellRecords=o.filter((function(e){return!s.includes(e.id)&&!l.includes(e.id)}))),e}},{key:"getSelectedCellsForRecords",value:function(e){return this._selectedCells.filter((function(t){return t.id&&e.some((function(e){return e.id===t.id}))}))}},{key:"delayUntilMouseUp",value:function(e){var t=fr.on({element:this.selectionDragMouseEventListenerElement,blur:function(n){return e(n,t)},mouseup:function(n){return e(n,t)},thisObj:this,once:!0})}},{key:"isRowSelectionMode",get:function(){return!this.isCellSelectionMode}},{key:"isCellSelectionMode",get:function(){return!0===this.selectionMode.cell}},{key:"isRowNumberSelecting",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.selectionMode.rowNumber&&!t.some((function(e){var t=e.column.type;return"rownumber"!==t&&"sequence"!==t}))}},{key:"selectionShouldIncludeChildren",value:function(e){var t,n=this.selectionMode,r=n.includeChildren,i=n.multiSelect;return("always"===r||!0===r&&this._isCheckboxSelecting)&&i&&!e.isLeaf&&(null===(t=e.allChildren)||void 0===t?void 0:t.length)}},{key:"extendSelectionLeft",value:function(){this.extendSelection("Left")}},{key:"extendSelectionRight",value:function(){this.extendSelection("Right")}},{key:"extendSelectionUp",value:function(){this.extendSelection("Up")}},{key:"extendSelectionDown",value:function(){this.extendSelection("Down")}},{key:"extendSelection",value:function(e){this._isKeyboardRangeSelecting=!0,this["navigate"+e](),this._isKeyboardRangeSelecting=!1}},{key:"onCellNavigate",value:function(e,t,n,i){var a,o=e.selectionMode,l=e._selectionListenersDetachers,s=o.multiSelect,u=o.alwaysMultiSelect,c=o.deselectOnClick,d=o.dragSelect,h=Wn.ctrlKeyDown,f=Wn.shiftKeyDown,v=Wn.isMouseDown(),g=Wn.isMouseDown(2),m=Wn.currentMouseDown||Wn.currentKeyDown;if(n=e.normalizeCellContext(n),!(e.selectionDisabled||!i||-1===n.rowIndex||null!==(a=n.record)&&void 0!==a&&a.isGroupHeader||null!=m&&m.fromKeyMap&&!o.selectOnKeyboardNavigation||e.columns.getById(n.columnId)===e.checkboxSelectionColumn||o.checkboxOnly||!0===(null==m?void 0:m.handled)&&!e._fromFocusCell)){f||(e._isAddingToSelection=(h||u)&&s,e._selectionStartCell=n),s&&d&&v&&!l.selectiondrag&&!e.preventDragSelect&&(l.selectiondrag=fr.on({name:"selectiondrag",element:e.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:r},mousemove:"onSelectionDrag",thisObj:e})),e.preventDragSelect=!1;var p=e._selectionStartCell,y=e._isAddingToSelection;if((f&&v||e._isKeyboardRangeSelecting)&&p&&s)e.performSelection(e.internalSelectRange(p,n,e.isRowNumberSelecting(p,n)));else{var k,b,C=!1,w=!0;if(e.isCellSelected(n,!0)){if(g)return;if(y||c)b=[n],w=!1;else if(e.selectedRecords.length+(e.isCellSelectionMode?e._selectedCells.length:0)<=1)return;C=c||s}b||y||(b=null,d&&C&&l.selectiondrag&&(e._clearSelectionOnSelectionDrag=!0));var D=function(t,r){var i;if(null==r||r(),!Qi.dragging){if((null==t||null===(i=t.target)||void 0===i?void 0:i.nodeType)===Node.ELEMENT_NODE){var a=new cg(t.target);if(null!=a&&a.grid&&!a.equals(n,!0))return}f||(e._shiftSelectRange=null),e.performSelection(e.prepareSelection(b,w&&[n],null===b,w&&e.isRowNumberSelecting(n)))}};if(null!==(k=e.features.rowReorder)&&void 0!==k&&k.isDragging)return;C?e.delayUntilMouseUp(D):D()}}}},{key:"prepareSelection",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this,o=a._isSelectionDragging,l=a.store,s=a.selectionMode,u=s.includeParents,c=s.selectRecordOnCell,d=[],h=n?a._selectedCells:[],f=[],v=n?a._selectedRows:[],g=$e.keyBy(v,"id",(function(){return 1})),m=n?a.selectedRecords.filter((function(e){return!g[e.id]})):[],p=[];if(!n&&e){var y,k=D($e.asArray(e));try{var b=function(){var e=y.value,t=a.normalizeCellContext(e),n=(null==t?void 0:t.record)||(e.isModel?e:l.getById(t.id));if(t.isSpecialRow)return 1;if(h.push(t),n&&!g[n.id]&&(o||a.isSelected(n)?(v.push(n),g[n.id]=1):c&&a.selectedRecordCollection.get(n.id)&&!m.some((function(e){return e.id===n.id}))&&m.push(n),a.selectionShouldIncludeChildren(n))){var r,i=D(n.allChildren);try{for(i.s();!(r=i.n()).done;){var s=r.value;g[s.id]||!o&&!a.isSelected(s)||(v.push(s),g[s.id]=1)}}catch(e){i.e(e)}finally{i.f()}}};for(k.s();!(y=k.n()).done;)b()}catch(e){k.e(e)}finally{k.f()}}if(t){var C,w={},S=D($e.asArray(t));try{for(S.s();!(C=S.n()).done;){var x=C.value,E=a.normalizeCellContext(x),R=(null==E?void 0:E.record)||(x.isModel?x:l.getById(E.id));if(!E.isSpecialRow&&(a.isCellSelectionMode&&!r&&d.push(E),(a.isRowSelectionMode||r)&&!w[R.id]&&(f.push(R),w[R.id]=1,a.selectionShouldIncludeChildren(R)))){var T,M=D(R.allChildren);try{for(M.s();!(T=M.n()).done;){var F=T.value;w[F.id]||(f.push(F),w[F.id]=1)}}catch(e){M.e(e)}finally{M.f()}}}}catch(e){S.e(e)}finally{S.f()}c&&d.length&&(p=$e.unique(d.map((function(e){return e.record}))).filter((function(e){return!w[e.id]})))}if(u&&(v.length||f.length)){var A=[].concat(z(v),f),I=$e.unique(A.filter((function(e){return e.parent&&!e.allChildren.some((function(e){return A.includes(e)}))})).map((function(e){return e.parent})));I.forEach((function(e){return a.toggleParentSelection(e,f,v)}))}return a.cleanSelectionChange({selectedCells:d,selectedRecords:f,deselectedCells:h,deselectedRecords:v,deselectAll:n,action:null!=f&&f.length||null!=d&&d.length?"select":"deselect",selectedCellRecords:p,deselectedCellRecords:m})}},{key:"toggleParentSelection",value:function(e,t,n){var r=this;if(e&&!e.isRoot){var i=this.isSelected(e),a=t.includes(e),o=n.includes(e),l=function(e){return r.isSelected(e)&&!n.includes(e)||t.includes(e)};"some"===this.selectionMode.includeParents?e.allChildren.some(l)?i&&!o||a||t.push(e):i&&!o&&n.push(e):i?o||a||!e.allChildren.some((function(e){return n.includes(e)}))||n.push(e):a||e.allChildren.every(l)&&t.push(e),e.parent&&this.toggleParentSelection(e.parent,t,n)}}},{key:"internalSelectRange",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.isRowSelectionMode||n,o=r.prepareSelection(r._shiftSelectRange,r.getRange(e,t,a),!1,n);return r._shiftSelectRange=o["selected".concat(a?"Records":"Cells")],o}},{key:"getRange",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.store,o=r.normalizeCellContext(e),l=r.normalizeCellContext(t),s=Math.min(o.rowIndex,l.rowIndex),u=Math.max(o.rowIndex,l.rowIndex),c=[],d=Math.min(o.columnIndex,l.columnIndex),h=Math.max(o.columnIndex,l.columnIndex);if(-1===s||-1===u)throw new Error("Record not found in selectRange");if(n){var f=a.getRange(s,u+1,!1);l.rowIndex<o.rowIndex&&f.reverse(),c.push.apply(c,z(f))}else for(var v=s;v<=u;v++)for(var g=d;g<=h;g++)c.push({rowIndex:v,columnIndex:g});return c.map((function(e){return r.normalizeCellContext(e)}))}},{key:"performSelection",value:function(e){var t,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this,o=e.selectedRecords,l=void 0===o?[]:o,s=e.selectedCells,u=void 0===s?[]:s,c=e.selectedCellRecords,d=void 0===c?[]:c,h=e.deselectedRecords,f=void 0===h?[]:h,v=e.deselectedCells,g=void 0===v?[]:v,m=e.deselectedCellRecords,p=void 0===m?[]:m,y=e.action,k=[].concat(z(l),z(d)),b=[].concat(z(f),z(p)),C=a.isRowSelectionMode;if(!1===a.trigger("beforeSelectionChange",{mode:C?"row":"cell",action:y,selected:k,deselected:b,selection:a.selectedRecords,selectedCells:u,deselectedCells:g,cellSelection:a.selectedCells}))return a.removeDragListeners(),!1;if(a._selectedCells===g)a._selectedCells=[];else{var w,S=[],x=D(a._selectedCells);try{var E=function(){var e=w.value;g.some((function(t){return e.equals(t,!0)}))||u.some((function(t){return e.equals(t,!0)}))||S.push(e)};for(x.s();!(w=x.n()).done;)E()}catch(e){x.e(e)}finally{x.f()}a._selectedCells=S}if(e.deselectedRecords=z(f),f===a._selectedRows)a._selectedRows.length=0,a.changeSelectedRecordCollectionSilent((function(e){return e.clear()}));else{var R,T=[],M=[],F=$e.keyBy(b,"id",(function(){return 1})),A=D(a.selectedRecords);try{for(A.s();!(R=A.n()).done;){var I=R.value;F[I.id]||(a.isSelected(I)?T.push(I):M.push(I))}}catch(e){A.e(e)}finally{A.f()}a._selectedRows=T,a.changeSelectedRecordCollectionSilent((function(e){return e.values=[].concat(T,M)}))}if(u.length){var L,O=D(u);try{var P=function(){var e=L.value;a._selectedCells.some((function(t){return t.equals(e,!0)}))||a._selectedCells.push(e)};for(O.s();!(L=O.n()).done;)P()}catch(e){O.e(e)}finally{O.f()}}l.length&&((t=a._selectedRows).push.apply(t,z(l.filter((function(e){return!a._selectedRows.some((function(t){return t.id===e.id}))})))),a.changeSelectedRecordCollectionSilent((function(e){return e.add.apply(e,z(l))})));d.length&&a.changeSelectedRecordCollectionSilent((function(e){return e.add.apply(e,z(d))})),n&&a.refreshGridSelectionUI(e),a.afterSelectionChange(e),r||a.triggerSelectionChangeEvent(e)}},{key:"refreshGridSelectionUI",value:function(e){var t=e.selectedRecords,n=e.selectedCells,r=e.deselectedRecords,i=e.deselectedCells,a=this,o=a.checkboxSelectionColumn;null==o||o.suspendEvents(),a.updateGridSelectionRecords(t,!0),a.updateGridSelectionRecords(r,!1),a.updateCheckboxHeader(),null==o||o.resumeEvents(),a.isCellSelectionMode&&(a.updateGridSelectionCells(n,!0),a.selectionMode.column&&a.updateGridSelectionColumns(n)),a.updateGridSelectionCells(i,!1)}},{key:"updateGridSelectionRecords",value:function(e,t){var n=this.checkboxSelectionColumn;if(null!=e&&e.length)for(var r=0;r<e.length;r++){var i=this.getRowFor(e[r]);i&&(i.toggleCls("b-selected",t),i.setAttribute("aria-selected",t),!n||n.hidden||e[r].isSpecialRow||(i.getCell(n.id).widget.checked=t))}}},{key:"updateGridSelectionCells",value:function(e,t){if(null!=e&&e.length)for(var n=0;n<e.length;n++){var r=this.getCell(e[n]);r&&(r.setAttribute("aria-selected",t),r.classList.toggle("b-selected",t))}}},{key:"updateGridSelectionColumns",value:function(e){var t,n=this.store.count,r=D(this.columns.visibleColumns);try{var i=function(){var r,i=t.value;null===(r=i.element)||void 0===r||r.classList.toggle("b-selected",(null==e?void 0:e.filter((function(e){return e.columnId===i.id})).length)===n)};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}},{key:"triggerSelectionChangeEvent",value:function(e){var t=e.selectedRecords,n=void 0===t?[]:t,r=e.selectedCells,i=void 0===r?[]:r,a=e.selectedCellRecords,o=void 0===a?[]:a,l=e.deselectedRecords,s=void 0===l?[]:l,u=e.deselectedCells,c=void 0===u?[]:u,d=e.deselectedCellRecords,h=void 0===d?[]:d,f=[].concat(z(n),z(o)),v=[].concat(z(s),z(h)),g=this.isRowSelectionMode;this.trigger("selectionChange",{mode:g?"row":"cell",action:e.action,selected:f,deselected:v,selection:this.selectedRecords,selectedCells:i,deselectedCells:c,cellSelection:this.selectedCells})}},{key:"doDestroy",value:function(){var e;for(var n in(null===(e=this.selectedRecordCollection)||void 0===e?void 0:e.owner)===this&&this.selectedRecordCollection.destroy(),this._selectedCells.length=0,this._selectedRows.length=0,this._selectionListenersDetachers)this._selectionListenersDetachers[n]();B(t,"doDestroy",this,3)([])}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","GridSelection"),S(t,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{},selectionDisabled:!1}),t},rm=function(e){return e.columns.suspendEvents()},im=function(e){return e.columns.resumeEvents()},am=function(e){e.columns.clearCaches(),e.columns.fillFromMaster()},om=function(e,t){return e.stateSortIndex-t.stateSortIndex},lm=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateStore",value:function(e,n){var r;null===(r=B(t,"updateStore",this,3))||void 0===r||r([e,n]),this.detachListeners("stateStoreListeners"),null==e||e.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}},{key:"updateColumns",value:function(e,n){var r;null===(r=B(t,"updateColumns",this,3))||void 0===r||r([e,n]),this.detachListeners("stateColumnListeners"),e.ion({name:"stateColumnListeners",change:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}},{key:"updateRowManager",value:function(e,n){var r;null===(r=B(t,"updateRowManager",this,3))||void 0===r||r([e,n]),this.detachListeners("stateRowManagerListeners"),e.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}},{key:"triggerUpdate",value:function(){this.trigger("stateChange")}},{key:"finalizeInit",value:function(){var e=this;B(t,"finalizeInit",this,3)([]),this.ion({selectionChange:"triggerUpdate",toggleGroup:function(t){return!t.allRecords&&e.triggerUpdate()},thisObj:this})}},{key:"getState",value:function(){var e,t=this,n=t.element.style.cssText,r={rowHeight:t.rowHeight};if(n&&(r.style=n),t.selectedCell){var i=t.selectedCell,a=i.id,o=i.columnId;r.selectedCell={id:a,columnId:o}}!t.disableGridColumnIdWarning&&t.columns.find((function(e){return e.meta.generatedId===e.id}))&&console.warn("Column(s) without id detected. When saving and restoring state, columns without a configured id can be restored incorrectly."),r.selectedRecords=t.selectedRecords.map((function(e){return e.id})),r.columns=t.columns.allRecords.map((function(e){return e.getState()})),r.store=t.store.state,r.scroll=t.storeScroll();var l=null===(e=t.features.treeGroup)||void 0===e?void 0:e.levels;(null==l?void 0:l.length)>0&&!l.some((function(e){return!e.fieldName}))&&(r.treeGroupLevels=t.features.treeGroup.levels.map((function(e){return e.fieldName}))),r.subGrids={},t.eachSubGrid((function(e){var t,n=r.subGrids[e.region]=r.subGrids[e.region]||{};e.isPainted?null==e.flex&&(n.width=e.width):null!=e.config.width?n.width=e.config.width:n.flex=e.config.flex,n.collapsed=null!==(t=e.collapsed)&&void 0!==t&&t,n.collapsed&&(n._beforeCollapseState=e._beforeCollapseState)}));for(var s=0,u=Object.entries(this.features);s<u.length;s++){var c=_(u[s],2),d=c[0],h=c[1].state;h&&(r.features=r.features||{},r.features[d]=h)}return r}},{key:"applyState",value:function(e){var t=this,n=t.columns;if(e=Object.assign({},e),t.suspendRefresh(),"columns"in e){var r=!1,i=!1;n.suspendEvents(),t.eachSubGrid(rm);var l=new o,s=new a;e.columns.forEach((function(e,a){var o,u,c=null!==(o=n.lookupStateColumns(e).filter((function(e){return!l.has(e)}))[0])&&void 0!==o?o:(null===(u=t.stateSettings)||void 0===u?void 0:u.restoreUnconfiguredColumns)&&n.add({id:e.id,type:e.type,field:e.field})[0];if(c){l.add(c),s.set(e,c);var d=c.generation;"region"in e&&!(e.region in t.subGrids)&&(delete e.region,delete e.locked),c.applyState(e),r=r||c.generation!==d,c.stateSortIndex=a,c.allIndex!==a&&(i=r=!0)}})),e.columns.forEach((function(t){if("parentId"in t){var n=e.columns.find((function(e){return e.id===t.parentId})),r=s.get(n),i=s.get(t);r&&i&&i.parent!==r&&r.insertChild(i)}})),r&&t.eachSubGrid(am),i&&(t.eachSubGrid((function(e){e.columns.records.sort(om),e.columns.allRecords.sort(om)})),n.sort({fn:om,ascending:!0})),t.isPainted&&r&&t.renderContents(),n.resumeEvents(),t.eachSubGrid(im),delete e.columns}"subGrids"in e&&(t.eachSubGrid((function(t){if(t.region in e.subGrids){var n=e.subGrids[t.region];"width"in n?t.width=n.width:"flex"in n&&(t.flex=n.flex),"collapsed"in n&&(t.collapsed=n.collapsed,t._beforeCollapseState=n._beforeCollapseState)}t.clearWidthCache()})),delete e.subGrids),"store"in e&&(t.store.state=e.store,delete e.store);var u=e.scroll;if(delete e.scroll,"features"in e){for(var c in e.features){var d,h;null===(d=this.features[c])||void 0===d||null===(h=d.setConfig)||void 0===h||h.call(d,e.features[c])}delete e.features}Be.assign(t,e),"treeGroupLevels"in e&&t.features.treeGroup&&(t.features.treeGroup.levels=e.treeGroupLevels),t.resumeRefresh(!0),t.whenVisible((function(){return t.applyScrollState(u)}))}},{key:"applyScrollState",value:function(e){var t=this;t.eachSubGrid((function(e){return e.refreshFakeScroll()})),e&&(t.restoreScroll(e),e.scrollTop&&t.element.querySelectorAll(".b-resize-monitored").forEach((function(e){var t=Lo.fromElement(e);t&&t.onElementResize(e)})))}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","GridState"),S(t,"configurable",{statefulEvents:["subGridCollapse","subGridExpand","horizontalScrollEnd","verticalScrollEnd","stateChange","selectionChange","collapseAllGroups","expandAllGroups","treeGroupChange"],stateSettings:{restoreUnconfiguredColumns:!0}}),t},sm=Promise.resolve(),um={block:"nearest"},cm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateYScroller",value:function(e){null==e||e.addScroller(this)}},{key:"scrollIntoView",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:um,n=this.getDeltaTo(e,t),r=n.xDelta,a=n.yDelta,o=r||a?this.scrollBy(r,a,t):sm;if(t.highlight||t.focus){var l=o;(o=o.then((function(){var n,i;l.cancelled||(e=e instanceof pt?e:null!==(n=null===(i=t.elementAfterScroll)||void 0===i?void 0:i.call(t))&&void 0!==n?n:e,t.highlight&&(e instanceof pt?e.translate(-r,-a).highlight():li.highlight(e)),t.focus&&e.focus({preventScroll:!0}))}))).cancel=function(){var e;return null===(e=l.cancel)||void 0===e?void 0:e.call(l)}}return o}},{key:"scrollBy",value:function(e,n,r){var i=n&&this.yScroller.scrollBy(0,n,r),a=e&&B(t,"scrollBy",this,3)([e,0,r]),o=Promise.all([a,i]);return o.cancel=function(){var e,t;null==a||null===(e=a.cancel)||void 0===e||e.call(a),null==i||null===(t=i.cancel)||void 0===t||t.call(i),o.cancelled=!0},null!=a&&a.cancel&&null!=i&&i.cancel&&(r.force=!0),o}},{key:"scrollTo",value:function(e,n,r){var i=null!=n&&this.yScroller.scrollTo(null,n,r),a=null!=e&&B(t,"scrollTo",this,3)([e,null,r]);r&&r.animate||this.syncPartners();var o=Promise.all([a,i]);return o.cancel=function(){var e,t;null==a||null===(e=a.cancel)||void 0===e||e.call(a),null==i||null===(t=i.cancel)||void 0===t||t.call(i),o.cancelled=!0},null!=a&&a.cancel&&null!=i&&i.cancel&&(r.force=!0),o}},{key:"viewport",get:function(){var e=pt.from(this.element);return(this.yScroller?e.intersect(pt.from(this.yScroller.element)):e)||new pt(e.x,e.y,e.width,0)}},{key:"y",get:function(){return this.yScroller?this.yScroller.y:0},set:function(e){this.yScroller&&(this.yScroller.y=e)}},{key:"maxY",get:function(){return this.yScroller?this.yScroller.maxY:0}},{key:"scrollHeight",get:function(){return this.yScroller?this.yScroller.scrollHeight:0}},{key:"clientHeight",get:function(){return this.yScroller?this.yScroller.clientHeight:0}},{key:"suspendEvents",value:function(){var e;B(t,"suspendEvents",this,3)([]),null===(e=this.yScroller)||void 0===e||e.suspendEvents()}},{key:"resumeEvents",value:function(){var e;B(t,"resumeEvents",this,3)([]),null===(e=this.yScroller)||void 0===e||e.resumeEvents()}}])}(Oa);S(cm,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),cm._$name="SubGridScroller";var dm=function(e,t){return e+t.getBoundingClientRect().width},hm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),Ne.isTestEnv&&(this.hideOverlayScroller.delay=50)}},{key:"doDestroy",value:function(){var e,n=this;n.header.destroy(),n.footer.destroy(),null===(e=n.fakeScroller)||void 0===e||e.destroy(),n.virtualScrollerElement.remove(),n.splitterElements.forEach((function(e){return e.remove()})),B(t,"doDestroy",this,3)([])}},{key:"barConfig",get:function(){var e=this,t=e.element.style,n=t.width,r=t.flex,a={subGrid:e,parent:e,maxWidth:e.maxWidth||i,minWidth:e.minWidth||i};return r?a.flex=r:n&&(a.width=n),a}},{key:"changeHeader",value:function(e){return new this.headerClass(Be.assign({id:this.id+"-header"},this.barConfig,e))}},{key:"changeFooter",value:function(e){return new this.footerClass(Be.assign({id:this.id+"-footer"},this.barConfig,e))}},{key:"splitterElements",get:function(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}},{key:"toggleSplitterCls",value:function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];this.splitterElements.forEach((function(t){return null==t?void 0:t.classList[n?"add":"remove"](e)})),r&&this.scrollable.eachPartner((function(r){var i,a,o=r.scroller;o.owner!==t&&(null===(i=(a=o.owner).toggleSplitterCls)||void 0===i||i.call(a,"b-hover"===e?"b-partner-splitter-hover":"b-hover",n,!1))}))}},{key:"hideSplitter",value:function(){this.splitterElements.forEach((function(e){return e.classList.add("b-hide-display")})),this.$showingSplitter=!1}},{key:"showSplitter",value:function(){this.splitterElements.forEach((function(e){return e.classList.remove("b-hide-display")})),this.$showingSplitter=!0}},{key:"changeElement",value:function(e,n){var r=this.region;return B(t,"changeElement",this,3)([{tabIndex:-1,"aria-label":"".concat(r," subgrid"),className:S(S({"b-grid-subgrid":1},"b-grid-subgrid-".concat(r),r),"b-grid-subgrid-collapsed",this.collapsed),dataset:{region:r}},n])}},{key:"rowElementConfig",get:function(){var e=this.grid;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map((function(t,n){return{role:"gridcell","aria-colindex":n+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}}}))}}},{key:"changeVirtualScrollerElement",value:function(){var e=li.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}},{key:"changeSplitterElement",value:function(){var e=li.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[ne.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[ne.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[ne.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}},{key:"splitterConfig",get:function(){return{className:this.splitterElement.className.trim(),children:[ne.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}},{key:"changeHeaderSplitter",value:function(){return li.createElement(this.splitterConfig)}},{key:"changeScrollerSplitter",value:function(){return li.createElement(this.splitterConfig)}},{key:"changeFooterSplitter",value:function(){return li.createElement(this.splitterConfig)}},{key:"render",value:function(){for(var e=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];B(t,"render",this,3)(r),e.grid&&(e.updateHasFlex(),e.element.parentNode.insertBefore(e.splitterElement,e.element.nextElementSibling),e.splitterElements.forEach((function(t){return fr.on({element:t,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:e})})),e._collapsed&&e.collapse())}},{key:"toggleHeaders",value:function(e){var t=this;if(e)t.headerSplitter.remove(),t.header.element.remove(),t.scrollable.removePartner(t.header.scrollable,"x");else{var n=t.grid;if(!t.isConfiguring){var r=2*n.items.indexOf(t);li.insertAt(n.headerContainer,t.headerSplitter,r),li.insertAt(n.headerContainer,t.header.element,r),t.refreshHeader()}t.scrollable.addPartner(t.header.scrollable,"x")}}},{key:"refreshHeader",value:function(){this.header.refreshContent()}},{key:"refreshColumnHeader",value:function(e){this.header.refreshColumn(e)}},{key:"refreshFooter",value:function(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}},{key:"childItems",get:function(){return[this.header,this.footer]}},{key:"fixCellWidths",value:function(e){for(var t=this.columns.visibleColumns,n=e.firstElementChild,r=0;n;){var i=t[r],a=i.element;i.minWidth&&(n.style.minWidth=li.setLength(i.minWidth)),i.maxWidth&&(n.style.maxWidth=li.setLength(i.maxWidth)),i.flex?i.childLevel&&a?(n.style.flex="0 0 ".concat(a.getBoundingClientRect().width,"px"),n.style.width=""):(n.style.flex=i.flex,n.style.width=""):i.width?n.style.width=li.setLength(i.width):n.style.flex=n.style.width=n.style.minWidth="",n=n.nextElementSibling,r++}}},{key:"totalFixedWidth",get:function(){return this.columns.totalFixedWidth}},{key:"headerScrollWidth",get:function(){return z(this.header.contentElement.children).reduce(dm,0)||this.columns.totalFixedWidth}},{key:"fixWidths",value:function(){var e=this,t=e.element,n=e.header,r=e.footer;if(!e.collapsed){if(e.flex)n.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((function(e){return!e.hidden&&e.flex}))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);e.clearWidthCache();var i=e.width;if(!i&&e.hasCalculatedWidth){i=0;var a,o=D(e.columns);try{for(o.s();!(a=o.n()).done;){var l=a.value;l.flex||l.hidden||(i+=l.width)}}catch(e){o.e(e)}finally{o.f()}}t.style.width="".concat(i,"px"),n.width=i,r&&(r.width=i)}e.handleHorizontalScroll(!1)}}},{key:"fixRowWidthsInSafariEdge",value:function(){if(ne.isSafari){var e=this,t=e.region,n=e.header,r=n.calculateMinWidthForSafari();e.rowManager.forEach((function(e){var n=e.getElement(t);n&&(n.style.width="".concat(r,"px"))})),n.headersElement.style.width="".concat(r,"px")}}},{key:"width",get:function(){return B(t,"width",this,1)},set:function(e){var n,r,i=this;(i.hasCalculatedWidth=!1,V(t,"width",e,this,1,1),i.header.width=e,i.footer.width=e,i.isPainted&&i.onElementResize(),i.isExpanding||i.isCollapsing||i.isConfiguring)||(null===(n=(r=i.grid).syncSplits)||void 0===n||n.call(r,(function(t){return t.subGrids[i.region]&&(t.subGrids[i.region].width=e)})))}},{key:"flex",get:function(){return B(t,"flex",this,1)},set:function(e){var n,r,i=this;(i.hasCalculatedWidth=!1,i.header.flex=e,i.footer.flex=e,V(t,"flex",e,this,1,1),i.isPainted&&i.onElementResize(),i.isExpanding||i.isCollapsing||i.isConfiguring)||(null===(n=(r=i.grid).syncSplits)||void 0===n||n.call(r,(function(t){return t.subGrids[i.region]&&(t.subGrids[i.region].flex=e)})))}},{key:"onInternalResize",value:function(e,n,r,i,a){var o=this,l=o.grid;if(B(t,"onInternalResize",this,3)(arguments),null!=l&&l.isPainted){var s;if(o.syncSplitterButtonPosition(),n!==i)o.trigger("beforeInternalResize",o),null===(s=l.beforeSubGridInternalResize)||void 0===s||s.call(l,o),l.trigger("horizontalScroll",{grid:l,subGrid:o,scrollLeft:o.scrollable.scrollLeft,scrollX:o.scrollable.x}),l.trigger("horizontalScrollEnd",{subGrid:o,scrollLeft:o.scrollable.scrollLeft}),o.fakeScroller&&o.refreshFakeScroll(),l.syncFlexedSubCols(),o.fixRowWidthsInSafariEdge();r!==a&&l.onHeightChange(),o.trigger("afterInternalResize",o)}}},{key:"syncParallelSplitters",value:function(e){var t=this,n=t.grid;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{var r=n.getSubGrid(n.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}},{key:"onSplitterMouseEnter",value:function(){var e=this,t=e.nextSibling;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}},{key:"onSplitterMouseLeave",value:function(){var e=this,t=e.nextSibling;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}},{key:"startSplitterButtonSyncing",value:function(){var e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}},{key:"stopSplitterButtonSyncing",value:function(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}},{key:"syncSplitterButtonPosition",value:function(){var e=this.grid;this.splitterButtons.style.top="".concat(e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2,"px")}},{key:"viewRectangle",get:function(){var e=this.scrollable;return new pt(e.x,e.y,this.width||0,this.rowManager.viewHeight)}},{key:"updateHasFlex",value:function(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}},{key:"updateResizable",value:function(e){this.splitterElements.forEach((function(t){return li.toggleClasses(t,["b-disabled"],!e)}))}},{key:"resizeColumnsToFitContent",value:function(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((function(e){e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}},{key:"overflowingHorizontally",get:function(){return!this.collapsed&&(this.grid.hideHeaders?this.scrollable.hasOverflow("x"):this.header.scrollable.hasOverflow("x"))}},{key:"overflowingVertically",get:function(){return!1}},{key:"refreshFakeScroll",value:function(){var e=this,t=e.element,n=e.virtualScrollerElement,r=e.virtualScrollerWidth,i=e.header,a=e.footer,o=e.scrollable,l=z(i.contentElement.children).reduce(dm,0);o.scrollWidth=l,t.style.setProperty("--total-column-width","".concat(e.headerScrollWidth,"px")),n.style.width=t.style.width,n.style.flex=t.style.flex,n.style.minWidth=t.style.minWidth,n.style.maxWidth=t.style.maxWidth,i.scrollable.syncOverflowState(),a.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(r.style.width="".concat(o.scrollWidth||0,"px"),e.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}},{key:"initScroll",value:function(){var e=this,t=e.scrollable,n=e.virtualScrollerElement,r=e.grid;e.fakeScroller=new Oa({element:n,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),r.hideHorizontalScrollbar||(t.addPartner(e.fakeScroller,"x"),e.refreshFakeScroll()),r.hideHeaders||t.addPartner(e.header.scrollable,"x"),r.hideFooters||t.addPartner(e.footer.scrollable,"x")}},{key:"onSubGridScrollEnd",value:function(e){var t=this,n=t.grid;t.scrollingToCenter=null==e?void 0:e.scrollingToCenter,t.scrolling=!1,t.handleHorizontalScroll(!1),li.scrollBarWidth||(n.virtualScrollers.classList.remove("b-scrolling"),t.hideOverlayScroller()),n.trigger("horizontalScrollEnd",{subGrid:t})}},{key:"onSubGridScroll",value:function(e){this.scrollingToCenter=null==e?void 0:e.scrollingToCenter,this.handleHorizontalScroll()}},{key:"showOverlayScroller",value:function(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}},{key:"hideOverlayScroller",value:function(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}},{key:"scrolling",get:function(){return this._scrolling},set:function(e){this._scrolling=e}},{key:"handleHorizontalScroll",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this,n=t.grid;!t.scrolling&&e&&(t.scrolling=!0,li.scrollBarWidth||(n.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),n.trigger("horizontalScroll",{subGrid:t,grid:n,scrollLeft:t.scrollable.scrollLeft,scrollX:t.scrollable.x,scrollingToCenter:null==t?void 0:t.scrollingToCenter})}},{key:"scrollColumnIntoView",value:function(e,t){var n=this.columns,r=this.header,i=r.scrollable;if(e=e instanceof yg?e:n.get(e)||n.getById(e)||n.getAt(e)){var a=r.getHeader(e.id);if(a)return i.scrollIntoView(pt.from(a,null,!0),t)}}},{key:"onAddRow",value:function(e){var t,n=e.source,r=void 0===n?this.grid.rowManager:n,i=e.rows,a=this,o=a.region,l=a.rowElementConfig,s=document.createDocumentFragment(),u=null===(t=r.rows[i[i.length-1].index+1])||void 0===t?void 0:t.elements[o];i.forEach((function(e){var t=li.createElement(l);li.syncClassList(t,e.cls),s.appendChild(t),e.addElement(o,t),a.fixCellWidths(t)})),a.fixRowWidthsInSafariEdge(),a.element.insertBefore(s,u||a.insertRowsBefore)}},{key:"rowElements",get:function(){return this.fromCache(".b-grid-row",!0)}},{key:"clearRows",value:function(){this.emptyCache();var e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}},{key:"addNewRowElement",value:function(){var e=li.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}},{key:"store",get:function(){return this.grid.store}},{key:"rowManager",get:function(){var e;return null===(e=this.grid)||void 0===e?void 0:e.rowManager}},{key:"changeCollapsed",value:function(e){return Boolean(e)}},{key:"updateCollapsed",value:function(e,t){this.isConfiguring||(this._fromPropertyUpdate=!0,e?this.collapse():this.expand(),this._fromPropertyUpdate=!1)}},{key:"collapse",value:(o=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(i=t).grid,o=a.partners,e=e&&Object.keys(a.subGrids).length<=2,!a.rendered||!0!==i._collapsed||i._fromPropertyUpdate){r.next=4;break}return r.abrupt("return");case 4:if(!a.partners||n){r.next=12;break}return a.isSyncingFromPartner=!0,o.forEach((function(e){return e.isSyncingFromPartner=!0})),r.next=9,Promise.all([i.collapse(e,!0)].concat(z(o.map((function(t){var n;return null===(n=t.subGrids[i.region])||void 0===n?void 0:n.collapse(e,!0)})))));case 9:return o.forEach((function(e){return e.isSyncingFromPartner=!1})),a.isSyncingFromPartner=!1,r.abrupt("return");case 12:if(!e){r.next=21;break}return a.element.classList.add("b-subgrid-width-transition"),r.next=16,a.runWithTransition((function(){return i._collapseInternal(!0)}),!0);case 16:if(!i.isDestroyed){r.next=18;break}return r.abrupt("return");case 18:a.element.classList.remove("b-subgrid-width-transition"),r.next=22;break;case 21:i._collapseInternal(!1);case 22:a.trigger("subGridCollapse",{subGrid:i}),a.afterToggleSubGrid({subGrid:i,collapsed:!0}),i.isCollapsing=!1,a.trigger("afterInternalResize");case 26:case"end":return r.stop()}}),r)}))()})),function(e){return o.apply(this,arguments)})},{key:"_collapseInternal",value:(a=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0];return L().mark((function n(r){var i,a,o,l,s,u,c,d,h;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=(i=e).grid,o=i.element,l=a.getSubGrid(a.getNextRegion(i.region)),s=i.splitterElement?i:i.previousSibling,u=i._beforeCollapseState,c=0,i.isCollapsing=!0,a.eachSubGrid((function(e){e!==i&&!e._collapsed&&++c})),null===(r=a.syncSplits)||void 0===r||r.call(a,(function(e){var n;return null===(n=e.subGrids[i.region])||void 0===n?void 0:n.collapse(t)})),0!==c){n.next=10;break}if(l){n.next=8;break}return n.abrupt("return");case 8:return n.next=10,l.expand();case 10:d=!1,u||(u=i._beforeCollapseState={},i.width&&(d=!0),u.width=i.width,u.elementWidth=o.style.width,""!==o.style.flex&&(u.flex=o.style.flex,i.header.element.style.flex=o.style.flex=""),""===l.element.style.flex&&(u.nextRegionWidth=l.width,l.width="",l.flex="1 1 ".concat(u.nextRegionWidth,"px")),o.classList.add("b-grid-subgrid-collapsed"),i.virtualScrollerElement.classList.add("b-collapsed"),i.header.element.classList.add("b-collapsed"),i.footer.element.classList.add("b-collapsed"),i._collapsed=!0,i.width="",d||i.syncParallelSplitters(!0)),i.isDestroyed||d&&(a.refreshVirtualScrollbars(),i.syncParallelSplitters(!0),null===(h=s.startSplitterButtonSyncing)||void 0===h||h.call(s));case 13:case"end":return n.stop()}}),n)}))()})),function(){return a.apply(this,arguments)})},{key:"expand",value:(r=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(i=t).grid,o=a.partners,e=e&&Object.keys(a.subGrids).length<=2,!a.rendered||!0===i._collapsed||i._fromPropertyUpdate){r.next=4;break}return r.abrupt("return");case 4:if(!o||n){r.next=12;break}return a.isSyncingFromPartner=!0,o.forEach((function(e){return e.isSyncingFromPartner=!0})),r.next=9,Promise.all([i.expand(e,!0)].concat(z(o.map((function(t){var n;return null===(n=t.subGrids[i.region])||void 0===n?void 0:n.expand(e,!0)})))));case 9:return o.forEach((function(e){return e.isSyncingFromPartner=!1})),a.isSyncingFromPartner=!1,r.abrupt("return");case 12:if(!e){r.next=21;break}return a.element.classList.add("b-subgrid-width-transition"),r.next=16,a.runWithTransition((function(){return i._expandInternal(!0)}),!0);case 16:if(!i.isDestroyed){r.next=18;break}return r.abrupt("return");case 18:a.element.classList.remove("b-subgrid-width-transition"),r.next=22;break;case 21:i._expandInternal(!1);case 22:i.columns.clearCaches(),a.trigger("subGridExpand",{subGrid:i}),a.afterToggleSubGrid({subGrid:i,collapsed:!1}),i.isExpanding=!1,a.trigger("afterInternalResize");case 27:case"end":return r.stop()}}),r)}))()})),function(e){return r.apply(this,arguments)})},{key:"_expandInternal",value:(n=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0];return L().mark((function n(r){var i,a,o,l,s,u;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=(i=e).grid,o=i._beforeCollapseState,l=a.getSubGrid(a.getNextRegion(i.region)),s=i.splitterElement?i:i.previousSibling,i.isExpanding=!0,null===(r=a.syncSplits)||void 0===r||r.call(a,(function(e){var n;return null===(n=e.subGrids[i.region])||void 0===n?void 0:n.expand(t)})),null!=o&&(u=!1,i.width!==o.elementWidth&&(u=!0),o.nextRegionWidth&&(l.width=o.nextRegionWidth,l.flex=null),i.element.classList.remove("b-grid-subgrid-collapsed"),i._collapsed=!1,i.virtualScrollerElement.classList.remove("b-collapsed"),i.header.element.classList.remove("b-collapsed"),i.footer.element.classList.remove("b-collapsed"),o.flex?(i.width=o.width,i.header.flex=i.flex=o.flex,i.footer.flex=o.flex,i._width=null):i.width=o.elementWidth,u&&(s.stopSplitterButtonSyncing(),i.syncParallelSplitters(!1)),delete i._beforeCollapseState);case 4:case"end":return n.stop()}}),n)}))()})),function(){return n.apply(this,arguments)})},{key:"hide",value:function(){var e,n;return null===(e=this.header)||void 0===e||e.hide(),null===(n=this.footer)||void 0===n||n.hide(),this.hideSplitter(),B(t,"hide",this,3)([])}},{key:"show",value:function(){var e,n,r=this;return null===(e=r.header)||void 0===e||e.show(),null===(n=r.footer)||void 0===n||n.show(),r.region!==r.grid.regions[r.grid.regions.length-1]&&r.showSplitter(),B(t,"show",this,3)([])}}]);var n,r,a,o}(Lo);S(hm,"$name","SubGrid"),S(hm,"type","subgrid"),S(hm,"defaultConfig",{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,defaultBindProperty:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:cm,hasCalculatedWidth:null,sealedColumns:null}),S(hm,"configurable",{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,collapsed:!1,resizable:null,role:"rowgroup"}),S(hm,"delayable",{hideOverlayScroller:1e3}),hm.initClass(),hm._$name="SubGrid";var fm=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeSubGridConfigs",value:function(e){var t,n,r=this,i=new o,a=D(r.columns);try{for(a.s();!(n=a.n()).done;){var l=n.value.region;l&&(e[l]||(e[l]={}),i.add(l))}}catch(e){a.e(e)}finally{a.f()}e.normal&&Be.isEmpty(e.normal)&&(e.normal={flex:1}),null!==(t=e.normal)&&void 0!==t&&t.width&&delete e.normal.flex;var s,u=D(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;r.createSubGrid(c,e[c])}}catch(e){u.e(e)}finally{u.f()}return r.items=r.subGrids,e}},{key:"createSubGrid",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=this,r=n.columns.chain((function(t){return t.region===e}),["region"]),a=hm.mergeConfigs({type:"subgrid",id:"".concat(n.id,"-").concat(e,"Subgrid"),parent:n,grid:n,region:e,headerClass:n.headerClass,footerClass:n.footerClass,columns:r,weight:e,scrollable:{yScroller:n.scrollable}},t||n.subGridConfigs[e]),o=!1;a.flex||a.width||0===a.flex||0===a.width||(a.width=r.totalFixedWidth,o=!0);var l=n.subGrids[e]=hm.create(a);return l.element.style.setProperty("--total-column-width",r.totalFixedWidth),l.hasCalculatedWidth=o,e===n.regions[0]&&(l.isFirstRegion=!0),l}},{key:"onChildAdd",value:function(e){if(e.isSubGrid){var n=this,r=n.items,i=n.headerContainer,a=n.virtualScrollers,o=n.footerContainer,l=2*r.indexOf(e);n.hideHeaders&&!n.columns.some((function(e){return e.flex}))||(li.insertAt(i,e.headerSplitter,l),li.insertAt(i,e.header.element,l)),li.insertAt(a,e.scrollerSplitter,l),li.insertAt(a,e.virtualScrollerElement,l),li.insertAt(o,e.footerSplitter,l),li.insertAt(o,e.footer.element,l),r.forEach((function(e,t){t<r.length-1&&e.showSplitter()})),0===l&&n.emptyTextEl&&e.element.appendChild(n.emptyTextEl)}return B(t,"onChildAdd",this,3)([e])}},{key:"onChildRemove",value:function(e){if(B(t,"onChildRemove",this,3)([e]),e.isSubGrid){var n=this.items;delete this.subGrids[e.region],$e.remove(this.regions,e.region),e.destroy(),n.length&&n[n.length-1].hideSplitter()}}},{key:"doDestroy",value:function(){this.eachSubGrid((function(e){return e.destroy()})),B(t,"doDestroy",this,3)([])}},{key:"eachSubGrid",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;this.items.forEach((function(n,r){n.isSubGrid&&e.call(t||n,n,r++)}))}},{key:"callEachSubGrid",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=null;return this.items.forEach((function(t,r){if(t.isSubGrid&&t[e]){var a=t[e].apply(t,n);0===r&&(i=a)}})),i}},{key:"regions",get:function(){return this.items.map((function(e){return e.region}))}},{key:"getLastRegions",value:function(){var e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}},{key:"getNextRegion",value:function(e){var t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}},{key:"getPreviousRegion",value:function(e){return this.regions[this.regions.indexOf(e)-1]}},{key:"getSubGrid",value:function(e){return this.subGrids[e]}},{key:"getSubGridFromColumn",value:function(e){return e=e instanceof yg?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}},{key:"resolveSplitter",value:function(e){var t=this.getLastRegions(),n=e instanceof hm?e.region:e;return t[1]===n&&(n=t[0]),this.subGrids[n].splitterElement}},{key:"widgetClass",get:function(){}}],[{key:"properties",get:function(){return{subGrids:{}}}}])}(e||Mn),S(t,"$name","GridSubGrids"),t},vm=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"applyLoadMask",value:function(){var e=this,t=e.loadMask;return t&&(e.masked=gs.mergeConfigs(e.loadMaskDefaults,t)),e.masked}},{key:"applyMaskError",value:function(e){var t=this.loadMaskError,n=this.masked;return!1===t?n.hide():n&&(Be.assign(n.errorDefaults,t),n.error=e),n}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}}])}(e),S(t,"$name","LoadMaskable"),t},gm={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,ChecklistFilterCombo:{search:"Search",selectAll:"Select All",removeAll:"Remove All",filtersSet:function(e){return 1===e?"1 filter set":"".concat(e," filters set")},noItems:"No results found",placeholder:"Filter...",apply:"Apply"},ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns",showName:function(e){return"Show column".concat(e.text?" ".concat(e.text):"")},hideName:function(e){return"Hide column".concat(e.text?" ".concat(e.text):"")}},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:function(e){return'Move before "'.concat(e,'"')},moveAfter:function(e){return'Move after "'.concat(e,'"')},collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Split:{split:"Split",unsplit:"Unsplit",horizontally:"Horizontally",vertically:"Vertically",both:"Both"},LockRows:{lockRow:"Lock row",unlockRow:"Unlock row"},ActionColumn:{rowActions:"Row actions"},Column:{columnLabel:function(e){return"".concat(e.text?"".concat(e.text," column. "):"","SPACE for context menu").concat(e.sortable?", ENTER to sort":"")},cellLabel:new String},WidgetColumn:{rowWidgets:"Row widgets"},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset",toggleName:function(e){return"Toggle ".concat(e.text||"value")}},RatingColumn:{cellLabel:function(e){var t;return"".concat(e.text?e.text:""," ").concat(null!==(t=e.location)&&void 0!==t&&t.record?"rating : ".concat(e.location.record.get(e.field)||0):"")}},RowNumberColumn:{rowNumber:"Row number"},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:function(e){return"Move column to ".concat(e)}},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",printSettings:"Print settings",print:"Print",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:function(e){var t=e.currentPage,n=e.totalPages;return"Exporting page ".concat(t,"/").concat(n)}},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:function(e){var t=e.currentPage,n=e.totalPages;return"Exporting page ".concat(t,"/").concat(n)}},RowExpander:{loading:"Loading",expand:"Expand row details",collapse:"Collapse row details",columnDescription:"Toggle row details"},TreeGroup:{group:"Group by",stopGrouping:"Stop grouping",stopGroupingThisColumn:"Ungroup column"}};Pa.publishLocale(gm);var mm=new Promise((function(e){return e()})),pm="GridBase:store",ym={block:"nearest",inline:"nearest"},km={dataset:1,pageLoad:1,filter:1},bm={hidden:1,mergeCells:1,region:1},Cm=Object.freeze([]),wm=function(e,t){return e-t},Dm=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"_animationSuspendedCounter",0),e}return R(t,e),w(t,[{key:"finishConfigure",value:function(e){var n=this,r=n.initScroll;n.initScroll=function(){return!n.scrollInitialized&&r.call(n)},Ne.isTestEnv&&(n.bufferedAfterColumnsResized.delay=50,n.bufferedElementResize.delay=50),B(t,"finishConfigure",this,3)([e]),Na.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:n}),Na.ion({locale:"onLocaleChange",prio:-1,thisObj:n}),Wn.ion({theme:"onThemeChange",thisObj:n}),n.ion({subGridExpand:"internalOnSubGridExpand",prio:-1,thisObj:n}),n.bufferedFixElementHeights=n.buffer("fixElementHeights",n.fixElementHeightsBuffer,n),n.setGridClassList(n.element.classList),n.verticalScroller.classList.remove("b-content-element","b-auto-container"),n.bodyWrapElement.classList.remove("b-auto-container-panel"),CSS.supports("selector(:has(*))")&&n.element.classList.add("b-supports-has")}},{key:"internalOnSubGridExpand",value:function(){this.renderContents()}},{key:"onBeforeLocaleChange",value:function(){this._suspendRenderContentsOnColumnsChanged=!0}},{key:"onLocaleChange",value:function(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}},{key:"finalizeInit",value:function(){B(t,"finalizeInit",this,3)([]),this.store.isLoading&&this.onStoreBeforeRequest()}},{key:"changeScrollManager",value:function(e,t){return null==t||t.destroy(),e?vg.new({element:this.element,owner:this},e):null}},{key:"doDestroy",value:function(){var e,n=this;n.detachListeners(pm),null===(e=n.scrollManager)||void 0===e||e.destroy();for(var r=0,i=Object.values(n.features);r<i.length;r++){var a,o=i[r];null===(a=o.destroy)||void 0===a||a.call(o)}n._focusedCell=null,n.columns.destroy(),B(t,"doDestroy",this,3)([])}},{key:"setGridClassList",value:function(e){Object.values(this.features).forEach((function(t){var n;t.disabled||!1===t||(n=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:"b-".concat(t instanceof Mn?t.$$name:t.constructor.name))&&e.add(n.toLowerCase())}))}},{key:"compose",value:function(){var e=this.autoHeight,t=this.enableSticky,n=this.enableTextSelection,r=this.fillLastColumn,i=this.positionMode,a=this.showDirty;return{class:S(S(S(S(S(S(S({},"b-grid-".concat(i),1),"b-enable-sticky",t),"b-grid-notextselection",!n),"b-autoheight",e),"b-fill-last-column",r),"b-show-dirty",a),"b-show-dirty-during-edit",null==a?void 0:a.duringEdit)}}},{key:"recomposeInternal",value:(l=f(L().mark((function e(){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.isConstructing)||(n=this.storeScroll()),e.next=4,B(t,"recomposeInternal",this,3)([]);case 4:r||(i=[].concat(z(Object.keys(n.scrollLeft).map((function(e){return n.scrollLeft[e]}))),[n.scrollTop]),Math.max.apply(Math,z(i))&&(a=this.storeScroll(),Math.max([].concat(z(Object.keys(a.scrollLeft).map((function(e){return a.scrollLeft[e]}))),[a.scrollTop]))||null===(o=this.restoreScroll)||void 0===o||o.call(this,n)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"cellCls",get:function(){var e=this._cellCls;return e.value||e}},{key:"bodyConfig",get:function(){var e=this.autoHeight,t=this.hideFooters,n=this.hideHeaders;return S(S({reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1}},this.hasHeader?"aria-labelledby":"","".concat(this.id,"-panel-title")),"children",{headerContainer:{"aria-hidden":n,role:n?null:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":n}},bodyContainer:{className:"b-grid-body-container",role:"presentation",children:{verticalScroller:{role:"presentation",className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",role:null},footerContainer:{"aria-hidden":t,role:t?null:"row",className:{"b-grid-footer-container":1,"b-hidden":t}}})}},{key:"contentElement",get:function(){return this.verticalScroller}},{key:"overflowElement",get:function(){return this.bodyContainer}},{key:"updateCellEllipsis",value:function(e){this.element.classList.toggle("b-use-ellipsis",e)}},{key:"updateHideHeaders",value:function(e){var t;e=Boolean(e),null===(t=this.headerContainer)||void 0===t||t.classList.toggle("b-hidden",e),this.eachSubGrid((function(t){return t.toggleHeaders(e)}))}},{key:"updateHideFooters",value:function(e){var t;e=Boolean(e),null===(t=this.footerContainer)||void 0===t||t.classList.toggle("b-hidden",e),this.eachSubGrid((function(t){t.scrollable[e?"removePartner":"addPartner"](t.footer.scrollable,"x")}))}},{key:"updateHideHorizontalScrollbar",value:function(e){var t=this;e=Boolean(e),this.eachSubGrid((function(n){n.virtualScrollerElement.classList.toggle("b-hide-display",e),t.isConfiguring||(n.scrollable[e?"removePartner":"addPartner"](n.fakeScroller,"x"),e||n.refreshFakeScroll())}))}},{key:"changeColumns",value:function(e,t){var n=this;if(!e&&t)return n.isDestroying?t.owner===n&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===n&&t.destroy(),e.grid=n,e;if(Array.isArray(e)){if(t){var r=t.allRecords.slice();t.data=e;var i,a=D(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;t.includes(o)||o.destroy()}}catch(e){a.e(e)}finally{a.f()}return t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return bg.new({grid:n,owner:n},e)}},{key:"updateColumns",value:function(e,n){var r,i,a,o,l=this,s=l.formulaProviders;if(null===(r=B(t,"updateColumns",this,3))||void 0===r||r([e,n]),e.ion({refresh:l.onColumnsChanged,sort:l.onColumnsChanged,change:l.onColumnsChanged,move:l.onColumnsChanged,thisObj:l}),e.ion((a=l.onColumnsResized,o=l,{update:function(e){var t=e.store,n=e.record,r=e.changes,i=!0;return("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r)&&(i=a.call(o,{store:t,record:n,changes:r})),i}})),ne.isTouchDevice&&(l.touch=!0,e.forEach((function(e){var t=e.touchConfig;t&&e.applyState(t)}))),null===(i=l.bodyElement)||void 0===i||i.setAttribute("aria-colcount",e.visibleColumns.length),s){var u=l.store.modelClass;e.forEach((function(e){e.data.formula&&e.field&&u.fieldMap[e.field]&&(u.fieldMap[e.field].formulaProviders=s)}))}}},{key:"onColumnsChanged",value:function(e){var t=e.type,n=e.action,r=e.changes,i=e.record,a=e.records,o=e.isMove,l=this,s=l.columns,u=l.checkboxSelectionColumn,c=r&&Object.keys(r),d=1===(null==c?void 0:c.length);if(o=!0===o||o&&Object.values(o).some((function(e){return e})),l.beforeColumnsChange({type:t,action:n,changes:r,column:i,columns:a}),!(o||"refresh"===t&&"batch"!==n&&"sort"!==n||"update"===n&&d&&"parentIndex"in r||"sort"===n&&s.isSyncingDataOnLoad)){var h="add"===n&&a.some((function(e){return e.region&&!l.subGrids[e.region]}));if(!l.isConfiguring&&(h||l.isPainted&&(!o||"remove"!==n))){if("add"===n){var f,v=D(a);try{for(v.s();!(f=v.n()).done;){var g,m=f.value.region;if(!l.subGrids[m])l.add(l.createSubGrid(m,null===(g=l.subGridConfigs)||void 0===g?void 0:g[m]))}}catch(e){v.e(e)}finally{v.f()}}else if("update"===n){var p=c[0];if(("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r)&&!("region"in r)){var y=i.region;return s.visibleColumns.forEach((function(e){e.region===y&&e.repaintOnResize&&l.refreshColumn(e)})),void l.afterColumnsChange({type:t,action:n,changes:r,column:i})}if("text"in r&&d)return void i.subGrid.refreshHeader();if("hidden"in r){var k=l.getSubGridFromColumn(i.id);k.header.fixHeaderWidths(),k.footer.fixFooterWidths(),k.updateHasFlex()}else if(d&&!(p in bm)&&!i.hidden&&!i.subGrid.collapsed)return i.subGrid.refreshHeader(),void l.refreshColumn(i)}else"remove"===n&&a.forEach((function(e){var t;return null===(t=e.freeColumnWidgets)||void 0===t?void 0:t.call(e)}));if("dataset"===n||"batch"===n||"update"===n&&"region"in r){var b=s.getDistinctValues("region",!0),C=$e.delta(b,l.regions,!0),w=C.toRemove,S=C.toAdd;l.remove(w.map((function(e){return l.getSubGrid(e)}))),l.add(S.map((function(e){return l.createSubGrid(e,l.subGridConfigs[e])})))}if(u&&!s.includes(u)){var x=s.indexOf(s.findRecord("type","rownumber"))+1;s.insert(x,u,!0)}l._suspendRenderContentsOnColumnsChanged||l.renderContents(),l.syncFlexedSubCols(),l.bodyElement.setAttribute("aria-colcount",s.visibleColumns.length),l.afterColumnsChange({type:t,action:n,changes:r,column:i,columns:a})}}}},{key:"onColumnsResized",value:function(e){var t=e.changes,n=e.record,r=this;if(!r.isConfiguring){var i=li.setLength(n.width),a=li.setLength(n.minWidth),o=li.setLength(n.maxWidth),l=r.getSubGridFromColumn(n.id);if(l.header.fixHeaderWidths(),l.footer.fixFooterWidths(),l.updateHasFlex(),!n.flex||!n.childLevel){r.cellEls&&n===r.lastColumnResized||(r.cellEls=li.children(r.element,'.b-grid-cell[data-column-id="'.concat(n.id,'"]')),r.lastColumnResized=n);var s,u=D(r.cellEls);try{for(u.s();!(s=u.n()).done;){var c,d=s.value;if("width"in t&&(d.style.width=i),"minWidth"in t&&(d.style.minWidth=a),"maxWidth"in t&&(d.style.maxWidth=o),"flex"in t)d.style.flex=null!==(c=n.flex)&&void 0!==c?c:null}}catch(e){u.e(e)}finally{u.f()}}r.resizingColumns||r.afterColumnsResized(n),r.syncFlexedSubCols()}}},{key:"afterColumnsResized",value:function(e){var t=this;t.eachSubGrid((function(t){t.collapsed||e&&e.region!==t.region||(t.fixWidths(),t.fixRowWidthsInSafariEdge())})),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}},{key:"syncFlexedSubCols",value:function(){var e=this.columns.query((function(e){return e.flex&&e.childLevel&&e.element}));if(e){var t,n=D(e);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=i.element.getBoundingClientRect().width,o=D(li.children(this.element,'.b-grid-cell[data-column-id="'.concat(i.id,'"]')));try{for(o.s();!(r=o.n()).done;){r.value.style.flex="0 0 ".concat(a,"px")}}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"bufferedAfterColumnsResized",value:function(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((function(t){t.collapsed||e&&e.region!==t.region||t.refreshFakeScroll()}))}},{key:"bufferedElementResize",value:function(){this.refreshRows()}},{key:"onInternalResize",value:function(e,n,r,i,a){li.scrollBarWidth&&n<i&&this.eachSubGrid((function(e){e.flex&&e.onElementResize(e.element)})),B(t,"onInternalResize",this,3)(arguments),this.isPainted&&n!==i&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}},{key:"changeRowManager",value:function(e,t){var n=this;if(n._isRowMeasured||n.measureRowHeight(),null==t||t.destroy(),e){var r=xg.new({grid:n,rowHeight:n.rowHeight,rowScrollMode:n.rowScrollMode||"move",autoHeight:n.autoHeight,fixedRowHeight:n.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:n}},e);return n.relayEvents(r,["beforeRenderRow","renderRow","removeRows"]),n._rowManager=null,r}}},{key:"updateRowHeight",value:function(e){!this.isConfiguring&&this.rowManager&&(this.rowManager.rowHeight=e),this.element.style.setProperty("--b-grid-row-height",li.setLength(e))}},{key:"updateFixedRowHeight",value:function(e){var t,n;e&&null!==(t=this.columns||this.peekConfig("columns"))&&void 0!==t&&null!==(n=t.some)&&void 0!==n&&n.call(t,(function(e){return e.autoHeight}))&&console.warn("One or more columns have `autoHeight` set, which is incompatible with `fixedRowHeight`.")}},{key:"getRowHeight",value:function(e){return e.rowHeight}},{key:"processRowHeight",value:function(e,t){}},{key:"getAsyncEventSuffixForStore",value:function(e){return this.asyncEventSuffix}},{key:"bindStore",value:function(e){var n,r=this.getAsyncEventSuffixForStore(e),i=e.masterStore;e.ion((S(S(S(S(S(S(S(S(S(S(n={name:pm},"refresh".concat(r),"onStoreDataChange"),"add".concat(r),"onStoreAdd"),"remove".concat(r),"onStoreRemove"),"replace".concat(r),"onStoreReplace"),"removeAll".concat(r),"onStoreRemoveAll"),"move".concat(r),e.tree?null:"onFlatStoreMove"),"change","relayStoreDataChange"),"idChange","onStoreRecordIdChange"),"update","onStoreUpdateRecord"),"beforeRequest","onStoreBeforeRequest"),S(S(S(S(S(S(S(S(S(n,"afterRequest","onStoreAfterRequest"),"exception","onStoreException"),"commit","onStoreCommit"),"clearChanges","onStoreRecordClearChanges"),"startApplyChangeset","internalOnStoreStartApplyChangeset"),"endApplyChangeset","internalOnStoreEndApplyChangeset"),"lazyLoadStarted","onStoreBeforeRequest"),"lazyLoadEnded","onStoreAfterRequest"),"thisObj",this))),null==i||i.ion({name:pm,beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",lazyLoadEnded:"onStoreAfterRequest",thisObj:this}),B(t,"bindStore",this,3)([e])}},{key:"unbindStore",value:function(e){this.detachListeners(pm),this.destroyStore&&e.destroy()}},{key:"$store",get:function(){return this.originalStore||this.store}},{key:"changeStore",value:function(e){if(null==e)return null;var t;("string"==typeof e&&(e=Ff.getStore(e)),e.isStore)||((e=Be.assign({data:this.data,tree:Boolean(null===(t=this.initialConfig.features)||void 0===t?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=Cg),e=new(e.readUrl?Pf:Ff)(e));return e}},{key:"updateStore",value:function(e,n){var r,i,a=this;(null===(r=B(t,"updateStore",this,3))||void 0===r||r([e,n]),n&&a.unbindStore(n),e&&(n&&a.deselectAll(),a.onStoreLoadOverride(),a.bindStore(e)),a.trigger("bindStore",{store:e,oldStore:n}),a.isDestroying||!a.isPainted||a.refreshSuspended)||(null===(i=a._rowManager)||void 0===i||i.reinitialize())}},{key:"onStoreUpdateRecord",value:function(e){var t=e.source,n=e.record,r=e.changes,i=this;if(!i.refreshSuspended)if(i.forceFullRefresh)i.rowManager.refresh(),i.forceFullRefresh=!1;else{var a;if(n.isFieldModified("id")&&(a=i.getRowFor(n.meta.modified.id)),!(a=a||i.getRowFor(n)))return;if(i.fullRowRefresh||n.isSpecialRow){var o=t.indexOf(n);-1!==o&&a.render(o,n)}else i.columns.visibleColumns.forEach((function(e){var t=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||r[t]){var n=a.getCell(t);n&&a.renderCell(n)}}))}}},{key:"refreshFromRowOnStoreAdd",value:function(e,t){var n=this,r=n.rowManager;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),1===n.store.count&&n.callEachSubGrid("refreshFakeScroll")}},{key:"onMaskAutoClose",value:function(e){B(t,"onMaskAutoClose",this,3)([e]),this.toggleEmptyText()}},{key:"onStoreAdd",value:function(e){var t=e.source,n=e.records,r=e.index,i=e.oldIndex,a=e.isChild,o=e.oldParent,l=e.parent,s=e.isMove,u=e.isExpand,c=e.isExpandAll,d=this,h=d.rowManager;if(d.isPainted&&!c&&!d.refreshSuspended){if(u&&d.animateTreeNodeToggle)return h.insert(h.getRowFor(l).index+1,n.length);var f=s&&n.some((function(e){if(s[e.id]){var n=t.getById(e.meta.modified.parentId);return(null==n?void 0:n.isExpanded(t))&&(null==n?void 0:n.ancestorsExpanded(t))}}));if(!a||n[0].ancestorsExpanded(t)||f){h.calculateRowCount(!1,!0,!0),t.isFiltered&&(r=t.indexOf(n[0]));var v=h.topIndex,g=h.rows,m=h.rowCount,p=h.topIndex+h.rowCount-1,y=r,k=r+n.length-1,b=p>=t.count-n.length-1;o||i>-1||a&&s&&Object.values(s).some((function(e){return e}))?h.refresh():y>=v&&y<v+m?d.refreshFromRowOnStoreAdd.apply(d,[g[y-v]].concat(Array.prototype.slice.call(arguments))):k>=v&&k<v+m?h.refresh():(b&&r>p?h.fillBelow(d._scrollTop||0):r<v&&h.refresh(),h.estimateTotalHeight(!0))}else if(!l.isLeaf){var C=h.getRowById(l);C&&h.renderRows([C])}}}},{key:"onStoreException",value:function(e){var t,n,r=e.action,i=e.type,a=e.response,o=e.exceptionType,l=e.error,s=this;switch(i){case"server":n=a.message||s.L("L{unspecifiedFailure}");break;case"exception":n="network"===o?s.L("L{networkFailure}"):(null==l?void 0:l.message)||(null==a||null===(t=a.parsedJson)||void 0===t?void 0:t.message)||s.L("L{parseFailure}")}s.applyMaskError('<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">'.concat(s.L("read"===r?"L{loadFailedMessage}":"L{syncFailedMessage}"),"</div>\n                ").concat(null!=a&&a.url?'<div class="b-grid-load-fail">'.concat(a.url,"</div>"):"",'\n                <div class="b-grid-load-fail">').concat(s.L("L{serverResponse}"),'</div>\n                <div class="b-grid-load-fail">').concat(n,"</div>\n            </div>"))}},{key:"onStoreDataChange",value:function(e){var n,r=e.action,i=e.changes,a=e.source,o=e.removed,l=e.added;null===(n=B(t,"onStoreDataChange",this,3))||void 0===n||n(arguments);var s=this,u=s.rowManager,c=u.rowCount,d=(null==o?void 0:o.length)||0;if(!s.refreshSuspended&&u){if("filter"===r&&d&&(null==l||!l.length)&&c&&d<c&&o.every((function(e){return u.getRowById(e.id)}))){var h=o.map((function(e){return u.getRowFor(e).index})).sort(wm),f=h.length;if(f&&h[f-1]===h[0]+f-1){var v=s.animateRemovingRows;s.animateRemovingRows=!s.features.cellEdit.isEditing&&s.animateFilterRemovals;var g=s.onStoreRemove({action:r,source:a,records:o});return s.animateRemovingRows=v,g}}if("dataset"!==r||(u.clearKnownHeights(),!a.isTree||!a.isFiltered)){var m=a.isGrouped&&i&&a.groupers.some((function(e){return e.rootFieldName in i}));s.isPainted&&!m&&s.renderRows(Boolean(!(r in km)||s.preserveScrollOnDatasetChange||a.isChained&&a.isFillingFromMaster)),s.toggleEmptyText()}}}},{key:"onStoreRecordIdChange",value:function(){var e;null===(e=B(t,"onStoreRecordIdChange",this,3))||void 0===e||e(arguments)}},{key:"onStoreBeforeRequest",value:function(e){this.isLockedRows||this.store.count&&this.store.lazyLoad&&(null==e||!e.isReload)||this.applyLoadMask()}},{key:"onStoreAfterRequest",value:function(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}},{key:"needsFullRefreshOnStoreRemove",value:function(e){var t,n=e.isCollapse,r=this.store;return(null===(t=this.features)||void 0===t||null===(t=t.group)||void 0===t?void 0:t.enabled)&&r.isGrouped||r.tree&&!n&&r.modelClass.convertEmptyParentToLeaf}},{key:"onStoreRemove",value:function(e){var n,r=arguments;e.source;var i=e.records,a=e.isCollapse,o=e.isChild,l=e.isMove,s=e.isCollapseAll;if(this.isPainted&&!l&&!s){null===(n=B(t,"onStoreRemove",this,3))||void 0===n||n(arguments);var u=this,c=u.rowManager;if(c.invalidateKnownHeight(i),!u.refreshSuspended)if(!u.animateRemovingRows||a||o)if(a&&u.animateTreeNodeToggle){var d=i.flatMap((function(e){var t=c.getRowFor(e);return t?t.index:Cm})).sort(wm),h=d.length;if(h&&d[h-1]===d[0]+h-1)return c.insert(d[0],-d.length)}else if(u.needsFullRefreshOnStoreRemove.apply(u,arguments))c.refresh(),u.afterRemove(arguments[0]);else{var f=c.rows,v=i.reduce((function(e,t){var n=c.getRowById(t.id);return n&&(e=Math.min(e,f.indexOf(n))),e}),f.length);f[v]?!u.refreshSuspended&&c.renderFromRow(f[v]):c.trigger("changeTotalHeight",{totalHeight:c.totalHeight}),u.trigger("rowRemove",{isCollapse:a}),u.afterRemove(arguments[0])}else{var g=i.reduce((function(e,t){var n=c.getRowById(t.id);return n&&e.push(n),e}),[]);if(g.length){var m=g[0];u.isAnimating=!0,fr.onTransitionEnd({element:m._elementsArray[0],property:"left",duration:u.transitionDuration+50,thisObj:u,handler:function(){u.isAnimating=!1,g.forEach((function(e){return!e.isDestroyed&&e.removeCls("b-removing")})),c.refresh(),u.trigger("rowRemove"),u.afterRemove(r[0])}}),g.forEach((function(e){return e.addCls("b-removing")}))}}}}},{key:"onFlatStoreMove",value:function(e){var t=e.from,n=e.to,r=this.rowManager,i=this.store,a=r.topIndex,o=r.rowCount,l=_([t,n].sort((function(e,t){return e-t})),2),s=l[0],u=l[1],c=i.indexOf(i.getAt(s,!0)),d=i.indexOf(i.getAt(u,!0));c>=a&&c<a+o?r.renderFromRow(r.rows[c-a]):d>=a&&d<a+o&&r.refresh()}},{key:"onStoreReplace",value:function(e){var t=this,n=e.records,r=e.all,i=this.rowManager;if(r)i.clearKnownHeights(),i.refresh();else{var a=n.reduce((function(e,n){var r=_(n,2)[1],i=t.getRowFor(r);return i&&e.push(i),e}),[]);i.invalidateKnownHeight(n),i.renderRows(a)}}},{key:"relayStoreDataChange",value:function(e){var t;if(null===(t=this.ariaElement)||void 0===t||t.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",F(F({},e),{},{store:e.source,source:this}))}},{key:"onStoreRemoveAll",value:function(){var e;null===(e=B(t,"onStoreRemoveAll",this,3))||void 0===e||e(arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}},{key:"onStoreCommit",value:function(e){var t=this,n=e.changes;if(this.showDirty&&n.modified.length){var r=[];n.modified.forEach((function(e){var n=t.rowManager.getRowFor(e);n&&r.push(n)})),this.rowManager.renderRows(r)}}},{key:"onStoreRecordClearChanges",value:function(e){var t=e.record,n=this.rowManager.getRowFor(t);n&&this.rowManager.renderRows([n])}},{key:"internalOnStoreStartApplyChangeset",value:function(){this.suspendRefresh(),this.constructor.bindStoreChangeset&&this.captureScrollTargetRow()}},{key:"internalOnStoreEndApplyChangeset",value:function(){this.resumeRefresh(!0),this.constructor.bindStoreChangeset&&this.restoreScrollTargetRow()}},{key:"captureScrollTargetRow",value:function(){var e=this;if(e.preserveScroll){var t=e.rowManager,n=t.firstFullyVisibleRow,r=t.lastVisibleRow;if(n){e.lastVisibleRowIds=[n.id];for(var i=n.dataIndex+1;i<=r.dataIndex;i++)e.lastVisibleRowIds.push(e.rowManager.getRow(i).id);e.lastTopRowOffset=e.scrollable.getDeltaTo(n.element,{block:"start",x:!1,constrainToScrollable:!1})}}}},{key:"restoreScrollTargetRow",value:function(){var e=this,t=!1;if(e.preserveScroll){if(e.lastVisibleRowIds){e.rowManager.refresh(),e.scrollable.scrollHeight>=e.lastOverscrollHeight&&e.scrollable.y===e.lastOverscrollY?e.rowManager.fillBelow(e.scrollable.y):(e.lastOverscrollHeight=null,e.lastOverscrollY=null);var n=e.lastVisibleRowIds.find((function(t){return e.store.getById(t)}));if(n!=i&&n!==e.rowManager.firstFullyVisibleRow.id){if(e.preserveScroll.overscroll){var r=e.scrollable.getDeltaTo(e.getRecordCoords(n),{block:"start",x:!1,constrainToScrollable:!1,edgeOffset:e.lastTopRowOffset.yDelta}).yDelta;r>e.scrollable.maxY-e.scrollable.y&&(e.scrollable.scrollHeight+=r,t=!0)}e.scrollRowIntoView(n,{block:"start",edgeOffset:e.lastTopRowOffset.yDelta,x:!1})}}e.lastVisibleRowIds=i,e.lastTopRowOffset=i,t&&(e.lastOverscrollHeight=e.scrollable.scrollHeight,e.lastOverscrollY=e.scrollable.y)}}},{key:"data",get:function(){return this._store?this._store.records:this._data},set:function(e){this._store?this._store.data=e:this._data=e}},{key:"populateHeaderMenu",value:function(e){var t=e.column,n=e.items,r=this,i=r.subGrids,a=r.regions,o=t.parent,l=!0;Object.entries(i).forEach((function(e){var s=_(e,2),u=s[0],c=s[1];if(!c.sealedColumns&&t.draggable&&u!==t.region&&(!o&&i[t.region].columns.count>1||o&&o.children.length>1)){var d=c.element.compareDocumentPosition(i[t.region].element)===document.DOCUMENT_POSITION_PRECEDING,h=r.rtl?!d:d,f=a.length>2?r.L("L{moveColumnTo}",r.optionalL(u)):r.L(h?"L{moveColumnRight}":"L{moveColumnLeft}");n["".concat(u,"Region")]={targetSubGrid:u,text:f,icon:"b-fw-icon b-icon-column-move-"+(h?"right":"left"),separator:l,disabled:!t.allowDrag,onItem:function(e){var n=e.item,a=r.columns.indexOf(i[n.targetSubGrid].columns.last);t.traverse((function(e){return e.region=u})),r.columns.insert(a+1,t),r.scrollColumnIntoView(t)}},l=!1}}))}},{key:"populateCellMenu",value:function(e){e.record,e.items}},{key:"getColumnDragToolbarItems",value:function(e,t){return t}},{key:"normalizeCellContext",value:function(e){var t=this,n=t.columns;return e.isLocation?e:e.isModel?new cg({grid:t,id:e.id,columnId:n.visibleColumns[0].id}):new cg(Be.assign({grid:t},e))}},{key:"getCell",value:function(e){var t=this.store,n=this.columns,r=this.columns.visibleColumns,i=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,a=isNaN(e.column)?isNaN(e.columnIndex)?r.indexOf(e.column||n.getById(e.columnId)||n.get(e.field)||r[0]):e.columnIndex:e.column;return i>-1&&i<t.count&&a>-1&&a<r.length&&this.normalizeCellContext(e).cell||null}},{key:"getHeaderElement",value:function(e){return e.isModel&&(e=e.id),this.fromCache('.b-grid-header[data-column-id="'.concat(e,'"]'))}},{key:"getFooterElement",value:function(e){return e.isModel&&(e=e.id),this.fromCache('.b-grid-footer[data-column-id="'.concat(e,'"]'))}},{key:"getHeaderElementByField",value:function(e){var t=this.columns.get(e);return t?this.getHeaderElement(t):null}},{key:"bodyHeight",get:function(){return this._bodyHeight}},{key:"headerHeight",get:function(){var e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}},{key:"footerHeight",get:function(){var e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}},{key:"isTreeGrouped",get:function(){var e;return Boolean(null===(e=this.features.treeGroup)||void 0===e?void 0:e.isGrouped)}},{key:"getRecordFromElement",value:function(e){var t=e.closest(".b-grid-row");return t?this.$store.getById(t.dataset.id):null}},{key:"getColumnFromElement",value:function(e){var t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);var n=wa.get(t);return this.columns.getById(n.columnId)}},{key:"updateAutoHeight",value:function(e){Be.assertBoolean(e,"autoHeight")}},{key:"updateColumnLines",value:function(e){Be.assertBoolean(e,"columnLines"),li.toggleClasses(this.element,"b-no-column-lines",!e)}},{key:"updateRowLines",value:function(e){li.toggleClasses(this.element,"b-no-row-lines",!e)}},{key:"keyMapElement",get:function(){return this.bodyElement}},{key:"fixSizes",value:function(){this.callEachSubGrid("fixWidths");for(var e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0"),t=0,n=e.length;t<n;t++)e[t].setAttribute("aria-colindex",t+1)}},{key:"onRowManagerChangeTotalHeight",value:function(e){var t=e.totalHeight,n=e.immediate;return this.refreshTotalHeight(t,n)}},{key:"refreshTotalHeight",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.rowManager.totalHeight,t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this;if(n.renderingRows||!n.isVisible)return!1;var r=n.scrollable,a=Math.abs(n.virtualScrollHeight-e),o=n._bodyRectangle.height;if(a){var l=e-o-n._scrollTop<2*o||n._verticalScrollHeight&&n._verticalScrollHeight-o<n._scrollTop;r.scrollHeight=n.virtualScrollHeight=e,n.isPainted&&(n.scrolling&&!l||a<100)&&!t?n.bufferedFixElementHeights():(n.virtualScrollHeightDirty&&n.virtualScrollHeightDirty(),n.bufferedFixElementHeights.cancel(),n.fixElementHeights())}}},{key:"fixElementHeights",value:function(){var e=this,t=e.virtualScrollHeight,n="".concat(t,"px");e._verticalScrollHeight=t,e.verticalScroller.style.height=n,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e._height=null,e.bodyContainer.style.height=n,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}},{key:"refreshBodyRectangle",value:function(){return this._bodyRectangle=pt.client(this.bodyContainer)}},{key:"scrolling",get:function(){return this._scrolling},set:function(e){this._scrolling=e}},{key:"enableScrollingCloseToEdges",value:function(e){var t=this;this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"}].concat(z($e.asArray(e||[]).map((function(e){return{element:("string"==typeof e?t.subGrids[e]:e).scrollable.element}})))),direction:"horizontal"})}},{key:"disableScrollingCloseToEdges",value:function(e){var t=this;this.scrollManager.stopMonitoring([this.scrollable.element].concat(z($e.asArray(e||[]).map((function(e){return("string"==typeof e?t.subGrids[e]:e).element})))))}},{key:"onRowManagerRequestScrollChange",value:function(e){var t=e.bottom;this.scrollable.y=t-this.bodyHeight}},{key:"initScroll",value:function(){var e=this,t=e.scrollable;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),ne.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}},{key:"onGridVerticalScroll",value:function(e){var t=this,n=e.source.y;n!==t._scrollTop&&(t._scrollTop=n,t.scrolling||(t.scrolling=!0,t.eachSubGrid((function(e){return e.suspendResizeMonitor=!0}))),t.rowManager.updateRenderedRows(n),t.afterScroll({scrollTop:n}),t.trigger("scroll",{scrollTop:n}))}},{key:"onGridVerticalScrollEnd",value:function(e){this.scrolling=!1,this.eachSubGrid((function(e){return e.suspendResizeMonitor=!1})),this.trigger("verticalScrollEnd",e)}},{key:"scrollRowIntoView",value:(o=f((function(e){var t=arguments,n=this,r=arguments.length>1&&arguments[1]!==i?arguments[1]:ym;return L().mark((function i(){var a,o,l,s,u,c,d,h,f,v,g,m,p;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=n,o=r.block||"nearest",l=a.rowManager,!(s=a.store.getById(e))){i.next=40;break}if(a.isLockedRows&&a.syncSplits((function(e){return e.scrollRowIntoView.apply(e,z(t))})),-1!==a.store.indexOf(s)){i.next=5;break}return i.abrupt("return",mm);case 5:if(a.rowManager.topRow){i.next=8;break}return i.next=8,a.await("renderRows");case 8:if(c=a.scrollable,d=a.getRecordCoords(s),h=pt.from(c.element),!d.virtual){i.next=36;break}if(f=d.block,v="nearest"!==o?r:{block:f},u=c.scrollIntoView(d,{block:"center"}),l.scrollTargetRecordId=s,l.updateRenderedRows(c.y,!0),d=a.getRecordCoords(s),l.lastScrollTop=c.y,!d.virtual){i.next=19;break}return i.abrupt("return",mm);case 19:if(!r.animate){i.next=29;break}return c.suspendEvents(),"end"===o||"nearest"===o&&"end"===f?c.y-=h.bottom-d.bottom:("start"===o||"nearest"===o&&"start"===f)&&(c.y+=d.y-h.y),l.updateRenderedRows(c.y,!1,!0),"end"===f?c.y-=l.appendRowBuffer*l.rowHeight-1:c.y+=l.prependRowBuffer*l.rowHeight-1,c.resumeEvents(),i.next=27,c.scrollIntoView(a.getRecordCoords(s),Object.assign({},r,v));case 27:i.next=34;break;case 29:if(r.recursive){i.next=32;break}return i.next=32,u;case 32:return i.next=34,null===(g=a.scrollRowIntoView)||void 0===g?void 0:g.call(a,s,Object.assign({recursive:!0},r,v));case 34:i.next=40;break;case 36:return(m=r.column)?(m.isModel||(m=a.columns.getById(m)||a.columns.get(m)),m&&(c=a.getSubGridFromColumn(m).scrollable,p=pt.from(l.getRowFor(s).getCell(m.id)),d.x=p.x,d.width=p.width)):r=Be.assign({},r,{x:!1}),i.next=40,c.scrollIntoView(d,r);case 40:case"end":return i.stop()}}),i)}))()})),function(e){return o.apply(this,arguments)})},{key:"scrollColumnIntoView",value:function(e,t){e=e instanceof yg?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e);var n=this.getSubGridFromColumn(e);return n.columns.visibleColumns.length>1?n.scrollColumnIntoView(e,t):Promise.resolve()}},{key:"scrollCellIntoView",value:function(e,t){var n=this.normalizeCellContext(e);return this.scrollRowIntoView(n.id,F({column:n.columnId},"boolean"==typeof t?{animate:t}:t))}},{key:"scrollToBottom",value:function(e){return this.scrollRowIntoView(this.isLockedRows?this.originalStore.last:this.store.last,e)}},{key:"scrollToTop",value:function(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}},{key:"storeScroll",value:function(){var e=this.storedScrollState={scrollTop:this.scrollable.y,scrollLeft:{}};return this.eachSubGrid((function(t){e.scrollLeft[t.region]=t.scrollable.x})),e}},{key:"restoreScroll",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.storedScrollState;this.eachSubGrid((function(t){var n,r=e.scrollLeft[t.region];null!=r&&(t.scrollable.updateX(r),t.header.scrollable.updateX(r),t.footer.scrollable.updateX(r),null===(n=t.fakeScroller)||void 0===n||n.updateX(r))})),this.restoreVerticalScroll(e)}},{key:"restoreVerticalScroll",value:function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:this.storedScrollState,n=this.rowManager;n.rowCount?this.scrollable.updateY(t.scrollTop):n.ion({changeTotalHeight:function(){return e.restoreVerticalScroll(t)},once:!0})}},{key:"beginGridMeasuring",value:function(){var e=this;if(e.element.classList.add("b-grid-measuring"),e.$measureCellElements||(e.$measureCellElements=li.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:ne.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){var t=e.appendTo||e.insertBefore||document.body,n=li.getRootElement("string"==typeof t?document.getElementById(t):t)||document.body;e.adopt&&n.contains(e.element)||(n.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}},{key:"endGridMeasuring",value:function(){var e=this;e.element.classList.remove("b-grid-measuring"),e.$removeAfterMeasuring&&(e.element.remove(),e.$removeAfterMeasuring=!1),e.$measureCellElements.subGridElement.remove()}},{key:"measureRowHeight",value:function(){var e=this,t=e.beginGridMeasuring().rowElement,n=parseFloat(li.getStyleValue(document.body,"zoom"))||1,r=li.getStyleValue(t,["height","border-top-width","border-bottom-width"]),i=parseInt(r.height),a=li.devicePixelRatio,o=n*(ne.isFirefox?a/Math.max(Math.trunc(a),1):1),l=r["border-top-width"]?Math.round(o*parseFloat(r["border-top-width"])):0,s=r["border-bottom-width"]?Math.round(o*parseFloat(r["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(i)&&i?i:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=l+s,e._isRowMeasured=!0,e.endGridMeasuring()}},{key:"onThemeChange",value:function(e){var t=e.theme;this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:t})}},{key:"refreshRow",value:function(e){this.refreshRows([e])}},{key:"refreshRows",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,t=arguments.length>1&&arguments[1]!==i&&arguments[1];if(!this.refreshSuspended){var n=this.element,r=this.rowManager;if(e){var a=e.flatMap((function(e){var t;return null!==(t=r.getRowById(e))&&void 0!==t?t:[]}));r.renderRows(a)}else n.classList.add("b-notransition"),t?r.returnToTop():r.refresh(!0),n.classList.remove("b-notransition")}}},{key:"refreshColumn",value:function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1];e.isVisible&&this.runWithTransition((function(){e.isLeaf?t.rowManager.forEach((function(t){return t.renderCell(t.getCell(e.id))})):e.children.forEach((function(e){return t.refreshColumn(e)}))}),n)}},{key:"refreshVirtualScrollbars",value:function(){var e=this,t=e.headerContainer,n=e.footerContainer,r=e.virtualScrollers,i=e.scrollable,a=e.hasVerticalOverflow,o=!r.classList.contains("b-hide-display"),l=Object.values(e.subGrids).some((function(e){return e.overflowingHorizontally})),s=l!==o;if(s&&r.classList.toggle("b-hide-display",!l),li.scrollBarWidth){var u=a||"scroll"===i.overflowY;t.classList.toggle("b-show-yscroll-padding",u),n.classList.toggle("b-show-yscroll-padding",u),r.classList.toggle("b-show-yscroll-padding",u),!s&&e.$virtualScrollbarsRefreshed||(e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}},{key:"hasVerticalOverflow",get:function(){return this.scrollable.hasOverflow("y")}},{key:"contentHeight",get:function(){var e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}},{key:"onContentChange",value:function(){var e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(e.autoHeight),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}},{key:"triggerPaint",value:function(){this.isPainted||this.refreshBodyRectangle(),B(t,"triggerPaint",this,3)([])}},{key:"onHeightChange",value:function(){var e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}},{key:"suspendRefresh",value:function(){this.refreshSuspended++}},{key:"resumeRefresh",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0];this.refreshSuspended&&! --this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}},{key:"renderRows",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this,n=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(n),t.autoHeight&&t.store.count>200&&!t.autoHeightWarning&&!t.disableAutoHeightWarning&&(console.warn("Warning: 'autoHeight' is enabled for a large number of rows (200+). While 'autoHeight' provides flexibility, it should be used cautiously as it disables virtualization, leading to significant performance degradation with large datasets. Consider alternatives to maintain optimal performance."),t.autoHeightWarning=!0),t.element.classList.remove("b-grid-refreshing"))}},{key:"renderContents",value:function(){var e=this,t=e.element,n=e.headerContainer,r=e.footerContainer,i=e.rowManager;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader"),e.callEachSubGrid("refreshFooter"),e.renderHeader(n,t),e.renderFooter(r,t),e.fixSizes();var a=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.setPosition(a),e.renderRows()}}},{key:"refreshHeaders",value:function(){this.callEachSubGrid("refreshHeader")}},{key:"refreshHeader",value:function(e){e.subGrid.refreshHeader()}},{key:"onPaintOverride",value:function(){}},{key:"onStoreLoadOverride",value:function(){}},{key:"onInternalPaint",value:function(e){var n,r=e.firstPaint,i=this;if(i.ariaElement.setAttribute("aria-rowcount",i.store.count+1),null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n(arguments),!i.onPaintOverride()&&r){var a,o=i.rowManager,l=i.store,s=i.element,u=i.headerContainer,c=i.bodyContainer,d=i.footerContainer,h=li.scrollBarPadElement,f=0;i.role=null!=l&&l.isTree?"treegrid":"grid",i.columns.ion({change:function(){return a=!0},once:!0}),i.updateResponsive(i.width,0),a&&(i.callEachSubGrid("refreshHeader",u),i.callEachSubGrid("refreshFooter",d)),i.renderHeader(u,s),i.renderFooter(d,s),li.append(u,h),li.append(d,h),li.append(i.virtualScrollers,h),i.refreshBodyRectangle();var v=i.bodyContainer.offsetHeight;if(i.autoHeight?(i._bodyHeight=o.initWithHeight(s.offsetHeight-u.offsetHeight-d.offsetHeight,!0),c.style.height=i.bodyHeight+"px"):(i._bodyHeight=v,o.initWithHeight(i._bodyHeight,!0)),i.eachSubGrid((function(e){e.header.maxDepth>f&&(f=e.header.maxDepth)})),u.dataset.maxDepth=f,i.fixSizes(),!l.count&&l.isLoading||i.renderRows(),i.columns.usesAutoHeight){var g=document.fonts;"loaded"!==(null==g?void 0:g.status)&&g.ready.then((function(){return!i.isDestroyed&&i.refreshRows()}))}i.initScroll(),i.initInternalEvents()}}},{key:"render",value:function(){var e,n=this;(n.requireSize=Boolean(n.owner),B(t,"render",this,3)(arguments),n.setupFocusListeners(),n.autoHeight)||(n.headerContainer.offsetHeight&&!n.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),n.splitFrom||null!==(e=n.features.split)&&void 0!==e&&e.owner||"minHeight"in n.initialConfig||"height"in n.initialConfig||parseInt(r.getComputedStyle(n.element).minHeight)!==n.height||console.warn("The ".concat(n.$$name," is sized by its predefined minHeight, likely this is not intended. ")+'Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.'))}},{key:"renderHeader",value:function(e,t){}},{key:"renderFooter",value:function(e,t){}},{key:"beforeRenderCell",value:function(){}},{key:"beforeRenderRow",value:function(){}},{key:"afterRenderRow",value:function(){}},{key:"afterScroll",value:function(){}},{key:"processCellEditor",value:function(e){}},{key:"afterColumnsChange",value:function(){B(t,"afterColumnsChange",this,3)(arguments)}},{key:"afterRemove",value:function(e){}},{key:"afterToggleGroup",value:function(){}},{key:"afterToggleSubGrid",value:function(){}},{key:"onConfigChange",value:function(e){B(t,"onConfigChange",this,3)([e]),this.isConfiguring||this.afterConfigChange(e)}},{key:"afterPluginConfigChange",value:function(){}},{key:"afterConfigChange",value:function(e){}},{key:"afterAddListener",value:function(e,t){}},{key:"afterRemoveListener",value:function(e,t){}},{key:"syncMaskCover",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.masked;if(e){var t="body"===e.cover&&this.rectangleOf("bodyContainer"),n=t&&li.scrollBarWidth&&this.rectangleOf("virtualScrollers"),r=e.element.style;r.marginTop=t?"".concat(t.y,"px"):"",r.height=t?"".concat(t.height+((null==n?void 0:n.height)||0),"px"):""}}},{key:"changeMasked",value:function(e,n){if(e){var r=this;"string"==typeof e&&(e={text:e}),r.isLockedRows||r.splitFrom?(e.cover=null,e.target=r.element.parentElement):(e.cover="body",e.target=r.element)}return B(t,"changeMasked",this,3)([e,n])}},{key:"maskBody",value:function(e){var t;return this.bodyContainer&&(this.masked=gs.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}},{key:"unmaskBody",value:function(){this.masked=null}},{key:"updateEmptyText",value:function(e){var t,n,r;null===(t=this.emptyTextEl)||void 0===t||t.remove();var i="object"===W(e);i&&(e=$e.asArray(e)),this.emptyTextEl=li.createElement(S({parent:null===(n=this.firstItem)||void 0===n?void 0:n.element,className:"b-empty-text"},i?"children":null!==(r=e)&&void 0!==r&&r.includes("<")?"html":"text",e))}},{key:"toggleEmptyText",value:function(){var e=this,t=e.isLockedRowsView?e.store.$master:e.store,n=!(t.count>0||t.isLoading||t.isCommitting);e.element.classList.toggle("b-grid-empty",n),e.announceAriaLive(n?e.emptyText:"")}},{key:"updateReadOnly",value:function(e,n){if(B(t,"updateReadOnly",this,3)([e,n]),!this.isConfiguring){var r,i=D(this.columns.bottomColumns);try{for(i.s();!(r=i.n()).done;){var a,o=r.value;null===(a=o.updateReadOnly)||void 0===a||a.call(o,e)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]),r=this.store,i=r.getInlineData(e),a=r.getCurrentConfig(e)||n.store;return i.length&&(n.data=i),a&&r.originalModelClass===Cg&&delete a.modelClass,Be.isEmpty(a)||(n.store=a),n.store&&delete n.store.data,n}},{key:"suspendAnimations",value:function(){this._animationSuspendedCounter++}},{key:"resumeAnimations",value:function(){this._animationSuspendedCounter--}},{key:"runWithTransition",value:(a=f(L().mark((function e(t,n){var r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,n&&r.isVisible&&0===r._animationSuspendedCounter&&!1!==r.enableEventAnimations){e.next=3;break}return e.abrupt("return",t());case 3:return r.isAnimating=!0,e.next=6,r.executeAndAwaitAnimations(r.element,t);case 6:r.isAnimating=!1,r.isDestroyed||r.isAnimating||r.trigger("transitionEnd");case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"waitForReadiness",value:(n=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.features.treeGroup)||void 0===t||null===(n=t.waitForReadiness)||void 0===n?void 0:n.call(t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"delayable",get:function(){return{bufferedAfterColumnsResized:250,bufferedElementResize:250}}},{key:"configurable",get:function(){return{autoHeight:null,disableAutoHeightWarning:null,disableNoIDWarning:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideHeaders:null,hideFooters:!0,cellEllipsis:!0,hideHorizontalScrollbar:null,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"$store",rowHeight:null,preserveScroll:!1,animateTreeNodeToggle:!Ne.isTestEnv,columnLines:!0,rowLines:!0,fixedRowHeight:null,formulaProviders:null}}},{key:"defaultConfig",get:function(){return{defaultRowHeight:45,fullRowRefresh:!0,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},resizeToFitIncludesHeader:!0,animateRemovingRows:!0,animateFilterRemovals:null,disableGridRowModelWarning:null,disableGridColumnIdWarning:null,headerClass:Ig,footerClass:Lg,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:Tg,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}},{key:"properties",get:function(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}}]);var n,a,o,l}(uc.mixin(Dc,wu,Vg,Yg,(function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onStoreRecordIdChange",value:function(e){var n;null===(n=B(t,"onStoreRecordIdChange",this,3))||void 0===n||n([e]);var r=this.focusedCell,i=e.oldValue,a=e.value;r&&r.id===i&&(r._id=a)}},{key:"onFocusedRowDerender",value:function(){var e=this,t=e.focusedCell;if(null!=(null==t?void 0:t.id)&&t.cell){var n=li.isDescendant(t.cell,li.getActiveElement(e));if(e.hideHeaders)n&&e.revertFocus();else{var r=e.normalizeCellContext({rowIndex:-1,columnIndex:n?t.columnIndex:0});n?e.focusCell(r):r.cell.tabIndex=0}t.cell.tabIndex=-1}}},{key:"navigateFirstCell",value:function(){this.focusCell(cg.FIRST_CELL)}},{key:"navigateFirstColumn",value:function(){this.focusCell(cg.FIRST_COLUMN)}},{key:"navigateLastCell",value:function(){this.focusCell(cg.LAST_CELL)}},{key:"navigateLastColumn",value:function(){this.focusCell(cg.LAST_COLUMN)}},{key:"navigatePrevPage",value:function(){this.focusCell(cg.PREV_PAGE)}},{key:"navigateNextPage",value:function(){this.focusCell(cg.NEXT_PAGE)}},{key:"activateCell",value:function(e){var t,n=this.focusedCell;if(n.isColumnHeader){if(e.target.classList.contains("b-grid-header")){var r,i=this.focusedCell.column;null===(r=i.onKeyDown)||void 0===r||r.call(i,e),this.getHeaderElement(i.id).click()}}else!n.isActionable&&null!==(t=n.actionTargets)&&void 0!==t&&t.length&&(e.preventDefault(),n.actionTargets[0].focus());return!1}},{key:"toggleCellActivate",value:function(e){var t,n=this.focusedCell;null!=n&&null!==(t=n.actionTargets)&&void 0!==t&&t.length&&(n.isActionable?this.deactivateCell(e):n.actionTargets[0].focus())}},{key:"deactivateCell",value:function(e){var t,n,r=this,i=r.focusedCell;!e.target.closest(".b-dragging")&&null!=i&&i.isActionable?(e.stopImmediatePropagation(),r._focusedCell=null,r.focusCell({rowIndex:i.rowIndex,column:i.column},{disableActionable:!0})):!r.isNested||!r.owner||null!==(t=(n=r.owner).catchFocus)&&void 0!==t&&t.call(n,{source:r})||r.revertFocus(!0)}},{key:"onTab",value:function(e){var t=e.target,n=this.focusedCell,r=this.bodyElement,i=n.isActionable,a=n.actionTargets,o=void 0===a?[]:a;if(i&&li.isEditable(t)&&!t.readOnly&&t===o[o.length-1])e.preventDefault(),this.navigateRight(e);else if(!i||t===o[o.length-1])return r.style.display="none",this.requestAnimationFrame((function(){return r.style.display=""})),!1}},{key:"onShiftTab",value:function(e){var t=this,n=e.target,r=t.focusedCell,i=t.bodyElement,a=r.cell,o=r.isActionable,l=r.actionTargets,s=o&&li.isEditable(n)&&!n.readOnly,u=0===r.columnIndex&&r.rowIndex===(t.hideHeaders?0:-1);if(!u&&s&&n===l[0])e.preventDefault(),t.navigateLeft(e);else if(!o||n===l[0]){var c=!u&&!t.hideHeaders&&t.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return c?(c.cell.tabIndex=-1,a.tabIndex=0,t._focusedCell=r):(i.style.display="none",t.requestAnimationFrame((function(){return i.style.display=""}))),!1}}},{key:"onSpace",value:function(e){return this.focusedCell.isActionable||e.preventDefault(),!1}},{key:"focusedCell",get:function(){return this._focusedCell},set:function(e){this.focusCell(e)}},{key:"isActionableLocation",get:function(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.isActionable}},{key:"focusedRecord",get:function(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.record}},{key:"cellCSSSelector",get:function(){var e=this._focusedCell;return e?"[data-index=".concat(e.rowIndex,"] [data-column-id=").concat(e.columnId,"]"):""}},{key:"afterHide",value:function(){B(t,"afterHide",this,3)(arguments),this.lastFocusedCell=null}},{key:"isFocused",value:function(e){var t;return Boolean(null===(t=this._focusedCell)||void 0===t?void 0:t.equals(this.normalizeCellContext(e)))}},{key:"focusElement",get:function(){if(!this.isDestroying){var e;if(this.store.count&&this._focusedCell)e=this._focusedCell.target;else if(!this.hideHeaders){var n;e=this.normalizeCellContext({rowIndex:-1,columnIndex:(null===(n=this._focusedCell)||void 0===n?void 0:n.columnIndex)||0}).target}var r=B(t,"focusElement",this,1);return!r||e&&e.compareDocumentPosition(r)!==Node.DOCUMENT_POSITION_PRECEDING?e:r}}},{key:"afterInternalPaint",value:function(e){var n,r;e.firstPaint;var i=this;null===(n=B(t,"afterInternalPaint",this,3))||void 0===n||n(arguments);var a=this.normalizeCellContext({rowIndex:i.hideHeaders?0:-1,column:i.hideHeaders?0:i.columns.find((function(e){return!e.hidden&&e.isFocusable}))});null!==(r=a.cell)&&void 0!==r&&r.getAttribute("tabIndex")&&(a._isDefaultFocus=!0,i._focusedCell=a,a.target===a.cell&&(a.cell.tabIndex=0))}},{key:"onGridBodyFocusIn",value:function(e){var t=this,n=t.bodyElement,r=t.focusedCell,i=(null==r?void 0:r.initialTarget)||(null==r?void 0:r.target),a=e.relatedTarget,o=e.browserEvent.target,l=o.closest(t.focusableSelector),s=o.closest(".b-grid-row");if(l&&(!Wn.currentMouseDown||Wn.isMouseDown(0)||Wn.isMouseDown(2))){var u,c=new cg(o),d=c.cell,h=null==r?void 0:r.cell,f=c.actionTargets=t.findFocusables(l),v=(!t._fromFocusCell||t.selectOnFocus)&&(o===d||!l.contains(o.closest('button, input, textarea, a, [contenteditable="true"], select, option'))||t._selectActionCell)&&!(null!=o&&o._isRevertingFocus);if(s&&-1===c.rowIndex)return void d.focus({preventScroll:!0});if(o.matches(t.focusableSelector)){if(t.disableActionable)c._target=d;else if(f.length){var g,m,p=null===(g=Wn.currentMouseDown)||void 0===g?void 0:g.target;if(!f.some((function(e){return e.contains(p)})))null===(m=t.onCellNavigate)||void 0===m||m.call(t,t,r,c,v),t.trigger("navigate",{lastFocusedCell:r,focusedCell:c,event:e});return t._selectActionCell=p===o,f[0].focus(),void delete t._selectActionCell}}else{var y;if(null!=r&&r.target&&a&&(!Wn.isMouseDown()||!n.contains(null===(y=Wn.currentMouseDown)||void 0===y?void 0:y.target))&&!n.contains(a)&&!c.equals(r))return void i.focus();c._target=o}if(h&&(h.classList.remove("b-focused"),h.tabIndex=-1),d&&(d.classList.add("b-focused"),c.column.onCellFocus(c),d===o&&(d.tabIndex=0),d.contains(e.relatedTarget)&&i===o))return;t._focusedCell=c,null===(u=t.onCellNavigate)||void 0===u||u.call(t,t,r,c,v),t.trigger("navigate",{lastFocusedCell:r,focusedCell:c,event:e})}else o.closest(".b-rowexpander-body")||null==i||i.focus({preventScroll:!0})}},{key:"findFocusables",value:function(e){var t=this.focusableFinder,n=[];t.currentNode=this.focusableFinderCell=e;for(var r=t.nextNode();r;r=t.nextNode())n.push(r);return n}},{key:"focusableFinder",get:function(){var e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,li.NodeFilter.SHOW_ELEMENT,{acceptNode:Kg.bind(e)})),e._focusableFinder}},{key:"restoreActiveItem",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this._focusedCell;if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}},{key:"focusCell",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:qg,a=this,o=a._focusedCell,l=r,s=l.scroll,u=l.disableActionable,c=e===cg.DOWN,d=e===cg.UP,h=e===cg.PREV_CELL||e===cg.NEXT_CELL,f=a.features.cellEdit;if(-1===(null===(t=e)||void 0===t?void 0:t.rowIndex)&&a.hideHeaders)a.revertFocus();else if("number"!=typeof e||null!=o&&o.isLocation){e="number"==typeof e&&null!=o&&o.isLocation?o.move(e):a.normalizeCellContext(e);var v="doSelect"in r?r.doSelect:!e.isActionable||e.initialTarget===e.cell;if(e.equals(o)){var g,m,p;if(a.isNested&&(c||d))null!==(g=a.owner)&&void 0!==g&&null!==(m=g.catchFocus)&&void 0!==m&&m.call(g,{source:a,navigationDirection:c?"down":"up"})||a.revertFocus(!0);else null===(p=a.onCellNavigate)||void 0===p||p.call(a,a,o,e,v);return o}if(null!=f&&f.isEditing&&!e.equals(f.editorContext)&&f.getEditingContext(e))return f.startEditing(e),e;var y=a.getSubGridFromColumn(e.columnId),k=e.cell||a.getCell({rowIndex:a.rowManager.topIndex,columnId:e.columnId}),b=pt.from(y.element),C=pt.from(a.bodyElement),w=pt.from(k).moveTo(null,b.y);if(!1!==s)if(-1===e.rowIndex)h&&a.scrollColumnIntoView(e.column);else{r=Object.assign({},r,s);var D=a.cellIsVisibleWidthThreshold,S=a.cellIsVisibleHeightThreshold,x=D*b.width,E=S*C.height,R=b.intersect(w),T=Math.min(C.bottom,w.bottom)-Math.max(C.y,w.y);(w.width>b.width||w.height>C.height)&&(w.width>b.width&&R.width>=x&&(r.x=!1),w.height>C.height&&T>=E&&(r.y=!1)),r.column=e.columnId,a.scrollRowIntoView(e.id,r)}return(a._hoveredRow||a.hoveredCell)&&(a.hoveredCell=null),a.disableActionable=u,a.selectOnFocus=v,a._fromFocusCell=!0,null===(n=e[u?"cell":"target"])||void 0===n||n.focus({preventScroll:!0}),a.disableActionable=a.selectOnFocus=!1,delete a._fromFocusCell,e}}},{key:"blurCell",value:function(e){var t=this.getCell(e);t&&t.classList.remove("b-focused")}},{key:"clearFocus",value:function(e){var t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}},{key:"catchFocus",value:function(){}},{key:"internalNextPrevCell",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this,n=t._focusedCell;return n?t.focusCell({id:n.id,columnId:t.columns.getAdjacentVisibleLeafColumn(n.column,e,!0).id}):null}},{key:"navigateRight",value:function(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?cg.PREV_CELL:cg.NEXT_CELL):this.internalNextPrevCell(!this.rtl)}},{key:"navigateLeft",value:function(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?cg.NEXT_CELL:cg.PREV_CELL):this.internalNextPrevCell(Boolean(this.rtl))}},{key:"internalNextPrevRow",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=this,a=r._focusedCell;if(!a)return!1;var o=r.store["get".concat(e?"Next":"Prev")](a.id,!1,t);return o?r.focusCell({id:o.id,columnId:a.columnId,scroll:{x:!1}}):(e||!n||a.isColumnHeader||(this.clearFocus(),this.getHeaderElement(a.columnId).focus()),!1)}},{key:"navigateDown",value:function(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(cg.DOWN):this.internalNextPrevRow(!0,!1)}},{key:"navigateUp",value:function(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(cg.UP):this.internalNextPrevRow(!1,!1)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","GridNavigation"),S(t,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0[tabIndex]",isNested:!1,keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateCell",F2:"toggleCellActivate",Escape:{handler:"deactivateCell",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1,weight:200},Tab:{handler:"onTab",preventDefault:!1,weight:200}," ":{handler:"onSpace",preventDefault:!1}},cellIsVisibleWidthThreshold:.6,cellIsVisibleHeightThreshold:.6}),t}),Xg,nm,lm,fm,vm));S(Dm,"$name","GridBase"),S(Dm,"type","gridbase"),S(Dm,"bindStoreChangeset",!0),Dm.initClass(),Ne.setVersion("grid","6.2.2"),Dm._$name="GridBase";var Sm=function(){return w((function e(){m(this,e)}),[{key:"refreshBodyRectangle",value:function(){var e=this._bodyRectangle,t=pt.client(this.bodyContainer);return 0===t.height&&e?this._bodyRectangle:this._bodyRectangle=t}},{key:"selectionDragMouseEventListenerElement",get:function(){return this.rootElement}}],[{key:"target",get:function(){return{class:Dm}}}])}();We.apply(Sm);var xm={all:"all",visible:"visible"},Em={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69,portraitWidth:8.3,portraitHeight:11.7,landscapeWidth:11.7,landscapeHeight:8.26},A3:{width:11.69,height:16.49,portraitWidth:11.7,portraitHeight:16.49,landscapeWidth:16.54,landscapeHeight:11.68},A2:{width:16.54,height:23.39,portraitWidth:16.54,portraitHeight:23.39,landscapeWidth:23.39,landscapeHeight:16.51},A1:{width:23.39,height:33.11,portraitWidth:23.39,portraitHeight:33.08,landscapeWidth:33.11,landscapeHeight:23.39},Legal:{width:8.5,height:14,portraitWidth:8.5,portraitHeight:14,landscapeWidth:14,landscapeHeight:8.15},Letter:{width:8.5,height:11,portraitWidth:8.5,portraitHeight:10.95,landscapeWidth:11,landscapeHeight:8.3}};function Rm(){return ne.isFirefox?{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.26}:ne.isSafari?{portraitWidth:0,portraitHeight:.1,landscapeWidth:0,landscapeHeight:.5}:{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.25}}var Tm,Mm={portrait:"portrait",landscape:"landscape"},Fm={pdf:"pdf",png:"png"},Am={pdf:"application/pdf",png:"image/png"},Im=["a5","a4","a3","b5","b4","jis-b5","jis-b4","letter","legal","ledger"],Lm=function(e){return Im.includes(e.toLowerCase())},Om=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"pageTpl",value:function(e){var t=e.title,n=e.header,r=e.footer,i=e.styles,a=e.htmlClasses,o=e.bodyClasses,l=void 0===o?[]:o,s=e.paperHeight,u=e.paperWidth,c=e.html,d=e.currentPage,h=e.htmlStyle,f=void 0===h?"":h,v=e.bodyStyle,g=void 0===v?"":v;return l.push("b-".concat(this.constructor.type)),li.scrollBarWidth?l.push("b-visible-scrollbar"):l.push("b-overlay-scrollbar"),ne.isChrome?l.push("b-chrome"):ne.isSafari?l.push("b-safari"):ne.isFirefox&&l.push("b-firefox"),g="".concat(g,"; width: ").concat(u,"in; height: ").concat(s,"in;"),Kf.tpl(Tm||(Tm=N(['\n            <!DOCTYPE html>\n            <html class="',' b-print-root" style="','">\n                <head>\n                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />\n                    <title>',"</title>\n                    ",'\n                </head>\n                <body class="b-export b-print ','" style="','">\n                <div class="b-page-wrap">\n                    <div class="b-export-content b-page-','">\n                        ','\n                        <div class="b-export-body"><div class="b-export-viewport">',"</div></div>\n                        ","\n                    </div>\n                </div>\n                </body>\n            </html>"])),a,f,t,i.join(""),l.join(" "),g,d,n&&'<div class="b-export-header" style="width: 100%">'.concat(n,"</div>"),c,r&&'<div class="b-export-footer" style="width: 100%">'.concat(r,"</div>"))}},{key:"stylesheets",get:function(){var e=this,t=this;if(t._stylesheets)return t._stylesheets;var n=t.translateURLsToAbsolute,i=r.origin,a=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),o=[];return a.forEach((function(r){var a;(r=r.cloneNode(!0),n&&r.href)&&(a=!0===n?r.href:e.keepPathName?r.href.replace(i,n):new URL(r.getAttribute("href"),n),r.setAttribute("href",a));var l=r.outerHTML;if(n&&/style/i.test(r.tagName)){var s=t.getStyleTagURLConverter(n);l=l.replace(/url\(['"]?(.+?)['"]?\)/g,s)}o.push(l)})),t._stylesheets=t.filterStyles(o)},set:function(e){this._stylesheets=e?this.filterStyles(e):e}},{key:"getStyleTagURLConverter",value:function(e){return function(t,n){var i;try{var a;/^#/.test(n)?i=t:(a=!0===e?r.location.href:this.keepPathName?r.location.href.replace(r.location.origin,e):e,i="url('".concat(new URL(n,a).href,"')"))}catch(e){i=t}return i}.bind(this)}},{key:"saveState",value:function(e){var t=e.client,n=t.disableGridColumnIdWarning;t.disableGridColumnIdWarning=!0,this.state=t.state,t.disableGridColumnIdWarning=n}},{key:"restoreState",value:(u=f((function(e){var t=this,n=e.client;return L().mark((function e(){var r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],(i=new o).add(n.scrollable.ion({scroll:function(){r.push(n.scrollable.await("scrollEnd"))}})),n.eachSubGrid((function(e){var t=e.header,n=e.scrollable;i.add(n.ion({scroll:function(){r.push(n.await("scrollEnd"))}})),i.add(t.scrollable.ion({scroll:function(){r.push(t.scrollable.await("scrollEnd"))}}))})),n.state=t.state,e.next=6,Promise.all(r);case 6:i.forEach((function(e){return e()}));case 7:case"end":return e.stop()}}),e)}))()})),function(e){return u.apply(this,arguments)})},{key:"beforeExport",value:function(){this.element=document.createElement("div")}},{key:"cloneElement",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.element;(!(arguments.length>2&&arguments[2]!==i)||arguments[2])&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0));var n=t.querySelector(".b-gridbase > .b-mask");null==n||n.remove()}},{key:"createPlaceholder",value:function(e){var t=arguments.length>2&&arguments[2]!==i?arguments[2]:{};return(!(arguments.length>1&&arguments[1]!==i)||arguments[1])&&(e.innerHTML=""),li.createElement(Object.assign({parent:e,id:ba.generateId("export")},t))}},{key:"prepareElement",value:function(e){var t=e.client,n=t.tbar,r=t.bbar;n&&this.element.querySelector("#".concat(n.id)).remove(),r&&this.element.querySelector("#".concat(r.id)).remove()}},{key:"measureElement",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"",t=arguments.length>1&&arguments[1]!==i?arguments[1]:"";e instanceof HTMLElement&&(e=e.outerHTML);var n=li.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},className:t,html:'<div style="height: 1px"></div>'.concat(e,'<div style="height: 1px"></div>')}),r=n.offsetHeight-2;return n.remove(),r}},{key:"prepareHTML",value:function(e){e instanceof HTMLElement&&(e=e.outerHTML);for(var t=li.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),n=t.querySelectorAll("img"),r=0,i=n.length;r<i;r++)n[r].setAttribute("src",n[r].src);var a=t.innerHTML;return t.remove(),a}},{key:"getVirtualScrollerHeight",value:function(e){var t=0;return e.eachSubGrid((function(e){e.overflowingHorizontally&&(t=li.scrollBarWidth)})),0===t?t:t+1}},{key:"getPaperWidth",value:function(e,t){if("portraitWidth"in e){var n=t?"portraitWidth":"landscapeWidth";return e[n]-(this.exportMeta.isPrinting?Rm()[n]:0)}return t?e.width:e.height}},{key:"getPaperHeight",value:function(e,t){if("portraitHeight"in e){var n=t?"portraitHeight":"landscapeHeight";return e[n]-(this.exportMeta.isPrinting?Rm()[n]:0)}return t?e.height:e.width}},{key:"inchToPx",value:function(e){return 96*e}},{key:"getScaleValue",value:function(e,t){return Math.floor(1e4*e/t)/1e4}},{key:"export",value:(s=f(L().mark((function e(t){var n,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this).beforeExport(),n.saveState(t),e.next=5,n.prepareComponent(t);case 5:return e.prev=5,e.next=8,n.getPages(t);case 8:r=e.sent;case 9:return e.prev=9,e.next=12,n.restoreComponent(t);case 12:return n.stylesheets=null,e.next=15,Ge.animationFrame();case 15:return e.next=17,n.restoreState(t);case 17:return e.finish(9);case 18:return e.abrupt("return",r);case 19:case"end":return e.stop()}}),e,this,[[5,,9,18]])}))),function(e){return s.apply(this,arguments)})},{key:"getPages",value:(l=f(L().mark((function e(t){var n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.pagesExtractor(t),r=[];case 1:return e.next=3,n.next();case 3:if(e.t0=i=e.sent,!e.t0){e.next=6;break}e.t0=!i.done;case 6:if(!e.t0){e.next=10;break}r.push(i.value),e.next=1;break;case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"prepareExportElement",value:function(){var e=this.element,t=this.exportMeta;return Object.values(t.subGrids).forEach((function(t){var n=t.width;[t.id,t.headerId,t.footerId].forEach((function(t){if(t){var r=e.querySelector('[id="'.concat(t,'"]'));r&&(r.style.width="".concat(n,"px"),r.style.flex="")}}))})),e.innerHTML}},{key:"prepareComponent",value:(a=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,r=t.client,i=t.columns,a=t.keepRegionSizes,o=t.useRenderedColumnWidth,l=r.rowManager,s=n.exportMeta={totalWidth:0,totalHeight:0,subGrids:{},isPrinting:t.useBrowserPrint,title:t.title||r.description},u=Em[t.paperFormat],c=t.orientation===Mm.portrait,d=n.getPaperWidth(u,c),h=n.getPaperHeight(u,c),f=n.inchToPx(d),v=n.inchToPx(h),Object.assign(s,{paperWidth:d,paperHeight:h,realPaperWidth:n.getPaperWidth(u,c),realPaperHeight:n.getPaperHeight(u,c),pageWidth:f,pageHeight:v}),r.columns.forEach((function(e){i.includes(e.id)?e.show():e.hide()})),e.next=5,Ge.animationFrame();case 5:g=n.element,n.cloneElement(r.element),n.prepareElement(t),r.eachSubGrid((function(e){var t,i,u,c,d=n.createPlaceholder(g.querySelector('[id="'.concat(e.id,'"]')),!1);if(null!=a&&a[e.region])c=e.element.offsetWidth;else{var h=e.columns.visibleColumns;c=1!==h.length||h[0].isTimeAxisColumn||0!==n.state.columns.filter((function(t){return t.region===e.region&&!t.hidden&&t.id!==h[0].id})).length?e.columns.visibleColumns.reduce((function(e,t){return o||"number"!=typeof t.width?e+=(r.hideHeaders?l.rows[0].getCell(t.id):t.element).offsetWidth:e+=t.width,e}),0):e.element.offsetWidth}s.totalWidth+=c;var f=(null===(t=e.splitterElement)||void 0===t?void 0:t.offsetWidth)||0;s.totalWidth+=f,s.subGrids[e.region]={id:e.id,headerId:(null===(i=e.header)||void 0===i?void 0:i.id)||null,footerId:(null===(u=e.footer)||void 0===u?void 0:u.id)||null,rows:[],splitterWidth:f,placeHolder:d,width:c}}));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"restoreComponent",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"collectRow",value:function(e){var t=this.exportMeta.subGrids,n=/data-owner-cmp=".+?"/,r=e.grid.features.rowExpander;Object.entries(e.elements).forEach((function(e){var i=_(e,2),a=i[0],o=i[1];o.classList.remove("b-export-row");var l=o.outerHTML;if(r){var s=o.querySelector(".".concat(r.shadowRootContainerClass));if(s){var u=[];s._shadowRoot.childNodes.forEach((function(e){"LINK"!==e.tagName&&"STYLE"!==e.tagName&&u.push(e.outerHTML)})),l=l.replace(s.outerHTML,s.outerHTML.replace(/></,">".concat(u.join(""),"<")))}}t[a].rows.push(l.replace(n,"")),o.classList.add("b-export-row")}))}}],[{key:"defaultConfig",get:function(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:function(e){return e}}}},{key:"inchToPx",value:function(e){return 96*e}}]);var n,a,l,s,u}($i(_n(Ya(Mn))));Om.prototype.pagesExtractor=function(){var e=U(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Implement this method in a subclass");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Om._$name="ExporterBase";var Pm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"cloneElement",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.element,r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];B(t,"cloneElement",this,3)([e,n,r]),li.removeEachSelector(n,".b-grid-row,.b-grid-merged-cells-container")}},{key:"getVisibleRowsCount",value:function(e){var t=e.rowManager,n=t.rows.indexOf(t.firstVisibleRow),r=t.rows.indexOf(t.lastVisibleRow);return-1!==n?-1===r?e.store.count-n:r-n+1:e.store.count}},{key:"prepareComponent",value:(r=f(L().mark((function e(n){var r,i,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,i=r.rowManager,e.next=3,B(t,"prepareComponent",this,3)([n]);case 3:o=this.exportMeta.fakeRow=i.rowClass.new({cls:S(S({},r.rowCls,1),"b-export-row",1),rowManager:i,grid:r,index:-10,dataIndex:-10,isFakeRow:!0}),this.exportMeta.rowsMap=new a,r.eachSubGrid((function(e){e.onAddRow({rows:[o]}),o.element.dataset.ownerCmp=r.id}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"restoreComponent",value:(n=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"restoreComponent",this,3)([n]);case 2:this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderMergedCells",value:function(e,t,n,r){var i=e.client,a=this.exportMeta.subGrids,o=i.features.mergeCells.buildMergedCellsConfig(t,n,r);for(var l in a){var s=a[l],u=document.createElement("div");fa.sync({targetElement:u,domConfig:{children:o[l].children}}),u.childNodes.length&&(u.childNodes.forEach((function(e){var t=e.dataset.syncId,n=i.features.mergeCells.mergedRanges.find((function(e){var n;return(null===(n=e.cellElement)||void 0===n?void 0:n.parentNode.dataset.syncId)===t}));n&&(e.innerHTML=n.cellElement.outerHTML)})),s.mergedCellsHtml=[u.innerHTML])}}}]);var n,r}(Om);Pm._$name="Exporter";var _m=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"stateNextPage",value:(o=f((function(e){var t=this,n=e.client,r=e.rowsRange;return L().mark((function e(){var i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:++(i=t.exportMeta).currentPage,++i.verticalPosition,i.lastRowIndex>=i.finishRowIndex?(i.verticalPages=i.verticalPosition,i.totalPages=i.verticalPages*i.horizontalPages):i.verticalPages=Math.max(i.verticalPages,i.verticalPosition+1),i.verticalPosition>=i.verticalPages&&i.horizontalPosition<i.horizontalPages-1&&Object.assign(i,{verticalPosition:0,horizontalPosition:i.horizontalPosition+1,lastTop:0,lastRowIndex:r===xm.visible?n.rowManager.firstVisibleRow.dataIndex:0,lastRowExported:!1});case 5:case"end":return e.stop()}}),e)}))()})),function(e){return o.apply(this,arguments)})},{key:"prepareComponent",value:(a=f(L().mark((function e(n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:i=(r=this).exportMeta,a=n.client,o=n.headerTpl,l=n.footerTpl,s=n.alignRows,u=n.rowsRange,c=Em[n.paperFormat],d=n.orientation===Mm.portrait,h=r.getPaperWidth(c,d),f=r.getPaperHeight(c,d),v=r.inchToPx(h),g=r.inchToPx(f),m=u===xm.visible,p=Math.ceil(i.totalWidth/v),y=g,o&&(y-=r.measureElement(o({totalWidth:i.totalWidth,totalPages:-1,currentPage:-1}),"b-export-header")),l&&(y-=r.measureElement(l({totalWidth:i.totalWidth,totalPages:-1,currentPage:-1}),"b-export-footer")),C=a.store.count,m?(C=r.getVisibleRowsCount(a),k=i.totalHeight+a.headerHeight+a.footerHeight+a.bodyHeight,i.finishRowIndex=a.rowManager.lastVisibleRow.dataIndex):(k=i.totalHeight+a.headerHeight+a.footerHeight+a.scrollable.scrollHeight,i.finishRowIndex=a.store.count-1),s&&!m?(w=a.rowManager.rowOffsetHeight,D=Math.floor((y-a.headerHeight)/w),S=Math.floor(y/w),x=C-D,b=1+Math.ceil(x/S)):b=Math.ceil(k/y),Object.assign(i,{paperWidth:h,paperHeight:f,pageWidth:v,pageHeight:g,horizontalPages:p,verticalPages:b,totalHeight:k,contentHeight:y,totalRows:C,totalPages:p*b,currentPage:0,verticalPosition:0,horizontalPosition:0,lastTop:0,lastRowIndex:m?a.rowManager.firstVisibleRow.dataIndex:0,lastRowExported:!1});case 10:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"renderRows",value:(i=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(n=this).exportMeta,i=t.client,a=t.alignRows,o=t.repeatHeader,l=r.verticalPosition,s=r.contentHeight,u=r.lastRowIndex,c=r.fakeRow,d=r.rowsMap,h=[],f=o?0:i.headerHeight,v=i.store,g=i.hasActiveFeature("mergeCells"),m=u+(a&&0!==l?1:0),p=0,y=s,0===l&&(y-=f);case 3:if(!(y>0)){e.next=25;break}if(b=v.getAt(m),c.render(m,b,!0,!1,!0),!(a&&y<c.offsetHeight)){e.next=10;break}return e.abrupt("break",25);case 10:if(k=p,p=c.translate(p),r.lastRowIndex=c.dataIndex,y-=c.offsetHeight,n.collectRow(c),m++,C={top:c.top,bottom:c.bottom,offsetHeight:c.offsetHeight,dataIndex:c.dataIndex},h.push(C),d.set(b.id,C),c.dataIndex!==r.finishRowIndex){e.next=23;break}if(!(y>=0)){e.next=23;break}return r.lastRowExported=!0,e.abrupt("break",25);case 23:e.next=3;break;case 25:return g&&n.renderMergedCells(t,u,m,h),r.lastTop=a?p:k,r.exactGridHeight=c.bottom+i.footerContainer.offsetHeight+(0===l||o?f:0),e.next=30,n.onRowsCollected(h,t);case 30:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"buildPage",value:(r=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).exportMeta,i=t.client,a=t.headerTpl,o=t.footerTpl,l=r.totalWidth,s=r.totalPages,u=r.currentPage,c=r.subGrids,Object.values(c).forEach((function(e){return e.rows=[]})),t.rowsRange===xm.all&&(r.totalHeight=i.height-i.bodyHeight+i.scrollable.scrollHeight-n.getVirtualScrollerHeight(i)),a&&(d=n.prepareHTML(a({totalWidth:l,totalPages:s,currentPage:u}))),o&&(h=n.prepareHTML(o({totalWidth:l,totalPages:s,currentPage:u}))),e.next=7,n.renderRows(t);case 7:return f=n.buildPageHtml(t),e.abrupt("return",{html:f,header:d,footer:h});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onRowsCollected",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"buildPageHtml",value:function(){var e=this.exportMeta.subGrids,t=this.prepareExportElement();return Object.values(e).forEach((function(e){var n=e.placeHolder,r=e.rows,i=e.mergedCellsHtml,a=n.outerHTML,o=r.join("");null!=i&&i.length&&(o+='<div class="b-grid-merged-cells-container">'.concat(i.join(""),"</div>")),t=t.replace(a,o)})),t}}],[{key:"title",get:function(){return this.L("L{multipage}")}},{key:"exportingPageText",get:function(){return"L{exportingPage}"}}]);var n,r,i,a,o}(Pm);S(_m,"$name","MultiPageExporter"),S(_m,"type","multipage"),_m.prototype.pagesExtractor=function(){var e=U(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,g,m,p,y;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(n=this).exportMeta,i=n.stylesheets,a=r.totalWidth,o=r.totalPages,l=r.paperWidth,s=r.paperHeight,u=r.realPaperWidth,c=r.realPaperHeight,d=r.title;case 1:if(r.lastRowExported){e.next=17;break}return h=r.currentPage,n.trigger("exportStep",{text:n.L(_m.exportingPageText,{currentPage:h,totalPages:o}),progress:Math.round((h+1)/o*90)}),e.next=6,v(n.buildPage(t));case 6:return f=e.sent,g=f.html,m=f.header,p=f.footer,y=[].concat(z(i),["\n                <style>\n                    .b-page-wrap {\n                        width: ".concat(l,"in;\n                        height: ").concat(s,"in;\n                    }\n                    .b-page-").concat(h," #").concat(t.client.id," {\n                        height: ").concat(r.exactGridHeight,"px !important;\n                        width: ").concat(a,"px !important;\n                    }\n                    .b-page-").concat(h," .b-export-body .b-export-viewport {\n                        transform: translate(").concat(-l*r.horizontalPosition,"in, 0);\n                    }\n                    ").concat(0===r.verticalPosition?"":".b-page-".concat(h," .b-grid-header-container {\n                        display: none;\n                    }"),"\n                </style>\n            ")]),e.next=13,v(n.stateNextPage(t));case 13:return e.next=15,{html:n.pageTpl({html:g,title:d,header:m,footer:p,styles:y,paperWidth:l,paperHeight:s,realPaperWidth:u,realPaperHeight:c,currentPage:h})};case 15:e.next=1;break;case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),_m._$name="MultiPageExporter";var Hm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"stateNextPage",value:(l=f(L().mark((function e(){var t,n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.exportMeta,n=t.totalRows,r=t.processedRows,i=t.totalPages,++t.currentPage,++t.verticalPosition,t.currentPage===i&&r.size!==n&&(++t.totalPages,++t.verticalPages);case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"calculateScale",value:function(){var e=this,t=e.exportMeta,n=t.pageWidth,r=t.totalWidth,i=e.getScaleValue(n,r);return e.exportMeta.scale=i,i}},{key:"estimateTotalPages",value:function(e){var t,n=this,r=n.exportMeta,i=e.client,a=e.headerTpl,o=e.footerTpl,l=e.alignRows,s=e.rowsRange,u=e.repeatHeader,c=r.pageWidth,d=r.pageHeight,h=r.totalWidth,f=n.calculateScale(c,h),v=i.store.count,g=v?0-n.getVirtualScrollerHeight(i)+i.height-i.bodyElement.offsetHeight+i.scrollable.scrollHeight:0,m=d/f,p=g;if(a&&(m-=n.measureElement(a({totalWidth:h,totalPages:-1,currentPage:-1}),"b-export-header")),o&&(m-=n.measureElement(o({totalWidth:h,totalPages:-1,currentPage:-1}),"b-export-footer")),u&&(m-=i.headerHeight+i.footerHeight,g-=i.headerHeight+i.footerHeight),s===xm.visible){var y=i.rowManager,k=y.firstVisibleRow,b=y.lastVisibleRow;v=n.getVisibleRowsCount(i),p=b.bottom-k.top,g=i.headerHeight+i.footerHeight+p,r.lastRowIndex=k.dataIndex,r.finishRowIndex=b.dataIndex}else r.finishRowIndex=i.store.count-1;if(l&&!u&&s!==xm.visible){var C=i.rowManager.rowOffsetHeight,w=Math.floor((m-i.headerHeight)/C),D=Math.floor(m/C),S=v-w;t=1+Math.ceil(S/D)}else t=Math.ceil(p/m);Object.assign(r,{scale:f,contentHeight:m,totalRows:v,totalHeight:g,verticalPages:t,initialScroll:0,horizontalPages:1,totalPages:t,lastRowExported:!1})}},{key:"prepareComponent",value:(a=f(L().mark((function e(n){var r,i,a,l,s,u,c,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:i=(r=this).exportMeta,a=Em[n.paperFormat],l=n.orientation===Mm.portrait,s=r.getPaperWidth(a,l),u=r.getPaperHeight(a,l),c=r.inchToPx(s),d=r.inchToPx(u),Object.assign(i,{paperWidth:s,paperHeight:u,realPaperWidth:r.getPaperWidth(a,l),realPaperHeight:r.getPaperHeight(a,l),pageWidth:c,pageHeight:d,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,lastTop:0,lastRowIndex:-1,processedRows:new o}),r.estimateTotalPages(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"renderRows",value:(i=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(n=this).exportMeta,i=t.client,a=t.alignRows,o=t.repeatHeader,l=r.verticalPosition,s=r.contentHeight,u=r.lastRowIndex,c=r.fakeRow,d=r.rowsMap,h=r.nextPageTop,f=void 0===h?0:h,v=[],g=o||l>0?0:i.headerHeight,m=i.store,p=i.hasActiveFeature("mergeCells"),y=Math.max(0,u)+(f>0||!a||0===l?0:1),k=s+f,b=-f,C=!1,r.nextPageTop=0,0===l&&(C=!0,k-=g);case 4:if(!(k>0)){e.next=32;break}if(D=m.getAt(y),c.render(y,D,!0,!1,!0),S=c.offsetHeight,!(a&&S<s&&k<S)){e.next=12;break}return e.abrupt("break",32);case 12:if(b=c.translate(b),k-=S,(w=c.bottom)>s&&S>s&&(r.nextPageTop=s-c.top-(C?g:0),k=s-w),r.lastRowIndex=c.dataIndex,n.collectRow(c),x={top:c.top,bottom:w,dataIndex:c.dataIndex,offsetHeight:S},v.push(x),d.set(D.id,x),k>0&&r.processedRows.add(y),y++,c.dataIndex!==r.finishRowIndex){e.next=30;break}if(!(k>=0)){e.next=27;break}return r.lastRowExported=!0,e.abrupt("break",32);case 27:r.verticalPages=r.verticalPosition,r.totalPages=r.verticalPages&r.horizontalPages,n.calculateScale();case 30:e.next=4;break;case 32:return p&&n.renderMergedCells(t,u,y,v),r.exactGridHeight=w+i.footerContainer.offsetHeight+(0===l||o?i.headerHeight:0),e.next=36,n.onRowsCollected(v,t);case 36:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"buildPage",value:(r=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).exportMeta,i=t.headerTpl,a=t.footerTpl,o=r.totalWidth,l=r.totalPages,s=r.currentPage,u=r.subGrids,Object.values(u).forEach((function(e){return e.rows=[]})),i&&(c=n.prepareHTML(i({totalWidth:o,totalPages:l,currentPage:s}))),a&&(d=n.prepareHTML(a({totalWidth:o,totalPages:l,currentPage:s}))),e.next=6,n.renderRows(t);case 6:return h=n.buildPageHtml(t),e.abrupt("return",{html:h,header:c,footer:d});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onRowsCollected",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"buildPageHtml",value:function(){var e=this.exportMeta.subGrids,t=this.prepareExportElement();return Object.values(e).forEach((function(e){var n=e.placeHolder,r=e.rows,i=e.mergedCellsHtml,a=n.outerHTML,o=r.join("");null!=i&&i.length&&(o+='<div class="b-grid-merged-cells-container">'.concat(i.join(""),"</div>")),t=t.replace(a,o)})),t}}],[{key:"title",get:function(){return this.L("L{multipagevertical}")}},{key:"exportingPageText",get:function(){return"L{exportingPage}"}}]);var n,r,i,a,l}(Pm);S(Hm,"$name","MultiPageVerticalExporter"),S(Hm,"type","multipagevertical"),Hm.prototype.pagesExtractor=function(){var e=U(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,g,m,p,y,k,b,C;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(n=this).exportMeta,i=n.stylesheets,a=r.totalWidth,o=r.paperWidth,l=r.paperHeight,s=r.realPaperWidth,u=r.realPaperHeight,c=r.title,d=t.lockPaperSize&&Lm(t.paperFormat)?"@page { size: ".concat(t.paperFormat," ").concat(t.orientation," }"):"",h=r.totalPages;case 2:if(r.lastRowExported){e.next=22;break}return f=r.currentPage,n.trigger("exportStep",{text:n.L(Hm.exportingPageText,{currentPage:f,totalPages:h}),progress:Math.round((f+1)/h*90)}),e.next=7,v(n.buildPage(t));case 7:return m=e.sent,p=m.html,y=m.header,k=m.footer,b=n.exportMeta.scale,g="\n            ".concat(d,"\n            .b-page-wrap {\n                width: ").concat(s,"in;\n                height: ").concat(u,"in;\n            }\n            .b-print .b-export-content {\n                scale: ").concat(b,";\n                transform-origin: top left;\n                height: calc(100% / ").concat(b,");\n                width: calc(100% / ").concat(b,");\n            }\n        "),g=t.repeatHeader?"\n                ".concat(g,"\n                .b-page-").concat(f," #").concat(t.client.id," {\n                    height: ").concat(r.exactGridHeight,"px !important;\n                    width: ").concat(a,"px !important;\n                }\n                .b-export-body {\n                    height: 100%;\n                    display: flex;\n                }\n                .b-export-viewport {\n                    height: 100%;\n                }\n            "):"\n                ".concat(g,"\n                .b-page-").concat(f," #").concat(t.client.id," {\n                    height: ").concat(r.exactGridHeight,"px !important;\n                    width: ").concat(a,"px !important;\n                }\n                ").concat(0===f?"":".b-page-".concat(f," .b-grid-header-container {\n                    display: none;\n                }"),"\n                .b-export-body {\n                    overflow: hidden;\n                }\n            "),C=[].concat(z(i),["<style>".concat(g,"</style>")]),e.next=17,v(n.stateNextPage());case 17:return h=r.totalPages,e.next=20,{html:n.pageTpl({html:p,title:c,header:y,footer:k,styles:C,paperWidth:o,paperHeight:l,realPaperWidth:s,realPaperHeight:u,currentPage:f})};case 20:e.next=2;break;case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),Hm._$name="MultiPageVerticalExporter";var Bm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"prepareComponent",value:(i=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onRowsCollected",value:(r=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"renderRows",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,r=t.client,i=t.rowsRange,a=r.rowManager,o=r.store,l=r.hasActiveFeature("mergeCells"),s=i===xm.visible,u=n.exportMeta.totalHeight,!o.count){e.next=11;break}if(c=n.exportMeta,d=c.fakeRow,h=c.rowsMap,f=a.firstVisibleRow,v=s?f.dataIndex:0,g=s?a.lastVisibleRow.dataIndex:o.count-1,m=[],p=0,!d.cells.length){e.next=9;break}for(y=v;y<=g;y++)k=o.getAt(y),d.render(y,k,!0,!1,!0),p=d.translate(p),n.collectRow(d),b={top:d.top,bottom:d.bottom,offsetHeight:d.offsetHeight,dataIndex:d.dataIndex},m.push(b),h.set(k.id,b);return e.next=9,n.onRowsCollected(m,t);case 9:u+=p,l&&n.renderMergedCells(t,v,g,m);case 11:return n.exportMeta.exactGridHeight=u,e.abrupt("return",u);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildPageHtml",value:function(e){var t=this.exportMeta.subGrids,n=this.prepareExportElement();return Object.values(t).forEach((function(e){var t=e.placeHolder,r=e.rows,i=e.mergedCellsHtml,a=t.outerHTML,o=r.join("");null!=i&&i.length&&(o+='<div class="b-grid-merged-cells-container">'.concat(i.join(""),"</div>")),n=n.replace(a,o)})),n}}],[{key:"title",get:function(){return this.localize("L{singlepage}")}},{key:"defaultConfig",get:function(){return{centerContentHorizontally:!1}}}]);var n,r,i}(Pm);S(Bm,"$name","SinglePageExporter"),S(Bm,"type","singlepage"),Bm.prototype.pagesExtractor=function(){var e=U(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,g,m,p,y,k,b,C,w,D;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,r=t.client,i=n.exportMeta.totalWidth,a=n.stylesheets,o=t.orientation===Mm.portrait,l=Em[t.paperFormat],s=n.getPaperWidth(l,o),u=n.getPaperHeight(l,o),c=n.getPaperWidth(l,o),d=n.getPaperHeight(l,o),h=t.lockPaperSize&&Lm(t.paperFormat)?"@page { size: ".concat(t.paperFormat," ").concat(t.orientation," }"):"",e.next=3,v(n.renderRows(t));case 3:return e.t0=e.sent,e.t1=r.headerHeight,e.t2=e.t0+e.t1,e.t3=r.footerHeight,f=e.t2+e.t3,p=n.buildPageHtml(t),y=f,t.headerTpl&&(g=n.prepareHTML(t.headerTpl({totalWidth:i})),k=n.measureElement(g,"b-export-header"),f+=k),t.footerTpl&&(m=n.prepareHTML(t.footerTpl({totalWidth:i})),b=n.measureElement(m,"b-export-footer"),f+=b),C=Math.min(1,n.getScaleValue(n.inchToPx(s),i)),w=Math.min(1,n.getScaleValue(n.inchToPx(u),f)),D=Math.min(C,w),a.push("<style>\n            ".concat(h,"\n            #").concat(r.id," {\n                height: ").concat(y,"px !important;\n                width: ").concat(i,"px !important;\n            }\n            .b-page-wrap {\n                width: ").concat(c,"in;\n                height: ").concat(d,"in;\n            }\n            .b-print .b-export-content {\n                height: 100%;\n            }\n            ").concat(n.centerContentHorizontally?".b-export-viewport > .b-widget { transform: translateX(-50%); left: 50%; }":"","\n            .b-print .b-export-viewport {\n                scale: ").concat(D,";\n                transform-origin: top left;\n                height: calc(100% / ").concat(D,");\n                width: calc(100% / ").concat(D,");\n            }\n        </style>")),e.next=16,{html:n.pageTpl({html:p,header:g,footer:m,styles:a,paperWidth:s,paperHeight:u,realPaperHeight:d,realPaperWidth:c,currentPage:0})};case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),Bm._$name="SinglePageExporter";var Vm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){return[{id:xm.all,text:this.L("L{all}")},{id:xm.visible,text:this.L("L{visible}")}]}}],[{key:"defaultConfig",get:function(){return{editable:!1}}}])}(dv);S(Vm,"$name","ExportRowsCombo"),S(Vm,"type","exportrowscombo"),Vm.initClass(),Vm._$name="ExportRowsCombo";var Nm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){return[{id:Mm.portrait,text:this.L("L{portrait}")},{id:Mm.landscape,text:this.L("L{landscape}")}]}}],[{key:"defaultConfig",get:function(){return{editable:!1}}}])}(dv);function zm(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:function(e){return e};return Object.keys(e).map((function(e){return{id:e,text:t(e)}}))}S(Nm,"$name","ExportOrientationCombo"),S(Nm,"type","exportorientationcombo"),Nm.initClass(),Nm._$name="ExportOrientationCombo";var jm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this,r=e.client;if(!r)throw new Error("`client` config is required");n.columnsStore=r.columns.chain((function(e){return e.isLeaf&&e.exportable}),null,{excludeCollapsedRecords:!1}),n.applyInitialValues(e),B(t,"construct",this,3)([e]),Na.ion({locale:"onLocaleChange",prio:-1,thisObj:n})}},{key:"updateUseBrowserPrint",value:function(e){var t=this;t.whenVisible((function(){var n=t.widgetMap,r=n.exportButton,i=n.fileFormatField,a=r.initialConfig.text,o=!("title"in t.initialConfig);(!a||"L{ExportDialog.export}"===a&&e)&&(r.text=e?t.L("L{ExportDialog.print}"):t.L("L{ExportDialog.export}")),o&&(t.title=e?t.L("L{printSettings}"):t.L("L{exportSettings}")),i.hidden=e||Boolean(i.initialConfig.hidden)}))}},{key:"applyInitialValues",value:function(e){var t=this,n=e.items=e.items||{};e.width=e.width||t.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||t.L("L{ExportDialog.labelWidth}"),n.columnsField=n.columnsField||{},n.fileFormatField=n.fileFormatField||{},n.paperFormatField=n.paperFormatField||{},n.fileFormatField.items=zm(Fm,(function(e){return e.toUpperCase()})),n.paperFormatField.items=zm(Em),n.columnsField.store=t.columnsStore}},{key:"onInternalBeforeShow",value:function(){var e=this.widgetMap,t=e.columnsField,n=e.alignRowsField,r=e.exporterTypeField,i=e.repeatHeaderField;this.autoSelectVisibleColumns&&(t.value=this.columnsStore.query((function(e){return!e.hidden})));var a=r.value;n.hidden=a.match(/singlepage/)||a.match(/^vertical/),i.hidden=!a.match("multipagevertical")}},{key:"onLocaleChange",value:function(){var e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((function(t){t instanceof Uf&&(t.labelWidth=e)}))}},{key:"onExportClick",value:function(){var e=this.values;this.trigger("export",{values:e})}},{key:"onCancelClick",value:function(){this.trigger("cancel"),this.hide()}}],[{key:"configurable",get:function(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,useBrowserPrint:!1,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",name:"columns",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",name:"rowsRange",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",name:"exporterType",editable:!1,value:"singlepage",displayField:"text",buildItems:function(){var e=this,t=this.parent;return t.exporters.map((function(n){return{id:n.type,text:t.optionalL(n.title,e)}}))},onChange:function(e){var t=e.value;this.owner.widgetMap.alignRowsField.hidden=t.match(/singlepage/)||t.match(/^vertical/),this.owner.widgetMap.repeatHeaderField.hidden=!t.match(/multipagevertical/)},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",name:"alignRows",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",name:"repeatHeader",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",name:"fileFormat",localeClass:this,editable:!1,value:"pdf",items:[],onChange:function(e){var t=e.value,n=e.oldValue,r=this.parent;if(r.hidePNGMultipageOption){var i=r.widgetMap.exporterTypeField,a=i.store.find((function(e){return"singlepage"===e.id}));t===Fm.png&&a?(this._previousDisabled=i.disabled,i.disabled=!0,this._previousValue=i.value,i.value="singlepage"):n===Fm.png&&this._previousValue&&(i.disabled=this._previousDisabled,i.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",name:"paperFormat",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",name:"orientation",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}},internalListeners:{beforeShow:"onInternalBeforeShow"}}}}])}(fc);S(jm,"$name","ExportDialog"),S(jm,"type","exportdialog"),jm.initClass(),jm._$name="ExportDialog";var Wm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeSide",value:function(e){return"top"==e||"bottom"==e?e+="-end":"start"!==e&&"end"!=e||(e="bottom-"+e),e}},{key:"compose",value:function(){var e=this.appendTo,t=this.color,n=this.html,r=this.showProgress,i=this.style,a=this.timeout,o=this.side;return{parent:e||this.floatRoot,class:F(F({},Ct.normalize(t,"object")),{},S(S({},"b-side-".concat(o),1),"b-toast-hide",1)),"aria-atomic":!1,html:n,style:F(F({},li.parseStyle(i)),{},{"--side":o.split("-")[0]}),children:{progressElement:r&&{style:"animation-duration:".concat(a,"ms;"),class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}},{key:"doDestroy",value:function(){this.untoast(),B(t,"doDestroy",this,3)([])}},{key:"getNextInset",value:function(e){var t=this.sideMargin,n=this.element;return parseInt(n.style[e],10)+n.offsetHeight+t}},{key:"show",value:(r=f(L().mark((function e(){var n,r,i,a,o,l,s,u,c,d=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"show",this,3)(d);case 2:i=(r=this).element,a=r.side,o=t.toasts[a],l=a.split("-")[0],s=r.timeout*(null!==(n=li.getActiveElement())&&void 0!==n&&n.matches(":focus-visible")?3:1),o.includes(r)||(i.style[l]=(null!==(u=null===(c=o[0])||void 0===c?void 0:c.getNextInset(l))&&void 0!==u?u:r.sideMargin)+"px",o.unshift(r),i.getBoundingClientRect(),i.classList.remove("b-toast-hide"),s>0&&(r.hideTimeout=r.setTimeout("hide",s)));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"hide",value:(n=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this).untoast(),t.element.classList.add("b-toast-hide"),t.autoDestroy&&!t.destroyTimer&&(t.destroyTimer=t.setTimeout("destroy",t.destroyTimeout));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"untoast",value:function(){var e=t.toasts[this.side];e.includes(this)&&e.splice(e.indexOf(this),1),li.removeAttributeValue(document.body,"aria-describedby",this.id)}}],[{key:"configurable",get:function(){return{testConfig:{destroyTimeout:1,timeout:400},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,sideMargin:20,side:"bottom",role:"alert"}}},{key:"hideAll",value:function(){Object.keys(t.toasts).forEach((function(e){return t.toasts[e].slice().reverse().forEach((function(e){return e.hide()}))}))}},{key:"show",value:function(e){var n,r=this,i=t.new({autoDestroy:!0,rootElement:document.body,autoShow:!1},"string"==typeof e?{html:e}:e);return null!==(n=li.getActiveElement())&&void 0!==n&&n.matches(":focus-visible")&&Object.values(this.toasts).flat().length?Ge.waitFor((function(){return!Object.values(r.toasts).flat().length})).then((function(){return setTimeout((function(){return i.show()}),250)})):i.show(),i}}]);var n,r}(Lo);S(Wm,"$name","Toast"),S(Wm,"type","toast"),S(Wm,"toasts",{"top-start":[],"top-end":[],"bottom-start":[],"bottom-end":[]}),Wm.initClass(),Wm._$name="Toast";var $m=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;null===(e=this.exportDialog)||void 0===e||e.destroy(),this.exportersMap.forEach((function(e){return e.destroy()})),B(t,"doDestroy",this,3)([])}},{key:"currentExportPromise",get:function(){return this._currentExportPromise},set:function(e){this._currentExportPromise=e}},{key:"exportersMap",get:function(){return this._exportersMap||(this._exportersMap=new a)}},{key:"getExporter",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this.exportersMap,r=t.type;if(n.has(r))e=n.get(r),Object.assign(e,t);else{var a=this.exporters.find((function(e){return e.type===r}));if(!a)throw new Error("Exporter type ".concat(r," is not found. Make sure you've configured it"));delete(t=Be.clone(t)).type,(e=new a(t)).relayAll(this),n.set(r,e)}return e}},{key:"buildExportConfig",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this,n=t.client,r=t.exportServer,a=t.clientURL,o=t.fileFormat,l=t.fileName,s=t.paperFormat,u=t.rowsRange,c=t.alignRows,d=t.repeatHeader,h=t.keepRegionSizes,f=t.orientation,v=t.translateURLsToAbsolute,g=t.keepPathName,m=t.sendAsBinary,p=t.headerTpl,y=t.footerTpl,k=t.filterStyles,b=t.useRenderedColumnWidth,C=t.useBrowserPrint,w=t.lockPaperSize;e.columns||(e.columns=n.columns.visibleColumns.filter((function(e){return e.exportable})).map((function(e){return e.id})));var D=Be.assign({client:n,exportServer:r,clientURL:a,fileFormat:o,paperFormat:s,rowsRange:u,alignRows:c,repeatHeader:d,keepRegionSizes:h,orientation:f,translateURLsToAbsolute:v,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:y,useRenderedColumnWidth:b,useBrowserPrint:C,lockPaperSize:w,exporterType:t.exporterType,fileName:l||n.$$name},e);return D.columns=e.columns.slice(),"multipagevertical"!==D.exporterType&&"verticalmultipagevertical"!==D.exporterType&&(D.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(D.alignRows=!0),D.exporterConfig=Be.assign({type:D.exporterType,translateURLsToAbsolute:D.translateURLsToAbsolute,keepPathName:D.keepPathName,filterStyles:k},D.exporterConfig||{}),delete D.exporterType,delete D.translateURLsToAbsolute,delete D.keepPathName,D}},{key:"export",value:(l=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return L().mark((function n(){var r,i,a,o,l,s,u,c,d,h;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(r=e).client,a=r.pagesPerRequest,t=r.buildExportConfig(t),!1===i.trigger("beforePdfExport",{config:t})){n.next=40;break}if(i.isExporting=!0,i.mask(r.exportMask),n.prev=5,l=r.getExporter(t.exporterConfig),0!==a){n.next=30;break}return n.next=10,l.export(t);case 10:if(u=n.sent,!r.isDestroying){n.next=13;break}return n.abrupt("return");case 13:if(null===(s=r.exportDialog)||void 0===s||s.close(),i.unmask(),r.trigger("exportStep",{progress:90,text:r.exportProgressMask,contentGenerated:!0}),!t.useBrowserPrint){n.next=22;break}return n.next=19,r.doPrint(u,t);case 19:o={},n.next=30;break;case 22:return c=r.receiveExportContent(u,t),r.toast=r.showLoadingToast(c),n.next=26,c;case 26:return d=n.sent,o={response:d},n.next=30,r.processExportContent(d,t);case 30:n.next=36;break;case 32:throw n.prev=32,n.t0=n.catch(5),o=n.t0 instanceof Response?{response:n.t0}:{error:n.t0},n.t0;case 36:return n.prev=36,r.toast&&!r.toast.isDestroying&&r.toast.hide(),r.isDestroying||(null===(h=r.exportDialog)||void 0===h||h.close(),i.unmask(),r.showErrorToast&&(o.error?"AbortError"!==o.error.name&&Wm.show({html:r.L("L{Export failed}"),rootElement:r.rootElement}):o.response&&!o.response.ok&&Wm.show({html:r.L("L{Server error}"),rootElement:r.rootElement})),i.trigger("pdfExport",o),i.isExporting=!1),n.finish(36);case 40:return n.abrupt("return",o);case 41:case"end":return n.stop()}}),n,null,[[5,32,36,40]])}))()})),function(){return l.apply(this,arguments)})},{key:"receiveExportContent",value:function(e,t){return Ba.fetch(t.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary})},this.fetchOptions))}},{key:"processExportContent",value:(o=f(L().mark((function e(t,n){var r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,!t.ok||!r.openAfterExport){e.next=18;break}if(t=t.clone(),!(i=t.headers.get("content-type")).match(/application\/octet-stream/)){e.next=13;break}return a=Am[n.fileFormat],e.next=8,r.responseBlobToObjectURL(t,a);case 8:o=e.sent,r.getDownloadLink(n.fileName,o).click(),e.next=18;break;case 13:if(!i.match(/application\/json/)){e.next=18;break}return e.next=16,t.json();case 16:(l=e.sent).success?r.getDownloadLink(n.fileName,l.url).click():Wm.show({html:l.msg,rootElement:this.rootElement});case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"doPrint",value:function(e){}},{key:"responseBlobToObjectURL",value:(r=f(L().mark((function e(t,n){var r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.blob();case 2:return r=e.sent,e.abrupt("return",URL.createObjectURL(r.slice(0,r.size,n)));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"getDownloadLink",value:function(e,t){var n=document.createElement("a");return n.download=e,n.href=t,this.openInNewTab&&(n.target="_blank"),n}},{key:"defaultExportDialogConfig",get:function(){var e=this;return{client:e.client,exporters:e.exporters,useBrowserPrint:e.useBrowserPrint,items:{rowsRangeField:{value:e.rowsRange},exporterTypeField:{value:e.exporterType},orientationField:{value:e.orientation},paperFormatField:{value:e.paperFormat},repeatHeaderField:{value:e.repeatHeader},fileFormatField:{value:e.fileFormat},alignRowsField:{checked:e.alignRows}}}}},{key:"changeExportDialog",value:function(e,t){var n=this;if(null==t||t.destroy(),e){var r=n.dialogClass.mergeConfigs({rootElement:n.rootElement,client:n.client,modal:{transparent:!0},items:{rowsRangeField:{value:n.rowsRange},exporterTypeField:{value:n.exporterType},orientationField:{value:n.orientation},paperFormatField:{value:n.paperFormat},repeatHeaderField:{value:n.repeatHeader},fileFormatField:{value:n.fileFormat},alignRowsField:{checked:n.alignRows}}},n.defaultExportDialogConfig,e);(e=n.dialogClass.new(r)).ion({export:n.onExportButtonClick,thisObj:n})}return e}},{key:"showExportDialog",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.exportDialog.show());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"isExporting",get:function(){return Boolean(this.client.isExporting)}},{key:"onExportButtonClick",value:function(e){var t=e.values,n=this,r=n.exportDialog.mask({progress:0,maxProgress:100,text:n.exportMask}),i=n.ion({exportstep:function(e){var t=e.progress,a=e.text;e.contentGenerated?(n.exportDialog.unmask(),i()):(r.progress=t,null!=a&&(r.text=a))}});n.currentExportPromise=n.export(t),n.currentExportPromise.catch((function(){})).finally((function(){var e;i(),null===(e=n.exportDialog)||void 0===e||e.unmask(),n.currentExportPromise=null}))}},{key:"showLoadingToast",value:function(e){var t=Wm.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:'\n    <span class="b-mask-icon b-icon b-icon-spinner"></span>\n    <span>'.concat(this.exportProgressMask,'</span>\n    <button class="b-button">').concat(this.L("L{Click to abort}"),"</button>")});return fr.on({element:t.element,click:function(){var t;null===(t=e.abort)||void 0===t||t.call(e)}}),t}}]);var n,r,o,l}(wc);S($m,"$name","PdfExport"),S($m,"configurable",{dialogClass:jm,exportServer:i,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[Bm,_m,Hm],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:function(e){return e},useRenderedColumnWidth:!1,useBrowserPrint:!1,lockPaperSize:!1,testConfig:{openAfterExport:!1}}),$m._$name="PdfExport",Ug.registerFeature($m,!1,"Grid");var Um,Gm=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"showPrintDialog",value:function(){return this.showExportDialog()}},{key:"print",value:function(e){return this.export(e)}},{key:"onPrintIFrameLoad",value:(r=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"showBrowserPrintDialog",value:(n=f(L().mark((function e(t,n){var r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onPrintIFrameLoad(t);case 2:return e.next=4,this.client.trigger("beforeShowPrintDialog",{iframe:t});case 4:if(e.t0=e.sent,!1===e.t0){e.next=9;break}this.test||((r=t.contentWindow).onafterprint=function(){t.remove(),n()},r.print()),e.next=11;break;case 9:t.remove(),n();case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addStylesToDocument",value:function(e,t,n){t.head.querySelectorAll('link[rel="stylesheet"],link[as="style"]').forEach((function(t){var n=e.adoptNode(t);e.head.appendChild(n)}))}},{key:"addInlineStylesToDocument",value:function(e,t){t.head.querySelectorAll("style").forEach((function(t){var n=e.adoptNode(t);e.head.appendChild(n)}))}},{key:"doPrint",value:function(e){var t=this;return new Promise((function(n,r){var i=document.createElement("iframe");i.className="b-print-wrapper",i.style.visibility="hidden",i.style.height="0",i.onload=function(){var a,o,l,s=i.contentWindow.document,u=s.body,c=new DOMParser;e.forEach((function(e,n){var r=e.html,i=c.parseFromString(r,"text/html"),a=s.adoptNode(i.body.firstChild);0===n&&(t.addStylesToDocument(s,i,r),o=parseFloat(i.body.style.height),l=parseFloat(i.body.style.width)),t.addInlineStylesToDocument(s,i),u.appendChild(a)}));var d=e[0].html;u.className=(null===(a=d.match(/<body class="(.+?)"/))||void 0===a?void 0:a[1])||"",u.parentElement.classList.add("b-print-root"),u.style.height="".concat(o*e.length,"in"),u.style.width="".concat(l,"in"),Promise.all(Array.from(s.head.querySelectorAll('link[rel="stylesheet"]')).map((function(e){return new Promise((function(t,n){e.onload=t,e.onerror=n}))}))).then((function(){return s.fonts.ready})).then((function(){return t.showBrowserPrintDialog(i,n)})).catch((function(e){console.warn("Failed to load stylesheets ".concat(e.message?": ".concat(e.message):"")),r(t.L("L{PdfExport.Export failed}"))}))},t.client.element.parentElement.appendChild(i)}))}}],[{key:"configurable",get:function(){return{useBrowserPrint:!0,exporterType:"multipagevertical",test:!1}}},{key:"pluginConfig",get:function(){return{assign:["print","showPrintDialog"]}}}]);var n,r}(e),S(t,"$name","PrintMixin"),t},Ym=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Gm($m));S(Ym,"$name","Print"),Ym._$name="Print",Ug.registerFeature(Ym,!1,"Grid"),We.apply((Um=function(){return w((function e(){m(this,e)}),[{key:"addStylesToDocument",value:function(e,t,n){n.matchAll(/<link .+?>/g).forEach((function(t){var n,r=null===(n=_(t,1)[0].match(/ href="(.+?)"/))||void 0===n?void 0:n[1];if(/resource/.test(r)){var i=e.createElement("link");i.rel="stylesheet",i.href=r,e.head.appendChild(i)}})),t.head.querySelectorAll('style,link[rel="stylesheet"],link[as="style"]').forEach((function(t){if("STYLE"===t.tagName){var n=e.createElement("style");n.textContent=t.textContent.replace(/\[c-.+?]/g,""),e.head.appendChild(n)}else{var r=e.adoptNode(t);e.head.appendChild(r)}}))}}])}(),S(Um,"target",{class:Ym}),Um));var qm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"groupHeaderReserved",get:function(){return!0}},{key:"construct",value:function(e,n){var r=this;e.renderer&&(Ne.deprecate("grid","7.0.0","Using deprecated `renderer` with ActionColumn, use `afterRenderCell` callback instead."),e.afterRenderCell=e.renderer,delete e.renderer),B(t,"construct",this,3)([e,n]),e.width||e.flex||r.grid.ion({paint:"updateAutoWidth",thisObj:r}),r.disableIfGridReadOnly&&r.grid.element.classList.add("b-actioncolumn-readonly")}},{key:"defaultRenderer",value:function(e){var t,n=this;e.grid;var r=e.column,i=e.record,a=e.isExport;e.callExternalRenderer;var o=i&&"groupRowFor"in i.meta,l=r.subGrid,s={className:{"b-action-ct":1},children:null===(t=r.actions)||void 0===t?void 0:t.map((function(e,t){var s;if("visible"in e&&("function"==typeof e.visible&&!1===e.visible({record:i})||!1===e.visible))return"";if(o&&!e.showForGroup||!o&&e.showForGroup)return"";var u,c=e.tooltip,d=e.renderer,h="function"==typeof c||null!=c&&null!==(s=c.startsWith)&&void 0!==s&&s.call(c,"up.")?l.callback(c,l,[{record:i}]):c||"";if("string"==typeof h&&(h=n.optionalL(h,n)),d){var f,v=null!==(f=l.callback(d,l,[{index:t,record:i,column:r,isExport:a,tooltip:h,action:e}]))&&void 0!==f?f:"";"string"==typeof v?u={tag:"span",class:"b-action-item b-tool",dataset:F(F({},pc.encodeConfig(h)),{},{index:t}),html:v}:(((u=v).dataset||(u.dataset={})).index=t,(u.className||(u.className={}))["b-action-item"]=1,u.className[e.cls]=e.cls)}else u={tag:"button",dataset:F(F({},pc.encodeConfig(h)),{},{index:t}),className:S({"b-tool":1,"b-action-item":1},e.cls,e.cls)};var g=e.ariaLabel||u.dataset.btip;return g&&(u["aria-label"]=Le.encodeHtml(g)),u}))};return a?s.children.flatMap((function(e){return e.html||[]})).join(","):s}},{key:"onCellClick",value:function(e){var t,n,r=e.grid,i=e.column,a=e.record,o=e.target;if(i===this&&(n=o.closest(".b-action-item[data-index]"))){var l=n.dataset.index,s=null===(t=i.actions)||void 0===t?void 0:t[l],u=null==s?void 0:s.onClick;u&&this.callback(u,i,[{record:a,action:s,target:o,grid:r,column:i}])}}},{key:"updateAutoWidth",value:function(){var e=this,t=[],n=e.actions;if(e.element){var r=e.actions=[];null==n||n.forEach((function(e){var n=F({},e);delete n.visible,n.showForGroup?(delete n.showForGroup,t.push(n)):r.push(n)})),t.length>r.length&&(e._actions=t);var i=li.createElement(e.defaultRenderer({column:e,record:new e.grid.store.modelClass,callExternalRenderer:!1})).outerHTML;e.width=li.measureText(i,e.element,!0,e.element.parentElement),e.actions=n}}}])}(yg);S(qm,"type","action"),S(qm,"$name","ActionColumn"),S(qm,"fields",[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}]),S(qm,"defaults",{minWidth:30,filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,readOnly:!0,ariaLabel:"L{ActionColumn.rowActions}"}),bg.registerColumnType(qm),qm.exposeProperties(),qm._$name="ActionColumn";var Km,Xm={onTab:1,onShiftTab:1},Zm={remove:1,filter:1,dataset:1,replace:1},Jm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e=this,t=e.client;if(!e.renderer&&!e.widget)return e.disabled=!0,void console.warn("RowExpander requires either a widget config or implementing the renderer function.");t.isGanttBase&&!1!==t.fixedRowHeight&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to `false`."),e.widget&&Wn.ion({theme:e.onThemeChange,thisObj:e}),e.bindStore(t.store),e.triggerEvent&&t.ion(S(S({},e.triggerEvent,"onTriggerEvent"),"thisObj",e)),e.addColumn()}},{key:"bindStore",value:function(e){var t=this;t.recordStateMap.clear(),t.collapsingStateMap.clear(),t.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:t.onStoreChange,thisObj:t})}},{key:"doDisable",value:function(e){var n=this.client;e&&(this.recordStateMap.clear(),this.collapsingStateMap.clear()),n.isConfiguring||n.rowManager.renderFromRow(),B(t,"doDisable",this,3)([e])}},{key:"changeLoadingIndicatorText",value:function(e){return e?this.L(e):e}},{key:"onGridBodyFocusIn",value:function(e){var t,n=this;(n.hasWidget?e.target.matches(".".concat(n.expanderBodyClass,", .").concat(n.shadowRootContainerClass)):null!==(t=n.client.lastMousedownEvent)&&void 0!==t&&null!==(t=t.target)&&void 0!==t&&t.closest("."+n.expanderBodyClass))||n.overridden.onGridBodyFocusIn(e)}},{key:"keyMapOnKeyDown",value:function(e){var t,n,r=e.target;this.hasWidget&&null!==(t=r.classList)&&void 0!==t&&t.contains(this.shadowRootContainerClass)||(n=this.overridden).keyMapOnKeyDown.apply(n,arguments)}},{key:"isAnimating",get:function(){return this.client.isAnimating},set:function(e){var t=this.client,n=t.isAnimating;t.isAnimating=e,t.isAnimating!==n&&t.element.classList.toggle("b-rowexpander-animating")}},{key:"changeWidget",value:function(e){return e&&this.isWidgetConfig(e)?S({},this.client.regions[0],e):e}},{key:"afterColumnsChange",value:function(){this.addColumn()}},{key:"changeColumn",value:function(e){var t=this,n=t.client;if(null==e)return e;var r="first"===t.columnPosition?"left":"right";return n.isRTL&&(r="first"===t.columnPosition?"right":"left"),Be.assign({type:"action",draggable:!1,resizable:!1,showColumnPicker:!1,ariaLabel:t.L("L{RowExpander.columnDescription}"),actions:[{cls:"b-icon b-icon-collapse-".concat(r),tooltip:function(e){var n=e.record;return t.L(t.recordStateMap.has(n)?"L{RowExpander.collapse}":"L{RowExpander.expand}")},onClick:function(e){var n=e.record;return t.toggleExpand(n)}}],width:40,hideable:!1,align:"center",region:n.regions[0],field:"expanderActionColumn"},e)}},{key:"addColumn",value:function(){var e=this,t=e.column,n=e.client.columns;if(!e._isAddingExpanderColumn&&t&&(!e._expander||!n.includes(e._expander))){if(e._isAddingExpanderColumn=!0,"last"===e.columnPosition){var r=_(n.add(t),1);e._expander=r[0],e.client.fillLastColumn=!1}else{var i=_(n.insert(0,t),1);e._expander=i[0]}e._isAddingExpanderColumn=!1}}},{key:"onTriggerEvent",value:function(e){var t=e.target;this.disabled||null!=t&&t.closest(".b-action-cell")||!t.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(t))}},{key:"toggleExpand",value:function(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}},{key:"onExpanderBodyResize",value:function(e){var t,n=D(e);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=this.client.store.getById(null===(r=i.target.dataset)||void 0===r?void 0:r.id),o=a&&this.recordStateMap.get(a);if(o&&!o.ignoreResize&&!o.isAnimating){var l=o.expanderBodyHeight;o.expanderBodyHeight=null,this.processRowHeight(a,0)!==l&&this.renderRowsWithAnimation(a)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"shouldSpanRegions",get:function(){return this.spanRegions&&this.client.regions.length>1}},{key:"onStoreChange",value:function(e){var t,n=e.action,r=e.source,i=e.records,a=e.changes,o=this,l=o.recordStateMap,s=o.collapsingStateMap,u=a&&Object.keys(a);if((1!==(null==u?void 0:u.length)||"store"!==(null===(t=r.modelClass.fieldMap[u[0]])||void 0===t?void 0:t.type))&&!o.disabled)if("removeAll"===n)l.clear(),s.clear();else if(Zm[n]){var c,d=D(l);try{for(d.s();!(c=d.n()).done;){var h=_(c.value,2),f=h[0],v=h[1];r.includes(f)||(o.destroyWidgets(v),l.delete(f),s.delete(f))}}catch(e){d.e(e)}finally{d.f()}}else if(o.refreshOnRecordChange&&null!=i&&i.length&&"update"===n){var g,m=null===(g=Wn.currentPointerDown)||void 0===g?void 0:g.target,p=[],y=!1;i.forEach((function(e){var t=l.get(e);null!=t&&t.isCreated&&(t.isCreated=!1,!y&&m&&o.client.regions.some((function(e){var n,r;return(null===(n=t.expandedBodyElements)||void 0===n||null===(n=n[e])||void 0===n?void 0:n.contains(m))||(null===(r=t.widgets)||void 0===r||null===(r=r[e])||void 0===r||null===(r=r.element)||void 0===r?void 0:r.contains(m))}))&&(y=!0),p.push(e))})),null!=p&&p.length&&(y?o.client.delayUntilMouseUp((function(){p.forEach((function(e){return o.bufferedRenderer(e)}))})):o.client.rowManager.renderFromRecord(p[0]))}}},{key:"processRowHeight",value:function(e,t){var n,r,i=this,a=i.shouldSpanRegions,o=i.recordStateMap.get(e),l=!1;if(o&&!o.expanderBodyHeight){var s,u=D(i.client.regions);try{for(u.s();!(s=u.n()).done;){var c,d=s.value,h=null===(c=o.expandedBodyElements[d])||void 0===c?void 0:c.offsetHeight;h>o.expanderBodyHeight&&(o.expanderBodyHeight=h,l=!0)}}catch(e){u.e(e)}finally{u.f()}}else!o&&(o=i.collapsingStateMap.get(e))&&o.expanderBodyHeight&&(o.expanderBodyHeight=0,l=!0);return l&&i.enableAnimations&&a&&i.animateSpannedExpander(o),(null!==(n=null===(r=o)||void 0===r?void 0:r.expanderBodyHeight)&&void 0!==n?n:0)+t}},{key:"animateSpannedExpander",value:function(e){var t=this,n=e.expandedBodyElements[t.client.regions[0]],r=t.client.rowManager.getRowById(e.record).element;e.isAnimating=t.isAnimating=!0,e.ignoreResize=!0,n.style.height=r.offsetHeight-e.cellHeight+"px",n.offsetHeight,n.style.height=e.expanderBodyHeight+"px",t.waitForTransition(n,(function(){n.style.height="",e.expanderBodyHeight||n.remove(),e.isAnimating=t.isAnimating=!1}))}},{key:"beforeRenderRow",value:function(e){var t=e.row,n=e.record,r=this,i=r.client.regions,a=r.expandedRowClass,o=r.collapsingStateMap,l=r.shouldSpanRegions,s=r.recordStateMap.get(n);if(t.cls.toggle("b-rowexpander-disabled",r.disabled),t.cls[a]){var u=o.get(n);if(u){var c=function(){(u=o.get(n))&&(o.delete(n),r.removeExpander(t),r.destroyWidgets(u))};r.enableAnimations&&r.isAnimating?r.waitForTransition(t,c):c()}else s||r.removeExpander(t)}else o.delete(n);!r.disabled&&s&&(s.isCreated||(s.ignoreResize=!0,r.renderExpander(n,t,s)),t.cls.add(a),i.forEach((function(e,n){var i=t.getElement(e);if(s.isCreated&&(!l||0===n)){var a=s.expandedBodyElements[e],o=l?r.client.verticalScroller:i;a.parentElement!==o&&(l||li.removeEachSelector(i,"."+r.expanderBodyClass),o.appendChild(a),r.observeResize(a)),l&&(a.style.top=t.top+s.cellHeight+"px",t._spannedExpandedBodyElement=a),s.ignoreResize=!1,s.renderPromiseResolver&&!s.isRenderingAsync&&(r.delay(s.renderPromiseResolver),s.renderPromiseResolver=null)}r.lockCellHeight(i,s.cellHeight,!1)})),r._shouldScrollIntoView&&r.autoScroll&&(r._shouldScrollIntoView=!1,li.isInView(s.expandedBodyElements[i[0]],!0)||r.client.rowManager.ion({once:!0,thisObj:r,renderDone:function(){return r.scrollRowIntoView(t,n)}})))}},{key:"scrollRowIntoView",value:function(e,t){var n=this;this.isAnimating?this.waitForTransition(e,(function(){return n.client.scrollRowIntoView(t)})):this.client.scrollRowIntoView(t)}},{key:"waitForTransition",value:function(e,t){var n,r=li.isElement(e)?e:e.element;fr.onTransitionEnd({element:r,property:"height",handler:t,thisObj:this,duration:null!==(n=li.getPropertyTransitionDuration(r,"height"))&&void 0!==n?n:1})}},{key:"removeExpander",value:function(e){var t=this;e.cls.remove(t.expandedRowClass);var n,r=D(t.client.regions);try{for(r.s();!(n=r.n()).done;){var i,a,o,l=n.value,s=e.getElement(l),u=D(s.querySelectorAll("."+t.expanderBodyClass));try{for(u.s();!(i=u.n()).done;){var c=i.value;t.unobserveResize(c),c.remove()}}catch(e){u.e(e)}finally{u.f()}if(s.classList.remove(t.expandedRowClass),t.lockCellHeight(s,null,!1),t.shouldSpanRegions)null===(a=e._spannedExpandedBodyElement)||void 0===a||null===(o=a.remove)||void 0===o||o.call(a),e._spannedExpandedBodyElement=null}}catch(e){r.e(e)}finally{r.f()}}},{key:"destroyWidgets",value:function(e){var t,n=D(this.client.regions);try{for(n.s();!(t=n.n()).done;){var r,i,a=t.value;null===(r=e.widgets)||void 0===r||null===(r=r[a])||void 0===r||null===(i=r.destroy)||void 0===i||i.call(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"isWidgetConfig",value:function(e){return e.type&&!e.tag}},{key:"renderExpander",value:function(e,t,n){var r,i=this,a=i.client,o=i.widget,l=i.shouldSpanRegions,s=null===(r=t.cells[0])||void 0===r?void 0:r.offsetHeight,u=n.expandedBodyElements,c=void 0===u?{}:u,d=[],h=function(e,t,n){if(null!=e)if("string"==typeof e){var r=z(t.childNodes).map((function(e){return t.removeChild(e)}));t.innerHTML=e,r.reverse().forEach((function(e){return t.insertBefore(e,t.firstChild)}))}else i.isWidgetConfig(e)?f(e,t,n):(e=li.createElement(e),t.appendChild(e))},f=function(r,o,l){if(o.attachShadow){var s=li.createElement({parent:o,className:i.shadowRootContainerClass,style:"flex : 1"}),u=s._shadowRoot=s.attachShadow({mode:"closed"});d.push(li.cloneStylesIntoShadowRoot(u).then((function(){var s,c,d=null===(s=li.getThemeInfo())||void 0===s?void 0:s.name;if(!a.isDestroyed){var h=null!==(c=r.dataField)&&void 0!==c?c:i.dataField;if(h){var f=e.getValue(h);if(null!=f&&f.isStore)r.store=f;else if(a.store["".concat(h,"Store")]){var v=a.store["".concat(h,"Store")];r.store=v.chain((function(t){return e.getValue(h).includes(t)}))}else r.store={data:f,internalListeners:{change:function(){return!t.isDestroyed&&t.render()},thisObj:i}}}if(d){var g=r.cls,m="b-theme-".concat(d.toLowerCase());r.cls=g?g+" "+m:m}n.widgets||(n.widgets={}),n.widgets[l]=o.widget=Lo.create(Be.assign({appendTo:u,owner:a,flex:1,minHeight:"5em",isNested:!0,expandedRecord:e},r))}})).catch((function(e){throw new Error("Could not load stylesheet "+e)})))}else console.warn("Rendering a Widget in the RowExpander requires access to the Shadow DOM. If your app lives in a sandboxed environment with restrictions on Shadow DOM manipulation, this is not supported. If you use SalesForce LWC, consider enabling Lightning Web Security.")};if(!n.isRenderingAsync){t.addCls(i.expandedRowClass),Object.assign(n,{cellHeight:s,expandedBodyElements:c,expanderBodyHeight:0,loadingIndicators:[]});var v,g=D(a.regions.entries());try{var m=function(){var n=_(v.value,2),r=n[0],u=n[1];if(l&&r>0)return 1;var g,m,p=t.getElement(u),y=c[u];(y?(i.unobserveResize(y),y.innerHTML=""):y=li.createElement({parent:l?a.verticalScroller:p,tabIndex:-1,className:i.expanderBodyClass,style:{top:l?t.top+s:s+"px"},dataset:{id:e.id}}),i.observeResize(y),null!=o&&o[u])?f(o[u],y,u):g=null===(m=i.renderer)||void 0===m?void 0:m.call(i,{record:e,expanderElement:y,rowElement:p,region:u,grid:a});pe.isPromise(g)?d.push(g.then((function(e){return h(e,y,u)}))):h(g,y,u),c[u]=y};for(g.s();!(v=g.n()).done&&!m(););}catch(e){g.e(e)}finally{g.f()}d.length&&(n.isRenderingAsync=!0,i.showLoadingIndicators(n),Promise.all(d).then((function(){Promise.all(d).then((function(){var t,r;if(!a.isDestroyed){null===(t=n.loadingIndicators)||void 0===t||t.forEach((function(e){return e.remove()})),n.loadingIndicators.length=0,n.ignoreResize=!1,n.isRenderingAsync=!1;var o,l=D(i.recordStateMap);try{for(l.s();!(o=l.n()).done;){if(_(o.value,2)[1].isRenderingAsync)return}}catch(e){l.e(e)}finally{l.f()}null===(r=i.renderRowsWithAnimation)||void 0===r||r.call(i,e,!0)}}))}))),n.isCreated=!0}}},{key:"showLoadingIndicators",value:function(e){for(var t in e.expandedBodyElements)e.loadingIndicators.push(li.createElement({parent:e.expandedBodyElements[t],className:"b-rowexpander-loading",style:{height:this.loadingIndicatorHeight+"px"},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]}))}},{key:"renderRowsWithAnimation",value:function(e){var t=this;if(t.enableAnimations){var n=t.client.rowManager.getRowById(e);n&&(t.isAnimating=!0,t.collapsingStateMap.has(e)&&n.addCls("b-row-is-collapsing"),t.waitForTransition(n,(function(){var e;(t.isAnimating=!1,n.isDestroyed)||(null===(e=n.removeCls)||void 0===e||e.call(n,"b-row-is-collapsing"))})))}return t.bufferedRenderer(e)}},{key:"bufferedRenderer",value:function(e){var t,n=this;return(null!==(t=this._bufferedRecords)&&void 0!==t?t:this._bufferedRecords=[]).push(e),this._rafPromise||(this._rafPromise=new Promise((function(e){requestAnimationFrame((function(){var t;null===(t=n.internalRender)||void 0===t||t.call(n,e),n._rafPromise=null}))}))),this._rafPromise}},{key:"internalRender",value:function(e){var t=this,n=t._bufferedRecords,r=t.client.store;t.recordStateMap.forEach((function(e,t){e.renderPromiseResolver&&e.isCreated&&!n.includes(t)&&n.push(t)}));var i=_(n.sort((function(e,t){return r.indexOf(e)-r.indexOf(t)})),1)[0];t.client.rowManager.renderFromRecord(i),n.length=0,t.delay(e)}},{key:"lockCellHeight",value:function(e,t,n){for(var r=0;r<e.children.length;r++){var i=e.children[r];i.classList.contains(this.expanderBodyClass)||(i.style.height=n?"":t+"px")}}},{key:"expandRow",value:(s=f(L().mark((function e(){var t=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.expand.apply(this,t));case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"collapseRow",value:(l=f(L().mark((function e(){var t=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.collapse.apply(this,t));case 1:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"expand",value:(o=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(i=t).client,r.t1=i.disabled||i.recordStateMap.has(e),r.t1){r.next=7;break}return r.next=5,i.trigger("beforeExpand",{record:e});case 5:r.t2=r.sent,r.t1=!1===r.t2;case 7:if(r.t0=r.t1,r.t0){r.next=13;break}return r.next=11,a.trigger("beforeRowExpand",{record:e});case 11:r.t3=r.sent,r.t0=!1===r.t3;case 13:if(!r.t0){r.next=15;break}return r.abrupt("return");case 15:return r.abrupt("return",new Promise((function(t){var r;o={isCreated:!1,renderPromiseResolver:t,record:e},i.recordStateMap.set(e,o),i.collapsingStateMap.delete(e),i._shouldScrollIntoView=!0,i.renderRowsWithAnimation(e),n||null===(r=a.syncSplits)||void 0===r||r.call(a,(function(t){return t.features.rowExpander.expand(e,!0)}))})).then((function(){var t,n,r,l;null===(t=i.trigger)||void 0===t||t.call(i,"expand",{record:e,expandedElements:o.expandedBodyElements,widget:null===(n=o.widgets)||void 0===n?void 0:n[i.client.regions[0]],widgets:o.widgets}),null===(r=a.trigger)||void 0===r||r.call(a,"rowExpand",{record:e,expandedElements:o.expandedBodyElements,widget:null===(l=o.widgets)||void 0===l?void 0:l[i.client.regions[0]],widgets:o.widgets})})));case 16:case"end":return r.stop()}}),r)}))()})),function(e){return o.apply(this,arguments)})},{key:"collapse",value:(r=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o,l,s;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(i=t).client,o=i.recordStateMap.get(e),r.t1=i.disabled,r.t1){r.next=7;break}return r.next=5,i.trigger("beforeCollapse",{record:e});case 5:r.t2=r.sent,r.t1=!1===r.t2;case 7:if(r.t0=r.t1,r.t0){r.next=13;break}return r.next=11,a.trigger("beforeRowCollapse",{record:e});case 11:r.t3=r.sent,r.t0=!1===r.t3;case 13:if(!r.t0){r.next=15;break}return r.abrupt("return");case 15:if(null!=o&&o.expandedBodyElements)for(l in o.expandedBodyElements)i.unobserveResize(o.expandedBodyElements[l]);return i.recordStateMap.delete(e),i.collapsingStateMap.set(e,o),r.next=20,i.renderRowsWithAnimation(e);case 20:i.trigger("collapse",{record:e}),a.trigger("rowCollapse",{record:e}),n||null===(s=a.syncSplits)||void 0===s||s.call(a,(function(t){return t.features.rowExpander.collapse(e,!0)}));case 23:case"end":return r.stop()}}),r)}))()})),function(e){return r.apply(this,arguments)})},{key:"refreshRow",value:(n=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=this.recordStateMap.get(t))||!n.isCreated){e.next=4;break}return n.isCreated=!1,e.abrupt("return",this.bufferedRenderer(t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"hasWidget",get:function(){return Boolean(this.widget)||z(this.recordStateMap.values()).some((function(e){return e.widgets}))}},{key:"navigateDown",value:function(){var e;if(!this.onKeyboardIn())return(e=this.overridden).navigateDown.apply(e,arguments)}},{key:"navigateUp",value:function(){this.onKeyboardIn(!0)}},{key:"catchFocus",value:function(e){var t,n=e.navigationDirection,r=e.source,a=e.editing,o=this.client,l=o.focusedCell,s=o.regions,u=D(this.recordStateMap.entries());try{for(u.s();!(t=u.n()).done;){var c=_(t.value,2),d=c[0],h=c[1];for(var f in h.expandedBodyElements)if(h.expandedBodyElements[f].widget===r){if(a){var v,g=s[s.indexOf(f)+("down"===n?1:-1)];if(g)return this.startEditInWidget(null===(v=h.widgets)||void 0===v?void 0:v[g],"down"===n)}"down"===n&&(d=o.store.getNext(d,i,!0));var m=void 0;m=a||!l||l._isDefaultFocus?this.getNavigateableColumn(o,!0,a&&"up"===n):l.column,o._focusedCell=null;var p=o.normalizeCellContext({record:d,column:m});return o.focusCell(p),a&&o.startEditing(p),!0}}}catch(e){u.e(e)}finally{u.f()}}},{key:"onKeyboardIn",value:function(e){var t,n,r,i=this.client.focusedCell,a=i&&this.recordStateMap.get(i.record),o=null==a||null===(t=a.expandedBodyElements)||void 0===t||null===(t=t[null==i||null===(n=i.column)||void 0===n?void 0:n.region])||void 0===t?void 0:t.widget;return!(null==o||!o.isGrid)&&(r=o.focusedCell&&!o.focusedCell._isDefaultFocus?o.focusedCell.column:this.getNavigateableColumn(o),o._focusedCell=null,o.focusCell(o.normalizeCellContext({record:o["".concat(e?"last":"first","VisibleRow")],column:r})),!0)}},{key:"getNavigateableColumn",value:function(e){var t,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2]?z(e.columns.visibleColumns).reverse():e.columns.visibleColumns;return null!==(t=r.find((function(t){var r;return t!==e.checkboxSelectionColumn&&t!==(null===(r=e.features.rowExpander)||void 0===r?void 0:r._expander)&&(!n||t.editor)})))&&void 0!==t?t:r[0]}},{key:"isActionAvailable",value:function(e){var t,n=e.actionName;if(Xm[n])return!this.isDisabled&&(null===(t=this.client.features.cellEdit)||void 0===t?void 0:t.isEditing)}},{key:"onTab",value:function(e){var t=this.client,n=t.features.cellEdit;if(null!=n&&n.enabled){var r,i=t.columns,a=t.regions,o=n.activeRecord,l=!0!==e,s=n.getAdjacentEditableCell(t.focusedCell,l),u=l?o:s?t.store.getById(s.id):null,c=u&&(null===(r=this.recordStateMap.get(u))||void 0===r?void 0:r.widgets);if(c&&(null==o?void 0:o.id)!==(null==s?void 0:s.id))for(var d=(s?i.getById(s.columnId):i.visibleColumns[0]).region;d;){var h=c[d];if(this.startEditInWidget(h,l))return!0;d=a[a.indexOf(d)+(l?1:-1)]}}return!1}},{key:"startEditInWidget",value:function(e){var t,n=this,r=!(arguments.length>1&&arguments[1]!==i)||arguments[1],a=this.client.features.cellEdit;if(null!=a&&a.enabled&&null!=e&&null!==(t=e.features)&&void 0!==t&&null!==(t=t.cellEdit)&&void 0!==t&&t.enabled)return a.finishEditing().then((function(){var t=e["".concat(r?"first":"last","VisibleRow")],i=n.getNavigateableColumn(e,!0,!r);e.startEditing(e.normalizeCellContext({record:t,column:i}))})),!0}},{key:"onShiftTab",value:function(){return this.onTab(!0)}},{key:"observeResize",value:function(e){var t=this;t.resizeObserver||(t.resizeObserver=new ResizeObserver((function(e){return t.onExpanderBodyResize(e)}))),t.resizeObserver.observe(e)}},{key:"unobserveResize",value:function(e){var t;null===(t=this.resizeObserver)||void 0===t||t.unobserve(e)}},{key:"doDestroy",value:function(){var e;null===(e=this.resizeObserver)||void 0===e||e.disconnect(),delete this.resizeObserver;var n,r=D(this.recordStateMap);try{for(r.s();!(n=r.n()).done;){var i=_(n.value,2)[1];this.destroyWidgets(i)}}catch(e){r.e(e)}finally{r.f()}B(t,"doDestroy",this,3)([])}},{key:"onThemeChange",value:function(e){var t,n=this,r=e.prev,i=e.theme,a=D(this.recordStateMap);try{for(a.s();!(t=a.n()).done;){var o=_(t.value,2)[1];Object.values(o.expandedBodyElements).forEach((function(e){var t,a,o=e.querySelector("."+n.shadowRootContainerClass);null!=o&&o._shadowRoot&&(li.cloneStylesIntoShadowRoot(null==o?void 0:o._shadowRoot,!0),null===(t=e.widget)||void 0===t||null===(t=t.element)||void 0===t||t.classList.remove("b-theme-".concat(r)),null===(a=e.widget)||void 0===a||null===(a=a.element)||void 0===a||a.classList.add("b-theme-".concat(i)))}))}}catch(e){a.e(e)}finally{a.f()}}},{key:"getExpandedRecord",value:function(e){var t,n=D(this.recordStateMap.entries());try{for(n.s();!(t=n.n()).done;){var r=_(t.value,2),i=r[0],a=r[1],o=a.widgets,l=a.expandedBodyElements;if(o&&e.isWidget){var s;for(var u in o)if(o[u]===e)return i;if(null!==(s=e.expandedRecord)&&void 0!==s&&s.isModel)return e.expandedRecord}else for(var c in l){var d=l[c];if(d===e||d.contains(e))return i}}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"getExpandedWidgets",value:function(e){var t;return null===(t=this.recordStateMap.get(e))||void 0===t?void 0:t.widgets}}],[{key:"properties",get:function(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",shadowRootContainerClass:"b-rowexpander-shadowroot-container",recordStateMap:new a,collapsingStateMap:new a}}},{key:"pluginConfig",get:function(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore","navigateUp"],override:["onGridBodyFocusIn","navigateDown","catchFocus","keyMapOnKeyDown"],assign:["expandRow","collapseRow"]}}}]);var n,r,o,l,s}(wc.mixin($i));S(Jm,"$name","RowExpander"),S(Jm,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0,widget:null,dataField:null,keyMap:{Tab:{handler:"onTab",weight:50},"Shift+Tab":{handler:"onShiftTab",weight:50}},autoScroll:!1,spanRegions:!1,callOnFunctions:!0}),S(Jm,"deprecatedEvents",{beforeExpand:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `beforeExpand` was replaced by the `beforeRowExpand` event on the Grid itself"},expand:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `expand` was replaced by the `rowExpand` event on the Grid itself"},beforeCollapse:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `beforeCollapse` was replaced by the `beforeRowCollapse` event on the Grid itself"},collapse:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `collapse` was replaced by the `rowCollapse` event on the Grid itself"}}),Jm._$name="RowExpander",Ug.registerFeature(Jm),We.apply((S(Km=function(){return w((function e(){m(this,e)}),[{key:"observeResize",value:function(e){var t=this,n=t._overridden;if(r.ResizeObserver)return n.observeResize.call(t,e);t.$resizeObserved||(t.$resizeObserved=new a);var i=function(e){return t.onExpanderBodyResize([{target:e}])};t.$resizeObserved.set(e,i),ya.addResizeListener(e,i)}},{key:"unobserveResize",value:function(e){var t;this._overridden.unobserveResize.call(this,e);var n=null===(t=this.$resizeObserved)||void 0===t?void 0:t.get(e);n&&(ya.removeResizeListener(e,n),this.$resizeObserved.delete(e))}},{key:"doDestroy",value:function(){var e;this._overridden.doDestroy.call(this),null===(e=this.$resizeObserved)||void 0===e||e.forEach((function(e,t){return ya.removeResizeListener(t,e)})),delete this.$resizeObserved}}])}(),"target",{class:Jm}),Km));var Qm=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(od);S(Qm,"$name","ComboModel"),S(Qm,"fields",[{name:"value"},{name:"text"}]),Qm._$name="ComboModel";var ep=/^b-icon-/,tp=/^b-fa-/,np=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateElement",value:function(e,n){var r=this,i=B(t,"updateElement",this,3)([e,n]);return"boolean"==typeof r.checked?r.role="menuitemcheckbox":r.href&&(r.role=null),r.ariaHasPopup=!!r.hasMenu&&"menu",i}},{key:"compose",value:function(){var e,t=this,n=t.checked,r=t.href,a=t.hasMenu,o=t.radio,l=t.separator,s=t.target,u=t.text,c="boolean"==typeof n,d=t.icon||(c?"b-fw-icon":""),h="b-icon-".concat(o?"radio-":""),f="object"===W(u);return S(S(S({tag:r?"a":"div",tabIndex:-1,href:r,target:s,class:{"b-has-submenu":a,"b-checked":n,"b-separator":l||(null===(e=t.cls)||void 0===e?void 0:e["b-separator"])},dataset:{group:t.toggleGroup}},c?"aria-checked":"",n),a?"aria-expanded":"",!1),"children",{iconElement:d&&{"aria-hidden":!0,tag:"i",class:F(S(S({"b-fa":tp.test(d),"b-icon":ep.test(d),"b-menuitem-icon":1},"".concat(h,"checked"),!0===n),"".concat(h,"unchecked"),!1===n),Ct.normalize(d,"object"))},textElement:S(S(S({tag:"span"},f?i:"text",f?i:u),"class",{"b-menu-text":1,"b-menu-custom-content":f}),"children",f?$e.asArray(u):null),subMenuIcon:a&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}})}},{key:"doAction",value:function(e){var t=this,n=this.parent,r={menu:n,item:t,element:t.element,bubbles:!0,domEvent:e};if("boolean"==typeof t.checked){var i=!t.checked;t.toggleGroup&&!i||(t.checked=!t.checked)}else t.href&&e.key&&t.element.click();t.trigger("beforeItem",r),t.trigger("item",r),t.closeParent&&n&&(n.rootMenu.close(),e&&!t.href&&e.preventDefault())}},{key:"focusElement",get:function(){return this.element}},{key:"contentElement",get:function(){return this.textElement}},{key:"isFocusable",get:function(){var e=this.focusElement;return e&&this.isVisible&&(e===document.body||e.offsetParent)}},{key:"hasMenu",get:function(){return this.hasConfig("menu")}},{key:"childItems",get:function(){var e=this._menu;return e?[e]:[]}},{key:"radio",get:function(){var e;return Boolean(null!==(e=this._radio)&&void 0!==e?e:this.toggleGroup)}},{key:"onFocusIn",value:function(e){var n=this.menu;B(t,"onFocusIn",this,3)([e]),!this.disabled&&n&&(n.clearTimeout(n.closeTimer),this.delay("openMenu",n.closeTimer?0:this.openMenuDelay),n.closeTimer=null)}},{key:"onFocusOut",value:function(e){var n,r=this;r.clearTimeout("openMenu"),B(t,"onFocusOut",this,3)([e]);var i=r._menu;!i||null!==(n=r.owner)&&void 0!==n&&n.ignoreFocusOut||(li.usingKeyboard?r.closeMenu():(i.clearTimeout(i.closeTimer),i.closeTimer=i.setTimeout((function(){return r.closeMenu()}),i.closeMenuDelay),i.once("hide",(function(){return i.clearTimeout(i.closeTimer)}))))}},{key:"openMenu",value:function(e){var t=this.menu,n=this.parent;!this.disabled&&t&&(t.focusOnToFront=e,n.isMenu?n.openSubMenu(this.element,this):t.show())}},{key:"onChildShow",value:function(e){B(t,"onChildShow",this,3)([e]),this.ariaElement.setAttribute("aria-expanded",!0)}},{key:"closeMenu",value:function(){this._menu.isWidget&&this.menu.close(),this.menu.closeTimer=null}},{key:"onChildHide",value:function(e){B(t,"onChildHide",this,3)([e]),this.ariaElement.setAttribute("aria-expanded",!1)}},{key:"changeToggleGroup",value:function(e){return e&&"boolean"!=typeof this.checked&&(this.checked=!1),e}},{key:"changeChecked",value:function(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}},{key:"updateChecked",value:function(e){var t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.element.setAttribute("aria-checked",e),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}},{key:"getToggleGroupMembers",value:function(){var e=this,t=e.checked,n=e.toggleGroup,r=e.element,i=[];return t&&n&&li.forEachSelector(e.rootElement,"[data-group=".concat(n,"]"),(function(e){if(e!==r){var t=Lo.fromElement(e);t&&i.push(t)}})),i}},{key:"uncheckToggleGroupMembers",value:function(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((function(e){return e.checked=!1}))}},{key:"closeParent",get:function(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}},{key:"changeMenu",value:function(e,t){var n=this,r=n.owner,i=r.constrainTo,a=r.scrollAction,o=r.focusOnHover;return!e||"object"!==W(e)||"type"in e&&"menu"!==e.type||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),ap.reconfigure(t,e?ap.mergeConfigs(n.menuDefaults,S(S(S(S({owner:n,forElement:n.element,ariaLabel:n.text},t?"positioned":"_",!1),"focusOnHover",o),"constrainTo",i),"scrollAction",a),e):null,n)}}],[{key:"configurable",get:function(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},menuDefaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,floating:!0,autoShow:!1,cls:{"b-sub-menu":1}},icon:null,text:null,closeParent:null,href:null,radio:null,target:null,localizableProperties:["text"],role:"menuitem",openMenuDelay:120}}}])}(Lo);S(np,"$name","MenuItem"),S(np,"type","menuitem"),np.initClass(),np._$name="MenuItem";var rp,ip={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1},ap=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){Array.isArray(e)&&(e={lazyItems:e}),B(t,"construct",this,3)([e]),fr.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}},{key:"afterShow",value:function(){var e=this.items,n=this.element;e.some((function(e){return e.hasConfig("menu")}))&&n.classList.add("b-menu-with-submenu"),e.some((function(e){return e.icon}))&&n.classList.add("b-menu-with-icon"),B(t,"afterShow",this,3)(arguments)}},{key:"createWidget",value:function(e){return"string"==typeof e&&(e={text:e}),B(t,"createWidget",this,3)([e])}},{key:"focusElement",get:function(){var e,n=this,r=null===(e=n.parentMenu)||void 0===e?void 0:e.element.contains(li.getActiveElement(n.parentMenu)),i=n.items[0];return!r&&!li.usingKeyboard&&i instanceof np?n.element:B(t,"focusElement",this,1)}},{key:"onDocumentMouseDown",value:function(e){var n=e.event;if(!this.parentMenu||!this.parentMenu.owns(n.target))return B(t,"onDocumentMouseDown",this,3)(arguments)}},{key:"hide",value:function(e){var n,r,i=this,a=B(t,"hide",this,3)([e]);i.isVisible||(null===(n=i.currentSubMenu)||void 0===n||null===(r=n.hide)||void 0===r||r.call(n,e),i.parentMenu&&(i.parentMenu.currentSubMenu=null));return a}},{key:"show",value:function(){var e=B(t,"show",this,3)(arguments),n=this.parentMenu;return this.isVisible&&n&&(n.currentSubMenu=this),e}},{key:"onMouseClick",value:function(e){var t=e.target.closest(".b-menuitem");t&&this.triggerElement(t,e)}},{key:"onMouseOver",value:function(e){if(!1!==this.focusOnHover){var t,n=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(".b-widget"),r=e.target.closest(".b-widget"),i=Lo.fromElement(r);!li.isTouchEvent&&r&&r!==n&&i.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}}},{key:"handleMouseOver",value:function(e){e.focus()}},{key:"onMouseEnter",value:function(){this.clearTimeout(this.closeTimer);var e=this.parentMenu;e&&(e.ignoreFocusOut=!0,e.setTimeout((function(){return e.ignoreFocusOut=!1}),500),e.clearTimeout(e.hideSubMenuTimer))}},{key:"onMouseLeave",value:function(e){var t=this,n=e.relatedTarget,r=n&&t.owns(n),i=n instanceof HTMLElement&&Lo.fromElement(n),a=!r;if(i){for(;i.ownerCmp;)i=i.ownerCmp;a&=!li.getAncestor(i.element,[e.target])}!r&&a&&(t.currentSubMenu&&(t.hideSubMenuTimer=t.setTimeout((function(){var e;return null===(e=t.currentSubMenu)||void 0===e?void 0:e.hide()}),t.closeMenuDelay)),t.element.contains(li.getActiveElement(t))&&li.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}},{key:"onInternalKeyDown",value:function(e){var n=Lo.fromElement(e),r=n&&n!==this&&!(n instanceof np);if("Escape"!==e.key){if(B(t,"onInternalKeyDown",this,3)([e]),!r){ip[e.key]&&e.preventDefault();var i=this.element,a=li.getActiveElement(i);this.navigateFrom(a!==i&&i.contains(a)?a:null,e.key,e)}}else(r?this:this.rootMenu).close()}},{key:"navigateFrom",value:function(e,t,n){var r,i,a,o=this,l=o.treeWalker,s=e&&o.getItem(e),u=o.rtl?"ArrowLeft":"ArrowRight",c=o.rtl?"ArrowRight":"ArrowLeft";switch(t){case"ArrowUp":l.currentNode=e||(e=o.bottomFocusTrap),l.previousNode(),a=l.currentNode,null==s||null===(r=s.menu)||void 0===r||r.hide(!1);break;case"ArrowDown":l.currentNode=e||(e=o.topFocusTrap),l.nextNode(),a=l.currentNode,null==s||null===(i=s.menu)||void 0===i||i.hide(!1);break;case" ":e&&!e.classList.contains("b-disabled")&&(null!=s&&s.menu?o.openSubMenu(e,s):o.triggerElement(e,n));break;case u:if(e&&null!=s&&s.menu&&!e.classList.contains("b-disabled")){var d=o.openSubMenu(e,s);null==d||d.focus()}else l.currentNode=e||(e=o.topFocusTrap),l.nextNode(),a=l.currentNode;break;case c:o.isSubMenu?o.hide():e||(l.currentNode=e||(e=o.topFocusTrap),l.nextNode(),a=l.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&o.triggerElement(e,n)}a&&(a===o.element?o.navigateFrom(o.bottomFocusTrap,"ArrowUp",n):a===e?o.navigateFrom(o.topFocusTrap,"ArrowDown",n):a.focus())}},{key:"getItem",value:function(e){if(null!=e)return"number"==typeof e?this.items[e]:e.nodeType===Element.ELEMENT_NODE?Lo.fromElement(e,"menuitem",this.contentElement):this.items.find((function(t){return t.id==e}))}},{key:"triggerElement",value:function(e,t){var n=this.getItem(e);n&&!n.disabled&&n.doAction(t)}},{key:"isSubMenu",get:function(){var e;return this===(null===(e=this.owner)||void 0===e?void 0:e.menu)}},{key:"openSubMenu",value:function(e,t){var n=t.menu;if(n){if(!n.isVisible){var r,i={item:t,element:e};if(!1===this.trigger("beforeSubMenu",i))return;if(!1===(null===(r=t.onBeforeSubMenu)||void 0===r?void 0:r.call(t,i)))return;n.show(),n.isVisible&&!n.isMenu&&(this.currentSubMenu=n)}return n}}},{key:"selectedElement",get:function(){return this._selectedElement},set:function(e){var t=this,n=t._selectedElement;if(n){var r=t.getItem(n),i=null==r?void 0:r.menu;null==i||i.hide(),n.classList.remove("b-active")}if(t._selectedElement=e,e){var a=li.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!a,focus:a})}}},{key:"selectFirst",value:function(){var e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((function(){return e.currentNode.focus()}))}},{key:"parentMenu",get:function(){var e,t=this.owner;return t&&(t.isMenu?t:null===(e=t.up)||void 0===e?void 0:e.call(t,"menu"))}},{key:"rootMenu",get:function(){for(var e=this;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}])}(fc);S(ap,"$name","Menu"),S(ap,"type","menu"),S(ap,"configurable",{layout:"vbox",focusable:!0,draggable:!1,showAnimation:null,hideAnimation:{opacity:{from:1,to:0,duration:".15s",delay:"0s"}},align:{align:"t-b"},scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",closeMenuDelay:200,testConfig:{hideAnimation:null,closeMenuDelay:1}}),ap.initClass(),ap._$name="Menu";var op=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(B(t,"construct",this,3)(r),null===(e=this.type)||void 0===e||!e.length)throw new Error("Config 'type' is required to be specified for context menu")}},{key:"onElementContextMenu",value:function(e){this.onElementEvent(e)}},{key:"onElementClick",value:function(e){this.onElementEvent(e)}},{key:"onElementDblClick",value:function(e){this.onElementEvent(e)}},{key:"onElementEvent",value:function(e){if(e.handled||this.triggerEvent!==e.type)"click"===e.type&&this.clickTriggerSelector&&e.target.matches(this.clickTriggerSelector)&&this.internalShowContextMenu(e,{align:"l-r",target:e.target});else{if(!0===e.ctrlKey&&!ne.isMac)return void e.preventDefault();var t=e;if(rp){var n=rp.target;e=fr.fixEvent(new MouseEvent(e.type,e)),Object.defineProperties(e,{target:{value:n},offsetX:{value:t.offsetX},offsetY:{value:t.offsetY}}),e.preventDefault=function(){t.preventDefault(),t.handled=!0}}this.internalShowContextMenu(e)}}},{key:"showContextMenuByKey",value:function(e){if(!li.isEditable(e.target)){var t=e.target;if(t)return rp=e,li.triggerMouseEvent(t,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),rp=null,!0}return!1}},{key:"internalShowContextMenu",value:function(e,t){var n,r=this;r.disabled||!e.handled&&!e.defaultPrevented&&(n=r.getDataFromEvent(e))&&r.shouldShowMenu(n)&&("contextmenu"===e.type&&ne.isSafari&&!e.ctrlKey&&e.metaKey&&fr.on({element:e.target,capture:!0,once:!0,thisObj:this,click:function(e){e.preventDefault(),e.stopImmediatePropagation()}}),n.domEvent=e,r.showContextMenu(n,t))}},{key:"getDataFromEvent",value:function(e){return{feature:this,event:e,targetElement:this.getTargetElementFromEvent(e)}}},{key:"getTargetElementFromEvent",value:function(e){return e.target}},{key:"showContextMenu",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this,o=li.isDOMEvent(t),l=o?a.getDataFromEvent(t):t,s=o?t:l.domEvent,u=null===(r=li.isInView(l.targetElement))||void 0===r?void 0:r.center,null===(i=a._menu)||void 0===i||i.hide(),!a.disabled&&u){e.next=4;break}return e.abrupt("return");case 4:if(a.menuContext=l,c=a.type,d=a.client,h=a.processItems,pe.assign(l,{point:null!=s&&s.clientX?[s.clientX+1,s.clientY+1]:[u.x,u.y],menu:a,items:{},selection:d.selectedRecords}),a.callChainablePopulateMenuMethod(l),pe.merge(l.items,a.baseItems),a.preventNativeMenu&&a.preventDefaultEvent(l),e.t1=!h,e.t1){e.next=16;break}return e.next=14,a.callback(h,d,[l]);case 14:e.t2=e.sent,e.t1=!1!==e.t2;case 16:if(e.t0=e.t1,!e.t0){e.next=19;break}e.t0=a.hasActiveMenuItems(l);case 19:if(!e.t0){e.next=33;break}if(a.populateItemsWithData(l),!1===a.beforeContextMenuShow(l)){e.next=33;break}if(f=a.menu,v=f.featureItems,g=l.items,a.preventDefaultEvent(l),m=d.trigger("".concat(c,"MenuBeforeShow"),l),!Be.isPromise(m)){e.next=30;break}return s.handled=!0,e.next=29,m;case 29:m=e.sent;case 30:if(Object.values(g).some((function(e){return e}))){e.next=32;break}return e.abrupt("return");case 32:!1!==m&&(v&&(f.remove(v),$e.asArray(v).forEach((function(e){return e.destroy()}))),f.featureItems=f.add.apply(f,z(Array.isArray(g)?g:f.processItemsObject(g))),f.showBy(n||{target:l.domEvent,align:"s0-e100"}),null===(p=a.touchMoveDetacher)||void 0===p||p.call(a),a.touchMoveDetacher=fr.on({element:d.element,touchmove:function(){return f.hide()},thisObj:f,once:!0}),s&&(s.preventDefault(),s.handled=!0));case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"baseItems",get:function(){if(!this._baseItems){var e=this,t=e.namedItems,n=e._baseItems=pe.assign({},e.items);for(var r in n){var i=n[r];i&&(t&&r in t?n[r]="object"===W(i)?pe.merge(pe.clone(t[r]),i):t[r]:!0===i&&delete n[r])}}return this._baseItems}},{key:"hideContextMenu",value:function(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}},{key:"callChainablePopulateMenuMethod",value:function(e){var t,n;null===(t=(n=this.client)["populate".concat(Le.capitalize(this.type),"Menu")])||void 0===t||t.call(n,e)}},{key:"hasActiveMenuItems",value:function(e){return Object.values(e.items).some((function(e){return e&&!e.hidden}))}},{key:"shouldShowMenu",value:function(){return!0}},{key:"beforeContextMenuShow",value:function(e){}},{key:"populateItemsWithData",value:function(e){}},{key:"preventDefaultEvent",value:function(e){var t;null===(t=e.event)||void 0===t||t.preventDefault()}},{key:"triggerEvent",get:function(){return this._triggerEvent||this.client.contextMenuTriggerEvent}},{key:"changeMenu",value:function(e,t){var n=this,r=n.client,i=n.type;if(e)return ap.reconfigure(t,e?ap.mergeConfigs({owner:r,rootElement:r.rootElement,onItem:function(e){r.trigger("".concat(i,"MenuItem"),e)},onToggle:function(e){r.trigger("".concat(i,"MenuToggleItem"),e)},onDestroy:function(){n.menu=null},onBeforeItem:function(e){Object.assign(e,n.menuContext)},onShow:function(e){var t=e.source;n.menuContext.menu=t,r.trigger("".concat(i,"MenuShow"),n.menuContext)}},e):null,n);null!=t&&t.isWidget&&t.destroy()}}],[{key:"configurable",get:function(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",constrainTo:r,scrollAction:null}},items:{},triggerEvent:null,clickTriggerSelector:null,preventNativeMenu:null,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}},{key:"pluginConfig",get:function(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}}]);var n}(wc);S(op,"$name","ContextMenuBase"),op._$name="ContextMenuBase";var lp={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},sp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)([e]),n.handleSelector||ne.isHoverableDevice||(n.handleSize=n.touchHandleSize),n.handleVisibilityThreshold=n.handleVisibilityThreshold||2*n.handleSize,n.initListeners(),n.initResize()}},{key:"doDestroy",value:function(){this.abort(!0),B(t,"doDestroy",this,3)([])}},{key:"updateSkipUpdatingElement",value:function(e){e&&(this.skipTranslate=!0)}},{key:"getX",value:function(e){return"inset"===this.positioning?parseFloat(getComputedStyle(e).insetInlineStart,10):li.getTranslateX(e)}},{key:"getY",value:function(e){return"inset"===this.positioning?parseFloat(getComputedStyle(e).insetBlockStart,10):li.getTranslateY(e)}},{key:"setX",value:function(e,t){"inset"===this.positioning?e.style.insetInlineStart=t+"px":li.setTranslateX(e,t)}},{key:"setY",value:function(e,t){"inset"===this.positioning?e.style.insetBlockStart=t+"px":li.setTranslateY(e,t)}},{key:"initResize",value:function(){var e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=function(t){return t.closest(e.targetSelector)}),e.grab){var t=e.grab,n=t.edge,r=t.element,i=t.event;e.startEvent=i;var a=e.getX(r)||r.offsetLeft,o=e.getY(r)||r.offsetTop;e.context={element:r,edge:n,valid:!0,async:!1,elementStartX:a,elementStartY:o,newX:a,newY:o,elementWidth:r.offsetWidth,elementHeight:r.offsetHeight,startX:i.clientX+e.scrollLeft,startY:i.clientY+e.scrollTop,finalize:function(){var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},r.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}},{key:"initListeners",value:function(){var e=this,t={element:e.outerElement,mousedown:lp.down,touchstart:lp.touchstart,thisObj:e};!e.handleSelector&&ne.isHoverableDevice&&(t.mousemove={handler:lp.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),fr.on(t)}},{key:"isRTL",get:function(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}},{key:"scrollLeft",get:function(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}},{key:"scrollTop",get:function(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}},{key:"internalStartResize",value:function(e){var t,n={element:document,keydown:lp.keydown,thisObj:this};e?(n.touchmove=lp.touchmove,n.touchend=n.pointerup=lp.touchend):(n.mousemove=lp.move,n.mouseup=lp.up),this.removeDragListeners=fr.on(n),null===(t=this.onResizeHandlePointerDown)||void 0===t||t.call(this,this.startEvent)}},{key:"removeDragListeners",value:function(){}},{key:"reset",value:function(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null,this.trigger("reset")}},{key:"canResize",value:function(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}},{key:"onPointerDown",value:function(e,t){var n=this;n.startEvent=t,n.canResize(t.target,t)&&n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),"touchstart"===t.type&&t.preventDefault(),n.internalStartResize(e))}},{key:"onTouchStart",value:function(e){e.touches.length>1||this.onPointerDown(!0,e)}},{key:"onMouseDown",value:function(e){0===e.button&&this.onPointerDown(!1,e)}},{key:"internalMove",value:function(e,t){var n=this,r=n.context,i=n.direction;if(null!=r&&r.element&&(r.started||fr.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)){var a;if(!r.started)null===(a=n.scrollManager)||void 0===a||a.startMonitoring(Be.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:i}],callback:function(e){var t;return(null===(t=n.context)||void 0===t?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:r,event:t}),r.started=!0;n.update(t)}else e||n.handleSelector||n.checkResizeHandles(t)}},{key:"onTouchMove",value:function(e){this.internalMove(!0,e)}},{key:"onMouseMove",value:function(e){this.internalMove(!1,e)}},{key:"onPointerUp",value:function(e,t){var n,r,i,a=this,o=a.context;(null===(n=a.removeDragListeners)||void 0===n||n.call(a),o)?(null===(r=a.scrollManager)||void 0===r||r.stopMonitoring(),o.started&&fr.on({element:li.getRootElement(t.target),thisObj:a,click:lp.docclick,expires:a.clickSwallowDuration,capture:!0,once:!0}),a.finishResize(t)):null===(i=a.reset)||void 0===i||i.call(a)}},{key:"onTouchEnd",value:function(e){this.onPointerUp(!0,e)}},{key:"onMouseUp",value:function(e){this.onPointerUp(!1,e)}},{key:"onDocumentClick",value:function(e){e.stopPropagation()}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&this.abort()}},{key:"update",value:function(e){var t=this,n=t.context,r=t.constrainToParent,i=n.element;if(r){var a=pt.from(t.outerElement);n.currentX=Math.max(Math.min(e.clientX,a.right),a.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY,a.bottom),a.y)+t.scrollTop}else n.currentX=e.clientX+t.scrollLeft,n.currentY=e.clientY+t.scrollTop;i.classList.add(t.resizingCls),t.updateResize(e)&&(t.trigger("resizing",{context:n,event:e}),i.classList.toggle(t.invalidCls,!1===n.valid)),t.lastMouseMoveEvent=e}},{key:"abort",value:function(){var e,t,n=arguments.length>0&&arguments[0]!==i&&arguments[0],r=this;null===(e=r.scrollManager)||void 0===e||null===(t=e.stopMonitoring)||void 0===t||t.call(e),r.context?r.abortResize(null,n):r.isDestroyed||r.reset()}},{key:"grabResizeHandle",value:function(e,t){var n=this;if(n.allowResize&&!n.allowResize(t.target,t))return!1;var r=n.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,a=i.clientX,o=i.clientY,l=n.targetSelector?t.target.closest(n.targetSelector):t.target;if(l){var s,u;if(r){if(!t.target.matches(r))return!1;u="horizontal"===n.direction?t.pageX<li.getPageX(l)+l.offsetWidth/2?n.isRTL?"right":"left":n.isRTL?"left":"right":t.pageY<li.getPageY(l)+l.offsetHeight/2?"top":"bottom"}else if("horizontal"===n.direction?n.overLeftHandle(t,l)?u=n.isRTL?"right":"left":n.overRightHandle(t,l)&&(u=n.isRTL?"left":"right"):n.overTopHandle(t,l)?u="top":n.overBottomHandle(t,l)&&(u="bottom"),!u)return n.context=null,!1;"touchstart"===t.type&&t.preventDefault();var c=null===(s=n.internalBeforeStart)||void 0===s?void 0:s.call(n,{element:l,edge:u});if(c&&(l=c.element,u=c.edge),!1!==n.trigger("beforeResizeStart",{element:l,event:t})){var d=n.getX(l)||l.offsetLeft,h=n.getY(l)||l.offsetTop;return n.context={element:l,edge:u,isTouch:e,valid:!0,async:!1,direction:n.direction,elementStartX:d,elementStartY:h,newX:d,newY:h,elementWidth:l.offsetWidth,elementHeight:l.offsetHeight,startX:a+n.scrollLeft,startY:o+n.scrollTop,finalize:function(){var e;return null===(e=n.reset)||void 0===e?void 0:e.call(n)}},l.classList.add(n.resizingCls),!0}}return!1}},{key:"checkResizeHandles",value:function(e){var t=this,n=t.targetSelector?e.target.closest(t.targetSelector):e.target,r=!1;return!n||t.allowResize&&!t.allowResize(e.target,e)?t.currentElement&&t.unHighlightHandle():(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&((r="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n))?t.highlightHandle():t.unHighlightHandle())),r}},{key:"onMouseLeaveTarget",value:function(e){var t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}},{key:"updateResize",value:function(e){var t,n=this,r=n.context,i=n.allowEdgeSwitch,a=n.skipTranslate,o=n.skipUpdatingElement;i&&("horizontal"===n.direction?r.edge=r.currentX>r.startX?"right":"left":r.edge=r.currentY>r.startY?"bottom":"top");var l=r.element,s=r.elementStartX,u=r.elementStartY,c=r.elementWidth,d=r.elementHeight,h=r.edge,f=l.style,v=(r.currentX-r.startX)*("inset"===n.positioning&&n.isRTL?-1:1),g=r.currentY-r.startY,m=li.getExtremalSizePX(l,"minWidth")||n.minWidth,p=li.getExtremalSizePX(l,"maxWidth")||n.maxWidth,y=li.getExtremalSizePX(l,"minHeight")||n.minHeight,k=li.getExtremalSizePX(l,"maxHeight")||n.maxHeight,b=("right"!==h||n.isRTL&&"inset"!==n.positioning)&&"bottom"!==h?-1:1,C=c+v*b,w=d+g*b,D=Math.max(m,C),S=Math.max(y,w);if(p>0&&(D=Math.min(D,p)),k>0&&(S=Math.min(S,k)),"horizontal"===n.direction&&c!==D){if(o||(f.flex="",f.width=Math.abs(D)+"px"),r.newWidth=D,"left"===h||D<0){var x=Math.max(Math.min(s+c-n.minWidth,s+v),0);a||n.setX(l,Math.round(x)),r.newX=x}else"right"===h&&i&&!a&&n.setX(l,s);t=!0}else"vertical"===n.direction&&d!==w&&(o||(f.flex="",f.height=Math.abs(S)+"px"),r.newHeight=S,"top"===h||S<0?(r.newY=Math.max(Math.min(u+d-n.minHeight,u+g),0),a||n.setY(l,r.newY)):"bottom"===h&&i&&!a&&n.setY(l,u),t=!0);return t}},{key:"finishResize",value:function(e){var t=this,n=t.context,r={context:n,event:e};if(n.element.classList.remove(t.resizingCls),n.started){var i=!1;i="horizontal"===t.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,t.trigger(i?"resize":"cancel",r),n.async||n.finalize()}else{var a;null===(a=t.reset)||void 0===a||a.call(t)}}},{key:"abortResize",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.context;r.element.classList.remove(n.resizingCls),"horizontal"===n.direction?(("left"===r.edge||r.allowEdgeSwitch&&!r.skipTranslate)&&n.setX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(n.setY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&n.trigger("cancel",{context:r,event:e}),n.isDestroyed||n.reset()}},{key:"highlightHandle",value:function(){var e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}},{key:"unHighlightHandle",value:function(){var e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}},{key:"overAnyHandle",value:function(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}},{key:"overStartHandle",value:function(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}},{key:"overEndHandle",value:function(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}},{key:"getDynamicHandleSize",value:function(e,t){var n=e?2:1,r=this.handleSize;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}},{key:"overLeftHandle",value:function(e,t){var n=this,r=t.offsetWidth;if(n.leftHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){var i=pt.from(t);return i.width=n.getDynamicHandleSize(n.rightHandle,r),i.width>0&&i.contains(fr.getPagePoint(e))}return!1}},{key:"overRightHandle",value:function(e,t){var n=this,r=t.offsetWidth;if(n.rightHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){var i=pt.from(t);return i.x=i.right-n.getDynamicHandleSize(n.leftHandle,r),i.width>0&&i.contains(fr.getPagePoint(e))}return!1}},{key:"overTopHandle",value:function(e,t){var n=this,r=t.offsetHeight;if(n.topHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){var i=pt.from(t);return i.height=n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(fr.getPagePoint(e))}return!1}},{key:"overBottomHandle",value:function(e,t){var n=this,r=t.offsetHeight;if(n.bottomHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){var i=pt.from(t);return i.y=i.bottom-n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(fr.getPagePoint(e))}return!1}}],[{key:"defaultConfig",get:function(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,constrainToParent:!0,rtlSource:null}}}])}(_n(Mn));S(sp,"configurable",{skipUpdatingElement:null}),sp._$name="ResizeHelper";var up=function(e){function t(e,n){var r;return m(this,t),(r=g(this,t)).timeZone=e,r.year=n,r}return R(t,e),w(t)}(Y(Array)),cp=function(){return w((function e(t,n){m(this,e),this.asString=t,this.timeZone=n,this.asArray=fp(t)}),[{key:"asLocalDate",get:function(){return this._asLocalDate||(this._asLocalDate=b(Date,z(this.asArray))),this._asLocalDate}},{key:"asTicksUtc",get:function(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC.apply(Date,z(this.asArray))).getTime()),this._asTicksUtc}}])}(),dp=function(e,t){var n=e.toLocaleString("sv-SE",{timeZone:t});return new cp(n,t)},hp=function(e,t){var n=dp(new Date(e),t),r=n.asTicksUtc;return{offset:(e-r)/6e4,tzTicksUtc:r,tzString:n.asString}},fp=function(e){var t=e.split(/[\s-:]/).map((function(e){return 1*e}));return t[1]-=1,t},vp=-864e5,gp=2592e6,mp=function(e,t){var n=pp.get(e,t);if(n)return n;for(var r,i,a,o,l=new up(e,t),s=new Date(Date.UTC(t,0,1)).getTime(),u=s,c=gp,d=0,h=[],f=null;!o;){var v=hp(u,e);a=v.offset,r=v.tzTicksUtc,i=v.tzString,null==f?(f=a,l.push({offset:a})):c>0&&a!==f?c=c===gp?vp:-6e4:c<0&&a===f&&(c===vp?c=36e5:(1===l.length?(l.push(h),f=h.offset):(l[0].startTicks=h.startTicks,l[0].startDateString=h.startDateString,o=!0),c=gp)),h={offset:a,startDateString:i,startTicks:r},c===gp&&(u=s,u+=d*gp,d+=1),u+=c,d>11&&(o=!0)}return pp.set(l),l},pp={_cache:{},get:function(e,t){var n;return null===(n=this._cache[e])||void 0===n?void 0:n[t]},set:function(e){var t=e.timeZone,n=this._cache;n[t]||(n[t]={}),n[t][e.year]=e}},yp=function(){return w((function e(){m(this,e)}),null,[{key:"toTimeZone",value:function(e,t){if("number"==typeof t)return this.toUtcOffset(e,t);var n=dp(e,t);return n.asArray[3]!==n.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),n.asLocalDate}},{key:"fromTimeZone",value:function(e,t){if("number"==typeof t)return this.fromUtcOffset(e,t);var n=this.dateAsArray(e),r=mp(t,e.getUTCFullYear()),i=r[0].offset;if(2===r.length){var a=Date.UTC.apply(Date,z(n));a>=r[1].startTicks&&a<r[0].startTicks&&(i=r[1].offset)}return n[4]+=i,new Date(Date.UTC.apply(Date,z(n)))}},{key:"toUtcOffset",value:function(e,t){var n=e.getTimezoneOffset()+t;return new Date(e.getTime()+60*n*1e3)}},{key:"fromUtcOffset",value:function(e,t){var n=-e.getTimezoneOffset()-t;return new Date(e.getTime()+60*n*1e3)}},{key:"dateAsArray",value:function(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}}])}();S(yp,"$name","TimeZoneHelper"),yp.findOffsetDates=mp,te.register(yp),yp._$name="TimeZoneHelper";var kp=function(){return w((function e(){m(this,e)}),null,[{key:"getById",value:function(e){return Ne.deprecate("core","7.0.0","Use Widget.getById instead"),Lo.getById(e)}},{key:"fromElement",value:function(e,t,n){return Ne.deprecate("core","7.0.0","Use Widget.fromElement instead"),Lo.fromElement(e,t,n)}},{key:"createWidget",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return Ne.deprecate("core","7.0.0","Use Widget.create instead"),e.isWidget?e:Lo.create(e)}},{key:"append",value:function(e,t){if(Ne.deprecate("core","7.0.0","Use a Container instead"),e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){var n="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;n.firstChild?t.insertBefore=n.firstChild:t.appendTo=n}return e.map((function(e){return Lo.create(Be.assign({},t||{},e))}))}},{key:"openPopup",value:function(e,t){return Ne.deprecate("core","7.0.0","Use Popup directly instead"),Lo.create(Be.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}},{key:"showContextMenu",value:function(e,t){Ne.deprecate("core","7.0.0","Use Menu directly instead");var n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:(t.forElement=document.body,Array.isArray(e)&&(e=b(yt,z(e))),e instanceof yt&&(t.align={position:e})),t.internalListeners={destroy:n.currentContextMenu=null},n.currentContextMenu=Lo.create(t,"menu")}},{key:"attachTooltip",value:function(e,t){return Ne.deprecate("core","7.0.0","Use Tooltip directly instead"),Lo.attachTooltip(e,t)}},{key:"hasTooltipAttached",value:function(e){return Ne.deprecate("core","7.0.0","Will be removed"),Lo.resolveType("tooltip").hasTooltipAttached(e)}},{key:"destroyTooltipAttached",value:function(e){return Ne.deprecate("core","7.0.0","Will be removed"),Lo.resolveType("tooltip").destroyTooltipAttached(e)}},{key:"mask",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:"Loading";if(Ne.deprecate("core","7.0.0","Use Mask directly instead"),e)return e instanceof HTMLElement&&(e={target:e,text:t}),gs.mask(e,e.target)}},{key:"unmask",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];Ne.deprecate("core","7.0.0","Use Mask directly instead"),e.mask&&(t?e.mask.close():e.mask.hide())}},{key:"toast",value:function(e){return Ne.deprecate("core","7.0.0","Use Toast directly instead"),Wm.show(e)}}])}();kp._$name="WidgetHelper";var bp=function(){return w((function e(){m(this,e)}),null,[{key:"convertFromObject",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{};pe.assignIf(t,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});var n=t.rootName,r=t.elementName,a=t.includeHeader,o=t.rootElementForArray,l=t.xmlns;l=l?' xmlns="'.concat(l,'"'):"";var s=function(e){var t=[];for(var n in e){var i=e[n];if(Array.isArray(i)){o&&t.push("<".concat(n,">"));var a,l=D(i);try{for(l.s();!(a=l.n()).done;){var u=a.value;r.length?t.push("<".concat(r,">")):t.push("<".concat(n,">")),t.push(s(u)),r.length?t.push("</".concat(r,">")):t.push("</".concat(n,">"))}}catch(e){l.e(e)}finally{l.f()}o&&t.push("</".concat(n,">"))}else pe.isObject(i)?t.push("<".concat(n,">").concat(s(i),"</").concat(n,">")):null==i?t.push("<".concat(n,"/>")):t.push("<".concat(n,">").concat(Le.encodeHtml(i),"</").concat(n,">"))}return t.join("")};return"".concat(a?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':"","<").concat(n).concat(l,">").concat(s(e),"</").concat(n,">")}}])}();bp._$name="XMLHelper";var Cp=function(){return w((function e(){m(this,e),this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}),[{key:"nextRandom",value:function(e){var t,n=this.randomCache;return n[e]?t=n[e]:(t=this.random100.filter((function(t){return t<e})),n[e]=t),t[this.rndIndex++%t.length]}},{key:"reset",value:function(){this.rndIndex=0}},{key:"fromArray",value:function(e){return e[this.nextRandom(e.length)]}},{key:"randomArray",value:function(e,t){for(var n=[],r=this.nextRandom(t+1),i={},a=0,o=this.nextRandom(e.length);a<r;a++){for(;i[o];)o=this.nextRandom(e.length);i[o]=!0,n.push(e[o])}return n}}])}();Cp._$name="RandomGenerator";var wp=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"],Dp=function(){function e(){m(this,e)}return w(e,null,[{key:"reset",value:function(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}},{key:"cities",get:function(){return["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Montreal"]}},{key:"namesWithAvatars",get:function(){return["Adam","Amit","Angelo","Arcady","Arnold","Barbara","Celia","Chang","Dan","Daniel","Dave","David","Don","Doug","Emilia","George","Gloria","Henrik","Hitomi","James","Jane","Jenny","John","Jong","Karen","Kate","Lee","Linda","Lisa","Lola","Macy","Madison","Malik","Mark","Mary","Maxim","Melissa","Mike","Rob","Steve","Team","Theo"]}},{key:"firstNames",get:function(){return["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"]}},{key:"surNames",get:function(){return["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"]}},{key:"teams",get:function(){return["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"]}},{key:"foods",get:function(){return["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"]}},{key:"colors",get:function(){return["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}},{key:"skills",get:function(){return["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"]}},{key:"tasks",get:function(){return["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]}},{key:"generateName",value:function(){var e=this.namesWithAvatars,t=this.surNames,n=e[Math.round(Math.random()*(e.length-1))],r=t[Math.round(Math.random()*(t.length-1))];return"".concat(n," ").concat(r)}},{key:"generate",value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i?arguments[2]:1;return L().mark((function a(){var o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x,E,R,T,M,F;return L().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:"object"===W(e)&&(n=e.randomHeight,r=null!==(s=e.initialId)&&void 0!==s?s:1,o=e.addSkills,l=e.rowCallback,e=e.count),c=(u=t).rnd,d=u.rndTime,h=u.rndRating,f=u.rndText,v=u.firstNames,g=u.surNames,m=u.teams,p=u.foods,y=u.colors,k=u.cities,b=u.skills,C=0;case 3:if(!(C<e)){a.next=14;break}return D=c.fromArray(v),S=c.fromArray(g),x="".concat(D," ").concat(String.fromCharCode(65+C%25)," ").concat(S),E=c.nextRandom(60)+1,R=new Date(2019,0,E),T=new Date(2019,0,E+c.nextRandom(30)+2),M={id:r>-1?C+r:i,title:"Row "+C,name:x,firstName:D,surName:S,city:c.fromArray(k),team:c.fromArray(k)+" "+c.fromArray(m),age:10+c.nextRandom(80),food:c.fromArray(p),color:c.fromArray(y),score:10*c.nextRandom(100),rank:c.nextRandom(100)+1,start:R,finish:T,time:Pl.getTime(d.nextRandom(24),5*d.nextRandom(12)),percent:c.nextRandom(100),done:c.nextRandom(100)<50,rating:h.nextRandom(5),active:E>30,relatedTo:Math.min(e-1,C+r+c.nextRandom(10)),notes:wp[f.nextRandom(7)+1]},o&&(M.skills=c.randomArray(b,"number"==typeof o?o:7)),(F=null===(w=l)||void 0===w?void 0:w(M))&&Object.assign(M,F),n&&(M.rowHeight=5*c.nextRandom(!0===n?20:n)+20),a.next=11,M;case 11:C++,a.next=3;break;case 14:case"end":return a.stop()}}),a)}))()}},{key:"generateData",value:function(t){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i?arguments[2]:1,a=!(arguments.length>3&&arguments[3]!==i)||arguments[3],o=t;"object"!==W(t)&&(o={count:t,randomHeight:n,initialId:r,reset:a}),!1!==o.reset&&this.reset(),e.overrideRowCount&&(o.count=e.overrideRowCount);for(var l=[],s=this.generate(o),u=0;u<o.count;u++)l.push(s.next().value);return l}},{key:"generateEvents",value:function(e){var t=e.viewStartDate;e.viewEndDate;var n,r,i=e.nbrResources,a=void 0===i?50:i,o=e.nbrEvents,l=void 0===o?5:o,s=e.dependencies,u=e.tickUnit,c=void 0===u?"days":u,d=e.minDuration,h=void 0===d?2:d,f=e.maxDuration,v=void 0===f?10:f,g=e.gap,m=void 0===g?1:g,p=e.eventCallback,y=this.generateData(a),k=[];s=[];for(var b=0;b<=a;b++)for(var C=0;C<=l;C++){var w=Math.round(Math.random()*(v-1-h))+h,D=k.length+1;n=0===C?Pl.add(t,Math.round(3*Math.random())*m,c):Pl.add(r,m,c),r=Pl.add(n,w,c),k.push({id:D,name:this.tasks[(b+C)%(this.tasks.length-1)],startDate:n,duration:w,endDate:r,resourceId:b}),null==p||p(k[k.length-1]),s&&b>0&&s.push({id:s.length+1,from:D-1,to:D})}return{resources:y,events:k,dependencies:s}}},{key:"generateOneEventPerTickAndResource",value:function(e){for(var t=e.startDate,n=e.endDate,r=e.nbrResources,i=void 0===r?50:r,a=e.tickUnit,o=void 0===a?"days":a,l=this.generateData(i),s=[],u=Pl.getDurationInUnit(t,n,o),c=0;c<=i;c++)for(var d=0;d<u;d++)s.push({id:s.length+1,resourceId:c,name:this.tasks[(c+d)%(this.tasks.length-1)],startDate:Pl.add(t,d,o),duration:1,durationUnit:o});return{resources:l,events:s}}},{key:"generateRow",value:function(){return e.generateData(1,!1,-1,!1)[0]}}])}();S(Dp,"rnd",new Cp),S(Dp,"rndTime",new Cp),S(Dp,"rndRating",new Cp),S(Dp,"rndText",new Cp),Dp._$name="DataGenerator";var Sp=["action","target","to","deltaX","deltaY","x","y","text"],xp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]);var n=this;n.widget&&(n.outerElement=n.widget.element,n.widget.playingDemo=!0),fr.playingDemo=!0,Object.assign(n,{prevTarget:null,currentStep:0,mouse:li.createElement({parent:n.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),n.intervalId=n.setInterval(n.nextStep.bind(n),1e3),n.outerElement.classList.add("b-playing-demo"),n.outerElement.addEventListener("click",(function(e){e.isTrusted&&n.abort()}))}},{key:"doDestroy",value:function(){this.abort()}},{key:"abort",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),fr.playingDemo=!1,t.trigger(e?"done":"abort")}},{key:"triggerEvent",value:function(e,t,n){if(!e)return null;var i;if(t.startsWith("mouse")){var a=this.mouse.getBoundingClientRect();i=new MouseEvent(t,Object.assign({view:r,bubbles:!0,cancelable:!0,clientX:a.left,clientY:a.top},n||{}))}else(i=document.createEvent("Event")).initEvent(t,!0,!1);return e.dispatchEvent(i),i}},{key:"handleMouseMove",value:function(e,t){var n=this,r=n.mouse;r.classList.add("quick"),n.mouseDown&&r.classList.add("drag");var i=pt.from(r,n.outerElement),a=i.x,o=i.y,l=0,s=0;if(e.to)if("string"==typeof e.to){var u=n.outerElement.querySelector(e.to);if(u){var c=pt.from(u,n.outerElement),d=c.x+c.width/2,h=c.y+c.height/2;l=(d-a)/10,s=(h-o)/10}}else e.to.x?l=(e.to.x-a)/10:(l=e.to[0]/10,s=e.to[1]/10);else e.deltaX?l=e.deltaX/10:e.x&&(l=(e.x-a)/10);e.deltaY&&(s=e.deltaY/10);var f=0;n.innerIntervalId=n.setInterval((function(){if(!n.shouldPause){9==f++&&(clearInterval(n.innerIntervalId),e.then&&e.then());var t=a+l*f,i=o+s*f;r.style.left=t+"px",r.style.top=i+"px";var u=r.getBoundingClientRect(),c=u.left,d=u.top,h=li.elementFromPoint(c,d);h!==n.prevTarget&&(n.prevTarget&&(n.mouseOutElements.push(n.prevTarget),li.isDescendant(n.mouseOutElements[0],h)||(n.mouseOutElements.forEach((function(e){return n.triggerEvent(e,"mouseout")})),n.mouseOutElements.length=0)),n.prevTarget=h,n.triggerEvent(h,"mouseover")),n.triggerEvent(h,e.action,{clientX:c,clientY:d})}}),50)}},{key:"getTarget",value:function(e){var t=e.target;return t?"function"==typeof t?t(e):document.querySelector(t):this.prevTarget||this.outerElement}},{key:"normalizeStep",value:function(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(var t in e)Object.hasOwnProperty.call(e,t)&&!Sp.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}},{key:"isScrolling",get:function(){var e=this,t=e.outerElement.getBoundingClientRect(),n=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,n}},{key:"isInView",get:function(){var e=this.outerElement.getBoundingClientRect();return e.top<r.innerHeight&&e.bottom>0}},{key:"shouldPause",get:function(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}},{key:"nextStep",value:function(){var e=this;if(!e.shouldPause){if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");var t=e.mouse,n=e.normalizeStep(e.steps[e.currentStep++]),r=e.getTarget(n),i=n.action;if(r&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(n,r);else{if(r!==e.prevTarget){var a=pt.from(r,e.outerElement);t.style.left=a.x+a.width/2+"px",t.style.top=a.y+a.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((function(){if(e.prevTarget=r,t.classList.add(i),"type"===i){var a=Lo.fromElement(r),o=n.text.split("|");a.value=o[1===o.length||a.value!=o[0]?0:1]}else e.triggerEvent(r,i)}),"type"===i?100:550)}}}}],[{key:"defaultConfig",get:function(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}}])}(_n($i()));xp._$name="DemoBot";var Ep=Object.defineProperty,Rp=Symbol("fencible"),Tp=[],Mp=function(e){return Array.from(new o(e))},Fp=function(e){return e?Mp(Le.split(e)):Tp},Ap=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=this,n=Object.getPrototypeOf(e),r=e.$meta.getInherited("fenced"),i=e[Rp]={},a=function(e){return!i[e]};Be.forEach(r,(function(t,r){var o=t.any,l=t.all,s=t.lock;Ep(e,r,{configurable:!0,value:function(){var t;if(l.every(a)&&(!o||o.some(a)))try{var u,c=D(s);try{for(c.s();!(u=c.n()).done;)t=u.value,i[t]=(i[t]||0)+1}catch(e){c.e(e)}finally{c.f()}for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return n[r].apply(e,h)}finally{var v,g=D(s);try{for(g.s();!(v=g.n()).done;)t=v.value,--i[t]}catch(e){g.e(e)}finally{g.f()}}}})}));for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];return B(t,"construct",this,3)(l)}},{key:"widgetClass",get:function(){}}],[{key:"setupFenced",value:function(e,t){var n,r,i,a,o,l=e.fenced,s=t.getInherited("fenced");for(a in l)!0===(o=l[a])&&(o=a),Be.isObject(o)||(o={all:o}),n=Fp(o.all),r=Fp(o.any),i=o.lock?Fp(o.lock):Mp(n.concat(r)),r=r.length?r:null,s[a]={any:r,all:n,lock:i}}}])}(e||Mn),S(t,"$name","Fencible"),S(t,"declarable",["fenced"]),t},Ip=Math.floor,Lp=Math.max,Op=Math.min,Pp=function(e,t,n){return Op(Lp(e,t),n)},_p=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"direction",get:function(){var e,t,n,r=this.name,i=this.owner,a=i.events,o=i.scrollStarted,l=0;for(e=a.length;e-- >0&&(n=a[e][r],null==t||!(l=t-n));)t=n;return l||null==t||(l=t-o[r]),l}},{key:"drift",get:function(){return this._drift||0}},{key:"driftRange",get:function(){var e=this.range;return[e[0],Lp(e[0],e[1]-this.scrollSize)]}},{key:"items",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.items}},{key:"safeZone",get:function(){var e=this.drift,t=this.scrollSize,n=Ip(this.owner.safetyMargin*t);return[e+n,e+t-n]}},{key:"scroller",get:function(){var e;return null===(e=this.owner)||void 0===e||null===(e=e.client)||void 0===e?void 0:e.scrollable}},{key:"scrollLimit",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.scrollLimit}},{key:"vast",get:function(){var e=this.range;return!!e&&e[1]-e[0]>this.scrollSize}},{key:"changePos",value:function(e){var t=this.range;return Pp(e||0,t[0],t[1])}},{key:"updatePos",value:function(e){this.sync({pos:e})}},{key:"updateDrift",value:function(e){var t=this,n=t.pos,r=t.range,i=n-e;if(t.scrollPos===i){var a=new CustomEvent("scroll",{detail:"driftChange"});t.owner.scroller.element.dispatchEvent(a)}else r[0]<=n&&n<r[1]&&(t.scrollPos=i)}},{key:"changeRange",value:function(e,t){var n=_(Array.isArray(e)?e:[0,e],2),r=n[0],i=n[1],a=[r||0,null==i?1/0:i];if(!t||a[0]!==t[0]||a[1]!==t[1])return a}},{key:"updateRange",value:function(e){this.scrollSize=e[1]-e[0],this.sync({range:e})}},{key:"changeScrollSize",value:function(e){return Op(e,this.scrollLimit)}},{key:"snap",value:function(){var e,t,n,r,i,a,o=this,l=o.direction,s=o.items,u=o.owner,c=o.pos,d=o.range,h=D(s);try{for(h.s();!(a=h.n()).done;){e=a.value;var f=_(o.getItemSpan(e),2);if(t=f[0],n=f[1],t<=c&&c<n){t<c?((i=u.snapThreshold)<1&&(i*=n-t),i=Lp(1,i),r=l<0?n-c>i?t:n:c-t>i?n:t,r=Pp(r,d[0],d[1]),o.pos=r,u.watchForEnd()):u.scrolling=!1;break}}}catch(e){h.e(e)}finally{h.f()}}},{key:"sync",value:function(e){var t=Object.assign(this,e),n=t._drift,r=t.range,i=t.vast;if(r&&r[0]!==r[1]){var a,o=t.pos,l=o<r[0]||o>=r[1];if((null==o||l)&&(o=r[1]<0?r[0]:Pp(0,r[0],r[1])),i){var s=t.driftRange,u=t.safeZone,c=t.scrollSize;a=null==n||o<u[0]||o>u[1]?Pp(Ip(o-c/2),s[0],s[1]):n}else a=r[0];t.scroller.positionDirty=!0,t.overflow="hidden-scroll",t.drift=a,a!==n?l?(t.positionDirty=!1,t._pos=null,t.pos=o):t.positionDirty=!0:null!=(null==e?void 0:e.pos)?(t.scrollPos=o-a,t.positionDirty=!0):(t.positionDirty&&(t.positionDirty=!1,t._pos=null),t.pos=t.scrollPos+a),(null!=e&&e.range||a!==n)&&t.owner.syncItems()}else t.overflow="hidden"}},{key:"toLogical",value:function(e){return e+this.drift}},{key:"toPhysical",value:function(e){var t=e-this.drift;return t>=0&&t<this.scrollLimit?t:NaN}}])}(Mn.mixin(Ap));S(_p,"configurable",{owner:null,drift:null,overflow:null,pos:{value:null,default:0,$config:"lazy"},range:{value:null,$config:"lazy"},scrollSize:null}),S(_p,"fenced",{sync:!0});var Hp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"name",get:function(){return"x"}},{key:"other",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.y}},{key:"scrollPos",get:function(){return this.scroller.x},set:function(e){this.scroller.x=e}},{key:"scrollSize",get:function(){return this.scroller.scrollWidth},set:function(e){V(t,"scrollSize",e,this,1,1)}},{key:"getItemSpan",value:function(e){var t=e.$vxy,n=t.x;return[n,n+t.width]}},{key:"updateScrollSize",value:function(e){this.scroller.scrollWidth=e}},{key:"updateOverflow",value:function(e){this.scroller.overflowX=e}}])}(_p),Bp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"name",get:function(){return"y"}},{key:"other",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.x}},{key:"scrollPos",get:function(){return this.scroller.y},set:function(e){this.scroller.y=e}},{key:"scrollSize",get:function(){return this.scroller.scrollHeight},set:function(e){V(t,"scrollSize",e,this,1,1)}},{key:"getItemSpan",value:function(e){var t=e.$vxy,n=t.y;return[n,n+t.height]}},{key:"updateScrollSize",value:function(e){this.scroller.scrollHeight=e}},{key:"updateOverflow",value:function(e){this.scroller.overflowY=e}}])}(_p);_p.X=Hp,_p.Y=Bp,_p._$name="Axis";var Vp="b-infinity-scroller",Np=Object.freeze({width:0,height:0}),zp=function(e,t){var n="v"+t;n in e||Object.defineProperty(e,n,{configurable:!0,get:function(){var e;return null===(e=this.$vxy)||void 0===e?void 0:e[t]},set:function(e){this.$vxy&&(this.$vxy[t]=e)}})},jp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"height",get:function(){return this.getDim("height")}},{key:"width",get:function(){return this.getDim("width")}},{key:"x",get:function(){return this._x},set:function(e){this.moveTo(e)}},{key:"xy",get:function(){return[this._x,this._y]},set:function(e){this.moveTo.apply(this,z(e))}},{key:"y",get:function(){return this._y},set:function(e){this.moveTo(null,e)}},{key:"getDim",value:function(e){var t=this,n=t.widget,r="_"+e;return n?n.monitorResize?n[e]:t[r]||(t[r]=n[e]):0}},{key:"moveTo",value:function(e,t){null!=e&&(this._x=e),null!=t&&(this._y=t),this.sync()}},{key:"sync",value:function(){var e=this,t=e.owner,n=e.widget.element,r=t.x.toPhysical(e.x),i=t.y.toPhysical(e.y),a=isNaN(r+i);e.hidden=a,a?e.size=Np:n.style.transform="translate(".concat(r,"px, ").concat(i,"px)")}},{key:"updateHidden",value:function(e){var t;null===(t=this.widget)||void 0===t||null===(t=t.element)||void 0===t||t.classList.toggle("b-scroll-hidden",e)}},{key:"updateWidget",value:function(e,t){null==t||t.element.classList.remove("b-infinity-scroller-item"),e&&(e.element.classList.add("b-infinity-scroller-item"),zp(e,"x"),zp(e,"y"),zp(e,"xy"))}}])}(Mn);S(jp,"configurable",{hidden:null,owner:null,widget:null}),S(jp,"prototypeProperties",{_height:0,_width:0,_x:0,_y:0});var Wp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"element",get:function(){var e;return null===(e=this.scroller)||void 0===e?void 0:e.element}},{key:"events",get:function(){return this._events||(this._events=[])}},{key:"items",get:function(){var e;return((null===(e=this.client)||void 0===e?void 0:e.items)||[]).filter((function(e){return e.$vxy}))}},{key:"lastEvent",get:function(){var e;return null===(e=this._events)||void 0===e?void 0:e[this._events.length-1]}},{key:"pos",get:function(){return[this.x.pos,this.y.pos]}},{key:"changeScrollLimit",value:function(e){return e||li.scrollLimit}},{key:"updateAnimate",value:function(e,t){var n,r=null===(n=this.element)||void 0===n?void 0:n.classList;t&&(null==r||r.remove("b-infinity-scroller-".concat(t))),e&&(null==r||r.add("b-infinity-scroller-".concat(e)))}},{key:"updateClient",value:function(e){this.scroller=(null==e?void 0:e.scrollable)||null}},{key:"updateScroller",value:function(e,t){var n;this.detachListeners("scroller"),null==t||null===(n=t.element)||void 0===n||n.classList.remove(Vp),e&&(e.element.classList.add(Vp),e.ion({thisObj:this,name:"scroller",scroll:"onInternalScroll"}))}},{key:"changeX",value:function(e){return _p.X.new(e,{owner:this})}},{key:"changeY",value:function(e){return _p.Y.new(e,{owner:this})}},{key:"onInternalScroll",value:function(e){var t=this,n=t.lastPos,r=t.scrolling;r||(t.scrolling="maybe"),t.sync();var i=[t.x.pos,t.y.pos];n&&n[0]===i[0]&&n[1]===i[1]?t.scrolling=r:(t.lastPos=i,t.pushEvent(e),r||(t.scrolling=!0),t.triggerScroll("scroll",e))}},{key:"onInternalScrollEnd",value:function(){var e=this,t=e.scrolling;t&&("snap"===t?e.updateScrolling(t):e.scrolling=!!e.snap&&"snap")}},{key:"pushEvent",value:function(e){var t=this,n=t.events,r={event:e,x:t.x.pos,y:t.y.pos},i=n[n.length-1];if(e.type===(null==i?void 0:i.event.type)&&i.x===r.x&&i.y===r.y)i.event=e;else for(i||(t.scrollStarted=r),n.push(r);n.length>3;)n.shift()}},{key:"scrollTo",value:function(e){var t,n,r=this,i=r.scrollingTo,a=r.x.pos,o=r.y.pos,l=null!==(t=null==e?void 0:e.x)&&void 0!==t?t:a+(null==e?void 0:e.dx)||0,s=null!==(n=null==e?void 0:e.y)&&void 0!==n?n:o+(null==e?void 0:e.dy)||0,u=l-a,c=s-o,d=u||c,h=!1!==(null==e?void 0:e.animate)&&null!==(null==e?void 0:e.animate);if(i){if(i.scroll.x===l&&i.scroll.y===s&&i.scroll.animate===h)return i.promise;i.finish()}var f=r.scrollingTo=xs.new();return f.scroll={x:l,y:s,animate:h},d&&r.unanimated(!h,(function(){u&&(r.x.pos=l),c&&(r.y.pos=s)})),d&&h?(f.cancel=r.ion({once:!0,scrollEnd:function(){f.resolve(r.x.pos===l&&r.y.pos===s)}}),f.finish=function(){f.cancel&&(f.cancel(),f.cancel=null,f.resolve(!1),r.scrollStarted=null)}):f.resolve(!0),f.finally((function(){r.scrollingTo===f&&(r.scrollingTo=null)})),f.promise}},{key:"suppressAnim",value:function(e){var t=this,n=t._suppressAnim||0,r=t._suppressAnim=Math.max(0,n+(e?1:-1));t.scroller.behavior=r?"instant":null}},{key:"sync",value:function(){var e=this;this.unanimated((function(){e.x.sync(),e.y.sync()}))}},{key:"syncItems",value:function(){var e,t=D(this.items);try{for(t.s();!(e=t.n()).done;){e.value.$vxy.sync()}}catch(e){t.e(e)}finally{t.f()}}},{key:"triggerScroll",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.x.pos,r=arguments.length>3&&arguments[3]!==i?arguments[3]:this.y.pos;this.trigger(e,{widget:this.client,relatedEvent:t,x:n,y:r})}},{key:"updateScrolling",value:function(e,t){var n=this,r="maybe"===t,i=n.lastEvent;e?r?(n.watchForEnd(),n.scrollEnded=null,n.triggerScroll("scrollStart",i.event,i.x,i.y),n.element.classList.add("b-scrolling")):"snap"===e&&n[n.snap].snap():!t||"driftChange"!==(null==i?void 0:i.event.detail)&&r||(n.scrollEnded=i,n.events.length=0,n.triggerScroll("scrollEnd",i.event,i.x,i.y),n.element.classList.remove("b-scrolling"))}},{key:"unanimated",value:function(e,t){if("function"==typeof e&&(t=e,e=!0),e){this.suppressAnim(!0);try{t()}finally{this.suppressAnim(!1)}}else t()}},{key:"virtualize",value:function(e){"string"==typeof e&&(e=this.client.widgetMap[e]);var t,n=e.$vxy;n&&n.owner===this||(null===(t=n)||void 0===t||t.destroy(),e.$vxy=n=new jp({owner:this,widget:e}));return n}},{key:"watchForEnd",value:function(){var e,t,n=this,r=n.client,i=n.scrollIdle,a=n.scrollStarted,o=0;!function l(){if(!n.isDestroyed&&!r.isDestroyed&&a===n.scrollStarted){if(t=n.pos,e&&e[0]===t[0]&&e[1]===t[1]){if(++o>=i&&!Wn.hasActiveTouches)return void n.onInternalScrollEnd()}else e=t,o=0;r.requestAnimationFrame(l)}}()}}])}(Mn.mixin(_n));S(Wp,"configurable",{animate:"smooth",client:null,safetyMargin:.01,scroller:null,scrollIdle:8,scrolling:null,scrollLimit:{value:0,$config:"lazy"},snap:null,snapThreshold:.1,x:{},y:{}}),Wp._$name="InfinityScroller";var $p=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"infinityScrollerDefaults",get:function(){return{animate:this.animate}}},{key:"compose",value:function(){return{}}},{key:"changeInfinityScroller",value:function(e,t){return t?t.setConfig(e):t=Wp.new({client:this},this.infinityScrollerDefaults,e),t}},{key:"onChildAdd",value:function(e){var n;return e.innerItem&&(null===(n=this._infinityScroller)||void 0===n||n.virtualize(e)),B(t,"onChildAdd",this,3)([e])}},{key:"onInfiniteScroll",value:function(){this.syncSoon()}},{key:"onInfiniteScrollEnd",value:function(){this.syncSoon.now()}},{key:"onInfiniteScrollStart",value:function(){}},{key:"onInternalResize",value:function(e,n,r,i,a){B(t,"onInternalResize",this,3)([e,n,r,i,a]),this.hasPainted&&this.syncSoon()}},{key:"onInternalPaint",value:function(e){var n;null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n([e]),e.firstPaint&&(this.syncSoon.now(),this.infinityScroller.ion({thisObj:this,scroll:"onInfiniteScroll",scrollStart:"onInfiniteScrollStart",scrollEnd:"onInfiniteScrollEnd"}))}},{key:"scrollingTo",get:function(){return this.infinityScroller.scrollingTo}},{key:"scrollTo",value:function(e){return this.infinityScroller.scrollTo(e)}},{key:"sync",value:function(){this.infinityScroller.sync()}},{key:"syncSoon",value:function(){var e=this;e.isPainted&&(e.recompose.flush(),e.infinityScroller.animate=e.animate,e.sync())}},{key:"unanimated",value:function(e,t){return this.infinityScroller.unanimated(e,t)}},{key:"updateAnimation",value:function(){this._infinityScroller&&this.syncSoon()}},{key:"widgetClass",get:function(){}}])}(e),S(t,"configurable",{animate:"smooth",infinityScroller:{value:{},$config:"lazy"},monitorResize:!0,scrollable:{}}),S(t,"delayable",{syncSoon:"raf"}),t},Up=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"hasNativeAccess",!0),S(e,"_content",null),e}return R(t,e),w(t,[{key:"writeText",value:(a=f(L().mark((function e(t,n){var r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this)._content,!n||!r.hasNativeAccess){e.next=10;break}return e.prev=2,e.next=5,navigator.clipboard.writeText(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),r.hasNativeAccess=!1;case 10:i!==t&&(r._content=t,r.triggerContentChange(i,!1,!0));case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e,t){return a.apply(this,arguments)})},{key:"writeData",value:function(e,t){this._dataContent=e,this._contentSource=t}},{key:"readText",value:(r=f(L().mark((function e(t){var n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this)._content,!t||!n.hasNativeAccess){e.next=13;break}return e.prev=2,e.next=5,navigator.clipboard.readText();case 5:return i=e.sent,r!==i&&(n._content=i,n._dataContent=n._contentSource=null,n.triggerContentChange(r,!0)),e.abrupt("return",i);case 10:e.prev=10,e.t0=e.catch(2),n.hasNativeAccess=!1;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e){return r.apply(this,arguments)})},{key:"readData",value:function(e){if(!e||$e.asArray(e).includes(this._contentSource))return this._dataContent}},{key:"triggerPaste",value:function(e){this.trigger("paste",{source:e,text:this._content})}},{key:"triggerContentChange",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2];this.trigger("contentChange",{fromRead:t,fromWrite:n,oldText:e,newText:this._content})}},{key:"clear",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.writeText("",t);case 2:this.writeData(null);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]);var n,r,a}(Mn.mixin(_n)),Gp=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];B(t,"construct",this,3)(n),r.bryntum.clipboard||(r.bryntum.clipboard=new Up),r.bryntum.clipboard.ion({paste:"onClipboardPaste",contentChange:"onClipboardContentChange",thisObj:this})}},{key:"clipboard",get:function(){return r.bryntum.clipboard}},{key:"onClipboardPaste",value:function(e){var t,n=e.text,r=e.source,i=this,a=i.clipboardText,o=i.isCut,l=i.compareClipboardText(a,n);l&&o?(null===(t=i.handleCutData)||void 0===t||t.call(i,{text:n,source:r}),i.isCut=!1,i.cutData=null):l||i.clearClipboard(!1)}},{key:"onClipboardContentChange",value:function(e){var t=e.newText;this.compareClipboardText(this.clipboardText,t)||this.clearClipboard(!1)}},{key:"cutData",get:function(){return this._cutData},set:function(e){var t,n,r=this;null===(t=r._cutData)||void 0===t||t.forEach((function(e){return r.setIsCut(e,!1)})),r._cutData=$e.asArray(e),null===(n=r._cutData)||void 0===n||n.forEach((function(e){return r.setIsCut(e,!0)}))}},{key:"writeToClipboard",value:(o=f((function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i?arguments[2]:{};return L().mark((function i(){var a,o,l,s;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.beforeCopy(F({data:e,isCut:t},r));case 2:if(i.t0=i.sent,!1!==i.t0){i.next=5;break}return i.abrupt("return");case 5:return a=n,l=(o="string"==typeof e)?e:a.stringConverter?a.stringConverter(e):Le.safeJsonStringify(e),s=o?l:a.cloneData?a.cloneData({data:e,stringData:l,isPaste:!1}):Be.clone(e),a.clipboardText=l,a.clipboard.writeData(s,a.$$name),i.next=10,a.clipboard.writeText(l,a.useNativeClipboard);case 10:return a.clipboardData=s,a.originalData=e,a.isCut=t,a.cutData=t&&!o?e:null,i.abrupt("return",{data:t?e:s,clonedData:s,originalData:e,stringData:l});case 16:case"end":return i.stop()}}),i)}))()})),function(e,t){return o.apply(this,arguments)})},{key:"readFromClipboard",value:(a=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(i){var a,o,l,s,u,c,d;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=(a=e).clipboard,r.next=4,o.readText(a.useNativeClipboard);case 4:if(l=r.sent,s=a.compareClipboardText(a.clipboardText,l),u=s?a.originalData:[],c=o.readData(a.allowedDataSources),s||a.clearClipboard(!1),!(d=a.isCut)&&c&&c!==l||(c=a.transformClipboardText(l)),c&&!d&&"string"!=typeof c&&a.cloneData&&(c=a.cloneData({data:c,isPaste:!0})),r.t0=null==c||Array.isArray(c)&&0===c.length,r.t0){r.next=18;break}return r.next=16,null===(i=a.beforePaste)||void 0===i?void 0:i.call(a,F(F({data:c,text:l,originalData:u},t),{},{isCut:d,isOwn:s}));case 16:r.t1=r.sent,r.t0=!1===r.t1;case 18:if(!r.t0){r.next=20;break}return r.abrupt("return");case 20:return n||o.triggerPaste(a),r.abrupt("return",{data:c,text:l,isOwn:s,isCut:d,originalData:u});case 22:case"end":return r.stop()}}),r)}))()})),function(){return a.apply(this,arguments)})},{key:"clearClipboard",value:(n=f((function(){var e=this,t=!(arguments.length>0&&arguments[0]!==i)||arguments[0];return L().mark((function n(){var r;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=e).clipboardData=r.originalData=r.clipboardText=r.cutData=null,r.isCut=!1,!t){n.next=6;break}return n.next=6,r.clipboard.clear(r.useNativeClipboard);case 6:case"end":return n.stop()}}),n)}))()})),function(){return n.apply(this,arguments)})},{key:"compareClipboardText",value:function(e,t){var n=/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/g;return(null==e?void 0:e.replace(n,"\n"))===(null==t?void 0:t.replace(n,"\n"))}},{key:"transformClipboardText",value:function(e){var t=this;return t.compareClipboardText(t.clipboardText,e)?t.isCut?t.originalData:t.clipboardData:t.stringParser&&e?t.stringParser(e):e}},{key:"hasClipboardData",value:function(){var e=this.clipboard,t=e._content;if(!this.useNativeClipboard||!e.hasNativeAccess)return Boolean(t&&this.transformClipboardText(t))}}]);var n,a,o}(e||Mn),S(t,"$name","Clipboardable"),S(t,"configurable",{useNativeClipboard:!1,allowedDataSources:null}),t},Yp=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"construct",this,3)(n),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}},{key:"doFinalize",value:function(){this.destroy()}},{key:"finalize",value:function(){var e=this,t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}},{key:"_awaitFinalizer",value:(n=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.prev=1,e.next=4,t.finalizer;case 4:return e.prev=4,t.finalizing=null,t.isFinalized=!0,t.doFinalize(),e.finish(4);case 9:case"end":return e.stop()}}),e,this,[[1,,4,9]])}))),function(){return n.apply(this,arguments)})}]);var n}(e||Mn),S(t,"$name","Finalizable"),t},qp=Symbol("dragAbort"),Kp=Symbol("dragInit"),Xp=Symbol("dragDrag"),Zp=Symbol("dragDrop"),Jp={x:"horizontal",y:"vertical"},Qp=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];B(t,"construct",this,3)(n);var o=this,l=o.event;Object.assign(o,{altKey:null,cleaners:[],ctrlKey:null,data:new a,element:l.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:Kp,startEvent:l,touchStartTimer:null,_valid:!0}),"touches"in l&&o.touchStartDelay&&(o.touchStartTimer=o.setTimeout((function(){return o.touchStartTimer=null}),o.touchStartDelay,"touchStartDelay"));var s=r;fr.on({element:s,blur:"onWindowBlur",thisObj:o,autoDetach:!0})}},{key:"doDestroy",value:function(){var e=this,n=e.source,r=e.target;e.cleanup(),(null==r?void 0:r.dropping)===e&&(r.dropping=null),(null==n?void 0:n.dragging)===e&&(n.dragging=null),B(t,"doDestroy",this,3)([])}},{key:"onWindowBlur",value:function(){this.started&&!this.completed&&this.abort()}},{key:"aborted",get:function(){return this.state===qp}},{key:"completed",get:function(){return this.isDestroying||this.aborted||null!==this.endEvent}},{key:"pending",get:function(){return this.state===Kp}},{key:"started",get:function(){return this.state!==Kp&&!this.aborted}},{key:"valid",get:function(){return this.started&&null!=this.targetElement&&this._valid},set:function(e){this._valid=e}},{key:"get",value:function(){var e=f(L().mark((function e(t){var n,r=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.aborted){e.next=2;break}throw new Error("Data is not available on aborted drag");case 2:if(this.completed){e.next=4;break}throw new Error("Data is not available until drag completion");case 4:if(!Array.isArray(t)){e.next=6;break}return e.abrupt("return",Promise.all(t.map((function(e){return r.get(e)}))));case 6:if("function"!=typeof(n=this.data.get(t))){e.next=12;break}return e.next=10,n();case 10:n=e.sent,this.data.set(t,n);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"has",value:function(e){return this.data.has(e)}},{key:"peek",value:function(e){var t=this;if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((function(e){return t.peek(e)}));var n=this.data.get(e);return"function"==typeof n&&(n=!0),n}},{key:"set",value:function(e,t){this.data.set(e,t)}},{key:"changeTarget",value:function(e,t){if(e!==t){var n=this;n._target=e,n.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=n,e.dropping!==n&&(e=null,n.valid=!1)),n._target=t}return e}},{key:"updateTarget",value:function(e,t){var n=this;t&&n.source.dragLeaveTarget(n,t),e&&(n.valid=!0,e.dragMove(n),n.source.dragEnterTarget(n))}},{key:"updateTargetElement",value:function(e){var t,n,r,i,a;for(a=e;a;a=a.parentElement)if(n=wa.get(a,"droppables"))for(i=0;i<n.length;++i)if((t=n[i]).dropRootElement.contains(e)&&(!(r=t.droppableSelector)||e.closest("#".concat(li.getId(t.dropRootElement)," ").concat(r)))&&(this.target=t,this.target===t))return}},{key:"abort",value:function(){var e=this,t=e.element,n=e.source;null==t||t.getBoundingClientRect(),e.state!==Zp&&(e.state=qp,e.cleanup()),null==n||n.endDrag(e)}},{key:"begin",value:function(){var e=this,t=e.source,n=t.beforeDrag(e);return!1!==n&&(t.dragging=e),n}},{key:"cleanup",value:function(){for(var e;e=this.cleaners.pop();)e()}},{key:"end",value:function(e){var t=this,n=t.lastMoveEvent,i=t.target,a=t.source.dragSwallowClickTime;if(t.event=t.domEvent=t.endEvent=e,t.syncFlags(),t.started){if((null==n?void 0:n.clientX)===e.clientX&&(null==n?void 0:n.clientY)===e.clientY&&(null==n?void 0:n.target)===e.target||t.track(),a){var o=r;fr.on({element:o,capture:!0,expires:a,once:!0,click:function(e){e.stopPropagation()}})}t.state=Zp,i!==t.source&&(null==i||i.dragDrop(t))}}},{key:"fakeKey",value:function(e,t){var n,r=this,i=r.lastMoveEvent;i&&r.element&&(i.isKey=!0,"Alt"===e.key?r.altKey!==t&&(r.altKey=t,n=!0):"Control"===e.key&&r.ctrlKey!==t&&(r.ctrlKey=t,n=!0),n&&(r.event=r.domEvent=i,r.track()))}},{key:"keyDown",value:function(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}},{key:"keyUp",value:function(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}},{key:"getDistance",value:function(e){return fr.getDistanceBetween(this.startEvent,e)}},{key:"isDragToggleKey",value:function(e){return"Control"===e||"Alt"===e}},{key:"move",value:function(e){var t=this,n=e.target,r=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)r&&t.abort();else if(n&&n.nodeType===Node.ELEMENT_NODE&&n.isConnected){if(r&&!t.started&&(t.event=t.domEvent=e,!1===t.start()))return void t.abort();e.touches&&(t.startEvent.preventDefault(),e.preventDefault(),e.stopPropagation()),t.started&&!t.completed&&(t.lastMoveEvent=t.event=t.domEvent=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}},{key:"start",value:function(){var e=this,t=e.scrollManager,n=e.monitoringConfig,r=e.source,i=r.draggingBodyCls,a=r.dragLock,o=r.dragRootElement;if(e.state=Xp,t){var l=t.startMonitoring(pe.merge({scrollables:[{element:o}],direction:Jp[a]||a||"both",callback:function(t){var n=e.lastMoveEvent;n&&e.element&&(n.isScroll=!0,e.event=e.domEvent=n,e.scrollerAction=t,e.track(),e.scrollerAction=null)}},n));e.cleaners.push(l)}var s=r.dragRootElement.closest(".b-outer")||document.body;if(s.classList.add(i),e.cleaners.push((function(){return s.classList.remove(i)})),!1===r.startDrag(e))return e.cleanup(),!1}},{key:"syncFlags",value:function(){var e=this,t=e.event;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}},{key:"track",value:function(){var e,t=this,n=t.event,r=t.source,i=t.target,a=n.target;"touchmove"===n.type&&(e=n.changedTouches[0],a=li.elementFromPoint(e.clientX,e.clientY)),t.targetElement=a,i===t.target&&(null==i||i.dragMove(t)),r.trackDrag(t)}}],[{key:"configurable",get:function(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300,event:null}}},{key:"identifiable",get:function(){return{}}}])}(Mn.mixin(Yp,$i,eo));S(Qp,"$name","DragContext"),Qp.prototype.STATE=Qp.STATE=Object.freeze({ABORTED:qp,INIT:Kp,DRAGGING:Xp,DROPPED:Zp}),Qp._$name="DragContext";var ey=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateDragging",value:function(e,t){t&&this.close(t),e&&this.open(e)}},{key:"close",value:function(e){}},{key:"open",value:function(e){}},{key:"dragStart",value:function(e){this.dragging=e}},{key:"dragMove",value:function(e){}},{key:"dragEnd",value:function(e){this.dragging=null}}],[{key:"configurable",get:function(){return{dragging:null}}},{key:"factoryable",get:function(){return{defaultType:t}}}])}(Mn.mixin(Za));S(ey,"type","default"),ey.initClass(),ey._$name="DragProxy";var ty=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"beforeDrag",value:function(e){var t=this.dragRootElement,n=this.dragSelector,r=this.ignoreSelector,i=n&&e.element.closest(n);return!n||Boolean(i&&i===t||t.contains(i)&&(!r||!e.element.matches(r)))}},{key:"dragStart",value:function(e){}},{key:"dragOver",value:function(e){}},{key:"dragEnterTarget",value:function(e){}},{key:"dragLeaveTarget",value:function(e,t){}},{key:"dragDrop",value:(i=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"dragEnd",value:function(e){}},{key:"activeDrag",get:function(){var e=this.dragging;return null!=e&&e.started&&!e.completed?e:null}},{key:"dragEventer",get:function(){return this.trigger?this:null}},{key:"draggingClassElement",get:function(){var e=this.draggingClsSelector,t=this.dragRootElement;return e?null==t?void 0:t.closest(e):t}},{key:"beginDrag",value:function(e){var t=this.draggingCls,n=this.draggingClassElement;t&&n&&(n.classList.add(t),e.cleaners.push((function(){return n.classList.remove(t)})))}},{key:"endDrag",value:(r=f(L().mark((function e(t){var n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).dragEventer,i=n.dragProxy,!t.valid){e.next=4;break}return e.next=4,n.dragDrop(t);case 4:if(!n.isDestroyed){e.next=6;break}return e.abrupt("return");case 6:t.pending?t.destroy():(n.dragEnd(t),null==i||i.dragEnd(t),null==r||r.trigger(t.valid?"drop":"dragCancel",{drag:t,event:t.event}),n.finalizeDrag(t));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"finalizeDrag",value:(n=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=t.finalize)||void 0===n?void 0:n.call(t);case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"moveDrag",value:function(e){if(!1!==this.dragOver(e)){var t=this.dragEventer,n=this.dragProxy;null==n||n.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}},{key:"setupDragContext",value:function(e){var t=this,n=t.dragItemSelector,r=t.id,i=e.target;return{event:e,id:r?"".concat(r,"-drag-").concat(t._nextDragId=(t._nextDragId||0)+1):null,itemElement:n?i.closest(n):i,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}},{key:"startDrag",value:function(e){var t=this.draggingStartedCls,n=this.draggingClassElement,r=this.draggingItemCls,i=this.dragEventer,a=this.dragProxy,o=e.itemElement;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&n&&(n.classList.add(t),e.cleaners.push((function(){return n.classList.remove(t)}))),r&&o&&(o.classList.add(r),e.cleaners.push((function(){return o.classList.remove(r)}))),null==a||a.dragStart(e);var l=this.dragStart(e);return!1!==l&&(null==i||i.trigger("dragStart",{drag:e,event:e.event})),l}},{key:"trackDrag",value:function(e){var t,n=this.dropTargetSelector;e.valid=!(n&&(null===(t=e.targetElement)||void 0===t||!t.closest(n))),this.moveDrag(e)}},{key:"configureListeners",value:function(e){var t=this,n=Be.assign({thisObj:t},t.dragDocumentListeners);return"touches"in e.startEvent?(delete n.mousemove,delete n.mouseup):(delete n.contextmenu,delete n.touchmove,delete n.touchend,delete n.pointerup),n.element=li.getRootElement(t.dragRootElement),n}},{key:"updateDragging",value:function(e,t){if(e){var n=this.configureListeners(e);e.cleaners.push(fr.on(n)),this.beginDrag(e)}else t&&t.destroy()}},{key:"changeDragProxy",value:function(e,t){return ey.reconfigure(t,e,{owner:this,defaults:{owner:this}})}},{key:"updateDragRootElement",value:function(e,t){var n,r=this,i=r.draggableCls,a=r.dragItemSelector,o=r.onDragItemMouseMove;if(null==t||t.classList.remove(i),null===(n=r._dragRootDetacher)||void 0===n||n.call(r),e){var l={thisObj:r,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:function(e){var t,n;return e.pointerId&&(null===(t=(n=e.target).releasePointerCapture)||void 0===t?void 0:t.call(n,e.pointerId))}};o&&(l.mousemove={delegate:a,handler:"onDragItemMouseMove"}),(r.dragItemOverCls||o||r.onDragItemMouseEnter||r.onDragItemMouseLeave)&&Object.assign(l,{mouseover:{delegate:a,handler:"onDragItemMouseOver"},mouseout:{delegate:a,handler:"onDragItemMouseOut"}}),e.classList.add(i),r._dragRootDetacher=fr.on(l)}}},{key:"onDragItemMouseOver",value:function(e){this.overItem=e}},{key:"onDragItemMouseOut",value:function(e){this.dragging||(this.overItem=e)}},{key:"changeOverItem",value:function(e){var t;return this.enterLeaveEvent=e,"mouseout"===e.type?(null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(this.dragItemSelector))||null:e.target.closest(this.dragItemSelector)}},{key:"updateOverItem",value:function(e,t){var n,r,i=this,a=i.dragItemOverCls;t&&(a&&t.classList.remove(a),null===(n=i.onDragItemMouseLeave)||void 0===n||n.call(i,i.enterLeaveEvent,t));e&&(a&&e.classList.add(a),null===(r=i.onDragItemMouseEnter)||void 0===r||r.call(i,i.enterLeaveEvent,e))}},{key:"onDragContextMenu",value:function(e){e.preventDefault()}},{key:"onDragKeyDown",value:function(e){this.dragging.keyDown(e)}},{key:"onDragKeyUp",value:function(e){this.dragging.keyUp(e)}},{key:"onDragMouseDown",value:function(e){0===e.button&&this.onDragPointerDown(e)}},{key:"onDragPointerDown",value:function(e){var t=this.dragging;t?t.isFinalizing||t.abort():(t=this.setupDragContext(e))&&!1===(t=new Qp(t)).begin()&&t.destroy()}},{key:"changeDragging",value:function(e,t){return null==t||t.destroy(),e}},{key:"onDragPointerMove",value:function(e){var t=e.changedTouches,n=this.dragging;!n||n.completed||t&&1!==t.length||null==n||n.move(e)}},{key:"onDragPointerUp",value:function(e){var t=this.dragging;t&&!t.completed&&(t.end(e),this.endDrag(t))}},{key:"onDragTouchStart",value:function(e){1===e.touches.length&&this.onDragPointerDown(e)}}]);var n,r,i}(e||Mn),S(t,"$name","Draggable"),S(t,"configurable",{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}),S(t,"properties",{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}),t},ny=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dropEventer",get:function(){return this.trigger?this:null}},{key:"droppableCls",get:function(){return"b-droppable"}},{key:"dragEnter",value:function(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragEnter",{drag:e,event:e.event})}},{key:"dragMove",value:function(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragMove",{drag:e,event:e.event})}},{key:"dragDrop",value:function(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("drop",{drag:e,event:e.event})}},{key:"dragLeave",value:function(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragLeave",{drag:e,event:e.event})}},{key:"changeDropping",value:function(e,t){if(e!==t){var n=this;t&&(!t.aborted&&t.completed||n.dragLeave(t)),e&&(n._dropping=e,!1===n.dragEnter(e)&&(e=null),n._dropping=t)}return e}},{key:"updateDropRootElement",value:function(e,t){var n,r,i,a=this,o=a.droppableCls;t&&(n=wa.get(t,"droppables"),i=!0,Array.isArray(n)&&(r=n.indexOf(a))>-1&&(n.length<2?wa.remove(t,"droppables"):(n.splice(r,1),n.forEach((function(e){o===e.droppableCls&&(i=!1)})))),i&&t.classList.remove(o)),e&&((n=wa.get(e,"droppables"))?n.push(a):wa.set(e,"droppables",[a]),e.classList.add(o))}}],[{key:"configurable",get:function(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}}])}(e||Mn),S(t,"$name","Droppable"),t},ry=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e=this.features;for(var n in B(t,"doDestroy",this,3)([]),e){var r,i=e[n];null===(r=i.destroy)||void 0===r||r.call(i)}}},{key:"hasFeature",value:function(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}},{key:"changeFeatures",value:function(e,t){if(!this.isDestroying){var n=this,r=n.constructor.featureable,i=n.$features||(n.$features=new du({configName:"features",factory:r.factory,owner:n,ownerName:r.ownerName}));return i.update(e),t?void 0:i.target}}},{key:"widgetClass",get:function(){}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]),r=n.features;if(r)for(var i in r)0===Object.keys(r[i]).length&&(r[i]=!0);return n}}],[{key:"configurable",get:function(){return{features:null}}},{key:"declarable",get:function(){return["featureable"]}},{key:"setupFeatureable",value:function(e){var t=F({ownerName:"client"},e.featureable);t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:function(){return t}})}}])}(e||Mn),S(t,"$name","Featureable"),t},iy="b-hover-edge",ay="b-hover-top",oy="b-hover-right",ly="b-hover-bottom",sy="b-hover-left",uy=S(S(S(S(S({},iy,1),ay,1),oy,1),ly,1),sy,1),cy={t:[iy,ay],r:[iy,oy],b:[iy,ly],l:[iy,sy],tr:[iy,ay,oy],bl:[iy,ly,sy],tl:[iy,ay,sy],br:[iy,ly,oy]},dy=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"hoverEnter",value:function(e){}},{key:"hoverIgnore",value:function(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}},{key:"hoverLeave",value:function(e){}},{key:"hoverMove",value:function(e){}},{key:"onHoverMouseMove",value:function(e){var t=this,n=t.hoverEdges,r=t.hoverEdgeSize,i=t.hoverTarget;if(i){if(n){var a=i.getBoundingClientRect(),o=a.top,l=a.left,s=a.width,u=a.height,c=a.right,d=a.bottom,h=e.clientX,f=e.clientY,v=l+s/2,g=o+u/2,m=f<(r?o+r:g),p=h>=(r?c-r:v),y=m||f>=(r?d-r:g)?m?"t":"b":"",k=p||h<(r?l+r:v)?p?"r":"l":"";t.hoverZone=(n.includes(y)?y:"")+(n.includes(k)?k:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}},{key:"onHoverMouseOver",value:function(e){this.hoverEvent=e,this.hoverElement=e.target}},{key:"onHoverMouseOut",value:function(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}},{key:"updateHoverDelay",value:function(e){this.setHoverTarget.delay=e}},{key:"changeHoverEdges",value:function(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}},{key:"updateHoverEdges",value:function(){this.syncHoverListeners()}},{key:"changeHoverElement",value:function(e){if(!this.hoverIgnore(e))return e}},{key:"updateHoverElement",value:function(e){var t,n=this.hoverSelector;n&&(e=null===(t=e)||void 0===t?void 0:t.closest(n));this.setHoverTarget(e)}},{key:"updateHoverRootElement",value:function(e,t){var n=this.hoverRootCls;n&&(null==t||t.classList.remove(n),null==e||e.classList.add(n)),this.syncHoverListeners()}},{key:"changeHoverTarget",value:function(e,t){return t&&(this.hoverZone=null),e}},{key:"updateHoverTarget",value:function(e,t){var n=this,r=n.hoverCls,i=n.hoverAnimationCls,a=n.hoverRootActiveCls,o=n.hoverRootElement;a&&(null==o||o.classList[e?"add":"remove"](a)),t&&(r&&t.classList.remove(r),i&&t.classList.remove(i),n.hoverLeave(t)),e&&(r&&e.classList.add(r),n.hoverEnter(t),n.hoverTrack&&n.hoverMove(n.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}},{key:"updateHoverTrack",value:function(){this.syncHoverListeners()}},{key:"updateHoverZone",value:function(e){var t=this.hoverAnimationCls,n=this.hoverTarget;if(n){var r=n.className,i=Ct.change(r,e?cy[e]:null,uy);r!==i&&(n.className=i,e&&t&&(n.classList.remove(t),n.getBoundingClientRect(),n.classList.add(t)))}}},{key:"setHoverTarget",value:function(e){this.hoverTarget=e}},{key:"syncHoverListeners",value:function(){var e,t=this,n=t.hoverRootElement,r={element:n,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(r.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=n&&fr.on(r)}}],[{key:"configurable",get:function(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}},{key:"delayable",get:function(){return{setHoverTarget:0}}}])}(e.mixin($i)),S(t,"$name","Hoverable"),t},hy=6e4,fy=36e5,vy=864e5,gy=/(\d+)?:?(\d*)/,my=function(){function e(t){m(this,e);var n,r,i=0;null!=t&&t.isDayView?(i=t.dayStartShift,n=t.dayStartTime,r=t.dayEndTime):"number"==typeof t?i=n=r=t:t&&(i=t.startShift,n=t.timeStart,r=t.timeEnd),this.startShift=i=e.parse(i||0),this.timeEnd=(null==r?(i+vy)%vy:e.parse(r))||vy,this.timeStart=null==n?i:e.parse(n)}return w(e,[{key:"startHour",get:function(){return Math.floor(this.timeStart/fy)}},{key:"endHour",get:function(){return Math.floor(this.timeEnd/fy)}},{key:"startTimeOffsetMs",get:function(){var e=this.startShift,t=this.timeStart;return t<e?vy-e+t:t-e}},{key:"today",get:function(){return this.startOfDay(new Date)}},{key:"ceil",value:function(e){var t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}},{key:"contains",value:function(e){return!this.outside(e)}},{key:"dateKey",value:function(e){return e=this.shiftDate(e,-1),Pl.makeKey(e)}},{key:"dayOfDate",value:function(e){return this.shiftDate(Pl.clearTime(e))}},{key:"dayOfWeek",value:function(e){return(e=this.shiftDate(e,-1)).getDay()}},{key:"delta",value:function(t){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:"ms",r=this.timeStart,a=e.parse(t),o=(this.startShift&&a<r?a+vy:a)-r;return"ms"===n?o:Pl.as(n,o,"ms")}},{key:"duration",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"ms",t=this.timeStart,n=this.timeEnd,r=t<n?n-t:vy-t+n;return"ms"===e?r:Pl.as(e,r,"ms")}},{key:"equals",value:function(e){return this.startShift===(null==e?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}},{key:"intersects",value:function(e,t){var n=this,r=n.timeStart,i=n.timeEnd,a=_(n._dateRangeArgs(e,t),2),o=a[0],l=a[1],s=_(n.timeRange(o,l),2),u=s[0],c=s[1];return r<i?u<c?u<i&&r<c:u<i||r<c:!(u<c)||u<i||r<c}},{key:"isIntraDay",value:function(e,t){var n=_(this._dateRangeArgs(e,t),2),r=n[0],i=n[1],a=this.startOfDay(r),o=vy-Pl.diff(a,i,"ms");return!(o<0)&&(o>0||a<r)}},{key:"isInterDay",value:function(e){return e.allDay||!this.isIntraDay.apply(this,arguments)}},{key:"outside",value:function(t){var n=this.startShift,r=this.timeStart,i=this.timeEnd,a=e.parse(t);return r<i?a<r?a<n?1:-1:a<i?0:a<n?-1:1:a<i||a>=r?0:a<n?1:-1}},{key:"parseKey",value:function(e){return this.dayOfDate(Pl.parseKey(e))}},{key:"shiftDate",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1,n=this.startShift,r=W(e);return e="number"===r?new Date(e):"string"===r?Pl.parse(e):new Date(e.getTime()),t&&n&&e.setMilliseconds(t>0?n:-n),e}},{key:"sortEvents",value:function(e,t){var n=this.startOfDay(e);return null==t?void 0:t.sort((function(e,t){e=e.eventRecord||e,t=t.eventRecord||t;var r=e.startDate,i=t.startDate;return r?i?(r=r<n?n:r)-(i=i<n?n:i)||t.endDate-i-(e.endDate-r):1:-1}))}},{key:"startOfDay",value:function(e){return e=this.shiftDate(e,-1),e=Pl.clearTime(e),e=this.shiftDate(e)}},{key:"timeRange",value:function(e,t){var n=_(this._dateRangeArgs(e,t),2),r=n[0],i=n[1];return[Pl.getTimeOfDay(r),Pl.getTimeOfDay(i)]}},{key:"toString",value:function(){var t=this.startShift,n=this.timeEnd,r=this.timeStart,i=t?"@".concat(e.format(t)):"",a=e.format(r);return r===n?t?i:a:"".concat(a,"-").concat(e.format(n)).concat(i)}},{key:"_dateRangeArgs",value:function(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}}],[{key:"format",value:function(e){var t=Math.floor(e/fy),n=Math.floor(e/hy)%60;return"".concat(t,":").concat(n<10?"0":"").concat(n)}},{key:"parse",value:function(e){var t=W(e);if("string"===t){var n=gy.exec(e);e=Number(n[1]||0)*fy+Number(n[2]||0)*hy}else"number"!==t?e=Pl.getTimeOfDay(e):e<=24&&(e*=fy);return Math.min(Math.max(Math.floor(e),0),vy)}}])}();my.MIDNIGHT=new my({startShift:0,timeStart:0,timeEnd:24}),my.MILLIS_PER_MINUTE=hy,my.MILLIS_PER_HOUR=fy,my.MILLIS_PER_DAY=vy,my._$name="DayTime";var py=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterShow",value:function(){B(t,"afterShow",this,3)(arguments),this.addDocumentMouseDownListener()}},{key:"realign",value:function(){B(t,"realign",this,3)(arguments),this.syncTargetHighlighting()}},{key:"isTopModal",get:function(){return!1}},{key:"owns",value:function(){return!!this.masked||B(t,"owns",this,3)(arguments)}},{key:"onDocumentMouseDown",value:function(e){var n=e.event;n.isTrusted&&(this.owns(n.target)?B(t,"onDocumentMouseDown",this,3)(arguments):this.hintFlow.stop())}},{key:"changeTarget",value:function(e){var t=this;return e&&("string"==typeof e&&(this._target=this._forElement=null),e=this.hintFlow.normalizeTarget(e),Be.isPromise(e))?(e.then((function(e){return!t.isDestroyed&&(t.target=e)})),void this.setTimeout("hide",this.maxWait)):e}},{key:"updateButtons",value:function(e){this.bbar={items:e}}},{key:"updateHighlightTarget",value:function(e,t){var n=null==e?void 0:e.inflate;n?(this.initialInflate=this.align.inflate,this.align.inflate=n):this.align.inflate=this.initialInflate}},{key:"updateTarget",value:function(e){e instanceof Element&&(this.forElement=e)}},{key:"changeHighlighter",value:function(e,t){if(e)return Lo.reconfigure(t,Lo.mergeConfigs({owner:this},e),this);null==t||t.destroy()}},{key:"updateForElement",value:(n=f(L().mark((function e(t){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).autoNext,i=n.owner,a=n.index,n.syncTargetHighlighting(),n.clearTimeout("hide"),n.hidden=!1,n.showBy({target:n.forElement}),!n.element.matches(":focus-within")&&n.focus(),!r){e.next=24;break}e.t0=W(r),e.next="number"===e.t0?10:"string"===e.t0?12:"function"===e.t0?21:24;break;case 10:return n.setTimeout((function(){return i.navigate(1)}),r),e.abrupt("break",24);case 12:return e.next=14,Ge.sleep(500);case 14:if(n.index!==a){e.next=20;break}return e.next=17,n.autoNextPromise=i.normalizeTarget(r,!1);case 17:o=e.sent,n.autoNextPromise=null,o&&i.navigate(1,!1);case 20:return e.abrupt("break",24);case 21:return e.next=23,Ge.waitFor(r,1e4);case 23:i.navigate(1,!1);case 24:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"syncTargetHighlighting",value:function(){if(this.isVisible){var e=this,t=e.highlightTarget,n=e.highlighter,r=e.forElement,i=e.element.classList,a={"--b-hint-highlight-color":""},o=null==n?void 0:n.element,l=null==o?void 0:o.classList,s=null==t?void 0:t.inflate;if(null==l||l.remove("b-hint-highlighter-ping","b-hint-highlighter-center"),i[e.scrollRealigning?"add":"remove"]("b-scroll-realigning"),r){var u=e.floatRoot.style,c=r.ownerDocument.defaultView.getComputedStyle(r),d=li.isInView(r,!1,this),h=null!=t&&t.center?d.center.inflate(10):d;if(s&&h.inflate.apply(h,Array.isArray(s)?s:[s]),t&&(null==t||!t.center))for(var f=0,v=["top","bottom"];f<v.length;f++)for(var g=v[f],m=0,p=["left","right"];m<p.length;m++){var y=p[m],k=c.getPropertyValue("border-".concat(g,"-").concat(y,"-radius"));a["border-".concat(g,"-").concat(y,"-radius")]=parseInt(k)?k:""}"string"==typeof(null==t?void 0:t.center)&&(a["--b-hint-highlight-color"]=t.center),u.setProperty("--b-highlight-top","".concat(h.top,"px")),u.setProperty("--b-highlight-left","".concat(h.x,"px")),u.setProperty("--b-highlight-width","".concat(h.width,"px")),u.setProperty("--b-highlight-height","".concat(h.height,"px"))}t&&(l[e.scrollRealigning?"add":"remove"]("b-realigning"),li.applyStyle(o,a),n.show(),t.ping&&fr.onTransitionEnd({element:o,property:"inset-inline-start",once:!0,thisObj:e,timeout:500,handler:function(){l.add("b-hint-highlighter-ping")}}),t.center&&l.add("b-hint-highlighter-center")),e.requestAnimationFrame((function(){i.remove("b-scroll-realigning"),l.remove("b-realigning")}))}}},{key:"next",value:function(){this.index<this.owner.hints.length-1&&this.owner.navigate(1)}},{key:"previous",value:function(){this.index&&this.owner.navigate(-1)}},{key:"stop",value:function(){this.owner.stop()}}]);var n}(fc);S(py,"$name","Hint"),S(py,"type","hint"),S(py,"configurable",{ui:"plain",defaultFocus:function(e){return!e.hidden&&("next"===e.ref||"stop"===e.ref)},align:{align:"t-b",allowTargetOut:!0},anchor:!0,autoShow:!1,autoClose:!1,centered:!1,allowOver:!0,closable:!0,minWidth:"max-content",closeAction:"stop",previousAction:null,nextAction:null,keyMap:{P:"previous",N:"next",S:"stop"},buttons:null,maxWait:1e4,highlightTarget:null,highlighter:{$config:["lazy","nullify"],value:{floating:!0,cls:"b-hint-highlighter"}},autoNext:null,target:null}),py.initClass(),py._$name="Hint";var yy=function(e,t){return{previous:{weight:100,text:"L{Object.previous}",cls:"b-raised b-previous",hidden:!e,onClick:"up.onHintButtonClick"},next:{weight:100,text:"L{Object.next}",cls:"b-raised b-blue b-next",hidden:e===t-1,onClick:"up.onHintButtonClick"},stop:{weight:300,text:"L{Object.close}",cls:"b-raised b-red b-stop",hidden:e!==t-1,onClick:"up.onHintButtonClick"}}},ky=/\[(?:([\w+]+)\+)?(\w+)\]|./g,by=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"waitInterval",100),S(e,"maxWait",1e4),S(e,"keyStrokeIntervalRandomness",100),e}return R(t,e),w(t,[{key:"onHintButtonClick",value:function(e){var t=this;switch(e.source.ref){case"next":t.navigate(1);break;case"previous":t.navigate(-1);break;case"stop":t.stop();break;case"completed":t.trigger("completed"),t.stop()}}},{key:"fakeType",value:(l=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target,r=t.text,i=t.initialDelay,a=void 0===i?0:i,o=t.focus,"string"==typeof t&&(n=document.activeElement,r=t),!1!==o&&this.activeHint.revertFocus(),!n){e.next=10;break}return e.next=6,this.normalizeTarget(n);case 6:n=e.sent,!1!==o&&n.focus(),e.next=11;break;case 10:n=li.getActiveElement(this.activeHint.element);case 11:return t.clear&&(n.value=""),e.next=14,Ge.sleep(a);case 14:l=ky.exec(r);case 15:if(!l){e.next=22;break}return l[2]?(u=((null===(s=l[1])||void 0===s?void 0:s.split("+"))||[]).reduce((function(e,t){return e["".concat(t.toLowerCase(),"Key")]=!0,e}),{}),c=F({key:l[2],bubbles:!0},u),n.dispatchEvent(new KeyboardEvent("keydown",c)),n.dispatchEvent(new KeyboardEvent("keyup",c))):(n.value+=l[0],n.dispatchEvent(new Event("input",{data:l[0]}))),e.next=19,Ge.sleep(Math.random()*this.keyStrokeIntervalRandomness+30);case 19:l=ky.exec(r),e.next=15;break;case 22:n.dispatchEvent(new Event("change"));case 23:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"normalizeTarget",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.maxWait;return li.waitForSelector(e,t,this.waitInterval)}},{key:"navigate",value:function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1];this.navigationOngoing||(this.navigationOngoing=new Promise(function(){var r=f(L().mark((function r(i){var a,o,l,s,u,c,d;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=(a=t).activeHint,l=a.activeIndex+e,s=Wn.ion({mouseup:function(e){var t=e.event;return a.squashDocumentEvents(t)}}),u=fr.on({element:document,mousedown:"squashDocumentEvents",keydown:"squashDocumentEvents",thisObj:a,capture:!0}),r.prev=1,o.masked=!0,a.allowInteraction=!1,!n){r.next=11;break}return c=a.processActions(a.activeHint[1===e?"nextAction":"previousAction"]),r.next=8,Ge.animationFrame();case 8:return 1!==a.normalizeTarget(o.target,-1).nodeType&&(1===(null==(d=a.normalizeTarget(a.hints[l].target,-1))?void 0:d.nodeType)?o.target=d:li.applyStyle(o.floatRoot,{"--b-highlight-width":"0px","--b-highlight-height":"0px"})),r.next=11,c;case 11:return a.activeIndex=l,r.next=14,a.activeIndexUpdated;case 14:a.navigationOngoing=null,o.masked=!1;case 16:return r.prev=16,null==s||s(),null==u||u(),a.navigationOngoing&&(a.navigationOngoing=null,o.element.classList.remove("b-no-title"),o.hide(!1),py.reconfigure(o,{hidden:!1,masked:!1,centered:!0,title:"Navigation timed out",content:"Navigation could not be completed.",nextAction:null,bbar:{items:yy(0,1)}})),i(),r.finish(16);case 22:case"end":return r.stop()}}),r,null,[[1,,16,22]])})));return function(e){return r.apply(this,arguments)}}()))}},{key:"squashDocumentEvents",value:function(e){e.isTrusted&&(!this.activeHint.element.contains(e.target)&&this.allowInteraction||(e.preventDefault(),e.stopImmediatePropagation()))}},{key:"processActions",value:(o=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,!t){e.next=59;break}if(!Array.isArray(t)){e.next=22;break}r=D(t),e.prev=4,r.s();case 6:if((i=r.n()).done){e.next=12;break}return a=i.value,e.next=10,n.processActions(a);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:e.next=59;break;case 22:o=0,l=Object.entries(t);case 23:if(!(o<l.length)){e.next=59;break}s=_(l[o],2),u=s[0],c=s[1],e.t1=u,e.next="type"===e.t1?28:"dblclick"===e.t1||"click"===e.t1||"contextmenu"===e.t1?31:"fn"===e.t1?40:"drag"===e.t1?43:"waitFor"===e.t1?46:"allowInteraction"===e.t1?54:56;break;case 28:return e.next=30,n.fakeType(c);case 30:return e.abrupt("break",56);case 31:return d="string"==typeof c,e.next=34,n.normalizeTarget(d?c:c.target);case 34:return h=e.sent,(f=!d&&c.focus)&&(v=li.getActiveElement(h),li.triggerMouseEvent(h,"mousedown").defaultPrevented||li.getActiveElement(h)!==v||null===(g=li.closest(h,li.isFocusable))||void 0===g||g.focus()),li.triggerMouseEvent(h,u),f&&li.triggerMouseEvent(h,"mouseup"),e.abrupt("break",56);case 40:return e.next=42,n.activeHint.callback(c,n.activeHint);case 42:return e.abrupt("break",56);case 43:return e.next=45,n.drag(c);case 45:return e.abrupt("break",56);case 46:if(!isNaN(c)){e.next=51;break}return e.next=49,n.normalizeTarget(c);case 49:e.next=53;break;case 51:return e.next=53,Ge.sleep(c);case 53:return e.abrupt("break",56);case 54:return n.allowInteraction=c,e.abrupt("break",56);case 56:o++,e.next=23;break;case 59:case"end":return e.stop()}}),e,this,[[4,14,17,20]])}))),function(e){return o.apply(this,arguments)})},{key:"drag",value:(a=f((function(e){var t=this,n=e.target,r=void 0===n?this.activeHint.target:n,i=_(e.by,2),a=i[0],o=i[1],l=e.duration,s=void 0===l?500:l;return L().mark((function e(){var n,i,l,u,c,d,h,v,g,m,p,y;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.normalizeTarget(r);case 2:return n=e.sent,i=n.ownerDocument,l=t.activeHint,u=l.modalMask,c=pt.from(n).center.roundPx(1),d=c.x,h=c.y,v=li.createElement({parent:i.body,className:"b-mouse-pointer b-icon b-fa-mouse-pointer",style:{left:"".concat(d,"px"),top:"".concat(h,"px")}}),g={clientX:d,clientY:h,bubbles:!0},m=l.floatRoot.style,u&&(u.style.pointerEvents="none",m.setProperty("--b-highlight-width","0px"),m.setProperty("--b-highlight-height","0px")),n.dispatchEvent(new PointerEvent("pointerover",g)),n.dispatchEvent(new MouseEvent("mouseover",g)),n.dispatchEvent(new PointerEvent("pointerdown",g)),n.dispatchEvent(new MouseEvent("mousedown",g)),e.next=19,Ge.animationFrame();case 19:return e.next=21,Tt.animate(s,function(){var e=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.clientX=d+a*t,g.clientY=h+o*t,u.style.pointerEvents="none",p=i.elementFromPoint(g.clientX,g.clientY),v.style.cssText="left:".concat(g.clientX,"px;top:").concat(g.clientY,"px"),p.dispatchEvent(new PointerEvent("pointermove",g)),p.dispatchEvent(new MouseEvent("mousemove",g)),p!==y&&(p.dispatchEvent(new PointerEvent("pointerenter",g)),p.dispatchEvent(new MouseEvent("mouseenter",g)),p.dispatchEvent(new PointerEvent("pointerover",g)),p.dispatchEvent(new MouseEvent("mouseover",g)),y=p),u.style.pointerEvents="";case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 21:m.setProperty("--b-highlight-top","".concat(g.clientY,"px")),m.setProperty("--b-highlight-left","".concat(g.clientX,"px")),p.dispatchEvent(new PointerEvent("pointerup",g)),p.dispatchEvent(new MouseEvent("mouseup",g)),v.remove();case 26:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"updateActiveIndex",value:(r=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(i=this).hints,o=i.activeHint,l=a.length,s=a[t],null==o||null===(r=o.autoNextPromise)||void 0===r||r.resolve(),!s){e.next=18;break}return e.next=5,i.normalizeTarget(s.target);case 5:if(!1!==(u=e.sent)){e.next=9;break}return i.activeIndex=++t,e.abrupt("return");case 9:return o?("string"==typeof s.target&&(o._target=o._forElement=null),o.bbar.element.matches(":focus-within")&&o.element.focus()):i.returnFocusTo=li.getActiveElement(),c=F({steps:{type:"widget",content:"".concat(t+1,"/").concat(l),weight:-1e3},completed:{text:i.L("L{Hint.dontShowAgain}"),cls:"b-transparent",weight:10,onClick:"up.onHintButtonClick"}},Be.merge(yy(t,l),Array.isArray(s.buttons)?Be.transformArrayToNamedObject(s.buttons):s.buttons)),d=i.activeHint=py.reconfigure(o,py.mergeConfigs(i.defaults,{index:t,hintFlow:i,owner:i,maxWait:i.maxWait,rootElement:document.body},s,{target:u,buttons:c})),i.owner=py.fromElement(u),d.element.classList.toggle("b-no-title",Boolean(!s.title)),e.next=15,Promise.all([d.highlighter.element.isConnected&&li.waitForSelector(d.highlighter.element,-1e3),li.waitForSelector(d.element,-1e3)]);case 15:d.isVisible&&(null===(h=d.bbar.widgetMap[t===l-1?"stop":t&&t<n?"previous":"next"])||void 0===h||h.focus()),e.next=19;break;case 18:i.stop();case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"stop",value:(n=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this).activeIndex!==n.hints.length-1){e.next=4;break}return e.next=4,n.processActions(n.activeHint.nextAction);case 4:n.activeHint.owner=null,bryntum.queryAll("hint").forEach((function(e){return e.hintFlow===n&&e.destroy()})),n.activeHint=null,null===(t=n.returnFocusTo)||void 0===t||t.focus();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]);var n,r,a,o,l}(Mn.mixin(Ya,_n,$i));S(by,"configurable",{activeIndex:0,hints:null,defaults:{type:"hint",align:{allowTargetOut:!0},closable:!0,draggable:!1,buttons:{},autoNext:null,nextAction:null,previousAction:null,minWidth:null,trapFocus:!0,title:new String("")}}),by._$name="HintFlow";var Cy=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"configure",value:function(e){B(t,"configure",this,3)([e]),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}},{key:"changeDate",value:function(e){if(!this.isConfiguring){if(e="string"==typeof e?Pl.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}},{key:"updateDate",value:function(e,t){var n=this,r=n.dayColumnIndex,i=n.weekCount,a=Pl.getFirstDateOfMonth(e),o=Pl.getLastDateOfMonth(a),l=r[a.getDay()],s=r[o.getDay()],u=!t||e.getFullYear()!==t.getFullYear(),c=!t||e.getMonth()!==t.getMonth(),d=n.eventListeners&&(t?e.getDate()!==t.getDate()|(n.getWeekId(e)!==n.getWeekId(t))<<1|c<<2|u<<3:15);if(n._year=e.getFullYear(),n._month=e.getMonth(),n.startDayOfMonth=1-l,n.endDayOfMonth=o.getDate()+(6-s),n.sixWeeks&&(n.endDayOfMonth+=7*(6-n.weekCount)),n.weekBase&&!u||n.calculateWeekBase(),(c||u)&&n.generation++,d){var h={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&d),m:Boolean(12&d),y:Boolean(8&d),r:n.weekCount!==i}};n.trigger("dateChange",h),2&d&&n.trigger("weekChange",h),12&d&&n.trigger("monthChange",h),8&d&&n.trigger("yearChange",h)}}},{key:"calculateWeekBase",value:function(){var e=this,t=e.dayColumnIndex,n=new Date(e.year,0,1),r=new Date(e.year,11,31),i=e.month?e.getOtherMonth(n):e;e.dayColumnIndex[n.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);var a=Math.floor(Pl.diff(e.weekBase,r,"day")/7);e.has53weeks=53===a&&t[r.getDay()]>2}},{key:"getWeekStart",value:function(e){if("number"==typeof e)return Pl.add(this.weekBase,7*Math.max(e,1),"day");var t=this,n=_(e,2),r=n[0],i=n[1];return r===t.year?t.getWeekStart(i):t.getOtherMonth(new Date(r,0,1)).getWeekStart(i)}},{key:"getOtherMonth",value:function(e){var n=this,r=n===wy?new t(null):wy;return r.configure({weekBase:null,weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks,date:new Date(e.getFullYear(),0,1)}),r.date=e,r.updateDate(r.date,r.date),r}},{key:"changeYear",value:function(e){var t=new Date(this.date);t.setFullYear(e),this.date=t}},{key:"changeMonth",value:function(e){var t=new Date(this.date);t.setMonth(e),this.date=t}},{key:"weekStartDay",get:function(){return"number"==typeof this._weekStartDay?this._weekStartDay:Pl.weekStartDay}},{key:"updateWeekStartDay",value:function(){var e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}},{key:"nonWorkingDays",get:function(){return this._nonWorkingDays||Pl.nonWorkingDays}},{key:"changeNonWorkingDays",value:function(e){return Be.assign({},e)}},{key:"updateNonWorkingDays",value:function(){this.updateDayNumbers()}},{key:"updateHideNonWorkingDays",value:function(){this.updateDayNumbers()}},{key:"updateSixWeeks",value:function(){this.isConfiguring||this.updateDate(this.date,this.date)}},{key:"dayCount",get:function(){return this.endDayOfMonth+1-this.startDayOfMonth}},{key:"weekCount",get:function(){return this.dayCount/7}},{key:"startDate",get:function(){var e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}},{key:"endDate",get:function(){var e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}},{key:"firstDate",get:function(){var e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,1)}},{key:"lastDate",get:function(){var e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month+1,0)}},{key:"eachDay",value:function(e){for(var t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}},{key:"eachWeek",value:function(e){for(var t=this,n=t.weekCount,r=t.startDayOfMonth,i=0;i<n;i++){for(var a=[],o=t.getWeekNumber(new Date(t.year,t.month,r)),l=0;l<7;l++,r++)a.push(new Date(t.year,t.month,r));e(o,a,i,i===n-1)}}},{key:"getWeekNumber",value:function(e){var t=this;if((e=Pl.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);var n=Math.floor(Pl.diff(t.weekBase,e,"day")/7),r=e.getFullYear();return n?(53!==n||t.has53weeks?n>53&&(n%=52):(n=1,r++),[r,n]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}},{key:"getWeekId",value:function(e){var t=this.getWeekNumber(e);return 100*t[0]+t[1]}},{key:"getCellData",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:my.MIDNIGHT,r=this,a=e.getDay(),o=r.visibleDayColumnIndex[a],l=r.nonWorkingDays[a],s=r.hideNonWorkingDays&&l;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:a,dayTime:n,visibleColumnIndex:o,isNonWorking:l,week:r.getOtherMonth(e).getWeekNumber(e),key:Pl.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[a],date:new Date(e),dayEnd:n.duration("s"),tomorrow:n.dayOfDate(Pl.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!s&&e>=t.startDate&&e<Pl.add(t.endDate,1,"day"),isRowStart:0===o,isRowEnd:o===r.visibleColumnCount-1}}},{key:"updateDayNumbers",value:function(){for(var e=this,t=e.weekStartDay,n=e.nonWorkingDays,r=e.hideNonWorkingDays,i=e.dayColumnIndex=[],a=e.canonicalDayNumbers=[],o=e.visibleDayColumnIndex=[],l=0,s=0;s<7;s++){var u=(t+s)%7;a[s]=u,i[u]=s,r&&n[u]||(o[u]=l++)}e.visibleColumnCount=l,e.weekLength=r?7-Be.keys(n).length:7}}],[{key:"configurable",get:function(){return{date:{$config:{equal:"date"},value:Pl.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}}])}(_n(Mn));S(Cy,"$name","Month");var wy=new Cy(null);Cy._$name="Month";var Dy=0,Sy=new WeakMap,xy=function(e){var t=new a;return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){var t;return e&&"object"==W(e)||"function"==typeof e?(t=Sy.get(e))===i&&(t=++Dy,Sy.set(e,t)):t=String(e),t})).join("-")}(r),l=t.get(o);return l===i&&(l=e.apply(void 0,r),t.set(o,l)),l}},Ey=function(e){var t=new a,n=function(e){return e[0]},r=function(e){return e[1]},o=function(e,t){return n(e).push(t)};return function(a,l){var s=function(e){var n=t.get(e);return n===i&&(n=[[],[]],t.set(e,n)),n}(a);!function(e){return!r(e).length&&!n(e).length}(s)?(o(s,l),r(s).forEach((function(e){return l(e)}))):(o(s,l),e(a,(function(e){(function(e,t){return r(e).some((function(e){return Be.isEqual(e,t)}))})(s,e)||(!function(e,t){r(e).push(t)}(s,e),n(s).forEach((function(t){return t(e)})))})))}},Ry=Symbol("success"),Ty=Symbol("failure"),My=function(e,t){return[Ry,e,t]},Fy=function(e){return[Ty,e]},Ay=function(e){return e.length&&e[0]===Ry},Iy=function(e){return"function"!=typeof e||e.length?e:e()},Ly=xy((function(e){return Ey((function(t,n){return n(My(e,t))}))})),Oy=xy((function(e){return Ey((function(t,n){var r=Math.min(e.length,t.length),i=t.substr(0,r),a=t.substr(r);n(i===e?My(i,a):Fy(a))}))})),Py=function(e,t){return function(n,r){return Iy(e)(n,(function(e){if(Ay(e)){var n=_(e,3),i=n[1],a=n[2];t(i)(a,r)}else r(e)}))}},_y=xy((function(){for(var e=xy((function(e,t){return Ey(Py(e,(function(e){return Py(t,(function(t){return Ly([].concat(e,t))}))})))})),t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.reduce(e,Ly([]))})),Hy=xy((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ey((function(e,n){return t.forEach((function(t){return Iy(t)(e,n)}))}))})),By=xy((function(e){return function(t,n){var r=new RegExp("^".concat(e)).exec(t);if(r){var i=r[0],a=t.substr(i.length);n(My(i,a))}else n(Fy(t))}})),Vy=xy((function(e,t){return Py(e,(function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Ly(t.apply(void 0,z([].concat.apply([],n))))}))})),Ny=function(e,t){var n=[];return e(t,(function(e){Ay(e)&&(""===_(e,3)[2]&&n.push(e))})),n},zy={memo:xy,memoCps:Ey,success:My,failure:Fy,isSuccess:Ay,resolveParser:Iy,succeed:Ly,string:Oy,bind:Py,seq:_y,alt:Hy,regexp:By,red:Vy,runParser:Ny,defineParser:function(e){return function(t,n){return n?Iy(e)(t,n):Ny(Iy(e),t)}}},jy=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"open",value:function(){this.getConfig("tooltip")}},{key:"close",value:function(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}},{key:"dragMove",value:function(e){var t=this.offset,n=this.tooltip,r=e.event;n&&(n.isVisible||n.show(),n.alignTo({align:this.align,target:new pt(r.clientX-t,r.clientY-t,2*t,2*t)}))}},{key:"changeTooltip",value:function(e,t){return Lo.reconfigure(t,e,this)}}],[{key:"configurable",get:function(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}}])}(ey);S(jy,"type","tip"),jy.initClass(),jy._$name="DragTipProxy";var Wy=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeStore",value:function(e,n){var r=this;return B(t,"changeStore",this,3)([new Ff({data:[{id:r.positiveValue,text:r.positiveText||r.L("L{Object.Yes}")},{id:r.negativeValue,text:r.negativeText||r.L("L{Object.No}")}]}),n])}}],[{key:"configurable",get:function(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}}])}(dv);S(Wy,"$name","BooleanCombo"),S(Wy,"type","booleancombo"),Wy.initClass(),Wy._$name="BooleanCombo";var $y,Uy={0:1,6:1},Gy=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.refreshCount||this.refresh()}},{key:"onInternalPaint",value:function(e){var n,r=e.firstPaint;null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n(arguments),r&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}},{key:"overflowElement",get:function(){return this.weeksElement}},{key:"doDestroy",value:function(){var e;null===(e=this.tip)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"updateMinRowHeight",value:function(e){this.element.style.setProperty("--min-row-height",li.setLength(e)),this.scrollable={overflowY:!!e&&"auto"}}},{key:"updateMinColumnWidth",value:function(e){this.element.style.setProperty("--min-column-width",li.setLength(e)),this.scrollable={overflowX:!!e&&"auto"},this.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}},{key:"getDateFromDomEvent",value:function(e){var t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest("#".concat(this.id," [data-date]"));if(t)return Pl.parseKey(t.dataset.date)}},{key:"changeTip",value:function(e,t){var n=this;return pc.reconfigure(t,e,{owner:n,defaults:{type:"tooltip",owner:n,id:"".concat(n.id,"-cell-tip"),forElement:n.bodyElement,forSelector:".".concat(n.dayCellCls)}})}},{key:"updateTip",value:function(e){this.detachListeners("tip"),null==e||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}},{key:"updateElement",value:function(e,n){var r=this;B(t,"updateElement",this,3)([e,n]),r.updateHideNonWorkingDays(r.hideNonWorkingDays),r.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),r.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),r.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),r.cellElements=[];for(var i=0,a=r.weekDayElements.length;i<a;i++){var o;(o=r.cellElements).push.apply(o,[r.weekDayElements[i].previousSibling].concat(z(r.weekDayElements[i].children)))}}},{key:"changeDate",value:function(e){if(e="string"==typeof e?Pl.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return Pl.clearTime(e)}},{key:"updateDate",value:function(e){this.month.date=e,this.element.dataset.month=Pl.format(e,"YYYY-MM")}},{key:"updateDayNameFormat",value:function(){var e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(var t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(Pl.format(e,this.dayNameFormat))}},{key:"weekStartDay",get:function(){return"number"==typeof this._weekStartDay?this._weekStartDay:Pl.weekStartDay}},{key:"updateWeekStartDay",value:function(e){var t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(var n=0;n<7;n++)t.dayNames[n]=t.shortDayNames[t.canonicalDayNumbers[n]];t.refreshCount&&t.refresh()}}},{key:"updateHideNonWorkingDays",value:function(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}},{key:"updateHideOtherMonthCells",value:function(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}},{key:"updateDisableOtherMonthCells",value:function(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}},{key:"nonWorkingDays",get:function(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=Pl.nonWorkingDays)}},{key:"weekends",get:function(){return this._localeWeekends||(this._localeWeekends=Pl.weekends)}},{key:"changeNonWorkingDays",value:function(e){return Be.assign({},e)}},{key:"updateNonWorkingDays",value:function(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}},{key:"visibleDayColumnIndex",get:function(){return this.month.visibleDayColumnIndex}},{key:"dayColumnIndex",get:function(){return this.month.dayColumnIndex}},{key:"canonicalDayNumbers",get:function(){return this.month.canonicalDayNumbers}},{key:"visibleColumnCount",get:function(){return this.month.visibleColumnCount}},{key:"weekLength",get:function(){return this.month.weekLength}},{key:"startDate",get:function(){return this.month.startDate}},{key:"duration",get:function(){return Pl.diff(this.month.startDate,this.month.endDate,"day")+1}},{key:"endDate",get:function(){var e=this.month.endDate;if(e)return Pl.add(e,1,"day")}},{key:"changeMonth",value:function(e,t){var n=this;if(!(e instanceof Cy)){if("number"==typeof e){if(t)return void(t.month=e);var r=n.date||Pl.clearTime(new Date);r.setMonth(e),e={date:r}}e=Cy.new({weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:n}),e}},{key:"onMonthDateChange",value:function(e){var t=e.source,n=e.newDate,r=e.oldDate,i=e.changes,a=this;if(a.year=t.year,!a.isConfiguring){if(!a.getCell(n)||i.m||i.y){var o=a.isVisible;a.refresh(),a.animateTimeShift&&o&&li.slideIn(a.contentElement,n>r?1:-1)}a.trigger("dateChange",{changes:i,value:n,oldValue:r})}}},{key:"updateYear",value:function(e){this.month.year=e}},{key:"updateShowWeekNumber",value:function(e){this.updateShowWeekColumn(e)}},{key:"updateShowWeekColumn",value:function(e){var t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}},{key:"updateSixWeeks",value:function(e){this.month&&(this.month.sixWeeks=e,this.refresh())}},{key:"refresh",value:function(){this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.doRefresh()}},{key:"doRefresh",value:function(){var e;this.getConfig("element");var t=this,n=null!=t.timeZone?t.timeZone:null===(e=t.project)||void 0===e?void 0:e.timeZone,r=null!=n?yp.toTimeZone(new Date,n):new Date,i=t.weekElements,a=t.weekDayElements,o=t.date,l=t.month,s=t.dayCellCls,u=t.dayHeaderCls,c=t.disabledCls,d=t.otherMonthCls,h=t.weekendCls,f=t.todayCls,v=t.nonWorkingDayCls,g=t.nonWorkingDays,m=t.canonicalDayNumbers,p=t.sixWeeks;if(r.setHours(0,0,0,0),o){t.element.style.setProperty("--visible-week-count",l.weekCount),t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(var y=0;y<7;y++){var k=t.weekdayCells[y],b=t.canonicalDayNumbers[y],C=S(S(S({},u,1),h,Uy[b]),v,g[b]);if(t.headerRenderer){k.innerHTML="";var w=t.callback(t.headerRenderer,t,[k,y,b]);w&&("string"==typeof w?li.setInnerText(k,w):li.createElement(F(F({},w),{},{parent:k})))}else li.setInnerText(k,t.shortDayNames[b]);li.syncClassList(k,C),k.dataset.columnIndex=y,k.dataset.cellDay=b}for(var D=0,x=0,E=6,R=6;R>=0;R--)if(!g[m[R]]){E=R;break}i[4].classList.toggle("b-hide-display",l.weekCount<5&&!p),i[5].classList.toggle("b-hide-display",l.weekCount<6&&!p),l.eachWeek((function(e,n){var o=a[D],u=[o.previousSibling].concat(z(o.children)),m=u[0];if(i[D].dataset.week="".concat(e[0],",").concat(e[1]),i[D].setAttribute("aria-label","".concat(t.L("L{Week}")," ").concat(e[1],", ").concat(e[0])),""===m.innerHTML&&(m.innerText=e[1]),t.weekRenderer){var p=t.callback(t.weekRenderer,t,[m,e]);p&&("string"==typeof p?li.setInnerText(m,p):(m.innerHTML="",li.createElement(F(F({},p),{},{parent:m}))))}else m.innerText=e[1];for(var y=0;y<7;y++){var k=n[y],b=k.getDay(),C=Pl.makeKey(k),w=g[b],R=u[y+1],T=S(S(S(S(S(S(S(S(S(S({},s,1),c,t.isDisabledDate(k)),d,k.getMonth()!==l.month),h,Uy[b]),f,k.getTime()===r.getTime()),v,w),"b-last-working-day",y===E),"b-first-visible-cell",!(k-(t.firstVisibleDate||-1))),"b-last-visible-cell",!(k-(t.lastVisibleDate||-1))),"b-day-of-week-".concat(b),1);li.syncClassList(R,T),R.role="gridcell",R.dataset.date=C,R.dataset.cellIndex=x,R.dataset.columnIndex=y,R.lastDomConfig&&(delete R.lastDomConfig.class,delete R.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:R,date:k,day:b,rowIndex:D,cellIndex:x,columnIndex:y,key:C,week:e,row:i[D],source:t,visibleColumnIndex:t.visibleDayColumnIndex[b]}]):R.innerHTML=k.getDate(),x++}D++})),t.visibleWeekCount=D,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}else t.date=r}},{key:"isDisabledDate",value:function(e){var t=this,n=e.getDay(),r=t.disabledDates;return!(!t.disableWeekends||!Uy[n])||(!(!t.disableNonWorkingDays||!t.nonWorkingDays[n])||(r?Array.isArray(r)?(e=Pl.clearTime(e,!0),r.some((function(t){return t="string"==typeof t?Pl.parse(t):t,!(Pl.clearTime(t,!0)-e)}))):t.callback(r,t,[e]):void 0))}},{key:"bodyConfig",get:function(){var e=B(t,"bodyConfig",this,1),n=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays","aria-hidden":!0,reference:"weekdaysHeader",children:[{class:"b-week-number-cell"}].concat(z($e.fill(7,{class:this.dayHeaderCls})),[li.scrollBarPadElement])},{className:"b-weeks-container notranslate",reference:"weeksElement",children:n,role:"grid"}];for(var r=0;r<6;r++){var i={role:"row",className:"b-calendar-row b-calendar-week",dataset:{rowIndex:r},children:[{className:"b-week-number-cell",role:"rowheader"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};n.push(i)}return e}},{key:"firstVisibleDate",get:function(){if(this.hideOtherMonthCells){var e=this.month,t=e.year,n=e.month;return new Date(t,n,1)}for(var r=this,i=r.month.startDate;;i.setDate(i.getDate()+1))if(!r.hideNonWorkingDays||!r.nonWorkingDays[i.getDay()])return i}},{key:"lastVisibleDate",get:function(){var e=Pl.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(var t=e;;t.setDate(t.getDate()-1))if(!this.hideNonWorkingDays||!this.nonWorkingDays[t.getDay()])return t}},{key:"getCell",value:function(e,t){"string"!=typeof e&&(e=Pl.makeKey(e));var n=this.weeksElement.querySelector('[data-date="'.concat(e,'"]'));if(n&&(!t||!n.classList.contains(this.otherMonthCls)))return n}},{key:"onTipOverCell",value:function(e){var t=e.source,n=e.target;t.date=Pl.parseKey(n.dataset.date)}},{key:"updateLocalization",value:function(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),B(t,"updateLocalization",this,3)([])}}],[{key:"configurable",get:function(){return{layout:"vbox",textContent:!1,date:{$config:"date"},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,disableNonWorkingDays:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}}])}(uc);S(Gy,"$name","CalendarPanel"),S(Gy,"type","calendarpanel"),Gy.initClass(),Gy._$name="CalendarPanel";var Yy=Math.abs,qy=Math.ceil,Ky=Math.floor,Xy=Math.max,Zy=Math.min,Jy="b-carousel-item",Qy=[0,0],ek=Symbol("carouselIndex"),tk=Symbol("carouselSyncGen"),nk="b-carousel-reserve",rk="".concat(nk,"-before"),ik="".concat(nk,"-after"),ak=function(e,t){return e[ek]-t[ek]},ok="b-carousel-visible",lk=["x","y"],sk=["y","x"],uk={h:{minSize:"minWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",size:"width",vxy:["vx","vy"],xy:lk},v:{minSize:"minHeight",offsetSize:"offsetHeight",size:"height",vxy:["vy","vx"],xy:sk}};uk.h.other=uk.v,uk.v.other=uk.h;var ck=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){return{class:F({},this.carouselClasses)}}},{key:"afterFloatReparent",value:function(){this.syncSoon()}},{key:"allSlots",get:function(){return this.ensureItems().values.filter((function(e){return e.innerItem})).sort(ak)}},{key:"bodyConfig",get:function(){var e=this.carouselClasses,n=this.emptyHtml,r=this.emptyText,i=B(t,"bodyConfig",this,1);return Be.merge(i,{className:F({"b-vbox":1},e),children:{innerCt:{class:{"b-carousel-inner-ct":1,"b-box-center":1}},emptyElement:{class:{"b-carousel-empty-text":1,"b-box-center":1},html:n||Le.xss($y||($y=N(["",""])),r)}}})}},{key:"carouselClasses",get:function(){return{"b-carousel-empty":this.empty,"b-carousel-vertical":this.vertical}}},{key:"contentElement",get:function(){return this.innerCt}},{key:"currentIndex",get:function(){return this.indexFromPos(this.scrollPos)},set:function(e){this.goto(e)}},{key:"focusedSlot",get:function(){var e,t,n=this.innerCt,r=null;for(e=li.getActiveElement();e;e=t)if((t=e.parentElement)===n){r=Lo.fromElement(e);break}return r}},{key:"infinityScrollerDefaults",get:function(){var e=this,n=_(e.vertical?sk:lk,2),r=n[0],i=n[1];return Be.merge(B(t,"infinityScrollerDefaults",this,1),S(S({snap:e.snap&&r},r,{overflow:"hidden-scroll",range:e.scrollRange,pos:0}),i,{overflow:"hidden"}))}},{key:"propNames",get:function(){return uk[this.vertical?"v":"h"]}},{key:"scrollAxis",get:function(){return this.infinityScroller[this.vertical?"y":"x"]}},{key:"scrolling",get:function(){return this.infinityScroller.scrolling}},{key:"scrollPos",get:function(){return this.scrollAxis.pos},set:function(e){this.scrollAxis.pos=e}},{key:"scrollRange",get:function(){var e=this.range,t=this.slotSize;return t?[e[0]*t,e[1]*t]:[0,1/0]}},{key:"shrinkWrap",get:function(){var e=this._shrinkWrap;return"auto"===e?"absolute"===li.getStyleValue(this.element,"position"):e}},{key:"lastVisibleIndex",get:function(){var e;return null===(e=this.lastVisibleSlot)||void 0===e?void 0:e[ek]}},{key:"visibleSlots",get:function(){return this.allSlots.filter((function(e){return e.element.classList.contains(ok)}))}},{key:"updateAtMax",value:function(e){this.element.classList.toggle("b-carousel-at-max",e)}},{key:"updateAtMin",value:function(e){this.element.classList.toggle("b-carousel-at-min",e)}},{key:"changeConfigureSlot",value:function(e){var t=this;if("string"==typeof e){var n="_".concat(e,"Fn");return this[n]||(this[n]=function(){return t[e].apply(t,arguments)})}return e}},{key:"triggerSlotVisibility",value:function(){var e=this.firstVisibleSlot,t=this.lastVisibleSlot;this.trigger("slotVisibility",{firstVisibleSlot:e,lastVisibleSlot:t})}},{key:"updateFirstVisibleSlot",value:function(e){this.triggerSlotVisibility()}},{key:"updateLastVisibleSlot",value:function(){this.triggerSlotVisibility()}},{key:"changeRange",value:function(e){var t,n,r;if((e=e?[null!==(t=e[0])&&void 0!==t?t:-1/0,null!==(n=e[1])&&void 0!==n?n:1/0]:[0,0])[0]!==e[1]&&(e[1]<e[0]&&(r="denormalized"),r))throw new Error("Invalid carousel range [".concat(e[0],", ").concat(e[1],"): ").concat(r));return e}},{key:"updateRange",value:function(e){this.empty=!(e[0]<e[1]),this.syncSoon()}},{key:"updateShrinkWrap",value:function(){this.isPainted&&this.syncSoon()}},{key:"updateVertical",value:function(){this.isPainted&&this.syncSoon()}},{key:"convertIndexPos",value:function(e,t){var n=this,r=n.allSlots,i=n.propNames,a=_(n.range,2),o=a[0],l=a[1],s=Math.floor((o+l)/2),u=r.length,c=r[u-1],d=i.vxy[0],h=o<=0&&0<l;if(!(t||o<=e&&e<l))return null;var f,v,g,m,p,y,k,b,C=n.slotSize||100;if(u){C=0;var w,S=D(r);try{for(S.s();!(w=S.n()).done&&(g=(b=w.value)[ek],f=b[d],C=C||b.$vxy[i.size],!(b===r[0]&&(m=g,k=f,e<(t?f:g))));){if(t){if(e===f)return g;if(e<f)return g-1}else if(e===g)return f;if(b===c){if(v=f+b.$vxy[i.size],t&&e<v)return g;p=g+1,y=v}}}catch(e){S.e(e)}finally{S.f()}C=C||n.slotSize||100}else{if(t&&0<=e&&e<C)return h?0:s;k=0,y=C,p=(m=h?0:s)+1}return t?e<k?Xy(m-qy((k-e)/C),o):Zy(p+Ky((e-y)/C),l):e<m?k-(m-e)*C:y+(e-p)*C}},{key:"ensurePlan",value:function(e){return e}},{key:"ensureVisible",value:function(e){var t=this;if(null==t.lastScrollPos)t._afterSync=function(){return t.ensureVisible(F(F({},e),{},{animate:!1}))};else{if(!t.scrolling||!t.hasPainted){var n,r=t.ensurePlan(e),i=r.index,a=r.animate,o=t.currentIndex,l=t.lastVisibleIndex;return i<o?n=i-o:l<i&&(n=i-l),n&&t.go(n,a)}t._afterScroll=function(){return t.ensureVisible(e)}}}},{key:"getSlotIndex",value:function(e){return null==e?void 0:e[ek]}},{key:"indexFromPos",value:function(e){return this.convertIndexPos(e,!0)}},{key:"posFromIndex",value:function(e){return this.convertIndexPos(e,!1)}},{key:"slotFromIndex",value:function(e){var t,n=D(this.allSlots);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r[ek]===e)return r}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"backward",value:function(e){return this.go(-1,e)}},{key:"forward",value:function(e){return this.go(1,e)}},{key:"go",value:function(e,t){return this.goto(this.currentIndex+e,t)}},{key:"goto",value:function(e,t){var n=this;if(null==n.lastScrollPos)n._afterSync=function(){var t=n.scrollPos;n.goto(e,!1),n.hasPainted||t===n.scrollPos||n.sync()};else{if(!n.scrolling||!n.hasPainted){var r=n.range,i=n.slots,a=r[1]-("number"==typeof i?i-1:0),o=Zy(a-1,Xy(r[0],e)),l=Yy(n.currentIndex-o),s=n.posFromIndex(o);return l>=n.allSlots.length&&(t=!1),n.scrollTo(S({animate:t},n.scrollAxis.name,s))}n._afterScroll=function(){return n.goto(e,t)}}}},{key:"onChildAdd",value:function(e){return e.innerItem&&e.element.classList.add(Jy),B(t,"onChildAdd",this,3)([e])}},{key:"onChildRemove",value:function(e){return e.innerItem&&e.element.classList.remove(Jy),B(t,"onChildRemove",this,3)([e])}},{key:"onInfiniteScrollEnd",value:function(e){B(t,"onInfiniteScrollEnd",this,3)([e]);var n=this._afterScroll;this._afterScroll=null,null==n||n()}},{key:"onSlotFocusTrap",value:function(e){var t=e.source,n=this,r=e.top?-1:1,i=t[ek],a=n.slotFromIndex(i+r);return a.element.classList.contains(nk)?n.scrollOnTab&&n.go(r).then((function(e){var t;e&&(null===(t=a.element)||void 0===t||t.focus())})):a.element.focus(),!1}},{key:"resync",value:function(){this.sync()}},{key:"sync",value:function(){if(this.syncCount=(this.syncCount||0)+1,!this.empty){var e,t=this,n=t.allSlots,r=t.disableReserveSlots,i=t.innerCt,a=t.scrollAxis,o=t.propNames,l=t.reserveSlots,s=t.scrolling,u=t.slots,c=_(t.range,2),d=c[0],h=c[1],f=a.pos,v=Lo.resolveType((null===(e=t.defaults)||void 0===e?void 0:e.type)||t.defaultType),g=t.indexFromPos(f),m=t.posFromIndex(g),p=f-m,y=[l,l],k=t.syncGen=(t.syncGen||0)+1;s&&f>(t.lastScrollPos||0)&&p&&(--y[0],++y[1]),t.lastScrollPos=f,i.style.setProperty("--carousel-item-offset","".concat(Math.abs(p),"px")),t.shrinkWrapped||(i.style[o.minSize]="");var b,C,w,x,E=i[o.offsetSize],R=!1,T=!1,M=null,F=null;t.unanimated((function(){var e=t._afterSync,l=u&&"auto"!==u?t.syncFixed(g,o,n,v,y,u,d,h):t.syncDynamic(g,o,n,v,y,u,E,d,h),c=[],m=n.filter((function(e){return e[tk]!==k}));m.length&&(m.forEach((function(e){return t.detachListeners("".concat(e.id,"-listeners"))})),t.remove(m)),i.style[o.other.minSize]="".concat(l[o.other.size],"px"),E=i[o.offsetSize];var p,A=D(n);try{for(A.s();!(p=A.n()).done;)if(x=p.value,!m.includes(x)){var I=a.getItemSpan(x),L=f+E,O=I[1]<=f,P=L<=I[0],H=!O&&!P,B=H&&I[0]<=f,V=H&&I[1]>=L;H&&(x[ek]===d&&(T=!0),x[ek]===h-1&&(R=!0)),B&&(M=x),V&&(F=x),c.push([x,x.element.classList,S(S(S(S(S(S({},nk,O||P),rk,O),"b-carousel-first",B),ok,H),"b-carousel-last",V),ik,P)])}}catch(e){A.e(e)}finally{A.f()}for(var N=0,z=c;N<z.length;N++){var j=_(z[N],3);for(C in x=j[0],b=j[1],w=j[2],r&&(x.disabled=!w[ok]&&r),w)b.toggle(C,w[C])}t.atMax=R,t.atMin=T,t.firstVisibleSlot=M,t.lastVisibleSlot=F,a.other.range=Qy,t.syncDomOrder(m.length?t.allSlots:n),!s&&t.scrollable.fixPositionSync(),a.sync({range:t.scrollRange}),a.pos!==f?t.resync():e&&(t._afterSync=null,e())}))}}},{key:"syncDomOrder",value:function(e){var t,n,r,i,a=li.getActiveElement();for(i=e.length;i-- >1;)r=e[i].element,n||r.classList.add("b-last-visible-child"),(n=e[i-1].element).classList.remove("b-last-visible-child"),r.classList.remove("b-first-visible-child"),n.nextSibling!==r&&n.parentElement.insertBefore(n,r);null===(t=n)||void 0===t||t.classList.add("b-first-visible-child"),this.element.contains(a)&&a!==li.getActiveElement()&&a.focus()}},{key:"syncDynamic",value:function(e,t,n,r,i,a,o,l,s){var u,c,d,h=t.offsetSize,f="auto"===a,v=f?"":null,g=_(i,2),m=g[0],p=g[1],y=1,k=0;for(d=e;l<=d&&d<s;d+=y){if(c=this.syncSlot(n,r,d,v),u=u||c,k<o){if(k+=c.element[h],f)return this.syncFixed(e,t,n,r,i,qy(o/k));if(y>0){if(d+1<s&&(k<o||p))continue;m+=p,p=0}}if(--p<1){if(y<0||!m)break;y=-1,d=e,p=m}}return u}},{key:"syncFixed",value:function(e,t,n,r,i,a,o,l){for(var s,u,c,d,h,f=this,v=f.shrinkWrap,g=f.shrinkWrapped,m="".concat(100/a,"%"),p=e+a,y=e-i[0],k=p+i[1],b=0;k>l;)--y,--k;for(;y<o;)++y,++k;for(h=y;h<k;++h)u=f.syncSlot(n,r,h,v&&!g?"":m),h===e&&(s=u),v?(c||(c=[])).push(u):u[t.size]=m;if(v){for(h=(d=Zy(p,k-i[1]))-a;h<d;++h)b+=c[h-y][t.size];var C,w=D(c);try{for(w.s();!(C=w.n()).done;)(u=C.value)[t.size]=m}catch(e){w.e(e)}finally{w.f()}b&&(f.innerCt.style[t.minSize]="".concat(b,"px"),f.shrinkWrapped=!0)}return s}},{key:"syncSlot",value:function(e,t,n,r){var i,a,o,l,s,u=this,c=u.propNames,d=u.syncGen,h=null!==r,f=null,v=D(e);try{for(v.s();!(s=v.n()).done;)if((l=s.value)[tk]!==d){if((a=l[ek])===n){o=l,h&&(o[c.size]=r);break}(!f||a>f[ek])&&(f=l)}}catch(e){v.e(e)}finally{v.f()}return o||(i=u.configureSlot(n,u,f),f?(o=f,h&&(o[c.size]=r),delete i.type,o.setConfig(i)):(i=(i.type?Lo.resolveType(i.type):t).mergeConfigs(u.defaults,i),h&&(i[c.size]=r),o=u.add(i),e.push(o),o.ion({thisObj:u,name:"".concat(o.id,"-listeners"),focusTrap:"onSlotFocusTrap"})),o[ek]=n,u.slotSize||(u.slotSize=o[c.size]),o[c.vxy[0]]=n*u.slotSize),o[tk]=d,o}}])}(uc.mixin(Ap,$p));S(ck,"$name","Carousel"),S(ck,"type","carousel"),S(ck,"configurable",{atMax:null,atMin:null,configureSlot:function(e,t,n){return{}},disableReserveSlots:null,empty:null,emptyHtml:null,emptyText:"No items to display",firstVisibleSlot:null,lastVisibleSlot:null,range:[null,null],reserveSlots:1,scrollOnTab:null,shrinkWrap:"auto",slots:null,snap:!0,vertical:null}),S(ck,"delayable",{triggerSlotVisibility:"raf"}),S(ck,"fenced",{resync:!0}),ck.initClass(),ck._$name="Carousel";var dk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"bodyConfig",get:function(){var e=B(t,"bodyConfig",this,1),n=e.className,r=this.inlineInternal,i=this.hasLabel,a=this.title;return delete e.html,n["b-inline"]=r,n["b-fieldset-has-label"]=i,a&&(e.children={legendElement:{tag:"legend",text:a,class:{"b-fieldset-legend":1}}}),e}},{key:"compose",value:function(){var e=this.inlineInternal,t=this.label,n=this.labelCls,r=this.labelWidth;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":t?{tag:"label",html:t,class:S({"b-label":1,"b-align-start":1},n,n),style:{width:li.unitize("width",r)[1]}}:null}}}},{key:"syncInlineInternal",value:function(){var e;this.inlineInternal=null!==(e=this.inline)&&void 0!==e?e:null!=this.label&&"before"===this.labelPosition}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.eachWidget((function(t){t.disabled=e}),!1)}},{key:"updateInline",value:function(){this.syncInlineInternal()}},{key:"updateInlineInternal",value:function(e){this.layout.horizontal=e}},{key:"updateLabel",value:function(){this.syncInlineInternal()}},{key:"updateLabelPosition",value:function(){this.syncInlineInternal()}}],[{key:"prototypeProperties",get:function(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}}])}(uc.mixin(Bf));S(dk,"$name","FieldSet"),S(dk,"type","fieldset"),S(dk,"configurable",{bodyTag:"fieldset",focusable:!1,localizableProperties:["label"],inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}),dk.initClass(),dk._$name="FieldSet";var hk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"textLabelCls",get:function(){return B(t,"textLabelCls",this,1)+" b-radio-label"}},{key:"internalOnClick",value:function(e){!1!==B(t,"internalOnClick",this,3)([e])&&this.checked&&this.clearable&&(this.checked=!1)}},{key:"updateName",value:function(e){this.toggleGroup=e}},{key:"updateClearable",value:function(){}}],[{key:"configurable",get:function(){return{inputType:"radio",clearable:null,uncheckedValue:i}}}])}(Jg);S(hk,"$name","Radio"),S(hk,"type","radio"),S(hk,"alias","radiobutton"),hk.initClass(),hk._$name="Radio";var fk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"triggerPaint",value:function(){var e=this,n=!e.isPainted,r=e.__value;B(t,"triggerPaint",this,3)(arguments),ne.isFirefox&&e.isVisible&&n&&r!==i&&r!==e.value&&(e.value=i,e.value=r)}},{key:"existingOptions",get:function(){var e=this.name;return this.ensureItems().filter((function(t){return t.name===e}))}},{key:"refPrefix",get:function(){return"".concat(this.name||this.ref||this.id,"_")}},{key:"selected",get:function(){return this.existingOptions.filter((function(e){return e.input.checked}))[0]||null}},{key:"value",get:function(){var e=this.selected;return e?e.checkedValue:null},set:function(e){var t=this;this.existingOptions.forEach((function(n){n.isConfiguring=t.isConfiguring,n.checked=n.checkedValue===e,n.isConfiguring=!1})),ne.isFirefox&&!this.isConnected&&(this.__value=e)}},{key:"ensureItems",value:function(){return this.getConfig("options"),B(t,"ensureItems",this,3)([])}},{key:"changeOptions",value:function(e,t){if(!(e&&t&&Be.isDeeplyEqual(t,e)))return e}},{key:"convertOption",value:function(e,t,n){var r=this,i={name:r.name,type:r.defaultType,value:r.peekConfig("value"),ref:"".concat(r.refPrefix).concat(e),disabled:r.disabled,checkedValue:e};return"string"==typeof t?i.text=t:Be.assign(i,t),n?Lo.reconfigure(n,i):i}},{key:"isOurRadio",value:function(e){return(e.isRadio||e.isCheckbox)&&e.name===this.name}},{key:"isolateFieldChange",value:function(e){return this.isOurRadio(e)}},{key:"onChildAdd",value:function(e){B(t,"onChildAdd",this,3)([e]),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onItemBeforeChange",change:"onItemChange",click:"onItemClick",thisObj:this})}},{key:"onChildRemove",value:function(e){this.isOurRadio(e)&&this.detachListeners(e.id),B(t,"onChildRemove",this,3)([e])}},{key:"onItemClick",value:function(e){var t=e.source;t.checked&&this.clearable&&null==t.clearable&&(t.checked=!1)}},{key:"onItemBeforeChange",value:function(e){if(e.checked){var t=this,n=t.lastValue;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=n&&n!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=n,t.lastValue=n,t.reverting=!1,!1}}},{key:"onItemChange",value:function(e){var t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}},{key:"wrapRadioEvent",value:function(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}},{key:"updateOptions",value:function(){var e,t,n=this,r=n.options,i=n.refPrefix,a=n.existingOptions.reduce((function(e,t){return e[t.ref.substring(i.length)]=t,e}),{}),o=0;if(r)for(e in r)t=n.convertOption(e,r[e],a[e]),delete a[e],n.insert(t,o++);var l=Object.values(a);null!=l&&l.length&&(n.remove(l),l.forEach((function(e){return e.destroy()})))}}])}(dk);S(fk,"$name","RadioGroup"),S(fk,"type","radiogroup"),S(fk,"configurable",{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}),fk.initClass(),fk._$name="RadioGroup";var vk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onItemBeforeChange",value:function(e){var t=this,n=t.lastValue;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=n&&n!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=n,t.lastValue=n,t.reverting=!1,!1}},{key:"onItemChange",value:function(e){var t=this;t.reverting||(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value),t.syncInvalid()}},{key:"selected",get:function(){return this.existingOptions.filter((function(e){return e.input.checked}))||null}},{key:"value",get:function(){return this.selected.map((function(e){return e.checkedValue}))},set:function(e){var t=this;"string"==typeof(e=e||[])&&(e=e.split(this.separator)),this.existingOptions.forEach((function(n){n.isConfiguring=t.isConfiguring,n.checked=e.includes(n.checkedValue),n.isConfiguring=!1})),ne.isFirefox&&!this.isConnected&&(this.__value=e)}},{key:"internalOnChange",value:function(){this.syncInvalid()}},{key:"inputWrap",get:function(){return this.element}},{key:"isValid",get:function(){var e=!0,t=this,n=t.selected,r=t.requiredSelectedOptions,a=t.minSelectedOptions,o=t.maxSelectedOptions;if(t.clearError(i,!0),!t.disabled){var l=isNaN(t.minSelectedOptions)||n.length>=a,s=isNaN(t.maxSelectedOptions)||n.length<=o;r&&n.length!==r?(e=!1,t.setError(t.L("L{wrongNbrOfOptionsSelected}",r),!0)):l?s||(e=!1,t.setError(t.L("L{tooManyOptionsSelected}",o),!0)):(e=!1,t.setError(t.L("L{tooFewOptionsSelected}",a),!0))}return e&&t.errors&&Object.keys(t.errors).length&&(e=!1),e}},{key:"updateMinSelectedOptions",value:function(){this.isConfiguring||this.syncInvalid()}},{key:"updateMaxSelectedOptions",value:function(){this.isConfiguring||this.syncInvalid()}},{key:"updateRequiredSelectedOptions",value:function(){this.isConfiguring||this.syncInvalid()}}])}(fk.mixin(Vf));S(vk,"$name","CheckboxGroup"),S(vk,"type","checkboxgroup"),S(vk,"configurable",{defaultType:"checkbox",defaults:{color:"b-blue"},separator:",",requiredSelectedOptions:null,minSelectedOptions:null,maxSelectedOptions:null,errorTooltipCachePath:"checkboxGroupErrorTooltip",errorTooltipConfig:{forSelector:".b-checkboxgroup.b-invalid .b-checkbox-label",align:"t-b"}}),vk.initClass(),vk._$name="CheckboxGroup";var gk,mk=w((function e(){m(this,e)})),pk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"configure",value:function(e){B(t,"configure",this,3)([e]),this.setItems(),this.ion({item:"onColorSelect"})}},{key:"setItems",value:function(){var e=this,t=e.colors,n=e.colorClasses,r=t||n;e.addNoColorItem&&(e.store.modelClass.allowNullId=!0,r=[].concat(z(r),[null])),e.items=r.map((function(t){return t&&"string"!=typeof t?t:{color:t,text:(n?Le.capitalize(t):t)||e.L("L{noColor}")}}))}},{key:"afterConfigure",value:function(){var e;(B(t,"afterConfigure",this,3)(arguments),this.addNoColorItem||this.value)&&this.select(null!==(e=this.value)&&void 0!==e?e:null)}},{key:"updateColors",value:function(){this.isConfiguring||this.setItems()}},{key:"updateAddNoColorItem",value:function(){this.isConfiguring||this.setItems()}},{key:"onColorSelect",value:function(e){var t,n=e.record;this.refresh();var r={color:n.color,record:n,bubbles:!0};null===(t=this.colorSelected)||void 0===t||t.call(this,r),this.trigger("colorSelected",r)}},{key:"select",value:function(e){e&&"string"!=typeof e||(e=this.store.findRecord("color",null!=e?e:null)),e&&B(t,"select",this,3)([e])}},{key:"updateColumns",value:function(e){this.style="grid-template-columns:repeat(".concat(e,", 1fr);")}},{key:"getColorClassName",value:function(e){var t,n;return null!==(t=this.colorClasses)&&void 0!==t&&t.includes(e)||null!==(n=this.colorClasses)&&void 0!==n&&n.find((function(t){return t&&t.color===e}))?this.colorClassPrefix+e:e?"":"b-no-color"}}])}(ev);S(pk,"$name","ColorPicker"),S(pk,"type","colorpicker"),S(pk,"configurable",{itemsFocusable:!1,navigator:{focusCls:"b-color-active"},itemWrapperTpl:function(e,t){var n=this.selected,r=e.color,i=e.text,a=this.getColorClassName(r);return Kf.tpl(gk||(gk=N(['\n                    <li\n                        class="'," ",'"\n                        role="option"\n                        aria-selected="','"\n                        data-index="','"\n                        data-id="','"\n                        data-btip="','"\n                        ','\n                        style="','"\n                    ></li>'])),this.getItemClasses(e,t),a,n.includes(e),t,Le.encodeHtml(r),i,this.itemsFocusable?'tabindex="-1"':"",a?"":"background-color: "+r)},colorClasses:null,colorClassPrefix:null,colors:["#45171D","#F03861","#FF847C","#FECEA8","#A5F2E7","#AA83F3","#8983F3","#A10054","#073059","#2866AB","#5FBDC5","#D8D95C","#FFDEDE","#F7F3CE","#C5ECBE","#3E3E3E","#405559","#68868C","#EDEDED","#D3D6DB","#3A4750","#303841","#BE3144"],addNoColorItem:!0,columns:6,colorSelected:null,store:{useRawData:!1}}),pk.initClass(),pk._$name="ColorPicker";var yk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"configure",value:function(e){var n,r=null!==(n=e.picker)&&void 0!==n?n:{};e.colors&&(r.colors=e.colors),"addNoColorItem"in e&&(r.addNoColorItem=e.addNoColorItem),e.picker=r,B(t,"configure",this,3)([e])}},{key:"updatePicker",value:function(e,n){B(t,"updatePicker",this,3)([e,n]),e&&(this.items=e.store.records)}},{key:"updateColors",value:function(e){this.isConfiguring||(this.picker.colors=e)}},{key:"updateAddNoColorItem",value:function(e){this.isConfiguring||(this.picker.addNoColorItem=e)}},{key:"value",get:function(){return B(t,"value",this,1)},set:function(e){this.store||(this.items=[],this.store=this.picker.store),e||(e=this.store.findRecord("color",null)),V(t,"value",e,this,1,1)}},{key:"showPicker",value:function(){this.picker.refresh(),B(t,"showPicker",this,3)(arguments)}},{key:"syncInputFieldValue",value:function(){var e,n=this,r=n.value,i=null===(e=n.picker)||void 0===e?void 0:e.getColorClassName(r);i||(n.colorBox.style.color=r),i="b-colorbox "+i,n.colorBox.className=i,n.showBoxForNoColor||n.element.classList.toggle("b-colorless",!r);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];B(t,"syncInputFieldValue",this,3)(o)}},{key:"innerElements",get:function(){return[{reference:"colorBox",className:"b-colorbox"}].concat(z(B(t,"innerElements",this,1)))}}])}(dv);S(yk,"$name","ColorField"),S(yk,"type","colorfield"),S(yk,"configurable",{displayField:"text",valueField:"color",editable:!1,picker:{type:"colorpicker",align:{align:"t100-b100",matchSize:!1}},showBoxForNoColor:!0,colors:null,addNoColorItem:!0}),yk.initClass(),yk._$name="ColorField";var kk=["ok","cancel","yes","no"].reduce((function(e,t,n,r){return e[t]=Object.freeze(F(F({},Object.fromEntries(r.map((function(e){return[e,!1]})))),{},S({name:t,approve:"ok,yes".includes(t)},t,!0))),e}),Object.create(null)),bk=["b-raised","b-blue"],Ck=["b-gray"],wk=ne.isWindows,Dk=/(?:\s+,?|,)\s*/,Sk=/^(icon|menu|text)$/,xk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buttons",get:function(){return this.items.filter((function(e){return e.isButton}))}},{key:"cancelButton",get:function(){return this.widgetMap.cancel||null}},{key:"noButton",get:function(){return this.widgetMap.no||null}},{key:"okButton",get:function(){return this.widgetMap.ok||null}},{key:"yesButton",get:function(){return this.widgetMap.yes||null}},{key:"changeItems",value:function(e,n){return"string"==typeof e&&(e=Object.fromEntries(e.split(Dk).map((function(e){return[e,!0]})))),B(t,"changeItems",this,3)([e,n])}},{key:"clickButton",value:function(e,t){var n,r,i,a=this.widgetMap,o=this.defaultButton,l=t?a.cancel||a.no:a[o];if(!l)for(var s=0,u=Object.entries(a);s<u.length;s++){var c=_(u[s],2);if(i=c[0],r=c[1],i!==o){l=r;break}}null===(n=l)||void 0===n||n.onInternalClick(e)}},{key:"doCancel",value:function(e){this.clickButton(e,!0)}},{key:"doDefault",value:function(e){this.clickButton(e)}},{key:"onButtonClick",value:function(e){this.trigger("choice",F(F({},e),{},{choice:kk[e.source.ref],source:this,userAction:!0}))}},{key:"onChildAdd",value:function(e){B(t,"onChildAdd",this,3)([e]),Tt.before(e,"onConfigChange","onChildConfigChange",this),this.syncButtons()}},{key:"onChildConfigChange",value:function(e){var t=e.name;Sk.test(t)&&this.syncButtons()}},{key:"onChildRemove",value:function(e){B(t,"onChildRemove",this,3)([e]),this.syncButtons()}},{key:"onInternalPaint",value:function(e){B(t,"onInternalPaint",this,3)([e]),e.firstPaint&&this.syncButtons.resume(),this.syncButtons.now()}},{key:"syncButtons",value:function(){var e,t,n=this,r=n.isDestroying?[]:n.buttons,i=n.defaultButton;!1!==n.syncWidthButtons&&r.forEach((function(n){(t=n.text)&&(e=Math.max(e||0,t.length+Boolean(n.icon)+Boolean(n.menu)))})),r.forEach((function(t){var n=t.element.classList,r=t.ref===i;n.add.apply(n,z(r?bk:Ck)),n.remove.apply(n,z(r?Ck:bk)),n.toggle("b-default-button",r),t.minWidth=e&&t.text?"".concat(e,"em"):null}))}},{key:"updateAutoWidthButtons",value:function(){this.syncButtons()}},{key:"updateDefaultButton",value:function(){this.syncButtons()}}])}(Zu);S(xk,"$name","ConfirmationBar"),S(xk,"type","confirmationbar"),S(xk,"configurable",{defaultButton:"ok",defaultType:"button",items:"ok,cancel",keyMap:{Enter:"doDefault",NumpadEnter:"doDefault",Escape:"doCancel"},namedItems:{yes:{cls:"b-yes-button",text:"L{Object.Yes}",onClick:"up.onButtonClick",weight:wk?100:130},no:{cls:"b-no-button",text:"L{Object.No}",onClick:"up.onButtonClick",weight:wk?110:120},ok:{cls:"b-ok-button",text:"L{Object.Ok}",onClick:"up.onButtonClick",weight:wk?120:110},cancel:{cls:"b-cancel-button",text:"L{Object.Cancel}",onClick:"up.onButtonClick",weight:wk?130:100}},syncWidthButtons:null}),S(xk,"delayable",{syncButtons:{type:"raf",suspended:!0}}),xk.initClass(),xk._$name="ConfirmationBar";var Ek=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([F({month:(new Date).getMonth()},e)]),fr.on({element:this.contentElement,click:"onMonthClick",delegate:".b-monthpicker-month",thisObj:this})}},{key:"focusElement",get:function(){return this.getMonthButton(this.month)}},{key:"getMonthButton",value:function(e){return this.contentElement.querySelector('.b-monthpicker-month[data-month="'.concat(e,'"]'))}},{key:"onMonthClick",value:function(e){var t=e.target,n=parseInt(t.getAttribute("data-month"));this.month===n?this.trigger("select",{oldValue:n,value:n}):this.month=n}},{key:"handleTitleClick",value:function(e){this.trigger("titleClick",e)}},{key:"changeMonth",value:function(e){if(!isNaN(e))return Be.isDate(e)?e.getMonth():e>=0&&e<=11?e:i}},{key:"updateMonth",value:function(e,t){this.isConfiguring||this.trigger("select",{oldValue:t,value:e})}},{key:"composeBody",value:function(){this.getConfig("month");var e=B(t,"composeBody",this,3)([]),n=e.children[this.tbar?1:0].children=[];this.widgetMap.title.text=Pl.getMonthName(this.month);for(var r=0;r<=11;r++)n.push({tag:"button",dataset:{month:r},class:{"b-monthpicker-month":1,"b-selected":r===this.month},text:Pl.getMonthShortName(r)});return e}},{key:"updateLocalization",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConfiguring){e.next=3;break}return e.next=3,this.recompose();case 3:B(t,"updateLocalization",this,3)([]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]);var n}(uc);S(Ek,"$name","MonthPicker"),S(Ek,"type","monthpicker"),S(Ek,"configurable",{textContent:!1,tbar:{overflow:null,items:{title:{type:"button",cls:"b-monthpicker-title",onAction:"up.handleTitleClick"}}},itemCls:"b-month-container",month:null}),Ek.initClass(),Ek._$name="MonthPicker";var Rk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([F({year:(new Date).getFullYear()},e)]),fr.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}},{key:"focusElement",get:function(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}},{key:"getYearButton",value:function(e){return this.contentElement.querySelector('.b-yearpicker-year[data-year="'.concat(e,'"]'))}},{key:"value",get:function(){return this.year},set:function(e){this.year=e}},{key:"onYearClick",value:function(e){var t=e.target,n=Math.min(Math.max(parseInt(t.innerText),this.minYear||1),this.maxYear||9999);this.year===n?this.trigger("select",{oldValue:n,value:n}):this.year=n}},{key:"handleTitleClick",value:function(e){this.trigger("titleClick",e)}},{key:"previous",value:function(){this.startYear=this.startYear-this.yearButtonCount}},{key:"next",value:function(){this.startYear=this.endYear+1}},{key:"ingestYear",value:function(e){if(!isNaN(e))return Be.isDate(e)?e.getFullYear():e}},{key:"changeYear",value:function(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}},{key:"updateYear",value:function(e,t){var n=this;!n.startYear||e>n.endYear?n.startYear=e:e<n.startYear&&(n.startYear=e-(n.yearButtonCount-1)),n.isConfiguring||n.trigger("select",{oldValue:t,value:e})}},{key:"endYear",get:function(){return this.startYear+this.yearButtonCount-1}},{key:"changeStartYear",value:function(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}},{key:"updateStartYear",value:(n=f(L().mark((function e(t,n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isVisible&&li.slideIn(this.contentElement,Math.sign(t-n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"composeBody",value:function(){this.getConfig("year");var e=this.startYear,n=B(t,"composeBody",this,3)([]),r=n.children[this.tbar?1:0].children=[];this.widgetMap.title.text="".concat("000".concat(e).slice(-4)," - ").concat("000".concat(this.endYear).slice(-4));for(var i=0,a=e;i<this.yearButtonCount;i++,a++)r.push({tag:"button",dataset:{year:a},class:{"b-yearpicker-year":1,"b-selected":a===this.year},text:"000".concat(a).slice(-4)});return n}}]);var n}(uc);S(Rk,"$name","YearPicker"),S(Rk,"type","yearpicker"),S(Rk,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),Rk.initClass(),Rk._$name="YearPicker";var Tk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"focusElement",get:function(){}},{key:"changeReadOnly",value:function(){return!0}},{key:"changeEditable",value:function(){return!1}},{key:"inputElement",get:function(){return{tag:"span",id:"".concat(this.id,"-input"),reference:"displayElement",html:this.template?this.template(this.value):Le.encodeHtml(this.value)}}}],[{key:"configurable",get:function(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}}])}(iv);S(Tk,"$name","DisplayField"),S(Tk,"type","displayfield"),S(Tk,"alias","display"),Tk.initClass(),Tk._$name="DisplayField";var Mk=function(e,t){return e.valueOf()-t.valueOf()},Fk=Pl.DateSet,Ak=Object.freeze([]),Ik=function(e){return e.every((function(t,n){return!(n&&Pl.add(e[n-1],1,"d")-t)}))},Lk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)([e]);var r=n.widgetMap;n.externalCellRenderer=n.cellRenderer,n.cellRenderer=n.internalCellRenderer,n.element.removeAttribute("tabindex"),n.ariaElement.setAttribute("aria-activedescendant","".concat(n.id,"-active-day")),r.fields&&!n.ariaLabel&&n.element.setAttribute("aria-labelledby",r.fields.id),fr.on({element:n.weeksElement,click:{handler:"onCellClick",delegate:".".concat(n.dayCellCls,":not(.").concat(n.disabledCls,"):not(.").concat(n.outOfRangeCls,")")},mousedown:{handler:"onCellMousedown",delegate:".".concat(n.dayCellCls)},thisObj:n}),n.getConfig("editMonth"),n.getConfig("includeYear"),n.refresh.flush()}},{key:"labelledElement",get:function(){return this.element}},{key:"afterHide",value:function(){var e,n;null===(e=this._monthPicker)||void 0===e||e.hide(),null===(n=this._yearPicker)||void 0===n||n.hide(),B(t,"afterHide",this,3)(arguments)}},{key:"doDestroy",value:function(){var e,n;null===(e=this.yearButton)||void 0===e||e.destroy(),null===(n=this.monthButton)||void 0===n||n.destroy(),B(t,"doDestroy",this,3)([])}},{key:"activeDayCell",get:function(){return this.weeksElement.querySelector("#".concat(this.id,"-active-day"))}},{key:"focusElement",get:function(){return!this.disabled&&this.activeDayCell||this.element}},{key:"onMonthDateChange",value:function(e){var n=B(t,"onMonthDateChange",this,3)([e]);return this.ariaElement.setAttribute("aria-label",Pl.format(this.date,"MMMM YYYY")),this.refresh.flush(),n}},{key:"updateEditMonth",value:function(e){var t=this.widgetMap,n=t.monthButton,r=t.yearButton,i=!1===e;n&&(n.readOnly=i),r&&(r.disabled=i)}},{key:"updateIncludeYear",value:function(e){var t=this.widgetMap.yearButton;t&&(t.hidden=!1===e)}},{key:"updateReadOnly",value:function(e){e?this.element.setAttribute("inert",!0):this.element.removeAttribute("inert")}},{key:"doRefresh",value:function(){var e=this,n=e.date,r=e.widgetMap,i=e.activeDayCell,a=Pl.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=n;e.getConfig("tbar");for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];B(t,"doRefresh",this,3)(l),r.monthButton&&(r.monthButton.text=e.constructor._monthNames[n.getMonth()]),r.yearButton&&(r.yearButton.text=n.getFullYear());var u=Pl.parseKey(null==i?void 0:i.dataset.date);a-u&&e.syncActiveDate(a,u)}},{key:"internalCellRenderer",value:function(e){var t=e.cell,n=e.date,r=this,i=r.externalCellRenderer,a=r.isSelectedDate(n),o=r.getCellClassList.apply(r,arguments);if(a&&r.multiSelect){var l=!r.isSelectedDate(Pl.add(n,-1,"d")),s=!r.isSelectedDate(Pl.add(n,1,"d"));o["b-range-start"]=l,o["b-range-end"]=s,o["b-in-range"]=!l&&!s}li.updateClassList(t,o),t.innerHTML='<div class="b-datepicker-cell-inner">'.concat(n.getDate(),"</div>"),t.setAttribute("role","gridcell"),t.setAttribute("aria-label",Pl.format(n,"dddd MMMM Do, YYYY")),li.toggleAttribute(t,"aria-selected",a),r.isActiveDate(n)?t.id="".concat(r.id,"-active-day"):t.removeAttribute("id"),i&&(arguments[0].cell=t.firstChild,r.callback(i,this,arguments))}},{key:"getCellClassList",value:function(e){var t=e.date,n=this,r=n.activeCls,i=n.selectedCls;return S(S(S({},r,r&&n.isActiveDate(t)),i,n.isSelectedDate(t)),n.outOfRangeCls,n.minDate&&t<n.minDate||n.maxDate&&t>n.maxDate)}},{key:"onCellMousedown",value:function(e){var t=e.target.closest("[data-date]");this.focusable?(t.focus(),li.getActiveElement(t)===t&&e.preventDefault()):e.preventDefault(),this.activeDate=Pl.parseKey(t.dataset.date)}},{key:"onCellClick",value:function(e){var t=e.target.closest("[data-date]");this.onUIDateSelect(Pl.parseKey(t.dataset.date),e)}},{key:"onUIDateSelect",value:function(e,t){var n=this,r=n.lastClickedDate,i=n.multiSelect;n.isDisabledDate(e)||!1!==n.trigger("beforeDateSelect",{date:e,event:t})&&(n.lastClickedDate=e,n.activatingEvent=t,i?n.handleMultiSelect(r,e,t):(n.date=n.selection=e,n.floating&&n.hide()),n.activatingEvent=null)}},{key:"handleMultiSelect",value:function(e,t,n){var r=this,i=r.multiSelect,a=r._selection||(r._selection=new Fk),o=a.dates,l="range"===i||"simple"===i,s="simple"===i||li.isTouchEvent,u=a.size,c=a.generation,d=u&&S(S(S(S({},Pl.makeKey(Pl.add(o[0],-1,"d")),1),Pl.makeKey(o[0]),1),Pl.makeKey(o[o.length-1]),1),Pl.makeKey(Pl.add(o[o.length-1],1,"d")),1),h=a.has(t)?"delete":"add",f=l&&(null==d?void 0:d[Pl.makeKey(t)]);if(s&&u>1)a.clear(),a.add(t);else if(n.ctrlKey)!0!==i&&u&&!f||(a[h](t),l&&!a.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<o[1]?1:-1)));else if((s||n.shiftKey)&&u){var v=_([new Date(l?r.rangeStartDate||(r.rangeStartDate=o[0]):e),t].sort(Mk),2),g=v[0],m=v[1];l&&a.clear();for(var p=g;p<=m;p.setDate(p.getDate()+1))a.add(p)}else a.has(t)&&1===a.size||(a.clear(),a.add(t));var y=a.size;1===y?r.rangeStartDate=t:y||(r.rangeStartDate=null),a.generation!==c&&r.updateSelection(a)}},{key:"updateHighlightSelectedWeek",value:function(e){this.element.classList.toggle("b-highlight-selected-week",Boolean(e))}},{key:"updateMultiSelect",value:function(e){this.element.classList.toggle("b-multiselect",Boolean(e)),e||(this.selection=z(this.selection)[0])}},{key:"selection",get:function(){var e=this._selection,t=e?e.dates:Ak;return"range"===this.multiSelect&&t.length?[t[0],t[t.length-1]]:t}},{key:"getRange",value:function(e){if(this.multiSelect){var t=this.selection,n=t[0],r=t[t.length-1];if(t.length>1&&Pl.add(r,1,"d").getDate()===n.getDate())return{unit:"month",magnitude:Pl.diff(n,Pl.add(r,1,"d"),"month"),wholeMonth:1===n.getDate()&&r.getDate()===Pl.getLastDateOfMonth(r).getDate()&&Ik(t),startDate:n,endDate:r};if(n.getDay()==Pl.weekStartDay&&r.getDay()===(Pl.weekStartDay+6)%7)return{unit:"week",magnitude:Pl.diff(n,Pl.add(r,1,"d"),"week"),startDate:n,endDate:r};if(e){var i=Math.max(Math.ceil(Pl.diff(n,Pl.add(r,1,"d"),"w")),1),a=(n.getDay()-Pl.weekStartDay+7)%7,o=Pl.add(n,-a,"d");return{unit:"week",magnitude:i,startDate:o,endDate:Pl.add(o,7*i-1,"d")}}return{unit:"day",magnitude:Pl.diff(n,r,"d")+1,startDate:n,endDate:r}}}},{key:"snappedRange",get:function(){}},{key:"changeSelection",value:function(e,t){var n,r,i=this;if(e)if(e.isDateSet){if(t===e||null!=t&&t.equals(e))return t;r=Be.first(e),n=e}else if(e.forEach||(e=[e]),e.forEach((function(t,n){return e[n]=i.changeDate(t)})),r=e[0],e.sort(Mk),"range"===i.multiSelect&&2===e.length){n=new Fk;for(var a=new Date(e[0]);a<=e[1];a.setDate(a.getDate()+1))n.add(a)}else r=e[0],n=new Fk(e);else n=new Fk;return r&&(i.rangeStartDate=Pl.clearTime(r)),n}},{key:"updateSelection",value:function(e,t){var n=this,r=n.multiSelect,i=e.dates,a="range"===r?[i[0],i[i.length-1]]:i;if(!n.isConfiguring){r||!i.length||n.peekConfig("date")||i[0].getMonth()!==n.month.month||(n.date=i[0]),n.refresh.now();var o={selection:a,userAction:Boolean(n.activatingEvent)};if(t){var l=t.dates;o.oldSelection="range"===r?[l[0],l[l.length-1]]:l}n.trigger("selectionChange",o)}}},{key:"isSelected",value:function(e){return this.selection.some((function(t){return Pl.isSameDate(t,e)}))}},{key:"onInternalKeyDown",value:function(e){var t=this,n=e.key.trim()||e.code,r=t.activeDate,i=new Date(r);if("Escape"===n){if(t.monthPicker.isVisible)return t.monthPicker.hide();if(t.yearPicker.isVisible)return t.yearPicker.hide();if(t.floating)return t.hide()}if(r&&t.weeksElement.contains(e.target)){do{switch(n){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i=t.gotoPrevMonth():i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i=t.gotoNextMonth():i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}},{key:"changeMinDate",value:function(e){return e&&Gy.prototype.changeDate.apply(this,arguments)}},{key:"updateMinDate",value:function(e){this._yearPicker&&(this._yearPicker.minYear=null==e?void 0:e.getFullYear()),this.refresh()}},{key:"changeMaxDate",value:function(e){return e&&Gy.prototype.changeDate.apply(this,arguments)}},{key:"updateMaxDate",value:function(e){this._yearPicker&&(this._yearPicker.maxYear=null==e?void 0:e.getFullYear()),this.refresh()}},{key:"changeDate",value:function(e){return Pl.clamp(B(t,"changeDate",this,3)([e]),this.minDate,this.maxDate)}},{key:"updateDate",value:function(e,n){var r=this,i=r.month;if(r.isConfiguring&&!r.initializingActiveDate&&("selection"in r.initialConfig||(r.selection=e),"activeDate"in r.initialConfig||(r.activeDate=e)),!i.date||e.getMonth()===i.month||!r.getCell(e)||r.alwaysRefreshOnMonthChange||r.isNavigating)B(t,"updateDate",this,3)([e]);else{var a=i.getOtherMonth(e),o=r.eventListeners&&(n?e.getDate()!==n.getDate()|(a.getWeekId(e)!==i.getWeekId(n))<<1|(e.getMonth()!==(null==n?void 0:n.getMonth()))<<2|(e.getFullYear()!==(null==n?void 0:n.getFullYear()))<<3:15);r.trigger("dateChange",{changes:{d:!0,w:Boolean(2&o),m:Boolean(12&o),y:Boolean(8&o),r:a.weekCount!==i.weekCount},value:e,oldValue:n})}}},{key:"changeActiveDate",value:function(e,t){var n=this;if("today"===e&&(e=new Date),!1!==n.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})){if(e=e?n.changeDate(e):n.date||(n.date=Pl.clearTime(new Date)),isNaN(e))throw new Error("DatePicker activeDate must be passed a Date, or a YYYY-MM-DD date string");return Pl.clamp(e,n.minDate,n.maxDate)}}},{key:"updateActiveDate",value:function(e,t){var n=this,r=n.isConfiguring;!r&&n.getCell(e)||(n.initializingActiveDate=r,n.date=e,n.initializingActiveDate=!1),r||n.refresh.isPending||n.syncActiveDate(e,t)}},{key:"syncActiveDate",value:function(e,t){var n=this,r=n.activeCls,i=n.getCell(e),a=t&&n.getCell(t),o=li.getActiveElement(n.element);i&&(n.focusable&&i.setAttribute("tabIndex","0"),r&&i.classList.add(r),i.id="".concat(n.id,"-active-day"),n.weeksElement.contains(o)&&i.focus()),a&&a!==i&&(n.focusable&&a.removeAttribute("tabIndex"),r&&a.classList.remove(r),a.removeAttribute("id"))}},{key:"value",get:function(){var e=this.selection,t=(null==e?void 0:e.length)||null;return t&&e[t-1]},set:function(e){var t=this,n=t.selection,r=t.duration;if(t.isNavigating=!0,e){if(e=t.changeDate(e,t.value),"range"===t.multiSelect&&2===(null==n?void 0:n.length))return Pl.betweenLesserEqual.apply(Pl,[e].concat(z(n)))||(e<n[0]?t.selection=[e,Pl.add(e,r-1,"d")]:t.selection=[Pl.add(e,-(r-1),"d"),e]),void(t.date=t.activeDate=e);e!==i&&(t.selection=e,t.date=t.activeDate=e)}else t.date=t.activeDate=new Date,t.selection=null;t.isNavigating=!1}},{key:"duration",get:function(){return"range"===this.multiSelect?Pl.diff.apply(Pl,z(this.selection).concat(["d"]))+1:1}},{key:"gotoPrevYear",value:function(){return this.goto(-1,"year")}},{key:"gotoPrevMonth",value:function(){return this.goto(-1,"month")}},{key:"gotoNextMonth",value:function(){return this.goto(1,"month")}},{key:"gotoNextYear",value:function(){return this.goto(1,"year")}},{key:"goto",value:function(e,t){var n,r=this,i=r.activeDate,a=i&&r.getCell(i);return n="month"===t&&a&&(null==i?void 0:i.getMonth())===r.month.month+e?i:Pl.add(a?i:r.date,e,t),r.gotoDate(n,e,a)}},{key:"gotoDate",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.activeDate&&this.getCell(this.activeDate),r=this,a=new Date(e);a.setDate(1);var o=Pl.add(Pl.add(a,1,"month"),-1,"day");if(!(r.minDate&&t<0&&o<r.minDate||r.maxDate&&t>0&&a>r.maxDate)){r.isNavigating=!0;var l=r.date=e;return r.widgetMap.monthButton.text=r.constructor._monthNames[e.getMonth()],n&&(r.activeDate=e),r.isNavigating=!1,l}}},{key:"isActiveDate",value:function(e){return!(e-this.activeDate)}},{key:"isSelectedDate",value:function(e){var t;return null===(t=this._selection)||void 0===t?void 0:t.has(e)}},{key:"onFocusIn",value:function(e){var n;(B(t,"onFocusIn",this,3)([e]),e.toWidget!==this||e._target!==this.element||this.disabled)||(null===(n=this.focusElement)||void 0===n||n.focus())}},{key:"onMonthPickerRequested",value:function(){var e=this.monthPicker;e.isVisible?e.hide():(e.month=this.activeDate.getMonth(),e.show(),e.focus())}},{key:"onYearPickerRequested",value:function(){var e=this.yearPicker;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}},{key:"onMonthPickerTitleClick",value:function(){this.monthPicker.hide()}},{key:"onYearPickerTitleClick",value:function(){this.yearPicker.hide()}},{key:"onMonthPicked",value:function(e){var t,n=e.value,r=e.source,i=this;i.gotoDate(Pl.add(i.activeDate,n-i.activeDate.getMonth(),"month")),i.widgetMap.monthButton.text=i.constructor._monthNames[i.activeDate.getMonth()],null===(t=i.focusElement)||void 0===t||t.focus({preventScroll:!0}),r.hide()}},{key:"onYearPicked",value:function(e){var t,n=e.value,r=e.source,i=new Date(this.activeDate);i.setFullYear(n),this.activeDate=i,null===(t=this.focusElement)||void 0===t||t.focus({preventScroll:!0}),r.hide()}},{key:"changeMonthPicker",value:function(e,t){return Ek.reconfigure(t,e?Ek.mergeConfigs({owner:this,appendTo:this.element},e):null,this)}},{key:"changeYearPicker",value:function(e,t){var n,r;return Rk.reconfigure(t,e?Rk.mergeConfigs({owner:this,appendTo:this.element,minYear:null===(n=this.minDate)||void 0===n?void 0:n.getFullYear(),maxYear:null===(r=this.maxDate)||void 0===r?void 0:r.getFullYear()},e):null,this)}},{key:"childItems",get:function(){var e=this._yearPicker,n=this._monthPicker,r=B(t,"childItems",this,1);return e&&r.push(e),n&&r.push(n),r}},{key:"updateLocalization",value:function(){var e,n=this,r=n.widgetMap.monthButton,i=n.constructor._monthNames=Pl.getMonthNames();r&&!n.isConfiguring&&(r.text=i[null!==(e=n.monthPicker.month)&&void 0!==e?e:n.date.getMonth()]);B(t,"updateLocalization",this,3)([])}},{key:"changeMultiSelect",value:function(e){return"range"===e&&ne.isTouchDevice&&(e="simple"),e}}],[{key:"delayable",get:function(){return{refresh:"raf"}}},{key:"configurable",get:function(){return{activeDate:{$config:"date",value:"today"},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first b-datepicker-nav-button",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}",weight:100},prevMonth:{cls:"b-icon b-icon-previous b-datepicker-nav-button",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}",weight:200},fields:{type:"container",cls:"b-datepicker-title",items:{monthButton:{type:"button",cls:"b-datepicker-monthbutton",internalListeners:{click:"up.onMonthPickerRequested"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}},weight:300},nextMonth:{cls:"b-icon b-icon-next b-datepicker-nav-button",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}",weight:400},nextYear:{cls:"b-icon b-icon-last b-datepicker-nav-button",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}",weight:500}}},monthPicker:{value:{type:"MonthPicker",trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onMonthPickerTitleClick",select:"up.onMonthPicked",Escape:"up.onMonthPickerTitleClick"}},$config:"lazy"},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{$config:"date",value:null},maxDate:{$config:"date",value:null},focusDisabledDates:null,multiSelect:null,selection:{$config:{equal:function(e,t){return e&&e.equals(t)}},value:null},editMonth:{$config:"lazy",value:null},includeYear:{$config:"lazy",value:null},dayNameFormat:"dd",trapFocus:!0,ariaElement:"weeksElement",focusDescendant:!0,alwaysRefreshOnMonthChange:null,highlightSelectedWeek:null}}},{key:"prototypeProperties",get:function(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}}])}(Gy);S(Lk,"$name","DatePicker"),S(Lk,"type","datepicker"),S(Lk,"_monthNames",Pl.getMonthNames()),Lk.initClass(),Lk._$name="DatePicker";var Ok=new Date,Pk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changePicker",value:function(e,t){var n;if(null!=e&&e.isDatePicker)return e;var r=this,i=Lk.mergeConfigs({owner:r,forElement:r.pickerAlignElement,minDate:r.min,maxDate:r.max,weekStartDay:r._weekStartDay,align:{anchor:r.overlayAnchor,target:r.pickerAlignElement},internalListeners:{selectionChange:"onPickerSelectionChange",thisObj:r}},e);r.calendarContainerCls&&(i.cls=r.calendarContainerCls),r.value?i[r.isValid?"value":"activeDate"]=r.value:i.activeDate||(i.activeDate=new Date);var a=Lk.reconfigure(t,e?i:null,r);return null==a||null===(n=a.refresh)||void 0===n||n.flush(),a}},{key:"onPickerSelectionChange",value:function(e){var t=e.selection,n=e.source;if(n.isVisible){var r=this,i=t.length?r.value?Pl.copyTimeValues(new Date(t[0]),r.value):new Date(t[0]):null;r._isUserAction=r._isPickerInput=!0,r.value=i,r._isPickerInput=r._isUserAction=!1,n.hide()}}},{key:"getStepDate",value:function(e){var t=this.step;return Pl.add(this.value,(e||1)*t.magnitude,t.unit)}},{key:"stepDate",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this;if(!n.readOnly&&n.value){var r=n.getStepDate(e);n.checkMinMax(r)||(t?(n._isUserAction=!0,n.value=r,n.autoSelect&&n.select(),n._isUserAction=!1):n.value=r)}}},{key:"onBackClick",value:function(){this.stepDate(-1)}},{key:"onForwardClick",value:function(){this.stepDate(1)}},{key:"showPicker",value:function(e){if(!this.readOnly){var n=this,r=n._picker;if(r){var i={minDate:n.min,maxDate:n.max};n.value?i[n.isValid?"value":"activeDate"]=n.value:r.activeDate||(i.activeDate=new Date),r.setConfig(i)}B(t,"showPicker",this,3)([e])}}},{key:"focusPicker",value:function(){var e;null===(e=this.picker)||void 0===e||e.focus()}},{key:"checkMinMax",value:function(e){var t=this.min,n=this.max;return t&&e<t?-1:n&&e>n?1:0}},{key:"isValid",get:function(){var e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);var n=e.value;if(n){var r=e.min,i=e.max;if(e.validateDateOnly&&(n=Pl.clearTime(n,!1),r&&(r=Pl.clearTime(r,!1)),i&&(i=Pl.clearTime(i,!1))),r&&n<r)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(i&&n>i)return e.setError("L{Field.maximumValueViolation}",!0),!1}return B(t,"isValid",this,1)}},{key:"transformDateValue",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this;return null!=e&&(Pl.isDate(e)||(e="string"==typeof e?Pl.parse(e,n.format,n.strictParsing)||Pl.parse(e,n.fallbackFormat,n.strictParsing):new Date(e)),Pl.isValidDate(e))?t&&(!n.min||e-n.min>-Pl.MS_PER_DAY)&&(!n.max||e<=n.max)?n.transformTimeValue(e):e:null}},{key:"isTimeValue",value:function(e){return e&&!0!==e&&"entered"!==e}},{key:"transformTimeValue",value:function(e){var t=this,n=t.keepTime;if(e=Pl.clone(e),n)if(t.isTimeValue(n)){var r=Pl.parse(n,t.timeFormat);Pl.copyTimeValues(e,r)}else!0===n&&(t._isPickerInput||t.inputting)&&Pl.isValidDate(t.value)&&Pl.copyTimeValues(e,t.value);else Pl.clearTime(e,!1);return e}},{key:"changeMin",value:function(e){return this.transformDateValue(e,!1)}},{key:"updateMin",value:function(e){var t=this.input,n=this._picker;t&&(null==e?t.removeAttribute("min"):t.min=e),n&&(n.minDate=e),this.syncInvalid()}},{key:"changeMax",value:function(e){return this.transformDateValue(e,!1)}},{key:"updateMax",value:function(e){var t=this.input,n=this._picker;t&&(null==e?t.removeAttribute("max"):t.max=e),n&&(n.maxDate=e),this.syncInvalid()}},{key:"weekStartDay",get:function(){return"number"==typeof this._weekStartDay?this._weekStartDay:Pl.weekStartDay}},{key:"updateWeekStartDay",value:function(e){this._picker&&(this._picker.weekStartDay=e)}},{key:"changeValue",value:function(e,n){var r=this,i=r.transformDateValue(e),a=r.L("L{invalidDate}")(Pl.format(Ok,r.format));if(!e||i){if(r.clearError(a),r.hasChanged(n,i))return B(t,"changeValue",this,3)([i,n]);r.inputting||r.syncInputFieldValue()}else r.inputting&&!r.validateOnInput||r.setError(a)}},{key:"updateValue",value:function(e,n){var r=this._picker;r&&(r.value=e,this.inputting||(r.activeDate=e)),B(t,"updateValue",this,3)([e,n])}},{key:"changeStep",value:function(e,t){var n=W(e);return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===n&&(e=Pl.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}},{key:"updateStep",value:function(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}},{key:"hasChanged",value:function(e,n){return null!=e&&e.getTime&&null!=n&&n.getTime&&(!this.keepTime||this.isTimeValue(this.keepTime))?!Pl.isEqual(Pl.clearTime(e),Pl.clearTime(n)):B(t,"hasChanged",this,3)([e&&e.getTime(),n&&n.getTime()])}},{key:"inputValue",get:function(){var e=this.value;return e?Pl.format(e,this.format):""}},{key:"updateFormat",value:function(){this.isConfiguring||this.syncInputFieldValue(!0)}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this.syncInputFieldValue(!0)}},{key:"internalOnKeyEvent",value:function(e){var n;if(B(t,"internalOnKeyEvent",this,3)([e]),"keydown"===e.type){var r,i=this;switch(e.virtualKey){case"Enter":i.isValid&&(null===(n=i.picker)||void 0===n||n.hide());break;case"ArrowLeft":(i.caretAtStart||i.selectedAll)&&(r=-1);break;case"ArrowRight":(i.caretAtEnd||i.selectedAll)&&(r=1);break;case"NumpadAdd":r=1;break;case"NumpadSubtract":r=-1}r&&i.step&&(i.stepDate(r),i.selectAll(),e.preventDefault())}}}])}(ov);S(Pk,"$name","DateField"),S(Pk,"type","datefield"),S(Pk,"alias","date"),S(Pk,"configurable",{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger b-step-trigger-back",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger b-step-trigger-forward",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:{$config:null,default:!0},weekStartDay:null,picker:{type:"datepicker",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null,role:"combobox"}),Pk.initClass(),Pk._$name="DateField";var _k=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dateFieldDefaults",get:function(){return Be.merge({format:this.format},this._dateFieldDefaults)}},{key:"configureDateField",value:function(e,t,n){var r=this,i=r.dateStepTriggers;return Pk.reconfigure(t,e,{owner:r,defaults:Be.assign({stepTriggers:!0===i||"both"===i||i===n},r.dateFieldDefaults)})}},{key:"changeFieldEndDate",value:function(e,t){return this.configureDateField(e,t,"end")}},{key:"updateFieldEndDate",value:function(e){var t;e&&(null===(t=this.dateFieldContainer)||void 0===t||t.add(e))}},{key:"changeFieldStartDate",value:function(e,t){return this.configureDateField(e,t,"start")}},{key:"updateFieldStartDate",value:function(e){var t;e&&(null===(t=this.dateFieldContainer)||void 0===t||t.add(e))}},{key:"updateFormat",value:function(e){this.isConstructing||(this.fieldEndDate.format=e,this.fieldStartDate.format=e)}},{key:"updatePickingStartDate",value:function(e){this.element.classList.toggle("b-picking-start-date",Boolean(e))}},{key:"updateValue",value:function(e,n){var r;null===(r=B(t,"updateValue",this,3))||void 0===r||r([e,n]),this.syncValue("value",e)}},{key:"stepDown",value:function(e){this.adjustByKey(e,this.stepSmall)}},{key:"stepUp",value:function(e){this.adjustByKey(e,"-"+this.stepSmall)}},{key:"stepDownLarge",value:function(e){this.adjustByKey(e,this.stepLarge)}},{key:"stepUpLarge",value:function(e){this.adjustByKey(e,"-"+this.stepLarge)}},{key:"adjustByKey",value:function(e,t){var n,r,i=this,a=i._isUserAction,o=e.target,l=[i.fieldStartDate,i.fieldEndDate],s=((o===l[0].input?1:o===l[1].input&&2)||0)-1,u=l[s],c=[l[0].value,l[1].value],d=null==c[0]||null==c[1];c[s]=Pl.add(null!==(n=c[s])&&void 0!==n?n:i.defaultDate(s,c),t),c[1-s]=null!==(r=c[1-s])&&void 0!==r?r:c[s],c[1]<c[0]&&(c[1-s]=c[s]),i.checkValid(c)&&(i._isUserAction=!0,d?i.value=c:(l[0].value=c[0],l[1].value=c[1]),i._isUserAction=a),u.selectAll(),e.preventDefault()}},{key:"checkMinMax",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:this.value,n=this.maxDate,r=this.minDate,a=this.validateDateOnly,o=0;if(t&&(r||n)){var l,s=D(Array.isArray(t)?t:[t]);try{for(s.s();!(l=s.n()).done&&(e=l.value,e=a?Pl.clearTime(e):e,!(o=r&&e<r?-1:n&&e>n?1:0)););}catch(e){s.e(e)}finally{s.f()}}return o}},{key:"checkValid",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.value;return!this.checkMinMax(e)}},{key:"defaultDate",value:function(e,t){var n=this.minDate,r=this.maxDate,i=Pl.clearTime(new Date);return i<n||i>r?n:i}},{key:"hasChanged",value:function(e,t){return!Be.isEqual(e,t)}},{key:"onDateFieldChange",value:function(e){var t=e.source,n=e.userAction,r=this,i=r.fieldEndDate,a=r.fieldStartDate,o=r._isUserAction;r._isUserAction=n||o,r.syncValue(t.ref,[a.value,i.value]),r._isUserAction=o}},{key:"onStartDateFocusIn",value:function(){this.pickingStartDate=!0}},{key:"onStartDateFocusOut",value:function(e){this.pickingStartDate=!1}},{key:"syncValue",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.value,n=this;"fieldEndDate"!==e&&(n.fieldEndDate.value=t&&t[1]),"fieldStartDate"!==e&&(n.fieldStartDate.value=t&&t[0]),"value"!==e&&(n.value=t),!n.isConstructing&&n.hasChanged(n._lastValue,t)&&n.checkValid(t)&&n.triggerChange(),n._lastValue=t}},{key:"widgetClass",get:function(){}}])}(e.mixin(Ap)),S(t,"configurable",{altFormats:["YYYY-MM-DD"],dateFieldDefaults:{type:"datefield",autoSelect:!0,picker:null,step:"1d",internalListeners:{change:"up.onDateFieldChange"},triggers:{expand:null,back:{align:"end",weight:101}}},fieldEndDate:{ref:"fieldEndDate",cls:"b-end-date",weight:40},fieldStartDate:{ref:"fieldStartDate",cls:"b-start-date",weight:30,internalListeners:{focusIn:"up.onStartDateFocusIn",focusOut:"up.onStartDateFocusOut"}},dateStepTriggers:null,format:"ddd, MMM D",keyMap:{ArrowDown:"stepDown",ArrowUp:"stepUp","Ctrl+ArrowDown":"stepDownLarge","Ctrl+ArrowUp":"stepUpLarge"},pickingStartDate:null,stepLarge:"1 month",stepSmall:"7 days",validateDateOnly:!0,value:{$config:{type:"date[]",formats:["format","altFormats"]}}}),S(t,"fenced",{syncValue:!0}),S(t,"prototypeProperties",{_lastValue:null}),t},Hk=Array.isArray,Bk=function(e){return 12*e.getFullYear()+e.getMonth()},Vk=/material/i,Nk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"datePickers",get:function(){return this.items.filter((function(e){return e.isDatePicker}))}},{key:"compose",value:function(){var e,t=this.navButtons,n=!0===t?Vk.test((null===(e=li.getThemeInfo())||void 0===e?void 0:e.name)||"")?"floating":"inline":t;return{class:S({"b-multidatepicker-nav-buttons":t},"b-multidatepicker-nav-".concat(n),t)}}},{key:"onInternalPaint",value:function(e){if(e.firstPaint){var n=this,r=n.date;r&&n.unanimated((function(){n.scrollPos=n.posFromIndex(n.indexFromDate(r))}))}B(t,"onInternalPaint",this,3)([e])}},{key:"applyDate",value:function(e,t,n){var r,i=this,a=null==t?void 0:t.containsFocus,o=i._isUserAction,l=i.selection,s=a?n:t;!l||a&&e>=l[1]?(s=n,l=[e,e]):a?l=[e,l[1]||e]:e<l[0]?(s=n,l=[e,l[1]||e]):l=[l[0]||e,e],null===(r=s)||void 0===r||r.focus(),i._isUserAction=!0,i.selection=l,i._isUserAction=o}},{key:"changeIncludeYear",value:function(e){return"number"==typeof e&&(e=[e]),Hk(e)?function(t){return e.includes(t.getMonth()+1)}:e}},{key:"configureDatePicker",value:function(e,t,n){var r=t.includeYear,i=Pl.add(t.baseDate,e,"month"),a={date:i,activeDate:null,includeYear:r(i),multiSelect:t.multiSelect,selection:t.selection,weekStartDay:t.weekStartDay};return n||(a=Lk.mergeConfigs(t.datePickerDefaults,a,{cellRenderer:t.cellRenderer,headerRenderer:t.headerRenderer,weekRenderer:t.weekRenderer})),a}},{key:"ensurePlan",value:function(e){return Pl.isDate(e)&&(e={date:e}),e.date&&delete(e=F(F({},e),{},{index:this.indexFromDate(e.date)})).date,e}},{key:"getCell",value:function(e){return"string"!=typeof e&&(e=Pl.makeKey(e)),this.element.querySelector('[data-date="'.concat(e,'"]:not(.b-other-month)'))}},{key:"indexFromDate",value:function(e){return e?Bk(e)-Bk(this.baseDate):e}},{key:"onDatePickerSelectionChange",value:function(e){var t=e.selection;if(e.userAction){var n=this,r=n._isUserAction;n._isUserAction=!0,n.syncSelection("picker",t),n._isUserAction=r}}},{key:"onNextMonthClick",value:function(){this.forward()}},{key:"onPrevMonthClick",value:function(){this.backward()}},{key:"onYearPickedMulti",value:function(e){var t=e.source,n=e.value,r=t.up("datepicker"),i=r.focusableElement;null==i||i.focus({preventScroll:!0}),t.hide(),n-=r.activeDate.getFullYear(),this.go(12*n)}},{key:"updateAtMax",value:function(e,n){var r=this.widgetMap,i=r.nextButton,a=r.prevButton;B(t,"updateAtMax",this,3)([e,n]),i&&(i.containsFocus&&(null==a||a.focus()),i.isTabbable=!e,i.hidden=e)}},{key:"updateAtMin",value:function(e,n){var r=this.widgetMap,i=r.nextButton,a=r.prevButton;B(t,"updateAtMin",this,3)([e,n]),a&&(a.containsFocus&&(null==i||i.focus()),a.isTabbable=!e,a.hidden=e)}},{key:"changeDate",value:function(e){return e&&Pl.clamp(e,this.minDate,this.maxDate)}},{key:"updateDate",value:function(e){null!=e&&(this.currentIndex=this.indexFromDate(e))}},{key:"updateMaxDate",value:function(){this.syncDateRange()}},{key:"updateMinDate",value:function(){this.syncDateRange()}},{key:"syncDateRange",value:function(){this.range=[this.minDate,this.maxDate]}},{key:"updateNavButtons",value:function(e){var t=this;this.detachListeners("navButtons"),!0===e&&Wn.ion({theme:function(){return t.recompose()},name:"navButtons",thisObj:this})}},{key:"changeRange",value:function(e,n){if(Hk(e)){var r,i=_(e,2),a=i[0],o=i[1];Pl.isDate(a)&&(a=this.indexFromDate(a),r=!0),Pl.isDate(o)&&(o=this.indexFromDate(o),r=!0),r&&(e=[a,o])}return B(t,"changeRange",this,3)([e,n])}},{key:"changeSelection",value:function(e,t){return e&&Be.isEqual(e,t)&&(e=t),e}},{key:"updateSelection",value:function(e){var t=this;t.syncSelection("selection",e),t.isConfiguring?e&&(t.date=e[0]):t.trigger("selectionChange",{selection:e,userAction:t._isUserAction})}},{key:"syncSelection",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.selection,n=this.datePickers;"selection"!==e&&(this.selection=t),"picker"!==e&&n.forEach((function(e){return e.selection=t}))}}])}(ck.mixin(Ap));S(Nk,"$name","MultiDatePicker"),S(Nk,"type","multidatepicker"),S(Nk,"configurable",{configureSlot:"configureDatePicker",disableReserveSlots:"inert",slots:2,baseDate:{$config:"day",value:"today"},cellRenderer:null,headerRenderer:null,weekRenderer:null,weekStartDay:null,date:{$config:"day",value:"today"},minDate:{$config:"day"},maxDate:{$config:"day"},datePickerDefaults:{type:"datepicker",activeDate:null,animateTimeShift:!1,dayNameFormat:"d1",multiSelect:"range",trapFocus:!1,internalListeners:{selectionChange:"up.onDatePickerSelectionChange"},tbar:{items:{prevMonth:{onAction:"up.onPrevMonthClick"},nextMonth:{onAction:"up.onNextMonthClick"},fields:{items:{monthField:{disabled:!0},yearButton:{disabled:!0}}}}},yearPicker:{internalListeners:{select:"up.onYearPickedMulti"}}},includeYear:function(e){return!e.getMonth()},items:{prevButton:{type:"button",positionable:"before",cls:"b-multidatepicker-nav-button b-multidatepicker-prev-button b-icon b-icon-previous",onAction:"up.onPrevMonthClick",hideMode:"opacity"},nextButton:{type:"button",positionable:"after",cls:"b-multidatepicker-nav-button b-multidatepicker-next-button b-icon b-icon-next",onAction:"up.onNextMonthClick",hideMode:"opacity"}},multiSelect:null,navButtons:!0,selection:{$config:"day[]"}}),S(Nk,"fenced",{syncSelection:!0}),Nk.initClass(),Nk._$name="MultiDatePicker";var zk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dateFieldContainer",get:function(){return this.tbar}},{key:"changeConfirmable",value:function(e){return this.bbar=e,this.bbar}},{key:"updateConfirmable",value:function(e){this.detachListeners("confirmable"),null==e||e.ion({name:"confirmable",thisObj:this,choice:"doConfirm"})}},{key:"isValid",get:function(){return this.checkValid()}},{key:"configureDatePicker",value:function(e,n,r){var i=B(t,"configureDatePicker",this,3)([e,n,r]);return i.selection=this.selection,i}},{key:"onDatePickerBeforeDateSelect",value:function(e){var t=e.date;return this.applyDate(t,this.fieldStartDate,this.fieldEndDate),!1}},{key:"doConfirm",value:function(e){var t=e.choice,n=e.event,r=e.userAction;this.trigger("confirm",{choice:t,event:n,userAction:r})}},{key:"internalOnKeyDown",value:function(e){var n=this.confirmable,r=null==n?void 0:n.hotKeys[e.virtualKey];r?("default"===r&&(r=n.defaultButton),r&&this.doConfirm({event:e,choice:S(S({},r,!0),"name",r)})):B(t,"internalOnKeyDown",this,3)([e])}},{key:"syncSelection",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.selection;B(t,"syncSelection",this,3)([e,n]),"value"!==e&&this.syncValue("selection",n)}},{key:"syncValue",value:function(e){var n,r,a,o=arguments.length>1&&arguments[1]!==i?arguments[1]:this.value,l=this,s=(null===(n=o)||void 0===n?void 0:n[1])<(null===(r=o)||void 0===r?void 0:r[0]);"fieldEndDate"===e?(a=2,s&&(o=[o[1],o[1]])):"fieldStartDate"===e&&(a=1,s&&(o=[o[0],o[0]])),a&&o&&!l.isConstructing&&l.ensureVisible(o[a-1]),"selection"!==e&&l.syncSelection("value",o),B(t,"syncValue",this,3)([e,o])}},{key:"triggerChange",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:Boolean(this._isUserAction),n=this.value,r=this._lastValue,a=this.isValid;this.triggerFieldChange({value:n,oldValue:r,event:e,userAction:t,valid:a})}}])}(Nk.mixin(_k));S(zk,"$name","DateRangePicker"),S(zk,"type","daterangepicker"),S(zk,"configurable",{confirmable:null,datePickerDefaults:{focusable:!1,internalListeners:{beforeDateSelect:"up.onDatePickerBeforeDateSelect"}},keyMap:{delegate:"confirmable"},multiSelect:"range",selection:["today","today"],stripDefaults:{bbar:{type:"confirmationbar"}},tbar:{items:{spacer:{type:"widget",flex:1,weight:0}}}}),zk.initClass(),zk._$name="DateRangePicker";var jk=new Date,Wk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dateFieldContainer",get:function(){return this.container}},{key:"innerElements",get:function(){return[]}},{key:"maxDate",get:function(){return this.max}},{key:"minDate",get:function(){return this.min}},{key:"compose",value:function(){var e=this.pickTime;return{class:{"b-pick-time":Boolean(e)}}}},{key:"updateClearable",value:function(e){var t=this,n=this.fieldEndDate;n.clearable=e,e&&(n.triggers.clear.handler=function(){return t.clear()})}},{key:"updateConfirmable",value:function(){this.isConstructing||(this.picker=this._pickerConfig)}},{key:"changeEndTimeField",value:function(e,t){return Kv.reconfigure(t,e,{owner:this,defaults:Kv.mergeConfigs(this.timeFieldDefaults,this.fieldEndTimeDefaults)})}},{key:"updateEndTimeField",value:function(e){e&&this.container.add(e)}},{key:"changeStartTimeField",value:function(e,t){return Kv.reconfigure(t,e,{owner:this,defaults:Kv.mergeConfigs(this.timeFieldDefaults,this.fieldStartTimeDefaults)})}},{key:"updateStartTimeField",value:function(e){e&&this.container.add(e)}},{key:"updateKeepTime",value:function(e){e=!this.pickTime&&e,this.fieldEndDate.keepTime=e,this.fieldStartDate.keepTime=e}},{key:"updateMax",value:function(e){var t=this.fieldEndDate,n=this.fieldStartDate,r=this._picker;t.max=e,n.max=e,r&&(r.maxDate=e),this.syncInvalid()}},{key:"updateMin",value:function(e){var t=this.fieldEndDate,n=this.fieldStartDate,r=this._picker;t.min=e,n.min=e,r&&(r.minDate=e),this.syncInvalid()}},{key:"changePicker",value:function(e,t){var n=this,r=n.confirmable,i=n.pickerAlignElement,a=r?n.confirmableDefaults:n.nonConfirmableDefaults,o=Lo.resolveType(a.type),l=o.mergeConfigs({owner:n,forElement:i,minDate:n.min,maxDate:n.max,selection:n.value,weekStartDay:n._weekStartDay,align:{anchor:n.overlayAnchor,target:i}},a,r&&{confirmable:r});return n._pickerConfig=e,Be.isObject(e)&&(e=Be.merge({type:l.type},e)),o.reconfigure(t,e,{owner:n,defaults:l})}},{key:"updatePicker",value:function(e,n){B(t,"updatePicker",this,3)([e,n]),this.detachListeners("dateRangeField.picker"),null==e||e.ion({name:"dateRangeField.picker",thisObj:this,selectionChange:"onPickerSelectionChange",confirm:"onPickerConfirm",focusIn:"onPickerFocusIn"})}},{key:"updatePickerCls",value:function(e,t){var n,r=null===(n=this.picker)||void 0===n||null===(n=n.element)||void 0===n?void 0:n.classList;t&&(null==r||r.remove(t)),e&&(null==r||r.add(e))}},{key:"updatePickTime",value:function(e){var t=null,n=null;!0===e?t=n={}:e&&(e.fieldStartTime||e.fieldEndTime?(n=e.fieldStartTime,t=e.fieldEndTime):n=t=e),this.fieldEndTime=t,this.fieldStartTime=n}},{key:"changeValue",value:function(e){var t=this,n=t.L("L{DateField.invalidDate}")(Pl.format(jk,t.format));if(!e||Pl.isDate(e[0])&&Pl.isDate(e[1]))return t.clearError(n),e;t.setError(n)}},{key:"weekStartDay",get:function(){return"number"==typeof this._weekStartDay?this._weekStartDay:Pl.weekStartDay}},{key:"updateWeekStartDay",value:function(e){this._picker&&(this._picker.weekStartDay=e)}},{key:"maybeHidePicker",value:function(){if(!this.picker.isVisible||this.confirmable)return!1;this.hidePicker()}},{key:"onDatePickerBeforeDateSelect",value:function(e){var t=e.date;return this.picker.applyDate(t,this.fieldStartDate,this.fieldEndDate),!1}},{key:"onDateFieldChange",value:function(e){var t,n,r,i,a,o=e.source,l=this,s=o.ref,u="fieldStartDate"===s?0:1,c=l.pickTime;l.isConstructing||(t=o.value,n=1-u,i=l.value,t&&(c?(r=u?l.fieldStartTime:l.fieldEndTime,t=Pl.combineDateAndTime(t,r.value)):t=Pl.clearTime(t),a=[t,t],i&&(a[n]=i[n],a[1]<a[0]&&(a[n]=Pl.combineDateAndTime(t,a[n]),a[1]<a[0]&&(a[n]=t))),l.syncValue(s,a)))}},{key:"onKeyArrowUp",value:function(e){var t=this;if(t.picker.isVisible)return!t.confirmable&&t.stepUp(e);t.showPicker()}},{key:"onKeyClear",value:function(){this.clearable&&this.clear()}},{key:"onKeyEnter",value:function(){this.maybeHidePicker()}},{key:"onKeyEscape",value:function(){this.maybeHidePicker()}},{key:"onExpandPicker",value:function(){this.confirmable?this.showPicker():this.togglePicker()}},{key:"onPickerSelectionChange",value:function(e){var t=e.selection,n=e.userAction;if(!this.confirmable){var r=this,i=r._isUserAction;r._isUserAction=n||i,r.syncValue("picker",t),r._isUserAction=i}}},{key:"onPickerConfirm",value:function(e){var t=e.choice,n=e.source,r=e.userAction,i=this,a=i._isUserAction,o=n.containsFocus&&(n.pickingStartDate?i.fieldStartDate:i.fieldEndDate);t.ok&&(i._isUserAction=r||a,i.syncValue("picker",n.value),i._isUserAction=a),i.hidePicker(),null==o||o.focus()}},{key:"onPickerFocusIn",value:function(e){var t=e.relatedTarget,n=this.container.widgetMap,r=n.fieldEndDate,i=n.fieldStartDate,a=t===i?i:r;!this.confirmable&&a.focus()}},{key:"onTriggerKeyDown",value:function(e){return this.picker.isVisible&&!this.confirmable?this.stepDown(e):B(t,"onTriggerKeyDown",this,3)([e])}},{key:"focusPicker",value:function(){var e=this.picker,t=this.container.widgetMap,n=t.fieldEndDate,r=t.fieldStartDate,i=e.tbar,a=(null==i?void 0:i.widgetMap)||{},o=a.fieldEndDate,l=a.fieldStartDate,s=i?n.containsFocus&&o||l:n.containsFocus&&n||r;s.focus(),s!==e&&(e.ensureVisible({animate:!1,date:s.value}),s.selectAll())}},{key:"showPicker",value:function(e){var n=this,r=n._picker;n.readOnly||(r&&r.setConfig({range:[n.min,n.max],selection:n.value}),e=e||Boolean(n.confirmable),B(t,"showPicker",this,3)([e]))}},{key:"isValid",get:function(){var e=this,n=e.checkMinMax();return e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0),n?(e.setError(n<0?"L{Field.minimumValueViolation}":"L{Field.maximumValueViolation}",!0),!1):B(t,"isValid",this,1)}},{key:"setupLabel",value:function(e){return B(t,"setupLabel",this,3)([Be.assign({for:this.fieldStartDate.input.id},e)])}},{key:"syncInputFieldValue",value:function(){}},{key:"syncValue",value:function(e){var n,r,a,o=arguments.length>1&&arguments[1]!==i?arguments[1]:this.value,l=this,s=l._picker,u=(null===(n=o)||void 0===n?void 0:n[1])<(null===(r=o)||void 0===r?void 0:r[0]);null!=s&&s.isVisible&&!l.confirmable&&("fieldEndDate"===e?(a=2,u&&(o=[o[1],o[1]])):"fieldStartDate"===e&&(a=1,u&&(o=[o[0],o[0]])),a&&o&&!l.isConstructing&&s.ensureVisible(o[a-1]));"picker"!==e&&s&&(s.selection=o),B(t,"syncValue",this,3)([e,o])}}])}(ov.mixin(_k));S(Wk,"$name","DateRangeField"),S(Wk,"type","daterangefield"),S(Wk,"alias","daterange"),S(Wk,"configurable",{inline:!0,confirmable:null,container:{},confirmableDefaults:{type:"daterangepicker",navButtons:"floating",trapFocus:!0,align:{align:"t100-t100",offset:'[data-ref="fieldEndDate"]',overlap:!0},fieldStartDate:{triggers:{expand:{align:"start",disabled:!0}}}},fieldEndDate:{internalListeners:{triggerKey:"up.onTriggerKey"},triggers:{expand:null}},fieldEndTime:null,fieldEndTimeDefaults:{ref:"fieldEndTime",cls:"b-end-time",weight:20},fieldStartDate:{internalListeners:{triggerKey:"up.onTriggerKey"},triggers:{expand:{handler:"up.onExpandPicker",align:"start"}}},fieldStartTime:null,fieldStartTimeDefaults:{ref:"fieldStartTime",cls:"b-start-time",weight:10},keepTime:null,keyMap:{ArrowDown:"onTriggerKeyDown",ArrowUp:"onKeyArrowUp",Enter:"onKeyEnter",Escape:"onKeyEscape","Shift+Backspace":"onKeyClear"},max:{$config:{type:"date",formats:["format","altFormats"],strict:!0}},min:{$config:{type:"date",formats:["format","altFormats"],strict:!0}},nonConfirmableDefaults:{type:"multidatepicker",align:{align:"t100-r100"},datePickerDefaults:{focusable:!1,internalListeners:{beforeDateSelect:"up.onDatePickerBeforeDateSelect"}}},picker:{cls:"b-daterangefield-picker",floating:!0,hideMode:"clip",multiSelect:"range",scrollAction:"realign",align:{axisLock:!0}},pickerAlignElement:"container.element",pickerCls:null,pickTime:null,stepSmall:"7 days",timeFormat:"HH:mm:ss:SSS",triggers:{expand:null},weekStartDay:null,timeFieldDefaults:{type:"timefield",autoSelect:!0,picker:{align:{align:"b0-t0"}},triggers:{expand:null}}}),Wk.initClass(),Wk._$name="DateRangeField";var $k=new Date(2e3,0,1),Uk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){this.dateField.destroy(),this.timeField.destroy(),B(t,"doDestroy",this,3)([])}},{key:"childItems",get:function(){return[this.dateField,this.timeField]}},{key:"fieldDefaults",get:function(){var e=this.revertOnEscape,t=this.tabIndex;return null==t?{revertOnEscape:e}:{revertOnEscape:e,tabIndex:t}}},{key:"focusElement",get:function(){return this.dateField.input}},{key:"innerElements",get:function(){return[this.dateField.element,this.timeField.element]}},{key:"internalOnKeyEvent",value:function(){}},{key:"updateRevertOnEscape",value:function(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}},{key:"changeTimeField",value:function(e,t){return Kv.reconfigure(t,e,{owner:this,defaults:this.fieldDefaults})}},{key:"updateTimeField",value:function(e){var t=this;fr.on({element:e.element,keydown:"onTimeFieldKeyDown",thisObj:t}),Tt.after(e,"syncInvalid",(function(){t.timeField&&!t.updatingInvalid&&t.syncInvalid()})),e.ion({thisObj:t,change:function(e){var n=e.userAction,r=e.value;if(n&&!t.$settingValue){var i=t.dateField.value;t._isUserAction=!0,t.value=i?Pl.copyTimeValues(new Date(i),r||$k):null,t._isUserAction=!1}}}),t.readOnly&&(e.readOnly=!0)}},{key:"changeDateField",value:function(e,t){return Pk.reconfigure(t,e,{owner:this,defaults:this.fieldDefaults})}},{key:"updateDateField",value:function(e){var t=this;fr.on({element:e.element,keydown:"onDateFieldKeyDown",thisObj:t}),Tt.after(e,"syncInvalid",(function(){t.dateField&&!t.updatingInvalid&&t.syncInvalid()})),e.ion({thisObj:t,change:function(e){var n=e.userAction,r=e.value;n&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value=r,t.value=r,t._isUserAction=!1)},keydown:function(e){var n,r=e.event;"Tab"===r.key&&!r.shiftKey&&null!==(n=t.timeField)&&void 0!==n&&n.isVisible&&r.stopPropagation()}}),t.readOnly&&(e.readOnly=!0)}},{key:"updateWeekStartDay",value:function(e){this.dateField&&(this.dateField.weekStartDay=e)}},{key:"changeWeekStartDay",value:function(e){var t,n;return"number"==typeof e?e:null!==(t=null===(n=this.dateField)||void 0===n?void 0:n.weekStartDay)&&void 0!==t?t:Pl.weekStartDay}},{key:"syncInputFieldValue",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.isConfiguring;B(t,"syncInputFieldValue",this,3)([!0]);var n=this,r=n.dateField,a=n.timeField,o=r.highlightExternalChange,l=a.highlightExternalChange;e||n.highlightExternalChange||(e=!0),n.$isInternalChange=!0,r.highlightExternalChange=!1,r.highlightExternalChange=o,e&&(a.highlightExternalChange=r.highlightExternalChange=!1),a.value=r.value=n.inputValue,r.highlightExternalChange=o,a.highlightExternalChange=l,n.$isInternalChange=!1,n.syncInvalid()}},{key:"onTimeFieldKeyDown",value:function(e){var t=this;if(!t.readOnly&&("Enter"===e.key||"Tab"===e.key)){var n=t.dateField.value;t._isUserAction=!0,t.value=n?Pl.copyTimeValues(new Date(n),t.timeField.value||$k):null,t._isUserAction=!1}}},{key:"onDateFieldKeyDown",value:function(e){var t=this;"Tab"!==e.key||e.shiftKey?t.readOnly||"Enter"!==e.key||(t.value=t.dateField.value):(e.stopPropagation(),e.preventDefault(),t.timeField.focus())}},{key:"updateRequired",value:function(e){B(t,"updateRequired",this,3)([e]),this.timeField.required=this.dateField.required=e}},{key:"updateReadOnly",value:function(e,n){B(t,"updateReadOnly",this,3)([e,n]),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}},{key:"onDisabled",value:function(e){this.timeField.disabled=this.dateField.disabled=e}},{key:"focus",value:function(){this.dateField.focus()}},{key:"hasChanged",value:function(e,n){var r,i;return null!=e&&e.getTime&&null!=n&&n.getTime?!Pl.isEqual(e,n):B(t,"hasChanged",this,3)([null==e||null===(r=e.getTime)||void 0===r?void 0:r.call(e),null==n||null===(i=n.getTime)||void 0===i?void 0:i.call(n)])}},{key:"isValid",get:function(){return this.timeField.isValid&&this.dateField.isValid}},{key:"setError",value:function(e,t){[this.dateField,this.timeField].forEach((function(n){return n.setError(e,t)}))}},{key:"getErrors",value:function(){var e=[].concat(z(this.dateField.getErrors()||[]),z(this.timeField.getErrors()||[]));return e.length?e:null}},{key:"clearError",value:function(e,t){[this.dateField,this.timeField].forEach((function(n){return n.clearError(e,t)}))}},{key:"updateInvalid",value:function(){this.updatingInvalid=!0,this.dateField.updateInvalid(),this.timeField.updateInvalid(),this.updatingInvalid=!1}}])}(Uf);S(Uk,"$name","DateTimeField"),S(Uk,"type","datetimefield"),S(Uk,"alias","datetime"),S(Uk,"configurable",{timeField:{type:"timefield"},dateField:{type:"datefield",keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:function(){return""},ariaElement:"element"}),Uk.initClass(),Uk._$name="DateTimeField";var Gk=w((function e(){m(this,e)})),Yk=w((function e(){m(this,e)})),qk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeMin",value:function(e){return"string"==typeof e?new ql(e):e}},{key:"changeMax",value:function(e){return"string"==typeof e?new ql(e):e}},{key:"changeAllowedUnits",value:function(e){return"string"==typeof e&&(e=e.split(",")),e.length>0&&!e.includes(this.defaultUnit)&&(this.defaultUnit=e[0]),e}},{key:"updateAllowedUnits",value:function(e){this.allowedUnitsRe=new RegExp("^(".concat(e.join("|"),")$"),"i")}},{key:"inputValue",get:function(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation,this.decimalPrecision)}},{key:"updateUnit",value:function(){this.clearError("L{invalidUnit}"),V(t,"value",this.calcValue(),this,1,1)}},{key:"updateMagnitude",value:function(){this.clearError("L{invalidUnit}"),V(t,"value",this.calcValue(),this,1,1)}},{key:"unitWithDefault",get:function(){return this.unit||this.defaultUnit}},{key:"roundMagnitude",value:function(e){return e&&null!=this.decimalPrecision?Be.round(e,this.decimalPrecision):e}},{key:"allowDecimals",get:function(){return 0!==this.decimalPrecision}},{key:"isValid",get:function(){var e=this,n=e.input.value,r=Pl.parseDuration(n,e.allowDecimals,n.match(/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u065F\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06EF\u06FA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07CA-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u0870-\u0887\u0889-\u088E\u0897-\u08E1\u08E3-\u0963\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09F0\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A70-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3C-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C5D\u0C60-\u0C63\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDD\u0CDE\u0CE0-\u0CE3\u0CF1-\u0CF3\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECE\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u103F\u1050-\u108F\u109A-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1715\u171F-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u180B-\u180D\u180F\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F\u1AA7\u1AB0-\u1ACE\u1B00-\u1B4C\u1B6B-\u1B73\u1B80-\u1BAF\u1BBA-\u1BF3\u1C00-\u1C37\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u20D0-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005\u3006\u302A-\u302F\u3031-\u3035\u303B\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA672\uA674-\uA67D\uA67F-\uA6E5\uA6F0\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CD\uA7D0\uA7D1\uA7D3\uA7D5-\uA7DC\uA7F2-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8E0-\uA8F7\uA8FB\uA8FD-\uA8FF\uA90A-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF\uA9E0-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD4A-\uDD65\uDD69-\uDD6D\uDD6F-\uDD85\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDEC2-\uDEC4\uDEFC-\uDF1C\uDF27\uDF30-\uDF50\uDF70-\uDF85\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC70-\uDC75\uDC7F-\uDCBA\uDCC2\uDCD0-\uDCE8\uDD00-\uDD34\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE\uDDCF\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E-\uDE41\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7-\uDFC0\uDFC2\uDFC5\uDFC7-\uDFCA\uDFCC-\uDFD3\uDFE1\uDFE2]|\uD805[\uDC00-\uDC4A\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE80-\uDEB8\uDF00-\uDF1A\uDF1D-\uDF2B\uDF40-\uDF46]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDEE0-\uDEF6\uDF00-\uDF10\uDF12-\uDF3A\uDF3E-\uDF42\uDF5A\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC40-\uDC55\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD2F]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDC30-\uDC6D\uDC8F\uDD00-\uDD2C\uDD30-\uDD3D\uDD4E\uDE90-\uDEAE\uDEC0-\uDEEF]|\uD839[\uDCD0-\uDCEF\uDDD0-\uDDF0\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF]|\uDB40[\uDD00-\uDDEF])+/gi)?i:e.unitWithDefault),a=!n||r&&null==r.magnitude;return e.skipValidation||B(t,"isValid",this,1)&&(a&&!e.required||!a&&(e.allowNegative||(null==r?void 0:r.magnitude)>=0))}},{key:"internalOnChange",value:function(e){var t=this,n=t.value,r=t._lastValue;t.hasChanged(r,n)&&(t._lastValue=n,t.triggerFieldChange({value:n,event:e,userAction:!0,valid:t.isValid}))}},{key:"onFocusOut",value:function(e){var n;return this.syncInputFieldValue(!0),null===(n=this.triggers)||void 0===n||null===(n=n.spin)||void 0===n||null===(n=n.clickRepeater)||void 0===n||n.cancel(),B(t,"onFocusOut",this,3)([e])}},{key:"value",get:function(){return B(t,"value",this,1)},set:function(e){var n,r,i=this;if(i.getConfig("allowedUnits"),i.clearError("L{invalidUnit}"),"number"==typeof e||"string"==typeof e&&e.length>0&&!isNaN(e))n=Number(e),r=i.unitWithDefault;else if("string"==typeof e)if(/^\s*$/.test(e))n=null;else{var a=Pl.parseDuration(e,i.allowDecimals,i.unitWithDefault);a&&(!i.allowedUnitsRe||i.allowedUnitsRe.test(a.unit)?(r=a.unit,n=a.magnitude):i.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,n=e.magnitude):(r=null,n=null);i.magnitude===n&&i.unit==r||(i._magnitude=n,r&&(i.unit=r),V(t,"value",i.calcValue(),this,1,1))}},{key:"okMax",value:function(e){return"number"==typeof e&&(e=new ql({unit:this.unitWithDefault,magnitude:e})),null==this.max||e<=this.max}},{key:"okMin",value:function(e){return"number"==typeof e&&(e=new ql({unit:this.unitWithDefault,magnitude:e})),null==this.min||e>=this.min}},{key:"validity",get:function(){var e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}},{key:"calcValue",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.magnitude;return t.unit&&null!=n||!t.clearable?new ql(e?t.roundMagnitude(n):n,t.unitWithDefault):null}},{key:"hasChanged",value:function(e,t){return t&&!e||!t&&e||t&&e&&!(e.unit===t.unit&&e.isEqual(t))}},{key:"milliseconds",get:function(){return this.value?this.value.milliseconds:0}},{key:"onInternalKeyDown",value:function(e){var t=this,n=t._isUserAction;t._isUserAction=!0,"ArrowUp"===e.key?t.doSpinUp():"ArrowDown"===e.key&&t.doSpinDown(),t._isUserAction=n}},{key:"doSpinUp",value:function(){var e=this,t=e.value;if(!e.readOnly){Be.isEmpty(t)&&(t=new ql({magnitude:0,unit:this.defaultUnit}));var n=t.add(this._step);e.okMin(n)||(n=e.min),e.okMax(n)&&(e.value=n)}}},{key:"doSpinDown",value:function(){var e=this,t=e.value;if(!e.readOnly){Be.isEmpty(t)&&(t=new ql({magnitude:0,unit:this.defaultUnit}));var n=t.add({magnitude:-this._step.magnitude,unit:this._step.unit});e.okMax(n)||(n=e.max),e.okMin(n)&&(e.allowNegative||(e.magnitude||0)>0)&&(e.value=n)}}},{key:"changeStep",value:function(e,t){var n=W(e);return e?("number"===n?e={magnitude:Math.abs(e),unit:i}:"string"===n&&(e=Pl.parseDuration(e)),e&&e.unit&&e.magnitude&&e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):null}},{key:"updateStep",value:function(e){this.element.classList.toggle("b-no-steppers",Boolean(e)),this.syncInvalid()}}],[{key:"defaultConfig",get:function(){return{value:null,defaultUnit:"day",useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}},{key:"configurable",get:function(){return{min:null,max:null,allowedUnits:null,step:1,unit:null,magnitude:null}}}])}(iv);S(qk,"$name","DurationField"),S(qk,"type","durationfield"),S(qk,"alias","duration"),qk.initClass(),qk._$name="DurationField";var Kk,Xk=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConfigure",value:function(){var e=this;B(t,"afterConfigure",this,3)([]),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),fr.on({element:e.element,keydown:"onEditorKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide"}),Na.ion({locale:"onLocaleChange",thisObj:e})}},{key:"onLocaleChange",value:function(){var e=this.inputField;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}},{key:"render",value:function(e){var n=this.element.parentNode,r=_(this.getRenderContext(this,e),1)[0];r.classList.add("b-editing"),B(t,"render",this,3)(arguments),null!=n&&n.classList&&r!==n&&n.classList.remove("b-editing")}},{key:"startEdit",value:(a=f(L().mark((function e(t){var n,r,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x,E;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,t=Be.assignIf(t,{align:n.align,hideTarget:n.hideTarget,matchSize:n.matchSize,matchFont:n.matchFont,fitTargetContent:n.fitTargetContent,focus:!0}),!n.isVisible){e.next=5;break}return e.next=5,n.completeEdit();case 5:if(!1===n.trigger("beforeStart",t)){e.next=33;break}if(s=(l=t).target,u=l.hideTarget,c=l.matchSize,d=l.matchFont,h=l.fitTargetContent,f=l.record,v=l.field,g=void 0===v?n.inputField.name:v,m=l.focus,p=n.inputField,y=n.appendToTargetParent,k=p.input,b=li.getStyleValue(s,"font-size"),C=li.getStyleValue(s,"font-family"),D=(w=t).value,S=w.align,f&&g&&(n.record=f,n.dataField=g,p.assignFieldValue!==Lo.prototype.assignFieldValue?D=p.value:D===i&&(D=f.getValue(g))),y&&s.nodeType===Node.ELEMENT_NODE&&s.parentElement.appendChild(n.element),c&&(s instanceof HTMLElement&&n.updateSize(s,c),s instanceof HTMLElement&&ya.addResizeListener(s,n.onTargetSizeChange)),k&&(d?(k.style.fontSize=b,k.style.fontFamily=C):k.style.fontSize=k.style.fontFamily=""),n.assigningValues=!0,null===(r=p.clearError)||void 0===r||r.call(p),!("setValue"in p)){e.next=19;break}return e.next=17,p.setValue(D);case 17:e.next=20;break;case 19:p.value=D;case 20:return n.assigningValues=!1,"string"==typeof S&&(S={align:S}),e.next=24,n.showBy(F({target:s,allowTargetOut:!0},S));case 24:return h&&(x=k.scrollWidth-k.clientWidth)>0&&(n.width+=x+li.scrollBarWidth),m&&(null===(a=p.focus)||void 0===a||a.call(p)),s.nodeType===Element.ELEMENT_NODE&&u&&s.classList.add("b-hide-visibility"),n.editing=!0,E=p.value,n.trigger("start",{value:E}),Array.isArray(E)&&p.editingRecords&&null!==(o=E[0])&&void 0!==o&&o.isModel?n.oldValue=E.map((function(e){return e.copy(e.id)})):(n.oldValue=E,Array.isArray(n.oldValue)&&(n.oldValue=n.oldValue.slice())),p.initialValue=n.oldValue,e.abrupt("return",!0);case 33:return e.abrupt("return",!1);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"refreshEdit",value:(r=f(L().mark((function e(){var t,n,r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isVisible){e.next=9;break}if(t=this.record,n=this.dataField,r=this.inputField,i=this.owner,!t){e.next=9;break}if(((null==i?void 0:i.readOnly)||t.readOnly)&&this.cancelEdit(),!n){e.next=9;break}if(a=t.getValue(n),Be.isEqual(r.value,a)){e.next=9;break}return e.next=9,r.setValue(a);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"finishEdit",value:function(){var e=this.lastAlignSpec,t=e.target;e.aligningToElement&&(t.classList.remove("b-editing"),t.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("afterEdit",{record:this.record})}},{key:"onEditorKeyDown",value:function(e){var t,n=this;switch(e.key){case n.completeKey:e.preventDefault(),e.stopImmediatePropagation(),n.completeEdit(null,e);break;case n.cancelKey:n.cancelEdit(e),e.stopImmediatePropagation()}null===(t=n.trigger)||void 0===t||t.call(n,"keyDown",{event:e})}},{key:"stopMouseEvents",value:function(e){this.allowMouseEvents||e.stopPropagation()}},{key:"onFocusOut",value:function(e){B(t,"onFocusOut",this,3)([e]);var n=this;if(!n.isFinishing&&n.editing)switch(n.blurAction){case"cancel":n.cancelEdit(e);break;case"complete":n.completeEdit(null,e)}}},{key:"completeEdit",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).inputField,a=r.oldValue,o=r.record,l=i.invalidAction||(!1===i.allowInvalid?"block":r.invalidAction),s=i.value,r.isVisible){e.next=3;break}return e.abrupt("return");case 3:if(i.isValid||"allow"===l){e.next=14;break}if((null==n?void 0:n.key)&&n.preventDefault(),"block"!==l){e.next=10;break}return null===(u=i.focus)||void 0===u||u.call(i),e.abrupt("return",!1);case 10:if("revert"!==l){e.next=12;break}return e.abrupt("return",!1!==r.cancelEdit(n));case 12:e.next=51;break;case 14:if(!Be.isEqual(s,a)){e.next=18;break}return e.abrupt("return",!1!==r.cancelEdit(n));case 18:return(null==n?void 0:n.key)&&n.stopPropagation(),c={inputField:i,record:o,value:s,oldValue:a},e.next=22,r.trigger("beforeComplete",c);case 22:if(e.t0=e.sent,!1!==e.t0){e.next=27;break}null===(d=i.focus)||void 0===d||d.call(i),e.next=51;break;case 27:if(t||(t=c.finalize||(null===(h=c.editorContext)||void 0===h?void 0:h.finalize)),!t){e.next=49;break}return e.next=31,t(c);case 31:if(!0!==(f=e.sent)){e.next=36;break}r.onEditComplete(),e.next=46;break;case 36:if(i.setError&&(v=f||i.invalidValueError,g=function(){m(),i.clearError(v)},m=i.ion({change:g,input:g}),i.setError(v)),"block"!==l){e.next=41;break}null===(p=i.focus)||void 0===p||p.call(i),e.next=45;break;case 41:if("revert"!==l){e.next=45;break}return e.next=44,i.setValue(a);case 44:f=!0;case 45:f=!1;case 46:return e.abrupt("return",f);case 49:return r.onEditComplete(),e.abrupt("return",!0);case 51:return e.abrupt("return",!1);case 52:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"cancelEdit",value:function(e){var t,n=this,r=n.inputField,i=n.oldValue,a=r.value;if(!n.editing||n.isFinishing||!1===n.trigger("beforeCancel",{value:a,oldValue:i,event:e}))return null==e||e.preventDefault(),!1;null===(t=r.clearError)||void 0===t||t.call(r),n.isFinishing=!0,n.hide(),"Escape"===(null==e?void 0:e.key)&&e.stopImmediatePropagation(),n.trigger("cancel",{value:a,oldValue:i,event:e}),n.finishEdit(),n.isFinishing=!1}},{key:"onEditComplete",value:function(){var e=this,t=e.record,n=e.dataField,r=e.inputField,i=e.oldValue,a=r.value;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t&&(!e.instantUpdate||r._outstandingUpdate)){var o="set".concat(Le.capitalize(n));!t.isFieldModified(n)||null!=t.getUnmodified(n)||null!=a&&""!==a||(a=t.meta.modified[n]),t[o]?t[o](a):t.setValue(n,a)}e.trigger("complete",{value:a,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}},{key:"doDestroy",value:function(){this.createdInputField&&this.inputField.destroy(),B(t,"doDestroy",this,3)([])}},{key:"owner",get:function(){return this._owner||Lo.fromElement(this.element.parentNode)},set:function(e){this._owner=e}},{key:"changeInputField",value:function(e,t){var n=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof Lo||(e.type||(e.type="textfield"),e=Lo.create(e),n.createdInputField=!0),n.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:n}),e.parent=n,e}},{key:"updateInputField",value:function(e){this.removeAll(),this.add(e)}},{key:"inputField",get:function(){return this.items[0]}},{key:"onInputFieldChange",value:function(){this.containsFocus&&this.completeEdit()}},{key:"onTargetSizeChange",value:function(e,t,n){t&&n&&this.updateSize(e)}},{key:"updateSize",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.lastMatchSize,n=this,r=pt.inner(e);n.width=!1===t.width?"auto":r.width-n.align.offset[0],n.height=!1===t.height?"auto":r.height,n.lastMatchSize=t}},{key:"beforeEditorHide",value:function(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}},{key:"afterEditorHide",value:function(){var e;this.positioned&&this.element.remove(),ya.removeResizeListener(null===(e=this.lastAlignSpec)||void 0===e?void 0:e.target,this.onTargetSizeChange)}}]);var n,r,a}(Ss);S(Xk,"$name","Editor"),S(Xk,"type","editor"),S(Xk,"configurable",{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,appendToTargetParent:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0,instantUpdate:!1,floating:!1}),Xk.initClass(),Xk._$name="Editor";var Zk={number:!0,boolean:!0,string:!0,date:!0,duration:!0,time:!0,auto:!0},Jk={number:!0,boolean:!0,string:!0},Qk=function(e){var t;return"duration"===(null==e||null===(t=e.column)||void 0===t?void 0:t.type)},eb="b-fieldfilterpicker",tb={between:!0,notBetween:!0,isIncludedIn:!0,isNotIncludedIn:!0},nb={textfield:!0,datefield:!0,numberfield:!0,durationfield:!0,combo:!0,timefield:!0},rb={empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}",isArrayValued:!0},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}",isArrayValued:!0}},ib=function(e){var t=e.value;return e.isTimeField&&t?Pl.getTime(t):t},ab=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e=this;if(!e._fields)throw new Error("".concat(t.name," requires 'fields' to be configured."));if(!e._filter)throw new Error("".concat(t.name," requires 'filter' to be configured."));B(t,"afterConstruct",this,3)([]);var n=e.widgetMap,r=n.propertyPicker,i=n.operatorPicker,a=n.caseSensitive;r.ion({select:"onPropertySelect",thisObj:e}),i.ion({select:"onOperatorSelect",thisObj:e}),a.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&r.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&i.setConfig(e.operatorFieldConfig),r.cls=e.allPropertyPickerClasses,i.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}},{key:"changeDateFormat",value:function(e){return this.L(e)}},{key:"allChildInputs",get:function(){var e=this.widgetMap,t=e.propertyPicker,n=e.operatorPicker,r=e.caseSensitive;return[t,n].concat(z(this.valueFields),[r])}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.allChildInputs.forEach((function(t){return t.disabled=e}))}},{key:"updateReadOnly",value:function(e){var t=this.widgetMap,n=t.propertyPicker,r=t.operatorPicker;this.allChildInputs.forEach((function(t){return t.readOnly=e})),n.readOnly=n.readOnly||e,r.readOnly=r.readOnly||e}},{key:"updatePropertyLocked",value:function(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}},{key:"updateOperatorLocked",value:function(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}},{key:"changeOperators",value:function(e){var n=this,r=null!=e?e:t.defaultOperators;return Object.keys(r).reduce((function(e,t){return F(F({},e),{},S({},t,r[t].map((function(e){return F(F({},e),{},{text:n.L(e.text)})}))))}),{})}},{key:"isMultiSelectValueField",get:function(){var e;return["isIncludedIn","isNotIncludedIn"].includes(null===(e=this._filter)||void 0===e?void 0:e.operator)}},{key:"allPropertyPickerClasses",get:function(){var e;return new Ct("".concat(eb,"-property"),null===(e=this.propertyFieldConfig)||void 0===e?void 0:e.cls,S({},"".concat(eb,"-combo-locked"),this.propertyLocked))}},{key:"allOperatorPickerClasses",get:function(){var e;return new Ct("".concat(eb,"-operator"),null===(e=this.operatorFieldConfig)||void 0===e?void 0:e.cls,S({},"".concat(eb,"-combo-locked"),this.operatorLocked))}},{key:"getValueFieldConfigs",value:function(){var e,n=this,r=n.valueFieldCls,i=n.fieldType,a=n._filter.operator,o=n.onValueChange,l=n.filterValues,s=n.isMultiSelectValueField,u=n.operatorArgCount,c=n.getValueFieldConfig,d=n.fieldIsRelation,h=n.triggerChangeOnInput,f=Be.merge({},t.defaultValueFieldPlaceholders,n.valueFieldPlaceholders);if(!i||!a||0===u)return[];var v,g,m={type:"textfield",internalListeners:{change:o,input:h?o:null,thisObj:n},bubbleEvents:{keydown:!0},cls:r,dataset:{type:i},placeholder:n.L(f[s?"list":d?"relation":i]),highlightExternalChange:!1};if(s||d?m=F(F({},m),{},{type:"combo",multiSelect:s,createOnUnmatched:!0,items:n.getUniqueDataValues(l),value:null!=l?l:[]}):"sameTime"===a||"notSameTime"===a?m.type="timefield":["number","date","boolean","duration","time"].includes(i)&&(m.type="".concat(i,"field")),"date"===i&&"timefield"!==m.type)m.format=null!==(v=null===(g=n.selectedField)||void 0===g?void 0:g.format)&&void 0!==v?v:n.dateFormat;else if("number"===i&&null!==(e=n.selectedField)&&void 0!==e&&e.format){var p;m.format=null===(p=n.selectedField)||void 0===p?void 0:p.format}return c&&(m=n.callback(c,n,[n.filter,m])),s?[m]:$e.populate(u,(function(e){return[{type:"widget",tag:"div",cls:"".concat(eb,"-value-separator"),content:n.L("L{FieldFilterPicker.and}")},F(F({},m),{},{value:l[e]})]})).flat().slice(1)}},{key:"getUniqueDataValues",value:function(){var e,t,n=arguments.length>0&&arguments[0]!==i?arguments[0]:[],r=this,a=r.fieldType,o=null===(e=r.selectedField)||void 0===e?void 0:e.format;if(!r.store||null===(t=r._filter)||void 0===t||!t.property)return[];var l,s,u=r.selectedField.relatedDisplayField;if(r.fieldIsRelation){var c=r.currentPropertyRelationConfig.foreignStore;u?s=(l=c.allRecords.reduce((function(e,t){return null!=t.id&&e.push({text:t.getValue(u),value:t.id}),e}),[])).sort((function(e,t){return r.sortStrings(e.text,t.text)})):l=c.allRecords.map((function(e){return e.id}))}else l=r.store.allRecords.map((function(e){return e.getValue(r._filter.property)}));if(!s){var d;(d=l).push.apply(d,z(n));var h=$e.unique(l.reduce((function(e,t){return null!=t&&""!==String(t).trim()&&("date"===a?e.push(t.valueOf()):"duration"===a?e.push(t.toString()):e.push(t)),e}),[]));if(s="string"===a?h.sort(r.sortStrings):"duration"===a?h.map((function(e){return new ql(e)})).filter((function(e){return e.isValid})).sort(r.sortDurations):h.sort(r.sortNumerics),"date"===a)s=s.map((function(e){var t=new Date(e);return{text:Pl.format(t,null!=o?o:r.dateFormat),value:e}}));else if("number"===a&&o){var f=eg.getLocalizedFormatter(o);s=s.map((function(e){return{text:f.format(e),value:e}}))}else"duration"===a&&(s=s.map((function(e){return e.toString()})))}return s}},{key:"sortStrings",value:function(e,t){return(null!=e?e:"").localeCompare(null!=t?t:"")}},{key:"sortNumerics",value:function(e,t){return e-t}},{key:"sortDurations",value:function(e,t){return e.valueOf()-t.valueOf()}},{key:"fieldType",get:function(){var e;return null===(e=this.selectedField)||void 0===e?void 0:e.type}},{key:"selectedField",get:function(){var e,t;return null===(e=this.fields)||void 0===e?void 0:e[null===(t=this._filter)||void 0===t?void 0:t.property]}},{key:"propertyOptions",get:function(){var e;return Object.entries(null!==(e=this.fields)&&void 0!==e?e:{}).filter((function(e){var t=_(e,2)[1];return Zk[t.type]||Qk(t)})).map((function(e){var t=_(e,2),n=t[0],r=t[1].title;return{value:n,text:null!=r?r:n}})).sort((function(e,t){return e.text.localeCompare(t.text)}))}},{key:"operatorOptions",get:function(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}},{key:"fieldIsRelation",get:function(){return Boolean(this.currentPropertyRelationConfig)}},{key:"currentPropertyRelationConfig",get:function(){var e,t=this;return null===(e=this.store)||void 0===e||null===(e=e.modelRelations)||void 0===e?void 0:e.find((function(e){var n;return e.foreignKey===(null===(n=t._filter)||void 0===n?void 0:n.property)}))}},{key:"updateOperators",value:function(){delete this._operatorArgCountLookup}},{key:"operatorArgCountLookup",get:function(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=t.buildOperatorArgCountLookup(this.operators))}},{key:"updateFilter",value:function(){this._filter&&this.onFilterChange()}},{key:"updateStore",value:function(e){var t;null===(t=this._store)||void 0===t||t.un(this),null==e||e.ion({refresh:"onStoreRefresh",thisObj:this}),this.inferFieldTypes()}},{key:"onStoreRefresh",value:function(e){var t=e.action;this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(t)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}},{key:"refreshValueFields",value:function(){var e=this,t=e.widgetMap.valueFields,n=e.valueFields,r=e.fieldType,a=e.operatorArgCount,o=e._filter,l=o.property,s=o.operator,u=tb[s],c="sameTime"===s||"notSameTime"===s?"time":r;t.element.className=new Ct(S(S(S(S({},"".concat(eb,"-values"),!0),"".concat(eb,"-values-multiple"),u),"".concat(eb,"-values-").concat(c),r!==i),"b-hidden",l==i||s==i||0===a));var d=e.getValueFieldConfigs();if(d.length!==n.length||d.some((function(e,t){var r=e.type;return n[t].type!==r})))t.removeAll(),t.add(d);else{var h,f=0,v=D(d);try{for(v.s();!(h=v.n()).done;){var g=h.value;delete g.type,Be.assign(n[f++],g)}}catch(e){v.e(e)}finally{v.f()}}delete e._valueFields,e.refreshCaseSensitive()}},{key:"refreshCaseSensitive",value:function(){var e,t,n=this,r=n.fieldType,i=n.operatorArgCount,a=n.isMultiSelectValueField,o=null===(e=n._filter)||void 0===e?void 0:e.operator,l=n.widgetMap.caseSensitive;l.hidden="string"!==r||!o||a||0===i,l.checked=!1!==(null===(t=n._filter)||void 0===t?void 0:t.caseSensitive)}},{key:"onPropertySelect",value:function(e){var t,n=this,r=n._filter;r.property=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.fieldType!==n._fieldType&&(r.operator=null,r.value=null),n._fieldType=r.type=n.fieldType,n.refreshOperatorPicker(),n.refreshValueFields(),n.triggerChange()}},{key:"onCaseSensitiveChange",value:function(e){var t=e.checked;this._filter.caseSensitive=t,this.triggerChange()}},{key:"onOperatorSelect",value:function(e){var t,n=this,r=n.isMultiSelectValueField,i=this.operatorArgCount;n._filter.operator=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.operatorArgCount!==i&&(n._filter.value=null),n.isMultiSelectValueField&&!r&&(n._filter.value=[]),n.refreshValueFields(),n.triggerChange()}},{key:"triggerChange",value:function(){var e=this.filter,t=this.isValid;this.trigger("change",{filter:e,isValid:t})}},{key:"onValueChange",value:function(){var e=this,t=e.isMultiSelectValueField,n=e.fieldType,r=e._filter,i=this.valueFields.map(ib);t&&"date"===n?r.value=i[0].map((function(e){return new Date(e)})):t&&"duration"===n?r.value=i[0].map((function(e){return new ql(e)})):("date"===n&&"between"===r.operator&&Pl.isValidDate(i[1])&&i[1].setHours(23,59,59,999),r.value=1===i.length?i[0]:i),e.triggerChange()}},{key:"refreshOperatorPicker",value:function(){var e=this.widgetMap.operatorPicker,t=this._filter,n=t.operator,r=t.property,i=this.operatorOptions;e.items=i,e.value=n,e.hidden=null===r}},{key:"populateUIFromFilter",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.filterValues,r=t.widgetMap,a=r.propertyPicker,o=r.operatorPicker,l=t._filter,s=l.property,u=l.operator,c=l.disabled,d=t.propertyOptions,h=t.operatorOptions,f=t.isMultiSelectValueField;a.items=d,o.items=h,o.hidden=null===s;var v=e;a.value!==s&&(a.value=s,t.refreshOperatorPicker(),v=!0),"date"===t.fieldType&&("="===u?t._filter.operator="sameDay":"!="===u&&(t._filter.operator="notSameDay")),o.value!==u&&(null!==u&&o.items.find((function(e){return e.value===u}))?o.value=u:o.clear(),v=!0),u||1!==o.items.length||(o.value=t._filter.operator=o.items[0].value),v&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach((function(e,r){f&&(e.value.length>0||n.length>0)?"date"===t.fieldType?e.value=n.map((function(e){return null==e?void 0:e.valueOf()})):"duration"===t.fieldType?e.value=n.map((function(e){return null==e?void 0:e.toString()})):e.value=n:r>=n.length?e.clear():e.value=n[r]})),t.allChildInputs.forEach((function(e){return e.disabled=t.disabled||c}))}},{key:"valueFields",get:function(){var e=this;return this._valueFields||(this._valueFields=this.widgetMap.valueFields.queryAll((function(t){return t.owner===e.widgetMap.valueFields&&nb[t.type]})))}},{key:"filterValues",get:function(){var e;return null==(null===(e=this._filter)||void 0===e?void 0:e.value)?[]:$e.asArray(this._filter.value)}},{key:"onFilterChange",value:function(){var e=this,t=e.fieldType,n=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(n)}},{key:"operatorArgCount",get:function(){var e=this.fieldType,t=this.filter.operator,n=this.operatorArgCountLookup;return e&&t?n[e][t]:1}},{key:"isValid",get:function(){var e=this,t=e.filter,n=e.fieldType,r=e.filterValues,i=e.isMultiSelectValueField,a=e.operatorArgCount,o=t.operator,l=a>0&&null==(null==t?void 0:t.value);return Boolean(n&&o&&!l&&(i&&r.length>0||r.length===a)&&r.every((function(e){return null!=e&&("duration"!==n||e.isValid)})))}},{key:"focusElement",get:function(){var e,n,r,i;return null!==(e=null===(n=null!==(r=null!==(i=this.valueFields.find((function(e){return e.isEmptyInput})))&&void 0!==i?i:this.operatorPicker)&&void 0!==r?r:this.propertyPicker)||void 0===n?void 0:n.input)&&void 0!==e?e:B(t,"focusElement",this,1)}},{key:"inferFieldTypes",value:function(){var e;if((null===(e=this.store)||void 0===e?void 0:e.totalCount)>0&&this.fields)for(var n=0,r=Object.entries(this.fields);n<r.length;n++){var i=_(r[n],2),a=i[0],o=i[1];"auto"===o.type&&(o.type=t.inferFieldType(this.store,a))}}}],[{key:"defaultValueFieldPlaceholders",get:function(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",relation:"L{selectValue}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}",time:"L{selectATime}",auto:"L{enterAValue}"}}},{key:"inferFieldType",value:function(e,t){var n,r=null===(n=e.find((function(e){return null!=e.getValue(t)}),!0))||void 0===n?void 0:n.getValue(t);if(r!==i){var a=W(r);if("object"===a&&r instanceof Date)return"date";if(Jk[a])return a}return"auto"}},{key:"localizeOperator",value:function(e,n){var r,i=t.defaultOperators,a=D(Object.keys(i).sort((function(e,t){return e===n?-1:t===n?1:0})));try{for(a.s();!(r=a.n()).done;){var o,l=D(i[r.value]);try{for(l.s();!(o=l.n()).done;){var s=o.value;if(s.value===e)return t.L(s.text)}}catch(e){l.e(e)}finally{l.f()}}}catch(e){a.e(e)}finally{a.f()}return e}}])}(Ss);Kk=ab,S(ab,"$name","FieldFilterPicker"),S(ab,"type","fieldfilterpicker"),S(ab,"defaultOperators",{string:[rb.empty,rb.notEmpty,rb["="],rb["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},rb.isIncludedIn,rb.isNotIncludedIn],number:[rb.empty,rb.notEmpty,rb["="],rb["!="],rb[">"],rb["<"],rb[">="],rb["<="],rb.between,rb.notBetween,rb.isIncludedIn,rb.isNotIncludedIn],date:[rb.empty,rb.notEmpty,{value:"sameDay",text:"L{equals}"},{value:"notSameDay",text:"L{doesNotEqual}"},{value:"sameTime",text:"L{timeEquals}"},{value:"notSameTime",text:"L{timeDoesNotEqual}"},{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},rb.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},rb.isIncludedIn,rb.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[rb.empty,rb.notEmpty,rb["="],rb["!="],rb[">"],rb["<"],rb[">="],rb["<="],rb.between,rb.notBetween,rb.isIncludedIn,rb.isNotIncludedIn],time:[rb.empty,rb.notEmpty,rb["="],rb["!="],rb[">"],rb["<"],rb[">="],rb["<="],rb.between,rb.notBetween,rb.isIncludedIn,rb.isNotIncludedIn],relation:[rb.empty,rb.notEmpty,rb["="],rb["!="],rb.isIncludedIn,rb.isNotIncludedIn],auto:[{value:"*",text:"L{contains}"}]}),S(ab,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,triggerChangeOnInput:!0,items:{inputs:{type:"container",layout:"hbox",cls:"".concat(eb,"-inputs"),items:{propertyPicker:{type:"combo",items:{},cls:"".concat(eb,"-property"),placeholder:"L{FieldFilterPicker.selectAProperty}",highlightExternalChange:!1},operatorPicker:{type:"combo",items:{},cls:"".concat(eb,"-operator"),placeholder:"L{FieldFilterPicker.selectAnOperator}",highlightExternalChange:!1},valueFields:{type:"container",cls:"".concat(eb,"-values"),items:{}}}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:"".concat(eb,"-case-sensitive")}},operators:Kk.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),S(ab,"buildOperatorArgCountLookup",(function(e){return $e.keyBy(Object.entries(e),(function(e){return _(e,1)[0]}),(function(e){var t=_(e,2)[1];return $e.keyBy(t,(function(e){return e.value}),(function(e){var t=e.argCount;return t===i?1:t}))}))})),ab.initClass(),ab._$name="FieldFilterPicker";var ob,lb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){return{tag:"label",text:this.text,html:this.html}}}])}(Lo);S(lb,"$name","Label"),S(lb,"type","label"),S(lb,"configurable",{text:null,localizableProperties:["text"]}),lb.initClass(),lb._$name="Label";var sb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e=this;e.validateConfig();var n=e.widgetMap.addFilterButton;n.ion({click:"addFilter",thisObj:e}),n.text=e.L(n.text),e.store&&e.updateStore(e.store),B(t,"afterConstruct",this,3)([])}},{key:"changeDateFormat",value:function(e){return this.L(e)}},{key:"validateConfig",value:function(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}},{key:"updateFields",value:function(e){this.widgetMap.pickers.childItems.forEach((function(t){return t.fields=e}))}},{key:"updateFilters",value:function(e,t){var n=this;t&&t.filter((function(t){return!e.find((function(e){return e.id===t.id}))})).forEach((function(e){var t;return null===(t=n.store)||void 0===t?void 0:t.removeFilter(e.id)})),e.forEach((function(e){return e.id=e.id||n.nextFilterId})),n.widgetMap.pickers.items=(null==e?void 0:e.map((function(e){return n.getPickerRowConfig(e)})))||[]}},{key:"changeFilters",value:function(e){var t=this,n=this.canManageFilter,r=this.limitToProperty,i=e;return n&&(i=i.filter((function(e){return t.callback(n,t,[e])}))),r&&(i=i.filter((function(e){return null==e.property||e.property===r}))),i}},{key:"updateStore",value:function(e){var t=this;if(t.detachListeners("store"),e){var n=!1;t.widgetMap.pickers.childItems.forEach((function(t){var r=t.widgetMap.filterPicker,i=r.filter;r.isValid&&!e.filters.includes(i)&&(e.removeFilter(i.id,!0),e.addFilter(i,!0),n=!0)})),n&&e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})}t.widgetMap.pickers.childItems.forEach((function(t){return t.store=e}))}},{key:"updateShowAddFilterButton",value:function(e){this.widgetMap.addFilterButton.hidden=!e}},{key:"updateAddFilterButtonText",value:function(e){this.widgetMap.addFilterButton.text=null!=e?e:t.addFilterButtonDefaultText}},{key:"appendFiltersFromStore",value:function(){var e=this;e.store.filters.forEach((function(t){var n,r=e.canManage(t),i=t.property,a=t.operator,o=t.id;r&&i&&a&&(null===(n=e.filters)||void 0===n||!n.find((function(e){return e.id===o})))&&e.appendFilter(t)}))}},{key:"canManage",value:function(e){var t=this;return(!t.allowedFieldNames||t.allowedFieldNames.includes(e.property))&&(!t.canManageFilter||!0===t.callback(t.canManageFilter,t,[e]))}},{key:"getFilterPickerConfig",value:function(e){var t=this,n=t.fields,r=t.store,a=t.disabled,o=t.readOnly,l=t.valueFieldCls,s=t.operators,u=t.limitToProperty,c=t.dateFormat,d=t.getFieldFilterPickerConfig,h=t.triggerChangeOnInput,f=t.allowedFieldNames;return F({type:t.constructor.childPickerType,fields:null!=n?n:t.getFieldsFromStore(r),filter:e,store:r,disabled:a,readOnly:o,propertyLocked:Boolean(u),valueFieldCls:l,operators:s,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,triggerChangeOnInput:h,allowedFieldNames:f},d?t.callback(d,t,[e]):i)}},{key:"getFieldsFromStore",value:function(e){var t,n;return Object.fromEntries(null!==(t=null===(n=e.modelClass)||void 0===n?void 0:n.fields.map((function(e){return[e.name,{type:e.type}]})))&&void 0!==t?t:[])}},{key:"getPickerRowConfig",value:function(e){var n=this,r=n.disabled,i=n.readOnly,a=n.canDeleteFilter,o=!(a&&!1===n.callback(a,n,[e])),l=!Boolean(e.disabled);return{type:"container",layout:"box",cls:S(S({},"b-".concat(t.type,"-row"),!0),"b-".concat(t.type,"-row-removable"),o),dataset:{separatorText:n.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:r,readOnly:i,checked:l,ariaLabel:n.L("L{FieldFilterPickerGroup.applyCond}",l),internalListeners:{change:"onFilterActiveChange",thisObj:n},cls:"b-".concat(t.type,"-filter-active")},filterPicker:n.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:r,readOnly:i,hidden:!o,cls:"b-transparent b-".concat(t.type,"-remove"),icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:n}}}}}},{key:"allInputs",get:function(){var e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll((function(t){return e.includes(t.type)}))}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.allInputs.forEach((function(t){return t.disabled=e}))}},{key:"updateReadOnly",value:function(e){this.allInputs.forEach((function(t){return t.readOnly=e}))}},{key:"onFilterActiveChange",value:function(e){var t=e.source,n=e.checked,r=this,i=r.getFilterIndex(t),a=r.filters[i],o=r.getFilterPicker(i);t.input.setAttribute("aria-label",r.L("L{FieldFilterPickerGroup.applyCond}",n)),a.disabled=!n,o.onFilterChange(),r.store&&o.isValid&&(r.store.addFilter(a,!0),r.updateStoreFilter()),r.triggerChange()}},{key:"onFilterPickerChange",value:function(e){var t=e.source,n=e.filter,r=e.isValid,i=this,a=i.store,o=i.getFilterIndex(t);a&&(a.removeFilter(n.id,!0),r&&(a.addFilter(n,!0),i.updateStoreFilter())),Object.assign(i.filters[o],n),i.triggerChange()}},{key:"getFilterIndex",value:function(e){return parseInt(e.parent.element.dataset.itemIndex)}},{key:"getPickerRow",value:function(e){return this.widgetMap.pickers.childItems[e]}},{key:"getFilterPicker",value:function(e){return this.getPickerRow(e).widgetMap.filterPicker}},{key:"nextFilterId",get:function(){return this._nextId=(this._nextId||0)+1,"".concat(this.id,"-filter-").concat(this._nextId)}},{key:"removeFilter",value:function(e){var t=e.source,n=this,r=n.getFilterIndex(t),i=n.filters[r],a=n.getPickerRow(r),o=n.query((function(e){return e.isFocusable&&"container"!==e.type&&!a.contains(e)}));o&&o.focus(),n.removeFilterAt(r),n.store&&(n.store.removeFilter(i.id,!0),n.updateStoreFilter()),n.trigger("remove",{filter:i}),n.triggerChange()}},{key:"addFilter",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.property,n=void 0===t?null:t,r=e.operator,a=void 0===r?null:r,o=e.value,l=void 0===o?null:o,s=this,u=s.filters,c={property:s.limitToProperty||n,operator:a,value:l,disabled:!1,id:s.nextFilterId,caseSensitive:!1};if(s.trigger("beforeAddFilter",{filter:c})){var d;if(s.appendFilter(c),s.getFilterPicker(u.length-1).isValid)null===(d=s.store)||void 0===d||d.addFilter(c,!0),s.store&&s.updateStoreFilter();s.trigger("add",{filter:c}),s.triggerChange()}}},{key:"appendFilter",value:function(e){var t=this;t.limitToProperty&&e.property!==t.limitToProperty||(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}},{key:"onStoreFilter",value:function(e){var t=this;if(!t._isUpdatingStore){for(var n=e.filters.values.reduce((function(e,t){return F(F({},e),{},S({},t.id,t))}),{}),r=t.filters.length-1;r>=0;r--){var a=t.filters[r],o=n[a.id],l=t.getPickerRow(r);if(l){var s=l.widgetMap,u=s.filterPicker,c=s.activeCheckbox;if(!o&&u.isValid)t.removeFilterAt(r);else if(o!==i){var d=o.operator,h=o.value,f=o.property,v=o.disabled,g=o.caseSensitive;a!==o&&Object.assign(a,{operator:d,value:h,property:f,disabled:v,caseSensitive:g}),u.filter=a,u.onFilterChange(),c.checked=!v}}}t.appendFiltersFromStore(),t.triggerChange()}}},{key:"removeFilterAt",value:function(e){var t=this.widgetMap.pickers,n=this.filters;t.remove(t.childItems[e]),n.splice(e,1),this.triggerChange()}},{key:"updateStoreFilter",value:function(){var e;this._isUpdatingStore=!0,null===(e=this.store)||void 0===e||e.filter(),this._isUpdatingStore=!1}},{key:"value",get:function(){return this.filters}},{key:"triggerChange",value:function(){var e=this,t=this.filters,n=t.filter((function(t,n){return e.getPickerRow(n).widgetMap.filterPicker.isValid}));this.trigger("change",{filters:t,validFilters:n})}},{key:"activateAll",value:function(){this.setAllActiveStatus(!0)}},{key:"deactivateAll",value:function(){this.setAllActiveStatus(!1)}},{key:"setAllActiveStatus",value:function(e){var t=this,n=t._filters,r=t.store;n.forEach((function(n,i){if(e===n.disabled){var a=t.getPickerRow(i).widgetMap,o=a.filterPicker,l=a.activeCheckbox;n.disabled=!e,o.onFilterChange(),l.checked=e,e&&r&&o.isValid&&r.addFilter(n,!0)}})),t.updateStoreFilter()}},{key:"focusElement",get:function(){var e,n;return null!==(e=null===(n=this.getPickerRow(this._filters.length-1))||void 0===n?void 0:n.widgetMap.filterPicker.focusElement)&&void 0!==e?e:B(t,"focusElement",this,1)}}])}(Ss);ob=sb,S(sb,"$name","FieldFilterPickerGroup"),S(sb,"type","fieldfilterpickergroup"),S(sb,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),S(sb,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,triggerChangeOnInput:!0,allowedFieldNames:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:ob.addFilterButtonDefaultText,cls:"b-".concat(ob.type,"-add-button"),hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),S(sb,"childPickerType","fieldfilterpicker"),sb.initClass(),sb._$name="FieldFilterPickerGroup";var ub=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"files",get:function(){return this.input.files}},{key:"pickFile",value:function(){this.input.click()}},{key:"multiple",get:function(){return this._multiple?"":null}},{key:"clear",value:function(){this.input.value=null}},{key:"triggerChange",value:function(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}],[{key:"configurable",get:function(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}}])}(Uf);S(ub,"$name","FileField"),S(ub,"type","filefield"),ub.initClass(),ub._$name="FileField";var cb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),B(t,"construct",this,3)([e]),n.button.ion({click:n.onButtonClick,thisObj:n}),n.fileField.ion({change:n.onFileFieldChange,thisObj:n}),n._thisIsAUsedExpression(n.fileTip)}},{key:"button",get:function(){return this.widgetMap.fileButton}},{key:"fileField",get:function(){return this.widgetMap.fileField}},{key:"files",get:function(){return this.fileField.files}},{key:"fileTip",get:function(){var e=this;return e._fileTip||(e._fileTip=new pc({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow:function(){var t=e.files;return!(!t||!t.length)&&(this.html="".concat(Array.from(t).map((function(e){return Le.encodeHtml(e.name)})).join("<br>")),!0)}}}))}},{key:"clear",value:function(){var e=this;e.fileField.clear(),e.updateBadge(),e.trigger("clear")}},{key:"onButtonClick",value:function(e){var t=e.event;this.fileField.pickFile(),t.preventDefault()}},{key:"onFileFieldChange",value:function(e){var t=e.valid,n=this;n.updateBadge(),n.triggerFieldChange({files:n.files,valid:t})}},{key:"updateShowBadge",value:function(){this.isConfiguring||this.updateBadge()}},{key:"updateBadge",value:function(){this.button.badge=this.showBadge&&this.files.length||""}}])}(Ss);S(cb,"$name","FilePicker"),S(cb,"type","filepicker"),S(cb,"configurable",{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null,showBadge:!0}),cb.initClass(),cb._$name="FilePicker";var db=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateValue",value:function(e,n){B(t,"updateValue",this,3)([e,n]),e&&this.isConfiguring&&this.onInternalChange({value:e})}},{key:"onInternalChange",value:function(e){var t=e.value,n=this.store,r=this.field,i=this.filterFunction;if(n){var a,o="".concat(r||this.id,"-Filter");if(0===t.length)n.removeFilter(o);else i?a=function(e){return i(e,t)}:(t=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=function(e){var n;return null===(n=e.getValue(r))||void 0===n?void 0:n.match(new RegExp(t,"i"))}),n.filter({id:o,filterBy:a})}}}],[{key:"configurable",get:function(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,ignoreParentReadOnly:!0,keyStrokeChangeDelay:100,internalListeners:{change:"onInternalChange"}}}}])}(iv);S(db,"$name","FilterField"),S(db,"type","filterfield"),db.initClass(),db._$name="FilterField";var hb=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];ne.isWindows&&hb.reverse();var fb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){this.okButton=this.yesButton=1,this.cancelButton=3,B(t,"construct",this,3)(arguments)}},{key:"destroy",value:function(){}},{key:"confirm",value:(i=f(L().mark((function e(){var t=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.showDialog.apply(this,["confirm"].concat(Array.prototype.slice.call(t))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"alert",value:(r=f(L().mark((function e(){var t=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.showDialog.apply(this,["alert"].concat(Array.prototype.slice.call(t))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"prompt",value:(n=f((function(e){var t=arguments,n=this,r=e.textField;return L().mark((function e(){var i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.widgetMap.input,Lo.reconfigure(i,r),i.value=null==r?void 0:r.value,e.abrupt("return",n.showDialog.apply(n,["prompt"].concat(z(t))));case 4:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"showDialog",value:function(e,t){var n=t.message,r=void 0===n?"":n,i=t.title,a=void 0===i?"":i,o=t.cancelButton,l=t.okButton,s=t.align,u=t.modal,c=t.rootElement,d=void 0===c?document.body:c,h=this;return h.rootElement=d,h.getConfig("lazyItems"),h.title=h.optionalL(a),h.widgetMap.message.html=h.optionalL(r),h.showClass="b-messagedialog-".concat(e),h.modal="boolean"!=typeof u||u,h.centered=!s,l&&(l="string"==typeof l?{text:l}:l),o&&(o="string"==typeof o?{text:o}:o),l=Object.assign({},h.widgetMap.okButton.initialConfig,l),o=Object.assign({},h.widgetMap.cancelButton.initialConfig,o),l.text=h.optionalL(l.text),o.text=h.optionalL(o.text),Lo.reconfigure(h.widgetMap.okButton,l),Lo.reconfigure(h.widgetMap.cancelButton,o),h.show({align:s}),h.promise=new Promise((function(e){h.resolve=e}))}},{key:"show",value:function(){var e=li.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:t.fromElement(document.activeElement),B(t,"show",this,3)(arguments)}},{key:"updateShowClass",value:function(e,t){var n=this.element.classList;t&&n.remove(t),e&&n.add(e)}},{key:"doResolve",value:function(e){var t=this,n=t.resolve;if(n){var r="b-messagedialog-prompt"===t.showClass;if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,n(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}},{key:"onInternalKeyDown",value:function(e){"Escape"===e.key?(e.stopImmediatePropagation(),this.onCancelClick()):"Enter"!==e.key||e.target.closest(".b-button")||(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),B(t,"onInternalKeyDown",this,3)([e])}},{key:"onOkClick",value:function(){this.doResolve(vb.okButton)}},{key:"onCancelClick",value:function(){this.doResolve(vb.cancelButton)}}],[{key:"configurable",get:function(){return{ui:"plain",centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:" ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:hb}}}}]);var n,r,i}(fc);S(fb,"$name","MessageDialog"),S(fb,"type","messagedialog"),fb.initClass();var vb=new Proxy({},{get:function(e,t){var n=e.instance||(e.instance=new fb({rootElement:document.body})),r=n[t];return"function"==typeof r?r.bind(n):r}}),gb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"parent",get:function(){return B(t,"parent",this,1)},set:function(e){V(t,"parent",e,this,1,1),this.store||(this.store=e.store)}},{key:"changeStore",value:function(e){var t;return"string"==typeof e?null===(t=this.parent)||void 0===t?void 0:t[e]:e}},{key:"updateStore",value:function(e){var t=this;t.detachListeners("store"),e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t}),e.isLoading&&t.onStoreBeforeRequest())}},{key:"onStoreBeforeRequest",value:function(){this.eachWidget((function(e){return e.disable()}))}},{key:"updateLocalization",value:function(){this.updateSummary(),B(t,"updateLocalization",this,3)([])}},{key:"updateSummary",value:function(){var e=this,t=e.widgetMap,n=t.pageCount,r=t.dataSummary,i=0,a=0,o=0,l=0,s=0;if(e.store){var u=e.store,c=u.pageSize,d=u.currentPage;i=u.count,a=u.lastPage,s=u.totalCount,o=Math.max(0,(d-1)*c+1),l=Math.min(s,o+c-1)}n.html=e.L("L{pageCountTemplate}")({lastPage:a}),r&&(r.html=i?e.L("L{summaryTemplate}")({start:o,end:l,allCount:s}):e.L("L{noRecords}"))}},{key:"onStoreChange",value:function(){var e=this,t=e.widgetMap,n=e.store,r=n.count,i=n.lastPage,a=n.currentPage,o=t.pageNumber,l=t.pageCount,s=t.firstPageButton,u=t.previousPageButton,c=t.nextPageButton,d=t.lastPageButton,h=t.dataSummary;e.eachWidget((function(e){return e.enable()})),o.value=a,o.max=i,h&&(h.disabled=!r),o.disabled=l.disabled=!r,s.disabled=u.disabled=a<=1||!r,c.disabled=d.disabled=a>=i||!r,e.updateSummary()}},{key:"onPageNumberChange",value:function(e){var t=e.value;this.store.currentPage!==t&&this.store.loadPage(t)}},{key:"onFirstPageClick",value:function(){this.store.loadPage(1)}},{key:"onPreviousPageClick",value:function(){this.store.previousPage()}},{key:"onNextPageClick",value:function(){this.store.nextPage()}},{key:"onLastPageClick",value:function(){this.store.loadPage(this.store.lastPage)}},{key:"onReloadClick",value:function(){this.store.loadPage(this.store.currentPage)}}],[{key:"defaultConfig",get:function(){return{defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}}])}(Zu);S(gb,"$name","PagingToolbar"),S(gb,"type","pagingtoolbar"),S(gb,"configurable",{store:null}),gb.initClass(),gb._$name="PagingToolbar";var mb=uu.maps.dockIsHorz,pb={top:0,down:0,left:1,bottom:2,up:2,right:3},yb={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}},kb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doAutoClose",value:function(){this.toggleReveal(!1)}},{key:"updateAutoCloseDelay",value:function(e){var t=this.doAutoClose;(t.suspended=null==e||e<0)||(t.delay=e,t.immediate=!e)}},{key:"changeRecollapseTool",value:function(e){var t=this,n=t.panel;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={recollapse:e}}},{key:"beforeCollapse",value:function(e){if(!1===B(t,"beforeCollapse",this,3)([e]))return!1;this.panel.revealed&&(e.animation=null)}},{key:"applyHeaderDock",value:function(e){var n,r=!(arguments.length>1&&arguments[1]!==i)||arguments[1];null===(n=this.panel)||void 0===n||n.recompose(),B(t,"applyHeaderDock",this,3)([e,r])}},{key:"collapseBegin",value:function(e){var t=this,n=t.collapseDir,r=t.innerElement,i=e.animation,a=t.collapseTool,o=t.panel;t.configuredWidth=o._lastWidth,t.configuredHeight=o._lastHeight,t.applyHeaderDock(!0),t.lockInnerSize(),null==a||a.element.classList.add("b-collapsed"),i&&(o.element.classList.add("b-collapsing"),i.element=r,i.transform=yb[n],e.animation=_s.run(i))}},{key:"onComplete",value:function(e){var n,r;B(t,"onComplete",this,3)([e]);var i=this,a=i.panel,o=a.element;i.autoCloseLeaveDetacher=null===(n=i.autoCloseLeaveDetacher)||void 0===n?void 0:n.call(i),i.autoCloseClickDetacher=null===(r=i.autoCloseClickDetacher)||void 0===r?void 0:r.call(i),i.doAutoClose.cancel(),"reveal"===e&&i.autoClose&&(a.containsFocus&&(i.autoCloseLeaveDetacher=fr.on({element:o,mouseenter:function(e){i.doAutoClose.cancel()},mouseleave:function(e){i.doAutoClose()}})),i.autoCloseClickDetacher=fr.on({element:document.body,thisObj:a,mousedown:function(e){var t;a.owns(e)||null!==(t=i.revealer)&&void 0!==t&&t.contains(e.target)||null==i.autoCloseDelay||i.doAutoClose.now()}})),i.hasPainted||"collapse"!==e||i.innerElement.offsetHeight}},{key:"expandBegin",value:function(e){var t=this,n=e.animation,r=t.collapseDir,i=t.collapseTool,a=t.innerElement,o=t.panel.element;o.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1),t.lockInnerSize(),null==i||i.element.classList.remove("b-collapsed"),n&&(o.classList.add("b-collapsed","b-expanding"),n.element=a,n.transform={from:yb[r].to,to:yb[r].from},e.animation=_s.run(n))}},{key:"expandEnd",value:function(e){B(t,"expandEnd",this,3)([e]);var n=this.panel;e.completed&&(n.revealed=!1),n.element.classList.remove("b-expanding")}},{key:"expandRevert",value:function(e){B(t,"expandRevert",this,3)([e]),this.panel.element.classList.add("b-expanding")}},{key:"innerElement",get:function(){return this.panel.overlayElement}},{key:"innerSizeElement",get:function(){return this.panel.element}},{key:"toolsConfig",get:function(){var e=this.direction,n=B(t,"toolsConfig",this,1),r=this.recollapseTool;return r?F(F({},n),{},{recollapse:r&&Be.assign({direction:e.toLowerCase()},r)}):n}},{key:"lockInnerSize",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],n=this,r=n.panel,a=e&&r.rectangle(),o=e?[0,0,0,0]:"",l=B(t,"lockInnerSize",this,3)([e]);return e&&(o[pb[n.collapseDir]]="-".concat(a[n.collapseDim]+10,"px")),r.element.style.clipPath=e?"inset(".concat(o.join(" "),")"):"",l}},{key:"onOverlayTransitionDone",value:function(e){var t=this,n=t.panel;e.srcElement===n.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(n.revealed?"reveal":"unreveal"))}},{key:"onRevealerClick",value:function(){this.toggleReveal()}},{key:"toggleReveal",value:function(e){var t=this.panel,n=t.element;t.collapsed&&(this.revealer=li.getActiveElement(n),null==e&&(e=!t.revealed),t.revealed!==e&&!1!==t.trigger("beforeToggleReveal",{reveal:e})&&(!e&&n.matches(":focus-within")&&t.revertFocus(!0),this.revealing=!0,t.revealed=e,n.getBoundingClientRect()))}},{key:"updateRevealing",value:function(e){var t=this,n=t.panel,r=/left|right/i.test(t.collapseDir)?"height":"width";n&&(t.innerElement.style[r]="0px",t.innerElement.style["min-".concat(r)]="100%",n.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}},{key:"wrapCollapser",value:function(e,t){var n,r=this,i=r.collapseDir,a=r.panel,o=a.expandedHeaderDock,l=a.header,s=a.uiClassList,u=null===(n=a.tools)||void 0===n?void 0:n.recollapse,c=_(r.splitHeaderItems({as:"element",dock:r.collapseDock}),2),d=c[0],h=c[1],f=mb[o],v=a.hasHeader?a.title||(null==l?void 0:l.title)||" ":null;return u&&(u.direction=i),["overlayElement",{class:F(F({},s),{},S(S(S(S(S({},"b-panel-overlay-header-".concat(o),1),"b-panel-overlay-".concat(i),1),"b-".concat(f?"h":"v","box"),1),"b-panel-overlay",1),"b-box-center",1)),listeners:{transitionend:function(e){return r.onOverlayTransitionDone(e)},transitioncancel:function(e){return r.onOverlayTransitionDone(e)}},children:S({overlayHeaderElement:v&&{tag:"header",class:new Ct(F(F({},s),{},S(S(S({},"b-dock-".concat(o),1),"b-panel-header",1),"b-panel-overlay-header",1)),null==l?void 0:l.cls),children:[].concat(z(d),[{reference:"overlayTitleElement",html:v,class:F(F({},s),{},S(S({},"b-align-".concat((null==l?void 0:l.titleAlign)||"start"),1),"b-header-title",1))}],z(h))}},e,t)}]}}],[{key:"configurable",get:function(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler:function(){var e;null===(e=this.collapsible)||void 0===e||e.toggleReveal()}}}}},{key:"delayable",get:function(){return{doAutoClose:0}}}])}(uu.mixin($i));S(kb,"$name","PanelCollapserOverlay"),S(kb,"type","overlay"),kb.initClass(),kb._$name="PanelCollapserOverlay";var bb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){(arguments.length>0&&arguments[0]!==i?arguments[0]:{}).inputType="password",B(t,"construct",this,3)(arguments),this.element.classList.add("b-textfield")}}])}(Uf);S(bb,"$name","PasswordField"),S(bb,"type","passwordfield"),S(bb,"alias","password"),bb.initClass(),bb._$name="PasswordField";var Cb={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1},wb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){var e=this.id,t=this.min,n=this.max,r=this.showValue,i=this.step,a=this.text,o=this.value,l=this.unit,s=void 0===l?"":l,u=this.disabled,c=this.readOnly,d=this.label,h="".concat(e,"-input"),f=Boolean(a||r),v=i<1?o.toFixed(2):o;return{class:{"b-has-field-label":d,"b-has-label":f,"b-label-before":f,"b-text":f,"b-disabled":u},children:{inputLabel:d?{tag:"label",for:h,text:d,style:{width:this.labelWidth}}:null,input:S(S(S(S(S(S(S({tag:"input",type:"range",id:h,reference:"input"},u?"disabled":"",u),c?"readOnly":"",c),"min",t),"max",n),"step",i),"value",o),"listeners",{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}),valueLabel:f?{tag:"label",class:"b-slider-value",for:h,text:r?a?"".concat(a," (").concat(v).concat(s,")"):v+s:a}:null}}}},{key:"focusElement",get:function(){return this.input}},{key:"percentProgress",get:function(){return(this.value-this.min)/(this.max-this.min)*100}},{key:"onInternalKeyDown",value:function(e){!this.readOnly&&Cb[e.key]&&e.stopImmediatePropagation()}},{key:"onInternalChange",value:function(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}},{key:"onInternalInput",value:function(){var e=this;e.readOnly?e.input.value=e.value:(e.value=e.step<1?parseFloat(e.input.value):parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e))}},{key:"onInternalMouseOver",value:function(){var e,t=this,n=t.rtl?100-t.percentProgress:t.percentProgress;null===(e=t.tooltip)||void 0===e||e.showBy({target:pt.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:"b-t".concat(Math.round(n))})}},{key:"onInternalMouseOut",value:function(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}},{key:"triggerChange",value:function(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}},{key:"updateMax",value:function(e){var t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}},{key:"updateMin",value:function(e){var t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}},{key:"changeTooltip",value:function(e,t){var n;e&&(e.owner=this);var r=this.value,i=this.step<1?r.toFixed(2):r;return this.showTooltip?pc.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:"".concat(i).concat(null!==(n=this.unit)&&void 0!==n?n:"")}}):null}},{key:"changeValue",value:function(e){var t=this,n=t.min,r=t.step;return(e=Math.min(Math.max(e,n),t.max))>n?n+Be.roundTo(e-n,r):Be.roundTo(e,r)}},{key:"updateValue",value:function(e){var t,n=this,r=n.input,i=n._tooltip,a=n.step<1?e.toFixed(2):e;(r&&r.value!==String(e)&&(r.value=e,n.triggerChange(!1)),n.updateUI(),i)&&(i.html="".concat(a).concat(null!==(t=n.unit)&&void 0!==t?t:""))}},{key:"updateUI",value:function(){var e,t,n=this;(null===(e=n._tooltip)||void 0===e?void 0:e.isVisible)&&(null===(t=n._tooltip)||void 0===t||t.alignTo({target:pt.from(n.input).inflate(n.thumbSize/2,-n.thumbSize/2),align:"b-t".concat(Math.round(n.percentProgress))}))}}],[{key:"configurable",get:function(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0,autoClose:!1}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value",twinSyncConfigs:["max","min","step","value"],label:null,labelWidth:null}}}])}(Lo);S(wb,"$name","Slider"),S(wb,"type","slider"),wb.initClass(),wb._$name="Slider";var Db=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){e.checked&&(e.cls=Ct.from(e.cls)||{},e.cls[this.constructor.properties.toggledCls]=1),B(t,"construct",this,3)([e])}},{key:"innerElements",get:function(){var e=B(t,"innerElements",this,1);return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}},{key:"toggleElement",get:function(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}},{key:"internalOnChange",value:function(){B(t,"internalOnChange",this,3)([]),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}],[{key:"properties",get:function(){return{toggledCls:"b-slidetoggle-checked"}}}])}(Jg);S(Db,"$name","SlideToggle"),S(Db,"type","slidetoggle"),Db.initClass(),Db._$name="SlideToggle";var Sb=["b-horizontal","b-vertical"],xb=function(e){return"flex"===li.getStyleValue(e.parentElement,"display")&&(parseInt(li.getStyleValue(e,"flex-basis"),10)||parseInt(li.getStyleValue(e,"flex-grow"),10))},Eb={horizontal:!1,vertical:!0},Rb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;null===(e=this.mouseDetacher)||void 0===e||e.call(this),B(t,"doDestroy",this,3)([])}},{key:"compose",value:function(){return{class:{"b-splitter":1},children:this.showButtons?[ne.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-splitter-inner",children:[{className:"b-splitter-buttons",reference:"splitterButtons",children:[{className:"b-splitter-button-collapse",reference:"collapseButton",children:[ne.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"i",className:"b-icon b-icon-collapse-left b-splitter-collapse-arrow b-splitter-button-icon"}]},{className:"b-splitter-button-expand",reference:"expandButton",children:[ne.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"i",className:"b-icon b-icon-collapse-right b-splitter-expand-arrow b-splitter-button-icon"}]}]}]}]:null,listeners:F({pointerdown:"onMouseDown",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousewheel:"onScroll",dblclick:"onDoubleClick"},!ne.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"})}}},{key:"currentOrientation",get:function(){return this.vertical?"vertical":"horizontal"}},{key:"getSibling",value:function(){for(var e,t=!(arguments.length>0&&arguments[0]!==i)||arguments[0],n=this.element;!e&&(n=n["".concat(t?"next":"previous","ElementSibling")]);)n.isConnected&&!li.isVisible(n)||(e=n);return e}},{key:"nextWidget",get:function(){for(var e,t=this.element;!e&&(t=t.nextElementSibling);)e=Lo.fromElement(t,this.element.parentElement);return e}},{key:"previousWidget",get:function(){for(var e,t=this.element;!e&&(t=t.previousElementSibling);)e=Lo.fromElement(t,this.element.parentElement);return e}},{key:"nextSplitter",get:function(){for(var e,t=this.element;!e&&(t=null===(n=t)||void 0===n?void 0:n.nextElementSibling);){var n,r=Lo.fromElement(t,this.element.parentElement);"splitter"===(null==r?void 0:r.type)&&(e=r)}return e}},{key:"previousSplitter",get:function(){for(var e,t=this.element;!e&&(t=null===(n=t)||void 0===n?void 0:n.previousElementSibling);){var n,r=Lo.fromElement(t,this.element.parentElement);"splitter"===(null==r?void 0:r.type)&&(e=r)}return e}},{key:"updateContainerElement",value:function(e){var t,n=this;n.stateDetector=null===(t=n.stateDetector)||void 0===t?void 0:t.disconnect(),e&&(n.stateDetector=new MutationObserver((function(){return n.syncState()})),n.stateDetector.observe(e,{attributes:!0,childList:!0}))}},{key:"updateNextNeighbor",value:function(e){this.watchNeighbor(e,"next")}},{key:"updatePreviousNeighbor",value:function(e){this.watchNeighbor(e,"previous")}},{key:"watchNeighbor",value:function(e,t){this.detachListeners(t),null==e||e.ion({name:t,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}},{key:"updateOrientation",value:function(){this.syncState.now()}},{key:"updateVertical",value:function(e){var t,n=null===(t=this.element)||void 0===t?void 0:t.classList;null==n||n.add(Sb[e?1:0]),null==n||n.remove(Sb[e?0:1])}},{key:"syncState",value:function(e){var t,n,r,i,a,o,l,s=this,u=s.element,c=s.nextWidget,d=s.previousWidget,h=s.nextSplitter,f=s.previousSplitter,v=null!==(t=Eb[s.orientation])&&void 0!==t?t:null;(s.nextNeighbor=c,s.previousNeighbor=d,s.disabled=!s.showButtons&&(c&&(c.collapsible&&c.collapsed||c.hidden)||d&&(d.collapsible&&d.collapsed||d.hidden)),"collapsed"===(null==h||null===(n=h.collapseState)||void 0===n?void 0:n.status)||"expanded"===(null==f||null===(r=f.collapseState)||void 0===r?void 0:r.status)||"collapsed"===(null===(i=s.collapseState)||void 0===i?void 0:i.status)||"expanded"===(null===(a=s.collapseState)||void 0===a?void 0:a.status)?s.element.classList.add("b-drag-disabled"):s.element.classList.remove("b-drag-disabled"),"expand"===(null==e?void 0:e.type)&&s.showButtons)?(((null==e?void 0:e.source)===d&&"collapsed"===(null===(o=s.collapseState)||void 0===o?void 0:o.status)||(null==e?void 0:e.source)===c&&"expanded"===(null===(l=s.collapseState)||void 0===l?void 0:l.status))&&(s.collapseState=null,u.classList.remove("b-drag-disabled","b-show-buttons")),s.setSplitterButtonPosition(),s.setButtonVisibility()):"collapse"===(null==e?void 0:e.type)&&s.showButtons&&(e.source!==d||s.collapseState?e.source!==c||s.collapseState||(s.collapseState={status:"expanded"}):s.collapseState={status:"collapsed"},u.classList.add("b-drag-disabled","b-show-buttons"),s.setSplitterButtonPosition(),s.setButtonVisibility());if(null!==v&&c&&d)s.containerElement=null;else if(s.containerElement=u.parentElement,s.rendered&&u.offsetParent){var g=li.getStyleValue(u.parentElement,"flex-direction");if(g)v=!g.startsWith("column");else{var m=u.previousElementSibling,p=u.nextElementSibling;if(!m||!p)return;var y=m.getBoundingClientRect(),k=p.getBoundingClientRect(),b=y.top<k.top?y:k,C=b===k?y:k;v=b.top===C.top}}s.vertical=v}},{key:"setButtonVisibility",value:function(){var e,t,n,r,i,a,o=this.showButtons,l=this.collapseState,s=this.collapseButton,u=this.expandButton,c=this.nextWidget,d=this.previousWidget,h=this.nextSplitter,f=this.previousSplitter;"start"===o||"end"===o?"collapsed"===(null==l?void 0:l.status)||"expanded"===(null==l?void 0:l.status)?(s.classList.toggle("b-disabled","collapsed"===l.status),u.classList.toggle("b-disabled","expanded"===l.status)):(s.classList.toggle("b-disabled","start"!==o&&!(null!=d&&d.collapsible)||"expanded"===(null==f||null===(n=f.collapseState)||void 0===n?void 0:n.status)),u.classList.toggle("b-disabled","end"!==o&&!(null!=c&&c.collapsible)||"collapsed"===(null==h||null===(r=h.collapseState)||void 0===r?void 0:r.status))):(s.classList.toggle("b-disabled",!o||"collapsed"===(null==l?void 0:l.status)||"expanded"===(null==f||null===(i=f.collapseState)||void 0===i?void 0:i.status)),u.classList.toggle("b-disabled",!o||"expanded"===(null==l?void 0:l.status)||"collapsed"===(null==h||null===(a=h.collapseState)||void 0===a?void 0:a.status)));"expanded"!==(null==l?void 0:l.status)&&"collapsed"===(null==f||null===(e=f.collapseState)||void 0===e?void 0:e.status)?f.setButtonVisibility():"collapsed"!==(null==l?void 0:l.status)&&"expanded"===(null==h||null===(t=h.collapseState)||void 0===t?void 0:t.status)&&h.setButtonVisibility()}},{key:"setSplitterButtonPosition",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:0,t=this.vertical,n=this.splitterButtons,r=this.element.parentElement;if(t){var a=r.clientHeight,o=r.scrollTop+e,l=Math.min(Math.max(0,o),r.scrollHeight-a)+a/2;n.style.top="".concat(l,"px")}else{var s=r.clientWidth,u=r.scrollLeft+e,c=Math.min(Math.max(0,u),r.scrollWidth-s)+s/2;n.style.left="".concat(c,"px")}}},{key:"restoreOriginalState",value:function(){var e=this.nextNeighbor,t=this.previousNeighbor,n=this.collapseState,r=this.vertical,i=t?t.element:this.getSibling(!1),a=e?e.element:this.getSibling();n&&(r?(n.prevHasFlex?i.style.flexGrow=n.prevFlexGrow:i.style.width="".concat(n.prevWidth,"px"),n.nextHasFlex?a.style.flexGrow=n.nextFlexGrow:a.style.width="".concat(n.nextWidth,"px")):(n.prevHasFlex?i.style.flexGrow=n.prevFlexGrow:i.style.height="".concat(n.prevHeight,"px"),n.nextHasFlex?a.style.flexGrow=n.nextFlexGrow:a.style.height="".concat(n.nextHeight,"px")))}},{key:"lockFlexedSiblings",value:function(){var e,t=[],n=D(this.element.parentElement.children);try{for(n.s();!(e=n.n()).done;){var r,i=e.value;xb(i)&&i!==this.element&&"splitter"!==(null===(r=Lo.fromElement(i,this.element.parentElement))||void 0===r?void 0:r.type)&&t.push({child:i,width:i.offsetWidth,height:i.offsetHeight})}}catch(e){n.e(e)}finally{n.f()}for(var a=0,o=t;a<o.length;a++){var l=o[a];l.child.style.flexGrow=this.vertical?l.width:l.height,l.child.style.flexBasis=0}}},{key:"onDoubleClick",value:function(e){(e.ctrlKey?this.element.parentElement.querySelectorAll(":scope > :not(.b-splitter)"):[this.getSibling(!1),this.getSibling()]).forEach((function(e){return e&&(e.style.flex="1 1 0px")}))}},{key:"onMouseDown",value:function(e){var t,n,r,i,a=this,o=e.target;o.closest(".b-splitter-button-collapse")?a.onCollapseClick(e):o.closest(".b-splitter-button-expand")?a.onExpandClick(e):"collapsed"!==(null===(t=a.collapseState)||void 0===t?void 0:t.status)&&"expanded"!==(null===(n=a.collapseState)||void 0===n?void 0:n.status)&&"collapsed"!==(null===(r=a.nextSplitter)||void 0===r||null===(r=r.collapseState)||void 0===r?void 0:r.status)&&"expanded"!==(null===(i=a.previousSplitter)||void 0===i||null===(i=i.collapseState)||void 0===i?void 0:i.status)&&a.startMove(e)}},{key:"startMove",value:function(e){var t;e.preventDefault(),e.touches&&(e=e.touches[0]);var n=this,r=n.element,i=n.nextNeighbor,a=n.previousNeighbor,o=a?a.element:n.getSibling(!1),l=i?i.element:n.getSibling(),s=xb(o),u=xb(l),c=[];null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.showButtons&&(n.collapseState=null,n.setButtonVisibility());var d,h=D(r.parentElement.children);try{for(h.s();!(d=h.n()).done;){var f,v=d.value;xb(v)&&v!==r&&"splitter"!==(null===(f=Lo.fromElement(v,r.parentElement))||void 0===f?void 0:f.type)&&c.push({element:v,width:v.offsetWidth,height:v.offsetHeight})}}catch(e){h.e(e)}finally{h.f()}n.context={startX:e.pageX,startY:e.pageY,prevWidth:o.offsetWidth,prevHeight:o.offsetHeight,nextWidth:l.offsetWidth,nextHeight:l.offsetHeight,prevHasFlex:s,nextHasFlex:u,flexed:c,prev:o,next:l};var g={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:n};ne.supportsPointerEvents||(g.mousemove=g.touchmove="onMouseMove",g.mouseup=g.touchend="onMouseUp"),r.classList.add("b-moving"),n.mouseDetacher=fr.on(g),n.trigger("splitterMouseDown",{event:e})}},{key:"onMouseEnter",value:function(e){var t=this;t.syncState(),t.trigger("splitterMouseEnter",{event:e}),t.showButtons&&(t.setSplitterButtonPosition(),t.setButtonVisibility()),t.element.classList.add("b-hover")}},{key:"onMouseLeave",value:function(e){this.trigger("splitterMouseLeave",{event:e}),this.element.classList.remove("b-hover")}},{key:"onMouseMove",value:function(e){var t=this.context,n=this.nextWidget,r=this.previousWidget,i=this.vertical,a=this.rtl,o=t.prev.style,l=t.next.style,s=(e.pageX-t.startX)*(a?-1:1),u=e.pageY-t.startY;if(e.preventDefault(),Object.assign(t,{deltaX:s,deltaY:u}),t.started||(t.started=!0,this.trigger("dragStart",{context:t,event:e}),t.flexed.forEach((function(e){e.element.style.flexGrow=i?e.width:e.height,e.element.style.flexBasis="0"}))),i){var c=t.prevWidth+s,d=t.nextWidth-s;t.prevHasFlex?o.flexGrow=c:r?r.width=c:o.width="".concat(c,"px"),t.nextHasFlex?l.flexGrow=d:n?n.width=d:l.width="".concat(d,"px")}else{var h=t.prevHeight+u,f=t.nextHeight-u;t.prevHasFlex?o.flexGrow=h:r?r.height=h:o.height="".concat(h,"px"),t.nextHasFlex?l.flexGrow=f:n?n.height=f:l.height="".concat(f,"px")}this.trigger("drag",{context:t,event:e})}},{key:"onMouseUp",value:function(e){var t,n=this;null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.mouseDetacher=null,n.element.classList.remove("b-moving"),n.context.started&&n.trigger("drop",{context:n.context,event:e}),n.context=null}},{key:"onScroll",value:function(e){var t=e.deltaY,n=e.shiftKey,r=this.vertical;(n&&!r||!n&&r)&&this.setSplitterButtonPosition(t)}},{key:"onCollapseClick",value:function(e){var t,n=this,r=n.nextNeighbor,i=n.nextWidget,a=n.previousNeighbor,o=n.previousWidget,l=n.collapseState,s=n.showButtons,u=n.vertical,c=a?a.element:n.getSibling(!1),d=r?r.element:n.getSibling(),h=xb(c),f=xb(d);if(("end"!==s||null!=o&&o.collapsible||"expanded"===(null==l?void 0:l.status))&&"collapsed"!==(null==l?void 0:l.status)){e.stopPropagation();var v={status:"collapsed"};if(n.element.classList.toggle("b-show-buttons",!l),o&&(null==l||!l.status)&&u&&o.minWidth>0?(v=F(F({},v),{},{prevMinWidth:o.minWidth}),o.minWidth=0):o&&(null==l||!l.status)&&!u&&o.minHeight>0&&(v=F(F({},v),{},{prevMinHeight:o.minHeight}),o.minHeight=0),i&&"expanded"===(null==l?void 0:l.status)&&(null!=l&&l.nextMinWidth||null!=l&&l.nextMinHeight)&&(u?i.minWidth=l.nextMinWidth:i.minHeight=l.nextMinHeight),l||null==o||!o.collapsible||null!=o&&o.collapsed)if("expanded"===(null==l?void 0:l.status)&&null!=i&&i.collapsible&&(null!=i&&i.collapsed||null!=i&&null!==(t=i.collapsible)&&void 0!==t&&t.collapsed))i.collapsible.isPanelCollapser?i.collapsible.collapse(!1):i.expand();else if("expanded"===(null==l?void 0:l.status))n.restoreOriginalState();else if(n.lockFlexedSiblings(),v=F(F({},v),{},{prevWidth:c.offsetWidth,prevHeight:c.offsetHeight,prevHasFlex:h,prevFlexGrow:h?c.style.flexGrow:null,nextWidth:d.offsetWidth,nextHeight:d.offsetHeight,nextHasFlex:f,nextFlexGrow:f?d.style.flexGrow:null}),n.vertical){var g,m=c.offsetWidth+d.offsetWidth;h?c.style.flexGrow=1:c.style.width="0px","collapsed"!==(null===(g=n.nextSplitter)||void 0===g||null===(g=g.collapseState)||void 0===g?void 0:g.status)?f?d.style.flexGrow=m:d.style.width="".concat(m,"px"):f?d.style.flexGrow=1:d.style.width="0px"}else{var p,y=c.offsetHeight+d.offsetHeight;h?c.style.flexGrow=1:c.style.height="0px","collapsed"!==(null===(p=n.nextSplitter)||void 0===p||null===(p=p.collapseState)||void 0===p?void 0:p.status)?f?d.style.flexGrow=y:d.style.height="".concat(y,"px"):f?d.style.flexGrow=1:d.style.height="0px"}else o.collapsible.isPanelCollapser?o.collapsible.collapse():o.collapse();n.collapseState=l?null:v,n.element.classList.toggle("b-drag-disabled",!l),n.setButtonVisibility()}}},{key:"onExpandClick",value:function(e){var t,n=this,r=n.nextNeighbor,i=n.nextWidget,a=n.previousNeighbor,o=n.previousWidget,l=n.collapseState,s=n.showButtons,u=n.vertical,c=a?a.element:n.getSibling(!1),d=r?r.element:n.getSibling(),h=xb(c),f=xb(d);if(("start"!==s||null!=i&&i.collapsible||"collapsed"===(null==l?void 0:l.status))&&"expanded"!==(null==l?void 0:l.status)){e.stopPropagation();var v={status:"expanded"};if(n.element.classList.toggle("b-show-buttons",!l),(null==l||!l.status)&&u&&i.minWidth>0?(v=F(F({},v),{},{nextMinWidth:i.minWidth}),i.minWidth=0):null!=l&&l.status||u||!(i.minHeight>0)||(v=F(F({},v),{},{nextMinHeight:i.minHeight}),i.minHeight=0),o&&"collapsed"===(null==l?void 0:l.status)&&(null!=l&&l.prevMinWidth||null!=l&&l.prevMinHeight)&&(u?o.minWidth=l.prevMinWidth:o.minHeight=l.prevMinHeight),l||null==i||!i.collapsible||null!=i&&i.collapsed)if("collapsed"===(null==l?void 0:l.status)&&null!=o&&o.collapsible&&(null!=o&&o.collapsed||null!=o&&null!==(t=o.collapsible)&&void 0!==t&&t.collapsed))o.collapsible.isPanelCollapser?o.collapsible.collapse(!1):o.expand();else if("collapsed"===(null==l?void 0:l.status))n.restoreOriginalState();else if(n.lockFlexedSiblings(),v=F(F({},v),{},{prevWidth:c.offsetWidth,prevHeight:c.offsetHeight,prevHasFlex:h,prevFlexGrow:h?c.style.flexGrow:null,nextWidth:d.offsetWidth,nextHeight:d.offsetHeight,nextHasFlex:f,nextFlexGrow:f?d.style.flexGrow:null}),n.vertical){var g,m=c.offsetWidth+d.offsetWidth;"expanded"!==(null===(g=n.previousSplitter)||void 0===g||null===(g=g.collapseState)||void 0===g?void 0:g.status)?h?c.style.flexGrow=m:c.style.width="".concat(m,"px"):h?c.style.flexGrow=1:c.style.width="0px",f?d.style.flexGrow=1:d.style.width="0px"}else{var p,y=c.offsetHeight+d.offsetHeight;"expanded"!==(null===(p=n.previousSplitter)||void 0===p||null===(p=p.collapseState)||void 0===p?void 0:p.status)?h?c.style.flexGrow=y:c.style.height="".concat(y,"px"):h?c.style.flexGrow=1:c.style.height="0px",f?d.style.flexGrow=1:d.style.height="0px"}else i.collapsible.isPanelCollapser?i.collapsible.collapse():i.collapse();n.collapseState=l?null:v,n.element.classList.toggle("b-drag-disabled",!l),n.setButtonVisibility()}}},{key:"render",value:function(){B(t,"render",this,3)(arguments),this.syncState.now(),null===this.vertical&&this.syncState()}}],[{key:"configurable",get:function(){return{orientation:"auto",showButtons:!1,vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}},{key:"delayable",get:function(){return{syncState:"raf"}}}])}(Lo);S(Rb,"$name","Splitter"),S(Rb,"type","splitter"),Rb.initClass(),Rb._$name="Splitter";var Tb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(e){var t=this.active,n=this.cls,r=this.index,i=this.isFirst,a=this.isLast,o=this.closable,l=this.owner.visibleChildCount;return o&&(e.children.closeIcon={tag:"i",class:"b-tab-close b-icon b-icon-close"}),{tabindex:0,"aria-selected":t,"aria-setsize":l,"aria-posinset":r+1,class:F({"b-tabpanel-tab":1,"b-active":t,"b-tab-first":i,"b-tab-last":a},n),dataset:{index:r}}}},{key:"updateIndex",value:function(e){this.isFirst=!e}},{key:"updateItem",value:function(e,t){var n,r,i=this;(null==t?void 0:t.tab)===i&&(t.tab=null),e&&(e.tab=i,i[i.titleProperty]=e[i.titleSource],i.itemCls=e.cls,i.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),null===(n=i.itemChangeDetacher)||void 0===n||n.call(i),i.itemChangeDetacher=e&&Tt.after(e,"onConfigChange","onItemConfigChange",i,{return:!1}),null===(r=i.itemHideDetacher)||void 0===r||r.call(i),i.itemHideDetacher=null==e?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:i,prio:1e3}),i.syncMinMax()}},{key:"updateItemCls",value:function(e,t){var n=this.element,r=n&&Ct.from(null==n?void 0:n.classList,!0);n&&(r.remove(t).add(e),n.className=r.value)}},{key:"updateRotate",value:function(e,t){!e!=!t&&this.syncMinMax()}},{key:"syncMinMax",value:function(){var e=this,t=e.rotate,n=e.tabPanel,r=e._minWidth,i=e._minHeight,a=e._maxWidth,o=e._maxHeight;if(n){var l=n.tabMinWidth,s=n.tabMaxWidth;null!=l&&(t?(r===l&&(r=null),i=l):(i===l&&(i=null),r=l)),null!=s&&(t?(a===s&&(a=null),o=s):(o===s&&(o=null),a=s)),e.minWidth=r,e.minHeight=i,e.maxWidth=a,e.maxHeight=o}}},{key:"onItemBeforeChangeHidden",value:function(e){var t=e.source,n=e.hidden;if(!t.$isDeactivating&&!t.$isActivating){var r=this.tabPanel;this.hidden=n,n&&t===r.activeItem&&r.activateAvailableTab(t)}}},{key:"onItemBeforeHide",value:function(){this.item.$isDeactivating||this.hide()}},{key:"onItemBeforeUpdateDisabled",value:function(e){var t=e.source,n=e.disabled,r=this.tabPanel;this.disabled=n,t===r.activeItem&&r.activateAvailableTab(t)}},{key:"onItemConfigChange",value:function(e){var t=e.name,n=e.value;t===this.titleSource&&(this[this.titleProperty]=n)}},{key:"closable",get:function(){return this._closable&&!(this.isFirst&&this.isLast)}}],[{key:"configurable",get:function(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",closable:null,role:"tab"}}}])}(Nu);S(Tb,"$name","Tab"),S(Tb,"type","tab"),Tb.initClass(),Tb._$name="Tab";var Mb=function(e){return e.isTab},Fb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"firstTab",get:function(){return this.tabAt(0)}},{key:"lastTab",get:function(){return this.tabAt(-1)}},{key:"tabCount",get:function(){return this._items.countOf(Mb)}},{key:"tabs",get:function(){return $e.from(this._items,Mb)}},{key:"compose",value:function(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}},{key:"indexOfTab",value:function(e){return this._items.indexOf(e,Mb)}},{key:"onChildAdd",value:function(e){B(t,"onChildAdd",this,3)([e]),null==e.index&&this.syncTabs()}},{key:"onChildRemove",value:function(e){B(t,"onChildRemove",this,3)([e]),this.syncTabs()}},{key:"onFocusIn",value:function(e){var t=e._target,n=this.owner.activeIndex;null!=t&&t.matches(".b-tab:focus-visible")&&!isNaN(n)&&this.tabs[n].focus()}},{key:"syncTabs",value:function(){for(var e=this.tabs,t=0,n=e.length;t<n;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===n-1}},{key:"tabAt",value:function(e){return this._items.find(Mb,e)||null}},{key:"onChildMove",value:function(){this.syncTabs()}},{key:"onDrop",value:function(e){var n=e.context,r=n.item,i=n.valid,a=n.oldIndex,o=this.owner;if(B(t,"onDrop",this,3)(arguments),i&&o){var l=this.owner,s=r.active,u=Array.from(r.element.parentElement.children).indexOf(r.element);l.insert(l.items[a],u),s&&(l.layout.setActiveItem(u,a,{animation:!1,silent:!0}),l.activeTab=r.item)}}}])}(Zu);S(Fb,"$name","TabBar"),S(Fb,"type","tabbar"),S(Fb,"configurable",{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}),Fb.initClass(),Fb._$name="TabBar";var Ab=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],Ib={preventScroll:!0},Lb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onChildAdd",value:function(e){B(t,"onChildAdd",this,3)([e]);var n=this,r=n.activeItem,i=n.owner,a=null!=i.activeIndex?i.activeIndex:n.activeIndex||0,o=i.items.indexOf(e),l=null!=r?e===r:o===a;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",show:{fn:"onChildShow",prio:99999},thisObj:n}),l?(n._activeIndex=o,n._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}},{key:"onChildRemove",value:function(e){B(t,"onChildRemove",this,3)([e]);var n=this;n._activeItem===e&&n.activateSiblingOf(e),n._activeIndex=n.owner.items.indexOf(n._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",show:"onChildShow",thisObj:n})}},{key:"onBeforeChildShow",value:function(e){var t=e.source;if(!this.owner.isConfiguring&&!t.$isActivating)return this.activeItem=t,!1}},{key:"onChildShow",value:function(e){var t=e.source;this._activeItem=t}},{key:"onBeforeChildHide",value:function(e){var t=e.source;if(!this.owner.isConfiguring&&!t.$isDeactivating)return this.activateSiblingOf(t),!1}},{key:"activateSiblingOf",value:function(e){var t=this.owner.items.slice(),n=t.indexOf(e);t.splice(n,1),this.activeIndex=Math.min(n,t.length-1)}},{key:"setActiveItem",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.activeIndex,n=arguments.length>2?arguments[2]:i,r=this,a=r.owner,o=a.items,l=e instanceof Lo,s=o[t],u=a.items[e=l?o.indexOf(e):parseInt(e,10)],c=!1!==(null==n?void 0:n.animation),d=!(null!=n&&n.silent),h={prevActiveIndex:t,prevActiveItem:s,containedFocus:null==s?void 0:s.element.matches(":focus-within"),ownerContainedFocus:a.element.matches(":focus-within")};if(u&&!u.$isActivating&&u!==s){var f,v=s&&s.element,g=u&&u.element;if(r.animateDetacher){var m,p,y=r.animateDetacher.event;if(y.activeItem===u)return y.promise;r.animateDetacher(),(m=y.prevActiveItem.element.classList).remove.apply(m,Ab),(p=y.activeItem.element.classList).remove.apply(p,Ab),r.animateDetacher=null}if(h.activeIndex=e,h.activeItem=u,d&&!1===a.trigger("beforeActiveItemChange",h))return null;var k=r._activeIndex!==h.activeIndex;k&&(r._activeIndex=h.activeIndex),d&&(null===(f=a.onBeginActiveItemChange)||void 0===f||f.call(a,h)),k&&(r._activeIndex=h.prevActiveIndex),c&&v&&a.isVisible&&r.animateCardChange?h.promise=r.cardChangeAnimation=new Promise((function(i,o){var l=s.monitorResize;s.monitorResize=!1,r.contentElement.style.overflowX="hidden",s._hidden=!0,u.$isActivating=!0,u.show(),a.element.matches(":focus-within")&&u.focus(Ib),u.$isActivating=!1,v.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),g.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),a.isAnimating=!0,r.animateDetacher=fr.onTransitionEnd({mode:"animation",element:g,thisObj:s,handler:function(){var o;if(a.isAnimating=r.cardChangeAnimation=!1,r.animateDetacher){var u;if(r.animateDetacher=null,(o=g.classList).remove.apply(o,Ab),v)(u=v.classList).remove.apply(u,Ab),s.$isDeactivating=!0,s._hidden=!1,s.hide(),s.monitorResize=l,s.$isDeactivating=!1;r.contentElement.style.overflowX="",r.onActiveItemChange(h,i,!d)}else r.setActiveItem(e,t,n)}}),r.animateDetacher.reject=o,r.animateDetacher.event=h})):(u.$isActivating=!0,u.show(),a.element.matches(":focus-within")&&u.focus(Ib),u.$isActivating=!1,s&&(s.$isDeactivating=!0,s.hide(),s.$isDeactivating=!1),r.onActiveItemChange(h,null,!d))}return h}},{key:"onActiveItemChange",value:function(e,t,n){var r=this,i=r.owner,a=e.activeItem;r._activeItem=a,r._activeIndex=e.activeIndex,!n&&i.trigger("activeItemChange",e),e.ownerContainedFocus&&!a.element.matches(":focus-within")&&a.focus(Ib),null==t||t(e)}},{key:"renderChildren",value:function(){var e=this.owner;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),B(t,"renderChildren",this,3)([])}},{key:"changeActiveIndex",value:function(e){var t=this.owner;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}},{key:"updateActiveIndex",value:function(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}},{key:"updateActiveItem",value:function(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}},{key:"isChangingCard",get:function(){return Boolean(this.animateDetacher)}},{key:"insertChild",value:function(e){var n=this;if(n.owner.items.includes(e)){var r=n.activeItem,i=e===r;i&&(n._activeItem=null);var a=B(t,"insertChild",this,3)(arguments);return i||(n._activeIndex=n.owner.items.indexOf(r)),a}return B(t,"insertChild",this,3)(arguments)}}])}(Po);S(Lb,"$name","Card"),S(Lb,"type","card"),S(Lb,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),Lb.initClass(),Lb._$name="Card";var Ob=function(e){return e.maximized},Pb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"activeIndex",get:function(){return this.layout.activeIndex}},{key:"activeItem",get:function(){return this.layout.activeItem}},{key:"activeTabItemIndex",get:function(){var e,t=this.activeTab,n=this.items,r=this.tabBar;return n.indexOf(null===(e=r.tabs[t])||void 0===e?void 0:e.item)}},{key:"bodyConfig",get:function(){return Be.merge({className:{"b-tabpanel-body":1}},B(t,"bodyConfig",this,1))}},{key:"focusElement",get:function(){var e,t=this.items[this.activeTab||0];return(null==t?void 0:t.focusElement)||(null==t||null===(e=t.tab)||void 0===e?void 0:e.focusElement)}},{key:"tabPanelBody",get:function(){return this.bodyElement}},{key:"finalizeInit",value:function(){B(t,"finalizeInit",this,3)([]);var e=this,n=e.activeTab,r=e.layout,i=r.activeIndex,a=e.tabBar.tabs,o=n>=0&&n<a.length&&e.items.indexOf(a[n].item);if(a.length>0&&(!1===o||o<0))throw new Error("Invalid activeTab ".concat(n," (").concat(a.length," tabs)"));o!==i&&r.setActiveItem(o,i,{animation:!1,silent:!0}),r.animateCardChange=e.animateTabChange}},{key:"onChildAdd",value:function(e){var n=this;if(B(t,"onChildAdd",this,3)([e]),!n.initialItems){var r=n.tabBar,i=n.makeTabConfig(e),a=i&&(null==r?void 0:r.firstTab),o=a&&r._items,l=a&&$e.from(n._items,(function(t){return t.tab||t===e})),s=a?l.indexOf(e)+o.indexOf(a):0;i&&r&&(a&&null==e.weight&&s<o.count-1?r.insert(i,s):r.add(i))}}},{key:"onChildRemove",value:function(e){var n=this,r=e.tab,i=n.items;r&&(n.tabBar.remove(r),r.destroy()),e===n.activeItem&&(n._activeTab=null,i.length&&(n.activeTab=i[Math.min(n.activeIndex,i.length-1)])),B(t,"onChildRemove",this,3)([e]),e.tabBarItems&&n.tabBar.remove(e.tabBarItems)}},{key:"isDisabledOrHiddenTab",value:function(e){var t=this.tabBar.tabs,n=null==t?void 0:t[e];return n&&(n.disabled||n.hidden)}},{key:"findAvailableTab",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:1,r=this.tabBar.tabs,a=r.length,o=Math.max(0,r.indexOf(e.tab));o&&(n=-n);for(var l=1;l<=a&&(t=(o+(n<0?a:0)+l*n)%a,this.isDisabledOrHiddenTab(t));++l);return t}},{key:"activateAvailableTab",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:1;this.activeTab=this.findAvailableTab(e,t)}},{key:"changeActiveTab",value:function(e,t){var n=this,r=n.tabBar,i=n.layout,a=r.tabCount;if(e.isWidget||Be.isObject(e)?(-1===n.items.indexOf(e)&&(e=n.add(e)),e=r.indexOfTab(e.tab)):e=parseInt(e,10),!n.initialItems&&a>0&&(e<-1||e>=a))throw new Error("Invalid activeTab ".concat(e," (").concat(a," tabs)"));if(n.isDisabledOrHiddenTab(e)&&(e=n.findAvailableTab(e)),!i.animateCardChange||!i.cardChangeAnimation)return e;i.cardChangeAnimation.then((function(r){(null==r?void 0:r.activeIndex)!==e&&(n._activeTab=e,n.updateActiveTab(e,t))}))}},{key:"updateActiveTab",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this).initialItems){e.next=11;break}if(i=r.activeTabItemIndex,a=r.layout,!(i>-1)){e.next=10;break}if(o=r.items[i],a.activeItem===o){e.next=10;break}if(!a.animateCardChange){e.next=9;break}return e.next=9,r.tabSelectionPromise;case 9:r.tabSelectionPromise=null===(l=a.setActiveItem(o))||void 0===l?void 0:l.promise;case 10:r.tabBar.remove(r.tabBar.items.filter((function(e){return!e.isTab&&e.trueOwner})));case 11:null!=(s=r.items[t])&&s.tabBarItems&&(s.tabBarItems=r.tabBar.add(s.tabBarItems),s.tabBarItems.forEach((function(e){return e.trueOwner=s})));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"changeTabBar",value:function(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}},{key:"makeTabConfig",value:function(e){var t=e.tab,n={item:e,type:"tab",active:!e.hidden,tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return!1===t?null:Be.isObject(t)?Tb.mergeConfigs(n,t):n}},{key:"updateAnimateTabChange",value:function(e){this.isConfiguring||(this.layout.animateCardChange=e)}},{key:"updateItems",value:function(e,n){var r,i=this,a=i.activeTab,o=i.initialItems,l=0;B(t,"updateItems",this,3)([e,n]),o&&(r=Array.from(e,(function(e){return i.makeTabConfig(e)})).filter((function(e){if(e)return e.index=l++,!0})),l&&(r[a].active=!0,i.tabBar.add(r),i.activeTab=a))}},{key:"updateTabMinWidth",value:function(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((function(t){t.isTab&&(t.minWidth=e)}))}},{key:"updateTabMaxWidth",value:function(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((function(t){t.isTab&&(t.maxWidth=e)}))}},{key:"updateAutoHeight",value:function(e){this.detachListeners("themeAutoHeight"),e&&Wn.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this})}},{key:"applyAutoHeight",value:function(){var e=this,t=e.layout,n=e.activeTab,r=e.element,i=t.animateCardChange;if(t.animateCardChange=!1,e.flex="0 0 0%",!e.up(Ob)){var a=e.height=Math.max.apply(Math,z(e.items.map((function(t){return e.activeTab=t,r.clientHeight}))))+1;e.flex="1 1 ".concat(a,"px")}e.activeTab=n,t.animateCardChange=i}},{key:"internalOnThemeChange",value:function(){this.isVisible&&this.applyAutoHeight()}},{key:"onBeginActiveItemChange",value:function(e){var t=this.tabBar.tabs,n=e.activeItem,r=e.prevActiveItem;this.activeTab=t.indexOf(null==n?void 0:n.tab),null!=r&&r.tab&&(r.tab.active=!1),null!=n&&n.tab&&(n.tab.active=!0,n.tab.show())}},{key:"onBeforeActiveItemChange",value:function(e){return this.trigger("beforeTabChange",e)}},{key:"onActiveItemChange",value:function(e){this.trigger("tabChange",e)}},{key:"onTabClick",value:function(e){var t=e.source.item;t.tab.closable&&e.event.target.classList.contains("b-tab-close")?this.remove(t):this.activeTab=t}},{key:"onInternalPaint",value:function(){B(t,"onInternalPaint",this,3)(arguments),this.autoHeight&&this.applyAutoHeight()}},{key:"onValidityChange",value:function(e){var t=e.source,n=e.valid,r=t.closest((function(e){return e.element.classList.contains("b-tabpanel-item")})).tab;r.element.classList.toggle("b-invalid",!n),r.ariaLabel=n?"":this.L("L{TabPanel.containsInvalidFields}")}}]);var n}(uc);S(Pb,"$name","TabPanel"),S(Pb,"type","tabpanel"),S(Pb,"alias","tabs"),S(Pb,"configurable",{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}),Pb.initClass(),Pb._$name="TabPanel";var _b=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateResize",value:function(e){this.input.style.resize=e}}],[{key:"configurable",get:function(){return{resize:"none",inputAttributes:{tag:"textarea"}}}}])}(Uf);S(_b,"$name","TextAreaField"),S(_b,"type","textareafield"),S(_b,"alias","textarea"),_b.initClass(),_b._$name="TextAreaField";var Hb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"inputElement",get:function(){var e=B(t,"inputElement",this,1);return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}},{key:"nonEditableClickTarget",get:function(){return this.displayElement}},{key:"focusElement",get:function(){var e;return null!==(e=this._picker)&&void 0!==e&&e.isVisible?this.input:this.displayElement}},{key:"needsInputSync",get:function(){var e;return this.displayElement[this.inputValueAttr]!==String(null!==(e=this.inputValue)&&void 0!==e?e:"")}},{key:"showPicker",value:function(){this.picker.width=this.pickerWidth||this.pickerAlignElement.offsetWidth,B(t,"showPicker",this,3)([!0])}},{key:"focusPicker",value:function(){this.input.focus()}},{key:"onPickerKeyDown",value:function(e){var n=this,r=n.input;switch(e.key.trim()||e.code){case"Escape":return void n.picker.hide();case"Enter":e.ctrlKey&&(n.syncInputFieldValue(),n.picker.hide())}n.input=n.displayElement;var i=B(t,"onPickerKeyDown",this,3)([e]);return n.input=r,i}},{key:"syncInputFieldValue",value:function(e){this.displayElement&&(this.displayElement.value=this.inputValue),B(t,"syncInputFieldValue",this,3)([e])}},{key:"changeValue",value:function(e){return null==e?"":e}},{key:"changePicker",value:function(e,n){var r,i,a=this,o=a.pickerWidth||(null===(r=e)||void 0===r?void 0:r.width);if(e=t.reconfigure(n,e?pe.merge({owner:a,forElement:a.pickerAlignElement,align:{matchSize:null==o,anchor:a.overlayAnchor,target:a.pickerAlignElement},id:a.id+"-input",style:{resize:a.resize},html:null!==(i=a.value)&&void 0!==i?i:""},e):null,a)){var l=a.input=e.element;a.inputListenerRemover=fr.on({element:l,thisObj:a,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}])}(ov);S(Hb,"$name","TextAreaPickerField"),S(Hb,"type","textareapickerfield"),S(Hb,"configurable",{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null,editable:!1}),Hb.initClass(),Hb._$name="TextAreaPickerField";var Bb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){this.updateUndoRedoControls()}},{key:"updateStm",value:function(e){this.detachListeners("undoredo"),null==e||e.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}},{key:"changeItems",value:function(e){var n=e.undoBtn,r=e.redoBtn;return this.color&&(n&&(n.color=this.color),r&&(r.color=this.color)),this.text&&(n&&(n.text="L{UndoRedo.Undo}"),r&&(r.text="L{UndoRedo.Redo}")),B(t,"changeItems",this,3)([e])}},{key:"updateProject",value:function(e){this.stm=e.stm}},{key:"fillUndoRedoCombo",value:function(){var e=this.widgetMap.transactionsCombo;e&&(e.items=[[0,"Original data"]].concat(z(this.stm.queue.map((function(e,t){return[t+1,e||"Transaction ".concat(t+1)]})))))}},{key:"updateUndoRedoControls",value:function(){var e=this.stm,t=this.showZeroActionBadge,n=this.widgetMap,r=n.undoBtn,i=n.redoBtn,a=n.transactionsCombo;r.badge=e.position||(t?"0":""),i.badge=e.length-e.position||(t?"0":""),r.disabled=!e.canUndo,i.disabled=!e.canRedo,this.fillUndoRedoCombo(),a&&(a.disabled=a.store.count<=1)}},{key:"transactionsDisplayValueRenderer",value:function(e,t){var n,r=(null===(n=this.stm)||void 0===n?void 0:n.position)||0;return"".concat(r," undo actions / ").concat(t.store.count-r-1," redo actions")}},{key:"onUndo",value:function(){var e=this.stm,t=this.project;e.canUndo&&(e.revisionsEnabled?t.queue((function(){return e.undo(),t.commitAsync()})):e.undo())}},{key:"onRedo",value:function(){var e=this.stm,t=this.project;e.canRedo&&(e.revisionsEnabled?t.queue((function(){return e.redo(),t.commitAsync()})):e.redo())}},{key:"onTransactionSelected",value:function(e){var t=this.stm,n=t.position-e.value;n>0?t.canUndo&&t.undo(n):n<0&&t.canRedo&&t.redo(-n)}}],[{key:"configurable",get:function(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}},overflowable:!0}}}])}(Ss);S(Bb,"$name","UndoRedoBase"),S(Bb,"type","undoredobase"),Bb.initClass(),Bb._$name="UndoRedoBase";var Vb="http://www.w3.org/2000/svg",Nb={bar:1,outline:2,text:3},zb=function(e,t){return parseInt(e.order,10)-parseInt(t.order,10)},jb=function(e,t){return parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10)},Wb=function(e){return e.field},$b=function(){return!1},Ub=/\s+/,Gb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)([e]),n.scheduleRefresh=n.createOnFrame(n.refresh,[],n,!0),n.refresh()}},{key:"tip",set:function(e){var t,n=this;null===(t=n.tip)||void 0===t||t.destroy(),n._tip=e?pc.new({owner:n,forElement:n.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):null}},{key:"onElementResize",value:function(){B(t,"onElementResize",this,3)(arguments);var e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform","scale(".concat(e.width," ").concat(e.height,")"))}},{key:"onBeforeTipShow",value:function(e){var t=e.source,n=parseInt(t.activeTarget.dataset.index);t.html=t.contentTemplate({histogram:this,index:n})}},{key:"updateSeries",value:function(e){var t=this,n=t._series={},r=0,i=0;for(var a in e)if(!1!==e[a]){var o=n[a]=pe.merge({},e[a]);o.field||(o.field=a),o.type||(o.type="bar"),"order"in o||(o.order=10*Nb[o.type]+r),"index"in o||(o.index=r),"bar"===o.type&&(o.index=i++),o.id=a,r++}!t.topValue&&t._data&&(t.topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}},{key:"getDataTopValue",value:function(e,t){for(var n,r=Object.values(t||this.series).map(Wb),i=0,a=0,o=e.length;a<o;a++){n=e[a];for(var l=0,s=r.length;l<s;l++)i=Math.max(i,n[r[l]])}return i}},{key:"updateGetRectClass",value:function(e){Ne.deprecate("core","7.0.0","getRectClass is deprecated in favor of getBarClass"),this.getBarClass=e}},{key:"updateData",value:function(e){var t=this;t._data=e,!t.topValue&&t._data&&t._series&&(t.topValue=t.getDataTopValue(e)),t.refreshSuspended||t.scheduleRefresh()}},{key:"updateTopValue",value:function(e){var t=this;t._topValue=e,!e&&t._data&&(t._topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}},{key:"scheduleRefresh",value:function(){}},{key:"suspendRefresh",value:function(){this.refreshSuspended++}},{key:"resumeRefresh",value:function(){this.refreshSuspended&&this.refreshSuspended--}},{key:"refresh",value:function(e){var t=this,n=t.series,r=t._tip,i=t.topValue,a=t.singleTextForAllBars,o=(null==e?void 0:e.args)||[],l=[],s=[];if(n){var u=Object.values(n).sort(zb);if(a){var c,d=D(u);try{for(d.s();!(c=d.n()).done;){var h=c.value,f=t["draw".concat(Le.capitalize(h.type))].apply(t,[h].concat(z(o)));f&&(Array.isArray(f)?l.push.apply(l,f):l.push(f))}}catch(e){d.e(e)}finally{d.f()}s.push.apply(s,z(t.drawText.apply(t,[null].concat(z(o)))))}else{var v,g=D(u);try{for(g.s();!(v=g.n()).done;){var m=v.value,p=t["draw".concat(Le.capitalize(m.type))].apply(t,[m].concat(z(o)));p&&(Array.isArray(p)?l.push.apply(l,p):l.push(p)),"bar"===m.type&&s.push.apply(s,z(t.drawText.apply(t,[m].concat(z(o)))))}}catch(e){g.e(e)}finally{g.f()}s.sort(jb)}l.sort(jb),fa.sync({domConfig:{width:"100%",height:"100%",preserveAspectRatio:"none",dataset:{topValue:i},children:[{ns:Vb,tag:"g",reference:"scaledSvgGroup",children:l},{ns:Vb,tag:"g",reference:"unscaledSvgGroup",children:s}]},configEquality:$b,targetElement:t.svgElement}),r&&r.isVisible&&t.onBeforeTipShow({source:r})}}},{key:"drawBar",value:function(e){for(var t,n=this,r=n.topValue,a=n.data,o=n.omitZeroHeightBars,l=n.barStyle,s=e.field,u=e.order,c=e.stretch,d=1/a.length,h=[],f=Le.createId(e.id),v=e.index,g=c?1:i,m=arguments.length,p=new Array(m>1?m-1:0),y=1;y<m;y++)p[y-1]=arguments[y];for(var k=function(){var i=a[b],c=i.rectConfig={ns:Vb,tag:"rect",dataset:{}},m=i[s],y=m?g||i.height||(m>r?r:m)/r:0,k=1-y,w=n.callback("getBarTip",n,[e,c,i,b].concat(p));t=i.width||d,l?c.style=l:delete c.style,Object.assign(c.dataset,{index:b,order:u,series:f});var D=S(S({},"b-series-".concat(f),1),"b-series-index-".concat(v),1),x=n.callback("getBarClass",n,[e,c,i,b].concat(p));x&&x.split(Ub).forEach((function(e){return D[e]=1})),Object.assign(c,{x:C,y:k,width:t,height:y,class:D}),w?c.dataset.btip=w:delete c.dataset.btip,n.getBarDOMConfig&&(c=n.getBarDOMConfig.apply(n,[e,c,i,b].concat(p))),!c||!c.height&&o||h.push(c)},b=0,C=0,w=a.length;b<w;b++,C+=t)k();return h}},{key:"changeGetBarDOMConfig",value:function(e){return e?this.bindCallback(e):null}},{key:"drawOutline",value:function(e){for(var t,n=this,r=n.topValue,i=n.data,a=e.field,o=e.order,l=e.id,s=1/i.length,u=["M 0,1"],c={ns:Vb,tag:"path",dataset:{order:o,id:l}},d="M",h="L",f=0,v=0,g=i.length;f<g;f++){var m=1-i[f][a]/r;t=i[f].width||s,u.push("".concat(d," ").concat(v,",").concat(m," ").concat(h," ").concat(v+=t,",").concat(m)),d=h=""}for(var p=arguments.length,y=new Array(p>1?p-1:0),k=1;k<p;k++)y[k-1]=arguments[k];return c.class="b-series-".concat(e.id," b-series-index-").concat(e.index," ")+n.callback("getOutlineClass",n,[e,i].concat(y)),c.d=u.join(" "),n.callback("getOutlineDOMConfig",n,[e,c,i].concat(y))||[]}},{key:"drawText",value:function(e){for(var t=this,n=t.data,r=1/n.length,a=[],o=arguments.length,l=new Array(o>1?o-1:0),s=1;s<o;s++)l[s-1]=arguments[s];for(var u,c=0,d=0,h=n.length;c<h;c++,d+=u){u=n[c].width||r;var f=t.callback("getBarText",t,[n[c],c,e].concat(l));if(f){var v=t.callback("getBarTextDOMConfig",t,[{ns:Vb,tag:"text",className:"b-bar-legend",html:f,left:d,width:u,x:"".concat(100*(d+u/2),"%"),y:n[c].y!==i?n[c].y:"100%",dataset:{index:c,series:e}},n[c],c,e].concat(l));if(v){var g=t.callback("getBarTextTip",t,[v,n[c],c,e].concat(l));g?v.dataset.btip=g:delete v.dataset.btip,a.push(v)}}}return a}}],[{key:"configurable",get:function(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:Vb,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Vb,tag:"g",reference:"scaledSvgGroup"},{ns:Vb,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:!1,singleTextForAllBars:!0,monitorResize:!0,getRectClass:i,getBarClass:function(e,t,n,r){return""},getOutlineClass:function(e,t){return""},getOutlineDOMConfig:function(e,t,n){return t},getBarTip:function(e,t,n,r){},getBarText:function(e,t,n){return""},getBarDOMConfig:null,getBarTextDOMConfig:function(e,t,n,r){return e},getBarTextTip:function(e,t,n,r){}}}}])}(Lo);S(Gb,"type","histogram"),S(Gb,"$name","Histogram"),S(Gb,"properties",{refreshSuspended:0}),Gb.initClass(),Gb._$name="Histogram";var Yb="http://www.w3.org/2000/svg",qb=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}},{key:"changeAlign",value:function(e){return e||(e=this.horizontal?"bottom":"right"),e}},{key:"updateAlign",value:function(e,t){this.element.classList.remove("b-align-".concat(t)),this.element.classList.add("b-align-".concat(e))}},{key:"updateHorizontal",value:function(e,t){this.element.classList.remove("b-scale-".concat(t?"horizontal":"vertical")),this.element.classList.add("b-scale-".concat(e?"horizontal":"vertical"))}},{key:"onElementResize",value:function(){B(t,"onElementResize",this,3)(arguments),this.scheduleRefresh()}},{key:"scheduleRefresh",value:function(){}},{key:"refresh",value:function(){var e;if(this.scalePoints){var t=this,n=t.horizontal,r=t.width,i=t.height,a=t.align,o=t.scalePoints,l=t.scaleMaxPadding,s=null===(e=o[o.length-1])||void 0===e?void 0:e.value,u=[],c=[],d=1/(s+l*s);t.scaledSvgGroup.setAttribute("transform","scale(".concat(n?r:1," ").concat(n?1:i,")"));var h,f=D(o);try{for(f.s();!(h=f.n()).done;){var v=h.value,g=Boolean(v.text),m=d*v.value;if(g){var p={ns:Yb,tag:"text",className:"b-scale-tick-label",html:v.text,dataset:{tick:v.value}};n?(p.x="".concat(100*m,"%"),p.y="top"===a?"1.6em":i-12):(p.x="left"===a?"12":"".concat(r-12),p.y="".concat(100*(1-m),"%")),c.push(p)}n?"top"===a?u.push("M".concat(m,",0 L").concat(m,",").concat(g?10:5)):u.push("M".concat(m,",").concat(i," L").concat(m,",").concat(i-(g?10:5))):"left"===a?u.push("M0,".concat(1-m," L").concat(g?10:5,",").concat(1-m)):u.push("M".concat(r,",").concat(1-m," L").concat(r-(g?10:5),",").concat(1-m))}}catch(e){f.e(e)}finally{f.f()}t.pathElement.setAttribute("d",u.join("")),fa.syncChildren({domConfig:{children:c}},t.unscaledSvgGroup)}}}],[{key:"configurable",get:function(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:Yb,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Yb,tag:"g",reference:"scaledSvgGroup",children:[{ns:Yb,tag:"path",reference:"pathElement"}]},{ns:Yb,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}}])}(Lo);S(qb,"$name","Scale"),S(qb,"type","scale"),qb.initClass(),qb._$name="Scale";var Kb=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){return{class:{"b-minified":this.minified}}}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","Minifiable"),S(t,"configurable",{minifiable:!0,minified:null}),t},Xb=[],Zb=function(e){return"*"!==e[0]},Jb=function(e,t){var n=e[t]||null;return delete e[t],n},Qb=function(e){return e.responsiveRoot},eC={number:function(e){return function(t){return t.width<=e&&e}}},tC=function(e){return delete e.once,{configs:e,callback:Jb(e,"callback"),when:Jb(e,"when")}},nC=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=r.flatMap((function(e){return(null==e?void 0:e.once)||Xb})),o=t.mergeConfigs.apply(t,r),l=tC(o);for(var s in l.once=a.length?tC(t.mergeConfigs.apply(t,z(a))):null,o)s in e&&delete o[s];return l},rC=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isResponsivePending",get:function(){return 0===this.responsiveUpdateCount&&this.hasConfig("responsive")}},{key:"isResponsiveUpdating",get:function(){var e;return this._responsiveUpdating||(null===(e=this.responsiveWidget)||void 0===e?void 0:e._responsiveUpdating)}},{key:"updateResponsive",value:function(e){var t,n,r,i,a=this,l=a.constructor,s=a.initialConfig,u=a.responsiveDefaults,c=Array.from(new o(Be.keys(e).concat(Be.keys(u)))).filter(Zb),d=null;if(e){d={"*":nC(s,l,u["*"],e["*"])};var h,f=D(c);try{for(f.s();!(h=f.n()).done;){var v;if(null!==(r=e[n=h.value])&&!1!==r)t=t||r&&"when"in r,d[n]=nC(s,l,u["*"],u[n],e["*"],r),i=d[n].when,d[n].when=(null===(v=eC[W(i)])||void 0===v?void 0:v.call(eC,i))||i}}catch(e){f.e(e)}finally{f.f()}}a.$responsiveStates=d,a.$responsiveWhen=t,a.syncResponsiveWidget()}},{key:"updateResponsiveState",value:function(e,t){var n,r,i=this,a=i.$responsiveStates,o=1==++i.responsiveStateChanges,l=null===(n=i.element)||void 0===n?void 0:n.classList,s=a["*"],u=a[e]||s,c=o&&(u.once||s.once),d=o&&i.isStateful,h=i.responsiveWidget,f=u.configs,v=null==c?void 0:c.configs;v&&(f=f?i.constructor.mergeConfigs(f,v):v),t&&(null==l||l.remove("b-responsive-".concat(t.toLowerCase()))),e&&(null==l||l.add("b-responsive-".concat(e.toLowerCase()))),d&&((v=i.loadStatefulData())&&(f=f?i.constructor.mergeConfigs(f,v):v),i.suspendStateful()),i._responsiveUpdating=!0;try{var g,m;null===(g=i.trigger)||void 0===g||g.call(i,"beforeResponsiveStateChange",{state:e,oldState:t,target:h}),f&&i.setConfig(f);for(var p=0,y=[u.callback,null==c?void 0:c.callback];p<y.length;p++){var k;null===(k="string"==typeof(r=y[p])?i[r]:r)||void 0===k||k.call(i,{source:i,state:e,oldState:t,target:h,initial:o})}null===(m=i.trigger)||void 0===m||m.call(i,"responsiveStateChange",{state:e,oldState:t,target:h})}finally{i._responsiveUpdating=!1,d&&i.resumeStateful()}}},{key:"responsiveTarget",get:function(){return this.responsiveWidget||this._responsiveTarget}},{key:"updateResponsiveTarget",value:function(){this.syncResponsiveWidget()}},{key:"updateResponsiveWidget",value:function(e){var t,n=this,r=e&&n.responsiveUpdate;null===(t=n.$responsiveWrapper)||void 0===t||t.destroy(),n.$responsiveWrapper=e&&function(e,t){var n,r=Proxy.revocable(e,{get:function(t,r){return n&&(n[r]=!0),e[r]}}),i=Tt.after(e,"onConfigChange",(function(e,r){var i,a=r.name;null!==(i=n)&&void 0!==i&&i[a]&&t()})),a=e.ion({resize:function(){t()}});return e.monitorResize=!0,{widget:e,get object(){var e;return null===(e=r)||void 0===e?void 0:e.proxy},destroy:function(){r&&(r.revoke(),i(),a(),r=i=a=null)},reset:function(){n=Object.create(null)}}}(e,r),null==r||r.now()}},{key:"responsiveUpdate",value:function(){var e=this,t=e.$responsiveStates,n=e.$responsiveWrapper,r=null==n?void 0:n.widget;if(t&&n){var i,a,o=null,l=0,s=t;for(a in r&&r!==e&&!e.$responsiveWhen&&(r.getConfig("responsive"),s=r.$responsiveStates||s),n.reset(),t)"*"!==a&&null!=(i=s[a].when(n.object,ne))&&!1!==i&&(!o||i<l)&&(o=a,l=i);++e.responsiveUpdateCount,e.responsiveState=o}}},{key:"syncResponsiveWidget",value:function(){var e,t=this,n=null;if(!t.isDestroying&&t.responsive){var r;if(n=e=t.responsiveTarget){if("string"==typeof e&&!(n="@"===e?t:"@"===e[0]?t[e.substring(1)]:t.up(e)))throw new Error('No match for responsiveTarget="'.concat(e,'"'))}else n=!t.responsiveRoot&&(null===(r=t.up)||void 0===r?void 0:r.call(t,Qb))||t;if(!n.isWidget)throw new Error("".concat(n.constructor.$$name," is not a widget and cannot be a responsiveTarget"))}return t.responsiveWidget=n,n}}])}((e||Mn).mixin($i,Ap)),S(t,"$name","Responsive"),S(t,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:function(){return 1/0}},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}}}),S(t,"delayable",{responsiveUpdate:"raf"}),S(t,"fenced",{syncResponsiveWidget:!0}),S(t,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),t};n&&!n.bryntum&&(n.bryntum={});var iC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"defaultEditor",get:function(){var e=this.format,t=this.name,n=this.max,r=this.min,i=this.step,a=this.largeStep,o=this.align;return Be.cleanupProperties({type:"numberfield",format:e,name:t,max:n,min:r,step:i,largeStep:a,textAlign:o})}},{key:"formatter",get:function(){var e=this,t=e.format,n=e._formatter;return n&&e._lastFormat===t||(e._formatter=n=eg.getLocalizedFormatter(e._lastFormat=t)),n}},{key:"formatValue",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return null!=e&&(e=this.formatter.format(e),this.unit&&t&&(e="".concat(e).concat(this.unit))),null!=e?e:""}},{key:"defaultRenderer",value:function(e){var t=e.value;return this.formatValue(t)}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this._formatter=null}}])}(yg);S(iC,"type","number"),S(iC,"fieldType","number"),S(iC,"fields",[{name:"format",defaultValue:""},"min","max","step","largeStep","unit","renderer"]),S(iC,"defaults",{filterType:"number",align:"end",exportedType:"number"}),bg.registerColumnType(iC,!0),iC.exposeProperties(),iC._$name="NumberColumn";var aC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;r.configuredAlign="align"in e,r.configuredEditor="editor"in e,B(t,"construct",this,3)(arguments);var i=n.grid;"sum"===r.function&&(r.function="sumChildren"),i&&(r.store=i.store)}},{key:"store",get:function(){return this._store},set:function(e){var t=this,n={update:"onRecordUpdate",thisObj:t,prio:1e3},r=t._store;if(e!==r){r&&r.un(n),t._store=e;var i=e.modelClass.fieldMap[t.field];i&&"number"===i.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.ion(n)}}},{key:"canEdit",value:function(e){return e.isLeaf}},{key:"sumChildren",value:function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n.length;i<a;i++)e+=parseFloat(n[i]||0,10);return e}},{key:"avg",value:function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=n.length,a=0;a<i;a++)e+=parseFloat(n[a]||0,10);return e/i}},{key:"onRecordUpdate",value:function(e){var t=e.record,n=e.changes,r=this,i=r.grid.rowManager;r.field in n&&t.isLeaf&&t.bubble((function(e){var t=i.getRowFor(e);if(t){var n=t.getCell(r.field);n&&t.renderCell(n)}}),!0)}},{key:"getRawValue",value:function(e){var t,n=this,r=n.field,a=n.grid,o=n.enableAggregation,l=a.store.isFiltered&&n.includeFilteredOutRecords?e.unfilteredChildren:e.children;if(null!=l&&l.length){var s=n.function,u="string"==typeof s&&"function"==typeof Math[s]?{handler:Math[s],thisObj:Math}:n.resolveCallback(s),c=u.handler,d=u.thisObj;t=o?c.apply(d,l.map((function(e){return n.getRawValue(e)}))):i,n.includeParentInChangeSet&&!a.isTreeGrouped?e.set(r,t,!0):e.setData(r,t)}else t=e.getValue(r);return t}},{key:"canFillValue",value:function(e){return e.record.isLeaf&&B(t,"canFillValue",this,3)(arguments)}}],[{key:"defaults",get:function(){return{function:"sum",includeParentInChangeSet:null,enableAggregation:!0,includeFilteredOutRecords:null}}}])}(iC);S(aC,"type","aggregate"),S(aC,"fields",["function","includeParentInChangeSet","enableAggregation","includeFilteredOutRecords"]),bg.registerColumnType(aC,!0),aC.exposeProperties(),aC._$name="AggregateColumn";var oC=function(e){var t=e.source,n=e.value;e.userAction&&t.cellInfo.record.setValue(t.name,n)},lC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){e.disableRendererWarning||(e.renderer&&(e.afterRenderCell=e.renderer,delete e.renderer,Ne.deprecate("grid","7.0.0","Using deprecated `renderer` with WidgetColumn, use `afterRenderCell` callback instead.")),this.renderer&&this.renderer!==this.defaultRenderer&&(e.afterRenderCell=this.renderer,this.renderer=this.defaultRenderer,Ne.deprecate("grid","7.0.0","Using deprecated `renderer` with WidgetColumn, use `afterRenderCell` callback instead."))),B(t,"construct",this,3)(arguments);var n=this,r=n.grid;r&&(r.widgetColumnCache?n.widgetColumnCache=r.widgetColumnCache:(n.widgetColumnCache=r.widgetColumnCache=new a,r.ion({removeRows:"onRemoveGridRows",thisObj:this})))}},{key:"onRemoveGridRows",value:function(e){var t=this;e.rows.forEach((function(e){var n=e.columnWidgets;n&&(t.freeWidgets(z(n.values()).flat()),n.clear())}))}},{key:"freeWidgets",value:function(e){var t=this;null==e||e.forEach((function(e){var n,r=t.widgetColumnCache,i=e.cellInfo.column,a="".concat(i.id,"-").concat(e.widgetColumnIndex);null===(n=i.onAfterWidgetDerendered)||void 0===n||n.call(i,e),e.cellInfo=e.__boundRecordId=e.owner=null,e.element.remove(),(r.get(a)||r.set(a,[]).get(a)).push(e)})),e.length=0}},{key:"freeColumnWidgets",value:function(){var e=this,t=this.id;this.grid.rowManager.forEach((function(n){var r,i=null===(r=n.columnWidgets)||void 0===r?void 0:r.get(t);null!=i&&i.length&&e.freeWidgets(i)}))}},{key:"hide",value:function(){this.freeColumnWidgets(),B(t,"hide",this,3)(arguments)}},{key:"getWidget",value:function(e,t){var n,r,i=this,a=i.grid,o=i.widgetColumnCache,l="".concat(t.column.id,"-").concat(e.widgetColumnIndex),s=o.get(l)||o.set(l,[]).get(l),u=s.length;return u?(delete(r=s[--u]).onBeforeDestroy,s.length=u,e.owner=a,Lo.reconfigure(r,e)):(i.onBeforeWidgetCreate(e,t),e.recomposeAsync=!1,e.owner=a,r=Lo.create(e),i.onAfterWidgetCreate(r,t),r.name&&r.ion({change:oC})),null===(n=i.onBeforeWidgetRender)||void 0===n||n.call(i,r),r}},{key:"doDestroy",value:function(){this.grid.isDestroying?(z(this.widgetColumnCache.values()).flat().forEach((function(e){return e.destroy()})),this.widgetColumnCache.clear()):this.freeColumnWidgets(),B(t,"doDestroy",this,3)([])}},{key:"updateReadOnly",value:function(e){var t=this;this.readOnly||this.grid.rowManager.forEach((function(n){var r;null===(r=n.columnWidgets)||void 0===r||null===(r=r.get(t.id))||void 0===r||r.forEach((function(t){t.cellInfo.record.readOnly||(t.readOnly=e)}))}))}},{key:"defaultRenderer",value:function(e){var t=this,n=t.grid,r=e.cellElement,i=e.column,o=e.record,l=e.row,s=e.isExport,u=i.widgets;if(!s&&u){var c=l.columnWidgets||(l.columnWidgets=new a),d=c.get(t.id);z(r.childNodes).forEach((function(e){var t;null!==(t=e.classList)&&void 0!==t&&t.contains("b-widget")||e.remove()})),e.widgets=i.widgets.map((function(a,l){var s,u;a.widgetColumnIndex=l;var c=(null==d?void 0:d[l])||t.getWidget(a,e);if(c.cellInfo=e,c.element.isConnected||(c.rendered?r.appendChild(c.element):c.render(r)),t.meta.isSelectionColumn||(c.readOnly=n.readOnly||o.readOnly||t.readOnly),!1!==(null===(s=t.onBeforeWidgetSetValue)||void 0===s?void 0:s.call(t,c,e))){var h=a.valueProperty||"value"in c&&"value"||c.defaultBindProperty;if(h&&(!i.noFieldSpecified&&1===i.widgets.length||c.name)){var f=c.name?o.getValue(c.name):e.value;"object"==W(f)&&c.__boundRecordId!==o.id&&(c["_".concat(h)]=NaN),c.suspendEvents(),c[h]=f,c.resumeEvents(),c.__boundRecordId=o.id}}return null===(u=t.onAfterWidgetSetValue)||void 0===u||u.call(t,c,e),c})),c.set(t.id,e.widgets)}if(!u)return""}},{key:"onBeforeWidgetCreate",value:function(e,t){}},{key:"onAfterWidgetCreate",value:function(e,t){}},{key:"resizeToFitContent",value:function(){}}],[{key:"defaults",get:function(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1,ariaLabel:"L{WidgetColumn.rowWidgets}"}}}])}(yg);S(lC,"$name","WidgetColumn"),S(lC,"type","widget"),S(lC,"fields",["widgets","disableRendererWarning"]),bg.registerColumnType(lC),lC.exposeProperties(),lC._$name="WidgetColumn";var sC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){e.localizableProperties=rn.mergeMethods.distinct(e.localizableProperties,["checkAriaLabel"]),B(t,"construct",this,3)(arguments);var r=this;if(r.widgets[0].cls=r.checkCls,Object.assign(r,{externalHeaderRenderer:r.headerRenderer,externalOnBeforeWidgetSetValue:r.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:r.onAfterWidgetSetValue}),r.setData({onBeforeWidgetSetValue:r.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:r.internalOnAfterWidgetSetValue,headerRenderer:r.internalHeaderRenderer}),!r.meta.isSelectionColumn){var i,a=null===(i=r.grid)||void 0===i?void 0:i.store.modelClass;r.field?!a||"boolean"==typeof r[r.field]||a.fieldMap[r.field]||r.constructor.suppressNoModelFieldWarning||e.suppressNoModelFieldWarning||(console.warn(r.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),a.addField({name:r.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}},{key:"groupHeaderReserved",get:function(){return this.grid.selectionMode.showCheckAllInGroupRows}},{key:"doDestroy",value:function(){var e;null===(e=this.headerCheckbox)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"internalHeaderRenderer",value:function(e){var t,n,r=e.headerElement,a=e.column;return r.classList.add("b-check-header"),a.showCheckAll?(r.classList.add("b-check-header-with-checkbox"),a.headerCheckbox?r.appendChild(a.headerCheckbox.element):a.headerCheckbox=new Jg({appendTo:r,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:a}})):n=a.headerText,n=a.externalHeaderRenderer?(t=a.externalHeaderRenderer).call.apply(t,[this].concat(Array.prototype.slice.call(arguments))):n,a.showCheckAll?i:n}},{key:"updateCheckAllState",value:function(e){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=e,this.headerCheckbox.resumeEvents())}},{key:"onCheckAllChange",value:function(e){var t=e.checked,n=this;if(n.field){var r=n.grid.store;r.beginBatch(),r.forEach((function(e){return n.updateRecord(e,n.field,t)})),r.endBatch()}n.trigger("toggleAll",{checked:t})}},{key:"defaultRenderer",value:function(e){var n,r=e.value,i=e.isExport,a=e.record,o=this.grid,l=B(t,"defaultRenderer",this,3)([e]),s=null===(n=e.widgets)||void 0===n?void 0:n[0];return i?null!=l?l:null==r?"":r:(s.readOnly=this.readOnly||(o.readOnly||a.readOnly)&&!this.meta.isSelectionColumn,r?s.input.setAttribute("checked",!0):s.input.removeAttribute("checked"),s.input.setAttribute("aria-label",this.checkAriaLabel),l)}},{key:"onBeforeWidgetRender",value:function(e,t){e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}},{key:"onAfterWidgetDerendered",value:function(e,t){e.un({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}},{key:"internalOnBeforeWidgetSetValue",value:function(e,t){var n;t.cellElement.widget=e,e.record=e.cellInfo.record,null===(n=this.externalOnBeforeWidgetSetValue)||void 0===n||n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"internalOnAfterWidgetSetValue",value:function(e){var t;null===(t=this.externalOnAfterWidgetSetValue)||void 0===t||t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"onBeforeCheckboxChange",value:function(e){var t=e.source,n=e.checked,r=e.userAction,i=this,a=i.grid,o=t.cellInfo.record;return!(r&&i.field&&(!a.features.cellEdit||a.features.cellEdit.disabled)||!(!i.meta.isSelectionColumn||a.isSelectable(o)||a.selectionMode.showCheckAllInGroupRows&&o.isGroupHeader)&&n)&&i.trigger("beforeToggle",{record:o,checked:n})}},{key:"onCheckboxChange",value:function(e){var t=e.source,n=e.checked,r=this,i=t.cellInfo.record,a=r.field;a&&(r.updateRecord(i,a,n),n?r.updateCheckAllState(r.grid.store.every((function(e){return e[a]}),null,!0)):r.updateCheckAllState(!1)),r.trigger("toggle",{record:i,checked:n,checkbox:t})}},{key:"updateRecord",value:function(e,t,n){e.setValue(t,n)}},{key:"onCellKeyDown",value:function(e){var t=e.event,n=e.cellElement,r=e.record;if(" "===t.key){var i=t.target,a=n.widget;i.matches(".b-grid-cell")&&!(null!=r&&r.readOnly||a.disabled||a.readOnly)&&(null==a||a.toggle(),t.preventDefault(),t.handled=!0)}}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return delete n.onBeforeWidgetSetValue,delete n.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(n.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(n.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),n}}])}(lC);S(sC,"$name","CheckColumn"),S(sC,"type","check"),S(sC,"fields",["checkCls",{name:"checkAriaLabel",defaultValue:"L{Checkbox.toggleName}"},"showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),S(sC,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,minWidth:30,widgets:[{type:"checkbox",valueProperty:"checked"}]}),bg.registerColumnType(sC,!0),sC._$name="CheckColumn";var uC=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"preventCellEditViaMouse",!0),e}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments);var e=this,n=e.editor,r=e.colors;null!=r&&r.length&&(n.colors=r),n.addNoColorItem=e.addNoColorItem,n.ion({colorSelected:"onColorSelected",thisObj:e})}},{key:"applyValue",value:function(e,n,r){if(!this.isConstructing){var i=this.editor;"colors"===n?i.colors=r:"addNoColorItem"===n&&(i.addNoColorItem=r)}B(t,"applyValue",this,3)(arguments)}},{key:"picker",get:function(){return this.editor.picker}},{key:"defaultRenderer",value:function(e){var t=e.value,n="b-empty",r=t;if(t){var i=this.picker.getColorClassName(t);i?(n=i,r=null):n=""}return{className:"b-color-cell-inner "+n,style:{backgroundColor:r},"data-btip":t}}},{key:"onCellClick",value:function(e){var t,n=e.grid,r=e.record,i=e.target;if(i.classList.contains("b-color-cell-inner")&&!this.readOnly&&!n.readOnly&&!r.isSpecialRow&&!r.readOnly&&(null===(t=n.features.cellEdit)||void 0===t||!t.finishEditingPromise)){var a=this.picker,o=r.get(this.field);this._editingRecord=r,a.deselectAll(),a.select(o),a.refresh(),a.showBy(i)}}},{key:"onColorSelected",value:function(e){var t,n=e.color;null!==(t=this.grid.features.cellEdit)&&void 0!==t&&t.isEditing||!this._editingRecord||this._editingRecord.set(this.field,n)}}])}(yg);S(uC,"$name","ColorColumn"),S(uC,"type","color"),S(uC,"fields",["colors",{name:"addNoColorItem",defaultValue:!0}]),S(uC,"defaults",{align:"center",editor:"colorfield"}),bg.registerColumnType(uC),uC._$name="ColorColumn";var cC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=arguments.length>1?arguments[1]:i;if(B(t,"construct",this,3)([e,n]),this.grid){var r=this.field,a=this.grid.store,o=a.modelClass,l=r&&o.getFieldDefinition(r);if(l&&!l.isDateDataField){console.warn("DateColumn expects the `type` of the model field `".concat(r,"` to be of type `date`"));var s=o.addField(F(F({},l.getCurrentConfig()),{},S({type:"date"},"format"in e?"format":i,this.format)));a.forEach((function(e){return e.data[l.dataSource]=s.convert(e[r])}))}}}},{key:"defaultRenderer",value:function(e){var t=e.value;return t?this.formatValue(t):""}},{key:"groupRenderer",value:function(e){var t=e.cellElement,n=e.groupRowFor;t.innerHTML=this.formatValue(n)}},{key:"formatValue",value:function(e){return"string"==typeof e&&(e=Pl.parse(e,this.format||i)),Pl.format(e,this.format||i)}},{key:"format",get:function(){return this.get("format")},set:function(e){var t=this.data.editor;this.set("format",e),t&&(t.format=e)}},{key:"defaultEditor",get:function(){var e=this,t=e.min,n=e.max,r=e.step,i=e.format;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:i,max:n,min:t,step:r}}}],[{key:"defaults",get:function(){return{format:"L",step:1,minWidth:85,filterType:"date"}}}])}(yg);S(cC,"$name","DateColumn"),S(cC,"type","date"),S(cC,"fieldType","date"),S(cC,"fields",["format","pickerFormat","step","min","max","renderer"]),bg.registerColumnType(cC,!0),cC.exposeProperties(),cC._$name="DateColumn";var dC=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"circleHeightPercentage",.75),e}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.showCircle&&(Ne.deprecate("core","7.0.0","PercentColumn `showCircle` is deprecated, in favor of `mode`"),this.mode="circle")}},{key:"defaultRenderer",value:function(e){var t,n=e.value,r=e.record,a=e.isExport;n=n||0;var o=this,l=o.formatValue(n,r)||n,s="".concat(o.text?"".concat(o.text," : "):"").concat(l);if(a)return l;if("number"===o.mode)return l+"%";var u=o.min,c=o.max;if("circle"===o.mode){var d,h=Math.round(o.circleHeightPercentage*o.grid.rowHeight)+"px";return{tabIndex:0,role:"progressbar","aria-valuemin":u,"aria-valuemax":c,"aria-valuenow":n,"aria-label":(null===(d=o.formatAriaLabel)||void 0===d?void 0:d.call(o,s,r))||s,className:{"b-percentdone-circle":1,"b-empty":0===n,"b-full":100===n,"b-over":n>100},style:{height:h,width:h,"--grid-percent-circle-angle":"".concat(n/100,"turn")},dataset:{value:l}}}return{className:"b-percent-bar-outer",role:"progressbar","aria-valuemin":u,"aria-valuemax":c,"aria-valuenow":n,"aria-label":(null===(t=o.formatAriaLabel)||void 0===t?void 0:t.call(o,s,r))||s,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===n,"b-low":n<o.lowThreshold,"b-full":100===n,"b-over":n>100},style:{width:n+"%"},children:[o.showValue?{tag:"span",text:l+"%"}:i]}]}}},{key:"resizeToFitContent",value:function(){if("number"===this.mode)return B(t,"resizeToFitContent",this,3)(arguments)}},{key:"align",get:function(){var e=this.get("align"),t=this.mode;return e||("number"===t?"end":"circle"===t?"center":"start")},set:function(e){this.set("align",e)}},{key:"htmlEncode",get:function(){return"number"===this.mode}},{key:"internalCellCls",get:function(){return"bar"===this.mode?"b-percent-bar-cell":""}}])}(iC);S(dC,"type","percent"),S(dC,"fields",["showValue","lowThreshold","showCircle","mode"]),S(dC,"defaults",{min:0,max:100,step:1,align:null,showCircle:!1,mode:"bar",showValue:!1,lowThreshold:0,htmlEncode:!1,searchable:!1,summaryRenderer:function(e){var t=e.sum;return"".concat(t,"%")},fitMode:!1}),dC.sum="average",bg.registerColumnType(dC,!0),dC._$name="PercentColumn";var hC=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"preventCellEditViaMouse",!0),e}return R(t,e),w(t,[{key:"defaultRenderer",value:function(e){var t=this,n=e.value;return e.isExport?"★".repeat(n):{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:$e.populate(this.max,(function(e){var r=e<n;return{tag:"i",className:S({"b-rating-icon":!0,"b-filled":r,"b-empty":!r},r?t.filledIcon:t.emptyIcon,!0)}}))}}},{key:"onCellClick",value:function(e){var t=e.grid,n=e.column,r=e.record,i=e.target,a=e.event;if(i.classList.contains("b-rating-icon")&&!t.readOnly&&n.editable){var o=[].indexOf.call(i.parentNode.childNodes,i);i.classList.contains("b-filled")&&(a.metaKey||a.shiftKey)&&(o-=1),1===r.getValue(n.field)&&0===o&&(o=-1),r.set(n.field,o+1)}}}],[{key:"defaults",get:function(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,exportedType:"string",filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",align:"start",fitMode:"value"}}}])}(iC);S(hC,"$name","RatingColumn"),S(hC,"type","rating"),S(hC,"fieldType","number"),S(hC,"fields",["emptyIcon","filledIcon","editable"]),bg.registerColumnType(hC,!0),hC.exposeProperties(),hC._$name="RatingColumn";var fC=function(e){function t(e,n){var r;m(this,t);var i=r=g(this,t,arguments);if(!i.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof i.template)throw new Error("TemplateColumn.template must be a function");return r}return R(t,e),w(t,[{key:"defaultRenderer",value:function(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:this.field})}}],[{key:"defaults",get:function(){return{htmlEncode:!1}}}])}(yg);S(fC,"type","template"),S(fC,"fields",["template"]),bg.registerColumnType(fC,!0),fC.exposeProperties(),fC._$name="TemplateColumn";var vC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"defaultRenderer",value:function(e){var t=e.value;return t?this.formatValue(t):""}},{key:"groupRenderer",value:function(e){var t=e.cellElement,n=e.groupRowFor;t.innerHTML=this.formatValue(n)}},{key:"formatValue",value:function(e){return"string"==typeof e&&(e=Pl.parse(e,this.format)),Pl.format(e,this.format)}},{key:"format",get:function(){return this.get("format")},set:function(e){var t=this.editor;this.set("format",e),t&&(t.format=e)}},{key:"defaultEditor",get:function(){return{name:this.field,type:"timefield",format:this.format}}}],[{key:"defaults",get:function(){return{format:"LT",minWidth:140,filterType:"time"}}}])}(yg);S(vC,"$name","TimeColumn"),S(vC,"type","time"),S(vC,"fieldType","date"),S(vC,"fields",["format"]),bg.registerColumnType(vC,!0),vC.exposeProperties(),vC._$name="TimeColumn";var gC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];B(t,"construct",this,3)([e,n].concat(i));var o=this;o.shouldHtmlEncode=o.htmlEncode,o.setData("htmlEncode",!1);var l=o.renderer;!l||o.grid.splitFrom||o.grid.initialConfig.splitFrom||(o.originalRenderer=l),o.setData("renderer",o.treeRenderer.bind(o))}},{key:"treeRenderer",value:function(e){var t,n=this,r=e.grid,i=e.cellElement,a=e.row,o=e.record,l=e.isExport,s=r.features;if(!s.tree)throw new Error("TreeColumn requires the Tree feature to be enabled");var u,c,d=o.instanceMeta(r.store),h=!o.isLeaf&&d.collapsed,f={className:"b-tree-cell-value"},v=[f],g={className:{"b-tree-cell-inner":1},tag:o.href?"a":"div",href:o.href,target:o.target,children:v},m=s.tree.treeLines,p=r.isTreeGrouped&&!o.isLeaf&&s.treeGroup.parentRenderer,y=e.value,k=n;if(n.originalRenderer||p){var b,C;if(p){var w,D;if(o.field)if(k=r.columns.get(o.field))y=k.isWidgetColumn?y:null!==(w=null===(D=k===n?k.originalRenderer:k.renderer)||void 0===D?void 0:D.call(k,F(F({},e),{},{column:k,value:o.name,isTreeGroup:!0})))&&void 0!==w?w:o.name;else y=o.name;C=s.treeGroup.parentRenderer(F(F({},e),{},{field:o.field,value:y,column:k,record:o.firstGroupChild,grid:r}))}else C=n.originalRenderer(e);var x=null===(b=r.hasFrameworkRenderer)||void 0===b?void 0:b.call(r,{cellContent:C,renderingColumn:k});u="object"===W(C)&&!x,y=x?"":!1===C?i.innerHTML:C,e.rendererHtml=C}if(u||(y=String(null!=y?y:"")),l)return y;if(o.isLeaf)i.classList.add("b-tree-leaf-cell"),c=e.iconCls||o.iconCls||n.leafIconCls;else{var E,R=o.isExpanded(r.store),T=R?n.collapseIconCls:n.expandIconCls,M=h?n.expandedFolderIconCls:n.collapsedFolderIconCls;i.classList.add("b-tree-parent-cell"),i.setAttribute("aria-expanded",R),a.toggleCls("b-loading-children",Boolean(d.isLoadingChildren)),v.unshift({tag:"i",className:S(S({"b-tree-expander":1},T,1),"b-empty-parent",!(d.isLoadingChildren||!0===o.children||null!==(E=o.children)&&void 0!==E&&E.length))}),o.meta.hasIcon=c=e.iconCls||o.iconCls||M}if(c&&v.splice(v.length-1,0,{tag:"i","aria-hidden":"true",className:S({"b-tree-icon":1},c,1)}),a.isRow&&!o.isLeaf)if(a.setAttribute("aria-expanded",!h),h)a.removeAttribute("aria-owns");else{var A=function(e){var t,n,i=a.elements[e];li.setAttributes(i,{"aria-owns":null!==(t=o.children)&&void 0!==t&&t.length?null===(n=o.children)||void 0===n?void 0:n.map((function(t){return"".concat(r.id,"-").concat(e,"-").concat(t.id)})).join(" "):null})};for(var I in r.subGrids)A(I)}Array.isArray(y)?f.children=y:u?Object.assign(f,y):null!==(t=k)&&void 0!==t&&t.shouldHtmlEncode||!y.includes("<")?(g.className["b-text-value"]=1,f.text=y):f.html=y;var L,O=0;o.isLeaf?O+=null!==(L=o.parent)&&void 0!==L&&L.meta.hasIcon?2.2:c?.5:.4:O+=c?-.15:0;var P=[];if(m)for(var _=0;_<o.childLevel;_++)P.push({tag:"span",style:"margin: 0 ".concat(n.indentSize/2-.2-.125,"em 0 ").concat(n.indentSize/2+.2,"em"),className:"b-tree-line b-tree-line-".concat(_)});else O+=o.childLevel*n.indentSize;return g.style="padding-inline-start:".concat(O,"em"),m?[].concat(P,[g]):g}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return n.renderer=this.originalRenderer,n}},{key:"isTreeExpanderIcon",value:function(e){return e.matches("."+this.expandIconCls.trim().replace(/\s/g,".")+",."+this.collapseIconCls.trim().replace(/\s/g,"."))}}],[{key:"defaults",get:function(){return{tree:!0,hideable:!1,minWidth:150}}},{key:"fields",get:function(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}}])}(yg);S(gC,"$name","TreeColumn"),S(gC,"type","tree"),bg.registerColumnType(gC,!0),gC.exposeProperties(),gC._$name="TreeColumn";var mC={cut:1,copy:1,paste:1},pC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"clipboardRecords",get:function(){return this.clipboardData||[]}},{key:"isActionAvailable",value:function(e){var t,n,i=e.event,a=e.actionName;return!!mC[a]&&!(this.disabled||0!==r.getSelection().toString().length||"copy"!==a&&this.copyOnly||null!==(t=this.client.features.cellEdit)&&void 0!==t&&t.isEditing||null!==(n=this.client.focusedCell)&&void 0!==n&&n.isSpecialRow||li.isEditable(i.target,!0))}},{key:"cellsToString",value:function(e){var t=this,n=0,r=0,a="";e.sort((function(e,t){return e.rowIndex===t.rowIndex?e.columnIndex-t.columnIndex:e.rowIndex-t.rowIndex}));var o,l=D(e);try{for(l.s();!(o=l.n()).done;){var s,u,c=o.value,d=c.record,h=c._column,f=c.rowIndex,v=c.columnIndex;f>n?(a.length>0&&(a+="\n".repeat(f-n)),n=f,r=v):v>r&&(a.length>0&&(a+="\t".repeat(v-r)),r=v);var g,m=null==h||null===(s=h.toClipboardString)||void 0===s?void 0:s.call(h,c);if(m===i)if((m=d.getValue(h.field))instanceof Date)m=Pl.format(m,t.dateFormat);else m=null===(g=m)||void 0===g?void 0:g.toString();t.toCopyString&&(m=t.toCopyString({currentValue:m,column:h,record:d})),a+=(m=null===(u=m)||void 0===u?void 0:u.replaceAll(/[\n\t]/g," "))||t.emptyValueChar}}catch(e){l.e(e)}finally{l.f()}return a}},{key:"setFromStringData",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.client.store,r=arguments.length>3?arguments[3]:i,a=this,l=a.client,s=l.columns,u=l.selectedCells,c=l._shiftSelectRange,d=new o,h=a.stringAs2dArray(e),f=[],v=[];if(t||(null==c?void 0:c.length)!==u.length)!t&&u.length>1&&1===h.length&&1===h[0].length&&f.push.apply(f,z(u));else{var g=a.cellSelectorsAs2dArray(c);if((null==g?void 0:g.length)%h.length==0&&g.columnCount%h.columnCount==0)for(var m=0;m<g.length;m+=h.length)for(var p=0;p<g.columnCount;p+=h.columnCount)f.push(g[m][p])}f.length||f.push(null==u?void 0:u[0]);for(var y=0,k=f;y<k.length;y++)for(var b=k[y],C=0;C<h.length;C++){var w=h[C],D=t?n.createRecord():n.getAt(b.rowIndex+C);if(D&&!D.readOnly){for(var S=0;S<w.length;S++){var x=r?null:s.visibleColumns[t?S:b.columnIndex+S],E=(null==x?void 0:x.field)||(null==r?void 0:r[S]),R=w[S];if(E&&R&&(null==x||!x.readOnly)){var T;if(R===a.emptyValueChar&&(R=null),null!=x&&x.fromClipboardString&&(R=x.fromClipboardString({string:R,record:D})),a.toPasteValue&&(R=a.toPasteValue({currentValue:R,record:D,column:x,field:E})),"string"==typeof R&&null!==(T=D.getFieldDefinition(E))&&void 0!==T&&T.isDateDataField){var M=Pl.parse(R,a.dateFormat);isNaN(M.getTime())||(R=M)}D.set(E,R,!1,!1,!1,!0),x&&v.push(l.normalizeCellContext({column:x,record:D}))}}d.add(D)}}return{modifiedRecords:z(d),targetCells:v}}},{key:"cellSelectorsAs2dArray",value:function(e){var t,n,r=[],i=null,a=D(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.id!==i&&(i=o.id,t=[],r.push(t)),t.push(o)}}catch(e){a.e(e)}finally{a.f()}return r.columnCount=r[0].length,!r.some((function(e){return e.length!==r.columnCount}))&&r}},{key:"stringAs2dArray",value:function(e){var t,n=[],r=D(e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/).filter((function(e){return e.length})));try{for(r.s();!(t=r.n()).done;){var i=t.value.split("\t");if(n.columnCount&&i.length!==n.columnCount)return!1;n.columnCount=i.length,n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}}])}(wc.mixin(Gp));S(pC,"configurable",{copyOnly:null,keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!1,toCopyString:null,toPasteValue:null,emptyValueChar:" ",dateFormat:"lll",generateNewName:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.client.store,r=this.nameField,a=e.getValue(r),o=2;(null==t?void 0:t.meta.generatedName)===a&&(a=t.meta.originalName);var l=a;if(null!=l&&""!==l)for(;n.findRecord(r,l);)l="".concat(a," - ").concat(o),o+=1;return e.meta.generatedName=l,e.meta.originalName=a,l}}),pC._$name="CopyPasteBase";var yC=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"entityName","cell"),e}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]),this.afterSelectionModeChange()}},{key:"afterSelectionModeChange",value:function(){var e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}},{key:"copyOnly",get:function(){var e;return null==this._copyOnly?!(null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.enabled):Boolean(this._copyOnly)},set:function(e){this._copyOnly=e}},{key:"canCopy",get:function(){var e,t=this.client;return Boolean(!this.disabled&&t.selectedCells.length&&(!t._selectedRows.length||(null===(e=t.features.rowCopyPaste)||void 0===e?void 0:e.disabled)||t.focusedCell&&t.isCellSelected(t.focusedCell)))}},{key:"canCutPaste",get:function(){var e;return this.canCopy&&!this.copyOnly&&!(null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.isEditing)&&!this.client.readOnly}},{key:"isActionAvailable",value:function(e){var n=e.actionName;return B(t,"isActionAvailable",this,3)(arguments)&&this.canCopy&&("copy"===n||this.canCutPaste)}},{key:"cut",value:(l=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copy(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"copy",value:(o=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0];return L().mark((function n(){var r,a,o,l,s,u,c,d,h,f;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("boolean"!=typeof t&&(t=!1),a=(r=e).client.selectedCells,!(o=t?a.filter((function(e){var t;return!(null!==(t=e.record)&&void 0!==t&&t.readOnly)})):a)){n.next=14;break}if(!(t?!r.canCutPaste:!r.canCopy)){n.next=5;break}return n.abrupt("return");case 5:return l=r.cellsToString(o),n.next=8,r.writeToClipboard(l,t,{cells:o});case 8:if(n.t0=n.sent,n.t1=i,n.t0!==n.t1){n.next=12;break}return n.abrupt("return");case 12:if(!0===t){s=D(o);try{for(s.s();!(u=s.n()).done;)c=u.value,d=c.column,h=c.record,d.readOnly||(f=null,d.fromClipboardString&&(f=d.fromClipboardString({string:f,record:h})),c.record.set(c.column.field,f))}catch(e){s.e(e)}finally{s.f()}}r.client.trigger("copy",{cells:o,copiedDataString:l,isCut:t,entityName:r.entityName});case 14:case"end":return n.stop()}}),n)}))()})),function(){return o.apply(this,arguments)})},{key:"beforeCopy",value:(a=f((function(e){var t=this,n=e.data,r=e.isCut,i=e.cells;return L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.client.trigger("beforeCopy",{cells:i,data:n,isCut:r,entityName:t.entityName});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"paste",value:(r=f(L().mark((function e(){var t,n,r,i,a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).client,i=n.entityName,a=r.selectedCells[0],n.canCutPaste&&a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.readFromClipboard({},!0);case 5:if(e.t1=t=e.sent,e.t0=null===e.t1,e.t0){e.next=9;break}e.t0=void 0===t;case 9:if(!e.t0){e.next=13;break}e.t2=void 0,e.next=14;break;case 13:e.t2=t.data;case 14:if(o=e.t2){e.next=17;break}return e.abrupt("return");case 17:l=n.setFromStringData(o),s=l.modifiedRecords,u=l.targetCells,1===r.selectedCells.length&&u.length>1&&r.selectCellRange(u[0],u[u.length-1]),r.trigger("paste",{clipboardData:o,targetCell:a,modifiedRecords:z(s),entityName:i});case 20:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"beforePaste",value:(n=f((function(e){var t=this,n=e.data,r=e.text;return L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.client.trigger("beforePaste",{clipboardData:n,targetCell:t.client.selectedCell,entityName:t.entityName,text:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"populateCellMenu",value:function(e){var t=e.record,n=e.items,r=this;r.canCopy&&(n.cutCell={text:r.cutText,localeClass:r,icon:"b-icon b-icon-cut",weight:115,disabled:t.readOnly||!r.canCutPaste,onItem:function(){return r.cut()}},n.pasteCell={text:r.pasteText,localeClass:r,icon:"b-icon b-icon-paste",weight:120,disabled:t.readOnly||!r.canCutPaste||!1===r.hasClipboardData(),onItem:function(){return r.paste()}},n.copyCell={text:r.copyText,localeClass:r,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:function(){return r.copy()}})}}],[{key:"pluginConfig",get:function(){return{chain:["populateCellMenu","afterSelectionModeChange"]}}}]);var n,r,a,o,l}(pC);S(yC,"$name","CellCopyPaste"),S(yC,"configurable",{useNativeClipboard:!Ne.isTestEnv,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}",allowedDataSources:"none"}),yC._$name="CellCopyPaste",Ug.registerFeature(yC);var kC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]);var r=this,i={cellClick:"onCellClick",readOnly:"syncEditingReadOnly",thisObj:r};r.grid=e,"cellclick"!==r.triggerEvent&&(i[r.triggerEvent]="onTriggerEditEvent"),e.ion(i),r.bindStore(e.store)}},{key:"doDestroy",value:function(){this.grid.columns.allRecords.forEach((function(e){var t;null===(t=e._cellEditor)||void 0===t||t.destroy()})),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){e&&!this.isConfiguring&&this.cancelEditing(!0),B(t,"doDisable",this,3)([e])}},{key:"disabled",get:function(){var e=this.grid;return Boolean(B(t,"disabled",this,1)||e.disabled||e.readOnly)},set:function(e){V(t,"disabled",e,this,1,1)}},{key:"isEditing",get:function(){return Boolean(this.editorContext)}},{key:"activeRecord",get:function(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}},{key:"onCellClickWhileEditing",value:(a=f((function(e){var t=this,n=e.event,r=e.cellSelector;return L().mark((function e(){var i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t,!n.target.closest(".b-editor")){e.next=3;break}return e.abrupt("return");case 3:if(!li.isTouchEvent&&!n.target.matches(i.ignoreCSSSelector)){e.next=7;break}return e.next=6,i.finishEditing();case 6:return e.abrupt("return");case 7:if(!i.finishEditingPromise){e.next=9;break}return e.abrupt("return");case 9:if(!i.editorContext||i.editorContext.editor.owns(n.target)){e.next=34;break}if(!i.getEditingContext(r)){e.next=32;break}if(!i.isRowEdit){e.next=20;break}if(!i.continueEditingOnCellClick){e.next=17;break}return e.next=15,i.startEditing(r);case 15:e.next=18;break;case 17:i.cancelEditing();case 18:e.next=30;break;case 20:return e.next=22,i.finishEditing();case 22:if(!e.sent){e.next=28;break}if(!i.continueEditingOnCellClick){e.next=26;break}return e.next=26,i.startEditing(r);case 26:e.next=30;break;case 28:i.grid.focusCell(i.editorContext),i.editor.focus();case 30:e.next=34;break;case 32:return e.next=34,i.finishEditing();case 34:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"onCellClick",value:(r=f((function(e){var t=arguments,n=this,r=e.cellSelector,i=e.target,a=e.event;return e.column,L().mark((function e(){var o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=(o=n).client.focusedCell,!i.closest(".b-tree-expander")){e.next=5;break}return e.abrupt("return",!1);case 5:if(!(li.isTouchEvent&&o._lastCellClicked===(null==l?void 0:l.cell)&&a.timeStamp-o.touchEditDelay>o._lastCellClickedTime)){e.next=10;break}return e.next=8,o.startEditing(r);case 8:e.next=13;break;case 10:if("cellclick"!==n.triggerEvent){e.next=13;break}return e.next=13,o.onTriggerEditEvent.apply(o,z(t));case 13:o._lastCellClicked=null==l?void 0:l.cell,o._lastCellClickedTime=a.timeStamp;case 15:case"end":return e.stop()}}),e)}))()})),function(e){return r.apply(this,arguments)})},{key:"onElementPointerUp",value:function(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(i,e)}},{key:"onTriggerEditEvent",value:(n=f((function(e){var t=this,n=e.cellSelector,r=e.target,i=e.event,a=e.column;return L().mark((function e(o){var l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t.editorContext,s=t.client,!(a.preventCellEditViaMouse||r.closest(".b-tree-expander")||li.isTouchEvent&&"dblclick"===i.type)){e.next=3;break}return e.abrupt("return");case 3:if(!i||(null===(o=s.features.cellMenu)||void 0===o?void 0:o.triggerEvent)!==i.type){e.next=5;break}return e.abrupt("return");case 5:if(!l){e.next=13;break}if(e.t0=l.equals(t.grid.normalizeCellContext(n)),e.t0){e.next=11;break}return e.next=10,t.finishEditing();case 10:e.t0=!e.sent;case 11:if(!e.t0){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,t.startEditing(n);case 15:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"onStoreUpdate",value:function(e){var t=e.changes,n=e.record,r=this.editorContext;null!=r&&r.editor.isVisible&&(n!==r.record||!t.readOnly&&r.editor.dataField&&!(r.editor.dataField in t)||r.editor.refreshEdit())}},{key:"onStoreRemove",value:function(e){e.changes;var t=e.records,n=this.editorContext;null!=n&&n.editor.isVisible&&t.includes(n.editor.record)&&this.cancelEditing()}}],[{key:"pluginConfig",get:function(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}}]);var n,r,a}($i(wc));S(kC,"name","GridEditBase"),S(kC,"configurable",{continueEditingOnCellClick:!0,autoEdit:null,triggerEvent:"celldblclick",ignoreCSSSelector:"button,.b-icon,.b-fa,svg,input,.b-widget"}),kC._$name="GridEditBase";var bC={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},CC=F(F({},bC),{},{startEditing:1,finishAllSelected:1}),wC={cancel:"cancelEditing",complete:"finishEditing"},DC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]);var r=this,i={renderRows:"onGridRefreshed",thisObj:r};r.autoEdit&&!("editNextOnEnterPress"in n)&&(r.editNextOnEnterPress=!1),e.ion(i),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:r})}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",remove:"onStoreRemove",beforeSort:"onStoreBeforeSort",thisObj:this})}},{key:"confirm",value:(v=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!0,!this.editorContext){e.next=8;break}return vb.owner=this.editorContext.editor.inputField,t.rootElement=this.grid.rootElement,e.next=6,vb.confirm(t);case 6:n=e.sent,vb.owner=null;case 8:return e.abrupt("return",n===vb.yesButton);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getEditorForCell",value:function(e){var t,n,r=e.id,i=e.cell,a=e.column,o=e.columnId,l=e.editor,s=this,u=s.grid,c=s.editorClass,d=a.cellEditor,h=0;a.editTargetSelector&&(h=i.querySelector(a.editTargetSelector).offsetLeft);(l.autoSelect=s.autoSelect,null!==(t=d)&&void 0!==t&&t.isEditor)||(d=a.data.cellEditor=c.create(c.mergeConfigs({type:c.type,cls:"b-cell-editor",inputField:l,blurAction:"none",invalidAction:a.invalidAction,completeKey:!1,cancelKey:!1,owner:u,align:{align:"t0-t0",offset:[h,0]},internalListeners:s.getEditorListeners(a.managedCellEditing),onInternalKeyDown:s.onEditorKeydown.bind(s),allowMouseEvents:l.allowMouseEvents,instantUpdate:a.instantUpdate},null!==(n=d)&&void 0!==n&&n.floating?{align:{align:"t0-b0",allowTargetOut:!1,minHeight:100},matchSize:!1,scrollAction:"realign"}:{constrainTo:null},d)));d.minHeight=u.rowHeight,d.inputField!==l&&(d.remove(d.items[0]),d.add(l));var f=d.inputField,v=a.instantUpdate&&!l.cellEditValueSetter;return d.instantUpdate=v,d.align.offset[0]=h,v&&(Be.wrapProperty(l,"value",null,(function(e){var t=s.editorContext;if(t){var n=t.record,r=t.column.editorField;t.editor.isValid&&!Be.isEqual(n.getValue(r),e,!0)&&(null==f||!f.isDateField||null!=f&&f._isPickerInput?(n.setValue(r,e),f._outstandingUpdate=!1):f._outstandingUpdate=!0)}})),l.cellEditValueSetter=!0),Object.assign(d.element.dataset,{rowId:r,columnId:o,field:a.editorField}),d.inputField.revertOnEscape=a.revertOnEscape,s.editor=d}},{key:"getEditorListeners",value:function(e){return{focusOut:e?"onEditorFocusOut":null,focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",afterEdit:"onEditorAfterEdit",thisObj:this}}},{key:"syncEditingReadOnly",value:function(e){var t=e.readOnly;this.isEditing&&t&&this.cancelEditing()}},{key:"onEditorStart",value:function(e){var t=e.source,n=this,r=n.editorContext=t.cellEditorContext;if(r){var i,a,o=n.grid;"cellclick"!==n.triggerEvent&&(n.detachListeners("cellClickWhileEditing"),o.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:n})),null===(i=n.removeEditingListeners)||void 0===i||i.call(n),null===(a=n.removeScrollListener)||void 0===a||a.call(n),r.column.managedCellEditing&&(n.removeEditingListeners=Wn.addListener({globaltap:"onTapOut",thisObj:n})),n.scrollAction&&(n.removeScrollListener=fr.on({element:document,scroll:"onScroll",thisObj:n,capture:!0})),o.trigger("startCellEdit",{grid:o,editorContext:r})}}},{key:"onScroll",value:function(){li.isInView(this.editor.element)||this[wC[this.scrollAction]]()}},{key:"onEditorBeforeComplete",value:function(e){var t=this.grid,n=e.source.cellEditorContext;return e.grid=t,e.editorContext=n,n.oldValue=n.value,n.value=n.editor.inputField.value,t.trigger("beforeFinishCellEdit",e)}},{key:"onEditorComplete",value:function(e){var t=e.source,n=this.grid,r=t.cellEditorContext;if(r){if(r.value=t.inputField.value,t.dataField.includes(".")){var i,a=t.dataField.split(".")[0];null!==(i=t.record.constructor.relations)&&void 0!==i&&i[a]&&n.rowManager.refresh()}n.trigger("finishCellEdit",{grid:n,editorContext:r})}}},{key:"onEditorBeforeCancel",value:function(){var e=this.editorContext;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}},{key:"onEditorCancel",value:function(e){var t=e.event,n=this.editorContext,r=this.muteEvents,i=this.grid;r||i.trigger("cancelCellEdit",{grid:i,editorContext:n,event:t})}},{key:"onBeforeEditorHide",value:function(e){var t,n,r=this,i=e.source.cellEditorContext,a=i.row,o=i.cell;null==o||o.classList.remove("b-editing"),null==a||a.removeCls("b-editing"),r.detachListeners("cellClickWhileEditing"),null===(t=r.removeEditingListeners)||void 0===t||t.call(r),null===(n=r.removeScrollListener)||void 0===n||n.call(r)}},{key:"onEditorAfterEdit",value:function(e){var t,n,r=e.source,i=this.editorContext;r.cellEditorContext=this.editorContext=null,null==i||null===(t=i.column)||void 0===t||null===(n=t.onCellEditComplete)||void 0===n||n.call(t,i)}},{key:"getAdjacentEditableCell",value:function(e,t){for(var n=this.grid,r=n.store,i=n.columns,a=i.visibleColumns,o=e.id,l=e.record,s=i.getAdjacentVisibleLeafColumn(e.columnId,t);o;){if(s){if(this.tabToFocusables){var u=n.normalizeCellContext({record:l,column:s});if(u.target!==u.cell&&!this.getEditingContext(u))return u}return s.canEdit(l)?{id:o,columnId:s.id}:this.getAdjacentEditableCell(n.normalizeCellContext({id:o,columnId:s.id}),t)}var c;o=null===(c=l=r.getAdjacent(e.id,t,!1,!0))||void 0===c?void 0:c.id,l&&(s=t?a[0]:a[a.length-1])}return null}},{key:"doAddNewAtEnd",value:(h=f(L().mark((function e(){var t,n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="object"===W(this.addNewAtEnd)?Be.clone(this.addNewAtEnd):{},n=this.grid.store,r=this.addToCurrentParent,i=n.tree&&r?n.last.parent.appendChild(t):n.add(t)[0],e.next=4,this.client.scrollRowIntoView(i,{animate:!1,block:"nearest"});case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getEditingContext",value:function(e){var t=e=this.grid.normalizeCellContext(e),n=t.column,r=t.record,a=n.editor;if(null!=n&&n.isVisible&&a&&r&&!r.isSpecialRow&&n.canEdit(r)){var o=r?n.getRawValue(r,!0):r;return Object.assign(e,{value:o===i?null:o,editor:a}),e}return!1}},{key:"startEditingFromKeyMap",value:function(){var e=this.grid.focusedCell,t=null==e?void 0:e.column;return!this.disabled&&!1!==(null==t?void 0:t.get("editor"))&&this.startEditing(e)}},{key:"startEditing",value:(d=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return L().mark((function n(){var r,i,a,o,l,s,u,c,d,h,f,v,g,m;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=e).disabled){n.next=39;break}if(u=r.grid,null!==(i=t)&&void 0!==i&&i.fromKeyMap&&(t=u.focusedCell),Be.isEmpty(t)&&(t.id=u.firstVisibleRow.id),!u.store.isTree||!u.features.tree){n.next=13;break}if(!(d=t.id?u.store.getById(t.id):null!==(c=t.record)&&void 0!==c?c:u.store.getAt(t.row))){n.next=12;break}return n.next=10,u.expandTo(d);case 10:n.next=13;break;case 12:return n.abrupt("return",!1);case 13:if(h=r.getEditingContext(t)){n.next=16;break}return n.abrupt("return",!1);case 16:if(!r.editorContext){n.next=22;break}if(h.id!==r.editorContext.id||h.columnId!==r.editorContext.columnId){n.next=19;break}return n.abrupt("return");case 19:if(!1!==r.cancelEditing()){n.next=21;break}return n.abrupt("return",!1);case 21:case 22:if(null!==(a=u.focusedCell)&&void 0!==a&&a.equals(h)||u.focusCell(h),!1!==u.trigger("beforeCellEditStart",{grid:u,editorContext:h})){n.next=25;break}return n.abrupt("return",!1);case 25:return f=h.editor=r.getEditorForCell(h),v=h.row,g=h.cell,m=h.record,f.inputField.highlightExternalChange=!1,f.cellEditorContext=h,f.render(g),g.classList.add("b-editing"),v.addCls("b-editing"),n.next=33,f.startEdit({target:g,field:f.inputField.name||h.column.editorField,value:h.value,record:m});case 33:if(n.sent){n.next=36;break}g.classList.remove("b-editing"),v.removeCls("b-editing");case 36:return null===(o=(l=h.column).onCellEditStart)||void 0===o||o.call(l,h),null===(s=r.onCellEditStart)||void 0===s||s.call(r),n.abrupt("return",!0);case 39:return n.abrupt("return",!1);case 40:case"end":return n.stop()}}),n)}))()})),function(){return d.apply(this,arguments)})},{key:"cancelEditing",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1?arguments[1]:i,n=this,r=n.editor;if(n.isEditing){e.fromKeyMap&&(t=e,e=!1),n.muteEvents=e;var a,o=r.cancelEdit(t);if(n.muteEvents=!1,!1===o)r.inputField.focus();else n.finishEditingPromise=!1,null===(a=n.afterCellEdit)||void 0===a||a.call(n);return o}}},{key:"finishEditing",value:(c=f(L().mark((function e(t){var n,r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).editorContext,i=n.grid,a=!1,!n.finishEditingPromise){e.next=4;break}return e.abrupt("return",n.finishEditingPromise);case 4:if(!r){e.next=21;break}if(o=r.column,"Enter"!==(null==t?void 0:t.key)||r.editor.isEditor){e.next=8;break}return e.abrupt("return",!1);case 8:return n.finishEditingPromise=r.editor.completeEdit(o.bindCallback(o.finalizeCellEdit),t),e.next=11,n.finishEditingPromise;case 11:if(a=e.sent,!i.isDestroyed){e.next=14;break}return e.abrupt("return");case 14:if(!i.isSchedulerBase){e.next=17;break}return e.next=17,i.waitForAnimations();case 17:if(n.finishEditingPromise=null,!a){e.next=21;break}return e.next=21,null===(l=n.afterCellEdit)||void 0===l?void 0:l.call(n);case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"onStoreBeforeSort",value:function(){var e,t=null===(e=this.editorContext)||void 0===e?void 0:e.editor;if(this.isEditing&&(null==t||!t.isFinishing)&&!t.isValid)return this.cancelEditing()}},{key:"onGridRefreshed",value:function(){var e=this,t=e.grid,n=e.editorContext;if(n&&t.isVisible&&t.focusedCell){var r=n.editor,i=n.cell;i&&li.isInView(i)&&!r.isFinishing?(n._cell=i,Wn.suspendFocusEvents(),r.render(i),r.showBy(i),r.focus(),Wn.resumeFocusEvents()):e.finishEditingPromise||e.cancelEditing()}}},{key:"gridSelection",get:function(){return[].concat(z(this.grid.selectedRows),z(this.grid.selectedCells))}},{key:"isActionAvailable",value:function(e){var t=e.actionName,n=e.event,r=this;if(CC[t]){if(!r.disabled&&!n.target.closest(".b-grid-header"))if(r.isEditing){if("finishAllSelected"===t)return r.multiEdit&&r.gridSelection.length>1;if(bC[t])return!0}else if("startEditing"===t)return Boolean(r.grid.focusedCell&&!li.isEditable(n.target));return!1}}},{key:"finishAllSelected",value:(u=f(L().mark((function e(){var t,n,r,i,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=this).editor,r=n.dataField,i=n.record,e.next=3,t.finishEditing();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}e.t0=!t.isDestroyed;case 6:if(!e.t0){e.next=10;break}a=i.getValue(r),o=D(t.gridSelection);try{for(o.s();!(l=o.n()).done;)(s=l.value).isModel?s!==i&&s.setValue(r,a):s.record.set(s.column.editorField,a)}catch(e){o.e(e)}finally{o.f()}case 10:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"finishAndEditNextRow",value:(s=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o,l,s,u,c,d,h,f;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=(i=t).grid,o=i.editorContext,l=o.record,s=o.column,r.next=3,i.finishEditing(e);case 3:if(!(c=r.sent)){r.next=31;break}if(!i.isDestroyed){r.next=7;break}return r.abrupt("return");case 7:if(i.isEditing){r.next=31;break}if(!n){r.next=16;break}if((u=a.internalNextPrevRow(!1,!0,!1))||!a.splitFrom){r.next=14;break}return d=a.splitFrom,r.next=14,d.startEditing({id:d.store.last.id,columnId:s.id});case 14:r.next=28;break;case 16:if(l!==a.store.last){r.next=27;break}if(null===(h=a.features.lockRows)||void 0===h||!h.enabled){r.next=24;break}if(!((f=a.features.lockRows.subViews[0]).store.count>0)){r.next=22;break}return r.next=22,f.startEditing({id:f.store.first.id,columnId:s.id});case 22:r.next=27;break;case 24:if(!i.addNewAtEnd){r.next=27;break}return r.next=27,i.doAddNewAtEnd();case 27:i.isDestroyed||(u=a.internalNextPrevRow(!0,!0));case 28:if(!u||!i.editNextOnEnterPress){r.next=31;break}return r.next=31,i.startEditing(u);case 31:return r.abrupt("return",c);case 32:case"end":return r.stop()}}),r)}))()})),function(e){return s.apply(this,arguments)})},{key:"finishAndEditPrevRow",value:function(e){return this.finishAndEditNextRow(e,!0)}},{key:"finishAndEditNextCell",value:(l=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(i=t).grid,!(o=a.focusedCell)||i.finishEditingPromise){r.next=64;break}if(c=o.columnIndex,d=o.record,h=o.actionTargets,!i.tabToFocusables||!i.editorContext||i.editorContext.editor.inputField){r.next=6;break}if(li.getActiveElement(o.cell)===(n?h[0]:h.at(-1))){r.next=6;break}return r.abrupt("return",!1);case 6:if((f=i.getAdjacentEditableCell(o,!n))||n){r.next=28;break}return r.next=10,i.finishEditing(e);case 10:if(!0!==r.sent){r.next=28;break}if(null===(v=a.features.lockRows)||void 0===v||!v.enabled){r.next=25;break}if(g=_(a.subViews,1),!((m=g[0]).store.count>0)){r.next=23;break}if(p=m.store.first,y={record:p,id:p.id,columnId:m.columns.visibleColumns[0].id},!m.features.cellEdit.getEditingContext(y)){r.next=21;break}return r.next=19,m.startEditing(y);case 19:r.next=23;break;case 21:return r.next=23,m.startEditing(i.getAdjacentEditableCell(y));case 23:r.next=28;break;case 25:if(!i.addNewAtEnd){r.next=28;break}return r.next=28,i.doAddNewAtEnd();case 28:if(k=!0,!i.isEditing){r.next=33;break}return r.next=32,i.finishEditing(e);case 32:k=r.sent;case 33:if(!i.isDestroyed){r.next=35;break}return r.abrupt("return");case 35:if((f=i.getAdjacentEditableCell(new cg({grid:a,record:d,columnIndex:c}),!n))||!n||null===(l=a.splitFrom)||void 0===l||!l.features.lockRows||d!==a.store.first){r.next=45;break}if(b=a.splitFrom,C=b.store.last,w=b.columns.visibleColumns[b.columns.visibleColumns.length-1],D={record:C,id:C.id,columnId:w.id},!b.features.cellEdit.getEditingContext(D)){r.next=43;break}return r.next=41,b.startEditing(D);case 41:r.next=45;break;case 43:return r.next=45,b.startEditing(i.getAdjacentEditableCell(D,!1));case 45:if(!f){r.next=63;break}if(!k){r.next=61;break}if(f.target===f.cell||!i.tabToFocusables){r.next=54;break}S=a.findFocusables(f.cell),f.editor=i.editor=i.getFakeEditor(f.target),S[n?S.length-1:0].focus(),i.editorContext=f,r.next=59;break;case 54:return a.focusCell(f,{animate:i.focusCellAnimationDuration}),r.next=57,i.startEditing(f);case 57:if(r.sent){r.next=59;break}return r.abrupt("return",i.finishAndEditNextCell(e,n));case 59:r.next=61;break;case 61:r.next=64;break;case 63:!a.isNested||!a.owner||null!==(s=(u=a.owner).catchFocus)&&void 0!==s&&s.call(u,{source:a,navigationDirection:n?"up":"down",editing:!0})||a.onTab(e);case 64:case"end":return r.stop()}}),r)}))()})),function(e){return l.apply(this,arguments)})},{key:"getFakeEditor",value:function(e){var t=this,n=function(){return t.editorContext=t.editor=null,!0};return{element:e,completeEdit:n,cancelEdit:n,isFinishing:!0}}},{key:"finishAndEditPrevCell",value:function(e){return this.finishAndEditNextCell(e,!0)}},{key:"onElementKeyDown",value:(o=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).grid,i=r.focusedCell,!(t.handled||!n.autoEdit||n.isEditing||!i||i.isActionable&&li.isEditable(t.target)||t.ctrlKey)){e.next=3;break}return e.abrupt("return");case 3:if(a=t.key,o="Delete"===t.key||"Backspace"===t.key,l=(o?n:{}).gridSelection,s=n.multiEdit&&(null==l?void 0:l.length)>1,e.t0=a.length<=1||o&&!s,!e.t0){e.next=9;break}return e.next=8,n.startEditing(i);case 8:e.t0=e.sent;case 9:if(!e.t0){e.next=15;break}u=n.editor.inputField,(c=u.input)&&(u.internalOnKeyEvent(t),t.defaultPrevented||(c.value=o?"":a,u.internalOnInput(t))),t.preventDefault(),e.next=33;break;case 15:if(!s){e.next=33;break}if(!1===r.trigger("beforeCellRangeDelete",{grid:r,gridSelection:l})){e.next=33;break}d=D(l),e.prev=18,f=L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=h.value).isModel?r.columns.visibleColumns.forEach((function(e){e.canEdit(t)&&t.set(e.editorField,null)})):t.column.canEdit(t.record)&&t.record.set(t.column.editorField,null);case 2:case"end":return e.stop()}}),e)})),d.s();case 21:if((h=d.n()).done){e.next=25;break}return e.delegateYield(f(),"t1",23);case 23:e.next=21;break;case 25:e.next=30;break;case 27:e.prev=27,e.t2=e.catch(18),d.e(e.t2);case 30:return e.prev=30,d.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[18,27,30,33]])}))),function(e){return o.apply(this,arguments)})},{key:"onEditorKeydown",value:function(e){if(e.key&&1!==e.key.length&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return e.key.startsWith("Arrow")||"Backspace"===e.key||"End"===e.key||e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}},{key:"onEditorFocusOut",value:(a=f(L().mark((function e(t){var n,r,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).grid,a=n.editor,o=n.editorContext,l=new cg(t.relatedTarget),s=l.grid===r&&n.getEditingContext(l),!o||a.isFinishing||!a.owns(t._target)){e.next=9;break}if("cancel"!==n.blurAction&&r.store.includes(o.record)){e.next=6;break}n.cancelEditing(i,t),e.next=9;break;case 6:if(n.finishEditingPromise||"cellclick"!==n.triggerEvent&&("cellclick"===n.triggerEvent||s)){e.next=9;break}return e.next=9,n.finishEditing(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onEditorFocusIn",value:function(e){var t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}},{key:"onTapOut",value:(r=f((function(e){var t=this,n=e.event;return L().mark((function e(){var r,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,(a=n.target)._shadowRoot||r.editor.owns(a)||r.grid.bodyContainer.contains(a)&&!n.button){e.next=11;break}if(o=r.resolveCallback(r.validateTapOut,r,!1),l=(null==o?void 0:o.handler.call(o.thisObj,n,r.editorContext))||r.blurAction,r.editingStoppedByTapOutside=!0,"cancel"!==l){e.next=8;break}r.cancelEditing(i,n),e.next=10;break;case 8:return e.next=10,r.finishEditing(n);case 10:delete r.editingStoppedByTapOutside;case 11:case"end":return e.stop()}}),e)}))()})),function(e){return r.apply(this,arguments)})},{key:"onElementClick",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.matches(".b-grid-body-container, .b-grid-subgrid")||!this.editorContext){e.next=3;break}return e.next=3,this.finishEditing(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"defaultConfig",get:function(){return{autoSelect:!0,blurAction:"complete",scrollAction:null,addNewAtEnd:null,addToCurrentParent:!1,editNextOnEnterPress:!0,editorClass:Xk,touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:{handler:"finishAndEditNextCell",weight:100},"Shift+Tab":{handler:"finishAndEditPrevCell",weight:100}},validateTapOut:null,tabToFocusables:null}}},{key:"pluginConfig",get:function(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}}]);var n,r,a,o,l,s,u,c,d,h,v}(kC);S(DC,"$name","CellEdit"),DC._$name="CellEdit",Ug.registerFeature(DC,!0);var SC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"showContextMenu",value:function(e){var n=e.cellSelector,r=e.event;this.client.focusCell(n,{doSelect:!this.client.selectedRecordCollection.includes(n.id),event:r}),B(t,"showContextMenu",this,3)([e])}},{key:"shouldShowMenu",value:function(e){var t=e.column;return t&&!1!==t.enableCellContextMenu}},{key:"getDataFromEvent",value:function(e){var n=this.client.getCellDataFromEvent(e);if(n)return Be.assign(B(t,"getDataFromEvent",this,3)([e]),n)}},{key:"beforeContextMenuShow",value:function(e){var t=e.record,n=e.items;if(!1===e.column.cellMenuItems)return!1;t&&!t.isSpecialRow||(n.removeRow=!1)}},{key:"populateCellMenu",value:function(e){var t=e.items,n=e.column,r=e.record,i=this.client;null!=n&&n.cellMenuItems&&Be.merge(t,n.cellMenuItems),i.readOnly||(t.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:r.readOnly,onItem:function(){var e,t,a=null!==(e=null===(t=i.features.treeGroup)||void 0===t?void 0:t.originalStore)&&void 0!==e?e:i.store;i.isCellSelected({record:r,column:n},!0)?a.remove(i.selectedRecords.filter((function(e){return!e.readOnly})).map((function(e){return e.$original}))):a.remove(r)}})}},{key:"showMenu",get:function(){return!0}},{key:"showMenuFor",value:function(e){var t=(arguments.length>1&&arguments[1]!==i?arguments[1]:{}).targetElement;e=this.client.normalizeCellContext(e),li.triggerMouseEvent(t||this.client.getCell(e),this.triggerEvent)}}],[{key:"defaultConfig",get:function(){return{processItems:null,items:null,type:"cell"}}},{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateCellMenu"),e}}])}(op);S(SC,"$name","CellMenu"),SC.featureClass="",SC._$name="CellMenu",Ug.registerFeature(SC,!0,["Grid","Scheduler"]),Ug.registerFeature(SC,!1,["Gantt"]);var xC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,this.processConfig(n)])}},{key:"initTip",value:function(){var e=this;e.tip=pc.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.client.ion({startCellEdit:e.tip.hide,thisObj:e.tip}),e.relayEvents(e.tip,["beforeShow","show"])}},{key:"onPointerOver",value:function(e){var t=e.target,n=this.client.getColumnFromElement(t);return!1!==n.tooltipRenderer&&Boolean(n.tooltipRenderer||this.tooltipRenderer)}},{key:"processConfig",value:function(e){return"function"==typeof e?{tooltipRenderer:e}:e}},{key:"setConfig",value:function(e){B(t,"setConfig",this,3)([this.processConfig(e)])}},{key:"doDestroy",value:function(){var e;null===(e=this.tip)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){var n;e?this.tip=null===(n=this.tip)||void 0===n?void 0:n.destroy():this.initTip();B(t,"doDisable",this,3)([e])}},{key:"getTooltipContent",value:function(e){var t,n=e.tip,r=e.activeTarget,i=e.event,a=this,o=a.client.getRecordFromElement(r),l=a.client.getColumnFromElement(r),s={cellElement:r,record:o,column:l,event:i,tip:n,cellTooltip:a};return a.forSelector||o!==a.lastRecord||o.generation!==a.lastRecordGeneration||l!==a.lastColumn?(a.lastRecord=o,a.lastRecordGeneration=o.generation,a.lastColumn=l,l.tooltipRenderer?t=l.tooltipRenderer(s):a.tooltipRenderer&&!1!==l.tooltipRenderer&&(t=a.tooltipRenderer(s)),pe.isPromise(t)&&(a.lastRecord=a.lastRecordGeneration=a.lastColumn=null),t||n.hide(),t):a.tip._html}}])}(wc);S(xC,"$name","CellTooltip"),S(xC,"configurable",{tooltipRenderer:null}),xC._$name="CellTooltip",Ug.registerFeature(xC);var EC,RC,TC,MC="store",FC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]);var n=this.store;n&&this.bindStore(n)}},{key:"doDestroy",value:function(){this.unbindStore(),B(t,"doDestroy",this,3)([])}},{key:"store",get:function(){return this.client.$store}},{key:"bindStore",value:function(e){this.lastSync=null,e.ion(S(S({name:MC},"change".concat(this.client.asyncEventSuffix),"onStoreChange"),"thisObj",this))}},{key:"unbindStore",value:function(){this.detachListeners(MC)}},{key:"columnAutoWidthPending",get:function(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}},{key:"onStoreChange",value:function(e){var t=e.action;if("move"!==t&&this.client.isPainted){var n=this,r=n.client.features.cellEdit;++n.storeGeneration,"filter"===t||null!=r&&r.isEditing&&!r.editingStoppedByTapOutside?n.syncAutoWidthColumns():n.client.refreshSuspended?n.client.rowManager.once("renderDone",(function(){return n.syncAutoWidthColumns()})):n.setTimeout({fn:"syncAutoWidthColumns",delay:n.delay,cancelOutstanding:!0})}}},{key:"onInternalResize",value:function(e,t,n,r){0===r&&(this.lastSync=null,this.syncAutoWidthColumns())}},{key:"syncAutoWidthColumns",value:function(){var e,t=this.client;this.disabled||0===t.store.count||0===t.rowManager.rows.length||t.splitFrom&&(null===(e=t.splitFrom.features)||void 0===e||null===(e=e.lockRows)||void 0===e||!e.enabled)||this.doSyncAutoWidthColumns()}},{key:"doSyncAutoWidthColumns",value:function(){var e=this,t=e.client,n=e.storeGeneration;if((!t.splitFrom||t.usesLockRows)&&t.isPainted){if(e.lastSync!==n){var r,i;e.lastSync=n;var a,o=D(t.columns.visibleColumns);try{for(o.s();!(a=o.n()).done;){var l=a.value;(r=l.autoWidth)&&(!0===r&&(r=e.default),t.resizingColumns=i=!0,l.resizeToFitContent(r))}}catch(e){o.e(e)}finally{o.f()}i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}}],[{key:"pluginConfig",get:function(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}}])}($i(wc));S(FC,"$name","ColumnAutoWidth"),S(FC,"configurable",{default:null,delay:0}),FC.prototype.storeGeneration=0,FC._$name="ColumnAutoWidth",Ug.registerFeature(FC,!0);var AC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,B(t,"construct",this,3)([e,n])}},{key:"doDestroy",value:function(){var e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),B(t,"doDisable",this,3)([e])}},{key:"init",value:function(){var e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart:function(n){var r=n.context,i=t.columns.getById(r.element.dataset.columnId);e.showToolbar(i)},gridheaderdrag:function(t){var n=t.context;return e.onDrag(n)},gridheaderabort:function(){e.hideToolbar()},gridHeaderDrop:e.onDrop,thisObj:e}),e.initialized=!0)}},{key:"onColumnReorderBeforeDestroy",value:function(){this.detachFromColumnReorder()}},{key:"detachFromColumnReorder",value:function(){var e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}},{key:"render",value:function(){this.initialized||this.init()}},{key:"showToolbar",value:function(e){var t=this,n=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),n.forEach((function(e){e.text=e.localeClass.L(e.text);var t=r.find((function(t){return t.text===e.group}));t||(t={text:e.localeClass.L(e.group),buttons:[]},r.push(t)),t.buttons.push(e)})),t.element=li.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=n,t.column=e}},{key:"hideToolbar",value:(n=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=(t=this).element)){e.next=7;break}return n.classList.add("b-remove"),e.next=5,fr.waitForTransitionEnd({element:n,mode:"animation",thisObj:t.client});case 5:n.remove(),t.element=null;case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onDrag",value:function(e){var t,n=this;if(e.dragProxy.getBoundingClientRect().top-n.grid.element.getBoundingClientRect().top>100?n.element.classList.add("b-closer"):n.element.classList.remove("b-closer"),n.hoveringButton&&(n.hoveringButton.classList.remove("b-hover"),n.hoveringButton=null),null!==(t=e.targetElement)&&void 0!==t&&t.closest(".b-columndragtoolbar")){n.element.classList.add("b-hover");var r=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),n.hoveringButton=r)}else n.element.classList.remove("b-hover")}},{key:"onDrop",value:function(e){var t=e.context,n=this,r=t.targetElement;if(r&&r.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){var i=n.buttons.find((function(e){return e.ref===r.dataset.ref}));i&&(r.classList.add("b-activate"),n.buttonHideTimer=n.setTimeout((function(){n.hideToolbar(),i.onDrop({column:n.column})}),100))}else n.hideToolbar()}},{key:"template",value:function(e){return Kf.tpl(EC||(EC=N(['\n            <div class="b-columndragtoolbar">\n            <div class="b-title"></div>\n            ',"\n            </div>"])),e.map((function(e){return Kf.tpl(RC||(RC=N(['\n                <div class="b-group">\n                    <div class="b-buttons">\n                    ','\n                    </div>\n                    <div class="b-title">',"</div>\n                </div>\n            "])),e.buttons.map((function(e){return Kf.tpl(TC||(TC=N(['\n                        <div class="b-target-button" data-ref="','" data-disabled="','">\n                            <i class="','"></i>\n                            ',"\n                        </div>\n                    "])),e.ref,e.disabled,e.icon,e.text)})),e.text)})))}}],[{key:"pluginConfig",get:function(){return{after:["render"]}}}]);var n}($i(wc));S(AC,"$name","ColumnDragToolbar"),AC.featureClass="b-hascolumndragtoolbar",AC._$name="ColumnDragToolbar",Ug.registerFeature(AC,ne.isTouchDevice);var IC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"grid",get:function(){return this.client}},{key:"getColumnPickerItems",value:function(e){var t,n=this,r=n.createColumnsFromModel;if(n.groupByRegion)t=n.grid.regions.map((function(e){var t=n.grid.getSubGrid(e).columns.topColumns;return{text:Le.capitalize(e),menu:n.buildColumnMenu(t),disabled:0===t.length,region:e}})),r&&t.push({text:n.L("L{newColumns}"),menu:n.createAutoColumnItems()});else if(n.groupByTag){var i={};e.topColumns.forEach((function(e){e.tags&&Array.isArray(e.tags)&&!1!==e.hideable&&e.tags.forEach((function(e){i[e]||(i[e]=1)}))})),t=Object.keys(i).sort().map((function(e){return{text:Le.capitalize(e),menu:n.buildColumnMenu(n.getColumnsForTag(e)),tag:e,onBeforeSubMenu:function(e){var t=e.item,r=e.itemEl;n.refreshTagMenu(t,r)}}})),r&&t.push({text:n.L("L{newColumns}"),menu:n.createAutoColumnItems()})}else{var a;if(t=n.buildColumnMenu(e.topColumns),r)(a=t.items).push.apply(a,z(Be.transformNamedObjectToArray(n.createAutoColumnItems())))}return t}},{key:"createAutoColumnItems",value:function(){for(var e=this,t=e.grid,n=t.columns,r=t.store.modelClass.allFields,i={},a=function(){var a=r[o],l=a.name;n.get(l)||a.internal||(i[l]={text:a.text||Le.separate(a.name),checked:!1,onToggle:function(r){var i=n.get(l);i?i[r.checked?"show":"hide"]():(t._suspendRenderContentsOnColumnsChanged=!0,n.add(n.generateColumnForField(a,{region:e.forColumn.region}),!0),t._suspendRenderContentsOnColumnsChanged=!1,t.renderContents()),r.bubbles=!1}})},o=0,l=r.length;o<l;o++)a();return i}},{key:"getColumnsForTag",value:function(e){return this.grid.columns.records.filter((function(t){return t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&!1!==t.hideable}))}},{key:"refreshTagMenu",value:function(e,t){this.getColumnsForTag(e.tag).forEach((function(t){var n=e.items.find((function(e){return e.column===t}));n&&(n.checked=!0!==t.hidden)}))}},{key:"buildColumnMenu",value:function(e){var t=this,n=e.length>0&&e[0].region,r=this.grid,i=e.reduce((function(e,i){if(!1!==i.hideable){var a=r.columns.visibleColumns.filter((function(e){return e.region===i.region})),o=!0!==i.hidden,l={grid:r,column:i,text:i.htmlEncodeHeaderText?i.text:li.stripTags(i.text),checked:o,disabled:o&&1===a.length,cls:i.region!==n?"b-separator":"",ariaLabel:t.L(o?"L{ColumnPicker.hideName}":"L{ColumnPicker.showName}",i)};n=i.region,i.children&&!i.isCollapsible&&(l.menu=t.buildColumnMenu(i.children)),e.push(l)}return e}),[]);return{cls:this.menuCls,items:i}}},{key:"populateHeaderMenu",value:function(e){var t=e.column,n=e.items,r=this,i=r.grid.columns;r.forColumn=t,!1!==t.showColumnPicker&&i.some((function(e){return e.hideable}))&&(n.columnPicker={text:"L{columnsMenu}",localeClass:r,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:r.getColumnPickerItems(i),onToggle:r.onColumnToggle,disabled:r.disabled}),!1===t.hideable||t.parent.isCollapsible||(n.hideColumn={text:"L{hideColumn}",localeClass:r,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!t.allowDrag||r.disabled,onItem:function(){return t.hide()}})}},{key:"onColumnToggle",value:function(e){var t=e.menu,n=e.item,r=e.checked;if(Boolean(n.column.hidden)!==!r){var i,a;n.column[r?"show":"hide"](),n.ariaLabel=this.L("L{HeaderMenu.".concat(r?"hide":"show","Name}"),n.column);var o=n.grid,l=n.column,s=o.columns,u=o.features,c=t.items,d=s.visibleColumns.filter((function(e){return e.region===n.column.region&&!1!==e.showColumnPicker})),h=(null===(i=u.headerMenu)||void 0===i?void 0:i.enabled)&&u.headerMenu.menu.widgetMap.hideColumn;if(1===d.length){var f=c.find((function(e){return e.column===d[0]}));f&&(f.disabled=!0),h&&l.region===n.column.region&&(h.disabled=!0)}else d.forEach((function(e){var t=c.find((function(t){return t.column===e}));t&&(t.disabled=!1)})),h&&l.region===n.column.region&&(h.disabled=!1);null===(a=n.menu)||void 0===a||a.eachWidget((function(e){e.checked=r}));var v=t.owner;v&&v.column===l.parent&&(v.checked=c.some((function(e){return!0===e.checked})))}}},{key:"getColumnDragToolbarItems",value:function(e,t){var n=this.grid.columns.visibleColumns.filter((function(t){return t.region===e.region}));return!1!==e.hideable&&n.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:function(e){return e.column.hide()}}),t}}],[{key:"pluginConfig",get:function(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}}])}(wc);S(IC,"$name","ColumnPicker"),S(IC,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),IC._$name="ColumnPicker",Ug.registerFeature(IC,!0);var LC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;null===(e=this.editor)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"populateHeaderMenu",value:function(e){var t=this,n=e.items,r=e.column;n.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:r.readOnly,onItem:function(){return t.startEdit(r)}}}},{key:"startEdit",value:function(e){var t;e instanceof Event&&(e=null===(t=this.client.getHeaderDataFromEvent(e))||void 0===t?void 0:t.column);if(!e||e.readOnly||this.disabled)return!1;var n=e.textWrapper,r=this.editor;r||(this.editor=r=new Xk({owner:this.client,align:{align:"t0-t0"}})),r.render(n),r.startEdit({target:n,record:e,field:"text"})}}],[{key:"pluginConfig",get:function(){return{after:["populateHeaderMenu"]}}}])}(wc);S(LC,"$name","ColumnRename"),S(LC,"configurable",{keyMap:{F2:"startEdit"}}),LC._$name="ColumnRename",Ug.registerFeature(LC,!1);var OC=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"]),e}return R(t,e),w(t,[{key:"init",value:function(){var e=this,t=e.grid,n=t.element,r=li.children(n,".b-grid-headers");r.push.apply(r,z(li.children(n,".b-grid-header-children"))),e.dragHelper?e.dragHelper.containers=r:t.whenVisible((function(){return e.createDragHelper()}))}},{key:"createDragHelper",value:function(){var e=this,t=e.grid,n=t.element,r=li.children(n,".b-grid-headers");return r.push.apply(r,z(li.children(n,".b-grid-header-children"))),e.dragHelper=new Qi({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,externalDropTargetSelector:".b-groupbar, .b-columndragtoolbar",monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:vg.new({direction:"horizontal",element:t.headerContainer}),containers:r,isElementDraggable:function(n){if(Boolean(n.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;var r=n.closest(this.targetSelector),i=r&&t.columns.getById(r.dataset.columnId),a=0===(null==i?void 0:i.childLevel)&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!a},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",resolveTargetElement:function(e){var n=e.closest("[data-column-id]");return n?t.columns.getById(n.dataset.columnId).element:e},internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onAbort,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"),e.dragHelper}},{key:"doDestroy",value:function(){var e,n;null===(e=this.dragHelper)||void 0===e||e.scrollManager.destroy(),null===(n=this.dragHelper)||void 0===n||n.destroy(),B(t,"doDestroy",this,3)([])}},{key:"grid",get:function(){return this.client}},{key:"onBeforeDragStart",value:function(e){var t=e.source,n=e.context,r=e.event,i=this,a=n.element,o=n.column=i.client.columns.getById(a.dataset.columnId);return t.autoSizeClonedTarget=!i.stretchedDragProxy&&!i.usingGroupBarWidget,t.dropTargetSelector=i.stretchedDragProxy?null:".b-grid-headers, .b-groupbar, .b-columndragtoolbar",o.allowDrag&&i.client.trigger("beforeColumnDragStart",{column:o,event:r})}},{key:"onDragStart",value:function(e){var t=e.context,n=e.event,r=this,i=r.grid,a=r.usingGroupBarWidget,o=r.dragHelper,l=t.column,s=t.dragProxy,u=t.element,c=i.element.querySelector(".b-grid-header-container").getBoundingClientRect();s.style.width=l.element.offsetWidth+"px",o.useCenteredCursor=!r.stretchedDragProxy,i.features.columnDragToolbar||a?s.style.height=c.height+"px":(o.minY=c.top,r.stretchedDragProxy?(s.classList.add("b-column-reorder-stretched"),li.setTranslateXY(s,u.left,u.top),o.maxY=i.element.getBoundingClientRect().bottom):o.maxY=c.bottom,s.style.height=i.bodyElement.offsetHeight+"px"),i.element.classList.add("b-dragging-header"),a&&s.classList.add("b-grid-reordering-columns-with-groupbar"),i.features.filterBar&&i.features.filterBar.compactMode&&s.classList.add("b-filter-bar-compact"),i.trigger("columnDragStart",{column:l,event:n})}},{key:"onDrag",value:function(e){var t=e.context,n=e.event,r=this.client,i=t.column,a=t.insertBefore,o=r.columns.getById(null==a?void 0:a.dataset.columnId),l=Lo.fromElement(n.target,"gridheader");null!=l&&l.subGrid.sealedColumns&&(t.valid=!1),r.trigger("columnDrag",{column:i,insertBefore:o,event:n,context:t})}},{key:"onDrop",value:function(e){var t,n=e.context,r=e.event;if(!n.valid)return this.onInvalidDrop({context:n,event:r});var i,a,o,l,s,u=this.grid,c=n.column,d=n.dragging,h=n.target.closest(".b-grid-header"),f=null===(t=n.draggedTo)||void 0===t?void 0:t.dataset.region,v=f||h;if(u.element.classList.remove("b-dragging-header"),v){var g=h?u.columns.getById(h.dataset.columnId):u.subGrids[f].columns.last,m=n.insertBefore;if(l=f||g.region,s=c.parent,o=m?u.columns.getById(m.dataset.columnId):u.subGrids[l].columns.last.nextSibling)a=o.parent;else{var p=null==h?void 0:h.parentElement.closest(".b-grid-header");a=p?u.columns.getById(p.dataset.columnId):u.columns.rootNode}i=l===c.region&&s===a&&(g===c.previousSibling||o===c.nextSibling),d.remove()}!(i=i||!1===u.trigger("beforeColumnDropFinalize",{column:c,newParent:a,insertBefore:o,event:r,region:l}))&&v&&(i=!a.insertChild(c,o)),n.valid=!i,!i&&v&&(c.parent.isRoot&&c.region!==l&&(c.region=l),0===s.children.length&&s.parent.removeChild(s)),u.trigger("columnDrop",{column:c,newParent:a,insertBefore:o,valid:n.valid,event:r,region:l})}},{key:"onAbort",value:function(e){var t=e.context,n=e.event;this.onInvalidDrop({context:t,event:n})}},{key:"onInvalidDrop",value:function(e){var t=e.context,n=e.event,r=this.grid,i=t.column;r.trigger("columnDrop",{column:i,valid:!1,event:n}),r.element.classList.remove("b-dragging-header")}},{key:"renderContents",value:function(){this.init()}},{key:"onInternalPaint",value:function(){this.init()}},{key:"isReordering",get:function(){var e;return Boolean(null===(e=this.dragHelper)||void 0===e?void 0:e.isDragging)}}],[{key:"pluginConfig",get:function(){return{after:["onInternalPaint","renderContents"]}}}])}($i(wc));S(OC,"$name","ColumnReorder"),S(OC,"configurable",{stretchedDragProxy:null}),OC.featureClass="b-column-reorder",OC._$name="ColumnReorder",Ug.registerFeature(OC,!0);var PC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;B(t,"construct",this,3)([e,n]),r.resizer=new sp({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,constrainToParent:!1,internalListeners:{beforeresizestart:r.onBeforeResizeStart,resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,cancel:r.onCancel,thisObj:r}})}},{key:"doDestroy",value:function(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"changeLiveResize",value:function(e){return"auto"===e?!ne.isMobileSafari:e}},{key:"onBeforeResizeStart",value:function(e){var t=e.event,n=e.element,r=this.client;return!this.disabled&&r.trigger("beforeColumnResize",{column:r.columns.getById(n.dataset.columnId),domEvent:t})}},{key:"onResizeStart",value:function(e){var t=e.context,n=this.client,r=this.resizer,i=t.column=n.columns.getById(t.element.dataset.columnId),a=i.subGrid.columns.allRecords;r.minWidth=i.minWidth,t.subGridBoundary=i.element.getBoundingClientRect()[n.rtl?"left":"right"],n.element.classList.add("b-column-resizing"),a.slice(0,a.indexOf(i)).forEach((function(e){e.flex&&e.element&&e!==i.parent&&e.set({width:e.element.offsetWidth,flex:""})})),n.trigger("columnResizeStart",{column:i,domEvent:t.event})}},{key:"onResizing",value:function(e){var t=e.context;if(t.valid&&this.liveResize){var n=t.column,r=n.subGrid,i=r.scrollable,a=r.columns,o=this.client.rtl;this.client.resizingColumns=!0,n.width=t.newWidth,r.refreshFakeScroll(),n===a.last&&(o?t.currentX<t.subGridBoundary:t.currentX>t.subGridBoundary)&&(i.x=i.maxX)}}},{key:"onResize",value:function(e){var t=e.context,n=this.client,r=t.column,i=t.event;n.element.classList.remove("b-column-resizing"),t.valid&&(this.liveResize?(n.resizingColumns=!1,n.afterColumnsResized(r)):r.width=t.newWidth,n.trigger("columnResize",{column:r,domEvent:i}))}},{key:"onCancel",value:function(e){var t=e.context,n=this.client;n.element.classList.remove("b-column-resizing"),t.column.width=t.elementWidth,n.resizingColumns=!1}}])}(wc);S(PC,"$name","ColumnResize"),S(PC,"configurable",{liveResize:"auto"}),PC._$name="ColumnResize",Ug.registerFeature(PC,!0);var _C=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"delayable",{handleSelection:"raf"}),e}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]);var e=this.client;e.selectionMode.cell||(this.disabled=!0),e.ion({startCellEdit:"onStartCellEdit",finishCellEdit:"onFinishCellEdit",cancelCellEdit:"onFinishCellEdit",rowExpand:"onContentChange",rowCollapse:"onContentChange",thisObj:this}),this._fillListeners={}}},{key:"onContentChange",value:(r=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.removeElements(),e.next=3,this.client.waitForAnimations();case 3:this.handleSelection(!0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"fixElementHeights",value:function(){this.handleSelection()}},{key:"syncFlexedSubCols",value:function(){this.handleSelection()}},{key:"beforeSubGridInternalResize",value:function(){this.removeElements()}},{key:"onStoreRemove",value:function(e){e.isCollapse&&this.handleSelection(!0)}},{key:"onStartCellEdit",value:function(){this.removeElements(!1)}},{key:"onFinishCellEdit",value:function(){this.handleSelection()}},{key:"getCellDataFromEvent",value:function(e,t){return t&&(t=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,t)}},{key:"currentRangeForEvents",get:function(){if(this.currentRange){var e=this.currentRange,t=e.from,n=e.to;if(e.negative){var r=[n,t];t=r[0],n=r[1]}return{from:t,to:n}}}},{key:"findPatternsIn2dRange",value:function(e,t,n){var r,i={},a=D(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,l=t?o.id:o.columnId,s=o.record.getValue(o.column.editorField);s&&"string"==typeof s&&!isNaN(s)&&(s=parseFloat(s)),i[l]||(i[l]=[]),i[l].push(s)}}catch(e){a.e(e)}finally{a.f()}for(var u in i)i[u].pattern=this.findPatternsIn1dRange(i[u],n);return i}},{key:"findPatternsIn1dRange",value:function(e,t){var n=e[t?0:e.length-1],r={next:function(){return n},lastValue:n};if(e.every((function(e){return"number"==typeof e}))||e.every((function(e){return e instanceof Date}))){var a=e.map((function(t,n){return t-e[n-1]}));a.shift(),1===new o(a).size&&(r.increaseBy=a[0]*(t?-1:1),r.next=function(){return r.lastValue instanceof Date?r.lastValue=new Date(r.lastValue.getTime()+r.increaseBy):r.lastValue+=r.increaseBy,r.lastValue})}else e.length>1&&(r.stringPattern=z(e),r.next=function(){return r.currentIndex===i?r.currentIndex=0:(r.currentIndex+=1,r.currentIndex>=r.stringPattern.length&&(r.currentIndex=0)),r.stringPattern[r.currentIndex]});return r}},{key:"afterSelectionChange",value:function(){var e=this;e.client.readOnly||e.disabled?e.removeElements():Wn.isMouseDown()?(e.client.delayUntilMouseUp((function(){return e.handleSelection(!0)})),e.removeElements()):e.handleSelection(!0)}},{key:"handleSelection",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];if(this.enabled&&!this._isExtending){e&&(this._cachedSelectedRange=null);var t=this.rangeSelection;t?this.drawFillHandleAndBorder(t[0],t[t.length-1]):this.removeElements()}}},{key:"onMouseDown",value:function(e){var t=this.client;this.enabled&&!t.readOnly&&!1!==t.trigger("beforeFillHandleDragStart",{cell:t.focusedCell,domEvent:e})&&(this._fillListeners.mouseDownOver=fr.on({element:this.rootElement,keydown:"onKeyDown",mouseenter:{handler:"onMouseOver",delegate:".b-grid-cell",element:t.selectionDragMouseEventListenerElement},capture:!0,thisObj:this}),this._fillListeners.mouseUp=fr.on({element:document,capture:!0,mouseup:"onMouseUp",thisObj:this}),e.preventDefault(),e.stopImmediatePropagation(),e.handled=!0,t.trigger("fillHandleDragStart",{cell:t.focusedCell,domEvent:e}))}},{key:"onMouseUp",value:(n=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.trigger("fillHandleBeforeDragFinalize",F(F({},this.currentRangeForEvents),{},{domEvent:t}));case 2:e.t0=e.sent,n=!1!==e.t0,this.finalize(n,t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"finalize",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n.client,o=n.currentRange,l=n.currentRangeForEvents,s=n._isCropping,u=n.rangeSelection,c=u&&o&&r.internalSelectRange(o.from,o.to),d=(null==c?void 0:c.selectedCells)||[],h=s?n.croppingCells:d.filter((function(e){return!u.some((function(t){return t.equals(e,!0)}))}));if(n._isCropping=null,n._isExtending&&(r.disableScrollingCloseToEdges(r.items),n._isExtending=null),null==h||!h.length||!e)return n.currentRange=null,n.handleSelection(),void r.trigger("fillHandleDragAbort",{cell:r.focusedCell});if(r.suspendRefresh(),s)h.forEach((function(e){return e.record.set(e.column.field,null,!1,!1,!1,!0)}));else{var f=_(h,1)[0],v=u.some((function(e){return e.record===f.record})),g=v?f.columnIndex<u[0].columnIndex:f.rowIndex<u[0].rowIndex,m=n.findPatternsIn2dRange(u,v,g),p=new a;g&&h.reverse();var y,k=D(h);try{for(k.s();!(y=k.n()).done;){var b,C=y.value,w=C.column,S=C.record,x=null===(b=n.calculateFillValue)||void 0===b?void 0:b.call(n,{range:u,column:w,record:S,cell:C});if(x===i)x=m[v?C.id:C.columnId].pattern.next();if(w.canFillValue({range:u,record:S,cell:C,value:x,enforceType:v})){var E,R=p.get(S);R||(R={},p.set(S,R)),R[w.field]=(null===(E=w.calculateFillValue)||void 0===E?void 0:E.call(w,{value:x,record:S,range:u,horizontal:v}))||x}}}catch(e){k.e(e)}finally{k.f()}var T,M=D(p);try{for(M.s();!(T=M.n()).done;){var A=_(T.value,2),I=A[0],L=A[1];I.set(L,null,null,null,null,!0)}}catch(e){M.e(e)}finally{M.f()}}r.resumeRefresh(!0),r.performSelection(c),n.currentRange=null,n.handleSelection(),r.trigger("fillHandleDragEnd",F(F({},l),{},{domEvent:t}))}},{key:"onMouseOver",value:function(e){var t,n=this,r=n.client,i=n.rangeSelection,a=i[0],o=i[i.length-1],l=r.getCellDataFromEvent(e,!0),s=l&&r.normalizeCellContext(l.cellSelector);if((null===(t=s)||void 0===t||null===(t=t._column)||void 0===t?void 0:t.region)===a._column.region){var u,c=i.some((function(e){return e.equals(s,!0)}));n._isExtending||r.enableScrollingCloseToEdges(r.items),n._isCropping=c&&n.allowCropping&&(s.rowIndex<o.rowIndex||s.columnIndex<o.columnIndex),c||(s.rowIndex>=a.rowIndex&&s.rowIndex<=o.rowIndex?(u=a.columnIndex>s.columnIndex,s=new cg({grid:r,record:u?a.record:o.record,column:s.column})):(u=a.rowIndex>s.rowIndex,s=new cg({grid:r,record:s.record,column:u?a.column:o.column})));var d=u?s:a,h=u||c&&!n._isCropping?o:s;n.currentRange={from:d,to:h,negative:u},n._isExtending=!0,n.drawFillHandleAndBorder(d,h,!0),r.trigger("fillHandleDrag",F(F({},n.currentRangeForEvents),{},{domEvent:e}))}}},{key:"drawFillHandleAndBorder",value:function(e,t){var n,r,a=arguments.length>2&&arguments[2]!==i&&arguments[2],o=this,l=o.client,s=o._fillListeners,u=l.subGrids[e.column.region].element,c=pt.from(e.cell||e.column.element,u),d=pt.from(t.cell||t.column.element,u),h=null===(n=l.getRecordCoords(e.record,!0))||void 0===n?void 0:n.y,f=d.bottom,v=o.borderElement,g=o.handleElement;if(o.removeElements(a),v||(o.borderElement=v=li.createElement({className:"b-fill-selection-border"}),o.handleElement=g=li.createElement({className:"b-fill-handle"})),l.rtl){var m=pt.from(l.subGrids[e.column.region].element).width-c.right,p=d.left>c.left?d.right-c.left:c.right-d.left;li.setRect(v,{x:m,y:h,width:p,height:f-h}),li.setTopInsetInlineStart(g,f,m+p),g.classList.toggle("b-fill-handle-left-edge",d.left<=0)}else li.setRect(v,{y:h,x:c.x,width:d.right-c.x,height:f-h}),li.setTopInsetInlineStart(g,f,d.right),g.classList.toggle("b-fill-handle-right-edge",d.right>=u.scrollWidth-1);if(u.appendChild(v),u.appendChild(g),o.toggleCroppingCls(!1),o.croppingCells=null,o._isCropping&&null!==(r=o.rangeSelection)&&void 0!==r&&r.length){var y=l.getRange(e,t);o.croppingCells=o.rangeSelection.filter((function(e){return!y.some((function(t){return t.equals(e,!0)}))})),o.toggleCroppingCls()}s.handleClick||(s.handleClick=fr.on({element:l.element,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:o})),o.hasFillElements=!0}},{key:"toggleCroppingCls",value:function(){var e,t=this,n=!(arguments.length>0&&arguments[0]!==i)||arguments[0];null===(e=this.croppingCells)||void 0===e||e.forEach((function(e){var r;return null===(r=t.client.getCell(e))||void 0===r?void 0:r.classList.toggle("b-indicate-crop",n)}))}},{key:"removeElements",value:function(){var e,t,n=arguments.length>0&&arguments[0]!==i&&arguments[0],r=this;null===(e=r.handleElement)||void 0===e||e.remove(),null===(t=r.borderElement)||void 0===t||t.remove(),n||r.removeListeners(),r.hasFillElements=!1}},{key:"removeListeners",value:function(){var e=this;for(var t in e._fillListeners)e._fillListeners[t]();e._fillListeners={}}},{key:"rangeSelection",get:function(){return this._cachedSelectedRange||(this._cachedSelectedRange=this.currentSelectedRange),this._cachedSelectedRange}},{key:"currentSelectedRange",get:function(){var e=this.client,t=e.store,n=e.selectedCells;if(!e._selectedRows.length&&n.length&&n.every((function(e){var n=e.record;return t.indexOf(n)>=0}))){if(!(n.length>1))return n;var r=_(n=n.sort((function(e,t){return e.rowIndex-t.rowIndex||e.columnIndex-t.columnIndex})),1)[0],i=_(n.slice(-1),1)[0],a=r.rowIndex,o=r.columnIndex,l=r.region,s=i.rowIndex,u=i.columnIndex,c=(u-o+1)*(s-a+1);if(n.length===c&&n.every((function(e){return e.region===l&&e.rowIndex>=a&&e.rowIndex<=s&&e.columnIndex>=o&&e.columnIndex<=u})))return n}}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&this.abort()}},{key:"abort",value:function(){this.finalize(!1),this.reset()}},{key:"reset",value:function(){this._isExtending=this._isCropping=this.currentRange=this.croppingCells=null}},{key:"doDisable",value:function(e){this.removeElements(),this.reset(),B(t,"doDisable",this,3)([e])}}],[{key:"pluginConfig",get:function(){return{before:["onStoreRemove"],chain:["afterSelectionChange","onContentChange","fixElementHeights","syncFlexedSubCols","beforeSubGridInternalResize"],override:["getCellDataFromEvent"]}}}]);var n,r}(wc.mixin($i));S(_C,"$name","FillHandle"),S(_C,"configurable",{calculateFillValue:null,allowCropping:!1}),_C._$name="FillHandle",Ug.registerFeature(_C);var HC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e,n=this;if(!n.grid)throw new Error("".concat(n.constructor.$name," requires 'grid' to be configured."));n.fields=null!==(e=n.fields)&&void 0!==e?e:{},B(t,"afterConstruct",this,3)([])}},{key:"updateGrid",value:function(e){var t;if(null===(t=e.store)||void 0===t||!t.modelClass)throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}},{key:"changeFields",value:function(e){var n,r=Be.merge({},t.getColumnFields(this.grid.columns,null===(n=this.grid.store)||void 0===n?void 0:n.modelClass),e);return this.allowedFieldNames?Object.fromEntries(this.allowedFieldNames.map((function(e){return[e,r[e]]}))):r}}],[{key:"getColumnFields",value:function(e,t,n){var r;return Object.fromEntries(null!==(r=null==e?void 0:e.bottomColumns.reduce((function(e,r){var a=r.field,o=r.text,l=r.filterType,s=r.filterable,u=r.format;if(!n||n.includes(a)){var c,d=a&&t.getFieldDefinition(a),h=function(e){return Zk[null==e?void 0:e.type]||Qk(e)}(d)?d.type:i;if(h||l||s)e.push([a,{title:o||a,type:null!==(c=null!=l?l:Qk(d)?"duration":h)&&void 0!==c?c:"auto",format:u}])}return e}),[]))&&void 0!==r?r:[])}}])}(ab);S(HC,"$name","GridFieldFilterPicker"),S(HC,"type","gridfieldfilterpicker"),S(HC,"configurable",{grid:null,allowedFieldNames:null}),HC.initClass(),HC._$name="GridFieldFilterPicker";var BC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"validateConfig",value:function(){if(!this.grid)throw new Error("".concat(this.constructor.$name," requires the 'grid' config property."))}},{key:"getFilterPickerConfig",value:function(e){var n=this.grid,r=this.allowedFieldNames,i=this.fields;return F(F({},B(t,"getFilterPickerConfig",this,3)([e])),{},{fields:i,grid:n,allowedFieldNames:r})}},{key:"store",get:function(){return this.grid.$store},set:function(e){}}])}(sb);S(BC,"$name","GridFieldFilterPickerGroup"),S(BC,"type","gridfieldfilterpickergroup"),S(BC,"configurable",{grid:null}),S(BC,"childPickerType","gridfieldfilterpicker"),BC.initClass(),BC._$name="GridFieldFilterPickerGroup";var VC=Symbol("valueCount"),NC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changePicker",value:function(e,n){var r=e?Be.merge({items:{list:{store:this.store,itemTpl:this.listItemTpl}}},e,{selectedRecordCollection:this.valueCollection,cls:new Ct("b-checklistfiltercombo-picker",e.cls)}):e;return B(t,"changePicker",this,3)([r,n])}},{key:"updateReadOnly",value:function(e){B(t,"updateReadOnly",this,3)(arguments),this._picker&&(this.picker.readOnly=e)}},{key:"updateStore",value:function(e){var t=this;t.detachListeners("storeChange"),e&&e.ion({name:"storeChange",change:t.updateListSelection,thisObj:t}),t.picker&&(t.picker.widgetMap.list.store=e),t.updateListSelection()}},{key:"onListSelectionChange",value:function(){this.showApplyButton||this.applyListSelection(),this.picker.widgetMap.list.refresh(),this.syncInputFieldValue()}},{key:"applyListSelection",value:function(){var e=this,t=this.picker.widgetMap.list.selected;this.value=t.map((function(t){return t[e.valueField]}))}},{key:"onSearchInput",value:function(e){var t=e.value;this.searchText=t}},{key:"onSearchClear",value:function(){this.searchText=null}},{key:"updateSearchText",value:function(e){var t=this;(null==e?void 0:e.trim().length)>0?t.store.filter({id:t.searchFilterId,property:t.displayField,operator:t.filterOperator,value:e,caseSensitive:!1}):t.store.removeFilter(t.searchFilterId),t.picker.widgetMap.searchField.value=e}},{key:"changeChipView",value:function(){return null}},{key:"onSelectAllClick",value:function(){this.searchText=null,this.picker.widgetMap.list.selectAll()}},{key:"onRemoveAllClick",value:function(){this.clear(),this.picker.widgetMap.list.deselectAll()}},{key:"renderListItem",value:function(e){var t,n=null===(t=this.listItemPillTpl)||void 0===t?void 0:t.call(this,e);return'<div class="b-checklistfiltercombo-item-text">'.concat(e.getValue(this.displayField),"</div>").concat(n?'<div class="b-checklistfiltercombo-item-pill">'.concat(n,"</div>"):"")}},{key:"syncInputFieldValue",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this;if(t.picker){var n=t.picker.widgetMap.list.selected.values;t.input.value=n.length>0?t.L("L{filtersSet}",n.length,n):"",e||t.highlightChanged()}}},{key:"updateListSelection",value:function(){var e,t,n,r=this;null===(e=this.picker)||void 0===e||e.widgetMap.list.select(null!==(t=null===(n=this.value)||void 0===n?void 0:n.map((function(e){return r.store.find((function(t){return t[r.valueField]===e}),!0)})))&&void 0!==t?t:[],!0)}},{key:"value",get:function(){return B(t,"value",this,1)},set:function(e){V(t,"value",e,this,1,1),this.updateListSelection()}},{key:"updateShowApplyButton",value:function(e){this.picker.widgetMap.selectAllButton.hidden=e,this.picker.widgetMap.applyButton.hidden=!e}},{key:"onApplyClick",value:function(){this.applyListSelection()}},{key:"showPicker",value:function(){B(t,"showPicker",this,3)(arguments),this.picker.widgetMap.searchField.focus()}}])}(dv);S(NC,"$name","ChecklistFilterCombo"),S(NC,"type","checklistfiltercombo"),S(NC,"configurable",{multiSelect:!0,listItemTpl:"up.renderListItem",listItemPillTpl:null,showApplyButton:!1,picker:{type:"panel",flex:1,tbar:{items:{searchField:{type:"textfield",placeholder:"L{ChecklistFilterCombo.search}",clearable:!0,weight:100,internalListeners:{input:"up.onSearchInput",clear:"up.onSearchClear"}}}},items:{list:{type:"list",multiSelect:!0,emptyText:"L{ChecklistFilterCombo.noItems}",weight:100,internalListeners:{selectionChange:"up.onListSelectionChange"}}},bbar:{items:{applyButton:{type:"button",text:"L{ChecklistFilterCombo.apply}",cls:"b-transparent",textAlign:"left",weight:100,visible:!1,internalListeners:{click:"up.onApplyClick"}},selectAllButton:{type:"button",text:"L{ChecklistFilterCombo.selectAll}",cls:"b-transparent",textAlign:"left",weight:200,internalListeners:{click:"up.onSelectAllClick"}},removeAllButton:{type:"button",text:"L{ChecklistFilterCombo.removeAll}",cls:"b-transparent",textAlign:"left",weight:300,internalListeners:{click:"up.onRemoveAllClick"}}}}},chipView:null,store:{data:[]},editable:!1,placeholder:"L{placeholder}",searchText:null,searchFilterId:"search",value:[]}),NC.initClass(),NC._$name="ChecklistFilterCombo";var zC=["column","record","items"],jC={date:"date",int:"number",integer:"number",number:"number",text:"string",string:"string",duration:"duration",time:"time",auto:"auto"},WC=F(F({},Zk),{},{relation:!0}),$C={filterDateIsToday:!0,filterDateIsThisWeek:!0,filterDateIsThisMonth:!0,filterDateIsThisYear:!0},UC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;if(r.closeFilterEditor=r.closeFilterEditor.bind(r),r.inferredTypes={},B(t,"construct",this,3)([e,n]),r.bindStore(r.store),n&&"object"===W(n)){var i=Be.clone(n);delete i.prioritizeColumns,delete i.legacyMode,delete i.pickerConfig,delete i.dateFormat,delete i.closeEmptyPopup,delete i.defaultOperators,delete i.defaultEnabled,delete i.allowedOperators,Be.isEmpty(i)||r.store.filter(i,null,e.isConfiguring)}}},{key:"doDestroy",value:function(){var e,n;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(n=this.filterEditorPopup)||void 0===n||n.destroy(),B(t,"doDestroy",this,3)([])}},{key:"store",get:function(){return this.client.$store}},{key:"updateAllowedOperators",value:function(e){var t=null==e?void 0:e.indexOf("*");t>=0&&(e[t]="includes")}},{key:"bindStore",value:function(){this.detachListeners("store"),this.store.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this}),this.client.isPainted&&this.refreshHeaders(!1)}},{key:"refreshHeaders",value:function(e){var t=this,n=t.client,r=t.store,i=n.headerContainer;i&&(li.children(i,".b-filter-icon.b-latest").forEach((function(e){return e.classList.remove("b-latest")})),t.filterTip||(t.filterTip=new pc({forElement:i,forSelector:".b-filter-icon",getHtml:function(e){return e.activeTarget.dataset.filterText}})),r.isFiltered||t.filterTip.hide(),n.columns.visibleColumns.forEach((function(e){if(t.canFilterColumn(e)){var n=r.filters.allValues.filter((function(t){var n=t.property,r=t.disabled,i=t.internal,a=t.isNoOp;return n===e.field&&!r&&!i&&!a})),i=n.length>0,a=e.element;if(a){var o,l=e.textWrapper,s=null==l?void 0:l.querySelector(".b-filter-icon");if(i){o="".concat(t.L("L{filter}"),": ")+(n.length>1?"<br/><br/>":"")+n.map((function(i){var a,o,l=null!==(a=i.value)&&void 0!==a?a:"",s=Array.isArray(l),u=null==r||null===(o=r.modelRelations)||void 0===o?void 0:o.find((function(e){return e.foreignKey===i.property}));if(i.displayValue)l=i.displayValue;else{if(!t.legacyMode&&u){var c,d=(null===(c=t.pickerConfig)||void 0===c||null===(c=c.fields)||void 0===c?void 0:c[i.property]).relatedDisplayField;if(d){var h=function(e){var t;return null===(t=u.foreignStore.getById(e))||void 0===t?void 0:t[d]};l=s?l.map(h).sort((function(e,t){return(null!=e?e:"").localeCompare(null!=t?t:"")})):h(l)}}else e.formatValue&&l&&(l=s?l.map((function(t){return e.formatValue(t)})):e.formatValue(l));s&&(l="[ ".concat(l.join(", ")," ]"))}var f=ab.localizeOperator(i.operator,t.getFilterType(e));return(n.length>1?"&#x2022 ":"")+("string"==typeof i?i:"".concat(f," ").concat(l))})).join("<br/><br/>")}else o=t.L("L{applyFilter}");s?s.dataset.filterText=o:s=li.createElement({parent:l,tag:"i",className:"b-icon b-filter-icon",dataset:{filterText:o}}),e.field===r.latestFilterField&&s.classList.add("b-latest"),a.classList.add("b-filterable"),a.classList.toggle("b-filter",i)}e.meta.isFiltered=i}})),e&&n.refreshRows())}},{key:"applyFilter",value:function(e,t){var n=this.store;e.$filter=n.addFilter(this.injectColumnFilterConfig(e,t),!0),n.filter()}},{key:"injectColumnFilterConfig",value:function(e,t){var n=e.filterable.filterFn;return Be.assign(t,F(F(F({},e.filterable),t),{},S({property:e.field},n?"filterBy":"_",(function(t){return n({value:this.value,record:t,operator:this.operator,property:this.property,column:e})}))))}},{key:"removeFilter",value:function(e,t){var n;if(this.legacyMode||null!==(n=e.filterable)&&void 0!==n&&n.filterField)this.store.removeFilter(this.store.filters.getBy("property",e.field));else{var r,i=D(this.getCurrentMultiFilters(e));try{for(i.s();!(r=i.n()).done;){var a=r.value;t&&a.operator!==t||this.store.removeFilter(a)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"disableFilter",value:function(e){var t,n=D(this.getCurrentMultiFilters(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.disabled=!0,this.store.filter(r)}}catch(e){n.e(e)}finally{n.f()}this.store.filter()}},{key:"getCurrentMultiFilters",value:function(e){return this.store.filters.values.filter((function(t){return t.property===e.field}))}},{key:"getPopupDateItems",value:function(e,t,n,r,i,a,o,l){var s=this,u=a;function c(){s.removeFilter(e)}function d(e){"Enter"===e.event.key&&a()}function h(t){var n=t.source,r=t.value;null==r?c():(s.clearSiblingsFields(n),s.applyFilter(e,{operator:n.operator,value:r,displayValue:n._value,type:"date"}))}return[Be.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"sameDay"===(null==n?void 0:n.operator)?n.value:r,operator:"sameDay",onKeydown:d,onChange:h,onClose:u,onClear:c},l),Be.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:d,onChange:h,onClose:u,onClear:c},l),Be.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:d,onChange:h,onClose:u,onClear:c},l)]}},{key:"getPopupNumberItems",value:function(e,t,n,r,i,a,o,l){var s=this,u=a;function c(){s.removeFilter(e)}function d(e){"Enter"===e.event.key&&a()}function h(t){var n=t.source,r=t.value;null==r?c():(s.clearSiblingsFields(n),s.applyFilter(e,{operator:n.operator,value:r}))}return[Be.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:d,onChange:h,onEsc:u,onClear:c},l),Be.assign({type:"number",placeholder:"L{lessThan}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:d,onChange:h,onEsc:u,onClear:c},l),Be.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:d,onChange:h,onEsc:u,onClear:c},l)]}},{key:"clearSiblingsFields",value:function(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((function(t){t!==e&&(null==t||t.clear())}))}},{key:"getPopupDurationItems",value:function(e,t,n,r,i,a,o,l){var s=this,u=a,c=function(){return s.removeFilter(e)};function d(t){var n=t.source,r=t.value;null==r?c():(s.clearSiblingsFields(n),s.applyFilter(e,{operator:n.operator,value:r}))}return[Be.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onChange:d,onEsc:u,onClear:c},l),Be.assign({type:"duration",placeholder:"L{lessThan}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onChange:d,onEsc:u,onClear:c},l),Be.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:s,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onChange:d,onEsc:u,onClear:c},l)]}},{key:"getPopupStringItems",value:function(e,t,n,r,a,o,l,s){var u,c=this;return[Be.assign({type:"text",cls:"b-last-row",placeholder:"L{filter}",localeClass:c,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:n?null!==(u=n.value)&&void 0!==u?u:n:r,operator:"*",onChange:function(t){var n=t.source,r=t.value;""===r?l():(c.applyFilter(e,{operator:n.operator,value:r,displayValue:n.displayField&&n.records?n.records.map((function(e){return e[n.displayField]})).join(", "):i}),n.multiSelect||o())},onClose:o,onClear:l},s)]}},{key:"getPopupItems",value:function(e,t,n,r,i,a,o,l){var s=this;if(s.useLegacyModeForColumn(e)||l)switch(t){case"date":return s.getPopupDateItems.apply(s,arguments);case"number":return s.getPopupNumberItems.apply(s,arguments);case"duration":return s.getPopupDurationItems.apply(s,arguments);default:return s.getPopupStringItems.apply(s,arguments)}return[s.getFieldFilterPickerGroup(e)]}},{key:"getAllowedOperators",value:function(e){var t,n,r=this.allowedOperators;null!=e&&null!==(t=e.filterable)&&void 0!==t&&t.allowedOperators&&(n=r=null!=r?r:[]).push.apply(n,z(e.filterable.allowedOperators));return r}},{key:"getFieldFilterPickerGroup",value:function(e){var t,n=this,r=n.getFilterType(e),i=n.getAllowedOperators(e),a=F(F({fields:S({},e.field,{type:r,title:null!==(t=e.text)&&void 0!==t?t:e.field})},n.pickerConfig),{},{type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:n.client,propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",internalListeners:{beforeAddFilter:function(t){var r=t.filter;n.injectColumnFilterConfig(e,r)},remove:n.onPopupFilterRemove,keydown:n.onPopupKeydown,thisObj:n},triggerChangeOnInput:!1});return i&&(a.operators=S({},r,ab.defaultOperators[r].filter((function(e){var t=e.value;return i.includes(t)})))),a}},{key:"onPopupFilterRemove",value:function(){this.closeEmptyPopup&&0===this.filterEditorPopup.widgetMap.pickerGroup.filters.length&&this.delay(this.closeFilterEditor,0)}},{key:"onPopupKeydown",value:function(e){"Enter"===e.event.key&&this.delay(this.closeFilterEditor,0)}},{key:"showFilterEditor",value:function(e,t,n){var r=this,a=arguments.length>3&&arguments[3]!==i&&arguments[3];e=this.client.columns.getById(e);var o=this,l=o.store,s=e.element,u=l.filters.getBy("property",e.field),c=o.getFilterType(e),d=o.useLegacyModeForColumn(e),h=e.filterable;if(o.canFilterColumn(e)){o.closeFilterEditor();var f=o.getPopupItems(e,c,null!=u&&u.internal?null:u,t,l,o.closeFilterEditor,(function(){o.removeFilter(e),o.closeFilterEditor()}),h.filterField);if(f.forEach((function(e){return e.placeholder=e.placeholder?r.L(e.placeholder):e.placeholder})),o.filterEditorPopup=new fc({forElement:s,owner:o.client,cls:new Ct("b-filter-popup",{"b-filter-popup-legacymode":d}),scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:f,dataset:{column:e.field,fieldType:c}}),!d){if(a||null==l||!l.filters.find((function(t){return t.property===e.field}))){var v,g,m=o.getAllowedOperators(e),p=(null!==(v=o.filterEditorPopup.widgetMap.pickerGroup.operators)&&void 0!==v?v:ab.configurable.operators)[c],y=o.defaultOperators[c];if(!p.find((function(e){return e.value===y})))y=null===(g=p[0])||void 0===g?void 0:g.value;m&&!m.includes(y)&&(y=m[0]),o.filterEditorPopup.widgetMap.pickerGroup.addFilter({type:c,property:e.field,operator:null!=n?n:y,value:t})}o.filterEditorPopup.items[0].focus()}var k=_(o.filterEditorPopup.items,1)[0];if(h.filterField&&k.isCombo&&h.getFilterableValues){var b=$e.countUnique(l.allRecords.flatMap(h.getFilterableValues));k.store.data=b.map((function(t){var n=t.value,r=t.count;return S(S({id:n},e.field,n),VC,r)})),k.showPicker()}}}},{key:"closeFilterEditor",value:function(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}},{key:"getFilterType",value:function(e){var t,n,r,i,a=this,o=a.store,l=e.field,s=l&&o.modelClass.getFieldDefinition(l),u=null!==(t=null!==(n=e.filterType)&&void 0!==n?n:jC[e.type])&&void 0!==t?t:jC[null==s?void 0:s.type];return(null==o||null===(r=o.modelRelations)||void 0===r?void 0:r.find((function(e){return e.foreignKey===l})))?"relation":"auto"===u&&o&&!a.useLegacyModeForColumn(e)?(o.totalCount>0&&(a.inferredTypes[l]=ab.inferFieldType(o,l)),null!==(i=a.inferredTypes[l])&&void 0!==i?i:"auto"):u?jC[u]:"auto"}},{key:"populateCellMenuWithDateItems",value:function(e){var t=e.column,n=e.record,r=e.items,i=t.field;if("date"===this.getFilterType(t)){var a=this,o=n.getValue(i),l=function(e){a.applyFilter(t,{operator:e,value:o,displayValue:t.formatValue?t.formatValue(o):o,type:"date"})};r.filterDateEquals={text:"L{on}",localeClass:a,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:a.disabled,onItem:function(){return l("=")}},r.filterDateBefore={text:"L{before}",localeClass:a,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:a.disabled,onItem:function(){return l("<")}},r.filterDateAfter={text:"L{after}",localeClass:a,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:a.disabled,onItem:function(){return l(">")}}}}},{key:"populateCellMenuWithNumberItems",value:function(e){var t=e.column,n=e.record,r=e.items,i=t.field;if("number"===this.getFilterType(t)){var a=this,o=n.getValue(i),l=function(e){a.applyFilter(t,{operator:e,value:o})};r.filterNumberEquals={text:"L{equals}",localeClass:a,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:a.disabled,onItem:function(){return l("=")}},r.filterNumberLess={text:"L{lessThan}",localeClass:a,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:a.disabled,onItem:function(){return l("<")}},r.filterNumberMore={text:"L{moreThan}",localeClass:a,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:a.disabled,onItem:function(){return l(">")}}}}},{key:"populateCellMenuWithDurationItems",value:function(e){var t=e.column,n=e.record,r=e.items;if("duration"===this.getFilterType(t)){var i=this,a=t.getFilterableValue(n),o=function(e){i.applyFilter(t,{operator:e,value:a})};r.filterDurationEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:function(){return o("=")}},r.filterDurationLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:i.disabled,onItem:function(){return o("<")}},r.filterDurationMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:i.disabled,onItem:function(){return o(">")}}}}},{key:"populateCellMenuWithStringItems",value:function(e){var t=e.column,n=e.record,r=e.items,i=this.getFilterType(t);if(!/(date|number|duration)/.test(i)){var a,o,l=this,s=t.getFilterableValue(n),u=null!==(a=null===(o=t.filterable.filterField)||void 0===o?void 0:o.operator)&&void 0!==a?a:"*";r.filterStringEquals={text:"L{equals}",localeClass:l,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:l.disabled,onItem:function(){return l.applyFilter(t,{value:s,operator:u})}}}}},{key:"getMenuItems",value:function(e,t){var n=this,r={},a=n.getFilterType(e);if(!1===e.filterable)return{};if(WC[a]){var o,l=t?e.getFilterableValue(t):i,s=n.getCurrentMultiFilters(e).filter((function(e){return!e.disabled})).map((function(e){return e.operator})),u=t?1:i,c=n.getAllowedOperators(e),d=ab.defaultOperators[a].filter((function(e){var t=e.value,n=e.argCount,r=e.isArrayValued;return!(n>u||r)&&(!c||c.includes(t))})),h=300,f=D(d);try{var v=function(){var t=o.value,i=t.value,u=t.text,c=t.argCount,d="filter".concat(Le.capitalize(a)).concat(Le.capitalize(i));r[d]={text:Le.capitalize(ab.L(u)),weight:h+=10,icon:s.includes(i)?"b-icon b-icon-check":null,disabled:n.disabled,cls:$C[d]?"b-separator":null,onItem:function(){return n.onOperatorMenuItem(e,l,i,c)}}};for(f.s();!(o=f.n()).done;)v()}catch(e){f.e(e)}finally{f.f()}}return e.meta.isFiltered&&Object.assign(r,n.getMenuItemsForFilteredColumn(e,t!==i)),{filterMenu:{text:"L{filter}",localeClass:n,menu:r,icon:"b-fw-icon b-icon-filter",weight:t?400:100}}}},{key:"onOperatorMenuItem",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:1,a=this,o=a.getFilterType(e);a.getCurrentMultiFilters(e).find((function(e){return!e.disabled&&e.operator===n}))?a.removeFilter(e,n):0==r||t!==i?a.applyFilter(e,{property:e.field,operator:n,type:o,value:1===r?t:null,caseSensitive:!1,disabled:null==t&&r>0}):a.showFilterEditor(e,null,n,!0)}},{key:"getMenuItemsForFilteredColumn",value:function(e,t){var n=this,r=!n.disabled&&(n.legacyMode||n.columnHasRemovableFilters(e));return{filterEdit:n.legacyMode?i:{text:"L{editFilter}",localeClass:n,icon:"b-fw-icon b-icon-edit",cls:"b-separator",weight:500,disabled:!r,onItem:function(){return n.showFilterEditor(e)}},filterRemove:{text:"L{removeFilter}",localeClass:n,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:510,disabled:!r,onItem:function(){return n.removeFilter(e)}},filterDisable:{text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon b-icon-filter-disable",weight:520,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:function(){return n.disableFilter(e)}}}}},{key:"populateCellMenu",value:function(e){var t=e.column,n=e.record,r=e.items,i=A(e,zC),a=this;a.canFilterColumn(t)&&!n.isSpecialRow&&(a.useLegacyModeForColumn(t)?(a.populateCellMenuWithDateItems(F({column:t,record:n,items:r},i)),a.populateCellMenuWithNumberItems(F({column:t,record:n,items:r},i)),a.populateCellMenuWithDurationItems(F({column:t,record:n,items:r},i)),a.populateCellMenuWithStringItems(F({column:t,record:n,items:r},i)),t.meta.isFiltered&&Object.assign(r,a.getMenuItemsForFilteredColumn(t,!0))):Object.assign(r,a.getMenuItems(t,n)))}},{key:"columnHasRemovableFilters",value:function(e){var t=this;return Boolean(t.getCurrentMultiFilters(e).find((function(e){return!t.canDeleteFilter||!1!==t.callback(t.canDeleteFilter,t,[e])})))}},{key:"columnHasEnabledFilters",value:function(e){return Boolean(this.getCurrentMultiFilters(e).find((function(e){return!e.disabled})))}},{key:"populateHeaderMenu",value:function(e){var t=e.column,n=e.items,r=this;r.useLegacyModeForColumn(t)?t.meta.isFiltered?(n.filterEdit={text:"L{editFilter}",localeClass:r,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:function(){return r.showFilterEditor(t)}},n.filterRemove={text:"L{removeFilter}",localeClass:r,weight:110,icon:"b-fw-icon b-icon-remove",disabled:r.disabled||!r.legacyMode&&!r.columnHasRemovableFilters(t),onItem:function(){return r.removeFilter(t)}},n.filterDisable={text:"L{disableFilter}",localeClass:r,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:r.disabled||!r.columnHasEnabledFilters(t),onItem:function(){return r.disableFilter(t)}}):r.canFilterColumn(t)&&(n.filter={text:"L{filter}",localeClass:r,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:function(){return r.showFilterEditor(t)}}):Object.assign(n,r.getMenuItems(t))}},{key:"useLegacyModeForColumn",value:function(e){var t;return this.legacyMode||(null===(t=e.filterable)||void 0===t?void 0:t.filterField)!=i}},{key:"canFilterColumn",value:function(e){var t,n;return!1!==e.filterable&&(!0===(null===(t=e.filterable)||void 0===t?void 0:t.filter)||!1!==(null===(n=e.filterable)||void 0===n?void 0:n.filter)&&!1!==this.defaultEnabled)}},{key:"onStoreBeforeFilter",value:function(e){for(var t=this,n=e.filters,r=this.client.columns,i=$e.groupBy(n,"property"),a=function(){var e=_(l[o],2),i=e[0],a=e[1],s=r.find((function(e){return t.canFilterColumn(e)&&e.field===i}));s&&(s.$filters=a.map((function(e,r){var a;if((e.columnOwned||t.prioritizeColumns)&&!e.internal&&null!=s&&null!==(a=s.filterable)&&void 0!==a&&a.filterFn){var o,l=new Jl({id:null!==(o=e.id)&&void 0!==o?o:"".concat(i,"-").concat(r,"-").concat(Date.now()),columnOwned:!0,property:i,operator:e.operator,value:e.value,displayValue:e.displayValue,disabled:e.disabled,filterBy:function(e){return s.filterable.filterFn.call(this,{value:this.value,record:e,operator:this.operator,property:this.property,column:s})}});return n.splice(n.indexOf(e),1,l),l}return e})))},o=0,l=Object.entries(i);o<l.length;o++)a()}},{key:"onStoreFilter",value:function(){this.refreshHeaders(!1)}},{key:"renderHeader",value:function(){this.refreshHeaders(!1)}},{key:"onElementClick",value:function(e){var t=e.target;if(this.filterEditorPopup&&this.closeFilterEditor(),t.classList.contains("b-filter-icon")){var n=t.closest(".b-grid-header");return this.showFilterEditor(n.dataset.columnId),!1}}},{key:"showFilterEditorByKey",value:function(e){var t=e.target,n=t.matches(".b-grid-header")&&t;return n&&this.showFilterEditor(n.dataset.columnId),Boolean(n)}},{key:"isActionAvailable",value:function(e){var t=e.event;if("showFilterEditorByKey"===e.actionName){var n=t.target.closest(".b-grid-header"),r=n&&this.client.columns.find((function(e){return e.id===n.dataset.columnId}));return Boolean(null==r?void 0:r.filterable)}}}],[{key:"configurable",get:function(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},legacyMode:!1,pickerConfig:null,closeEmptyPopup:!1,value:null,property:null,operator:null,defaultOperators:{date:"sameDay",number:"=",string:"includes",duration:"=",relation:null,auto:"*"},allowedOperators:null,defaultEnabled:!0}}},{key:"pluginConfig",get:function(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}}])}(wc);S(UC,"$name","Filter"),UC._$name="Filter",Ug.registerFeature(UC);var GC={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null},YC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;r.onColumnFilterFieldChange=r.onColumnFilterFieldChange.bind(r),B(t,"construct",this,3)([e,Array.isArray(n)?{filter:n}:n]),r.bindStore(r.store),r.filter&&r.store.filter(r.filter),r.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:r})}},{key:"store",get:function(){return this.client.$store}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}},{key:"doDestroy",value:function(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){var n=this,r=this.client.columns;null==r||r.forEach((function(t){var r=n.getColumnFilterField(t);r&&(r.disabled=e)})),B(t,"doDisable",this,3)([e])}},{key:"updateHidden",value:function(e){this.isConfiguring||(e?this.hideFilterBar():this.showFilterBar())}},{key:"updateCompactMode",value:function(e){for(var t in this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact"),this._columnFilters){var n=this._columnFilters[t];n.placeholder=e?n.placeholder||n.column.headerText:null}}},{key:"destroyFilterBar",value:function(){var e;null===(e=this.client.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}},{key:"hideFilterBar",value:function(){var e,t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.client.columns)||void 0===e||e.forEach((function(e){return t.hideColumnFilterField(e,!0)})),t.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t._hidden=!0}},{key:"showFilterBar",value:function(){this.suspendStoreTracking(),this.renderFilterBar(this.clearStoreFiltersOnHide),this.resumeStoreTracking(),this._hidden=!1}},{key:"toggleFilterBar",value:function(){this.hidden?this.showFilterBar():this.hideFilterBar()}},{key:"renderFilterBar",value:function(e){var t=this;this.client.hideHeaders||(this.client.columns.visibleColumns.forEach((function(n){return t.renderColumnFilterField(n,e)})),this.rendered=!0)}},{key:"renderColumnFilterField",value:function(e,t){var n=this,r=n.client,a=n.store,o=n.getColumnFilterable(e);if(o&&e.isVisible){var l=e.field,s=e.element,u=a.filters.get(e.id)||a.filters.getBy("property",l),c=n.getColumnFilterField(e);if(c)t&&n.onColumnFilterFieldChange({source:c,value:c.value}),c.render(s),c.show();else{var d,h="".concat(e.filterType||"text","field"),f=o.filterField,v=null==f?void 0:f.cls;v&&delete o.filterField.cls;var g=null!==(d=null==f?void 0:f.ariaLabel)&&void 0!==d?d:e.text?n.L("L{Filter.filter} ".concat(e.text)):null;c=Lo.append(Be.assign({type:h,cls:S(S({},n.filterFieldCls,1),v,v),dataset:{column:l},column:e,owner:r,clearable:!0,revertOnEscape:!0,name:l,value:!u||u._filterBy||u.internal?i:n.buildFilterValue(u),inputCls:n.filterFieldInputCls,keyStrokeChangeDelay:n.keyStrokeFilterDelay,disabled:n.disabled,placeholder:n.compactMode?e.headerText:null,format:e.format,ariaLabel:g,internalListeners:{change:n.onColumnFilterFieldChange,clear:n.onColumnFilterFieldChange}},f),s)[0],n.compactMode&&(c.placeholder=(null==f?void 0:f.placeholder)||e.headerText),null!=f&&f.hasOwnProperty("min")||Object.defineProperty(c,"min",{get:function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.min},set:function(){return null}}),null!=f&&f.hasOwnProperty("max")||Object.defineProperty(c,"max",{get:function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.max},set:function(){return null}}),null!=f&&f.hasOwnProperty("strictParsing")||Object.defineProperty(c,"strictParsing",{get:function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.strictParsing},set:function(){return null}}),c.element.retainElement=!0,n.setColumnFilterField(e,c);var m=(null==f?void 0:f.store)&&(f.store.readUrl||f.store.data||f.store.isChained)||(null==f?void 0:f.items);if(c.isCombo&&!m&&0===c.store.count){var p,y,k=c.value,b=function(){if(!c.store.readUrl&&!c.store.isChained){var e;if(o.getFilterableValues)e=$e.countUnique(a.flatMap(o.getFilterableValues)).map((function(e){var t=e.value,n=e.count;return S(S({id:t},l,t),VC,n)}));else e=a.getDistinctValues(l,!0,!0).map((function(e){var t=e.value,n=e.count;return a.createRecord(S(S({id:t},l,t),VC,n))}));c.store.data=e}};c.value=null,c.store.isSorted||c.store.sort({field:l,ascending:!0}),c.picker.ion({beforeShow:b}),b(),c.value=k,c.displayField=null!==(p=f.displayField)&&void 0!==p?p:l,c.valueField=null!==(y=f.valueField)&&void 0!==y?y:l}!n.filter&&c.value&&!1!==a.autoLoad&&n.onColumnFilterFieldChange({source:c,value:c.value,silent:!0})}s.classList.add(n.filterableColumnCls)}}},{key:"updateColumnFilterFields",value:function(){var e,t,n=this,r=n.store,i=n.client.columns;n._updatingFields=!0;var a,o=D(i.visibleColumns);try{for(o.s();!(a=o.n()).done;){var l=a.value;(e=n.getColumnFilterField(l))&&!l.$isApplyingFilter&&((t=r.filters.get(l.id)||r.filters.getBy("property",l.field))&&!t.internal?t._filterBy?e.value=t.value:e.value=n.buildFilterValue(t):e.isCombo&&e.multiSelect?e.value=[]:e.value="")}}catch(e){o.e(e)}finally{o.f()}n._updatingFields=!1}},{key:"getColumnFilterable",value:function(e){if(!e.isRoot&&this.canFilterColumn(e)&&e.field&&e.isLeaf)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}},{key:"destroyColumnFilterField",value:function(e){var t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,i))}},{key:"hideColumnFilterField",value:function(e,t){var n=this,r=n.store,i=e.element,a=n.getColumnFilterField(e);if(a){n.isDestroying||a.hide();var o=e.$filter;!r.isDestroyed&&n.clearStoreFiltersOnHide&&o&&r.removeFilter(o,t),null==i||i.classList.remove(n.filterableColumnCls)}}},{key:"getColumnFilterField",value:function(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.id]}},{key:"setColumnFilterField",value:function(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}},{key:"parseFilterValue",value:function(e,t,n){var r;if(Array.isArray(t)||t instanceof ql||"number"==typeof t)return{value:t};if(Be.isDate(t))return{operator:n.isDateField?"sameDay":n.isTimeField?"sameTime":"=",value:t};var i=String(t).match(this.filterParseRegExp),a="number"==typeof t?"=":"*";return{operator:i[1]||(null===(r=e.filterable)||void 0===r?void 0:r.operator)||a,value:i[2]}}},{key:"buildFilterValue",value:function(e){var t=e.operator,n=e.value;return"number"==typeof n||n instanceof Date||Array.isArray(n)||n instanceof ql?n:(t in GC?"":t)+n}},{key:"onStoreBeforeFilter",value:function(e){for(var t=this,n=e.filters,r=this.client.columns,i=function(){var e,i=n.getAt(a),o=(i.columnOwned||t.prioritizeColumns)&&r.find((function(e){return t.canFilterColumn(e)&&e.field===i.property}));null!=o&&null!==(e=o.filterable)&&void 0!==e&&e.filterFn&&(o.$filter||(o.$filter=new Jl({columnOwned:!0,property:i.property,id:o.id,filterBy:function(e){return o.filterable.filterFn({value:this.value,record:e,property:this.property,column:o})}})),o.$filter.value=i.value,n.splice(a,1,o.$filter))},a=0;a<n.count;a++)i()}},{key:"onStoreFilter",value:function(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}},{key:"afterColumnsChange",value:function(e){var t,n=e.action,r=e.changes,i=e.column,a=e.columns,o=this,l=D(o.client.columns.visibleColumns);try{for(l.s();!(t=l.n()).done;){var s,u,c,d=t.value;if(o.canFilterColumn(d)&&(!0===(null===(s=d.filterable)||void 0===s?void 0:s.filter)||null!==(u=o.client.features.filter)&&void 0!==u&&u.defaultEnabled&&!1!==(null===(c=d.filterable)||void 0===c?void 0:c.filter)))throw new Error("Columns do not currently support both `filter` and "+"`filterBar` features enabled on the same column. Please check column with id ".concat(d.id,"."))}}catch(e){l.e(e)}finally{l.f()}!o.hidden&&null!=r&&r.hidden&&(r.hidden.value?o.destroyColumnFilterField(i):o.renderColumnFilterField(i));"remove"===n&&a.forEach((function(e){return o.destroyColumnFilterField(e)}))}},{key:"suspendStoreTracking",value:function(){this.storeTrackingSuspended++}},{key:"resumeStoreTracking",value:function(){this.storeTrackingSuspended--}},{key:"renderHeader",value:function(){this.hidden||this.renderFilterBar()}},{key:"renderContents",value:function(){if(this._columnFilters)for(var e=0,t=Object.values(this._columnFilters);e<t.length;e++){var n=t[e];null==n||n.element.remove()}}},{key:"disableGridNavigation",value:function(e){return e.target.matches(this.filterFieldInputSelector)}},{key:"onBeforeElementClick",value:function(e){if(e.event.target.closest(".".concat(this.filterFieldCls)))return!1}},{key:"onColumnFilterFieldChange",value:function(e){var t,n=e.source,r=e.value,a=e.silent,o=this,l=n.column,s=l.filterable.filterFn,u=o.store,c=l.$filter||u.filters.find((function(e){return(e.id===l.id||e.property===l.field)&&!e.internal}));if(!o._updatingFields){var d,h,f,v,g=null==r||""===r||Array.isArray(r)&&0===r.length;if(u.removeFilter(c,!0),l.$filter=null,l.$isApplyingFilter=!0,g){if(!c)return void(l.$isApplyingFilter=!1)}else l.$filter=u.addFilter(F(F({property:n.name},o.parseFilterValue(l,r,n)),{},S(S({},"boolean"==typeof(null===(d=l.filterable)||void 0===d?void 0:d.caseSensitive)?"caseSensitive":i,null===(h=l.filterable)||void 0===h?void 0:h.caseSensitive),s?"filterBy":"_",(function(e){return s({value:this.value,record:e,operator:this.operator,property:this.property,column:l})}))),!0);if(u.filter({silent:a}),l.$isApplyingFilter=!1,null!==(t=n.picker)&&void 0!==t&&t.isVisible)null===(f=n.picker)||void 0===f||null===(v=f.realign)||void 0===v||v.call(f)}}},{key:"populateHeaderMenu",value:function(e){var t=this;e.items.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:function(){return t.toggleFilterBar()}}}},{key:"canFilterColumn",value:function(e){var t,n;return!1!==e.filterable&&(!0===(null===(t=e.filterable)||void 0===t?void 0:t.filterBar)||!1!==(null===(n=e.filterable)||void 0===n?void 0:n.filterBar)&&!1!==this.defaultEnabled)}}],[{key:"configurable",get:function(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,hidden:!1,filter:null,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}},defaultEnabled:!0}}},{key:"pluginConfig",get:function(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}},{key:"properties",get:function(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}}])}(wc);S(YC,"$name","FilterBar"),YC.featureClass="b-filter-bar",YC._$name="FilterBar",Ug.registerFeature(YC);var qC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r,i=this;e.features.tree||(i._thisIsAUsedExpression(e.features.groupSummary),n=i.processConfig(n),i.grid=e,B(t,"construct",this,3)([e,n]),e.ion({lockRows:"onLockRows",beforeUnlockRows:"onUnlockRows",thisObj:i}),null!==(r=e.features.lockRows)&&void 0!==r&&r.enabled&&!e.splitFrom||i.init(e))}},{key:"init",value:function(e){this.grid=e,this.bindStore(e.store),this.detachListeners("rowManager"),e.rowManager.ion({name:"rowManager",beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:this}),e.isConfiguring||e.renderRows()}},{key:"processConfig",value:function(e){return"string"==typeof e?{field:e}:e}},{key:"setConfig",value:function(e){null===e?this.store.clearGroupers():B(t,"setConfig",this,3)([this.processConfig(e)])}},{key:"bindStore",value:function(e){var t=this,n=t.client;n.isSchedulerBase&&n.isVertical&&e&&(e=n.resourceStore),t.detachListeners("store"),n.isLockedRows||(e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",toggleGroup:"onStoreToggleGroup",thisObj:t}),!t.field&&!e.isGrouped||n.isConfiguring?t.onStoreGroup({groupers:e.groupers}):e.group({field:t.field,ascending:t.ascending,fn:t.groupSortFn}))}},{key:"updateRenderer",value:function(e){this.groupRenderer=e}},{key:"updateField",value:function(e){var t,n,r=this;null!==(t=r.client.features.lockRows)&&void 0!==t&&t.enabled&&!r.client.splitFrom||r.isConfiguring&&null!==(n=r.store.groupers)&&void 0!==n&&n.some((function(t){return t.field===e}))||r.store.group({field:e,ascending:r.ascending,fn:r.groupSortFn})}},{key:"updateGroupSortFn",value:function(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}},{key:"updateAscending",value:function(e){var t=this;t.isConfiguring||t.store.group({field:t.field,ascending:e,fn:t.groupSortFn})}},{key:"doDisable",value:function(e){var n=this.store;if(e&&n.isGrouped){var r=n.sorters;r.unshift.apply(r,z(n.groupers)),this.currentGroupers=n.groupers,n.clearGroupers(),n.sort(r)}else!e&&this.currentGroupers&&(n.group(this.currentGroupers[0]),this.currentGroupers=null);B(t,"doDisable",this,3)([e])}},{key:"store",get:function(){var e=this.grid;return e.isSchedulerBase&&e.isVertical?e.resourceStore:e.store}},{key:"refreshGrid",value:function(e){var t=this.grid,n=t.store,r=t.rowManager;r.rowCount>n.count||!r.getRowFor(e)?r.renderFromRow():r.renderFromRecord(e)}},{key:"toggleCollapse",value:function(e,t){this.internalToggleCollapse(e,t)}},{key:"internalToggleCollapse",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3?arguments[3]:i,a=arguments.length>4&&arguments[4]!==i&&arguments[4],o=this,l=o.store,s=o.grid,u=Number.MAX_VALUE,c=$e.asArray(e).map((function(e){if((e=l.getById(e)).isGroupHeader||(e=l.getGroupHeaderForRecord(e)),u=Math.min(u,l.indexOf(e),0),e.isGroupHeader)return e}));t=t===i?!c[0].meta.collapsed:t,!1!==s.trigger("beforeToggleGroup",{groupRecord:c[0],groupRecords:c,collapse:t,domEvent:r})&&(o.isToggling=!0,t?l.collapse(c):l.expand(c),o.isToggling=!1,n||o.refreshGrid(l.getAt(u)),s.trigger("toggleGroup",{groupRecord:c[0],groupRecords:c,collapse:t,allRecords:a}),s.afterToggleGroup())}},{key:"collapseAll",value:function(){var e=this,t=e.store,n=e.grid;t.isGrouped&&!e.disabled&&(e.internalToggleCollapse(t.groupHeaderRecords,!0,!0,i,!0),n.trigger("collapseAllGroups"),n.refreshRows(null,!0))}},{key:"expandAll",value:function(){var e=this,t=e.store,n=e.grid;t.isGrouped&&!e.disabled&&(e.internalToggleCollapse(t.groupHeaderRecords,!1,!0,i,!0),n.trigger("expandAllGroups"),n.refreshRows())}},{key:"onLockRows",value:function(e){var t=e.clone;this.grid=t}},{key:"onUnlockRows",value:function(e){e.source;var t=this.client;t.isDestroying||this.init(t)}},{key:"onBeforeRenderRow",value:function(e){var t=e.row,n=t.grid.store.getById(t.id);t.forceInnerHTML=t.forceInnerHTML||(null==n?void 0:n.isGroupHeader)}},{key:"renderCell",value:function(e){var t=this,n=e.cellElement,r=e.row,i=e.column,a=e.grid,o=e.record.meta,l={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in o){if(i.groupHeaderReserved)return;i.clearCell(n),l["b-grid-group-collapsed"]=o.collapsed,l["b-group-row"]=1,a.buildGroupHeader?a.buildGroupHeader(e):t.buildGroupHeader(e),i===t.groupHeaderColumn&&(li.createElement({parent:n,tag:"i",className:S(S({"b-group-state-icon":1,"b-fw-icon":1},t.expandIconCls,o.collapsed),t.collapseIconCls,!o.collapsed),nextSibling:n.firstChild}),n.classList.add("b-group-title"),n.$groupHeader=n._hasHtml=!0)}else if(n.$groupHeader){var s;null===(s=n.querySelector(".b-group-state-icon"))||void 0===s||s.remove(),n.classList.remove("b-group-title"),n.$groupHeader=!1}r.assignCls(l)}},{key:"buildGroupHeader",value:function(e){var t=this,n=e.record,r=e.cellElement,i=e.column,a=e.persist,o=e.isExporting,l=void 0!==o&&o,s=t.grid,u=n.meta,c=u.emptyArray?s.L("L{Object.None}"):u.groupRowFor,d=s.features.groupSummary,h=u.childCount-(d&&"header"!==d.target?1:0),f=null,v=!0;if(a||i){var g,m=s.columns.get(u.groupField),p=e.isFirstColumn=i===t.findGroupHeaderColumn(l);null!=m&&m.groupRenderer?p&&(f=m.groupRenderer(F(F({},e),{},{groupRowFor:c,groupRecords:n.groupChildren,groupColumn:m,count:h})),v=!1):t.groupRenderer&&(f=t.groupRenderer(F(F({},e),{},{groupRowFor:c,groupRecords:n.groupChildren,groupColumn:m,count:h,isFirstColumn:p}))),null!==(g=e.size)&&void 0!==g&&g.height||!t.headerHeight||(e.size.height=t.headerHeight),p&&null==f&&v&&0===li.getChildElementCount(r)&&(f=Le.encodeHtml("".concat("__novalue__"===c?"":c)+(t.showCount?" (".concat(h,")"):"")))}else t.groupRenderer&&(f=t.groupRenderer(e));return"string"==typeof f?r.innerHTML=f:"object"===W(f)&&fa.sync({targetElement:r,domConfig:{onlyChildren:!0,children:$e.asArray(f)}}),li.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}},{key:"groupHeaderColumn",get:function(){return this.grid.columns.visibleColumns.find((function(e){return!e.groupHeaderReserved}))}},{key:"findGroupHeaderColumn",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];return this.grid.columns.visibleColumns.find((function(t){return!(t.groupHeaderReserved||e&&!1===t.exportable)}))}},{key:"renderHeader",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.grid.headerContainer,t=this.store,n=this.grid;if(e&&t.isGrouped){var r,a=D(t.groupers);try{for(a.s();!(r=a.n()).done;){var o,l=r.value,s=n.columns.get(l.field),u=s&&n.getHeaderElement(s.id);if(null==u||u.classList.add("b-group",l.ascending?"b-asc":"b-desc"),u&&(null===(o=n.features.sort)||void 0===o||!o.enabled||!1===s.sortable)){var c=s.textWrapper;null!=c&&c.querySelector(".b-sort-icon")||li.createElement({parent:c,className:"b-icon b-sort-icon"})}}}catch(e){a.e(e)}finally{a.f()}}}},{key:"populateHeaderMenu",value:function(e){var t=e.column,n=e.items,r=this;!1!==t.groupable&&(n.groupAsc={text:"L{groupAscending}",localeClass:r,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:r.disabled,onItem:function(){return r.store.group(t.field,!0)}},n.groupDesc={text:"L{groupDescending}",localeClass:r,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:r.disabled,onItem:function(){return r.store.group(t.field,!1)}}),r.store.isGrouped&&(n.groupRemove={text:"L{stopGrouping}",localeClass:r,icon:"b-fw-icon b-icon-clear",cls:t.groupable?"":"b-separator",weight:420,disabled:r.disabled,onItem:function(){return r.store.clearGroupers()}})}},{key:"getColumnDragToolbarItems",value:function(e,t){var n,r=this,i=r.store,a=r.disabled;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:a,onDrop:function(e){var t=e.column;return i.group(t.field,!0)}}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:a,onDrop:function(e){var t=e.column;return i.group(t.field,!1)}});var o=(null===(n=i.groupers)||void 0===n?void 0:n.some((function(t){return t.field===e.field})))&&!a;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!o,weight:110,onDrop:function(e){var t=e.column;return i.removeGrouper(t.field)}}),t}},{key:"onStoreGroup",value:function(e){var t=e.groupers,n=this.grid.element,r=n&&li.children(n,".b-grid-header.b-group");if(n){var i,a=D(r);try{for(a.s();!(i=a.n()).done;){i.value.classList.remove("b-group","b-asc","b-desc")}}catch(e){a.e(e)}finally{a.f()}t&&this.renderHeader()}}},{key:"onStoreChange",value:function(e){var t=e.action,n=e.records,r=this.client,i=r.rowManager,a=r.store;if(a.isGrouped&&"move"===t){var o=a.groupers[0].field,l=Math.min.apply(Math,z(n.reduce((function(e,t){if(e.push(a.indexOf(t.instanceMeta(a).groupParent)),o in t.meta.modified){var n=a.groupRecords.find((function(e){return e.meta.groupRowFor===t.meta.modified[o]}));n&&e.push(a.indexOf(n))}return e}),[])));i.renderFromRow(i.getRow(l))}}},{key:"onStoreToggleGroup",value:function(e){var t=e.groupRecord;this.isToggling||this.refreshGrid(t)}},{key:"onElementTouchStart",value:function(e){var t=this,n=e.target.closest(".b-grid-header"),r=n&&t.grid.getColumnFromElement(n);e.touches.length>1&&r&&!1!==r.groupable&&!t.disabled&&t.store.group(r.field)}},{key:"onElementClick",value:function(e){var t=this,n=t.store,r=e.target,a=r.closest(".b-group-row"),o=r.closest(".b-grid-header"),l=null==o?void 0:o.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item")||r.closest(".b-checkbox")||e.handled)){if(o&&l){var s,u=null===(s=n.groupers)||void 0===s?void 0:s.find((function(e){return e.field===l}));if(u&&!e.shiftKey)return u.ascending=!u.ascending,n.group(),!1;e.shiftKey&&!1!==t.grid.columns.get(l).groupable&&(e.altKey?n.removeGrouper(l):n.group(l))}return a&&(t.toggleOnRowClick||e.target.classList.contains("b-group-state-icon"))?(t.internalToggleCollapse(wa.get(a).id,i,i,e),!1):void 0}}},{key:"toggleGroup",value:function(){var e,t=this.grid.focusedCell;return!(this.disabled||t.isActionable||null===(e=t.record)||void 0===e||!e.isGroupHeader)&&(this.internalToggleCollapse(t.id),!0)}},{key:"updateHeaderHeight",value:function(){this.isConfiguring||this.client.refreshRows()}},{key:"updateShowCount",value:function(){this.isConfiguring||this.client.refreshRows()}}],[{key:"configurable",get:function(){return{field:null,expandIconCls:"b-icon-group-expand",collapseIconCls:"b-icon-group-collapse",ascending:!0,headerHeight:null,showCount:!0,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}},{key:"pluginConfig",get:function(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}}])}(wc);S(qC,"$name","Group"),qC._$name="Group",Ug.registerFeature(qC,!0,["Grid","Scheduler"]),Ug.registerFeature(qC,!1,["TreeGrid"]);var KC=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"generateHtml",value:function(e,t,n){var r=this.client.store,i=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]),a='<div class="b-summary-wrap '.concat(n,'">');return i.forEach((function(n){var i=n.sum,o=null;switch(!0===i&&(i="sum"),i){case"sum":case"add":o=r.sum(e.field,t);break;case"max":o=r.max(e.field,t);break;case"min":o=r.min(e.field,t);break;case"average":case"avg":o=r.average(e.field,t);break;case"count":o=t.length;break;case"countNotEmpty":o=t.reduce((function(t,n){return t+(null!=n.getValue(e.field)?1:0)}),0)}if("function"==typeof i&&(o=t.reduce(i,"seed"in n?n.seed:0)),null!==o){var l,s,u,c="b-grid-summary-value",d=n.label?'<div class="b-grid-summary-label">'.concat(n.label,"</div>"):"",h=n.renderer?n.renderer({config:n,sum:o}):null!==(l=null===(s=e.formatValue)||void 0===s?void 0:s.call(e,o,t[0]))&&void 0!==l?l:o;null==h&&(h=""),u=String(h).includes("<div>")?h:d?"".concat(d,'<div class="').concat(c,'">').concat(h,"</div>"):'<div class="'.concat(c,' b-nolabel">').concat(h,"</div>"),a+=u}})),"".concat(a,"</div>")}}])}(e||Mn),S(t,"$name","SummaryFormatter"),t},XC=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){if(B(t,"construct",this,3)([e,n]),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}},{key:"store",get:function(){return this.client.store}},{key:"doDisable",value:function(e){this.updateTarget(this.target),B(t,"doDisable",this,3)([e])}},{key:"changeTarget",value:function(e){return Be.assertString(e,"target"),e}},{key:"updateTarget",value:function(e){this.store.useGroupFooters=!this.disabled&&"footer"===e,this.isConfiguring||this.store.group()}},{key:"changeCollapseToHeader",value:function(e){return Be.assertBoolean(e,"collapseToHeader"),e}},{key:"updateCollapseToHeader",value:function(){this.isConfiguring||this.store.group()}},{key:"onBeforeRenderRow",value:function(e){var t=e.row,n=e.record;t.isGroupFooter&&!("groupFooterFor"in n.meta)?(t.isGroupFooter=!1,t.forceInnerHTML=!0):t.isGroupHeader&&!n.meta.collapsed&&t.eachElement(this.removeSummaryElements)}},{key:"removeSummaryElements",value:function(e){}},{key:"renderCell",value:function(e){var t=e.column,n=e.cellElement,r=e.row,i=e.record,a=e.size,o=e.isFirstColumn,l=this,s=i.meta,u=l.client.rowHeight,c="groupRowFor"in s,d="groupFooterFor"in s,h="header"===l.target,f={"b-group-footer":0,"b-header-summary":0},v=c&&(h||l.collapseToHeader&&s.collapsed)&&!o||d&&!h;if((c||d)&&(a.height=c&&a.height||u),l.store.isGrouped&&v&&!l.disabled){t.clearCell(n);var g=c?i:s.groupRecord;r.isGroupFooter=d,r.isGroupHeader=c,d?f["b-group-footer"]=1:f["b-header-summary"]=1;var m=l.updateSummaryHtml(n,t,g),p="number"==typeof m?m:m.count;p>1&&(a.height+=s.collapsed&&!h?0:p*u*.1),m.height&&(a.height+=m.height)}r.assignCls(f)}},{key:"updateSummaryHtml",value:function(e,t,n){var r=n.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();var i=this.generateHtml(t,r,"b-grid-group-summary",n,n.meta.groupField,n.meta.groupRowFor);return e.children.length?li.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}},{key:"onStoreUpdate",value:function(e){var t=this,n=e.source,r=e.changes;if(!this.disabled&&n.isGrouped){if(r&&n.groupers.find((function(e){return e.field in r})))return;Object.keys(r).some((function(e){var n=t.client.columns.get(e);return Boolean(n)&&(Boolean(n.sum)||Boolean(n.summaries))}))&&(this.client.forceFullRefresh=!0)}}},{key:"refresh",value:function(){var e=this;this.client.columns.visibleColumns.forEach((function(t){t.hasSummary&&e.client.refreshColumn(t)}))}},{key:"hasSummary",value:function(e){return e.sum||e.summaries}},{key:"updateSummaries",value:function(){this.isConfiguring||this.refresh()}}],[{key:"configurable",get:function(){return{collapseToHeader:null,target:"footer"}}},{key:"pluginConfig",get:function(){return{chain:["bindStore"]}}}])}(KC(wc));S(XC,"$name","GroupSummary"),XC.featureClass="b-group-summary",XC._$name="GroupSummary",Ug.registerFeature(XC);var ZC=Object.freeze({animate:!1,block:"start"}),JC=Object.freeze({animate:!1,block:"end"}),QC={split:1,unsplit:1},ew=new WeakMap,tw=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return y(e=g(this,t,[].concat(r)),ew,!1),S(e,"restorers",[]),e}return R(t,e),w(t,[{key:"doDestroy",value:function(){this.unsplit(!0),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){var t=this;t.isConfiguring||(e?(t._disabledSplitOptions=t._splitOptions,t.unsplit()):t._disabledSplitOptions&&(t.split(t._disabledSplitOptions),t._disabledSplitOptions=null))}},{key:"onInternalPaint",value:function(){}},{key:"isSplit",get:function(){var e;return Boolean(null===(e=this.widgets)||void 0===e?void 0:e.length)}},{key:"getClientConfig",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:{},a=this.client,o=a.subGrids,l=a.regions,s=a.columns.records.slice(),u=Be.assign({},a.subGridConfigs);if(a.eachSubGrid((function(e){var t=u[e.region];e.flex?t.flex=e.flex:t.width=e.element.style.width})),n.atColumn&&l.length>1&&t>0)for(var c=l.indexOf(n.atColumn.region),d=0;d<c;d++){var h=o[l[d]];$e.remove.apply($e,[s].concat(z(h.columns.records))),delete u[l[d]]}var f,v=Be.merge({},a.initialConfig,{appendTo:e,insertFirst:null,insertBefore:null,splitFrom:a,owner:a.owner,tbar:a.initialConfig.tbar&&1===t?{height:a.tbar.height,items:[" "]}:null,store:a.store,selectedRecordCollection:a.selectedRecordCollection,subGridConfigs:u,columns:this.cloneColumns(s),minHeight:0,minWidth:0},r),g=D(Be.keys(this.relayProperties));try{for(g.s();!(f=g.n()).done;){var m=f.value;v[m]=a[m]}}catch(e){g.e(e)}finally{g.f()}var p={};for(var y in a.listeners)if(!QC[y]){var k=a.listeners[y].filter((function(e){return!e.$internal}));k.length&&(p[y]=k)}return v.listeners=p,("horizontal"===n.direction||"both"===n.direction&&1!==t)&&("hideHeaders"in v||(v.hideHeaders=!0),v.features.headerMenu=!1),delete v.data,delete v.adopt,v}},{key:"cloneColumns",value:function(e){return e.flatMap((function(e){if(e.meta.isSelectionColumn||"expanderActionColumn"===e.field)return[];var t=F({},e.data);return e.children&&(t.children=e.children.map((function(e){return F({},e.data)}))),delete t.headerRenderer,delete t.parentId,delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,t}))}},{key:"cloneClient",value:function(e,t,n,r){var i=this.getClientConfig(e,t,n,r),a=new this.client.constructor(i);return a.element.classList.add("b-split-clone"),a}},{key:"processOptions",value:function(e){var t=this.client,n=e.atRecord,r=e.atColumn,i=e.direction;if(i){if("vertical"!==i&&!n&&t.store.count){var a,o=t._bodyRectangle.height/2+t.scrollable.y,l=null!==(a=t.rowManager.getRowAt(o,!0))&&void 0!==a?a:t.rowManager.rows[Math.ceil(t.rowManager.rows.length/2)];e.atRecord=t.store.getById(l.id)}if("horizontal"!==i&&!r){for(var s=pt.from(t.element),u=s.center.x-s.x,c=t.subGrids[t.regions[0]],d=0,h=null;u>c.width;)u-=c.width,c=t.subGrids[t.regions[++d]];u+=c.scrollable.x;for(var f=c.columns.visibleColumns,v=0,g=0;v<u&&g<f.length;)v+=(h=f[g++]).element.offsetWidth;e.atColumn=h}}else e.direction=n&&r?"both":r?"vertical":"horizontal";return e}},{key:"createSplitContainer",value:function(e){var t=e.direction,n=this.client,r=n.element;return this.splitContainer=li.createElement({parent:r.parentElement,nextSibling:r.nextSibling,className:S(S({"b-split-container":1},"b-split-".concat(t),1),"b-rtl",n.rtl),style:{width:r.style.width,flex:r.style.flex,height:r.style.height},children:["both"!==t&&r,"both"===t&&{className:"b-split-top",children:[r]},"both"===t&&{className:"b-split-bottom"}]})}},{key:"syncHeaderHeights",value:function(){var e,t=0,n=D(this.subViews);try{for(n.s();!(e=n.n()).done;){e.value.eachSubGrid((function(e){e.header.height>t&&(t=e.header.height)}))}}catch(e){n.e(e)}finally{n.f()}var r,i=D(this.subViews);try{for(i.s();!(r=i.n()).done;){r.value.eachSubGrid((function(e){e.header.height=t}))}}catch(e){i.e(e)}finally{i.f()}}},{key:"toggleOriginalSubGrids",value:function(e){var t=this,n=t.client,r=n.regions;if(e.atColumn&&r.length>1){var i=r.indexOf(e.atColumn.region),a=[n];"both"===e.direction&&a.push(t.subViews[2]);for(var o=function(){var e=s[l];if(i+1<r.length){var a=e===n,o=e.subGrids[r[i]];o.hideSplitter(),a&&t.restorers.push((function(){return o.showSplitter()})),o.flex||(n.inForEachOther=!0,o.flex=1,n.inForEachOther=!1,a&&t.restorers.push((function(){o.flex=null,o.width=o._initialWidth})));for(var u=function(){var n=e.subGrids[r[c]];n.hide(),a&&t.restorers.push((function(){n.show()}))},c=i+1;c<r.length;c++)u();2===r.length&&(e._initialWidth=e.element.style.width,e._initialFlex=e.flex,e.width=o._initialWidth,a&&t.restorers.push((function(){null!==e._initialFlex?e.flex=e._initialFlex:null!==e._initialWidth&&(e.width=e._initialWidth)})))}},l=0,s=a;l<s.length;l++)o()}}},{key:"split",value:(r=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return L().mark((function n(){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x,E,R,T,M,F;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=(r=e).client).splitFrom){n.next=3;break}return n.abrupt("return");case 3:if(!r.isSplit){n.next=6;break}return n.next=6,r.unsplit(!0);case 6:if(a=i.rtl,o=r.processOptions(t),l=o.atRecord,s=o.atColumn,u=o.direction,c=t.splitX,d=t.remainingWidth,h=null,f=null,!l){n.next=16;break}return n.next=11,i.scrollRowIntoView(l);case 11:if(v=i.getRowFor(l)){n.next=14;break}throw new Error("Could not find row for record ".concat(l.id));case 14:h=pt.from(v.cells[0],i.element).bottom,f=pt.from(i.element).height-h;case 16:return s&&!c&&(c=pt.from(s.element,i.element).getEnd(a),d=pt.from(i.element).width-c-li.scrollBarWidth,a&&(g=c,c=d+li.scrollBarWidth,d=g-li.scrollBarWidth)),m=[],p=r.createSplitContainer(t),y=i.columns.visibleColumns,k=s?y[y.indexOf(s)+1]:null,b=l?i.store.getNext(l):null,i.eachSubGrid((function(e){return e._initialWidth=e.width})),i.columns.commit(),"both"!==u?(C={flex:"0 0 ".concat((null!=h?f:d)-7,"px"),height:null},w=r.widgets=[new Rb({appendTo:p}),r.cloneClient(p,"vertical"===u?1:0,t,C)],D=_(w,2),S=D[1],null!=c&&(i.renderRows(),t.atDate||(m.push(i.scrollColumnIntoView(s,JC)),k&&m.push(S.scrollColumnIntoView(k,ZC)))),null!=h&&m.push(S.scrollRowIntoView(b,ZC)),i.element.classList.add("b-split-start"),S.element.classList.add("b-split-end"),i.scrollable.addPartner(S.scrollable,{x:"horizontal"===u,y:"horizontal"!==u})):(x={flex:"0 0 ".concat(d-7,"px")},p.lastElementChild.style.flex="0 0 ".concat(f-7,"px"),r.widgets=[new Rb({insertBefore:p.lastElementChild}),r.topSplitter=new Rb({appendTo:p.firstElementChild}),r.cloneClient(p.firstElementChild,1,t,x),r.cloneClient(p.lastElementChild,0,t),r.bottomSplitter=new Rb({appendTo:p.lastElementChild}),r.cloneClient(p.lastElementChild,2,t,x)],E=i,R=r.widgets[2],T=r.widgets[3],M=r.widgets[5],E.element.classList.add("b-split-top-start"),R.element.classList.add("b-split-top-end"),T.element.classList.add("b-split-bottom-start"),M.element.classList.add("b-split-bottom-end"),null!=c&&(E.renderRows(),T.renderRows(),s&&!t.atDate&&(m.push(i.scrollColumnIntoView(s,JC)),k&&m.push(R.scrollColumnIntoView(k,ZC)))),null!=h&&m.push(T.scrollRowIntoView(b,ZC),M.scrollRowIntoView(b,ZC)),E.scrollable.addPartner(R.scrollable,"y"),E.scrollable.addPartner(T.scrollable,"x"),R.scrollable.addPartner(M.scrollable,"x"),T.scrollable.addPartner(M.scrollable,"y"),r.topSplitter.ion({splitterMouseDown:"onSplitterMouseDown",splitterMouseEnter:"onSplitterMouseEnter",splitterMouseLeave:"onSplitterMouseLeave",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:r}),r.bottomSplitter.ion({splitterMouseDown:"onSplitterMouseDown",splitterMouseEnter:"onSplitterMouseEnter",splitterMouseLeave:"onSplitterMouseLeave",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:r})),r.subViews=[i].concat(z(r.widgets.filter((function(e){return e.isGridBase})))),r.toggleOriginalSubGrids(t),r.syncHeaderHeights(),r._splitOptions=t,n.next=27,Promise.all(m);case 27:return F=pt.from(i.element),i.onInternalResize(i.element,F.width,F.height),i.eachSubGrid((function(e){var t=pt.from(e.element);e.onInternalResize(e.element,t.width,t.height)})),i.splitDirection=u,i.scrollable.x+=.5,i.scrollable.y+=.5,r.startSyncingColumns(),i.trigger("split",{subViews:r.subViews,options:t}),n.abrupt("return",r.subViews);case 36:case"end":return n.stop()}}),n)}))()})),function(){return r.apply(this,arguments)})},{key:"unsplit",value:(n=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0];return L().mark((function n(){var r,i,a,o,l,s,u;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(r=e).client,a=r.splitContainer,o=i.element,!r.isSplit){n.next=28;break}if(r.stopSyncingColumns(),delete i.splitDirection,null===(l=r.widgets)||void 0===l||l.forEach((function(e){return e.destroy()})),r.widgets=null,i.eachSubGrid((function(e){return e.scrollable.x})),i.scrollable.y,a.parentElement.appendChild(o),a.remove(),r.splitContainer=null,o.style.flexBasis=o.style.flexGrow="",o.classList.remove("b-split-top-start","b-split-start"),r.subViews.length=0,r.isDestroying){n.next=28;break}i.renderRows(),r.unsplitCleanup(),s=D(r.restorers);try{for(s.s();!(u=s.n()).done;)(0,u.value)()}catch(e){s.e(e)}finally{s.f()}return r.restorers.length=0,n.next=22,Ge.animationFrame();case 22:return n.next=24,Ge.animationFrame();case 24:if(!r.isDestroyed){n.next=26;break}return n.abrupt("return");case 26:!t&&i.trigger("unsplit"),r._splitOptions=null;case 28:case"end":return n.stop()}}),n)}))()})),function(){return n.apply(this,arguments)})},{key:"unsplitCleanup",value:function(){}},{key:"populateCellMenu",value:function(e){var t=e.record,n=e.column,r=e.items,i=this,a=i.isSplit,o=i.client.splitFrom;i.disabled||(r.splitGrid={text:"L{split}",localeClass:i,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:a||o,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:i,weight:100,onItem:function(){i.split({atRecord:t})}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:i,weight:200,onItem:function(){i.split({atColumn:n})}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:i,weight:300,onItem:function(){i.split({atColumn:n,atRecord:t})}}}},r.unsplitGrid={text:"L{unsplit}",localeClass:i,icon:"b-icon b-icon-clear",hidden:!(a||o),weight:400,separator:!0,onItem:function(){(o||i).unsplit()}})}},{key:"startSyncingColumns",value:function(){this.detachListeners("columns");var e,t=D(this.subViews);try{for(t.s();!(e=t.n()).done;){e.value.columns.ion({name:"columns",change:"onColumnsChange",thisObj:this})}}catch(e){t.e(e)}finally{t.f()}}},{key:"stopSyncingColumns",value:function(){this.detachListeners("columns")}},{key:"onColumnsChange",value:function(e){var t=e.source,n=e.isMove,r=e.action,i=e.parent,a=e.records,o=e.changes,l=this;if(!p(ew,l)){k(ew,l,!0);var s,u=D(l.subViews);try{var c=function(){var e=s.value,u=e.columns;if(t!==u){if("update"===r&&o.region&&1===Object.keys(o).length&&!l.isLockRows){if(u.getById(a[0].id))u.remove(a[0].id);else{var c,d=_(a,1)[0],h=null!==(c=u.getById(l.$before.parent.id))&&void 0!==c?c:u.rootNode,f=null!==l.$before.id&&u.getById(l.$before.id);h.insertChild(d.data,f)}l.$before=null}else if(null!=n&&n[a[0].id]||!0===n){if("add"===r){var v,g=a[0],m=g.nextSibling,p=u.getById(g.id);if(!p)return l.$before={id:null==m?void 0:m.id,parent:i},k(ew,l,!1),0;if(g.meta.isSelectionColumn)return k(ew,l,!1),0;var y=null!==(v=u.getById(i.id))&&void 0!==v?v:u.rootNode,b=m&&u.getById(m.id);y.insertChild(p,b)}}else if("add"===r){var C=a.filter((function(t){return e.getSubGridFromColumn(t)}));u.add(l.cloneColumns(C))}else u.applyChangesFromStore(t);u.commit()}};for(u.s();!(s=u.n()).done;)c()}catch(e){u.e(e)}finally{u.f()}t.commit(),k(ew,l,!1)}}},{key:"getOtherSplitter",value:function(e){return e===this.topSplitter?this.bottomSplitter:this.topSplitter}},{key:"onSplitterMouseDown",value:function(e){var t=e.source,n=e.event;n.handled||(n.handled=!0,this.getOtherSplitter(t).onMouseDown(n))}},{key:"onSplitterMouseEnter",value:function(e){var t=e.source;e.event,this.getOtherSplitter(t).element.classList.add("b-hover")}},{key:"onSplitterMouseLeave",value:function(e){var t=e.source;e.event,this.getOtherSplitter(t).element.classList.remove("b-hover")}},{key:"onSplitterDrag",value:function(e){var t=e.source,n=e.event;n.handled||(n.handled=!0,this.getOtherSplitter(t).onMouseMove(n))}},{key:"onSplitterDrop",value:function(e){var t=e.source,n=e.event;n.handled||(n.handled=!0,this.getOtherSplitter(t).onMouseUp(n))}},{key:"afterConfigChange",value:function(e){var t=e.name,n=e.value;this.isSplit&&this.relayProperties[t]&&this.syncSplits((function(e){e[t]=n}))}},{key:"afterAddListener",value:function(e,t){!this.isSplit||t.$internal||QC[e]||this.syncSplits((function(n){return n.on(e,t)}))}},{key:"afterRemoveListener",value:function(e,t){t.$internal||this.syncSplits((function(n){return n.un(e,t)}))}},{key:"forEachOther",value:function(e){var t,n=this.client.splitFrom||this.client,r=Le.uncapitalize(this.constructor.$name);if(null!==(t=n.features[r])&&void 0!==t&&t.enabled&&!n.inForEachOther){n.inForEachOther=!0;var i,a=D(n.subViews);try{for(a.s();!(i=a.n()).done;){var o=i.value;o!==this.client&&e(o)}}catch(e){a.e(e)}finally{a.f()}n.inForEachOther=!1}}},{key:"syncSplits",value:function(e){this.forEachOther(e)}}],[{key:"pluginConfig",get:function(){return{chain:["populateCellMenu","afterConfigChange","afterAddListener","afterRemoveListener",{fn:"onInternalPaint",prio:-1e3}],assign:["split","unsplit","subViews","syncSplits"]}}}]);var n,r}(wc);S(tw,"$name","Split"),S(tw,"featureClass",""),S(tw,"configurable",{subViews:[],relayProperties:{value:{readOnly:1,rowHeight:1},$config:{merge:"merge"}}}),tw._$name="Split",Ug.registerFeature(tw,!1);var nw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.enabled&&(this.refreshSuspended=!0,this.client.suspendRefresh())}},{key:"onInternalPaint",value:function(e){e.firstPaint&&(this.refreshSuspended&&this.client.resumeRefresh(),this.lockRows())}},{key:"lockRows",value:(r=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{fieldName:this.fieldName,filterFn:this.filterFn};return L().mark((function n(r){var i,a,o,l,s,u,c,d,h,f,v,g,m,p;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((a=(i=e).client).splitFrom||i.disabled||i.$isLocking)){n.next=3;break}return n.abrupt("return");case 3:if(i.$isLocking=!0,!i.isSplit){n.next=7;break}return n.next=7,i.unsplit(!0);case 7:return t=i.processOptions(t),o=a.store,l=a.scrollable,s=t.fieldName,u="".concat(a.id,"-sticky-record-filter"),c=Be.copyProperties({},a,["flex","minHeight","maxHeight","autoHeight","hideHorizontalScrollbar"]),d=i.createSplitContainer(t),h=t.filterFn,0===c.maxHeight&&(c.maxHeight=null),c.height=a._lastHeight||null,i.restorers.push((function(){a.setConfig(c),o.removeFilter(u),a.element.classList.remove("b-locked-rows"),a.store=a.store.$master,a.isLockedRows=a.originalStore=null,a.isLockedRowsView=null})),s&&!o.modelClass.fieldMap[s]&&o.modelClass.addField({name:s,type:"boolean"}),a.setConfig({height:null,flex:"0 0 auto",minHeight:0,maxHeight:t.maxHeight||"50%",autoHeight:!0,hideHorizontalScrollbar:!0,hideFooters:!0,footer:!1,bbar:null}),a.element.classList.add("b-locked-rows"),f=s?[s]:"*",h=h||function(e){return e[s]},v=i.widgets=[i.cloneClient(d,0,t,Be.merge({flex:"1 1 0%",hideHeaders:!0,header:!1,usesLockRows:!0},i.bottomGridConfig))],g=_(v,1),(m=g[0]).element.classList.add("b-locked-rows-clone"),i.subViews=[m,a],a.originalStore=o,a.isLockedRows=!0,a.isLockedRowsView=m.isLockedRowsView=!0,a.store=o.chain((function(e){return h(e)}),f,{chainFilters:!0}),m.store=o.chain((function(e){return!h(e)}),f,{chainFilters:!0}),li.scrollBarWidth&&l.hasOverflowY&&(l.overflowY="scroll"),!a.scrollable.isPartneredWith(m.scrollable)&&a.scrollable.addPartner(m.scrollable,{x:!0}),m.columns.leaves.forEach((function(e){e.isRowNumberColumn&&m.refreshColumn(e)})),i._splitOptions=t,p=pt.from(a.element),a.onInternalResize(a.element,p.width,p.height),a.eachSubGrid((function(e){var t=pt.from(e.element);e.onInternalResize(e.element,t.width,t.height)})),null!==(r=a.features.columnAutoWidth)&&void 0!==r&&r.enabled&&a.features.columnAutoWidth.syncAutoWidthColumns(),a.scrollable.x+=.5,a.scrollable.y+=.5,i.startSyncingColumns(),i.$isLocking=!1,a.trigger("lockRows",{clone:m}),n.abrupt("return",i.subViews);case 40:case"end":return n.stop()}}),n)}))()})),function(){return r.apply(this,arguments)})},{key:"processOptions",value:function(e){var t=e.fieldName;if(e.direction="horizontal",!e.filterFn&&!t)throw new Error("LockRows needs `fieldName` or `filterFn`");return"string"==typeof e.filterFn&&(e.filterFn=this.resolveCallback(e.filterFn)),e}},{key:"numberOfLockedRows",get:function(){return this.isSplit?this.subViews[1].store.count:0}},{key:"afterPluginConfigChange",value:function(e){var t,n=e.plugin,r=e.applied,i=e.origPassedValue,a=e.name,o=this;if(o.enabled&&null!==(t=o.subViews)&&void 0!==t&&t[0]&&n!==o&&r){var l=Le.uncapitalize(n.$$name),s=o.subViews[0].features[l];null!=s&&s.enabled&&(W(i)in{string:1,boolean:1,number:1}||i instanceof Date)&&(s[a]=i)}}},{key:"isAllRecordsSelected",value:function(){var e=this.isSplit&&this.subViews[0];return this.overridden.isAllRecordsSelected()&&(!e||e.isAllRecordsSelected())}},{key:"selectAll",value:function(e){this.isSplit&&this.subViews[0].selectAll(e)}},{key:"deselectAll",value:function(e,t){this.isSplit&&this.subViews[0].deselectAll(e,t)}},{key:"afterRenderRow",value:function(e){var t=e.row,n=e.recordIndex;this.isSplit&&t.toggleCls("b-last",n===this.client.store.count-1)}},{key:"populateCellMenu",value:function(e){var t,n,r=e.record,i=e.items,a=this,o=(null===(t=a.client.splitFrom)||void 0===t?void 0:t.features.lockRows)||a,l=null===(n=o._splitOptions)||void 0===n?void 0:n.fieldName;a.disabled||!l||o.filterFn||a.client.readOnly||r.isSpecialRow||(i.toggleLocked={text:r[l]?"L{unlockRow}":"L{lockRow}",localeClass:a,icon:"b-icon ".concat(r[l]?"b-icon-unlock-row":"b-icon-lock-row"),weight:500,separator:!0,closeParent:!0,onItem:function(){r[l]=!r[l]}})}},{key:"unsplit",value:(n=f((function(){var e=this,n=arguments.length>0&&arguments[0]!==i&&arguments[0];return L().mark((function r(){var i,a;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=(i=e).subViews[0],i.client.trigger("beforeUnlockRows",{clone:a}),r.next=4,B(t,"unsplit",e,3)([n]);case 4:!i.isDestroyed&&i.client.trigger("unlockRows",{clone:a});case 5:case"end":return r.stop()}}),r)}))()})),function(){return n.apply(this,arguments)})},{key:"doDisable",value:function(e){this.isConfiguring||(e?this.unsplit():this.lockRows())}}],[{key:"pluginConfig",get:function(){var e={};for(var n in B(t,"pluginConfig",this))e[n]=z(B(t,"pluginConfig",this)[n]);return e.chain.push("selectAll","deselectAll","afterRenderRow","afterPluginConfigChange"),e.override||(e.override=[]),e.override.push("isAllRecordsSelected"),e}}]);var n,r}(tw);S(nw,"$name","LockRows"),S(nw,"configurable",{fieldName:"fixed",filterFn:null,bottomGridConfig:null}),nw._$name="LockRows",Ug.registerFeature(nw,!1);var rw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"shouldShowMenu",value:function(e){var t=e.column;return t&&!1!==t.enableHeaderContextMenu&&t!==this.client.timeAxisColumn}},{key:"getDataFromEvent",value:function(e){return Be.assign(B(t,"getDataFromEvent",this,3)([e]),this.client.getHeaderDataFromEvent(e))}},{key:"populateHeaderMenu",value:function(e){var t=e.items,n=e.column,r=this;if(n){if(n.headerMenuItems&&Be.merge(t,n.headerMenuItems),n.isCollapsible){var i=n.collapsed,a=i?r.client.rtl?"left":"right":r.client.rtl?"right":"left";t.toggleCollapse={weight:215,icon:"b-fw-icon b-icon-collapse-".concat(a),text:r.L(i?"L{expandColumn}":"L{collapseColumn}"),onItem:function(){return n.collapsed=!i}}}if(r.moveColumns){var o=r.getColumnToMoveBefore(n),l=r.getColumnToMoveAfter(n);o&&(t.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:r.L("L{moveBefore}",Le.encodeHtml(o.text)),onItem:function(){var e,t=n.parent;o.parent.insertChild(n,o)&&(n.region=o.region,null!==(e=t.children)&&void 0!==e&&e.length||t.remove())}}),l&&(t.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:r.L("L{moveAfter}",Le.encodeHtml(l.text)),onItem:function(){var e,t=n.parent;l.parent.insertChild(n,l.nextSibling)&&(n.region=l.region,null!==(e=t.children)&&void 0!==e&&e.length||t.remove())}})}}return t}},{key:"getColumnToMoveBefore",value:function(e){var t=e.previousSibling,n=e.parent;return t?t.children&&!e.children?t.children[t.children.length-1]:t:n.isRoot?void 0:n}},{key:"getColumnToMoveAfter",value:function(e){var t=e.nextSibling,n=e.parent;return t||(n.isRoot?void 0:n)}}],[{key:"configurable",get:function(){return{type:"header",items:null,moveColumns:null}}},{key:"defaultConfig",get:function(){return{processItems:null}}},{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateHeaderMenu"),e}}])}(op);S(rw,"$name","HeaderMenu"),rw.featureClass="",rw._$name="HeaderMenu",Ug.registerFeature(rw,!0);var iw={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"},aw=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"mergedRanges",[]),S(e,"mergedMap",{}),e}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e=this,t=e.client;t.eachSubGrid((function(t){return e.setupSubGrid(t)})),t.rowManager.ion({renderDone:"onRenderDone",offsetRows:"onOffsetRowsUpdated",thisObj:e}),e.bindStore(t.store)}},{key:"setupSubGrid",value:function(e){e.$mergedCellsElement=li.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}}),e.ion({beforeInternalResize:"refreshBounds",thisObj:this})}},{key:"doDisable",value:function(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),B(t,"doDisable",this,3)([e])}},{key:"updatePassthrough",value:function(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}},{key:"updateSortedOnly",value:function(e){this.isConfiguring||this.reset(!0,e)}},{key:"updateShouldMerge",value:function(e){this.isConfiguring||this.reset(!0,e)}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}},{key:"onInternalResize",value:function(){this.refreshBounds()}},{key:"refresh",value:function(){this.reset(!1)}},{key:"beforeRenderCell",value:function(e){var t=this,n=e.column,r=e.record,i=e.cellElement,a=t.client.subGrids[n.region];if(!t.disabled&&n.mergeCells&&(n.isSorted||!t.sortedOnly)&&!r.isSpecialRow&&!a.collapsed){var o=t.getMergeRange(r,n);null!=o&&o.use&&(i.classList.add("b-merged-cell"),i.innerHTML="",e.cellElement=o.cellElement)}}},{key:"afterRenderRow",value:function(e){var t=e.row,n=e.oldId,r=e.oldHeight;n===t.id&&r!==t.height&&(this.heightChanged=!0)}},{key:"afterColumnsChange",value:function(e){var t=e.action,n=e.changes,r=e.column;if(!this.disabled)if("update"!==t||!n.mergeCells||r.mergeCells)this.refreshBounds();else{var i,a=D(this.mergedRanges.slice());try{for(a.s();!(i=a.n()).done;){var o=i.value;o.column===r&&this.removeRange(o)}}catch(e){a.e(e)}finally{a.f()}this.syncDom()}}},{key:"afterRemove",value:function(){!this.disabled&&this.reset()}},{key:"afterToggleGroup",value:function(){!this.disabled&&this.reset()}},{key:"afterToggleSubGrid",value:function(){!this.disabled&&this.reset()}},{key:"afterSelectionChange",value:function(){if(!this.passthrough){var e,t=this.client,n=t.selectedRecords.map((function(e){return t.store.indexOf(e)})),r=!1,i=D(this.mergedRanges);try{for(i.s();!(e=i.n()).done;){for(var a=e.value,o=!0,l=a.fromIndex;l<=a.toIndex&&o;l++)o=n.includes(l);a.isSelected!==o&&(a.isSelected=o,r=!0)}}catch(e){i.e(e)}finally{i.f()}r&&this.syncDom()}}},{key:"getRecordFromElement",value:function(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}},{key:"getColumnFromElement",value:function(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}},{key:"populateHeaderMenu",value:function(e){var t=e.column,n=e.items;!1!==t.mergeable&&(n.mergeCells={text:"L{MergeCells.mergeCells}",icon:"b-fw-icon ".concat(t.mergeCells?"b-icon-checked":"b-icon-unchecked"),tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:function(){return t.mergeCells=!t.mergeCells}})}},{key:"handleEvent",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.passthrough){e.next=13;break}if(!(n=t.target.closest(".b-grid-merged-cells"))){e.next=13;break}for(i=this.client,a=n.elementData.range,o=i.features.cellEdit,l=a.column,s=Le.capitalize(null!==(r=iw[t.type])&&void 0!==r?r:t.type),u={grid:i,records:[],column:l,cellElement:n.firstElementChild,target:t.target,event:t},c=a.fromIndex;c<=a.toIndex;c++)u.records.push(i.store.getAt(c));if(i.trigger("mergedCell".concat(s),u),(null==o?void 0:o.triggerEvent.toLowerCase())!=="cell".concat(s).toLowerCase()){e.next=12;break}return d=i.rowManager.getRowAt(t.clientY),e.next=10,o.startEditing({id:d.id,columnId:l.id});case 10:e.next=13;break;case 12:"click"===t.type&&this.onRangeClick({range:a});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onRangeClick",value:function(e){for(var t=e.range,n=[],r=t.fromIndex;r<=t.toIndex;r++)n.push(this.client.store.getAt(r));this.client.selectedRecords=n}},{key:"onStoreChange",value:function(e){e.action,e.removed,e.added,!this.disabled&&this.reset()}},{key:"onStoreRefresh",value:function(e){var t=e.source,n=e.action;"filter"===n||"dataset"===n||this.disabled||this.reset(Boolean(t.isResourceStore))}},{key:"createRangeElement",value:function(e){var t,n,r,i=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,a="".concat(e.fromIndex,"-@-").concat(e.column.id),o=null!==(t=null===(n=i.syncIdMap)||void 0===n?void 0:n[a])&&void 0!==t?t:null===(r=i.releasedIdMap)||void 0===r?void 0:r[a];return i.releasedIdMap&&delete i.releasedIdMap[a],o||(o=li.createElement(this.createRangeDomConfig(e))),fa.addChild(i,o,a),e.element=o,e.cellElement=o.firstElementChild,o}},{key:"createRangeDomConfig",value:function(e){var t,n=e.column,r=e.fromIndex,i=e.toIndex,a=e.top,o=e.left,l=e.right,s=e.width,u=e.height,c=n.type,d=this.client.store.getAt(r),h={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:a,left:o,right:l,height:u,width:s},dataset:{syncId:"".concat(r,"-@-").concat(n.id),fromIndex:r,toIndex:i,column:n.field,columnId:n.id},children:[{className:new Ct(this.client.cellCls).assign(S(S(S({},"b-".concat(null==c?void 0:c.toLowerCase(),"-cell"),c),n.cellCls,n.cellCls),n.internalCellCls,n.internalCellCls)).assign(n.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:n.field,columnId:n.id},style:{height:this.client.rowManager.rowHeight}}]};return null===(t=n.mergedRenderer)||void 0===t||t.call(n,{domConfig:h,value:n.getRawValue(d),record:d,column:n,fromIndex:r,toIndex:i}),h}},{key:"buildMergedCellsConfig",value:function(e,t,n){var r,i,a=this,o=a.client,l=o.rowManager;e=null!=e?e:null===(r=l.topRow)||void 0===r?void 0:r.dataIndex,t=null!=t?t:null===(i=l.bottomRow)||void 0===i?void 0:i.dataIndex;var s,u=o.regions.reduce((function(e,t){return e[t]={className:{"b-grid-merged-cells-container":1},children:[]},e}),{}),c=D(a.mergedRanges);try{for(c.s();!(s=c.n()).done;){var d=s.value;d.use&&d.fromIndex<=t&&d.toIndex>=e&&(a.updateRange(d,a.heightChanged,n),u[d.column.region].children.push(a.createRangeDomConfig(d)))}}catch(e){c.e(e)}finally{c.f()}return u}},{key:"syncDom",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.client,r=n.rowManager;if((e||r.topRow)&&(!t.disabled||t.isDisabling)){var a=this.buildMergedCellsConfig();n.eachSubGrid((function(e){fa.sync({targetElement:e.$mergedCellsElement,syncIdField:"syncId",domConfig:a[e.region]})})),t.heightChanged=!1}}},{key:"onRenderDone",value:function(){this.syncDom()}},{key:"onOffsetRowsUpdated",value:function(){this.reset(!0)}},{key:"removeRange",value:function(e){$e.remove(this.mergedRanges,e);for(var t=e.fromIndex;t<=e.toIndex;t++)delete this.mergedMap["".concat(t,"-@-").concat(e.column.id)]}},{key:"reset",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.client.columns.visibleColumns.filter((function(e){return e.mergeCells&&(e.isSorted||!n.sortedOnly||t)}),!0),a=n.mergedRanges.length;if(n.mergedRanges=[],n.mergedMap={},e&&!n.client.refreshSuspended){var o,l=D(n.client.rowManager.rows);try{for(l.s();!(o=l.n()).done;){var s,u=o.value,c=D(r);try{for(c.s();!(s=c.n()).done;){var d=s.value;u.renderCell(u.getCell(d.id))}}catch(e){c.e(e)}finally{c.f()}}}catch(e){l.e(e)}finally{l.f()}n.syncDom(a&&!n.client.rowManager.rowCount)}}},{key:"refreshBounds",value:function(){var e,t=this.mergedRanges,n=this.client.rowManager.topRow,r=new a,i=this.client.rtl,o=D(t.slice());try{for(o.s();!(e=o.n()).done;){var l=e.value,s=l.column,u=n.getCell(s.id);if(u){var c,d=null!==(c=r.get(s))&&void 0!==c?c:{},h=d.rowWidth,f=d.bounds;f||(h=u.parentElement.offsetWidth,f=pt.from(u,u.parentElement),r.set(s,{rowWidth:h,bounds:f})),i?l.right=h-f.right:l.left=f.left,l.width=f.width}else this.removeRange(l)}}catch(e){o.e(e)}finally{o.f()}this.syncDom()}},{key:"updateRange",value:function(e,t){var n,r,a=arguments.length>2&&arguments[2]!==i?arguments[2]:null,o=this.client,l=o.store,s=o.rowManager,u=e.topRendered,c=e.bottomRendered,d=s.rowOffsetHeight,h=e.fromIndex,f=e.toIndex;if((t=a?a.length>0:t)||!u||!c){if(!u||t){if(a){var v=a.findIndex((function(e){return e.dataIndex>=h}));n=a[v],h=n.dataIndex}else do{n=s.getRowById(l.getAt(h))}while(!n&&h++<f);e.topRendered=h===e.fromIndex;var g=h-e.fromIndex;e.top=n.top-g*(a?n.offsetHeight:d)}if(!c||t){if(a){var m=a.findIndex((function(e){return e.dataIndex===f}));r=a[-1===m?a.length-1:m],h=r.dataIndex}else do{r=s.getRowById(l.getAt(f))}while(!r&&f-- >h);e.bottomRendered=f===e.toIndex;var p=e.toIndex-f;e.bottom=r.bottom+p*(a?r.offsetHeight:d)}e.height=e.bottom-e.top}}},{key:"getMergeRange",value:function(e,t){var n;if(!e.isSpecialRow){var r=this,i=r.mergedMap,a=r.client.store,o=r.client.rowManager.topRow,l=t.id,s=a.indexOf(e),u="".concat(s,"-@-").concat(l),c=this.client.rtl,d=t.getRawValue(e),h=i[u];if(!h){h=i[u]={column:t},r.mergedRanges.push(h);var f,v,g=s-1;do{v=(f=a.getAt(g))&&t.getRawValue(f),i["".concat(g,"-@-").concat(l)]&&(f=null),g--}while(f&&!f.isSpecialRow&&v===d);var m,p,y=s+1;do{p=(m=a.getAt(y))&&t.getRawValue(m),i["".concat(y,"-@-").concat(l)]&&(m=null),y++}while(m&&!m.isSpecialRow&&p===d);if(h.fromIndex=g+2,h.toIndex=y-2,r.shouldMerge&&h.toIndex-h.fromIndex>0)for(var k=h.fromIndex+1;k<=h.toIndex;k++){var b=a.getAt(k),C=a.getAt(k-1);if(!1===r.shouldMerge({column:t,record:b,previousRecord:C,value:d})){h.toIndex=k-1;break}}if(h.toIndex-h.fromIndex>0){for(var w=h.fromIndex;w<=h.toIndex;w++)i["".concat(w,"-@-").concat(l)]=h;var D=o.getCell(l),S=D.parentElement.offsetWidth,x=pt.from(D,D.parentElement);c?h.right=S-x.right:h.left=x.left,h.width=x.width,h.use=!0}}return null!==(n=h)&&void 0!==n&&n.use&&!h.element&&r.createRangeElement(h),h}}}],[{key:"pluginConfig",get:function(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize","refresh"],override:["getColumnFromElement","getRecordFromElement"]}}}]);var n}(wc);S(aw,"$name","MergeCells"),S(aw,"configurable",{passthrough:!0,sortedOnly:!0,shouldMerge:null}),aw._$name="MergeCells",Ug.registerFeature(aw);var ow={goToNextHit:1,goToPrevHit:1,showFilterEditor:1,clearSearch:1},lw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,li.NodeFilter.SHOW_TEXT,(function(){return li.NodeFilter.FILTER_ACCEPT}))})}},{key:"isActionAvailable",value:function(e){var t=e.actionName;if(ow[t]){var n=this.grid.focusedCell;return!this.disabled&&(null==n?void 0:n.record)&&!n.isActionable&&this.find.length>0}}},{key:"doDisable",value:function(e){e&&this.clear(),B(t,"doDisable",this,3)([e])}},{key:"store",get:function(){return this.grid.store}},{key:"showQuickFind",value:function(){var e=this,t=e.grid,n=t.getHeaderElement(e.columnId);if(n){if(!e.headerField){var r=_(li.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0}),3),i=r[0],a=r[1],o=r[2];"header"===e.mode?n.appendChild(i):(i.className+=" b-quick-hit-mode-grid",t.element.appendChild(i)),e.headerField={header:i,field:a,badge:o,colHeader:n}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,n.classList.add("b-quick-find-header")}!n&&!t.hideHeaders||e.renderListenerInitialized||(t.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}},{key:"hideQuickFind",value:function(){var e,t,n=this,r=n.grid,i=n.headerField,a=D(n.prevFound||n.found);try{for(a.s();!(e=a.n()).done;){var o=e.value,l=r.getRowById(o.id);if(l){l.forceInnerHTML=!0;var s=l.getCell(n.columnId);s._content=null,l.renderCell(s),l.forceInnerHTML=!1}}}catch(e){a.e(e)}finally{a.f()}i&&(null===(t=i.header.parentNode)||void 0===t||t.removeChild(i.header),i.colHeader.classList.remove("b-quick-find-header"),n.headerField=null);n.renderListenerInitialized&&(r.rowManager.un({rendercell:n.renderCell},n),n.renderListenerInitialized=!1),r.trigger("hideQuickFind")}},{key:"search",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.columnId,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this,o=a.grid,l=o.columns.getById(n)||o.columns.get(n),s=a.store.findByField(l.field,e,l.mergeCells&&l.isSorted),u=1;Object.assign(a,{foundMap:{},prevFound:a.found,found:s,find:e,columnId:l.id,findRe:new RegExp("(\\s+)?(".concat(Le.escapeRegExp(String(e)),")(\\s+)?"),"ig")}),e?a.showQuickFind():a.hideQuickFind();var c,d=D(li.children(o.element,".".concat(a.hitCls)));try{for(d.s();!(c=d.n()).done;){var h=c.value;h.classList.remove(a.hitCls,a.hitCellCls),h._originalContent&&(h.innerHTML=h._originalContent,h._originalContent=null)}}catch(e){d.e(e)}finally{d.f()}if(s){s.length>0&&!r&&a.gotoClosestHit(o.focusedCell,s);var f,v=D(s);try{for(v.s();!(f=v.n()).done;){var g=f.value;a.foundMap[g.id]=u++;var m=o.getRowById(g.data.id);if(null==m||m.renderCell(m.getCell(l.id)),u>1e3)break}}catch(e){v.e(e)}finally{v.f()}null===(t=o.syncSplits)||void 0===t||t.call(o,(function(t){return t.features.quickFind.search(e,n,!0)})),o.trigger("quickFind",{find:e,found:s})}}},{key:"clear",value:function(){var e;(this.find||null!==(e=this.found)&&void 0!==e&&e.length)&&this.search("")}},{key:"foundCount",get:function(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}},{key:"gotoHit",value:function(e){var t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id},{doSelect:!0}),Boolean(t)}},{key:"gotoClosestHit",value:function(e,t){var n=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort((function(e,t){return Math.abs(e.index-n)-Math.abs(t.index-n)}));this.gotoHit(t.indexOf(r[0]))}},{key:"gotoFirstHit",value:function(){this.gotoHit(0)}},{key:"gotoLastHit",value:function(){this.gotoHit(this.found.length-1)}},{key:"gotoNextHit",value:function(){var e,t,n,r,i=this;if(null!==(e=i.found)&&void 0!==e&&e.length){var a=i.grid,o=null!==(t=null===(n=a._focusedCell)||void 0===n?void 0:n.id)&&void 0!==t?t:null===(r=a.lastFocusedCell)||void 0===r?void 0:r.id,l=a.store.indexOf(o)||0,s=i.found.find((function(e){return e.index>l}));s?a.focusCell({columnId:i.columnId,id:s.id},{doSelect:!0}):i.gotoFirstHit()}}},{key:"gotoPrevHit",value:function(){var e,t,n,r,i=this;if(null!==(e=i.found)&&void 0!==e&&e.length){var a,o=i.grid,l=i.found,s=null!==(t=null===(n=o._focusedCell)||void 0===n?void 0:n.id)&&void 0!==t?t:null===(r=o.lastFocusedCell)||void 0===r?void 0:r.id,u=o.store.indexOf(s)||0;if(l.length){for(var c=l.length-1;c--;c>=0)if(l[c].index<u){a=l[c];break}a?o.focusCell({columnId:i.columnId,id:a.id},{doSelect:!0}):i.gotoLastHit()}}}},{key:"renderCell",value:function(e){var t,n=e.cellElement,r=e.column,i=e.record,a=this,o=n.classList,l=a.treeWalker,s=a.findRe,u=a.hitTextCls,c=a.columnId===r.id&&(null===(t=a.foundMap)||void 0===t?void 0:t[i.id]);if(c){o.add(a.hitCls),n.isQuickHit=!0,n._originalContent=n.innerHTML;for(var d=l.currentNode=li.down(n,".b-grid-cell-value,.b-tree-cell-value")||n,h=l.nextNode();h&&d.contains(h);){var f=h,v=h.nodeValue,g=["<span>"];h=l.nextNode();for(var m=s.lastIndex,p=s.exec(v);p;p=s.exec(v)){var y=v.substring(m,p.index),k=p[1]?" ":"",b=p[2],C=p[3]?" ":"";g.push("".concat(Le.encodeHtml(y)).concat(k,'<span class="').concat(u,'">').concat(b,"</span>").concat(C)),m=s.lastIndex}g.push(Le.encodeHtml(v.substring(m)),"</span>"),f.parentNode.insertBefore(li.createElementFromTemplate(g.join(""),{fragment:!0}),f),f.remove()}li.createElement({parent:n,className:a.hitCellBadgeCls,text:c})}}},{key:"onBackspace",value:function(e){var t=this;return!!t.find&&(t.find=t.find.substr(0,t.find.length-1),t.search(t.find),!0)}},{key:"clearSearch",value:function(){return!!this.find&&(this.find="",this.search(this.find),!0)}},{key:"showFilterEditor",value:function(){var e=this,t=e.client.features.filter;t&&e.columnId&&e.foundCount&&(e.clear(),t.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}},{key:"onElementKeyPress",value:function(e){var t,n=this,r=n.grid,i=r.focusedCell;if(!e.handled&&!n.disabled&&null!=i&&i.record&&!i.isActionable&&1===(null===(t=e.key)||void 0===t?void 0:t.length)){var a=r.columns.getById(r._focusedCell.columnId);a&&!1!==a.searchable&&(n.columnId=r._focusedCell.columnId,n.find+=e.key,n.search(n.find))}}},{key:"onCellNavigate",value:function(e,t,n){var r=this;!r.find||n&&n.columnId===r.columnId||r.clear()}}],[{key:"pluginConfig",get:function(){return{chain:["onElementKeyPress","onCellNavigate"]}}},{key:"properties",get:function(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}}])}(wc);S(lw,"$name","QuickFind"),S(lw,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}}),lw._$name="QuickFind",Ug.registerFeature(lw);var sw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateShowSplitterButtons",value:function(e){this.client.element.classList.toggle("b-hide-splitter-buttons",!e)}},{key:"onElementDblClick",value:function(e){var t=this,n=t.client,r=e.target.closest(".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;var i=r.dataset.region,a=n.getSubGrid(i);a.collapsed||(i=n.getLastRegions()[1],a=n.getSubGrid(i)),a.expand().then((function(){return t.expanding=!1}))}}},{key:"startMove",value:function(e,t){var n=this,r=t.clientX,i=n.client,a=e.dataset.region,o=i.element,l=i.regions[i.regions.indexOf(a)+1],s=i.getSubGrid(l),u=i.getSubGrid(a);if(!e.classList.contains("b-grid-splitter-collapsed")){var c=u,d=1;null!=c.flex&&null==s.flex&&(c=s,d=-1),i.rtl&&(d*=-1);var h=Object.values(i.subGrids).reduce((function(e,t){return t.width+e}),0);i.trigger("splitterDragStart",{subGrid:c,domEvent:t}),n.dragContext={element:e,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:u,originalWidth:c.element.offsetWidth,originalX:r,minWidth:c.minWidth||0,maxWidth:Math.min(h,c.maxWidth||h),flip:d},o.classList.add("b-moving-splitter"),u.toggleSplitterCls("b-moving"),n.pointerDetacher=fr.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:n})}}},{key:"endMove",value:function(e){var t=this,n=t.dragContext,r=t.client;if(n){var i=n.subGrid;e.preventDefault(),t.pointerDetacher(),r.element.classList.remove("b-moving-splitter"),n.splitterSubGrid.toggleSplitterCls("b-moving",!1),t.dragContext=null,r.trigger("splitterDragEnd",{subGrid:i,domEvent:e})}}},{key:"onCollapseClick",value:function(e,t,n){var r=this,i=r.client,a=t.dataset.region,o=i.getLastRegions();if(!1!==i.trigger("splitterCollapseClick",{subGrid:e,domEvent:n})){if(o[0]===a){var l=i.getSubGrid(o[1]);if(l.collapsed)return void l.expand(r.animateCollapseExpand)}e.collapse(r.animateCollapseExpand)}}},{key:"onExpandClick",value:function(e,t,n){var r=this,i=r.client,a=t.dataset.region,o=i.getLastRegions();if(!1!==i.trigger("splitterExpandClick",{subGrid:e,domEvent:n})){if(o[0]===a)if(!e.collapsed)return void i.getSubGrid(o[1]).collapse(r.animateCollapseExpand);e.expand(r.animateCollapseExpand)}}},{key:"updateMove",value:function(e){var t=this.dragContext;if(t){var n=e-t.originalX,r=Math.max(Math.min(t.maxWidth,t.originalWidth+n*t.flip),0);t.subGrid.width=Math.max(r,t.minWidth)}}},{key:"onElementPointerDown",value:function(e){var t,n,r=this,i=e.target,a=0===e.button&&i.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),o=a&&r.client.getSubGrid(a.dataset.region);a&&(i.closest(".b-grid-splitter-button-collapse")?r.onCollapseClick(o,a,e):i.closest(".b-grid-splitter-button-expand")?r.onExpandClick(o,a,e):r.enableDragging&&(r.startMove(a,e),n=a)),("touch"===e.pointerType||null!==(t=r.touchedSplitter)&&void 0!==t&&t.classList.contains("b-touching"))&&r.toggleTouchSplitter(n)}},{key:"onPointerMove",value:function(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}},{key:"onElementTouchMove",value:function(e){this.dragContext&&e.preventDefault()}},{key:"onPointerUp",value:function(e){this.enableDragging&&this.endMove(e)}},{key:"onSubGridCollapse",value:function(e){var t=e.subGrid,n=this.client.resolveSplitter(t);this.client.getLastRegions()[1]===t.region&&n.classList.add("b-grid-splitter-allow-collapse")}},{key:"onSubGridExpand",value:function(e){var t=e.subGrid;this.client.resolveSplitter(t).classList.remove("b-grid-splitter-allow-collapse")}},{key:"toggleTouchSplitter",value:function(e){var t=this,n=t.touchedSplitter;e&&n&&e.dataset.region!==n.dataset.region&&t.toggleTouchSplitter();var r=t.client.getSubGrid(e?e.dataset.region:null==n?void 0:n.dataset.region);r&&(r.toggleSplitterCls("b-touching",Boolean(e)),e?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),t.touchedSplitter=e}},{key:"render",value:function(){var e=this.client,t=e.regions,n=e.subGrids;if(2===t.length){var r=n[t[0]];r.maxWidth&&r.width>=r.maxWidth&&r.splitterElement.classList.add("b-left-only")}else t.length>2&&(n[t[0]].splitterElement.classList.add("b-left-only"),n[t[1]].splitterElement.classList.add("b-right-only"))}},{key:"updateEnableDragging",value:function(e){this.client.element.classList.toggle("b-grid-splitter-no-drag",!e)}}],[{key:"pluginConfig",get:function(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}}])}(wc);S(sw,"$name","RegionResize"),S(sw,"configurable",{showSplitterButtons:!0,animateCollapseExpand:!0,enableDragging:!0}),sw.featureClass="b-split",sw._$name="RegionResize",Ug.registerFeature(sw);var uw=function(e){return e instanceof KeyboardEvent||"keydown"===(null==e?void 0:e.type)&&(null==e?void 0:e.target)},cw=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"entityName","row"),e}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}},{key:"onBeforeRenderRow",value:function(e){var t,n=e.row,r=e.record;n.cls["b-cut-row"]=this.isCut&&(null===(t=this.cutData)||void 0===t?void 0:t.includes(r))}},{key:"isActionAvailable",value:function(e){var n,r=e.actionName,i=e.event;if(!B(t,"isActionAvailable",this,3)(arguments))return!1;var a=this.grid,o=i.target;return("cut"!==r&&"paste"!==r||!a.isLockedRows)&&(("paste"===r||(null===(n=a.selectedRecords)||void 0===n?void 0:n.length)>0)&&(!o||Boolean(o.closest(".b-grid-body-container"))))}},{key:"copy",value:(s=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyRows(!1,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"cut",value:(l=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyRows(!0,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"paste",value:function(e){var t;return uw(e)&&(e=this.client.getRecordFromElement(e.target)),this.pasteRows(null!==(t=e)&&void 0!==t&&t.isModel?e:null)}},{key:"copyRows",value:(o=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=arguments.length>1?arguments[1]:i;return L().mark((function r(){var a,o,l,s,u,c,d,h,f;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=(a=e).client,l=a.entityName,s=o.selectionMode,a.cutOnly&&(t=!0),u=a.selectedRecords.filter((function(e){return!e.readOnly||!t})),n&&(c=n,uw(n)&&(c=null!==(d=null===(h=o.resolveRowRecord)||void 0===h?void 0:h.call(o,n.target))&&void 0!==d?d:o.getRecordFromElement(n.target)),s.multiSelect&&s.cell&&!o.features.cellCopyPaste||o.isSelected(c)||(u=[c])),r.next=6,a.writeToClipboard(u,t);case 6:if((f=r.sent)!==i){r.next=9;break}return r.abrupt("return");case 9:o.trigger("copy",{records:f.data,originalRecords:u,isCut:t,entityName:l}),a.monitorCellCopyPaste();case 11:case"end":return r.stop()}}),r)}))()})),function(){return o.apply(this,arguments)})},{key:"setIsCut",value:function(e,t){var n;null===(n=this.grid.rowManager.getRowById(e))||void 0===n||n.toggleCls("b-cut-row",t),e.meta.isCut=t}},{key:"handleCutData",value:function(e){var t;e.source!==this&&null!==(t=this.cutData)&&void 0!==t&&t.length&&this.grid.store.remove(this.cutData)}},{key:"monitorCellCopyPaste",value:function(){var e=this,t=e.client.features.cellCopyPaste;t&&!e._cellCopyPasteListener&&(e._cellCopyPasteListener=e.client.ion({beforePaste:function(n){var r=n.entityName,i=n.text,a=n.targetCell;if(r===t.entityName&&e.compareClipboardText(e.clipboardText,i))return e.paste(a.record),!1},thisObj:e}))}},{key:"stringConverter",value:function(e){var t=this.grid.rowManager,n=this.columnTypesToIgnore,r=e.flatMap((function(e){var n;return null===(n=t.getRowById(e))||void 0===n?void 0:n.cells.map((function(e){return new cg(e)}))}));return this.cellsToString(r.filter((function(e){var t;return e&&!n.includes(null===(t=e.column)||void 0===t?void 0:t.type)})))}},{key:"cloneData",value:function(e){var t,n=e.data,r=e.isPaste;return null!==(t=n)&&void 0!==t&&t.length&&!this.cutOnly&&(this.sortByIndex(n),n=this.extractParents(z(n),{},r)),n}},{key:"beforeCopy",value:(a=f((function(e){var t=this,n=e.data,r=e.isCut;return L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.client.trigger("beforeCopy",{records:n,isCut:r,entityName:t.entityName});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"pasteRows",value:(r=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(i=this).client,o=i.entityName,l=t||a.selectedRecord,s=a.store.tree,!a.readOnly&&!a.isTreeGrouped){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,i.readFromClipboard({referenceRecord:l},!0);case 5:if(u=e.sent,c=null==u?void 0:u.isCut,d=null==u?void 0:u.data,u&&Array.isArray(d)&&null!==(n=d)&&void 0!==n&&n.length&&!(s&&c&&d.some((function(e){return e.contains(l,!0)})))){e.next=10;break}return e.abrupt("return",[]);case 10:return c&&s&&(d=i.extractParents(d,{})),e.next=13,i.insertCopiedRecords(d,l);case 13:if(!a.isDestroying){e.next=15;break}return e.abrupt("return");case 15:if(!c){e.next=20;break}return e.next=18,i.clearClipboard();case 18:e.next=21;break;case 20:a.selectedRecords=d;case 21:return a.trigger("paste",{records:d,originalRecords:u.originalData,referenceRecord:l,isCut:c,entityName:o}),i.clipboard.triggerPaste(i),null===(r=a.getRowFor(d[d.length-1]))||void 0===r||null===(r=r.cells)||void 0===r||null===(r=r[0])||void 0===r||r.focus(),e.abrupt("return",d);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"beforePaste",value:(n=f((function(e){var t=this,n=e.referenceRecord,r=e.data,i=e.originalData,a=e.text,o=e.isCut;return L().mark((function e(){var l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=r!==a?r:[],e.next=3,t.client.trigger("beforePaste",{records:l,referenceRecord:n,isCut:o,entityName:t.entityName,data:r,originalRecords:i});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"stringParser",value:function(e){return this.setFromStringData(e,!0).modifiedRecords}},{key:"insertCopiedRecords",value:function(e,t){var n=this.client.store.$master,r=t?n.indexOf(t)+1:n.count;return n.isTree?((null==t?void 0:t.parent)||n.rootNode).insertChild(e,null==t?void 0:t.nextSibling,!1,{orderedBeforeNode:null==t?void 0:t.nextOrderedSibling}):n.insert(r,e)}},{key:"selectedRecords",get:function(){var e=z(this.client.selectedRecords);return this.client.selectedCells.forEach((function(t){e.includes(t.record)||e.push(t.record)})),e}},{key:"getMenuItemText",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n[e+"RecordText"];return t&&(r+=" (".concat(n.selectedRecords.length>1?n.rowSpecifierTextPlural:n.rowSpecifierText,")")),r}},{key:"populateCellMenu",value:function(e){var t,n=e.record,r=e.items,i=e.cellSelector,a=this,o=a.client,l=a.rowOptionsOnCellContextMenu,s=!0===(null===(t=o.features.cellCopyPaste)||void 0===t?void 0:t.enabled),u=s&&o.isCellSelected(i);o.isTreeGrouped||!1!==(null==n?void 0:n.isSpecialRow)||!(s?o.selectedRows.length:o.selectedRecords.length)||u&&!a.rowOptionsOnCellContextMenu||(a.copyOnly||(r.cut={text:a.getMenuItemText("cut",u&&l),localeClass:a,icon:"b-icon b-icon-cut",weight:135,disabled:n.readOnly||o.isLockedRows||o.readOnly,onItem:function(){return a.cut(n)}},r.paste={text:a.getMenuItemText("paste",u&&l),localeClass:a,icon:"b-icon b-icon-paste",weight:140,onItem:function(){return a.paste(n)},disabled:o.readOnly||!1===a.hasClipboardData()||o.isLockedRows}),a.cutOnly||(r.copy={text:a.getMenuItemText("copy",u&&l),localeClass:a,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:function(){return a.copy(n)}}))}},{key:"sortByIndex",value:function(e){var t=this.client.store;return e.sort((function(n,r){var i=n.indexPath,a=r.indexPath;if(!e.includes(n.parent)&&!e.includes(r.parent))return t.indexOf(n)-t.indexOf(r);if(i.length===a.length){for(var o=0;o<i.length;o++){if(i[o]<a[o])return-1;if(i[o]>a[o])return 1}return 0}return i.length-a.length}))}},{key:"extractParents",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=this,a=r.client.store;a.tree&&e.forEach((function(t){t.traverse((function(t){var n=t.getTopParent(!0);e.includes(t)||r.isCut&&e.some((function(e){return n.includes(e)}))||e.push(t)}))}));var o=e.reduce((function(e,i){var o,l=i.parentId||i.meta.modified;return r.isCut?(o=i).meta.isCut=!1:(o=i.copy(),n&&(o[r.nameField]=r.generateNewName(o,i)),o.data.expanded=i.isExpanded(r.client.store)),t[i.id]=o,i.parent===a.rootNode?e.push(o):l in t?t[l].appendChild(o,!0):e.push(o),e}),[]);return o.forEach((function(e){e.sortOrderedChildren(!0,!0)})),o}}],[{key:"pluginConfig",get:function(){return{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}}}]);var n,r,a,o,l,s}(pC);S(cw,"$name","RowCopyPaste"),S(cw,"type","rowCopyPaste"),S(cw,"configurable",{nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1,cutOnly:null,allowedDataSources:["RowCopyPaste"],columnTypesToIgnore:["rownumber","sequenceNumber"]}),cw.featureClass="b-row-copypaste",cw._$name="RowCopyPaste",Ug.registerFeature(cw,!0,"Grid"),Ug.registerFeature(cw,!1,"Gantt"),Ug.registerFeature(cw,!1,"SchedulerPro"),Ug.registerFeature(cw,!1,"ResourceHistogram");var dw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",remove:"onStoreRemove",thisObj:this})}},{key:"changeTitleField",value:function(e){var t=this;"string"==typeof e&&(this.titleRenderer=function(n){return t.L("L{Object.editing}",Le.encodeHtml(n[e]))})}},{key:"getEditingContext",value:function(e){if(!(e=e.target?new cg(e.target):this.grid.normalizeCellContext(e)).record.isSpecialRow)return e}},{key:"startEditing",value:(o=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{id:this.grid.firstVisibleRow.id},n=arguments.length>1?arguments[1]:i;return L().mark((function r(){var i,a,o,l,s,u,c,d;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.isEditing){r.next=4;break}if(!1!==e.cancelEditing(!0)){r.next=3;break}return r.abrupt("return",!1);case 3:null===(i=e.editorContext)||void 0===i||null===(i=i.row)||void 0===i||i.removeCls("b-editing");case 4:if(!(t=e.editorContext=e.getEditingContext(t))){r.next=23;break}if(l=(o=e).grid,s=o.editor||(o.editor=o._editorConfig)&&o.editor,u=s.bbar.widgetMap.cancel,t.editor=s,s.title=o.callback(o.titleRenderer,o,[t.record]),s.record=t.record,s.rowEditorContext=t,s.readOnly=l.readOnly||s.record.readOnly,u&&(u.text=o.L(s.readOnly?"L{close}":"L{cancel}")),!1!==l.trigger("beforeStartRowEdit",{grid:l,editorContext:t})){r.next=15;break}return r.abrupt("return",!1);case 15:return o.revertButton&&(s.bbar.widgetMap.revert.hidden=!o.editorContext.record.isModified),r.next=18,s.collapsible.toggleReveal(!0);case 18:c=s.widgetMap[null===(a=t.column)||void 0===a?void 0:a.field],d=c&&(n||o.focusContextualField)?c:s,n&&!s.readOnly&&(null==c||c.clear()),d.focus(),t.row.addCls("b-editing"),l.trigger("startRowEdit",{grid:l,editorContext:t});case 23:case"end":return r.stop()}}),r)}))()})),function(){return o.apply(this,arguments)})},{key:"onEditorStart",value:function(){"cellclick"!==this.triggerEvent&&(this.detachListeners("cellClickWhileEditing"),this.grid.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:this}))}},{key:"syncEditingReadOnly",value:function(e){var t=e.readOnly;if(this.isEditing){var n=this.editor,r=this.editorContext.record,i=n.bbar.widgetMap.cancel;n.readOnly=t||r.readOnly,i&&(i.text=this.L(n.readOnly?"L{close}":"L{cancel}"))}}},{key:"onEditorHide",value:function(){var e;null===(e=this.editorContext)||void 0===e||null===(e=e.row)||void 0===e||e.removeCls("b-editing"),this.detachListeners("cellClickWhileEditing"),this.editorContext=this.editor.record=null}},{key:"finishEditing",value:(a=f(L().mark((function e(){var t,n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,n=this.grid,r=this.editor,i=this.editorContext,!r.isValid){e.next=18;break}if(a=n.trigger("beforeFinishRowEdit",i),!Be.isPromise(a)){e.next=9;break}return t.finishEditingPromise=a,e.next=7,a;case 7:a=e.sent,t.finishEditingPromise=null;case 9:if(!1!==a){e.next=12;break}return r.focus(),e.abrupt("return",!1);case 12:return r.collapsible.toggleReveal(!1),t.updateRecordFromFields(),n.trigger("finishRowEdit",i),e.abrupt("return",!0);case 18:return null===(o=r.items.find((function(e){return!e.isValid})))||void 0===o||o.focus(),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"cancelEditing",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.editor;if(!1===t.grid.trigger("beforeCancelRowEdit",t.editorContext))return n.focus(),!1;!0!==e&&(t.instantUpdate&&(t.isCanceling=!0,n.setValues(n.initialValues),t.updateRecordFromFields(),t.isCanceling=!1),n.collapsible.toggleReveal(!1))}},{key:"onElementClick",value:(r=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.matches(".b-grid-body-container, .b-grid-subgrid")||!this.editorContext){e.next=3;break}return e.next=3,this.finishEditing(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onElementKeyDown",value:(n=f(L().mark((function e(t){var n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).grid,i=r.focusedCell,!(t.handled||!n.autoEdit||n.isEditing||!i||i.isActionable&&li.isEditable(t.target)||t.ctrlKey)){e.next=3;break}return e.abrupt("return");case 3:t.key.length<=1&&n.startEditing(i,!0);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateSide",value:function(){this.editor=null}},{key:"changeEditor",value:function(e,t){if(e){var n,r=this,i=r.grid,a=r.labelWidth,o=uc.mergeConfigs({owner:i,cls:{"b-editor-instant-update":r.instantUpdate},drawer:{side:r.side,size:r.editorSize},autoUpdateRecord:r.instantUpdate,items:r.collectEditorFields(),style:S({},a?"--b-label-width":"",li.setLength(a)),refreshEdit:r.refreshEdit.bind(r)},e);r._editorConfig||(r._editorConfig=e),r.local&&(o.appendTo=i.element),r.revertButton&&(o.bbar.items.revert={text:"L{revert}",onClick:r.revertChanges.bind(r)}),null===(n=e=uc.reconfigure(t,e?o:null,r))||void 0===n||n.ion({thisObj:r,show:"onEditorStart",hide:"onEditorHide"})}else null==t||t.removeAll(),null==t||t.destroy();return e}},{key:"revertChanges",value:function(){var e=this,t=e.editorContext,n=t.editor,r=t.record;e.isCanceling=!0,r.revertChanges(),n.title=e.callback(e.titleRenderer,e,[r]),n.setValues(r,{onlyName:n.strictRecordMapping,highlight:Boolean(n.$highlight)}),e.isCanceling}},{key:"refreshEdit",value:function(){var e=this.editor;e.isVisible&&(this.syncEditingReadOnly({readOnly:this.grid.readOnly}),this.instantUpdate||this.isCanceling||e.setValues(this.editorContext.record,{onlyName:e.strictRecordMapping,highlight:Boolean(e.$highlight)}))}},{key:"updateRecordFromFields",value:function(){var e=this.editor,t=e.record;e.items.forEach((function(n){var r=n.getValueName({onlyName:e.strictRecordMapping});r&&r in t&&t.setValue(r,n.value)}),!0)}},{key:"updateInstantUpdate",value:function(e){var t=this._editor;t&&(t.autoUpdateRecord=e,t.element.classList.toggle("b-editor-instant-update",Boolean(e)))}},{key:"collectEditorFields",value:function(){var e=this,t=0;return this.grid.columns.reduce((function(n,r){var i=r.editor,a=e.grid.store.modelClass;return null!=i&&i.isField&&(i.readOnly=r.readOnly,t=i.weight||(i.weight=t+100),i.label||(i.label=r.text||a.getFieldDefinition(r.field).label),i.revertOnEscape=r.revertOnEscape,n[r.field]=i),n}),{})}}]);var n,r,a,o}(kC);S(dw,"$name","RowEdit"),S(dw,"configurable",{editor:{$config:"lazy",value:{type:"panel",cls:{"b-row-editor":1},drawer:{type:"overlay",autoClose:!1,tool:null},keyMap:{Escape:"up.cancelEditing",Enter:function(e){if(e.target.matches("button"))return!1;this.callback("up.finishEditing")}},bbar:{items:{save:{text:"L{save}",cls:{"b-raised":1},color:"b-blue",onClick:"up.finishEditing"},cancel:{text:"L{cancel}",onClick:"up.cancelEditing"}}},focus:function(){(this.isValid?this.focusableElement:this.items.find((function(e){return!e.isValid})).focusableElement).focus({preventScroll:!0})}}},focusContextualField:!0,instantUpdate:null,editorSize:null,labelWidth:null,local:null,revertButton:null,side:{$config:"lazy",value:"end"},keyMap:{Enter:"startEditing",F2:"startEditing"},titleField:"name",titleRenderer:null}),dw._$name="RowEdit",Ug.registerFeature(dw);var hw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){this.grid=e,e.isGanttBase&&!("dropOnLeaf"in n)&&(n.dropOnLeaf=!0),B(t,"construct",this,3)(arguments)}},{key:"doDestroy",value:function(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"init",value:function(){var e=this,t=e.grid,n=e.allowCrossGridDrag;e.dragHelper=Qi.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!n,allowDropOutside:!0,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),dragWithin:n?t.floatRoot:t.bodyContainer,scrollManager:t.scrollManager,positioning:"inset",monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},setXY:function(e,i,a){var o=this.context;if(!o.started){var l=pt.from(o.element,this.dragWithin),s=o.startPageY-r.pageYOffset-o.element.getBoundingClientRect().top;this._elementHeight=l.height,a=l.top+s+this.proxyTopOffset,this._startScrollY=t.scrollable.y}var u=n?a:Math.min(t.scrollable.element.scrollHeight-this._elementHeight-1,a+t.scrollable.y-this._startScrollY);li.setTopInsetInlineStart(e,u,i)},ignoreSamePositionDrop:!1,createProxy:function(n){var r=document.createElement("div"),i=document.createElement("i");if(r.classList.add("b-row-reorder-proxy"),i.className="b-row-proxy-copy "+e.copyIconCls,r.appendChild(i),t.selectedRecords.slice().sort((function(e,n){return t.store.indexOf(e)-t.store.indexOf(n)})).forEach((function(e){var i,a=null===(i=t.rowManager.getRowFor(e))||void 0===i||null===(i=i.elements[t.regions[0]])||void 0===i?void 0:i.cloneNode(!0);a&&(a.style.transform=a.style.insetInlineStart=a.style.top="",a.style.width=n.offsetWidth+"px",a.removeAttribute("id"),r.appendChild(a))})),t.selectedRecords.length>1){var a=document.createElement("div");a.classList.add("b-badge","b-row-drag-count-indicator"),a.dataset.badge=t.selectedRecords.length,r.appendChild(a)}return li.removeClsGlobally(r,"b-selected","b-hover","b-focused"),r},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onAbort",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),t.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag"],"gridRow",!0),e.dropIndicator=li.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}},{key:"targetSubGridElement",get:function(){var e=this.grid.regions[0];return this.grid.subGrids[e].element}},{key:"beforeRenderCell",value:function(e){e.cellElement;var t=e.column,n=e.record,r=e.cellCls,i=this.grid;r["b-row-reorder-grip"]=this.showGrip&&this.enabled&&!n.isSpecialRow&&t===i.columns.visibleColumns[0]}},{key:"isElementDraggable",value:function(e,t){var n;if(!(null===(n=this.client.features.rowResize)||void 0===n?void 0:n.isEventOverResizeHandle(t))&&!e.closest(".b-grid-cell .b-widget")){if(!this.gripOnly)return!0;var r=e.closest(".b-grid-cell:first-child");if(r){var i=getComputedStyle(r,":before"),a=(this.grid.rtl?r.getBoundingClientRect().width-t.borderOffsetX:t.borderOffsetX)<=parseFloat(i.width);return a&&(this.client.preventDragSelect=!0),a}}}},{key:"onBeforeDragStart",value:function(e){var t=e.event,n=e.source,r=e.context,i=this,a=i.grid,o=i.targetSubGridElement,l=r.startRecord=a.getRecordFromElement(r.element);if(t.target.classList.contains("b-rowexpander-shadowroot-container")||i.disabled||a.readOnly||a.isTreeGrouped&&l.isParent||!o.contains(r.element))return!1;if(l.readOnly||l.isSpecialRow)return!1;r.originalRowTop=a.rowManager.getRowFor(l).top,a.selectionMode.checkboxOnly||("touch"===n.startEvent.pointerType?a.isSelected(l)||a.selectRow({record:l,addToSelection:!1}):a.isSelected(l)||t.shiftKey||t.ctrlKey||a.selectRow({record:l}));var s,u=a.selectedRecords.filter((function(e){return!e.readOnly}));(r.records=[l],u.includes(l))&&((s=r.records).push.apply(s,z(u.filter((function(e){return e!==l})))),r.records.sort((function(e,t){return a.store.indexOf(e)-a.store.indexOf(t)})));return!0}},{key:"onDragStart",value:function(e){var t,n,r=e.context,i=this,a=i.grid,o=a.features,l=o.cellEdit,s=o.cellMenu,u=o.headerMenu;i.targetGrid=a,l&&(i.cellEditDisabledState=l.disabled,l.disabled=!0),null==s||null===(t=s.hideContextMenu)||void 0===t||t.call(s,!1),null==u||null===(n=u.hideContextMenu)||void 0===n||n.call(u,!1);var c=r.element.querySelector(".b-focused");null==c||c.classList.remove("b-focused"),r.element.firstElementChild.classList.remove("b-selected","b-hover")}},{key:"resolveGrid",value:function(e,t){var n=e.target;if(/^touch/.test(e.type)){var r=pt.from(t.element,null,!0).center;n=li.elementFromPoint(r.x,r.y)}return this.client.constructor.fromElement(n,(function(e){return e.isGridBase}))}},{key:"onDrag",value:function(e){var t=e.context,n=e.event,r=this,i=n.clientY,a=r.grid;if(!r.allowCrossGridDrag||(a=r.resolveGrid(n,t),r.targetGrid=a,a)){var o,l,s,u,c,d=a,h=d.store,f=d.rowManager,v=!0,g=f.getRowAt(i);if(g){var m=g.top+a.scrollable.element.getBoundingClientRect().top-a.scrollable.y,p=g.height/4,y=m+p,k=m+g.height/2,b=m+3*p;l=g.dataIndex,o=h.storage.getAt(l),h.isTree?u=(o.isParent||r.dropOnLeaf)&&i>y&&i<b:h.isGrouped&&(u=o.isGroupHeader&&o.meta.collapsed),s=!u&&n.clientY>=k}else n.pageY<a._bodyRectangle.y?(l=0,o=h.first,s=!1):(l=h.count-1,o=h.last,s=!0),g=f.getRow(l);if(o!==r.overRecord||r.after!==s||r.over!==u){var C,w;if(r.overRecord!==o)null===(C=f.getRowById(r.overRecord))||void 0===C||C.removeCls(r.dropOverTargetCls);if(r.overRecord=o,r.after=s,r.over=u,(r.targetGrid.readOnly||o===t.startRecord||!s&&!u&&0===l&&h.isGrouped||s&&o&&o.isGroupHeader&&o.meta.collapsed&&h.indexOf(o)===h.count-1)&&(v=!1),h.isTree?o?(c=s?o.nextSibling:o,t.records.some((function(e){return e.contains(o)}))&&(v=!1),t.parent=v&&u?o:o.parent,r.clearTimeout(r.hoverTimer),o&&o.isParent&&!o.isExpanded(h)&&(r.hoverTimer=r.setTimeout((function(){return a.expand(o)}),r.hoverExpandTimeout))):t.parent=a.store.rootNode:c=s?h.storage.getAt(l+1):o,g)li.setTranslateY(r.dropIndicator,Math.max(g.top+(s?g.element.getBoundingClientRect().height:0),1)),null===(w=g)||void 0===w||w.toggleCls(r.dropOverTargetCls,v&&u);else 0===a.store.count&&li.setTranslateY(r.dropIndicator,0);!u&&l===h.indexOf(t.startRecord)+(s?-1:1)&&t.parent&&t.startRecord.parent===t.parent&&(v=!1),r.dropIndicator.style.visibility=u?"hidden":"visible",r.dropIndicator.classList.toggle("b-drag-invalid",!v),t.insertBefore=c,t.valid=r.reorderValid=v}else t.valid=!0}else t.valid=!1}},{key:"onDrop",value:(i=f(L().mark((function e(t){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).grid,i=n.targetGrid,a=t.context,o=Wn.ctrlKeyDown,a.valid=a.valid&&n.reorderValid,t.source=r,!a.valid){e.next=17;break}return a.async=!0,i.store.isTree&&(a.oldPositionContext=a.records.map((function(e){var t;return{record:e,parentId:null===(t=e.parent)||void 0===t?void 0:t.id,parentIndex:e.parentIndex}}))),e.next=8,r.trigger("gridRowBeforeDropFinalize",t);case 8:if(e.t0=e.sent,!1!==e.t0){e.next=11;break}a.valid=!1;case 11:if(e.t1=n.animateDrop,!e.t1){e.next=15;break}return e.next=15,n.dragHelper.animateProxyTo(n.dropIndicator,{align:"l0-l0"});case 15:return e.next=17,n.finalizeReorder(a,o);case 17:n.clearTimeout(n.hoverTimer),r.trigger("gridRowDrop",t),n.overRecord=n.after=n.over=n.targetGrid=null;case 20:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onAbort",value:function(e){e.source=this.client,this.client.trigger("gridRowDragAbort",e),this.targetGrid=null}},{key:"finalizeReorder",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(i=this).client,o=i.allowCrossGridDrag,l=t.targetGrid||a,s=l.store,u=l.focusedCell,c=t.parent,d=s===a.store,h=null==u?void 0:u.record,f=(null==h||null===(r=h.proxyMeta)||void 0===r?void 0:r.originalRecord)||h,v=t.records,g=t.insertBefore,!o&&t.valid&&(t.valid=!v.some((function(e){return!s.includes(e)}))),!t.valid){e.next=32;break}if(m=i.preserveSorters&&s.isSorted&&s.sorterFn,n&&(v=v.map((function(e){return e.copy()}))),m&&v.sort(m),d||!i.allowCrossGridDrag.transferData){e.next=13;break}return e.next=10,i.allowCrossGridDrag.transferData({sourceGrid:a,targetGrid:l,records:v,insertBefore:g,parent:c});case 10:l.focusCell({grid:l,record:v[0]}),e.next=28;break;case 13:if(!s.isTree){e.next=27;break}if(v=v.filter((function(e){return!e.parent||e.bubbleWhile((function(e){return!v.includes(e)}),!0)})),!l.isTreeGrouped){e.next=19;break}c!==h.parent?c.bubble((function(e){v.forEach((function(t){t[e.field]=e.key}))})):t.valid=!1,e.next=22;break;case 19:return e.next=21,c.tryInsertChild(v,i.over?null===(k=c.children)||void 0===k?void 0:k[0]:g);case 21:p=e.sent;case 22:l.rowManager.forEach((function(e){return e.removeCls(i.dropOverTargetCls)})),!c.isExpanded(s)&&null!==(y=c.children)&&void 0!==y&&y.length&&l.expand(c),t.valid=!1!==p,e.next=28;break;case 27:if(s.isGrouped&&i.over)n?s.insert(s.indexOf(g),v):s.move(v,s.getNext(g));else{if(v.length>1)for(;g&&v.includes(g);)g=s.getNext(g,!1,!0);d?n?s.insert(s.indexOf(g),v):s.move(v,g):(n||a.store.remove(v),s.insert(g?s.indexOf(g):s.count,v))}case 28:(null==u?void 0:u._rowIndex)>=0&&l===a&&(l._focusedCell=null,l.focusCell({grid:a,record:f,columnId:u.columnId})),b=!0,t.valid&&m&&(C=v[0],w=v[v.length-1],D=C.previousSibling,S=w.nextSibling,(!D||m(D,C)<=0)&&(!S||m(w,S)<=0)&&(b=!1)),t.valid&&b&&s.clearSorters();case 32:t.finalize(t.valid),l.element.classList.remove("b-row-reordering");case 34:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onReset",value:function(){var e=this,t=e.targetGrid,n=e.grid,r=n.features.cellEdit;n.element.classList.remove("b-row-reordering"),r&&(r.disabled=e.cellEditDisabledState),li.removeClsGlobally.apply(li,[n.element].concat(z(e.dropOverTargetCls))),n.scrollManager.stopMonitoring(),t&&n!==t&&(t.element.classList.remove("b-row-reordering"),t.scrollManager.stopMonitoring(),li.removeClsGlobally.apply(li,[t.element].concat(z(e.dropOverTargetCls))))}},{key:"onInternalPaint",value:function(e){e.firstPaint,!this._initialized&&this.grid.regions.length>0&&(this._initialized=!0,this.init())}},{key:"updateShowGrip",value:function(e){this.enabled&&this.grid.columns.visibleColumns[0].refreshCells()}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.dragHelper&&(this.dragHelper.disabled=e),this.showGrip&&this.grid.columns.visibleColumns[0].refreshCells()}},{key:"updateTargetGrid",value:function(e,t){t&&(t.element.classList.remove("b-row-reordering"),t.scrollManager.stopMonitoring()),this.dragHelper.isDragging&&(this.dragHelper.context.targetGrid=e),e?(e.element.classList.add("b-row-reordering"),e.bodyContainer.appendChild(this.dropIndicator),e.scrollManager.startMonitoring({scrollables:[{element:e.scrollable.element,direction:"vertical"}]})):this.dropIndicator.remove()}},{key:"isDragging",get:function(){return this.dragHelper.isDragging}}],[{key:"pluginConfig",get:function(){return{chain:["beforeRenderCell","onInternalPaint"]}}}]);var n,i}($i(wc));S(hw,"$name","RowReorder"),S(hw,"configurable",{showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:null,copyIconCls:"b-icon b-icon-add",allowCrossGridDrag:!1,dragHelperConfig:null,preserveSorters:null,animateDrop:!0,targetGrid:null}),hw.featureClass="",hw._$name="RowReorder",Ug.registerFeature(hw,!1);var fw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;B(t,"construct",this,3)(arguments),r.resizer=new sp({name:"rowResize",targetSelector:".b-grid-row:not(.b-group-header)",handleContainerSelector:".b-grid-row",outerElement:e.element,direction:"vertical",dragThreshold:1,handleSize:Math.min(5,.1*e.rowHeight),internalListeners:{beforeresizestart:r.onBeforeResizeStart,resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,cancel:r.onCancel,thisObj:r},allowResize:function(t,n){var i;return null===(i=e.hoveredCell)||void 0===i?void 0:i.matches(r.cellSelector)},overTopHandle:function(e,t){if(this.canResize(t,e)&&"0"!==t.dataset.index){var n=pt.from(t);return n.height=this.handleSize,n.height>0&&Math.abs(n.top-fr.getPagePoint(e).top)<this.handleSize}return!1},internalBeforeStart:function(e){var t=e.edge,n=e.element;if("top"===t)return{edge:"bottom",element:n.previousElementSibling}},onResizeHandlePointerDown:function(t){e.selectionDisabled=!0,e.features.rowReorder&&(r._oldReorderDisabled=e.features.rowReorder.dragHelper.disabled,e.features.rowReorder.dragHelper.disabled=!0),e.setTimeout((function(){e.selectionDisabled=!1}),10)}})}},{key:"doDestroy",value:function(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"onBeforeResizeStart",value:function(){return!this.disabled}},{key:"onResizeStart",value:function(e){var t=e.source,n=e.context,r=this.client,i=this.applyToAllRows||r.fixedRowHeight;n.record=r.store.getById(n.element.dataset.id),n.oldHeight=n.record.rowHeight,r.store.suspendAutoCommit(),Object.assign(t,{minHeight:this.minHeight,maxHeight:this.maxHeight,skipUpdatingElement:!i}),r.element.classList.add("b-row-resizing")}},{key:"onResizing",value:function(e){var t=e.context;this.applyToAllRows||this.client.fixedRowHeight||!t.valid||(t.record.rowHeight=t.newHeight)}},{key:"onResize",value:function(e){var t=e.context,n=this.client;this.applyToAllRows||n.fixedRowHeight?n.rowHeight=t.newHeight:n.selectionMode.multiSelect&&n.selectedRecords.includes(t.record)&&n.selectedRecords.forEach((function(e){return e.rowHeight=t.newHeight})),this.cleanup()}},{key:"onCancel",value:function(e){var t=e.context;this.applyToAllRows||this.client.fixedRowHeight||(t.record.rowHeight=t.oldHeight),this.cleanup()}},{key:"cleanup",value:function(){var e=this.client;e.element.classList.remove("b-row-resizing"),e.store.resumeAutoCommit(),"boolean"==typeof this._oldReorderDisabled&&(e.features.rowReorder.dragHelper.disabled=this._oldReorderDisabled)}},{key:"isEventOverResizeHandle",value:function(e){return this.enabled&&this.resizer.checkResizeHandles(e)}}])}(wc);S(fw,"$name","RowResize"),S(fw,"configurable",{applyToAllRows:null,cellSelector:".b-grid-cell",minHeight:20,maxHeight:0}),fw._$name="RowResize",Ug.registerFeature(fw,!1);var vw={goToNextHit:1,goToPrevHit:1},gw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),Object.assign(this,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,li.NodeFilter.SHOW_TEXT,(function(){return li.NodeFilter.FILTER_ACCEPT}))}),e.ion({expandNode:"onTreeNodeExpand",thisObj:this})}},{key:"isActionAvailable",value:function(e){var t=e.actionName;if(vw[t])return Boolean(this.text)}},{key:"onTreeNodeExpand",value:function(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0,i,i,!1])}},{key:"doDestroy",value:function(){this.clear(!0),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){e&&this.clear(),B(t,"doDisable",this,3)([e])}},{key:"store",get:function(){return this.grid.store}},{key:"search",value:(n=f((function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=arguments.length>3?arguments[3]:i,o=arguments.length>4&&arguments[4]!==i&&arguments[4],l=arguments.length>5&&arguments[5]!==i?arguments[5]:this.client.store.isTree;return L().mark((function i(s){var u,c,d,h,f,v,g,m,p,y,k,b,C,w,x,E,R,T,M;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(u=t,e){i.next=3;break}return i.abrupt("return",u.clear());case 3:if((r||e!==u.text)&&!u.disabled){i.next=5;break}return i.abrupt("return");case 5:if(c=u.grid,d=u.store,h=c.columns.visibleColumns.filter((function(e){return!1!==e.searchable})),f=[],a=a||h.map((function(e){var t;return f.push(null===(t=e.formatValue)||void 0===t?void 0:t.bind(e)),e.field})),v=d.search(e,a,f),!l||!v.length){i.next=11;break}return i.next=11,c.expandTo(v.map((function(e){return e.id})));case 11:g=D(h);try{for(g.s();!(m=g.n()).done;)if((p=m.value).mergeCells&&p.isSorted){y=null,k=null,b=D(v);try{for(b.s();!(C=b.n()).done;)(w=C.value).field===p.field&&((x=w.data[w.field])===y&&(w.belongsTo=k),y=x,k="".concat(w.field,"-").concat(w.id))}catch(e){b.e(e)}finally{b.f()}}}catch(e){g.e(e)}finally{g.f()}if(E=1,Object.assign(u,{foundMap:{},prevFound:u.found,found:v,text:e,findRe:new RegExp("(\\s+)?(".concat(Le.escapeRegExp(String(e)),")(\\s+)?"),"ig")}),u.clearHits(),v){i.next=18;break}return i.abrupt("return");case 18:R=D(v),i.prev=19,R.s();case 21:if((T=R.n()).done){i.next=28;break}if(M=T.value,u.foundMap["".concat(M.field,"-").concat(M.id)]=M.belongsTo?u.foundMap[M.belongsTo]:E++,!(E>u.limit)){i.next=26;break}return i.abrupt("break",28);case 26:i.next=21;break;case 28:i.next=33;break;case 30:i.prev=30,i.t0=i.catch(19),R.e(i.t0);case 33:return i.prev=33,R.f(),i.finish(33);case 36:return u.listenersInitialized||(c.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:u}),d.ion(S(S({name:"storeRefresh"},"refresh".concat(c.asyncEventSuffix),"onStoreRefresh"),"thisObj",u)),u.listenersInitialized=!0),c.refreshRows(),c.trigger("search",{grid:c,find:e,found:v}),!n||u.isHitFocused||o||u.gotoNextHit(!0),null===(s=c.syncSplits)||void 0===s||s.call(c,(function(t){return t.features.search.search(e,n,r,a,!0)})),i.abrupt("return",v);case 42:case"end":return i.stop()}}),i,null,[[19,30,33,36]])}))()})),function(e){return n.apply(this,arguments)})},{key:"clearHits",value:function(){if(!this.isDestroying){var e,t=D(li.children(this.grid.element,"."+this.hitCls));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.classList.remove(this.hitCls,this.hitCellCls);var r=wa.get(n).row;r&&(r.forceInnerHTML=!0,r.renderCell(n),r.forceInnerHTML=!1)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"clear",value:function(){var e,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=this,r=n.grid;(n.foundMap&&delete n.foundMap,n.text=null,n.clearHits(),n.listenersInitialized&&(n.detachListeners("renderCell"),n.detachListeners("storeRefresh"),n.listenersInitialized=!1),t)||(r.trigger("clearSearch",{grid:r}),null===(e=r.syncSplits)||void 0===e||e.call(r,(function(e){return e.features.search.clear()})))}},{key:"foundCount",get:function(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}},{key:"isHitFocused",get:function(){var e,t=this.grid,n=t.focusedCell;if(null!=n&&null!==(e=n.cell)&&void 0!==e&&e.contains(li.getActiveElement(t.element))){var r=n.rowIndex,i=n.column;return-1!==r&&this.found.some((function(e){return e.index===r&&i&&e.field===i.field}))}}},{key:"gotoNextHit",value:function(){var e,t=arguments.length>0&&arguments[0]!==i&&arguments[0],n=this;if(null!==(e=n.found)&&void 0!==e&&e.length){var r=n.grid,a=n.store,o=r.focusedCell||r.lastFocusedCell,l=o&&!0!==t?a.indexOf(o.record,i,!0):-1,s=n.found.findIndex((function(e){return e.index>l}));-1!==s&&n.gotoHit(s)}}},{key:"gotoPrevHit",value:function(){var e,t=this,n=t.store;if(null!==(e=t.found)&&void 0!==e&&e.length)for(var r=t.grid,a=t.found,o=r.focusedCell||r.lastFocusedCell,l=o?n.indexOf(o.record,i,!0):0,s=a.length-1;s--;s>=0){if(a[s].index<l){t.gotoHit(s);break}}}},{key:"gotoHit",value:function(e){var t=this.grid,n=this.found[e];return n&&t.focusCell({field:n.field,id:n.id}),Boolean(n)}},{key:"gotoFirstHit",value:function(){this.gotoHit(0)}},{key:"gotoLastHit",value:function(){this.gotoHit(this.found.length-1)}},{key:"renderCell",value:function(e){var t,n=e.cellElement,r=e.column,i=e.record,a=e.value,o=this,l=o.treeWalker,s=o.findRe,u=o.hitTextCls,c=o.showHitIndex,d=null===(t=o.foundMap)||void 0===t?void 0:t[r.field+"-"+i.id];if(d){var h;n.classList.add(o.hitCls),c&&(null===(h=n.querySelector(".".concat(o.hitCellBadgeCls)))||void 0===h||h.remove());var f=li.down(n,".b-grid-cell-value,.b-tree-cell-value")||n;if(String(a).toLowerCase()===String(o.text).toLowerCase())f.innerHTML='<span class="'.concat(o.hitTextCls,'">').concat(f.innerHTML,"</span>").concat(c?'<div class="'.concat(o.hitCellBadgeCls,'">').concat(d,"</div>"):"");else{l.currentNode=f;for(var v=l.nextNode();v&&f.contains(v);){var g=v,m=v.nodeValue,p=["<span>"];v=l.nextNode();for(var y=s.lastIndex,k=s.exec(m);k;k=s.exec(m)){var b=m.substring(y,k.index),C=k[1]?" ":"",w=k[2],D=k[3]?" ":"";p.push("".concat(Le.encodeHtml(b)).concat(C,'<span class="').concat(u,'">').concat(Le.encodeHtml(w),"</span>").concat(D)),y=s.lastIndex}p.push(Le.encodeHtml(m.substring(y)),"<span>"),g.parentNode.insertBefore(li.createElementFromTemplate(p.join(""),{fragment:!0}),g),g.remove()}c&&li.createElement({parent:n,className:o.hitCellBadgeCls,text:d})}o.hitEls.push(n)}}},{key:"populateCellMenu",value:function(e){var t=e.column;e.record;var n=e.items,i=e.cellElement,a=this;t.searchable&&(n.search={text:"L{searchForValue}",localeClass:a,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:a.disabled,onItem:function(){var e=r.getSelection().toString();e||(e=i.innerText),a.search(e)}})}},{key:"onStoreRefresh",value:function(){this.search(this.text,!1,!0)}}],[{key:"properties",get:function(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}},{key:"pluginConfig",get:function(){return{chain:["populateCellMenu"]}}}]);var n}($i(wc));S(gw,"$name","Search"),S(gw,"configurable",{limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}),gw.featureClass="b-search",gw._$name="Search",Ug.registerFeature(gw);var mw=Object.freeze([]),pw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){n=this.processConfig(n),B(t,"construct",this,3)([e,n]),this.bindStore(this.store)}},{key:"processConfig",value:function(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}},{key:"setConfig",value:function(e){B(t,"setConfig",this,3)([this.processConfig(e)])}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this}),this.client.isPainted&&this.syncHeaderSortState()}},{key:"field",set:function(e){var t,n=this.client.columns.get(e);n&&"object"===W(n.sortable)&&(n.sortable.field=n.sortable.property||e,e=n.sortable),null!==(t=this.store.sorters)&&void 0!==t&&t.some((function(t){return t.field===e}))||this.store.sort(e,this.ascending)}},{key:"store",get:function(){return this.client[this.client.sortFeatureStore]}},{key:"syncHeaderSortState",value:function(){var e=this,t=e.client;if(!t.hideHeaders&&t.isPainted){var n,r,i,a=null!==(n=e.store.sorters)&&void 0!==n?n:mw,o=a.length,l=new Ct,s=D(t.columns.visibleColumns);try{var u=function(){var t=i.value;if(!t.sortable)return 1;var n,s=t.element,u=t.textWrapper,c=null==u?void 0:u.dataset,d="none";((null==c?void 0:c.sortIndex)&&delete c.sortIndex,l.value=s.classList,!1===t.sortable)?(l.remove(e.sortableCls),null==u||null===(n=u.querySelector(".b-sort-icon"))||void 0===n||n.remove()):(null!=u&&u.querySelector(".b-sort-icon")||li.createElement({tag:"i",parent:u,className:"b-icon b-sort-icon"}),l.add(e.sortableCls),(r=a.find((function(e){return e.field===t.field||e.sortFn&&e.sortFn===t.sortable.sortFn})))?(o>1&&c&&(c.sortIndex=a.indexOf(r)+1),l.add(e.sortedCls),r.ascending?(l.add(e.sortedAscCls),l.remove(e.sortedDescCls),d="ascending"):(l.add(e.sortedDescCls),l.remove(e.sortedAscCls),d="descending")):(l.remove(e.sortedCls),l["b-group"]||(l.remove(e.sortedAscCls),l.remove(e.sortedDescCls))));li.syncClassList(s,l),li.setAttributes(s,{"aria-sort":d})};for(s.s();!(i=s.n()).done;)u()}catch(e){s.e(e)}finally{s.f()}}}},{key:"updateShowIconOnColumnHover",value:function(e){this.client.element.classList.toggle("b-sort-hover-icon",Boolean(e))}},{key:"populateHeaderMenu",value:function(e){var t,n=e.column,r=e.items,i=this,a=i.store,o=F(F({},n.sortable),{},{field:n.field,columnOwned:!0}),l=null===(t=a.groupers)||void 0===t?void 0:t.find((function(e){return e.field===n.field}));if(!1!==n.sortable&&(r.sortAsc={text:"L{sortAscending}",localeClass:i,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:l||i.disabled,onItem:function(){return a.sort(o,!0)}},r.sortDesc={text:"L{sortDescending}",localeClass:i,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:l||i.disabled,onItem:function(){return a.sort(o,!1)}},i.multiSort&&i.client.columns.records.some((function(e){return e.sortable})))){var s=a.sorters.find((function(e){return e.field===n.field||n.sortable.sortFn&&n.sortable.sortFn===e.sortFn}));r.multiSort={text:"L{multiSort}",localeClass:i,icon:"b-fw-icon b-icon-sort",weight:320,disabled:l||i.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:i,icon:"b-fw-icon b-icon-sort-asc",disabled:s&&(null==s?void 0:s.ascending),weight:330,onItem:function(){return a.addSorter(o,!0)}},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:i,icon:"b-fw-icon b-icon-sort-desc",disabled:s&&!s.ascending,weight:340,onItem:function(){return a.addSorter(o,!1)}},removeSorter:{text:"L{removeSorter}",localeClass:i,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!s,onItem:function(){a.removeSorter(o.field)}}}}}}},{key:"getColumnDragToolbarItems",value:function(e,t){var n=this,r=n.store,i=n.disabled;if(!1!==e.sortable){var a=r.sorters.find((function(t){return t.field===e.field}));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:function(e){var t=e.column;return r.sort(t.field,!0)}},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:i,onDrop:function(e){var t=e.column;return r.sort(t.field,!1)}},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:i||a&&a.ascending,weight:105,onDrop:function(e){var t=e.column;return r.addSorter(t.field,!0)}},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:i||a&&!a.ascending,weight:105,onDrop:function(e){var t=e.column;return r.addSorter(t.field,!1)}},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:i||!a,onDrop:function(e){var t=e.column;return r.removeSorter(t.field)}})}return t}},{key:"onStoreBeforeSort",value:function(e){for(var t=e.sorters,n=this.client.columns,r=0;r<t.length;r++){var i,a=t[r],o=(a.columnOwned||this.prioritizeColumns)&&n.get(a.field);null!=o&&null!==(i=o.sortable)&&void 0!==i&&i.sortFn&&(t[r]=F(F(F({},a),o.sortable),{},{columnOwned:!0}))}}},{key:"onElementClick",value:function(e){var t=this,n=t.store,r=e.target,i=r.closest(".b-grid-header.b-sortable"),a=null==i?void 0:i.dataset.column;if(!(t.ignoreRe.test(r.className)||r.closest(".b-grid-headerwidget")||t.disabled||e.handled)&&i&&a&&(t.toggleOnHeaderClick||r.closest(".b-sort-icon"))){var o=t.client.columns.getById(i.dataset.columnId);if(n.isGrouped&&n.groupers.find((function(e){return e.field===a}))&&!e.shiftKey)return;if(o.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)n.removeSorter(o.field);else{var l={columnOwned:!0,field:o.field};"object"===W(o.sortable)&&Be.assign(l,o.sortable),n.sort(l,null,e.ctrlKey&&t.multiSort)}}}},{key:"renderHeader",value:function(){this.syncHeaderSortState()}},{key:"onInternalPaint",value:function(){this.syncHeaderSortState()}}],[{key:"properties",get:function(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon","b-widget"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}},{key:"pluginConfig",get:function(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onInternalPaint","bindStore"]}}}])}(wc);S(pw,"$name","Sort"),S(pw,"configurable",{multiSort:!0,prioritizeColumns:!1,showIconOnColumnHover:!0,toggleOnHeaderClick:!0}),pw.featureClass="b-sort",pw._$name="Sort",Ug.registerFeature(pw,!0);var yw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,li.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses=S({"b-focused":!1,"b-hover":!1,"b-selected":!1},this.currentTopRowCls,!1)}},{key:"renderRows",value:function(){this.element.classList.add("b-hide-visibility")}},{key:"onGridScroll",value:function(){var e=this,t=e.client,n=e.element,r=e.contentElement,i=pt.client(t.bodyContainer).roundPx(),a=t.rowManager.getRowAt(i.y),o=a!==e.currentTopRow;if(a){o&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=a,a.addCls(e.currentTopRowCls),r.innerHTML="",r.appendChild(e.updateStickyContent()));var l=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[l?"add":"remove"]("b-hide-visibility"),e.currentTopRow[l?"addCls":"removeCls"]("b-not-enough-height"),i.y+=e.stickyContentTop,li.alignTo(n,e.stickyEls[0],{align:"t0-t0",constrainTo:i},!0)}e.lastProcessedTopRow=a}},{key:"updateStickyContent",value:function(){var e=this,t=e.currentTopRow,n=e.removeClasses,r={"b-grid-sticky-row":1},i={},a=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),o=e.stickyEls||(e.stickyEls=[]);for(o.forEach((function(e){e.classList.remove("b-sticky-content-el")})),o.length=0,t.eachElement((function(t){o.push.apply(o,z(t.querySelectorAll(e.contentSelector)))}));a.firstChild;)a.remove(a.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,o.map((function(t){t.closest(".b-grid-cell").classList.forEach((function(e){return i[e]=1})),t.closest(".b-grid-row").classList.forEach((function(e){return r[e]=1})),Object.assign(i,n),Object.assign(r,n);var o=t.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,o),t.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-t.offsetTop+o),t.style.alignSelf="";var l=t.cloneNode(!0);return t.classList.add("b-sticky-content-el"),a.appendChild(l),l})),i["b-focused"]=!1,li.syncClassList(e.contentElement,i),li.syncClassList(e.element,r),a}}],[{key:"defaultConfig",get:function(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}},{key:"pluginConfig",get:function(){return{before:["renderRows"]}}}])}(wc);S(yw,"$name","StickyCells"),yw._$name="StickyCells",Ug.registerFeature(yw,!1);var kw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDisable",value:function(e){this.isConfiguring||this.client.refreshRows(),B(t,"doDisable",this,3)([e])}},{key:"beforeRenderRow",value:function(e){var t,n,r=e.row,i=e.record,a=this.enabled,o=i.isGroupHeader,l=this.client.store.isGrouped&&i.instanceMeta(this.client.store).groupParent,s=(null!==(t=null==l||null===(n=l.groupChildren)||void 0===n?void 0:n.indexOf(i))&&void 0!==t?t:r.dataIndex)%2==0;r.assignCls({"b-even":a&&!o&&s,"b-odd":a&&!o&&!s})}}],[{key:"pluginConfig",get:function(){return{chain:["beforeRenderRow"]}}}])}(wc);S(kw,"$name","Stripe"),kw._$name="Stripe",Ug.registerFeature(kw);var bw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){this.grid=e,B(t,"construct",this,3)([e,n]),this.bindStore(e.store),e.hideFooters=this.hideFooters}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this}),this.isConfiguring||this.refreshSummaries()}},{key:"store",get:function(){return this.grid.store}},{key:"doDestroy",value:function(){B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){B(t,"doDisable",this,3)([e]);var n=this.client;e?n.element.classList.add("b-summary-disabled"):(this.refreshSummaries(),n.element.classList.remove("b-summary-disabled"),n.eachSubGrid((function(e){return e.scrollable.syncPartners()})))}},{key:"renderRows",value:function(){this.refreshSummaries()}},{key:"refreshSummaries",value:function(e){var t=this,n=t.grid,r=t.store,i=e?null:li.children(n.element,".b-grid-footer"),a=t.selectedOnly&&n.selectedRecords.length>0,o=(r.isFiltered?r.storage.values:r.allRecords).filter((function(e){return!e.isSpecialRow&&(!a||n.isSelected(e))}));(e?e.map((function(e){return n.columns.get(e)})):n.columns.visibleColumns).forEach((function(r,a){var l;null===(l=r.summaries)||void 0===l||l.forEach((function(e){"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(W(e.initialSeed))?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}));var s=e?n.element.querySelector(".b-grid-footer[data-column-id=".concat(r.id,"]")):i[a];if(null!=s&&s.dataset.column){var u=t.generateHtml(r,o,"b-grid-footer-summary");(r.summaries?r.summaries.length:!!r.sum)&&(s.children.length?li.sync(u,s.firstElementChild):s.innerHTML=u)}}))}},{key:"onStoreChange",value:function(e){var t=this,n=e.action,r=e.changes,a=!0;this.disabled||("update"===n&&(a=Object.keys(r).some((function(e){var n=t.grid.columns.get(e);return Boolean(n)&&(Boolean(n.sum)||Boolean(n.summaries))}))),a&&this.refreshSummaries("update"===n&&this.refreshOnlyAffectedSummaries?Object.keys(r):i))}},{key:"updateSelectedOnly",value:function(e){var t=this;t.detachListeners("selectionChange"),e&&t.grid.ion({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}},{key:"refresh",value:function(){this.refreshSummaries()}}],[{key:"configurable",get:function(){return{selectedOnly:null,refreshOnlyAffectedSummaries:null,hideFooters:!1}}},{key:"pluginConfig",get:function(){return{chain:["renderRows","bindStore"]}}}])}(KC(wc));S(bw,"$name","Summary"),bw.featureClass="b-summary",bw._$name="Summary",Ug.registerFeature(bw);var Cw=Promise.resolve(),ww=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r;B(t,"construct",this,3)([e,n]),!this.treeColumn&&(null===(r=e.initialConfig.columns)||void 0===r?void 0:r.length)>0&&console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}},{key:"doDisable",value:function(e){if(e)throw new Error("Tree feature cannot be disabled")}},{key:"store",get:function(){return this.client.store}},{key:"treeColumn",get:function(){var e=this,t=e.client.columns;return e._treeColumn&&t.includes(e._treeColumn)||(e._treeColumn=t.find((function(e){return e.isTreeColumn}))),e._treeColumn}},{key:"bindStore",value:function(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",beforeLazyLoad:"onBeforeLoadChildren",afterLazyLoad:"onLoadChildren",thisObj:this})}},{key:"toggleCollapse",value:(c=f(L().mark((function e(t,n){var r,i,a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("Tree#toggleCollapse must be passed a record");case 2:return i=(r=this).store,a=r.client,o=a.rowManager,l=i.getById(t),s=l.instanceMeta(i),u=o.getRowFor(l),l.generation++,e.next=7,i.toggleCollapse(l,n);case 7:if(!e.sent){e.next=15;break}if(!r.isDestroyed){e.next=10;break}return e.abrupt("return");case 10:(u=o.getRowFor(l))&&l.ancestorsExpanded()&&u.render(null,null,!1),r.isTogglingNode||(a.element.classList.add("b-toggling-node"),r.isTogglingNode=!0,r.requestAnimationFrame((function(){a.element.classList.remove("b-toggling-node"),r.isTogglingNode=!1}))),a.trigger(s.collapsed?"collapseNode":"expandNode",{record:l}),a.trigger("toggleNode",{record:l,collapse:s.collapsed});case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"collapse",value:(u=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.toggleCollapse(t,!0));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"expand",value:(s=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.toggleCollapse(t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"onBeforeToggleNode",value:function(e){var t=e.record,n=e.collapse;this.client.trigger("beforeToggleNode",{record:t,collapse:n})}},{key:"onBeforeLoadChildren",value:function(e){var t,n=e.source,r=e.params,i=e.parent,a=void 0===i?n.getById(r[n.modelClass.idField]):i;null===(t=this.client.rowManager.getRowFor(a))||void 0===t||t.addCls("b-loading-children")}},{key:"onLoadChildren",value:function(e){var t,n=e.source,r=e.params,i=e.parent,a=void 0===i?n.getById(r[n.modelClass.idField]):i;null===(t=this.client.rowManager.getRowFor(a))||void 0===t||t.removeCls("b-loading-children")}},{key:"onLoadChildrenException",value:function(e){var t=e.record,n=this.client.rowManager.getRowFor(t);null==n||n.removeCls("b-loading-children")}},{key:"expandOrCollapseAll",value:(l=f((function(){var e=this,t=!(arguments.length>0&&arguments[0]!==i)||arguments[0],n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.store.rootNode;return L().mark((function r(){var i,a,o,l,s;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=e.client,a=e.store,o=i.animateTreeNodeToggle,l=[],s=[],i.trigger("beforeToggleAllNodes",{collapse:t}),i.animateTreeNodeToggle=!1,a.suspendEvents(),a.traverse((function(n){var r=n.instanceMeta(a);n.isLeaf||(t&&!r.collapsed?(e.toggleCollapse(n,!0),s.push.apply(s,z(n.children))):!t&&r.collapsed&&(Array.isArray(n.children)&&s.push.apply(s,z(n.children)),l.push(e.toggleCollapse(n,!1))))}),n,n===a.rootNode),a.resumeEvents(),r.abrupt("return",(t?Cw:Promise.all(l)).then((function(){s.length&&(t?a.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):a.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),i.refreshRows(null,t),i.trigger("toggleAllNodes",{collapse:t}),i.animateTreeNodeToggle=o})));case 7:case"end":return r.stop()}}),r)}))()})),function(){return l.apply(this,arguments)})},{key:"collapseAll",value:(o=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.expandOrCollapseAll(!0));case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"expandAll",value:(a=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.expandOrCollapseAll(!1));case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"expandTo",value:(r=f((function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return L().mark((function r(){var i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(i=t).store,o=i.client,l=o.animateTreeNodeToggle,!Array.isArray(e)){r.next=14;break}if(!(e.length>0)){r.next=13;break}o.suspendRefresh(),s=e.length-1;case 5:if(!(s>=0)){r.next=13;break}return c=a.getById(e[s]),0===s&&(null===(d=o.resumeRefresh)||void 0===d||d.call(o,!1),o.rowManager.refresh()),r.next=10,null===(u=i.expandTo)||void 0===u?void 0:u.call(i,c,0===s);case 10:s--,r.next=5;break;case 13:return r.abrupt("return");case 14:if(!1!==(h=a.getById(e)).instanceMeta(i.store).hiddenByCollapse){r.next=17;break}return r.abrupt("return");case 17:if(o.animateTreeNodeToggle=!1,h.ancestorsExpanded()){r.next=33;break}for(g=[],m=h.parent;m&&!m.isRoot;m=m.parent)m.isExpanded(a)||g.unshift(m);o.suspendRefresh(),p=0,y=g;case 23:if(!(p<y.length)){r.next=31;break}if(k=y[p],i.isDestroyed){r.next=28;break}return r.next=28,i.toggleCollapse(k,!1);case 28:p++,r.next=23;break;case 31:null===(f=o.resumeRefresh)||void 0===f||f.call(o,!1),null===(v=o.refreshRows)||void 0===v||v.call(o);case 33:if(o.animateTreeNodeToggle=l,i.isDestroyed||!n){r.next=37;break}return r.next=37,o.scrollRowIntoView(h);case 37:case"end":return r.stop()}}),r)}))()})),function(e){return r.apply(this,arguments)})},{key:"expandToLevel",value:(n=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(){var i,a,o,l;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=t.store,a=t.client,o=a.animateTreeNodeToggle,l=function(n){n.children.forEach((function(n){n.isLeaf||(n.instanceMeta(i).collapsed&&t.toggleCollapse(n,!1),n.childLevel<e&&l(n))}))},i.suspendEvents(),a.suspendRefresh(),!n){r.next=6;break}return r.next=6,t.collapseAll();case 6:a.isDestroyed||(a.animateTreeNodeToggle=!1,l(i.rootNode),i.resumeEvents(),a.resumeRefresh(!0),a.animateTreeNodeToggle=o);case 7:case"end":return r.stop()}}),r)}))()})),function(e){return n.apply(this,arguments)})},{key:"onElementClick",value:function(e){var t=this,n=e.target,r=t.client.getCellDataFromEvent(e),i=n.closest(".b-tree-expander");i&&e.preventDefault(),(i||t.expandOnCellClick&&null!=r&&r.record.isParent)&&t.toggleCollapse(r.record)}},{key:"toggleCollapseByKey",value:function(){var e,t=this.client.focusedCell;return!(!((null==t?void 0:t.rowIndex)>-1)||null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.isEditing||!t.record.isParent||!document.activeElement.closest(".b-grid-cell"))&&(this.toggleCollapse(t.id),!0)}},{key:"beforeRenderRow",value:function(e){var t=e.record,n=e.cls;if(t.isLeaf)n["b-tree-parent-row"]=0,n["b-tree-collapsed"]=0,n["b-tree-expanded"]=0,n["b-loading-children"]=0;else{var r=this.client.store,i=!t.isExpanded(r);n["b-tree-parent-row"]=1,n["b-tree-collapsed"]=i,n["b-tree-expanded"]=!i,n["b-loading-children"]=t.instanceMeta(r).isLoadingChildren}}},{key:"expandIfSingleColumn",value:function(){return 1===this.client.columns.count&&this.expandByKey()}},{key:"expandByKey",value:function(){var e=this.client,t=e.focusedCell,n=null==t?void 0:t.record;return!!(n&&null!=t&&t.column.tree&&n.isParent&&n.instanceMeta(e.store).collapsed)&&(this.expand(n),!0)}},{key:"collapseIfSingleColumn",value:function(){return 1===this.client.columns.count&&this.collapseByKey()}},{key:"collapseByKey",value:function(){var e=this.client,t=e.focusedCell,n=null==t?void 0:t.record;if(null!=t&&t.column.tree&&n){if(n.isParent&&!n.instanceMeta(e.store).collapsed)return this.collapse(n),!0;if(n.parent&&!n.parent.isRoot)return e.deselectAll(),e.focusCell({record:n.parent,column:t.column}),!0}return!1}},{key:"updateTreeLines",value:function(){this.isConfiguring||this.client.refreshRows()}}],[{key:"pluginConfig",get:function(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementClick","bindStore","beforeRenderRow"]}}}]);var n,r,a,o,l,s,u,c}(wc.mixin($i));S(ww,"$name","Tree"),S(ww,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"},treeLines:!1}),ww.featureClass="b-tree",ww._$name="Tree",Ug.registerFeature(ww,!1,"Grid"),Ug.registerFeature(ww,!0,"TreeGrid");var Dw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){if(this.treeColumn=e.columns.find((function(e){return e.isTreeColumn})),B(t,"construct",this,3)([e,n]),this._levels=this._levels||[],!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled");e.rowManager.ion({renderCell:"renderCell",prio:1e3,thisObj:this})}},{key:"applyPluginConfig",value:function(){return this.scheduleRefreshGroups=Tt.createBuffered(this.refreshGroups,this.refreshGroupsTimeout,this),B(t,"applyPluginConfig",this,3)(arguments)}},{key:"processParentData",value:function(e){this.parentCls&&(e.cls=this.parentCls)}},{key:"processTransformedData",value:function(e){}},{key:"waitForLoad",value:(l=f(L().mark((function e(){var t,n,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this).originalStore.isLoading){e.next=6;break}return e.next=4,t.originalStore.await("load",!1);case 4:if(!t.isDestroyed){e.next=6;break}return e.abrupt("return");case 6:if(!(n=this.client.crudManager)){e.next=15;break}if(!n.isLoadingOrSyncing&&!n._autoLoadPromise){e.next=11;break}return e.next=11,n.await("requestDone");case 11:if(!t.isDestroyed){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,null===(r=t.client.project)||void 0===r?void 0:r.commitAsync();case 15:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"waitForReadiness",value:(o=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitForLoad();case 2:if(!this.scheduleRefreshGroups.isPending){e.next=5;break}return e.next=5,this.client.await("treeGroupChange",!1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"updateOriginalStore",value:function(e){var t=this;t.store=t.initialConfig.store,t.detachListeners("originalStore"),null==e||e.ion({name:"originalStore",refresh:t.onOriginalStoreRefresh,add:t.onOriginalStoreChanged,update:t.onOriginalStoreUpdate,remove:t.onOriginalStoreChanged,removeAll:t.onOriginalStoreChanged,thisObj:t})}},{key:"changeStore",value:function(e){var t,n=this.originalStore;n&&(e=new n.constructor({reapplyFilterOnAdd:!0,reapplyFilterOnUpdate:!0,tree:!0,modelClass:n.modelClass,load:null===(t=n.load)||void 0===t?void 0:t.bind(n),commit:n.commit.bind(n),remove:function(t,r){t=$e.asArray(t);var i=[],a=[];if(e.isApplyingLevels)a.push.apply(a,z(t));else{var o,l=D(t);try{for(l.s();!(o=l.n()).done;){var s=o.value;s.isLinked?i.push(s.$original):a.push(s)}}catch(e){l.e(e)}finally{l.f()}}a.length&&n.remove.call(e,a,r),i.length&&n.remove(i,r)},removeAll:n.removeAll.bind(n)},e));return e}},{key:"applyLevels",value:(i=f(L().mark((function e(t){var n,r,i,o,l,s,u,c,d,h,f,v,g,m,p,y,k;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).client,i=n.treeColumn,o=n.expandParents,l=r.store,s=null,c=l.modelClass,null!=i&&i.field&&c.getFieldDefinition(i.field)&&(u=c.getFieldDataSource(i.field)),0!==(t=t||[]).length||!n.isConfiguring){e.next=7;break}return e.abrupt("return");case 7:return n._levels=t,n.isApplying++,n.originalStore||(n.originalStore=l,r.suspendRefresh(),r.store=l=n.store,r.resumeRefresh(!1)),e.next=12,n.waitForLoad();case 12:if(!n.isDestroyed){e.next=14;break}return e.abrupt("return");case 14:if(r.suspendRefresh(),!(t.length>0)){e.next=31;break}d=new a,h=D(l.getAllDataRecords(!1));try{for(h.s();!(f=h.n()).done;)(v=f.value).isLeaf&&v.isLinked&&d.set(v.$original,v)}catch(e){h.e(e)}finally{h.f()}g=n.originalStore.getAllDataRecords(!1).flatMap((function(e){return e.isLeaf?d.has(e)?d.get(e):e.link():[]})),m=D(g);try{for(m.s();!(p=m.n()).done;)y=p.value,(k=y.instanceMeta(l.id)).collapsed=!1,k.hidden=!1}catch(e){m.e(e)}finally{m.f()}return s=l.treeifyData(g,t,(function(e){u&&Be.setPath(e,u,e.key);var t=l.getById(e.id);!o||t&&l.syncDataOnLoad||(e.expanded=!0),n.processParentData(e)}),!1,(function(e,t){var n=t&&r.columns.get(t);return null!=n&&n.formatValue?e=n.formatValue(e):null!=n&&n.isCheckColumn&&(e=Boolean(e)),e})),n.processTransformedData(s),e.next=26,n.trigger("beforeDataLoad",{store:l,data:s.children});case 26:l.isApplyingLevels=!0,l.data=s.children,l.isApplyingLevels=!1,e.next=34;break;case 31:r.store=n.originalStore,n.detachListeners("originalStore"),n.originalStore=null;case 34:n.isApplying--,r.element.classList.toggle("b-grid-treegrouped",t.length>0),r.resumeRefresh(!1),n.refresh(),r.trigger("treeGroupChange",{levels:t});case 39:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"refresh",value:function(){this.client.isPainted&&this.client.renderRows(!1)}},{key:"doDisable",value:function(e){e&&this.clearGroups(),B(t,"doDisable",this,3)([e])}},{key:"onOriginalStoreUpdate",value:function(e){var t=this;e.records;var n=e.changes;this.levels.some((function(e){return(e.fieldName||e)in n}))?this.scheduleRefreshGroups():Object.keys(n).forEach((function(e){var n=t.client.columns.get(e);null!=n&&n.isVisible&&n.hasSummary&&n.refreshCells()}))}},{key:"onOriginalStoreChanged",value:function(){this.scheduleRefreshGroups()}},{key:"onOriginalStoreRefresh",value:function(e){var t=e.action;"dataset"!==t&&"filter"!==t||this.scheduleRefreshGroups()}},{key:"updateLevels",value:function(e,t){var n=this,r=n.client;n.hideGroupedColumns&&(null==t||t.forEach((function(t){t=t.fieldName||t,e.some((function(e){return(e.fieldName||e)===t}))||r.columns.get(t).show()})),null==e||e.forEach((function(e){e=e.fieldName||e,t&&t.some((function(t){return t.fieldName===e}))||(r._suspendRenderContentsOnColumnsChanged=!0,r.columns.get(e).hide(),r._suspendRenderContentsOnColumnsChanged=!1)}))),!e&&n.isConfiguring||(n.updatePromise=n.applyLevels(e),r.renderContents())}},{key:"groupFields",get:function(){return this.levels.map((function(e){return e.fieldName||e}))}},{key:"group",value:(r=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.assertArray(t,"group()"),e.next=3,this.applyLevels(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"clearGroups",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isGrouped){e.next=4;break}return this.levels=[],e.next=4,this.updatePromise;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"refreshGroups",value:function(){var e;return null===(e=this.applyLevels)||void 0===e?void 0:e.call(this,this._levels)}},{key:"isGrouped",get:function(){return!this.disabled&&this._levels.length>0}},{key:"populateHeaderMenu",value:function(e){var t=e.column,n=e.items,r=this,i=!1;!1!==t.groupable&&!t.isTreeColumn&&!r.isGroupedByField(t.field)&&(n.groupAsc={text:"L{group}",localeClass:r,icon:"b-fw-icon b-icon-group-asc",separator:!0,weight:400,disabled:r.disabled,onItem:function(){return r.addGrouper(t)}},i=!0),r.isGrouped&&(r.isGroupedByField(t.field)&&(n.groupRemove={text:"L{stopGroupingThisColumn}",localeClass:r,icon:"b-fw-icon b-icon-clear",separator:!i,weight:420,disabled:r.disabled,onItem:function(){return r.removeGrouper(t)}},i=!0),n.groupRemoveAll={text:"L{stopGrouping}",localeClass:r,icon:"b-fw-icon b-icon-clear",separator:!i,weight:420,disabled:r.disabled,onItem:function(){return r.clearGroups()}})}},{key:"addGrouper",value:function(e){this.levels=this.levels.concat(e.field)}},{key:"isGroupedByField",value:function(e){return this.levels.find((function(t){return t.fieldName===e}))}},{key:"removeGrouper",value:function(e){this.levels.splice(this.levels.findIndex((function(t){return t.fieldName===e.field})),1),this.levels=this.levels.slice()}},{key:"renderCell",value:function(e){var t=e.column,n=e.cellElement;e.row;var r=e.record;if(e.size,e.isFirstColumn,this.isGrouped&&!this.disabled&&r.generatedParent&&t.hasSummary){var i=this.generateHtml(t,r.allChildren,"b-grid-treegroup-summary");n.children.length?li.sync(i,n.firstElementChild):n.innerHTML=i}}}],[{key:"pluginConfig",get:function(){return{chain:["populateHeaderMenu"],assign:["group","clearGroups","refreshGroups"]}}}]);var n,r,i,o,l}(KC(wc));S(Dw,"$name","TreeGroup"),S(Dw,"configurable",{levels:[],parentCls:"b-generated-parent",parentRenderer:null,hideGroupedColumns:null,refreshGroupsTimeout:100,expandParents:!0,store:{},originalStore:null}),S(Dw,"properties",{isApplying:0}),Dw._$name="TreeGroup",Ug.registerFeature(Dw);var Sw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"export",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this;return e=Be.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}},{key:"generateExportData",value:function(e){var t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}},{key:"normalizeColumns",value:function(e){var t,n,r=this,i=e.columns||(e.exportAllColumns?null===(t=this.target.columns)||void 0===t?void 0:t.records:null===(n=this.target.columns)||void 0===n?void 0:n.visibleColumns).filter((function(e){return!1!==e.exportable}));e.columns=i.map((function(e){return"string"==typeof e?r.target.columns.find((function(t){return t.field===e}))||{field:e}:e}))}},{key:"generateColumns",value:function(e){var t=this;return e.columns.map((function(n){return t.processColumn(n,e)}))}},{key:"generateRows",value:function(e){var t,n=e.columns,r=e.rows;if(0===n.length||0===(null==r?void 0:r.length))return[];var i=this,a=i.target,o=(r||a.store).map((function(t){return i.processRecord(t,n,e)})).filter((function(e){return null==e?void 0:e.length}));if(null!==(t=a.features.summary)&&void 0!==t&&t.enabled){var l=document.createElement("div"),s=n.map((function(e){return l.innerHTML=a.features.summary.generateHtml(e,r||a.store.records),l.innerText}));o.push(s)}return o}},{key:"getColumnType",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.target.store,n=e.exportedType||"object";if(e.exportedType===i&&e.field){var r=t.modelClass.getFieldDefinition(e.field);r&&"auto"!==r.type&&(n=r.type)}return n}},{key:"processColumn",value:function(e,t){var n=this.target,r=t.defaultColumnWidth,i=e.field,a=e.text,o=e.width,l=e.minWidth;if(n.store&&!(i in n.store.modelClass.fieldMap)&&(i=""),!a||!o){var s=n.columns.find((function(e){return e.field===i}));a||(a=s&&(s.text||s.headerRenderer&&s.textElement.innerText)||i),null==o&&(o=s&&s.width||r)}return o=Math.max(o||r,l||r),{field:i,value:a,width:o,type:this.getColumnType(e)}}},{key:"processRecord",value:function(e,t,n){var r,i=this.target,a=n.showGroupHeader,o=n.indent,l=n.indentationSymbol;if(e)if(e.isSpecialRow){if(a&&"groupRowFor"in e.meta&&(r=t.map((function(t){return i.features.group.buildGroupHeader({cellElement:li.createElement(),grid:i,isExporting:!0,record:e,column:t,isExport:!0})}))),e.meta.groupFooterFor&&!i.isTimelineBase){var s=document.createElement("div"),u=e.groupChildren.slice();u.pop(),r=t.map((function(t){return s.innerHTML=i.features.groupSummary.generateHtml(t,u,e,i.features.group.field,e._groupValue),s.innerText}))}}else r=t.map((function(t){var r,a=e.getValue(t.field),s=t.renderer;!s||a&&t.isDateColumn&&n.exportDateAsInstance||(a=null!==(r=s.call(t,{value:a,record:e,column:t,grid:i,isExport:!0}))&&void 0!==r?r:a);return o&&t.tree&&(a="".concat(l.repeat(e.childLevel)).concat(a)),a}));else r=t.map((function(){return""}));return r}}],[{key:"defaultConfig",get:function(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"    "}}}])}(Mn);Sw._$name="TableExporter";var xw=function(){return w((function e(){m(this,e)}),null,[{key:"write",value:function(e){throw new Error("XlsProviderBase#write must be implemented in a subclass")}}])}();xw._$name="XlsProviderBase";var Ew={string:String,number:Number,date:Date,boolean:Boolean,bool:Boolean},Rw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"write",value:function(e){var t=e.filename,n=e.columns,i=e.rows;i.forEach((function(e){e.forEach((function(e){e.type=Ew[e.type]||String,e.type===String&&"string"!=typeof e.value&&(e.value="".concat(e.value))}))})),n.map((function(e){delete e.type,delete e.field,e.fontWeight="bold",e.align="center"})),r.writeXlsxFile([n].concat(z(i)),{dateFormat:"yyyy-mm-dd",fileName:t,columns:n.map((function(e){return{width:Math.round((e.width||100)/10)}}))})}}])}(xw);Rw._$name="WriteExcelFileProvider";var Tw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"processValue",value:function(e){return e===i||null===e||Number.isNaN(e)||"function"==typeof e||"object"===W(e)&&"[object Object]"===String(e)?"":e}},{key:"generateExportData",value:function(e){var t=this,n=t.exporter.export(e.exporterConfig),r=n.rows,i=n.columns;return{rows:r.map((function(n){return n.map((function(n,r){var a,o=(null===(a=i[r])||void 0===a?void 0:a.type)||"string";return"object"!==o&&"auto"!==o||(o="string"),n instanceof Date?e.dateFormat?(n=Pl.format(n,e.dateFormat),o="string"):(n=yp.fromTimeZone(n,0),o="date"):"number"===o&&"string"==typeof n&&(n=parseFloat(n.replace(/^\D*/,""))),t.convertEmptyValueToEmptyString?n=t.processValue(n):"string"===o&&"string"!=typeof n&&(n="".concat(n)),{value:n,type:o}}))})),columns:i}}},{key:"export",value:(n=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return L().mark((function n(i){var a,o,l,s,u,c,d,h,f,v,g,m,p,y;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=(a=e).client,l=(null===(i=a.xlsProvider)||void 0===i?void 0:i.write)||a.zipcelx||r.zipcelx){n.next=3;break}throw new Error('ExcelExporter: "xlsProvider" or "zipcelx" library is required');case 3:if(!a.disabled){n.next=5;break}return n.abrupt("return");case 5:if((t=Be.assign({},a.config,t)).filename||(t.filename=o.$$name),s=t.filename,u=a.generateExportData(t),c=u.rows,d=u.columns,!t.csv){n.next=12;break}return h=t.csv.columnDelimiter||",",f=t.csv.lineDelimiter||"\n",!1!==o.trigger("beforeCSVExport",{config:t,rows:c,columns:d,lineDelimiter:f,columnDelimiter:h})&&(v=d.map((function(t){return e.processCsvValue(t.value)})).join(h)+f,g=c.map((function(t){return t.map((function(t){return e.processCsvValue(t.value)})).join("".concat(h))})).join(f),m=new Uint8Array([239,187,191]),p=new Blob([m,v+g],{type:a.csvMimeType}),ne.downloadBlob(p,s)),n.abrupt("return",Promise.resolve());case 12:if(!1===o.trigger("beforeExcelExport",{config:t,rows:c,columns:d})){n.next=16;break}return y={filename:s,columns:d,rows:c},Ne.checkVersion("core","7.0","<")&&(y.sheet={},y.sheet.data=z(c.map((function(e){return e.map((function(e,t){var n;return F(F({},e),{},{type:"number"===(null===(n=d[t])||void 0===n?void 0:n.type)&&"string"!=typeof value?"number":"string"})}))}))),y.sheet.cols=d.map((function(e){return F(F({},e),{},{type:"string"})})),y.sheet.data.unshift(y.sheet.cols)),n.abrupt("return",l(y));case 16:return n.abrupt("return",Promise.resolve());case 17:case"end":return n.stop()}}),n)}))()})),function(){return n.apply(this,arguments)})},{key:"processCsvValue",value:function(){return'"'.concat(String(arguments.length>0&&arguments[0]!==i?arguments[0]:"").replace(/"/g,'""'),'"')}},{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=r.zipcelx)}},{key:"exporter",get:function(){var e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}]);var n}(wc);S(Tw,"$name","ExcelExporter"),S(Tw,"configurable",{filename:null,dateFormat:Ne.checkVersion("core","7.0",">=")?null:"YYYY-MM-DD",exporterClass:Sw,exporterConfig:null,xlsProvider:Ne.checkVersion("core","7.0",">=")?Rw:null,csvMimeType:"text/csv",zipcelx:null,convertEmptyValueToEmptyString:!0,exportAllColumns:!1}),Tw._$name="ExcelExporter",Ug.registerFeature(Tw,!1,"Grid");var Mw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;B(t,"construct",this,3)([e,n]),fr.on({element:e.element,thisObj:r,drop:r.onFileDrop,dragover:r.onFileDragOver,dragenter:r.onFileDragEnter,dragleave:r.onFileDragLeave})}},{key:"onFileLoad",value:function(e){this.client.trigger("fileDrop",{file:this.file,domEvent:e})}},{key:"onFileDragEnter",value:function(){this.client.element.classList.add("b-dragging-file")}},{key:"onFileDragOver",value:function(e){e.preventDefault()}},{key:"onFileDragLeave",value:function(e){var t=this.client.element;e.relatedTarget&&!t.contains(e.relatedTarget)&&this.client.element.classList.remove("b-dragging-file")}},{key:"onFileDrop",value:function(e){e.preventDefault();var t=e.dataTransfer.items[0].getAsFile();this.client.trigger("fileDrop",{file:t,domEvent:e}),this.onFileDragLeave(e)}}])}(wc);S(Mw,"$name","FileDrop"),Mw._$name="FileDrop",Ug.registerFeature(Mw,!1,"Grid");var Fw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Dm);S(Fw,"$name","Grid"),S(Fw,"type","grid"),Fw.initClass(),Fw._$name="Grid";var Aw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateStore",value:function(e,n){if(e&&!e.tree&&!e.isTree)throw new Error("TreeGrid requires a Store configured with tree : true");B(t,"updateStore",this,3)([e,n])}}],[{key:"configurable",get:function(){return{store:{tree:!0}}}}])}(Fw);S(Aw,"$name","TreeGrid"),S(Aw,"type","treegrid"),Aw.initClass(),Aw._$name="TreeGrid";var Iw,Lw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments);var e=this.grid=this.up("gridbase",!0);if(!e)throw new Error("GroupBar must be used inside a Grid component");e.ion({paint:this.onGridPaint,once:!0,thisObj:this})}},{key:"onGridPaint",value:function(){var e=this,t=e.grid,n=t.features,r=n.treeGroup,a=n.group,o=n.columnReorder,l=n.tree;if(!r&&!a)throw new Error("GroupBar widget requires the TreeGroup or Group feature to be present");o.usingGroupBarWidget=!0,e.store=new Ff({fields:["cls","ascending"],internalListeners:{add:e.onStoreChanged,remove:e.onStoreChanged,thisObj:e}}),t.ion(S(S(S(S(S(S({},l?"treeGroupChange":i,e.onTreeGroupChanged),"beforeColumnDropFinalize",e.onBeforeColumnDropFinalize),"columnDrag",e.onColumnDrag),"columnDragStart",e.onColumnDragStart),"columnDrop",e.onColumnDrop),"thisObj",e)),l?e.onTreeGroupChanged({levels:r.levels}):(t.store.ion({group:e.onGroupChanged,thisObj:e}),e.onGroupChanged())}},{key:"onStoreChanged",value:function(e){var t,n=e.records,r=this,i=r.grid;i.isConstructing||"b-drop-target"===(null==n||null===(t=n[0])||void 0===t?void 0:t.cls)||(r.ignoreGroupChange=!0,i.features.treeGroup?i.features.treeGroup.levels=r.store.map((function(e){return e.field})):r.store.count>0?i.store.group(r.store.records[0].field):i.store.clearGroupers(),r.ignoreGroupChange=!1)}},{key:"onGroupChanged",value:function(){var e=this,t=this.grid.store.groupers;this.store.data=t?t.map((function(t){return e.grid.columns.get(t.field)})):[]}},{key:"onTreeGroupChanged",value:function(e){var t=this,n=e.levels;if(!this.ignoreGroupChange){if(n.some((function(e){return e instanceof Function&&!e.fieldName})))throw new Error("GroupBar only supports column grouping");this.store.data=(n||[]).map((function(e){return e=e.fieldName||e,t.grid.columns.get(e)}))}}},{key:"onColumnDragStart",value:function(e){var t=e.column;this.store.add({id:"placeholder",cls:"b-drop-target",text:this.grid.features.treeGroup?i:t.text})}},{key:"onColumnDrag",value:function(e){var t=e.context,n=e.column;e.event.target.closest(".b-groupbar")&&(t.valid=n.groupable)}},{key:"onBeforeColumnDropFinalize",value:function(e){var t=e.column,n=e.event,r=this.grid.features.tree;n.target.closest(".b-groupbar")&&t.groupable&&(r&&t.isTreeColumn||(this.store.getById("placeholder").remove(),r||this.store.removeAll(!0),this.store.add(t)))}},{key:"onColumnDrop",value:function(){var e;null===(e=this.store.getById("placeholder"))||void 0===e||e.remove()}}])}(lv);S(Lw,"type","groupbar"),S(Lw,"$name","GroupBar"),S(Lw,"configurable",{selectedCls:"not-used",ariaLabel:"L{TreeGroup.group}",itemTpl:function(e){return Le.encodeHtml(Le.capitalize(e.getValue(this.displayField)))}}),Lw.initClass(),Lw._$name="GroupBar";var Ow=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changePicker",value:function(e,n){return this.isDestroying||e.columns||(console.warn("No `columns` provided for the TreeCombo `picker` config"),e.columns=[{type:"tree"}]),B(t,"changePicker",this,3)([e?F(F({},e),{},{selectedRecordCollection:this.valueCollection}):e,n])}},{key:"updateMultiSelect",value:function(e){B(t,"updateMultiSelect",this,3)(arguments),this.picker.selectionMode.multiSelect=e}},{key:"updateReadOnly",value:function(e){B(t,"updateReadOnly",this,3)(arguments),this._picker&&(this.picker.readOnly=e)}}])}(dv);S(Ow,"$name","TreeCombo"),S(Ow,"type","treecombo"),S(Ow,"configurable",{multiSelect:!0,picker:{type:"treegrid",minWidth:"35em",disableGridRowModelWarning:!0,selectionMode:{row:!0,checkbox:!0}},chipView:{itemTpl:function(e){return Le.xss(Iw||(Iw=N(["",""])),e.name)},scrollable:{overflowX:"hidden-scroll"}}}),Ow.initClass(),Ow._$name="TreeCombo";var Pw=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"compositeField",!0),e}return R(t,e),w(t,[{key:"construct",value:function(){var e=this;B(t,"construct",this,3)(arguments);var n=this.sortable;this.sortable=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return n.call.apply(n,[e].concat(r))}}},{key:"defaultEditor",get:function(){var e=this.max,t=this.min,n=this.step,r=this.largeStep,i=this.decimalPrecision,a=void 0===i?this.grid.durationDisplayPrecision:i;return Be.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:n,decimalPrecision:a,largeStep:r})}},{key:"durationUnitField",get:function(){return"".concat(this.field,"Unit")}},{key:"formatter",get:function(){var e=this,t=e.format,n=e._formatter,r=e.decimalPrecision;return n&&e._lastFormat===t||(e._formatter=eg.getLocalizedFormatter(r?{maximumFractionDigits:r}:e._lastFormat=t)),e._formatter}},{key:"roundValue",value:function(e){var t,n,r=Math.pow(10,null!==(t=null!==(n=this.decimalPrecision)&&void 0!==n?n:this.grid.durationDisplayPrecision)&&void 0!==t?t:1);return Math.round(e*r)/r}},{key:"formatValue",value:function(e,n){e instanceof ql&&(n=e.unit,e=e.magnitude),e=this.roundValue(e);var r=this.abbreviatedUnit?"getShortNameOfUnit":"getLocalizedNameOfUnit";return B(t,"formatValue",this,3)([e])+(this.abbreviatedUnit?"":" ")+Pl[r](n,1!==e)}},{key:"defaultRenderer",value:function(e){var t=e.value,n=e.record,r=e.isExport,i=e.dataField,a=W(t),o="number"===a?t:null==t?void 0:t.magnitude,l="number"===a?n.getValue(this.durationUnitField):null==t?void 0:t.unit;return"number"!=typeof o?r?"":null:(!this.fieldWarningShown&&i instanceof Yc&&"totalslack"!==this.type&&(console.warn("Warning: Setting 'duration' as the 'field' value for the '".concat(this.type,"' column is not allowed since the field needs both a duration magnitude and unit, as supplied by for example the 'fullDuration' field. Additionally, a custom implemented field for the duration column should return a duration object to work correctly.")),this.fieldWarningShown=!0),this.formatValue(o,l))}},{key:"toClipboardString",value:function(e){var t;return null===(t=e.record.getValue(this.field))||void 0===t?void 0:t.toString()}},{key:"fromClipboardString",value:function(e){var t=e.string,n=e.record,r=Pl.parseDuration(t,!0,this.durationUnit);return r&&"magnitude"in r?r:n.fullDuration}},{key:"calculateFillValue",value:function(e){var t=e.value,n=e.record;return this.fromClipboardString({string:t,record:n})}}])}(iC);S(Pw,"$name","DurationColumn"),S(Pw,"type","duration"),S(Pw,"isGanttColumn",!0),S(Pw,"fields",[{name:"decimalPrecision"},"abbreviatedUnit"]),S(Pw,"defaults",{abbreviatedUnit:null,min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable:function(e,t){return e.getValue(this.field)-t.getValue(this.field)}}),bg.registerColumnType(Pw),Pw._$name="DurationColumn";var _w={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},Hw=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"timeZone",get:function(){return this.getData("timeZone")},set:function(e){this.setData("timeZone",e)}},{key:"setLocalDate",value:function(e,t){var n=this;null!=n.timeZone&&(t=yp.toTimeZone(t,n.timeZone)),n.set(e,t,!0),n["_"+e]=t}},{key:"getLocalDate",value:function(e){return null!=this.timeZone&&this[e]&&!isNaN(this[e])?yp.fromTimeZone(this[e],this.timeZone):this[e]}},{key:"applyChangeset",value:function(e){if(null!=this.timeZone)for(var n in delete e.timeZone,_w)e[n]&&(this.setLocalDate(n,new Date(e[n])),e[n]=this["_"+n]);return B(t,"applyChangeset",this,3)(arguments)}},{key:"getFieldPersistentValue",value:function(e){if(null!=this.timeZone){var n,r,i=null!==(n=null!==(r=null==e?void 0:e.field)&&void 0!==r?r:null==e?void 0:e.name)&&void 0!==n?n:e;if(_w[i]){var a=this.getLocalDate(i);return e.serialize?e.serialize(a):a}}return B(t,"getFieldPersistentValue",this,3)([e])}},{key:"convertToTimeZone",value:function(e,t){var n,r=this,i=F({},r.meta.modified),a=F({},_w),o=r.timeZone,l=r.constructor.isProEventModel;for(var s in r.isTask&&!r.manuallyScheduled&&(delete a.startDate,delete a.endDate),null==t||t.forEach((function(e){delete a[e]})),a)null!=r[s]?(l&&(r["_"+s]=null),a[s]=r[s],null!=o&&(a[s]=r.getLocalDate(s),i[s]&&(i[s]=yp.fromTimeZone(i[s],o)))):delete a[s];for(var u in r.timeZone=e,a)r.setLocalDate(u,a[u]),a[u]=1,null!=e&&i[u]&&(i[u]=yp.toTimeZone(i[u],e));(r.internalClearChanges(!0,!0,a),Be.isEmpty(i))||(r.meta.modified=i,null===(n=r.stores)||void 0===n||n.forEach((function(e){return e.modified.add(r)})))}}])}(e),S(t,"$name","TimeZonedDatesMixin"),S(t,"fields",[{name:"timeZone",persist:!1}]),t},Bw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;if(null!=e&&e.fullDuration){var r=e.fullDuration,i=r.magnitude,a=r.unit;e.duration=i,e.unit=a,delete e.fullDuration}for(var o=arguments.length,l=new Array(o>1?o-1:0),s=1;s<o;s++)l[s-1]=arguments[s];B(t,"construct",this,3)([e].concat(l)),n.normalize(),n.startDateMS&&n.endDateMS&&n.startDateMS>n.endDateMS&&console.error("startDate > endDate for ".concat(n.constructor.$name," record with id: ").concat(n.id))}},{key:"internalCalculateStartDate",value:function(e,t,n){return Pl.add(e,-t,n)}},{key:"internalCalculateEndDate",value:function(e,t,n){return Pl.add(e,t,n)}},{key:"internalCalculateDuration",value:function(e,t,n){return Pl.as(n,Pl.diff(e,t,"h"),"h")}},{key:"internalNormalize",value:function(e,t,n,r){var i=this,a=null!=n;e&&t&&!a?i.setData("duration",i.internalCalculateDuration(e,t,r)):e&&!t&&a?i.setData("endDate",i.internalCalculateEndDate(e,n,r)):!e&&t&&a&&i.setData("startDate",i.internalCalculateStartDate(t,n,r))}},{key:"normalize",value:function(){this.internalNormalize(this.startDate,this.endDate,this.duration,this.durationUnit||this.constructor.defaultValues.durationUnit)}},{key:"eventStore",get:function(){var e,t=this;if(t.isOccurrence)return t.recurringTimeSpan.eventStore;t._eventStore||(t._eventStore=null===(e=t.stores)||void 0===e?void 0:e.find((function(e){return e.isEventStore})));return t._eventStore}},{key:"updateInternalCls",value:function(e){this._cls?this._cls.value=e:this._cls=new Ct(e)}},{key:"internalCls",get:function(){var e=this.cls;return null!=e&&e.isDomClassList?e:(this.updateInternalCls(e),this.setData("cls",this._cls.value),this._cls)},set:function(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}},{key:"cls",get:function(){return this._cls||(this._cls=new Ct(B(t,"get",this,3)(["cls"]))),this._cls},set:function(e){this.internalCls=e}},{key:"startDate",get:function(){return this.get("startDate")},set:function(e){this.setStartDate(e)}},{key:"endDate",get:function(){return this.get("endDate")},set:function(e){this.setEndDate(e)}},{key:"endingDate",get:function(){var e=this,t=e.endDate,n=e.startDate;return t||Pl.add(n,e.duration,e.durationUnit)}},{key:"duration",get:function(){return this.get("duration")},set:function(e){this.setDuration(e,this.durationUnit)}},{key:"durationUnit",get:function(){return this.get("durationUnit")}},{key:"setDuration",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.durationUnit;e=parseFloat(e),this.set(F({duration:e,durationUnit:t},this.updateDatesFromDuration(e,t)))}},{key:"updateDatesFromDuration",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.startDate,r=arguments.length>3&&arguments[3]!==i?arguments[3]:this.endDate,a={};return n?a.endDate=this.internalCalculateEndDate(n,e,t):r&&(a.startDate=this.internalCalculateStartDate(r,e,t)),a}},{key:"getDurationInUnit",value:function(e,t){var n=this;return n.startDate&&n.endDate?Pl.getDurationInUnit(n.startDate,n.endDate,e,t):Pl.as(e,n.duration,n.durationUnit)}},{key:"fullDuration",get:function(){return new ql({unit:this.durationUnit,magnitude:this.duration})},set:function(e){null!=e?("string"==typeof e&&(e=Pl.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)):this.set({duration:e})}},{key:"setStartDate",value:function(e){var t=this,n={startDate:e};if(e){var r;if(!(arguments.length>1&&arguments[1]!==i)||arguments[1])r=null!=t.duration;else if(t.endDate){if(n.duration=t.internalCalculateDuration(e,t.endDate,t.durationUnit),n.duration<0)throw new Error("Negative duration")}else r=null!=t.duration;r&&(n.endDate=t.internalCalculateEndDate(e,t.duration,t.durationUnit))}else n.duration=null;t.set(n)}},{key:"setEndDate",value:function(e){var t=this,n={endDate:e};if(e){var r;if(!0===(arguments.length>1&&arguments[1]!==i&&arguments[1]))r=null!=t.duration;else if(t.startDate){if(n.duration=t.internalCalculateDuration(t.startDate,e,t.durationUnit),n.duration<0)throw new Error("Negative duration")}else r=null!=this.duration;r&&(n.startDate=t.internalCalculateStartDate(e,t.duration,t.durationUnit))}t.set(n)}},{key:"setStartEndDate",value:function(e,t,n){if(e>t)throw new Error("Start date must be less or equal to end date");this.set({startDate:e,endDate:t},null,n)}},{key:"dates",get:function(){for(var e=[],t=Pl.startOf(this.startDate,"day"),n=this.endDate,r=t;r<n;r=Pl.add(r,1,"day"))e.push(r);return e}},{key:"startDateMS",get:function(){var e;return null===(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)||void 0===e?void 0:e.getTime()}},{key:"endDateMS",get:function(){var e;return null===(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)||void 0===e?void 0:e.getTime()}},{key:"durationMS",get:function(){return this.rawDurationMS}},{key:"rawDurationMS",get:function(){var e=this.endDateMS,t=this.startDateMS;return e&&t?e-t:Pl.asMilliseconds(this.duration||0,this.durationUnit)}},{key:"isMilestone",get:function(){return 0===this.duration}},{key:"inSetNormalize",value:function(e){if("string"!=typeof e){var t=e.startDate,n=e.endDate,r=e.duration,i=e.durationUnit,a=void 0===i?this.durationUnit:i;"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof n&&(n=this.getFieldDefinition("endDate").convert(n)),"duration"in e?(t&&!n&&(n=this.internalCalculateEndDate(t,r,a)),!t&&n&&(t=this.internalCalculateStartDate(n,r,a))):t&&n&&(r=this.internalCalculateDuration(t,n,a));var o=Object.isFrozen(e)?Be.clone(e):e;return t&&(o.startDate=t),n&&(o.endDate=n),null!=r&&(o.duration=r),o}}},{key:"fieldToKeys",value:function(e,n){var r,i,a=this,o=B(t,"fieldToKeys",this,3)([e,n]);if(o.fullDuration){var l=o.fullDuration,s=l.magnitude,u=l.unit;o.duration=s,o.durationUnit=u}a.isEventModel||a.isTaskModel||(!("duration"in o)&&!o.durationUnit||o.startDate&&o.endDate||Object.assign(o,a.updateDatesFromDuration(null!==(r=o.duration)&&void 0!==r?r:a.duration,null!==(i=o.durationUnit)&&void 0!==i?i:a.durationUnit,o.startDate,o.endDate)));return o}},{key:"inSet",value:function(e,n,r,i,a,o,l){var s,u=this;a||(e=u.inSetNormalize(e)||e);var c,d=B(t,"inSet",this,3)([e,n,r,i,a,o,l]);null!==(s=u.project)&&void 0!==s&&s.isWritingData||!e.startDate||!e.endDate||(e.startDate instanceof Date&&e.endDate instanceof Date?c=e.startDate>e.endDate:u.fieldMap.startDate.convert(e.startDate)>u.fieldMap.endDate.convert(e.endDate)&&(c=!0),c&&console.error("startDate > endDate for ".concat(u.constructor.$name," record with id: ").concat(u.id)));return d}},{key:"applyValue",value:function(e,n,r,i,a){"cls"===n&&this.updateInternalCls(r),B(t,"applyValue",this,3)([e,n,r,i,a])}},{key:"forEachDate",value:function(e,t){return this.dates.forEach(e.bind(t))}},{key:"isScheduled",get:function(){var e=this.startDateMS;return this.endDateMS-e>=0}},{key:"isValid",get:function(){var e=this.startDate,t=this.endDate;return!e||!t||t-e>=0}},{key:"shift",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.durationUnit;return this.setStartDate(Pl.add(this.startDate,e,t,!0),!0)}},{key:"wbsCode",get:function(){return this._wbsCode||this.indexPath.join(".")},set:function(e){this._wbsCode=e}},{key:"fullCopy",value:function(){return this.copy.apply(this,arguments)}},{key:"intersects",value:function(e){return this.intersectsRange(e.startDate,e.endDate)}},{key:"intersectsRange",value:function(e,t){var n=this.startDate,r=this.endDate;return n&&r&&Pl.intersectSpans(n,r,e,t)}},{key:"split",value:function(){var e,t,n=arguments.length>0&&arguments[0]!==i?arguments[0]:.5,r=this,a=r.copy(),o=r.fullDuration,l=r.eventStore,s=r.assignmentStore,u=new ql(o),c=new ql(o);return"string"==typeof n?(e=new ql(n)).unit===u.unit?c.magnitude-=e.magnitude:(c.magnitude=Pl.as(e.unit,u)-e.magnitude,c.unit=e.unit,t=!0):(e=new ql(n>1?n:r.duration*n,r.durationUnit),c.magnitude-=e.magnitude),a.startDate=Pl.add(r.startDate,e.magnitude,e.unit),t?(a.fullDuration=c,r.fullDuration=e):(a.duration=c.magnitude,r.duration=e.magnitude),l&&(l.add(a),s&&!l.usesSingleAssignment&&s.add(r.assignments.map((function(e){var t=Object.assign({},e.data,{eventId:a.id,event:null,resource:null});return delete t.id,t})))),a}},{key:"toICSString",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};if(!this.isScheduled)return"";var t=this.startDate,n=this.endDate,r=e.DTSTAMP||Pl.format(new Date,"uu");delete e.DTSTAMP;var a={};a=this.allDay?{"DTSTART;VALUE=DATE":Pl.format(t,"u"),"DTEND;VALUE=DATE":Pl.format(n,"u")}:{DTSTART:Pl.format(t,"uu"),DTEND:Pl.format(n,"uu")};var o=Ne.scheduler&&Ne.getVersion("scheduler")||Ne.calendar&&Ne.getVersion("calendar")||"",l={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:"-//Bryntum AB//Bryntum Scheduler ".concat(o," //EN"),END:"VCALENDAR"},s=F(F(F(F({BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:r},a),this.recurrenceRule?{RRULE:this.recurrenceRule}:{}),e),{},{END:"VEVENT"}),u=Object.keys(l).map((function(e){return"".concat(e,":").concat(l[e])})),c=Object.keys(s).map((function(e){return"".concat(e,":").concat(s[e])}));return u.splice.apply(u,[u.length-1,0].concat(z(c))),u.join("\n")}},{key:"exportToICS",value:function(e){if(this.isScheduled){var t=new Blob([this.toICSString(e)],{type:"text/calendar"});ne.downloadBlob(t,(this.name||"Event")+".ics")}}},{key:"isFieldModified",value:function(e){return"fullDuration"===e?B(t,"isFieldModified",this,3)(["duration"])||B(t,"isFieldModified",this,3)(["durationUnit"]):B(t,"isFieldModified",this,3)([e])}}])}(od.mixin(Hw));S(Bw,"$name","TimeSpan"),S(Bw,"fields",[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]),Bw._$name="TimeSpan";var Vw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.normalizeUnits()}},{key:"generateId",value:function(e){var t=this,n=t.headers,r=[],i=Object.getPrototypeOf(t.data).id;if(!i){for(var a=n.length-1;a>=0;a--){var o=n[a],l=o.unit,s=o.increment,u=s>1;r.push("".concat(u?s:"").concat(a?l:Le.capitalize(l)).concat(u?"s":""))}i=r.join("And")}return e.count&&e.includes(i)&&(i+="-".concat(t.tickWidth,"by").concat(t.tickHeight||t.tickWidth),e.includes(i)&&(i+="-".concat(t.bottomHeader.increment),e.includes(i)&&(i=ba.generateId("".concat(i,"-"))))),i}},{key:"normalizeUnits",value:function(){var e=this,t=e.timeResolution,n=e.headers,r=e.shiftUnit;if(n)for(var i=0,a=n.length;i<a;i++){var o=n[i];o.unit=Pl.normalizeUnit(o.unit),o.splitUnit&&(o.splitUnit=Pl.normalizeUnit(o.splitUnit)),"increment"in o||(n[i]=Object.assign({increment:1},o))}t&&(t.unit=Pl.normalizeUnit(t.unit)),r&&(e.shiftUnit=Pl.normalizeUnit(r))}},{key:"set",value:function(){}},{key:"inSet",value:function(){}},{key:"options",get:function(){return this.data.options},set:function(e){this.data.options=e}},{key:"columnLinesFor",get:function(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}},{key:"tickSize",get:function(){return this._tickSize||this.tickWidth}},{key:"tickWidth",get:function(){return"tickWidth"in this.data?this.data.tickWidth:50}},{key:"tickHeight",get:function(){return"tickHeight"in this.data?this.data.tickHeight:50}},{key:"headerConfig",get:function(){if(this.data.headerConfig)return this.data.headerConfig;var e={},t=this.headers;switch(t.length){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}},{key:"mainHeaderLevel",get:function(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1},set:function(e){this.data.mainHeaderLevel=e}},{key:"mainHeader",get:function(){return this.headers[this.mainHeaderLevel]}},{key:"topHeader",get:function(){return this.headers[0]}},{key:"topUnit",get:function(){return this.topHeader.unit}},{key:"topIncrement",get:function(){return this.topHeader.increment}},{key:"bottomHeader",get:function(){return this.headers[this.headers.length-1]}},{key:"leafUnit",get:function(){return this.bottomHeader.unit}},{key:"leafIncrement",get:function(){return this.bottomHeader.increment}},{key:"mainUnit",get:function(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}},{key:"msPerPixel",get:function(){var e=this.bottomHeader;return Math.round(Pl.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}},{key:"isValid",get:function(){var e,t=this,n=!0,r=D(t.headers);try{for(r.s();!(e=r.n()).done;){var i=e.value;n=n&&Boolean(Pl.normalizeUnit(i.unit))}}catch(e){r.e(e)}finally{r.f()}return t.timeResolution&&(n=n&&Pl.normalizeUnit(t.timeResolution.unit)),t.shiftUnit&&(n=n&&Pl.normalizeUnit(t.shiftUnit)),n}}],[{key:"fields",get:function(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight"},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}},{key:"normalizeHeaderConfig",value:function(e){var t=e.headerConfig,n=e.columnLinesFor,r=e.mainHeaderLevel,i=e.headers=[];if(t.top&&("top"===n&&(e.columnLinesFor=0),"top"===r&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===n&&(e.columnLinesFor=i.length),"middle"===r&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==n?e.columnLinesFor=i.length-1:"bottom"===n&&(e.columnLinesFor=i.length),null==r&&(e.mainHeaderLevel=i.length-1),"bottom"===r&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}}])}(od);S(Vw,"$name","ViewPreset"),Vw._$name="ViewPreset";Pa.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,Object:{newEvent:"New event",information:"Information",showDetails:"Show details"},ResourceInfoColumn:{eventCountText:function(e){return e+" event"+(1!==e?"s":"")}},ResourceCollapseColumn:{toggleResourceLayout:"Toggle resource layout column. SPACE for context menu."},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",startTime:"Start time",End:"End",endTime:"End time",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete","Unassign event":"Unassign",color:"Color",eventAriaLabel:function(e,t){return"".concat(e.name,", starts at ").concat(t," ").concat(e.duration>0?"for ".concat(e.fullDuration.toString(!1)):"")}},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},TimeAxisColumn:{ariaLabel:function(e,t){return"Time axis showing ".concat(e," to ").concat(t)}},EventCopyPaste:{copyEvent:"Copy",cutEvent:"Cut",pasteEvent:"Paste"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-only-this-message":"Do you want to delete this occurrence of this event?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-only-this-message":"Do you want to change this occurrence of this event?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":function(e){var t=e.days;return"Weekly on ".concat(t)},"Monthly on {1}":function(e){var t=e.days;return"Monthly on ".concat(t)},"Yearly on {1} of {2}":function(e){var t=e.days,n=e.months;return"Yearly on ".concat(t," of ").concat(n)},"Every {0} days":function(e){var t=e.interval;return"Every ".concat(t," days")},"Every {0} weeks on {1}":function(e){var t=e.interval,n=e.days;return"Every ".concat(t," weeks on ").concat(n)},"Every {0} months on {1}":function(e){var t=e.interval,n=e.days;return"Every ".concat(t," months on ").concat(n)},"Every {0} years on {1} of {2}":function(e){var t=e.interval,n=e.days,r=e.months;return"Every ".concat(t," years on ").concat(n," of ").concat(r)},position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:function(e){var t=e.position,n=e.days;return"".concat(t," ").concat(n)}},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each",on:"On",the:"The","On the":"On the","End repeat":"End repeat","time(s)":"time(s)",Days:"Days",Months:"Months"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":function(e){return"Summary for ".concat(e)}},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}});var Nw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"storage",get:function(){return B(t,"storage",this,1)},set:function(e){var n=this;V(t,"storage",e,this,1,1),this.storage.addSorter((function(e,t){var r=e.bottomHeader,i=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||Pl.compareUnits(r.unit,i.unit)||r.increment-i.increment)*n.zoomOrder}))}},{key:"changeModelClass",value:function(e){return e}},{key:"getById",value:function(e){return B(t,"getById",this,3)([e])||!this.isPresetManager&&r.bryntum.PresetManager.getById(e)}},{key:"createRecord",value:function(e){var n;if(e.isViewPreset)return e;if("string"==typeof e)n=this.getById(e);else{if("number"!=typeof e){e.base&&(e=this.copyBaseValues(e));for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return B(t,"createRecord",this,3)([e].concat(i))}n=this.getAt(e)}if(!n)throw new Error("ViewPreset ".concat(e," does not exist"));return n}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]);var e=this,n=e.allRecords;e.isPresetManager&&(n=new o(n.concat(Object.values(e.basePresets)))),n.forEach((function(t){var n=e.optionalL("L{PresetManager.".concat(t.id,"}"),null,!0);"string"==typeof n&&t.baseId&&(n=e.optionalL("L{PresetManager.".concat(t.baseId,"}"),null,!0)),n&&"object"===W(n)&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&n.topDateFormat&&(n.middleDateFormat=n.middleDateFormat||n.topDateFormat),t.setData("displayDateFormat",n.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((function(e){var r=t.headerConfig[e],i=n[e+"DateFormat"];if(r){!r.originalDateFormat&&r.dateFormat&&(r.originalDateFormat=r.dateFormat),i&&r.renderer&&(r.renderer=null);var a=i||r.originalDateFormat;a&&(r.dateFormat=a)}})),n.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",n.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))}))}},{key:"getCurrentConfig",value:function(e){return B(t,"getCurrentConfig",this,3)([e]).data}},{key:"copyBaseValues",value:function(e){var t=this.getById(e.base);if(!t)throw new Error("ViewPreset base '".concat(e.base,"' does not exist."));return delete(t=Be.clone(t.data)).id,e.name&&delete t.name,Be.merge(t,e)}},{key:"add",value:function(e){var n=this;return(e=Array.isArray(e)?e:[e]).forEach((function(e){e.isViewPreset&&e.base&&(e.data=n.copyBaseValues(e.originalData))})),B(t,"add",this,3)(arguments)}}],[{key:"defaultConfig",get:function(){return{useRawData:!0,modelClass:Vw,zoomOrder:1}}}])}(Ya(Ff));S(Nw,"$name","PresetStore"),Nw._$name="PresetStore";var zw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"basePresets",get:function(){return this._basePresets},set:function(e){var t=this._basePresets={};for(var n in this.getConfig("modelClass"),e)e[n].id=n,t[n]=this.createRecord(e[n])}},{key:"defaultPresets",set:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t],a="string"==typeof r,o=a?r:r.base,l=void 0;if(a)l=this.basePresets[o];else{var s=Object.assign(Object.create({id:o}),Be.clone(this.basePresets[o].data)),u=s.timeResolution,c=s.headers[s.headers.length-1];s.id=i,"width"in r&&(s.tickWidth=r.width),"height"in r&&(s.tickHeight=r.height),"increment"in r&&(c.increment=r.increment),"resolution"in r&&(u.increment=r.resolution),"resolutionUnit"in r&&(u.unit=Pl.getUnitByName(r.resolutionUnit)),(l=this.createRecord(s)).baseId=o}this.add(l)}}},{key:"getById",value:function(e){return B(t,"getById",this,3)([e])||this.basePresets[e]}},{key:"registerPreset",value:function(e,t){var n=this.createRecord(Object.assign({id:e},t)),r=this.find((function(e){return e.equals(n)}));if(r)return r;if(!n.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(n),n}},{key:"getPreset",value:function(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof Vw||(e=this.createRecord(e)),e}},{key:"normalizePreset",value:function(e){var t=this;if(!(e instanceof Vw))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"===W(e)){if(e.base){var n=this.getById(e.base);if(!n)throw new Error("ViewPreset base '".concat(e.base,"' does not exist"));e=Be.merge(Be.clone(n.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(Be.assign({},e))).id=e.generateId(e)}return e}},{key:"deletePreset",value:function(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}}],[{key:"defaultConfig",get:function(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:function(e){return'\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">'.concat(Pl.format(e,"HH"),'</span>\n                                    <span class="b-sch-calendarcolumn-minutes">').concat(Pl.format(e,"mm"),"</span></div>\n                                ")}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:function(e){return'\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">'.concat(Pl.format(e,"HH"),'</span>\n                                    <span class="sch-calendarcolumn-minutes">').concat(Pl.format(e,"mm"),"</span>\n                                    </div>\n                                ")}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:function(e){if(1===Pl.weekStartDay){var t=_(Pl.getWeekNumber(e),2),n=t[0],r=t[1],i=Pl.getDateFromISOWeek(n,r,4),a=Pl.format(i,"MMM");return"".concat(Pl.getShortNameOfUnit("week"),".").concat(String(r).padStart(2,"0")," ").concat(a," ").concat(n)}return Pl.getShortNameOfUnit("week")+"."+Pl.format(e,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,mainHeaderLevel:0,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:function(e,t,n){return Pl.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:function(e,t){return e.getFullYear()+" - "+t.getFullYear()}},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}}])}(Nw);S(zw,"$name","PresetManager");var jw=new zw;r.bryntum.PresetManager=jw;var Ww=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"startDate",get:function(){return this.data.startDate}},{key:"endDate",get:function(){return this.data.endDate}}])}(Bw),$w=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;if(B(t,"construct",this,3)([e]),n.originalContinuous=n.continuous,n.ion({change:function(e){"filter"!==e.action&&n.trigger("reconfigure",{supressRefresh:!1})},refresh:function(){return n.trigger("reconfigure",{supressRefresh:!1})},endreconfigure:function(e){return n.trigger("reconfigure",e)}}),n.startDate)n.internalOnReconfigure(),n.trigger("reconfigure");else if(n.viewPreset){var r=n.getAdjustedDates(new Date);n.startDate=r.startDate,n.endDate=r.endDate}}},{key:"isTimeAxis",get:function(){return!0}},{key:"reconfigure",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.owner,o={},l=r.getAdjustedDates(e.startDate,e.endDate),s=!1;if(null!=a&&a.isBeforeMinDate(l.startDate)&&(e.startDate=null==a?void 0:a.minDate,s=!0),null!=a&&a.isAfterMaxDate(l.endDate)&&(e.endDate=null==a?void 0:a.maxDate,s=!0),s&&(l=r.getAdjustedDates(e.startDate,e.endDate)),!1!==r.trigger("beforeReconfigure",{startDate:l.startDate,endDate:l.endDate,config:e})){for(var u in r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate,e)o[u]=r[u];var c=e.viewPreset&&e.viewPreset!==r.viewPreset;if(c&&(n=r.isFiltered,r.filters.forEach((function(e){return e.disabled=!1}))),Object.assign(r,e),!1===r.internalOnReconfigure(n,c))return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:o})}}},{key:"internalOnReconfigure",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=arguments.length>1?arguments[1]:i,n=this;n.isConfigured=!0;var r=n.getAdjustedDates(n.startDate,n.endDate,!0),a=n.getAdjustedDates(n.startDate,n.endDate),o=a.startDate,l=a.endDate;if(o>=l)throw new Error("Invalid start/end dates. Start date must be less than end date. Start date: ".concat(o,". End date: ").concat(l,"."));var s=n.unit,u=n.increment,c=void 0===u?1:u,d=n.generateTicks(o,l,s,c)||n.constructor.prototype.generateTicks.call(n,o,l,s,c);n.suspendEvents(),n.maintainFilter=e,n.data=d,n.maintainFilter=!1;var h=n.count;if(0===h){if(e)return t&&n.disableFilters(),n.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}n.startDate=n.first.startDate,n.endDate=n.last.endDate,n.resumeEvents(),n.isContinuous?(n.adjustedStart=r.startDate,n.adjustedEnd=Pl.getNext(h>1?d[h-1].startDate:r.startDate,s,c,n.weekStartDay)):(n.adjustedStart=n.startDate,n.adjustedEnd=n.endDate),n.updateVisibleTickBoundaries(),n.updateTickCache(!0)}},{key:"updateVisibleTickBoundaries",value:function(){var e=this,t=e.count,n=e.unit,r=e.startDate,i=e.endDate,a=e.weekStartDay,o=e.increment,l=void 0===o?1:o,s=Pl.getNormalizedUnitDuration(r,n)*l,u=Pl.getNormalizedUnitDuration(i,n)*l;do{e.visibleTickStart=(r-e.adjustedStart)/s,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=Pl.getNext(e.adjustedStart,n,l,a))}while(e.visibleTickStart>=1);do{e.visibleTickEnd=t-(e.adjustedEnd-i)/u,t-e.visibleTickEnd>=1&&(e.adjustedEnd=Pl.getNext(e.adjustedEnd,n,-1,a))}while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}},{key:"viewPreset",get:function(){return this._viewPreset},set:function(e){if(!(e=jw.getPreset(e)).isViewPreset)throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}},{key:"weekStartDay",get:function(){var e;return null!==(e=this._weekStartDay)&&void 0!==e?e:Pl.weekStartDay}},{key:"resolution",get:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},set:function(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}},{key:"resolutionUnit",get:function(){return this.forceFullTicks?this.unit:this._resolutionUnit}},{key:"resolutionIncrement",get:function(){return this.forceFullTicks?this.increment:this._resolutionIncrement}},{key:"setTimeSpan",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];t&&e-t==0&&(t=null);var r=this,a=r.getAdjustedDates(e,t),o=a.startDate,l=a.endDate;if(r.startDate-o!=0||r.endDate-l!=0)return r.reconfigure({startDate:o,endDate:l},!1,n)}},{key:"shift",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.shiftUnit,n=this,r=n.startDate,a=n.endDate;n.isFiltered&&(r=n.allRecords[0].startDate,a=n.allRecords[n.totalCount-1].endDate);var o=0;do{r=Pl.add(r,e,t),a=Pl.add(a,e,t)}while(o++<n.maxTraverseTries&&!1===n.setTimeSpan(r,a,{preventThrow:!0}))}},{key:"shiftNext",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.shiftIncrement;this.shift(e)}},{key:"shiftPrevious",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.shiftIncrement;this.shift(-e)}},{key:"filterBy",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:this;this.filters.clear(),B(t,"filterBy",this,3)([function(t,r){return e.call(n,t.data,r)}])}},{key:"filter",value:function(){var e,n=this;n.viewportCenterDate=null===(e=n.owner)||void 0===e?void 0:e.viewportCenterDate;var r=B(t,"filter",this,3)(arguments);return n.maintainFilter||0!==n.count||(n.resumeEvents(),n.trigger("invalidFilter"),n.disableFilters()),r}},{key:"disableFilters",value:function(){this.filters.forEach((function(e){return e.disabled=!0})),this.filter()}},{key:"triggerFilterEvent",value:function(e){var n=this,r=n.owner;e.filters.count?n.continuous=!1:n.continuous=n.originalContinuous,n.updateTickCache(),null!=r&&r.infiniteScroll&&!n.continuous&&r.timeAxisViewModel.ion({update:function(){r.shiftToDate(n.viewportCenterDate,{visibleDate:n.viewportCenterDate,block:"center"})},once:!0}),B(t,"triggerFilterEvent",this,3)([e])}},{key:"isContinuous",get:function(){return!1!==this.continuous&&!this.isFiltered}},{key:"getAdjustedDates",value:function(e,t){var n,r,a=arguments.length>2&&arguments[2]!==i&&arguments[2],o=this,l=o.owner;t&&e-t==0&&(t=null),e=e||o.startDate,t=t||Pl.add(e,o.defaultSpan,o.mainUnit);var s=o.floorDate(e,!1,o.autoAdjust?o.mainUnit:o.unit,1),u=o.ceilDate(t,!1,o.autoAdjust?o.mainUnit:o.unit,1),c=u-s,d=null!==(n=null==l?void 0:l.getMinDateOrDate(s))&&void 0!==n?n:s,h=null!==(r=null==l?void 0:l.getMaxDateOrDate(u))&&void 0!==r?r:u;return h<=d&&(h=null==l?void 0:l.getMaxDateOrDate(Pl.add(d,c))),o.autoAdjust||a?{startDate:d,endDate:h}:{startDate:e,endDate:t}}},{key:"startDate",get:function(){return this._start||(this.first?new Date(this.first.startDate):null)},set:function(e){this._start=Pl.parse(e)}},{key:"endDate",get:function(){return this._end||(this.last?new Date(this.last.endDate):null)},set:function(e){e&&(this._end=Pl.parse(e))}},{key:"startMS",get:function(){return this._startMS}},{key:"endMS",get:function(){return this._endMS}},{key:"floorDate",value:function(e,t,n,r){var i=this,a=(t=!1!==t)?Pl.clone(i.startDate):null,o=r||i.resolutionIncrement,l=n||(t?i.resolutionUnit:i.mainUnit);if(t)return Pl.floor(e,{unit:l,magnitude:o},a);var s=Pl.clone(e);if("week"===l){var u=s.getDay()||7,c=i.weekStartDay||7;Pl.add(Pl.startOf(s,"day",!1),u>=c?c-u:-(7-c+u),"day",!1),s.getDay()!==c&&23===s.getHours()&&Pl.add(s,1,"hour",!1)}else{Pl.startOf(s,l,!1);var d=["day","year"].includes(l)?1:0,h="day"===l?"date":l,f=function(e,t){return Math.floor(e/t)*t}(Pl.get(s,h)-d,o)+d;Pl.set(s,h,f)}return s}},{key:"roundDate",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.resolutionUnit,r=arguments.length>3&&arguments[3]!==i?arguments[3]:this.resolutionIncrement||1,a=Pl.clone(e);switch(t=Pl.clone(t||this.startDate),n){case"week":Pl.startOf(a,"day",!1);var o,l=a.getDay()-this.weekStartDay;return l<0&&(l=7+l),o=1===Math.round(l/7)?7-l:-l,Pl.add(a,o,"day",!1);case"month":var s=Pl.diff(t,a,"month")+Pl.as("month",a.getDay()/Pl.daysInMonth(a)),u=Math.round(s/r)*r;return Pl.add(t,u,"month",!1);case"quarter":return Pl.startOf(a,"month",!1),Pl.add(a,3-a.getMonth()%3,"month",!1);default:var c=Pl.as(n,Pl.diff(t,a)),d="year"===n?0:Pl.as(n,t.getTimezoneOffset()-a.getTimezoneOffset(),"minute"),h=Math.round((c+d)/r)*r;return Pl.add(t,h-d,n,!1)}}},{key:"ceilDate",value:function(e,t,n,r){var i=this;t=!1!==t,r=r||(t?i.resolutionIncrement:1);var a=n||(t?i.resolutionUnit:i.mainUnit),o=Pl.clone(e),l=!1;switch(a){case"minute":l=!Pl.isStartOf(o,"minute");break;case"hour":l=!Pl.isStartOf(o,"hour");break;case"day":case"date":l=!Pl.isStartOf(o,"day");break;case"week":Pl.startOf(o,"day",!1),l=o.getDay()!==i.weekStartDay||!Pl.isEqual(o,e);break;case"month":Pl.startOf(o,"day",!1),l=1!==o.getDate()||!Pl.isEqual(o,e);break;case"quarter":Pl.startOf(o,"day",!1),l=o.getMonth()%3!=0||1!==o.getDate()||!Pl.isEqual(o,e);break;case"year":Pl.startOf(o,"day",!1),l=0!==o.getMonth()||1!==o.getDate()||!Pl.isEqual(o,e)}return l?Pl.getNext(o,a,r,i.weekStartDay):o}},{key:"include",get:function(){return this._include},set:function(e){var t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}},{key:"processExclusion",value:function(e,t,n){var r=this.include;return!!r&&Object.entries(r).some((function(r){var i=_(r,2),a=i[0],o=i[1];if(!o)return!1;var l=o.from,s=o.to;if(Pl.compareUnits("day",n)>=0&&Pl.getLargerUnit(a)===n&&(l&&Pl.set(e,a,l),s)){var u=n;"day"===n&&(u="date"),Pl.set(t,S(S({},u,Pl.get(t,u)-1),a,s))}if(Pl.compareUnits(a,n)>=0){var c="day"===a?e.getDay():Pl.get(e,a);if(l&&c<l||s&&c>=s)return!0}}))}},{key:"initExclusion",value:function(){Object.entries(this.include).forEach((function(e){var t=_(e,2),n=t[0],r=t[1];if(r){var i=r.from,a=r.to;r.lengthFactor=Pl.getUnitToBaseUnitRatio(n,Pl.getLargerUnit(n))/(a-i),r.lengthFactorExcl=Pl.getUnitToBaseUnitRatio(n,Pl.getLargerUnit(n))/(a-i-1),r.center=i+i/(r.lengthFactor-1)}}))}},{key:"updateGenerateTicks",value:function(){this.isConfiguring||this.reconfigure(this)}},{key:"_generateTicks",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.unit,r=arguments.length>3&&arguments[3]!==i?arguments[3]:this.increment,a=this,o=[],l=Boolean(a.include);a.validateTickCount();var s,u,c,d=0,h=a.getAdjustedDates(e,t),f=h.startDate,v=h.endDate,g=!1;for(a.tickCache={},l&&a.initExclusion();f<v;){if(s=Pl.getNext(f,n,r,a.weekStartDay),!a.autoAdjust&&s>v&&!g&&(s=new Date(v.getTime())),"hour"===n&&r>1&&o.length>0&&0===d){var m=o[o.length-1];0!==(d=(m.startDate.getHours()+r)%24-m.endDate.getHours())&&(s=Pl.add(s,d,"hour"))}if(c=!1,l){if(u=new Date(s.getTime()),c=a.processExclusion(f,s,n),g){if(!a.autoAdjust&&s>v){f=u;continue}}else if(s<f){g=!0;continue}}else u=s;c||(o.push({id:o.length+1,startDate:f,endDate:s}),a.tickCache[f.getTime()]=o.length-1),f=u}return o}},{key:"visibleTickTimeSpan",get:function(){var e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}},{key:"getTickFromDate",value:function(e){var t,n,r,i,a,o,l=this,s=l.records,u=null!==(t=null===(n=e.getTime)||void 0===n?void 0:n.call(e))&&void 0!==t?t:e,c=0,d=s.length-1;if(!s.length||u<s[0].startDateMS||u>s[d].endDateMS)return-1;if(l.isContinuous){for(;c<d;)u>s[r=c+d+1>>1].endDateMS?c=r+1:u<s[r].startDateMS?d=r-1:c=r;return u>(a=(i=s[c]).startDateMS)&&(c+=(u-a)/((o=i.endDateMS)-a)),Math.min(Math.max(c,l.visibleTickStart),l.visibleTickEnd)}for(var h=0;h<=d;h++)if(u<=(o=s[h].endDateMS))return i=h+(u>(a=s[h].startDateMS)?(u-a)/(o-a):0)}},{key:"getSnappedTickFromDate",value:function(e){var t=Math.floor(this.getTickFromDate(e));return this.getAt(t)}},{key:"getDateFromTick",value:function(e,t){var n=this;if(e===n.visibleTickEnd)return n.endDate;var r=Math.floor(e),i=e-r,a=n.getAt(r);if(!a)return null;var o=0===r&&n.isContinuous?n.adjustedStart:a.startDate,l=r===n.count-1&&n.isContinuous?n.adjustedEnd:a.endDate,s=Pl.add(o,i*(l-o),"millisecond");return t&&(s=n[t+"Date"](s)),s}},{key:"maxAllowedEndDate",get:function(){var e=this.maxAllowedTickCount*Pl.asMilliseconds(this.increment,this.unit);return Pl.add(Pl.parse(this.startDate),e)}},{key:"validateTickCount",value:function(){this.endDate>this.maxAllowedEndDate&&console.error("Configured date range will result in a too long time axis. If you required in long timeline, please use InfiniteScroll feature.")}},{key:"ticks",get:function(){return this.records}},{key:"updateTickCache",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach((function(e,n){return t.tickCache[e.startDate.getTime()]=n})))}},{key:"dateInAxis",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.startDate,a=n.endDate;if(n.isContinuous)return t?Pl.betweenLesserEqual(e,r,a):Pl.betweenLesser(e,r,a);for(var o,l,s,u=n.count,c=0;c<u;c++)if(o=(s=n.getAt(c)).startDate,l=s.endDate,t&&e<=l||!t&&e<l)return e>=o;return!1}},{key:"timeSpanInAxis",value:function(e,t){var n=this;return t&&t.getTime()!==e.getTime()?n.isContinuous?Pl.intersectSpans(e,t,n.startDate,n.endDate):e<n.startDate&&t>n.endDate||n.getTickFromDate(e)!==n.getTickFromDate(t):this.dateInAxis(e,!0)}},{key:"isTimeSpanInAxis",value:function(e){var t,n=this,r=n.startMS,i=n.endMS,a=e.startDateMS,o=null!==(t=e.endDateMS)&&void 0!==t?t:e.meta.endDateCached;if(!a||!o)return!1;if(o===a)return n.dateInAxis(e.startDate,!0);if(n.isContinuous)return o>r&&a<i;var l=n.getTickFromDate(a),s=n.getTickFromDate(o);return!(l===n.count&&Pl.isEqual(e.startDate,n.last.endDate)||0===s&&Pl.isEqual(e.endDate,n.first.startDate))&&(a<r&&o>i||l!==s)}},{key:"forEachAuxInterval",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:1,r=arguments.length>2?arguments[2]:i,a=arguments.length>3&&arguments[3]!==i?arguments[3]:this,o=this.endDate,l=this.startDate,s=0;if(l>o)throw new Error("Invalid time axis configuration");for(;l<o;)t=Pl.min(Pl.getNext(l,e,n,this.weekStartDay),o),r.call(a,l,t,s,t>=o),l=t,s++}}],[{key:"defaultConfig",get:function(){return{modelClass:Ww,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0},maxAllowedTickCount:1e4}}},{key:"configurable",get:function(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}}])}(Ff);$w._$name="TimeAxis";var Uw=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;n.unitToPixelsCache={},B(t,"construct",this,3)([e]);var r=n.timeAxis.viewPreset||n.viewPreset;if(r)if(r instanceof Vw)n.consumeViewPreset(r);else{var i=jw.getPreset(r);i&&n.consumeViewPreset(i)}n.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:n}),n.configured=!0}},{key:"doDestroy",value:function(){var e,n;null===(e=(n=this.timeAxis).un)||void 0===e||e.call(n,"reconfigure",this.onTimeAxisReconfigure,this),B(t,"doDestroy",this,3)([])}},{key:"columnConfig",get:function(){return this._columnConfig},set:function(e){this._columnConfig=e}},{key:"headers",get:function(){return this._headers},set:function(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}},{key:"isTimeAxisViewModel",get:function(){return!0}},{key:"isHorizontal",get:function(){return"vertical"!==this.mode}},{key:"isVertical",get:function(){return"vertical"===this.mode}},{key:"forceFit",get:function(){return this._forceFit},set:function(e){e!==this._forceFit&&(this._forceFit=e,this.update())}},{key:"reconfigure",value:function(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}},{key:"onTimeAxisReconfigure",value:function(e){var t=e.source,n=e.suppressRefresh;this.viewPreset!==t.viewPreset&&this.consumeViewPreset(t.viewPreset),!n&&t.count>0&&this.update()}},{key:"update",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this,o=a.timeAxis,l=a.headers,s=0!==e;if(a.isConfiguring||s&&a._availableSpace===e)r&&a.trigger("update");else{if(a._availableSpace=Math.max(e||a.availableSpace||0,0),"number"!=typeof a.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");a.columnConfig=[];var u=a._tickSize=a.calculateTickSize(a.originalTickSize);if("number"!=typeof u||u<0)throw new Error("Invalid timeAxis tick size");a.unitToPixelsCache={},a._totalSize=null;var c=Pl.weekStartDay;"number"==typeof(null===(t=a.owner)||void 0===t?void 0:t.weekStartDay)&&(Pl._weekStartDay=o.weekStartDay);for(var d=0,h=l.length;d<h;d++){var f=l[d];if(f.cellGenerator){var v=f.cellGenerator.call(a,o.startDate,o.endDate);a.columnConfig[d]=a.createHeaderRow(d,f,v)}else a.columnConfig[d]=a.createHeaderRow(d,f)}a.owner&&(Pl._weekStartDay=c),n||a.trigger("update")}}},{key:"getDistanceBetweenDates",value:function(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}},{key:"getDistanceForDuration",value:function(e){return this.getSingleUnitInPixels("millisecond")*e}},{key:"getPositionFromDate",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},n=this.getScaledTick(e,t);return-1===n?-1:this.tickSize*(n-this.timeAxis.visibleTickStart)}},{key:"getScaledTick",value:function(e,t){var n=t.respectExclusion,r=t.snapToNextIncluded,i=t.isEnd,a=t.min,o=t.max,l=this.timeAxis,s=l.include,u=l.unit,c=l.getTickFromDate(e);if(-1!==c&&n&&s){var d=!1;if(s.hour&&Pl.compareUnits(u,"hour")>0&&"day"!==u){var h=s.hour,f=h.from,v=h.to,g=h.lengthFactor,m=h.center,p=e.getHours(),y=Math.min(Math.max(p,f),v);if(!r&&y!==p)return-1;var k=m-(m-(y+e.getMinutes()/60))*g;e=Pl.add(e,k-p,"h"),d=!0}if(s.day&&Pl.compareUnits(u,"day")>0){var b=s.day,C=b.from,w=b.to,D=b.lengthFactor,S=b.center,x=e.getDay();i&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--x<0&&(x=6);var E=0;if(x<C||x>=w){if(!r)return-1;if(E=i?(w-x-8)%7:(C-x+7)%7,e=Pl.add(e,E,"d"),e=Pl.startOf(e,"d",!1,l.weekStartDay),o&&e.getTime()>=o||a&&e.getTime()<=a)return-1}var R=l.weekStartDay,T=0===e.getDay()?0:S,M=e.getDay()+e.getHours()/24,F=T-(T-M)*D;e=Pl.add(e,F-M+R,"d"),d=!0}d&&(e=Pl.constrain(e,l.startDate,l.endDate),c=l.getTickFromDate(e))}return c}},{key:"getDateFromPosition",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=this,o=a.timeAxis,l=a.getScaledPosition(e)/a.tickSize+o.visibleTickStart;return l<0||l>o.count?r?(n=l<0?Pl.add(o.startDate,l,o.unit):Pl.add(o.endDate,l-o.count,o.unit),t&&(n=o[t+"Date"](n)),n):null:o.getDateFromTick(l,t)}},{key:"getScaledPosition",value:function(e){var t=this.timeAxis,n=t.include,r=t.unit,i=t.weekStartDay;if(n){var a=this.getSingleUnitInPixels("day");if(n.day&&Pl.compareUnits(r,"day")>0){var o=n.day,l=o.from,s=e%(7*a);e=s/o.lengthFactor+(l-i)*a+(e-s)}if(n.hour&&Pl.compareUnits(r,"hour")>0&&"day"!==r){var u=n.hour,c=u.from,d=e%a;e=d/u.lengthFactorExcl+c*this.getSingleUnitInPixels("hour")+(e-d)}}return e}},{key:"getSingleUnitInPixels",value:function(e){var t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=Pl.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}},{key:"snapPixelAmount",get:function(){if(this.snap){var e=this.timeAxis.resolution;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}},{key:"tickSize",get:function(){return this._tickSize},set:function(e){this.setTickSize(e,!1)}},{key:"setTickSize",value:function(e,t){this._tickSize=this.originalTickSize=e,this.update(i,t)}},{key:"timeResolution",get:function(){return this.timeAxis.resolution}},{key:"calculateTickSize",value:function(e){var t=this,n=t.forceFit,r=t.timeAxis,i=t.suppressFit,a=r.unit,o=0,l=1;if(t.snap){var s=r.resolution;l=Pl.getUnitToBaseUnitRatio(a,s.unit)*s.increment}if(i)o=e;else{var u=t.availableSpace/r.visibleTickTimeSpan;o=n||e<u?u:e,l>0&&(!n||l<1)&&(o=Math.max(1,l*o)/l)}return o}},{key:"totalSize",get:function(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}},{key:"availableSpace",get:function(){return this._availableSpace},set:function(e){var t=this,n=t._availableSpace;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){var r=t.calculateTickSize(t.originalTickSize);r>0&&(r!==t.tickSize||0===n)&&t.update()}}},{key:"getDates",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.columnLinesFor,t=arguments.length>2&&arguments[2]!==i&&arguments[2],n=this,r=[],a=arguments.length>1&&arguments[1]!==i&&arguments[1]?n.lowestHeader:e,o=n.majorHeaderLevel,l=n.headers&&n.headers[e].unit,s=null!=o&&n.headers&&n.headers[o].unit,u=null!=o&&Pl.doesUnitsAlign(s,l);if(Boolean(n.headers&&n.headers[a].cellGenerator))for(var c=n.columnConfig[a],d=1,h=c.length;d<h;d++)r.push({date:c[d].startDate});else n.forEachInterval(a,(function(i,a){r.push({date:t?a:i,isMajor:o!==e&&u&&n.isMajorTick(t?a:i)})}));return r}},{key:"fitToAvailableSpace",value:function(e){var t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}},{key:"snap",get:function(){return this._snap},set:function(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}},{key:"createHeaderRow",value:function(e,t,n){var r=this,i=[],a=t.align,o=t.headerCellCls,l=void 0===o?"":o,s=Pl.clearTime(new Date),u=r.timeAxis,c=r.headers.length-1,d=function(n,o,d,f,v){var g=Pl.format(n,t.dateFormat),m=d>0&&!f,p={align:a,start:n,end:o,value:v?v.header:g,headerCellCls:l,width:c===e&&r.owner&&(u.fullTicks||m)?r.owner.tickSize:r.getDistanceBetweenDates(n,o),index:d};0!==p.width&&(p.coord=h-1,h+=p.width,r.headersDatesCache[e][n.getTime()]=1,t.renderer&&(g=t.renderer.call(t.thisObj||r,n,o,p,d,r.owner),p.value=null==g?"":g),"day"!==t.unit||t.increment&&1!==t.increment||(p.headerCellCls+=" b-sch-dayheadercell-"+n.getDay(),Pl.clearTime(n,!0)-s==0&&(p.headerCellCls+=" b-sch-dayheadercell-today")),i.push(p))},h=0;return r.headersDatesCache[e]={},n?n.forEach((function(e,t){return d(e.start,e.end,t,t===n.length-1,e)})):r.forEachInterval(e,d),i}},{key:"mainHeader",get:function(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}},{key:"bottomHeader",get:function(){return this.headers[this.headers.length-1]}},{key:"lowestHeader",get:function(){return this.headers.length-1}},{key:"majorHeaderLevel",get:function(){var e=this.headers;return e?Math.max(e.length-2,0):null}},{key:"isMajorTick",value:function(e){var t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}},{key:"forEachInterval",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this,r=this.headers,a=this.timeAxis;if(r)if(e===r.length-1)a.forEach((function(e,r){return t.call(n,e.startDate,e.endDate,r,r===a.count-1)}));else{var o=r[e];a.forEachAuxInterval(o.unit,o.increment,t,n)}}},{key:"forEachMainInterval",value:function(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}},{key:"consumeViewPreset",value:function(e){var t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}],[{key:"defaultConfig",get:function(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}}])}(_n());Uw._$name="TimeAxisViewModel";var Gw,Yw=new Date,qw=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getRtlX",value:function(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}},{key:"getDateFromCoordinate",value:function(e,t){var n=arguments.length>3&&arguments[3]!==i&&arguments[3],r=arguments.length>4&&arguments[4]!==i&&arguments[4];return!(arguments.length>2&&arguments[2]!==i)||arguments[2]||(e=this.currentOrientation.translateToScheduleCoordinate(e)),r||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,t,n)}},{key:"getDateFromCoord",value:function(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}},{key:"getDateFromVirtualCoord",value:function(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,!0)}},{key:"getDateFromXY",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=arguments.length>3&&arguments[3]!==i&&arguments[3];return this.currentOrientation.getDateFromXY(e,t,n,r)}},{key:"getDateFromDomEvent",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];return this.getDateFromXY([e.pageX,e.pageY],t,!1,n)}},{key:"getStartEndDatesFromRectangle",value:function(e,t,n){var r,a,o=arguments.length>3&&arguments[3]!==i&&arguments[3],l=!(arguments.length>4&&arguments[4]!==i)||arguments[4],s=this,u=s.isHorizontal,c=u?e.x:e.top,d=u?e.right:e.bottom;return c>=0&&d<s.timeAxisViewModel.totalSize?(r=s.getDateFromCoordinate(c,t,l),a=s.getDateFromCoordinate(d,t,l)):c<0?r=(a=s.getDateFromCoordinate(d,t,l,o))&&Pl.add(a,-n,"ms"):a=(r=s.getDateFromCoordinate(c,t,l,o))&&Pl.add(r,n,"ms"),{start:r,end:a}}},{key:"getDisplayEndDate",value:function(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||Pl.formatContainsHourInfo(this.displayDateFormat)||(e=Pl.add(e,-1,"day")),e}},{key:"getFormattedEndDate",value:function(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}},{key:"getCoordinateFromDate",value:function(e){var t,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1];if(!e)throw new Error("Invalid date passed to getCoordinateFromDate");var r,a=this,o=a.timeAxisViewModel,l=a.timeAxis,s=l.isContinuous,u=l.startMS,c=l.endMS,d=l.startDate,h=l.endDate,f=l.unit,v=e.valueOf();if(!0===n?n={local:!0}:n?"local"in n||(n.local=!0):n={local:!1},e instanceof Date||(Yw.setTime(e),e=Yw),s&&e.getTimezoneOffset()===d.getTimezoneOffset()&&d.getTimezoneOffset()===h.getTimezoneOffset()&&-1!==Pl.getUnitToBaseUnitRatio(f,"day")){if(v<u||v>c)return-1;r=(v-u)/(c-u)*o.totalSize}else r=o.getPositionFromDate(e,n);return!a.rtl||!a.isHorizontal||null!==(t=n)&&void 0!==t&&t.ignoreRTL||(r=o.totalSize-r),n.local||(r=a.currentOrientation.translateToPageCoordinate(r)),r}},{key:"getVirtualCoordFromDate",value:function(e,t){return this.getCoordinateFromDate(e,F(F({},t),{},{ignoreRTL:!0}))}},{key:"getTimeSpanDistance",value:function(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}},{key:"viewportCenterDate",get:function(){if(this.isVisible){var e=this.timeAxis,t=this.timelineScroller;if(e.isContinuous){var n=(t.position+t.clientSize/2)/t.scrollSize;return new Date(e.startMS+(e.endMS-e.startMS)*n)}return this.getDateFromCoordinate(t.position+t.clientSize/2)}}},{key:"viewportCenterDateCached",get:function(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}},{key:"timeResolution",get:function(){return this.timeAxis.resolution},set:function(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}},{key:"snap",get:function(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.snap)&&void 0!==e?e:this._snap}},{key:"updateSnap",value:function(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}},{key:"onSchedulerHorizontalScroll",value:function(e,t,n,r){r||(this.cachedCenterDate=null)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","TimelineDateMapper"),S(t,"configurable",{snap:!1}),t},Kw=fr.eventNameMap,Xw=function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"hoveredEvents",new o),e}return R(t,e),w(t,[{key:"initDomEvents",value:function(){var e=this,t=e.schedulerEvents;t.element=e.timeAxisSubGridElement,t.thisObj=e,fr.on(t),fr.on({element:e.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:e}),e.updateTimelineContextOnScroll&&ne.supportsPointerEventConstructor&&fr.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e})}},{key:"getTimeSpanMouseEventParams",value:function(e,t){throw new Error("Implement in subclass")}},{key:"getScheduleMouseEventParams",value:function(e,t){throw new Error("Implement in subclass")}},{key:"handleScheduleEvent",value:function(e){var t=this;if(!t.ignoreDomEventsWhileScrolling||!t.scrolling&&!t.timeAxisSubGrid.scrolling){var n=t.getTimelineEventContext(e);t.lastPointerEvent=e,n&&t.trigger("".concat(n.eventElement?t.scheduledEventName:"schedule").concat(Kw[n.domEvent.type]||Le.capitalize(n.domEvent.type)),n),t.timelineContext=n}}},{key:"handleScheduleLeaveEvent",value:function(e){e.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(e)}},{key:"onScheduleScroll",value:function(e){var t,n=e.target,r=this;if(n&&r.updateTimelineContextOnScroll&&(null===(t=r.features.pan)||void 0===t||!t.isActive)&&!r.partners.some((function(e){var t;return null===(t=e.features.pan)||void 0===t?void 0:t.isActive}))&&(n.contains(r.element)||r.bodyElement.contains(n))){var i=r.timelineContext,a=r.lastPointerEvent;if(i){var o,l,s,u,c=li.elementFromPoint(i.domEvent.clientX,i.domEvent.clientY),d=new ne.PointerEventConstructor("pointermove",a),h=new MouseEvent("mousemove",a);Object.defineProperty(d,"pointerId",{value:null!==(o=null!==(l=null===(s=Wn.currentPointerDown)||void 0===s?void 0:s.pointerId)&&void 0!==l?l:null===(u=Wn.currentTouch)||void 0===u?void 0:u.identifier)&&void 0!==o?o:1}),d.scrollInitiated=h.scrollInitiated=!0,null==c||c.dispatchEvent(d),null==c||c.dispatchEvent(h)}}}},{key:"updateTimelineContext",value:function(e,t){this.trigger("timelineContextChange",{oldContext:t,context:e}),e&&!t?this.trigger("scheduleMouseEnter",e):e||this.trigger("scheduleMouseLeave",{event:t.event})}},{key:"getTimelineEventContext",value:function(e){var t=this,n=t.features.scheduleContext;if(n){var r,i,a=n.context,o=e.type,l=o.endsWith("leave")||o.endsWith("out")?e.relatedTarget:e.target;if(a&&(null!==(r=n.widget)&&void 0!==r&&r.owns(l)||n.element.contains(l)))return n.element.style.pointerEvents="none",a.eventElement=null===(i=document.elementFromPoint(e.clientX,e.clientY))||void 0===i?void 0:i.closest(t.eventSelector),a.eventRecord=t.resolveEventRecord(a.eventElement),n.element.style.pointerEvents="",t._timelineContext=null,a}var s=e.target.closest(t.eventInnerSelector),u=t.getCellElementFromDomEvent(e);if(u){var c=t.getDateFromDomEvent(e);if(!c)return;var d=t.timeAxis.floorDate(c),h=wa.get(u),f=s?t.getTimeSpanMouseEventParams(s,e):t.getScheduleMouseEventParams(h,e);if(!f)return;var v=t.isVertical?t.resourceStore.indexOf(f.resourceRecord):h.row.dataIndex,g=t.timeAxis.getTickFromDate(d),m=t.timeAxis.getAt(Math.floor(g));if(m)return F({scheduler:t,isTimelineContext:!0,domEvent:e,eventElement:s,cellElement:u,index:v,tick:m,tickIndex:g,date:d,time:c,tickStartDate:m.startDate,tickEndDate:m.endDate,tickParentIndex:m.parentIndex,row:h.row,event:e},f)}}},{key:"getCellElementFromDomEvent",value:function(e){var t,n=e.target,r=e.clientY,i=e.type,a=this,o=a.isVertical,l=a.foregroundCanvas,s=n.closest(a.eventSelector);if(o)return a.timeAxisSubGridElement.querySelector(a.timeCellSelector);if(s)return a.getCell({record:a.resolveRowRecord(s)||a.store.getAt(a.rowManager.getRowAt(r,!1).dataIndex),column:a.timeAxisColumn});if(l.contains(n)&&(n===l||n.closest(".b-sch-resourcetimerange")||"mousemove"===i))return null===(t=a.rowManager.getRowAt(r,!1))||void 0===t?void 0:t.getCell(a.timeAxisColumn.id);return n.matches(".b-grid-row")?n.firstElementChild:n.closest(a.timeCellSelector)}},{key:"matchScheduleCell",value:function(e){return e.closest(this.timeCellSelector)}},{key:"onElementMouseButtonEvent",value:function(e){var t=e.target.closest(".b-sch-header-timeaxis-cell");if(t){var n=this,r=t.parentElement.dataset.headerPosition,i=n.timeAxisViewModel.columnConfig[r],a=n.timeAxis.isFiltered?i.findIndex((function(e){return e.index==t.dataset.tickIndex})):t.dataset.tickIndex,o=i[a],l=n.features.contextMenu;l&&e.type===l.triggerEvent||this.trigger("timeAxisHeader".concat(Le.capitalize(e.type)),{startDate:o.start,endDate:o.end,event:e})}}},{key:"onElementMouseDown",value:function(e){this.onElementMouseButtonEvent(e),B(t,"onElementMouseDown",this,3)([e])}},{key:"onElementClick",value:function(e){this.onElementMouseButtonEvent(e),B(t,"onElementClick",this,3)([e])}},{key:"onElementDblClick",value:function(e){this.onElementMouseButtonEvent(e),B(t,"onElementDblClick",this,3)([e])}},{key:"onElementContextMenu",value:function(e){this.onElementMouseButtonEvent(e),B(t,"onElementContextMenu",this,3)([e])}},{key:"onElementMouseOver",value:function(e){var n,r=this;if(!r.ignoreDomEventsWhileScrolling||!r.scrolling&&!r.timeAxisSubGrid.scrolling){B(t,"onElementMouseOver",this,3)([e]);var i=e.target,a=r.hoveredEvents;if(!i.closest(r.eventInnerSelector)&&!i.matches(".b-sch-terminal-hover-area")||null!==(n=r.features.eventDrag)&&void 0!==n&&n.isDragging)a.size&&r.unhoverAll(e);else{var o=i.closest(r.eventSelector);if(!a.has(o)&&!r.preventOverCls){a.add(o),o.classList.add(r.overScheduledEventClass);var l=r.getTimeSpanMouseEventParams(o,e);l&&r.trigger("".concat(r.scheduledEventName,"MouseEnter"),l)}}}}},{key:"onElementMouseOut",value:function(e){var n,r=this,i=r.features,a=e.target,o=e.relatedTarget;null!=o&&o.closest(".b-sch-canvas *")||B(t,"onElementMouseOut",this,3)([e]);var l=a.closest(r.eventSelector),s=null==l?void 0:l.querySelector(r.eventInnerSelector),u=l&&r.resolveTimeSpanRecord(l);s&&u&&r.hoveredEvents.has(l)&&(null===(n=i.eventDrag)||void 0===n||!n.isDragging)&&o&&(li.isDescendant(s,o)||o.matches(".b-sch-terminal-hover-area"))||l&&r.hoveredEvents.size&&r.unhover(l,e)}},{key:"unhover",value:function(e,t){var n=this;e.classList.remove(n.overScheduledEventClass),n.getTimeSpanMouseEventParams(e,t)&&n.trigger("".concat(n.scheduledEventName,"MouseLeave"),n.getTimeSpanMouseEventParams(e,t)),n.hoveredEvents.delete(e)}},{key:"unhoverAll",value:function(e){var t,n=D(this.hoveredEvents);try{for(n.s();!(t=n.n()).done;){var r=t.value;!r.isReleased&&!r.classList.contains("b-released")&&this.unhover(r,e)}}catch(e){n.e(e)}finally{n.f()}this.hoveredEvents.clear()}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","TimelineDomEvents"),S(t,"configurable",{timelineContext:{$config:{equal:function(e,t){return(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))&&(null==e?void 0:e.eventRecord)===(null==t?void 0:t.eventRecord)}}},updateTimelineContextOnScroll:!1,ignoreDomEventsWhileScrolling:null}),S(t,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}}),S(t,"delayable",{onScheduleScroll:"raf"}),t},Zw=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changePresets",value:function(e){var t={owner:this,data:!0===e?jw.data:[]};if(!0!==e)if(Array.isArray(e)){var n,r=D(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if("string"==typeof i){var a=jw.getById(i);a&&t.data.push(a.data)}else t.data.push(i)}}catch(e){r.e(e)}finally{r.f()}}else Be.assign(t,e);return new Nw(t)}},{key:"changeViewPreset",value:function(e,t){var n=this,r=n.presets;e?(e=r.createRecord(e),r.includes(e)||r.add(e)):e=r.first;var i=n.lastViewPresetOptions||{},a=e.options||(e.options={}),o=F(F({},a),{},{from:t,to:e,preset:e}),l=!n._viewPreset||!n._viewPreset.equals(e);if(delete i.event,(l||!Be.isEqual(a,i))&&(a.event=o,l||(n._viewPreset=null),n.isConfiguring||!1!==n.trigger("beforePresetChange",o)))return e}},{key:"displayDateFormat",get:function(){return this._displayDateFormat||this.viewPreset.displayDateFormat}},{key:"updateDisplayDateFormat",value:function(e){this.trigger("displayDateFormatChange",{format:e})}},{key:"getFormattedDate",value:function(e){return Pl.format(e,this.displayDateFormat)}},{key:"updateViewPreset",value:function(e){var t,n=this,r=e.options,i=r.event,a=r.startDate,o=r.endDate,l=n.hasTimelineBoundaries,s=n.isHorizontal,u=n._timeAxis,c=n._timeAxisViewModel,d=s&&n.rtl,h=r.centerDate,f=r.zoomDate,v=r.zoomPosition,g=!1;if(null===(t=n.syncSplits)||void 0===t||t.call(n,(function(t){return t.viewPreset=e})),delete e.options,n._viewPresetChanging=!0,u&&!n.isConfiguring){var m=n.timelineScroller;if(n.lastViewPresetOptions=r,u.isConfigured){n.suspendRefresh();var p=Be.copyProperties({},n,["weekStartDay","startTime","endTime"]);n.range&&n.calendar&&!n.isConfiguring?(p.startDate=n.startDate,p.endDate=n.endDate):n.infiniteScroll?Object.assign(p,n.calculateInfiniteScrollingDateRange(h||(a&&o?new Date((a.getTime()+o.getTime())/2):n.viewportCenterDateCached),!0,e)):a?(p.startDate=a,p.endDate=o,!h&&o&&(h=new Date((a.getTime()+o.getTime())/2))):(p.startDate=u.startDate,p.endDate=o||u.endDate,h||(h=n.viewportCenterDate)),u.isConfigured=!1,p.viewPreset=e,u.reconfigure(p,!0),c.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:r.tickSize||(s?e.tickWidth:e.tickHeight||e.tickWidth||60)}),r.tickSize&&(n.tickSize=r.tickSize),n.resumeRefresh(!1)}if(n.refresh(),!r.notScroll&&n.isPainted)if("scrollPosition"in r)g=m.position===r.scrollPosition,m.scrollTo(r.scrollPosition);else if(r.visibleDate)n.visibleDate=r.visibleDate;else if(f&&v){var y=15,k="minute";Pl.compareUnits(u.resolutionUnit,"hour")>0&&(y=1,k="hour");var b=Pl.asMilliseconds(y,k),C=new Date(Math.round(f/b)*b);i.zoomDate=f,i.zoomPosition=v,i.zoomLevel=r.zoomLevel,l&&0==m.position&&n.currentOrientation.updateFromHorizontalScroll(0,!0,!0),m.position=d?m.scrollWidth-(n.getCoordinateFromDate(C)+v):n.getCoordinateFromDate(C)-v}else if(h){n.cachedCenterDate=h,i.centerDate=h;var w=n.timelineScroller.clientSize,D=d?n.timeAxisViewModel.totalSize-n.getCoordinateFromDate(h,!0):n.getCoordinateFromDate(h,!0),S=Math.max(D-w/2,0);S===(n.isHorizontal?n.scrollLeft:n.scrollTop)?g=!0:n.isHorizontal?n.scrollHorizontallyTo(S,{scrollingToCenter:!0}):n.scrollVerticallyTo(S,{scrollingToCenter:!0})}else 0===(n.isHorizontal?n.scrollLeft:n.scrollTop)?g=!0:n.timelineScroller.scrollTo(0)}n.dataset.presetId=e.id,e.rowHeight&&!n.initialConfig.rowHeight&&(n.rowHeight=e.rowHeight),n.trigger("presetChange",i),n._viewPresetChanging=!1,g&&(n.isHorizontal?n.currentOrientation.updateFromHorizontalScroll(n.scrollLeft,!0):n.currentOrientation.updateFromVerticalScroll(n.scrollTop))}},{key:"doDestroy",value:function(){this._presets.owner===this&&this._presets.destroy(),B(t,"doDestroy",this,3)([])}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return n.viewPreset&&n.viewPreset.name&&!n.viewPreset.base&&delete n.viewPreset.name,n}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}}])}(e||Mn),S(t,"$name","TimelineViewPresets"),t},Jw=function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"lastWheelTime",-1),S(e,"lastZoomPosition",-1),e}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)([e]),n.zoomOnMouseWheel&&fr.on({element:n.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:function(e){return(e.ctrlKey||e.metaKey)&&e.preventDefault()}},thisObj:n,capture:!0,passive:!1}),n.zoomOnTimeAxisDoubleClick&&n.ion({timeaxisheaderdblclick:function(e){var t=e.startDate,r=e.endDate;n.forceFit||n.zoomToSpan({startDate:t,endDate:r})}})}},{key:"maxZoomLevel",get:function(){return this._maxZoomLevel||this.presets.count-1},set:function(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}},{key:"minZoomLevel",get:function(){return this._minZoomLevel},set:function(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}},{key:"zoomLevel",get:function(){return this.presets.indexOf(this.viewPreset)},set:function(e){this.zoomToLevel(e)}},{key:"getMilliSecondsPerPixelForZoomLevel",value:function(e,t){var n=e.bottomHeader,r=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((Pl.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(t?r:e.actualWidth||r))}},{key:"zoomTo",value:function(e){var t=this;"object"===W(e)?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}},{key:"zoomToLevel",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},n=this;if(n.forceFit)return console.warn("Warning: The forceFit setting and zooming cannot be combined"),null;"number"==typeof e&&(e=Math.min(Math.max(e,n.minZoomLevel),n.maxZoomLevel));var r=n.presets,a=n.isVertical?"tickHeight":"tickWidth",o=r.createRecord(e),l=o[a],s=t.startDate?new Date(t.startDate):null,u=t.endDate?new Date(t.endDate):null;r.add(o);var c=s&&u?{startDate:s,endDate:u}:null,d=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width,h=t.centerDate?new Date(t.centerDate):c?new Date((s.getTime()+u.getTime())/2):n.viewportCenterDateCached;if(0===d){var f=n.timeAxisSubGrid._beforeCollapseState;if(!(n.isHorizontal&&n.timeAxisSubGrid.collapsed&&null!=f&&f.width))return null;d=f.width}return c||(c=n.calculateOptimalDateRange(h,d,o)),"width"in t&&o.setData(a,t.width),n.isZooming=!0,o.options=F(F({},t),{},{startDate:c.startDate||n.startDate,endDate:c.endDate||n.endDate,centerDate:h}),n.viewPreset=o,o.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,o.setData(a,l),n.zoomLevel}},{key:"zoomToFit",value:function(e){var t=this.eventStore.getTotalTimeSpan();(e=F(F({leftMargin:0,rightMargin:0},e),t)).startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}},{key:"zoomToSpan",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this,n=t.timeAxisViewModel.availableSpace,r=e.endDate-e.startDate;if(!(n<=0)){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");e.startDate=t.getMinDateOrDate(e.startDate),e.endDate=t.getMaxDateOrDate(e.endDate),e.endDate<=e.startDate&&(e.endDate=t.getMaxDateOrDate(Pl.add(e.startDate,r)));var a=t.timeAxis,o=e.adjustStart>=0||e.adjustEnd>=0,l=e.startDate,s=e.endDate;if(o&&(l=Pl.add(l,-e.adjustStart,a.mainUnit),s=Pl.add(s,e.adjustEnd,a.mainUnit)),l<=s){var u,c,d=t.presets.allRecords,h=s-l||1,f=t.zoomLevel;-1===f&&(f=0);for(var v,g=t.getMilliSecondsPerPixelForZoomLevel(d[f]),m=f+(u=h/g+e.leftMargin+e.rightMargin>n?-1:1),p=null;m>=0&&m<=d.length-1;){v=d[m];var y=h/(g=t.getMilliSecondsPerPixelForZoomLevel(v))+e.leftMargin+e.rightMargin;if(-1===u){if(y<=n){p=m;break}}else{if(!(y<=n))break;f!==m-u&&(p=m)}m+=u}var k=(v=d[p=null!=p?p:m-u]).bottomHeader.unit;g=t.getMilliSecondsPerPixelForZoomLevel(v),(e.leftMargin||e.rightMargin)&&(l=new Date(l.getTime()-g*e.leftMargin),s=new Date(s.getTime()+g*e.rightMargin));var b=Pl.getDurationInUnit(l,s,k,!0)/v.bottomHeader.increment;if(0===b)return null;var C=Math.floor(n/b),w=e.centerDate||new Date((l.getTime()+s.getTime())/2);c=o?{startDate:l,endDate:s}:t.calculateOptimalDateRange(w,n,v);var D=t.zoomLevel;return t.zoomLevel===p?a.reconfigure(c):D=t.zoomToLevel(p,Object.assign(c,{width:C,centerDate:w})),this.trigger("zoomToSpan",{zoomLevel:p,startDate:l,endDate:s,centerDate:w}),D}return null}}},{key:"zoomIn",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:1,t=arguments.length>1?arguments[1]:i;"object"===W(e)&&(t=e,e=1);var n=this.zoomLevel;return n>=this.maxZoomLevel?null:this.zoomToLevel(n+e,t)}},{key:"zoomOut",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:1,t=arguments.length>1?arguments[1]:i;"object"===W(e)&&(t=e,e=1);var n=this.zoomLevel;return n<=this.minZoomLevel?null:this.zoomToLevel(n-e,t)}},{key:"zoomInFull",value:function(e){return this.zoomToLevel(this.maxZoomLevel,e)}},{key:"zoomOutFull",value:function(e){return this.zoomToLevel(this.minZoomLevel,e)}},{key:"calculateOptimalDateRange",value:function(e,t,n){var r=this,i=r.timeAxis,a=r.minDate,o=r.maxDate,l=n.bottomHeader,s=r.isHorizontal?n.tickWidth:n.tickHeight;if(r._originalConfiguredDateRange=r._originalConfiguredDateRange||{startDate:r.startDate,endDate:r.endDate},r.zoomKeepsOriginalTimespan)return r.getAllowedDateRange(e,n);var u=l.unit,c=Math.ceil(t/s*l.increment*r.visibleZoomFactor/2),d=Pl.add(e,-c,u),h=Pl.add(e,c,u);return r.isBeforeMinDate(d)?(d=a,h=Pl.add(d,2*c,u)):r.isAfterMaxDate(h)&&(h=o,d=Pl.add(h,-2*c,u)),{startDate:i.floorDate(d,!1,u,l.increment),endDate:i.ceilDate(h,!1,u,l.increment)}}},{key:"getAllowedDateRange",value:function(e,t){var n=this;e=e||new Date((n.startDate.getTime()+n.endDate.getTime())/2),t=t||n.viewPreset;var r=n.timeAxis,i=t.bottomHeader,a=r.maxAllowedTickCount,o=Math.ceil(a*Pl.asMilliseconds(i.increment,i.unit)/2),l=Pl.add(e,o);if(this.endDate>l)return console.warn("Warn: start/end dates exceeds max allowed date range for current viewPreset, it was recalculated automatically."),{startDate:Pl.add(e,-o),endDate:Pl.add(e,o)};var s=n._originalConfiguredDateRange||n,u=s.startDate,c=s.endDate;return c<l?{startDate:u,endDate:c}:{startDate:r.startDate,endDate:r.endDate}}},{key:"onElementMouseMove",value:function(e){var n=this.isHorizontal,r=this.zoomContext;B(t,"onElementMouseMove",this,3)([e]),e.isTrusted&&r&&Math.abs(e["client".concat(n?"X":"Y")]-r.coordinate)>10&&(this.zoomContext=null)}},{key:"onWheel",value:function(e){if((e.ctrlKey||e.metaKey)&&!this.forceFit){e.preventDefault();var t=this,n=t.zoomContext,r=t.isHorizontal,a=t.timelineScroller,o=t.zoomLevel,l=performance.now(),s=e["client".concat(r?"X":"Y")],u=s-a.viewport["".concat(r?"x":"y")];r&&t.rtl&&(u=a.viewport.width+a.viewport.x-s),l-t.lastWheelTime>200||!n||Math.abs(s-t.zoomContext.coordinate)>20?t.zoomContext={zoomLevel:o,coordinate:s,zoomPosition:u,zoomDate:t.getDateFromDomEvent(e)}:(o>n.zoomLevel&&(n.zoomDate=t.getDateFromDomEvent(e),n.zoomLevel=o),n.zoomPosition=u),t.lastWheelTime=l,t["zoom".concat(e.deltaY>0?"Out":"In")](i,t.zoomContext)}}},{key:"shift",value:function(e,t){this.timeAxis.shift(e,t)}},{key:"shiftNext",value:function(e){this.timeAxis.shiftNext(e)}},{key:"shiftPrevious",value:function(e){this.timeAxis.shiftPrevious(e)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","TimelineZoomable"),S(t,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),t},Qw=function(e){var t;return null===(t=e.enableRecurringEvents)||void 0===t?void 0:t.defaultAction},eD=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeMultipleButton",get:function(){return this.widgetMap.changeMultipleButton}},{key:"changeSingleButton",get:function(){return this.widgetMap.changeSingleButton}},{key:"cancelButton",get:function(){return this.widgetMap.cancelButton}},{key:"onChangeMultipleButtonClick",value:function(){this.processMultipleRecords(),this.hide()}},{key:"onChangeSingleButtonClick",value:function(){this.processSingleRecord(),this.hide()}},{key:"onCancelButtonClick",value:function(){var e;null===(e=this.cancelFn)||void 0===e||e.call(this.thisObj),this.hide()}},{key:"onRecurrenceClose",value:function(){var e;null===(e=this.cancelFn)||void 0===e||e.call(this.thisObj),this.hide()}},{key:"confirm",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=this,a=r.closest(Qw),o=null==a||null===(e=a.enableRecurringEvents)||void 0===e?void 0:e.defaultAction;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach((function(e){e in n&&(r[e]=n[e])})),"single"===o?(r.processSingleRecord(),!0):"future"===o?(r.processMultipleRecords(),!0):(r.confirmed=!1,r.updatePopupContent(),B(t,"show",this,3)([n]),new Promise((function(e){return r.resolve=e})))}},{key:"updatePopupContent",value:function(){var e=this,t=e.widgetMap,n=t.changeMultipleButton,r=t.changeSingleButton,i=e.eventRecord,a=e.actionType,o=void 0===a?"update":a,l=null==i?void 0:i.isRecurring;n&&r?(l?(n.initialConfig.text||(n.text=e.L("L{Object.Yes}")),e.html=e.L("".concat(o,"-all-message"))):(n.initialConfig.text||(n.text=e.L("".concat(o,"-further-btn-text"))),e.html=e.L("".concat(o,"-further-message"))),r.initialConfig.text||(r.text=e.L("".concat(o,"-only-this-btn-text")))):((n||r).text=e.L("L{Object.Yes}"),e.html=l||n?e.L("".concat(o,"-all-message")):e.L("".concat(o,"-only-this-message"))),e.width=e.L("L{width}"),e.title=e.L("".concat(o,"-title"))}},{key:"processMultipleRecords",value:function(){var e=this.eventRecord,t=this.changerFn,n=this.thisObj,r=this.finalizerFn;e.beginBatch(),t&&this.callback(t,n,[e]),e.endBatch(),r&&this.callback(r,n,[e]),this.confirmed=!0}},{key:"processSingleRecord",value:function(){var e,t,n=this.eventRecord,r=this.changerFn,i=this.thisObj,a=this.finalizerFn;(n.beginBatch(),n.isRecurring)&&(n.recurrence.forEachOccurrence(n.startDate,null,(function(e,n,r){if(r>1)return t=e,!1})),null===(e=t)||void 0===e||e.convertToRealEvent());n.recurrence=null,r&&this.callback(r,i,[n]),n.recurrenceRule=null,n.endBatch(),a&&this.callback(a,i,[n]),this.confirmed=!0}},{key:"updateLocalization",value:function(){this.updatePopupContent(),B(t,"updateLocalization",this,3)([])}},{key:"hide",value:function(){var e;B(t,"hide",this,3)([]),null===(e=this.resolve)||void 0===e||e.call(this,this.confirmed),this.resolve=null}}])}(fc);Gw=eD,S(eD,"$name","RecurrenceConfirmationPopup"),S(eD,"type","recurrenceconfirmation"),S(eD,"configurable",{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:r,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:Gw},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}),eD.initClass(),eD._$name="RecurrenceConfirmationPopup";var tD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}},{key:"changeRecurrenceConfirmationPopup",value:function(e,t){if(e)return eD.reconfigure(t,eD.mergeConfigs({owner:this},e),this)}},{key:"findRecurringEventToConfirmDelete",value:function(e){return e.find((function(e){return e.supportsRecurring&&(e.isRecurring||e.isOccurrence)}))}},{key:"onRecurrableAssignmentBeforeDelete",value:function(e){var t=e.assignmentRecords,n=e.context,r=t.map((function(e){return e.event})),i=this.findRecurringEventToConfirmDelete(r);if(this.enableRecurringEvents&&i)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:i,changerFn:function(){n.finalize(!0)},cancelFn:function(){n.finalize(!1)}}),!1}},{key:"onRecurrableBeforeEventDropFinalize",value:function(e){var t=e.context;if(this.enableRecurringEvents){var n=t.eventRecords.filter((function(e){return e.supportsRecurring&&(e.isRecurring||e.isOccurrence)}));n.length&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn:function(){t.finalize(!0)},cancelFn:function(){t.finalize(!1)}}))}}},{key:"onRecurrableBeforeEventResizeFinalize",value:function(e){var t=e.context;if(this.enableRecurringEvents){var n=t.eventRecord;n.supportsRecurring&&(n.isRecurring||n.isOccurrence)&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n,changerFn:function(){t.finalize(!0)},cancelFn:function(){t.finalize(!1)}}))}}},{key:"onAssignmentChange",value:function(e){var t=e.action,n=e.records,r=e.changes;if(("update"!==t||!r.event||!r.resource||2!==Object.keys(r).length)&&"dataset"!==t&&Array.isArray(n)){var i,a=D(n);try{for(a.s();!(i=a.n()).done;){var o,l=i.value;null!==(o=l.event)&&void 0!==o&&o.isRecurring&&!l.event.isBatchUpdating&&l.event.removeOccurrences(this.eventStore)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"getOccurrencesFor",value:function(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}},{key:"removeEvents",value:(n=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:null,r=arguments.length>2&&arguments[2]!==i?arguments[2]:this;return L().mark((function a(){var o,l,s,u;return L().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if((o=t).readOnly||!e.length){a.next=23;break}if(l={finalize:function(){var t=!(arguments.length>0&&arguments[0]!==i)||arguments[0];n&&n(t),!1!==t&&(e.some((function(e){var t;return e.isOccurrence||(null===(t=e.event)||void 0===t?void 0:t.isOccurrence)}))?e.forEach((function(e){return e.isOccurrenceAssignment?e.event.remove():e.remove()})):(e[0].isAssignment?o.assignmentStore:o.eventStore).remove(e))}},!e[0].isAssignment){a.next=9;break}return a.next=6,o.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:l});case 6:s=a.sent,a.next=12;break;case 9:return a.next=11,o.trigger("beforeEventDelete",{eventRecords:e,context:l});case 11:s=a.sent;case 12:if(!1===s){a.next=23;break}if(!(u=e.find((function(e){return e.isRecurring||e.isOccurrence})))){a.next=21;break}return o.recurrenceConfirmationPopup.owner=r,a.next=18,o.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:u,changerFn:function(){l.finalize(!0)},cancelFn:function(){l.finalize(!1)}});case 18:return a.abrupt("return",a.sent);case 21:l.finalize(!0);case 22:return a.abrupt("return",!0);case 23:return a.abrupt("return",!1);case 24:case"end":return a.stop()}}),a)}))()})),function(e){return n.apply(this,arguments)})},{key:"widgetClass",get:function(){}}]);var n}(e||Mn),S(t,"$name","RecurringEvents"),S(t,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),t},nD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateFillTicks",value:function(e){var t=this;if(!t.isConfiguring){var n=t.timeAxis;n.forceFullTicks=e&&t.snap,e&&(t.timeResolution={unit:n.mainUnit,increment:1}),t.refreshWithTransition(),t.trigger("stateChange")}}},{key:"changeBarMargin",value:function(e){return Be.assertNumber(e,"barMargin",!0),null==this._resourceMargin&&this.changeResourceMargin(e),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}},{key:"updateBarMargin",value:function(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}},{key:"resourceMargin",get:function(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}},{key:"changeResourceMargin",value:function(e){var t,n,r=this;return null==e&&(e=this.resourceMargin),"number"==typeof e?(r.isHorizontal&&r.rowHeight&&(e=Math.min(Math.floor(r.rowHeight/2),e)),r.resourceMarginObject={start:e,end:e,total:2*e},e):(null!==(t=e)&&void 0!==t&&t.start||(e.start=0),null!==(n=e)&&void 0!==n&&n.end||(e.end=0),r.isHorizontal&&r.rowHeight&&(e.start=r.rowHeight<e.start+e.end?Math.ceil(r.rowHeight/2):e.start,e.end=r.rowHeight<e.start+e.end?Math.ceil(r.rowHeight/2):e.end),r.resourceMarginObject=Be.assign({total:e.start+e.end},e),e)}},{key:"updateResourceMargin",value:function(){var e=this;e.rendered&&(e.currentOrientation.onBeforeRowHeightChange(),e.refreshWithTransition())}},{key:"changeTickSize",value:function(e){return Be.assertNumber(e,"tickSize",!0),e}},{key:"updateTickSize",value:function(e){var t,n,r=this,i=r.timeAxisViewModel,a=null,o=0;if(!r.isConfiguring&&r.isHorizontal){var l=(a=r.timelineScroller).viewport.width/2+a.scrollLeft*(r.rtl?-1:1),s=r.getDateFromCoordinate(l);n=e-i.tickSize,o=r.timeAxis.getTickFromDate(s)}i.tickSize=e,null===(t=a)||void 0===t||t.scrollBy(o*n,0),r.trigger("tickSizeChange",{tickSize:e})}},{key:"tickSize",get:function(){return this.timeAxisViewModel.tickSize}},{key:"updateEventStyle",value:function(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}},{key:"updateEventColor",value:function(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}},{key:"widgetClass",get:function(){}}],[{key:"defaultConfig",get:function(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}},{key:"eventColors",get:function(){return["red","pink","magenta","purple","violet","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","gantt-green","lime","yellow","orange","amber","deep-orange","light-gray","gray","black"]}},{key:"eventStyles",get:function(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}}])}(e||Mn),S(t,"$name","TimelineEventRendering"),S(t,"configurable",{barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null}),t},rD=new Date(-864e13),iD=new Date(864e13),aD={maintainVisibleStart:!0},oD={block:"nearest"},lD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onZoomToSpan",value:function(e){var t=e.startDate;this.infiniteScroll&&this.scrollToDate(t,{block:"start"})}},{key:"calculateOptimalDateRange",value:function(e,n,r){if(this.infiniteScroll){if(this.zoomKeepsOriginalTimespan){var i=this.timeAxis;return{startDate:i.startDate,endDate:i.endDate}}return this.calculateInfiniteScrollingDateRange(e,!0)}return B(t,"calculateOptimalDateRange",this,3)(arguments)}},{key:"initScroll",value:function(){var e=this,n=e.isHorizontal,r=e.visibleDate;B(t,"initScroll",this,3)([]);var i,a=(n?e.timeAxisSubGrid:e).scrollable;if(a.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll)if(null!==(i=e.partneredWith)&&void 0!==i&&i.values.some((function(e){return e.infiniteScroll}))){var o=a.element.getBoundingClientRect()[e.isHorizontal?"width":"height"];e.timeAxisViewModel.update(o,!1,!0)}else{var l=r?F(F({},r),{},{visibleDate:r.date}):{visibleDate:e.viewportCenterDate,block:"center"},s=e.calculateInfiniteScrollingDateRange(l.visibleDate,"center"===l.block),u=s.startDate,c=s.endDate;e.setTimeSpan(u,c,l)}}},{key:"timelineScroller",get:function(){var e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new sD({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}},{key:"calculateInfiniteScrollingDateRange",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.timeAxisViewModel.viewPreset,r=this,a=r.timeAxisViewModel,o=r.bufferCoef,l=a.timeAxis,s=a.availableSpace,u=Math.ceil(l.totalCount/l.count),c=n.leafUnit,d=n.leafIncrement,h=n.topUnit,f=n.topIncrement,v=n.tickSize,g=c===h&&Math.round(f)===f&&Math.round(d)===d,m=g?f:d,p=g?h:c;if(t){var y=Math.ceil((s*o+s/2)/v)*u,k=l.floorDate(Pl.add(e,-y*d,c),!1,p,m),b=l.ceilDate(Pl.add(e,y*d,c),!1,p,m),C=b-k,w=r.getMinDateOrDate(k),D=r.getMaxDateOrDate(b);return D<=w&&(D=r.getMaxDateOrDate(Pl.add(w,C))),{startDate:w,endDate:D}}var S=Math.ceil(s*o/v)*u,x=Pl.add(e,-S*d,c),E=Pl.add(e,Math.ceil((s/v+S)*d),c),R=E-x,T=r.getMinDateOrDate(x),M=r.getMaxDateOrDate(E);return M<=T&&(M=r.getMaxDateOrDate(Pl.add(T,R))),{startDate:l.floorDate(T,!1,p,m),endDate:l.ceilDate(M,!1,p,m)}}},{key:"doDestroy",value:function(){var e;null===(e=this._timelineScroller)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"onTimelineScroll",value:function(){this.infiniteScroll&&this.checkTimeAxisScroll()}},{key:"checkTimeAxisScroll",value:function(){var e,t=this,n=t.minDate,r=t.maxDate,i=t.timeAxis,a=i.startDate,o=i.endDate,l=t.timelineScroller,s=l.position,u=l.clientSize,c=u*t.bufferCoef*t.bufferThreshold,d=l.maxPosition,h=t.timeAxisSubGrid.virtualScrollerElement.style,f=s<c&&(!n||Pl.isAfter(a,n)),v=d-s<c&&(!r||Pl.isBefore(o,r));(f||v)&&(h.overflow="hidden",h.pointerEvents="none",h.paddingBottom="".concat(li.scrollBarWidth,"px"),t.setTimeout((function(){h.overflow="",h.paddingBottom="",h.pointerEvents=""}),100),e=f&&v?l.position+u/2:l.position,t.shiftToDate(t.getDateFromCoordinate(e,"floor",!0,!1,!0),f&&v))}},{key:"shiftToDate",value:function(e,t){var n=this.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(n.startDate,n.endDate,t?!0===t?{visibleDate:this.viewportCenterDate,block:"center"}:t:aD)}},{key:"updateInfiniteScroll",value:function(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll()}},{key:"scrollToDate",value:(r=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:{};return L().mark((function r(){var i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==(i=t).timeAxisSubGrid.width){r.next=3;break}return r.abrupt("return");case 3:if(a=i.timeAxis,o=i.visibleDateRange,l=i.infiniteScroll,s=i.minDate,u=i.maxDate,c=a.unit,d=a.increment,h=n.edgeOffset||0,f=Pl.ceil(o.endDate,d+" "+c)-Pl.floor(o.startDate,d+" "+c),v=e>i.viewportCenterDate?1:-1,g=(l?f*i.bufferCoef*i.bufferThreshold:"center"===n.block?f/2:h?i.getMilliSecondsPerPixelForZoomLevel(i.viewPreset)*h:0)*v,m=new Date(e.getTime()+g),p=m>a.endDate?1:m<a.startDate?-1:0,!i.isBeforeMinDate(e)&&!i.isAfterMaxDate(e)){r.next=7;break}return e=s&&e<s?s:u,r.abrupt("return",i.scrollToDate(e,n));case 7:if(!p||!i.infiniteScroll){r.next=13;break}return r.next=10,i.nextAnimationFrame();case 10:return i.shiftToDate(new Date(e-g),null,!0),r.next=13,i.nextAnimationFrame();case 13:return y=i.timelineScroller.viewport,k=i.getCoordinateFromDate(e,!0),b=Math.min(i.timeAxisViewModel.tickSize,i.timeAxisViewModel.availableSpace),C=i.isHorizontal?new pt(i.getCoordinateFromDate(e,!1)-(i.rtl?b:0),y.y,b,y.height):new pt(y.x,i.getCoordinateFromDate(e,!1),y.width,i.timeAxisViewModel.tickSize),r.next=16,i.scrollToCoordinate(k,C,e,n);case 16:case"end":return r.stop()}}),r)}))()})),function(e){return r.apply(this,arguments)})},{key:"scrollToNow",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return this.scrollToDate(new Date,e)}},{key:"scrollToCoordinate",value:(n=f((function(e,t,n){var r=this,a=arguments.length>3&&arguments[3]!==i?arguments[3]:{};return L().mark((function i(){var o,l,s,u,c,d,h,f,v,g,m,p,y;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(l=(o=r).startDate,s=o.endDate,u=o.hasTimelineBoundaries,c=o.minDate,d=o.maxDate,h=o.timeAxis,f=h.isContinuous,v=h.unit,g=h.increment,!(e<0||f&&(n<l||n>s))){i.next=16;break}if(m=s-l,p=Pl.floor(new Date(n.getTime()-m/2),g+" "+v),y=Pl.add(p,m),!u){i.next=11;break}if(o.isBeforeMinDate(n)||o.isAfterMaxDate(n)){i.next=9;break}o.isBeforeMinDate(p)?(p=c,y=Pl.add(p,m)):o.isAfterMaxDate(y)&&(y=d,p=Pl.add(y,-m)),i.next=11;break;case 9:return n=c&&n<c?c:d,i.abrupt("return",o.scrollToDate(n,a));case 11:if(p-l==0||y-s==0){i.next=15;break}return i.next=14,o.setTimeSpan(p,y);case 14:return i.abrupt("return",o.scrollToDate(n,a));case 15:return i.abrupt("return");case 16:return i.next=18,o.timelineScroller.scrollIntoView(t,a);case 18:return i.abrupt("return",!o.isDestroyed&&o.nextAnimationFrame());case 19:case"end":return i.stop()}}),i)}))()})),function(e,t,r){return n.apply(this,arguments)})},{key:"scrollLeft",get:function(){return this.timeAxisSubGrid.scrollable.element.scrollLeft},set:function(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}},{key:"scrollX",get:function(){return this.timeAxisSubGrid.scrollable.x},set:function(e){this.timeAxisSubGrid.scrollable.x=e}},{key:"scrollTop",get:function(){return this.scrollable.y},set:function(e){this.scrollable.y=e}},{key:"scrollHorizontallyTo",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}},{key:"scrollVerticallyTo",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return this.scrollable.scrollTo(null,e,t)}},{key:"scrollTo",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}},{key:"widgetClass",get:function(){}}]);var n,r}((e||Mn).mixin(Jw)),S(t,"$name","TimelineScroll"),S(t,"configurable",{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}),t},sD=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateOverflowX",value:function(){}},{key:"updateOverflowY",value:function(){}},{key:"onScroll",value:function(e){B(t,"onScroll",this,3)([e]),this._position=null}},{key:"syncPartners",value:function(e){this.scrollable.syncPartners(e)}},{key:"updatePosition",value:function(e){this.scrollable[this.isHorizontal?"x":"y"]=e}},{key:"viewport",get:function(){return this.scrollable.viewport}},{key:"position",get:function(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}},{key:"clientSize",get:function(){return this.scrollable["client".concat(this.isHorizontal?"Width":"Height")]}},{key:"scrollSize",get:function(){return this.scrollable["scroll".concat(this.isHorizontal?"Width":"Height")]}},{key:"maxPosition",get:function(){return this.scrollable["max".concat(this.isHorizontal?"X":"Y")]}},{key:"scrollTo",value:function(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}},{key:"scrollBy",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:0,t=arguments.length>1&&arguments[1]!==i?arguments[1]:0,n=arguments.length>2&&arguments[2]!==i?arguments[2]:oD;return this.isHorizontal?this.scrollable.scrollBy(e||t,0,n):this.scrollable.scrollBy(0,t||e,n)}},{key:"scrollIntoView",value:function(){var e;return(e=this.scrollable).scrollIntoView.apply(e,arguments)}},{key:"changeX",value:function(e){this.position=e}},{key:"changeY",value:function(e){this.position=e}},{key:"x",get:function(){return this.position},set:function(e){this.scrollable[this.isHorizontal?"x":"y"]=e}},{key:"y",get:function(){return this.position},set:function(e){this.scroller[this.isHorizontal?"x":"y"]=e}},{key:"clientWidth",get:function(){return this.clientSize}},{key:"clientHeight",get:function(){return this.clientSize}},{key:"scrollWidth",get:function(){return this.scrollSize}},{key:"scrollHeight",get:function(){return this.scrollSize}},{key:"maxX",get:function(){return this.maxPosition}},{key:"maxY",get:function(){return this.maxPosition}}],[{key:"configurable",get:function(){return{position:null,x:null,y:null}}}])}(Oa),uD=["barMargin"],cD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getState",value:function(){var e=this,n=Be.copyProperties(B(t,"getState",this,3)([]),e,uD);return n.zoomLevel=e.zoomLevel,n.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:i,width:e.tickSize},n}},{key:"applyState",value:function(e){var n=this;e=Object.assign({},e),n.suspendRefresh(),null!=e.zoomLevel&&(delete e.startDate,delete e.endDate,n.timeAxis.suspendEvents());var r,i=e,a=i.zoomLevel,o=i.zoomLevelOptions;(delete e.zoomLevel,delete e.zoomLevelOptions,B(t,"applyState",this,3)([e]),null!=a)&&(n.timeAxis.resumeEvents(),n.infiniteScroll&&null!==(r=e)&&void 0!==r&&null!==(r=r.scroll)&&void 0!==r&&r.scrollLeft&&(e.scroll.scrollLeft={}),n.whenVisible((function(){return n.zoomToLevel(a,o)})));n.resumeRefresh(!0,!1)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","TimelineState"),t},dD=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"refreshContent",value:function(){var e;null!==(e=this.headersElement)&&void 0!==e&&e.querySelector(".b-sch-timeaxiscolumn")||B(t,"refreshContent",this,3)([])}}])}(Ig);S(dD,"$name","SchedulerHeader"),dD._$name="Header";var hD=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"startConfigure",value:function(e){var n=e.grid;n.timeAxisSubGrid=this,B(t,"startConfigure",this,3)([e]),e.header={cls:{"b-sticky-headers":n.stickyHeaders}},delete e.headerClass,"flex"in e||"width"in e||(e.flex=1)}},{key:"changeScrollable",value:function(){var e=this,n=B(t,"changeScrollable",this,3)(arguments);return n&&Object.defineProperty(n,"scrollWidth",{get:function(){var e,t;return null!==(e=null===(t=this.element)||void 0===t?void 0:t.scrollWidth)&&void 0!==e?e:0},set:function(){e.positionDirty=!0,e.grid.updateCanvasSize()}}),n}},{key:"handleHorizontalScroll",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0];this.grid._viewPresetChanging||B(t,"handleHorizontalScroll",this,3)([e])}},{key:"onInternalResize",value:function(e,n,r,i,a){var o=this;if(B(t,"onInternalResize",this,3)(arguments),o.isPainted&&n!==i){var l=o.grid,s=l._bodyRectangle.height,u=o.monitorResize&&li.scrollBarWidth&&n<i;u&&(o.monitorResize=!1),l.onSchedulerViewportResize(n,s,i,s),u&&o.queueMicrotask((function(){return o.monitorResize=!0}))}}},{key:"headerScrollWidth",get:function(){return this.grid.isVertical?B(t,"headerScrollWidth",this,1):this.grid.timeAxisViewModel.totalSize}},{key:"clearWidthCache",value:function(){B(t,"clearWidthCache",this,3)([]),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}},{key:"expand",value:(n=f((function(){var e=this,n=arguments.length>0&&arguments[0]!==i&&arguments[0],r=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function i(){var a;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=e.owner,i.next=3,B(t,"expand",e,3)([n,r]);case 3:a.isPainted&&a.timeAxisViewModel.update(e.width,!1,!0);case 4:case"end":return i.stop()}}),i)}))()})),function(){return n.apply(this,arguments)})}],[{key:"configurable",get:function(){return{sealedColumns:!0,headerClass:dD}}}]);var n}(hm);S(hD,"$name","TimeAxisSubGrid"),S(hD,"type","timeaxissubgrid"),hD.initClass(),hD._$name="TimeAxisSubGrid";var fD=function(e,t,n){return null==t?null==n||e<n:null==n?e>=t:t<n?t<=e&&e<n:e<n||t<=e},vD={},gD=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"timeCellSelector",null),e}return R(t,e),w(t,[{key:"updateTimeZone",value:function(e){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e)}},{key:"timeZone",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.timeZone}},{key:"hasTimelineBoundaries",get:function(){return Boolean(this.minDate||this.maxDate)}},{key:"populateEventMenu",value:function(){}},{key:"populateScheduleMenu",value:function(){}},{key:"internalOnVisibleDateRangeChange",value:function(e){if(!this.handlingVisibleDateRangeChange){var t=this,n=t._visibleDateRange;(!n||n.startDate-e.startDate||n.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:n,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}},{key:"onVisibleResourceRangeChange",value:function(){}},{key:"onVisibleResourceColumnChange",value:function(){}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this;B(t,"construct",this,3)([e]),n.$firstVerticalOverflow=!0,n.initDomEvents(),n.currentOrientation.init(),n.rowManager.ion({refresh:function(){n.forceLayout=!1}})}},{key:"createSubGrid",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=this,a=r.stickyHeaders;return e===(r.schedulerRegion||"normal")?n.type="timeaxissubgrid":"locked"===e&&a&&r.isVertical&&(n.scrollable={overflowX:"visible",overflowY:"visible"},"resizable"in n||(n.resizable=!1),r.bodyContainer.classList.add("b-sticky-headers")),B(t,"createSubGrid",this,3)([e,n])}},{key:"doDestroy",value:function(){var e=this,n=e.partneredWith,r=e.currentOrientation;if(null==r||r.destroy(),e._bodyContainer&&ya.removeResizeListener(e._bodyContainer,e.onBodyResize),n){for(var i=n.count-1;i>-1;--i){var a=n.getAt(i);e.removePartner(a)}n.destroy()}else e.timeAxisViewModel.destroy(),e.timeAxis.destroy();B(t,"doDestroy",this,3)([])}},{key:"startConfigure",value:function(e){var n=this;B(t,"startConfigure",this,3)([e]),n.onBodyResize=n.onBodyResize.bind(n),n._bodyContainer&&ya.addResizeListener(n._bodyContainer,n.onBodyResize),n.getConfig("partner")}},{key:"onInternalPaint",value:function(e){if(e.firstPaint){var n,r,i=this,a=(i.isHorizontal?i.timeAxisSubGrid.scrollable:i.scrollable).element.getBoundingClientRect()[i.isHorizontal?"width":"height"];if(i.timeAxisViewModel.update(a,i.infiniteScroll,!0),i.infiniteScroll)null===(n=(r=i.currentOrientation).doUpdateTimeView)||void 0===n||n.call(r);i.getConfig("hideRowHover")}B(t,"onInternalPaint",this,3)(arguments)}},{key:"onSchedulerHorizontalScroll",value:function(e,n,r,i){this.currentOrientation.updateFromHorizontalScroll(r),B(t,"onSchedulerHorizontalScroll",this,3)([e,n,r,i])}},{key:"initScroll",value:function(){var e=this,n=0;B(t,"initScroll",this,3)([]),e.ion({horizontalScroll:function(t){var r=t.subGrid,i=t.scrollLeft,a=t.scrollX,o=t.scrollingToCenter;!e.isPainted||r!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(r,i,a,o),n++}}),"horizontal"===e.testPerformance&&e.setTimeout((function(){var t=performance.now(),r=5,i=1,a=e.setInterval((function(){if(r+=5,e.scrollX+=(10+Math.floor(r))*i,1===i&&e.scrollX>5500&&(i=-1,r=5),-1===i&&e.scrollX<=0){var o=(performance.now()-t)/n,l=Math.round(1e3/o*10)/10;clearInterval(a),console.log(e.eventPositionMode,e.eventScrollMode,l+"fps")}}),0)}),500)}},{key:"preserveViewCenter",value:function(e){for(var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this,n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o=this,l=o.viewportCenterDate,s=e.apply(t,r),u=o.timelineScroller,c=u.clientSize,d=Math.max(Math.floor(o.getCoordinateFromDate(l,!0)-c/2),0);return u.scrollTo(d,{scrollingToCenter:!0}),s}},{key:"setTimeSpan",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:vD,r=this,a=r.timeAxis,o=n.preventThrow,l=void 0!==o&&o,s=n.maintainVisibleStart,u=void 0!==s&&s,c=n.visibleDate,d=a.getAdjustedDates(e,t),h=d.startDate,f=d.endDate,v=a.startDate-h!=0,g=a.endDate-f!=0;if(v||g){if(u){var m=r.timeAxisViewModel,p=m.totalSize,y=m.tickSize,k=r.timelineScroller,b=k.position,C=m.getDateFromPosition(b);C>=h&&C<f&&m.ion({update:function(){var e=m.tickSize!==y;r.updateCanvasSize(),!v||g||e?k.position=v||e?m.getPositionFromDate(C):b:k.position+=m.totalSize-p,k.syncPartners(!0)},prio:1e4,once:!0})}r.lastViewPresetOptions&&(r.lastViewPresetOptions={startDate:h,endDate:f});var w=a.reconfigure({startDate:h,endDate:f},!1,l);return c?r.scrollToDate(c,n).then((function(){return w})):w}}},{key:"hasVisibleEvents",get:function(){var e=this;return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((function(t){return e.timeAxis.isTimeSpanInAxis(t)}))}},{key:"noFeatureElementsInAxis",value:function(){}},{key:"capitalizedEventName",get:function(){return this._capitalizedEventName||(this._capitalizedEventName=Le.capitalize(this.scheduledEventName)),this._capitalizedEventName}},{key:"updatePartner",value:function(e){e&&this.addPartner(e)}},{key:"addPartner",value:function(e){var t=this;if(!t.isPartneredWith(e)){null==t._partner&&(t._partner=e),(t.partneredWith||(t.partneredWith=new us)).add(e),(e.partneredWith||(e.partneredWith=new us)).add(t),t.getConfig("viewPreset"),t.getConfig("infiniteScroll"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t});var n=t.partnerSharedConfigs.reduce((function(t,n){return t[n]=e[n],t}),{});n.viewPreset.options={scrollPosition:e.timelineScroller.position,tickSize:e.tickSize},t._ownTimeAxis=t.timeAxis,t._ownTimeAxisViewModel=t.timeAxisViewModel,t.setConfig(n),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.isPainted?(e.scrollable.addPartner(t.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=Tt.createSequence(t.initScroll,(function(){e.scrollable.addPartner(t.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()}),t)}}},{key:"removePartner",value:function(e){var t=this,n=t.partneredWith,r=t.timeAxis;if(t.isPartneredWith(e)){t._partner===e&&(t._partner=null),n.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e});var i=e.scrollLeft,a=e.scrollTop;if(e.removePartner(t,!0),r.owner!==t&&!t.isDestroying){t.timeAxis=F(F({},e.timeAxis.getCurrentConfig({skip:{owner:1}})),{},{owner:t});var o=e.timeAxisViewModel.getCurrentConfig({skip:{owner:1,timeAxis:1,internalListeners:1}});t.timeAxisViewModel=F(F({},o),{},{owner:t,timeAxis:t.timeAxis}),t.scrollLeft=i,t.scrollTop=a,t.timeAxisViewModel.update(t.timeAxisSubGridElement.getBoundingClientRect()[t.isHorizontal?"width":"height"])}}}},{key:"isPartneredWith",value:function(e){var t;return Boolean(null===(t=this.partneredWith)||void 0===t?void 0:t.includes(e))}},{key:"onPartnerPresetChange",value:function(e){var t=e.preset,n=e.startDate,r=e.endDate,i=e.centerDate,a=e.zoomDate,o=e.zoomPosition,l=e.zoomLevel;this._viewPresetChanging||this.viewPreset===t||(t.options={startDate:n,endDate:r,centerDate:i,zoomDate:a,zoomPosition:o,zoomLevel:l},this.viewPreset=t)}},{key:"partners",get:function(){var e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),z(new o(e))}},{key:"timeAxisColumn",get:function(){return this.columns&&this._timeAxisColumn}},{key:"show",value:(l=f(L().mark((function e(){var n=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"show",this,3)(n);case 2:this.partner&&this.partner.eachSubGrid((function(e){return e.scrollable.syncPartners()}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"changeColumns",value:function(e,n){var r,i=this,a=i.timeAxisColumnConfig;if(e){var o=Array.isArray(e),l=e;o||(l=e.data),r=l&&l.length,l.some((function(e,t){return"timeAxis"===e.type&&(r=t,a=Be.assign(e,i.timeAxisColumn),!0)})),i.isVertical?(l=[Be.assign({type:"verticalTimeAxis"},i.verticalTimeAxisColumn),l[r]],r=1):l=l.slice(),l[r]=this._timeAxisColumn||Be.assign({type:"timeAxis",cellCls:i.timeCellCls,mode:i.mode},a),o||e.isStore&&e.owner!==this?e=l:e.data=l}return B(t,"changeColumns",this,3)([e,n])}},{key:"updateColumns",value:function(e,n){if(B(t,"updateColumns",this,3)([e,n]),e){var r=this,i=r._timeAxisColumn=r.columns.find((function(e){return e.isTimeAxisColumn}));r.isVertical&&(r.verticalTimeAxisColumn=r.columns.find((function(e){return e.isVerticalTimeAxisColumn})),r.verticalTimeAxisColumn.relayAll(r)),i.relayAll(r)}}},{key:"onColumnsChanged",value:function(e){var n,r=e.action,i=e.changes,a=e.record;e.records;var o=this.timeAxisColumn,l=this.columns;"dataset"!==r&&"batch"!==r||l.includes(o)?a===o&&"width"in i&&this.updateCanvasSize():l.add(o,!0),a&&(null===(n=this.partneredWith)||void 0===n||n.forEach((function(e){var t=e.columns.getAt(a.allIndex);if(null!=t&&t.shouldSync(a)){var n={};for(var r in i)n[r]=i[r].value;t.set(n)}}))),B(t,"onColumnsChanged",this,3)(arguments)}},{key:"timeView",get:function(){var e,t,n=this;return n.columns&&n.isVertical?null===(e=n.verticalTimeAxisColumn)||void 0===e?void 0:e.view:null===(t=n.timeAxisColumn)||void 0===t?void 0:t.timeAxisView}},{key:"updateEventCls",value:function(e){var t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=".".concat(e,"-wrap")),t.eventInnerSelector||(t.eventInnerSelector=".".concat(e))}},{key:"timeAxisViewModel",get:function(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel},set:function(e){var t,n,r=this,i=r._timeAxisViewModel,a={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:r};r.isConfiguring&&r.initialConfig.partner&&(e=r.initialConfig.partner.timeAxisViewModel),i&&i===e||((null==i?void 0:i.owner)===r&&i.destroy(),r.detachListeners("timeAxisViewModel"),null!==(t=e)&&void 0!==t&&t.isTimeAxisViewModel?e.ion(a):e=Uw.new({mode:r._mode,snap:r.snap,forceFit:r.forceFit,timeAxis:r.timeAxis,suppressFit:r.suppressFit,internalListeners:a,owner:r},e),r._timeAxisViewModel=e,r.isHorizontal&&r.timeAxisColumn?r.timeAxisColumn.timeAxisViewModel=e:r.isVertical&&null!==(n=r.verticalTimeAxisColumn)&&void 0!==n&&n.view&&(r.verticalTimeAxisColumn.view.model=e),r.relayEvents(e,["update"],"timeAxisViewModel"),i&&e&&r.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}},{key:"suppressFit",get:function(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.suppressFit)&&void 0!==e?e:this._suppressFit},set:function(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}},{key:"timeAxis",get:function(){return this._timeAxis||(this.timeAxis=null),this._timeAxis},set:function(e){var t,n=this,r=n._timeAxis,i={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:n};n._partner&&!e||r&&r===e||(r&&r.owner===n&&r.destroy(),n.detachListeners("timeAxis"),null!==(t=e)&&void 0!==t&&t.isTimeAxis||(e=Be.assign({owner:n,viewPreset:n.viewPreset,autoAdjust:n.autoAdjustTimeAxis,weekStartDay:n.weekStartDay,forceFullTicks:n.fillTicks&&n.snap},e),n.startDate&&(e.startDate=n.startDate),n.endDate&&(e.endDate=n.endDate),n.workingTime&&n.applyWorkingTime(e),e=new $w(e)),e.ion(i),n._timeAxis=e)}},{key:"onTimeAxisReconfigure",value:function(e){var t=e.config,n=e.oldConfig;t&&((!n||n.startDate-t.startDate||n.endDate-t.endDate)&&this.trigger("dateRangeChange",{old:{startDate:n.startDate,endDate:n.endDate},new:{startDate:t.startDate,endDate:t.endDate}}));this.trigger("timeAxisChange",{config:t})}},{key:"updateForceFit",value:function(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}},{key:"workingTime",get:function(){return this._workingTime},set:function(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}},{key:"applyWorkingTime",value:function(e){var t,n=this,r=n._workingTime;if(r){var i=null;r.fromHour>=0&&r.fromHour<24&&r.toHour>r.fromHour&&r.toHour<=24&&r.toHour-r.fromHour<24&&(i={from:r.fromHour,to:r.toHour});var a=null;r.fromDay>=0&&r.fromDay<7&&r.toDay>r.fromDay&&r.toDay<=7&&r.toDay-r.fromDay<7&&(a={from:r.fromDay,to:r.toDay}),e.include=i||a?{hour:i,day:a}:null}else e.include=null;n.isPainted&&(n.timeAxisColumn.refreshHeader(),null===(t=n.features.columnLines)||void 0===t||t.refresh(),n.refreshWithTransition())}},{key:"changeMinDate",value:function(e){return"string"==typeof e?e=Pl.parse(e):Pl.isDate(e)||(e=null),e}},{key:"updateMinDate",value:function(e){e&&Pl.isBefore(this.startDate,e)&&this.setStartDate(e,!1)}},{key:"isBeforeMinDate",value:function(e){return this.minDate&&Pl.isBefore(e,this.minDate)}},{key:"getMinDateOrDate",value:function(e){return this.minDate?Pl.max(this.minDate,e):e}},{key:"changeMaxDate",value:function(e){return"string"==typeof e?e=Pl.parse(e):Pl.isDate(e)?this.isBeforeMinDate(e)&&(e=null):e=null,e}},{key:"updateMaxDate",value:function(e){e&&Pl.isBefore(e,this.endDate)&&this.setEndDate(e,!1)}},{key:"isAfterMaxDate",value:function(e){return this.maxDate&&Pl.isBefore(this.maxDate,e)}},{key:"getMaxDateOrDate",value:function(e){return this.maxDate?Pl.min(this.maxDate,e):e}},{key:"changeStartDate",value:function(e){return"string"==typeof e&&(e=Pl.parse(e)),e}},{key:"updateStartDate",value:function(e){this.setStartDate(e)}},{key:"setStartDate",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n._timeAxis,a=r||vD,o=a.startDate,l=a.endDate,s=a.mainUnit;if("string"==typeof e&&(e=Pl.parse(e)),e=n.getMinDateOrDate(e),r&&l){if(e){var u=l;if(t&&o){var c=Pl.diff(o,l,s,!0);u=Pl.add(e,c,s)}n.setTimeSpan(e,u)}}else n._tempStartDate=e}},{key:"startDate",get:function(){var e,t,n,r=this,i=r.range,a=r.workingTime,o=(null===(e=r._timeAxis)||void 0===e?void 0:e.startDate)||r._tempStartDate;if(!o){if(o=Pl.floor(r.peekConfig("date")||new Date,i),r.calendar&&(r._tempEndDate=Pl.add(o,i)),a)for(;n=a,!fD((t=o).getDay(),n.fromDay,n.toDay)||!fD(t.getHours(),n.fromHour,n.toHour);)o.setHours(o.getHours()+1);r._tempStartDate=o}return o}},{key:"changeEndDate",value:function(e){this.setEndDate(e)}},{key:"setEndDate",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n._timeAxis,a=r||vD,o=a.startDate,l=a.endDate,s=a.mainUnit;if("string"==typeof e&&(e=Pl.parse(e)),e=n.getMaxDateOrDate(e),r&&o){if(e){var u=o;if(t&&l){var c=Pl.diff(o,l,s,!0);u=Pl.add(e,-c,s)}n.setTimeSpan(u,e)}}else n._tempEndDate=e}},{key:"endDate",get:function(){var e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||Pl.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}},{key:"changeVisibleDate",value:function(e){return"string"==typeof e?this.changeVisibleDate({date:e}):e instanceof Date?{date:e,block:this.isConfiguring?"start":"nearest"}:e instanceof Object?F(F({},e),{},{date:"string"==typeof e.date?Pl.parse(e.date):e.date,block:e.block||(this.isConfiguring?"start":"nearest")}):void 0}},{key:"updateVisibleDate",value:function(e){var t=this;t.infiniteScroll&&t.isConfiguring||(t.isPainted?t.scrollToDate(e.date,e):t.visibleDateProcessed||(t.whenVisible((function(){return t.updateVisibleDate(t.visibleDate)})),t.visibleDateProcessed=!0))}},{key:"features",get:function(){return B(t,"features",this,1)},set:function(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),V(t,"features",e,this,1,1)}},{key:"onLocaleChange",value:function(){B(t,"onLocaleChange",this,3)([]);var e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}},{key:"onBodyResize",value:function(e,t,n){var r=n.width,i=n.height;this.isVertical&&t&&r!==t.width&&delete this.timeAxisSubGrid._width;var a=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&i!==t.height&&this.onSchedulerViewportResize(a,i,a,t.height)}},{key:"onSchedulerViewportResize",value:function(e,t,n,r){if(this.isPainted){var i=this,a=i.isHorizontal,o=i.partneredWith;i.currentOrientation.onViewportResize(e,t,n,r),i.updateViewModelAvailableSpace(a?e:Math.floor(t)),o&&!i.isSyncingFromPartner&&i.syncPartnerSubGrids(),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:n,oldHeight:r})}}},{key:"updateViewModelAvailableSpace",value:function(e){this.timeAxisViewModel.availableSpace=e}},{key:"onTimeAxisViewModelUpdate",value:function(){this._viewPresetChanging||!this.timeAxisSubGrid||this.timeAxisSubGrid.collapsed||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}},{key:"syncPartnerSubGrids",value:function(){var e=this;this.partneredWith.forEach((function(t){t.isSyncingFromPartner||(t.isSyncingFromPartner=!0,e.eachSubGrid((function(e){var n=t.subGrids[e.region];if(n.width!==e.width)if(e.flex)e.flex!==n.flex&&(n.flex=e.flex);else if(n.hasCalculatedWidth&&e.hasCalculatedWidth){var r=Math.max(n.totalFixedWidth,e.totalFixedWidth);n.width=e.width=r,n.hasCalculatedWidth=e.hasCalculatedWidth=!0}else n.width=e.width})),t.isSyncingFromPartner=!1)}))}},{key:"currentOrientation",get:function(){throw new Error("Implement in subclass")}},{key:"isHorizontal",get:function(){return!0}},{key:"foregroundCanvas",get:function(){return this._foregroundCanvas}},{key:"svgCanvas",get:function(){var e=this;if(!e._svgCanvas){var t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",ba.generateId("svg")),t.classList.add("b-sch-canvas","b-sch-dependencies-canvas"),t.retainElement=!0,e.timeAxisSubGridElement.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}},{key:"timeAxisSubGridElement",get:function(){var e;this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=null===(e=this.timeAxisColumn)||void 0===e?void 0:e.subGridElement);return this._timeAxisSubGridElement}},{key:"updateCanvasSize",value:function(){var e=this,t=!1;if(e.isVertical){var n=e.timeAxisViewModel.totalSize;e.isPainted&&e.refreshTotalHeight(n+e._rowBorderHeight,!0),e.suppressFit&&li.setLength(e.foregroundCanvas,"height",n),t=!0}return t}},{key:"getHeaderDomConfigs",value:function(e){}},{key:"getForegroundDomConfigs",value:function(e){}},{key:"onStoreDataChange",value:(a=f((function(e){var n=arguments,r=this,i=e.action;return L().mark((function e(){var a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=r).isVisible){e.next=8;break}if("dataset"!==i||null===(o=a.project)||void 0===o||!o.isRepopulatingStores){e.next=5;break}return e.next=5,a.project.await("refresh",!1);case 5:B(t,"onStoreDataChange",r,3)(n),e.next=9;break;case 8:a.whenVisible("refresh",a,[!0]);case 9:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"refresh",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this;t.isPainted&&!t.refreshSuspended&&(t.isVertical||t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?!t.project||t.isEngineReady?t.refreshRows(null,!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}},{key:"render",value:function(){var e=this,n=e.resourceMarginObject.total,r=e.timeAxisSubGridElement,i=e._foregroundCanvas=li.createElement({className:"b-sch-canvas b-sch-foreground-canvas",style:"font-size:".concat(e.rowHeight-n,"px"),parent:r});e.canvases={event:i},e.timeAxisSubGrid.insertRowsBefore=i,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),B(t,"render",this,3)(arguments)}},{key:"refreshRows",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];this.isConfiguring||(this.currentOrientation.refreshRows(e,r),B(t,"refreshRows",this,3)([e,n]))}},{key:"updateHideHeaders",value:function(e){var n=this,r=n.isPainted?n.scrollLeft:0;B(t,"updateHideHeaders",this,3)([e]),n.isPainted&&(e||n.timeAxisColumn.refreshHeader(null,!0),n.nextAnimationFrame().then((function(){return n.scrollLeft=r})))}},{key:"updateHideRowHover",value:function(e){this.timeAxisSubGridElement.classList.toggle("b-hide-row-hover",e)}},{key:"getCellDataFromEvent",value:function(e,n){if(!e.target.closest(".b-verticaltimeaxis-cell"))return n&&(n=!Boolean(e.target.closest(".b-sch-foreground-canvas"))),B(t,"getCellDataFromEvent",this,3)([e,n])}},{key:"onCellNavigate",value:function(e,n,r){var i,a,o=r.target;null===(i=r.cell)||void 0===i||!i.classList.contains("b-timeaxis-cell")||null!==(a=Wn.currentMouseDown)&&void 0!==a&&a.target.classList.contains("b-grid-cell")||(this.preventDragSelect=!0),null!=o&&o.matches(this.eventSelector)&&!1===this.selectResourceOnEventNavigate||null!=o&&o.matches(".b-timeaxis-cell")&&!1===this.selectResourceOnScheduleClick||B(t,"onCellNavigate",this,3)(arguments)}},{key:"waitForAnimations",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isEngineReady||!this.project){e.next=3;break}return e.next=3,this.project.await("dataReady",!1);case 3:return e.next=5,B(t,"waitForAnimations",this,3)([]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"refreshWithTransition",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this;!n.refreshSuspended&&n.isPainted&&(n.rowManager.topRow?n.runWithTransition((function(){return n.refresh(e)}),t):n.rowManager.reinitialize())}},{key:"visibleDateRange",get:function(){return this.currentOrientation.visibleDateRange}},{key:"isRowNumberSelecting",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(t,"isRowNumberSelecting",this,3)(n)||n.some((function(e){var t;return e.column?e.column.isTimeAxisColumn:null===(t=e.cell)||void 0===t?void 0:t.closest(".b-timeaxis-cell")}))}},{key:"formatDuration",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.durationDisplayPrecision,n=Math.pow(10,t);return Math.round(e*n)/n}},{key:"beginListeningForBatchedUpdates",value:function(){var e;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,null===(e=this.syncSplits)||void 0===e||e.call(this,(function(e){return e.beginListeningForBatchedUpdates()}))}},{key:"endListeningForBatchedUpdates",value:function(){var e;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),null===(e=this.syncSplits)||void 0===e||e.call(this,(function(e){return e.endListeningForBatchedUpdates()}))}},{key:"onConnectedCallback",value:function(e,t){e&&!t&&(this.timeAxisSubGrid.scrollable.x+=.5)}},{key:"updateRtl",value:function(e){var n,r=this,i=r.isConfiguring;i||(n=r.visibleDateRange),B(t,"updateRtl",this,3)([e]),i||(r.currentOrientation.clearAll(),r.infiniteScroll?(r.shiftToDate(n.startDate),r.scrollToDate(n.startDate,{block:"start"})):r.timelineScroller.position+=.5)}},{key:"applyStartEndParameters",value:function(e){var t=this,n=t.eventStore.modelClass.fieldMap.startDate;t.passStartEndParameters&&(e[t.startParamName]=n.print(t.startDate),e[t.endParamName]=n.print(t.endDate))}},{key:"intersectsVisibleTimeSpan",value:function(e){return this.timeAxis.isTimeSpanInAxis(e)}},{key:"highlightEvents",value:function(e){var t,n,a,o,l,s=arguments,u=e.events,c=e.scroll,d=void 0===c||c,h=e.unhighlightOnClick,f=void 0===h||h,v=e.unhighlightOthers,g=void 0!==v&&v,m=this,p=m.viewportCenterDate,y=m.rowManager,k=null!==(t=m._highlightedAssignments)&&void 0!==t?t:m._highlightedAssignments=[],b=m.internalGetAssignmentsToHighlight(u);if(d&&b.length>1){var C,w,D=m.getMilliSecondsPerPixelForZoomLevel(m.viewPreset),S=m._bodyRectangle,x=S.y+S.height/2,E=null===(C=null!==(w=y.getRowAt(x))&&void 0!==w?w:y.bottomRow)||void 0===C?void 0:C.top;l=function(e){var t=e.isTask?e:e.event,n=e.isTask?e:e.resource,r=(p>t.endDate?p-t.endDate:t.startDate-p)/D,i="vertical"===m.mode?m.variableColumnWidths?n.instanceMeta(m).insetStart:m.currentOrientation.allResourceRecords.indexOf(n)*m.resourceColumnWidth:y.getRecordCoords(n).y,a=Math.abs(E-i);return Math.sqrt(r*r+a*a)}}g&&k.length&&m.unhighlightEvents({events:z(k)}),b.forEach((function(e){var t;k.includes(e)||(k.push(e),m.currentOrientation.toggleCls(e,"b-highlighted",!0),e.instanceMeta(m).isHighlighted=!0),d&&m.store.includes(e.isTask?e:e.resource)&&(l?((t=l(e))<o||null==o)&&(o=t,a=e):a=e)})),m.timeAxisSubGridElement.classList.toggle("b-is-highlighting",!0),a&&m["scroll".concat(m.isGantt?"Task":"Assignment","IntoView")](a,!0!==d?d:i),f&&!m._highlightEventsListener&&(m._highlightEventsListener=fr.on({element:r,autoDetach:!0,thisObj:m,pointerdown:m.unhighlightEvents})),null===(n=this.syncSplits)||void 0===n||n.call(this,(function(e){return e.highlightEvents(F(F({},s[0]),{},{unhighlightOnClick:!1}))}))}},{key:"unhighlightEvents",value:function(e){var t,n=this,r=n._highlightedAssignments,i=null==e?void 0:e.events;if(e instanceof Event){var a=e.target;if(a.closest(".b-virtual-scroller")||n.bodyContainer===a&&n.scrollable.hasOverflowY&&(e.offsetX>a.clientWidth||!li.scrollBarWidth&&e.offsetX>a.clientWidth-15))return;i=null}if(null!=r&&r.length)for(var o=i&&n.internalGetAssignmentsToHighlight(i),l=r.length-1;l>=0;l--){var s=r[l];o&&!o.includes(s)||(n.currentOrientation.toggleCls(s,"b-highlighted",!1),s.instanceMeta(n).isHighlighted=!1,r.splice(l,1))}null!=r&&r.length||n.timeAxisSubGridElement.classList.toggle("b-is-highlighting",!1),n._highlightEventsListener&&(n._highlightEventsListener(),n._highlightEventsListener=null),null===(t=this.syncSplits)||void 0===t||t.call(this,(function(t){return t.unhighlightEvents(e)}))}}],[{key:"defaultConfig",get:function(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}}]);var n,a,l}(Dm.mixin(qw,Xw,nD,(function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"applyViewStartEndDates",value:function(e,t){var n=this,r=n.visibleDate,i=void 0===r?{}:r,a=null==i?void 0:i.date,o=a?Pl.min(e,a):null!=e?e:new Date,l=a?t?Pl.max(t,a):Pl.add(o,n.visibleDateRange.endDate-n.visibleDateRange.startDate):t;return o&&l?(n.setTimeSpan(o,l,F(F({},i),{},{visibleDate:a})),!0):!!o&&(n.startDate=o,!0)}},{key:"onEventStoreDataRefresh",value:function(e){"pending"===this._initialStartDateFilled&&this.tryToApplyPreCommitStartEndDates(e.source)}},{key:"tryToApplyPreCommitStartEndDates",value:function(e){var t,n,r=this,i=r.project,a=null!==(t=i.get("startDate"))&&void 0!==t?t:i.replica?null:i.startDate;if(a)r.applyViewStartEndDates(a,null!==(n=i.get("endDate"))&&void 0!==n?n:i.replica?null:i.endDate),r._initialStartDateFilled="applied";else if(e.count>0){var o=iD,l=rD;e.forEach((function(e){var t=e.get("startDate"),n=e.get("endDate");t&&t<o&&(o=t),n&&n>l&&(l=n)})),r.applyViewStartEndDates(o.getTime()!==iD.getTime()?o:null,l.getTime()!==rD.getTime()?l:null),r._initialStartDateFilled="applied"}}},{key:"bindEventStoreForEarlyPositioning",value:function(e){var t,n=this,r=n.initialConfig;n._initialStartDateFilled!==i||r.startDate||r.date||null!==(t=r.timeAxis)&&void 0!==t&&t.startDate||r.visibleDate||r.partner||(n._initialStartDateFilled="pending",n.tryToApplyPreCommitStartEndDates(e)),n.detachListeners("eventStoreDataRefresh"),e.ion({name:"eventStoreDataRefresh",refreshPreCommit:"onEventStoreDataRefresh",once:!0,thisObj:n})}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","TimelineEarlyPositioning"),t}),Jw,lD,cD,Zw,tD));S(gD,"$name","TimelineBase"),S(gD,"type","timelinebase"),S(gD,"configurable",{animateTreeNodeToggle:!1,partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset","infiniteScroll"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},minDate:null,maxDate:null,partner:null,stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null,hideRowHover:{$config:"lazy",value:!0}}),gD.initClass(),Ne.setVersion("scheduler","6.2.2"),gD._$name="TimelineBase";var mD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isResourceStore",get:function(){return!0}},{key:"construct",value:function(e){if(B(t,"construct",this,3)([e]),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}},{key:"removeAll",value:function(){var e=B(t,"removeAll",this,3)(arguments);return e&&this.assignmentStore.removeAll(),e}},{key:"onRecordIdChange",value:function(e){var n=e.record,r=e.oldValue,i=e.value;B(t,"onRecordIdChange",this,3)([{record:n,oldValue:r,value:i}]),n.isFieldModified("id")&&(this.isChangingId=!0,n.updateAssignmentResourceIds(),this.isChangingId=!1)}},{key:"allResourceRecords",get:function(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}},{key:"getAvailableResources",value:function(e){var t=this,n=e.startDate,r=e.endDate;return this.query((function(e){return t.eventStore.isDateRangeAvailable(n,r,null,e)}))}}],[{key:"defaultConfig",get:function(){return{loadPriority:200,syncPriority:100,id:"resources",autoTree:!0}}}])}(e||Mn),S(t,"$name","ResourceStoreMixin"),t},pD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(e||Mn),S(t,"$name","PartOfProject"),t},yD=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateAssignmentResourceIds",value:function(){var e=this;this.assigned.forEach((function(t){t.resourceId=e.id}))}},{key:"syncId",value:function(e){B(t,"syncId",this,3)([e]),this.updateAssignmentResourceIds()}},{key:"events",get:function(){return this.assignments.reduce((function(e,t){return t.event&&e.push(t.event),e}),[])}},{key:"assignments",get:function(){return this.assigned?z(this.assigned):[]},set:function(e){var t=this;this.assignmentStore.remove(this.assignments),e.forEach((function(e){e.resource=t}))}},{key:"isPersistable",get:function(){return B(t,"isPersistable",this,1)&&(!this.parent||this.parent.isPersistable)}},{key:"unassignAll",value:function(){this.assignments&&this.assignmentStore.remove(this.assignments)}},{key:"initials",get:function(){var e=this.name,t=void 0===e?"":e;if(!t)return"";var n=t.split(" ");return n[0][0]+(n.length>1?n[n.length-1][0]:"")}},{key:"isWorkingTime",value:function(e){var t,n,r=this.effectiveCalendar||(null===(t=this.project)||void 0===t?void 0:t.calendar);return!r||(null===(n=r.isWorkingTime)||void 0===n?void 0:n.call(r,e))}},{key:"getEventStartingAfter",value:function(e){var t,n=Number.MAX_VALUE;return this.events.forEach((function(r){r.isScheduled&&r.startDate>=e&&r.startDate<n&&(t=r,n=r.startDate)})),t}},{key:"getEventEndingBefore",value:function(e){var t,n=0;return this.events.forEach((function(r){r.isScheduled&&r.endDate<=e&&r.endDate>n&&(t=r,n=r.endDate)})),t}},{key:"eventColor",get:function(){var e;return this.get("eventColor")||(null===(e=this.parent)||void 0===e?void 0:e.eventColor)},set:function(e){return this.set("eventColor",e)}}],[{key:"isResourceModel",get:function(){return!0}},{key:"fields",get:function(){return[{name:"name",type:"string"},"eventColor","eventStyle","imageUrl","image","resourceMargin",{name:"barMargin",type:"number"},"eventLayout",{name:"allowOverlap",type:"boolean"},{name:"showAvatar",type:"boolean"}]}}])}(e),S(t,"$name","ResourceModelMixin"),t},kD=L().mark(TD),bD=L().mark(MD),CD=L().mark(FD),wD=L().mark(AD),DD=L().mark(ID),SD=L().mark(LD),xD=L().mark(OD),ED=L().mark(PD);function RD(e){var t,n=[],r=[],i=L().mark((function i(){var a,o;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t||(t=e[Symbol.iterator]());case 1:if(!n.length){i.next=5;break}return i.delegateYield(n,"t0",4);case 4:n.length=0;case 5:if(t){i.next=7;break}return i.abrupt("break",17);case 7:if(a=t.next(),o=a.value,!a.done){i.next=12;break}return t=null,e=null,i.abrupt("break",17);case 12:return r.push(o),i.next=15,o;case 15:i.next=1;break;case 17:case"end":return i.stop()}}),i)})),a=L().mark((function i(){var a,o;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t||(t=e[Symbol.iterator]());case 1:if(!r.length){i.next=5;break}return i.delegateYield(r,"t0",4);case 4:r.length=0;case 5:if(t){i.next=7;break}return i.abrupt("break",17);case 7:if(a=t.next(),o=a.value,!a.done){i.next=12;break}return t=null,e=null,i.abrupt("break",17);case 12:return n.push(o),i.next=15,o;case 15:i.next=1;break;case 17:case"end":return i.stop()}}),i)}));return[i(),a()]}function TD(e,t){var n,r,i,a;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!(t<0)){o.next=2;break}throw new Error("Batch size needs to a natural number");case 2:t|=0,n=[],r=D(e),o.prev=5,r.s();case 7:if((i=r.n()).done){o.next=16;break}if(a=i.value,n.length!==t){o.next=13;break}return o.next=12,n;case 12:n.length=0;case 13:n.push(a);case 14:o.next=7;break;case 16:o.next=21;break;case 18:o.prev=18,o.t0=o.catch(5),r.e(o.t0);case 21:return o.prev=21,r.f(),o.finish(21);case 24:if(!(n.length>0)){o.next=27;break}return o.next=27,n;case 27:case"end":return o.stop()}}),kD,null,[[5,18,21,24]])}function MD(e,t){var n,r,i,a;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=0,r=D(e),o.prev=2,r.s();case 4:if((i=r.n()).done){o.next=11;break}if(a=i.value,!t(a,n++)){o.next=9;break}return o.next=9,a;case 9:o.next=4;break;case 11:o.next=16;break;case 13:o.prev=13,o.t0=o.catch(2),r.e(o.t0);case 16:return o.prev=16,r.f(),o.finish(16);case 19:case"end":return o.stop()}}),bD,null,[[2,13,16,19]])}function FD(e,t){var n,r,i,a;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=0,r=D(e),o.prev=2,r.s();case 4:if((i=r.n()).done){o.next=11;break}if(a=i.value,!(++n>t)){o.next=9;break}return o.next=9,a;case 9:o.next=4;break;case 11:o.next=16;break;case 13:o.prev=13,o.t0=o.catch(2),r.e(o.t0);case 16:return o.prev=16,r.f(),o.finish(16);case 19:case"end":return o.stop()}}),CD,null,[[2,13,16,19]])}function AD(e,t){var n,r,i,a;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=0,r=D(e),o.prev=2,r.s();case 4:if((i=r.n()).done){o.next=10;break}return a=i.value,o.next=8,t(a,n++);case 8:o.next=4;break;case 10:o.next=15;break;case 12:o.prev=12,o.t0=o.catch(2),r.e(o.t0);case 15:return o.prev=15,r.f(),o.finish(15);case 18:case"end":return o.stop()}}),wD,null,[[2,12,15,18]])}function ID(e){var t,n,r,i;return L().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t=new o,n=D(e),a.prev=2,n.s();case 4:if((r=n.n()).done){a.next=12;break}if(i=r.value,t.has(i)){a.next=10;break}return t.add(i),a.next=10,i;case 10:a.next=4;break;case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(2),n.e(a.t0);case 17:return a.prev=17,n.f(),a.finish(17);case 20:case"end":return a.stop()}}),DD,null,[[2,14,17,20]])}function LD(e,t){var n,r,i,a,l;return L().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n=new o,r=D(e),s.prev=2,r.s();case 4:if((i=r.n()).done){s.next=13;break}if(a=i.value,l=t(a),n.has(l)){s.next=11;break}return n.add(l),s.next=11,a;case 11:s.next=4;break;case 13:s.next=18;break;case 15:s.prev=15,s.t0=s.catch(2),r.e(s.t0);case 18:return s.prev=18,r.f(),s.finish(18);case 21:case"end":return s.stop()}}),SD,null,[[2,15,18,21]])}function OD(e,t){var n,r,i,a;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=0,r=D(e),o.prev=2,r.s();case 4:if((i=r.n()).done){o.next=14;break}if(a=i.value,!t(a,n++)){o.next=11;break}return o.next=9,a;case 9:o.next=12;break;case 11:return o.abrupt("return");case 12:o.next=4;break;case 14:o.next=19;break;case 16:o.prev=16,o.t0=o.catch(2),r.e(o.t0);case 19:return o.prev=19,r.f(),o.finish(19);case 22:case"end":return o.stop()}}),xD,null,[[2,16,19,22]])}function PD(e){var t,n,r;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t=D(e),i.prev=1,t.s();case 3:if((n=t.n()).done){i.next=8;break}return r=n.value,i.delegateYield(r,"t0",6);case 6:i.next=3;break;case 8:i.next=13;break;case 10:i.prev=10,i.t1=i.catch(1),t.e(i.t1);case 13:return i.prev=13,t.f(),i.finish(13);case 16:case"end":return i.stop()}}),ED,null,[[1,10,13,16]])}var _D=function(){function e(t){if(m(this,e),this.iterable=i,!t)throw new Error("Require an iterable instance for chaining");this.iterable=t}return w(e,[{key:"derive",value:function(t){return this.iterable=i,new e(t)}},{key:"copy",value:function(){var t=_(RD(this.iterable),2),n=t[0],r=t[1];return this.iterable=r,new e(n)}},{key:"split",value:function(){var t=_(RD(this.iterable),2),n=t[0],r=t[1];return[new e(n),this.derive(r)]}},{key:"inBatchesBySize",value:function(e){return this.derive(TD(this.iterable,e))}},{key:"filter",value:function(e){return this.derive(MD(this.iterable,e))}},{key:"drop",value:function(e){return this.derive(FD(this.iterable,e))}},{key:"map",value:function(e){return this.derive(AD(this.iterable,e))}},{key:"reduce",value:function(e,t){return function(e,t,n){var r,i=0,a=n,o=D(e);try{for(o.s();!(r=o.n()).done;)a=t(a,r.value,i++)}catch(e){o.e(e)}finally{o.f()}return a}(this,e,t)}},{key:"concat",value:function(){return this.derive(PD(this.iterable))}},{key:"uniqueOnly",value:function(){return this.derive(ID(this.iterable))}},{key:"uniqueOnlyBy",value:function(e){return this.derive(LD(this.iterable,e))}},{key:"every",value:function(e){return function(e,t){var n,r=0,i=D(e);try{for(i.s();!(n=i.n()).done;)if(!t(n.value,r++))return!1}catch(e){i.e(e)}finally{i.f()}return!0}(this,e)}},{key:"some",value:function(e){return function(e,t){var n,r=0,i=D(e);try{for(i.s();!(n=i.n()).done;)if(t(n.value,r++))return!0}catch(e){i.e(e)}finally{i.f()}return!1}(this,e)}},{key:"takeWhile",value:function(e){return this.derive(OD(this.iterable,e))}},{key:Symbol.iterator,value:L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.iterable){e.next=3;break}throw new Error("Chained iterator already exhausted or used to derive the new one");case 3:return this.iterable=i,e.delegateYield(t,"t0",5);case 5:t=i;case 6:case"end":return e.stop()}}),e,this)}))},{key:"toArray",value:function(){return Array.from(this)}},{key:"sort",value:function(e){return Array.from(this).sort(e)}},{key:"toSet",value:function(){return new o(this)}},{key:"toMap",value:function(){return new a(this)}},{key:"flush",value:function(){var e,t=D(this);try{for(t.s();!(e=t.n()).done;)e.value}catch(e){t.e(e)}finally{t.f()}}},{key:"memoize",value:function(){return new BD(this)}}])}(),HD=function(e){return new _D(e)},BD=function(e){function t(){var e;return m(this,t),(e=g(this,t,arguments)).elements=[],e.$iterator=i,e}return R(t,e),w(t,[{key:"iterable",get:function(){return this},set:function(e){this.$iterable=e}},{key:"derive",value:function(e){return new _D(e)}},{key:Symbol.iterator,value:L().mark((function(){var e,t,n,r,i,a;return L().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e=this.elements,!this.$iterable){o.next=33;break}if(this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]()),t=this.$iterator,!((n=e.length)>0)){o.next=7;break}return o.delegateYield(e,"t0",7);case 7:if(!(e.length>n)){o.next=17;break}r=n;case 10:if(!(r<e.length)){o.next=16;break}return o.next=13,e[r];case 13:r++,o.next=10;break;case 16:n=e.length;case 17:if(t){o.next=19;break}return o.abrupt("break",31);case 19:if(i=t.next(),a=i.value,!i.done){o.next=25;break}t=this.$iterator=null,this.$iterable=null,o.next=29;break;case 25:return e.push(a),n++,o.next=29,a;case 29:o.next=7;break;case 31:o.next=34;break;case 33:return o.delegateYield(e,"t1",34);case 34:case"end":return o.stop()}}),a,this)}))}])}(_D),VD=function(e){return new BD(e)},ND=Symbol("MixinIdentity"),zD=Symbol("MixinStateProperty"),jD=function(){return w((function e(){m(this,e),this.baseEl=i,this.sourceEl=i,this.$elementsByTopoLevel=i,this.$topoLevels=i,this.linearizedByTopoLevelsSource=VD(this.linearizedByTopoLevels())}),[{key:"topoLevels",get:function(){return this.$topoLevels!==i?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}},{key:"buildTopoLevels",value:function(){return Array.from(this.elementsByTopoLevel.keys()).sort((function(e,t){return e-t}))}},{key:"elementsByTopoLevel",get:function(){return this.$elementsByTopoLevel!==i?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}},{key:"getOrCreateLevel",value:function(e,t){var n=e.get(t);return n||(n=[],e.set(t,n)),n}},{key:"buildElementsByTopoLevel",value:function(){var e=this,t=0,n=this.baseEl?HD(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new o,r=HD(this.sourceEl.requirements).map((function(e){return e.walkDepthState.elementsByTopoLevel})).concat().reduce((function(n,r){var i=_(r,2),a=i[0],o=i[1];return a>t&&(t=a),e.getOrCreateLevel(n,a).push(o),n}),new a);return this.getOrCreateLevel(r,t+1).push([this.sourceEl]),HD(r).map((function(e){var t=_(e,2),r=t[0],i=t[1];return[r,HD(i).concat().uniqueOnly().filter((function(e){return!n.has(e)})).sort((function(e,t){return e.id-t.id}))]})).toMap()}},{key:"linearizedByTopoLevels",value:L().mark((function e(){var t=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(HD(this.topoLevels).map((function(e){return t.elementsByTopoLevel.get(e)})).concat(),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))}],[{key:"new",value:function(e){var t=new this;return e&&Object.assign(t,e),t}}])}(),WD=1,$D=function(e){return function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(e)},UD=w((function e(){m(this,e)})),GD=function(){return w((function e(){m(this,e),this.id=WD++,this.requirements=[],this.baseClass=UD,this.identitySymbol=i,this.mixinLambda=$D,this.walkDepthState=i,this.$minimalClass=i,this.name=""}),[{key:"minimalClass",get:function(){return this.$minimalClass!==i?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}},{key:"getBaseClassMixinId",value:function(e){var t=this.constructor,n=t.baseClassesIds.get(e);if(n!==i)return n;var r=WD++;return t.baseClassesIds.set(e,r),r}},{key:"buildMinimalClass",value:function(){var e=this.constructor,t=this.baseClass,n=this.walkDepthState.linearizedByTopoLevelsSource.reduce((function(t,n){var r=t.cls,i=t.hash+String.fromCharCode(n.id),a=e.minimalClassesByLinearHash.get(i);return a||(a=n.mixinLambda(r),n.name=a.name,e.minimalClassesByLinearHash.set(i,a)),t.cls=a,t.hash=i,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(n,S(S(S(S(S(S({},ND,this.identitySymbol),zD,this),"mix",this.mixinLambda),"derive",(function(e){return XD([r,e],(function(e){return function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(e)}))})),"$",this),"toString",this.toString.bind(this)));return Object.defineProperty(r,Symbol.hasInstance,{value:qD}),r}},{key:"toString",value:function(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((function(e,t){return"".concat(t.name,"(").concat(e,")")}),this.baseClass.name)}}],[{key:"new",value:function(e){var t=new this;e&&Object.assign(t,e),t.walkDepthState=jD.new({sourceEl:t,baseEl:YD(t.baseClass)});var n=t.mixinLambda,r=t.identitySymbol=Symbol(n.name),i=Object.assign((function(e){var t=n(e);return t.prototype[r]=!0,t}),S(S({},ND,r),zD,t));return Object.defineProperty(i,Symbol.hasInstance,{value:qD}),t.mixinLambda=i,t}}])}();GD.minimalClassesByLinearHash=new a,GD.baseClassesIds=new a;var YD=function(e){return Object.getPrototypeOf(e.prototype).constructor[zD]},qD=function(e){return Boolean(e&&e[this[ND]])},KD=function(e,t){return Boolean(e&&e[t[ND]])},XD=function(e,t){var n,r;if(e.length>0){var a=e[e.length-1];r=a,Object.getPrototypeOf(r.prototype).constructor.hasOwnProperty(zD)||a===UD||(n=a)}var o=[];return e.forEach((function(t,r){var a=t[zD];if(a!==i){var l=a.baseClass;if(l!==UD)if(n){if(n!==l){var s=l.prototype.isPrototypeOf(n.prototype),u=n.prototype.isPrototypeOf(l.prototype);if(!s&&!u)throw new Error("Base class mismatch");n=u?l:n}}else n=l;o.push(a)}else if(r!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")})),GD.new({requirements:o,mixinLambda:t,baseClass:n||UD}).minimalClass},ZD=function(){return w((function e(){m(this,e)}),[{key:"initialize",value:function(e){e&&Object.assign(this,e)}}],[{key:"new",value:function(e){var t=new this;return t.initialize(e),t}}])}(),JD=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([],(function(e){e.prototype;var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isPartOfProjectRaw",get:function(){return!0}},{key:"commitAsync",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.project.commitAsync());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"project",get:function(){return this.$project},set:function(e){this.$project=e}},{key:"calculateProject",value:function(){throw new Error("Implement me")}},{key:"setProject",value:function(e){return this.project=e}},{key:"getProject",value:function(){var e=this.project;return e||this.setProject(this.calculateProject())}},{key:"getAssignmentStore",value:function(){var e=this.getProject();return null==e?void 0:e.assignmentStore}},{key:"getDependencyStore",value:function(){var e=this.getProject();return null==e?void 0:e.dependencyStore}},{key:"getEventStore",value:function(){var e=this.getProject();return null==e?void 0:e.eventStore}},{key:"getResourceStore",value:function(){var e=this.getProject();return null==e?void 0:e.resourceStore}},{key:"getCalendarManagerStore",value:function(){var e=this.getProject();return null==e?void 0:e.calendarManagerStore}}]);var n}(e);return t}))),QD=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([JD],(function(e){e.prototype;var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"eventStore",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}},{key:"resourceStore",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}},{key:"assignmentStore",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}},{key:"dependencyStore",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}},{key:"calendarManagerStore",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}},{key:"getEventById",value:function(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}},{key:"getDependencyById",value:function(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}},{key:"getResourceById",value:function(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}},{key:"getAssignmentById",value:function(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}},{key:"getCalendarById",value:function(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}}])}(e);return t}))),eS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([JD,Ff],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).isLoadingData=!1,e.disableHasLoadedDataToCommitFlag=!1,e}return R(n,e),w(n,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}},{key:"trigger",value:function(e,n){var r=this,i=r.asyncEvents,a=r.project,o=null==i?void 0:i[e];return o&&(!0===o||o[n.action])?(t.trigger.call(r,"".concat(e,"PreCommit"),F({},n)),!a||a.isEngineReady()&&!a.isWritingData?t.trigger.call(r,e,n):!r.eventsSuspended&&a&&(a.dataReadyDetacher||(a.queuedDataReadyEvents=[],a.dataReadyDetacher=a.ion({dataReady:function(){this.queuedDataReadyEvents.forEach((function(e){var t=_(e,4),n=t[0],r=t[1],i=t[2],a=t[3];n.trigger.call(r,i,a)})),a.queuedDataReadyEvents=null,a.dataReadyDetacher(),a.dataReadyDetacher=null},once:!0})),a.queuedDataReadyEvents.push([t,r,e,n])),!0):t.trigger.call(r,e,n)}},{key:"calculateProject",value:function(){return this.project}},{key:"setStoreData",value:function(e){var n;!this.project||this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag||(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(n=this.project)||void 0===n||n.trigger("storeRefresh",{store:this})}},{key:"doAutoCommit",value:(l=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.suspendCount<=0&&this.project)||this.project.isEngineReady()){e.next=3;break}return e.next=3,this.project.commitAsync();case 3:t.doAutoCommit.call(this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"addAsync",value:(o=f(L().mark((function e(t,n){var r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.add(t,n),e.next=3,this.project.commitAsync();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"insertAsync",value:(a=f(L().mark((function e(t,n,r){var i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.insert(t,n,r),e.next=3,this.project.commitAsync();case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"loadDataAsync",value:(r=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.data=t,e.next=3,this.project.commitAsync();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]);var r,a,o,l}(e);return n.$name="AbstractPartOfProjectStoreMixin",n}))),tS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([JD,od],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"joinStore",value:function(e){var n=null;if(KD(e,eS)){var r=e.getProject();r&&!this.getProject()&&(this.setProject(r),n=r)}t.joinStore.call(this,e),n&&!n.isRepopulatingStores&&this.joinProject()}},{key:"unjoinStore",value:function(e){var n=arguments.length>1&&arguments[1]!==i&&arguments[1];t.unjoinStore.call(this,e,n);var r,a=this.project,o=KD(e,eS)&&!e.isFillingFromMaster&&a===(e.isChained&&e.project?e.masterStore.project:e.project);a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(null===(r=e.untrackRecordFieldChanges)||void 0===r||r.call(e),this.leaveProject(n),this.setProject(null));o&&(this.graph=null)}},{key:"joinProject",value:function(){}},{key:"leaveProject",value:function(){}},{key:"calculateProject",value:function(){var e,t=null===(e=this.stores)||void 0===e?void 0:e.find((function(e){return KD(e,eS)&&!!e.getProject()}));return null==t?void 0:t.getProject()}},{key:"setAsync",value:(a=f(L().mark((function e(t,n,r){var i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.set(t,n,r),e.next=3,null===(i=this.project)||void 0===i?void 0:i.commitAsync();case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"getAsync",value:(r=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.project)||void 0===n?void 0:n.commitAsync();case 2:return e.abrupt("return",this.get(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"isStmRestoring",get:function(){var e=this.getProject();return(null==e?void 0:e.isRestoringData)||(null==e?void 0:e.stm.isRestoring)||!1}}]);var r,a}(e);return n}))),nS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([tS,QD,od],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).$isCalculating=!1,e.$changed={},e.$beforeChange={},e}return R(n,e),w(n,[{key:"isInActiveTransaction",get:function(){return!0}},{key:"joinProject",value:function(){!this.isRoot&&this.invalidate()}},{key:"leaveProject",value:function(){var e,n=arguments.length>0&&arguments[0]!==i&&arguments[0];this.project.$leaving.add(this),t.leaveProject.call(this,n),null===(e=this.project)||void 0===e||e.bufferedCommitAsync()}},{key:"invalidate",value:function(){var e;!this._preventInvalidation&&(null===(e=this.project)||void 0===e||e.invalidate(this))}},{key:"getCurrentOrProposed",value:function(e){var t;return e in this.$changed&&!0!==this.$changed[e]?this.$changed[e]:null!==(t=this.get(e))&&void 0!==t?t:null}},{key:"hasCurrentOrProposed",value:function(e){return e in this.$changed&&1!=this.$changed[e]||null!=this.get(e)}},{key:"propose",value:function(e){var t;if(this.project||null!==(t=this.recurringTimeSpan)&&void 0!==t&&t.project){for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];this.$changed[i]=e[i]}this.invalidate()}else this.set(e)}},{key:"setChanged",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this;a.$changed[e]=t,r&&(e in a.$beforeChange||(a.$beforeChange[e]=a.get(e)),a.setData(e,t)),n&&a.invalidate()}},{key:"calculateInvalidated",value:function(){}},{key:"finalizeInvalidated",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}])}(e);return n}))),rS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([nS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"assigned",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}},{key:"joinProject",value:function(){var e,n=this;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((function(e){return e.get("resource")===n.id})).forEach((function(e){return e.setChanged("resource",n)})));t.joinProject.call(this)}},{key:"leaveProject",value:function(){var e,n=arguments.length>0&&arguments[0]!==i&&arguments[0];if(this.assigned&&!n&&(null===(e=this.resourceStore)||void 0===e||!e.isLoadingData)){var r=this.resourceStore;this.assigned.forEach((function(e){return r.assignmentsForRemoval.add(e)}))}t.leaveProject.call(this)}},{key:"applyValue",value:function(e,n,r,i,a){"id"===(null==a?void 0:a.name)&&this.assigned.forEach((function(e){e.set("resourceId",r)})),t.applyValue.call(this,e,n,r,i,a)}}])}(e);return n}))),iS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(yD(pD(rS.derive(Cg))));S(iS,"$name","ResourceModel"),iS.exposeProperties(),iS._$name="ResourceModel";var aS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS,QD,Ff],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"setProject",value:function(e){var n=t.setProject.call(this,e);return e&&this.joinProject(e),n}},{key:"joinProject",value:function(e){}},{key:"onCommitAsync",value:function(){}},{key:"joinRecordsToProject",value:function(e){var t=function(t){t.setProject(e),t.joinProject()};this.rootNode?this.rootNode.traverse(t):this.forEach(t)}},{key:"unjoinRecordsFromProject",value:function(e){var t=function(t){t.leaveProject(),t.setProject(e)},n=this.rootNode;n?n.traverse((function(e){e!==n&&t(e)})):this.forEach(t)}}])}(e);return n}))),oS={splice:1,clear:1},lS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).assignmentsForRemoval=new o,e}return R(n,e),w(n,[{key:"onDataChange",value:function(e){var t,r=oS[e.action];B(n,"onDataChange",this,3)([e]),r&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterResourceRemoval()}},{key:"remove",value:function(e,n){var r=t.remove.call(this,e,n);return this.afterResourceRemoval(),r}},{key:"removeAll",value:function(e){var n=t.removeAll.call(this,e);return this.afterResourceRemoval(),n}},{key:"afterResourceRemoval",value:function(){var e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){var t=z(this.assignmentsForRemoval).filter((function(t){return!e.assignmentsForRemoval.has(t)}));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}},{key:"processRecord",value:function(e){var t=this.getById(e.id);if(t&&t!==e){var n,r=D(t.assigned||[]);try{for(r.s();!(n=r.n()).done;){n.value.resource=e}}catch(e){r.e(e)}finally{r.f()}}return e}}])}(e);return n}))),sS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([lS,aS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"joinProject",value:function(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}},{key:"afterLoadData",value:function(){var e,n;null===(e=t.afterLoadData)||void 0===e||e.call(this),null===(n=this.assignmentStore)||void 0===n||n.linkAssignments(this,"resource")}},{key:"clear",value:function(e){var n;t.clear.call(this,e),null===(n=this.assignmentStore)||void 0===n||n.unlinkAssignments("resource")}}],[{key:"defaultConfig",get:function(){return{modelClass:rS}}}])}(e);return n}))),uS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{modelClass:iS}}}])}(mD(pD(sS.derive(Pf))));S(uS,"$name","ResourceStore"),uS._$name="ResourceStore";var cS=["isReload"],dS=function(){return w((function e(){m(this,e),S(this,"ranges",[]),S(this,"promises",[])}),[{key:"addPromise",value:function(e){var t=this;null!=e&&e.then&&(this.promises.push(e),e.then((function(){t.promises.splice(t.promises.indexOf(e),1)})))}},{key:"addRange",value:function(e,t,n){this.addPromise(n);var r=this.getRange(e);if((null==r?void 0:r.endDate)<t)r.endDate.setTime(t.getTime());else{var i=this.getRange(t);(null==i?void 0:i.startDate)>e?i.startDate.setTime(e.getTime()):(e=new Date(e.getTime()),t=new Date(t.getTime()),this.ranges.push({startDate:e,endDate:t}))}}},{key:"containsRange",value:function(e,t){return this.ranges.some((function(n){return Pl.timeSpanContains(n.startDate,n.endDate,e,t)}))}},{key:"getRange",value:function(e){return this.ranges.filter((function(t){return Pl.betweenLesserEqual(e,t.startDate,t.endDate)}))[0]}}])}(),hS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)(arguments),this.listenToProject()}},{key:"project",get:function(){return this.client.project}},{key:"resourceStore",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}},{key:"updateProject",value:function(){this.listenToProject()}},{key:"listenToProject",value:function(){var e,t=this.project;null===(e=this.$projectListenersDetacher)||void 0===e||e.call(this),null!=t&&t.ion&&(this.$projectListenersDetacher=t.ion({resourceStoreChange:"listenToResourceStore",thisObj:this})),this.listenToResourceStore()}},{key:"listenToResourceStore",value:function(){var e,t=this.resourceStore;null!=t&&t.lazyLoad&&t.isResourceStore&&!t.lazyLoad.$isCrudManager&&(null===(e=this.$resourceStoreListenersDetacher)||void 0===e||e.call(this),this.$resourceStoreListenersDetacher=t.ion({afterLazyLoad:"afterResourceStoreLazyLoad",thisObj:this}))}},{key:"afterResourceStoreLazyLoad",value:function(e){var t=this,n=t.resourceStore;if(!t.client.isAssignmentStore&&(e.isReload||t.$delayedReloadLoad)){if(n.tree&&n.isLoading)return void(t.$delayedReloadLoad=!0);t.load(),t.$delayedReloadLoad=!1}}},{key:"getEventsAsArray",value:function(e){var t=e.visibleDateRange,n=e.startDate,r=e.endDate,i=e.fromRowHeight,a=e.resourceRecord;!i&&t&&this.bufferedLazyLoad({startDate:n,endDate:r,visibleStart:t.startDate,visibleEnd:t.endDate,resourceRecord:a})}},{key:"isLoading",get:function(){return B(t,"isLoading",this,1)||Object.values(this.loadQueue).some((function(e){return e.promises.length}))}},{key:"internalOnBeforeAdd",value:function(){}},{key:"internalOnChange",value:function(){}},{key:"internalOnCommit",value:function(){}},{key:"updateAutoLoad",value:function(){V(t,"autoLoad",!1,this,1,1)}},{key:"calculateDateRange",value:function(e,t){var n=e.startDate,r=e.endDate,i=e.visibleStart,a=e.visibleEnd,o=this.getResourceQueue(t);if(i&&a&&!this.loadFullDateRange){var l,s=this.bufferAmount,u=this.bufferUnit,c=this.$bufferedResourceRecords,d=this.resourceStore,h=u&&null!=s?Pl.asMilliseconds(s,u):a-i,f=function(e,t){var i=Pl.clearTime(new Date(e.getTime()+t));return i<n?i.setTime(n.getTime()):i>r&&i.setTime(r.getTime()),i},v=f(i,h/-2),g=f(a,h/2);if(v>g)return!1;if(null!==(l=o)&&void 0!==l&&l.containsRange(v,g)){var m=!1;if((null==c?void 0:c.length)>1)for(var p=1;p<c.length;p++){var y;if(t=d.indexOf(c[p]),null===(y=o=this.getResourceQueue(t))||void 0===y||!y.containsRange(v,g)){m=!0;break}}if(!m)return!1}n=f(i,-1*h),r=f(a,h)}else{if(n>r)return!1;n=new Date(n.getTime()),r=new Date(r.getTime())}if(o){var k=o.getRange(n);if(k)n.setTime(k.endDate.getTime());else{var b=o.getRange(r);b&&r.setTime(b.startDate.getTime())}}return!(n-r>=0)&&{startDate:n,endDate:r,resourceIndex:t}}},{key:"calculateResourceRange",value:function(e){var t=e.resourceIndex,n=e.startDate,r=e.endDate,i=this.resourceStore,a=this.$bufferedResourceRecords,o=0,l=i.count-1;if(i.lazyLoad||!this.loadFullResourceRange&&i.count){var s,u,c=null!==(s=null===(u=i.lazyLoad)||void 0===u?void 0:u.chunkSize)&&void 0!==s?s:this.chunkSize;if(o=t-c,l=t+c,(null==a?void 0:a.length)>c){var d=i.indexOf(a.pop());d>l&&(l=d+c)}for(o=Math.max(o,0);!i.records[o]&&o<l;)o+=1;for(;!i.records[l]&&o<l;)l-=1}for(;o<t&&null!==(h=this.getResourceQueue(o))&&void 0!==h&&h.containsRange(n,r);){var h;o+=1}for(;l>t&&null!==(f=this.getResourceQueue(l))&&void 0!==f&&f.containsRange(n,r);){var f;l-=1}return{startIndex:o,count:l-o+1}}},{key:"getResourceQueue",value:function(e){if(null!=e){var t,n=this.resourceStore;if(!this.client.isTimeRangeStore&&n.isTree)e=null===(t=n.records[e])||void 0===t?void 0:t.id;return this.loadQueue[e]}}},{key:"addToQueue",value:function(e){var t=e.startDate,n=e.endDate,r=e.startIndex,i=void 0===r?0:r,a=e.count,o=void 0===a?1:a,l=e.promise,s=e.resourceIds,u=this.loadQueue,c=function(e){return(u[e]||(u[e]=new dS)).addRange(t,n,l)};if(s)s.forEach(c);else for(var d=i;d<i+o;d++)c(d)}},{key:"bufferedLazyLoad",value:function(e){var t=arguments,n=e.resourceRecord,r=this;n||r.doLazyLoad.apply(r,arguments),r.$bufferedResourceRecords?r.$bufferedResourceRecords.push(n):(r.$bufferedResourceRecords=[n],r.requestAnimationFrame((function(){r.doLazyLoad.apply(r,z(t)),r.$bufferedResourceRecords=null})))}},{key:"doLazyLoad",value:(r=f((function(e){var t=this,n=e.isReload,r=A(e,cS);return L().mark((function e(i,a){var o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=(o=t).client,s=o.dateFormat,u=o.project.resourceStore,c=!l.isTimeRangeStore&&u.isTree,d=null!==(i=r.resourceIndex)&&void 0!==i?i:r.resourceRecord?u.indexOf(r.resourceRecord):0,n&&o.clear(),r=o.calculateDateRange(r,d),!(!l.requestData||!1===r||c&&(u.isLoading||!u.count)||r.resourceIndex<0)){e.next=6;break}return!u.count&&l.clear(),e.abrupt("return");case 6:if(l.isTimeRangeStore){e.next=18;break}if(h=o.calculateResourceRange(r),!c){e.next=15;break}if(f=u.getRange(h.startIndex,h.startIndex+h.count+1),(v=f.filter((function(e){var t;return!(e.isPhantom||null!==(t=o.loadQueue[e.id])&&void 0!==t&&t.containsRange(r.startDate,r.endDate))}))).length){e.next=12;break}return e.abrupt("return");case 12:r.resourceIds=v.map((function(e){return e.id})),e.next=18;break;case 15:Object.assign(r,h),u.remoteFilter&&u.isFiltered&&(l.readUrl?(g=u.filterParamName,m=void 0===g?"filters":g,l.filterParamName===m&&(m="resource"+m),r[m]=u.encodeFilterParams(u.filters)):r.resourceFilters=u.getFilterParams(u.filters)),u.remoteSort&&u.isSorted&&(p=u.sorters,l.readUrl?(y=u.sortParamName,l.sortParamName===y&&(y="resource"+y),r[y]=u.encodeSorterParams(p)):r.resourceFilters=p);case 18:return delete r.resourceIndex,!l.isEventStore||null!==(a=l.crudManager)&&void 0!==a&&null!==(a=a.transport)&&void 0!==a&&null!==(a=a.load)&&void 0!==a&&a.url||(o.loadAssignmentStore(r,n),null===(k=o.project)||void 0===k||null===(k=k.timeRangeStore)||void 0===k||null===(k=k.lazyLoad)||void 0===k||k.doLazyLoad(r)),o.triggerLazyLoadStart(r),b=r,l.readUrl&&s?b=F(F({},r),{},{startDate:Pl.format(r.startDate,s),endDate:Pl.format(r.endDate,s)}):l.readUrl||l.buildRemoteParams(b),C=l.requestData(b),o.addToQueue(F(F({},r),{},{promise:C})),e.next=27,C;case 27:w=e.sent,D=w.data,o.addData(D,r,n),o.triggerLazyLoadEnd(r,D);case 31:case"end":return e.stop()}}),e)}))()})),function(e){return r.apply(this,arguments)})},{key:"addData",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=n.resourceIds,a=n.startDate,o=n.endDate,l=arguments.length>2?arguments[2]:i,s=this.client;if(null!=e&&e.length&&r){var u=e.filter((function(e){return!r.includes(e.resourceId)}));u.length&&this.addToQueue({startDate:a,endDate:o,resourceIds:u.map((function(e){return e.resourceId}))})}if(s.isTree)return s.rootNode.appendChild(e,!0),void s.added.clear();B(t,"addData",this,3)([e,null,l])}},{key:"processAddedRecords",value:function(e){var t=this.client;if(t.isEventStore&&t.$processResourceIds){var n,r,i,a=null!==(n=t.assignmentStore)&&void 0!==n?n:null===(r=t.crudManager)||void 0===r?void 0:r.assignmentStore,o=a.stm,l=(null==o?void 0:o.enabled)&&o.autoRecord,s=[],u=D(e);try{var c=function(){var e=i.value,t=e.resourceId,n=e.resourceIds,r=e.id;null!=t?s.push({resource:t,eventId:r}):null!=n&&n.length&&s.push.apply(s,z(n.map((function(e){return{resource:e,eventId:r}}))))};for(u.s();!(i=u.n()).done;)c()}catch(e){u.e(e)}finally{u.f()}l&&o.disable(),t.project.hasLoadedDataToCommit=!0,a.add(s),a.acceptChanges(),l&&o.enable(),t.$processResourceIds=!1}}},{key:"loadAssignmentStore",value:(n=f(L().mark((function e(t,n){var r,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.project.assignmentStore,!(a=r.lazyLoad)){e.next=12;break}return a.triggerLazyLoadStart(),n&&a.clear(),o=r.requestData(t),a.addToQueue(F(F({},t),{},{promise:o})),e.next=8,o;case 8:l=e.sent,s=l.data,a.addData(s,i,n),a.triggerLazyLoadEnd();case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"load",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return null===(e=this.beforeLoadCall)||void 0===e||e.call(this,t),this.doLazyLoad(F({isReload:!0},t))}},{key:"doDestroy",value:function(){var e,n;null===(e=this.$projectListenersDetacher)||void 0===e||e.call(this),null===(n=this.$resourceStoreListenersDetacher)||void 0===n||n.call(this),B(t,"doDestroy",this,3)([])}}],[{key:"pluginConfig",get:function(){var e,n={};for(var r in B(t,"pluginConfig",this))n[r]=z(B(t,"pluginConfig",this)[r]);n.assign.push("updateProject");var i=n.assign.indexOf("lazyGetAt");return i>=0&&n.assign.splice(i,1),n.before=null!==(e=n.before)&&void 0!==e?e:[],n.before.push("getEventsAsArray"),n}}]);var n,r}(Af.mixin($i));S(hS,"$name","DateStoreLazyLoadPlugin"),S(hS,"configurable",{bufferUnit:null,bufferAmount:null,dateFormat:"YYYY-MM-DD",loadFullDateRange:!1,loadFullResourceRange:!1}),hS._$name="DateStoreLazyLoadPlugin";var fS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"listenToResourceStore",value:function(){var e;B(t,"listenToResourceStore",this,3)([]);var n,r=this,i=r.resourceStore,a=r.client;!i||null!==(e=a.lazyLoad)&&void 0!==e&&e.$isCrudManager||a.isTimeRangeStore||(null===(n=r.$pagedResourceStoreListenersDetacher)||void 0===n||n.call(r),r.$pagedResourceStoreListenersDetacher=r.resourceStore.ion({beforeLoadPage:"beforeResourceStoreLoad",thisObj:r}),(i.isLoading||i.count)&&r.requestAnimationFrame(r.beforeResourceStoreLoad))}},{key:"beforeResourceStoreLoad",value:function(e){var t,n,r=F(F({},null!==(t=null==e?void 0:e.params)&&void 0!==t?t:{}),{},{isReload:!0});null===(n=this.beforeLoadCall)||void 0===n||n.call(this,r),this.doLazyLoad(r)}},{key:"calculateDateRange",value:function(e){var n=B(t,"calculateDateRange",this,3)(arguments);if(n){var r,i,a,o=this.client,l=o.defaultPageParamName,s=o.pageSizeParamName,u=this.resourceStore;n[l]=null!==(r=null!==(i=e[l])&&void 0!==i?i:u.currentPage)&&void 0!==r?r:1,n[s]=null!==(a=e[s])&&void 0!==a?a:u.pageSize}return n}},{key:"calculateResourceRange",value:function(e){return e}},{key:"addToQueue",value:function(e){e.startIndex=0,e.count=e.pageSize,B(t,"addToQueue",this,3)([e])}},{key:"doDestroy",value:function(){var e;B(t,"doDestroy",this,3)([]),null===(e=this.$pagedResourceStoreListenersDetacher)||void 0===e||e.call(this)}}])}(hS);S(fS,"$name","PagedDateStoreLazyLoadPlugin"),S(fS,"configurable",{loadFullDateRange:!0}),fS._$name="PagedDateStoreLazyLoadPlugin";var vS=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"$lazyLoadPluginClass",get:function(){return this.isPaged?fS:hS}},{key:"construct",value:function(e){if(B(t,"construct",this,3)([e]),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}},{key:"getEventCounts",value:function(e){var t=this,n=t.filtersFunction,r=t.added,i=t.getEvents(F(F({},e),{},{storeFilterFn:t.isFiltered?t.reapplyFilterOnAdd?n:function(e){return r.includes(e)?t.indexOf(e)>-1:n(e)}:null,dateMap:e.dateMap||!0}));return i.forEach((function(e,t){return i.set(t,e.length)})),i}},{key:"forEachScheduledEvent",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this;this.forEach((function(n){var r=n.startDate,i=n.endDate;if(r&&i)return e.call(t,n,r,i)}))}},{key:"getTotalTimeSpan",value:function(){var e=new Date(9999,0,1),t=new Date(0);return this.forEach((function(n){n.startDate&&(e=Pl.min(n.startDate,e)),n.endDate&&(t=Pl.max(n.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}},{key:"isEventPersistable",value:function(e){return e.isPersistable}},{key:"filterEventsForResource",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this;return e.getEvents(this).filter(t.bind(n))}},{key:"getResourcesForEvent",value:function(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}},{key:"getEventsForResource",value:function(e){return this.assignmentStore.getEventsForResource(e)}},{key:"getAssignmentsForEvent",value:function(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}},{key:"getAssignmentsForResource",value:function(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}},{key:"assignEventToResource",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2];return this.assignmentStore.assignEventToResource(e,t,i,n)}},{key:"unassignEventFromResource",value:function(e,t){this.assignmentStore.unassignEventFromResource(e,t)}},{key:"reassignEventFromResourceToResource",value:function(e,t,n){var r=od.asId(n),i=this.assignmentStore.getAssignmentForEventAndResource(e,t);i?i.resourceId=r:this.assignmentStore.assignEventToResource(e,n)}},{key:"isEventAssignedToResource",value:function(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}},{key:"removeAssignmentsForEvent",value:function(e){this.assignmentStore.removeAssignmentsForEvent(e)}},{key:"removeAssignmentsForResource",value:function(e){this.assignmentStore.removeAssignmentsForResource(e)}},{key:"append",value:function(e){return this.add(e)}},{key:"project",get:function(){return B(t,"project",this,1)},set:function(e){var n,r;(V(t,"project",e,this,1,1),null===(n=this.updateProject)||void 0===n||n.call(this,e),this.detachListeners("project"),e)&&(null!==(r=e.assignmentStore)&&void 0!==r&&r.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore),e.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}},{key:"usesResourceIds",get:function(){var e,t;return null!==(e=null===(t=this.modelClass.fieldMap)||void 0===t?void 0:t.resourceIds.persist)&&void 0!==e&&e}},{key:"usesSingleAssignment",get:function(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment},set:function(e){this._usesSingleAssignment=e,this.setupCheapAssignmentIdGeneration()}},{key:"setupCheapAssignmentIdGeneration",value:function(){var e=this.assignmentStore;null!=e&&e.isStore&&!e.hasGenerateIdOverride&&(e.modelClass.generateId=function(){return null==this.singleAssignmentIdCounter&&(this.singleAssignmentIdCounter=0),"a-".concat(++this.singleAssignmentIdCounter)},e.hasGenerateIdOverride=!0)}},{key:"processRecords",value:function(e,n,r){var a,o=this,l=this.assignmentStore,s=[];return l&&(l.skipInvalidateIndices=!0),e=B(t,"processRecords",this,3)([e,l&&!(null!==(a=this.stm)&&void 0!==a&&a.isRestoring)&&function(e){var t,n=o.usesResourceIds&&null!==(t=e.resourceIds)&&void 0!==t&&t.length?e.resourceIds:[e.resourceId];if(!e.reassignedFromReplace&&null!=(null==n?void 0:n[0])){var r,i=D(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;l.includesAssignment(e.id,a)||s.push({id:l.modelClass.generateId(""),resourceId:a,eventId:e.id})}}catch(e){i.e(e)}finally{i.f()}}e.reassignedFromReplace=!1}||i]),l&&(l.storage.invalidateIndices(),l.skipInvalidateIndices=!1,l.add(s,r)),e}},{key:"joinRecordsToStore",value:function(e){var n=this.assignmentStore;n?(n.skipInvalidateIndices=!0,B(t,"joinRecordsToStore",this,3)([e]),n.storage.invalidateIndices(),n.skipInvalidateIndices=!1):B(t,"joinRecordsToStore",this,3)([e])}},{key:"processRecord",value:function(e){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=this,a=(e=B(t,"processRecord",this,3)([e,n])).get("resourceId"),o=e.resourceIds;if(null!=o&&o.length&&r.usesResourceIds)r.$processResourceIds=!0,r.setupCheapAssignmentIdGeneration();else if(null!=a&&!e.meta.skipEnforcingSingleAssignment){var l=r.getById(e.id);if(l&&l!==e&&!n){var s,u,c=(null!==(s=r.assignmentStore)&&void 0!==s?s:null===(u=r.crudManager)||void 0===u?void 0:u.assignmentStore).storage.findItem("eventId",e.id);if(null!=c&&c.size)c.values().next().value.resource=a,e.reassignedFromReplace=!0}else r.$processResourceIds=!0;r.usesSingleAssignment=!0}return e}},{key:"processResourceIds",value:function(){var e,t,n,r=this,i=null!==(e=r.assignmentStore)&&void 0!==e?e:null===(t=r.crudManager)||void 0===t?void 0:t.assignmentStore;if(r.$processResourceIds&&null!=i&&i.isAssignmentStore&&(null===(n=r.project)||void 0===n||!n.isSharingAssignmentStore||!r.isChained)){var a=[];r.forEach((function(e){var t=e.resourceId,n=e.resourceIds,r=e.id;null!=t?a.push({id:i.modelClass.generateId(""),resourceId:t,eventId:r}):null!=n&&n.length&&n.forEach((function(e){a.push({id:i.modelClass.generateId(""),resourceId:e,eventId:r})}))}),r,{includeFilteredOutRecords:!0}),i.useRawData={disableDefaultValue:!r.modelClass.isProEventModel,disableDuplicateIdCheck:!0,disableTypeConversion:!0},i.usesSingleAssignment=!1,i.verifyNoGeneratedIds=!1,i.data=a,i.usesSingleAssignment=!0,r.$processResourceIds=!1}}},{key:"loadTreeData",value:function(){B(t,"loadTreeData",this,3)(arguments),this.processResourceIds()}},{key:"loadData",value:function(){B(t,"loadData",this,3)(arguments),this.processResourceIds()}},{key:"onBeforeRemoveAssignment",value:function(e){var t,n=e.records,r=this;if(r.removeUnassignedEvent&&!r.isRemoving&&!r.isSettingData&&(null===(t=r.stm)||void 0===t||!t.isRestoring)&&!r.usesSingleAssignment&&!r.assignmentStore.isSyncingDataOnLoad&&!r.resourceStore.isSyncingDataOnLoad){var i=new o;n.forEach((function(e){var t=e.event;t&&!t.isRemoved&&t.assignments.every((function(e){return n.includes(e)}))&&i.add(t)})),i.size&&r.remove(z(i))}}},{key:"onProjectAssignmentStoreChange",value:function(e){var t=e.store;this.attachToAssignmentStore(t)}},{key:"attachToAssignmentStore",value:function(e){var t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.ion({name:"assignmentStore",addPreCommit:function(e){var n=e.records;t.isSettingData||t.isAssigning||(t.usesSingleAssignment?n.forEach((function(e){var t=e.event;null!=t&&t.isEvent&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)})):t.usesResourceIds?n.forEach((function(e){var t=e.event;if(null!=t&&t.isEvent){var n;t.meta.isAssigning=!0;var r=null!==(n=t.resourceIds)&&void 0!==n?n:[];r.includes(e.resourceId)||(t.resourceIds=[].concat(z(r),[e.resourceId])),t.meta.isAssigning=!1}})):t.updateChainedStores())},beforeRemove:"onBeforeRemoveAssignment",removePreCommit:function(e){var n=e.records;t.isSettingData||t.isAssigning||(t.usesSingleAssignment?n.forEach((function(e){var n;null===(n=t.getById(e.eventId))||void 0===n||n.set("resourceId",null)})):t.usesResourceIds?n.forEach((function(e){var t,n=e.event,r=e.resourceId,i=null===(t=n.resourceIds)||void 0===t?void 0:t.slice(),a=null==i?void 0:i.indexOf(r);a>=0&&(i.splice(a,1),n.resourceIds=i)})):t.updateChainedStores())},removeAllPreCommit:function(){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?t.allRecords.forEach((function(e){return e.set("resourceId",null)})):t.usesResourceIds?t.allRecords.forEach((function(e){e.resourceIds=[]})):t.updateChainedStores())},update:function(e){var n=e.record,r=e.changes;if("resourceId"in r){var i=n.event;if(t.usesSingleAssignment)i.meta.isAssigning=!0,i.set("resourceId",r.resourceId.value),i.meta.isAssigning=!1;else if(t.usesResourceIds){i.meta.isAssigning=!0;var a=i.resourceIds.slice(),o=null==a?void 0:a.indexOf(r.resourceId.oldValue);o>=0&&a.splice(o,1),null!=a&&a.includes(r.resourceId.value)||(a.push(r.resourceId.value),i.resourceIds=a),i.meta.isAssigning=!1}else t.updateChainedStores()}},change:function(e){var n=e.action,r=e.records;"dataset"===n&&(t.usesResourceIds&&r.forEach((function(e){var t,n=e.event,r=e.resourceId,i=null!==(t=n.resourceIds)&&void 0!==t?t:[];i.includes(r)||(i.push(r),n.meta.isAssigning=!0,n.setData("resourceIds",i),n.meta.isAssigning=!1)})),t.usesSingleAssignment||t.usesResourceIds||t.updateChainedStores())},thisObj:t}))}},{key:"data",set:function(e){var n=this;n.isSettingData=!0,!n.usesSingleAssignment||n.syncDataOnLoad||n.isChained||n.assignmentStore.removeAll(!0),V(t,"data",e,this,1,1),n.isSettingData=!1}},{key:"trigger",value:function(e,n){var r,i=(n||{}).changes;return!i||!("resourceId"in i)||1!==Object.keys(i).length||null!==(r=this.stm)&&void 0!==r&&r.isRestoring||(n.isAssign=!0),B(t,"trigger",this,3)(arguments)}},{key:"remove",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=B(t,"remove",this,3)([e].concat(r));if(a.length&&this.usesSingleAssignment){var o,l=D(a);try{for(l.s();!(o=l.n()).done;){var s,u,c=o.value;if(!c.isOccurrence)null===(s=this.assignmentStore||(null===(u=this.crudManager)||void 0===u?void 0:u.assignmentStore))||void 0===s||s.remove(c.assignments,!0)}}catch(e){l.e(e)}finally{l.f()}}return a}}],[{key:"defaultConfig",get:function(){return{loadPriority:100,syncPriority:200,id:"events",removeUnassignedEvent:!0,singleAssignment:null}}}])}(e||Mn),S(t,"$name","EventStoreMixin"),t},gS=function(){return!0},mS=function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"bufferIsUnavailableTime",!1),e}return R(t,e),w(t,[{key:"getEvents",value:function(e){var t=e.filter,n=e.date,r=e.startDate,i=e.endDate,a=e.startOnly,o=e.includeOccurrences,l=e.allowPartial,s=e.onlyAssigned,u=void 0!==s&&s,c=e.dateMap,d=void 0!==c&&c;e.dayTime;var h=e.silent;e.getDateIndex,e.fromRowHeight;var f=this,v=arguments[0],g=f.lastDateRange,m=f.added,p=f.filtersFunction,y=t;if(u&&(v.filter=y?function(e){return y(e)&&e.resources.length}:function(e){return e.resources.length}),"startDate"in v||(r=v.startDate=n),"includeOccurrences"in v||(o=v.includeOccurrences=!0),"allowPartial"in v||(l=v.allowPartial=!a),v.storeFilterFn=!f.isFiltered||v.ignoreFilters||f.remoteFilter?null:f.reapplyFilterOnAdd?p:function(e){return m.includes(e)?f.indexOf(e)>-1:p(e)},!i)if(r)(i=v.endDate=Pl.clearTime(r)).setDate(i.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");v.dateFilter=gS}v.dateFilter||(v.dateFilter=a?function(e){var t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate;return t&&!(Pl.clearTime(t)-r)}:l?function(e){var t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,n=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&(!(t-n)?Pl.betweenLesserEqual(t,r,i):Pl.intersectSpans(t,n,r,i))}:function(e){var t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,n=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=r&&n<=i});var k={startDate:r,endDate:i},b=Boolean(!g||g.startDate-k.startDate||g.endDate-k.endDate);return f.processConfiguredListeners(),h||(f.trigger("loadDateRange",{old:g||{},new:pe.clone(k),changed:b}),f.lastDateRange=pe.clone(k)),d?f.getEventsAsMap(v):f.getEventsAsArray(v)}},{key:"getEventsAsArray",value:function(e){var t=e.filter,n=e.date,r=e.resourceRecord,i=e.startDate,a=void 0===i?n:i,l=e.endDate,s=e.startOnly,u=e.includeOccurrences,c=void 0===u||u,d=e.dayTime,h=void 0===d?null:d,f=e.dateFilter,v=e.storeFilterFn,g=e.getDateIndex,m=this,p=[];if(v?m.count:m.totalCount){var y=r?m.getEventsForResource(r):null;if(!r){var k=m.useDayIndex(h),b=new o,C=s?"startDate":"date";m.recurringEvents.forEach((function(e){k.dayTime.startOfDay(e.startDate)<=a&&b.add(e)}));for(var w=new Date(a);w<l;w.setDate(w.getDate()+1)){var D=k.get(g?g(w):C,w);null==D||D.forEach((function(e){return b.add(e)}))}y=z(b)}v&&(y=y.filter(v));for(var S=0,x=y.length;S<x;S++){var E=y[S];c&&E.isRecurring?p.push.apply(p,E.getOccurrencesForDateRange(a,l).filter(f)):f(E)&&p.push(E)}}return t?p.filter(t):p}},{key:"getEventsAsMap",value:function(e){var t,n=e.filter,r=e.date,i=e.resourceRecord,o=e.startDate,l=void 0===o?r:o,s=e.endDate,u=e.startOnly,c=e.includeOccurrences,d=void 0===c||c,h=e.dateMap,f=e.dayTime,v=void 0===f?null:f,g=e.storeFilterFn,m=e.getDateIndex,p=this;if(null!==(t=h)&&void 0!==t&&t.clear?h.clear():h=new a,p.count){var y,k=p.useDayIndex(v),b=u?"startDate":"date",C=[],w=function(e){return(!n||n(e))&&(!g||g(e))},D=function(e){return!e.isRecurring&&w(e)};if(v=k.dayTime,i)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");null===(y=p.recurringEvents)||void 0===y||y.forEach((function(e){v.startOfDay(e.startDate)<s&&C.push(e)}));for(var S=new Date(l);S<s;S.setDate(S.getDate()+1)){var x,E,R=_(k.get(m?m(S):b,S,!0),2),T=R[0],M=R[1];if(null!==(x=T)&&void 0!==x&&x.size)if((T=z(T).filter(D)).length)(E=h.get(M)||h.set(M,[]).get(M)).push.apply(E,z(T))}for(var F=0,A=C.length;F<A;F++)for(var I,L=C[F],O=(d?L.getOccurrencesForDateRange(l,s):[L]).filter(w),P=Pl.add(s,1,"day"),H=0,B=O.length;H<B;H++)for(var V=O[H],N=v.startOfDay(V.startDate),j="startDate"!==(m?m(N):u?"startDate":"date")&&V.durationMS?Pl.min(V.endDate||Pl.add(V.startDate,V.duration,V.durationUnit),P):Pl.add(N,1,"day");N<j;N.setDate(N.getDate()+1)){var W=v.dateKey(N);(I=h.get(W))||h.set(W,I=[]),I.push(V)}}return h}},{key:"isDateRangeAvailable",value:function(e,t,n,r){var i,a=this;return 1===arguments.length&&(t=e.endDate,n=e.excludeEvent,r=e.resourceRecord,i=e.allowOverlap,e=e.startDate),(r=$e.asArray(r)).every((function(r){return a.isResourceAvailable(e,t,n,r,i)}))}},{key:"isResourceAvailable",value:function(e,t,n,r,i){var a,l=this;if(r.data.generatedParent)return!1;if(i="boolean"==typeof r.allowOverlap?r.allowOverlap:i)return!0;var s=this.getEventsForResource(r);(null===(a=this.recurringEvents)||void 0===a?void 0:a.size)>0&&s.push.apply(s,z(s.flatMap((function(e){return e.occurrences}))));var u=new o(s);n&&(n=$e.asArray(n)).forEach((function(e){e.isAssignment&&e.event.resources.forEach((function(t){t.id!==e.resourceId&&l.getEventsForResource(t).forEach((function(e){return u.add(e)}))}));var t=e.isAssignment?e.event:e;u.delete(t)}));var c=Array.from(u);if(e.getTime()===t.getTime())return!c.some((function(n){return n.isScheduled&&(0===n.duration?n.startDate.getTime()===e.getTime():Pl.intersectSpans(e,t,n.startDate,n.endDate))}));var d=this.bufferIsUnavailableTime;return!c.some((function(n){var r=d&&n.outerStartDate||n.startDate,i=d&&n.outerEndDate||n.endDate;return n.isScheduled&&Pl.intersectSpans(e,t,r,i)}))}}])}(e),S(t,"$name","GetEventsMixin"),t},pS={date:"_dateIndex",startDate:"_startDateIndex"},yS=Object.values(pS),kS=Object.freeze([]),bS=my.MILLIS_PER_DAY,CS=function(){return w((function e(t,n){m(this,e),this.dayTime=n||my.MIDNIGHT,this.store=t,this.users=[this.dayTime]}),[{key:"add",value:function(e,t,n){var r=this[pS[e]],i=this.dayTime.dateKey(t);(r[i]||(r[i]=new o)).add(n)}},{key:"addEvent",value:function(e){var t,n,r=null===(t=this.dayTime.startOfDay(e.startDate))||void 0===t?void 0:t.getTime();if(r){var i,a;n=null!==(i=null===(a=e.endDate)||void 0===a?void 0:a.getTime())&&void 0!==i?i:r,this.add("startDate",r,e);do{this.add("date",r,e),r+=bS}while(r<n)}}},{key:"clear",value:function(){var e=this;yS.forEach((function(t){return e[t]=Object.create(null)}))}},{key:"get",value:function(e,t,n){!this.initialized&&this.initialize();var r,i=this[pS[e]];return t&&(r=this.dayTime.dateKey(t),i=n?[i[r],r]:i[r]),i}},{key:"initialize",value:function(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}},{key:"invalidate",value:function(){var e=this;this.initialized=!1,yS.forEach((function(t){return e[t]=null}))}},{key:"matches",value:function(e){return this.dayTime.startShift===e.startShift}},{key:"remove",value:function(e,t,n){var r=this[pS[e]][this.dayTime.dateKey(t)];r&&r.delete(n)}},{key:"removeEvent",value:function(e,t,n){var r,i,a=null===(r=this.dayTime.startOfDay(t))||void 0===r?void 0:r.getTime();if(a){var o;i=null!==(o=null==n?void 0:n.getTime())&&void 0!==o?o:a,this.remove("startDate",a,e);do{this.remove("date",a,e),a+=bS}while(a<i)}}},{key:"sync",value:function(e,t,n,r,i){var a,o;n=n||kS;var l,s,u,c=this,d=(t=t||kS).length,h=n.length,f=null==r?void 0:r.length;if(c.initialized)switch(e){case"clear":c.clear();break;case"splice":if(f)for(t=t.slice(),n=n.slice(),l=0;l<f;l++)n.push(r[l][0]),t.push(r[l][1]);if(h)for(l=0;l<h;l++)u=n[l],c.removeEvent(u,u.startDate,u.endDate);if(d)for(l=0;l<d;l++)(s=t[l]).isScheduled&&!s.isParent&&c.addEvent(s);break;case"reschedule":u=t[0],c.removeEvent(u,(null===(a=i.startDate)||void 0===a?void 0:a.oldValue)||u.startDate,(null===(o=i.endDate)||void 0===o?void 0:o.oldValue)||u.endDate),c.sync("splice",t)}}},{key:"register",value:function(e){this.users.push(e)}},{key:"unregister",value:function(e){var t=this.users,n=t.indexOf(e);return n>-1&&t.splice(n,1),!t.length}}])}(),wS=CS.prototype;yS.forEach((function(e){return wS[e]=null})),wS.initialized=!1,CS._$name="EventDayIndex";var DS=my.MIDNIGHT,SS=Object.freeze([]),xS=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=this;e.globalOccurrences=new a,e.recurringEvents=new o,e.ion({removeAll:function(){e.globalOccurrences.clear()}});for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];B(t,"construct",this,3)(r)}},{key:"afterLoadData",value:function(){var e;this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),null===(e=B(t,"afterLoadData",this,3))||void 0===e||e([])}},{key:"onDataChange",value:function(e){var n=e.action,r=e.added,i=e.removed,a=e.replaced;this.refreshRecurringEventsCache(n,r,i,a),B(t,"onDataChange",this,3)(arguments)}},{key:"refreshRecurringEventsCache",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:SS,n=arguments.length>2&&arguments[2]!==i?arguments[2]:SS,r=arguments.length>3?arguments[3]:i,a=this.recurringEvents,o=null==r?void 0:r.length;switch(e){case"clear":a.clear();break;case"splice":if(o){t=t.slice(),n=n.slice();for(var l=0;l<o;l++)n.push(r[l][0]),t.push(r[l][1])}var s=t.length,u=n.length;if(u&&a.size)for(var c=0;c<u;c++)a.delete(n[c]);if(s)for(var d=0;d<s;d++){var h=t[d];h.isRecurring&&a.add(h)}}}},{key:"getById",value:function(e){var n=B(t,"getById",this,3)([e]);return n||(n=this.globalOccurrences.get(this.modelClass.asId(e))),n}},{key:"onModelChange",value:function(e,n,r,i,a){var o=!i&&this.isRecurrenceRelatedFieldChange(e,r);if(o&&e.removeOccurrences(),B(t,"onModelChange",this,3)(arguments),o){var l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}},{key:"isRecurrenceRelatedFieldChange",value:function(e,t){return e.isRecurring||"recurrenceRule"in t}},{key:"getOccurrencesForTimeSpan",value:function(e,t,n){var r=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,n,(function(e){return r.push(e)})),r}},{key:"data",set:function(e){this.globalOccurrences.clear(),V(t,"data",e,this,1,1)}},{key:"getRecurringTimeSpans",value:function(){return z(this.recurringEvents)}}])}(e||Mn),S(t,"$name","RecurringTimeSpansMixin"),S(t,"configurable",{autoAdjustRecurrence:null}),t},ES=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getRecurringEvents",value:function(){return this.getRecurringTimeSpans()}},{key:"isEventPersistable",value:function(e){return B(t,"isEventPersistable",this,3)([e])&&(!e.supportsRecurring||!e.isOccurrence)}}])}(xS(e||Mn)),S(t,"$name","RecurringEventsMixin"),t},RS=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,TS=["SU","MO","TU","WE","TH","FR","SA"],MS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"decodeDay",value:function(e){var t,n;return(t=RS.exec(e))&&(n=[TS.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),n.push(t[1]))),n}},{key:"encodeDay",value:function(e){var t;if(Array.isArray(e)){var n=_(e,2);e=n[0],t=n[1]}return(t?t.toString():"")+TS[e]}},{key:"decode",value:function(e){var t,n=[];if(e)for(var r=0;r<e.length;r++)(t=this.decodeDay(e[r]))&&n.push(t);return n}},{key:"encode",value:function(e){var t,n=[];if(e)for(var r=0;r<e.length;r++)(t=this.encodeDay(e[r]))&&n.push(t);return n}}])}(Mn);MS._$name="RecurrenceDayRuleEncoder";var FS,AS=/ly$/i,IS=function(e){var t=e.replace(AS,"");return"DAI"===t?"DAY":t},LS=function(e,t,n,r){return r.buildOccurrence(e,n)},OS=function(e){return FS=e},PS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"processIterationConfig",value:function(e){var t,n=e.recurrence,r=n.frequency,i=n.interval,a=n.timeSpan,o=n.endDate,l=n.count;if(!e.syncingStartDate&&!a.meta.isSyncedWithRule){var s=Pl.add(a.startDate,i,IS(r)),u=Pl.min(s,e.endDate||s);this.forEachDate({syncingStartDate:!0,startDate:a.startDate,endDate:u,recurrence:n,fn:LS})}var c=a.startDate,d=e.startDate,h=void 0===d?c:d,f=e.endDate,v=void 0===f?o:f;h<c&&(h=c),o?(!v||v>o)&&(v=o):l&&h>c&&(this.forEachDate({recurrence:n,fn:OS}),(!v||v>FS)&&(v=new Date(FS.getTime()+1)));var g=h;return e.startOnly||(h=new Date(Pl.max(Pl.add(h,-i,IS(r)),c))),Object.assign({extraArgs:[],startOnly:!Boolean(a.durationMS)},e,{startDate:h,endDate:v,timeSpan:a,timeSpanStart:c,earliestVisibleDate:g,endDateMS:null===(t=v)||void 0===t?void 0:t.getTime(),timeSpanStartMS:c.getTime(),earliestVisibleDateMS:g.getTime(),durationMS:a.durationMS,spansStart:h<=c&&v>c})}},{key:"getOccurrenceIndex",value:function(e){if(e.isOccurrence)return Pl.diff(e.recurringTimeSpan.startDate,e.startDate,IS(e.recurringTimeSpan.recurrence.frequency))}},{key:"getNthDayInPeriod",value:function(e,t,n,r){var i,a,o;if(r){r>0?(a=1,o=e):(a=-1,o=t);var l=n-o.getDay();a*l<0&&(r+=a),(i=new Date(o)).setDate(o.getDate()+7*(r-a)+l),(i<e||i>t)&&(i=null)}return i}},{key:"buildDate",value:function(e,t,n){var r=new Date(e,t,n);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n)return r}},{key:"isValidPosition",value:function(e){return Boolean(e)}},{key:"forEachDateAtPositions",value:function(e,t,n,r){for(var i=e.length,a={},o=0;o<t.length;o++){var l=t[o];if(this.isValidPosition(l)){var s=l>0?e[l-1]:e[i+l];if(s&&!a[s.getTime()]&&(a[s.getTime()]=!0,!1===n.call(r,s)))return!1}}}},{key:"isInView",value:function(e,t,n,r,i){return(e?t>=n:t.valueOf()+r>n)&&!i.hasException(t)}},{key:"isInViewMS",value:function(e,t,n,r,i,a){return(e?n>=r:n+i>r)&&!a.hasException(t)}}])}(Mn);S(PS,"frequency","NONE"),S(PS,"MAX_OCCURRENCES_COUNT",1e6),PS._$name="AbstractRecurrenceIterator";var _S=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"forEachDate",value:function(e){var t=this.processIterationConfig(e),n=t.startOnly,r=t.startDate,i=t.endDate,a=t.endDateMS,o=t.timeSpan,l=t.timeSpanStart,s=t.earliestVisibleDateMS,u=t.durationMS,c=t.spansStart,d=t.recurrence,h=t.fn,f=t.extraArgs,v=t.scope,g=void 0===v?this:v,m=d.interval,p=r-l,y=864e5*m,k=Math.floor(p/y),b=d.count,C=0,w=Pl.add(l,k*m,"day"),D=w.getTime();for(i||b||(b=this.MAX_OCCURRENCES_COUNT);!a||D<a;){var S=this.isInViewMS(n,w,D,s,u,o);if(C++,b&&C>b||a&&D>=a||S&&!1===h.apply(g,[w,C,1===C&&c,o].concat(z(f))))break;D=(w=Pl.add(w,m,"day")).getTime()}}}])}(PS);S(_S,"frequency","DAILY"),_S._$name="DailyRecurrenceIterator";var HS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"forEachDate",value:function(e){var t,n,r,i=this.processIterationConfig(e),a=i.startOnly,o=i.startDate,l=i.endDateMS,s=i.timeSpan,u=i.timeSpanStart,c=i.timeSpanStartMS,d=i.earliestVisibleDateMS,h=i.durationMS,f=i.spansStart,v=i.recurrence,g=i.fn,m=i.extraArgs,p=i.scope,y=void 0===p?this:p,k=v.interval,b=v.days,C=Pl.weekStartDay,w=u.getHours(),D=u.getMinutes(),S=u.getSeconds(),x=u.getMilliseconds(),E=0,R=v.count,T=MS.decode(b);if(null!==(t=T)&&void 0!==t&&t.length||(T=[[u.getDay()]]),C>0)for(var M=0;M<T.length;M++)C>T[M][0]?T[M][0]=7-C-T[M][0]:T[M][0]-=C;for(T.sort((function(e,t){return e[0]-t[0]})),n=Pl.getNext(R||k>1?u:o,"week",0),l||R||(R=this.MAX_OCCURRENCES_COUNT);!l||n.getTime()<l;){for(var F=0;F<T.length;F++){var A=(r=new Date(n.getFullYear(),n.getMonth(),n.getDate()+T[F][0],w,D,S,x)).getTime();if(A>=c){var I=this.isInViewMS(a,r,A,d,h,s);if(E++,R&&E>R||l&&A>=l||I&&!1===g.apply(y,[r,E,1===E&&f,s].concat(z(m))))return}}n=Pl.getNext(n,"week",k)}}}])}(PS);S(HS,"frequency","WEEKLY"),HS._$name="WeeklyRecurrenceIterator";var BS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"getNthDayOfMonth",value:function(e,t){var n=Pl.daysInMonth(e),r=null;return t&&Math.abs(t)<=n&&(r=new Date(e.getFullYear(),e.getMonth(),t<0?n+t+1:t)),r}},{key:"isValidPosition",value:function(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}},{key:"forEachDate",value:function(e){var t,n,r,i,a,o,l=this,s=this.processIterationConfig(e),u=s.startOnly,c=s.startDate,d=s.endDate,h=s.timeSpan,f=s.timeSpanStart,v=s.earliestVisibleDate,g=s.durationMS,m=s.spansStart,p=s.recurrence,y=s.fn,k=s.extraArgs,b=s.scope,C=void 0===b?this:b,w=p.interval,D=p.days,S=p.count,x=p.positions,E=MS.decode(D),R=x&&x.length,T={},M=p.monthDays,F=0;for(n=Pl.startOf(S||w>1?f:c,"month"),r=new Date(Pl.getNext(n,"month",1)-1),M&&M.length||E&&E.length||(M=[f.getDate()]),E&&E.length&&E.forEach((function(e){e[1]&&((t=t||{})[e[0]]=e[1])}));(!d||d>n)&&(!S||F<S);){if(i=[],null!=E&&E.length){if(E.forEach((function(e){var t=e[0],s=1,u=53;for(e[1]&&(s=u=e[1]),o=s;o<=u;o++)(a=l.getNthDayInPeriod(n,r,t,o))&&(a=Pl.copyTimeValues(a,f),T[a.getTime()]||(T[a.getTime()]=!0,i.push(a)))})),i.sort((function(e,t){return e-t})),!R)for(o=0;o<i.length;o++)if((a=i[o])>=f){var A=this.isInView(u,a,v,g,h);if(F++,S&&F>S||d&&a>=d||A&&!1===y.apply(C,[a,F,1===F&&m,h].concat(z(k))))return!1}}else{var I=[];for(o=0;o<M.length;o++)(a=this.getNthDayOfMonth(n,M[o]))&&!T[a.getTime()]&&(T[a.getTime()]=!0,I.push(a));for(I.sort((function(e,t){return e-t})),o=0;o<I.length;o++)if(a=Pl.copyTimeValues(I[o],f),R)i.push(a);else if(a>=f){var L=this.isInView(u,a,v,g,h);if(F++,S&&F>S||d&&a>=d||L&&!1===y.apply(C,[a,F,1===F&&m,h].concat(z(k))))return}}if(R&&i.length&&!1===this.forEachDateAtPositions(i,x,(function(e){if(e>=f){var t=u?e>=v:e.valueOf()+g>v&&!h.hasException(e);if(F++,S&&F>S||d&&e>=d||t&&!1===y.apply(C,[e,F,1===F&&m,h].concat(z(k))))return!1}})))return!1;n=Pl.getNext(n,"month",w),r=new Date(Pl.getNext(n,"month",1)-1)}}}])}(PS);S(BS,"frequency","MONTHLY"),BS._$name="MonthlyRecurrenceIterator";var VS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"forEachDate",value:function(e){var t,n,r,i,a,o,l,s,u=this,c=this.processIterationConfig(e),d=c.startOnly,h=c.startDate,f=c.endDate,v=c.timeSpan,g=c.timeSpanStart,m=c.earliestVisibleDate,p=c.durationMS,y=c.spansStart,k=c.recurrence,b=c.fn,C=c.extraArgs,w=c.scope,S=void 0===w?this:w,x=k.interval,E=k.days,R=k.count,T=k.positions,M=MS.decode(E),A=null==T?void 0:T.length,I={},L=k.months,O=0;for(o=Pl.startOf(R||x>1?g:h,"year"),l=new Date(Pl.getNext(o,"year",1)-1),null===(t=L)||void 0===t||t.sort((function(e,t){return e-t})),null!==(n=L)&&void 0!==n&&n.length||null!=M&&M.length||(L=[g.getMonth()+1]),null==M||M.forEach((function(e){e[1]&&((s=s||{})[e[0]]=e[1])}));(!f||f>o)&&(!R||O<R);){var P;if(a=[],null!=E&&E.length&&null!==(P=L)&&void 0!==P&&P.length){var _,H=D(L);try{for(H.s();!(_=H.n()).done;){var B=_.value;o=new Date(o.getFullYear(),B-1),l=new Date(o.getFullYear(),B,-1);var V=F(F({},e),{},{fn:function(e,t,n){if(e>=g){var r=u.isInView(d,e,m,p,v);if(O++,r){for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];return b.apply(S,[e,O,1===O&&n].concat(a))}}},startDate:o,endDate:l,recurrence:k.constructor.new({timeSpan:k.timeSpan,frequency:"MONTHLY",days:E,positions:T})});BS.forEachDate(V)}}catch(e){H.e(e)}finally{H.f()}}else{if(null!=M&&M.length){if(M.forEach((function(e){var t=e[0],n=1,s=53;for(e[1]&&(n=s=e[1]),r=n;r<=s;r++)(i=u.getNthDayInPeriod(o,l,t,r))&&(i=Pl.copyTimeValues(i,g),I[i.getTime()]||(I[i.getTime()]=!0,a.push(i)))})),a.sort((function(e,t){return e-t})),!A)for(r=0;r<a.length;r++)if((i=a[r])>=g){var N=this.isInView(d,i,m,p,v);if(O++,R&&O>R||f&&i>=f||N&&!1===b.apply(S,[i,O,1===O&&y,v].concat(z(C))))return}}else for(r=0;r<L.length;r++)if((i=this.buildDate(o.getFullYear(),L[r]-1,g.getDate()))&&(i=Pl.copyTimeValues(i,g),!I[i.getTime()]))if(I[i.getTime()]=!0,A)a.push(i);else if(i>=g){var j=d?i>=m:i.valueOf()+p>m&&!v.hasException(i);if(O++,R&&O>R||f&&i>=f||j&&!1===b.apply(S,[i,O,1===O&&y,v].concat(z(C))))return}if(A&&a.length&&!1===this.forEachDateAtPositions(a,T,(function(e){if(e>=g){var t=d?e>=m:e.valueOf()+p>m&&!v.hasException(e);if(O++,t&&(!f||e<f)&&(!1===b.apply(S,[e,O,1===O&&y,v].concat(z(C)))||R&&O>=R))return!1}})))return!1}o=Pl.getNext(o,"year",x),l=new Date(Pl.getNext(o,"year",1)-1)}}}])}(PS);S(VS,"frequency","YEARLY"),VS._$name="YearlyRecurrenceIterator";var NS={};[_S,HS,BS,VS].forEach((function(e){NS[e.frequency]=e}));var zS={DAILY:"days",WEEKLY:"weeks",MONTHLY:"months",YEARLY:"years"},jS={MO:"Mon",TU:"Tue",WE:"Wed",TH:"Thu",FR:"Fri",SA:"Sat",SU:"Sun"};function WS(e){return e?"string"==typeof e&&(e=e.split(",").map((function(e){return parseInt(e,10)}))):e=null,e}function $S(e,t){return String(e)===String(t)}function US(e){return this.defaultValue&&e===i?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?i:e)}var GS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this,r=e.rule,a=e.timeSpan,o=e.laterJsSchedule;n._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,delete e.laterJsSchedule,B(t,"construct",this,3)(arguments),r&&(n.suspendTimeSpanNotifying(),n.rule=r,n.resumeTimeSpanNotifying()),n.timeSpan=a,o&&(n.laterJsSchedule=o)}},{key:"dateFormat",get:function(){return this._dateFormat||"YYYYMMDDTHHmmss"},set:function(e){this._dateFormat=e}},{key:"recurrenceIterator",get:function(){return NS[this.frequency]}},{key:"timeSpan",get:function(){return this._timeSpan},set:function(e){this._timeSpan=e}},{key:"timeSpanDate",get:function(){var e;return null===(e=this.timeSpan)||void 0===e?void 0:e.startDate}},{key:"getDateValues",value:function(e){return e=this.date||this.timeSpanDate,this.constructor.getDateValues(e)}},{key:"getRRule",value:function(){var e,t,n,r=arguments.length>0&&arguments[0]!==i&&arguments[0],a=this,o=a.date||a.timeSpanDate,l=[];if(a.frequency){var s,u,c,d;l.push("FREQ=".concat(a.frequency));var h=a.days,f=a.monthDays,v=a.months;if(r&&o){var g=a.constructor.getDateValues(o),m=g.days,p=g.monthDays,y=g.months;switch(a.frequency){case"WEEKLY":h||(h=m);break;case"MONTHLY":null!==(e=f)&&void 0!==e&&e.length||(f=p);break;case"YEARLY":null!==(t=f)&&void 0!==t&&t.length||(f=p),null!==(n=v)&&void 0!==n&&n.length||(v=y)}}a.interval>1&&l.push("INTERVAL=".concat(a.interval)),null!==(s=h)&&void 0!==s&&s.length&&l.push("BYDAY="+h.join(",")),null!==(u=f)&&void 0!==u&&u.length&&l.push("BYMONTHDAY="+f.join(",")),null!==(c=v)&&void 0!==c&&c.length&&l.push("BYMONTH="+v.join(",")),a.count&&l.push("COUNT=".concat(a.count)),a.endDate&&l.push("UNTIL="+Pl.format(a.endDate,a.dateFormat)),null!==(d=a.positions)&&void 0!==d&&d.length&&l.push("BYSETPOS="+a.positions.join(",")),null!=a.timeZone&&l.push("TZID="+a.timeZone)}return l.join(";")}},{key:"rule",get:function(){return this.getRRule()},set:function(e){var t=this,n={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null,timeZone:null};if(t.beginBatch(),e)for(var r=e.split(";"),i=0,a=r.length;i<a;i++){var o=r[i].split("="),l=o[1];switch(o[0]){case"FREQ":n.frequency=l;break;case"INTERVAL":n.interval=l;break;case"COUNT":n.count=l,n.until=null;break;case"UNTIL":n.endDate=l?Pl.parse(l,t.dateFormat):null,n.count=null;break;case"BYDAY":n.days=l;break;case"BYMONTHDAY":n.monthDays=l;break;case"BYMONTH":n.months=l;break;case"BYSETPOS":n.positions=l;break;case"TZID":n.timeZone=l}}t.set(n),e&&t.sanitize(),t.endBatch()}},{key:"forEachOccurrence",value:function(e,t,n){this.timeSpanDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn:function(e,t,r,i){return n(i.buildOccurrence(e,r),r,t,e)}})}},{key:"sanitize",value:function(){var e=this,t=e.timeSpanDate,n={};switch(e.isSanitizingSuspended=!0,e.frequency){case"DAILY":n.positions=null,n.days=null,n.monthDays=null,n.months=null;break;case"WEEKLY":n.positions=null,n.monthDays=null,n.months=null;var r=e.days;t&&1===(null==r?void 0:r.length)&&r[0]===MS.encodeDay(t.getDay())&&(n.days=null);break;case"MONTHLY":var i;null!==(i=e.monthDays)&&void 0!==i&&i.length&&(n.positions=null,n.days=null),n.months=null;var a=e.monthDays;t&&1===(null==a?void 0:a.length)&&a[0]===t.getDate()&&(n.monthDays=null);break;case"YEARLY":var o,l=e.months,s=(null===(o=this.days)||void 0===o?void 0:o.length)||0;7===s&&(n.days=null),!t||1!==(null==l?void 0:l.length)||s&&s<7||l[0]!==t.getMonth()+1||(n.months=null)}e.set(n),e.isSanitizingSuspended=!1}},{key:"copy",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=B(t,"copy",this,3)(n);return i.dateFormat=this.dateFormat,i.timeSpan=this.timeSpan,i}},{key:"afterChange",value:function(e,n,r){var i=B(t,"afterChange",this,3)([e,n,r]),a=this.timeSpan;return this.isSanitizingSuspended||this.sanitize(),a&&(a.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||a.onRecurrenceChanged.apply(a,[this].concat(Array.prototype.slice.call(arguments)))),i}},{key:"setValue",value:function(e,n){return"monthDays"===e&&Number.isInteger(n)&&(n=[n]),B(t,"setValue",this,3)([e,n])}},{key:"set",value:function(e,n){var r="object"===W(e)?e:S({},e,n);r.count?r.endDate=null:r.endDate&&(r.count=null);for(var a=arguments.length,o=new Array(a>2?a-2:0),l=2;l<a;l++)o[l-2]=arguments[l];return B(t,"set",this,3)([r,i].concat(o))}},{key:"isTimeSpanNotifyingSuspended",get:function(){return Boolean(this._suspendedTimeSpanNotifying)}},{key:"suspendTimeSpanNotifying",value:function(){this._suspendedTimeSpanNotifying++}},{key:"resumeTimeSpanNotifying",value:function(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}},{key:"reset",value:function(){var e=this;this.allFields.forEach((function(t){var n=t.name;return e.set(n,null)}))}},{key:"laterJsSchedule",get:function(){var e=this.frequency,t=this.interval,n=this.days,r=this.monthDays,i=this.months,a=this.positions,o=t>1?"every ".concat(t," ").concat(zS[e]," "):"";switch(this.frequency){case"YEARLY":null!=i&&i.length&&(o+="on the ".concat(i.join(",")," month "));case"MONTHLY":if(null!=r&&r.length){o+="on the ".concat(r.join(",")," day ");break}case"WEEKLY":null!=n&&n.length&&(o+="on ".concat(n.map((function(e){return jS[e]})).join(",")," ")),null!=a&&a.length&&(o+="on the ".concat(a.join(",")," day instance "))}return o.trim()},set:function(e){var t;if(e=(null===(t=e)||void 0===t||null===(t=t.schedules)||void 0===t?void 0:t[0])||e){this.reset();var n=e,r=n.s,i=n.m,a=n.h,o=n.t,l=n.D,s=n.d,u=n.M,c={interval:1};(r||i||a||o)&&(c.frequency="DAILY"),s&&(c.frequency="WEEKLY",c.days=s.map((function(e){return MS.encodeDay(e-1)}))),l&&(c.frequency="MONTHLY",c.monthDays=l.map((function(e){return e||-1}))),u&&(c.frequency="YEARLY",c.months=u.slice()),Object.assign(this,c)}}}],[{key:"processData",value:function(e,n,r,i,a){var o=this.fieldMap,l=o.date,s=l.name,u=l.dataSource,c=e[u||s];return"string"==typeof c&&(c=o.date.convert(c,e,i)),c&&(Object.assign(e,this.getDateValues(c)),e[u||s]=c),B(t,"processData",this,2)([e,n,r,i,a])}},{key:"getDateValues",value:function(e){if(e)return{days:[MS.encodeDay(e.getDay())],monthDays:[e.getDate()],months:[e.getMonth()+1]}}}])}(od);function YS(e){var t={},n=this.dateFormat;return e&&(e="string"==typeof e?e.split(","):$e.asArray(e)).forEach((function(e){"string"==typeof e&&(e=Pl.parse(e,n)),isNaN(e)||(t[Pl.makeKey(e)]=1)})),t}function qS(e){var t=[],n=this.dateFormat;for(var r in e)e[r]&&t.push(Pl.format(Pl.parseKey(r),n));return t}S(GS,"$name","RecurrenceModel"),S(GS,"fields",[{name:"date",type:"date"},{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:US},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:US},{name:"days",convert:function(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e},isEqual:$S},{name:"monthDays",convert:WS,isEqual:$S},{name:"months",convert:WS,isEqual:$S},{name:"positions",convert:WS,isEqual:$S},{name:"timeZone",allowNull:!0}]),GS._$name="RecurrenceModel";var KS=[],XS=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"supportsRecurring",get:function(){return!0}},{key:"remove",value:function(){if(!this.isOccurrence)return B(t,"remove",this,3)(arguments);var e=this,n=e.recurringTimeSpan;e.cancelBatch(),n.beginBatch(),e.detachFromRecurringEvent(),n.endBatch()}},{key:"eventStore",get:function(){var e,n,r=this.isOccurrence&&(null===(e=this.recurringEvent)||void 0===e?void 0:e.eventStore)||B(t,"eventStore",this,1);return!r&&null!==(n=this.firstStore)&&void 0!==n&&n.isRecurringTimeSpansMixin&&(r=this.firstStore),r}},{key:"recurrenceModel",get:function(){return this._recurrenceModel||GS},set:function(e){this._recurrenceModel=e}},{key:"setRecurrence",value:function(e,t,n){var r,i=this;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),n&&(n instanceof Date?e.endDate=n:e.count=n)),e=new i.recurrenceModel(e)),e.timeSpan=i,r=e.rule),i.recurrence=e,i.recurrenceRule=r}},{key:"recurrence",get:function(){var e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:"".concat(e.id,"-recurrence")})),e._recurrence},set:function(e){var t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}},{key:"isRecurring",get:function(){return Boolean(!this.isOccurrence&&this.recurrence)}},{key:"isOccurrence",get:function(){return Boolean(this.recurringTimeSpan)}},{key:"recurringTimeSpan",get:function(){return this._recurringTimeSpan},set:function(e){this._recurringTimeSpan=e}},{key:"isPersistable",get:function(){return B(t,"isPersistable",this,1)&&(!this.supportsRecurring||!this.isOccurrence)}},{key:"getOccurrencesForDateRange",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e;return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}},{key:"occurrences",get:function(){var e=this;if(this.isRecurring){var t=[];return this.occurrenceMap.forEach((function(n){n!==e&&t.push(n)})),t}return KS}},{key:"occurrenceMap",get:function(){return this._occurrencesMap||(this._occurrencesMap=new a)}},{key:"removeOccurrence",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.eventStore,n=e.isTimeSpan?e.occurrenceDate:e;null==t||t.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(Pl.makeKey(n))}},{key:"removeOccurrencesFrom",value:function(e){var t=this;this.occurrenceMap.forEach((function(n,r){Pl.parseKey(r)>=e&&t.removeOccurrence(n)}))}},{key:"removeOccurrences",value:function(e){var t=this;[this].concat(z(this.occurrences)).forEach((function(n){return t.removeOccurrence(n,e)}))}},{key:"onRecurrenceChanged",value:function(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}},{key:"sanitizeRecurrenceData",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.recurrence;if(this.removeOccurrences(),e.endDate){var t=Pl.clearTime(e.endDate),n=this.exceptionDates;if(n)for(var r in n){Pl.parseKey(r)>=t&&delete n[r]}}}},{key:"occurrenceDate",get:function(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}},{key:"occurrenceIndex",get:function(){return PS.getOccurrenceIndex(this)}},{key:"buildOccurrence",value:function(e,t){var n,r=this,a=r.occurrenceMap,o=r.recurrence,l=r.meta,s=null===(n=r.eventStore)||void 0===n?void 0:n.globalOccurrences,u=Pl.makeKey(e),c=r.createRecurrenceKey(e,u),d=!(e-r.startDate),h=r.constructor.fieldMap,f=null==s?void 0:s.get(c),v=r.duration;!r.endDate||!r.allDay&&v||(v=Pl.as(r.durationUnit,r.endDate.getTime()-r.startDate.getTime()));var g=v!==i?Pl.add(e,v,r.durationUnit):i;if(!f){if(t||d){var m,p;if(f=r,!d&&null==(null===(m=r.recurrence)||void 0===m?void 0:m.timeZone))r.preventRecurrenceSync=!0,r._preventInvalidation=null===(p=r.project)||void 0===p?void 0:p.isWritingData,r.setStartEndDate(e,g,!0),r._preventInvalidation=!1,r.preventRecurrenceSync=!1,o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying();l.isSyncedWithRule=!0}else(f=r.copy(S(S(S(S(S(S({},h.id.dataSource,c),h.startDate.dataSource,e),h.endDate.dataSource,g),h.duration.dataSource,v),"constraintDate",null),"constraintType",null),{creatingOccurrence:!0})).recurringTimeSpan=r;null==s||s.set(c,f),a.set(u,f)}return f}},{key:"createRecurrenceKey",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.startDate,t=arguments.length>1&&arguments[1]!==i?arguments[1]:null;return"_generated:".concat(this.id,":").concat(t||Pl.makeKey(e))}},{key:"convertToRealEvent",value:function(e,t){var n;if(this.isOccurrence){var r=this,i=r.recurringTimeSpan,a=r.resource,o=r.occurrenceIndex,l=r.recurrence&&i.recurrence.count,s=(null==e||null===(n=e.resourceRecords)||void 0===n?void 0:n.value)||r.data.newResource;i.beginBatch(),r.detachFromRecurringEvent(),r.internalClearChanges(),r._id=r.generateId(i.eventStore),r.setData("id",r._id),s&&delete r.data.resourceId,i.eventStore.add(r,t),l&&(r.recurrence.count=l-o),(s||a)&&r.assign(s||a),s&&delete r.data.resourceRecords,e&&delete e.resourceRecords,i.endBatch()}}},{key:"afterChange",value:function(e,n,r){var i=this,a=i.eventStore;if("recurrenceRule"in n&&(i._recurrence=null,null==a||a.recurringEvents[n.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence)i.convertToRealEvent(n,r);else{if(!i.preventRecurrenceSync&&"startDate"in n&&i.isRecurring&&null!=a&&a.autoAdjustRecurrence){var l,s,u,c,d,h=i.recurrence,f=i.startDate,v=n.startDate.oldValue,g=f.getDate(v),m=Math.ceil(g/7),p=f.getDate(),y=f.getDay(),k=MS.encodeDay(y),b=f.getMonth()+1,C=Math.ceil(p/7),w=null===(l=h.days)||void 0===l?void 0:l.slice(),D=null===(s=h.months)||void 0===s?void 0:s.slice(),S=null===(u=h.monthDays)||void 0===u?void 0:u.slice(),x=null===(c=h.positions)||void 0===c?void 0:c.slice();h.beginBatch(),null!==(d=i.getOccurrencesForDateRange(f,Pl.add(f,1)).filter((function(e){return!(e.startDate-f)})))&&void 0!==d&&d.length||(null!=w&&w.length&&($e.remove(w,MS.encodeDay(v.getDay())),w.push(k),h.days=w.sort()),null!=S&&S.length&&($e.remove(S,v.getDate()),S.push(p),h.monthDays=S.sort()),null!=x&&x.length&&($e.remove(x,m),x.push(C),h.positions=z(new o(x)).sort()),null!=D&&D.length&&($e.remove(D,v.getMonth()+1),D.push(b),h.months=z(new o(D)).sort())),h.endBatch()}"newExceptionDate"in n&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(n.newExceptionDate.value)),n.recurrenceRule&&!n.recurrenceRule.value&&(i.meta.modified.exceptionDates=!0,i.exceptionDates={})}for(var E=arguments.length,R=new Array(E>3?E-3:0),T=3;T<E;T++)R[T-3]=arguments[T];return B(t,"afterChange",this,3)([e,n,r].concat(R))}},{key:"detachFromRecurringEvent",value:function(){var e=this,t=e.recurringTimeSpan,n=e.occurrenceDate,r=e.startDate;e.recurringTimeSpan=null,t.addExceptionDate(n),e.recurrenceRule&&(t.recurrence.endDate=Pl.add(r,-1,"minute"))}},{key:"newExceptionDate",set:function(e){e&&((this.exceptionDates||(this.exceptionDates={}))[Pl.makeKey(e)]=1)}},{key:"addExceptionDate",value:function(e){this.set({newExceptionDate:e})}},{key:"hasException",value:function(e){var t;return Boolean(null===(t=this.exceptionDates)||void 0===t?void 0:t[Pl.makeKey(e)])}}])}(e||Bw),S(t,"$name","RecurringTimeSpan"),S(t,"fields",[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:YS,serialize:qS,internal:!0}]),t},ZS=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateAssignmentEventIds",value:function(){var e=this;this.assigned.forEach((function(t){t.eventId=e.id}))}},{key:"syncId",value:function(e){B(t,"syncId",this,3)([e]),this.updateAssignmentEventIds()}},{key:"setValue",value:function(e,n){if("resource"!==e||this.usesSingleAssignment)return B(t,"setValue",this,3)([e,n]);var r;this.resources=null!==(r=$e.asArray(n))&&void 0!==r?r:[]}},{key:"resources",get:function(){return this.assignments.reduce((function(e,t){var n=t.resource;return n&&e.push(n.$original),e}),[])},set:function(e){var t;e=$e.asArray(e);var n=this,r=e.map(n.constructor.asId);if(n.usesSingleAssignment)n.set("resourceId",r[0]);else if(null!==(t=n.fieldMap)&&void 0!==t&&t.resourceIds.persist)n.resourceIds=r;else{var i=n.assignments.map((function(e){return e.resource.id})),a=$e.delta(r,i),o=a.onlyInA,l=a.onlyInB;n.assignmentStore.add(o.map((function(e){return{resource:e,event:n}}))),n.assignmentStore.remove(l.map((function(e){return n.assignments.find((function(t){return t.resource.id===e}))})))}}},{key:"forEachResource",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this,r=D(this.resources);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(!1===e.call(n,a))return}}catch(e){r.e(e)}finally{r.f()}}},{key:"getResource",value:function(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}},{key:"startDate",get:function(){var e,n;this.isOccurrence?e=this.get("startDate"):e=null!==(n=this._startDate)&&void 0!==n?n:B(t,"startDate",this,1);return this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e},set:function(e){this.batching?(this._startDate=e,this.set({startDate:e})):V(t,"startDate",e,this,1,1)}},{key:"endDate",get:function(){var e,n;this.isOccurrence?e=this.get("endDate"):e=null!==(n=this._endDate)&&void 0!==n?n:B(t,"endDate",this,1);return this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e},set:function(e){this.batching?(this._endDate=e,this.set({endDate:e})):V(t,"endDate",e,this,1,1)}},{key:"wrapStartDate",get:function(){return this.startDate},set:function(e){}},{key:"wrapEndDate",get:function(){return this.endDate},set:function(e){}},{key:"isEvent",get:function(){return!0}},{key:"isDraggable",get:function(){return!this.readOnly&&this.draggable}},{key:"isResizable",get:function(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}},{key:"isPersistable",get:function(){return B(t,"isPersistable",this,1)&&!this.isCreating}},{key:"endBatch",value:function(e,n,r){var i=this,a=i.isPersistable;if(B(t,"endBatch",this,3)([e,n,r]),i.isPersistable&&!a&&!i.ignoreBag&&i.assigned){var o,l=D(i.assigned);try{var s=function(){var e=o.value;e.stores.forEach((function(t){return t.updateModifiedBagForRecord(e)}))};for(l.s();!(o=l.n()).done;)s()}catch(e){l.e(e)}finally{l.f()}}}},{key:"isCreating",get:function(){return B(t,"isCreating",this,1)},set:function(e){var n,r;V(t,"isCreating",e,this,1,1),null===(n=this.assignmentStore)||void 0===n||n.suspendAutoCommit(),this.assignments.forEach((function(t){return t.isCreating=e})),null===(r=this.assignmentStore)||void 0===r||r.resumeAutoCommit()}},{key:"usesSingleAssignment",get:function(){return!this.eventStore||this.eventStore.usesSingleAssignment}},{key:"copy",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=B(t,"copy",this,3)(n);return this.usesSingleAssignment||(i.resourceId=null),i}},{key:"persistableData",get:function(){var e=B(t,"persistableData",this,1);return this.usesSingleAssignment||delete e.resourceId,e}},{key:"resource",get:function(){var e=this.resources;return e.length?e[0]:null},set:function(e){this.resourceId=this.constructor.asId(e)}},{key:"resourceId",get:function(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.assignments[0])||void 0===e?void 0:e.resourceId},set:function(e){this.applyResourceId(e)}},{key:"resourceIds",get:function(){var e,t,n;return null!==(e=this.fieldMap)&&void 0!==e&&e.resourceIds.persist?this.get("resourceIds"):null!==(t=null===(n=this.resources)||void 0===n?void 0:n.map((function(e){return e.id})))&&void 0!==t?t:[]},set:function(e){this.set("resourceIds",e)}},{key:"$linkedResources",get:function(){var e,t;return null!==(e=null===(t=this.resources)||void 0===t?void 0:t.flatMap((function(e){return[e].concat(z(e.$links))})))&&void 0!==e?e:[]}},{key:"applyResourceId",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.eventStore,a=n.assignments;if(n.isApplyingResourceId)n.setData("resourceId",e);else{if(n.isApplyingResourceId=!0,r){var o,l,s=r.assignmentStore||(null===(o=r.crudManager)||void 0===o?void 0:o.assignmentStore);if(null!=e)if(n.meta.skipEnforcingSingleAssignment||(r.usesSingleAssignment=!0),null!=a&&a.length&&e!==a[0].resourceId){var u=Boolean(r.eventsSuspended);u&&s.suspendEvents(),a[0].resource=e,u&&s.resumeEvents()}else s.assignEventToResource(n,e);else(n.usesSingleAssignment||null!==(l=n.resourceIds)&&void 0!==l&&l.length)&&s.remove(a)}else t||n.set({resourceId:e});n.isApplyingResourceId=!1}}},{key:"applyResourceIds",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.eventStore,a=n.assignments;if(!1===n.fieldMap.resourceIds.persist)return!1;if(e=z(new o(e)),r){var l,s,u=r.assignmentStore||(null===(l=r.crudManager)||void 0===l?void 0:l.assignmentStore);if(null!==(s=e)&&void 0!==s&&s.length)if(null!=a&&a.length){var c=Boolean(r.eventsSuspended);c&&u.suspendEvents(),a.forEach((function(t){var n=e.find((function(e){return!a.some((function(t){return t.resourceId===e}))}));n&&(t.resource=n)}));var d=$e.delta(e,a.map((function(e){return e.resourceId}))),h=d.onlyInA,f=d.onlyInB;u.add(h.map((function(e){return{resource:e,event:n}}))),u.remove(f.map((function(e){return a.find((function(t){return t.resource.id===e}))}))),c&&u.resumeEvents()}else u.add(e.map((function(e){return{resource:e,event:n}})));else u.remove(a)}else t||n.set({resourceIds:e})}},{key:"applyValue",value:function(e,n,r,i,a){if(a&&!this.meta.isAssigning){var o=this.eventStore;switch(a.name){case"resourceId":o&&(o.isAssigning=!0),this.applyResourceId(r,!0);break;case"resourceIds":o&&(o.isAssigning=!0),this.applyResourceIds(r,!0)}o&&(o.isAssigning=!1)}B(t,"applyValue",this,3)([e,n,r,i,a])}},{key:"assignments",get:function(){return z(this.assigned||[])}},{key:"assign",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this.eventStore;if(n&&!n.usesSingleAssignment)return n.assignEventToResource(this,e,t);this.resourceId=this.constructor.asId(e),n||(this.meta.skipEnforcingSingleAssignment=!0)}},{key:"unassign",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=this;e=r.constructor.asId(e),r.meta.removingResource=n,null===(t=r.eventStore)||void 0===t||t.unassignEventFromResource(r,e),r.meta.removingResource=null}},{key:"reassign",value:function(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}},{key:"isAssignedTo",value:function(e){var t=this.constructor.asId(e);return this.assignments.some((function(e){return e.resourceId===t}))}},{key:"predecessors",get:function(){var e;return z(null!==(e=this.incomingDeps)&&void 0!==e?e:[])}},{key:"successors",get:function(){var e;return z(null!==(e=this.outgoingDeps)&&void 0!==e?e:[])}},{key:"dependencies",get:function(){var e,t;return[].concat(z(null!==(e=this.incomingDeps)&&void 0!==e?e:[]),z(null!==(t=this.outgoingDeps)&&void 0!==t?t:[]))}},{key:"normalize",value:function(){}},{key:"inSetNormalize",value:function(){}},{key:"recurringEvent",get:function(){return this.recurringTimeSpan}},{key:"isInterDay",get:function(){var e=this.durationMS;if(e>=864e5||!e&&this.allDay)return!0;var t=this.endDate,n=this.startDate,r=Pl.clearTime(n);return n&&t?(r.setDate(r.getDate()+1),(t||Pl.add(n,e))>r):void 0}},{key:"isEditable",value:function(e){var n=!0;switch(e){case"endDate":case"duration":case"fullDuration":n=this.isLeaf}return n&&B(t,"isEditable",this,3)([e])}}],[{key:"isEventModel",get:function(){return!0}},{key:"fields",get:function(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}},{key:"getAllDayStartDate",value:function(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=Pl.clearTime(e,!0)),e}},{key:"getAllDayEndDate",value:function(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=Pl.getNext(e,"d",1)),e}},{key:"getAllDayDisplayStartDate",value:function(e){return e&&e.isEvent&&(e=e.get("startDate")),Pl.clearTime(e,!0)}},{key:"getAllDayDisplayEndDate",value:function(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),Pl.clearTime(t,!0).valueOf()===t.valueOf()?t=Pl.add(t,Pl.DAY,-1):e.valueOf()!==t.valueOf()&&(t=Pl.clearTime(t,!0))),t}}])}(e),S(t,"$name","EventModelMixin"),t},JS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([nS],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments))._startDate=null,e._endDate=null,e._duration=null,e}return R(n,e),w(n,[{key:"startDate",get:function(){var e,t;return null!==(e=null!==(t=this._startDate)&&void 0!==t?t:this.get("startDate"))&&void 0!==e?e:null},set:function(e){this.proposeStartDate(e)}},{key:"endDate",get:function(){var e,t;return null!==(e=null!==(t=this._endDate)&&void 0!==t?t:this.get("endDate"))&&void 0!==e?e:null},set:function(e){this.proposeEndDate(e)}},{key:"duration",get:function(){var e,t;return null!==(e=null!==(t=this._duration)&&void 0!==t?t:this.get("duration"))&&void 0!==e?e:null},set:function(e){this.proposeDuration(e)}},{key:"inSet",value:function(e,n,r,i,a){var o=this;return!o.project||o.project.isWritingData||"string"==typeof e||a||("startDate"in e&&!("startDate"in o.$changed)&&(o.$changed.startDate=!0,o.invalidate()),"endDate"in e&&!("endDate"in o.$changed)&&(o.$changed.endDate=!0,o.invalidate())),t.inSet.call(o,e,n,r,i,a)}},{key:"getStartDate",value:function(){return this.startDate}},{key:"proposeStartDate",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:!("endDate"in this.$changed);(this.inSetting||(null==e?void 0:e.getTime())!==(null===(t=this.startDate)||void 0===t?void 0:t.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:n}))}},{key:"setStartDate",value:(o=f((function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return L().mark((function r(i){return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.proposeStartDate(e,n),r.abrupt("return",null===(i=t.project)||void 0===i?void 0:i.commitAsync());case 2:case"end":return r.stop()}}),r)}))()})),function(e){return o.apply(this,arguments)})},{key:"getEndDate",value:function(){return this.endDate}},{key:"proposeEndDate",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1];(this.inSetting||(null==e?void 0:e.getTime())!==(null===(t=this.endDate)||void 0===t?void 0:t.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:n}))}},{key:"setEndDate",value:(a=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(i){return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.proposeEndDate(e,n),r.abrupt("return",null===(i=t.project)||void 0===i?void 0:i.commitAsync());case 2:case"end":return r.stop()}}),r)}))()})),function(e){return a.apply(this,arguments)})},{key:"getDuration",value:function(){return this.duration}},{key:"proposeDuration",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2];this._duration=e,this.propose({duration:e,keepStart:n}),t&&this.propose({durationUnit:t})}},{key:"setDuration",value:(r=f((function(e,t){var n=this,r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];return L().mark((function i(a){return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.proposeDuration(e,t,r),i.abrupt("return",null===(a=n.project)||void 0===a?void 0:a.commitAsync());case 2:case"end":return i.stop()}}),i)}))()})),function(e,t){return r.apply(this,arguments)})},{key:"getDurationUnit",value:function(){return this.durationUnit}},{key:"joinProject",value:function(){var e=this,n=e.$changed,r=e.getCurrentOrProposed("startDate"),i=e.getCurrentOrProposed("endDate"),a=e.getCurrentOrProposed("duration");if(null!=r&&(n.startDate=e._startDate=r),null!=i&&(n.endDate=e._endDate=i),null!=a&&(n.duration=e._duration=a),e.eventStore&&!e.eventStore.isLoadingData){var o,l=null===(o=e.assignmentStore)||void 0===o?void 0:o.storage.findItem("event",null);if(l){var s,u=null===(s=e.assignmentStore)||void 0===s?void 0:s.storage.findItem("eventId",e.id);if(u){var c,d=D(u);try{for(d.s();!(c=d.n()).done;){c.value.setChanged("event",e)}}catch(e){d.e(e)}finally{d.f()}}else{var h,f=D(l);try{for(f.s();!(h=f.n()).done;){var v=h.value;v.getCurrentOrProposed("event")===e.id&&v.setChanged("event",e)}}catch(e){f.e(e)}finally{f.f()}}}}t.joinProject.call(e)}},{key:"applyValue",value:function(e,n,r,i,a){var o;if((this.project||null!==(o=this.recurringTimeSpan)&&void 0!==o&&o.project)&&a){var l=a.name;"startDate"!==l&&"duration"!=l&&"endDate"!==l||(e=!0,this["_"+l]=r),i&&(e=!1)}t.applyValue.call(this,e,n,r,i,a)}},{key:"afterChange",value:function(e,n,r,i,a){this.$isCalculating||a||this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,e,n,r,i,a)}},{key:"calculateInvalidated",value:function(){var e,t,n=this,r=n.$changed,i="startDate"in r,a="endDate"in r,o="duration"in r,l=r.startDate,s=r.endDate,u=r.duration,c=r.keepDuration,d=r.keepStart,h=null;!i||a||o?i||!a||o?i||a||!o?i&&a&&!o?null===l&&null===s?r.duration=null:h="duration":i&&!a&&o?h="endDate":!i&&a&&o?h="startDate":i&&a&&o&&(h=null==u?"duration":null==l?"startDate":"endDate"):null===u?r.endDate=null:!n.hasCurrentOrProposed("startDate")||!d&&n.hasCurrentOrProposed("endDate")?n.hasCurrentOrProposed("endDate")&&(h="startDate"):(d&&r.duration<0&&(r.duration=0),h="endDate"):null===s?r.startDate=null:n.hasCurrentOrProposed("startDate")&&!c&&!0!==s&&s<n.getCurrentOrProposed("startDate")?(r.startDate=s,r.duration=0):!n.hasCurrentOrProposed("duration")||!c&&n.hasCurrentOrProposed("startDate")?n.hasCurrentOrProposed("startDate")&&(h="duration"):h="startDate":null===l?r.endDate=null:n.hasCurrentOrProposed("endDate")&&l>n.getCurrentOrProposed("endDate")&&!c?(r.endDate=l,r.duration=0):!n.hasCurrentOrProposed("duration")||!c&&n.hasCurrentOrProposed("endDate")?n.hasCurrentOrProposed("endDate")&&(h="duration"):h="endDate";var f=n.getCurrentOrProposed("startDate"),v=n.getCurrentOrProposed("endDate"),g=n.getCurrentOrProposed("duration"),m=n.getCurrentOrProposed("durationUnit"),p=null!==(e=null===(t=n.getProject())||void 0===t?void 0:t.adjustDurationToDST)&&void 0!==e&&e;switch(h){case"startDate":var y=Pl.add(v,-g,m);if(p){var k=v.getTimezoneOffset()-y.getTimezoneOffset();y.setTime(y.getTime()-60*k*1e3)}r.startDate=y;break;case"endDate":var b=Pl.add(f,g,m);if(p){var C=f.getTimezoneOffset()-b.getTimezoneOffset();b.setTime(b.getTime()-60*C*1e3)}r.endDate=b;break;case"duration":var w=Pl.diff(f,v,"millisecond");if(p)w+=60*(f.getTimezoneOffset()-v.getTimezoneOffset())*1e3;r.duration=Pl.as(m,w,"millisecond")}"startDate"in r&&!0!==r.startDate&&(this._startDate=r.startDate),"endDate"in r&&!0!==r.endDate&&(this._endDate=r.endDate),"duration"in r&&!0!==r.duration&&(this._duration=r.duration),!0===r.startDate&&delete r.startDate,!0===r.endDate&&delete r.endDate,delete r.keepDuration,delete r.keepStart}}],[{key:"fields",get:function(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}}]);var r,a,o}(e);return n}))),QS=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([tS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"getAssignmentFor",value:function(e){var t,n,r=D(null!==(t=this.assigned)&&void 0!==t?t:[]);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.resource===e)return i}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"isAssignedTo",value:function(e){return Boolean(this.getAssignmentFor(e))}},{key:"assign",value:(i=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.project.assignmentStore.modelClass,this.addAssignment(new n({event:this,resource:t})),e.abrupt("return",this.commitAsync());case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"unassign",value:(r=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getAssignmentFor(t),this.removeAssignment(n),e.abrupt("return",this.commitAsync());case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"leaveProject",value:function(){var e;if(this.isInActiveTransaction&&this.assigned){var n=this.getEventStore();this.assigned.forEach((function(e){return n.assignmentsForRemoval.add(e)}))}(e=t.leaveProject).call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"remove",value:function(){if(!this.parent)return t.remove.call(this);var e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}},{key:"addAssignment",value:function(e){return this.getProject().assignmentStore.add(e),e}},{key:"removeAssignment",value:function(e){return this.getProject().assignmentStore.remove(e),e}}]);var r,i}(e);return n}))),ex=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([JS,QS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"assigned",get:function(){var e,t;return null!==(e=null===(t=this.project)||void 0===t?void 0:t.assignmentStore.getEventsAssignments(this))&&void 0!==e?e:this.$cachedAssignments}},{key:"leaveProject",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0];this.$cachedAssignments=this.assigned,B(n,"leaveProject",this,3)([e])}},{key:"applyValue",value:function(e,n,r,i,a){var o;"id"===n&&(null===(o=this.assigned)||void 0===o||o.forEach((function(e){return e.set("eventId",r)})));t.applyValue.call(this,e,n,r,i,a)}},{key:"copy",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,n=arguments.length>1&&arguments[1]!==i?arguments[1]:null,r=t.copy.call(this,e,n);return(Be.isObject(n)&&!n.skipFieldIdentifiers||!Be.isObject(n))&&(r.$cachedAssignments=this.assigned),r}}])}(e);return n}))),tx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([JS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"outgoingDeps",get:function(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}},{key:"incomingDeps",get:function(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}},{key:"leaveProject",value:function(){var e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((function(t){return e.dependenciesForRemoval.add(t)})),this.incomingDeps&&this.incomingDeps.forEach((function(t){return e.dependenciesForRemoval.add(t)})),t.leaveProject.call(this)}}])}(e);return n}))),nx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([JS,ex,tx],(function(e){e.prototype;var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(e);return t}))),rx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(nx.derive(Bw).mixin(XS,pD,ZS));S(rx,"$name","EventModel"),rx.exposeProperties(),rx._$name="EventModel";var ix={splice:1,clear:1},ax=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).assignmentsForRemoval=new o,e.dependenciesForRemoval=new o,e}return R(n,e),w(n,[{key:"onDataChange",value:function(e){var t,r=ix[e.action];B(n,"onDataChange",this,3)([e]),r&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterEventRemoval()}},{key:"remove",value:function(e,n){var r=t.remove.call(this,e,n);return this.afterEventRemoval(),r}},{key:"removeAll",value:function(e){var n=t.removeAll.call(this,e);return this.afterEventRemoval(),n}},{key:"clear",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t.clear.apply(this,n);return this.afterEventRemoval(),i}},{key:"onNodeRemoveChild",value:function(e,n,r,i){var a,o=(a=t.onNodeRemoveChild).call.apply(a,[this].concat(Array.prototype.slice.call(arguments)));return this.afterEventRemoval(),o}},{key:"afterEventRemoval",value:function(){var e=this.assignmentsForRemoval,t=this.dependenciesForRemoval;if(e){var n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval&&e.size){var r=z(e).filter((function(e){return!n.assignmentsForRemoval.has(e)}));r.length>0&&n.remove(r)}e.clear();var i=this.getDependencyStore();if(i&&!i.allDependenciesForRemoval&&t.size){var a=z(t).filter((function(e){return!i.dependenciesForRemoval.has(e)}));a.length>0&&i.remove(a)}t.clear()}}},{key:"processRecord",value:function(e){var t;if(null===(t=this.project)||void 0===t||!t.isRepopulatingStores){var n=this.getById(e.id);if(n&&n!==e&&n.assigned){var r,i=D(n.assigned);try{for(i.s();!(r=i.n()).done;){r.value.event=e}}catch(e){i.e(e)}finally{i.f()}}}return e}}])}(e);return n}))),ox=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([ax,aS],(function(e){e.prototype;var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"joinProject",value:function(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}},{key:"afterLoadData",value:function(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}}],[{key:"defaultConfig",get:function(){return{modelClass:nx}}}])}(e);return t}))),lx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{modelClass:rx}}}])}(pD(ox.derive(Pf)).mixin(ES,vS,(function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e]),this.dayIndices=null}},{key:"afterLoadData",value:function(){var e;this.syncIndices("splice",this.storage.allValues),null===(e=B(t,"afterLoadData",this,3))||void 0===e||e([])}},{key:"onDataChange",value:function(e){var n=e.action,r=e.added,i=e.removed,a=e.replaced;this.syncIndices(n,r,i,a),B(t,"onDataChange",this,3)(arguments)}},{key:"onDataReplaced",value:function(e,n){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),B(t,"onDataReplaced",this,3)([e,n])}},{key:"onModelChange",value:function(e,n,r,i,a){("startDate"in r||"endDate"in r)&&this.syncIndices("reschedule",[e],null,null,r),B(t,"onModelChange",this,3)(arguments)}},{key:"invalidateDayIndices",value:function(){var e;null===(e=this.dayIndices)||void 0===e||e.forEach((function(e){return e.invalidate()}))}},{key:"registerDayIndex",value:function(e){var t,n,r=this,i=r.dayIndices||(r.dayIndices=[]);for(n=0;!t&&n<i.length;++n)i[n].matches(e)&&(t=i[n]).register(e);return!t&&i.push(t=new CS(r,e)),t}},{key:"syncIndices",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null===(e=this.dayIndices)||void 0===e||e.forEach((function(e){return e.sync.apply(e,n)}))}},{key:"unregisterDayIndex",value:function(e){for(var t=this.dayIndices,n=null==t?void 0:t.length;n-- >0;)if(t[n].matches(e)){t[n].unregister(e)&&t.splice(n,1);break}}},{key:"useDayIndex",value:function(e){var t=this,n=t.dayIndices;e=e||DS;for(var r=0;n&&r<n.length;++r)if(n[r].matches(e))return n[r];if(e.startShift)throw new Error("No day index registered for ".concat(e," on ").concat(t.id));return t.registerDayIndex(DS)}}])}(e),S(t,"$name","DayIndexMixin"),t}),mS));S(lx,"$name","EventStore"),lx._$name="EventStore";var sx=Be.getPath,ux=function(e,t,n,r){n?Be.setPath(e,t,r):e[t]=r},cx=function(e,t,n,r){var i;null==r||!r.isModel||null!==(i=sx(e,t))&&void 0!==i&&i.model||ux(e,t,n,r)},dx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n,r;e=e?Object.isExtensible(e)?e:Object.assign({},e):{};var i=this.fieldMap,a=i.eventId.dataSource,o=i.resourceId.dataSource,l=i.event.dataSource,s=i.resource.dataSource,u=i.eventId.complexMapping,c=i.resourceId.complexMapping,d=i.event.complexMapping,h=i.resource.complexMapping,f=u?sx(e,a):e[a],v=c?sx(e,o):e[o],g=null!==(n=e.event)&&void 0!==n&&n.isModel?e.event:d?sx(e,l):e[l],m=null!==(r=e.resource)&&void 0!==r&&r.isModel?e.resource:h?sx(e,s):e[s];if(null!=f)ux(e,l,d,f);else if(null!=g){var p=g.isModel?g.id:g;ux(e,a,u,p)}if(null!=v)ux(e,s,h,v);else if(null!=m){var y=m.isModel?m.id:m;ux(e,o,c,y)}cx(e,l,d,e.event),cx(e,s,h,e.resource);for(var k=arguments.length,b=new Array(k>1?k-1:0),C=1;C<k;C++)b[C-1]=arguments[C];B(t,"construct",this,3)([e].concat(b))}},{key:"eventResourceKey",get:function(){return this.buildEventResourceKey(this.event,this.resource)}},{key:"buildEventResourceKey",value:function(e,t){var n,r;return n=e?e.isModel?e.id:e:this.internalId,r=t?t.isModel?t.id:t:this.internalId,"".concat(n,"-").concat(r)}},{key:"buildIndexKey",value:function(e){var t=e.event,n=e.resource;return this.buildEventResourceKey(t,n)}},{key:"set",value:function(e,n){var r,a,o=this.fieldToKeys(e,n);"resource"in o?(null===(r=o.resource)||void 0===r?void 0:r.id)!==i&&(o.resourceId=o.resource.id):"resourceId"in o&&this.constructor.isProAssignmentModel&&(o.resource=o.resourceId);"event"in o?(null===(a=o.event)||void 0===a?void 0:a.id)!==i&&(o.eventId=o.event.id):"eventId"in o&&this.constructor.isProAssignmentModel&&(o.event=o.eventId);for(var l=arguments.length,s=new Array(l>2?l-2:0),u=2;u<l;u++)s[u-2]=arguments[u];return B(t,"set",this,3)([o,null].concat(s))}},{key:"afterChange",value:function(e,n,r,i,a){var o,l,s=this;return!s.constructor.isProAssignmentModel&&null!=n&&n.resourceId&&(null===(o=s.resource)||void 0===o?void 0:o.id)!==n.resourceId.value?s.resource=n.resourceId.value:!(s.constructor.isProAssignmentModel&&null!==(l=s.project)&&void 0!==l&&l.propagatingSyncChanges&&null!=n&&n.eventId)||null!=n&&n.event||e.event.value!==n.eventId.value&&e.event.value.id!==n.eventId.value||(delete n.eventId,delete s.meta.modified.eventId),B(t,"afterChange",this,3)(arguments)}},{key:"resourceId",get:function(){var e,t;return null!==(e=null===(t=this.resource)||void 0===t?void 0:t.id)&&void 0!==e?e:this.get("resourceId")},set:function(e){var t=this.resource;null!=t&&t.isModel&&t.id===e?this.set("resourceId",e):this.resource=e}},{key:"eventId",get:function(){var e,t;return null!==(e=null===(t=this.event)||void 0===t?void 0:t.id)&&void 0!==e?e:this.get("eventId")},set:function(e){var t=this.event;null!=t&&t.isModel&&t.id===e?this.set("eventId",e):this.event=e}},{key:"eventName",get:function(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}},{key:"resourceName",get:function(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}},{key:"getResource",value:function(){return this.resource}},{key:"isAssignment",get:function(){return!0}},{key:"isPersistable",get:function(){var e=this.event,n=this.resource,r=this.unjoinedStores,i=this.assignmentStore,a=this.eventStore,o=null==i?void 0:i.crudManager;return(null==a||!a.usesSingleAssignment)&&((i?this.isValid&&!(null!=e&&e.isCreating)&&(o||!(null!=e&&e.isPhantom)&&!(null!=n&&n.isPhantom)):!this.isPhantom&&Boolean(r[0]))&&B(t,"isPersistable",this,1)&&!(null!=e&&e.isCreating))}},{key:"isValid",get:function(){return null!=this.resource&&null!=this.event}},{key:"toString",value:function(){return this.resourceName?"".concat(this.resourceName," ").concat(Math.round(this.units),"%"):""}},{key:"shouldRecordFieldChange",value:function(e,n,r){if(!B(t,"shouldRecordFieldChange",this,3)([e,n,r]))return!1;if("event"===e||"eventId"===e){var i,a=null===(i=this.project)||void 0===i?void 0:i.eventStore;if(a&&a.oldIdMap[n]===a.getById(r))return!1}if("resource"===e||"resourceId"===e){var o,l=null===(o=this.project)||void 0===o?void 0:o.resourceStore;if(l&&l.oldIdMap[n]===l.getById(r))return!1}return!0}}],[{key:"fields",get:function(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}}])}(e),S(t,"$name","AssignmentModelMixin"),t};function hx(e){return null!=e&&e.isModel?e.id:e}var fx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([nS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"setChanged",value:function(e,n,r){var i=this.assignmentStore,a=this.eventStore,o=this.resourceStore,l=this.project,s=!1;if("event"===e){var u=KD(n,JS)?n:null==a?void 0:a.$master.getById(n);u&&(s=!0),n=u||n}if("resource"===e){var c=KD(n,rS)?n:null==o?void 0:o.$master.getById(n);c&&(s=!0),n=c||n}t.setChanged.call(this,e,n,r,!0),!i||!s||l.isPerformingCommit||i.isLoadingData||null!=o&&o.isLoadingData||i.skipInvalidateIndices||i.invalidateIndices()}},{key:"joinProject",value:function(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}},{key:"calculateInvalidated",value:function(){var e=this.$changed,t=e.event,n=void 0===t?this.event:t,r=e.resource,i=void 0===r?this.resource:r;if(null!==n&&!KD(n,JS)){var a,o=null===(a=this.eventStore)||void 0===a?void 0:a.getById(n);o&&this.setChanged("event",o,!1)}if(null!==i&&!KD(i,rS)){var l,s=null===(l=this.resourceStore)||void 0===l?void 0:l.getById(i);s&&this.setChanged("resource",s,!1)}}},{key:"finalizeInvalidated",value:function(e){var n=this.$changed;"resource"in n&&(n.resourceId=hx(n.resource)),"event"in n&&(n.eventId=hx(n.event)),t.finalizeInvalidated.call(this,e)}},{key:"event",get:function(){var e=this.get("event");return null!=(null==e?void 0:e.id)?e:null},set:function(e){this.setChanged("event",e),this.setChanged("eventId",hx(e))}},{key:"resource",get:function(){var e=this.get("resource");return null!=(null==e?void 0:e.id)?e:null},set:function(e){this.setChanged("resource",e),this.setChanged("resourceId",hx(e))}}],[{key:"fields",get:function(){return[{name:"resource",isEqual:function(e,t){return e===t},persist:!1},{name:"event",isEqual:function(e,t){return e===t},persist:!1}]}}])}(e);return n}))),vx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(dx(pD(fx.derive(od))));S(vx,"$name","AssignmentModel"),vx.exposeProperties(),vx._$name="AssignmentModel";var gx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"$lazyLoadPluginClass",get:function(){return this.isPaged?fS:hS}},{key:"add",value:function(e){var n;if(null!==(n=e=$e.asArray(e))&&void 0!==n&&n.length){for(var r=0;r<e.length;r++){var i,a=e[r];if(a instanceof od||(e[r]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&-1!==this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0))throw new Error("Duplicate assignment Event: ".concat(a.eventId," to resource: ").concat(a.resourceId));null!==(i=a.event)&&void 0!==i&&i.isCreating&&(a.isCreating=!0)}for(var o=arguments.length,l=new Array(o>1?o-1:0),s=1;s<o;s++)l[s-1]=arguments[s];return B(t,"add",this,3)([e].concat(l))}}},{key:"includesAssignment",value:function(e,t){return-1!==this.storage.findIndex("eventResourceKey","".concat(e,"-").concat(t),!0)}},{key:"setStoreData",value:function(e){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined with EventStore data containing resourceId (single-assignment mode)");B(t,"setStoreData",this,3)([e])}},{key:"storage",get:function(){return this._storage||B(t,"storage",this,1)},set:function(e){V(t,"storage",e,this,1,1),this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0},onDuplicate:function(e){console.warn("Duplicate assignment of event ".concat(e.eventId," to resource ").concat(e.resourceId))}})}},{key:"isAssignmentStore",get:function(){return!0}},{key:"getOccurrence",value:function(e,t){if(!e||null==t||!t.isOccurrence)return e;var n=this;return{id:"".concat(t.id,":a").concat(e.id),event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta:function(e){return n.occurrenceInstanceMeta(this,e)}}}},{key:"occurrenceInstanceMeta",value:function(e,t){var n=t.id||t,r=e.id,i=this.occurrenceMeta;return i||(i=this.occurrenceMeta={}),i[r]||(i[r]={}),i[r][n]||(i[r][n]={})}},{key:"mapAssignmentsForEvent",value:function(e,t,n){e=this.eventStore.getById(e);var r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce((function(e,a){var o=r?t(a):a;return i&&!n(o)||e.push(o),e}),[]):e.assignments}},{key:"mapAssignmentsForResource",value:function(e,t,n){e=this.resourceStore.getById(e);var r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce((function(e,a){var o=r?t(a):a;return i&&!n(o)||e.push(o),e}),[]):e.assignments}},{key:"getAssignmentsForEvent",value:function(e){return e.assignments}},{key:"removeAssignmentsForEvent",value:function(e){return this.remove(e.assignments)}},{key:"getAssignmentsForResource",value:function(e){return(e=this.resourceStore.getById(e)).assignments}},{key:"removeAssignmentsForResource",value:function(e){this.remove(this.getAssignmentsForResource(e))}},{key:"getResourcesForEvent",value:function(e){return e.resources}},{key:"getEventsForResource",value:function(e){var t;return null===(t=e=this.resourceStore.getById(e))||void 0===t?void 0:t.events}},{key:"assignEventToResource",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:null,a=arguments.length>3&&arguments[3]!==i&&arguments[3],l=this,s=a?new o(e.assignments):null;if(t=$e.asArray(t).map((function(e){var t;return null!==(t=e.$original)&&void 0!==t?t:e})),null!==(n=l.eventStore)&&void 0!==n&&n.usesSingleAssignment){var u,c;if(null!==(u=e.assignments)&&void 0!==u&&u.length)return l.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];e.resourceId=null===(c=t[0])||void 0===c?void 0:c.id}var d=[];return l.suspendAutoCommit(),t.forEach((function(t){var n=l.getAssignmentForEventAndResource(e,t);if(n)a&&s.delete(n);else{var i,o={event:e,resource:t};d.push(null!==(i=null==r?void 0:r(o))&&void 0!==i?i:o)}})),d=l.add(d),a&&l.remove(Array.from(s)),l.resumeAutoCommit(),d}},{key:"unassignEventFromResource",value:function(e,t){var n=this,r=[];if(!t)return n.removeAssignmentsForEvent(e);t=$e.asArray(t);for(var i=0;i<t.length;i++)n.isEventAssignedToResource(e,t[i])&&r.push(n.getAssignmentForEventAndResource(e,t[i]));return n.remove(r)}},{key:"isEventAssignedToResource",value:function(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}},{key:"getAssignmentForEventAndResource",value:function(e,t){var n;return(e=this.eventStore.getById(e))&&(n=e.assignments)&&(t=this.resourceStore.$master.getById(t))?this.getOccurrence(n.find((function(e){var n;return(null===(n=e.resource)||void 0===n?void 0:n.$original)===t.$original})),e):null}}],[{key:"defaultConfig",get:function(){return{loadPriority:300,syncPriority:300,id:"assignments"}}}])}(e),S(t,"$name","AssignmentStoreMixin"),t},mx=function(e){return HD(e instanceof o||e instanceof Array?e:[e])},px=function(e){return new Promise((function(t){return setTimeout(t,e)}))},yx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).assignmentsForRemoval=new o,e.allAssignmentsForRemoval=!1,e}return R(n,e),w(n,[{key:"remove",value:function(e,n){this.assignmentsForRemoval=mx(e).toSet();var r=t.remove.call(this,e,n);return this.assignmentsForRemoval.clear(),r}},{key:"removeAll",value:function(e){this.allAssignmentsForRemoval=!0;var n=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,n}}])}(e);return n}))),kx=new o,bx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([yx,aS],(function(e){e.prototype;var t=function(e){function t(){var e;return m(this,t),(e=g(this,t,arguments)).skipInvalidateIndices=!1,e}return R(t,e),w(t,[{key:"data",set:function(e){this.allAssignmentsForRemoval=!0,V(t,"data",e,this,1,1),this.allAssignmentsForRemoval=!1}},{key:"getEventsAssignments",value:function(e){return this.storage.findItem("event",e,!0)||kx}},{key:"getResourcesAssignments",value:function(e){return this.storage.findItem("resource",e.$original,!0)||kx}},{key:"updateIndices",value:function(){this.storage.rebuildIndices()}},{key:"invalidateIndices",value:function(){this.storage.invalidateIndices()}},{key:"afterLoadData",value:function(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}},{key:"linkAssignments",value:function(e,t){e=e.masterStore||e;var n=this.count&&this.storage.findItem(t,null,!0);if(n){var r,i=D(n);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=e.getById(a.getCurrentOrProposed(t));o&&a.setChanged(t,o)}}catch(e){i.e(e)}finally{i.f()}this.invalidateIndices()}}},{key:"unlinkAssignments",value:function(e){this.forEach((function(t){var n,r,i;return t.setChanged(e,null!==(n=null!==(r=null===(i=t[e])||void 0===i?void 0:i.id)&&void 0!==r?r:null==t?void 0:t.getData(e))&&void 0!==n?n:t[e+"Id"])})),this.invalidateIndices()}},{key:"onCommitAsync",value:function(){this.updateIndices()}}],[{key:"defaultConfig",get:function(){return{modelClass:fx,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}}])}(e);return t}))),Cx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{modelClass:vx}}}])}(gx(pD(bx.derive(Pf))));S(Cx,"$name","AssignmentStore"),Cx._$name="AssignmentStore";var wx=["SS","SF","FS","FF"],Dx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=e[this.fieldMap.from.dataSource],r=e[this.fieldMap.to.dataSource],i=this.fieldMap.type.type;if(i&&"int"!==i&&"integer"!==i)throw new Error('Dependency type field must be of type "int"');null!=n&&(e.fromEvent=n),null!=r&&(e.toEvent=r),B(t,"construct",this,3)(arguments)}},{key:"eventStore",get:function(){var e;return this.eventStore||(null===(e=this.unjoinedStores[0])||void 0===e?void 0:e.eventStore)}},{key:"from",get:function(){return this.get("from")},set:function(e){var t=this.fromEvent;null!=t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}},{key:"to",get:function(){return this.get("to")},set:function(e){var t=this.toEvent;null!=t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}},{key:"hardType",get:function(){return this.getHardType()},set:function(e){this.setHardType(e)}},{key:"getHardType",value:function(){return this.get("type")}},{key:"setHardType",value:function(e){var t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}},{key:"lag",get:function(){return this.get("lag")},set:function(e){this.setLag(e)}},{key:"setLag",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.lagUnit;1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=Pl.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}},{key:"getLag",value:function(){return this.lag?"".concat(this.lag<0?"-":"+").concat(Math.abs(this.lag)).concat(Pl.getShortNameOfUnit(this.lagUnit)):""}},{key:"fullLag",get:function(){return new ql({unit:this.lagUnit,magnitude:this.lag})},set:function(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}},{key:"isPersistable",get:function(){var e,n=this,r=n.stores,i=n.unjoinedStores,a=r[0];if(a){var o=n.fromEvent,l=n.toEvent,s=a.crudManager;e=o&&(s||!o.hasGeneratedId)&&l&&(s||!l.hasGeneratedId)}else e=Boolean(i[0]);return e&&B(t,"isPersistable",this,1)}},{key:"getDateRange",value:function(){var e=this.fromEvent,n=this.toEvent;if(null!=e&&e.isScheduled&&null!=n&&n.isScheduled){var r,i,a=t.Type;switch(this.type){case a.StartToStart:r=e.startDateMS,i=n.startDateMS;break;case a.StartToEnd:r=e.startDateMS,i=n.endDateMS;break;case a.EndToEnd:r=e.endDateMS,i=n.endDateMS;break;case a.EndToStart:r=e.endDateMS,i=n.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(r,i),end:Math.max(r,i)}}return null}},{key:"highlight",value:function(e){var t,n,r=null!==(t=null===(n=this.highlighted)||void 0===n?void 0:n.split(" "))&&void 0!==t?t:[];r.includes(e)||(this.highlighted=r.concat(e).join(" "))}},{key:"unhighlight",value:function(e){var t=this.highlighted;if(t){var n=t.split(" "),r=n.indexOf(e);r>=0&&(n.splice(r,1),this.highlighted=n.join(" "))}}},{key:"isHighlightedWith",value:function(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}},{key:"getConnectorString",value:function(e){var n=wx[this.type];return e?n:this.type===t.Type.EndToStart?"":n}},{key:"toString",value:function(){return"".concat(this.from).concat(this.getConnectorString()).concat(this.getLag())}},{key:"isValid",get:function(){var e=this.fromEvent,t=this.toEvent;return"number"==typeof this.type&&e&&t&&e!==t}},{key:"fromEventName",get:function(){var e;return(null===(e=this.fromEvent)||void 0===e?void 0:e.name)||""}},{key:"toEventName",get:function(){var e;return(null===(e=this.toEvent)||void 0===e?void 0:e.name)||""}},{key:"shouldRecordFieldChange",value:function(e,n,r){if(!B(t,"shouldRecordFieldChange",this,3)([e,n,r]))return!1;if("from"===e||"to"===e||"fromEvent"===e||"toEvent"===e){var i,a=null===(i=this.project)||void 0===i?void 0:i.eventStore;if(a&&a.oldIdMap[n]===a.getById(r))return!1}return!0}},{key:"skipCopyFields",get:function(){var e,t,n,r,i=this.fieldMap;return S(S(S(S(S(S({},i.from.dataSource,!0),i.to.dataSource,!0),null===(e=i.fromEvent)||void 0===e?void 0:e.dataSource,!0),null===(t=i.toEvent)||void 0===t?void 0:t.dataSource,!0),null===(n=i.fromTask)||void 0===n?void 0:n.dataSource,!0),null===(r=i.toTask)||void 0===r?void 0:r.dataSource,!0)}}],[{key:"Type",get:function(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}},{key:"fields",get:function(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}}])}(od);S(Dx,"$name","DependencyBaseModel"),Dx.exposeProperties(),Dx._$name="DependencyBaseModel";var Sx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([nS],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"setChanged",value:function(e,n,r){var i,a,o=!1;if("fromEvent"===e||"toEvent"===e){var l,s=KD(n,JS)?n:null===(l=this.eventStore)||void 0===l?void 0:l.getById(n);s&&(o=!0),n=s||n}(t.setChanged.call(this,e,n,r,!0),!o||this.project.isPerformingCommit||null!==(i=this.dependencyStore)&&void 0!==i&&i.isLoadingData)||(null===(a=this.dependencyStore)||void 0===a||a.invalidateIndices())}},{key:"joinProject",value:function(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}},{key:"calculateInvalidated",value:function(){var e=this.$changed,t=e.fromEvent,n=e.toEvent;if(null!==t&&!KD(t,JS)){var r,i=null===(r=this.eventStore)||void 0===r?void 0:r.getById(t);i&&(this.$changed.fromEvent=i)}if(null!==n&&!KD(n,JS)){var a,o=null===(a=this.eventStore)||void 0===a?void 0:a.getById(n);o&&(this.$changed.toEvent=o)}}},{key:"fromEvent",get:function(){var e=this.get("fromEvent");return null!=(null==e?void 0:e.id)?e:null},set:function(e){this.setChanged("fromEvent",e)}},{key:"toEvent",get:function(){var e=this.get("toEvent");return null!=(null==e?void 0:e.id)?e:null},set:function(e){this.setChanged("toEvent",e)}}],[{key:"fields",get:function(){return[{name:"fromEvent",isEqual:function(e,t){return e===t},persist:!1},{name:"toEvent",isEqual:function(e,t){return e===t},persist:!1}]}}])}(e);return n}))),xx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getTypeFromSides",value:function(e,t,n){var r=Dx.Type,i=n?"right":"left",a=n?"left":"right";return e===i?t===i?r.StartToStart:r.StartToEnd:t===a?r.EndToEnd:r.EndToStart}}])}(pD(Sx.derive(Dx)));S(xx,"$name","DependencyModel"),xx.exposeProperties(),xx._$name="DependencyModel";var Ex=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"reduceEventDependencies",value:function(e,t,n){var r=this,a=!(arguments.length>3&&arguments[3]!==i)||arguments[3],o=arguments.length>4?arguments[4]:i;return o=o||function(e){return r.getEventDependencies(e)},(e=$e.asArray(e)).reduce((function(e,n){n.children&&!a?n.traverse((function(n){e=o(n).reduce(t,e)})):e=o(n).reduce(t,e)}),n),n}},{key:"mapEventDependencies",value:function(e,t,n,r,i){return this.reduceEventDependencies(e,(function(e,t){return n(t)&&e.push(t),e}),[],r,i)}},{key:"mapEventPredecessors",value:function(e,t,n,r){return this.reduceEventPredecessors(e,(function(e,t){return n(t)&&e.push(t),e}),[],r)}},{key:"mapEventSuccessors",value:function(e,t,n,r){return this.reduceEventSuccessors(e,(function(e,t){return n(t)&&e.push(t),e}),[],r)}},{key:"getEventDependencies",value:function(e){return[].concat(e.predecessors||[],e.successors||[])}},{key:"removeEventDependencies",value:function(e){this.remove(this.getEventDependencies(e))}},{key:"removeEventPredecessors",value:function(e){this.remove(e.predecessors)}},{key:"removeEventSuccessors",value:function(e,t){this.remove(e.successors)}},{key:"getBySourceTargetId",value:function(e){var t=this;return this.records.find((function(n){return e==t.constructor.makeDependencySourceTargetCompositeKey(n.from,n.to)}))}},{key:"getDependencyForSourceAndTargetEvents",value:function(e,t){return e=od.asId(e),t=od.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}},{key:"getEventsLinkingDependency",value:function(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}},{key:"isValidDependency",value:(n=f(L().mark((function e(t,n,r){var i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t,a=n,null!=t){e.next=3;break}return e.abrupt("return",!1);case 3:if(t.isDependencyModel&&(i=t.fromEvent,a=t.toEvent),i=this.eventStore.getById(i),a=this.eventStore.getById(a),!i||!a){e.next=10;break}if(i.project&&a.project){e.next=9;break}return e.abrupt("return",!1);case 9:return e.abrupt("return",this.project.isValidDependency(i,a,r));case 10:return e.abrupt("return",t!==n);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"isValidDependencyToCreate",value:function(e,t,n){return this.isValidDependency(e,t,n)}},{key:"getHighlightedDependencies",value:function(e){return this.records.reduce((function(t,n){return n.isHighlightedWith(e)&&t.push(n),t}),[])}},{key:"getTimeSpanDependencies",value:function(e){return this.getEventDependencies(e)}}],[{key:"defaultConfig",get:function(){return{loadPriority:400,syncPriority:400,id:"dependencies"}}},{key:"makeDependencySourceTargetCompositeKey",value:function(e,t){return"source(".concat(e,")-target(").concat(t,")")}}]);var n}(e),S(t,"$name","DependencyStoreMixin"),t},Rx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).dependenciesForRemoval=new o,e.allDependenciesForRemoval=!1,e}return R(n,e),w(n,[{key:"remove",value:function(e,n){this.dependenciesForRemoval=mx(e).toSet();var r=t.remove.call(this,e,n);return this.dependenciesForRemoval.clear(),r}},{key:"removeAll",value:function(e){this.allDependenciesForRemoval=!0;var n=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,n}}])}(e);return n}))),Tx=new o,Mx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([Rx,aS],(function(e){e.prototype;var t=function(e){function t(){var e;return m(this,t),(e=g(this,t,arguments)).dependenciesForRemoval=new o,e.allDependenciesForRemoval=!1,e}return R(t,e),w(t,[{key:"getIncomingDepsForEvent",value:function(e){return this.storage.findItem("toEvent",e)||Tx}},{key:"getOutgoingDepsForEvent",value:function(e){return this.storage.findItem("fromEvent",e)||Tx}},{key:"data",set:function(e){this.allDependenciesForRemoval=!0,V(t,"data",e,this,1,1),this.allDependenciesForRemoval=!1}},{key:"updateIndices",value:function(){this.storage.rebuildIndices()}},{key:"invalidateIndices",value:function(){this.storage.invalidateIndices()}},{key:"onCommitAsync",value:function(){this.updateIndices()}}],[{key:"defaultConfig",get:function(){return{modelClass:Sx,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}}])}(e);return t}))),Fx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{modelClass:xx}}}])}(Ex(pD(Mx.derive(Pf)).derive(Pf)));Fx._$name="DependencyStore";var Ax=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"crudLoadValidationMandatoryStores",get:function(){return[]}},{key:"getStoreLoadResponseWarnings",value:function(e,t,n){var r=[],i=e.storeId,a=this.crudLoadValidationMandatoryStores,o=S({},i,{});return t?t.rows||(r.push('- "'.concat(i,'" store section should have a "rows" property with an array of the store records.')),o[i].rows=["..."]):null!=a&&a.includes(i)&&(r.push('- No "'.concat(i,'" store section found. It should contain the store data.')),o[i].rows=["..."]),r.length&&Object.assign(n,o),r}},{key:"getLoadResponseWarnings",value:function(e,t){var n=this,r=[],i={};return this.skipSuccessProperty||(i.success=!0),this.forEachCrudStore((function(a,o,l){var s;null!=t&&null!==(s=t.stores)&&void 0!==s&&s.length&&!t.stores.includes(o)||r.push.apply(r,z(n.getStoreLoadResponseWarnings(l,null==e?void 0:e[o],i)))})),r.length&&(r.push("Please adjust your response to look like this:\n"+JSON.stringify(i,null,4).replace(/"\.\.\."/g,"...")),r.push(this.disableValidationNote)),r}},{key:"validateLoadResponse",value:function(e,t){var n=this.getLoadResponseWarnings(e,t);n.length&&console.warn(this.crudLoadValidationWarningPrefix+"\n"+n.join("\n"))}},{key:"getStoreSyncResponseWarnings",value:function(e,t,n,r){var i=[],a=[],o=[],l=e.storeId,s=S({},l,{}),u=e.phantomIdField||this.phantomIdField,c=e.store.modelClass.idField,d=(null==n?void 0:n.rows)||[],h=(null==n?void 0:n.removed)||[],f=!1;if(null!=t&&t.added&&(a.push.apply(a,z(t.added.filter((function(e){return!d.find((function(t){return t[u]==e[u]}))&&!h.find((function(t){return t[u]==e[u]||t[c]==e[u]}))})).map((function(e){return S(S({},u,e[u]),c,"...")})))),a.length)){var v=a.map((function(e){return"#"+e[u]})).join(", ");i.push('- "'.concat(l,'" store "rows" section should mention added record(s) ').concat(v," sent in the request. ")+'It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).')}if(this.supportShortSyncResponse)!a.length&&n&&(("object"!==W(n)||Array.isArray(n))&&(i.push('- "'.concat(l,'" store section should be an Object.')),s[l]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(i.push('- "'.concat(l,'" store "rows" section should be an array')),a.push("...")),n.removed&&!Array.isArray(n.removed)&&(i.push('- "'.concat(l,'" store "removed" section should be an array:')),o.push("...")));else{if(null!=t&&t.updated){var g=t.updated.filter((function(e){return!d.find((function(t){return t[c]==e[c]}))})).map((function(e){return S({},c,e[c])}));if(a.push.apply(a,z(g)),g.length){var m=g.map((function(e){return"#"+e[c]})).join(", ");i.push('- "'.concat(l,'" store "rows" section should mention updated record(s) ').concat(m," sent in the request. ")+"It should contain the updated record identifiers."),f=!0}}if(a.length&&a.push("..."),null!=t&&t.removed&&(o.push.apply(o,z(t.removed.filter((function(e){return!d.find((function(t){return t[c]==e[c]}))})).map((function(e){return S({},c,e[c])})))),o.length)){var p=o.map((function(e){return"#"+e[c]})).join(", ");i.push('- "'.concat(l,'" store "removed" section should mention removed record(s) ').concat(p," sent in the request. ")+"It should contain the removed record identifiers."),s[l].removed=o,o.push("..."),f=!0}}return a.length&&(s[l].rows=a),i.length||delete s[l],Object.assign(r,s),{messages:i,showSupportShortSyncResponseNote:f}}},{key:"getSyncResponseWarnings",value:function(e,t){var n=this,r=[],i={},a=t.pack;this.skipSuccessProperty||(i.success=!0);var o=!1;return this.forEachCrudStore((function(t,l,s){var u=n.getStoreSyncResponseWarnings(s,null==a?void 0:a[l],e[l],i);o=o||u.showSupportShortSyncResponseNote,r.push.apply(r,z(u.messages))})),r.length&&(r.push("Please adjust your response to look like this:\n"+JSON.stringify(i,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&r.push(this.supportShortSyncResponseNote),r.push(this.disableValidationNote)),r}},{key:"validateSyncResponse",value:function(e,t){var n=this.getSyncResponseWarnings(e,t);n.length&&console.warn(this.crudSyncValidationWarningPrefix+"\n"+n.join("\n"))}}],[{key:"configurable",get:function(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}}])}(e),S(t,"$name","AbstractCrudManagerValidation"),t},Ix=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Y(Error)),Lx=function(e){function t(){var e,n,r,a=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return m(this,t),r=g(this,t,[a.message||a.request&&Le.capitalize(null===(e=a.request)||void 0===e?void 0:e.type)+" failed"||"Crud Manager request failed"]),Object.assign(r,a),r.action=null===(n=r.request)||void 0===n?void 0:n.type,r}return R(t,e),w(t)}(Ix),Ox=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},Px=function(e,t){return Ox(e,t,"loadPriority")},_x=function(e,t){return Ox(e,t,"syncPriority")},Hx=function(e){var t,n;e.$$meta=e.$meta;var r=[];return e.isEvents||r.push(_n),e.isDelayable||r.push($i),r.push(Ax),t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isCrudManager",get:function(){return!0}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};this._requestId=0,this.activeRequests={},this.crudStoresIndex={},B(t,"construct",this,3)([e])}},{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}},{key:"loadUrl",get:function(){var e;return null===(e=this.transport)||void 0===e||null===(e=e.load)||void 0===e?void 0:e.url}},{key:"updateLoadUrl",value:function(e){Be.setPath(this,"transport.load.url",e)}},{key:"syncUrl",get:function(){var e;return null===(e=this.transport)||void 0===e||null===(e=e.sync)||void 0===e?void 0:e.url}},{key:"updateSyncUrl",value:function(e){Be.setPath(this,"transport.sync.url",e)}},{key:"shouldIgnoreRemoteChangesInSTM",get:function(){return this.ignoreRemoteChangesInSTM}},{key:"getStoreDescriptor",value:function(e){return e?(e instanceof Ff?e=e._crudManagerId||e.id:"object"===W(e)&&(e=e.storeId),this.crudStoresIndex[e]):null}},{key:"fillStoreDescriptor",value:function(e){var t=e.store,n=t.storeIdProperty,r=void 0===n?this.storeIdProperty:n,i=t.modelClass;return e.storeId||(e.storeId=t[r]||t.id),e.idField||(e.idField=i.idField),e.phantomIdField||(e.phantomIdField=i.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=i.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}},{key:"updateCrudStoreIndex",value:function(){var e=this.crudStoresIndex={};this.crudStores.forEach((function(t){return t.storeId&&(e[t.storeId]=t)}))}},{key:"getCrudStore",value:function(e){var t=this.getStoreDescriptor(e);return null==t?void 0:t.store}},{key:"forEachCrudStore",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this;if(!e)throw new Error("Iterator function must be provided");this.crudStores.every((function(n){return!1!==e.call(t,n.store,n.storeId,n)}))}},{key:"crudStores",get:function(){return this._crudStores},set:function(e){this._crudStores=[],this.addCrudStore(e);var t,n=D(this._crudStores);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.loadPriority=r.syncPriority=0}}catch(e){n.e(e)}finally{n.f()}}},{key:"orderedCrudStores",get:function(){return this._orderedCrudStores},set:function(e){return this._orderedCrudStores=e}},{key:"syncApplySequence",get:function(){return this._syncApplySequence},set:function(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}},{key:"internalAddCrudStore",value:function(e){var t,n=this;return t=e instanceof Ff?{store:e}:"object"===W(e)?e.store?e:{store:new Ff(e)}:{store:Ff.getStore(e)},n.fillStoreDescriptor(t),(e=t.store).setCrudManager&&e.setCrudManager(n,t),e.crudManager=n,e._crudManagerId=t.storeId,e.isAjaxStore&&(e.pageSize=null),(n.loadUrl||n.syncUrl)&&(e.autoCommit=!1,e.autoLoad=!1,(e.createUrl||e.updateUrl||e.deleteUrl||e.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),n.bindCrudStoreListeners(e),t}},{key:"addCrudStore",value:function(e,t,n){var r,i,a;if(null!==(r=e=$e.asArray(e))&&void 0!==r&&r.length){var o,l,s=this,u=e.map(s.internalAddCrudStore,s);if(void 0===t)(o=s.crudStores).push.apply(o,z(u));else n&&((n instanceof Ff||"object"!==W(n))&&(n=s.getStoreDescriptor(n)),t+=s.crudStores.indexOf(n)),(l=s.crudStores).splice.apply(l,[t,0].concat(z(u)));(i=s.orderedCrudStores).push.apply(i,z(u)),s.updateCrudStoreIndex(),null===(a=s.afterAddStore)||void 0===a||a.call(s,u)}}},{key:"addPrioritizedStore",value:function(e){var t=this;t.hasCrudStore(e)||t.addCrudStore(e,$e.findInsertionIndex(e,t.crudStores,Px)),t.hasApplySequenceStore(e)||t.addStoreToApplySequence(e,$e.findInsertionIndex(e,t.syncApplySequence,_x))}},{key:"hasCrudStore",value:function(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((function(t){return t===e||t.store===e||t.storeId===e}))}},{key:"removeCrudStore",value:function(e){var t=this,n=t.crudStores,r=t.orderedCrudStores,i=t.getStoreDescriptor(e);if(!i)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(i.store),$e.remove(n,i),$e.remove(r,i),t.removeStoreFromApplySequence(i),delete t.crudStoresIndex[i.storeId]}},{key:"bindCrudStoreListeners",value:function(e){e.ion({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}},{key:"unbindCrudStoreListeners",value:function(e){this.detachListeners(e.id)}},{key:"addStoreToApplySequence",value:function(e,t,n){if(e){e=$e.asArray(e);var r=this,i=e.reduce((function(e,t){var n=r.getStoreDescriptor(t);return n&&e.push(n),e}),[]);if(void 0===t){var a;(a=r.syncApplySequence).push.apply(a,z(i))}else{var o,l=t;n&&((n instanceof Ff||"object"!==W(n))&&(n=r.getStoreDescriptor(n)),l+=r.syncApplySequence.indexOf(n)),(o=r.syncApplySequence).splice.apply(o,[l,0].concat(z(i)))}var s=r.syncApplySequence.map((function(e){return e.storeId}));r.orderedCrudStores=z(r.syncApplySequence),r.crudStores.forEach((function(e){s.includes(e.storeId)||r.orderedCrudStores.push(e)}))}}},{key:"removeStoreFromApplySequence",value:function(e){var t=this.syncApplySequence,n=this.getStoreDescriptor(e);t&&n&&$e.remove(t,n)}},{key:"hasApplySequenceStore",value:function(e){return this.syncApplySequence.some((function(t){return t===e||t.store===e||t.storeId===e}))}},{key:"onCrudStoreDestroy",value:function(e){var t=e.source;this.removeCrudStore(t)}},{key:"onCrudStoreChange",value:function(e){var t=this,n=null==e?void 0:e.source;if(n){var r=t.getStoreDescriptor(n);r&&!r.idFieldProcessed&&n.modelClass.idFieldProcessed&&(r.idField=n.modelClass.idField,r.idFieldProcessed=!0)}t.crudIgnoreUpdates||(t.crudStoreHasChanges(null==e?void 0:e.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}},{key:"suspendAutoSync",value:function(){this.autoSyncSuspendCounter++,this.forEachCrudStore((function(e){return e.suspendAutoCommit()}))}},{key:"resumeAutoSync",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this;t.autoSyncSuspendCounter--,t.forEachCrudStore((function(t){return t.resumeAutoCommit(e)})),t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,e&&t.autoSync&&t.crudStoreHasChanges()&&t.scheduleAutoSync())}},{key:"isAutoSyncSuspended",get:function(){return this.autoSyncSuspendCounter>0}},{key:"scheduleAutoSync",value:function(){var e=this;e.hasTimeout("autoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"autoSync",fn:function(){e.sync().catch((function(e){}))},delay:e.autoSyncTimeout})}},{key:"triggerFailedRequestEvents",value:(u=f(L().mark((function e(t,n,r,i,a){var o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.options,l=t.type,this.trigger("requestFail",{requestType:l,response:n,responseText:r,requestOptions:i,rawResponse:a,responseOptions:i}),this.trigger(l+"Fail",{response:n,requestOptions:i,responseText:r,options:o,rawResponse:a,responseOptions:i});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return u.apply(this,arguments)})},{key:"internalOnResponse",value:(s=f(L().mark((function e(t,n,r,i){var a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this,o=n?a.decode(n):null,l=t.options,s=t.type,n&&!o&&console.error("Failed to parse response: "+n),o&&(a.skipSuccessProperty?!1!==o.success:o.success)){e.next=6;break}a.triggerFailedRequestEvents(t,o,n,r),e.next=16;break;case 6:if(!1===a.trigger("beforeResponseApply",{requestType:s,response:o})||!1===a.trigger("before".concat(Le.capitalize(s),"Apply"),{response:o,options:l})){e.next=16;break}return a.crudRevision=o.revision,a.afterSyncAttempt(t),e.next=11,a.applyResponse(t,o,l);case 11:if(!a.isDestroyed){e.next=13;break}return e.abrupt("return");case 13:a.trigger("requestDone",{requestType:s,response:o,requestOptions:r,rawResponse:i,responseOptions:r}),a.trigger(s,{response:o,requestOptions:r,options:l,rawResponse:i,responseOptions:r}),"load"!==s&&a.crudStoreHasChanges()||(a.trigger("noChanges"),"load"===s&&a.emitCrudStoreEvents(t.pack.stores,"afterRequest"));case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"afterSyncAttempt",value:function(e){for(var t=0,n=Object.values(e.pack);t<n.length;t++){var r,i=n[t];null==i||null===(r=i.added)||void 0===r||r.forEach((function(e){return e.__record__.isBeingMaterialized=!1}))}}},{key:"suspendChangeTracking",value:function(){this.crudIgnoreUpdates++,this.crudStores.forEach((function(e){var t=e.store;t.suspendFilterOnUpdate(),t.suspendSortOnUpdate()}))}},{key:"resumeChangeTracking",value:function(e){this.crudStores.forEach((function(e){var t=e.store;t.resumeFilterOnUpdate(),t.resumeSortOnUpdate()})),!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}},{key:"isChangeTrackingSuspended",get:function(){return this.crudIgnoreUpdates>0}},{key:"crudStoreHasChanges",value:function(e){var t=this;return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some((function(e){return t.isCrudStoreDirty(e.store)}))}},{key:"isCrudStoreDirty",value:function(e){return e.hasChanges}},{key:"doAutoLoad",value:function(){return this.load().catch((function(e){}))}},{key:"emitCrudStoreEvents",value:function(e,t,n){var r,i=F({action:"read"+t},n),a=D(this.crudStores);try{for(a.s();!(r=a.n()).done;){var o=r.value;e.includes(o.storeId)&&o.store.trigger(t,i)}}catch(e){a.e(e)}finally{a.f()}}},{key:"getLoadPackage",value:function(e){var t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return delete r.request,t.stores=n.map((function(e){var t,n=null==r?void 0:r[e.storeId],i=e.isPaged||(null===(t=e.store)||void 0===t?void 0:t.isPaged);if(n||i){var a,o,l=null!==(a=e.pageSize)&&void 0!==a?a:null===(o=e.store)||void 0===o?void 0:o.pageSize,s=Object.assign({storeId:e.storeId,page:1},n);return l&&(s.pageSize=l),e.currentPage=s.page,n&&delete r[e.storeId],s}return e.storeId})),Object.assign(t,r),t}},{key:"loadCrudStore",value:function(e,t,n){var r=null==t?void 0:t.rows;null!=n&&n.append||null!=t&&t.append?e.add(r,!1,{clean:!0}):e.data=r,e.trigger("load",{data:r})}},{key:"loadDataToCrudStore",value:function(e,t,n){var r=e.store,i=null==t?void 0:t.rows;r.__loading=!0,i&&this.loadCrudStore(r,t,n,e),r.__loading=!1}},{key:"loadCrudManagerData",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},n=this;n.trigger("beforeLoadCrudManagerData"),n.suspendChangeTracking(),n.crudStores.forEach((function(r){var i=r.storeId,a=e[i];a&&n.loadDataToCrudStore(r,a,t[i])})),n.resumeChangeTracking(!0),n.trigger("loadCrudManagerData")}},{key:"isCrudManagerLoading",get:function(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}},{key:"isCrudManagerSyncing",get:function(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}},{key:"isLoadingOrSyncing",get:function(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}},{key:"load",value:function(e){"string"==typeof e&&(e={request:{url:e}});var t=this,n=t.getLoadPackage(e);return t._autoLoadPromise=null,new Promise((function(r,a){if(!1!==t.trigger("beforeLoad",{pack:n})){var o,l=t.activeRequests.load;l&&(t.cancelRequest(l.desc,l.reject),t.trigger("loadCanceled",{pack:n}));var s=pe.assign({id:n.requestId,data:t.encode(n),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null===(o=e)||void 0===o?void 0:o.request);t.activeRequests.load={type:"load",options:e,pack:n,resolve:r,reject:function(){var e;s.success=s.failure=null,null!==(e=arguments.length<=0?i:arguments[0])&&void 0!==e&&e.cancelled||a.apply(void 0,arguments)},id:n.requestId,desc:t.sendRequest(s)},t.emitCrudStoreEvents(n.stores,"loadStart"),t.trigger("loadStart",{pack:n})}else t.trigger("loadCanceled",{pack:n}),a({cancelled:!0})}))}},{key:"getActiveCrudManagerRequest",value:function(e){var t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}},{key:"prepareAddedRecordData",value:function(e,t){var n=this,r=t.store,i=r.isTree,a=t.phantomIdField||n.phantomIdField,o=t.phantomParentIdField||n.phantomParentIdField,l=r.modelClass.allFields.filter((function(e){return e.subStore})),s=e.constructor,u=Object.assign(e.persistableData,S({},a,e.id));if(e.$isPhantom=!0,i){var c=e.parent;c&&!c.isRoot&&c.isPhantom&&(u[o]=c.id)}return n.resetIdsBeforeSync&&Be.deletePath(u,s.idField),l.forEach((function(t){var r=e.get(t.name);r.totalCount&&(u[t.dataSource]={added:r.getRange().map((function(e){return n.prepareAddedRecordData(e,{store:r})}))})})),Object.defineProperty(u,"__record__",{value:e,enumerable:!1}),u}},{key:"prepareAdded",value:function(e,t){var n=this;return e.filter((function(e){return e.isValid})).map((function(e){return n.prepareAddedRecordData(e,t)}))}},{key:"prepareUpdated",value:function(e,t){var n=this,r=t.store,i=r.isTree,a=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,o=t.phantomParentIdField||this.phantomParentIdField,l=r.modelClass.allFields.filter((function(e){return e.subStore}));if(t.store.tree){var s=t.store.rootNode;e=e.filter((function(e){return e!==s}))}return e.filter((function(e){return e.isValid})).reduce((function(e,t){var r;if(r=a?t.persistableData:t.modificationDataToWrite,i){var s=t.parent;s&&!s.isRoot&&s.isPhantom&&(r[o]=s.id)}return l.forEach((function(e){var i=t.get(e.name);r[e.dataSource]=n.getCrudStoreChanges({store:i})})),Be.isEmpty(r)||e.push(r),e}),[])}},{key:"prepareRemoved",value:function(e,t){var n,r=t.store;if(this.includeChildrenInRemoveRequest)n=e;else{n=[];var i,a=D(e);try{var o=function(){var t,a,o=i.value,l=null!==(t=o.parentId)&&void 0!==t?t:null===(a=o.meta.modified)||void 0===a?void 0:a.parentId;null==l||l!==r.rootNode.id&&e.some((function(e){return e.id===l}))||n.push(o)};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}return n.map((function(e){return Be.setPath({},e.constructor.idField,e.id)}))}},{key:"getCrudStoreChanges",value:function(e){var t,n,r,i=e.store,a=i.changes||{},o=a.added,l=void 0===o?[]:o,s=a.modified,u=void 0===s?[]:s,c=a.removed,d=void 0===c?[]:c;(l.length&&(l=this.prepareAdded(l,e)),u.length||null!==(t=i.modifiedMaterialized)&&void 0!==t&&t.size)&&(u=this.prepareUpdated([].concat(z(u),z(null!==(r=i.modifiedMaterialized)&&void 0!==r?r:[])),e));return d.length&&(d=this.prepareRemoved(d,e)),(l.length||u.length||d.length)&&(n={},l.length&&(n.added=l),u.length&&(n.updated=u),d.length&&(n.removed=d)),n}},{key:"getChangesetPackage",value:function(){var e=this.changes;return e||this.forceSync?F({type:"sync",requestId:this.requestId,revision:this.crudRevision},e):null}},{key:"changes",get:function(){var e=this,t={};return this.crudStores.forEach((function(n){var r=e.getCrudStoreChanges(n);r&&(t[n.storeId]=r)})),Object.keys(t).length>0?t:null}},{key:"isFieldValueEqual",value:function(e,t,n){return null!=e&&e.isEqual?e.isEqual(t,n):Be.isEqual(t,n)}},{key:"processRecordResponse",value:function(e,t,n,r,i,a){var o=e.syncConflictResolution||this.syncConflictResolution,l=e.store.modelClass.fieldDataSourceMap,s=e.idField,u=e.phantomIdField,c=void 0===u?this.phantomIdField:u,d={};if("local"===o)for(var h=0,f=Object.entries(i);h<f.length;h++){var v=_(f[h],2),g=v[0],m=v[1],p=!1,y=l[g];if(y&&(t||a)){var k=t?t.getFieldPersistentValue(y):a[g],b=g in r,C=r[g];g===s&&r[c]&&(b=b||c in r,C=r[c]),p=b&&!this.isFieldValueEqual(y,C,k)||g!==s&&this.isFieldValueEqual(y,m,k)}p||Be.setPath(d,g,m)}else d=n;return d}},{key:"getRecordChangesToClear",value:function(e,t,n){var r,i=e.store,a=i.modelClass.fieldDataSourceMap,o=i.isTree&&i.modelClass.parentIdField,l=!1;if(n){r={};for(var s=0,u=Object.entries(t);s<u.length;s++){var c=_(u[s],2),d=c[0],h=c[1],f=a[d];f||d!==o||(f={name:"parentId"}),f&&d in n&&this.isFieldValueEqual(f,h,n[d])&&(r[f.name]=!0,l=!0)}}return l?r:null}},{key:"processStoreResponse",value:function(e,t,n){var r,i=this,l=i.supportShortSyncResponse,s=e.idField,u=e.store,c=e.phantomIdField,d=void 0===c?i.phantomIdField:c,h=i.buildStoreSyncRequestMaps(e,n,t),f=h.addedMap,v=h.updatedMap,g=h.removedMap,m=new a,p=new a,y=[],k=[],b=new o,C=D((null==t?void 0:t.rows)||[]);try{for(C.s();!(r=C.n()).done;){var w=r.value,x=Be.getPath(w,s),E=Be.getPath(w,d),R=f.get(E)||v.get(x),T=u.getById(E||x)||u.removed.get(E||x),M=null==T?void 0:T.modificationDataToWrite,F=Be.pathifyKeys(R),A=Be.pathifyKeys(w),I=i.processRecordResponse(e,T,w,F,A,M);I&&(x&&m.set(x,I),E&&m.set(E,I),T?k.push(I):y.push(I))}}catch(e){C.e(e)}finally{C.f()}for(var L=0,O=[].concat(z(f.values()),z(v.values()));L<O.length;L++){var P=O[L],_=Be.getPath(P,d),H=Be.getPath(P,s),B=u.getById(_||H)||u.removed.get(_||H);B&&(l||m.has(H)||m.has(_))&&p.set(B,i.getRecordChangesToClear(e,Be.pathifyKeys(P),B.modificationDataToWrite))}for(var V=0,N=[].concat(z((null==t?void 0:t.removed)||[]),z(i.supportShortSyncResponse?g.values():[]));V<N.length;V++){var j=N[V],W=Be.getPath(j,s);!u.getById(W)&&!u.removed.includes(W)||m.has(W)||b.add(W)}return{added:y,updated:k,removed:z(b).map((function(e){return S({},s,e)})),clearChanges:p}}},{key:"buildStoreSyncRequestMaps",value:function(e,t){var n=e.idField,r=e.phantomIdField,i=void 0===r?this.phantomIdField:r,o=new a,l=new a,s=new a;if(t){var u,c=D(t.added||[]);try{for(c.s();!(u=c.n()).done;){var d=u.value,h=Be.getPath(d,i);o.set(h,d)}}catch(e){c.e(e)}finally{c.f()}var f,v=D(t.updated||[]);try{for(v.s();!(f=v.n()).done;){var g=f.value,m=Be.getPath(g,n);l.set(m,g)}}catch(e){v.e(e)}finally{v.f()}var p,y=D(t.removed||[]);try{for(y.s();!(p=y.n()).done;){var k=p.value,b=Be.getPath(k,n);s.set(b,k)}}catch(e){y.e(e)}finally{y.f()}}return{addedMap:o,updatedMap:l,removedMap:s}}},{key:"applyChangesToStore",value:function(e,t,n){var r,i=this,a=e.phantomIdField||i.phantomIdField,o=e.store,l=o.modelClass.getFieldDataSource("id"),s=o.modelClass.allFields.filter((function(e){return e.subStore})),u=i.processStoreResponse(e,t,n),c=u.added,d=u.updated,h=u.removed,f=u.clearChanges,v=[];if(d.length&&s.length){var g,m=D(d);try{var p=function(){var e,t,r,u,c=g.value,d=o.getById(null!==(e=c[a])&&void 0!==e?e:c[l]),h=(null===(t=n.added)||void 0===t?void 0:t.find((function(e){return e[a]==c[a]})))||(null===(r=n.updated)||void 0===r?void 0:r.find((function(e){return e[l]==c[l]}))),f={},m=D(s);try{for(m.s();!(u=m.n()).done;){var p=u.value,y=p.dataSource,k=i.fillStoreDescriptor({store:d.get(p.name)});i.applyChangesToStore(k,c[y],null==h?void 0:h[y]),f[y]="foo",delete c[y]}}catch(e){m.e(e)}finally{m.f()}v.push([d,f])};for(m.s();!(g=m.n()).done;)p()}catch(e){m.e(e)}finally{m.f()}}(h.length||c.length||d.length)&&(r=o.applyChangeset({removed:h,added:c,updated:d},null,a,!0,!0)),v.forEach((function(e){var t=_(e,2),n=t[0],i=t[1];return Object.assign(r.get(n.id),i)}));var y,k=D(f);try{for(k.s();!(y=k.n()).done;){var b=_(y.value,2),C=b[0],w=b[1];if(w)(C.isModel?C:o.getById(C)).internalClearChanges(!1,!0,w)}}catch(e){k.e(e)}finally{k.f()}return o.trigger("appliedCrudChangesToStore",{crudManager:i}),r}},{key:"applySyncResponse",value:function(e,t){var n=this,r=n.orderedCrudStores,i=n.supportShortSyncResponse;n.applyingChangeset=n.applyingSyncResponse=!0,n.suspendChangeTracking();var a,o=D(r);try{for(o.s();!(a=o.n()).done;){var l,s=a.value,u=e[s.storeId];if(u||i)n.applyChangesToStore(s,u,null==t||null===(l=t.pack)||void 0===l?void 0:l[s.storeId])}}catch(e){o.e(e)}finally{o.f()}n.resumeChangeTracking(!0),n.applyingChangeset=n.applyingSyncResponse=!1}},{key:"applyLoadResponse",value:function(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}},{key:"applyResponse",value:(l=f(L().mark((function e(t,n,r){var i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(i=this).trackResponseType&&n.type||t.type,e.t0=a,e.next="load"===e.t0?4:"sync"===e.t0?7:10;break;case 4:return i.validateResponse&&i.validateLoadResponse(n,r),i.applyLoadResponse(n,r),e.abrupt("break",10);case 7:return i.validateResponse&&i.validateSyncResponse(n,t),i.applySyncResponse(n,t),e.abrupt("break",10);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"applyChangeset",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=arguments.length>3&&arguments[3]!==i&&arguments[3],r=this,o=n?new a:i;r.applyingChangeset=!0,r.suspendAutoSync(),r.suspendChangeTracking();var l,s=D(r.orderedCrudStores);try{for(s.s();!(l=s.n()).done;){var u=l.value,c=u.store,d=u.phantomIdField;if(e[c.id]){var h=c.applyChangeset(e[c.id],t,d||r.phantomIdField,!0,n);h&&o.set(c.id,h)}}}catch(e){s.e(e)}finally{s.f()}return r.applyingChangeset=!1,r.resumeChangeTracking(!0),r.resumeAutoSync(!1),o}},{key:"requestId",get:function(){return Number.parseInt("".concat(Date.now()).concat(this._requestId++))}},{key:"sync",value:function(){var e=this,t=this;return t.clearTimeout("autoSync"),t.activeRequests.sync?(t.trigger("syncDelayed"),t.activeSyncPromise=t.activeSyncPromise.finally((function(){return t.sync()}))):t.activeSyncPromise=new Promise((function(n,r){var i=t.getChangesetPackage();if(i){e.forEachCrudStore((function(e){var t;return null===(t=e.modifiedMaterialized)||void 0===t?void 0:t.clear()}));for(var a=0,o=Object.values(i);a<o.length;a++){var l,s=o[a];null==s||null===(l=s.added)||void 0===l||l.forEach((function(e){return e.__record__.isBeingMaterialized=!0}))}t.activeRequests.sync={type:"sync",pack:i,resolve:n,reject:r,desc:null,id:i.requestId};var u=t.trigger("beforeSync",{pack:i});Promise.resolve(u).then((function(e){if(!1!==e){var n,a;if(t.trigger("syncStart",{pack:i}),null!==(n=t.eventStore)&&void 0!==n&&n.usesSingleAssignment)null===(a=t.assignmentStore)||void 0===a||a.acceptChanges();t.activeRequests.sync.desc=t.sendRequest({id:i.requestId,data:t.encode(i),type:"sync",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t})}else t.trigger("syncCanceled",{pack:i}),t.activeRequests.sync=null,r({cancelled:!0})})).catch((function(e){t.activeRequests.sync=null,r(e)}))}else n(null)})).catch((function(e){if(e&&!e.cancelled)throw e;return e}))}},{key:"onCrudRequestSuccess",value:(r=f(L().mark((function e(t,n,r){var i,a,o,l,s,u,c,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this,l=(o=r).type,s=o.id,!a.isDestroyed){e.next=3;break}return e.abrupt("return");case 3:return u="",r=a.activeRequests[l],e.prev=5,e.next=8,t.text();case 8:u=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:if(!a.isDestroyed){e.next=15;break}return e.abrupt("return");case 15:if((null===(i=r)||void 0===i?void 0:i.id)===s){e.next=17;break}throw new Error("Interleaved ".concat(l," operation detected"));case 17:return a.activeRequests[l]=null,e.next=20,a.internalOnResponse(r,u,n,t);case 20:if(c=e.sent,!a.isDestroyed){e.next=23;break}return e.abrupt("return");case 23:c&&(a.skipSuccessProperty?!1!==(null==c?void 0:c.success):null!=c&&c.success)||(d={rawResponse:t,response:c,request:r},null!=c&&c.message&&(d.message=c.message),r.reject(new Lx(d))),a["crud"+Le.capitalize(r.type)+"ed"]=!0,r.resolve({response:c,rawResponse:t,responseText:u,request:r});case 26:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"onCrudRequestFailure",value:(n=f(L().mark((function e(t,n,r){var i,a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this).isDestroyed){e.next=3;break}return e.abrupt("return");case 3:if(r=a.activeRequests[r.type],o=null==n||null===(i=n.abortController)||void 0===i?void 0:i.signal,l=Boolean(null==o?void 0:o.aborted),a.afterSyncAttempt(r),l){e.next=23;break}return u="",e.prev=8,e.next=11,t.text();case 11:u=e.sent,s=a.decode(u),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(8);case 17:if(!a.isDestroyed){e.next=19;break}return e.abrupt("return");case 19:if(a.triggerFailedRequestEvents(r,s,u,n,t),!a.isDestroyed){e.next=22;break}return e.abrupt("return");case 22:r.reject(new Lx({rawResponse:t,request:r}));case 23:a.activeRequests[r.type]=null;case 24:case"end":return e.stop()}}),e,this,[[8,15]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"acceptChanges",value:function(){this.crudStores.forEach((function(e){return e.store.acceptChanges()})),this.trigger("acceptChanges")}},{key:"revertChanges",value:function(){this.revertCrudStoreChanges(),this.trigger("revertChanges")}},{key:"revertCrudStoreChanges",value:function(){var e=this.eventStore.usesSingleAssignment;this.orderedCrudStores.forEach((function(t){var n=t.store;return(!n.isAssignmentStore||!e)&&n.revertChanges()}))}},{key:"doDestroy",value:function(){var e=this,n=e.activeRequests,r=n.load,i=n.sync;for(r&&e.cancelRequest(r.desc,r.reject),i&&e.cancelRequest(i.desc,i.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);B(t,"doDestroy",this,1)&&B(t,"doDestroy",this,3)([])}},{key:"crudStoresJSON",get:function(){var e,t={};return this.forEachCrudStore((function(e,n){return t["".concat(n,"Data")]=e.toJSON()})),null!==(e=this.assignmentStore)&&void 0!==e&&e.usesSingleAssignment&&delete t.assignmentsData,t},set:function(e){this.forEachCrudStore((function(t,n){var r="".concat(n,"Data");e[r]&&(t.data=e[r])}))}}],[{key:"defaultConfig",get:function(){return{crudRevision:null,crudStores:[],storeIdProperty:"id",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}}]);var n,r,l,s,u}((n=e||Mn).mixin.apply(n,r)),S(t,"$name","AbstractCrudManagerMixin"),S(t,"configurable",{loadUrl:null,syncUrl:null,forceSync:null,ignoreRemoteChangesInSTM:!1,includeChildrenInRemoveRequest:!0,syncConflictResolution:"local"}),S(t,"delayable",{doAutoLoad:"raf"}),t},Bx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"cancelRequest",value:function(e,t){var n;null===(n=e.abort)||void 0===n||n.call(e),this.isDestroying||null==t||t({cancelled:!0})}},{key:"shouldUseBodyForRequestData",value:function(e,t,n){return!("HEAD"===t||"GET"===t||n)}},{key:"sendRequest",value:function(e){var n=this,r=e.data,i=n.transport[e.type]||{},a=pe.assign({},i);e.url&&(a.url=e.url),a.method=a.method||t.defaultMethod[e.type],a.params=pe.assign(a.params||{},e.params);var o,l,s=a.paramName;if(n.shouldUseBodyForRequestData(i,a.method,s)?(a.body=r,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(s=s||"data",a.params[s]=r),!a.url)throw new Error("Trying to request without URL specified");function u(){a.queryParams=a.params,delete a.params;var t=!1,r=pe.assign({},a);return(o=Ba.fetch(a.url,r)).catch((function(e){var i,a;o.done=!0,null===(i=n.trigger)||void 0===i||i.call(n,"responseReceived",{success:!1});var l=null===(a=r.abortController)||void 0===a?void 0:a.signal;return l&&((t=l.aborted)||console.warn(e)),{error:e,cancelled:t}})).then((function(t){var i;o.done=!0,null===(i=n.trigger)||void 0===i||i.call(n,"responseReceived",{success:Boolean(null==t?void 0:t.ok)});var a=null!=t&&t.ok?e.success:e.failure;return null==a?void 0:a.call(e.thisObj||n,t,r,e)}))}delete a.paramName;var c=n.trigger("beforeSend",{params:a.params,requestType:e.type,requestConfig:a,config:e});return(l=pe.isPromise(c)?c.then(u):u()).abort=function(){var e,t;o.done||(null===(e=(t=o).abort)||void 0===e||e.call(t),l.aborted=!0)},l}}],[{key:"defaultMethod",get:function(){return{load:"GET",sync:"POST"}}}])}(e||Mn),S(t,"$name","AjaxTransport"),t},Vx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"encode",value:function(e){var t;return e=Object.assign({},null===(t=this.encoder)||void 0===t?void 0:t.requestData,e),Le.safeJsonStringify(e)}},{key:"decode",value:function(e){return Le.safeJsonParse(e)}}],[{key:"defaultConfig",get:function(){return{encoder:{}}}}])}(e||Mn),S(t,"$name","JsonEncoder"),t},Nx=function(e){return function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"startConfigure",value:function(e){this.getConfig("project"),B(t,"startConfigure",this,3)([e]),this._changesToClear=new a}},{key:"doAutoLoad",value:(o=f(L().mark((function e(){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.project)){e.next=4;break}return e.next=4,n.commitAsync();case 4:return e.abrupt("return",B(t,"doAutoLoad",this,3)([]));case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"applyProjectResponse",value:function(e){var t=this,n=t.project;t.applyingProjectResponse=!0,"$input"in e&&(e=e.$input);var r=n.fieldMap.startDate,i=n.fieldMap.endDate,a=Be.getPath(e,r.dataSource),o=Be.getPath(e,i.dataSource);"string"==typeof a&&Be.setPath(e,r.dataSource,r.convert(a)),"string"==typeof o&&Be.setPath(e,i.dataSource,i.convert(o)),n.setByDataSource(e),t._changesToClear.set(t,e),t.applyingProjectResponse=!1}},{key:"loadCrudManagerData",value:(i=f((function(e){var n=arguments,r=this;return L().mark((function i(){var a,o;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=(a=r).project,a.suspendChangeTracking(),i.next=4,B(t,"loadCrudManagerData",r,3)(n);case 4:return null!=e&&e.project&&(o.delayEnteringReplica&&o.hasDataInStores?o.ion({recordsUnlinked:function(){a.suspendChangeTracking(),a.applyProjectResponse(e.project),a.resumeChangeTracking()},once:!0}):a.applyProjectResponse(e.project)),a.resumeChangeTracking(),i.next=8,null==o?void 0:o.commitAsync();case 8:case"end":return i.stop()}}),i)}))()})),function(e){return i.apply(this,arguments)})},{key:"sync",value:(r=f(L().mark((function e(){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.project,this.suspendAutoSync(),this.suspendChangeTracking(),!n){e.next=6;break}return e.next=6,n.commitAsync();case 6:if(!this.isDestroying){e.next=8;break}return e.abrupt("return");case 8:return this.resumeChangeTracking(!0),this.resumeAutoSync(!1),e.abrupt("return",B(t,"sync",this,3)([]));case 11:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"applyResponse",value:(n=f(L().mark((function e(n,r,i){var a,o,l,s,u,c,d,h,f,v,g,m,p,y,k;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((u=this).isDestroyed||null!==(a=u.project)&&void 0!==a&&a.isDestroyed)){e.next=3;break}return e.abrupt("return");case 3:return u.trigger("beforeApplyResponse"),u.crudStores.forEach((function(e){return e.store.suspendFilterOnUpdate()})),(c=(null==r?void 0:r.project)||u.supportShortSyncResponse&&(null==n||null===(o=n.pack)||void 0===o?void 0:o.project))&&(d={},c.startDate&&(d.startDate=c.startDate),c.endDate&&(d.endDate=c.endDate),c.calendar&&(d.calendar=null!==(h=null===(f=u.project)||void 0===f?void 0:f.getCalendarById(c.calendar))&&void 0!==h?h:c.calendar,delete c.calendar),u.applyProjectResponse(d)),e.next=9,B(t,"applyResponse",this,3)([n,r,i]);case 9:if(c&&(v=u._changesToClear.get(u),u.applyProjectResponse(c),u._changesToClear.set(u,Be.assign({},v,c))),!u.project){e.next=22;break}return p=n.type,u.trackResponseType&&(p=r.type||p),y="propagating".concat(Le.capitalize(p),"Changes"),u.suspendAutoSync(),u[y]=!0,k=u.project.isInitialCommit&&!u.project.silenceInitialCommit,e.next=19,u.project.commitAsync();case 19:u[y]=!1,null===(g=u.resumeAutoSync)||void 0===g||g.call(u,k),null===(m=u.commitRespondedChanges)||void 0===m||m.call(u);case 22:null===(l=u.crudStores)||void 0===l||l.forEach((function(e){return e.store.resumeFilterOnUpdate()})),null===(s=u.trigger)||void 0===s||s.call(u,"applyResponse",{request:n,response:r,options:i});case 24:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"applySyncResponse",value:function(){var e,n=this,r=null===(e=n.project)||void 0===e?void 0:e.stm.disabled;!1===r&&n.shouldIgnoreRemoteChangesInSTM&&n.project.stm.disable(),n.suspendAutoSync();for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];B(t,"applySyncResponse",this,3)(a),n.resumeAutoSync(!1),!1===r&&n.project.stm.enable()}},{key:"shouldClearRecordFieldChange",value:function(e,t,n){var r,i=e.getValue(t);return null!==(r=t=e.getFieldDefinition(t))&&void 0!==r&&r.isEqual?t.isEqual(i,n):Be.isEqual(i,n)}},{key:"commitRespondedChanges",value:function(){var e=this;this._changesToClear.forEach((function(t,n){Object.entries(t).forEach((function(t){var r=_(t,2),i=r[0],a=r[1];n===e&&e.project!==e||!e.shouldClearRecordFieldChange(n,i,a)||delete n.meta.modified[i]}))})),this._changesToClear.clear()}},{key:"applyChangesToStore",value:function(e,n,r){for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++)a[o-3]=arguments[o];var l=B(t,"applyChangesToStore",this,3)([e,n,r].concat(a));if(null!=l&&l.size&&this.project){var s,u=D(l);try{for(u.s();!(s=u.n()).done;){var c=_(s.value,2),d=c[0],h=c[1],f=e.store.getById(d);f&&this._changesToClear.set(f,h)}}catch(e){u.e(e)}finally{u.f()}}return l}}],[{key:"defaultConfig",get:function(){return{project:null}}}]);var n,r,i,o}((e||Mn).mixin(Hx,Bx,Vx))},zx=["events","resourceTimeRanges","assignments","timeRanges"],jx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateRemotePaging",value:function(e,t){e?this.lazyLoad=!0:t&&(this.lazyLoad=!1)}},{key:"updatePageSize",value:function(){this.isConfiguring||this.load()}},{key:"updateLazyLoad",value:function(e,t){if(e||t){var n=this,r=n.internalLoad;n.crudStores.forEach((function(e){var t=e.store;return n.storeShouldLazyLoad(t)&&n.setupLazyStore(t)})),e?r||(n.internalLoad=n.load,n.load=n.internalLazyLoad):r&&(n.load=r)}}},{key:"afterAddStore",value:function(e){var t=this;e.forEach((function(e){var n=e.store;return t.storeShouldLazyLoad(n)&&t.setupLazyStore(n)}))}},{key:"setupPagingStore",value:function(e){var t=this;if(this.remotePaging){var n=e.isResourceStore;e.remotePaging=!0,e.syncDataOnLoad=!1,n?e._pageSize=this.pageSize:(e.lazyLoad=!0,e.lazyLoad.$isCrudManager=!0),n||e.isEventStore?e.requestData=function(e){return t.requestData(e,n)}:e.requestData=null}else e.remotePaging=!1}},{key:"setupLazyStore",value:function(e){var t,n=this;if(this.remotePaging)return this.setupPagingStore(e);var r=this.lazyLoad;if(r){var i=e.isResourceStore;if(!0!==r){var a=r,o=a.chunkSize,l=a.bufferUnit,s=a.bufferAmount;r={},i&&o?r.chunkSize=o:i||(l&&(r.bufferUnit=l),s&&(r.bufferAmount=s))}e.lazyLoad=r,e.lazyLoad.$isCrudManager=!0,e.syncDataOnLoad=!1,i||e.isEventStore?e.requestData=function(e){return n.requestData(e,i)}:e.requestData=null}else null!==(t=e.lazyLoad)&&void 0!==t&&t.$isCrudManager&&(e.lazyLoad=!1)}},{key:"internalLazyLoad",value:function(){return this.crudLoaded=!1,this.resourceStore.load()}},{key:"loadCrudStore",value:function(e,n,r){if(!this.lazyLoad||!this.storeShouldLazyLoad(e))return B(t,"loadCrudStore",this,3)([e,n,r])}},{key:"getLazyDateStores",value:function(e){return this.crudStores.filter((function(t){return zx.includes(t.storeId)&&(!e||!t.store.isEventStore)}))}},{key:"storeShouldLazyLoad",value:function(e){return e.isResourceStore||this.getLazyDateStores().some((function(t){return t.store===e}))}},{key:"requestData",value:(n=f(L().mark((function e(t,n){var r,a,o,l,s,u,c,d,h,f,v,g,m;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.startDate&&t.endDate){e.next=2;break}return e.abrupt("return");case 2:return a=(r=this).getLazyDateStores(!n),o=n&&r.resourceStore.isTree,l=r._lazyRequestPromises||(r._lazyRequestPromises=[]),s={type:"load",params:t,stores:r.crudStores.filter((function(e){return!r.crudLoaded||zx.includes(e.storeId)||n&&e.store.isResourceStore})).map((function(e){return e.storeId}))},u=Promise.all(l).then((function(){return r.internalLoad(s)})),c=F(F({},t),{},{promise:u}),o&&(c.startIndex=-1,c.count=1),a.forEach((function(e){var t=e.store;!n||!r.remotePaging&&r.resourceStore.count||(t.clear(!0),t.lazyLoad.clear()),t.lazyLoad.addToQueue(c),t.lazyLoad.triggerLazyLoadStart()})),l.push(u),e.next=8,u;case 8:return d=e.sent,h=d.response,f=n?h.resources:h.events,v=f.rows,g=f.total,o&&(m=r.resourceStore.modelClass.idField,c.resourceIds=v.map((function(e){return e[m]}))),a.forEach((function(e){var t,n=e.store.lazyLoad,r=e.storeId;o&&(delete n.loadQueue[-1],n.addToQueue(c)),n.addData(null===(t=h[r])||void 0===t?void 0:t.rows,c),n.triggerLazyLoadEnd()})),l.splice(l.indexOf(u),1),e.abrupt("return",{data:v,total:n?g:i});case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]);var n}(e||Mn),S(t,"$name","LazyLoadCrudManager"),S(t,"configurable",{lazyLoad:!1,remotePaging:!1,pageSize:50}),t},Wx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"revision",get:function(){return this.crudRevision},set:function(e){this.crudRevision=e}},{key:"json",get:function(){var e=this.crudStoresJSON;return Le.safeJsonStringify(e)},set:function(e){"string"==typeof e&&(e=Le.safeJsonParse(e)),this.crudStoresJSON=e}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.stores&&(e.crudStores=e.stores,delete e.stores),B(t,"construct",this,3)([e])}},{key:"toJSON",value:function(){return this.crudStoresJSON}},{key:"inlineData",get:function(){return this.crudStoresJSON},set:function(e){this.crudStoresJSON=e}},{key:"stores",get:function(){return this.crudStores},set:function(e){e!==this.crudStores&&(this.crudStores=e)}},{key:"isLoading",get:function(){return this.isCrudManagerLoading}},{key:"addStore",value:function(){return this.addCrudStore.apply(this,arguments)}},{key:"removeStore",value:function(){return this.removeCrudStore.apply(this,arguments)}},{key:"getStore",value:function(){return this.getCrudStore.apply(this,arguments)}},{key:"hasChanges",value:function(){return this.crudStoreHasChanges.apply(this,arguments)}},{key:"loadData",value:function(){return this.loadCrudManagerData.apply(this,arguments)}}],[{key:"defaultConfig",get:function(){return{stores:null}}}])}(Mn.mixin(Hx));Wx._$name="AbstractCrudManager";var $x=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"attachStore",value:function(e){B(t,"attachStore",this,3)([e]),null!=this.useRawData&&(e.useRawData=this.useRawData)}},{key:"toJSON",value:function(){switch(this.toJSONResultFormat){case"inlineData":return this.inlineData;case"model":return B(t,"toJSON",this,3)([])}}},{key:"inlineData",get:function(){var e,n=this;return e=n.isAbstractCrudManagerMixin?n.crudStoresJSON:{eventsData:n.eventStore.toJSON(),resourcesData:n.resourceStore.toJSON(),dependenciesData:n.dependencyStore.toJSON(),timeRangesData:n.timeRangeStore.toJSON(),resourceTimeRangesData:n.resourceTimeRangeStore.toJSON(),assignmentsData:n.assignmentStore.toJSON()},n.eventStore.usesSingleAssignment&&e.assignmentsData&&delete e.assignmentsData,e.project=B(t,"toJSON",this,3)([]),Be.deletePath(e,"project.id"),Be.deletePath(e,"project.children"),e},set:function(e){this.loadInlineData(e)}},{key:"json",get:function(){var e=this.toJSONResultFormat;this.toJSONResultFormat="inlineData";var n=B(t,"json",this,1);return this.toJSONResultFormat=e,n}},{key:"changeJson",value:function(e){return"string"==typeof e&&(e=Le.safeJsonParse(e)),e}},{key:"updateJson",value:function(e){e&&this.loadInlineData(e)}},{key:"assignments",get:function(){return this.assignmentStore.allRecords}},{key:"updateAssignments",value:function(e){this.assignmentStore.data=e}},{key:"dependencies",get:function(){return this.dependencyStore.allRecords}},{key:"updateDependencies",value:function(e){this.dependencyStore.data=e}},{key:"resources",get:function(){return this.resourceStore.allRecords}},{key:"updateResources",value:function(e){this.resourceStore.data=e}},{key:"timeRanges",get:function(){return this.timeRangeStore.allRecords}},{key:"getTimeRanges",value:function(e,t){var n,r=[],i=D(this.timeRangeStore);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.isRecurring?r.push.apply(r,z(a.getOccurrencesForDateRange(e,t))):a.startDate<t&&e<a.endDate&&r.push(a)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"updateTimeRanges",value:function(e){this.timeRangeStore.data=e}},{key:"getResourceTimeRanges",value:function(e,t){var n,r=[],i=D(this.resourceTimeRangeStore);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.isRecurring?r.push.apply(r,z(a.getOccurrencesForDateRange(e,t))):a.startDate<t&&(!a.endDate||e<a.endDate)&&r.push(a)}}catch(e){i.e(e)}finally{i.f()}return r}}],[{key:"configurable",get:function(){return{assignments:null,dependencies:null,resources:null,timeRanges:null,json:null,shouldSyncDataOnLoad:null,toJSONResultFormat:"inlineData",useRawData:null}}},{key:"autoExposeFields",get:function(){return!1}}])}(e||od),S(t,"$name","ProjectModelCommon"),t},Ux=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"domId",get:function(){return"".concat(this.constructor.domIdPrefix,"-").concat(this.id)}},{key:"isResourceTimeRange",get:function(){return!0}},{key:"resources",get:function(){return this.resource?[this.resource]:[]}},{key:"$linkedResources",get:function(){return this.resources}}])}(Bw.mixin(XS));S(Ux,"$name","ResourceTimeRangeModel"),S(Ux,"fields",["resourceId","timeRangeColor"]),S(Ux,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),S(Ux,"domIdPrefix","resourcetimerange"),Ux._$name="ResourceTimeRangeModel";var Gx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"$lazyLoadPluginClass",get:function(){return this.isPaged?fS:hS}},{key:"project",get:function(){return B(t,"project",this,1)},set:function(e){var n;V(t,"project",e,this,1,1),!this.resourceStore&&null!=e&&null!==(n=e.resourceStore)&&void 0!==n&&n.isStore&&(this.resourceStore=e.resourceStore)}},{key:"resourceStore",get:function(){return this._resourceStore},set:function(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}},{key:"getResourcesForEvent",value:function(e){return[e.resource]}},{key:"getRanges",value:function(e){var t=e.resourceRecord,n=e.startDate,r=e.endDate;return t.timeRanges.flatMap((function(e){return e.isRecurring?e.getOccurrencesForDateRange(n,r):e.intersectsRange(n,r)?e:[]})).sort((function(e,t){return e.startDate-t.startDate}))}}],[{key:"defaultConfig",get:function(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:Ux,id:"resourceTimeRanges",project:null}}}])}(Pf.mixin(xS));S(Gx,"$name","ResourceTimeRangeStore"),Gx._$name="ResourceTimeRangeStore";var Yx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"timeZone",get:function(){return this.client.project.timeZone}},{key:"processRecord",value:function(e,t){(t||this.client.isLoadingData||e.timeZone!==i)&&this.convertRecordToTimeZone(e)}},{key:"convertRecordToTimeZone",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.timeZone;if(e.timeZone!==t){var n;if(null!==(n=e.baselines)&&void 0!==n&&n.count){var r,a=D(e.baselines);try{for(a.s();!(r=a.n()).done;){var o=r.value;e.timeZone!==o.timeZone&&(o.timeZone=e.timeZone),o.convertToTimeZone(t)}}catch(e){a.e(e)}finally{a.f()}}e.isRecurring&&e.removeOccurrences(),e.convertToTimeZone(t)}}},{key:"beforeSyncRecord",value:function(e){var t,n=e.record,r=e.data;null!=n.timeZone&&(n.manuallyScheduled||!n.constraintDate||r.constraintDate||(t=["constraintDate"]),n.$restoreTimeZone=n.timeZone,n.convertToTimeZone(null,t))}},{key:"afterSyncRecord",value:function(e){var t,n=e.record,r=e.data;n.$restoreTimeZone&&(n.manuallyScheduled||!n.constraintDate||r.constraintDate||(t=["constraintDate"]),n.convertToTimeZone(n.$restoreTimeZone,t),n.$restoreTimeZone=null)}},{key:"getOccurrencesForTimeSpan",value:function(e,t,n){var r=[];if(e.isRecurring){var i,a=e.recurrence.timeZone,o=e.timeZone;if(null!=a&&o!=a&&(!e.project||o==e.project.timeZone)){i=e.startDate;var l=yp.toTimeZone(e.getLocalDate("startDate"),a);e.isResourceTimeRange?e.setData("startDate",l):e._startDate=l}r=this.overridden.getOccurrencesForTimeSpan(e,t,n),null!=i&&(e.isResourceTimeRange?e.setData("startDate",i):e._startDate=i,r.forEach((function(t){if(t!==e){var n=yp.fromTimeZone(t.startDate,a),r=yp.fromTimeZone(t.endDate,a);null!=o&&(n=yp.toTimeZone(n,o),r=yp.toTimeZone(r,o)),t.setData({startDate:n,endDate:r})}})))}return r}}],[{key:"pluginConfig",get:function(){return{before:["processRecord"],assign:["beforeSyncRecord","afterSyncRecord"],override:["getOccurrencesForTimeSpan"]}}}])}(wc);S(Yx,"$name","storeTimeZonePlugin"),Yx._$name="StoreTimeZonePlugin";var qx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"_storesWithDates",get:function(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter((function(e){return e}))}},{key:"plugStore",value:function(e){var t;!1===(null===(t=e.hasPlugin)||void 0===t?void 0:t.call(e,Yx))&&e.addPlugins(Yx)}},{key:"unplugStore",value:function(e){var t;null===(t=e.plugins.storeTimeZonePlugin)||void 0===t||t.destroy()}},{key:"attachStore",value:function(e){B(t,"attachStore",this,3)([e]),e&&this.data&&null!=this.timeZone&&this._storesWithDates.includes(e)&&(this.plugStore(e),this.convertStoresToTimeZone([e]))}},{key:"detachStore",value:function(e){B(t,"detachStore",this,3)([e]),e&&!e.isDestroyed&&null!=this.timeZone&&(this.convertStoresToTimeZone([e],null),this.unplugStore(e))}},{key:"relayStoreChange",value:function(e){var t,n=e.source,r=e.action,i=e.records,a=e.replaced,o=this;null!=o.timeZone&&o._storesWithDates.includes(n)&&(["add","replace"].includes(r)&&(null!==(t=i)&&void 0!==t&&t.length||null==a||!a.length||(i=a),i.length&&i.forEach((function(e){return e.timeZone=o.timeZone}))))}},{key:"convertStoresToTimeZone",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.timeZone,n=this.stm,r=null==n?void 0:n.enabled;r&&(n.disabled=!0);var a,o=D(e);try{var l=function(){var e,n=a.value;null==n||null===(e=n.forEach)||void 0===e||e.call(n,(function(e){return n.plugins.storeTimeZonePlugin.convertRecordToTimeZone(e,t)}))};for(o.s();!(a=o.n()).done;)l()}catch(e){o.e(e)}finally{o.f()}r&&this.commitAsync().then((function(){n.disabled=!1}))}},{key:"updateTimeZone",value:function(e,t){var n=this,r=n._isConfiguringTimeZone||n.isConfiguring;if(n.trigger("beforeTimeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:r}),n.calendarManagerStore.forEach((function(e){return e.bumpVersion()})),n._storesWithDates.forEach((function(e){return n.plugStore(e)})),n.convertStoresToTimeZone(n._storesWithDates),n.startDate){var i=null!=t?yp.fromTimeZone(n.startDate,t):n.startDate;n.startDate=null!=e?yp.toTimeZone(i,e):i}n.ignoreRecordChanges=!0,n.commitAsync().then((function(){n.isDestroyed||n.trigger("timeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:r}),delete n._isConfiguringTimeZone}))}}])}(e||od),S(t,"$name","ProjectModelTimeZoneMixin"),S(t,"configurable",{timeZone:{$config:"lazy",value:null}}),t},Kx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){this.endDate||(this.endDate=this.startDate),B(t,"afterConstruct",this,3)([])}}])}(Bw.mixin(XS));S(Kx,"$name","TimeRangeModel"),Kx._$name="TimeRangeModel";var Xx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"$lazyLoadPluginClass",get:function(){return this.isPaged?fS:hS}}])}(Pf.mixin(xS));S(Xx,"$name","TimeRangeStore"),S(Xx,"defaultConfig",{loadPriority:500,syncPriority:500,modelClass:Kx,id:"timeRanges"}),Xx._$name="TimeRangeStore";var Zx=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};B(t,"construct",this,3)(arguments),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData)}},{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]);var e=this;!e.timeRangeStore.stm&&e.stm.addStore(e.timeRangeStore),!e.resourceTimeRangeStore.stm&&e.stm.addStore(e.resourceTimeRangeStore)}},{key:"attachStore",value:function(e){e&&e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),B(t,"attachStore",this,3)([e])}},{key:"detachStore",value:function(e){e&&(this.detachListeners(e.$$name),B(t,"detachStore",this,3)([e]))}},{key:"relayStoreChange",value:function(e){return B(t,"relayStoreChange",this,3)([e]),this.trigger("change",F(F({store:e.source},e),{},{source:this}))}},{key:"updateTimeRangeStore",value:function(e,t){this.detachStore(t),this.attachStore(e),t&&(t.project=null),e&&(e.project=this)}},{key:"setTimeRangeStore",value:function(e){this.timeRangeStore=e}},{key:"changeTimeRangeStore",value:function(e){return e&&!e.isStore&&(e=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},e)),e}},{key:"updateResourceTimeRangeStore",value:function(e,t){this.detachStore(t),this.attachStore(e),t&&(t.project=null),e&&(e.project=this)}},{key:"changeResourceTimeRangeStore",value:function(e){return e&&!e.isStore&&(e=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},e)),e}},{key:"setResourceTimeRangeStore",value:function(e){this.resourceTimeRangeStore=e}},{key:"events",get:function(){return this.eventStore.allRecords}},{key:"updateEvents",value:function(e){this.eventStore.data=e}},{key:"resourceTimeRanges",get:function(){return this.resourceTimeRangeStore.allRecords}},{key:"updateResourceTimeRanges",value:function(e){this.resourceTimeRangeStore.data=e}},{key:"loadInlineData",value:(n=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoadingInlineData=!0,n.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=n.resourceTimeRangesData),n.timeRangesData&&(this.timeRangeStore.data=n.timeRangesData),e.abrupt("return",B(t,"loadInlineData",this,3)([n]));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"afterChange",value:function(e,n){B(t,"afterChange",this,3)(arguments),n.calendar&&this.trigger("calendarChange")}},{key:"doDestroy",value:function(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),B(t,"doDestroy",this,3)([])}}],[{key:"defaultConfig",get:function(){return{stm:{},timeRangeModelClass:Kx,resourceTimeRangeModelClass:Ux,timeRangeStoreClass:Xx,resourceTimeRangeStoreClass:Gx,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null,resourceTimeRangesData:null}}}]);var n}((e||od).mixin($x,qx)),S(t,"$name","ProjectModelMixin"),S(t,"configurable",{timeRangeStore:{value:{},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),t},Jx=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"eventStore",get:function(){return this._eventStore},set:function(e){var t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}},{key:"resourceStore",get:function(){return this._resourceStore},set:function(e){var t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}},{key:"assignmentStore",get:function(){return this._assignmentStore},set:function(e){var t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}},{key:"dependencyStore",get:function(){return this._dependencyStore},set:function(e){var t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}},{key:"onEventStoreBeforeSync",value:function(e){var t=e.changes;return this.removeNonPersistableRecordsToCreate(t),this.shallContinueSync(t)}},{key:"onResourceStoreBeforeSync",value:function(e){var t=e.changes;return this.removeNonPersistableRecordsToCreate(t),this.shallContinueSync(t)}},{key:"onAssignmentStoreBeforeSync",value:function(e){var t=e.changes;return this.removeNonPersistableRecordsToCreate(t),this.shallContinueSync(t)}},{key:"onDependencyStoreBeforeSync",value:function(e){var t=e.changes;return this.removeNonPersistableRecordsToCreate(t),this.shallContinueSync(t)}},{key:"removeNonPersistableRecordsToCreate",value:function(e){var t,n,r=e.added||[];for(n=r.length-1;n>=0;--n)(t=r[n]).isPersistable||r.splice(r.indexOf(t),1);0===r.length&&(e.added.length=0)}},{key:"shallContinueSync",value:function(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}])}(Mn);Jx._$name="ModelPersistencyManager";var Qx,eE,tE,nE,rE,iE,aE,oE,lE,sE,uE=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+t,e.getMilliseconds())},cE=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,i=0!==n[0],a=0,o=t.length-1;o>-1;--o){if((r=t[o])===e)return r;if(!(r>e||0===r&&i&&n[1]>e))break;a=o}return t[a]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],a=n[1],o=t.length,l=0===t[o-1]&&0!==r?a:0,s=e,u=t.indexOf(e),c=s;s===(t[u]||l);)if(++s>a&&(s=r),++u===o&&(u=0),s===c)return i;return s},e.array.prev=function(e,t,n){for(var r,i=t.length,a=0!==n[0],o=i-1,l=0;l<i;l++){if((r=t[l])===e)return r;if(!(r<e||0===r&&a&&n[1]<e))break;o=l}return t[o]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],a=n[1],o=t.length,l=0===t[o-1]&&0!==r?a:0,s=e,u=t.indexOf(e),c=s;s===(t[u]||l);)if(--s<r&&(s=a),-1===--u&&(u=o-1),s===c)return i;return s},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>i?i:n||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var i=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return i.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):i},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),i=e.dc.extent(r)[1];return n=n>i?i:n||i,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?i:n||i,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),i=e.s.val(t),a=n>59?60-r:n<=r?60-r+n:n-r,o=new Date(t.getTime()+a*e.MIN-i*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(a+120)*e.MIN-i*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),i=n>59?60-r:n<=r?60-r+n:n-r,a=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&a.getTime()<=t.getTime()&&(a=new Date(t.getTime()+(i+7200)*e.SEC)),a},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?i:n||i,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),i=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var a=e.wy.extent(i)[1],o=e.wy.start(i);return n=n>a?1:n||a,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var a=e.wy.extent(i)[1],o=e.wy.end(i);return n=n>a?a:n||a,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var n,r=[],a=0;for(var o in t){var l=o.split("_"),s=l[0],u=l[1],c=t[o],d=u?e.modifier[u](e[s],c):e[s];r.push({constraint:d,vals:c}),a++}return r.sort((function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0})),n=r[a-1].constraint,{start:function(t,i){for(var o,l=i,s=e.array[t],u=1e3;u--&&!o&&l;){o=!0;for(var c=0;c<a;c++){var d=r[c].constraint,h=d.val(l),f=d.extent(l),v=s(h,r[c].vals,f);if(!d.isValid(l,v)){l=d[t](l,v),o=!1;break}}}return l!==e.NEVER&&(l="next"===t?n.start(l):n.end(l)),l},end:function(t,n){for(var o,l=e.array[t+"Invalid"],s=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),u=a-1;u>=0;u--){var c,d=r[u].constraint,h=d.val(n),f=d.extent(n),v=l(h,r[u].vals,f);v!==i&&(!(c=d[t](n,v))||o&&!s(o,c)||(o=c))}return o},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)},tickSafe:function(e,t){return"next"===e?uE(n.end(t),1):uE(n.start(t),-1)},tickStart:function(e){return n.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var n=[],r=t.schedules.length,a=[],o=t.exceptions?t.exceptions.length:0,l=0;l<r;l++)n.push(e.compile(t.schedules[l]));for(var s=0;s<o;s++)a.push(e.compile(t.exceptions[s]));function u(t,r,l,s,u){var b,C,w,D=y(t),S=r,x=1e6,E=[],R=[],T=[],M="next"===t,F=M?0:1,A=M?1:0;if(!(l=l?new Date(l):new Date)||!l.getTime())throw new Error("Invalid start date.");for(!function(e,t,n,r){for(var i=0,a=t.length;i<a;i++)n[i]=t[i].start(e,r)}(t,n,E,l),function(t,n,r,i){for(var a=0,o=n.length;a<o;a++){var l=n[a].start(t,i);r[a]=l?[l,n[a].end(t,l)]:e.NEVER}}(t,a,R,l);x--&&S&&(b=k(E,D))&&(!s||!D(b,s));)if(o&&(h(t,a,R,b),C=g(t,R,b)))d(t,n,E,C);else{if(u){var I=m(R,D);C=p(t,n,E,b,I);var L=M?[new Date(Math.max(l,b)),C?new Date(s?Math.min(C,s):C):i]:[C?new Date(s?Math.max(s,C.getTime()+e.SEC):C.getTime()+e.SEC):i,new Date(Math.min(l,b.getTime()+e.SEC))];if(w&&L[F].getTime()===w[A].getTime()?(w[A]=L[A],S++):(w=L,T.push(w)),!C)break;d(t,n,E,C)}else T.push(M?new Date(Math.max(l,b)):v(n,E,b,s)),f(t,n,E,b);S--}for(var O=0,P=T.length;O<P;O++){var _=T[O];T[O]="[object Array]"===Object.prototype.toString.call(_)?[c(_[0]),c(_[1])]:c(_)}return 0===T.length?e.NEVER:1===r?T[0]:T}function c(e){return e instanceof Date&&!isNaN(e.valueOf())?new Date(e):i}function d(e,t,n,r){for(var i=y(e),a=0,o=t.length;a<o;a++)n[a]&&!i(n[a],r)&&(n[a]=t[a].start(e,r))}function h(t,n,r,i){for(var a=y(t),o=0,l=n.length;o<l;o++)if(r[o]&&!a(r[o][0],i)){var s=n[o].start(t,i);r[o]=s?[s,n[o].end(t,s)]:e.NEVER}}function f(t,n,r,i){for(var a=0,o=n.length;a<o;a++)if(r[a]&&r[a].getTime()===i.getTime()){var l=n[a].start(t,n[a].tick(t,i));l!==e.NEVER&&l.getTime()===r[a].getTime()?r[a]=n[a].start(t,n[a].tickSafe(t,i)):r[a]=l}}function v(e,t,n,r){for(var i,a=0,o=t.length;a<o;a++)if(t[a]&&t[a].getTime()===n.getTime()){var l=e[a].tickStart(n);if(r&&l<r)return r;(!i||l>i)&&(i=l)}return i}function g(e,t,n){for(var r,i=y(e),a=0,o=t.length;a<o;a++){var l=t[a];!l||i(l[0],n)||l[1]&&!i(l[1],n)||r&&!i(l[1],r)||(r=l[1])}return r}function m(e,t){for(var n,r=0,i=e.length;r<i;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function p(e,t,n,r,i){for(var a,o=y(e),l=0,s=t.length;l<s;l++){var u=n[l];if(u&&u.getTime()===r.getTime()){var c=t[l].end(e,u);if(i&&(!c||o(c,i)))return i;a&&!o(c,a)||(a=c)}}return a}function y(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function k(e,t){for(var n=e[0],r=1,i=e.length;r<i;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return u("next",1,t,t)!==e.NEVER},next:function(e,t,n){return u("next",e||1,t,n)},prev:function(e,t,n){return u("prev",e||1,t,n)},nextRange:function(e,t,n){return u("next",e||1,t,n,!0)},prevRange:function(e,t,n){return u("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,n){var r,a=e.schedule(n);return t&&function e(){var n=Date.now(),o=a.next(2,n);if(!o[0])return void(r=i);var l=o[0].getTime()-n;l<1e3&&(l=o[1]?o[1].getTime()-n:1e3);r=l<2147483647?setTimeout(t,l):setTimeout(e,2147483647)}(),{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout((function a(){i||(t(),r=e.setTimeout(a,n))}),n),i=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){i=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,i,a){return new Date(e,t,n,r,i,a)}:function(e,t,n,r,i,a){return new Date(Date.UTC(e,t,n,r,i,a))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,n,r,a,o,l){return e.date.build(t,n!==i?n-1:0,r!==i?r:1,a||0,o||0,l||0)},e.date.nextRollover=function(t,n,r,i){var a=r.val(t),o=r.extent(t)[1];return(n||o)<=a||n>o?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,n,r,i,a,o){var l=arguments.length;return n=l<2?11:n-1,r=l<3?e.D.extent(e.date.next(t,n+1))[1]:r,i=l<4?23:i,a=l<5?59:a,o=l<6?59:o,e.date.build(t,n,r,i,a,o)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function o(e,t,n,r,i){var a=n;for(e[t]||(e[t]=[]);a<=r;)e[t].indexOf(a)<0&&e[t].push(a),a+=i||1;e[t].sort((function(e,t){return e-t}))}function l(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),o(t,"d",n,n),o(t,"dc",r,r)}function s(e,t,r,i,s,u){var c,d,h=t.schedules,f=h[h.length-1];"L"===e&&(e=i-1),null!==(c=a(e,u,s))?o(f,r,c,c):null!==(c=a(e.replace("W",""),u,s))?function(e,t,r){var i={},a={};1===r?(o(t,"D",1,3),o(t,"d",n.MON,n.FRI),o(i,"D",2,2),o(i,"d",n.TUE,n.FRI),o(a,"D",3,3),o(a,"d",n.TUE,n.FRI)):(o(t,"D",r-1,r+1),o(t,"d",n.MON,n.FRI),o(i,"D",r-1,r-1),o(i,"d",n.MON,n.THU),o(a,"D",r+1,r+1),o(a,"d",n.TUE,n.FRI)),e.exceptions.push(i),e.exceptions.push(a)}(t,f,c):null!==(c=a(e.replace("L",""),u,s))?l(h,f,c,i-1):2===(d=e.split("#")).length?l(h,f,c=a(d[0],u,s),a(d[1])):function(e,t,n,r,i,l){var s=e.split("/"),u=+s[1],c=s[0];if("*"!==c&&"0"!==c){var d=c.split("-");r=a(d[0],l,i),i=a(d[1],l,i)||i}o(t,n,r,i,u)}(e,f,r,i,s,u)}function u(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function c(e,t){return u(e)&&!u(t)?1:e-t}var d=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var t,n,r,a,o={schedules:[{}],exceptions:[]},l=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((r=l[(n=i[t])[0]])&&"*"!==r&&"?"!==r){var u,d=(a=r.split(",").sort(c)).length;for(u=0;u<d;u++)s(a[u],o,t,n[1],n[2],n[3])}return o}(t?d:"0 "+d)},e.parse.recur=function(){var t,n,r,i,a,o,l,s,u,c=[],d=[],h=c;function f(e,c,d){if(e=a?e+"_"+a:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],i){for(r=[],s=c;s<=d;s+=i)r.push(s);u={n:e,x:i,c:n.length,m:d}}var f=(r=o?[c]:l?[d]:r).length;for(s=0;s<f;s+=1){var v=r[s];n.indexOf(v)<0&&n.push(v)}r=i=a=o=l=0}return{schedules:c,exceptions:d,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return a="a",r=[e],this},before:function(e){return a="b",r=[e],this},first:function(){return o=1,this},last:function(){return l=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return f("t"),this},second:function(){return f("s",0,59),this},minute:function(){return f("m",0,59),this},hour:function(){return f("h",0,23),this},dayOfMonth:function(){return f("D",1,l?0:31),this},dayOfWeek:function(){return f("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return f("dc",1,l?0:5),this},dayOfYear:function(){return f("dy",1,l?0:366),this},weekOfMonth:function(){return f("wm",1,l?0:5),this},weekOfYear:function(){return f("wy",1,l?0:53),this},month:function(){return f("M",1,12),this},year:function(){return f("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return f("fd"),this},customModifier:function(t,n){if(!e.modifier[t])throw new Error("Custom modifier "+t+" not recognized!");return a=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return f(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,u.m)},between:function(e,n){return t[u.n]=t[u.n].splice(0,u.c),i=u.x,f(u.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=d,t=null,this}}},e.parse.text=function(t){var n,r=e.parse.recur,a=0,o="",l={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\d(t\d\d(:\d\d(:\d\d)?)?)?)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},s={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function u(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function c(e){var t,n,r,i,l,s,c=e instanceof Array?e:[e],d=/\s+/;for(c.push(d),l=a;!t||t.type===d;){s=-1,n=o.substring(l),t=u(l,l,o.split(d)[0]);var h,f=c.length;for(h=0;h<f;h++)(r=(i=c[h]).exec(n))&&0===r.index&&r[0].length>s&&(t=u(l,l+(s=r[0].length),n.substring(0,s),i));t.type===d&&(l=t.endPos)}return t}function d(e){var t=c(e);return a=t.endPos,t}function h(e){for(var t=+k(e),n=p(l.through)?+k(e):t,r=[],i=t;i<=n;i++)r.push(i);return r}function f(e){for(var t=h(e);p(l.and);)t.push.apply(t,h(e));return e===l.dayName&&t.sort((function(e,t){return e-t})),t}function v(e){var t,n,r,i;p(l.weekend)?e.on(s.sun,s.sat).dayOfWeek():p(l.weekday)?e.on(s.mon,s.tue,s.wed,s.thu,s.fri).dayOfWeek():(t=k(l.rank),e.every(t),n=m(e),p(l.start)?(t=k(l.rank),e.startingOn(t),y(n.type)):p(l.between)&&(r=k(l.rank),p(l.and)&&(i=k(l.rank),e.between(r,i))))}function g(e){p(l.first)?e.first():p(l.last)?e.last():e.on(f(l.rank)),m(e)}function m(e){var t=y([l.second,l.minute,l.hour,l.dayOfYear,l.dayOfWeek,l.dayInstance,l.day,l.month,l.year,l.weekOfMonth,l.weekOfYear]);switch(t.type){case l.second:e.second();break;case l.minute:e.minute();break;case l.hour:e.hour();break;case l.dayOfYear:e.dayOfYear();break;case l.dayOfWeek:e.dayOfWeek();break;case l.dayInstance:e.dayOfWeekCount();break;case l.day:e.dayOfMonth();break;case l.weekOfMonth:e.weekOfMonth();break;case l.weekOfYear:e.weekOfYear();break;case l.month:e.month();break;case l.year:e.year();break;default:n=a}return t}function p(e){var t=c(e).type===e;return t&&d(e),t}function y(e){var t=d(e);return t.type?t.text=function(e,t){var n=e;switch(t){case l.time:var r=e.split(/(:|am|pm)/),i="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],a=r[2].trim();n=(1===i.length?"0":"")+i+":"+a;break;case l.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case l.monthName:case l.dayName:n=s[e.substring(0,3)];break;case l.fullDate:n=new Date(e.toUpperCase())}return n}(t.text,e):n=a,t}function k(e){return y(e).text}return function(e){a=0,o=e,n=-1;for(var t=r();a<o.length&&n<0;){switch(y([l.every,l.after,l.before,l.onthe,l.on,l.of,l.in,l.at,l.and,l.except,l.also]).type){case l.every:v(t);break;case l.after:c(l.time).type!==i?(t.after(k(l.time)),t.time()):c(l.fullDate).type!==i?(t.after(k(l.fullDate)),t.fullDate()):(t.after(k(l.rank)),m(t));break;case l.before:c(l.time).type!==i?(t.before(k(l.time)),t.time()):c(l.fullDate).type!==i?(t.before(k(l.fullDate)),t.fullDate()):(t.before(k(l.rank)),m(t));break;case l.onthe:g(t);break;case l.on:t.on(f(l.dayName)).dayOfWeek();break;case l.of:t.on(f(l.monthName)).month();break;case l.in:t.on(f(l.yearIndex)).year();break;case l.at:for(t.on(k(l.time)).time();p(l.and);)t.on(k(l.time)).time();break;case l.and:break;case l.also:t.and();break;case l.except:t.except();break;default:n=a}}return{schedules:t.schedules,exceptions:t.exceptions,error:n}}(t.toLowerCase())},e}();cE.date.localTime(),e.TimeUnit=void 0,(Qx=e.TimeUnit||(e.TimeUnit={})).Millisecond="millisecond",Qx.Second="second",Qx.Minute="minute",Qx.ElapsedMinute="eminute",Qx.Hour="hour",Qx.ElapsedHour="ehour",Qx.Day="day",Qx.ElapsedDay="eday",Qx.Week="week",Qx.ElapsedWeek="eweek",Qx.Month="month",Qx.ElapsedMonth="emonth",Qx.Quarter="quarter",Qx.ElapsedQuarter="equarter",Qx.Year="year",Qx.ElapsedYear="eyear",e.ProjectConstraintResolution=void 0,(eE=e.ProjectConstraintResolution||(e.ProjectConstraintResolution={})).Honor="honor",eE.Ignore="ignore",eE.Conflict="conflict",e.ConstraintType=void 0,(tE=e.ConstraintType||(e.ConstraintType={})).MustStartOn="muststarton",tE.MustFinishOn="mustfinishon",tE.StartNoEarlierThan="startnoearlierthan",tE.StartNoLaterThan="startnolaterthan",tE.FinishNoEarlierThan="finishnoearlierthan",tE.FinishNoLaterThan="finishnolaterthan",tE.AsSoonAsPossible="assoonaspossible",tE.AsLateAsPossible="aslateaspossible",e.SchedulingMode=void 0,(nE=e.SchedulingMode||(e.SchedulingMode={})).Normal="Normal",nE.FixedDuration="FixedDuration",nE.FixedEffort="FixedEffort",nE.FixedUnits="FixedUnits",e.DependencyValidationResult=void 0,(rE=e.DependencyValidationResult||(e.DependencyValidationResult={}))[rE.NoError=0]="NoError",rE[rE.CyclicDependency=1]="CyclicDependency",rE[rE.DuplicatingDependency=2]="DuplicatingDependency",e.DependencyType=void 0,(iE=e.DependencyType||(e.DependencyType={}))[iE.StartToStart=0]="StartToStart",iE[iE.StartToEnd=1]="StartToEnd",iE[iE.EndToStart=2]="EndToStart",iE[iE.EndToEnd=3]="EndToEnd",e.DependenciesCalendar=void 0,(aE=e.DependenciesCalendar||(e.DependenciesCalendar={})).Project="Project",aE.FromEvent="FromEvent",aE.ToEvent="ToEvent",aE.AllWorking="AllWorking",e.StartedTaskScheduling=void 0,(oE=e.StartedTaskScheduling||(e.StartedTaskScheduling={})).Auto="Auto",oE.Manual="Manual",e.ProjectType=void 0,(lE=e.ProjectType||(e.ProjectType={}))[lE.SchedulerBasic=1]="SchedulerBasic",lE[lE.SchedulerPro=2]="SchedulerPro",lE[lE.Gantt=3]="Gantt",e.Direction=void 0,(sE=e.Direction||(e.Direction={})).Forward="Forward",sE.Backward="Backward",sE.None="None";var dE,hE,fE;function vE(e){return e?"string"==typeof e&&(e=e.split(",")).map((function(e){var t=_(e.split("-"),2);return{startDate:t[0],endDate:t[1]}})):e=null,e}e.ConstraintIntervalSide=void 0,(dE=e.ConstraintIntervalSide||(e.ConstraintIntervalSide={})).Start="Start",dE.End="End",e.CalendarIntervalType=void 0,(hE=e.CalendarIntervalType||(e.CalendarIntervalType={})).Week="Week",hE.Exception="Exception",e.TreatInconsistentIntervals=void 0,(fE=e.TreatInconsistentIntervals||(e.TreatInconsistentIntervals={})).Skip="Skip",fE.Throw="Throw";var gE,mE,pE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([tS],(function(t){var n=function(t){function n(){return m(this,n),g(this,n,arguments)}return R(n,t),w(n,[{key:"getCalendar",value:function(){return this.stores[0].calendar}},{key:"compositeIntervalCode",get:function(){var e,t;return this.compositeCode||((null===(e=this.startDate)||void 0===e?void 0:e.getTime())||"")+"-"+((null===(t=this.endDate)||void 0===t?void 0:t.getTime())||"")+"-"+(this.type||"")}},{key:"resetPriority",value:function(){this.prioritySortValue=null,this.getCalendar().getDepth()}},{key:"getPrioritySortValue",value:function(){if(null!=this.prioritySortValue)return this.prioritySortValue;var t=1e4,n=this.priority;if(null==n){switch(this.type){case e.CalendarIntervalType.Week:t+=100*this.getCalendar().getDepth(),n=this.isOverride()?30:20;break;case e.CalendarIntervalType.Exception:t+=1e4*this.getCalendar().getDepth(),n=40;break;default:t+=100*this.getCalendar().getDepth(),this.isRecurrent()?(n=20,this.isOverride()&&(n+=10)):n=40}n+=this.parentIndex}return this.prioritySortValue=t+n}},{key:"isRecurrent",value:function(){return Boolean(this.getStartDateSchedule()||this.type===e.CalendarIntervalType.Exception&&this.getAvailabilityStartSchedule())}},{key:"isStatic",value:function(){return Boolean(this.startDate&&this.endDate&&!this.isRecurrent())}},{key:"isOverride",value:function(){return Boolean(this.startDate||this.endDate)}},{key:"parseDateSchedule",value:function(e){var t=e;if(e&&e!==Object(e))try{t=JSON.parse(e)}catch(n){if((t=cE.parse.text(e.trim())).error>=0)throw new Error("Parsing the 'later' schedule has failed: \"".concat(e,"\". Please consult the 'later' documentation for recognizable formats: https://bunkat.github.io/later/parsers.html"))}return t}},{key:"getStartDateSchedule",value:function(){var e;if(!this.recurrentStartDate)return null;if(this.startDateSchedule)return this.startDateSchedule;var t=this.parseDateSchedule(this.recurrentStartDate);if(null!=t&&null!==(e=t.schedules)&&void 0!==e&&e[0]){var n=t.schedules[0];!this.startDate&&n.fd_a&&(this.startDate=new Date(n.fd_a[0]),delete n.fd_a),!this.endDate&&n.fd_b&&(this.endDate=new Date(n.fd_b[0]),delete n.fd_b)}return this.startDateSchedule=cE.schedule(t)}},{key:"getEndDateSchedule",value:function(){var e;if(this.endDateSchedule)return this.endDateSchedule;if(!this.recurrentEndDate||"EOD"===this.recurrentEndDate)return null;var t=this.parseDateSchedule(this.recurrentEndDate);if(null!=t&&null!==(e=t.schedules)&&void 0!==e&&e[0]){var n,r,i,a,o,l,s,u,c=t.schedules[0];null!==(n=this.startDate)&&void 0!==n&&n.getTime()&&null!==(r=c.fd_a)&&void 0!==r&&r[0]&&(null===(i=this.startDate)||void 0===i?void 0:i.getTime())===(null===(a=c.fd_a)||void 0===a?void 0:a[0])&&delete c.fd_a,null!==(o=this.endDate)&&void 0!==o&&o.getTime()&&null!==(l=c.fd_b)&&void 0!==l&&l[0]&&(null===(s=this.endDate)||void 0===s?void 0:s.getTime())===(null===(u=c.fd_b)||void 0===u?void 0:u[0])&&delete c.fd_b}return this.endDateSchedule=cE.schedule(t)}},{key:"getAvailabilityStartSchedule",value:function(){var e;if(null!==(e=this.availability)&&void 0!==e&&e.length){if(this.availabilityStartSchedule)return this.availabilityStartSchedule;var t="at "+this.availability.map((function(e){return e.startDate})).sort().join(","),n=this.parseDateSchedule(t);return this.availabilityStartSchedule=cE.schedule(n)}}},{key:"getAvailabilityEndSchedule",value:function(){var e;if(null!==(e=this.availability)&&void 0!==e&&e.length){if(this.availabilityEndSchedule)return this.availabilityEndSchedule;var t="at "+this.availability.map((function(e){return e.endDate})).sort().join(","),n=this.parseDateSchedule(t);return this.availabilityEndSchedule=cE.schedule(n)}}},{key:"afterChange",value:function(e,t,r,a,o){B(n,"afterChange",this,3)([e,t,r,a,o]),null!=t&&t.recurrentStartDate&&(this.startDateSchedule=i),null!=t&&t.recurrentEndDate&&(this.endDateSchedule=i),null!=t&&t.availability&&(this.availabilityStartSchedule=i,this.availabilityEndSchedule=i)}}],[{key:"fields",get:function(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","color","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"},{name:"type"},{name:"availability",convert:vE},{name:"compositeCode"}]}}])}(t);return n}))),yE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS],(function(e){e.prototype;var t=function(e){function t(){var e;return m(this,t),(e=g(this,t,arguments)).disableHasLoadedDataToCommitFlag=!0,e}return R(t,e),w(t,[{key:"acceptChanges",value:function(){if(!this.isSyncingDataOnLoad)return B(t,"acceptChanges",this,3)(arguments)}}],[{key:"defaultConfig",get:function(){return{modelClass:pE}}}])}(e);return t}))),kE=new Date(-864e13),bE=new Date(864e13);e.EdgeInclusion=void 0,(gE=e.EdgeInclusion||(e.EdgeInclusion={}))[gE.Left=0]="Left",gE[gE.Right=1]="Right",e.CalendarIteratorResult=void 0,(mE=e.CalendarIteratorResult||(e.CalendarIteratorResult={}))[mE.FullRangeIterated=0]="FullRangeIterated",mE[mE.StoppedByIterator=1]="StoppedByIterator",mE[mE.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",mE[mE.MaxRangeReached=3]="MaxRangeReached";var CE,wE=function(){return w((function t(n){m(this,t),this.cacheFilledStartDate=bE,this.cacheFilledEndDate=kE,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=e.TimeUnit.Day,this.maxCacheExtendCycles=1e3,this.maxRange=15768e7,n&&Object.assign(this,n)}),[{key:"includeWrappingRangeFrom",value:function(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}},{key:"ensureCacheFilledForInterval",value:function(e,t){var n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==bE.getTime()){var i=e.getTime(),a=t.getTime();if(n<=i&&a<=r)return;if(a<=n)t=new Date(n-1);else if(i>=r)e=new Date(r);else if(n<=i&&i<=r)e=new Date(r+1);else{if(!(n<=a&&a<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===bE.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===kE.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}},{key:"fillCache",value:function(e,t){throw new Error("Abstract method")}},{key:"clear",value:function(){this.cacheFilledStartDate=bE,this.cacheFilledEndDate=kE,this.intervalCache.clear()}},{key:"forEachAvailabilityInterval",value:function(t,n,r){var i;r=r||this;var a=t.startDate,o=t.endDate,l=a&&a.getTime(),s=o&&o.getTime(),u=null!==(i=t.maxRange)&&void 0!==i?i:this.maxRange,c=!1!==t.isForward;if(c?!a:!o)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");for(var d=this.intervalCache,h=c?a:o,f=c?a:o,v=f.getTime(),g=1;g<this.maxCacheExtendCycles;g++){c?this.ensureCacheFilledForInterval(h,o||Pl.add(h,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(a||Pl.add(h,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),h);for(var m=d.getIntervalOf(f,c?e.EdgeInclusion.Left:e.EdgeInclusion.Right);m;){var p=m.startDate,y=m.endDate;if(c&&s&&p.getTime()>=s||!c&&l&&y.getTime()<=l)return e.CalendarIteratorResult.FullRangeIterated;if(c&&p.getTime()-v>=u||!c&&v-y.getTime()>=u)return e.CalendarIteratorResult.MaxRangeReached;if(c&&p.getTime()>=this.cacheFilledEndDate.getTime()||!c&&y.getTime()<=this.cacheFilledStartDate.getTime())break;f=c?y:p;var k=l&&p.getTime()<l?a:p,b=s&&y.getTime()>s?o:y;if(!1===n.call(r,k,b,m.cacheInterval))return e.CalendarIteratorResult.StoppedByIterator;m=c?d.getNextInterval(m):d.getPrevInterval(m)}if(c&&f.getTime()===bE.getTime()||!c&&f.getTime()===kE.getTime())return e.CalendarIteratorResult.FullRangeIterated;h=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return e.CalendarIteratorResult.MaxCacheExtendCyclesReached}}])}(),DE=function(e){return Array.from(new o(e))},SE=function(e,t){var n=e.getPrioritySortValue();return t.getPrioritySortValue()-n},xE=function(){function e(t){if(m(this,e),this.intervals=[],t&&Object.assign(this,t),this.intervals=this.normalizeIntervals(this.intervals),!this.calendar)throw new Error("Required attribute `calendar` is missing")}return w(e,[{key:"includeInterval",value:function(t){if(-1==this.intervals.indexOf(t)){var n=this.intervals.slice();return n.push(t),new e({intervals:n,calendar:this.calendar})}return this}},{key:"combineWith",value:function(t){return new e({intervals:this.intervals.concat(t.intervals),calendar:this.calendar})}},{key:"getIsWorking",value:function(){return null!=this.isWorking?this.isWorking:this.isWorking=this.intervals[0].isWorking}},{key:"normalizeIntervals",value:function(e){var t=DE(e);return t.sort(SE),t}}])}(),EE=function(e,t){for(var n=arguments.length>2&&arguments[2]!==i?arguments[2]:function(e,t){return e-t},r=0,a=t.length;r<a;){var o=(r+a)/2|0,l=n(e,t[o]);if(0===l)return{found:!0,index:o};l<0?a=o:r=o+1}return{found:!1,index:a}};e.IndexPosition=void 0,(CE=e.IndexPosition||(e.IndexPosition={}))[CE.Exact=0]="Exact",CE[CE.Next=1]="Next";var RE=function(){return w((function e(t){m(this,e),this.keys=[],this.values=[],this.comparator=t||function(e,t){return e-t}}),[{key:"set",value:function(e,t){var n=EE(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}},{key:"insertAt",value:function(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}},{key:"setValueAt",value:function(e,t){this.values[e]=t}},{key:"get",value:function(e){var t=EE(e,this.keys,this.comparator);return t.found?this.values[t.index]:i}},{key:"getEntryAt",value:function(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:i}},{key:"getKeyAt",value:function(e){return this.keys[e]}},{key:"getValueAt",value:function(e){return this.values[e]}},{key:"delete",value:function(e){var t=EE(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}},{key:"size",value:function(){return this.keys.length}},{key:"deleteAt",value:function(e){this.keys.splice(e,1),this.values.splice(e,1)}},{key:"indexOfKey",value:function(t){var n=EE(t,this.keys,this.comparator);return{found:n.found?e.IndexPosition.Exact:e.IndexPosition.Next,index:n.index}}},{key:"map",value:function(e){for(var t=this.keys,n=this.values,r=[],i=0;i<t.length;i++)r.push(e(n[i],t[i],i));return r}},{key:"getAllEntries",value:function(){return this.map((function(e,t){return{value:e,key:t}}))}},{key:"clear",value:function(){this.keys.length=0,this.values.length=0}}])}(),TE=function(){return w((function e(t){if(m(this,e),this.points=new RE((function(e,t){return e.getTime()-t.getTime()})),this.leftInfinityKey=kE,this.rightInfinityKey=bE,Object.assign(this,t),this.emptyInterval===i||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}),[{key:"size",value:function(){return this.points.size()}},{key:"indexOf",value:function(e){return this.points.indexOfKey(e)}},{key:"getDateAt",value:function(e){return this.points.getKeyAt(e)}},{key:"getPointAt",value:function(e){return this.points.getValueAt(e)}},{key:"getIntervalOf",value:function(t){var n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:e.EdgeInclusion.Left,a=this.indexOf(t),o=a.found,l=a.index;return n=r===e.EdgeInclusion.Left&&o===e.IndexPosition.Exact?l:l-1,this.getIntervalWithStartDateIndex(n)}},{key:"getPrevInterval",value:function(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}},{key:"getNextInterval",value:function(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}},{key:"getIntervalWithStartDateIndex",value:function(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}},{key:"addInterval",value:function(t,n,r){var i,a,o=this.points,l=o.indexOfKey(t),s=l.found,u=l.index;if(s==e.IndexPosition.Exact){var c=r(a=o.getValueAt(u));o.setValueAt(u,c),i=u+1}else{var d=r(a=o.getValueAt(u-1));o.insertAt(u,t,d),i=u+1}for(;i<o.size();){if(o.getKeyAt(i).getTime()>=n.getTime())break;var h=r(a=o.getValueAt(i));o.setValueAt(i,h),i++}i===o.size()?o.insertAt(o.size(),n,this.emptyInterval):o.getKeyAt(i).getTime()===n.getTime()||o.insertAt(i,n,a)}},{key:"includeWrappingRange",value:function(e,t,n){for(var r=this,i=e.getIntervalOf(t);i&&(this.addInterval(i.startDate,i.endDate,(function(e){return r.combineIntervalsFn(e,i.cacheInterval)})),!(i.endDate.getTime()>n.getTime()));)i=e.getNextInterval(i)}},{key:"getSummary",value:function(){return this.points.map((function(e,t){return{label:e,date:t}}))}},{key:"clear",value:function(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}])}(),ME=cE.schedule(cE.parse.text("every 1 day")),FE=function(t){function n(t){var r;if(m(this,n),(r=g(this,n,[t])).staticIntervalsCached=!1,!r.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");return r.intervalUnspecifiedTimeIntervals=new a,r.weekUnspecifiedTimeIntervalsByKey=new a,r.treatInconsistentIntervals=(null==t?void 0:t.treatInconsistentIntervals)||e.TreatInconsistentIntervals.Skip,r.intervalCache=new TE({emptyInterval:new xE({intervals:[r.unspecifiedTimeInterval],calendar:r.calendar}),combineIntervalsFn:function(e,t){return e.combineWith(t)}}),r}return R(n,t),w(n,[{key:"fillCache",value:function(e,t){var n;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);var r=this.calendar.ignoreTimeZone?null:null===(n=this.calendar.project)||void 0===n?void 0:n.timeZone;if(e>t)throw new Error("Invalid cache fill interval");var i,a=D(this.intervalStore);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.isRecurrent()&&this.cacheRecurrentInterval(e,t,r,o)}}catch(e){a.e(e)}finally{a.f()}}},{key:"cacheRecurrentInterval",value:function(t,n,r,i){var a,o,l=i.startDate,s=i.endDate;if(!(l&&l>=n||s&&s<=t)){var u,c=i.getAvailabilityStartSchedule(),d=i.getAvailabilityEndSchedule(),h=i.getStartDateSchedule()||c&&ME,f=i.getEndDateSchedule(),v=!f||"EOD"===f,g=t,m=n,p=h.prev(2,t);if(p&&(g=p[0]).getTime()===t.getTime()&&p[1]&&(g=p[1]),v){var y=h.next(1,n);y&&(m=Pl.getStartOfNextDay(y,!0))}else(u=f.next(2,n))&&(m=u[0]).getTime()===n.getTime()&&u[1]&&(m=u[1]);var k=h.next(1/0,g,new Date(m.getTime()-1e3));if(null!==(a=k)&&void 0!==a&&a.length){var b=v?k.map((function(e){return Pl.getStartOfNextDay(e,!0)})):f.next(1/0,g,m);if(null!==(o=b)&&void 0!==o&&o.length){for(k[0].getTime()===b[0].getTime()&&b.splice(0,1);l&&k[0]<l;)b[0]>l?k[0]=l:(k.shift(),b.shift());for(;s&&b[b.length-1]>s;)k[b.length-1]<s?b[b.length-1]=s:(k.pop(),b.pop());for(var C=this.treatInconsistentIntervals,w=0,D=k.length;w<D;w++){var S=k[w],x=b[w];if(!S||!x)break;if(S>x)if(C===e.TreatInconsistentIntervals.Skip)b.splice(w,1);else if(C===e.TreatInconsistentIntervals.Throw)throw new Error("Recurrent interval inconsistency: "+(i.name||i.id)+", caching startDate: "+Pl.format(S)+", caching endDate: "+Pl.format(x)+", recurrentStartDate: "+i.recurrentStartDate+", recurrentEndDate: "+i.recurrentEndDate)}if(b.length>k.length?b.length=k.length:b.length<k.length&&(k.length=b.length),c){for(var E=[],R=[],T=this.getUnspecifiedTimeIntervalForException(i,{isWorking:!1}),M=0,F=k.length;M<F;M++){var A=k[M],I=b[M];this.intervalCache.addInterval(A,I,(function(e){return e.includeInterval(T)}));var L=c.next(1/0,A,I);if(!L)return;var O=d.next(1/0,new Date(A.getTime()+1e3),I);if(!O)return;O.length>L.length?O.length=L.length:O.length<L.length&&(L.length=O.length),O[0]<L[0]&&(L.unshift(A),O.push(I)),E.push.apply(E,z(L)),R.push.apply(R,z(O))}k=E,b=R}for(var P=0,_=k.length;P<_;P++){var H=k[P],B=b[P];null!=r&&(H=yp.toTimeZone(H,r),B=yp.toTimeZone(B,r)),this.intervalCache.addInterval(H,B,(function(e){return e.includeInterval(i)}))}}}}}},{key:"getUnspecifiedTimeIntervalForException",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},n=this.intervalUnspecifiedTimeIntervals.get(e);return n||(n=this.unspecifiedTimeInterval.copy(),this.intervalUnspecifiedTimeIntervals.set(e,n),Object.assign(n,F({mainInterval:e,calendar:this.unspecifiedTimeInterval.calendar,name:e.name,cls:e.cls,startDate:e.startDate,endDate:e.endDate,prioritySortValue:e.getPrioritySortValue()-1},t))),n}},{key:"getUnspecifiedTimeIntervalForWeek",value:function(e){var t=this.intervalUnspecifiedTimeIntervals.get(e);if(!t){var n=e.compositeIntervalCode;(t=this.weekUnspecifiedTimeIntervalsByKey.get(n))||(t=this.unspecifiedTimeInterval.copy(),this.intervalUnspecifiedTimeIntervals.set(e,t),this.weekUnspecifiedTimeIntervalsByKey.set(n,t),Object.assign(t,{mainInterval:e,calendar:this.unspecifiedTimeInterval.calendar,name:e.name,cls:e.cls,startDate:e.startDate,endDate:e.endDate,prioritySortValue:e.getPrioritySortValue()-1}))}return t}},{key:"clear",value:function(){this.staticIntervalsCached=!1,B(n,"clear",this,3)([])}},{key:"cacheStaticIntervals",value:function(){var t,n,r=this,i=null===(t=this.calendar.project)||void 0===t?void 0:t.timeZone,a=this.intervalCache,o=D(this.intervalStore);try{var l=function(){var t=n.value,o=t.isStatic(),l=t.type===e.CalendarIntervalType.Week;if(o||l){l&&(t=r.getUnspecifiedTimeIntervalForWeek(t));var s=t,u=s.startDate,c=s.endDate;null!=i&&(u=yp.toTimeZone(u,i),c=yp.toTimeZone(c,i)),a.addInterval(u||kE,c||bE,(function(e){return e.includeInterval(t)}))}};for(o.s();!(n=o.n()).done;)l()}catch(e){o.e(e)}finally{o.f()}}}])}(wE),AE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([pE],(function(e){var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getCalendar",value:function(){return this.calendar}},{key:"getMainInterval",value:function(){return this.mainInterval}},{key:"getPrioritySortValue",value:function(){return null!=this.prioritySortValue?this.prioritySortValue:this.prioritySortValue=this.getCalendar().getDepth()}}])}(e);return t.$name="UnspecifiedTimeIntervalModel",t}))),IE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([tS],(function(t){var n=t.prototype,r=function(t){function r(){var e;return m(this,r),(e=g(this,r,arguments)).version=1,e}return R(r,t),w(r,[{key:"intervalStoreClass",get:function(){return yE}},{key:"intervalStore",get:function(){return this.meta.intervalsStore}},{key:"initIntervalsStore",value:function(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this,e.syncDataOnLoad=!0}},{key:"processIntervalsStoreData",value:function(e){this.bumpVersion()}},{key:"isDefault",value:function(){var e=this.getProject();return!!e&&this===e.defaultCalendar}},{key:"getDepth",value:function(){return this.childLevel+1}},{key:"forEachAvailabilityInterval",value:function(e,t,n){var r,i,a=null!==(r=e.maxRange)&&void 0!==r?r:null===(i=this.getProject())||void 0===i?void 0:i.maxCalendarRange;return a&&(e=F(F({},e),{},{maxRange:a})),this.calendarCache.forEachAvailabilityInterval(e,t,n)}},{key:"accumulateWorkingTime",value:function(e,t,n){var r,i,a;if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");var o=e,l=null!==(r=null!==(i=null===(a=this.getProject())||void 0===a?void 0:a.adjustDurationToDST)&&void 0!==i?i:this.adjustDurationToDST)&&void 0!==r&&r;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(function(e,r,i){var a=!0;if(i.getIsWorking()){var s=r.getTime()-e.getTime();if(t<=s){if(l){var u=n?e.getTimezoneOffset()-new Date(e.getTime()+t).getTimezoneOffset():new Date(r.getTime()-t).getTimezoneOffset()-r.getTimezoneOffset();t-=60*u*1e3}o=n?new Date(e.getTime()+t):new Date(r.getTime()-t),t=0,a=!1}else{if(l)s+=60*(e.getTimezoneOffset()-r.getTimezoneOffset())*1e3;o=n?r:e,t-=s}}return a})),{finalDate:new Date(o),remainingDurationInMs:t}}},{key:"calculateDurationMs",value:function(e,t){var n,r,a,o=arguments.length>2&&arguments[2]!==i&&arguments[2],l=0,s=e.getTime()<=t.getTime()||!o?1:-1;if(s<0){var u=[t,e];e=u[0],t=u[1]}var c=null!==(n=null!==(r=null===(a=this.getProject())||void 0===a?void 0:a.adjustDurationToDST)&&void 0!==r?r:this.adjustDurationToDST)&&void 0!==n&&n;return this.forEachAvailabilityInterval({startDate:e,endDate:t},(function(e,t,n){if(n.getIsWorking()&&(l+=t.getTime()-e.getTime(),c)){var r=e.getTimezoneOffset()-t.getTimezoneOffset();l+=60*r*1e3}})),l*s}},{key:"calculateEndDate",value:function(e,t){var n=t>=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}},{key:"calculateStartDate",value:function(e,t){var n=t<=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}},{key:"skipNonWorkingTime",value:function(t){var n,r=!(arguments.length>1&&arguments[1]!==i)||arguments[1],a=this.forEachAvailabilityInterval(r?{startDate:t,isForward:!0}:{endDate:t,isForward:!1},(function(e,t,i){if(i.getIsWorking())return n=r?e:t,!1}));return a===e.CalendarIteratorResult.MaxRangeReached||a===e.CalendarIteratorResult.FullRangeIterated?"empty_calendar":n?new Date(n):new Date(t)}},{key:"addInterval",value:function(e){return this.addIntervals([e])[0]}},{key:"addIntervals",value:function(e){return this.bumpVersion(),this.intervalStore.add(e)}},{key:"removeInterval",value:function(e){return this.removeIntervals([e])}},{key:"removeIntervals",value:function(e){return this.bumpVersion(),this.intervalStore.remove(e)}},{key:"clearIntervals",value:function(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}},{key:"bumpVersion",value:function(){this.clearCache(),this.version++}},{key:"calendarCache",get:function(){if(this.$calendarCache!==i)return this.$calendarCache;var e=new AE({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new FE({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,treatInconsistentIntervals:this.treatInconsistentIntervals,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}},{key:"clearCache",value:function(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=i}},{key:"resetPriorityOfAllIntervals",value:function(){this.traverse((function(e){var t,n=D(e.intervalStore);try{for(n.s();!(t=n.n()).done;){t.value.resetPriority()}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"insertChild",value:function(e,t,r){var i,a=(i=n.insertChild).call.apply(i,[this].concat(Array.prototype.slice.call(arguments)));return Array.isArray(a)||(a=[a]),a.forEach((function(e){e.bumpVersion(),e.resetPriorityOfAllIntervals()})),a}},{key:"joinProject",value:function(){n.joinProject.call(this),this.intervalStore.setProject(this.getProject())}},{key:"leaveProject",value:function(){n.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}},{key:"doDestroy",value:function(){this.leaveProject(),this.intervalStore.destroy(),B(r,"doDestroy",this,3)([])}},{key:"isDayHoliday",value:function(t){var n=Pl.clearTime(t),r=Pl.getNext(t,e.TimeUnit.Day),i=!1;return this.forEachAvailabilityInterval({startDate:n,endDate:r,isForward:!0},(function(e,t,n){return!(i=n.getIsWorking())})),!i}},{key:"getDayIntervals",value:function(t){var n=Pl.clearTime(t),r=Pl.getNext(t,e.TimeUnit.Day),i=[];return this.forEachAvailabilityInterval({startDate:n,endDate:r,isForward:!0},(function(e,t,n){return i.push([e,t,n.intervals[0]])})),i}},{key:"getDailyHolidaysRanges",value:function(t,n){var r=[];for(t=Pl.clearTime(t);t<n;)this.isDayHoliday(t)&&r.push({startDate:t,endDate:Pl.getStartOfNextDay(t,!0,!0)}),t=Pl.getNext(t,e.TimeUnit.Day);return r}},{key:"getWorkingTimeRanges",value:function(e,t,n){var r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0,maxRange:n},(function(e,t,n){if(n.getIsWorking()){var i=n.intervals[0];r.push({name:i.name,startDate:e,endDate:t})}})),r}},{key:"getNonWorkingTimeRanges",value:function(e,t,n){var r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0,maxRange:n},(function(e,t,n){if(!n.getIsWorking()){var i=n.intervals[0];r.push({name:i.name,type:i.type,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})}})),r}},{key:"isWorkingTime",value:function(t,n,r){if(r){var i,a=this.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0},(function(e,r,a){if(a.getIsWorking()&&e<=t&&r>=n)return i=!0,!1}));return a!==e.CalendarIteratorResult.MaxRangeReached&&a!==e.CalendarIteratorResult.FullRangeIterated&&i}var o=this.skipNonWorkingTime(t);return!(!o||"empty_calendar"===o)&&(n?o<n:o.getTime()===t.getTime())}}],[{key:"fields",get:function(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls",{name:"treatInconsistentIntervals",persist:!1}]}}])}(t);return r}))),LE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([IE,nS],(function(e){e.prototype;var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(e);return t}))),OE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([eS],(function(e){var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e,n=[];this.isChained||null!==(e=this.rootNode)&&void 0!==e&&e.isDestroyed||this.traverse((function(e){return n.push(e)})),B(t,"doDestroy",this,3)([]),n.forEach((function(e){return e.destroy()}))}}])}(e);return t}))),PE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([OE,aS],(function(e){e.prototype;var t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{tree:!0,modelClass:LE}}}])}(e);return t}))),_E=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([],_n)),HE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([],$i)),BE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([_E,HE,od],(function(e){var t=e.prototype,n=function(e){function n(){var e;return m(this,n),(e=g(this,n,arguments)).isRestoringData=!1,e}return R(n,e),w(n,[{key:"isRepopulatingStores",get:function(){return!1}},{key:"isInitialCommit",get:function(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;var n=!("silenceInitialCommit"in e)||e.silenceInitialCommit,r="adjustDurationToDST"in e&&e.adjustDurationToDST;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,t.construct.call(this,e),this.silenceInitialCommit=n,this.adjustDurationToDST=r}},{key:"repopulateStore",value:function(e){}},{key:"repopulateReplica",value:function(){}},{key:"deferUntilRepopulationIfNeeded",value:function(e,t,n){t.apply(void 0,z(n))}},{key:"attachStore",value:function(e){}},{key:"detachStore",value:function(e){}},{key:"commitAsync",value:(r=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Abstract method called");case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"isEngineReady",value:function(){throw new Error("Abstract method called")}},{key:"getStm",value:function(){throw new Error("Abstract method called")}}]);var r}(e);return n}))),VE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([],$i)),NE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(XD([BE,QD,VE,od],(function(e){var t=e.prototype,n=function(e){function n(){return m(this,n),g(this,n,arguments)}return R(n,e),w(n,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=this;if(n.$invalidated=new o,n.$leaving=new o,n.isPerformingCommit=!1,n.silenceInitialCommit=!0,n.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){var r,a=e.eventStore.masterStore||e.eventStore,l=a.assignmentStore||(null===(r=a.crudManager)||void 0===r?void 0:r.assignmentStore);null!=l&&l.isAssignmentStore&&(e.assignmentStore=l,n.isSharingAssignmentStore=!0)}t.construct.call(n,e),n.defaultCalendar=new n.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:n.unspecifiedTimeIsWorking}),n.defaultCalendar.project=n;var s=n.calendarsData,u=n.eventsData,c=n.dependenciesData,d=n.resourcesData,h=n.assignmentsData;Boolean(s||u||c||d||h)?(n.loadInlineData({calendarsData:s,eventsData:u,dependenciesData:c,resourcesData:d,assignmentsData:h}),delete n.calendarsData,delete n.eventsData,delete n.dependenciesData,delete n.resourcesData,delete n.assignmentsData):n.bufferedCommitAsync()}},{key:"doDestroy",value:function(){var e,n,r,i,a,o,l=this;null===(e=l.eventStore)||void 0===e||e.destroy(),null===(n=l.dependencyStore)||void 0===n||n.destroy(),null===(r=l.assignmentStore)||void 0===r||r.destroy(),null===(i=l.resourceStore)||void 0===i||i.destroy(),null===(a=l.calendarManagerStore)||void 0===a||a.destroy(),l.defaultCalendar.destroy(),null===(o=l.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}},{key:"loadInlineData",value:(p=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=this).isLoadingInlineData=!0,t.calendarsData&&(n.calendarManagerStore.data=t.calendarsData),t.resourcesData&&(n.resourceStore.data=t.resourcesData),t.assignmentsData&&(n.assignmentStore.data=t.assignmentsData),t.eventsData&&(n.eventStore.data=t.eventsData),t.tasksData&&(n.eventStore.data=t.tasksData),t.dependenciesData&&(n.dependencyStore.data=t.dependenciesData),e.next=10,n.commitLoad();case 10:return n.isLoadingInlineData=!1,e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"commitLoad",value:(v=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.commitAsync();case 2:this.isDestroyed||this.trigger("load");case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"resolveStoreAndModelClass",value:function(e,t){var n=(null==t?void 0:t.storeClass)||this["".concat(e,"StoreClass")],r=null==t?void 0:t.modelClass;return r||(r=this.getDefaultConfiguration()["".concat(e,"ModelClass")]!==n.getDefaultConfiguration().modelClass?n.getDefaultConfiguration().modelClass:this["".concat(e,"ModelClass")]),{storeClass:n,modelClass:r}}},{key:"setEventStore",value:function(e){this.eventStore=e}},{key:"changeEventStore",value:function(e,t){var n=this,r=n.stm;if(n.detachStore(t),e instanceof Ff)e.project=n,r.addStore(e),e.joinRecordsToProject(n);else{var i=n.resolveStoreAndModelClass("event",e),a=i.storeClass,o=i.modelClass;e=new a(Be.assign({modelClass:o,project:n,stm:r},e))}if(t&&r.hasStore(t)){r.removeStore(t),t.unjoinRecordsFromProject(n);var l=t.assignmentsForRemoval;l.forEach((function(t){var n=t.event;if(n){var r=e.getById(n.id);r&&(t.event=r,l.delete(t))}})),t.afterEventRemoval()}return e.setProject(n),e}},{key:"updateEventStore",value:function(e,t){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}},{key:"setAssignmentStore",value:function(e){this.assignmentStore=e}},{key:"changeAssignmentStore",value:function(e,t){var n=this,r=n.stm;if(n.detachStore(t),t&&r.hasStore(t)&&(r.removeStore(t),t.unjoinRecordsFromProject(n)),e instanceof Ff)e.project=n,r.addStore(e),e.joinRecordsToProject(n);else{var i=n.resolveStoreAndModelClass("assignment",e),a=i.storeClass,o=i.modelClass;e=new a(Be.assign({modelClass:o,project:n,stm:r},e))}return e.setProject(n),e}},{key:"updateAssignmentStore",value:function(e,t){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}},{key:"setResourceStore",value:function(e){this.resourceStore=e}},{key:"changeResourceStore",value:function(e,t){var n=this,r=n.stm;if(n.detachStore(t),e instanceof Ff)e.project=n,r.addStore(e),e.joinRecordsToProject(n);else{var i=n.resolveStoreAndModelClass("resource",e),a=i.storeClass,o=i.modelClass;e=new a(Be.assign({modelClass:o,project:n,stm:r},e))}if(t&&r.hasStore(t)){r.removeStore(t),t.unjoinRecordsFromProject(n);var l=t.assignmentsForRemoval;l.forEach((function(t){var n=t.resource;if(n){var r=e.getById(n.id);r&&(t.resource=r,l.delete(t))}})),t.afterResourceRemoval()}return e.setProject(n),e}},{key:"updateResourceStore",value:function(e,t){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}},{key:"setDependencyStore",value:function(e){this.dependencyStore=e}},{key:"changeDependencyStore",value:function(e,t){var n=this;if(n.detachStore(t),e instanceof Ff)e.project=n,n.stm.addStore(e),e.joinRecordsToProject(n);else{var r=n.resolveStoreAndModelClass("dependency",e),i=r.storeClass,a=r.modelClass;e=new i(Be.assign({modelClass:a,project:n,stm:n.stm},e))}return e}},{key:"updateDependencyStore",value:function(e,t){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}},{key:"setCalendarManagerStore",value:function(e){this.calendarManagerStore=e}},{key:"changeCalendarManagerStore",value:function(e,t){var n=this;if(n.detachStore(t),e instanceof Ff)n.stm.addStore(e);else{var r,i,a=(null===(r=e)||void 0===r?void 0:r.storeClass)||n.calendarManagerStoreClass,o=(null===(i=e)||void 0===i?void 0:i.modelClass)||a.getDefaultConfiguration().modelClass||n.calendarModelClass;e=new a(Be.assign({modelClass:o,project:n,stm:n.stm},e))}return e.setProject(n),e}},{key:"updateCalendarManagerStore",value:function(e,t){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}},{key:"calendar",get:function(){return this.$calendar||this.defaultCalendar},set:function(e){this.$calendar=e}},{key:"effectiveCalendar",get:function(){return this.calendar}},{key:"addEvent",value:(h=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.eventStore.add(t),e.abrupt("return",this.commitAsync());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"addAssignment",value:(d=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assignmentStore.add(t),e.abrupt("return",this.commitAsync());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"addResource",value:(c=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.resourceStore.add(t),e.abrupt("return",this.commitAsync());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"addDependency",value:(u=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dependencyStore.add(t),e.abrupt("return",this.commitAsync());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"bufferedCommitAsync",value:function(){var e=this;this.hasPendingAutoCommit||this.setTimeout({fn:function(){var t;return null===(t=e.commitAsync)||void 0===t?void 0:t.call(e)},name:"commitAsync",delay:10})}},{key:"hasPendingAutoCommit",get:function(){return this.hasTimeout("commitAsync")}},{key:"unScheduleAutoCommit",value:function(){this.clearTimeout("commitAsync")}},{key:"commitAsync",value:(s=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPerformingCommit){e.next=2;break}return e.abrupt("return",this.ongoing);case 2:return this.trigger("beforeCommit"),e.abrupt("return",this.ongoing=this.doCommitAsync());case 4:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"doCommitAsync",value:(l=f(L().mark((function e(){var t,n,r,i,a,o,l,s,u,c,d,h,f,v;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this).$invalidated.size||t.$leaving.size||t.hasLoadedDataToCommit||t.isInitialCommit){e.next=4;break}return t.trigger("commitFinalized"),e.abrupt("return");case 4:return t.$leaving.clear(),t.isPerformingCommit=!0,e.next=8,px(0);case 8:if(t.isDestroyed){e.next=30;break}t.unScheduleAutoCommit(),n=D(t.$invalidated);try{for(n.s();!(r=n.n()).done;)r.value.calculateInvalidated()}catch(e){n.e(e)}finally{n.f()}if(i=t.isInitialCommit,a=t.silenceInitialCommit,o=i&&a,t.assignmentStore.onCommitAsync(),t.dependencyStore.onCommitAsync(),t.isInitialCommitPerformed=!0,t.hasLoadedDataToCommit=!1,t.isPerformingCommit=!1,(l=[t.assignmentStore,t.dependencyStore,t.eventStore,t.resourceStore,t.calendarManagerStore]).forEach((function(e){var t,n;null===(t=e.suspendAutoCommit)||void 0===t||t.call(e),null===(n=e.suspendSortOnUpdate)||void 0===n||n.call(e)})),t.isWritingData=!0,t.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),o){s=D(t.$invalidated);try{for(s.s();!(u=s.n()).done;)u.value.finalizeInvalidated(!0)}catch(e){s.e(e)}finally{s.f()}}else{c=D(t.$invalidated);try{for(c.s();!(d=c.n()).done;)(h=d.value).beginBatch(!0),h.finalizeInvalidated()}catch(e){c.e(e)}finally{c.f()}f=D(t.$invalidated);try{for(f.s();!(v=f.n()).done;)v.value.endBatch(!1,!0)}catch(e){f.e(e)}finally{f.f()}}return t.isWritingData=!1,t.$invalidated.clear(),t.trigger("dataReady"),l.forEach((function(e){var t,n;null===(t=e.resumeAutoCommit)||void 0===t||t.call(e),null===(n=e.resumeSortOnUpdate)||void 0===n||n.call(e)})),t.trigger("commitFinalized"),e.abrupt("return",!0);case 30:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"propagateAsync",value:(a=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.commitAsync());case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"invalidate",value:function(e){this.$invalidated.add(e),this.bufferedCommitAsync()}},{key:"isValidDependency",value:(r=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"getStm",value:function(){return this.stm}},{key:"stm",get:function(){return this.$stm},set:function(e){var t,n=this;(e=this.$stm=new pf(Be.assign({disabled:!0},e))).ion({restoringStop:(t=f(L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.disable(),t.next=3,n.commitAsync();case 3:n.isDestroyed||(e.enable(),n.trigger("stateRestoringDone"));case 4:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})})}},{key:"isEngineReady",value:function(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}],[{key:"fields",get:function(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"}]}},{key:"configurable",get:function(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:nx,assignmentModelClass:fx,resourceModelClass:rS,dependencyModelClass:Sx,calendarModelClass:LE,eventStoreClass:ox,assignmentStoreClass:bx,resourceStoreClass:sS,dependencyStoreClass:Mx,calendarManagerStoreClass:PE,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}}]);var r,a,l,s,u,c,d,h,v,p}(e);return n.$name="SchedulerCoreProjectMixin",n.applyConfigs=!0,n}))),zE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];B(t,"construct",this,3)(n),Ne.isTestEnv&&(r.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}},{key:"createModelPersistencyManager",value:function(){return new Jx({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}},{key:"doDestroy",value:function(){this.modelPersistencyManager.destroy(),B(t,"doDestroy",this,3)([])}},{key:"taskStore",get:function(){return this.eventStore}}],[{key:"defaultConfig",get:function(){return{eventModelClass:rx,dependencyModelClass:xx,resourceModelClass:iS,assignmentModelClass:vx,eventStoreClass:lx,dependencyStoreClass:Fx,resourceStoreClass:uS,assignmentStoreClass:Cx}}}])}(function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);if(n){for(var r=0,i=["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"];r<i.length;r++){var a=i[r],o=this[a];if(o){o.count&&(n[o.id+"Data"]=o.getInlineData(e));var l=o.getCurrentConfig(e);l&&Object.keys(l).length>0?1===Object.keys(l).length&&l.data?delete n[a]:n[a]=Object.assign(n[a]||{},l):n[a]&&0===Object.keys(n[a]).length&&delete n[a]}}return this.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}}])}(Zx(NE)));S(zE,"$name","ProjectModel"),zE.applyConfigs=!0,zE.initClass(),zE._$name="ProjectModel";var jE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildProject",value:function(){return new this.projectClass(this.buildProjectConfig())}},{key:"buildProjectConfig",value:function(){return Be.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}},{key:"project",get:function(){return this._project},set:function(e){var t=this;e!==t._project&&(t.detachListeners("beforeDataReady"),t.detachListeners("afterDataReady"),t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:function(){return t.suspendChangeTracking()},prio:100,thisObj:t}),e.ion({name:"afterDataReady",dataReady:function(){return t.resumeChangeTracking()},prio:-100,thisObj:t})),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}),t.resourceTimeRangeStore||(t.resourceTimeRangeStore={}))}},{key:"timeRangeStore",get:function(){var e;return null===(e=this._timeRangeStore)||void 0===e?void 0:e.store},set:function(e){var t;this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}},{key:"resourceTimeRangeStore",get:function(){var e;return null===(e=this._resourceTimeRangeStore)||void 0===e?void 0:e.store},set:function(e){this.setFeaturedStore("_resourceTimeRangeStore",e,this.resourceTimeRangeStoreClass)}},{key:"resourceStore",get:function(){var e;return null===(e=this._resourceStore)||void 0===e?void 0:e.store},set:function(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}},{key:"eventStore",get:function(){var e;return null===(e=this._eventStore)||void 0===e?void 0:e.store},set:function(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}},{key:"assignmentStore",get:function(){var e;return null===(e=this._assignmentStore)||void 0===e?void 0:e.store},set:function(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}},{key:"dependencyStore",get:function(){var e;return null===(e=this._dependencyStore)||void 0===e?void 0:e.store},set:function(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}},{key:"setFeaturedStore",value:function(e,t,n){var r,i,a=this,o=null===(r=a[e])||void 0===r?void 0:r.store;o!==t&&(t=Ff.getStore(t,(null===(i=t)||void 0===i?void 0:i.storeClass)||n),o&&a.removeStore(o),a[e]=t&&{store:t}||null,a.addPrioritizedStore(a[e]));return a[e]}},{key:"getChangesetPackage",value:function(){var e,n=this,r=B(t,"getChangesetPackage",this,3)([]);return r&&(n.eventStore.usesSingleAssignment||null!==(e=n.eventStore.modelClass.fieldMap)&&void 0!==e&&null!==(e=e.resourceIds)&&void 0!==e&&e.persist)&&(delete r[n.assignmentStore.id],!n.forceSync&&!n.crudStores.some((function(e){return r[e.storeId]})))?null:r}},{key:"crudLoadValidationMandatoryStores",get:function(){return[this._eventStore.storeId,this._resourceStore.storeId]}}],[{key:"defaultConfig",get:function(){return{projectClass:zE,resourceStoreClass:uS,eventStoreClass:lx,assignmentStoreClass:Cx,dependencyStoreClass:Fx,resourceTimeRangeStoreClass:Gx,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null,resourceTimeRangeStore:{}}}}])}(Wx.mixin(Nx,Bx,Vx,jx));S(jE,"$name","CrudManager"),jE._$name="CrudManager";var WE=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],$E=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"],UE=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"preProcessCurrentConfigs",value:function(e){for(var n=0,r=$E;n<r.length;n++){delete e[r[n]]}B(t,"preProcessCurrentConfigs",this,3)([e])}},{key:"getCurrentConfig",value:function(e){var n,r,i=null===(n=(r=this.project).getCurrentConfig)||void 0===n?void 0:n.call(r,e),a=B(t,"getCurrentConfig",this,3)([e]);if(i){a.project=i;var o=a.crudManager;if(o)for(var l=0,s=WE;l<s.length;l++){var u=s[l];o[u]&&(i[u]=o[u])}0===Object.keys(i).length&&delete a.project}return delete a.data,delete a.store,delete a.eventStore,delete a.resourceStore,delete a.crudManager,a}},{key:"widgetClass",get:function(){}}])}(e),S(t,"$name","CurrentConfig"),t},GE=function(e){return!e||Array.isArray(e)?e:[e]},YE=function(e,t,n){return e&&!0!==e[t]?e[t]:n},qE=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dateBounds",get:function(){return[this.date]}},{key:"description",get:function(){var e=this,t=e.descriptionRenderer;return t?e.callback(t,e,[e]):e.formattedDescription}},{key:"formattedDescription",get:function(){var e;if(1===(null===(e=this.range)||void 0===e?void 0:e.magnitude)&&"day"!==this.range.unit)return this.rangeDescription;var t,n=this,r=n.dateBounds,i=n.dateFormat,a=null!==(t=n.descriptionFormat)&&void 0!==t?t:GE(n.defaultDescriptionFormat),o=YE(a,0,i),l=r.length>1&&(null==a?void 0:a.length)>1&&Pl.format(r[0],o)!==Pl.format(r[1],o),s=Pl.format(r[0],o);return l&&(s=Pl.formatRange(r,YE(a,1,"S".concat(i).concat(n.dateSeparator,"E").concat(i)))),s}},{key:"rangeDescription",get:function(){var e,t=this,n=t.date,r=t.startDate,i=t.endDate,a=t.range,o=t.month||(t.month=new Cy({date:n}));switch(a.unit){case"day":e=Pl.format(n,"L");break;case"week":var l=r.getMonth()===i.getMonth()?Pl.format(r,"MMMM"):"".concat(Pl.format(r,"MMM")," - ").concat(Pl.format(i,"MMM")),s=o.getWeekNumber(r);e="".concat(t.L("L{Object.Week}")," ").concat(s[1],", ").concat(l," ").concat(s[0]);break;case"month":e=Pl.format(n,"MMMM, YYYY");break;case"year":e=Pl.format(n,"YYYY");break;case"decade":e="".concat(Pl.format(r,"DC"))}return e}},{key:"changeDescriptionFormat",value:function(e){return GE(e)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","Describable"),S(t,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),t},KE=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getElementFromAssignmentRecord",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this;if(a.isPainted&&e){var o,l,s,u=a.foregroundCanvas,c=null===(o=u.syncIdMap)||void 0===o?void 0:o[e.id];if(!c){var d,h,f=r&&((null===(d=a.subViews)||void 0===d?void 0:d[0])||a.splitFrom);if(f&&(c=f.getElementFromAssignmentRecord(e,!0,n)),!c&&null!==(h=e.resource)&&void 0!==h&&h.hasLinks){var v,g=D(e.resource.$links);try{for(g.s();!(v=g.n()).done;){var m,p,y=v.value;if(c=null===(m=u.syncIdMap)||void 0===m?void 0:m["".concat(e.id,"_").concat(y.id)])break;if(n&&(c=null===(p=u.releasedIdMap)||void 0===p?void 0:p["".concat(e.id,"_").concat(y.id)]))break}}catch(e){g.e(e)}finally{g.f()}}}if(!c&&n)c=null===(s=u.releasedIdMap)||void 0===s?void 0:s[e.id];return t?c:null===(l=c)||void 0===l||null===(l=l.syncIdMap)||void 0===l?void 0:l.event}return null}},{key:"getElementFromEventRecord",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:null===(t=e.resources)||void 0===t?void 0:t[0],r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=arguments.length>3&&arguments[3]!==i&&arguments[3];if(e.isResourceTimeRange){var o,l=null===(o=this.foregroundCanvas.syncIdMap)||void 0===o?void 0:o[e.domId];return r?l:null==l?void 0:l.syncIdMap.event}var s=this.assignmentStore.getAssignmentForEventAndResource(e,n);return this.getElementFromAssignmentRecord(s,r,a)}},{key:"getElementsFromEventRecord",value:function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=arguments.length>3&&arguments[3]!==i&&arguments[3];return t?[this.getElementFromEventRecord(e,t,r,a)]:e.resources.reduce((function(t,i){var o=n.getElementFromEventRecord(e,i,r,a);return o&&t.push(o),t}),[])}},{key:"resolveResourceRecord",value:function(e,t){var n,r=null===(n=(e instanceof Event?e.target:e).dataset)||void 0===n?void 0:n.resourceId,i=r&&this.resourceStore.getById(r)||this.currentOrientation.resolveRowRecord(e,t);return null!=i&&i.isSpecialRow?null:i}},{key:"resolveRowRecord",value:function(e){return this.resolveResourceRecord(e)}},{key:"resolveEventRecord",value:function(e){var t;e instanceof Event&&(e=e.target);var n=null===(t=e)||void 0===t?void 0:t.closest(this.eventSelector);if(n){if("eventId"in n.dataset)return this.eventStore.getById(n.dataset.eventId);if("assignmentId"in n.dataset)return this.assignmentStore.getById(n.dataset.assignmentId).event}return null}},{key:"resolveTimeSpanRecord",value:function(e){return this.resolveEventRecord(e)}},{key:"resolveAssignmentRecord",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=e.closest(t?"[data-assignment-id][data-event-id]":this.eventSelector),r=n&&this.assignmentStore.getById(n.dataset.assignmentId),a=n&&this.eventStore.getById(n.dataset.eventId);return this.assignmentStore.getOccurrence(r,a)}},{key:"isRowVisible",value:function(e){return this.store.indexOf(e)>=0}},{key:"widgetClass",get:function(){}},{key:"isEventElement",value:function(e){var t=null==e?void 0:e.className;return Boolean(null==t?void 0:t[this.eventCls+"-wrap"])}}])}(e||Mn),S(t,"$name","SchedulerDom"),t},XE=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getTimeSpanMouseEventParams",value:function(e,t){var n=this.resolveEventRecord(e);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}},{key:"getScheduleMouseEventParams",value:function(e,t){var n=this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id);return n?{resourceRecord:n}:null}},{key:"onElementKeyDown",value:function(e){var n=B(t,"onElementKeyDown",this,3)([e]),r=this;return r.selectedEvents.length&&e.target.closest(".b-sch-event-wrap")&&r.trigger(r.scheduledEventName+"KeyDown",{eventRecords:r.selectedEvents,assignmentRecords:r.selectedAssignments,event:e}),n}},{key:"onElementKeyUp",value:function(e){B(t,"onElementKeyUp",this,3)([e]);var n=this;n.selectedEvents.length&&n.trigger(n.scheduledEventName+"KeyUp",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:e})}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","SchedulerDomEvents"),t},ZE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"clearCache",value:function(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}},{key:"applyLayout",value:function(e,t){return this.nbrOfBandsByResource[t.id]=this.layoutEventsInBands(e,t)}},{key:"layoutEventsInBands",value:function(e,t){throw new Error("Implement in subclass")}}],[{key:"defaultConfig",get:function(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}}])}(Mn);ZE._$name="HorizontalLayout";var JE=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"layoutEventsInBands",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=0;do{for(var a=0,o=e[0];o;)n||(o.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,r,o.eventRecord,o.resourceRecord)),e.splice(a,1),o=e[a=this.findClosestSuccessor(o,e)];r++}while(e.length>0);return r}},{key:"findClosestSuccessor",value:function(e,t){for(var n,r,i,a,o,l=e.endMS,s=e.group,u=0===(null===(n=e.eventRecord)||void 0===n?void 0:n.duration),c=1/0,d=0,h=t.length;d<h;d++){var f;if(i=(a=t[d]).startMS-l,o=a.endMS-a.startMS==0&&!(null!==(f=a.eventRecord)&&void 0!==f&&f.meta.isDragCreating),i>=0&&i<c&&(i>0||!o||!u)){if(this.grouped&&s!==a.group)break;r=d,c=i}}return r}}],[{key:"configurable",get:function(){return{type:"stack"}}}])}(ZE);S(JE,"$name","HorizontalLayoutStack"),JE._$name="HorizontalLayoutStack";var QE=function(e,t,n,r){return n<=e&&e<r||e<=n&&n<t},eR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isSameGroup",value:function(e,t){return!this.grouped||e.group===t.group}},{key:"packEventsInBands",value:function(e,t){for(var n,r,i,a,o=this,l=o.coordProp,s=o.sizeProp,u=0,c=e.length;u<c;u++){if(r=e[u],n=o.findStartSlot(e,r),(i=o.getCluster(e,u)).length>1){for(r[l]=n.start,r[s]=n.end-n.start,a=1;a<i.length-1&&i[a+1].start-r.start==0;)a++;var d=o.findStartSlot(e,i[a]);d&&d.start<.8&&(i.length=a)}var h=i.length,f=(n.end-n.start)/h;for(a=0;a<h;a++)t(i[a],a,n,f);u+=h-1}return 1}},{key:"findStartSlot",value:function(e,t){var n,r=this.inBandSizeProp,i=this.inBandCoordProp,a=this.coordProp,o=this.sizeProp,l=this.getPriorOverlappingEvents(e,t);if(0===l.length)return{start:0,end:1};for(n=0;n<l.length;n++){var s=l[n],u=i in s?i:a,c=r in s?r:o;if(0===n&&s[u]>0)return{start:0,end:s[u]};if(s[u]+s[c]<(n<l.length-1?l[n+1][u]:1))return{start:s[u]+s[c],end:n<l.length-1?l[n+1][u]:1}}return!1}},{key:"getPriorOverlappingEvents",value:function(e,t){for(var n=t.startMS,r=t.endMS,i=[],a=0,o=e.indexOf(t);a<o;a++){var l=e[a];this.isSameGroup(l,t)&&QE(n,r,l.startMS,l.endMS)&&i.push(l)}return i.sort(this.sortOverlappers.bind(this)),i}},{key:"sortOverlappers",value:function(e,t){var n=this.coordProp;return e[n]-t[n]}},{key:"getCluster",value:function(e,t){var n=e[t],r=[n];if(t>=e.length-1)return r;for(var i=n.startMS,a=n.endMS,o=t+1,l=e.length;o<l;o++){var s=e[o];if(!this.isSameGroup(s,n)||!QE(i,a,s.startMS,s.endMS))break;r.push(s),i=Math.max(i,s.startMS),a=Math.min(s.endMS,a)}return r}}])}(e||Mn),S(t,"$name","PackMixin"),S(t,"configurable",{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}),t},tR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"layoutEventsInBands",value:function(e){var t=this,n=this.packEventsInBands(e,(function(e,t,n,r){e.height=r,e.top=n.start+t*r}));return e.forEach((function(e){Object.assign(e,t.bandIndexToPxConvertFn.call(t.bandIndexToPxConvertThisObj||t,e.top,e.height,e.eventRecord,e.resourceRecord))})),n}}])}(ZE.mixin(eR));S(tR,"$name","HorizontalLayoutPack"),S(tR,"configurable",{type:"pack"}),tR._$name="HorizontalLayoutPack";var nR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"resourceColumns",get:function(){var e;return(null===(e=this.timeAxisColumn)||void 0===e?void 0:e.resourceColumns)||this._resourceColumns}},{key:"resourceColumnWidth",get:function(){var e;return(null===(e=this.resourceColumns)||void 0===e?void 0:e.columnWidth)||null}},{key:"getResourceMarginObject",value:function(e){if(null!=e&&e.resourceMargin){var t,n=null!==(t=null==e?void 0:e.resourceMargin)&&void 0!==t?t:this.resourceMargin;return"number"==typeof n?{start:n,end:n,total:2*n}:(n.total=n.start+n.end,n)}return this.resourceMarginObject}},{key:"getBarMargin",value:function(e){var t;return null!==(t=null==e?void 0:e.barMargin)&&void 0!==t?t:this.barMargin}},{key:"getResourceHeight",value:function(e){var t;return null!==(t=e.rowHeight)&&void 0!==t?t:this.isHorizontal?this.rowHeight:this.getResourceWidth(e)}},{key:"getResourceWidth",value:function(e){var t;return null!==(t=e.instanceMeta(this).columnWidth)&&void 0!==t?t:this.resourceColumnWidth}},{key:"getAppliedResourceHeight",value:function(e){var t,n=this.getRowById(e);return null!==(t=null==n?void 0:n.maxRequestedHeight)&&void 0!==t?t:this.getResourceHeight(e)}},{key:"getResourceLayoutSettings",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:null,n=this.getResourceMarginObject(e,t),r=this.getAppliedResourceHeight(e,t);return{barMargin:this.getBarMargin(e,t),contentHeight:Math.max(r-n.total,1),rowHeight:r,resourceMarginObject:n}}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","SchedulerResourceRendering"),S(t,"configurable",{resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"}),t},rR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeEventLayout",value:function(e){return!this.isConfiguring||"vertical"!==this.mode||"stack"!==e&&"stack"!==e.type||(e="pack"),this.internalEventLayout=e,this.internalEventLayout.type}},{key:"changeInternalEventLayout",value:function(e){return this.getEventLayout(e)}},{key:"updateInternalEventLayout",value:function(e,t){var n=this;t&&n.element.classList.remove("b-eventlayout-".concat(t.type)),n.element.classList.add("b-eventlayout-".concat(e.type)),"layoutFn"===e.type&&n.isVertical&&(n.resourceColumns.fitWidth=n.resourceColumns.fillWidth=!1),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}},{key:"updateOverlappingEventSorter",value:function(e){this.isConfiguring||this.refreshWithTransition()}},{key:"updateEventReleaseThreshold",value:function(){this.isConfiguring||this.refresh()}},{key:"getEventLayout",value:function(e){var t;return null!==(t=e)&&void 0!==t&&t.isModel&&(e=e.eventLayout||this.internalEventLayout),"string"==typeof e&&(e={type:e}),e}},{key:"getEventLayoutHandler",value:function(e){var t=this;if(!t.isHorizontal)return null;var n=t.timeAxisViewModel,r=t.horizontal,i=e.type;switch(t.layouts||(t.layouts={}),i){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass(Be.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass(Be.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalPack;default:return null}}},{key:"getEventsToRender",value:function(e,t){return t}},{key:"repaintEventsForResource",value:function(e){this.currentOrientation.repaintEventsForResource(e)}},{key:"repaintEvent",value:function(e){var t=this;this.eventStore.getResourcesForEvent(e).forEach((function(e){return t.repaintEventsForResource(e)}))}},{key:"getEventStyle",value:function(e,t){return e.eventStyle||t.eventStyle||this.eventStyle}},{key:"getEventColor",value:function(e,t){var n,r;return e.eventColor||(null===(n=e.event)||void 0===n?void 0:n.eventColor)||(null===(r=e.parent)||void 0===r?void 0:r.eventColor)||t.eventColor||this.eventColor}},{key:"generateRenderData",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:{viewport:!0},a=this,o=a.currentOrientation.getTimeSpanRenderData(e,t,n),l=e.isEvent,s=a.features.eventResize,u=!e.meta.isDragCreating&&e.isMilestone,c=l&&e.assignments.find((function(e){return e.resourceId===t.$originalId})),d={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(o){var h;Object.assign(o,{isWrap:!0,wrapperStyle:"",tabIndex:"0",eventGeneration:e.generation,resourceGeneration:t.generation,assignmentGeneration:null==c?void 0:c.generation});var f=e.isResizable;s&&f&&(o.startsOutsideView&&(!0===f?f="end":"start"===f&&(f=!1)),o.endsOutsideView&&(!0===f?f="start":"end"===f&&(f=!1)),f&&(a.isHorizontal?!a.rtl&&!s.leftHandle||a.rtl&&!s.rightHandle?f="start"!==f&&"end":(!a.rtl&&!s.rightHandle||a.rtl&&!s.leftHandle)&&(f="end"!==f&&"start"):s.topHandle?s.bottomHandle||(f="end"!==f&&"start"):f="start"!==f&&"end"));var v=Boolean(e.hasPersistableChanges||(null==c?void 0:c.hasPersistableChanges)),g=S(S(S(S(S(S(S(S(S(S({},t.cls,t.cls),a.generatedIdCls,!e.isOccurrence&&e.hasGeneratedId),a.dirtyCls,v),a.committingCls,e.isCommitting),a.endsOutsideViewCls,o.endsOutsideView),a.startsOutsideViewCls,o.startsOutsideView),"b-clipped-start",o.clippedStart),"b-clipped-end",o.clippedEnd),"b-iscreating",e.isCreating),"b-rtl",a.rtl),m=S(S(S(S({},"".concat(a.eventCls,"-parent"),t.isParent),"b-readonly",e.readOnly||(null==c?void 0:c.readOnly)),"b-linked-resource",t.isLinked),"b-original-resource",t.hasLinks),p=e.isResourceTimeRange?new Ct:e.internalCls.clone(),y=e.isResourceTimeRange?e.internalCls.clone():new Ct;if(l){var k=c&&a.isAssignmentSelected(c);Be.assign(g,S(S(S(S(S(S(S(S(S(S({},a.eventCls,1),"b-milestone",u),"b-sch-event-narrow",!u&&o.width<a.narrowEventWidth),a.fixedEventCls,!1===e.isDraggable),"b-sch-event-resizable-".concat(f),Boolean(s&&!e.readOnly)),a.eventSelectedCls,k),a.eventAssignHighlightCls,a.eventAssignHighlightCls&&!k&&a.isEventSelected(e)),"b-recurring",e.isRecurring),"b-occurrence",e.isOccurrence),"b-inactive",e.inactive)),o.eventId=e.id;var b=a.getEventStyle(e,t),C=a.getEventColor(e,t),w=a.isFirstRender&&a.useInitialAnimation&&!0!==r.bryntum.noAnimations;if(Be.assign(m,S(S(S({},"".concat(a.eventCls,"-wrap"),1),"b-milestone-wrap",u),a.navigator.focusCls,e.assignments.some((function(e){return e===a.activeAssignment})))),w){var D=(o.row?o.row.index:(o.top-a.scrollTop)/a.tickSize)/20*1e3;o.wrapperStyle="animation-delay: ".concat(D,"ms;"),a.maxDelay=Math.max(a.maxDelay||0,D),a.initialAnimationDetacher||(a.initialAnimationDetacher=fr.on({element:a.foregroundCanvas,delegate:a.eventSelector,once:!0,animationend:function(){return a.setTimeout({fn:"stopInitialAnimation",delay:a.maxDelay,cancelOutstanding:!0})},expires:{alt:"stopInitialAnimation",delay:a.initialAnimationDuration+a.maxDelay},thisObj:a}))}o.eventColor=C,o.eventStyle=b,o.assignmentRecord=o.assignment=c}if(o.wrapperCls=Be.assign(y,m),o.cls=Be.assign(p,g),o.iconCls=new Ct(e.getValue(a.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(o.style="",o.wrapperStyle+=e.style||""):o.style=e.style||"",o.resource=o.resourceRecord=t,o.resourceId=o.rowId,l){var x,E,R,T=null,M=null;if(a.eventRenderer){var F=a.eventRenderer.call(a.eventRendererThisObj||a,{eventRecord:e,resourceRecord:t,assignmentRecord:o.assignmentRecord,scheduler:a,renderData:o});o.ariaLabel&&(o.ariaLabelFromEventRenderer=!0),"string"==typeof o.cls&&(o.cls=new Ct(o.cls)),"string"==typeof o.wrapperCls&&(o.wrapperCls=new Ct(o.wrapperCls)),"string"==typeof o.iconCls&&(o.iconCls=new Ct(o.iconCls)),E=F}else a.eventBarTextField&&(E=Le.encodeHtml(e.getValue(a.eventBarTextField)||""));if(d.children=[],!u||"default"!==a.milestoneLayoutMode&&"always-outside"!==a.milestoneTextPosition||null==E||""===E||d.children.unshift(M={tag:"label",children:[],dataset:{isMilestone:!0}}),null!==(x=o.iconCls)&&void 0!==x&&x.length&&d.children.unshift({tag:"i",className:o.iconCls}),Array.isArray(E))(R=(M||d).children).push.apply(R,z(E));else Le.isHtml(E)?d.children.length?T={tag:"span",class:"b-event-text-wrap",html:E}:(d.children=null,d.html=E):"string"==typeof E||"object"===W(E)?T=E:null!=E&&(T=String(E));null!=T&&((M||d).children.push(T),o.cls.add("b-has-content")),(null!=d.html||d.children.length)&&o.children.push(d),o.cls.toggle("b-highlighted",Boolean(null==c?void 0:c.instanceMeta(a).isHighlighted))}var A=o.eventStyle,I=o.eventColor,L=o.wrapperCls;if(L["b-sch-style-".concat(A||"none")]=1,li.isNamedColor(I))L["b-sch-color-".concat(I)]=I;else if(I){var O="".concat(A?"color":"background-color",":").concat(I,";");o.style=O+o.style,L["b-sch-custom-color"]=1,o._customColorStyle=O}else L["b-sch-color-none"]=1;if(o.style&&u&&d&&(d.style=o.style,delete o.style),o.cls["b-sch-event-withicon"]=null===(h=o.iconCls)||void 0===h?void 0:h.length,o.eventContent=d,o.wrapperChildren=[],!o.ariaLabelFromEventRenderer){var P=Pl.format(e.startDate,this.displayDateFormat);o.ariaLabel=a.L("L{SchedulerBase.eventAriaLabel}")(e,P)}a.onEventDataGenerated(o)}return o}},{key:"onEventDataGenerated",value:function(e){}},{key:"changeUseInitialAnimation",value:function(e){return!0===e?"fade-in":e}},{key:"updateUseInitialAnimation",value:function(e,t){var n=this.element.classList;t&&n.remove("b-initial-".concat(t)),e&&(n.add("b-initial-".concat(e)),ne.isFirefox&&n.add("b-prevent-event-transitions"))}},{key:"restartInitialAnimation",value:function(e){var t,n=this;null===(t=n.initialAnimationDetacher)||void 0===t||t.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=e,n.isFirstRender=!0,n.refresh()}},{key:"stopInitialAnimation",value:function(){var e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,ne.isFirefox&&e.setTimeout((function(){return e.element.classList.remove("b-prevent-event-transitions")}),100)}},{key:"getMilestoneLabelWidth",value:function(e,t){var n=this,r=n.milestoneLayoutMode,i=n.getResourceLayoutSettings(t).contentHeight;if("measure"===r){var a=Le.encodeHtml(e.name),o=n.getEventColor(e,t),l=n.getEventStyle(e,t),s=n.milestoneMeasureElement||(n.milestoneMeasureElement=li.createElement({className:S(S({"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1},"b-sch-color-".concat(o),o),"b-sch-style-".concat(l),l),children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:n.foregroundCanvas}));if(s.retainElement=!0,s.style.fontSize="".concat(i,"px"),"always-outside"===n.milestoneTextPosition){var u=s.firstElementChild.firstElementChild.firstElementChild;u.innerHTML=a;var c=pt.from(u,u.parentElement);return c.left+c.width+2}return s.firstElementChild.firstElementChild.innerHTML="<label></label>".concat(a),s.firstElementChild.offsetWidth}return"estimate"===r?e.name.length*n.milestoneCharWidth+("always-outside"===n.milestoneTextPosition?i:0):"data"===r?e.milestoneWidth+("always-outside"===n.milestoneTextPosition?i:0):0}},{key:"updateMilestoneLayoutMode",value:function(e){var t=this,n="always-outside"===t.milestoneTextPosition;t.element.classList.toggle("b-sch-layout-milestones","default"!==e&&!n),t.element.classList.toggle("b-sch-layout-milestone-labels","default"!==e&&n),t.isConfiguring||t.refreshWithTransition()}},{key:"updateMilestoneTextPosition",value:function(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside","inside"===e),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}},{key:"updateMilestoneAlign",value:function(){this.isConfiguring||this.refreshWithTransition()}},{key:"updateMilestoneCharWidth",value:function(){this.isConfiguring||this.refreshWithTransition()}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",horizontalLayoutPackClass:tR,horizontalLayoutStackClass:JE,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,eventReleaseThreshold:null,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move",testConfig:{useInitialAnimation:!1}}}}])}(nR(e||Mn)),S(t,"$name","SchedulerEventRendering"),t},iR=["assignmentStore","dependencyStore","eventStore","resourceStore"],aR=function(e){var t,n;return n=new WeakMap,t=function(e){function t(){var e;m(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return y(e=g(this,t,[].concat(i)),n,void 0),e}return R(t,e),w(t,[{key:"startConfigure",value:function(e){this.getConfig("project"),B(t,"startConfigure",this,3)([e])}},{key:"changeProject",value:function(e,t){var n=this,r=n.constructor.projectDataNames;if(n.projectCallbacks=new o,e){if(n.buildingProjectConfig=!0,!e.isModel){if(n.isConfiguring){n._project=e,n.crudManager&&this.updateStoresFromCrudManager(),n.getConfig("projectStores");var i,a=D(r);try{for(a.s();!(i=a.n()).done;){var l=i.value;n.getConfig(l)}}catch(e){a.e(e)}finally{a.f()}}var s=e.eventStore,u=n._sharedProject;if(null==s||!s.autoLoad||s.isEventStoreMixin||s.count||s.lazyLoad||(s.autoLoad=!1,n.delayAutoLoad=!0),u&&iR.some((function(t){return e[t]&&e[t]!==u[t]}))){for(var c=0,d=iR;c<d.length;c++){var h=d[c];e[h]&&e[h]===u[h]&&(e[h]=e[h].chain())}u=null}e=u||new n.projectModelClass(e),delete n._project}n.buildingProjectConfig=!1}return e}},{key:"updateStoresFromCrudManager",value:function(){var e,t=this.crudManager,n=t.isCrudManager,r=D(this.constructor.projectStoreNames);try{for(r.s();!(e=r.n()).done;){var i=e.value;t[i]&&(this[i]=t[i],n||delete t[i])}}catch(e){r.e(e)}finally{r.f()}}},{key:"updateProject",value:function(e,t){var n=this,r=n.projectListeners,i=n.crudManager;if(n.detachListeners("projectConsumer"),n.detachListeners("projectDestroy"),delete n._crudManager,e){var a;r.thisObj=n,e.ion(r),e.isCrudManager?n.crudManager=e:i&&(i.project=e,n.crudManager=i),n.projectSubscribers.forEach((function(n){n.detachFromProject(t),n.attachToProject(e)}));var o,l=D(n.constructor.projectStoreNames);try{for(l.s();!(o=l.n()).done;){var s=o.value;n[s]=e[s]}}catch(e){l.e(e)}finally{l.f()}n.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load()),null===(a=e.stm)||void 0===a||a.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:n}),e.ion({name:"projectDestroy",beforeDestroy:"onProjectBeforeDestroy",thisObj:n})}n.trigger("projectChange",{project:e})}},{key:"changeCrudManager",value:function(e){if(!this.buildingProjectConfig)return B(t,"changeCrudManager",this,3)([e]);this._crudManager=e.isCrudManager?e:Object.assign({},e)}},{key:"updateCrudManager",value:function(e){!this.isConfiguring&&e&&this.updateStoresFromCrudManager()}},{key:"onProjectBeforeDestroy",value:function(e){var t=new e.source.constructor;this.project=t}},{key:"onProjectDataReady",value:function(){var e=this;e.whenVisible((function(){e.projectCallbacks.size&&(e.projectCallbacks.forEach((function(e){return e()})),e.projectCallbacks.clear())}),null,null,"onProjectDataReady")}},{key:"onProjectRestoringStart",value:function(e){var t=e.stm.rawQueue;t.length&&t[t.length-1].length>1&&(k(n,this,!0),this.suspendRefresh())}},{key:"onProjectRestoringStop",value:function(){p(n,this)&&(k(n,this,!1),this.resumeRefresh(!0))}},{key:"onBeforeTimeZoneChange",value:function(){}},{key:"onTimeZoneChange",value:function(e){var t=e.timeZone,n=e.oldTimeZone,r=this;if(r.startDate&&r.timeAxis.timeZone!==t){var i=null!=n?yp.fromTimeZone(r.startDate,n):r.startDate;r.startDate=null!=t?yp.toTimeZone(i,t):i,r.timeAxis.timeZone=t}}},{key:"onStartApplyChangeset",value:function(){this.suspendRefresh()}},{key:"onEndApplyChangeset",value:function(){this.resumeRefresh(!0)}},{key:"whenProjectReady",value:function(e){this.isEngineReady?e():this.projectCallbacks.add(e)}},{key:"isEngineReady",get:function(){var e,t;return Boolean(null===(e=(t=this.project).isEngineReady)||void 0===e?void 0:e.call(t))}},{key:"doDestroy",value:function(){B(t,"doDestroy",this,3)([]),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}},{key:"projectStores",get:function(){var e=this;return this.constructor.projectStoreNames.map((function(t){return e[t]}))}},{key:"onProjectStoreStartApplyChangeset",value:function(){this.suspendRefresh()}},{key:"onProjectStoreEndApplyChangeset",value:function(){this.resumeRefresh(!0)}},{key:"relayProjectDataChange",value:function(e){if(!e.isExpand&&!e.isCollapse||e.records[0].fieldMap.expanded.persist)return this.trigger("dataChange",F(F({project:e.source},e),{},{source:this}))}},{key:"widgetClass",get:function(){}}],[{key:"declarable",get:function(){return["projectStores"]}},{key:"configurable",get:function(){return{projectModelClass:zE,project:{},destroyStores:null,projectSubscribers:[]}}},{key:"projectStoreNames",get:function(){return Object.keys(this.projectStores)}},{key:"projectDataNames",get:function(){var e=this;return this.projectStoreNames.reduce((function(t,n){var r=e.projectStores[n].dataName;return r&&t.push(r),t}),[])}},{key:"setupProjectStores",value:function(e,t){var n=this,r=e.projectStores;if(r){var i,a={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset",startApplyingRevision:"onStartApplyChangeset",stopApplyingRevision:"onEndApplyChangeset"},o={projectListeners:a},l=function(e){var l=r[e].dataName;o[e]=o[l]=null,l&&(Object.defineProperty(t.class.prototype,l,{configurable:!0,get:function(){var t;return null===(t=this.project[e])||void 0===t?void 0:t.records}}),n.createDataUpdater(e,l,i,t)),n.createStoreDescriptor(t,e,r[e],a),i=l};for(var s in r)l(s);this.setupConfigs(t,o)}}},{key:"createDataUpdater",value:function(e,t,n,r){r.class.prototype["update".concat(Le.capitalize(t))]=function(r){var i=this.project;n&&this.getConfig(n),this.buildingProjectConfig?i["".concat(t,"Data")]=r:i[e].data=r}}},{key:"createStoreDescriptor",value:function(e,t,n,r){var i=n.listeners,a=e.class.prototype,o=Le.capitalize(t);r["".concat(t,"Change")]=function(e){var n=e.store;this[t]=n},a["change".concat(o)]=function(e,n){var r,a=this,l=a.project,s=null===(r=e)||void 0===r?void 0:r.project;return a.buildingProjectConfig?(null!=s&&s.isProjectModel&&(a._sharedProject=s),void(l[t]=e)):(a.initializingProject||l[t]!==e&&(l["set".concat(o)](e),e=l[t]),e!==n&&(i&&(i.thisObj=a,i.name="".concat(t,"Listeners"),i.startApplyChangeset="onProjectStoreStartApplyChangeset",i.endApplyChangeset="onProjectStoreEndApplyChangeset",a.detachListeners(i.name),e.ion(i)),a["_".concat(t)]=e,a.projectSubscribers.forEach((function(t){var n;null===(n=t["attachTo".concat(o)])||void 0===n||n.call(t,e)})),a["_".concat(t)]=null),e)}}}])}(e||Mn),S(t,"$name","ProjectConsumer"),t},oR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateProject",value:function(e,n){B(t,"updateProject",this,3)([e,n]),this.detachListeners("schedulerStores"),e.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this}),this.bindEventStoreForEarlyPositioning(e.eventStore)}},{key:"onProjectRefresh",value:function(e){var t=e.isInitialCommit,n=this;n.isVisible?(t&&n.isVertical&&(n.refreshAfterProjectRefresh=!1,n.refreshWithTransition()),n.refreshAfterProjectRefresh&&(n.refreshWithTransition(!1,!t),n.refreshAfterProjectRefresh=!1),n.navigateToAfterRefresh&&(n.navigateTo(n.navigateToAfterRefresh,{scrollIntoView:!1}),n.navigateToAfterRefresh=null)):n.whenVisible("refresh",n,[!0])}},{key:"changeCrudManager",value:function(e){var t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}},{key:"store",get:function(){return!this._store&&this.isVertical&&(this._store=new Ff({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}],filter:function(){return!1}})),B(t,"store",this,1)},set:function(e){V(t,"store",e,this,1,1)}},{key:"refreshFromRowOnStoreAdd",value:function(e,n){var r=this,i=n.isExpand,a=n.records,o=arguments,l=this;l.runWithTransition((function(){l.currentOrientation.suspended=!i&&!a.some((function(e){return e.isLinked})),l.element.classList.add("b-no-transitions"),B(t,"refreshFromRowOnStoreAdd",r,3)([e].concat(z(o))),l.element.classList.remove("b-no-transitions"),l.currentOrientation.suspended=!1}),!i)}},{key:"onStoreAdd",value:function(e){B(t,"onStoreAdd",this,3)([e]),this.isPainted&&this.calculateRowHeights(e.records)}},{key:"onStoreUpdateRecord",value:function(e){e.source,e.record;var n=e.changes,r=0;"assigned"in n&&r++,"calendar"in n&&r++,r!==Object.keys(n).length&&B(t,"onStoreUpdateRecord",this,3)(arguments)}},{key:"updateResourceStore",value:function(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}},{key:"usesDisplayStore",get:function(){return this.store!==this.resourceStore}},{key:"onEventIdChange",value:function(e){var t,n;null===(t=(n=this.currentOrientation).onEventStoreIdChange)||void 0===t||t.call(n,e)}},{key:"onEventStoreBatchedUpdate",value:function(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}},{key:"onInternalEventStoreChange",value:function(e){this.isPainted&&this._mode&&!e.isAssign&&!this.assignmentStore.isRemovingAssignment&&(this.isVisible?this.currentOrientation.onEventStoreChange(e):this.whenVisible(this.onInternalEventStoreChange,this,[e]))}},{key:"onEventCommit",value:function(e){var t=this,n=e.changes,r=[].concat(z(n.added),z(n.modified)).map((function(e){return t.eventStore.getResourcesForEvent(e)}));r=Array.prototype.concat.apply([],r),new o(r).forEach((function(e){return t.repaintEventsForResource(e)}))}},{key:"onEventCommitStart",value:function(e){var t=e.changes,n=this.currentOrientation,r=this.committingCls;[].concat(z(t.added),z(t.modified)).forEach((function(e){return e.assignments.forEach((function(e){return n.toggleCls(e,r,!0)}))}))}},{key:"onEventException",value:function(e){var t=this;if("commit"===e.action){var n=this.eventStore.changes;[].concat(z(n.added),z(n.modified),z(n.removed)).forEach((function(e){return t.repaintEvent(e)}))}}},{key:"onAssignmentCommit",value:function(e){var t=e.changes;this.repaintEventsForAssignmentChanges(t)}},{key:"onAssignmentCommitStart",value:function(e){var t=e.changes,n=this.currentOrientation,r=this.committingCls;[].concat(z(t.added),z(t.modified)).forEach((function(e){n.toggleCls(e,r,!0)}))}},{key:"onAssignmentException",value:function(e){"commit"===e.action&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}},{key:"repaintEventsForAssignmentChanges",value:function(e){var t=this,n=[].concat(z(e.added),z(e.modified),z(e.removed)).map((function(e){return e.getResource()}));new o(n).forEach((function(e){return t.repaintEventsForResource(e)}))}},{key:"onAssignmentBeforeRemove",value:function(e){var t=e.records;if(!e.removingAll){var n,r=this,i=r.activeAssignment,a=t.includes(i);if(!r.isConfiguring&&(r.navigateToAfterRefresh||i&&a)){t.includes(r.navigateToAfterRefresh)&&(r.navigateToAfterRefresh=null);var o=r.getElementFromAssignmentRecord(i,!0);if(a&&o){var l=r.timeAxisSubGrid.rectangle().intersect(r._bodyRectangle),s=pt.from(o),u=s.center,c=r.isHorizontal?"y":"x",d=Array.from(r.foregroundCanvas.querySelectorAll(r.navigator.itemSelector)).reduce((function(e,t){if(t!==o){var n=pt.from(t).intersect(l),i=n&&r.resolveAssignmentRecord(t);if(i){var a=n.center,c=u.getDelta(a),d=a.y<u.y?s.y-n.bottom:a.y>u.y?n.y-s.bottom:0,h=a.x<u.x?s.x-n.right:a.x>u.x?n.x-s.right:0;e.push({element:t,assignment:i,center:a,distance:Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),edgeDistance:Math.max(d,h)})}}return e}),[]).sort((function(e,t){var n=e.element,r=e.distance,i=e.center,a=e.edgeDistance,o=t.element,l=t.distance,s=t.center,d=t.edgeDistance;if(n.dataset.resourceId!==o.dataset.resourceId){if(Math.abs(i[c]-u[c])<Math.abs(s[c]-u[c]))return-1;if(Math.abs(i[c]-u[c])>Math.abs(s[c]-u[c]))return 1}return Math.min(a,r)-Math.min(d,l)||s[c]-i[c]}))[0];d&&(n=d.assignment)}n?(r.navigateTo(n,{scrollIntoView:!1}),r.navigateToAfterRefresh=n):r.focusElement.focus({preventScroll:!0})}}}},{key:"timeRanges",get:function(){return this.project.timeRanges},set:function(e){this.project.timeRanges=e}},{key:"resourceTimeRanges",get:function(){return this.project.resourceTimeRanges},set:function(e){this.project.resourceTimeRanges=e}},{key:"onBeforeLoad",value:function(e){var t=e.params;this.applyStartEndParameters(t)}},{key:"getResourcesEventsPerTick",value:function(e,t){var n=this,r=this.timeAxis,i=this.resourceStore,a=[];return(e=e||i.records).forEach((function(e){e.events.forEach((function(i){if(r.isTimeSpanInAxis(i)&&(!t||t.call(n,{resource:e,event:i}))){var o=Math.floor(r.getTickFromDate(i.startDate)),l=Math.ceil(r.getTickFromDate(i.endDate));-1==o&&(o=0),-1===l&&(l=r.ticks.length);do{a[o]?a[o].push(i):a[o]=[i]}while(++o<l)}}))})),a}},{key:"widgetClass",get:function(){}}],[{key:"projectStores",get:function(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}},{key:"configurable",get:function(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!0,crudManagerClass:null,crudManager:null}}}])}(aR(e||Mn)),S(t,"$name","SchedulerStores"),t},lR={block:"nearest",edgeOffset:20},sR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"scrollEventIntoView",value:(a=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:lR;return L().mark((function r(){var i,a;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=t,!((a=e.resources||[e]).length>1)){r.next=3;break}throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");case 3:if(a.length){r.next=6;break}return console.warn("You have asked to scroll to an event which is not assigned to a resource"),r.abrupt("return");case 6:return r.next=8,i.scrollResourceEventIntoView(a[0],e,n);case 8:case"end":return r.stop()}}),r)}))()})),function(e){return a.apply(this,arguments)})},{key:"scrollAssignmentIntoView",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.scrollResourceEventIntoView.apply(this,[e.resource,e.event].concat(n))}},{key:"scrollResourceEventIntoView",value:(r=f((function(e,t){var n=arguments,r=this,a=arguments.length>2&&arguments[2]!==i?arguments[2]:lR;return L().mark((function i(o){var l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x,E,R,T;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=(l=r).store,u=l.timeAxis,c=l.visibleDateRange,d=l.scrollExtensionThreshold,h=u.endDate-u.startDate,f=t.startDate,v=t.endDate,g=t.isScheduled&&f.getTime(),m=t.isScheduled&&v.getTime(),p=t.isScheduled&&f<l.timeAxis.startDate|(v>l.timeAxis.endDate)<<1,!s.includes(e)&&e.$links.length&&(e=e.$links.find((function(e){return s.includes(e)}))),i.next=4,l.waitForReadiness();case 4:if(l.isLockedRows&&l.syncSplits((function(e){return e.scrollResourceEventIntoView.apply(e,z(n))})),y=!1,null==a.edgeOffset&&(a.edgeOffset=20),!p||!1===a.extendTimeAxis){i.next=37;break}if(3!==p){i.next=13;break}return i.next=11,l.setTimeSpan(new Date(g-h/2),new Date(m+h/2));case 11:i.next=37;break;case 13:if(!l.infiniteScroll){i.next=29;break}if(b={start:u.startDate.getTime(),end:u.endDate.getTime()},C=d?new ql(d).milliseconds:h,1===p?b.start-=C:b.end+=C,!(g>=b.start&&m<=b.end)){i.next=24;break}return i.next=21,l.setTimeSpan(new Date(b.start),new Date(b.end),{visibleDate:c.startDate});case 21:y=!0,i.next=27;break;case 24:return w=c.endMS-c.startMS,D=1==(1&p?1:-1)?new Date(m+w):new Date(g-w),i.next=27,l.setTimeSpan(new Date(g-h/2),new Date(g+h/2),{visibleDate:D});case 27:i.next=37;break;case 29:if(S=l.presets.allRecords[l.zoomLevel],x=a.edgeOffset*l.getMilliSecondsPerPixelForZoomLevel(S,!1),!(1&p)){i.next=35;break}return i.next=33,l.setTimeSpan(new Date(g-x),new Date(g-x+h));case 33:i.next=37;break;case 35:return i.next=37,l.setTimeSpan(new Date(m+x-h),new Date(m+x));case 37:if(!l.isDestroyed){i.next=39;break}return i.abrupt("return");case 39:if(!s.tree){i.next=42;break}return i.next=42,null===(E=l.expandTo)||void 0===E?void 0:E.call(l,e);case 42:if(!s.isGrouped){i.next=45;break}return i.next=45,s.expand(s.getGroupHeaderForRecord(e));case 45:if(null===(o=l.features.nestedEvents)||void 0===o||!o.enabled||!t.parent||t.parent.isRoot){i.next=48;break}return i.next=48,l.scrollEventIntoView(t.parent);case 48:if(!(k=l.getElementFromEventRecord(t,e))){i.next=65;break}return li.isFocusable(k)||(k=k.parentNode),R=l.timeAxisSubGrid.scrollable,i.next=54,R.scrollIntoView(k,a);case 54:if(!l.isDestroyed){i.next=56;break}return i.abrupt("return");case 56:if(T=l.getElementFromEventRecord(t,e)){i.next=60;break}return i.next=60,Ge.animationFrame();case 60:if(!l.isDestroyed){i.next=62;break}return i.abrupt("return");case 62:if(!T){i.next=56;break}case 63:i.next=80;break;case 65:if(3!==p||!1!==a.extendTimeAxis){i.next=69;break}console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"),i.next=80;break;case 69:if(t.isOccurrence||!l.eventStore.isFilteredOut(t)){i.next=73;break}console.warn("You have asked to scroll to an event which is not available"),i.next=80;break;case 73:if(!t.isScheduled){i.next=78;break}return i.next=76,l.scrollUnrenderedEventIntoView(e,t,a);case 76:i.next=80;break;case 78:return i.next=80,l.scrollResourceIntoView(e,a);case 80:if(!y){i.next=88;break}if(1!==p){i.next=86;break}return i.next=84,l.setTimeSpan(u.startDate,new Date(u.endDate.getTime()-h),{maintainVisibleStart:!0});case 84:i.next=88;break;case 86:return i.next=88,l.setTimeSpan(new Date(u.startDate.getTime()+h),u.endDate,{maintainVisibleStart:!0});case 88:case"end":return i.stop()}}),i)}))()})),function(e,t){return r.apply(this,arguments)})},{key:"scrollUnrenderedEventIntoView",value:function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i?arguments[2]:lR;return new Promise(function(){var a=f(L().mark((function a(o){var l,s,u,c,d,h,f,v,g,m,p,y;return L().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=(l=n).timeAxisSubGrid.scrollable,u=s.viewport,c=l.rowManager,d=s.y,u){a.next=4;break}return o(),a.abrupt("return");case 4:h=Object.assign({},lR),g=0;case 6:if(!(++g>=50)){a.next=8;break}throw new Error("Too many preparational scrolls during 'scrollIntoView' for event id = ".concat(t.id));case 8:if(m=l.getResourceEventBox(t,e)){a.next=12;break}return o(),a.abrupt("return");case 12:return m.x=Math.ceil(m.x),m.y=Math.ceil(m.y),l.rtl&&(m._x=-(m.x-u.width)),m.translate(u.x-s.scrollLeft,u.y-s.y),v===i&&(v=s.getDeltaTo(m,h)),p=s.scrollIntoView(m,r),a.next=20,p;case 20:if(!p.cancelled&&!l.isDestroyed){a.next=23;break}return o(),a.abrupt("return",!0);case 23:return a.next=25,Ge.animationFrame();case 25:if(!l.isDestroyed){a.next=28;break}return o(),a.abrupt("return",!0);case 28:f=l.getElementFromEventRecord(t,e);case 29:if(!f){a.next=6;break}case 30:return s.suspendEvents(),v.yDelta>=0?s.y=Math.max(c.topRow.top-s.viewport.height,d):s.y=Math.min(c.bottomRow.bottom,d),l.fixElementHeights(),s.resumeEvents(),y=s.scrollIntoView(f,h),a.next=37,y;case 37:if(!y.canceled&&!l.isDestroyed){a.next=40;break}return o(),a.abrupt("return",!0);case 40:return a.next=42,Ge.animationFrame();case 42:o();case 43:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"scrollResourceIntoView",value:(n=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:lR;return L().mark((function r(){return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.waitForReadiness();case 2:if(!t.isVertical){r.next=7;break}return r.next=5,t.currentOrientation.scrollResourceIntoView(e,n);case 5:r.next=9;break;case 7:return r.next=9,t.scrollRowIntoView(e,n);case 9:case"end":return r.stop()}}),r)}))()})),function(e){return n.apply(this,arguments)})},{key:"widgetClass",get:function(){}}]);var n,r,a}(e||Mn),S(t,"$name","SchedulerScroll"),S(t,"configurable",{scrollExtensionThreshold:null}),t},uR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getScheduleRegion",value:function(e,t){var n;return(n=this.currentOrientation).getScheduleRegion.apply(n,arguments)}},{key:"getResourceRegion",value:function(e,t,n){var r;return(r=this.currentOrientation).getRowRegion.apply(r,arguments)}},{key:"getAssignmentEventBox",value:function(e,t){return this.getResourceEventBox(e.event,e.resource,t)}},{key:"getResourceEventBox",value:function(e,t){var n;return(n=this.currentOrientation).getResourceEventBox.apply(n,arguments)}},{key:"getItemBox",value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return e.resources.map((function(r){return t.getResourceEventBox(e,r,n)}))}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","SchedulerRegions"),t},cR=["startDate","endDate","eventLayout","barMargin","mode","tickSize","eventColor","eventStyle","fillTicks"],dR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getState",value:function(){return Be.copyProperties(B(t,"getState",this,3)([]),this,cR)}},{key:"applyState",value:function(e){var n,r;e=Object.assign({},e),this.suspendRefresh(),"layoutFn"===(null===(n=e)||void 0===n?void 0:n.eventLayout)&&delete e.eventLayout,null!==(r=e)&&void 0!==r&&null!==(r=r.zoomLevelOptions)&&void 0!==r&&r.width&&delete e.tickSize,B(t,"applyState",this,3)([e]),this.resumeRefresh(!0,!1)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","SchedulerState"),S(t,"configurable",{statefulEvents:["dateRangeChange"]}),t},hR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e;B(t,"afterConstruct",this,3)([]),null===(e=this.navigator)||void 0===e||e.ion({navigate:"onEventNavigate",thisObj:this})}},{key:"changeSelectedCollection",value:function(e){return e.isCollection||(e=new us(e)),e}},{key:"updateSelectedCollection",value:function(e){var t=this;e.owner||(e.owner=t),e.ion({change:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(function(){return!t.isDestroying&&t.onSelectedCollectionChange.apply(t,arguments)}),n)},beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:t})}},{key:"selectedCollection",get:function(){return this._selectedCollection}},{key:"getActionType",value:function(e,t,n,r){return r&&e.length>0&&n.length===e.length&&0===t.length||!r&&0===e.length&&n.length>0?"clear":t.length>0&&n.length>0?"update":t.length>0?"select":"deselect"}},{key:"getEventsFromAssignments",value:function(e){return $e.unique(e.map((function(e){return e.event})))}},{key:"selectedEvents",get:function(){return this.getEventsFromAssignments(this.selectedCollection.values)},set:function(e){var t,n=this,r=[];null===(t=e=$e.asArray(e))||void 0===t||t.forEach((function(e){!1!==n.isEventSelectable(e)&&(e.isOccurrence?e.assignments.forEach((function(t){r.push(n.assignmentStore.getOccurrence(t,e))})):r.push.apply(r,z(e.assignments)))})),this.selectedCollection.splice(0,this.selectedCollection.count,r)}},{key:"selectedAssignments",get:function(){return this.selectedCollection.values},set:function(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}},{key:"isEventSelected",value:function(e){var t=this.selectedCollection;return Boolean(t.count&&t.includes(e.assignments))}},{key:"isEventSelectable",value:function(e){}},{key:"isAssignmentSelected",value:function(e){return this.selectedCollection.includes(e)}},{key:"select",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}},{key:"selectEvent",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];this.isEventSelected(e)||this.selectEvents([e],t)}},{key:"selectAssignment",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}},{key:"deselect",value:function(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}},{key:"deselectEvent",value:function(e){var t;this.isEventSelected(e)&&(t=this.selectedCollection).remove.apply(t,z(e.assignments))}},{key:"deselectAssignment",value:function(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}},{key:"selectEvents",value:function(e){var t=this;if(arguments.length>1&&arguments[1]!==i&&arguments[1]){var n=e.reduce((function(e,n){return!1!==t.isEventSelectable(n)&&e.push.apply(e,z(n.assignments)),e}),[]);this.selectedCollection.add(n)}else this.selectedEvents=e}},{key:"deselectEvents",value:function(e){this.selectedCollection.remove(e.reduce((function(e,t){return e.push.apply(e,z(t.assignments)),e}),[]))}},{key:"selectAssignments",value:function(e){this.selectedCollection.add(e)}},{key:"deselectAssignments",value:function(e){this.selectedCollection.remove(e)}},{key:"clearEventSelection",value:function(){this.selectedAssignments=[]}},{key:"onBeforeSelectedCollectionSplice",value:function(e){var t=e.toAdd,n=e.toRemove,r=e.index,i=this,a=i._selectedCollection.values,o=t,l=n>0?a.slice(r,n+r):[],s=i.getActionType(a,o,l,!0);if(0!==t.length||0!==n)return!1!==i.trigger("beforeEventSelectionChange",{action:s,selection:i.getEventsFromAssignments(a)||[],selected:i.getEventsFromAssignments(o)||[],deselected:i.getEventsFromAssignments(l)||[]})&&(!1!==i.trigger("beforeAssignmentSelectionChange",{action:s,selection:a,selected:o,deselected:l})&&void 0)}},{key:"onSelectedCollectionChange",value:function(e){var t=e.added,n=e.removed,r=this,i=r.selectedAssignments,a=t||[],o=n||[];function l(e,t){var n=e.event;if(n){var i=!1,a=!0,o=r.eventAssignHighlightCls;if(r.currentOrientation.toggleCls(e,r.eventSelectedCls,t,i,a),o){var l=r.getElementFromAssignmentRecord(e,i,a);r.getElementsFromEventRecord(n,null,i,a).forEach((function(e){if(e!==l){var n=r.resolveAssignmentRecord(e,a);r.currentOrientation.toggleCls(n,o,t,i,a),t&&!e.parentElement.isReleased&&(e.style.animation="none",e.offsetHeight,e.style.animation=""),e.classList.toggle(o,t)}}))}}}if(o.forEach((function(e){return l(e,!1)})),a.forEach((function(e){return l(e,!0)})),(r.highlightSuccessors||r.highlightPredecessors)&&r.highlightLinkedEvents(r.selectedEvents),r.$selectedAssignments=i.map((function(e){return{eventId:e.eventId,resourceId:e.resourceId}})),!r.silent){var s=this.getActionType(i,a,o);r.trigger("assignmentSelectionChange",{action:s,selection:i,selected:a,deselected:o}),r.trigger("eventSelectionChange",{action:s,selection:r.selectedEvents,selected:r.getEventsFromAssignments(a),deselected:r.getEventsFromAssignments(o)})}}},{key:"onAssignmentChange",value:function(e){B(t,"onAssignmentChange",this,3)([e]);var n=this,r=e.action,i=e.records;if(n.silent=!n.triggerSelectionChangeOnRemove,"remove"===r)n.deselectAssignments(i);else if("removeall"!==r||n.eventStore.isSettingData){if("dataset"===r&&n.$selectedAssignments)if(n.maintainSelectionOnDatasetChange){var a=n.$selectedAssignments.map((function(e){return i.find((function(t){return t.eventId===e.eventId&&t.resourceId===e.resourceId}))}));n.selectedAssignments=$e.clean(a)}else n.clearEventSelection()}else n.clearEventSelection();n.silent=!1}},{key:"onInternalEventStoreChange",value:function(e){var n=e.source,r=e.action,i=e.records;n.isResourceTimeRangeStore||"dataset"!==r||i.length||this.clearEventSelection(),B(t,"onInternalEventStoreChange",this,3)(arguments)}},{key:"onAssignmentSelectionClick",value:function(e,t){var n=this;n.isAssignmentSelected(t)?(n.deselectOnClick||e.ctrlKey)&&n.deselectAssignment(t,n.multiEventSelect,e):!1!==this.isEventSelectable(t.event)&&n.selectAssignment(t,e.ctrlKey&&n.multiEventSelect,e)}},{key:"onEventNavigate",value:function(e){var t=e.event,n=e.item;if(!this.eventSelectionDisabled){var r=n&&(n.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(n):n);r?this.onAssignmentSelectionClick(t,r):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}},{key:"changeHighlightSuccessors",value:function(e){return this.changeLinkedEvents(e)}},{key:"changeHighlightPredecessors",value:function(e){return this.changeLinkedEvents(e)}},{key:"changeLinkedEvents",value:function(e){var t=this;return e?(t.highlighted=t.highlighted||new o,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}},{key:"highlightLinkedEvents",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:[],t=this,n=t.highlighted,r=t.eventStore,a=t.features.dependencies;n.forEach((function(t){e.includes(t)||(t.meta.highlight=!1,n.delete(t),r.includes(t)&&t.dependencies.forEach((function(e){return a.unhighlight(e,"b-highlight")})))})),e.forEach((function(e){for(var r=[e];r.length;){var i=r.pop();n.add(i),t.highlightSuccessors&&i.outgoingDeps.forEach((function(e){a.highlight(e,"b-highlight"),!n.has(e.toEvent)&&r.push(e.toEvent)})),t.highlightPredecessors&&i.incomingDeps.forEach((function(e){a.highlight(e,"b-highlight"),!n.has(e.fromEvent)&&r.push(e.fromEvent)}))}n.forEach((function(e){return e.meta.highlight=!0}))})),t.element.classList.toggle("b-highlighting",e.length>0),t.refreshWithTransition()}},{key:"onEventDataGenerated",value:function(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),B(t,"onEventDataGenerated",this,3)([e])}},{key:"updateProject",value:function(e,n){this.clearEventSelection(),B(t,"updateProject",this,3)([e,n])}},{key:"doDestroy",value:function(){var e;B(t,"doDestroy",this,3)([]),(null===(e=this._selectedCollection)||void 0===e?void 0:e.owner)===this&&this._selectedCollection.destroy()}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectResourceOnEventNavigate:!0,selectResourceOnScheduleClick:!0,selectedCollection:{}}}},{key:"defaultConfig",get:function(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}}])}(e||Mn),S(t,"$name","EventSelection"),t},fR=function(e){return e.preventDefault()},vR={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},gR={animate:100},mR=Object.freeze({}),pR=function(e,t){return e.event.startDate-t.event.startDate},yR=function(e,t){var n=e.event.startDate;return t.event.startDate-n},kR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)([e]),n.isInTimeAxis=n.isInTimeAxis.bind(n),n.onDeleteKey=n.throttle(n.onDeleteKey,n.onDeleteKeyBuffer,n)}},{key:"changeNavigator",value:function(e){var t=this,n=t.isVertical;return t.getConfig("subGridConfigs"),n&&(e.prevKey="ArrowUp",e.nextKey="ArrowDown",e.keys.ArrowUp=e.keys.ArrowDown=null,e.keys.ArrowLeft=e.keys.ArrowRight="navigateResourceHeaderCells"),new Jf(t.constructor.mergeConfigs({ownerCmp:t,target:n?t.bodyElement:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:".".concat(t.eventCls,"-wrap").concat(n?",.b-resourceheader-cell":""),focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:fR}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:fR})},e))}},{key:"doDestroy",value:function(){this.navigator.destroy(),B(t,"doDestroy",this,3)([])}},{key:"isInTimeAxis",value:function(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}},{key:"onElementKeyDown",value:function(e){var n,r,i=this,a=i.navigator;if(-1===(null===(n=i.focusedCell)||void 0===n?void 0:n.rowIndex)||(null===(r=i.focusedCell)||void 0===r?void 0:r.column)!==i.timeAxisColumn||e.target.closest(a.itemSelector)||"Enter"!==e.key){var o;null===(o=B(t,"onElementKeyDown",this,3))||void 0===o||o([e])}else{var l=i.getFirstVisibleAssignment();if(l)return i.navigateTo(l,{uiEvent:e}),!1}}},{key:"getFirstVisibleAssignment",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.focusedCell,t=this,n=t.currentOrientation,r=t.rowManager,a=t.eventStore;if(t.isHorizontal){var o,l,s,u,c,d=n.rowMap.get(r.getRow(e.rowIndex));if(null!==(o=d)&&void 0!==o&&o.length)return null===(l=d[0])||void 0===l?void 0:l.elementData.assignmentRecord;if(null!==(u=d=null===(s=n.resourceMap.get(e.id))||void 0===s?void 0:s.eventsData)&&void 0!==u&&u.length)return null===(c=d.filter((function(e){return a.isAvailable(e.eventRecord)}))[0])||void 0===c?void 0:c.assignmentRecord}else{var h=z(n.resourceMap.values())[0],f=h&&Object.values(h);if(null!=f&&f.length)return f.filter((function(e){return a.isAvailable(e.renderData.eventRecord)}))[0].renderData.assignmentRecord}}},{key:"onGridBodyFocusIn",value:function(e){var n=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){var r=this,i=r.navigationEvent,a=e.target,o=a.closest(r.navigator.itemSelector),l=o?r.normalizeCellContext({rowIndex:r.isVertical?0:r.resourceStore.indexOf(r.resolveResourceRecord(a)),column:r.timeAxisColumn,target:a}):new cg(a);if(o){var s,u=r._focusedCell;return r._focusedCell=l,void(null===(s=r.onCellNavigate)||void 0===s||s.call(r,r,u,l,i,!0))}if(n&&(!i||vR[i.key])){var c=r.getFirstVisibleAssignment(l);if(c)return void r.navigateTo(c,{scrollIntoView:Boolean(i&&"mousedown"!==i.type),uiEvent:i||e})}}n&&B(t,"onGridBodyFocusIn",this,3)([e])}},{key:"accessibleFocusCell",value:function(e,n){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return B(t,"focusCell",this,3)([e,n])}},{key:"normalizeTarget",value:function(e){return e.assignmentRecord}},{key:"getPrevious",value:function(e,t){var n=this,r=n.resourceStore,i=n.visibleDateRange,a=n.currentOrientation.eventSorter,o=n.timeAxis,l=o.startDate,s=o.endDate,u=e.event,c=n.eventStore.getEvents({resourceRecord:e.resource,startDate:l,endDate:s,visibleDateRange:i}).filter(this.isInTimeAxis).sort(a),d=e.resource,h=c[c.indexOf(u)-1];if(!h)for(var f=r.indexOf(d)-1;(!h||t&&h===u)&&f>=0;f--){d=r.getAt(f);var v=n.eventStore.getEvents({resourceRecord:d,startDate:l,endDate:s}).filter(n.isInTimeAxis).sort(a);h=v.length&&v[v.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(h,d)}},{key:"navigateResourceHeaderCells",value:function(e){var t=e.target;if(t.closest(".b-resourceheader-cell")){var n=this.resourceStore["ArrowRight"===e.key?"getNext":"getPrev"](this.resolveResourceRecord(t)),r=t.parentElement.querySelector('[data-resource-id="'.concat(null==n?void 0:n.id,'"]'));r&&(e.handled=!0,e.preventDefault(),r.scrollIntoView(),r.focus())}}},{key:"navigatePrevious",value:function(e){var t=this,n=e.target.closest(t.eventSelector)&&t.getPrevious(t.normalizeTarget(e));return n?(e.preventDefault(),e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,{uiEvent:e})):(e.handled=!1,t.doGridNavigation(e))}},{key:"getNext",value:function(e,t){var n=this,r=n.resourceStore,i=n.visibleDateRange,a=n.currentOrientation.eventSorter,o=n.timeAxis,l=o.startDate,s=o.endDate,u=e.event,c=n.eventStore.getEvents({resourceRecord:e.resource,startDate:l,endDate:s,visibleDateRange:i}).filter(this.isInTimeAxis).sort(a),d=e.resource,h=c[c.indexOf(u)+1];if(!h)for(var f=r.indexOf(d)+1;(!h||t&&h===u)&&f<r.count;f++){d=r.getAt(f),h=n.eventStore.getEvents({resourceRecord:d,startDate:l,endDate:s}).filter(n.isInTimeAxis).sort(a)[0]}return n.assignmentStore.getAssignmentForEventAndResource(h,d)}},{key:"navigateNext",value:function(e){var t=this,n=e.target,r=n.closest(t.eventSelector)&&t.getNext(t.normalizeTarget(e));if(r)return e.preventDefault(),e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,{uiEvent:e});if(t.isVertical&&n.closest(".b-resourceheader-cell")){var i=t.resolveResourceRecord(n),a=t.visibleDateRange,o=t.currentOrientation.eventSorter,l=t.timeAxis,s=l.startDate,u=l.endDate,c=t.eventStore.getEvents({resourceRecord:i,filter:t.isInTimeAxis,startDate:s,endDate:u,visibleDateRange:a}).sort(o)[0],d=c&&t.assignmentStore.getAssignmentForEventAndResource(c,i);return d?t.navigateTo(d,{uiEvent:e}):t.navigateDown()}return e.handled=!1,t.doGridNavigation(e)}},{key:"doGridNavigation",value:function(e){var t;e.handled||0!==e.key.indexOf("Arrow")||(null===(t=this["navigate".concat(e.key.substring(5),"ByKey")])||void 0===t||t.call(this,e))}},{key:"navigateTo",value:(n=f((function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:mR,r=n.scrollIntoView,a=void 0===r||r,o=n.uiEvent,l=void 0===o?{}:o;return L().mark((function n(){var r,i,o;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(r=t).navigator,o=i.skipScrollIntoView,!e){n.next=11;break}if(!a){n.next=9;break}return i.disabled=!0,n.next=6,r.scrollAssignmentIntoView(e,F({extendTimeAxis:r.infiniteScroll},gR));case 6:i.disabled=!1,n.next=10;break;case 9:i.skipScrollIntoView=!0;case 10:!r.isDestroyed&&t.getElementFromAssignmentRecord(e)&&(r.activeAssignment=e,i.skipScrollIntoView=o,i.trigger("navigate",{event:l,item:r.getElementFromAssignmentRecord(e).closest(i.itemSelector)}));case 11:case"end":return n.stop()}}),n)}))()})),function(e){return n.apply(this,arguments)})},{key:"activeAssignment",get:function(){var e=this.navigator.activeItem;if(e)return this.resolveAssignmentRecord(e)},set:function(e){var t=this.getElementFromAssignmentRecord(e,!0);t&&(this.navigator.activeItem=t)}},{key:"previousActiveEvent",get:function(){var e=this.navigator.previousActiveItem;if(e)return this.resolveEventRecord(e)}},{key:"processEvent",value:function(e){var t=this,n=e.target.closest(t.eventSelector);return n&&(e.assignmentRecord=t.resolveAssignmentRecord(n),e.eventRecord=t.resolveEventRecord(n),e.resourceRecord=t.resolveResourceRecord(n)),e}},{key:"onTab",value:function(e){e.target.closest(this.eventSelector)&&this.navigateNext(this.processEvent(e)),e.defaultPrevented||B(t,"onTab",this,3)(arguments)}},{key:"onShiftTab",value:function(e){e.target.closest(this.eventSelector)&&this.navigatePrevious(this.processEvent(e)),e.defaultPrevented||B(t,"onShiftTab",this,3)(arguments)}},{key:"onDeleteKey",value:function(e){var t=this;if(!t.readOnly&&t.enableDeleteKey){var n=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(n.filter((function(e){var t;return!(e.readOnly||null!==(t=e.event)&&void 0!==t&&t.readOnly)})))}}},{key:"onArrowUpKey",value:function(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}},{key:"onArrowDownKey",value:function(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}},{key:"navigateLeft",value:function(e){if(this.isVertical&&this.activeAssignment){var n=this,r=n.activeAssignment,i=n.eventStore,a=n.resourceStore,o=r.resource,l=r.event,s=l.startDate,u=l.endDate,c=i.getAssignmentsForResource(o).filter((function(e){var t=e.event,n=t.startDate,r=t.endDate;return Pl.intersectSpans(n,r,s,u)&&n<s}));if(!c.length)for(var d=a.indexOf(o)-1;!c.length&&d>=0;d--)c=n.eventStore.getAssignmentsForResource(a.getAt(d));return c.length?n.navigateTo(c.sort(yR)[0],{uiEvent:e}):B(t,"navigateLeft",this,3)([e])}return B(t,"navigateLeft",this,3)([e])}},{key:"navigateRight",value:function(e){if(this.isVertical&&this.activeAssignment){var n=this,r=n.activeAssignment,i=n.eventStore,a=n.resourceStore,o=r.resource,l=r.event,s=l.startDate,u=l.endDate,c=i.getAssignmentsForResource(o).filter((function(e){return e!==r})).filter((function(e){var t=e.event,n=t.startDate,r=t.endDate;return Pl.intersectSpans(n,r,s,u)&&n>=s}));if(!c.length)for(var d=a.indexOf(o)+1;!c.length&&d<a.count;d++)c=this.eventStore.getAssignmentsForResource(a.getAt(d));return c.length?n.navigateTo(c.sort(pR)[0],{uiEvent:e}):B(t,"navigateRight",this,3)([e])}return B(t,"navigateRight",this,3)([e])}},{key:"onEscapeKey",value:function(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn},{disableActionable:!0,scroll:!1}),e.handled=!0)}},{key:"onEventSpaceKey",value:function(e){}},{key:"onEventEnterKey",value:function(e){}},{key:"isActionableLocation",get:function(){if(!this.navigator.activeItem)return B(t,"isActionableLocation",this,1)}},{key:"onNavigate",value:function(e){var t,n=e.item;e.event,null!=n&&null!==(t=n.elementData)&&void 0!==t&&t.ariaLabel&&n.setAttribute("aria-label",n.elementData.ariaLabel)}},{key:"widgetClass",get:function(){}}]);var n}($i(e||Mn)),S(t,"$name","EventNavigation"),S(t,"configurable",{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey"},internalListeners:{navigate:"up.onNavigate"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}),S(t,"defaultConfig",{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}),t},bR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"widgetClass",get:function(){}},{key:"transactionalFeaturesEnabled",get:function(){return this.enableTransactionalFeatures&&this.project&&Boolean(this.project._queue)}},{key:"isTransactionalFeatureActive",get:function(){return null!=this._featureTransactionId}},{key:"featureTransactionId",get:function(){return this._featureTransactionId}},{key:"construct",value:function(){for(var e=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];B(t,"construct",this,3)(r),this.ion({beforeFeatureTransactionStart:function(t){var n=t.id;return e._featureTransactionId=n},featureTransactionComplete:function(){return delete e._featureTransactionId}})}},{key:"afterFeatureTransaction",value:function(e){this.transactionalFeaturesEnabled&&(this.isTransactionalFeatureActive?this.once("featureTransactionComplete",e):e.call(this))}}])}(e),S(t,"$name","TransactionalFeatureMixin"),S(t,"configurable",{enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}}),t},CR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]);var e=this.crudManager,n=this.project;this.loadMask&&(e||n).isCrudManagerLoading&&this.onCrudManagerLoadStart()}},{key:"applySyncMask",value:function(){var e=this.syncMask;e&&(this.masked=gs.mergeConfigs(this.loadMaskDefaults,e))}},{key:"bindCrudManager",value:function(e){this.detachListeners("crudManager");var t={};this.isTaskBoardBase||(t={beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",beforeLoadCrudManagerData:"onCrudManagerBeforeLoadCrudManagerData",loadCrudManagerData:"onCrudManagerLoadCrudManagerData"}),null==e||e.ion(F(F({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",requestDone:"onAjaxTransportResponseDone"},t),{},{thisObj:this}))}},{key:"onCrudManagerBeforeSend",value:function(e){var t,n=e.params;null===(t=this.applyStartEndParameters)||void 0===t||t.call(this,n)}},{key:"onCrudManagerLoadStart",value:function(){var e;this.applyLoadMask(),null===(e=this.toggleEmptyText)||void 0===e||e.call(this)}},{key:"onCrudManagerSyncStart",value:function(){this.applySyncMask()}},{key:"onCrudManagerBeforeApplyResponse",value:function(){this.suspendRefresh()}},{key:"onCrudManagerApplyResponse",value:function(e){var t=e.request;this.resumeRefresh(!0,"sync"===t.type)}},{key:"onCrudManagerBeforeLoadCrudManagerData",value:function(){this.crudManager.applyingLoadResponse||this.suspendRefresh()}},{key:"onCrudManagerLoadCrudManagerData",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.crudManager.applyingLoadResponse){e.next=4;break}return e.next=3,this.project.commitAsync();case 3:!this.isDestroyed&&this.resumeRefresh(!0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onCrudManagerRequestFinalize",value:function(){var e,t=arguments.length>1?arguments[1]:i,n=arguments.length>2?arguments[2]:i,r=this;arguments.length>0&&arguments[0]!==i&&!arguments[0]?(r.masked||r.applyLoadMask(),r.applyMaskError('<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">'.concat(r.L("L{GridBase.".concat(t,"FailedMessage}")),"</div>\n                    ").concat(n&&n.message?'<div class="b-grid-load-fail">'.concat(r.L("L{CrudManagerView.serverResponseLabel}")," ").concat(n.message,"</div>"):"","\n                </div>"))):null===(e=r.toggleEmptyText)||void 0===e||e.call(r)}},{key:"onCrudManagerLoadCanceled",value:function(){this.onCrudManagerRequestFinalize(!0,"load")}},{key:"onCrudManagerSyncCanceled",value:function(){this.onCrudManagerRequestFinalize(!0,"sync")}},{key:"onCrudManagerLoad",value:function(){this.onCrudManagerRequestFinalize(!0,"load")}},{key:"onCrudManagerSync",value:function(){this.onCrudManagerRequestFinalize(!0,"sync")}},{key:"onCrudManagerRequestFail",value:function(e){var t=e.requestType,n=e.response;this.onCrudManagerRequestFinalize(!1,t,n)}},{key:"onAjaxTransportResponseDone",value:function(){var e=this;null!=e.clearMaskDelay?e.setTimeout((function(){return e.masked=null}),e.clearMaskDelay):e.masked=null}},{key:"widgetClass",get:function(){}}]);var n}(e.mixin(vm)),S(t,"$name","CrudManagerView"),S(t,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),t},wR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n,r=this;if(r.$lazyLoadDetachers=new a,r.$lazyLoadCount=0,B(t,"construct",this,3)([e]),null!==(n=r.crudManager)&&void 0!==n&&n.lazyLoad){var i=r.resourceStore.lazyLoad,o="doLazyLoad";r.crudManager.remotePaging&&(i=r.resourceStore,o="requestData"),r.$lazyLoadDetachers.set(r,Tt.before(i,o,"beforeResourceStoreLoad",r)),r.passStartEndParameters=!1}}},{key:"beforeResourceStoreLoad",value:function(e){var t=this,n={startDate:t.startDate,endDate:t.endDate,visibleStart:t.visibleDateRange.startDate,visibleEnd:t.visibleDateRange.endDate};if(t.crudManager.remotePaging){var r=t.resourceStore.defaultPageParamName,i=t.resourceStore.pageSizeParamName;n[r]=e[r],n[i]=e[i]}var a=t.eventStore.lazyLoad.calculateDateRange(n);Object.assign(e,a)}},{key:"updateEventStore",value:function(e,n){var r;null===(r=B(t,"updateEventStore",this,3))||void 0===r||r([e,n]),this.lazyLoadAttachStore(e,n),e.lazyLoad&&(this.passStartEndParameters=!1)}},{key:"updateResourceTimeRangeStore",value:function(e,n){var r;null===(r=B(t,"updateResourceTimeRangeStore",this,3))||void 0===r||r([e,n]),this.lazyLoadAttachStore(e,n)}},{key:"updateAssignmentStore",value:function(e,n){var r;null===(r=B(t,"updateAssignmentStore",this,3))||void 0===r||r([e,n]),this.lazyLoadAttachStore(e,n)}},{key:"updateTimeRangeStore",value:function(e,n){var r;null===(r=B(t,"updateTimeRangeStore",this,3))||void 0===r||r([e,n]),this.lazyLoadAttachStore(e,n)}},{key:"lazyLoadAttachStore",value:function(e,t){var n,r,i,a=this,o=a.$lazyLoadDetachers;t&&(null===(r=o.get(t))||void 0===r||r(),o.delete(t),t.lazyLoad.beforeLoadCall&&(t.lazyLoad.beforeLoadCall=null));(e&&null!==(n=a.resourceStore)&&void 0!==n&&n.isPaged&&(e.lazyLoad&&!e.isPaged?e.remotePaging=!0:e.isPaged&&!e.lazyLoad&&(e.lazyLoad=!0)),null!=e&&e.lazyLoad)&&(null===(i=o.get(e))||void 0===i||i(),o.set(e,e.ion({lazyLoadStarted:"storeLazyLoadStarted",lazyLoadEnded:"storeLazyLoadEnded",thisObj:a})),e.lazyLoad.isDateStoreLazyLoadPlugin&&(e.lazyLoad.beforeLoadCall=function(e){Object.assign(e,{startDate:a.startDate,endDate:a.endDate,visibleStart:a.visibleDateRange.startDate,visibleEnd:a.visibleDateRange.endDate,resourceRecord:a.resourceStore.first})}))}},{key:"$lazyLoadCount",get:function(){return this.$_lazyLoadCount},set:function(e){0===this.$_lazyLoadCount&&e>0?this.lazyLoadShowLoadingIndicator():this.$_lazyLoadCount>0&&0===e&&this.lazyLoadHideLoadingIndicator(),this.$_lazyLoadCount=e}},{key:"storeLazyLoadStarted",value:function(){this.$lazyLoadCount+=1}},{key:"storeLazyLoadEnded",value:function(){this.$lazyLoadCount-=1}},{key:"lazyLoadShowLoadingIndicator",value:function(){var e=this;e.$lazyLoadingIndicatorElement?e.timeAxisSubGrid.header.element.appendChild(e.$lazyLoadingIndicatorElement):e.$lazyLoadingIndicatorElement=li.createElement({parent:e.timeAxisSubGrid.header.element,retainElement:!0,className:"b-timeline-loading-indicator-wrap",children:[{className:"b-timeline-loading-indicator"}]}),e.readOnly=!0}},{key:"lazyLoadHideLoadingIndicator",value:function(){var e;null===(e=this.$lazyLoadingIndicatorElement)||void 0===e||e.remove(),this.readOnly=!1}},{key:"doDestroy",value:function(){var e;null===(e=this.$lazyLoadDetachers)||void 0===e||e.forEach((function(e){return e()})),B(t,"doDestroy",this,3)([])}}])}(e),S(t,"$name","LazyLoadView"),t},DR=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:(n=f(L().mark((function e(){var n,r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B(t,"afterConstruct",this,3)([]),i=(r=this).client||r.grid,a=i.project,null===(n=i.projectSubscribers)||void 0===n||n.push(r),a&&(r.attachToProject(a),r.attachToResourceStore(a.resourceStore),r.attachToEventStore(a.eventStore),r.attachToAssignmentStore(a.assignmentStore),r.attachToDependencyStore(a.dependencyStore),r.attachToCalendarManagerStore(a.calendarManagerStore));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"attachToProject",value:function(e){var n;this.detachListeners("project"),this._project=e,null===(n=B(t,"attachToProject",this,3))||void 0===n||n([e])}},{key:"detachFromProject",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:this._project;this.detachListeners("project"),null===(e=B(t,"detachFromProject",this,3))||void 0===e||e([n])}},{key:"attachToEventStore",value:function(e){var n;this.detachListeners("eventStore"),null===(n=B(t,"attachToEventStore",this,3))||void 0===n||n([e])}},{key:"attachToResourceStore",value:function(e){var n;this.detachListeners("resourceStore"),null===(n=B(t,"attachToResourceStore",this,3))||void 0===n||n([e])}},{key:"attachToAssignmentStore",value:function(e){var n;this.detachListeners("assignmentStore"),null===(n=B(t,"attachToAssignmentStore",this,3))||void 0===n||n([e])}},{key:"attachToDependencyStore",value:function(e){var n;this.detachListeners("dependencyStore"),null===(n=B(t,"attachToDependencyStore",this,3))||void 0===n||n([e])}},{key:"attachToCalendarManagerStore",value:function(e){var n;this.detachListeners("calendarManagerStore"),null===(n=B(t,"attachToCalendarManagerStore",this,3))||void 0===n||n([e])}},{key:"project",get:function(){return this._project}},{key:"calendarManagerStore",get:function(){return this.project.calendarManagerStore}},{key:"assignmentStore",get:function(){return this.project.assignmentStore}},{key:"resourceStore",get:function(){return this.project.resourceStore}},{key:"eventStore",get:function(){return this.project.eventStore}},{key:"dependencyStore",get:function(){return this.project.dependencyStore}}]);var n}(e),S(t,"$name","AttachToProjectMixin"),t},SR={releaseElement:1,reuseElement:1},xR={newElement:1,reuseOwnElement:1,reuseElement:1},ER=9999999,RR=new Date(0),TR=new Date(9999,0,1),MR=function(e,t){return e.startDateMS-t.startDateMS},FR={startDate:1,endDate:1,duration:1};function AR(e,t,n,r,i){var a,o,l=e.timeAxis,s=t.isBatchUpdating&&!i?t.get(r):t[r],u=null===(a=t.hasBatchedChange)||void 0===a?void 0:a.call(t,r);if(e.fillTicks&&(!(null!==(o=t.meta)&&void 0!==o&&o.isResizing)||!u)){var c=l.getTickFromDate(s);if(c>=0){n&&c===Math.round(c)&&c>0&&c--;var d=Math.floor(c);return l.getAt(d)[r].getTime()}}return null==s?void 0:s.getTime()}var IR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;n.client=n.scheduler=e,n.eventSorter=n.eventSorter.bind(e),n.scrollBuffer=e.scrollBuffer,e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:n}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:n}),B(t,"construct",this,3)([{}])}},{key:"init",value:function(){}},{key:"updateVerticalBufferSize",value:function(){var e=this.scheduler.rowManager;this.scheduler.isPainted&&e.renderRows(e.rows)}},{key:"visibleDateRange",get:function(){return this._visibleDateRange}},{key:"getDateFromXY",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this.scheduler,o=e[0];return n||(o=this.translateToScheduleCoordinate(o)),o=a.getRtlX(o),a.timeAxisViewModel.getDateFromPosition(o,t,r)}},{key:"translateToScheduleCoordinate",value:function(e){var t=this.scheduler,n=t.timeAxisSubGrid.scrollable,i=e-t.timeAxisSubGridElement.getBoundingClientRect().left-r.scrollX;return t.rtl?i+=n.maxX-Math.abs(t.scrollLeft):i+=t.scrollLeft,i}},{key:"translateToPageCoordinate",value:function(e){var t=this.scheduler,n=t.timeAxisSubGrid.scrollable,r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}},{key:"getScheduleRegion",value:function(e,t){var n,r,a,o=!(arguments.length>2&&arguments[2]!==i)||arguments[2],l=arguments.length>3?arguments[3]:i,s=arguments.length>4&&arguments[4]!==i&&arguments[4],u=this,c=u.scheduler,d=c.timeAxisSubGridElement,h=c.timeAxis,f=(!s||e)&&c.getResourceMarginObject(e)||{start:0,end:0},v=f.start,g=f.end;if(e){var m=c.getRowById(e.id),p=t&&c.getElementsFromEventRecord(t,e)[0];if(a=m?pt.from(m.getElement("normal"),d):c.getRecordCoords(e,!0),p){var y=pt.from(p,d);a.y=y.y,a.bottom=y.bottom}else a.y=a.y+v,a.bottom=a.bottom-g}else(a=pt.from(d).moveTo(null,0)).width=d.scrollWidth,a.y=a.y+v,a.bottom=a.bottom-g;var k=h.startDate,b=h.endDate;(l=(null===(n=l)||void 0===n?void 0:n.start)&&l||(null===(r=c.getDateConstraints)||void 0===r?void 0:r.call(c,e,t))||{start:k,end:b}).start=l.start||RR,l.end=l.end||TR;var C=l.end<=k||l.start>=b,w=C?-1:c.getVirtualCoordFromDate(l.start?Pl.max(k,l.start):k),D=C?-1:c.getVirtualCoordFromDate(l.end?Pl.min(b,l.end):b);return o||(w=u.translateToPageCoordinate(w),D=u.translateToPageCoordinate(D)),a.left=Math.min(w,D),a.right=Math.max(w,D),a}},{key:"getRowRegion",value:function(e,t,n){var r=this.scheduler,i=r.timeAxis,a=r.getRowById(e.id);if(!a)return null;var o=i.startDate,l=i.endDate,s=t?Pl.max(o,t):o,u=n?Pl.min(l,n):l,c=r.getCoordinateFromDate(s),d=r.getCoordinateFromDate(u,!0,!0),h=a.top,f=Math.min(c,d),v=h+a.offsetHeight;return new pt(f,h,Math.max(c,d)-f,v-h)}},{key:"getResourceEventBox",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this.scheduler,o=this.resourceMap.get(t.id),l=null,s=!1;if(o&&(l=o.eventsData.find((function(t){return t.eventRecord===e}))),l||(l=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:n}),s=!0),l){var u,c=null!==(u=l.height)&&void 0!==u?u:a.getResourceLayoutSettings(t).contentHeight,d=a.rowManager.getRecordCoords(t,!0,r);if(!d)return null;var h=l.top+d.top,f=new pt(l.left,h,l.width,c);return f.layout=!s,f.rowTop=d.top,f.rowBottom=d.bottom,f.resourceId=t.id,f}return null}},{key:"resolveRowRecord",value:function(e){var t=this.scheduler,n=e.nodeType?e:e.target,r=n.nodeType===Element.TEXT_NODE?n.parentElement:n,i=r.closest("[data-resource-id]");return i?this.resourceStore.getById(i.dataset.resourceId):t.getRecordFromElement(r)}},{key:"attachToProject",value:function(e){B(t,"attachToProject",this,3)([e]),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),null==e||e.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}},{key:"onProjectCommitFinalized",value:function(){var e=this.scheduler,t=this.toDrawOnDataReady,n=this.project;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!t.size&&null!=n.timeZone&&n.ignoreRecordChanges&&n.resourceStore.forEach((function(e){return t.add(e.id)})),t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear()):e.whenVisible("refreshRows")}},{key:"onProjectRefresh",value:function(e){var t=e.isCalculated,n=e.isInitialCommit,r=this,i=r.scheduler,a=r.toDrawOnProjectRefresh;if(i.isVisible){if(i.isPainted&&!i.isConfiguring&&!i.refreshSuspended){if(r.refreshAllWhenReady||n&&t){i.calculateAllRowHeights(!0);var o=i.rowManager;o.topRow?(r.clearAll(),i.refreshAfterProjectRefresh||(o.topRow.dataIndex>=i.store.count?i.renderRows(!1):i.refreshWithTransition(!1,t&&!n))):o.reinitialize(),r.refreshAllWhenReady=!1}else a.size&&r.refreshResources(a);a.clear()}}else i.whenVisible("refresh",i,[!0])}},{key:"attachToAssignmentStore",value:function(e){this.refreshAllWhenReady=!0,B(t,"attachToAssignmentStore",this,3)([e]),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}},{key:"onAssignmentStoreChange",value:function(e){var t=e.source,n=e.action,r=e.records,i=void 0===r?[]:r,a=e.replaced,l=e.changes,s=this,u=s.scheduler,c=new o(i.flatMap((function(e){var t,n;return[e.resourceId].concat(z(null!==(t=null===(n=e.resource)||void 0===n||null===(n=n.$links)||void 0===n?void 0:n.map((function(e){return e.id})))&&void 0!==t?t:[]))})));if(!s.resourceStore.isRemoving&&!s.resourceStore.isChangingId)switch(n){case"dataset":return void(s.eventStore.usesSingleAssignment||(c.size?s.refreshResourcesWhenReady(c):(s.clearAll(),u.refreshWithTransition())));case"add":case"remove":return void s.refreshResourcesWhenReady(c);case"removeall":return void(s.refreshAllWhenReady=!0);case"replace":return a.forEach((function(e){var t=_(e,2),n=t[0],r=t[1];c.add(n.resourceId),c.add(r.resourceId)})),void s.refreshResourcesWhenReady(c);case"filter":return s.clearAll(),u.calculateAllRowHeights(!0),void u.refreshWithTransition();case"update":("eventId"in l||"resourceId"in l||"id"in l)&&("resourceId"in l&&c.add(l.resourceId.oldValue),t===u.project.assignmentStore?s.refreshResourcesOnDataReady(c):s.refreshResources(c));break;case"clearchanges":var d=l.added,h=l.modified,f=l.removed;h.length?u.refreshWithTransition():(d.forEach((function(e){return c.add(e.resourceId)})),f.forEach((function(e){return c.add(e.resourceId)})),s.refreshResourcesOnDataReady(c))}}},{key:"onAssignmentStoreRefresh",value:function(e){var t=e.action;e.records,"batch"===t&&(this.clearAll(),this.scheduler.refreshWithTransition())}},{key:"attachToEventStore",value:function(e){this.refreshAllWhenReady=!0,B(t,"attachToEventStore",this,3)([e]),e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}},{key:"onEventStoreAddConfirmed",value:function(e){var t,n=e.record,r=D(this.client.getElementsFromEventRecord(n));try{for(r.s();!(t=r.n()).done;){t.value.classList.remove("b-iscreating")}}catch(e){r.e(e)}finally{r.f()}}},{key:"onEventStoreRefresh",value:function(e){if("batch"===e.action){var t=this.scheduler;t.isEngineReady&&t.isPainted&&(this.clearAll(),t.refreshWithTransition())}}},{key:"onEventStoreChange",value:function(e){var t=e.action,n=e.records,r=void 0===n?[]:n,a=e.record,l=e.replaced,s=e.changes,u=e.source,c=this,d=c.scheduler,h=u.isResourceTimeRangeStore,f=new o;if(d.isPainted)if(r.forEach((function(e){var t,n=null===(t=e.$linkedResources)||void 0===t?void 0:t.filter((function(e){return c.resourceStore.includes(e)}));null==n||n.forEach((function(e){return f.add(e.id)}))})),h){switch(t){case"removeall":case"dataset":return c.clearAll(),void d.refreshWithTransition()}c.refreshResources(f,"lazyload"!==t)}else{switch(t){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":return c.clearAll(),void d.refreshWithTransition();case"lazyload":return void(d.isEngineReady?d.refreshRows():c.refreshAllWhenReady=!0);case"dataset":return c.clearAll(),void(d.isEngineReady?d.refreshWithTransition():c.refreshAllWhenReady=!0);case"add":break;case"replace":l.forEach((function(e){_(e,2)[1].resources.map((function(e){return f.add(e.id)}))}));break;case"removeall":case"filter":return d.isEngineReady?(c.clearAll(),d.calculateAllRowHeights(!0),void d.refreshWithTransition()):void(c.refreshAllWhenReady=!0);case"update":var v=a.$entity?!Object.keys(s).some((function(e){return!a.$entity.getField(e)})):!Object.keys(s).some((function(e){return!FR[e]})),g=0;if("startDate"in s&&g++,"endDate"in s&&g++,"duration"in s&&g++,"resourceId"in s&&f.add(s.resourceId.oldValue),f.size&&(!v||g&&(!("duration"in s)||1!==g)||"percentDone"in s||"inactive"in s||"constraintDate"in s||"constraintType"in s||"segments"in s)){var m,p,y=d.features,k=y.eventResize,b=y.eventDragCreate,C=null==k?void 0:k.isResizing,w=null==b?void 0:b.isResizing,S=d.store,x=a.isBatchUpdating&&z(f).every((function(e){var t=S.getById(e),n=d.getEventLayout(t);return!d.getEventLayoutHandler(n)}));if(a.isBatchUpdating&&(C&&k.lockLayout||w&&b.lockLayout||(C||w)&&x)){var E,R=C&&"minimal-updates"===k.lockLayout||w&&"minimal-updates"===b.lockLayout,T=D(f);try{for(T.s();!(E=T.n()).done;){var M=E.value,F=d.store.getById(M);if(F)if(R){var A,I,L=null===(A=c.resourceMap.get(M))||void 0===A?void 0:A.eventsData.find((function(e){return e.eventRecord===a})),O=d.getRowFor(M),P=null===(I=c.rowMap.get(O))||void 0===I?void 0:I.find((function(e){return e.elementData.eventRecord===a}));if(L&&P){var H=d.generateRenderData(a,S.getById(M),!0);Object.assign(L,H);var B=this.renderEvent(L);Object.assign(P,B)}}else c.refreshEventsForResource(F,i,!1)}}catch(e){T.e(e)}finally{T.f()}c.onRenderDone()}else null!==(m=c.project)&&void 0!==m&&m.propagatingLoadChanges||null!==(p=c.project)&&void 0!==p&&p.isWritingData?c.refreshResourcesOnDataReady(f):c.refreshResources(f)}return}c.refreshResourcesWhenReady(f)}}},{key:"attachToResourceStore",value:function(e){this.refreshAllWhenReady=!0,B(t,"attachToResourceStore",this,3)([e]),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}},{key:"resourceStore",get:function(){return this.client.store}},{key:"onResourceStoreChange",value:function(e){var t=e.action,n=e.isExpand,r=e.records,i=e.changes,a=this,o=null==r?void 0:r.flatMap((function(e){return e.isLinked?[e.id,e.$originalId]:[e.id]}));if(a.scheduler.isPainted){switch(t){case"add":return void(n||(r.every((function(e){return e.isLinked}))?a.refreshResources(o):a.refreshResourcesWhenReady(o)));case"update":return void(a.project.isChangeTrackingSuspended||i.isLeaf||a.refreshResources(o));case"filter":case"dataset":return;case"removeall":return void a.clearAll({clearLayoutCache:!0})}o&&a.clearResources(o)}}},{key:"onTranslateRow",value:function(e){var t=e.row;null!=t.id&&this.refreshEventsForResource(t,!1)}},{key:"onOffsetRows",value:function(){this.clearAll(),this.doUpdateTimeView()}},{key:"calculateRowHeight",value:function(e){var t,n,r,i=this.scheduler,a=i.getResourceHeight(e),o=i.getEventLayout(e),l=o.type,s=null===(t=i.features.eventResize)||void 0===t?void 0:t.lockLayout,u=null===(n=i.features.eventDragCreate)||void 0===n?void 0:n.lockLayout;if("stack"===l&&i.isEngineReady&&!e.isSpecialRow&&(null===(r=e.assigned)||void 0===r?void 0:r.size)>1){var c=i.assignmentStore,d=i.eventStore,h=i.timeAxis,f=i.getResourceLayoutSettings(e),v=f.barMargin,g=f.resourceMarginObject.total,m=f.contentHeight,p=(d.isFiltered||c.isFiltered)&&function(t){return t.assignments.some((function(t){return t.resource===e.$original&&c.includes(t)}))},y=d.getEvents({resourceRecord:e,includeOccurrences:i.enableRecurringEvents,startDate:h.startDate,endDate:h.endDate,filter:p,fromRowHeight:!0}).sort(MR).map((function(t){var n,r,i=t.isBatchUpdating&&!(s&&null!==(n=t.meta)&&void 0!==n&&n.isResizing)&&!(u&&null!==(r=t.meta)&&void 0!==r&&r.isCreating),a=i?t.get("startDate"):t.startDate,o=i?t.get("endDate"):t.endDate||a;return{eventRecord:t,resourceRecord:e,startMS:a.getTime(),endMS:o.getTime()}})),k=i.getEventLayoutHandler(o),b=k.layoutEventsInBands(y,e,!0);return"layoutFn"===k.type?b:b*m+(b-1)*v+g}return a}},{key:"doUpdateTimeView",value:function(){var e=this.scheduler.timeAxisSubGrid.scrollable;this.updateFromHorizontalScroll(e.x,!0)}},{key:"onTimeAxisViewModelUpdate",value:function(){var e=this,t=e.scheduler;e.clearAll(),t.refreshSuspended&&(e.detachListeners("renderingSuspend"),t.ion({name:"renderingSuspend",resumeRefresh:function(n){var r=n.trigger;t.isEngineReady&&r&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}},{key:"getConnectorStartSide",value:function(e){return"start"}},{key:"getConnectorEndSide",value:function(e){return"end"}},{key:"refreshRows",value:function(e,t){e?this.clearResources(e):t&&this.clearAll()}},{key:"onLocaleChange",value:function(){this.clearAll()}},{key:"onViewportResize",value:function(e,t,n,r){t>r&&this.onRenderDone()}},{key:"onDragAbort",value:function(e){var t=e.context,n=e.dragData.record;!n.isEventSegmentModel&&this.resourceStore.indexOf(n.resource)<this.scheduler.topRow.dataIndex&&t.element.remove()}},{key:"toggleCls",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=arguments.length>4&&arguments[4]!==i&&arguments[4],o=this.client.getElementFromAssignmentRecord(e,r,a),l=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),s=null==l?void 0:l.eventsData.find((function(t){return t.eventId===e.eventId}));s&&(s[r?"wrapperCls":"cls"][t]=n),o&&(o.classList.toggle(t,n),o.lastDomConfig.className[t]=n)}},{key:"onRemoveRows",value:function(e){var t=this;e.rows.forEach((function(e){return t.rowMap.delete(e)})),this.onRenderDone()}},{key:"onEarlyScroll",value:function(){this.rendererCalled=!1}},{key:"updateFromVerticalScroll",value:function(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}},{key:"updateFromHorizontalScroll",value:function(e,t,n){var r,i,a=this,o=a.scheduler,l=a.scrollBuffer,s=-1===l,u=o.timeAxisSubGrid,c=o.timeAxis,d=u.width,h=o.timeAxisViewModel.totalSize,f=e,v=Math.abs(u.scrollable.maxX)>1&&Math.abs(u.scrollable.maxX)<=Math.round(f)+5,g=s?c.startDate:o.getDateFromVirtualCoord({coord:Math.max(0,f-l)}),m=v||s?c.endDate:o.getDateFromVirtualCoord({coord:f+d+l})||c.endDate;if(g&&(!o._viewPresetChanging||n)&&(!s||t||g-((null===(r=a._visibleDateRange)||void 0===r?void 0:r.startDate)||0)||m-((null===(i=a._visibleDateRange)||void 0===i?void 0:i.endDate)||0))){a._visibleDateRange={startDate:g,endDate:m,startMS:g.getTime(),endMS:m.getTime()},a.viewportCoords=s?{left:0,right:h}:{left:e-l,right:e+d+l};var p=o.timeView.range={startDate:g,endDate:m};if(o.internalOnVisibleDateRangeChange(p),!o.refreshSuspended&&o.rowManager.rows.length){if(null===o.rowManager.rows[0].id)return;a.fromScroll=!0,o.rowManager.rows.forEach((function(e){return a.refreshEventsForResource(e,!1,!1)})),a.onRenderDone()}}}},{key:"repaintEventsForResource",value:function(e){this.refreshResources([e.id])}},{key:"onBeforeRowHeightChange",value:function(){this.clearAll()}},{key:"refreshResourcesOnDataReady",value:function(e){var t=this;e.forEach((function(e){return t.toDrawOnDataReady.add(e)}))}},{key:"refreshResourcesWhenReady",value:function(e){var t=this;this.clearResources(e),e.forEach((function(e){return t.toDrawOnProjectRefresh.add(e)}))}},{key:"refreshResources",value:function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=this.scheduler;if(this.clearResources(e),!r.refreshSuspended){var a=[],o=[];e.forEach((function(e){var t=r.getRowById(e);t?a.push(t):o.push(t)})),r.runWithTransition((function(){r.calculateRowHeights(o.map((function(e){return t.resourceStore.getById(e)})),!0),r.rowManager.renderRows(a)}),n)}}},{key:"layoutEventVerticallyStack",value:function(e,t,n){var r=this.scheduler.getResourceLayoutSettings(n,t.parent),i=r.barMargin,a=r.resourceMarginObject.start,o=r.contentHeight;return 0===e?a:a+e*o+e*i}},{key:"layoutEventVerticallyPack",value:function(e,t,n,r){var i=this.scheduler.getResourceLayoutSettings(r,n.parent),a=i.barMargin,o=i.resourceMarginObject.start,l=1/t,s=e*l,u=(i.contentHeight-(l-1)*a)*t;return{top:o+s*u+s*a,height:Math.max(u,0)}}},{key:"addTemporaryDragElement",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e.resource,n=this.scheduler,r=n.generateRenderData(e,t,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:n.getResourceEventBox(e,t,!0).top;var a=this.renderEvent(r),o=a.dataset;delete a.tabIndex,delete o.eventId,delete o.resourceId,delete o.assignmentId,delete o.syncId,o.transient=!0,a.parent=this.scheduler.foregroundCanvas,a.retainElement=!0;var l=li.createElement(a,{reactCallback:function(e){var t,r=e.jsx,i=e.domConfig,a=e.targetElement,o=n.reactComponent;r&&(null===(t=n.processEventContent)||void 0===t||t.call(n,{jsx:r,action:"add",domConfig:i,targetElement:a,isRelease:!1,reactComponent:o}))}});return l.innerElement=l.firstChild,e.instanceMeta(n).hasTemporaryDragElement=!0,l}},{key:"eventSorter",value:function(e,t){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,t.eventRecord||t);var n=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,r=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,a=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,o=e.isModel?e.name:e.eventRecord.name,l=t.isModel?t.name:t.eventRecord.name;return n-i||a-r||(o<l?-1:o==l?0:1)}},{key:"calculateMS",value:function(e,t,n,r,i){var a,o=this.scheduler,l=o.timeAxisViewModel,s=o.features.eventResize,u=AR(o,e,!1,t,r),c=AR(o,e,!0,n,r),d=c-u;if("default"!==o.milestoneLayoutMode&&0===d){var h=l.getSingleUnitInPixels("minute"),f=o.getMilestoneLabelWidth(e,i);if(d=60*(f*(1/h))*1e3,"always-outside"===o.milestoneTextPosition){if(c=(u-=o.getResourceLayoutSettings(i,e.parent).contentHeight*(1/h)*60*1e3/2)+d,!1===o.timeAxis.isContinuous){var v,g=o.getCoordinateFromDate(u);c=null!==(v=o.getDateFromCoordinate(g+f))&&void 0!==v?v:c}}else switch(o.milestoneAlign){case"start":case"left":c=u+d;break;case"end":case"right":u=(c=u)-d;break;default:u=(c=u+d/2)-d}}var m=u,p=c,y=d;return null!==(a=e.meta)&&void 0!==a&&a.isResizing&&null!=s&&s.isResizing&&s.lockLayout&&!s.isMultiResizing&&(u=e.startDate.getTime(),c=e.endDate.getTime(),d=p-m),{startMS:u,endMS:c,durationMS:d,elementStartMS:m,elementEndMS:p,elementDurationMS:y}}},{key:"setupRenderData",value:function(e,t){var n,r=this,i=r.scheduler,a=i.timeAxis,o=i.timeAxisViewModel,l=e.preamble,s=e.postamble,u=r.isProHorizontalRendering&&(null===(n=i.features.eventBuffer)||void 0===n?void 0:n.enabled)&&(l||s)&&!e.isMilestone,c=o.getSingleUnitInPixels("minute"),d=e.isBatchUpdating,h=u?"wrapStartDate":"startDate",f=u?"wrapEndDate":"endDate",v=d&&!u?e.get(h):e[h],g=d&&!u?e.get(f):e[f]||v,m=a.startMS,p=a.endMS,y=r.calculateMS(e,h,f,u,t),k=y.durationMS,b=y.elementStartMS,C=y.elementEndMS,w=b<m|(b>p)<<1,D=C>p|(C<=m)<<1,S=D?c*(k/6e4):null,x=i.getRowById(t);return 0===k&&y.startMS--,F({eventRecord:e,taskRecord:e,start:v,end:g,rowId:t.id,children:[],startsOutsideView:w,endsOutsideView:D,width:S,row:x,useEventBuffer:u},y)}},{key:"fillTimeSpanHorizontalPosition",value:function(e){var t=e.elementStartMS,n=e.elementEndMS,r=e.elementDurationMS,i=null!=t&&null!=n&&this.calculateHorizontalPosition(e,t,n,r);return!!i&&(Object.assign(e,i),!0)}},{key:"calculateHorizontalPosition",value:function(e,t,n,r){var i,a=this.scheduler,o=a.timeAxis,l=a.timeAxisViewModel,s=e.startsOutsideView,u=e.endsOutsideView,c=e.eventRecord,d=o.startMS,h=l.getSingleUnitInPixels("minute"),f=null,v=a.getVirtualCoordFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0}),g=!1,m=!1;(s?i=(t-d)/6e4*h:g=-1===(i=a.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==v})),u)?(f=l.totalSize-i+h*((n-o.endMS)/6e4),v=ne.isSafari&&ne.safariVersion<16&&a.features.stickyEvents&&o.endMS&&!s?a.getCoordinateFromDate(o.endMS):i+f):m=-1===v;return m&&!g&&(v=a.getVirtualCoordFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),f>ER&&(1===s?1===u?(i=-100,v=a.timeAxisColumn.width+100):i=v-ER:1===u&&(v=i+ER)),g&&m&&(i=a.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:n}))===(v=a.getVirtualCoordFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:t}))?(c.instanceMeta(a).excluded=!0,null):{left:Math.min(i,v),width:Math.abs(v-i)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:g,clippedEnd:m}}},{key:"fillTimeSpanVerticalPosition",value:function(e,t){var n=this.scheduler,r=e.start,i=e.end,a=n.getResourceLayoutSettings(t),o=a.resourceMarginObject.start,l=a.contentHeight;n.fillTicks&&(e.dataStartMS=r.getTime(),e.dataEndMS=i.getTime()),e.top=Math.max(0,o),n.managedEventSizing&&(e.height=l)}},{key:"getTimeSpanRenderData",value:function(e,t){var n=this.setupRenderData(e,t);return this.fillTimeSpanHorizontalPosition(n)?(this.fillTimeSpanVerticalPosition(n,t),n):null}},{key:"layoutEvents",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3?arguments[3]:i,a=arguments.length>4?arguments[4]:i,o=this,l=o.scheduler,s=l.timeAxis,u=t.reduce((function(t,r){if(n||s.isTimeSpanInAxis(r)){var i=l.generateRenderData(r,e,n);i&&t.push(i)}return t}),[]);u.sort(null!=a?a:o.eventSorter);var c=l.getAppliedResourceHeight(e,r),d=u.filter((function(e){var t=e.eventRecord;return t.isEvent&&!t.meta.excludeFromLayout})),h=l.getEventLayout(e,r),f=l.getEventLayoutHandler(h);if(f){var v=l.getResourceLayoutSettings(e,r),g=v.barMargin,m=v.resourceMarginObject.total,p=v.contentHeight,y=f.applyLayout(d,e,l)||1;c="layoutFn"===f.type?y:y*p+(y-1)*g+m}else if(d.length>0)for(var k=Math.min(d.length,o.maxZIndexStacks),b=0;b<k;b++){d[b].wrapperStyle+=";z-index:".concat(b+5)}return{rowHeight:c,eventsData:u}}},{key:"layoutResourceEvents",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.scheduler,a=r.eventStore,o=r.assignmentStore,l=r.timeAxis,s=a.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate,visibleDateRange:n.visibleDateRange,filter:(o.isFiltered||a.isFiltered)&&function(t){return t.assignments.some((function(t){return t.resource===e.$original&&o.includes(t)}))}}),u=r.getEventsToRender(e,s)||[];return n.layoutEvents(e,u,t)}},{key:"renderEvent",value:function(e,t){var n=this.scheduler,r=e.resourceRecord,a=e.assignmentRecord,o=e.eventRecord,l=a?this.assignmentStore.getOccurrence(a,o).id:e.eventId,s={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},u={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,"aria-label":e.wrapperCls["b-active"]?e.ariaLabel:i,children:[s].concat(z(e.wrapperChildren)),style:{insetBlockStart:e.absoluteTop,insetInlineStart:e.left,height:e.fillSize?t:e.height,width:e.width,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:r.id,eventId:e.eventId,syncId:r.isLinked?"".concat(l,"_").concat(r.id):l},elementData:e,retainElement:(null==a?void 0:a.instanceMeta(n).retainElement)||o.instanceMeta(n).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return o.isMilestone&&"default"!==n.milestoneLayoutMode&&"always-outside"===n.milestoneTextPosition&&"pack"===n.getEventLayout(r).type&&(u.style.insetInlineStart+=(n.getResourceLayoutSettings(r,o.parent).contentHeight-e.height)/2),e.fillSize&&(e.height=t),e.zIndex&&(u.zIndex=e.zIndex),a&&(u.dataset.assignmentId=a.id),e.elementConfig=u,n.afterRenderEvent({renderData:e,rowHeight:t,domConfig:u}),u}},{key:"refreshEventsForResource",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],r=this,a=r.scheduler.store,o=e.isRow?a.getAt(e.dataIndex):a.getById(e),l=r.scheduler.rowManager.getRowFor(o);t&&r.clearResources([o]),l&&o&&(r.renderer({row:l,record:o}),t&&n&&r.onRenderDone())}},{key:"getResourceLayout",value:function(e){var t=this,n=t.resourceMap.get(e.id);if(!n||n.invalid||t.eventStore.lazyLoad){if(t.suspended)return;n=t.layoutResourceEvents(e,!1),t.resourceMap.set(e.id,n)}return n}},{key:"getEventDOMConfigForCurrentView",value:function(e,t,n,r){for(var i,a,o=this,l=o.bufferSize,s=o.scheduler.features,u=s.labels,c=s.eventBuffer,d=(null==c?void 0:c.enabled)||(null==u?void 0:u.enabled)&&(u.left||u.right||u.before||u.after),h=e.eventsData,f=o.fromScroll?o.rowMap.get(t):null,v=[],g=function(){var s=h[m];if(i=n,a=r,(d||0===s.width)&&(i-=l,a+=l),s.left+s.width>=i&&s.left<=a){var u;s.absoluteTop=s.top+t.top;var c=null==f?void 0:f.find((function(e){return e.elementData.eventId===s.eventId&&e.elementData.resourceId===s.resourceId}));c&&(c.style.top=s.absoluteTop),s.hidden=null===(u=t.cls)||void 0===u?void 0:u.contains("b-row-placeholder"),v.push(null!=c?c:o.renderEvent(s,e.rowHeight))}},m=0;m<h.length;m++)g();return v}},{key:"renderer",value:function(e){var t=e.row,n=e.record,r=e.size,i=void 0===r?{}:r,a=this;if(n.isSpecialRow)a.rowMap.delete(t);else{var o=a.viewportCoords,l=o.left,s=o.right,u=a.getResourceLayout(n);if(u){i.height=u.rowHeight,i.transient=!0;var c=a.getEventDOMConfigForCurrentView(u,t,l,s);a.rowMap.set(t,c),a.rendererCalled=!0}}}},{key:"onRenderDone",value:function(){var e,t=this.scheduler,n=this.rowMap,r=this.verticalBufferSize,i=this.fromScroll;if(!t.refreshSuspended){var a,o=this.entityNames,l={event:[]},s=null!==(e=t._scrollTop)&&void 0!==e?e:0,u=s-r,c=s+t._bodyRectangle.height+r,d=r<0,h=!t.managedEventSizing,f=D(o);try{for(f.s();!(a=f.n()).done;){var v=a.value;l[v]=[]}}catch(e){f.e(e)}finally{f.f()}for(var g in n.forEach((function(e,t){if(!t.isDestroyed&&!t.cls.contains("b-row-placeholder")&&(d||t.bottom>u&&t.top<c))for(var n=0;n<e.length;n++){var r=e[n],i=r.elementData,a=i.absoluteTop,s=i.eventRecord,f=i.entityName,v=void 0===f?"event":f;(d||h||s.meta.isDragCreating||s.meta.isResizing||a+i.height>u&&a<c)&&(l[v]||(l[v]=[],o.add(v)),l[v].push(r))}for(var g=0;g<e.length;g++)e[g]=F({},e[g])})),this.fromScroll=!1,l)fa.sync({domConfig:{onlyChildren:!0,children:l[g]},targetElement:t.canvases[g],syncIdField:"syncId",releaseThreshold:t.eventReleaseThreshold,callback:function(e){var n=e.action,r=e.domConfig,a=e.lastDomConfig,o=e.targetElement,l=e.jsx;return LR(t,i,{action:n,domConfig:r,lastDomConfig:a,targetElement:o,jsx:l})}})}}},{key:"clearResources",value:function(e){var t=this;(e=$e.asArray(e)).map(od.asId).forEach((function(e){var n=t.resourceMap.get(e);n&&(n.invalid=!0);var r=t.scheduler.getRowById(e);r&&t.rowMap.delete(r)}))}},{key:"clearAll",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.clearDom,n=void 0!==t&&t,r=e.clearLayoutCache,a=void 0!==r&&r,o=this,l=o.scheduler,s=l.layouts,u=l.foregroundCanvas;if(a&&s)for(var c in s)s[c].clearCache();if(u&&n){u.syncIdMap=u.lastDomConfig=u.releasedIdMap=null;var d,h=D(u.children);try{for(h.s();!(d=h.n()).done;){var f=d.value;f.lastDomConfig=f.elementData=null}}catch(e){h.e(e)}finally{h.f()}}o.resourceMap.clear(),o.rowMap.clear()}}],[{key:"configurable",get:function(){return{bufferSize:150,verticalBufferSize:150,maxZIndexStacks:50}}},{key:"properties",get:function(){return{resourceMap:new a,rowMap:new a,eventConfigs:[],entityNames:new o,toDrawOnProjectRefresh:new o,toDrawOnDataReady:new o}}}])}(Mn.mixin(DR));function LR(e,t,n){var r,i,a=n.action,o=n.domConfig,l=n.lastDomConfig,s=n.targetElement,u=n.jsx,c=e.reactComponent,d=SR[a],h=xR[a];if(!d&&(null===(r=e.processEventContent)||void 0===r||r.call(e,{jsx:u,action:a,domConfig:o,targetElement:s,isRelease:d,reactComponent:c,scrolling:t})),"none"!==a&&null!=o&&null!==(i=o.elementData)&&void 0!==i&&i.isWrap){if(d&&null!=l&&l.elementData){var f,v=l.elementData,g=v.eventRecord,m=v.resourceRecord,p=v.assignmentRecord,y={renderData:l.elementData,element:s,eventRecord:g,resourceRecord:m,assignmentRecord:p};null===(f=e.processEventContent)||void 0===f||f.call(e,{isRelease:d,domConfig:l,targetElement:s,reactComponent:c}),s===li.getActiveElement(s)&&e.focusElement.focus(),e.trigger("releaseEvent",y)}if(h){var k=o.elementData,b=k.eventRecord,C=k.resourceRecord,w=k.assignmentRecord,D={renderData:o.elementData,element:s,isReusingElement:"reuseElement"===a,isRepaint:"reuseOwnElement"===a,eventRecord:b,resourceRecord:C,assignmentRecord:w};"reuseElement"===a&&e.isAnimating&&li.addTemporaryClass(s,"b-reusing-own",50,e,"b-reusing-own-".concat((w||b).id)),e.trigger("renderEvent",D)}}}S(IR,"$name","HorizontalRendering"),IR._$name="HorizontalRendering";var OR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"applyLayout",value:function(e,t,n){var r=this,i=r.scheduler.getResourceWidth(t,n),a=r.scheduler.getResourceLayoutSettings(t,n),o=a.barMargin,l=a.resourceMarginObject,s=l.start,u=l.total,c=r.scheduler.getEventLayout(t,n).type;return r.packEventsInBands(e,(function(e,t,n,a){if("none"===c)e.width=i-u,e.left+=s;else{e.widthFactor=a;var l=e.leftFactor=n.start+t*a,d=Math.round(1/a),h=l/a,f=i-u-o*(d-1);"mixed"===c&&2===d?(e.left+=l*i/5+o,e.width=i-l*i/5-2*o,e.zIndex=5+h):(e.width=a*f,e.appliedMargin=s+o*h,e.left+=l*f+e.appliedMargin)}e.cls["b-sch-event-narrow"]=e.width<r.scheduler.narrowEventWidth}))}}],[{key:"defaultConfig",get:function(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}}])}(eR());OR._$name="VerticalLayout";var PR={releaseElement:1,reuseElement:1},_R={newElement:1,reuseOwnElement:1,reuseElement:1},HR={startDate:1,endDate:1,duration:1},BR=Object.freeze({}),VR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){this.client=this.scheduler=e,this.verticalLayout=new OR({scheduler:e}),B(t,"construct",this,3)([{}])}},{key:"init",value:function(){var e=this,t=e.scheduler,n=e.resourceColumns;n.resourceStore=e.resourceStore,n.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),n.availableWidth=t.timeAxisSubGridElement.offsetWidth}},{key:"resolveRowRecord",value:function(e,t){var n=this,r=n.scheduler,i=e.nodeType?null:e,a=i?i.target:e,o=i?[i.borderOffsetX,i.borderOffsetY]:t,l=(a.nodeType===Element.TEXT_NODE?a.parentElement:a).closest(r.eventSelector);if(l)return r.resourceStore.getById(l.dataset.resourceId);if(!a.closest(".b-sch-timeaxis-cell"))return null;if(!o)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser\n                event instead of element to extract element and coordinates from");if(r.variableColumnWidths||r.resourceStore.isGrouped){var s,u=0,c=D(n.resourceStore);try{for(c.s();!(s=c.n()).done;){var d=s.value;if(d.isSpecialRow||(u+=r.getResourceWidth(d)),u>=o[0])return d}}catch(e){c.e(e)}finally{c.f()}return null}var h=Math.floor(o[0]/n.resourceColumns.columnWidth);return n.allResourceRecords[h]}},{key:"toggleCls",value:function(e,t){var n,r=!(arguments.length>2&&arguments[2]!==i)||arguments[2],a=arguments.length>3&&arguments[3]!==i&&arguments[3],o=null===(n=this.eventMap.get(e.eventId))||void 0===n?void 0:n[e.resourceId];if(o){o.renderData[a?"wrapperCls":"cls"][t]=r;var l=this.client.getElementFromAssignmentRecord(e,a);l&&l.classList[r?"add":"remove"](t)}}},{key:"getDateFromXY",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=e[1];return n||(a=this.translateToScheduleCoordinate(a)),this.scheduler.timeAxisViewModel.getDateFromPosition(a,t,r)}},{key:"translateToScheduleCoordinate",value:function(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-r.scrollY}},{key:"translateToPageCoordinate",value:function(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+r.scrollY}},{key:"getResourceEventBox",value:function(e,t){var n,r,i=e.id,a=t.id,o=((null===(n=this.eventMap.get(i))||void 0===n?void 0:n[a])||BR).renderData;o||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(a)),o=null===(r=this.eventMap.get(i))||void 0===r||null===(r=r[a])||void 0===r?void 0:r.renderData);return o?new pt(o.left,o.top,o.width,o.bottom-o.top):null}},{key:"getScheduleRegion",value:function(e,t,n){var r,i=this,a=i.scheduler,o=pt.from(a.timeAxisSubGridElement,a.timeAxisSubGridElement);e&&(o.left=i.allResourceRecords.indexOf(e)*a.resourceColumnWidth,o.right=o.left+a.resourceColumnWidth);var l=a.timeAxis.startDate,s=a.timeAxis.endDate,u=(null===(r=a.getDateConstraints)||void 0===r?void 0:r.call(a,e,t))||{start:l,end:s},c=a.getCoordinateFromDate(Pl.max(l,u.start)),d=a.getCoordinateFromDate(Pl.min(s,u.end));return n?(o.top=c,o.bottom=d):(o.top=i.translateToPageCoordinate(c),o.bottom=i.translateToPageCoordinate(d)),o}},{key:"getRowRegion",value:function(e,t,n){var r=this.scheduler,i=this.allResourceRecords.indexOf(e)*r.resourceColumnWidth,a=r.timeAxis.startDate,o=r.timeAxis.endDate,l=t?Pl.max(a,t):a,s=n?Pl.min(o,n):o,u=r.getCoordinateFromDate(l),c=r.getCoordinateFromDate(s,!0,!0),d=Math.min(u,c),h=Math.abs(u-c);return new pt(i,d,r.resourceColumnWidth,h)}},{key:"visibleDateRange",get:function(){var e=this.scheduler,t=e.scrollable.y,n=e.scrollable.clientHeight,r=e.getDateFromCoordinate(t)||e.timeAxis.startDate,i=e.getDateFromCoordinate(t+n)||e.timeAxis.endDate;return{startDate:r,endDate:i,startMS:r.getTime(),endMS:i.getTime()}}},{key:"onResourceColumnWidthChange",value:function(e){var t=e.width,n=e.oldWidth,r=this,i=r.scheduler;r.resourceColumns.width=i.timeAxisColumn.width=r.allResourceRecords.length*t,r.clearAll(),r.refresh(Math.abs(t-n)>30),i.onVisibleResourceColumnChange(t,n)}},{key:"attachToProject",value:function(e){B(t,"attachToProject",this,3)([e]),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}},{key:"onProjectRefresh",value:function(){var e=this,t=e.scheduler,n=e.toDrawOnProjectRefresh;t.isVisible?t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):n.size&&e.refresh(),n.clear()):t.whenVisible("refresh",t,[!0])}},{key:"attachToEventStore",value:function(e){B(t,"attachToEventStore",this,3)([e]),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}},{key:"onEventStoreAddConfirmed",value:function(e){var t,n=e.record,r=D(this.client.getElementsFromEventRecord(n));try{for(r.s();!(t=r.n()).done;){t.value.classList.remove("b-iscreating")}}catch(e){r.e(e)}finally{r.f()}}},{key:"onEventStoreRefresh",value:function(e){"batch"===e.action&&(this.refreshAllWhenReady=!0)}},{key:"onEventStoreChange",value:function(e){var t=e.action,n=e.records,r=void 0===n?[]:n,i=e.record,a=e.replaced,l=e.changes;e.isAssign;var s=this,u=new o;switch(r.forEach((function(e){var t,n=null===(t=e.$linkedResources)||void 0===t?void 0:t.filter((function(e){return s.resourceStore.includes(e)}));null==n||n.forEach((function(e){return u.add(e.id)}))})),t){case"sort":case"group":case"move":case"remove":case"batch":return;case"dataset":return void s.refreshAllResourcesWhenReady();case"add":break;case"replace":a.forEach((function(e){_(e,2)[1].resources.map((function(e){return u.add(e.id)}))})),s.clearResources(u);break;case"removeall":case"filter":return s.clearAll(),void s.refresh();case"update":var c=0;return"startDate"in l&&c++,"endDate"in l&&c++,"duration"in l&&c++,void((!(i.$entity?!Object.keys(l).some((function(e){return!i.$entity.getField(e)})):!Object.keys(l).some((function(e){return!HR[e]})))||c||"percentDone"in l||"inactive"in l||"segments"in l)&&(s.shouldWaitForInitializeAndEngineReady?s.refreshResourcesWhenReady(u):(s.clearResources(u),s.refresh())))}s.refreshResourcesWhenReady(u)}},{key:"attachToResourceStore",value:function(e){var n=this;B(t,"attachToResourceStore",this,3)([e]),n.refreshAllWhenReady=!0,n.resourceColumns&&(n.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:function(){return n.scheduler.unmaskBody()},thisObj:n,prio:1}),n.initialized&&n.scheduler.isPainted&&(n.firstResource=n.lastResource=null,n.clearAll(),n.renderer())}},{key:"onResourceStoreChange",value:function(e){var t=e.source,n=e.action,r=e.records,i=void 0===r?[]:r,a=e.record,l=e.replaced,s=e.changes,u=this,c=l?l.map((function(e){return e[1]})):i,d=new o(c.map((function(e){return e.id})));u.firstResource=u.lastResource=null,t._allResourceRecords=null;var h=t.allResourceRecords;if(u.scheduler.isEngineReady){switch(n){case"update":null!=s&&s.id?u.clearResources([s.id.oldValue,s.id.value]):u.clearResources([a.id]);break;case"filter":u.clearAll()}s&&"columnWidth"in s&&(a.instanceMeta(u.scheduler).columnWidth=a.columnWidth,u.clearAll()),u.refresh(!0)}else{switch(n){case"dataset":case"remove":case"removeall":return void u.refreshAllResourcesWhenReady();case"replace":case"add":if(!t.isGrouped)for(var f=c.reduce((function(e,t){return Math.min(e,h.indexOf(t))}),h.length),v=f;v<h.length;v++)d.add(h[v].id)}u.refreshResourcesWhenReady(d)}}},{key:"onResourceStoreRefresh",value:function(e){var t=e.action,n=this;"sort"!==t&&"group"!==t||(n.firstResource=n.lastResource=n.resourceStore._allResourceRecords=null,n.clearAll(),n.refresh())}},{key:"attachToAssignmentStore",value:function(e){B(t,"attachToAssignmentStore",this,3)([e]),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}},{key:"onAssignmentStoreChange",value:function(e){var t=e.action,n=e.records,r=void 0===n?[]:n,i=e.replaced,a=e.changes,l=this,s=new o(r.map((function(e){return e.resourceId})));if(l.scheduler.isEngineReady){switch(t){case"add":case"remove":l.clearResources(s);break;case"filter":l.clearAll();break;case"update":if("resourceId"in a&&s.add(a.resourceId.oldValue),!Object.keys(a).filter((function(e){return"resource"!==e&&"event"!==e})).length)return;l.clearResources(s)}l.refresh(!0)}else{switch(a&&"resourceId"in a&&s.add(a.resourceId.oldValue),t){case"removeall":return void l.refreshAllResourcesWhenReady();case"replace":i.forEach((function(e){var t=_(e,2),n=t[0],r=t[1];s.add(n.resourceId),s.add(r.resourceId)}))}l.refreshResourcesWhenReady(s)}}},{key:"onAssignmentStoreRefresh",value:function(e){var t=e.action;e.records,"batch"===t&&(this.clearAll(),this.refreshAllResourcesWhenReady())}},{key:"refreshRows",value:function(e,t){t&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}},{key:"repaintEventsForResource",value:function(e){var t=this.scheduler.resourceColumns;this.renderResource(e),"layoutFn"===this.scheduler.internalEventLayout.type&&(t.updateWidthCache(),t.refresh())}},{key:"updateFromHorizontalScroll",value:function(e){e!==this.prevScrollX&&(this.fromScroll=!0,this.renderer(),this.prevScrollX=e)}},{key:"updateFromVerticalScroll",value:function(){this.fromScroll=!0,this.renderer()}},{key:"scrollResourceIntoView",value:function(e,t){var n=this.scheduler,r=this.allResourceRecords.indexOf(e)*n.resourceColumnWidth;return n.scrollHorizontallyTo(r,t)}},{key:"allResourceRecords",get:function(){return this.scheduler.resourceStore.allResourceRecords}},{key:"onViewportResize",value:function(e){this.resourceColumns.availableWidth!==e&&(this.resourceColumns.availableWidth=e,this.scheduler.refreshVirtualScrollbars()),this.renderer()}},{key:"resourceColumns",get:function(){var e;return null===(e=this.scheduler.timeAxisColumn)||void 0===e?void 0:e.resourceColumns}},{key:"onLocaleChange",value:function(){this.clearAll()}},{key:"onDragAbort",value:function(){}},{key:"onBeforeRowHeightChange",value:function(){}},{key:"onTimeAxisViewModelUpdate",value:function(){}},{key:"updateElementId",value:function(){}},{key:"releaseTimeSpanDiv",value:function(){}},{key:"getConnectorStartSide",value:function(e){return"top"}},{key:"getConnectorEndSide",value:function(e){return"bottom"}},{key:"refreshResourcesWhenReady",value:function(e){var t=this;this.clearResources(e),e.forEach((function(e){return t.toDrawOnProjectRefresh.add(e)}))}},{key:"refreshAllResourcesWhenReady",value:function(){this.clearAll(),this.refreshAllWhenReady=!0}},{key:"resourceRange",get:function(){return this.getResourceRange(!0)}},{key:"visibleResources",get:function(){var e=this.getResourceRange(),t=e.first,n=e.last;return{first:this.allResourceRecords[t],last:this.allResourceRecords[n]}}},{key:"getResourceRange",value:function(e){var t=this.scheduler,n=this.resourceStore,r=t.resourceColumnWidth,i=t.scrollX,a=t.timeAxisSubGrid.scrollable.scrollWidth,o=e?this.resourceBufferSize:0,l=i-o,s=i+a+o;if(null==n||!n.count)return{first:-1,last:-1};if(t.variableColumnWidths){var u,c,d=0,h=0;return this.allResourceRecords.forEach((function(e,n){if(e.instanceMeta(t).insetStart=c=h,h=c+t.getResourceWidth(e),c>s)return!1;h>l&&null==u?u=n:c<s&&(d=n)})),{first:u,last:d}}return{first:Math.max(Math.floor(i/r)-o,0),last:Math.min(Math.floor((i+t.timeAxisSubGrid.width)/r)+o,this.allResourceRecords.length-1)}}},{key:"dateRange",get:function(){var e=this.scheduler,t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);var n=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return n||(n=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:n,bottomDate:t}}},{key:"getTimeSpanRenderData",value:function(e,t){var n,r=this,i=r.scheduler,a=e.preamble,o=e.postamble,l=i.variableColumnWidths,s=(null===(n=i.features.eventBuffer)||void 0===n?void 0:n.enabled)&&r.isProVerticalRendering&&(a||o)&&!e.isMilestone,u=s?"wrapStartDate":"startDate",c=s?"wrapEndDate":"endDate",d=e.isBatchUpdating&&e.hasBatchedChange(u)&&!s?e.get(u):e[u],h=e.isBatchUpdating&&e.hasBatchedChange(c)&&!s?e.get(c):e[c],f=i.getResourceLayoutSettings(t).resourceMarginObject.total,v=i.getCoordinateFromDate(d),g=t.instanceMeta(i),m=l?g.insetStart:r.allResourceRecords.indexOf(t)*i.resourceColumnWidth,p=i.getResourceWidth(t),y=p-f,k=d.getTime(),b=h.getTime(),C=i.getCoordinateFromDate(h),w=C-v;return-1===C&&(C=v+(w=Math.round((b-k)*i.timeAxisViewModel.getSingleUnitInPixels("millisecond")))),{eventRecord:e,resourceRecord:t,left:m,top:v,bottom:C,resourceWidth:p,width:y,height:w,startDate:d,endDate:h,startDateMS:k,endDateMS:b,useEventBuffer:s,children:[],start:d,end:h,startMS:k,endMS:b}}},{key:"eventSorter",value:function(e,t){var n=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,a=t.dataEndMs||t.endDateMS,o=e.isModel?e.name:e.eventRecord.name,l=t.isModel?t.name:t.eventRecord.name;return n-i||a-r||(o<l?-1:o==l?0:1)}},{key:"layoutEvents",value:function(e,t){var n=arguments.length>3?arguments[3]:i,r=arguments.length>4?arguments[4]:i,a=this,o=a.scheduler,l=o.variableColumnWidths,s=e.id,u=e.instanceMeta(o),c=n?"".concat(s,"-").concat(n.id):s,d=a.resourceMap.set(c,{}).get(c),h=a.allResourceRecords.indexOf(e),f=t.reduce((function(t,n){if(n.isScheduled){var r=o.generateRenderData(n,e,!1),i={renderData:r};Be.getMapPath(a.eventMap,r.eventId,{})[s]=i,d[r.eventId]=i,r.fillSize?(r.left=l?u.insetStart:h*o.resourceColumnWidth,r.width=o.getResourceWidth(e)):t.push(r)}return t}),[]);return f.sort(null!=r?r:a.eventSorter),a.verticalLayout.applyLayout(f,e,n),d}},{key:"layoutResourceEvents",value:function(e,t,n){var r=this.scheduler,i=r.assignmentStore,a=r.eventStore,o=r.timeAxis,l=a.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:null!=t?t:o.startDate,endDate:null!=n?n:o.endDate,filter:(i.isFiltered||a.isFiltered)&&function(t){return t.assignments.some((function(t){return t.resource===e&&i.includes(t)}))}});return l=r.getEventsToRender(e,l),this.layoutEvents(e,l)}},{key:"addTemporaryDragElement",value:function(e){var t=this.scheduler,n=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});n.top=n.row?n.top+n.row.top:t.getResourceEventBox(e,e.resource,!0).top;var r=this.renderEvent({renderData:n}),i=r.dataset;delete r.tabIndex,delete i.eventId,delete i.resourceId,delete i.assignmentId,delete i.syncId,i.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;var a=li.createElement(r,{reactCallback:function(e){var n,r=e.jsx,i=e.domConfig,a=e.targetElement,o=t.reactComponent;r&&(null===(n=t.processEventContent)||void 0===n||n.call(t,{jsx:r,action:"add",domConfig:i,targetElement:a,isRelease:!1,reactComponent:o}))}});return a.innerElement=a.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,a}},{key:"renderEvent",value:function(e){var t=this.scheduler,n=e.renderData,r=n.resourceRecord,a=n.assignmentRecord,o=n.eventRecord,l={className:n.wrapperCls,tabIndex:-1,"aria-label":n.wrapperCls["b-active"]?n.ariaLabel:i,children:[{role:"presentation",className:n.cls,style:(n.internalStyle||"")+(n.style||""),children:n.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}}].concat(z(n.wrapperChildren)),style:S(S(S(S(S({top:n.top},t.rtl?"right":"left",n.left),"height",o.isMilestone?"1em":n.height),"width",n.width),"style",n.wrapperStyle||""),"fontSize",o.isMilestone?Math.min(n.width,40):null),dataset:{resourceId:r.id,eventId:n.eventId,syncId:a?this.assignmentStore.getOccurrence(a,o).id:n.eventId},elementData:e,retainElement:(a||o).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return l.className["b-sch-vertical"]=1,n.zIndex&&(l.style.zIndex=n.zIndex),a&&(l.dataset.assignmentId=a.id),n.elementConfig=e.elementConfig=l,t.afterRenderEvent({renderData:n,domConfig:l}),l}},{key:"renderResource",value:function(e,t,n){var r,i,a=this,o=null!==(r=null==t?void 0:t.getTime())&&void 0!==r?r:a.topDateMS,l=null!==(i=null==n?void 0:n.getTime())&&void 0!==i?i:a.bottomDateMS,s=[],u=a.resourceMap.get(e.id);for(var c in u||(u=a.layoutResourceEvents(e,t,n)),u){var d=u[c],h=d.renderData,f=h.endDateMS,v=h.startDateMS,g=h.eventRecord;if(f>=o&&v<=l&&!g.instanceMeta(a.scheduler).hasTemporaryDragElement){var m,p="b-released"!==(null===(m=d.elementConfig)||void 0===m?void 0:m.className)&&d.elementConfig||a.renderEvent(d);s.push(p)}}return s}},{key:"shouldWaitForInitializeAndEngineReady",get:function(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}},{key:"renderer",value:function(){var e=this,t=e.scheduler,n=e.dateRange,r=n.topDate,a=n.bottomDate,o=[],l=[],s={event:[]},u=e.allResourceRecords,c=e.fromScroll,d=e.resourceRange,h=d.first,f=d.last;if(!e.shouldWaitForInitializeAndEngineReady){if(!Pl.isEqual(r,e.topDate)||!Pl.isEqual(a,e.bottomDate)){e.topDate=r,e.bottomDate=a,e.topDateMS=r.getTime(),e.bottomDateMS=a.getTime();var v=e.timeView.range={startDate:r,endDate:a};t.internalOnVisibleDateRangeChange(v)}if(-1!==h&&-1!==f){if("layoutFn"===t.internalEventLayout.type&&h!==i)e.renderResourceCustomLayout(o);else for(var g=h;g<=f;g++)o.push.apply(o,e.renderResource(u[g]));var m=e.resourceRange;h=m.first,f=m.last}t.getForegroundDomConfigs(l),o.push.apply(o,l);for(var p=0,y=o;p<y.length;p++){var k=y[p],b=k.elementData.renderData.entityName,C=void 0===b?"event":b;s[C]||(s[C]=[]),s[C].push(k)}for(var w in s)fa.sync({domConfig:{onlyChildren:!0,children:s[w]},targetElement:t.canvases[w],syncIdField:"syncId",releaseThreshold:t.eventReleaseThreshold,callback:function(e){var n=e.action,r=e.domConfig,i=e.lastDomConfig,a=e.targetElement,o=e.jsx;NR(t,c,{domConfig:r,jsx:o,action:n,targetElement:a,lastDomConfig:i})}});if(e.firstResource!==h||e.lastResource!==f){var D=e.resourceColumns.visibleResources={firstResource:h,lastResource:f};e.firstResource=h,e.lastResource=f,t.onVisibleResourceRangeChange(D),t.trigger("resourceRangeChange",D)}this.fromScroll=!1}}},{key:"refresh",value:function(e){var t=this;this.scheduler.runWithTransition((function(){return t.renderer()}),e)}},{key:"refreshResources",value:function(e){e=e.map((function(e){var t;return null!==(t=e.id)&&void 0!==t?t:e})),this.clearResources(e),this.refresh()}},{key:"refreshEventsForResource",value:function(e){this.refreshResources([e.id])}},{key:"onRenderDone",value:function(){}},{key:"timeView",get:function(){return this.scheduler.timeView}},{key:"clearResources",value:function(e){var t=this.resourceMap,n=this.eventMap;e.forEach((function(e){t.has(e)&&(Object.values(t.get(e)).forEach((function(t){var r=t.renderData.eventId;delete n.get(r)[e]})),t.delete(e))}))}},{key:"clearAll",value:function(){this.resourceMap.clear(),this.eventMap.clear()}}],[{key:"properties",get:function(){return{eventMap:new a,resourceMap:new a,releasedElements:{},toDrawOnProjectRefresh:new o,resourceBufferSize:1}}}])}(Mn.mixin($i,DR));function NR(e,t,n){var r,i=n.domConfig,a=n.jsx,o=n.action,l=n.targetElement,s=n.lastDomConfig,u=e.reactComponent;if(e.isEventElement(i)||a||null!=i&&null!==(r=i.elementData)&&void 0!==r&&r.jsx){var c,d=PR[o],h=_R[o];if(null!==(c=e.processEventContent)&&void 0!==c&&c.call(e,{action:o,domConfig:i,isRelease:!1,targetElement:l,reactComponent:u,jsx:a,scrolling:t}))return;if(d&&e.isEventElement(s)&&!s.isReleased){var f,v=s.elementData.renderData,g={renderData:v,assignmentRecord:v.assignmentRecord,eventRecord:v.eventRecord,resourceRecord:v.resourceRecord,element:l};null===(f=e.processEventContent)||void 0===f||f.call(e,{isRelease:d,domConfig:s,targetElement:l,reactComponent:u}),l===li.getActiveElement(l)&&e.focusElement.focus(),e.trigger("releaseEvent",g)}if(h){var m=i.elementData.renderData,p={renderData:m,assignmentRecord:m.assignmentRecord,eventRecord:m.eventRecord,resourceRecord:m.resourceRecord,element:l,isReusingElement:"reuseElement"===o,isRepaint:"reuseOwnElement"===o};p.reusingElement="reuseElement"===o,e.trigger("renderEvent",p)}}}function zR(e,t){return e===t.length-1}function jR(e,t){return t===e.cells[e.cells.length-1]}VR._$name="VerticalRendering";var WR=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"startDate",null),S(e,"endDate",null),S(e,"levels",[]),S(e,"size",null),e}return R(t,e),w(t,[{key:"range",set:function(e){var t=e.startDate,n=e.endDate,r=this;if(r.startDate-t||r.endDate-n){var i,a=r.client;if(r.startDate=t,r.endDate=n,"width"===r.sizeProperty&&null!=a&&a.hideHeaders||"height"===r.sizeProperty&&null!=a&&null!==(i=a.verticalTimeAxisColumn)&&void 0!==i&&i.hidden)return;r.refresh()}}},{key:"buildCells",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:this.startDate,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.endDate,a=this,o=a.sizeProperty,l=a.client||{},s=l.stickyHeaders,u=l.isVertical,c=[],d=a.levels.length,h=a.levels.map((function(e,i){var l,c=s&&(u||i<d-1);return{className:S(S(S(S({"b-sch-header-row":1},"b-sch-header-row-".concat(e.position),1),"b-sch-header-row-main",i===a.model.viewPreset.mainHeaderLevel),"b-lowest",zR(i,a.levels)),"b-sticky-header",c),syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:"headerRow".concat(i),headerPosition:e.position},children:null===(l=e.cells)||void 0===l?void 0:l.filter((function(e){return e.start<n&&e.end>t})).map((function(t,n){return{role:"presentation",className:S(S(S({"b-sch-header-timeaxis-cell":1},t.headerCellCls,t.headerCellCls),"b-align-".concat(t.align),t.align),"b-last",jR(e,t)),dataset:F({tickIndex:t.index},r.DEBUG&&{date:t.start.getTime()}),style:S(S(S({},a.positionProperty,t.coord),o,t.width),"min-".concat(o),t.width),children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":c},html:t.value}]}}))}}));return null===(e=a.client)||void 0===e||e.getHeaderDomConfigs(c),h.push.apply(h,c),{onlyChildren:!0,syncOptions:{releaseThreshold:0},children:h}}},{key:"render",value:function(e){B(t,"render",this,3)([e]),this.refresh(!0)}},{key:"refresh",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:!this.levels.length,t=this,n=t.model.columnConfig,r=t.levels,a=r.length;if(e){r.length=0,n.forEach((function(e,t){return r[t]={position:t,cells:e}})),t.size=r[0].cells.reduce((function(e,t){return e+t.width}),0);var o=t.element.parentElement;o&&(r.length!==a||e)&&(o.classList.remove("b-sch-timeaxiscolumn-levels-".concat(a)),o.classList.add("b-sch-timeaxiscolumn-levels-".concat(r.length)))}t.startDate&&t.endDate&&(fa.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}},{key:"widgetClass",get:function(){return"b-timeaxis"}}])}(Lo);S(WR,"$name","TimeAxisBase"),S(WR,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),WR._$name="TimeAxisBase";var $R=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"positionProperty",get:function(){return"insetInlineStart"}},{key:"width",get:function(){return this.size}},{key:"onModelUpdate",value:function(){var e;(null===(e=this.owner)||void 0===e||!e.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}},{key:"updateModel",value:function(e){this.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}])}(WR);S($R,"$name","HorizontalTimeAxis"),S($R,"type","horizontaltimeaxis"),S($R,"configurable",{model:null,sizeProperty:"width"}),$R._$name="HorizontalTimeAxis";var UR=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"firstResource",-1),S(e,"lastResource",-1),e}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;e.scheduler._resourceColumns=n,B(t,"construct",this,3)([e]),null!=n.imagePath&&n.element.classList.add("b-has-images"),fr.on({element:n.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:n})}},{key:"changeShowAvatars",value:function(e){var t;return null===(t=this.avatarRendering)||void 0===t||t.destroy(),e&&(this.avatarRendering=new yc({element:this.element})),e}},{key:"updateShowAvatars",value:function(){this.isConfiguring||this.refresh()}},{key:"updateResourceStore",value:function(e){var t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}},{key:"onResourceStoreDataChange",value:function(e){var t=e.action,n=this;n.getConfig("fillWidth"),n.getConfig("fitWidth"),n.updateWidthCache();var r=n.element,i=n.totalWidth;n.scheduler.variableColumnWidths?n._fillWidth=n._fitWidth=!1:(n._fillWidth=n.configuredFillWidth,n._fitWidth=n.configuredFitWidth),i!==n.width&&(li.setLength(r,"width",i),n.column.set("width",i,n.column.grid.isConfiguring)),"removeall"===t&&(r.innerHTML=""),("remove"===t||"add"===t||"filter"===t||n.fitWidth||n.fillWidth)&&n.refreshWidths(),n.column.grid.toggleEmptyText()}},{key:"totalWidth",get:function(){return this.updateWidthCache()}},{key:"updateWidthCache",value:function(){var e=0,t=this.scheduler;return t.variableColumnWidths=!1,t.resourceStore.forEach((function(n){var r=n.instanceMeta(t);null==r.columnWidth&&n.columnWidth&&(r.columnWidth=n.columnWidth),r.insetStart=e,r.insetEnd=e+t.getResourceWidth(n),null==r.columnWidth?e+=t.resourceColumnWidth:(e+=r.columnWidth,t.variableColumnWidths=!0)})),e}},{key:"changeColumnWidth",value:function(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}},{key:"updateColumnWidth",value:function(e,t){var n=this;n.refreshingWidths||n.refreshWidths(),n.isConfiguring||(n.resourceStore.isGrouped&&n.updateWidthCache(),n.refresh(),n.trigger("columnWidthChange",{width:e,oldWidth:t}))}},{key:"changeFillWidth",value:function(e){return this.configuredFillWidth=e}},{key:"updateFillWidth",value:function(){this.isConfiguring||this.refreshWidths()}},{key:"changeFitWidth",value:function(e){return this.configuredFitWidth=e}},{key:"updateFitWidth",value:function(){this.isConfiguring||this.refreshWidths()}},{key:"getImageURL",value:function(e){return Le.joinPaths([this.imagePath||"",e||""])+(null!=e&&e.includes(".")?"":this.imageExtension)}},{key:"updateImagePath",value:function(){this.isConfiguring||this.refresh()}},{key:"updateAvailableWidth",value:function(e){this.refreshWidths()}},{key:"refreshWidths",value:function(){var e,t=this,n=t.availableWidth,r=t.configuredColumnWidth,i=null===(e=t.resourceStore)||void 0===e?void 0:e.count;if(n&&i&&!t.scheduler.variableColumnWidths){t.refreshingWidths=!0;var a=t.fitWidth||t.fillWidth&&r*i<n?Math.floor(n/i):r,o=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-a)>30;li.addTemporaryClass(t.element,"b-animating",o?300:0,t),t.columnWidth=a,t.refreshingWidths=!1}}},{key:"visibleResources",set:function(e){var t=e.firstResource,n=e.lastResource;this.firstResource=t,this.lastResource=n,this.updateWidthCache(),this.refresh()}},{key:"refresh",value:function(){var e=this,t=e.firstResource,n=e.scheduler,r=e.resourceStore,i=e.lastResource,a=r.isGrouped&&r.groupers[0].field;e.element.classList.toggle("b-grouped",Boolean(a));var o=e.renderResourceHeaders(t,i);fa.sync({domConfig:{onlyChildren:!0,children:o},targetElement:e.element,syncIdField:"resourceId",callback:function(e){var t,r=e.jsx,i=e.targetElement,a=e.domConfig;null===(t=n.processResourceHeader)||void 0===t||t.call(n,{jsx:r,targetElement:i,domConfig:a})}})}},{key:"renderResourceHeaders",value:function(e,t){var n=this,r=n.scheduler,i=n.resourceStore,a=r.variableColumnWidths,o=i.isGrouped&&i.groupers[0].field,l=[];if(!n.column.grid.isConfiguring&&e>-1&&t>-1&&t<i.count)for(var s,u=e;u<=t;u++){var c,d=i.allResourceRecords[u],h=d.instanceMeta(i).groupParent,f=null==h?void 0:h.groupChildren;if(o&&h.id!==(null===(c=s)||void 0===c?void 0:c.dataset.resourceId)){var v,g=f[0].instanceMeta(r).insetStart,m=f[f.length-1].instanceMeta(r).insetEnd-g,p=null===(v=r.features.group)||void 0===v?void 0:v.renderer,y=f[0][o],k="text";if(p){var b=d.instanceMeta(i).groupParent,C=b.meta,w=C.groupRowFor,D=C.childCount;"string"==typeof(y=r.features.group.groupRenderer({groupRowFor:w,groupRecords:b.groupChildren,count:D}))&&y.includes("<")?k="html":"object"===W(y)&&(k="children",y=[y])}s={className:"b-resourceheader-group-cell",dataset:{resourceId:h.id},style:{left:g,width:m},children:[{className:"b-resourceheader-group-text-wrap",children:Array.isArray(y)?y:[S({tag:"span"},k,y)]},{className:"b-resourceheader-group-children",children:[]}]},l.push(s)}var x=d.instanceMeta(r),E=x.columnWidth||n.columnWidth,R=o?x.insetStart-s.style.left:a?x.insetStart:u*n.columnWidth,T={tabIndex:0,className:new Ct({"b-resourceheader-cell":1}),dataset:{resourceId:d.id},style:S(S({},r.rtl?"right":"left",R),"width",E),children:[]};if(n.headerRenderer){var M=n.headerRenderer({elementConfig:T,resourceRecord:d});M&&("string"==typeof M?T.html=M:"object"===W(M)&&(T.children=[M]))}else{var F=void 0;if(d.imageUrl)F=d.imageUrl;else if(null!=n.imagePath&&!1!==d.image){var A,I=d.image||(null===(A=d.name)||void 0===A?void 0:A.toLowerCase());F=I&&n.getImageURL(I)}T.children.push(n.showAvatars&&n.avatarRendering.getResourceAvatar({resourceRecord:d,initials:d.initials,color:d.eventColor,iconCls:d.iconCls,defaultImageUrl:n.defaultImageName&&n.getImageURL(n.defaultImageName),imageUrl:F}),{tag:"span",className:"b-resource-name",html:Le.encodeHtml(d.name)})}o?s.children[1].children.push(T):l.push(T)}return l}},{key:"onResourceMouseEvent",value:function(e){var t=e.target.closest(".b-resourceheader-cell"),n=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+Le.capitalize(e.type),{resourceRecord:n,event:e})}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return delete n.resourceStore,delete n.column,delete n.type,n}}])}(Lo);S(UR,"$name","ResourceHeader"),S(UR,"type","resourceheader"),S(UR,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),UR._$name="ResourceHeader";var GR=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"headerHoverable",!1),e}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this;e.disableRendererWarning=!0,B(t,"construct",this,3)(arguments),n.thisObj=n,n.grid._timeAxisColumn=n,n.timeAxisViewModel=n.grid.timeAxisViewModel,n.mode=n.mode,n.grid.ion({paint:"onTimelinePaint",thisObj:n,once:!0}),Na.ion({locale:n.updateHeaderAriaLabel,thisObj:n})}},{key:"updateHeaderAriaLabel",value:function(){var e=this.grid,n=e.visibleDateRange,r=Pl.format(null==n?void 0:n.startDate,e.displayDateFormat),i=Pl.format(null==n?void 0:n.endDate,e.displayDateFormat);return B(t,"updateHeaderAriaLabel",this,3)([this.L(this.ariaLabel||"L{TimeAxisColumn.ariaLabel}")(r,i)])}},{key:"doDestroy",value:function(){var e,n;null===(e=this.resourceColumns)||void 0===e||e.destroy(),null===(n=this.timeAxisView)||void 0===n||n.destroy(),B(t,"doDestroy",this,3)([])}},{key:"mode",get:function(){return this.get("mode")},set:function(e){var t=this,n=t.grid;t.set("mode",e),"horizontal"===e?t.timeAxisView=new $R({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:n,client:n}):"vertical"===e&&(t.resourceColumns=UR.new({column:t,scheduler:n,resourceStore:n.resourceStore,imagePath:n.resourceImagePath,imageExtension:n.resourceImageExtension,defaultImageName:n.defaultResourceImageName},n.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}},{key:"onViewModelUpdate",value:function(e){var t=e.source,n=this;n.grid.timeAxisSubGrid.collapsed||0===t.totalSize||("horizontal"===n.mode?(n.refreshHeader(!0),n.width=t.totalSize,n.grid.refresh(),n.subGrid.refreshFakeScroll()):"vertical"===n.mode&&n.grid.refreshRows())}},{key:"onTimelinePaint",value:function(e){var t,n=e.firstPaint,r=this;r.subGrid.insertRowsBefore&&(n&&(r.updateHeaderAriaLabel(),r.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===r.mode&&(r.refreshHeader(),null===(t=r.grid)||void 0===t||t.onHeightChange())))}},{key:"onCellFocus",value:function(){this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel"))}},{key:"refreshHeader",value:function(e){var t=this,n=t.element;n&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(i,i,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(n.querySelector(".b-grid-header-text").remove(),t.timeAxisView.render(n))):"vertical"===t.mode&&(t.resourceColumns.currentElement?t.resourceColumns.refresh():(n.innerHTML="",t.resourceColumns.render(n))))}},{key:"defaultRenderer",value:function(e){var n,r=this.grid;if(!r.isTimelineHistogramBase)return r.project.isInitialCommitPerformed||r.project.isDelayingCalculation||null!==(n=r.eventStore)&&void 0!==n&&n.lazyLoad?(r.currentOrientation.renderer(e),B(t,"defaultRenderer",this,3)([e])):""}},{key:"timeAxisViewModel",get:function(){return this._timeAxisViewModel},set:function(e){var t=this;t.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}},{key:"getState",value:function(){var e=B(t,"getState",this,3)([]);return delete e.width,delete e.flex,e}}],[{key:"defaults",get:function(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,ariaLabel:null,mode:null,region:"normal",exportable:!1,htmlEncode:!1,id:"timeaxiscolumn"}}},{key:"autoExposeFields",get:function(){return!0}}])}(_n(lC));S(GR,"$name","TimeAxisColumn"),S(GR,"type","timeAxis"),S(GR,"fields",[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]),bg.registerColumnType(GR),GR._$name="TimeAxisColumn";var YR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildHorizontalCells",value:function(){var e=this,t=e.client,n=null==t?void 0:t.stickyHeaders,i=[],a=e.levels.reduce((function(t,i,a){var o;i.cells&&t.push.apply(t,z(null===(o=i.cells)||void 0===o?void 0:o.filter((function(t){return t.start<e.endDate&&t.end>e.startDate})).map((function(t,i,o){return{role:"presentation",className:S(S(S(S({"b-sch-header-timeaxis-cell":1},t.headerCellCls,t.headerCellCls),"b-align-".concat(t.align),t.align),"b-last",i===o.length-1),"b-lowest",a===e.levels.length-1),dataset:F({tickIndex:t.index,cellId:"".concat(a,"-").concat(t.index),headerPosition:a},r.DEBUG&&{date:t.start.getTime()}),style:{top:t.coord,height:t.width,minHeight:t.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":n},html:t.value}]}}))));return t}),[]);return null==t||t.getHeaderDomConfigs(i),a.push.apply(a,i),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:a}}},{key:"height",get:function(){return this.size}}],[{key:"configurable",get:function(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}}])}(WR);S(YR,"$name","VerticalTimeAxis"),YR._$name="VerticalTimeAxis";var qR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateHeaderAriaLabel",value:function(){var e=this.grid,n=e.visibleDateRange,r=Pl.format(null==n?void 0:n.startDate,e.displayDateFormat),i=Pl.format(null==n?void 0:n.endDate,e.displayDateFormat);return B(t,"updateHeaderAriaLabel",this,3)([this.L(this.ariaLabel||"L{TimeAxisColumn.ariaLabel}")(r,i)])}},{key:"isFocusable",get:function(){return!0}},{key:"construct",value:function(e){var n=this;B(t,"construct",this,3)(arguments),n.view=new YR({model:n.grid.timeAxisViewModel,client:n.grid}),n.grid.ion({paint:"onTimelinePaint",thisObj:n,once:!0}),Na.ion({locale:n.updateHeaderAriaLabel,thisObj:n})}},{key:"defaultRenderer",value:function(e){var t=e.cellElement,n=e.size;this.view.render(t),n.height=this.view.height}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return delete n.id,delete n.region,delete n.type,delete n.field,delete n.ariaLabel,delete n.cellAriaLabel,n}},{key:"onTimelinePaint",value:function(e){e.firstPaint&&this.updateHeaderAriaLabel()}}],[{key:"defaults",get:function(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1,ariaLabel:null}}}])}(yg);S(qR,"$name","VerticalTimeAxisColumn"),S(qR,"type","verticalTimeAxis"),bg.registerColumnType(qR),qR._$name="VerticalTimeAxisColumn";var KR={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},XR=function(e,t){return e&&t?e.unit===t.unit&&e.magnitude===t.magnitude:e===t},ZR=Object.freeze({}),JR=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"timeCellSelector",".b-sch-timeaxis-cell"),S(e,"resourceTimeRangeSelector",".b-sch-resourcetimerange"),e}return R(t,e),w(t,[{key:"afterConstruct",value:function(){B(t,"afterConstruct",this,3)([]),this.ion({scroll:"onVerticalScroll",splitterDragStart:"internalOnSplitterDragStart",thisObj:this})}},{key:"onPaintOverride",value:function(){}},{key:"store",get:function(){return B(t,"store",this,1)},set:function(e){V(t,"store",e,this,1,1)}},{key:"visibleResources",get:function(){var e,t,n=this;return n.isVertical?n.currentOrientation.visibleResources:{first:n.store.getById(null===(e=n.firstVisibleRow)||void 0===e?void 0:e.id),last:n.store.getById(null===(t=n.lastVisibleRow)||void 0===t?void 0:t.id)}}},{key:"onLocaleChange",value:function(){this.currentOrientation.onLocaleChange(),B(t,"onLocaleChange",this,3)([])}},{key:"changeCreateEventOnDblClick",value:function(e){Ne.deprecate("scheduler","7.0.0","createEventOnDblClick is deprecated use autoCreate instead"),this.autoCreate=e}},{key:"changeAutoCreate",value:function(e){if(e){var n=W(e);"object"!==n&&(e={gesture:"string"===n?e:"dblclick"}),(e=rn.merge(e,t.$meta.config.autoCreate)).duration&&(e.duration=Pl.parseDuration(e.duration))}return e}},{key:"updateAutoCreate",value:function(e,t){(null==e?void 0:e.gesture)!==(null==t?void 0:t.gesture)&&(this.detachListeners("scheduleAutoCreateGesture"),this.ion(S(S({name:"scheduleAutoCreateGesture"},"schedule".concat(e.gesture),"onScheduleAutoCreateGesture"),"thisObj",this))),t||this.updateLocalization()}},{key:"onScheduleAutoCreateGesture",value:(l=f((function(e){var t=this,n=e.domEvent,r=e.time,i=e.resourceRecord;return L().mark((function e(){var a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(a=t).autoCreate||ZR,l=o.snapType||"floor",s=o.step,u=s?Pl[l](r,Pl.parseDuration(s)):a.timeAxis["".concat(l,"Date")](r),e.next=3,a.trigger("beforeAutoCreate",{domEvent:n,date:u,resourceRecord:i});case 3:if(e.t0=e.sent,!1===e.t0){e.next=6;break}return e.abrupt("return",a.createEvent(u,i,!0));case 6:case"end":return e.stop()}}),e)}))()})),function(e){return l.apply(this,arguments)})},{key:"onVerticalScroll",value:function(e){var t=e.scrollTop;this.currentOrientation.updateFromVerticalScroll(t)}},{key:"internalOnSplitterDragStart",value:function(){var e=this;this.isHorizontal&&this.foregroundCanvas.syncIdMap&&Object.keys(this.foregroundCanvas.syncIdMap).length>this.liveRedrawWhileMovingSplitterThreshold&&(this.suspendRefresh(),this.ion({splitterDragEnd:function(){return e.resumeRefresh(!0,!1)},once:!0}))}},{key:"onEventCreated",value:function(e){}},{key:"isHorizontal",get:function(){return"horizontal"===this.mode}},{key:"isVertical",get:function(){return"vertical"===this.mode}},{key:"mode",get:function(){return this._mode},set:function(e){var t=this;t._mode=e,t[e]||(t.element.classList.add("b-sch-".concat(e)),"horizontal"===e?(t.horizontal=new IR(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new VR(t),t.sortFeatureStore="resourceStore",t.rendered&&t.vertical.init()))}},{key:"currentOrientation",get:function(){return this[this.mode]}},{key:"onElementKeyDown",value:function(e){return B(t,"onElementKeyDown",this,3)([e])}},{key:"onElementKeyUp",value:function(e){return B(t,"onElementKeyUp",this,3)([e])}},{key:"onElementMouseOver",value:function(e){return B(t,"onElementMouseOver",this,3)([e])}},{key:"onElementMouseOut",value:function(e){return B(t,"onElementMouseOut",this,3)([e])}},{key:"processEventDrop",value:function(){}},{key:"processCrossSchedulerEventDrop",value:function(){}},{key:"beforeEventDragStart",value:function(){}},{key:"afterEventDragStart",value:function(){}},{key:"afterEventDragAbortFinalized",value:function(){}},{key:"checkEventDragValidity",value:function(){}},{key:"afterEventResizeStart",value:function(){}},{key:"afterRenderEvent",value:function(){}},{key:"hasEventEditor",get:function(){return Boolean(this.eventEditingFeature)}},{key:"eventEditingFeature",get:function(){var e=this.features,t=e.eventEdit,n=e.taskEdit,r=e.simpleEventEdit;return null!=t&&t.enabled?t:null!=n&&n.enabled?n:null!=r&&r.enabled?r:null}},{key:"createEvent",value:(o=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=(o=this).enableEventAnimations,s=o.eventStore,u=o.assignmentStore,c=o.hasEventEditor,d=o.autoCreate||ZR,h=d.newName,f=d.useEventModelDefaults,v=(null==d?void 0:d.duration)||{magnitude:f&&null!==(r=s.modelClass.defaultValues.duration)&&void 0!==r?r:1,unit:f&&null!==(i=s.modelClass.defaultValues.durationUnit)&&void 0!==i?i:o.timeAxis.unit},g=[n],m=s.createRecord({startDate:t,endDate:Pl.add(t,v),duration:v.magnitude,durationUnit:v.unit,name:o.resolveCallback(h,o,!1)?o.callback(h,o,[o,t,n]):h}),!(o.readOnly||n.isSpecialRow||n.readOnly)&&o.isDateRangeAvailable(m.startDate,m.endDate,null,n)){e.next=3;break}return e.abrupt("return");case 3:if(null===(a=o.eventEditingFeature)||void 0===a||a.captureStm(!0),m.isCreating=c,o.onEventCreated(m),p=null==u?void 0:u.assignEventToResource(m,n),!1!==o.trigger("beforeEventAdd",{eventRecord:m,resourceRecords:g,assignmentRecords:p})){e.next=11;break}return null==u||u.remove(p),null===(y=o.eventEditingFeature)||void 0===y||y.freeStm(!1),e.abrupt("return");case 11:if(o.enableEventAnimations=!1,k=s.add(m),o.project.commitAsync().then((function(){return o.enableEventAnimations=l})),k){e.next=18;break}return null==u||u.remove(p),null===(b=o.eventEditingFeature)||void 0===b||b.freeStm(!1),e.abrupt("return");case 18:return o.isCreating=!0,o.refreshRows(),o.isCreating=!1,e.next=23,o.scrollEventIntoView(m);case 23:if(!o.isDestroyed){e.next=25;break}return e.abrupt("return");case 25:o.trigger("eventAutoCreated",{eventRecord:m,resourceRecord:n}),c&&o.editEvent(m,n,o.getEventElement(m));case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"isDateRangeAvailable",value:function(e,t,n,r){return this.eventStore.isDateRangeAvailable({startDate:e,endDate:t,excludeEvent:n,resourceRecord:r,allowOverlap:this.allowOverlap})}},{key:"resumeRefresh",value:(a=f((function(){var e=this,n=!(arguments.length>0&&arguments[0]!==i)||arguments[0],r=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return L().mark((function i(){var a;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(B(t,"resumeRefresh",e,3)([!1]),(a=e).refreshSuspended||!n){i.next=7;break}if(a.isEngineReady){i.next=6;break}return a.currentOrientation.refreshAllWhenReady=!0,i.abrupt("return",a.project.commitAsync());case 6:a.isDestroyed||(r?a.refreshWithTransition():a.refresh());case 7:case"end":return i.stop()}}),i)}))()})),function(){return a.apply(this,arguments)})},{key:"refreshResource",value:function(e){this.refreshResources([e])}},{key:"refreshResources",value:function(e){this.currentOrientation.refreshResources(e)}},{key:"toggleEmptyText",value:function(){var e;li.toggleClasses(this.element,"b-grid-empty",!(this.resourceStore.count>0||null!==(e=this.crudManager)&&void 0!==e&&e.isLoading))}},{key:"getRowHeight",value:function(e){if(this.isHorizontal){var t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}},{key:"calculateRowHeights",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=this.store,a=D(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;o&&r.isAvailable(o)&&this.getRowHeight(o)}}catch(e){a.e(e)}finally{a.f()}n||this.rowManager.estimateTotalHeight(!0)}},{key:"calculateAllRowHeights",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this.store,n=this.rowManager,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){n.clearKnownHeights();for(var a=0;a<r;a++){var o=t.records[a];o&&this.getRowHeight(o)}e||n.estimateTotalHeight(!0)}}},{key:"dateBounds",get:function(){var e=this,t=[e.startDate];return"week"===e.range.unit&&t.push(e.lastDate),t}},{key:"description",get:function(){var e=this,n=e.startDate,r=e.endDate;if(!e.resolveCallback("descriptionRenderer",e,!1)&&"day"===e.range.unit&&r-n&&!Pl.isStartOf(n,"d")&&!Pl.isStartOf(r,"d")){var i=Pl.getMonthName(n.getMonth()),a=Pl.getMonthName(r.getMonth()),o=i!==a?"".concat(a," "):"";return"".concat(i," ").concat(n.getDate()," - ").concat(o).concat(r.getDate(),", ").concat(r.getFullYear())}return B(t,"description",this,1)}},{key:"defaultDescriptionFormat",get:function(){return KR[this.range.unit]}},{key:"lastDate",get:function(){var e=this.endDate;if(e)return Pl.isStartOf(e,"d")?Pl.add(e,-1,"day"):e}},{key:"getEventRecord",value:function(e){return e=li.getEventElement(e),this.resolveEventRecord(e)}},{key:"getResourceRecord",value:function(e){return this.resolveResourceRecord(e)}},{key:"getEventElement",value:function(e){return this.getElementFromEventRecord(e)}},{key:"changeListRangeMenu",value:function(e){if(e)return gD.mergeConfigs({view:this},e)}},{key:"changeRange",value:function(e){if(e)if("string"==typeof e){var t=Pl.parseTimeUnit(e);e=t?{magnitude:1,unit:t}:Pl.parseDuration(e)}else if("number"==typeof e)return{magnitude:e,unit:"day"};return e}},{key:"updateRange",value:function(e){if(!this.isConfiguring){var t=this.date,n=this.date=Pl.clamp(t,Pl.floor(t,e),Pl.ceil(t,e));t.getTime()===n.getTime()&&this.updateDate(n,t,!0)}}},{key:"changeShiftIncrement",value:function(e){return this.changeRange(e)}},{key:"updateShiftIncrement",value:function(e,t){this.trigger("shiftIncrementChange",{old:e,new:t})}},{key:"shiftIncrement",get:function(){return this._shiftIncrement||this.range}},{key:"stepUnit",get:function(){var e=this.shiftIncrement;return 1===e.magnitude?Pl.getLocalizedNameOfUnit(e.unit):"".concat(e.magnitude," ").concat(Pl.getLocalizedNameOfUnit(e.unit,!0))},set:function(e){Ne.deprecate("scheduler","7.0.0","changeStepUnit is deprectaed use shiftIncrement instead"),this.shiftIncrement=e}},{key:"updateDate",value:(r=f(L().mark((function e(t,n,r){var i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,x,E;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(a=this).timeAxis,l=a.vertical,s=a.range,u=a.workingTime,c=Pl.clearTime((null===(i=a.visibleDateRange)||void 0===i?void 0:i.startDate)||t),d=r?c:t,h=o.startDate,f=Pl.floor(h,s),v=Pl.add(f,s),g=a.isShifting?a.shiftIncrement:a.range,m=Pl.floor(h,g,h),p=Pl.add(m,s),y=S(S(S({},l?"x":"y",!1),"animate",!0),"block",t<m?"start":t>=p?"end":"nearest"),k=a.timeAxisColumn.width,!r&&Pl.betweenLesser(t,f,v)){e.next=9;break}if(b=Pl.floor(t,s),C=Pl.add(b,s),u&&(b.setHours(u.fromHour),C.setHours(u.toHour-24)),Object.assign(y,{animate:!1,block:"start",edgeOffset:r?{start:a.getCoordinateFromDate(c)-a.timelineScroller.position}:0}),a.setTimeSpan(b,C),!(a.timeAxisColumn.width<k)){e.next=9;break}return e.next=9,Ge.sleep(0);case 9:a._date=Pl.clamp(t,o.startDate,o.endDate),a.preventScroll||(a.isConfiguring?a.visibleDate={date:a._date,block:"start",animate:a.isPainted}:(w=a.getCoordinateFromDate(d,!1),D=a.getCoordinateFromDate(Pl.min(Pl.add(d,1,"d"),o.endDate),!1),x=Math.abs((-1===D?a.timelineScroller.scrollSize:D)-w),E=l?new pt(0,w,1,x):new pt(a.rtl?D:w,0,Math.abs(x),1),a.timelineScroller.scrollIntoView(E,y))),a.trigger("descriptionChange");case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"updateScrollBuffer",value:function(e){this.isConfiguring||(this.currentOrientation.scrollBuffer=e)}},{key:"previous",value:function(){this.move(-1)}},{key:"next",value:function(){this.move(1)}},{key:"move",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:1;e=Math.sign(e);var t=this,n=t.shiftIncrement;n&&(t.isShifting=!0,t.date=Pl.add(t.date,{unit:n.unit,magnitude:e*n.magnitude}),t.isShifting=!1)}},{key:"scheduleEvent",value:(n=f((function(e){var t=this,n=e.startDate,r=e.eventRecord,i=e.resourceRecord,a=e.element;return L().mark((function e(){var o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=t).eventStore.includes(r)||(l=o.eventStore.add(r),s=_(l,1),r=s[0]),r.beginBatch(),r.startDate=n,r.assign(i),r.endBatch(),a&&(u=pt.from(a,o.foregroundCanvas),li.setTranslateXY(a,0,0),li.setTopLeft(a,u.y,u.x),fa.addChild(o.foregroundCanvas,a,r.assignments[0].id)),e.next=9,o.project.commitAsync();case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"internalGetAssignmentsToHighlight",value:function(e){var t=this.eventStore,n=this.assignmentStore,r=this.resourceStore,i=t.usesSingleAssignment;return $e.asArray(e).reduce((function(e,a){var o,l;return null!==(o=a=(i&&!a.isModel||a.isEvent?t:n).getById(a))&&void 0!==o&&o.isEvent?e.push.apply(e,z(a.assignments.filter((function(e){return e.resource.stores.includes(r)})))):null!==(l=a)&&void 0!==l&&l.isAssignment&&a.resource.stores.includes(r)&&e.push(a),e}),[])}}],[{key:"defaultConfig",get:function(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:jE,liveRedrawWhileMovingSplitterThreshold:100,eventContainerSelector:".b-timeaxissubgrid",testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}}]);var n,r,a,o,l}(gD.mixin(CR,wR,qE,KE,XE,oR,sR,dR,rR,uR,hR,kR,UE,bR));S(JR,"$name","SchedulerBase"),S(JR,"type","schedulerbase"),S(JR,"configurable",{localizableProperties:["autoCreate.newName"],date:{value:null,$config:{equal:"date"}},listRangeMenu:{$config:"lazy",value:{type:"rangemenu"}},shiftIncrement:{$config:{lazy:!0,equal:XR},value:null},range:{$config:{equal:XR},value:"week"},getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}"},scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",showEventColorPickers:null,updateTimelineContextOnScroll:!0}),JR.initClass(),JR._$name="SchedulerBase";var QR=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateRecord",value:function(e){e&&(Ne.deprecate("scheduler","7.0.0","record config is deprecated in favor of records"),this.records=[e])}},{key:"colorSelected",value:function(e){var t=e.color;this.records&&this.records.forEach((function(e){return e.eventColor=t}))}}])}(pk);S(QR,"$name","EventColorPicker"),S(QR,"type","eventcolorpicker"),S(QR,"configurable",{colorClasses:JR.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null,records:null}),QR.initClass(),QR._$name="EventColorPicker";var eT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(yk);S(eT,"$name","EventColorField"),S(eT,"type","eventcolorfield"),S(eT,"configurable",{picker:{type:"eventcolorpicker"},name:"eventColor"}),eT.initClass(),eT._$name="EventColorField";var tT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(uC);S(tT,"$name","EventColorColumn"),S(tT,"type","eventcolor"),S(tT,"defaults",{editor:"eventcolorfield",field:"eventColor"}),bg.registerColumnType(tT),tT._$name="EventColorColumn";var nT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onCellClick",value:function(e){var t=e.record,n=e.event;!t.isSpecialRow&&n.target.classList.contains("b-icon")&&(n.preventDefault(),t.eventLayout="none"!==t.eventLayout?"none":"stack")}}],[{key:"defaults",get:function(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:function(e){var t=e.record;return{tag:"button","aria-label":e.column.L("L{ResourceCollapseColumn.toggleResourceLayout}"),class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":"none"!==t.eventLayout}}}}}}])}(yg);S(nT,"$name","ResourceCollapseColumn"),S(nT,"type","resourceCollapse"),S(nT,"fields",[{name:"ariaLabel",defaultValue:"L{ResourceCollapseColumn.toggleResourceLayout}"}]),bg.registerColumnType(nT),nT._$name="ResourceCollapseColumn";var rT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"construct",this,3)(n),this.avatarRendering=new yc({element:this.grid.element})}},{key:"doDestroy",value:function(){B(t,"doDestroy",this,3)([]),this.avatarRendering.destroy()}},{key:"getImageURL",value:function(e){var t=this.grid.resourceImagePath||"",n=t.split("//"),r=n.length>1?n[1]:t,i=Le.joinPaths([r||"",e||""]);return n.length>1?n[0]+"//"+i:i}},{key:"template",value:function(e,t){var n,r=this,i=r.showImage,a=r.showRole,o=r.showMeta,l=r.showEventCount,s=r.grid,u=s.timeAxis,c=s.resourceImageExtension,d=void 0===c?"":c,h=s.defaultResourceImageName,f="string"==typeof a?a:"role",v=l&&e.eventStore.getEvents({includeOccurrences:s.enableRecurringEvents,resourceRecord:e,startDate:u.startDate,endDate:u.endDate}).length,g=!1!==e.showAvatar;if(g&&i&&!1!==e.image)if(e.imageUrl)n=e.imageUrl;else{var m="string"==typeof i?i:e.image||t&&r.useNameAsImageName&&t.toLowerCase()+d||h||"";(n=m&&r.getImageURL(m))&&!m.includes(".")&&(n+=d)}return{class:{"b-resource-info":1,"b-no-avatar":!g},children:[i&&g&&r.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:n,defaultImageUrl:h&&this.getImageURL(h)}),a||l||o?{tag:"dl",children:[{tag:"dt",text:t},a?{tag:"dd",class:"b-resource-role",text:e.getValue(f)}:null,l?{tag:"dd",class:"b-resource-events",text:r.L("L{eventCountText}",v)}:null,o?{tag:"dd",class:"b-resource-meta",html:r.showMeta(e)}:null]}:t]}}},{key:"defaultRenderer",value:function(e){var t,n=e.grid,r=e.record,i=e.cellElement,a=e.value,o=e.isExport;return r.isSpecialRow?t="":o?t=a:(this.autoScaleThreshold&&n.rowHeight<this.autoScaleThreshold?i.style.fontSize=n.rowHeight/40+"em":i.style.fontSize="",t=this.template(r,a)),t}}],[{key:"fields",get:function(){return["showEventCount","showRole","showMeta","showImage","autoScaleThreshold","useNameAsImageName"]}},{key:"defaults",get:function(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",width:140,cellCls:"b-resourceinfo-cell",editor:!Ne.isTestEnv&&"text"}}}])}(yg);S(rT,"$name","ResourceInfoColumn"),S(rT,"type","resourceInfo"),bg.registerColumnType(rT),rT._$name="ResourceInfoColumn";var iT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onDestroy",value:function(){this.scaleWidget.destroy()}},{key:"width",get:function(){return B(t,"width",this,1)},set:function(e){V(t,"width",e,this,1,1),this.scaleWidget.width=e}},{key:"applyValue",value:function(e,n,r){return"scalePoints"===n&&(this.scaleWidget[n]=r),B(t,"applyValue",this,3)(arguments)}},{key:"buildScaleWidget",value:function(){var e=this,t=new qb({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(t,{width:{get:function(){return e.width},set:function(t){this.element.style.width="".concat(t,"px"),this._width=e.width}},height:{get:function(){return this._height},set:function(e){this.element.style.height="".concat(e,"px"),this._height=e}}}),t.width=e.width,t}},{key:"scaleWidget",get:function(){var e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}},{key:"defaultRenderer",value:function(e){var t=e.cellElement,n=e.value,r=e.scaleWidgetConfig,i=e.scaleWidget,a=void 0===i?this.scaleWidget:i;Be.assign(a,{scalePoints:n||this.scalePoints,height:this.grid.rowHeight},r),a.refresh();var o=a.element.cloneNode(!0);o.removeAttribute("id"),o.classList.remove("b-hide-offscreen"),t.innerHTML="",t.appendChild(o)}}])}(yg);S(iT,"$name","ScaleColumn"),S(iT,"type","scale"),S(iT,"isScaleColumn",!0),S(iT,"fields",["scalePoints"]),S(iT,"defaults",{text:" ",width:40,minWidth:40,field:"scalePoints",cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:null}),bg.registerColumnType(iT),iT._$name="ScaleColumn";var aT=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"isTickCell",!0),e}return R(t,e),w(t,[{key:"indexKey",get:function(){return"".concat(this.startDate.getTime(),"-").concat(this.resourceId)}},{key:"setValue",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.value=t;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]);var n}(Bw);S(aT,"$name","ResourceTickModel"),S(aT,"fields",["resourceId","value"]),aT._$name="ResourceTickModel";var oT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"$lazyLoadPluginClass",get:function(){return this.isPaged?fS:hS}}])}(Pf);S(oT,"$name","ResourceTickStore"),S(oT,"defaultConfig",{loadPriority:500,syncPriority:500,modelClass:aT,id:"resourceTicks"}),oT._$name="ResourceTickStore";var lT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"allDaysValueAsArray",get:function(){return["SU","MO","TU","WE","TH","FR","SA"]}},{key:"allDaysValue",get:function(){return this.allDaysValueAsArray.join(",")}},{key:"workingDaysValue",get:function(){return this.allDaysValueAsArray.filter((function(e,t){return!Pl.nonWorkingDays[t]})).join(",")}},{key:"nonWorkingDaysValue",get:function(){return this.allDaysValueAsArray.filter((function(e,t){return Pl.nonWorkingDays[t]})).join(",")}},{key:"getLegend",value:function(e,t){var n,r=this,i=e.timeSpan,a=e.interval,o=e.days,l=e.monthDays,s=e.months,u=e.positions,c=t||i.startDate,d={interval:a};switch(e.frequency){case"DAILY":return 1===a?r.L("L{Daily}"):r.L("L{Every {0} days}",d);case"WEEKLY":return o&&o.length?d.days=r.getDaysLegend(o):c&&(d.days=Pl.getDayName(c.getDay())),r.L(1===a?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return o&&o.length&&u&&u.length?d.days=r.getDaysLegend(o,u):l&&l.length?(l.sort((function(e,t){return e-t})),d.days=r.arrayToText(l)):c&&(d.days=c.getDate()),r.L(1===a?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return o&&o.length&&u&&u.length?d.days=r.getDaysLegend(o,u):d.days=c.getDate(),s&&s.length?(s.sort((function(e,t){return e-t})),n=s.length>2?function(e){return Pl.getMonthShortName(e-1)}:function(e){return Pl.getMonthName(e-1)},d.months=r.arrayToText(s,n)):d.months=Pl.getMonthName(c.getMonth()),r.L(1===a?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}},{key:"getDaysLegend",value:function(e,t){var n,r=this,i={position:""};if(t&&t.length&&(i.position=r.arrayToText(t,(function(e){return r.L("L{position".concat(e,"}"))}))),e.length)switch(e.sort((function(e,t){return MS.decodeDay(e)[0]-MS.decodeDay(t)[0]})),e.join(",")){case r.allDaysValue:i.days=r.L("L{day}");break;case r.workingDaysValue:i.days=r.L("L{weekday}");break;case r.nonWorkingDaysValue:i.days=r.L("L{weekend day}");break;default:n=e.length>2?function(e){return Pl.getDayShortName(MS.decodeDay(e)[0])}:function(e){return Pl.getDayName(MS.decodeDay(e)[0])},i.days=r.arrayToText(e,n)}return r.L("L{daysFormat}",i)}},{key:"arrayToText",value:function(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}])}(Ya());S(lT,"$name","RecurrenceLegend"),lT._$name="RecurrenceLegend";var sT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"generateContent",value:function(e){return this.div.innerHTML=this.template(e)}},{key:"updateDateIndicator",value:function(e,t){var n=null==e?void 0:e.querySelector(".b-sch-hour-indicator"),r=null==e?void 0:e.querySelector(".b-sch-minute-indicator");t&&n&&r&&ne.isBrowserEnv&&("hour"===this.mode?(n.style.transform="rotate(".concat(t.getHours()%12*30,"deg)"),r.style.transform="rotate(".concat(6*t.getMinutes(),"deg)")):(n.style.transform="none",r.style.transform="none"))}},{key:"mode",get:function(){if(this._mode)return this._mode;var e=Pl.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=Pl.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"},set:function(e){this._mode=e}},{key:"template",get:function(){return this._template},set:function(e){this._template=e}}],[{key:"defaultConfig",get:function(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template:function(e){return'<div class="b-sch-clockwrap b-sch-clock-'.concat(e.mode||this.mode," ").concat(e.cls||"",'">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">').concat(e.date?Pl.format(e.date,"MMM"):"",'</div>\n                        <div class="b-sch-minute-indicator">').concat(e.date?Pl.format(e.date,"D"):"",'</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">').concat(Le.encodeHtml(e.text||""),"</span>\n                </div>")}}}}])}(Mn);sT._$name="ClockTemplate";var uT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConstruct",value:function(){var e=this,n=this.client;e.capitalizedEventName=e.capitalizedEventName||n.capitalizedEventName,e.eventName=e.eventName||n.scheduledEventName;for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];B(t,"afterConstruct",this,3)(i)}},{key:"internalSnapToPosition",value:function(e){var t,n=this.dragData;null===(t=this.snapToPosition)||void 0===t||t.call(this,{assignmentRecord:n.assignmentRecord,eventRecord:n.eventRecord,resourceRecord:n.newResource||n.resourceRecord,startDate:n.startDate,endDate:n.endDate,snapTo:e})}},{key:"buildDragHelperConfig",value:function(){var e=this,t=e.client,n=e.constrainDragToTimeline,r=e.constrainDragToResource,a=e.constrainDragToTimeSlot,o=e.dragHelperConfig,l=void 0===o?{}:o,s=t.timeAxisViewModel,u=t.isHorizontal,c=u?r:a,d=u?a:r;return e.externalDropTargetSelector&&(l.dropTargetSelector=".b-timeaxissubgrid,".concat(e.externalDropTargetSelector)),pe.merge({name:e.constructor.name,positioning:"inset",rtlSource:t,lockX:d,lockY:c,minX:!0,maxX:!0,constrain:!1,cloneTarget:!n,removeProxyAfterDrop:!1,dragWithin:n?null:t.floatRoot,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",allowDropOutside:!n,dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:n?t.scrollManager:null,createProxy:function(t){return e.createProxy(t)},snapCoordinates:function(n){var a=n.element,o=n.newX,l=n.newY,c=e.dragData;if(t&&e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||s.snap)){var d,h,f=t.timeAxis,v=null!==(d=c.record.event)&&void 0!==d?d:c.record,g=v.calendar,m=c.startDate,p=e.getCoordinate(v,a,[o,l]);if(t.fillTicks&&f.isContinuous?h=t.snap?f.roundDate(m):m:(h=s.getDateFromPosition(p,"round"),(t.snapRelativeToEventStartDate||t.snap&&t.fillTicks)&&(h=f.roundDate(h,m))),!g||h&&g.isWorkingTime(h,Pl.add(h,v.fullDuration))){var y=h&&s.getPositionFromDate(h);h&&h>=t.startDate&&null!=y&&(u?o=y:l=y)}if(t.snap&&e.snapToResource&&!r){var k,b,C,w;if(u){var D,S=null===(D=t.rowManager.getRowAt(c.context.clientY))||void 0===D?void 0:D.id;w=t.resourceStore.getById(S)}else{var x=c.context.clientX-t.timeAxisSubGrid.rectangle().x,E=t.visibleResources,R=E.first,T=E.last;w=t.vertical.allResourceRecords.filter((function(e){return e.id>=R.id&&e.id<=T.id})).find((function(e){return e.instanceMeta(t).insetStart<=x&&e.instanceMeta(t).insetEnd>x}))}var M=w||c.newResource||c.resourceRecord,F=t.getResourceMarginObject(M).start,A=u?null===(k=t.getRowFor(M))||void 0===k?void 0:k.height:t.getResourceWidth(M),I=u?null===(b=t.getRowFor(M))||void 0===b?void 0:b.top:null===(C=M.instanceMeta(t))||void 0===C?void 0:C.insetStart;if(A!==i&&I!==i){var L=I+F,O=e.snapToResource.threshold?Math.min(A,e.snapToResource.threshold):A/4+F,P=u?Math.abs(l-I):Math.abs(o-I);M.id===c.resourceRecord.id&&(L=u?c.context.elementStartY:c.context.elementStartX,P=u?Math.abs(l-L):Math.abs(o-L)),P<=O&&(u?l=L:o=L)}}}var _={x:o,y:l};return e.internalSnapToPosition(_),_},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},l,{isElementDraggable:function(t,n){return(!l||!l.isElementDraggable||l.isElementDraggable(t,n))&&e.isElementDraggable(t,n)}})}},{key:"onInternalPaint",value:function(e){var t,n=e.firstPaint,r=this,i=r.client;null===(t=r.drag)||void 0===t||t.destroy(),r.drag=Qi.new(r.buildDragHelperConfig()),n&&i.rowManager.ion({changeTotalHeight:function(){var e;return r.updateYConstraint(null===(e=r.dragData)||void 0===e?void 0:e["".concat(i.scheduledEventName,"Record")])},thisObj:r}),r.showTooltip&&(r.clockTemplate=new sT({scheduler:i}))}},{key:"doDestroy",value:function(){var e,n,r;null===(e=this.drag)||void 0===e||e.destroy(),null===(n=this.clockTemplate)||void 0===n||n.destroy(),null===(r=this.tip)||void 0===r||r.destroy(),B(t,"doDestroy",this,3)([])}},{key:"tipId",get:function(){return"".concat(this.client.id,"-event-drag-tip")}},{key:"changeTip",value:function(e,t){var n=this;if(e){var r=pc.reconfigure(t,pc.mergeConfigs({forElement:n.element,id:n.tipId,getHtml:n.getTipHtml.bind(n),cls:n.tooltipCls,owner:n.client},e),{owner:n.client,defaults:{type:"tooltip"}});return r.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:n}),r}null==t||t.destroy()}},{key:"createProxy",value:function(e){var t=e.cloneNode(!0);return delete t.id,t.classList.add("b-sch-".concat(this.client.mode)),t}},{key:"onBeforeDragStart",value:function(e){var t=e.context,n=e.event,r=this,i=r.client,a=r.getMinimalDragData(t,n),o=null==a?void 0:a["".concat(i.scheduledEventName,"Record")],l=a.resourceRecord,s=r.constrainDragToResource&&r.constrainDragToTimeSlot;if(i.readOnly||r.disabled||!o||!1===o.isDraggable||o.readOnly||null!=l&&l.readOnly||s)return!1;t.pointerStartDate=i.getDateFromCoord({coord:i.isVertical?t.startPageY:t.startPageX,local:!1});var u,c=!1!==r.triggerBeforeEventDrag("before".concat(r.capitalizedEventName,"Drag"),F(F({},a),{},{event:n,context:F(F({},t),a)}));c&&(r.updateYConstraint(o,l),null===(u=i["before".concat(r.capitalizedEventName,"DragStart")])||void 0===u||u.call(i,t,a));return c}},{key:"onAfterDragStart",value:function(e){e.context,e.event}},{key:"isDragging",get:function(){var e;return null===(e=this.drag)||void 0===e?void 0:e.isDragging}},{key:"isActivelyDragging",get:function(){return this.isDragging&&!this.finalizing}},{key:"onDragStart",value:function(e){var t,n,r,i=e.context,a=e.event,o=this,l=null!==(t=o.findClientFromTarget(a,i))&&void 0!==t?t:o.client;o.currentOverClient=l,o.drag.unifiedProxy=o.unifiedDrag,o.onMouseOverNewTimeline(l,!0);var s=o.dragData=o.getDragData(i);if(o.suspendElementRedrawing(i.element),o.showTooltip&&o.tip){var u=s.context.dragProxy?s.context.dragProxy.firstChild:i.element;o.tip.showBy(u)}o.triggerDragStart(s),null===(n=l["after".concat(o.capitalizedEventName,"DragStart")])||void 0===n||n.call(l,i,s);var c=l.features,d=c.eventMenu,h=c.taskMenu,f=d||h;null==f||null===(r=f.hideContextMenu)||void 0===r||r.call(f,!1)}},{key:"updateDateIndicator",value:function(){var e=this.dragData,t=e.startDate,n=e.endDate,r=this.tip,i=this.clockTemplate,a=r.element.querySelector(".b-sch-tooltip-enddate");i.updateDateIndicator(r.element,t),a&&i.updateDateIndicator(a,n)}},{key:"findClientFromTarget",value:function(e,t){var n=e.target;if(/^touch/.test(e.type)){var r=pt.from(t.element,null,!0).center;n=li.elementFromPoint(r.x,r.y)}var i=Lo.fromElement(n,"timelinebase");return null!=i&&i.isResourceHistogram?null:i}},{key:"onDrag",value:function(e){var t,n=e.context,r=e.event,i=this,a=i.dragData,o=a.startDate;if(t=i.constrainDragToTimeline?i.client:i.findClientFromTarget(r,a.context),i.updateDragContext(n,r),t){if(t!==i.currentOverClient&&i.onMouseOverNewTimeline(t),a.dirty||!i.throttleDragEvent){var l=a.valid;i.triggerEventDrag(a,o),l!==a.valid&&(a.context.valid=a.externalDragValidity=a.valid)}i.showTooltip&&i.tip&&(i.tip.lastAlignSpec.allowTargetOut=!a.valid,i.tip.realign())}}},{key:"onMouseOverNewTimeline",value:function(e,t){var n=this,r=n.drag,i=r.lockX,a=r.lockY,o=[];n.currentOverClient.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||n.currentOverClient.scrollManager.stopMonitoring(),i||o.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),a||o.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:o,callback:n.drag.onScrollManagerScrollCallback}),n.currentOverClient=e}},{key:"triggerBeforeEventDropFinalize",value:function(e,t,n){n.trigger(e,t)}},{key:"onDrop",value:function(e){var t,n=e.context,r=e.event,i=this,a=i.currentOverClient,o=i.dragData,l=!1;if(null==a||a.scrollManager.stopMonitoring(),null===(t=i.tip)||void 0===t||t.hide(),n.valid=n.valid&&i.isValidDrop(o),i.drag.removeProxyAfterDrop=Boolean(o.externalDropTarget),n.valid&&o.startDate&&o.endDate){var s=!1;o.finalize=function(){var e=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s&&!o.async){e.next=5;break}return e.next=3,i.finalize(t);case 3:e.next=6;break;case 5:n.valid=n.valid&&t;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.triggerBeforeEventDropFinalize("before".concat(i.capitalizedEventName,"DropFinalize"),{context:o,domEvent:r},a),s=!0,n.async=o.async,n.async||o.externalDropTarget||(l=o.startDate-o.origStart!=0||o.newResource!==o.resourceRecord)}n.async||i.finalize(o.valid&&n.valid&&l)}},{key:"onDragAbort",value:function(e){var t,n,r=e.context,i=this;i.isAborting=!0,null===(t=i.currentOverClient)||void 0===t||t.scrollManager.stopMonitoring(),i.client.currentOrientation.onDragAbort({context:r,dragData:i.dragData}),i.resetDraggedElements(),null===(n=i.tip)||void 0===n||n.hide(),i.triggerDragAbort(i.dragData)}},{key:"onDragAbortFinalized",value:function(e){var t,n,r=e.context,i=this;i.triggerDragAbortFinalized(i.dragData),null===(t=(n=i.client)["after".concat(i.capitalizedEventName,"DragAbortFinalized")])||void 0===t||t.call(n,r,i.dragData),i.isAborting=!1}},{key:"onDragReset",value:function(e){var t,n=e.source,r=this,i=r.currentOverClient;null!==(t=n.context)&&void 0!==t&&t.started&&(r.resetDraggedElements(),i.trigger("".concat(r.eventName,"DragReset"))),null==i||i.element.classList.remove("b-dragging-".concat(i.scheduledEventName)),r.dragData=null}},{key:"resetDraggedElements",value:function(){var e=this,t=this.dragData,n=t.eventBarEls,r=t.draggedEntities;this.resumeRecordElementRedrawing(t.record),r.forEach((function(t,r){e.resumeRecordElementRedrawing(t),n[r]&&(n[r].classList.remove(e.drag.draggingCls),n[r].retainElement=!1)})),t.context.element.retainElement=!1}},{key:"onInternalInvalidDrop",value:function(e){var t,n=this,r=n.drag.context;null===(t=n.tip)||void 0===t||t.hide(),n.triggerAfterDrop(n.dragData,!1),r.valid=!1,e&&n.drag.abort()}},{key:"finalize",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).dragData,i=n.currentOverClient,a=r.eventBarEls,o=i.features.taskTooltip||i.features.eventTooltip,r&&!n.finalizing){e.next=3;break}return e.abrupt("return");case 3:if(l=r.context,s=r.draggedEntities,u=r.externalDropTarget,n.finalizing=!0,s.forEach((function(e,t){n.resumeRecordElementRedrawing(e),a[t]&&(a[t].classList.remove(n.drag.draggingCls),a[t].retainElement=!1)})),l.element.retainElement=!1,!(u&&r.valid||t)){e.next=16;break}if(c=n.updateRecords(r),u||!pe.isPromise(c)){e.next=13;break}return l.async=!0,e.next=13,c;case 13:r.valid?(l.async&&l.finalize(),u&&n.client.refreshRows(null,!1),n.triggerAfterDrop(r,!0)):n.onInternalInvalidDrop(!0),e.next=17;break;case 16:n.onInternalInvalidDrop(l.async||r.async);case 17:return n.finalizing=!1,null!=o&&o.enabled&&(o.disabled=!0,i.setTimeout((function(){o.disabled=!1}),200)),e.abrupt("return",c);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getEventStartEndDatesFromGraph",value:function(e,t,n){var r,i=this.dragData,a=i.newResource,o=i.resourceRecord,l=i.assignmentRecords,s=n.project,u=s.graph,c=s!==e.project,d=u.branch({autoCommit:!1,onComputationCycle:"throw",project:s});if(c){(e=e.copy()).parentEvent=s.eventStore.rootNode,e.project=s,d.addEntity(e);var h,f=D(l);try{for(f.s();!(h=f.n()).done;){var v=h.value;d.addEntity(v.copy({eventId:e.id,event:e,resourceId:a.id,resource:a}))}}catch(e){f.e(e)}finally{f.f()}}else if(a&&a!==o){var g,m=D(l);try{for(m.s();!(g=m.n()).done;){var p=g.value;d.write(p.$.resource,a)}}catch(e){m.e(e)}finally{m.f()}}d.write(e.$.startDate,t);try{t=d.read(e.$.startDate),r=d.read(e.$.endDate)}catch(e){return!1}finally{d.clearBranch()}return{startDate:t,endDate:r}}},{key:"getEventNewStartEndDates",value:function(e,t,n){var r,i=this.adjustStartDate(e.startDate,t);if(!e.graph||this.allowNonWorkingTimeSNET||e.manuallyScheduled&&!e.project.skipNonWorkingTimeWhenSchedulingManually)r=Pl.add(i,e.fullDuration);else try{var a=this.getEventStartEndDatesFromGraph(e,i,n);i=a.startDate,r=a.endDate}catch(e){return{valid:!1}}return{startDate:i,endDate:r}}},{key:"updateDragContext",value:function(e,t){var n,r=this,a=r.drag,o=r.dragData,l=r.currentOverClient,s=l.isHorizontal,u=l.timeAxis,c=o.record,d=c.isAssignment?c.event:c,h=o.startDate,f=r.constrainDragToTimeSlot||(s?a.lockX:a.lockY);if(o.browserEvent=t,Object.assign(o,r.getProductDragContext(o)),f)o.timeDiff=0;else if(u.isContinuous||o.startsOutsideView&&o.endsOutsideView){var v,g,m=l.isHorizontal?null!==(v=e.pageX)&&void 0!==v?v:e.startPageX:null!==(g=e.pageY)&&void 0!==g?g:e.startPageY,p=l.getDateFromCoordinate(m,null,!1,!0);null!==(n=o.timeDiff=p-e.pointerStartDate)&&(Object.assign(o,r.getEventNewStartEndDates(d,n,l)),o.valid&&(o.timeDiff=o.startDate-o.origStart))}else{var y=r.resolveStartEndDates(e.element);o.valid=Boolean(y.startDate&&y.endDate),o.valid&&(n=y.startDate-o.origStart),n!==i&&(d.graph&&!r.allowNonWorkingTimeSNET?Object.assign(o,r.getEventStartEndDatesFromGraph(d,y.startDate,l)):(o.startDate=y.startDate,o.endDate=y.endDate)),o.timeDiff=n}var k=o.dirty=o.dirty||h-o.startDate!=0;if(o.valid)if(r.constrainDragToTimeline&&(o.endDate<=u.startDate||o.startDate>=u.endDate))o.valid=!1,o.context.message=r.L("L{EventDrag.noDropOutsideTimeline}");else if(k||o.externalDropTarget){var b=o.externalDragValidity=!t||e.pageX&&r.checkDragValidity(o,t);b&&"boolean"!=typeof b?(o.valid=!1!==b.valid,o.context.message=b.message):(o.valid=!1!==b,o.context.message="")}else{var C;o.valid=!1!==o.externalDragValidity&&!1!==(null===(C=o.externalDragValidity)||void 0===C?void 0:C.valid)}else o.valid=!1;o.context.valid=o.valid}},{key:"suspendRecordElementRedrawing",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}},{key:"resumeRecordElementRedrawing",value:function(e){this.suspendRecordElementRedrawing(e,!1)}},{key:"suspendElementRedrawing",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];e&&(e.retainElement=t)}},{key:"resumeElementRedrawing",value:function(e){this.suspendElementRedrawing(e,!1)}},{key:"getDragData",value:function(e){var t=this,n=t.client,r=t.drag,i=t.setupProductDragData(e),a=i.record,o=i.eventBarEls,l=i.draggedEntities,s=r.startEvent,u=a.isAssignment?a.event:a,c=u.startDate,d=u.endDate,h=n.timeAxis,f=c<h.startDate,v=d>h.endDate,g=n.isSchedulerBase?n.multiEventSelect:n.selectionMode.multiSelect,m=t.getCoordinate(u,e.element,[e.elementStartX,e.elementStartY]),p=t.getCoordinate(u,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(a),l.forEach((function(e){return t.suspendRecordElementRedrawing(e)})),n.selectionMode.checkboxOnly||(a.isAssignment?n.selectAssignment(a,s.ctrlKey&&g):n.selectEvent(a,s.ctrlKey&&g));var y=F(F({context:e},i),{},{sourceDate:f?c:n.getDateFromCoordinate(m),screenSourceDate:n.getDateFromCoordinate(p,null,!1),startDate:c,endDate:d,timeDiff:0,origStart:c,origEnd:d,startsOutsideView:f,endsOutsideView:v,duration:d-c,browserEvent:s});return o.length>1&&(e.relatedElements=o.filter((function(e){return e&&e!==r.context.grabbed}))),o.forEach((function(e){return null==e?void 0:e.classList.remove("b-sch-event-hover","b-active")})),y}},{key:"setupConstraints",value:function(e,t,n,r,i){var a=this,o=!a.showExactDropPosition&&n>1?n:0;r?a.setXConstraint(e.left,e.right-t.width,o):a.setXConstraint(!0,!0,o),i?a.setYConstraint(e.top,e.bottom-t.height,0):a.setYConstraint(0,!0,0)}},{key:"updateYConstraint",value:function(e,t){var n=this,r=n.client,i=n.drag.context,a=r.timeAxisViewModel.snapPixelAmount;if(i&&!n.drag.lockY){var o;if(!n.constrainDragToTimeline)return void n.setYConstraint(null,null,a);o=r.getScheduleRegion(t,e),n.setYConstraint(o.top,o.bottom-i.element.offsetHeight,a)}else n.setYConstraint(null,null,a)}},{key:"setXConstraint",value:function(e,t,n){var r=this.drag;r.minX=e,r.maxX=t}},{key:"setYConstraint",value:function(e,t,n){var r=this.drag;r.minY=e,r.maxY=t}},{key:"adjustStartDate",value:function(e,t){var n=this.currentOverClient,r=n.timeAxis.roundDate(new Date(e-0+t),!!(n.snapRelativeToEventStartDate||n.snap&&n.fillTicks)&&e);return!n.fillTicks||"day"!==n.timeAxis.mainUnit&&0!==Pl.compareUnits(n.timeResolution.unit,"d")||Pl.copyTimeValues(r,this.dragData.origStart),this.constrainStartDate(r)}},{key:"normalizeDraggedElement",value:function(e){return li.down(e,this.currentOverClient.eventInnerSelector)}},{key:"resolveStartEndDates",value:function(e){var t=this.currentOverClient,n=t.timeAxis,r=this.normalizeDraggedElement(e),i=pt.from(r,t.timeAxisSubGridElement),a=this.dragData,o=_(a.draggedEntities,1)[0],l=o.isAssignment?o.event:o,s=t.fillTicks&&t.snapRelativeToEventStartDate,u=l.endDate-l.startDate,c=t.getStartEndDatesFromRectangle(i,s?null:"round",u,!0),d=c.start,h=c.end;if(d&&h){if(s){var f=(l.startDate-Pl.startOf(l.startDate,n.unit))/(h-d)*i.width;i.deflate(t.isVertical?f:0,0,0,t.isHorizontal?f:0);var v=i.getStart(t.rtl,!t.isVertical);d=t.getDateFromCoordinate(v,null,!0),d=n.roundDate(d,l.startDate)}if(d=this.adjustStartDate(d,0),a.startsOutsideView)a.endsOutsideView||(d=h&&Pl.add(h,-u));else{if(!n.dateInAxis(d,!1)){var g=n.getTickFromDate(d);g>=0&&(d=n.getDateFromTick(g))}h=d&&Pl.add(d,u)}}return{startDate:d,endDate:h}}},{key:"getTipHtml",value:function(){var e=this,t=e.dragData,n=e.client,r=e.tooltipTemplate,i=t.startDate,a=t.endDate,o=t.draggedEntities,l=t.newResource,s=n.getFormattedDate(i),u=a&&n.getFormattedEndDate(a,i)||"",c=t.context,d=c.valid,h=c.message,f=c.element,v=c.dragProxy,g=v?v.firstChild:f,m=o[0],p=m.isTask?m:m.event;return e.tip.lastAlignSpec.target=g,r(S(S(S({valid:d,startDate:i,endDate:a,startText:s,endText:u,dragData:t,newResource:l||t.resourceRecord,message:h||""},n.scheduledEventName+"Record",p),"startClockHtml",e.clockTemplate.template({date:i,text:s,cls:"b-sch-tooltip-startdate"})),"endClockHtml",p.isMilestone?"":e.clockTemplate.template({date:a,text:u,cls:"b-sch-tooltip-enddate"})))}},{key:"updateConstrainDragToTimeSlot",value:function(e){if(this.drag){var t=this.client.isHorizontal?"lockX":"lockY";this.drag[t]=e}}},{key:"updateConstrainDragToResource",value:function(e){var t=this;if(t.drag){var n=t.constrainDragToTimeSlot,r=t.client.isHorizontal;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=r?e:n,t.drag.lockX=r?n:e}}},{key:"updateConstrainDragToTimeline",value:function(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,allowDropOutside:!e,dragWithin:e?null:this.client.floatRoot,scrollManager:e?this.client.scrollManager:null})}},{key:"constrainStartDate",value:function(e){var t=this.dragData,n=t.dateConstraints,r=t.eventRecord||t.taskRecord||t.record;return null!=n&&n.start&&(e=Pl.max(n.start,e)),null!=n&&n.end&&(e=Pl.min(new Date(n.end-r.rawDurationMS),e)),e}},{key:"getElementFromContext",value:function(e){return e.grabbed||e.dragProxy||e.element}},{key:"getRelatedRecords",value:function(e){return[]}},{key:"getMinimalDragData",value:function(e,t){return{}}},{key:"isValidDrop",value:function(e){throw new Error("Implement in subclass")}},{key:"checkDragValidity",value:function(e){throw new Error("Implement in subclass")}},{key:"updateRecords",value:function(e){throw new Error("Implement in subclass")}},{key:"isElementDraggable",value:function(e,t){throw new Error("Implement in subclass")}},{key:"getCoordinate",value:function(e,t,n){throw new Error("Implement in subclass")}},{key:"setupProductDragData",value:function(e){throw new Error("Implement in subclass")}},{key:"getProductDragContext",value:function(e){throw new Error("Implement in subclass")}},{key:"getRecordElement",value:function(e){throw new Error("Implement in subclass")}}],[{key:"defaultConfig",get:function(){return{tooltipTemplate:function(e){return'\n                <div class="b-sch-tip-'.concat(e.valid?"valid":"invalid",'">\n                    ').concat(e.startClockHtml,"\n                    ").concat(e.endClockHtml,'\n                    <div class="b-sch-tip-message">').concat(e.message,"</div>\n                </div>\n            ")},showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip",allowNonWorkingTimeSNET:null}}},{key:"configurable",get:function(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0,capitalizedEventName:null,eventName:null}}},{key:"pluginConfig",get:function(){return{chain:["onInternalPaint"]}}}]);var n}(wc);uT._$name="DragBase";var cT=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"detachFromProject",value:function(e){this.rejectFeatureTransaction(),B(t,"detachFromProject",this,3)([e])}},{key:"getStmCapture",value:function(){var e,n,r=null!==(e=null===(n=B(t,"getStmCapture",this,3))||void 0===n?void 0:n([]))&&void 0!==e?e:{};return r._editorPromiseResolve=this._editorPromiseResolve,r}},{key:"applyStmCapture",value:function(e){var n;null===(n=B(t,"applyStmCapture",this,3))||void 0===n||n([e]),this._editorPromiseResolve=e._editorPromiseResolve}},{key:"captureFeatureTransaction",value:function(){if(this.client.transactionalFeaturesEnabled)return this._hasFeatureTransactionCapture=!0,{source:this,resolve:this._editorPromiseResolve}}},{key:"applyCapturedFeatureTransaction",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};if(this.client.transactionalFeaturesEnabled){var t=e.source,n=e.resolve;t!==this&&(t._hasFeatureTransactionCapture=!1,t.cleanupTransactionMetadata(),this._hasFeatureTransactionCapture=!0,this._editorPromiseResolve=n)}}},{key:"releaseFeatureTransaction",value:function(){this.client.transactionalFeaturesEnabled&&(this._hasFeatureTransactionCapture=!1)}},{key:"canStartFeatureTransaction",get:function(){return!this.client.transactionalFeaturesEnabled||!this._hasFeatureTransactionCapture&&!this.client.project.stm.isNavigatingRevisions}},{key:"startFeatureTransaction",value:(r=f(L().mark((function e(){var t,n,r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.transactionalFeaturesEnabled&&!this._hasFeatureTransactionCapture){e.next=2;break}return e.abrupt("return");case 2:return n=(t=this).client.project,r=n.stm,i=ba.generateId("featureTransaction"),t.client.trigger("beforeFeatureTransactionStart",{id:i}),t.hasStmCapture?r.startTransaction():a=n.queue(f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isEngineReady()){e.next=3;break}return e.next=3,n.commitAsync();case 3:case"end":return e.stop()}}),e)})))),n.queue((function(){return t.hasStmCapture||(t._stmInitiallyDisabled=r.disabled,t._stmInitiallyAutoRecord=r.autoRecord,r.isRecording?r.stopTransaction():t._stmInitiallyDisabled&&r.enable(),r.autoRecord=!1),r.isRecording||r.startTransaction(),t.client.trigger("featureTransactionStart",{id:i}),new Promise((function(e){return t._editorPromiseResolve=e}))})),e.next=8,a;case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"rejectFeatureTransaction",value:function(){var e,t=this,n=t.client.project.stm,r=t.client.featureTransactionId;r&&!t.finishingFeatureTransaction&&(null===(e=t._editorPromiseResolve)||void 0===e||e.call(t),t._hasFeatureTransactionCapture&&t.releaseFeatureTransaction(),t.cleanupTransactionMetadata(),n.isRecording&&n.rejectTransaction(),t.hasStmCapture||null==t._stmInitiallyDisabled||(n.disabled=t._stmInitiallyDisabled,n.autoRecord=t._stmInitiallyAutoRecord),t.client.trigger("featureTransactionReject",{id:r}),t.client.trigger("featureTransactionComplete",{id:r}))}},{key:"cleanupTransactionMetadata",value:function(){this._editorPromiseResolve=null}},{key:"finishFeatureTransaction",value:(n=f(L().mark((function e(){var t,n,r,i,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).client,i=n._stmInitiallyDisabled,a=n._stmInitiallyAutoRecord,o=r.project,l=r.featureTransactionId,s=o.stm,l&&!n._hasFeatureTransactionCapture){e.next=3;break}return e.abrupt("return");case 3:return r.trigger("featureTransactionFinalizeStart",{id:l}),n.finishingFeatureTransaction=!0,e.next=7,o.commitAsync();case 7:s.isRecording&&s.stopTransaction(),null===(t=n._editorPromiseResolve)||void 0===t||t.call(n),n._editorPromiseResolve=null,n.hasStmCapture||!s||s.isDestroying||null==i||(s.disabled=i,s.autoRecord=a),n.isDestroying||(n.finishingFeatureTransaction=!1,r.trigger("featureTransactionFinalized",{id:l}),r.trigger("featureTransactionComplete",{id:l}));case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]);var n,r}((e||Mn).mixin(DR)),S(t,"$name","TransactionalFeature"),t},dT={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},hT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){var e;B(t,"doDestroy",this,3)([]),null===(e=this.dragging)||void 0===e||e.destroy()}},{key:"render",value:function(){var e=this,t=e.client;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}},{key:"isEventElementDraggable",value:function(e,t,n,r){var i=this,a=null==t?void 0:t.resizable;return!(!i.disabled&&a&&!t.isMilestone)||(!0!==a&&"start"!==a||!i.isOverStartHandle(r,e))&&(!0!==a&&"end"!==a||!i.isOverEndHandle(r,e))}},{key:"onEventDataGenerated",value:function(e){var t,n=e.eventRecord,r=e.wrapperCls,i=e.cls;null!==(t=this.dragging)&&void 0!==t&&null!==(t=t.context)&&void 0!==t&&t.eventContexts.some((function(e){return e.eventRecord===n}))&&(r["b-active"]=r[this.draggingItemCls]=r["b-over-resize-handle"]=i["b-resize-handle"]=i[this.resizingItemInnerCls]=1)}},{key:"onDragPointerMove",value:function(e){var n,i=this.client,a=this.dragging,o=i.visibleDateRange,l=i.isHorizontal,s=l&&i.rtl,u=l?"X":"Y",c=r["page".concat(u,"Offset")],d=e["page".concat(u)]+((null===(n=a.context)||void 0===n?void 0:n.offset)||0),h=pt.from(i.timeAxisSubGridElement,null,!0),f=h.getStart(s,l),v=h.getEnd(s,l),g=i.getDateFromCoord({coord:d,local:!1});s?d-c>f?g=o.startDate:d<v&&(g=o.endDate):d-c<f?g=o.startDate:d-c>v&&(g=o.endDate),a.clientStartCoord=f,a.clientEndCoord=v,a.date=g,B(t,"onDragPointerMove",this,3)([e])}},{key:"isResizing",get:function(){return Boolean(this.dragging)}},{key:"isMultiResizing",get:function(){var e;return this.isResizing&&(null===(e=this.dragging)||void 0===e?void 0:e.context.eventContexts.length)>1}},{key:"beforeDrag",value:function(e){var n=this,r=n.client,i=r.resolveTimeSpanRecord(e.itemElement),a=!r.isGanttBase&&r.resolveResourceRecord(r.isVertical?e.startEvent:e.itemElement);return!(n.disabled||r.readOnly||null!=a&&a.readOnly||i&&(i.readOnly||!i.project&&!i.isOccurrence)||!1===B(t,"beforeDrag",this,3)([e]))&&(n.hasStmCapture||n.canStartFeatureTransaction?(e.mousedownDate=e.date=r.getDateFromCoordinate(e.event["page".concat(r.isHorizontal?"X":"Y")],null,!1),n.triggerBeforeResize(e)):(r.trigger("eventResizePrevented",{reason:"revision"}),!1))}},{key:"initEventRecordContext",value:function(e,t){var n=e===t.timespanRecord?t.element:this.getSelectedRecordElement(e),r=e.isAssignmentModel?e.event:e,i=r.isBatchUpdating,a=r.wrapEndDate,o=r.wrapStartDate,l=i?r.get("startDate"):r.startDate,s=i?r.get("endDate"):r.endDate,u=t.draggingEnd?s:l;return{mainContext:t,eventRecord:r,element:n,startDate:l,endDate:s,date:u,wrapEndDate:a,wrapStartDate:o,oldValue:u,originalStartDate:l,originalEndDate:s,timespanRecord:r}}},{key:"initResizeContext",value:function(e){var t,n,r,i=this,a=i.client,o=e.startEvent,l=e.itemElement,s=a.resolveEventRecord(l),u=s.endDate,c=s.startDate,d=null===(t=a.features.eventBuffer)||void 0===t?void 0:t.enabled,h="x"===i.dragLock,f=h&&a.rtl,v=i.isOverEndHandle(o,l),g=pt.from(l),m=h?o.clientX:o.clientY,p=v?g.getEnd(f,h):g.getStart(f,h),y=v?u:c,k=S(S({owner:i,valid:!0,offset:d?0:p-m,edge:h?v?"right":"left":v?"bottom":"top",finalize:i.finalize,event:e.event,toSet:v?"endDate":"startDate",otherEnd:v?"startDate":"endDate",setMethod:v?"setEndDate":"setStartDate",setOtherMethod:v?"setStartDate":"setEndDate",wrapToSet:d?v?"wrapEndDate":"wrapStartDate":null,oldValue:y,draggingEnd:v,timespanRecord:s},"".concat(a.scheduledEventName,"Record"),s),"element",(null===(n=this.eventContexts)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.element)||l);return i.resizeSelected&&i.isRecordSelected(s)?(r=i.selectedRecords.filter((function(e){return e.isAssignmentModel?!e.event.readOnly&&e.event.isScheduled:!e.readOnly&&e.isScheduled}))).sort((function(e,t){return e===s?-1:t===s?1:0})):r=[s],k.eventContexts=r.map((function(e){return i.initEventRecordContext(e,k)})),k}},{key:"selectedRecords",get:function(){return this.client.selectedAssignments}},{key:"isRecordSelected",value:function(e){var t,n;return null===(t=(n=this.client).isEventSelected)||void 0===t?void 0:t.call(n,e)}},{key:"getSelectedRecordElement",value:function(e){return e.isAssignmentModel?this.client.getElementFromAssignmentRecord(e,!1,!1,this.client.isLockedRowsView):this.client.getElementFromEventRecord(e)}},{key:"startDrag",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=B(t,"startDrag",this,3)(n);return!1===i||this.hasStmCapture||this.startFeatureTransaction().then(),i}},{key:"dragStart",value:function(e){var t,n=this,r=n.client,i=n.tip,a=e.context=n.initResizeContext(e);(t=r.element.classList).add.apply(t,z(n.dragActiveCls.split(" "))),r.listenToBatchedUpdates||r.beginListeningForBatchedUpdates();var o,l=D(a.eventContexts);try{for(l.s();!(o=l.n()).done;){var s=o.value,u=s.eventRecord;u.meta.isResizing=!0,u.isBatchUpdating||n.beginEventRecordBatch(u),s.element&&n.setupProductResizeContext(s,e.startEvent)}}catch(e){l.e(e)}finally{l.f()}n.triggerEventResizeStart("".concat(r.scheduledEventName,"ResizeStart"),n.getTriggerParams(a),a),i&&(i.show(),i.align=dT[a.edge],i.showBy(n.getTooltipTarget(e)))}},{key:"getTriggerParams",value:function(e){var t=e.eventContexts.map((function(e){return F({},e)})),n=this.client.capitalizedEventName.toLowerCase(),r=F(F({},t.find((function(e){var t,r=e.element,i=e.mainContext;return null==r||null===(t=r.closest(".b-sch-".concat(n,"-wrap")))||void 0===t?void 0:t.isEqualNode(i.element)}))||t[0]),{},{event:e.event,async:e.async,finalize:function(){return e.finalize.apply(e,arguments)},resizeData:t});return delete r.mainContext,r}},{key:"triggerBeforeResize",value:function(e){var t=this.client,n=t.resolveTimeSpanRecord(e.itemElement);return t.trigger("before".concat(t.capitalizedEventName,"Resize"),F(S(S({},"".concat(t.scheduledEventName,"Record"),n),"event",e.event),this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})))}},{key:"triggerEventResizeStart",value:function(e,t,n){var r,i;this.client.trigger(e,t),null===(r=(i=this.client)["after".concat(Le.capitalize(e))])||void 0===r||r.call(i,n,t)}},{key:"triggerEventResizeEnd",value:function(e,t){this.client.trigger(e,t)}},{key:"triggerEventPartialResize",value:function(e,t){var n,r=this.client.scheduledEventName+"Record",i=new a,o=D(t);try{for(o.s();!(n=o.n()).done;){var l=n.value[r];i.set(l,l.batching),l.batching=0}}catch(e){o.e(e)}finally{o.f()}this.client.trigger(e,F(F({},t[0]),{},{resizeData:t}));var s,u=D(t);try{for(u.s();!(s=u.n()).done;){var c=s.value[r];c.batching=i.get(c)}}catch(e){u.e(e)}finally{u.f()}}},{key:"triggerBeforeEventResizeFinalize",value:(u=f(L().mark((function e(t,n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.trigger(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"dragEnter",value:function(e){var t;return(null===(t=e.context)||void 0===t?void 0:t.owner)===this}},{key:"resizeEventPartiallyInternal",value:function(e,t){var n,r=this.client,i=t.mainContext.toSet;if(null!==(n=r.features.eventBuffer)&&void 0!==n&&n.enabled)if("startDate"===i){var a=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+a)}else if("endDate"===i){var o=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+o)}e.set(i,t[i])}},{key:"applyDateConstraints",value:function(e,t,n){var r,i,a=null===(r=n.dateConstraints)||void 0===r?void 0:r.start,o=null===(i=n.dateConstraints)||void 0===i?void 0:i.end;return(a||o)&&(e=Pl.constrain(e,a,o),n.snappedDate=Pl.constrain(n.snappedDate,a,o)),e}},{key:"isDateRangeValid",value:function(e){var t,n=this.client,r=e.startDate,i=e.endDate,a=e.eventRecord,o=null===(t=n.features.eventBuffer)||void 0===t?void 0:t.bufferIsUnavailableTime;return n.isDateRangeAvailable(a.preamble&&o?Pl.add(r,-a.preamble.milliseconds,"ms"):r,a.postamble&&o?Pl.add(i,a.postamble.milliseconds,"ms"):i,a,e.eventRecord.resources)}},{key:"hasValidSize",value:function(e,t){var n="startDate"===t?"endDate":"startDate";return!(!this.client.timeAxisViewModel.snap&&!this.allowResizeToZero)||e[t]-e[n]!=0}},{key:"resizeEventRecord",value:function(e,t,n){var r,i,a=this,o=a.client,l=o.timeAxis,s=o.enableEventAnimations,u=e.eventRecord,c=e.oldValue,d=e.element,h=l.resolutionUnit,f=l.resolutionIncrement,v=u.get("startDate"),g=u.get("endDate"),m=e.mainContext,p=m.toSet,y=m.otherEnd;"endDate"===p?n<v&&(r=-1):n>g&&(r=1),r&&a.onDragEndSwitch&&(a.onDragEndSwitch(e,n,r),y=m.otherEnd,p=m.toSet),o.snapRelativeToEventStartDate&&(n=l.roundDate(n,c)),e.snappedDate=Pl.round(n,l.resolution,null,l.weekStartDay);var k=Pl.diff(n,e[y],h)*(m.draggingEnd?-1:1);if(a.isEventDragCreate&&e.eventRecord===e.mainContext.eventRecord)e.mainContext.tooNarrow=Math.abs(k)<f/2;else if(k<f){if(k<0)return;if(a.allowResizeToZero)e.snappedDate=n=e[y];else{var b="startDate"===y?1:-1,C=l.ceilDate(Pl.add(u.get(y),f*b,h));Pl.diff(C,e[y],h)*(m.draggingEnd?-1:1)>f&&(C=l.roundDate(Pl.add(C,-b,h))),(C-c)*b<0||(n-c)*b>0?(n=b>0?Pl.max(n,C):Pl.min(n,C),e.snappedDate=C):(n=b>0?Pl.max(n,c):Pl.min(n,c),e.snappedDate=c),i=!0}}if(n=a.applyDateConstraints(n,u,e),(!e.date||n-e.date||i)&&(e.date=n,e[p]=a.showExactResizePosition||o.timeAxisViewModel.snap?e.snappedDate:n,e.valid=a.isDateRangeValid(e)&&a.hasValidSize(e,p),u.get(p)-e[p]))return e.valid=a.checkValidity(e,t.event,p),e.message="",e.valid&&"boolean"!=typeof e.valid&&(e.message=e.valid.message,e.valid=e.valid.valid),e.valid=!1!==e.valid,u.isOccurrence&&(u.stores=[o.eventStore]),o.enableEventAnimations=!1,this.resizeEventPartiallyInternal(u,e),o.enableEventAnimations=s,u.isOccurrence&&(u.stores=null),e.tooNarrow&&(e.valid=!1),F(S(S(S(S({},o.scheduledEventName+"Record",u),"startDate",v),"endDate",g),"element",d),S({},p,e[p]))}},{key:"moveDrag",value:function(e){var n=this,r=e.context,i=e.event,a=n.client,o=n.tip,l="x"===n.dragLock,s=l?"X":"Y",u=a.visibleDateRange,c=l&&a.rtl,d=r.offset*(c?-1:1),h=i["client".concat(s)]+d,f=pt.from(a.timeAxisSubGridElement,null,!0),v=f.getStart(c,l),g=f.getEnd(c,l),m=[],p=e.date;r.event=i,i.isScroll&&(e.date=a.getDateFromCoordinate(i["page".concat(s)]+d,null,!1)),c?h>v?p=e.date=u.startDate:h<g&&(p=e.date=u.endDate):h<v?p=e.date=u.startDate:h>g&&(p=e.date=u.endDate),r.message="",r.valid=!0;var y=p-r.oldValue;"Task"===n.client.capitalizedEventName&&(y=p-r.eventContexts[0].oldValue);var k,b=D(r.eventContexts);try{for(b.s();!(k=b.n()).done;){var C,w=k.value,S=new Date(w.oldValue.getTime()+y),x=n.resizeEventRecord(w,e,S);x&&m.push(x),w.valid||(r.valid=!1),null!==(C=w.message)&&void 0!==C&&C.length&&(r.message=w.message)}}catch(e){b.e(e)}finally{b.f()}o&&(o.align=dT[r.edge],o.alignTo(n.getTooltipTarget(e))),m.length&&n.triggerEventPartialResize("".concat(n.client.scheduledEventName,"PartialResize"),m),B(t,"moveDrag",this,3)([e])}},{key:"dragEnd",value:function(e){var t=e.context;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||fr.getPagePoint(e.event).equals(fr.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}},{key:"dragDrop",value:(s=f((function(e){var t=this,n=e.context;return e.event,L().mark((function e(r){var i,a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(i=t).client,o=n.toSet,l=!0,null===(r=i.tip)||void 0===r||r.hide(),u=D(n.eventContexts);try{for(u.s();!(c=u.n()).done;)(d=c.value)[o]=d.snappedDate,h=d.startDate,f=d.endDate,d.valid=h&&f&&(i.allowResizeToZero||f-h>0)&&d[o]-d.oldValue&&!1!==d.valid,d.valid||(l=!1)}catch(e){u.e(e)}finally{u.f()}if(!l){e.next=11;break}return v=i.getTriggerParams(n),g=F(F({},v),{},{context:v}),e.next=9,i.triggerBeforeEventResizeFinalize("before".concat(a.capitalizedEventName,"ResizeFinalize"),g);case 9:(g.async||v.async)&&(n.async=!0),s=!0;case 11:if(n.async){e.next=14;break}return e.next=14,n.finalize(s);case 14:case"end":return e.stop()}}),e)}))()})),function(e){return s.apply(this,arguments)})},{key:"eventRecordFinalize",value:(l=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).client,a=[],o=!1,n)a=t.eventContexts.map((function(e){return r.internalUpdateRecord(e,e.eventRecord)}));else{l=D(t.eventContexts);try{for(l.s();!(s=l.n()).done;)u=s.value,c=u.eventRecord,r.cancelEventRecordBatch(c),c.isOccurrence&&c.resources.forEach((function(e){return i.repaintEventsForResource(e)}))}catch(e){l.e(e)}finally{l.f()}}if(!a.length){e.next=9;break}return e.next=6,Promise.all(a);case 6:if(!r.isDestroyed){e.next=8;break}return e.abrupt("return");case 8:o=a.some((function(e){return e}));case 9:r.cleanup(t,o);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"finalize",value:(o=f(L().mark((function e(t){var n,r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.owner,r=this,i=n.client,a=i.snapRelativeToEventStartDate,o=i.timeAxis,l=r.toSet,!r.finalizing){e.next=3;break}return e.abrupt("return");case 3:return r.finalizing=!0,t&&(r.eventContexts.forEach((function(e){var t=e.oldValue;a&&(e[l]=e.snappedDate=o.roundDate(e.date,t)),n.adjustRecordBeforeUpdating(e,e.eventRecord)})),n.client.endListeningForBatchedUpdates()),e.next=7,n.eventRecordFinalize(r,t);case 7:if(!t){e.next=12;break}return e.next=10,n.finishFeatureTransaction();case 10:e.next=13;break;case 12:n.rejectFeatureTransaction();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"cleanup",value:function(e,t){var n,r,i,a=this,o=a.client,l=D(e.eventContexts);try{for(l.s();!(i=l.n()).done;){var s=i.value,u=s.element;s.eventRecord.meta.isResizing=!1,a.unHighlightHandle(u)}}catch(e){l.e(e)}finally{l.f()}o.endListeningForBatchedUpdates(),null===(n=a.tip)||void 0===n||n.hide(),(r=o.element.classList).remove.apply(r,z(a.dragActiveCls.split(" "))),a.triggerEventResizeEnd("".concat(o.scheduledEventName,"ResizeEnd"),F(F({},a.getTriggerParams(e)),{},{changed:t}))}},{key:"adjustRecordBeforeUpdating",value:function(e,t){var n=e.startDate,r=e.endDate,i=e.mainContext,a=i.toSet,o=i.draggingEnd,l=i.otherEnd;if(!t.isOccurrence&&t.isEntity&&(!t.manuallyScheduled||t.project.skipNonWorkingTimeWhenSchedulingManually)){var s=t.run("calculateProjectedDuration",n,r);t.set(S(S({},a,t.run("calculateProjectedXDateWithDuration",o?n:r,o,s)),l,e[l]))}}},{key:"internalUpdateRecord",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.client,i=n.generation,a=t.startDate,o=t.endDate,l=t.mainContext,s=l.toSet,u=l.wrapToSet,c=l.setMethod,n.isOccurrence?(n[n.batching>1?"endBatch":"cancelBatch"](),n.set(Bw.prototype.inSetNormalize.call(n,{startDate:a,endDate:o}))):(delete(h=Object.assign({},n.meta.batchChanges))[s],delete h.duration,this.cancelEventRecordBatch(n),null!==(d=r.features.eventBuffer)&&void 0!==d&&d.enabled&&(n[u]=null),n[c](t[s],!1),Object.keys(h).length&&n.set(h)),e.next=4,r.project.commitAsync();case 4:return e.abrupt("return",n.generation!==i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onDragItemMouseMove",value:function(e){"touch"===e.pointerType||this.handleSelector||0!==e.buttons||this.checkResizeHandles(e)}},{key:"checkResizeHandles",value:function(e){var t=this,n=t.overItem;if(n&&!t.client.readOnly&&(!t.allowResize||t.allowResize(n,e))){var r=t.client.resolveTimeSpanRecord(n);if(null!=r&&r.readOnly)return;t.isOverAnyHandle(e,n)?t.highlightHandle():t.unHighlightHandle()}}},{key:"onDragItemMouseLeave",value:function(e,t){this.unHighlightHandle(t)}},{key:"highlightHandle",value:function(){var e,t,n=this.overItem,r=this.client;(null!==(e=null===(t=n.syncIdMap)||void 0===t?void 0:t[r.scheduledEventName])&&void 0!==e?e:n.querySelector(r.eventInnerSelector)).classList.add("b-resize-handle"),n.classList.add("b-over-resize-handle")}},{key:"unHighlightHandle",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.overItem;if(e){var t,n,r=this,a=null!==(t=null===(n=e.syncIdMap)||void 0===n?void 0:n[r.client.scheduledEventName])&&void 0!==t?t:e.querySelector(r.client.eventInnerSelector);a&&a.classList.remove("b-resize-handle",r.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",r.draggingItemCls)}}},{key:"isOverAnyHandle",value:function(e,t){return Boolean(this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t))}},{key:"isOverStartHandle",value:function(e,t){var n;return Boolean(null===(n=this.getHandleRect("start",e,t))||void 0===n?void 0:n.contains(fr.getPagePoint(e)))}},{key:"isOverEndHandle",value:function(e,t){var n;return Boolean(null===(n=this.getHandleRect("end",e,t))||void 0===n?void 0:n.contains(fr.getPagePoint(e)))}},{key:"getHandleRect",value:function(e,t,n){if(this.overItem){if(!(n=t.target.closest(".".concat(this.client.eventCls))||n.querySelector(".".concat(this.client.eventCls))))return;var i=this,a="start"===e,o=i.client,l=Boolean(o.rtl),s=i.dragLock,u="x"===s,c=u?"width":"height",d="".concat(u?a?l?"right":"left":l?"left":"right":a?"top":"bottom","Handle"),h=o.resolveTimeSpanRecord(n),f=null==h?void 0:h.isResizable,v=pt.from(n),g=v.clone(),m=r.getComputedStyle(n,":before"),p=i.dynamicHandleSize?i.reservedSpace/2:0,y=[0,0,0,0],k=parseFloat(m[c]);if(!i.disabled&&k&&!isNaN(k)&&i[d]&&i.dynamicHandleSize&&(!0===f||f===e)){var b=!u&&!a||u&&l===a,C=v[c];if(k>.5*C&&(k=Math.max(Math.floor(C/4)-1,1)),b?(g[s]+=C-k,y[u?3:0]=C/2+p):y[u?1:2]=C/2+p,v.deflate.apply(v,y),g[c]=k,g.constrainTo(v),g[c])return g}}}},{key:"setupDragContext",value:function(e){var n=this;if(n.overItem&&n.isOverAnyHandle(e,n.overItem)&&n.isElementResizable(n.overItem,e)){var r=B(t,"setupDragContext",this,3)([e]);return r.scrollManager=n.client.scrollManager,r}}},{key:"changeTip",value:function(e,t){var n=this;if(!n.showTooltip)return null;if(e)e.isTooltip?e.owner=n:e=pc.reconfigure(t,pc.mergeConfigs({id:n.tipId},e,{getHtml:n.getTipHtml.bind(n),owner:n.client},n.tip),{owner:n,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:n}),n.clockTemplate=new sT({scheduler:n.client});else if(t){var r;t.destroy(),null===(r=n.clockTemplate)||void 0===r||r.destroy()}return e}},{key:"isElementResizable",value:function(e,t){var n,r,i=this,a=i.client,o=a.resolveTimeSpanRecord(e);if(a.readOnly)return!1;var l=null==o?void 0:o.isResizable,s=null!==(n=null===(r=e)||void 0===r?void 0:r.syncIdMap[a.scheduledEventName])&&void 0!==n?n:e,u=t.target.closest('[class$="-handle"]');if(!l||u&&u!==s)return!1;if(!(e=t.target.closest(i.dragSelector)))return!1;var c=e.classList.contains("b-sch-event-startsoutside"),d=e.classList.contains("b-sch-event-endsoutside");if(!0===l){if(c&&d)return!1;if(c)l="end";else{if(!d)return i.isOverStartHandle(t,e)||i.isOverEndHandle(t,e);l="start"}}return!(c&&"start"===l||d&&"end"===l)&&!!(i.isOverStartHandle(t,e)&&"start"===l||i.isOverEndHandle(t,e)&&"end"===l)}},{key:"updateDateIndicator",value:function(){var e=this.clockTemplate,t=this.dragging.context,n=t.eventContexts[0],r=n.eventRecord,i=n.snappedDate,a=t.draggingEnd,o=a?r.get("startDate"):i,l=a?i:r.get("endDate"),s=this.tip.element;e.updateDateIndicator(s.querySelector(".b-sch-tooltip-startdate"),o),e.updateDateIndicator(s.querySelector(".b-sch-tooltip-enddate"),l)}},{key:"getTooltipTarget",value:function(e){var t=e.itemElement,n=e.context,r=this,i=r.client.rtl,a=pt.from(t,null,!0);return"x"===r.dragLock?(!i&&"right"===n.edge||i&&"left"===n.edge?a.x=a.right-1:a.x-=r.tip.anchorSize[0]/2,a.width=r.tip.anchorSize[0]/2):("bottom"===n.edge&&(a.y=a.bottom-1),a.height=r.tip.anchorSize[1]/2),{target:a}}},{key:"basicValidityCheck",value:function(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}},{key:"getTipHtml",value:function(e){var t=e.tip,n=this,r=n.dragging.context,i=r.eventContexts.find((function(e){return e.eventRecord===r.timespanRecord})),a=i.startDate,o=i.endDate,l=i.snappedDate,s=i.eventRecord,u=r.toSet,c=r.valid,d=r.message,h=void 0===d?"":d;if(!a||!o)return t.html;var f=S({record:s,valid:c,message:h,startDate:a,endDate:o},u,l);return f.startText=n.client.getFormattedDate(f.startDate),f.endText=n.client.getFormattedDate(f.endDate),f.startClockHtml=n.clockTemplate.template({date:f.startDate,text:f.startText,cls:"b-sch-tooltip-startdate"}),f.endClockHtml=n.clockTemplate.template({date:f.endDate,text:f.endText,cls:"b-sch-tooltip-enddate"}),n.tooltipTemplate(f)}},{key:"beginEventRecordBatch",value:function(e){e.beginBatch()}},{key:"cancelEventRecordBatch",value:function(e){e.cancelBatch()}},{key:"getBeforeResizeParams",value:function(e){var t=this.client;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}},{key:"setupProductResizeContext",value:function(e,t){var n,r,i,a=this.client,o=e.element,l=a.resolveEventRecord(o),s=null===(n=a.resolveResourceRecord)||void 0===n?void 0:n.call(a,o),u=null===(r=a.resolveAssignmentRecord)||void 0===r?void 0:r.call(a,o);Object.assign(e,{eventRecord:l,resourceRecord:s,assignmentRecord:u,dateConstraints:null===(i=a.getDateConstraints)||void 0===i?void 0:i.call(a,s,l)})}},{key:"checkForEventOverlap",value:function(e){var t,n=e.startDate,r=e.endDate,i=e.snappedDate,a=e.eventRecord,o=e.toSet,l=this.client,s=null===(t=l.features.eventBuffer)||void 0===t?void 0:t.bufferIsUnavailableTime,u=a.resources;return a.preamble&&s&&("startDate"===o?i=Pl.add(i,-a.preamble.milliseconds,"ms"):n=Pl.add(n,-a.preamble.milliseconds,"ms")),a.postamble&&s&&("startDate"===o?r=Pl.add(r,a.postamble.milliseconds,"ms"):i=Pl.add(i,a.postamble.milliseconds,"ms")),"startDate"===o?!l.isDateRangeAvailable(i,r,a,u):!l.isDateRangeAvailable(n,i,a,u)}},{key:"checkValidity",value:function(e,t,n){var r=e.startDate,i=e.endDate,a=e.eventRecord,o=e.snappedDate;return e.resourceRecord,this.checkForEventOverlap({startDate:r,endDate:i,snappedDate:o,eventRecord:a,toSet:n})?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck.apply(this,arguments)}},{key:"tipId",get:function(){return"".concat(this.client.id,"-event-resize-tip")}}],[{key:"configurable",get:function(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:1,dragThreshold:0,dragTouchStartDelay:300,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:function(){return!0},validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:function(e){return'\n                <div class="b-sch-tip-'.concat(e.valid?"valid":"invalid",'">\n                    ').concat(e.startClockHtml,"\n                    ").concat(e.endClockHtml,'\n                    <div class="b-sch-tip-message">').concat(e.message,"</div>\n                </div>\n            ")},ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event",lockLayout:!0,resizeSelected:!0}}},{key:"pluginConfig",get:function(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}}]);var n,o,l,s,u}(wc.mixin(ty,ny,cT));S(hT,"$name","EventResize"),hT._$name="EventResize",Ug.registerFeature(hT,!0,"Scheduler"),Ug.registerFeature(hT,!1,"ResourceHistogram");var fT=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getStmCapture",value:function(){var e,n;return Object.assign(null!==(e=null===(n=B(t,"getStmCapture",this,3))||void 0===n?void 0:n([]))&&void 0!==e?e:{},{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1})}},{key:"applyStmCapture",value:function(e){this.stmInitiallyAutoRecord=e.stmInitiallyAutoRecord,this.stmInitiallyDisabled=e.stmInitiallyDisabled,this.hasStmCapture=!0,this.stmCapture=e,e.transferred=!0}},{key:"captureStm",value:function(){var e=arguments.length>0&&arguments[0]!==i&&arguments[0],t=this,n=t.project.getStm();t.hasStmCapture||(t.hasStmCapture=!0,t.stmInitiallyDisabled=n.disabled,t.stmInitiallyAutoRecord=n.autoRecord,t.stmInitiallyDisabled?(n.enable(),n.autoRecord=!1):(t.stmInitiallyAutoRecord&&(n.autoRecord=!1),n.isRecording&&n.stopTransaction()),e&&this.startStmTransaction())}},{key:"startStmTransaction",value:function(){this.project.getStm().startTransaction()}},{key:"commitStmTransaction",value:function(){var e=this,t=e.project.getStm();if(!e.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");t.enabled&&(t.stopTransaction(),e.stmInitiallyDisabled&&t.resetQueue())}},{key:"rejectStmTransaction",value:(r=f(L().mark((function e(){var t,n,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.project.getStm(),n=this.client,this.hasStmCapture){e.next=3;break}throw new Error("Does not have STM capture, no transaction to reject");case 3:if(!t.enabled){e.next=12;break}if(null===(r=t.transaction)||void 0===r||!r.length){e.next=11;break}return n.suspendRefresh(),t.rejectTransaction(),e.next=9,n.resumeRefresh(!0);case 9:e.next=12;break;case 11:t.isRecording&&t.stopTransaction();case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"enableStm",value:function(){this.project.getStm().enable()}},{key:"disableStm",value:function(){this.project.getStm().disable()}},{key:"freeStm",value:(n=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:null;return L().mark((function n(){var r,i,a,o,l;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(r=e).project.getStm(),a=r.stmInitiallyDisabled,o=r.stmInitiallyAutoRecord,r.hasStmCapture){n.next=3;break}return n.abrupt("return");case 3:return r.rejectingStmTransaction=!0,!0===t?l=r.commitStmTransaction():!1===t&&(l=r.rejectStmTransaction()),r.hasStmCapture=!1,r.stmCapture=null,n.next=9,l;case 9:i.isDestroying||(i.disabled=a,i.autoRecord=o),r.isDestroying||(r.rejectingStmTransaction=!1);case 11:case"end":return n.stop()}}),n)}))()})),function(){return n.apply(this,arguments)})}]);var n,r}(e||Mn),S(t,"$name","TaskEditStm"),t},vT=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"captureStm",value:function(e){if(this.client.transactionalFeaturesEnabled)return B(t,"captureStm",this,3)([]),this.startStmTransaction(e);B(t,"captureStm",this,3)([e])}},{key:"freeStm",value:function(e){if(this.hasStmCapture||!this.client.transactionalFeaturesEnabled)return B(t,"freeStm",this,3)([e])}},{key:"startStmTransaction",value:(n=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.client.transactionalFeaturesEnabled){e.next=5;break}return e.next=3,this.startFeatureTransaction(n);case 3:e.next=6;break;case 5:B(t,"startStmTransaction",this,3)([]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"commitStmTransaction",value:function(){if(this.client.transactionalFeaturesEnabled)return this.finishFeatureTransaction();B(t,"commitStmTransaction",this,3)([])}},{key:"afterCancel",value:function(){this.client.transactionalFeaturesEnabled&&this.rejectFeatureTransaction()}}]);var n}(e||Mn),S(t,"$name","TaskEditTransactional"),t},gT=function(e){var t;return(null===(t=this.source)||void 0===t||null===(t=t.client.features.taskEdit)||void 0===t||!t._canceling)&&fr.getDistanceBetween(this.startEvent,e)},mT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){!1===(null==n?void 0:n.showTooltip)&&(n.tip=null),B(t,"construct",this,3)(arguments)}},{key:"changeValidatorFn",value:function(e){this.createValidatorFn=e}},{key:"render",value:function(){var e=this,t=e.client;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}},{key:"onDragEndSwitch",value:function(e){var t=this.client,n=t.enableEventAnimations,r=e.eventRecord,i=e.mainContext.draggingEnd,a="x"===this.dragLock,o=this.dragging.initialDate;t.enableEventAnimations=!1,r.set({startDate:o,endDate:o}),i?(e.endDate=o,Object.assign(e.mainContext,{toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:a?"left":"top"})):(e.startDate=o,Object.assign(e.mainContext,{toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:a?"right":"bottom"})),e.mainContext.draggingEnd=this.draggingEnd=!i,t.enableEventAnimations=n}},{key:"beforeDrag",value:function(e){var n=this,r=B(t,"beforeDrag",this,3)([e]),i=n.client.features,a=i.pan,o=i.eventDragSelect;return!(!1===r||n.preventMultiple&&!n.isRowEmpty(e.rowRecord)||n.disabled||a&&!a.disabled||o&&!o.disabled)&&(n.client.preventDragSelect=!0,r)}},{key:"startDrag",value:function(e){var n=B(t,"startDrag",this,3)([e]);if(!1!==n){var r=_(e.context.eventContexts,1)[0];e.initialDate=r.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:r.eventRecord,resourceRecord:r.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return n}},{key:"isOverEndHandle",value:function(){return this.draggingEnd}},{key:"setupDragContext",value:function(e){var t=this.client;if(t.matchScheduleCell(e.target)){var n=t.resolveResourceRecord(e),r=null==n?void 0:n.$original;if(r&&!r.isSpecialRow){var i=ty().prototype.setupDragContext.call(this,e),a=[];return t.isVertical?a.push({element:t.scrollable.element,direction:"vertical"}):a.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i.scrollManager=t.scrollManager,i.monitoringConfig={scrollables:a},i.resourceRecord=i.rowRecord=r,n!==r&&(i.resourceRecordLink=n),i.getDistance=gT,i}}}},{key:"dragDrop",value:(o=f((function(e){var t=this,n=e.context,r=e.event;return L().mark((function e(i){var a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.client,o=n.toSet,l=_(n.eventContexts,1),(s=l[0])[o]=s.snappedDate,u=s.startDate,c=s.endDate,d=s.eventRecord,h=d.generation,null===(i=t.tip)||void 0===i||i.hide(),e.next=6,a.project.commitAsync();case 6:if(d.generation!==h&&(d[o]=s.oldValue,d[o]=s[o]),n.valid=u&&c&&c-u>0&&s[o]-s.oldValue&&!1!==n.valid,n.valid&&(n.startDate=s.startDate,n.endDate=s.endDate,a.trigger("beforeDragCreateFinalize",{context:n,event:r,proxyElement:s.element,eventElement:s.element,eventRecord:s.eventRecord,resourceRecord:s.resourceRecord}),f=!0),n.async){e.next=12;break}return e.next=12,n.finalize(f);case 12:case"end":return e.stop()}}),e)}))()})),function(e){return o.apply(this,arguments)})},{key:"updateDragTolerance",value:function(e){this.dragThreshold=e}},{key:"changeTip",value:function(e,n){return B(t,"changeTip",this,3)([!e||e.isTooltip?e:Be.assign({id:"".concat(this.client.id,"-drag-create-tip")},e),n])}},{key:"finalize",value:(a=f(L().mark((function e(t){var n,r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.finalized){e.next=2;break}return e.abrupt("return");case 2:if(this.finalized=!0,n=this.owner,i=_((r=this).eventContexts,1),a=i[0],o=function(){n.isDestroyed||(n.client.trigger("afterDragCreate",{proxyElement:a.element,eventElement:a.element,eventRecord:a.eventRecord,resourceRecord:a.resourceRecord}),n.cleanup(r))},!t){e.next=10;break}return e.next=7,n.finalizeDragCreate(r);case 7:o(),e.next=14;break;case 10:return e.next=12,n.cancelDragCreate(r);case 12:null===(l=n.onAborted)||void 0===l||l.call(n,r),o();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"cancelDragCreate",value:(r=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"finalizeDragCreate",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).client,i=_(t.eventContexts,1),a=i[0],o=a.eventRecord,l=a.resourceRecord,r.snapRelativeToEventStartDate&&(a[t.toSet]=a.snappedDate=r.timeAxis.roundDate(a.date,a.oldValue)),n.adjustRecordBeforeUpdating(a,o),r.endListeningForBatchedUpdates(),e.next=6,n.internalUpdateRecord(a,o);case 6:return s=n.getStmCapture(),!r.isDestroyed&&r.trigger("dragCreateEnd",{eventRecord:o,resourceRecord:l,event:t.event,eventElement:a.element,stmCapture:s}),!r.isDestroyed&&r.trigger("eventAutoCreated",{eventRecord:o,resourceRecord:l}),e.abrupt("return",s.transferred);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"cleanup",value:function(e){var t,n,r=this.client,i=_(e.eventContexts,1)[0];i.eventRecord.meta.isResizing=!1,r.endListeningForBatchedUpdates(),null===(t=this.tip)||void 0===t||t.hide(),(n=r.element.classList).remove.apply(n,z(this.dragActiveCls.split(" "))),i.element.parentElement.classList.remove("b-sch-dragcreating")}},{key:"onElementContextMenu",value:function(){if(this.proxy)return!1}},{key:"prepareCreateContextForFinalization",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i&&arguments[3];return F(F({},e),{},{async:r,event:t,finalize:n})}},{key:"onEventDataGenerated",value:function(e){var t;(null===(t=this.dragging)||void 0===t||null===(t=t.context)||void 0===t?void 0:t.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}},{key:"isDragCreating",get:function(){var e=this.dragging;return e&&e.state===e.constructor.STATE.DRAGGING}},{key:"triggerBeforeResize",value:function(){}},{key:"triggerEventResizeStart",value:function(){}},{key:"checkValidity",value:function(e,t){throw new Error("Implement in subclass")}},{key:"handleBeforeDragCreate",value:function(e,t){throw new Error("Implement in subclass")}},{key:"isRowEmpty",value:function(e){throw new Error("Implement in subclass")}}],[{key:"pluginConfig",get:function(){return{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}}}]);var n,r,a,o}(hT.mixin(fT,vT));S(mT,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:function(e){return'\n            <div class="b-sch-tip-'.concat(e.valid?"valid":"invalid",'">\n                ').concat(e.startClockHtml,"\n                ").concat(e.endClockHtml,'\n                <div class="b-sch-tip-message">').concat(e.message,"</div>\n            </div>\n        ")},dragActiveCls:"b-dragcreating"}),mT._$name="DragCreateBase";var pT=Pl,yT=["startDate","endDate","resource","recurrenceRule"],kT=function(e){if(1===e.length)return e[0].value;if(2===e.length){var t=_(e[0]instanceof Pk?e:e.reverse(),2),n=t[0],r=t[1],i=pT.parse(n.value);return i&&r.value&&i.setHours(r.value.getHours(),r.value.getMinutes(),r.value.getSeconds(),r.value.getMilliseconds()),i?Pl.clone(i):null}return null},bT=function(e,t){var n=new Date(e.getTime());return n.setHours(t.getHours(),t.getMinutes()),n},CT=function(e,t,n){if(!n.editor.assigningValues&&e&&t&&n.endDateField&&n.endTimeField){var r=pT.add(bT(n.startDateField.value,n.startTimeField.value),n._durationMS,"milliseconds");n.endDateField.value=r,n.endTimeField.value=pT.clone(r)}},wT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;e.eventEdit=r,B(t,"construct",this,3)([e,Be.assign({weekStartDay:e.weekStartDay},n)]),r.clientListenersDetacher=e.ion(S(S(S(S({},r.triggerEvent,"onActivateEditor"),"dragCreateEnd","onDragCreateEnd"),"eventAutoCreated","onEventAutoCreated"),"thisObj",r))}},{key:"doDestroy",value:function(){var e;this.clientListenersDetacher(),null===(e=this._editor)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"onEventAutoCreated",value:function(){}},{key:"changeEditorConfig",value:function(e){var t=this.items;return t&&((e=pe.clone(e)).items=rn.merge(t,e.items)),e}},{key:"changeItems",value:function(e){return this.cleanItemsConfig(e),e}},{key:"cleanItemsConfig",value:function(e){for(var t in e){var n=e[t];!0===n?delete e[t]:null!=n&&n.items&&this.cleanItemsConfig(n.items)}}},{key:"onDatesChange",value:function(e){var t,n,r,i,a,o=e.value,l=e.source,s=this;if(o&&l===s.startDateField&&null!==(t=s.startTimeField)&&void 0!==t&&t.keepDate&&s.startTimeField.value&&(s.startTimeField.value.setFullYear(o.getFullYear()),s.startTimeField.value.setMonth(o.getMonth()),s.startTimeField.value.setDate(o.getDate())),(l===s.endDateField||l===s.endTimeField)&&s.startDateField){var u,c,d,h,f,v,g=null!==(u=s.endTimeField)&&void 0!==u&&u.value&&null!==(c=s.endDateField)&&void 0!==c&&c.value?bT(s.endDateField.value,s.endTimeField.value):null===(d=s.endDateField)||void 0===d?void 0:d.value,m=null!==(h=s.startTimeField)&&void 0!==h&&h.value&&null!==(f=s.startDateField)&&void 0!==f&&f.value?bT(s.startDateField.value,s.startTimeField.value):null===(v=s.startDateField)||void 0===v?void 0:v.value;g&&m&&(s._durationMS=g-m)}(s.startDateField&&s.endDateField&&(s.endDateField.min=s.startDateField.value),s.endTimeField)&&(pT.isEqual(pT.clearTime(null===(i=s.startDateField)||void 0===i?void 0:i.value),pT.clearTime(null===(a=s.endDateField)||void 0===a?void 0:a.value))?s.endTimeField.min=s.startTimeField.value:s.endTimeField.min=null);switch(l.ref){case"startDateField":(null===(n=s.startTimeField)||void 0===n?void 0:n.value)&&CT(o,s.startTimeField.value,s);break;case"startTimeField":(null===(r=s.startDateField)||void 0===r?void 0:r.value)&&CT(s.startDateField.value,o,s)}}},{key:"save",value:(o=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Implement in subclass");case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"values",get:function(){var e=this,t=e.editor,n=[],r=[],i=t.values;return yT.forEach((function(e){return delete i[e]})),t.eachWidget((function(a){var o,l=a.name;if(!l||a.hidden||a.up((function(t){return t===e.recurrenceEditor})))delete i[l];else switch(l){case"startDate":n.push(a);break;case"endDate":r.push(a);break;case"resource":i[l]=a.record;break;case"recurrenceRule":i[l]="none"===(null===(o=t.widgetMap.recurrenceCombo)||void 0===o?void 0:o.value)?"":a.value}}),!0),i.allDay&&!e.eventRecord.allDay&&(n.push(e.startTimeField),r.push(e.endTimeField)),n.length&&(i.startDate=kT(n)),r.length&&(i.endDate=kT(r)),"startDate"in i&&"endDate"in i&&(i.duration=pT.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}},{key:"onBeforeSave",value:function(e){}},{key:"onAfterSave",value:function(e){}},{key:"updateRecord",value:function(e){var t,n=this.values;return this.assignmentStore&&delete n.resource,this._durationMS=Pl.asMilliseconds(null!==(t=n.duration)&&void 0!==t?t:e.duration,e.durationUnit),e.set(n)}},{key:"onBeforeEditorShow",value:function(){var e=this.editingContext,t=e.eventRecord,n=e.editor,r=n.widgetMap.nameField;r&&t.isCreating&&(n.assigningValues=!0,r.value="",n.assigningValues=!1,r._configuredPlaceholder=r.placeholder,r.placeholder=t.name)}},{key:"resetEditingContext",value:function(){var e=this;if(e.editingContext){var t=e.client,n=e.editingContext,r=n.editor,i=n.eventRecord,a=t.eventStore,o=r.widgetMap.nameField;if(i.isCreating){var l;if(t.isTimelineBase)null===(l=e.editingContext.eventElement)||void 0===l||l.closest("[data-event-id]").classList.add("b-released");a.remove(i),i.isCreating=!1}o&&(o.placeholder=o._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),e.targetEventElement=e.editingContext=r._record=null}}},{key:"onPopupKeyDown",value:function(e){var t=e.event,n=this;!n.readOnly&&"Enter"===t.key&&n.saveAndCloseOnEnter&&"input"===t.target.tagName.toLowerCase()&&(t.preventDefault(),"startDate"===t.target.name&&n.startTimeField&&CT(n.startDateField.value,n.startTimeField.value,n),n.onSaveClick())}},{key:"finalizeStmCapture",value:(a=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"onSaveClick",value:(i=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).editor.focus(),t.isFinalizingEventSave=!0,e.next=5,t.save();case 5:if(n=e.sent,t.isFinalizingEventSave=!1,!n){e.next=11;break}return e.next=10,t.finalizeStmCapture(!1);case 10:t.isDestroyed||(t.editor.close(t),t.client.trigger("afterEventEdit",F(F({},t.editingContext),{},{action:"save"})));case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"onDeleteClick",value:(r=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).isDeletingEvent=!0,e.next=4,t.deleteEvent();case 4:if(n=e.sent,t.isDeletingEvent=!1,!n){e.next=10;break}return e.next=9,t.finalizeStmCapture(!1);case 9:t.isDestroyed||(t.editor.close(t),t.client.trigger("afterEventEdit",F(F({},t.editingContext),{},{action:"delete"})));case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"onCancelClick",value:(n=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this).isCancelingEdit=!0,t.editor.close(t),t.isCancelingEdit=!1,!t.hasStmCapture){e.next=7;break}return e.next=7,t.finalizeStmCapture(!0);case 7:t.isDestroyed||t.client.trigger("afterEventEdit",F(F({},t.editingContext),{},{action:"cancel"}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"configurable",get:function(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}}]);var n,r,i,a,o}(wc);wT._$name="EditBase";var DT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"noFeatureElementsInAxis",value:function(){var e=this.client.timeAxis;return!this.needsRefresh&&this.store&&!this.store.storage.values.some((function(t){return e.isTimeSpanInAxis(t)}))}},{key:"doDisable",value:function(e){this.client.isPainted&&this.client.refresh(),B(t,"doDisable",this,3)([e])}},{key:"updateTabIndex",value:function(){this.isConfiguring||this.client.refresh()}},{key:"onInternalPaint",value:function(e){e.firstPaint&&this.setupCanvas()}},{key:"setupCanvas",value:function(){var e=this.entityName,t=this.client;this.canvas||(this.canvas=t.canvases[e]=li.createElement({className:"b-".concat(Le.hyphenate(e),"-canvas b-sch-canvas"),parent:t.timeAxisSubGridElement,retainElement:!0}))}},{key:"getEventsToRender",value:function(e,t){throw new Error("Implement in subclass")}},{key:"onEventDataGenerated",value:function(e){var t=this,n=t.client,r=e.eventRecord,i=e.iconCls;t.shouldInclude(r)&&(n.isVertical?e.width=n.getResourceWidth(e.resourceRecord):e.top=0,e.entityName=t.entityName,e.fillSize=!0,e.wrapperCls["b-sch-resourcetimerange"]=1,t.rangeCls&&(e.wrapperCls[t.rangeCls]=1),e.wrapperCls["b-sch-color-".concat(r.timeRangeColor)]=r.timeRangeColor,t.renderContent(r,e),e.children.push(e.eventContent),e.tabIndex=null!=t.tabIndex?String(t.tabIndex):null,(null==i?void 0:i.length)>0&&e.children.unshift({tag:"i",className:i.toString()}),e.eventId=t.generateElementId(r))}},{key:"renderContent",value:function(e,t){t.eventContent.text=e.name}},{key:"generateElementId",value:function(e){return e.domId}},{key:"resolveResourceTimeRangeRecord",value:function(e){var t;return null==e||null===(t=e.closest(".".concat(this.rangeCls)))||void 0===t?void 0:t.elementData.eventRecord}},{key:"getElementFromResourceTimeRangeRecord",value:function(e){return this.canvas.syncIdMap[e.domId]}},{key:"resolveResourceRecord",value:function(e){var t,n;return(t=this.overridden).resolveResourceRecord.apply(t,arguments)||(null===(n=this.resolveResourceTimeRangeRecord(e.target||e))||void 0===n?void 0:n.resource)}},{key:"shouldInclude",value:function(e){throw new Error("Implement in subclass")}},{key:"onStoreChange",value:function(e){"removeall"!==e.action&&"dataset"!==e.action||(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}},{key:"matchScheduleCell",value:function(e){var t=this.overridden.matchScheduleCell(e);if(!t&&this.enableMouseEvents){var n=this.client,r=e.closest(".".concat(this.rangeCls));t=r&&n.getCell({record:n.isHorizontal?r.elementData.resource:n.store.first,column:n.timeAxisColumn})}return t}},{key:"handleRangeMouseEvent",value:function(e){var t=this,n=e.target.closest(".".concat(t.rangeCls));if(n){var r,i=null!==(r=fr.eventNameMap[e.type])&&void 0!==r?r:Le.capitalize(e.type),a=t.resolveResourceTimeRangeRecord(n);t.client.trigger(t.entityName+i,S(S(S(S(S({feature:t},"".concat(t.entityName,"Record"),a),"resourceRecord",t.client.resourceStore.getById(a.resourceId)),"startDate",a.startDate),"endDate",a.endDate),"domEvent",e))}}},{key:"updateEnableMouseEvents",value:function(e){var t,n=this,r=n.client;null===(t=n.mouseEventsDetacher)||void 0===t||t.call(n),n.mouseEventsDetacher=null,r.whenVisible((function(){e&&(n.mouseEventsDetacher=fr.on({element:r.canvases[n.entityName],delegate:".".concat(n.rangeCls),mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:n})),n.canvas.classList.toggle("b-interactive",Boolean(e))}))}}],[{key:"pluginConfig",get:function(){return{before:["onInternalPaint"],chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}}])}(wc.mixin(DR));S(DT,"configurable",{tabIndex:null,entityName:"resourceTimeRange"}),DT.featureClass="",DT._$name="ResourceTimeRangesBase";var ST=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(op);ST._$name="TimeSpanMenuBase";var xT,ET=0,RT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;n=r.processConfig(n),B(t,"construct",this,3)([e,n]),r.forSelector||(r.forSelector="".concat(e.eventInnerSelector,":not(.b-dragproxy,.b-iscreating)")),r.clockTemplate=new sT({scheduler:e}),e.ion(S({},"before".concat(e.scheduledEventName,"drag"),(function(){var e;null===(e=r.tooltip)||void 0===e||e.hide()})))}},{key:"processConfig",value:function(e){return"function"==typeof e?{template:e}:e}},{key:"setConfig",value:function(e){B(t,"setConfig",this,3)([this.processConfig(e)])}},{key:"doDestroy",value:function(){this.destroyProperties("clockTemplate","tooltip"),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){this.tooltip&&(this.tooltip.disabled=e),B(t,"doDisable",this,3)([e])}},{key:"onInternalPaint",value:function(e){var t=this;if(e.firstPaint){var n,r=this,i=r.client,a=":not(".concat([".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",".b-dragging-".concat(i.scheduledEventName),".b-creating-dependency",".b-dragproxy"].join(),")");null===(n=r.tooltip)||void 0===n||n.destroy();var o=r.tooltip=new pc(F(F({axisLock:"flexible",id:r.tipId||"".concat(r.client.id,"-event-tip-").concat(ET++),cls:r.tipCls,forSelector:".b-timelinebase".concat(a," .b-grid-body-container:not(.b-scrolling) ").concat(r.forSelector),scrollAction:"realign",forElement:i.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:r.getTipHtml.bind(r),disabled:r.disabled},r.config),{},{internalListeners:r.configuredListeners}));o.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:r}),Object.keys(o.$meta.configs).forEach((function(e){Object.defineProperty(t,e,{set:function(t){return o[e]=t},get:function(){return o[e]}})}))}}},{key:"processConfiguredListeners",value:function(){}},{key:"addListener",value:function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=B(t,"addListener",this,3)(r),o=null===(e=this.tooltip)||void 0===e?void 0:e.addListener.apply(e,r);if(a||o)return function(){null==a||a(),null==o||o()}}},{key:"removeListener",value:function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];B(t,"removeListener",this,3)(r),null===(e=this.tooltip)||void 0===e||e.removeListener.apply(e,r)}},{key:"updateDateIndicator",value:function(){var e=this,t=e.tooltip,n=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),n&&e.clockTemplate.updateDateIndicator(n,e.record.endDate))}},{key:"resolveTimeSpanRecord",value:function(e){return this.client.resolveTimeSpanRecord(e)}},{key:"resolveData",value:function(e,t){var n=this,r=n.client,i=n.recordType||"".concat(r.scheduledEventName,"Record"),a=n.resolveTimeSpanRecord(t);if(a&&!a.isCommitting){e.eventRecord=e.record=a;var o=a.startDate,l=a.endDate,s=r.getFormattedDate(o),u=r.getDisplayEndDate(l,o),c=r.getFormattedDate(u);return S(S(S(S(S(S(S({tip:e},"".concat(i),a),"startDate",o),"endDate",l),"startText",s),"endText",c),"startClockHtml",n.clockTemplate.template({date:o,text:s,cls:"b-sch-tooltip-startdate"})),"endClockHtml",a.isMilestone?"":n.clockTemplate.template({date:u||"",text:c||"",cls:"b-sch-tooltip-enddate"}))}return null}},{key:"getTipHtml",value:function(e){var t=e.tip,n=e.activeTarget,r=this.resolveData(t,n);if(r&&this.template)return r.startDate instanceof Date?this.template(r):(t.hide(),"")}},{key:"record",get:function(){return this.tooltip.eventRecord}},{key:"onTipShow",value:function(){var e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({change:e.onRecordUpdate,buffer:300,thisObj:e}))}},{key:"onTipHide",value:function(){var e;this.tooltip.eventRecord=this.tooltip.record=null,null===(e=this.updateListener)||void 0===e||e.call(this),this.updateListener=null}},{key:"onOverNewTarget",value:function(e){var t=e.newTarget,n=this.tooltip;n.isVisible&&(this.client.timeAxisSubGrid.scrolling||this.client.scrolling?n.hide(!1):n.eventRecord=this.resolveTimeSpanRecord(t))}},{key:"onRecordUpdate",value:function(e){var t=e.record,n=this.tooltip;null!=n&&n.isVisible&&t===this.record&&(n.updateContent(),n.lastAlignSpec.aligningToElement?n.realign():n.internalOnPointerOver(this.client.lastPointerEvent))}}],[{key:"defaultConfig",get:function(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}},{key:"pluginConfig",get:function(){return{chain:["onInternalPaint"]}}}])}(wc);RT._$name="TooltipBase";var TT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;B(t,"construct",this,3)([e,n]),e.isVertical&&e.ion({renderRows:r.onUIReady,thisObj:r,once:!0}),r.cls=r.cls||"b-sch-".concat(r.constructor.$$name.toLowerCase()),r.baseSelector=".".concat(r.baseCls,".").concat(r.cls),r.enableResizing&&(r.showHeaderElements=!0)}},{key:"doDestroy",value:function(){var e,n,r,i,a=this;a.detachListeners("timeAxisViewModel"),a.detachListeners("timeAxis"),null===(e=a.clockTemplate)||void 0===e||e.destroy(),null===(n=a.tip)||void 0===n||n.destroy(),null===(r=a.drag)||void 0===r||r.destroy(),null===(i=a.resize)||void 0===i||i.destroy(),B(t,"doDestroy",this,3)([])}},{key:"doDisable",value:function(e){this.isConfiguring||this.renderRanges(),B(t,"doDisable",this,3)([e])}},{key:"setupTimeAxisViewModelListeners",value:function(){var e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}},{key:"onUIReady",value:function(){var e=this,t=e.client;t.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&fr.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=Qi.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement.parentElement,targetSelector:"".concat(e.baseSelector),isElementDraggable:function(n,r){return!t.readOnly&&e.isElementDraggable(n,r)},rtlSource:t,positioning:"inset",scrollManager:t.scrollManager,internalListeners:{dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=sp.new({direction:t.mode,targetSelector:"".concat(e.baseSelector,".b-sch-range"),outerElement:e.headerContainerElement,isElementResizable:function(e,t){return!e.matches(".b-dragging,.b-readonly")&&!t.target.matches(".b-fa")},rtlSource:t,positioning:"inset",internalListeners:{resizeStart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new pc(Be.assign({forElement:e.headerContainerElement,getHtml:function(t){var n=t.activeTarget,r=e.resolveTimeRangeRecord(n);return e.tooltipTemplate({timeRange:r})},forSelector:".b-timelinebase:not(.b-dragging-timerange, .b-resizing-timerange) .".concat(e.baseCls).concat(e.cls?"."+e.cls:"")},e.hoverTooltip)))}},{key:"refresh",value:function(){this._timeRanges=null,this.renderRanges()}},{key:"getDOMConfig",value:function(e,t){var n=this,r=[],i=[];if(!n.disabled){n._labelRotationMap={};var a,o=D(n.timeRanges);try{for(o.s();!(a=o.n()).done;){var l=a.value,s=n.renderRange(l,e,t);s&&(r.push(s.bodyConfig),i.push(s.headerConfig))}}catch(e){o.e(e)}finally{o.f()}}return[r,i]}},{key:"renderRanges",value:function(){var e=this,t=e.client;if(t.isPainted&&!t.timeAxisSubGrid.collapsed){var n=e.headerContainerElement,r=[],i=_(e.getDOMConfig(),2),a=i[0],o=i[1];e.bodyCanvas||(e.bodyCanvas=li.createElement({className:"b-timeranges-canvas b-timeranges-body-canvas ".concat(e.cls,"-canvas b-sch-canvas"),parent:t.timeAxisSubGridElement,retainElement:!0})),fa.sync({targetElement:e.bodyCanvas,domConfig:{children:a,onlyChildren:!0,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:function(e){var t=e.targetElement,n=e.action;"reuseElement"!==n&&"newElement"!==n&&"reuseOwnElement"!==n||r.push(t)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=li.createElement({className:"b-timeranges-canvas b-timeranges-header-canvas ".concat(e.cls,"-canvas"),parent:n,retainElement:!0})),e.headerCanvas&&fa.sync({targetElement:e.headerCanvas,domConfig:{onlyChildren:!0,children:o,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(var l=0,s=r;l<s.length;l++){var u=s[l];e.cacheRotation(u.elementData.timeRange,u)}for(var c=0,d=r;c<d.length;c++){var h=d[c];e.applyRotation(h.elementData.timeRange,h)}}}},{key:"timeRanges",get:function(){return[]}},{key:"shouldRenderRange",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.client.visibleDateRange.startDate,n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.client.visibleDateRange.endDate,r=this.client.timeAxis,a=e.startDate,o=e.endDate,l=e.duration;return Boolean(a&&(r.isContinuous||r.isTimeSpanInAxis(e))&&Pl.intersectSpans(t,n,a,l?o:Pl.add(a,this._lineBufferDurationMS)))}},{key:"getRangeDomConfig",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i?arguments[3]:0,a=this,o=a.client,l=o.rtl,s=o.timeAxis,u=e.startDate,c=e.endDate;if(o.fillTicks&&(c&&c-u!=0||e.fillAlign)&&(u=c||"start"===e.fillAlign?s.getSnappedTickFromDate(u).startDate:s.getSnappedTickFromDate(u).endDate,c)){var d=Math.ceil(s.getTickFromDate(c))-1;c=s.getAt(d).endDate}var h=o.getVirtualCoordFromDate(Pl.max(u,t),{respectExclusion:!0})-r,f=c?o.getVirtualCoordFromDate(Pl.min(c,n),{respectExclusion:!0,isEnd:!0})-r:h,v=Math.abs(f-h),g=v>0;return{className:S(S(S(S(S(S(S(S({},a.baseCls,1),a.cls,a.cls),a.rangeCls,g),a.lineCls,!g),e.cls,e.cls),"b-narrow-range",g&&v<a.narrowThreshold),"b-readonly",e.readOnly),"b-rtl",l),dataset:{id:e.id},elementData:{timeRange:e},style:o.isVertical?"inset-block-start: ".concat(h,"px; ").concat(g?"height:".concat(v,"px"):"",";"):"inset-inline-start: ".concat(h,"px; ").concat(g?"width:".concat(v,"px"):"",";")}}},{key:"renderRange",value:function(e,t,n){var r=this,i=r.client,a=i.timeAxis;if(i.timeAxisViewModel.availableSpace>0&&a.startDate&&r.shouldRenderRange(e,t,n)){var o,l=r.getRangeDomConfig(e,a.startDate,a.endDate),s=e.iconCls&&Le.xss(xT||(xT=N(['<i class="','"></i>'])),e.iconCls),u=e.name&&Le.encodeHtml(e.name),c=u||s?"".concat(s||"","<label>").concat(u||"&nbsp;","</label>"):"",d=F(F({},l),{},{style:l.style+(e.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:e}):r.showHeaderElements&&!r.showLabelInBody?"":c});return r.showHeaderElements&&(o=F(F({},l),{},{html:r.headerRenderer?r.headerRenderer({timeRange:e}):r.showLabelInBody?"":c})),{bodyConfig:d,headerConfig:o}}}},{key:"cacheRotation",value:function(e,t){if((e.iconCls||e.name)&&e.duration){var n=t.firstElementChild;n&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?n.offsetHeight<t.offsetHeight:n.offsetWidth>t.offsetWidth)}}},{key:"applyRotation",value:function(e,t){var n,r,i,a=this._labelRotationMap[null!==(n=null===(r=e.recurringTimeSpan)||void 0===r?void 0:r.id)&&void 0!==n?n:e.id];null===(i=t.firstElementChild)||void 0===i||i.classList.toggle("b-vertical",Boolean(a))}},{key:"getBodyElementByRecord",value:function(e){var t="string"==typeof e?e:null==e?void 0:e.id;return null!=t&&fa.getChild(this.bodyCanvas,t)}},{key:"resolveTimeRangeRecord",value:function(e){}},{key:"headerContainerElement",get:function(){var e=this,t=e.client,n=t.isVertical,r=t.timeAxisColumn;return e._headerContainerElement||(n?e._headerContainerElement=e.client.subGrids.locked.element:n||(e._headerContainerElement=r.element)),e._headerContainerElement}},{key:"showHeaderElements",get:function(){return!this.client.hideHeaders&&this._showHeaderElements}},{key:"updateShowHeaderElements",value:function(e){var t=this.client;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}},{key:"populateTimeAxisHeaderMenu",value:function(e){e.column,e.items}},{key:"onInternalPaint",value:function(e){e.firstPaint&&this.client.isHorizontal&&this.onUIReady()}},{key:"onSchedulerHorizontalScroll",value:function(){this.client.isHorizontal&&this.renderRanges()}},{key:"afterScroll",value:function(){this.client.isVertical&&this.renderRanges()}},{key:"updateLineBuffer",value:function(){var e=this.client.timeAxisViewModel;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}},{key:"onInternalResize",value:function(e,t,n,r,i){this.client.isVertical&&i!==n&&this.renderRanges()}},{key:"onTimeAxisViewModelUpdate",value:function(){this.updateLineBuffer(),this.refresh()}},{key:"onTimeRangeClick",value:function(e){var t=this.resolveTimeRangeRecord(e.target);this.client.trigger("timeRangeHeader".concat(Le.capitalize(e.type)),{domEvent:e,timeRangeRecord:t})}},{key:"showTip",value:function(e){var t=this;t.showTooltip&&(t.clockTemplate=new sT({scheduler:t.client}),t.tip=pc.reconfigure(t.tip,pc.mergeConfigs({type:"tooltip",id:"".concat(t.client.id,"-time-range-tip"),cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:function(){return t.getTipHtml(e.record,e.element)}},t.showTooltip)))}},{key:"destroyTip",value:function(){this.tip&&(this.tip.destroy(),this.tip=null)}},{key:"isElementDraggable",value:function(e){return(e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"))&&!e.classList.contains("b-over-resize-handle")}},{key:"onDragStart",value:function(e){var t=e.context,n=this.client,r=this.drag;n.isVertical?(r.minY=0,r.maxY=n.timeAxisViewModel.totalSize-t.element.offsetHeight,r.minX=0,r.maxX=Number.MAX_SAFE_INTEGER):(r.minX=0,r.maxX=n.timeAxisViewModel.totalSize-t.element.offsetWidth,r.minY=0,r.maxY=Number.MAX_SAFE_INTEGER),n.element.classList.add("b-dragging-timerange")}},{key:"onDrop",value:function(e){e.context,this.client.element.classList.remove("b-dragging-timerange")}},{key:"onInvalidDrop",value:function(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}},{key:"updateDateIndicator",value:function(e){var t=e.startDate,n=e.endDate,r=this,i=r.tip,a=i.element.querySelector(".b-sch-tooltip-enddate");r.clockTemplate.updateDateIndicator(i.element,t),a&&r.clockTemplate.updateDateIndicator(a,n)}},{key:"onDrag",value:function(e){var t=e.context,n=this;if(n.showTooltip){var r=n.client,i=pt.from(t.element),a=i.getStart(r.rtl,r.isHorizontal),o=i.getEnd(r.rtl,r.isHorizontal),l=r.getDateFromCoordinate(a,"round",!1),s=r.getDateFromCoordinate(o,"round",!1);n.updateDateIndicator({startDate:l,endDate:s})}}},{key:"onDragReset",value:function(){}},{key:"onResizeStart",value:function(){var e;this.client.element.classList.add("b-resizing-timerange"),null===(e=this.hoverTooltip)||void 0===e||e.hide()}},{key:"onResizeDrag",value:function(){}},{key:"onResize",value:function(){}},{key:"onInvalidResize",value:function(){}},{key:"onResizeReset",value:function(){this.client.element.classList.remove("b-resizing-timerange")}},{key:"getTipHtml",value:function(e,t){var n=this,r=n.client,i=pt.from(t),a=i.getStart(r.rtl,r.isHorizontal),o=i.getEnd(r.rtl,r.isHorizontal),l=r.getDateFromCoordinate(a,"round",!1),s=e.endDate&&r.getDateFromCoordinate(o,"round",!1),u=r.getFormattedDate(l),c=s&&r.getFormattedEndDate(s,l);return n.dragTipTemplate({name:e.name||"",startDate:l,endDate:s,startText:u,endText:c,startClockHtml:n.clockTemplate.template({date:l,text:u,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&n.clockTemplate.template({date:s,text:c,cls:"b-sch-tooltip-enddate"})})}},{key:"updateFillTicks",value:function(){this.isConfiguring||this.refresh()}}],[{key:"defaultConfig",get:function(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,hoverTooltip:null,tooltipTemplate:null,dragTipTemplate:function(e){return'\n                <div class="b-sch-tip-'.concat(e.valid?"valid":"invalid",'">\n                    <div class="b-sch-tip-name">').concat(Le.encodeHtml(e.name)||"","</div>\n                    ").concat(e.startClockHtml,"\n                    ").concat(e.endClockHtml||"","\n                </div>\n            ")},baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}},{key:"pluginConfig",get:function(){return{chain:["updateFillTicks","onInternalPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}}}])}(wc.mixin($i));S(TT,"configurable",{showHeaderElements:!0}),TT._$name="AbstractTimeRanges";var MT=Object.freeze({}),FT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"attachToResourceStore",value:function(e){var n=this.client;B(t,"attachToResourceStore",this,3)([e]),n.isVertical&&n.resourceStore.ion({name:"resourceStore",group:function(e){0===e.groupers.length&&this.refresh()},thisObj:this})}},{key:"doDisable",value:function(e){B(t,"doDisable",this,3)([e]),this.isConfiguring||this.refresh()}},{key:"render",value:function(){this.refresh()}},{key:"getColumnLinesDOMConfig",value:function(e,t,n,r){var i=this,a=i.client,l=a.timeAxisViewModel,s=a.isHorizontal,u=a.resourceStore,c=a.variableColumnWidths,d=l.columnConfig,h=l.columnLinesFor,f=Math.max(h-1,0),v=e.getTime(),g=t.getTime(),m=[],p=new o,y=s?"insetInlineStart":"insetBlockStart";if(!i.disabled){var k=function(e,t){var n=e.start.getTime();if(n>v&&n<g&&!p.has(n)){var r={role:"presentation",className:{"b-column-line-major":t,"b-column-line":!t},style:S({},y,e.coord),dataset:{line:t?"major-".concat(e.index):"line-".concat(e.index)}};p.add(n),m.push(r),i.renderer&&i.callback(i.renderer,i,[e.start,r])}};if(h!==f)for(var b=1;b<=d[f].length-1;b++)k(d[f][b],!0);for(var C=1;C<=d[h].length-1;C++)k(d[h][C],!1);if(!s&&a.columnLines){var w=a.resourceColumns.columnWidth;if(!n&&!r){var D=a.currentOrientation.getResourceRange(!0);n=D.first,r=D.last}var x=0;if(n>-1)for(var E=n;E<r+1;E++){var R=u.getAt(E);if(R.isGroupHeader)r++,x++;else{var T=R.instanceMeta(a),M=c?T.insetStart+a.getResourceWidth(R)-1:(E-x+1)*w-1,F=R.instanceMeta(a.resourceStore).groupParent;m.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":u.isGrouped&&(null==F?void 0:F.groupChildren[(null==F?void 0:F.groupChildren.length)-1])===R},style:{insetInlineStart:M},dataset:{line:"resource-".concat(E)}})}}}}return m}},{key:"refresh",value:function(){var e=this,t=e.client,n=t.timeAxis,r=t.visibleDateRange||MT,i=r.startDate,a=r.endDate;if(n.startDate&&i&&!e.client.timeAxisSubGrid.collapsed){e.element||(e.element=li.createElement({parent:t.timeAxisSubGridElement,className:"b-column-lines-canvas b-sch-canvas"}));var o=e.getColumnLinesDOMConfig(i,a);fa.sync({targetElement:e.element,domConfig:{onlyChildren:!0,children:o,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}}},{key:"internalOnVisibleDateRangeChange",value:function(){this.refresh.now()}},{key:"onVisibleResourceRangeChange",value:function(e){e.firstResource,e.lastResource,this.refresh()}},{key:"onVisibleResourceColumnChange",value:function(e,t){this.refresh()}},{key:"updateCanvasSize",value:function(){this.refresh()}}],[{key:"delayable",get:function(){return{refresh:{type:"raf",cancelOutstanding:!0}}}},{key:"pluginConfig",get:function(){return{after:["render","updateCanvasSize","internalOnVisibleDateRangeChange","onVisibleResourceRangeChange","onVisibleResourceColumnChange"]}}}])}(wc.mixin(DR,$i));S(FT,"$name","ColumnLines"),S(FT,"configurable",{renderer:null}),FT._$name="ColumnLines",Ug.registerFeature(FT,!0,["Scheduler","Gantt","TimelineHistogram"]);var AT=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]);var r=this;r.eventName=e.scheduledEventName,e.ion({readOnly:function(){return r.updateCreateListeners()}}),r.updateCreateListeners(),r.chain(e,"onElementTouchMove","onElementTouchMove")}},{key:"doDestroy",value:function(){var e,n,r=this;r.detachListeners("view"),r.creationData=null,null===(e=r.pointerUpMoveDetacher)||void 0===e||e.call(r),null===(n=r.creationTooltip)||void 0===n||n.destroy(),B(t,"doDestroy",this,3)([])}},{key:"updateCreateListeners",value:function(){var e=this;e.client&&(e.detachListeners("view"),e.isCreateAllowed&&e.client.ion(S(S(S({name:"view"},"".concat(e.eventName,"MouseEnter"),"onTimeSpanMouseEnter"),"".concat(e.eventName,"MouseLeave"),"onTimeSpanMouseLeave"),"thisObj",e)))}},{key:"allowCreate",get:function(){return this._allowCreate},set:function(e){this._allowCreate=e,this.updateCreateListeners()}},{key:"isCreateAllowed",get:function(){return this.allowCreate&&!this.client.readOnly&&!this.disabled}},{key:"updateAllowCreateOnlyParent",value:function(e){this.client.element.classList.toggle("b-dependency-only-parent",e)}},{key:"updateTerminalOffset",value:function(e){var t=this;this.client.whenVisible((function(){t.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-offset","".concat(-e,"px"))}))}},{key:"updateTerminalSize",value:function(e){var t=this;"number"==typeof e&&(e="".concat(e,"px")),this.client.whenVisible((function(){t.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-size",e?"".concat(e):null)}))}},{key:"onTimeSpanMouseEnter",value:function(e){var t=e.event,n=e.source,r=e["".concat(this.eventName,"Record")],i=e["".concat(this.eventName,"Element")],a=e.resourceRecord;if(!r.isCreating&&!r.readOnly){var o=this,l=o.creationData,s=o.client,u=li.down(i,n.eventInnerSelector);if(r!==(null==l?void 0:l.source)){var c=r.parent;if(r.isEventModel&&c&&!c.isRoot&&s.eventStore.includes(c)){var d=s.getElementFromEventRecord(c,a,!0);d&&o.delayHideTerminals(d)}o.delayShowTerminals(r,i),l&&t.target.closest(s.eventSelector)&&(l.timeSpanElement=u,o.onOverTargetEventBar(t))}}}},{key:"onTimeSpanMouseLeave",value:function(e){var t,n,r,i,a,o=e.eventRecord,l=e.event;if(l){var s=this,u=s.creationData,c=s.client,d=null!==(t=l.relatedTarget)&&void 0!==t&&t.matches(".b-sch-terminal-hover-area, .b-sch-terminal")?null:null===(n=l.relatedTarget)||void 0===n?void 0:n.closest(c.eventSelector),h=null!==(r=null==d||null===(i=d.elementData)||void 0===i?void 0:i.eventRecord)&&void 0!==r?r:null==d||null===(a=d.elementData)||void 0===a?void 0:a.taskRecord,f=(null!=o?o:{}).parent,v=e["".concat(s.eventName,"Element")];if((l.isTrusted||Ne.isTestEnv||u)&&s.delayHideTerminals(v),f&&!f.isRoot&&c.eventStore.includes(f)){var g=c.getElementFromEventRecord(f);g&&s.delayShowTerminals(f,g)}u&&s.onOverNewTargetWhileCreating(l.relatedTarget,null!=h&&h.readOnly||null!=h&&h.isOccurence?null:h,l)}}},{key:"onTerminalMouseOver",value:function(e){this.clearTimeout("hide-".concat(e.target.closest(this.client.eventSelector).dataset.syncId)),this.creationData&&this.onOverTargetEventBar(e)}},{key:"onTerminalMouseOut",value:function(e){var t,n,r,i,a=this,o=a.creationData,l=a.client,s=e.target.closest(l.eventSelector),u=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(l.eventSelector),c=null!==(n=null==u||null===(r=u.elementData)||void 0===r?void 0:r.eventRecord)&&void 0!==n?n:null==u||null===(i=u.elementData)||void 0===i?void 0:i.taskRecord;u===s||!s||a.hasTimeout("show-".concat(s.dataset.syncId))||o&&s===o.timeSpanElement||(a.delayHideTerminals(s),l.unhover(s,e)),o&&a.onOverNewTargetWhileCreating(e.relatedTarget,null!=c&&c.readOnly||null!=c&&c.isOccurence?null:c,e)}},{key:"onTerminalPointerDown",value:function(e){var t=this;if(0===e.button&&!t.creationData){var n,r=t.client,i=r.timeAxisSubGridElement,a=e.target,o=a.closest(r.eventInnerSelector),l=pt.from(r.element);e.stopPropagation(),t.creationData={sourceElement:o,source:r.resolveTimeSpanRecord(o).$original,fromSide:a.dataset.side,startPoint:pt.from(a,i).center,startX:e.pageX-l.x+r.scrollLeft,startY:e.pageY-l.y+r.scrollTop,valid:!1,sourceResource:null===(n=r.resolveResourceRecord)||void 0===n?void 0:n.call(r,e),tooltip:t.creationTooltip},t.pointerUpMoveDetacher=fr.on({pointerup:{element:li.getRootElement(r.element),handler:"onMouseUp",passive:!1},pointermove:{element:i,handler:"onMouseMove",passive:!1},thisObj:t}),t.documentPointerUpDetacher=fr.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:function(e){"Escape"===e.key&&t.abort()}},thisObj:t})}}},{key:"onElementTouchMove",value:function(e){var n;null===(n=B(t,"onElementTouchMove",this,3))||void 0===n||n([e]),this.connector&&e.preventDefault()}},{key:"onMouseMove",value:function(e){var t=this,n=t.client,r=t.creationData,i=pt.from(n.element),a=e.pageX-i.x+n.scrollLeft-r.startX,o=e.pageY-i.y+n.scrollTop-r.startY,l=Math.round(Math.sqrt(a*a+o*o))-3,s=Math.atan2(o,a),u=t.connector;if(!u){if(!1===t.onRequestDragCreate(e))return void t.abort();u=t.connector}u.style.width="".concat(l,"px"),u.style.transform="rotate(".concat(s,"rad)"),t.lastMouseMoveEvent=e}},{key:"onRequestDragCreate",value:function(e){var t=this,n=t.client,r=t.creationData;if(!1===n.trigger("beforeDependencyCreateDrag",{data:r,source:r.source}))return!1;if(n.element.classList.add("b-creating-dependency"),t.createConnector(r.startPoint.x,r.startPoint.y),n.trigger("dependencyCreateDragStart",{data:r,source:r.source}),t.showCreationTooltip){var i=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=i,i.disabled=!1,i.show(),i.onMouseMove(e)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:function(){return t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)}})}},{key:"onOverTargetEventBar",value:function(e){var t,n=this,r=n.client,i=n.creationData,a=n.allowDropOnEventBar,o=e.target,l=r.resolveTimeSpanRecord(o).$original;null!==(t=l)&&void 0!==t&&t.isEventSegment&&(l=l.event),pe.isPromise(i.valid)||!a&&!o.classList.contains(n.terminalCls)||l!==i.source&&n.onOverNewTargetWhileCreating(o,l,e)}},{key:"onOverNewTargetWhileCreating",value:(r=f(L().mark((function e(t,n,r){var i,a,o,l,s,u,c,d,h,f,v,g,m,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(i=this).client,o=i.creationData,l=i.allowDropOnEventBar,s=i.connector,!pe.isPromise(o.valid)){e.next=3;break}return e.abrupt("return");case 3:if(!o.finalizing){e.next=5;break}return e.abrupt("return");case 5:if(s){e.next=7;break}return e.abrupt("return");case 7:if(s.classList.remove("b-valid","b-invalid"),o.timeSpanElement&&li.removeClsGlobally(o.timeSpanElement,"b-sch-terminal-active"),n&&n!==o.source&&(l||t.classList.contains(i.terminalCls))&&(!i.allowCreateOnlyParent||n.isParent)){e.next=15;break}o.target=o.toSide=null,o.valid=!1,s.classList.add("b-invalid"),e.next=45;break;case 15:c=o.target=n,d=o.source,h=t.dataset.side,l&&!t.classList.contains(i.terminalCls)&&(h=i.getTargetSideFromType(i.dependencyStore.modelClass.fieldMap.type.defaultValue||Dx.Type.EndToStart)),a.resolveResourceRecord&&(o.targetResource=a.resolveResourceRecord(r)),o.toSide=h,v=o.fromSide,g=function(e){i.isDestroyed||(o.valid=e,t.classList.add(e?"b-valid":"b-invalid"),s.classList.add(e?"b-valid":"b-invalid"),a.trigger("dependencyValidationComplete",{data:o,source:d,target:c,dependencyType:f}))},e.t0=!0,e.next=e.t0===("start"===v&&"start"===h)?24:e.t0===("start"===v&&"end"===h)?26:e.t0===("end"===v&&"start"===h)?28:e.t0===("end"===v&&"end"===h)?30:32;break;case 24:return f=Dx.Type.StartToStart,e.abrupt("break",32);case 26:return f=Dx.Type.StartToEnd,e.abrupt("break",32);case 28:return f=Dx.Type.EndToStart,e.abrupt("break",32);case 30:return f=Dx.Type.EndToEnd,e.abrupt("break",32);case 32:if(a.trigger("dependencyValidationStart",{data:o,source:d,target:c,dependencyType:f}),m=o.valid=i.dependencyStore.isValidDependency(d,c,f),!pe.isPromise(m)){e.next=41;break}return e.next=37,m;case 37:m=e.sent,g(m),e.next=42;break;case 41:g(m);case 42:p=m?"b-valid":"b-invalid",s.classList.add(p),null===(u=o.timeSpanElement)||void 0===u||null===(u=u.querySelector(".".concat(i.terminalCls,"[data-side=").concat(h,"]")))||void 0===u||u.classList.add("b-sch-terminal-active",p);case 45:i.updateCreationTooltip();case 46:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"onMouseUp",value:(n=f(L().mark((function e(){var t,n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=(n=this).creationData).finalizing=!0,null===(t=n.pointerUpMoveDetacher)||void 0===t||t.call(n),!r.valid){e.next=34;break}return e.next=6,n.client.trigger("beforeDependencyCreateFinalize",r);case 6:if(!1!==e.sent){e.next=11;break}r.valid=!1,e.next=15;break;case 11:if(!pe.isPromise(r.valid)){e.next=15;break}return e.next=14,r.valid;case 14:r.valid=e.sent;case 15:if(!r.valid){e.next=30;break}return e.next=18,n.createDependency(r);case 18:if(null===(i=e.sent)){e.next=28;break}if(!pe.isPromise(i)){e.next=24;break}return e.next=23,i;case 23:i=e.sent;case 24:return r.dependency=i,n.client.trigger("dependencyCreateDrop",{data:r,source:r.source,target:r.target,dependency:i}),e.next=28,n.doAfterDependencyDrop(r);case 28:e.next=32;break;case 30:return e.next=32,n.doAfterDependencyDrop(r);case 32:e.next=37;break;case 34:return r.valid=!1,e.next=37,n.doAfterDependencyDrop(r);case 37:n.abort();case 38:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"doAfterDependencyDrop",value:function(e){this.client.trigger("afterDependencyCreateDrop",F({data:e},e))}},{key:"onDocumentMouseUp",value:function(e){var t=e.target;this.client.timeAxisSubGridElement.contains(t)||this.abort()}},{key:"abort",value:function(){var e,t,n=this,r=n.client,i=n.creationData;if(i){var a=i.source,o=i.sourceResource,l=i.target,s=i.targetResource;if(a){var u=r.getElementFromEventRecord(a,o);u&&n.hideTerminals(u)}if(l){var c=r.getElementFromEventRecord(l,s);c&&n.hideTerminals(c)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.documentPointerUpDetacher)||void 0===t||t.call(n),n.removeConnector()}},{key:"createConnector",value:function(e,t){var n=this,r=n.client;n.clearTimeout(n.removeConnectorTimeout),n.connector=li.createElement({parent:r.timeAxisSubGridElement,className:"".concat(n.baseCls,"-connector"),style:"left:".concat(e,"px;top:").concat(t,"px")}),r.element.classList.add("b-creating-dependency")}},{key:"createDragTooltip",value:function(){var e=this,t=e.client;return e.creationTooltip=pc.new({id:"".concat(t.id,"-dependency-drag-tip"),cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}},{key:"removeConnector",value:function(){var e=this,t=e.connector,n=e.client;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout((function(){t.remove(),e.connector=null}),200)),n.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),n.scrollManager.stopMonitoring()}},{key:"delayShowTerminals",value:function(e,t){var n=this,r=t.dataset.syncId;n.clearTimeout("hide-".concat(r)),n.clearTimeout("show-".concat(r)),t.classList.remove("b-hiding-terminals"),n.terminalShowDelay?n.setTimeout({fn:function(){return n.showTerminals(e,t)},name:"show-".concat(r),args:[e,t],delay:n.terminalShowDelay}):n.showTerminals(e,t)}},{key:"delayHideTerminals",value:function(e){var t=this,n=e.dataset.syncId;t.clearTimeout("hide-".concat(n)),t.clearTimeout("show-".concat(n)),e.classList.add("b-hiding-terminals"),t.terminalHideDelay?t.setTimeout({fn:function(){return t.hideTerminals(e)},name:"hide-".concat(n),args:[e],delay:t.terminalHideDelay}):t.hideTerminals(e)}},{key:"showTerminals",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.client.getElementFromEventRecord(e),n=this;if(n.isCreateAllowed&&e.project&&t&&(!n.allowCreateOnlyParent||e.isParent)){var r=n.client,a=n.terminalCls,o="".concat(a,"s-visible");if(n.showingTerminalsFor&&n.hideTerminals(n.showingTerminalsFor),!(t=li.down(t,n.client.eventInnerSelector)).classList.contains(o)&&!r.element.classList.contains("b-resizing-event")&&!r.readOnly){if(!1===r.trigger("beforeShowTerminals",{source:e}))return;li.createElement({parent:t.closest(r.eventSelector),className:"b-sch-terminal-hover-area"}),n.terminalSides.forEach((function(e){e=n.fixSide(e);var r=li.createElement({parent:t,className:"".concat(a," ").concat(a,"-").concat(e),dataset:{side:e,feature:!0}});r.detacher=fr.on({element:r,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})})),t.classList.add(o),e.internalCls.add(o)}}}},{key:"fixSide",value:function(e){return"left"===e?"start":"right"===e?"end":e}},{key:"hideTerminals",value:function(e){var t,n=this,r=n.client,i=r.getTimeSpanMouseEventParams(e),a=null==i?void 0:i["".concat(n.eventName,"Record")],o="".concat(n.terminalCls,"s-visible");null===(t=e.querySelector(".b-sch-terminal-hover-area"))||void 0===t||t.remove(),li.forEachSelector(e,"> ".concat(r.eventInnerSelector," > .").concat(n.terminalCls),(function(e){var t;null===(t=e.detacher)||void 0===t||t.call(e),e.remove()})),li.down(e,r.eventInnerSelector).classList.remove(o),null==a||a.internalCls.remove(o),e.classList.remove("b-hiding-terminals")}},{key:"createDependency",value:function(e){var t=e.source,n=e.target,r=e.fromSide,i=e.toSide,a=("start"===r?0:2)+("end"===i?1:0),o=this.dependencyStore.add({from:t.id,to:n.id,type:a,fromSide:r,toSide:i});return null!==o?o[0]:null}},{key:"getTargetSideFromType",value:function(e){return e===Dx.Type.StartToStart||e===Dx.Type.EndToStart?"start":"end"}},{key:"updateCreationTooltip",value:function(){var e=this;if(e.showCreationTooltip){var t=e.creationData,n=t.valid,r=e.creationTooltip,i=r.element.classList;if(pe.isPromise(n))return i.remove("b-invalid"),i.add("b-checking"),new Promise((function(i){return n.then((function(n){t.valid=n,r.isDestroyed||i(e.updateCreationTooltip())}))}));r.html=e.creationTooltipTemplate(t)}}},{key:"creationTooltipTemplate",value:function(e){var t,n,r,i,a=this,o=e.tooltip,l=e.valid,s=o.element.classList;return Object.assign(e,{fromText:e.source.name,toText:null!==(t=null===(n=e.target)||void 0===n?void 0:n.name)&&void 0!==t?t:"",fromSide:e.fromSide,toSide:e.toSide||""}),s.toggle("b-invalid",!l),s.remove("b-checking"),!0===l?(r="valid",i=a.L("L{Dependencies.valid}")):(r="invalid",i=a.L("L{Dependencies.invalid}")),o.title='<i class="b-icon b-icon-'.concat(r,'"></i>').concat(i),[{dataset:{ref:"fromLabel"},tag:"label",text:a.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:"b-sch-box b-".concat(e.fromSide)},{dataset:{ref:"toLabel"},tag:"label",text:a.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:"b-sch-box b-".concat(e.toSide)}]}},{key:"doDisable",value:function(e){this.isConfiguring||this.updateCreateListeners(),B(t,"doDisable",this,3)([e])}}],[{key:"defaultConfig",get:function(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}}]);var n,r}(e||Mn),S(t,"$name","DependencyCreation"),S(t,"configurable",{allowDropOnEventBar:!0,terminalSize:null,terminalOffset:null,terminalShowDelay:0,terminalHideDelay:0,allowCreateOnlyParent:!1}),t},IT=Math.min(1/r.devicePixelRatio,.75),LT=["start","end","top","bottom"],OT=function(e,t){return Math.abs(e-t)<.1},PT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"findPath",value:function(e,t){var n,r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x,E,R,T,M,F,A=this,I=e;for(t=$e.asArray(t),F=0;e&&!M;){var L;if(r=(n=Object.assign(A.config,e)).startBox,i=n.endBox,a=n.startShift,o=n.endShift,l=n.startSide,s=n.endSide,u=n.startArrowMargin,c=n.endArrowMargin,d=n.horizontalMargin,h=n.verticalMargin,f=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:d,v=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:h,g=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:d,m=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:h,p=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:d,y=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:h,k=n.otherBoxes,l=A.normalizeSide(l),s=A.normalizeSide(s),b=A.getConnectionCoordinatesFromBoxSideShift(r,l,a),C=A.getConnectionCoordinatesFromBoxSideShift(i,s,o),E=A.calcGridBaseBoxFromBoxAndDrawParams(r,l,u,f,v),R=A.calcGridBaseBoxFromBoxAndDrawParams(i,s,c,g,m),LT.forEach((function(e){Math.abs(E[e]-R[e])<=IT&&(R[e]=E[e])})),A.shouldLookForPath(r,i,E,R))k=null===(L=k)||void 0===L?void 0:L.map((function(e){return A.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,p,y)})),w=A.getConnectionCoordinatesFromBoxSideShift(E,l,a),D=A.getConnectionCoordinatesFromBoxSideShift(R,s,o),T=A.buildPathGrid(E,R,w,D,l,s,k),S=A.convertDecartPointToGridPoint(T,w),x=A.convertDecartPointToGridPoint(T,D),M=A.findPathOnGrid(T,S,x,l,s);for(e=!1;!M&&!e&&t&&F<t.length;F++)e=t[F](n,I)}return M&&(M=A.prependPathWithArrowStaffSegment(M,b,l),M=A.appendPathWithArrowStaffSegment(M,C,s),M=A.optimizePath(M)),M}},{key:"shouldLookForPath",value:function(e,n,r,i){var a=!0;return(e.end-e.start<=this.startArrowMargin||n.end-n.start<=this.endArrowMargin)&&2===Math.abs(t.calculateRelativePosition(e,n,!0))&&(a=!t.boxOverlapChanged(e,n,r,i)),a}},{key:"getConnectionCoordinatesFromBoxSideShift",value:function(e,t,n){var r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+n};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+n};break;case"top":r={x:(e.start+e.end)/2+n,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+n,y:e.bottom}}return r}},{key:"calcGridBaseBoxFromBoxAndDrawParams",value:function(e,t,n,r,i){var a;switch(this.normalizeSide(t)){case"left":a={start:e.start-Math.max(n,r),end:e.end+r,top:e.top-i,bottom:e.bottom+i};break;case"right":a={start:e.start-r,end:e.end+Math.max(n,r),top:e.top-i,bottom:e.bottom+i};break;case"top":a={start:e.start-r,end:e.end+r,top:e.top-Math.max(n,i),bottom:e.bottom+i};break;case"bottom":a={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+Math.max(n,i)};break;default:a={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+i}}return a}},{key:"normalizeSide",value:function(e){var t=this.client.rtl;return"start"===e?t?"right":"left":"end"===e?t?"left":"right":e}},{key:"buildPathGrid",value:function(e,t,n,r,i,a,l){var s,u,c,d,h,f,v,g,m,p,y,k,b,C={},w=[];for(s=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:n.x,e.end,t.start,"left"===a||"right"===a?(t.start+t.end)/2:r.x,t.end],u=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:n.y,e.bottom,t.top,"top"===a||"bottom"===a?(t.top+t.bottom)/2:r.y,t.bottom],l&&l.forEach((function(e){s.push(e.start,(e.start+e.end)/2,e.end),u.push(e.top,(e.top+e.bottom)/2,e.bottom)})),s=z(new o(s.sort((function(e,t){return e-t})))),f=0,g=(u=z(new o(u.sort((function(e,t){return e-t}))))).length;f<g;++f)for(C[f]=C[f]||{},c=u[f],h=0,v=s.length;h<v;++h){if(k=((d=s[h])<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),l)for(m=0,p=l.length;k&&m<p;++m)k=d<=(y=l[m]).start||d>=y.end||c<=y.top||c>=y.bottom||d===n.x&&c===n.y||d===r.x&&c===r.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:k,x:d,y:c,ix:h,iy:f},C[f][h]=b,w.push(b)}return{width:s.length,height:u.length,xs:s,ys:u,points:C,linearPoints:w}}},{key:"convertDecartPointToGridPoint",value:function(e,t){var n=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][n]}},{key:"findPathOnGrid",value:function(e,t,n,r,i){var a=!1;return t.permitted&&n.permitted&&(e=this.waveForward(e,t,0),a=this.collectPath(e,n,i)),a}},{key:"getGridPointNeighbors",value:function(e,t,n){var r,i=t.ix,a=t.iy,o=[];return a<e.height-1&&(r=e.points[a+1][i],(!n||n(r))&&o.push(r)),a>0&&(r=e.points[a-1][i],(!n||n(r))&&o.push(r)),i<e.width-1&&(r=e.points[a][i+1],(!n||n(r))&&o.push(r)),i>0&&(r=e.points[a][i-1],(!n||n(r))&&o.push(r)),o}},{key:"waveForward",value:function(e,t,n){var r=this;return ld.preWalkUnordered([t,n],(function(t){var n=_(t,2),i=n[0],a=n[1];return r.getGridPointNeighbors(e,i,(function(e){return e.permitted&&e.distance>a+1})).map((function(e){return[e,a+1]}))}),(function(e){var t=_(e,2),n=t[0],r=t[1];return n.distance=r})),e}},{key:"collectPath",value:function(e,t,n){for(var r,i,a,o,l=[],s=!0;s&&t.distance;)if(s=(r=this.getGridPointNeighbors(e,t,(function(e){return e.permitted&&e.distance===t.distance-1}))).length>0){switch(r=r.sort((function(e,r){var i,a;i=e.ix-t.ix,a=e.iy-t.iy;var o=("left"===n||"right"===n)&&0===a||("top"===n||"bottom"===n)&&0===i?-1:1;i=r.ix-t.ix,a=r.iy-t.iy;var l=("left"===n||"right"===n)&&0===a||("top"===n||"bottom"===n)&&0===i?-1:1;return o>l?1:o<l?-1:o===l?e.y>r.y?-1:e.y<r.y?1:0:void 0})),i=r[0],l.push({x1:i.x,y1:i.y,x2:t.x,y2:t.y}),a=i.ix-t.ix,o=i.iy-t.iy,!0){case!o&&a>0:n="left";break;case!o&&a<0:n="right";break;case!a&&o>0:n="top";break;case!a&&o<0:n="bottom"}t=i}return s&&l.reverse()||!1}},{key:"prependPathWithArrowStaffSegment",value:function(e,t,n){if(e.length>0){var r=e[0],i={x2:r.x1,y2:r.y1};switch(n){case"left":case"right":i.x1=t.x,i.y1=r.y1;break;case"top":case"bottom":i.x1=r.x1,i.y1=t.y}e.unshift(i)}return e}},{key:"appendPathWithArrowStaffSegment",value:function(e,t,n){if(e.length>0){var r=e[e.length-1],i={x1:r.x2,y1:r.y2};switch(n){case"left":case"right":i.x2=t.x,i.y2=r.y2;break;case"top":case"bottom":i.x2=r.x2,i.y2=t.y}e.push(i)}return e}},{key:"optimizePath",value:function(e){var t,n,r=[];if(e.length>0)for(t=e.shift(),r.push(t);e.length>0;)n=e.shift(),OT(t.x1,n.x1)&&OT(t.y1,n.y1)&&OT(t.x2,n.x2)&&OT(t.y2,n.y2)?t=n:OT(t.y1,t.y2)&&OT(n.y1,n.y2)?t.x2=n.x2:OT(t.x1,t.x2)&&OT(n.x1,n.x2)?t.y2=n.y2:(r.push(n),t=n);return r}}],[{key:"configurable",get:function(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}},{key:"calculateRelativePosition",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=n?"top":"start",a=n?"bottom":"end";return e[a]<t[r]?0:e[a]<=t[a]&&e[a]>=t[r]&&e[r]<t[r]?1:e[r]>=t[r]&&e[a]<=t[a]?2:e[r]<t[r]&&e[a]>t[a]?-2:e[r]<=t[a]&&e[a]>t[a]?3:4}},{key:"boxOverlapChanged",value:function(e,n,r,a){var o=arguments.length>4&&arguments[4]!==i&&arguments[4],l=t.calculateRelativePosition;return l(e,n,o)!==l(r,a,o)}}])}(Mn);function _T(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function HT(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function BT(e,t,n,r,i){var a=e.x1===e.x2?"v":"h",o=r;if(r){var l=HT(e),s=t?Math.abs(HT(t)):Number.MAX_SAFE_INTEGER,u=Math.sign(l);null==i&&(i=r),(Math.abs(l)<2*r||s<2*r)&&(o=Math.min(Math.abs(l),s)/2);var c=l-("single"===n?0:"first"===n?o:"between"===n?i+o:i)*u;a+=Math.sign(c)!==u?0:c,"last"!==n&&"single"!==n&&o>0&&(a+=" ".concat(function(e,t,n){var r=_T(e)+_T(t),i=n*(r.includes("l")?-1:1),a=n*(r.includes("u")?-1:1),o="ur"===r||"lu"===r||"dl"===r||"rd"===r?1:0;return"a".concat(i,",").concat(a," 0 0 ").concat(o," ").concat(i,",").concat(a)}(e,t,o)))}else a+=HT(e);return{line:a,currentRadius:r!==o?o:null}}function VT(e,t){var n=t.length;if(!n)return"";var r=null;return"M".concat(t[0].x1,",").concat(t[0].y1," ").concat(t.map((function(i,a){var o=1===n?"single":a===n-1?"last":0===a?"first":"between",l=BT(i,t[a+1],o,e,r);return r=l.currentRadius,l.line})).join(" "))}PT._$name="RectangularPathFinder";var NT=["start","start","end","end"],zT=["start","end","start","end"],jT=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeTooltip",value:function(e,t){var n=this;if(null==t||t.destroy(),!e)return null;var r=pc.new({align:"b-t",id:"".concat(n.client.id,"-dependency-tip"),forSelector:".b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .".concat(n.baseCls),forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},e);return r.element.classList.add("b-sch-dependency-tooltip"),r}},{key:"updateShowTooltip",value:function(e){var t=this;t.isConfiguring&&!e||(e&&!t._tooltip&&t.tooltip,t._tooltip&&(t._tooltip.disabled=!e))}},{key:"getHoverTipHtml",value:function(e){var t=e.activeTarget;return this.tooltipTemplate(this.resolveDependencyRecord(t))}}])}(e),S(t,"$name","DependencyTooltip"),S(t,"configurable",{showTooltip:!0,showLagInTooltip:!1,tooltipTemplate:function(e){var t=this;return[{tag:"label",text:t.L("L{Dependencies.from}")},{text:e.fromEvent.name},{className:"b-sch-box b-".concat(e.fromSide||NT[e.type])},{tag:"label",text:t.L("L{Dependencies.to}")},{text:e.toEvent.name},{className:"b-sch-box b-".concat(e.toSide||zT[e.type])},t.showLagInTooltip&&{tag:"label",text:t.L("L{DependencyEdit.Lag}")},t.showLagInTooltip&&{text:"".concat(e.lag||0," ").concat(Pl.getLocalizedNameOfUnit(e.lagUnit,1!==e.lag))}]},tooltip:{$config:["nullify","lazy"],value:{}}}),t},WT={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},$T=function(e){var t,n=[e];return null!==(t=e.resource)&&void 0!==t&&t.hasLinks&&n.push.apply(n,z(e.resource.$links.map((function(t){return{id:"".concat(t.id,"_").concat(e.id),resource:t,event:e.event,drawDependencies:e.drawDependencies}})))),n},UT=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"domConfigs",new a),S(e,"drawingLive",!1),S(e,"lastScrollX",null),S(e,"highlighted",new a),S(e,"visibleResources",null),S(e,"usingLinks",null),S(e,"visibleDateRange",null),S(e,"relativeTo",null),S(e,"generation",0),e}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]);var r=e.scheduledEventName;e.ion(S(S(S(S(S(S(S(S(S({svgCanvasCreated:"onSVGReady",animationStart:"refresh"},r+"DragStart","refresh"),r+"DragAbort","refresh"),r+"ResizeStart","refresh"),r+"SegmentDragStart","refresh"),r+"SegmentResizeStart","refresh"),"timelineViewportResize","immediateReset"),"timeAxisViewModelUpdate","reset"),"toggleNode","reset"),"thisObj",this)),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}},{key:"doDisable",value:function(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),B(t,"doDisable",this,3)([e])}},{key:"rowStore",get:function(){return this.client.isVertical?this.client.resourceStore:this.client.store}},{key:"eventStore",get:function(){return this.client.project.eventStore}},{key:"bindStore",value:function(e){var t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(null==e||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:t})),t.usingLinks=null,t.immediateReset())}},{key:"onStoreRefresh",value:function(){this.reset()}},{key:"attachToProject",value:function(e){B(t,"attachToProject",this,3)([e]),null==e||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}},{key:"attachToResourceStore",value:function(e){B(t,"attachToResourceStore",this,3)([e]),null==e||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}},{key:"onResourceStoreChange",value:function(){this.usingLinks=null,this.reset()}},{key:"attachToEventStore",value:function(e){B(t,"attachToEventStore",this,3)([e]),null==e||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}},{key:"attachToAssignmentStore",value:function(e){B(t,"attachToAssignmentStore",this,3)([e]),null==e||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}},{key:"attachToDependencyStore",value:function(e){B(t,"attachToDependencyStore",this,3)([e]),null==e||e.ion({name:"dependencyStore",change:"reset",refresh:"onDependencyStoreRefresh",thisObj:this})}},{key:"onDependencyStoreRefresh",value:function(e){"dataset"===e.action&&this.generation++,this.reset()}},{key:"updateDrawOnScroll",value:function(e){var t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}},{key:"onHorizontalScroll",value:function(e){var t=e.subGrid,n=e.scrollX;n!==this.lastScrollX&&t===this.client.timeAxisSubGrid&&(this.lastScrollX=n,this.draw())}},{key:"onInternalPaint",value:function(){this.refresh()}},{key:"getElementForDependency",value:function(e,t,n){return this.getElementsForDependency(e,t,n)[0]}},{key:"getElementsForDependency",value:function(e,t,n){var r='[data-dep-id="'.concat(e.id,'"]');return t&&(r+='[data-from-id="'.concat(t.id,'"]')),n&&(r+='[data-to-id="'.concat(n.id,'"]')),Array.from(this.client.svgCanvas.querySelectorAll(r))}},{key:"resolveDependencyRecord",value:function(e){var t;return null===(t=e.elementData)||void 0===t?void 0:t.dependency}},{key:"isDependencyElement",value:function(e){return e.matches(".".concat(this.baseCls))}},{key:"onElementPointerDown",value:function(e){var t=e.target,n=this,r=n.client;n.enableDelete&&!r.readOnly&&t!==n.removeIconElement&&(n.removeRemoveIcon(),li.removeClsGlobally(r.svgCanvas,"b-sch-dependency-selected"))}},{key:"onElementClick",value:function(e){var t=this.resolveDependencyRecord(e.target);if(t){var n=WT[e.type];"click"===e.type&&this.onDependencyClick(e.target),this.client.trigger("dependency".concat(n),{dependency:t,event:e})}}},{key:"onDependencyClick",value:function(e){var t=this,n=t.client,r=n.svgCanvas,i=e.elementData.dependency;if(t.enableDelete&&!n.readOnly&&!i.readOnly){var a=e.getPointAtLength(n.isGanttBase?0:e.getTotalLength());n.topCanvas||(n.topCanvas=li.createElement({className:"b-sch-canvas b-sch-top-canvas",parent:n.foregroundCanvas.parentElement})),t.removeIconElement=li.createElement({className:"b-sch-dependency-remove-icon "+t.removeIconCls,retainElement:!0,style:{insetInlineStart:a.x+"px",top:a.y+"px"},dataset:{depId:i.id},elementData:{dependencyEl:e},parent:n.topCanvas}),t.removeIconElement.addEventListener("click",t.onRemoveIconClick.bind(t));var o,l=D(t.getElementsForDependency(i));try{for(l.s();!(o=l.n()).done;){var s=o.value;s.classList.add("b-sch-dependency-selected"),r.moveBefore?r.moveBefore(s,null):r.appendChild(s)}}catch(e){l.e(e)}finally{l.f()}}}},{key:"positionRemoveIcon",value:function(){var e,t=((null===(e=this.removeIconElement)||void 0===e?void 0:e.elementData)||{}).dependencyEl;if(t){var n=t.getPointAtLength(this.client.isGanttBase?0:t.getTotalLength());Object.assign(this.removeIconElement.style,{insetInlineStart:n.x+"px",top:n.y+"px"})}}},{key:"removeRemoveIcon",value:(n=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.removeIconElement)){e.next=5;break}return e.next=4,this.client.executeAndAwaitAnimations(t,(function(){return t.classList.add("b-removing")}));case 4:t.remove();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoveIconClick",value:function(e){var t=e.target;this.client.dependencyStore.remove(t.dataset.depId),this.removeRemoveIcon()}},{key:"onElementDblClick",value:function(e){return this.onElementClick(e)}},{key:"onElementContextMenu",value:function(e){return this.onElementClick(e)}},{key:"onElementMouseOver",value:function(e){var t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOver",{dependency:n,event:e}),t.overCls&&t.highlight(n))}},{key:"onElementMouseOut",value:function(e){var t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOut",{dependency:n,event:e}),t.overCls&&t.unhighlight(n))}},{key:"isDependencyVisible",value:function(e){var t=this.rowStore,n=e.fromEvent,r=e.toEvent;if(!n||!r)return!1;var i=n.resource,a=r.resource;return!(!t.isAvailable(i)||!t.isAvailable(a))&&(n.isModel&&!i.instanceMeta(t).hidden&&!a.instanceMeta(t).hidden)}},{key:"updateHighlightDependenciesOnEventHover",value:function(e){var t=this;if(e){var n=t.client;n.ion(S(S(S({name:"highlightOnHover"},"".concat(n.scheduledEventName,"MouseEnter"),(function(e){return t.highlightEventDependencies(e.eventRecord||e.taskRecord)})),"".concat(n.scheduledEventName,"MouseLeave"),(function(e){return t.unhighlightEventDependencies(e.eventRecord||e.taskRecord)})),"thisObj",t))}else t.detachListeners("highlightOnHover")}},{key:"highlight",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.overCls,n=this.highlighted.get(e);n||this.highlighted.set(e,n=new o),n.add(t);var r,a=D(this.getElementsForDependency(e));try{for(a.s();!(r=a.n()).done;){r.value.classList.add(t)}}catch(e){a.e(e)}finally{a.f()}}},{key:"unhighlight",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.overCls,r=null===(t=this.highlighted)||void 0===t?void 0:t.get(e);r&&(r.delete(n),r.size||this.highlighted.delete(e));var a,o=D(this.getElementsForDependency(e));try{for(o.s();!(a=o.n()).done;){a.value.classList.remove(n)}}catch(e){o.e(e)}finally{o.f()}}},{key:"highlightEventDependencies",value:function(e,t){var n=this;e.dependencies.forEach((function(e){return n.highlight(e,t)}))}},{key:"unhighlightEventDependencies",value:function(e,t){var n=this;e.dependencies.forEach((function(e){return n.unhighlight(e,t)}))}},{key:"getDependenciesToConsider",value:function(e,n,r,i){var a,o=this.eventStore,l=null===(a=B(t,"getDependenciesToConsider",this,3))||void 0===a?void 0:a([e,n,r,i]);return null!=l&&l.size?l:this.project.dependencyStore.records.filter((function(e){return e.isValid&&!o.isFiltered||o.isAvailable(e.fromEvent)&&o.isAvailable(e.toEvent)}))}},{key:"getDependencyKey",value:function(e,t,n){return"dep:".concat(e.id,";from:").concat(t.id,";to:").concat(n.id,";gen:").concat(this.generation)}},{key:"drawDependency",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i&&arguments[1],a=arguments.length>2&&arguments[2]!==i?arguments[2]:null,o=this,l=o.domConfigs,s=o.client,u=o.rowStore,c=o.topIndex,d=o.bottomIndex,h=s.useInitialAnimation,f=u.idMap,v=o.visibleDateRange,g=v.startMS,m=v.endMS,p=e.fromEvent,y=e.toEvent,k=p.assigned,b=y.assigned;if(p.isScheduled&&y.isScheduled&&null!==(t=k)&&void 0!==t&&t.size&&null!==(n=b)&&void 0!==n&&n.size){o.usingLinks&&(k=z(k).flatMap($T),b=z(b).flatMap($T));var C,w=D(k);try{for(w.s();!(C=w.n()).done;){var S,x=C.value,E=D(b);try{for(E.s();!(S=E.n()).done;){var R,T,M,F,A=S.value,I=null===(R=f[null===(T=x.resource)||void 0===T?void 0:T.id])||void 0===R?void 0:R.index,L=null===(M=f[null===(F=A.resource)||void 0===F?void 0:F.id])||void 0===M?void 0:M.index,O=Math.min(p.startDateMS,y.startDateMS),P=Math.max(p.endDateMS,y.endDateMS);if(s.isExporting||null!=I&&null!=L&&!1!==x.drawDependencies&&!1!==A.drawDependencies&&u.isAvailable(x.resource)&&u.isAvailable(A.resource)&&!(I<c&&L<c||I>d&&L>d||O<g&&P<g||O>m&&P>m)){var _=o.getDependencyKey(e,x,A),H=o.getDomConfigs(e,x,A,a);H?(h&&(H[0].style={animationDelay:"".concat(Math.max(I,L)/20*1e3,"ms")}),l.set(_,H)):l.delete(_)}o.afterDrawDependency(e,I,L,O,P)}}catch(e){E.e(e)}finally{E.f()}}}catch(e){w.e(e)}finally{w.f()}}r||o.domSync()}},{key:"afterDrawDependency",value:function(e,n,r,i,a){var o;null===(o=B(t,"afterDrawDependency",this,3))||void 0===o||o([e,n,r,i,a])}},{key:"beforeDraw",value:function(){var e;null===(e=B(t,"beforeDraw",this,3))||void 0===e||e([])}},{key:"afterDraw",value:function(){var e;null===(e=B(t,"afterDraw",this,3))||void 0===e||e([])}},{key:"domSync",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.client.svgCanvas,t=arguments.length>1&&arguments[1]!==i&&arguments[1];fa.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback:function(){}}),t&&this.clearDomConfigs()}},{key:"fillDrawingCache",value:function(){var e=this,t=e.client,n=e.rowStore;e.relativeTo=pt.from(t.svgCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=n.indexOf(e.visibleResources.first),e.bottomIndex=n.indexOf(e.visibleResources.last),null==e.usingLinks&&(e.usingLinks=n.isChainedTree||t.resourceStore.some((function(e){return e.hasLinks})))}},{key:"clearDomConfigs",value:function(){this.domConfigs.clear()}},{key:"draw",value:function(){var e=this,t=e.client,n=t.visibleDateRange;if(!t.refreshSuspended&&t.foregroundCanvas&&n&&t.isEngineReady&&(!e.disabled||e._isDisabling)&&!t.isExporting){if(e.fillDrawingCache(),e.clearDomConfigs(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&n.endMS-n.startMS>0){var r,i=e.topIndex,a=e.bottomIndex,o=e.getDependenciesToConsider(n.startMS,n.endMS,i,a);e.beforeDraw();var l,s=D(o);try{for(s.s();!(l=s.n()).done;){var u=l.value;e.drawDependency(u,!0)}}catch(e){s.e(e)}finally{s.f()}e.afterDraw(),null!==(r=e.removeIconElement)&&void 0!==r&&r.isConnected&&t.waitForAnimations().then((function(){return e.positionRemoveIcon()}))}e.domSync(),t.trigger("dependenciesDrawn")}}},{key:"doRefresh",value:function(){var e,t,n,r,i,a=this,o=a.client,l=o.scheduledEventName,s=o.features;a.draw(),a.drawingLive=o.dependencyStore.count&&(o.isAnimating||o.useInitialAnimation&&a.eventStore.count||(null===(e=s["".concat(l,"Drag")])||void 0===e?void 0:e.isActivelyDragging)||(null===(t=s["".concat(l,"Drag")])||void 0===t?void 0:t.isAborting)||(null===(n=s["".concat(l,"Resize")])||void 0===n?void 0:n.isResizing)||(null===(r=s["".concat(l,"SegmentDrag")])||void 0===r?void 0:r.isActivelyDragging)||(null===(i=s["".concat(l,"SegmentResize")])||void 0===i?void 0:i.isResizing)),a.drawingLive&&a.refresh(!1,!0)}},{key:"rafRefresh",value:function(){this.doRefresh.now()}},{key:"refresh",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.immediateRefresh,t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.client;r.refreshSuspended||n.disabled||!r.isPainted||r.timeAxisSubGrid.collapsed||(e?n.doRefresh.now():t?n.rafRefresh():n.doRefresh())}},{key:"reset",value:function(){var e,n=arguments.length>1&&arguments[1]!==i&&arguments[1];null===(e=B(t,"reset",this,3))||void 0===e||e([]),this.refresh(n)}},{key:"immediateReset",value:function(){this.reset({},!0)}},{key:"render",value:function(){this.client.getConfig("svgCanvas")}}],[{key:"pluginConfig",get:function(){return{chain:["render","onInternalPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","onElementPointerDown","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}},{key:"getLocalizedDependencyType",value:function(e){return e?this.L("L{DependencyType.".concat(e,"}")):""}}]);var n}(wc.mixin(DR,$i,AT,(function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"gridCache",null),e}return R(t,e),w(t,[{key:"getDependenciesToConsider",value:function(e,t,n,r){var i=this,a=i.gridCache,l=i.client.timeAxis;if(a){for(var s=new o,u=Math.floor((e-l.startMS)/i.MS_PER_CELL),c=Math.floor((t-l.startMS)/i.MS_PER_CELL),d=Math.floor(n/25),h=Math.floor(r/25),f=u;f<=c;f++){var v=a[f];if(v)for(var g=d;g<=h;g++){var m=v[g];if(m)for(var p=0;p<m.length;p++)s.add(m[p])}}return s}}},{key:"afterDrawDependency",value:function(e,t,n,r,i){var a=this;if(a.constructGridCache){var o=a.MS_PER_CELL,l=a.client.timeAxis,s=l.startMS,u=l.endMS,c=Math.ceil((u-s)/o),d=Math.floor((r-s)/o),h=Math.floor((i-s)/o),f=Math.floor(t/25),v=Math.floor(n/25),g=Math.min(d,h),m=Math.max(d,h),p=Math.min(f,v),y=Math.max(f,v);if(g<0&&m<0||g>c&&m>c)return;for(var k=Math.max(g,0),b=Math.min(m,c),C=k;C<=b;C++)for(var w,D=null!==(w=a.gridCache[C])&&void 0!==w?w:a.gridCache[C]={},S=p;S<=y;S++){var x;(null!==(x=D[S])&&void 0!==x?x:D[S]=[]).push(e)}}}},{key:"beforeDraw",value:function(){var e=this;if(!e.gridCache){var t=e.client.visibleDateRange;e.constructGridCache=!0,e.MS_PER_CELL=Math.max(t.endMS-t.startMS,1e3),e.gridCache={}}}},{key:"afterDraw",value:function(){this.constructGridCache=!1}},{key:"reset",value:function(){this.gridCache=null}}])}(e),S(t,"$name","DependencyGridCache"),t}),(function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"lineCache",{}),e}return R(t,e),w(t,[{key:"onSVGReady",value:function(){var e=this;e.pathFinder=new PT(F(F({},e.pathFinderConfig),{},{client:e.client})),e.lineDefAdjusters=e.createLineDefAdjusters(),e.createMarker()}},{key:"changeRadius",value:function(e){return null!==e&&Be.assertNumber(e,"radius",!0),e}},{key:"resetAtRuntime",value:function(){this.isConfiguring||this.reset()}},{key:"updateRadius",value:function(){this.resetAtRuntime()}},{key:"updateRenderer",value:function(){this.resetAtRuntime()}},{key:"changeClickWidth",value:function(e){return null!==e&&Be.assertNumber(e,"clickWidth",!0),e}},{key:"updateClickWidth",value:function(){this.resetAtRuntime()}},{key:"updateDrawAroundParents",value:function(){this.resetAtRuntime()}},{key:"createMarker",value:function(){var e,t,n=this,r=n.markerDef,i=this.client.svgCanvas,a=r?"".concat(n.client.id,"-arrowEnd"):"arrowEnd";null===(e=n.marker)||void 0===e||e.remove(),i.style.setProperty("--scheduler-dependency-marker","url(#".concat(a,")")),n.marker=li.createElement({parent:i,id:a,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:null!==(t=n.markerDef)&&void 0!==t?t:"M3,0 L3,6 L9,3 z"}]})}},{key:"updateMarkerDef",value:function(){this.isConfiguring||(this.createMarker(),ne.isSafari&&(this.client.svgCanvas.innerHTML+=""))}},{key:"getAssignmentElement",value:function(e){var t,n;return(null===(t=this.client.features.eventDrag)||void 0===t||null===(n=t.getProxyElement)||void 0===n?void 0:n.call(t,e))||this.client.getElementFromAssignmentRecord(e)}},{key:"getDomConfigs",value:function(e,t,n,r){var i=this,a=i.getDependencyKey(e,t,n),o=i.lineCache[a];if(i.constructLineCache||!o||r||i.drawingLive&&(i.getAssignmentElement(t)||i.getAssignmentElement(n))){var l=i.prepareLineDef(e,t,n,r),s=l&&i.pathFinder.findPath(l,i.lineDefAdjusters),u=i.client,c=i.clickWidth,d=e.toEvent;if(s){var h,f,v=i.highlighted.get(e),g={tag:"path",ns:"http://www.w3.org/2000/svg",d:VT(null!==(h=i.radius)&&void 0!==h?h:0,s),role:"presentation",dataset:{syncId:a,depId:e.id,fromId:t.id,toId:n.id},elementData:{dependency:e,points:s},class:S(S(S(S(S(S(S(S(S({},i.baseCls,1),e.cls,e.cls),e.highlighted,e.highlighted),v&&z(v).join(" "),v),i.noMarkerCls,l.hideMarker),"b-inactive",!1===e.active),"b-sch-bidirectional-line",e.bidirectional),"b-readonly",e.readOnly),"b-sch-dependency-ends-outside",!d.milestone&&(u.showUnscheduledTasks&&!d.isScheduled?d._endDate<=u.startDate||u.endDate<=d._startDate:d.endDate<=u.startDate||u.endDate<=d.startDate)||d.milestone&&(d.endDate<u.startDate||u.endDate<d.startDate))};null===(f=i.renderer)||void 0===f||f.call(i,{domConfig:g,points:s,dependencyRecord:e,fromAssignmentRecord:t,toAssignmentRecord:n,fromBox:l.startBox,toBox:l.endBox,fromSide:l.startSide,toSide:l.endSide});var m=[g];return c>1&&m.push(F(F({},g),{},{class:F(F({},g.class),{},{"b-click-area":1}),dataset:F(F({},g.dataset),{},{syncId:"".concat(g.dataset.syncId,"-click-area")}),style:{strokeWidth:c}})),i.lineCache[a]=m}return i.lineCache[a]=null}return o}},{key:"generateBoundaryBoxes",value:function(e,t){return"top"===t?[]:"bottom"===t?[{start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}]:[{start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}]}},{key:"getAssignmentBounds",value:function(e){var t=this.client,n=this.getAssignmentElement(e);if(n&&!t.isExporting){var r=pt.from(n,this.relativeTo);if(r.fromElement=!0,t.isHorizontal){var i=t.getRowById(e.resource.id);if(!i)return t.getAssignmentEventBox(e,!0);if(r.y<i.top||r.bottom>i.bottom){var a=t.rowManager.getRowAt(r.center.y,!0);a&&(i=a)}r.rowTop=i.top,r.rowBottom=i.bottom}return r}return t.isEngineReady&&t.getAssignmentEventBox(e,!0)}},{key:"getConnectorStartSide",value:function(e){return this.client.currentOrientation.getConnectorStartSide(e)}},{key:"getConnectorEndSide",value:function(e){return this.client.currentOrientation.getConnectorEndSide(e)}},{key:"getDependencyStartSide",value:function(e){var t=e.fromEvent,n=e.type,r=e.fromSide;if(r)return r;switch(!0){case n===xx.Type.StartToEnd:case n===xx.Type.StartToStart:return this.getConnectorStartSide(t);case n===xx.Type.EndToStart:case n===xx.Type.EndToEnd:default:return this.getConnectorEndSide(t)}}},{key:"getDependencyEndSide",value:function(e){var t=e.toEvent,n=e.type,r=e.toSide;if(r)return r;switch(!0){case n===xx.Type.EndToEnd:case n===xx.Type.StartToEnd:return this.getConnectorEndSide(t);case n===xx.Type.EndToStart:case n===xx.Type.StartToStart:default:return this.getConnectorStartSide(t)}}},{key:"createLineDefAdjusters",value:function(){var e,t=this.client;var n=[function(e){var n=t.barMargin;return(e.startArrowMargin>n||e.endArrowMargin>n)&&(e.startArrowMargin=e.endArrowMargin=n,e)},function(e){return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,e)},function(e,t){return e.horizontalMargin>2&&(e.horizontalMargin=1,t.hideMarker=!0,e)}];return null!==(e=t.features.nestedEvents)&&void 0!==e&&e.enabled&&n.unshift((function(e){return e.otherBoxes.length&&(e.otherBoxes.length=e.otherBoxes.nestedStart),e})),n}},{key:"adjustLineDef",value:function(e,t){return t}},{key:"prepareLineDef",value:function(e,t,n,r){var i,a,o=this,l=o.client,s=o.getDependencyStartSide(e),u=o.getDependencyEndSide(e),c=null!==(i=null==r?void 0:r.from)&&void 0!==i?i:o.getAssignmentBounds(t),d=null!==(a=null==r?void 0:r.to)&&void 0!==a?a:o.getAssignmentBounds(n),h=[];if(!c||!d)return null;var f=o.pathFinder,v=f.startArrowMargin,g=f.verticalMargin;if(l.isHorizontal){var m;if(l.rtl){var p=l.timeAxisViewModel.totalSize;c&&!c.fromElement&&(c._x=p-c.x-c.width),d&&!d.fromElement&&(d._x=p-d.x-d.width)}if(null!=c.rowTop&&c.rowTop!==d.rowTop&&h.push.apply(h,z(o.generateBoundaryBoxes(c,s))),null!==(m=l.features.nestedEvents)&&void 0!==m&&m.enabled&&o.drawAroundParents){var y=l.resourceStore,k=t.resource,b=n.resource,C=y.indexOf(k),w=y.indexOf(b),S=Math.min(C,w),x=Math.max(C,w);h.nestedStart=h.length;var E,R=D(l.assignmentStore);try{for(R.s();!(E=R.n()).done;){var T,M=E.value;if(M!==t&&M!==n&&null!==(T=M.event)&&void 0!==T&&T.isParent&&t.event.parent!==M.event&&n.event.parent!==M.event){var F=y.indexOf(M.resource);if(F>=S&&F<=x){var A=o.getAssignmentBounds(M).inflate(v);A.isNestedParent=!0,h.push(A)}}}}catch(e){R.e(e)}finally{R.f()}}e.bidirectional||(/(top|bottom)/.test(s)&&(v=l.barMargin/2),g=l.barMargin/2)}return o.adjustLineDef(e,{startBox:c,endBox:d,otherBoxes:h,startArrowMargin:v,verticalMargin:g,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:s,endSide:u})}},{key:"beforeDraw",value:function(){B(t,"beforeDraw",this,3)([]),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}},{key:"afterDraw",value:function(){B(t,"afterDraw",this,3)([]),this.constructLineCache=!1}},{key:"reset",value:function(){B(t,"reset",this,3)([]),this.lineCache={}}}])}(e),S(t,"$name","DependencyLineGenerator"),t}),jT));S(UT,"$name","Dependencies"),S(UT,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",removeIconCls:"b-icon b-icon-remove-circle",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,enableDelete:!0,drawOnScroll:!0,clickWidth:null,immediateRefresh:null,drawAroundParents:null}),S(UT,"delayable",{doRefresh:10,rafRefresh:"raf"}),UT._$name="Dependencies",Ug.registerFeature(UT,!1,["Scheduler","ResourceHistogram"]);var GT,YT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"processWidgetConfig",value:function(e){var n=this.dependencyEditFeature;return!("lagField"===e.ref&&!n.showLagField)&&(!("deleteButton"===e.ref&&!n.showDeleteButton)&&B(t,"processWidgetConfig",this,3)([e]))}},{key:"afterShow",value:function(){var e=this.widgetMap.deleteButton;e&&(e.hidden=!this.record.isPartOfStore());for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];B(t,"afterShow",this,3)(r)}},{key:"onInternalKeyDown",value:function(e){this.trigger("keyDown",{event:e}),B(t,"onInternalKeyDown",this,3)([e])}}],[{key:"defaultConfig",get:function(){return{items:[],axisLock:"flexible"}}}])}(fc);S(YT,"$name","DependencyEditor"),YT._$name="DependencyEditor";var qT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){if(e.dependencyEdit=this,B(t,"construct",this,3)([e,n]),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit")}},{key:"doDestroy",value:function(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"changeEditorConfig",value:function(e){var t=this,n=t.autoClose,i=t.cls,a=t.client;return Be.assign({owner:a,align:"b-t",id:"".concat(a.id,"-dependency-editor"),autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:r,autoClose:n,cls:i},e)}},{key:"isValid",get:function(){return Object.values(this.editor.widgetMap).every((function(e){return!(e.name&&!e.hidden)||!1!==e.isValid}))}},{key:"values",get:function(){var e={};return this.editor.eachWidget((function(t){t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}},{key:"onBeforeSave",value:function(e){}},{key:"onAfterSave",value:function(e){}},{key:"updateRecord",value:function(e){var t=this.values;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),Be.cleanupProperties(t,!0),e.set(t)}},{key:"onPopupKeyDown",value:function(e){var t=e.event;"Enter"===t.key&&this.saveAndCloseOnEnter&&"input"===t.target.tagName.toLowerCase()&&(t.preventDefault(),this.onSaveClick())}},{key:"onHide",value:function(){this.isApplyingChanges||this.afterCancel()}},{key:"onSaveClick",value:(l=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).isApplyingChanges=!0,e.next=4,t.save();case 4:if(!e.sent){e.next=11;break}return t.afterSave(),e.next=8,t.editor.hide();case 8:t.isApplyingChanges=!1,e.next=12;break;case 11:t.isApplyingChanges=!1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"onDeleteClick",value:(o=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this).isApplyingChanges=!0,e.next=4,t.deleteDependency();case 4:if(!e.sent){e.next=6;break}t.afterDelete();case 6:return e.next=8,t.editor.hide();case 8:t.isApplyingChanges=!1;case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"onCancelClick",value:function(){this.editor.hide()}},{key:"afterSave",value:function(){}},{key:"afterDelete",value:function(){}},{key:"afterCancel",value:function(){}},{key:"internalShowEditor",value:function(e){var t,n=this,r=n.client,i=n.lastPointerDown,a=r.features.dependencies,o=n.getEditor(e),l=(null==a?void 0:a.getElementForDependency(e))||(null==i?void 0:i.target)||r.timeAxisSubGridElement,s=pt.from(l);n.loadRecord(e),r.trigger("beforeDependencyEditShow",{dependencyEdit:n,dependencyRecord:e,editor:o}),i?(Object.defineProperties(i,{offsetX:{configurable:!0,value:i.clientX-s.x},offsetY:{configurable:!0,value:i.clientY-s.y}}),t={target:i,align:"t50-b0"}):t={target:l,align:"c-c"};var u=o.showBy(t),c=[],d=0;return o.eachWidget((function(e){var t=e.labelElement,n=e.element;if(t){if(t.getBoundingClientRect().top<n.getBoundingClientRect().top)return!1;e.labelWidth=null,d=Math.max(d,t.offsetWidth),c.push(e)}})),c.forEach((function(e){return e.labelWidth=d})),u}},{key:"editDependency",value:(a=f(L().mark((function e(t){var n,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).client,e.t0=r.readOnly||t.readOnly,e.t0){e.next=7;break}return e.next=5,r.trigger("beforeDependencyEdit",{dependencyEdit:n,dependencyRecord:t});case 5:e.t1=e.sent,e.t0=!1===e.t1;case 7:if(!e.t0){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,this.internalShowEditor(t);case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getEditor",value:function(){var e,t,n,i=this,a=i.editor;return a||(0===(a=i.editor=YT.new({dependencyEditFeature:i,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:r,autoClose:i.autoClose,cls:i.cls,rootElement:i.client.rootElement,internalListeners:{keydown:i.onPopupKeyDown,hide:i.onHide,thisObj:i}},i.editorConfig)).items.length&&console.warn("Editor configured without any `items`"),a.eachWidget((function(e){var t=e.ref||e.id;t&&!i[t]&&(i[t]=e)})),null===(e=i.saveButton)||void 0===e||e.ion({click:"onSaveClick",thisObj:i}),null===(t=i.deleteButton)||void 0===t||t.ion({click:"onDeleteClick",thisObj:i}),null===(n=i.cancelButton)||void 0===n||n.ion({click:"onCancelClick",thisObj:i}),i.editor)}},{key:"loadRecord",value:function(e){var t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new ql(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}},{key:"save",value:(i=f(L().mark((function e(){var t,n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=this).client,(r=t.dependencyRecord)&&t.isValid){e.next=3;break}return e.abrupt("return");case 3:if(i=t.dependencyStore,a=t.values,!1===n.trigger("beforeDependencySave",{dependencyRecord:r,values:a})){e.next=15;break}if(t.onBeforeSave(r),t.updateRecord(r),!i||r.stores.length){e.next=11;break}if(!1!==n.trigger("beforeDependencyAdd",{dependencyRecord:r,dependencyEdit:t})){e.next=10;break}return e.abrupt("return");case 10:i.add(r);case 11:return e.next=13,null===(o=n.project)||void 0===o?void 0:o.commitAsync();case 13:n.trigger("afterDependencySave",{dependencyRecord:r}),t.onAfterSave(r);case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"deleteDependency",value:(n=f(L().mark((function e(){var t,n,r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.client,n=this.editor,r=this.dependencyRecord,!1===t.trigger("beforeDependencyDelete",{dependencyRecord:r})){e.next=7;break}return n.containsFocus&&n.revertFocus(),t.dependencyStore.remove(r),e.next=6,null===(i=t.project)||void 0===i?void 0:i.commitAsync();case 6:return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"dependencyStore",get:function(){return this.client.dependencyStore}},{key:"onActivateEditor",value:function(e){var t=e.dependency,n=e.event;this.disabled||(this.lastPointerDown=n,this.editDependency(t))}},{key:"updateTriggerEvent",value:function(e){var t;null===(t=this.clientListenersDetacher)||void 0===t||t.call(this),e&&(this.clientListenersDetacher=this.client.ion(S(S({},e,this.onActivateEditor),"thisObj",this)))}},{key:"populateDependencyMenu",value:function(e){var t=this,n=e.dependencyRecord,r=e.items;this.client.readOnly||this.disabled||(r.edit={text:"L{DependencyEdit.Edit dependency}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:n.readOnly,onItem:function(){t.editDependency(n)}})}}],[{key:"pluginConfig",get:function(){return{chain:["populateDependencyMenu"]}}}]);var n,i,a,o,l}(wc);GT=qT,S(qT,"$name","DependencyEdit"),S(qT,"configurable",{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:GT,closable:!0,defaults:{localeClass:GT},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){var e=this.parent;return Object.keys(xx.Type).map((function(t){return{id:xx.Type[t],name:e.L(t),localeKey:t}}))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0,highlightExternalChange:!1}},bbar:{defaults:{localeClass:GT},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}),qT._$name="DependencyEdit",Ug.registerFeature(qT,!1);var KT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getDataFromEvent",value:function(e){var n=B(t,"getDataFromEvent",this,3)([e]),r=this.client.features.dependencies,i=e.target.closest(".".concat(r.baseCls));if(i){var a=r.resolveDependencyRecord(i);return Object.assign(n,{element:i,dependencyRecord:a})}}},{key:"shouldShowMenu",value:function(e){return e.dependencyRecord}},{key:"populateDependencyMenu",value:function(e){var t=e.items,n=e.dependencyRecord;t.delete={disabled:n.readOnly,hidden:this.client.readOnly}}},{key:"changeItems",value:function(e){return pe.merge({delete:{text:"L{DependencyEdit.Delete}",icon:"b-icon b-icon-trash",cls:"b-separator",weight:500,onItem:function(e){e.dependencyRecord.remove()}}},e)}}],[{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateDependencyMenu"),e}}])}(op);S(KT,"$name","DependencyMenu"),S(KT,"configurable",{processItems:null,type:"dependency"}),KT.featureClass="",KT._$name="DependencyMenu",Ug.registerFeature(KT,Ne.checkVersion("core","7.0",">="),["Scheduler","Gantt"]);var XT=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"cursorTrackingSuspended",0),e}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]);var r=this.triggerEvent,i={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clear",thisObj:this};"mouseover"===r?i.timelineContextChange="onTimelineContextChange":("click"!==r&&"mousedown"!==r||(i.schedulecontextmenu="onScheduleContextGesture"),i["schedule".concat(r)]="onScheduleContextGesture"),e.ion(i),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}},{key:"changeTriggerEvent",value:function(e){return"hover"!==e&&"mousemove"!==e||(e="mouseover"),e}},{key:"changeWidget",value:function(e,t){if(e)return Lo.reconfigure(t,F(F({},e),{},{owner:this.client,positioned:!0,appendTo:this.client.timeAxisSubGridElement,hidden:!0,showAnimation:!1}),this);t.destroy()}},{key:"element",get:function(){var e;this._element||(this._element=(null===(e=this.widget)||void 0===e?void 0:e.element)||li.createElement({parent:this.client.timeAxisSubGridElement}),this.element.classList.add("b-schedule-selected-tick"));return this._element}},{key:"onTimelineContextChange",value:function(e){var t=e.context;this.context=t}},{key:"onScheduleContextGesture",value:function(e){this.context=e}},{key:"onTimeAxisViewModelUpdate",value:function(e){var t;e.source.timeAxis.includes(null===(t=this.context)||void 0===t?void 0:t.tick)?this.syncContextElement():this.clear()}},{key:"clear",value:function(){this.context=null}},{key:"changeContext",value:function(e){var t;if(null===(t=this.widget)||void 0===t||!t.query((function(e){return e.floating&&e.isVisible})))return!this.shareWithEvent&&this.hasEvent(e)||!this.activateOnEvent&&null!=e&&e.eventElement?null:e||null}},{key:"updateActivateOnEvent",value:function(e){var t=this;if(e){var n=t.triggerEvent,r=t.client;t.shareWithEvent=!0,"mouseover"!==n&&r.ion(S(S({name:"scheduleContextTrigger"},"".concat(r.scheduledEventName).concat(n),"onScheduleContextGesture"),"thisObj",t))}else t.shareWithEvent=t.config.shareWithEvent,t.detachListeners("scheduleContextTrigger")}},{key:"hasEvent",value:function(e){var t;return Boolean(e&&(null===(t=this.client.eventStore.getEvents({resourceRecord:e.resourceRecord,startDate:e.tickStartDate,endDate:e.tickEndDate}))||void 0===t?void 0:t.length))}},{key:"updateContext",value:function(e,t){this.syncContextElement()}},{key:"syncContextElement",value:function(){var e=this,t=e.client,n=e.element,r=e.widget,i=e.context,a=t.isVertical,o=i&&(a?t.rowManager.rows[0]:t.getRowFor(i.resourceRecord));if(i&&o&&this.enabled&&!i.domEvent.buttons){var l,s,u,c=this,d=c.renderer,h=n.style,f=i.tickStartDate,v=i.tickEndDate,g=i.resourceRecord,m=t.currentOrientation.getTimeSpanRenderData({startDate:f,endDate:v,startDateMS:f.getTime(),endDateMS:v.getTime()},g);a?(l=m.top,s=m.resourceWidth,u=m.height):(l=o.top,s=m.width,u=o.height),i.index=o.index,n.classList.add("b-schedule-selected-tick"),n.classList.toggle("b-contains-widget",Boolean(n.querySelector(".b-widget"))),r?(r.hide(!1),i.eventRecord||(r.setConfig({width:s,height:u,timelineContext:i,x:m.left,y:l}),r.show({animate:!1}))):n&&(h.width="".concat(s,"px"),h.height="".concat(u,"px"),li.setTranslateXY(n,m.left,l),n.innerHTML="",d&&c.callback(d,c,[i,n]),h.display="")}else(null==r?void 0:r.hide(!1))||(n.style.display="none")}}])}(wc.mixin($i));S(XT,"$name","ScheduleContext"),S(XT,"configurable",{triggerEvent:"click",renderer:null,widget:{$config:["lazy","nullify"],value:null},context:{$config:{equal:function(e,t){return(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))&&(null==e?void 0:e.eventRecord)===(null==t?void 0:t.eventRecord)}}},activateOnEvent:null,shareWithEvent:null}),XT.featureClass="b-scheduler-context",XT._$name="ScheduleContext",Ug.registerFeature(XT,!1,["Scheduler"]);var ZT=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"entityName","event"),e}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;B(t,"construct",this,3)([e,n]),e.ion({eventClick:"onEventClick",scheduleClick:"onScheduleClick",projectChange:function(){r.clearClipboard(),r._cellClickedContext=null},thisObj:this})}},{key:"scheduler",get:function(){return this.client}},{key:"attachToEventStore",value:function(e){B(t,"attachToEventStore",this,3)([e]),delete this._eventClickedContext}},{key:"onEventDataGenerated",value:function(e){var t=e.assignmentRecord;t&&(e.cls["b-cut-item"]=t.meta.isCut)}},{key:"onEventClick",value:function(e){this._cellClickedContext=null,this._eventClickedContext=e}},{key:"onScheduleClick",value:function(e){this._cellClickedContext=e,this._eventClickedContext=null}},{key:"isActionAvailable",value:function(e){var n=e.event;return e.actionName,B(t,"isActionAvailable",this,3)(arguments)&&Boolean(n.target.closest(this.client.eventContainerSelector))}},{key:"copy",value:(c=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyEvents();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"cut",value:(u=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.copyEvents(i,!0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"paste",value:(s=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pasteEvents();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"copyEvents",value:(l=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:this.scheduler.selectedAssignments,n=arguments.length>1&&arguments[1]!==i&&arguments[1];return L().mark((function r(i,a){var o,l,s,u,c,d;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(l=(o=e).scheduler).splitFrom){r.next=3;break}return r.abrupt("return",l.splitFrom.features.eventCopyPaste.copyEvents(t,n));case 3:if(null!==(i=t)&&void 0!==i&&i.length){r.next=5;break}return r.abrupt("return");case 5:if(s=t[0].isEventModel,t=n?t.filter((function(e){return s?!e.readOnly:!e.event.readOnly})):t.slice(),u=s?t.flatMap((function(e){return e.assignments})):t,c=u.length?u.map((function(e){return e.event})):t,u.length||o.allowNoAssignments&&c.length){r.next=10;break}return r.abrupt("return");case 10:return r.next=12,o.writeToClipboard({assignmentRecords:u,eventRecords:c},n);case 12:if(r.t1=a=r.sent,r.t0=null===r.t1,r.t0){r.next=16;break}r.t0=void 0===a;case 16:if(!r.t0){r.next=20;break}r.t2=void 0,r.next=21;break;case 20:r.t2=a.data;case 21:if(d=r.t2){r.next=24;break}return r.abrupt("return");case 24:l.trigger("copy",{originalAssignmentRecords:u,originalEventRecords:c,assignmentRecords:d.assignmentRecords,eventRecords:d.eventRecords,isCut:n,entityName:o.entityName}),o.refreshClient(),o._focusedEventOnCopy=o._eventClickedContext;case 27:case"end":return r.stop()}}),r)}))()})),function(){return l.apply(this,arguments)})},{key:"beforeCopy",value:(a=f((function(e){var t=this,n=e.data,r=n.assignmentRecords,i=n.eventRecords,a=e.isCut;return L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.scheduler.trigger("beforeCopy",{assignmentRecords:r,eventRecords:i,isCut:a,entityName:t.entityName});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"handleCutData",value:function(e){var t,n=this;if(e.source!==n&&null!==(t=n.cutData)&&void 0!==t&&t.length){var r=n.cutData[0],i=r.assignmentRecords,a=r.eventRecords;null!=i&&i.length&&n.scheduler.assignmentStore.remove(i),null!=a&&a.length&&n.scheduler.eventStore.remove(a)}}},{key:"stringConverter",value:function(e){var t,n=this,r=e.eventRecords,i=[],a=D(r);try{var o=function(){var e=t.value;i.push(n.eventToStringFields.map((function(t){var r=e[t];return r instanceof Date?Pl.format(r,n.dateFormat):r})).join("\t"))};for(a.s();!(t=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return i.join("\n")}},{key:"setIsCut",value:function(e,t){e.assignmentRecords.forEach((function(e){e.meta.isCut=t})),this.refreshClient()}},{key:"cloneData",value:function(e){var t=e.data,n=e.isPaste,r=this,a=r.eventStore,l=a.modelClass,s=new o,u=[],c=[],d=a.usesSingleAssignment||"clone"===r.copyPasteAction,h=function(e,t){var i,o,l=e.copy(null,!0);return n&&l.traverse((function(t){t.name=r.generateNewName(t,e,a)})),l.meta.originalResourceId=n?e.meta.originalResourceId:null!==(i=null==t?void 0:t.resourceId)&&void 0!==i?i:e.resourceId,null!==(o=l.fieldMap)&&void 0!==o&&o.resourceIds.persist&&(l.resourceIds=[]),l},f=t.assignmentRecords,v=t.eventRecords;if(n&&!f&&!v)return null!=t&&t.length&&t[0].isModel?{eventRecords:v=t.map((function(e){return new l(F(F({},e.toJSON()),{},S({},l.idField,i)))})),assignmentRecords:[]}:void 0;if(n&&d)u.push.apply(u,z(v.map((function(e){return h(e)}))));else{var g,m=f;null!==(g=m)&&void 0!==g&&g.length||!r.allowNoAssignments||(m=v);var p,y=D(m);try{var k=function(){var e=p.value,t=e.isEventModel?e:a.getById(e.eventId);if(s.has(t))return 1;s.add(t),d||e.isEventModel?((t=h(t,null==f?void 0:f.find((function(e){return e.eventId===t.id})))).constraintDate&&(t.constraintDate=null),u.push(t)):c.push(e.copy())};for(y.s();!(p=y.n()).done;)k()}catch(e){y.e(e)}finally{y.f()}}return{assignmentRecords:c,eventRecords:u}}},{key:"pasteEvents",value:(r=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,S,x,E,R,T,M,F,A,I,O,P,_,H,B,V,N,z,j=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(a=this).scheduler,l=a.copyPasteAction,s=a.entityName,u=a.unifiedPaste,c=a._cellClickedContext,d=a._eventClickedContext,h=o.eventStore,f=o.assignmentStore,v=o.resourceStore,0===j.length&&(c?(t=c.date,n=c.resourceRecord):a._focusedEventOnCopy!==d&&(t=d.eventRecord.startDate,n=d.resourceRecord)),n&&(n=n.$original),!o.splitFrom){e.next=5;break}return e.abrupt("return",o.splitFrom.features.eventCopyPaste.pasteEvents(t,n));case 5:return e.next=7,a.readFromClipboard({resourceRecord:n,date:t});case 7:if(e.t1=r=e.sent,e.t0=null!==e.t1,!e.t0){e.next=11;break}e.t0=void 0!==r;case 11:if(!e.t0){e.next=15;break}e.t2=r,e.next=16;break;case 15:e.t2={};case 16:if(g=e.t2,m=g.data,p=g.isCut,y=g.originalData,k=null!=m&&null!==(i=m.assignmentRecords)&&void 0!==i&&i.length?m.assignmentRecords:null==m?void 0:m.eventRecords,b=[],C=[],null!=k&&k.length){e.next=25;break}return e.abrupt("return");case 25:E=D(k);try{for(E.s();!(R=E.n()).done;)T=R.value,M=void 0,T.isEventModel?(M=T,T=null):(M=null!==(F=T.event)&&void 0!==F?F:h.getById(T.eventId),T.meta.isCut=!1),C.includes(M)||(t&&(u&&S&&(t=new Date(t.getTime()+(M.startDate-S))),S=M.startDate,M.startDate=t,M.constraintDate&&(M.constraintDate=null)),p||(h.add(M),null!=n||(n=v.getById(M.meta.originalResourceId))),C.push(M)),n?(P=v.getById(null!==(A=null!==(I=null===(O=T)||void 0===O?void 0:O.resourceId)&&void 0!==I?I:M.resourceId)&&void 0!==A?A:M.meta.originalResourceId),u&&x&&!o.isCalendar&&(H=v.indexOf(P)-v.indexOf(x),n=null!==(_=v.getAt(v.indexOf(n)+H))&&void 0!==_?_:v.last),n.readOnly||M.isAssignedTo(n)||(T=M.assign(n),M.traverse((function(e){return e.assign(n)}),!0)),!P||P.readOnly||n===P||h.usesSingleAssignment||!p&&"clone"!==l||M.unassign(P),x=P):!p&&o.isCalendar&&T&&!M.isAssignedTo(T.resourceId)&&f.add(T),T?(b.push(T),w=T):w=f.last}catch(e){E.e(e)}finally{E.f()}if(n||(n=null!==(B=null==b||null===(V=b[0])||void 0===V?void 0:V.resource)&&void 0!==B?B:null==C||null===(N=C[0])||void 0===N?void 0:N.resource),o.trigger("paste",{eventRecords:C,assignmentRecords:b,pastedEventRecords:C,originalEventRecords:null==y?void 0:y.eventRecords,originalAssignmentRecords:null==y?void 0:y.assignmentRecords,resourceRecord:n,date:t,isCut:p,entityName:s}),o.isSchedulerBase&&(z=o.ion({renderEvent:function(e){var t=e.assignmentRecord;t===w&&(o.navigateTo(t,{scrollIntoView:!1}),z())}})),!p){e.next=33;break}return e.next=33,a.clearClipboard();case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"beforePaste",value:(n=f((function(e){var t=this,n=e.originalData,r=e.data,i=r.assignmentRecords,a=r.eventRecords,o=e.resourceRecord,l=e.isCut,s=e.date;return L().mark((function e(r){var u,c,d,h,f,v,g,m,p,y;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.scheduler,c=null==n?void 0:n.assignmentRecords,o||(o=null==c||null===(d=c[0])||void 0===d?void 0:d.resource),h={assignmentRecords:i,eventRecords:a,resourceRecord:o,originalAssignmentRecords:c,originalEventRecords:null==n?void 0:n.eventRecords,date:s,isCut:l,entityName:t.entityName},null!==(r=o)&&void 0!==r&&r.readOnly&&(f="resourceReadOnly"),f||u.allowOverlap){e.next=25;break}v=null!=i&&i.length?i:a,g=D(v),e.prev=7,g.s();case 9:if((m=g.n()).done){e.next=17;break}if(p=m.value,y=p.isAssignmentModel?p.event:p,u.isDateRangeAvailable(null!=s?s:y.startDate,s?Pl.add(s,y.duration,y.durationUnit):y.endDate,l?y:null,null!=o?o:p.resource)){e.next=15;break}return f="overlappingEvents",e.abrupt("break",17);case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),g.e(e.t0);case 22:return e.prev=22,g.f(),e.finish(22);case 25:if(!f){e.next=28;break}return u.trigger("pasteNotAllowed",F(F({},h),{},{reason:f})),e.abrupt("return",!1);case 28:return e.next=30,t.scheduler.trigger("beforePaste",h);case 30:return e.abrupt("return",e.sent);case 31:case"end":return e.stop()}}),e,null,[[7,19,22,25]])}))()})),function(e){return n.apply(this,arguments)})},{key:"stringParser",value:function(e){var t,n=this.scheduler,r=n.eventStore,i=n.assignmentStore,a=this.setFromStringData(e,!0,r,this.eventToStringFields).modifiedRecords,o=[],l=D(a);try{for(l.s();!(t=l.n()).done;){var s=t.value,u=i.createRecord({eventId:s.id});u.event=s,o.push(u)}}catch(e){l.e(e)}finally{l.f()}return{eventRecords:a,assignmentRecords:o}}},{key:"populateEventMenu",value:function(e){var t,n=e.assignmentRecord,r=e.items,i=this,a=i.scheduler;i.disabled||(r.copyEvent={text:"L{copyEvent}",localeClass:i,icon:"b-icon b-icon-copy",cls:"b-separator",weight:110,onItem:function(){var e=a.isAssignmentSelected(n)?a.selectedAssignments:[n];i.copyEvents(e)}},a.readOnly||(r.cutEvent={text:"L{cutEvent}",localeClass:i,icon:"b-icon b-icon-cut",weight:120,disabled:n.readOnly||(null===(t=n.event)||void 0===t?void 0:t.readOnly),onItem:function(){var e=a.isAssignmentSelected(n)?a.selectedAssignments:[n];i.copyEvents(e,!0)}}))}},{key:"populateScheduleMenu",value:function(e){var t=e.items,n=e.resourceRecord,r=this,i=r.scheduler;r.disabled||i.readOnly||!1===r.hasClipboardData()||(t.pasteEvent={text:"L{pasteEvent}",localeClass:r,icon:"b-icon b-icon-paste",disabled:0===i.resourceStore.count&&!r.allowNoAssignments||(null==n?void 0:n.readOnly),weight:110,internalListeners:{item:r.onScheduleMenuPasteClick,thisObj:r}})}},{key:"onScheduleMenuPasteClick",value:function(e){var t=e.date,n=e.resourceRecord;this.pasteEvents(t,n)}},{key:"refreshClient",value:function(){this.scheduler.refreshWithTransition()}}],[{key:"pluginConfig",get:function(){return{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}}}]);var n,r,a,l,s,u,c}(pC.mixin(DR));S(ZT,"$name","EventCopyPaste"),S(ZT,"configurable",{nameField:"name",copyPasteAction:"clone",eventToStringFields:["name","startDate","endDate","duration","durationUnit","allDay"],unifiedPaste:!0,allowedDataSources:["EventCopyPaste","RowCopyPaste","TaskCopyPaste"],allowNoAssignments:!1}),ZT.featureClass="b-event-copypaste",ZT._$name="EventCopyPaste",Ug.registerFeature(ZT,!0,"Scheduler");var JT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeMode",value:function(e){var t=this.dragData,n=this.copyMode;if(("event"===n||"auto"===n||"assignment"===n&&!this.scheduler.eventStore.usesSingleAssignment)&&(!t||t.eventRecords.every((function(e){return!e.isRecurring}))))return e}},{key:"updateMode",value:function(e){this.dragData&&("copy"===e?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}},{key:"setCopying",value:function(){var e=this.dragData;e&&(e.eventBarCopies.some((function(e){return e.isConnected}))?e.eventBarCopies.forEach((function(e){e.classList.remove("b-hidden")})):e.eventBarCopies.forEach((function(t){t.classList.add("b-drag-proxy-copy"),t.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(t),t.retainElement=!0})))}},{key:"setMoving",value:function(){var e=this.dragData;e&&e.eventBarCopies.forEach((function(e){e.classList.add("b-hidden")}))}},{key:"scheduler",get:function(){return this.client}},{key:"onBeforeDragStart",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=B(t,"onBeforeDragStart",this,3)(n);return i&&(this.canStartFeatureTransaction?this.startFeatureTransaction().then():(this.client.trigger("eventDragPrevented",{reason:"revision"}),i=!1)),i}},{key:"onDragAbortFinalized",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"onDragAbortFinalized",this,3)(n),this.rejectFeatureTransaction()}},{key:"finalize",value:(a=f(L().mark((function e(){var n,r,i,a=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.length,r=new Array(n),i=0;i<n;i++)r[i]=a[i];return e.next=3,B(t,"finalize",this,3)(r);case 3:return e.next=5,this.finishFeatureTransaction();case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"onAfterDragStart",value:function(e){var n=this,r=n.drag,i=e.context.element;n.singleDirection&&(r.lockY="horizontal"===e.initialDirection,r.lockX=!r.lockY),B(t,"onAfterDragStart",this,3)([e]),n.handleKeyDownOrMove(e.event),n.keyEventDetacher=fr.on({element:li.getRootElement(i),keydown:n.handleKeyDownOrMove,keyup:n.handleKeyUp,thisObj:n})}},{key:"onDragReset",value:function(e){var n;B(t,"onDragReset",this,3)([e]),null===(n=this.keyEventDetacher)||void 0===n||n.call(this),this.mode="move"}},{key:"onDrop",value:function(e){var n;return null===(n=this.dragData.eventBarCopies)||void 0===n||n.forEach((function(e){return e.remove()})),B(t,"onDrop",this,3)([e])}},{key:"getDraggableElement",value:function(e){return null==e?void 0:e.closest(this.drag.targetSelector)}},{key:"resolveEventRecord",value:function(e){return(arguments.length>1&&arguments[1]!==i?arguments[1]:this.client).resolveEventRecord(e)}},{key:"isElementDraggable",value:function(e,t){var n,r=this,i=r.client,a=r.getDraggableElement(e);if(!a||r.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;var o=r.resolveEventRecord(a,i);return!(!o||!o.isDraggable||o.readOnly)&&!(!1===(null===(n=i["is".concat(r.capitalizedEventName,"ElementDraggable")])||void 0===n?void 0:n.call(i,a,o,e,t)))}},{key:"getTriggerParams",value:function(e){var t=e.assignmentRecords;return{context:e,eventRecords:e.eventRecords,resourceRecord:e.resourceRecord,assignmentRecords:t,domEvent:e.browserEvent}}},{key:"getGroupedToStoreResources",value:function(e){if(e.resourcesInStore)return e.resourcesInStore;var t=this.client,n=t.isVertical?t.resourceStore:t.store;return e.resourcesInStore=z(new o(n.getAllDataRecords().map((function(e){return e.$original})))).filter((function(e){return e.isLeaf}))}},{key:"getIndexDiff",value:function(e){var t,n=this,r=n.client,i=n.currentOverClient,a=r!==i,o=i.isVertical,l=r.isVertical?r.resourceStore:r.store,s=o?i.resourceStore:i.store,u=e.resourceRecord,c=e.newResource;if(a)t=s.indexOf(c)-l.indexOf(u.$original);else if(n.constainDragToResource)t=0;else if(o&&s.isGrouped){var d=n.getGroupedToStoreResources(e);t=d.indexOf(u.$original)-d.indexOf(c)}else t=l.indexOf(u.$original)-l.indexOf(c);return t}},{key:"getNewResource",value:function(e,t,n){var r=this,i=r.client,a=r.currentOverClient,o=i!==a,l=a.isVertical,s=i.isVertical?i.resourceStore:i.store,u=l?a.resourceStore:a.store,c=e.newResource;if(o){var d=s.indexOf(t);c=u.getAt(d+n)||c}else if(0!==n){var h,f;if(l&&u.isGrouped){var v=r.getGroupedToStoreResources(e);f=Math.max(Math.min(v.indexOf(t)-n,v.length-1),0),c=v[f]}else f=Math.max(Math.min(s.indexOf(t)-n,s.count-1),0),(c=s.getAt(f)).isSpecialRow&&(c=s.getNext(c,!1,!0)||s.getPrevious(c,!1,!0));c=null===(h=c)||void 0===h?void 0:h.$original}else c=t;return c}},{key:"getDropData",value:function(e){var t=this,n=this.getIndexDiff(e);return{events:e.eventRecords.map((function(n){return F({eventRecord:n},t.getEventNewStartEndDates(n,e.timeDiff,t.currentOverClient))})),assignments:e.assignmentRecords.map((function(r){return{assignmentRecord:r,resourceRecord:t.getNewResource(e,r.resource,n)}}))}}},{key:"triggerBeforeEventDropFinalize",value:function(e,n,r){n.context.dropData=this.getDropData(n.context),B(t,"triggerBeforeEventDropFinalize",this,3)([e,n,r])}},{key:"triggerBeforeEventDrag",value:function(e,t){return this.client.trigger(e,t)}},{key:"triggerEventDrag",value:function(e,t){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}},{key:"triggerDragStart",value:function(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}},{key:"triggerDragAbort",value:function(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}},{key:"triggerDragAbortFinalized",value:function(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}},{key:"triggerAfterDrop",value:function(e,t){var n=this;if(n.currentOverClient.trigger("afterEventDrop",Object.assign(n.getTriggerParams(e),{valid:t})),!t){var r=n.client,i=r.assignmentStore,a=r.eventStore;n.dragData.initialAssignmentsState.find((function(e,t){var r,o=e.resource,l=e.assignment;return!i.includes(l)||!a.includes(l.event)||o.id!==(null===(r=n.dragData.assignmentRecords[t])||void 0===r?void 0:r.resourceId)}))&&n.client.refresh()}n.client.setTimeout((function(){return n.client.navigator.skipNextClick=!1}),10)}},{key:"handleKeyDownOrMove",value:function(e){var t,n,r=this;"copy"!==r.mode&&(r.alwaysCopy||r.isCtrlKeyPress(e)||e.key&&fr.specialKeyFromEventKey(e.key)===(null===(t=r.copyKey)||void 0===t?void 0:t.toLowerCase())||e["".concat(null===(n=r.copyKey)||void 0===n?void 0:n.toLowerCase(),"Key")])&&(r.mode="copy")}},{key:"handleKeyUp",value:function(e){(this.isCtrlKeyPress(e)||fr.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase())&&(this.mode="move")}},{key:"isCtrlKeyPress",value:function(e){return"CTRL"===this.copyKey&&e.key===("ctrlKey"===ne.ctrlKey?"Ctrl":"Meta")}},{key:"isValidDrop",value:function(e){var t=e.newResource,n=e.resourceRecord,r=e.browserEvent,i=e.draggedEntities[0],a=r.target;return t?!t.isSpecialRow&&!t.readOnly&&(n.$original===t||!i.event.resources.includes(t)):!(this.constrainDragToTimeline||!this.externalDropTargetSelector)&&Boolean(a.closest(this.externalDropTargetSelector))}},{key:"checkDragValidity",value:function(e,t){var n,r,i,a=this,o=a.currentOverClient,l=e.newResource;if(null!=l&&l.readOnly)return!1;(n=l&&a.hasOverlaps()?{valid:!1,message:a.L("L{eventOverlapsExisting}")}:a.validatorFn.call(a.validatorFnThisObj||a,e,t))&&!n.valid||(n=null!==(r=null===(i=o.checkEventDragValidity)||void 0===i?void 0:i.call(o,e,t))&&void 0!==r?r:n);return n}},{key:"hasOverlaps",value:function(){var e=this,t=e.dragData,n=e.currentOverClient,r=t.startDate-t.origStart,i=e.getIndexDiff(e.dragData),a=(n.features.eventBuffer||{}).bufferIsUnavailableTime;return t.assignmentRecords.some((function(n){var o=e.getNewResource(t,n.resource,i),l=n.event,s=a&&l.outerStartDate||l.startDate,u=a&&l.outerEndDate||l.endDate,c=Pl.add(s,r,"ms"),d=Pl.add(u,r,"ms");return!e.currentOverClient.isDateRangeAvailable(c,d,t.assignmentRecords,o)}))}},{key:"updateRecords",value:(r=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).client,i=n.currentOverClient,a="copy"===n.mode,o=t.draggedEntities,l=t.timeDiff,s=t.initialAssignmentsState,u=s[0].startDate,c=n.adjustStartDate(u,l),t.externalDropTarget){e.next=11;break}if(i.timeAxis.timeSpanInAxis(c,Pl.add(c,o[0].event.rawDurationMS,"ms"))||(t.valid=!1),!t.valid){e.next=11;break}return r.eventStore.suspendAutoCommit(),i.eventStore.suspendAutoCommit(),e.next=8,n.updateAssignments(r,i,t,a);case 8:d=e.sent,r.eventStore.resumeAutoCommit(),i.eventStore.resumeAutoCommit();case 11:return t.valid&&i.trigger("eventDrop",Object.assign(n.getTriggerParams(t),{isCopy:a,copyMode:n.copyMode,domEvent:t.browserEvent,targetEventRecord:t.targetEventRecord,targetResourceRecord:t.newResource,externalDropTarget:t.externalDropTarget})),e.abrupt("return",d);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateAssignments",value:(n=f(L().mark((function e(t,n,r,a){var l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,S,x,E,R,T,M,A,I,O,P,H,B,V,N,j,W,$,U,G,Y,q,K,X=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=(l=this).copyMode,u=t!==n,c=n.isVertical,d=t.assignmentStore,h=t.eventStore,f=n.assignmentStore,v=n.eventStore,g=t.isVertical?t.resourceStore:t.store,m=r.eventRecords,p=r.assignmentRecords,y=r.timeDiff,k=r.initialAssignmentsState,b=r.newResource,C=l.unifiedDrag,w=v.usesSingleAssignment||!1!==v.usesSingleAssignment&&h.usesSingleAssignment,D="event"===s?"event":"assignment"===s?"assignment":w?"event":"assignment",S=l.adjustStartDate(p[0].event.startDate,y),x=[],E=[],R=[],T=[],M=[],A=new o,t.suspendRefresh(),n.suspendRefresh(),I=!1,O=!1,P=l.getIndexDiff(r),c&&m.forEach((function(e,n){var i=r.eventBarEls[n];delete e.instanceMeta(t).hasTemporaryDragElement,i.dataset.transient&&i.remove()})),H=r.eventBarEls.slice(),B=[],V={},N=L().mark((function e(t){var o,c,m,_,N,z,W,$,U,G,Y,q,K,Z,J;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=p[t],c=o.event,a?(m=o.copy(),V[o.id]=m):m=o,m.isOccurrenceAssignment||d.includes(o)&&h.includes(c)){e.next=10;break}return H[t].remove(),H.splice(t,1),p.splice(t,1),t--,j=t,e.abrupt("return",1);case 10:if(_=k[t],N=c,z=_.startDate,W=_.resource,$=X.constrainDragToTimeSlot?z:C?S:l.adjustStartDate(z,y),d.equals(f)||(U=N.assignments.length>1||a,a?G=m:(G=m.copy(),V[m.id]=G),G.event&&!w&&(G.event=G.event.id,G.resource=G.resource.id),a||T.push(m),U||E.push(N),(a&&("event"===s||"auto"===s&&v.usesSingleAssignment)||!v.getById(N.id))&&(c=v.createRecord(F(F({},N.data),{},{children:null===(Y=N.children)||void 0===Y?void 0:Y.map((function(e){return e.copy()})),id:!a||"event"!==s&&"auto"!==s?N.id:i,calendar:null})),G.set({eventId:c.id,event:c}),x.push(c)),w||R.push(G),m=G),q=b,K=null,C||(q=l.getNewResource(r,W,P)||b),q=q.$original,(Z=m.resourceId!==q.id)?(K=g.getById(m.resourceId),a&&d.equals(f)?(m.setData({resource:null,resourceId:null}),m.resource=q,m.event=v.getById(m.eventId),(J="event"===s||h.usesSingleAssignment&&"auto"===s)&&((c=c.copy()).meta.endDateCached=l.adjustStartDate(c.endDate,y),c.endDate=null,m.event=c,v.usesSingleAssignment&&(c.resource=q,c.resourceId=q.id)),f.find((function(e){return e.eventId===m.eventId&&e.resourceId===m.resourceId}))||R.find((function(e){return e.eventId===m.eventId&&e.resourceId===m.resourceId}))||(J&&x.push(c),R.push(m))):(m.resource=q,w?m.event.resourceId=q.id:m.resourceId=q.id),c.isEvent&&A.add(c),I=!0,c.isOccurrence&&c.set("newResource",q),u&&w&&(c.resourceId=q.id)):a&&("event"===s||"auto"===s&&h.usesSingleAssignment)&&!x.includes(c)&&((c=c.copy()).meta.endDateCached=l.adjustStartDate(c.endDate,y),c.endDate=null,x.push(c),m.event=c,v.usesSingleAssignment&&c.set({resource:q,resourceId:q.id}),R.push(m)),!M.find((function(e){return e.draggedEvent===c}))&&!Pl.isEqual(c.startDate,$)){for(;!c.isOccurrence&&c.isBatchUpdating;)c.endBatch(!0);a&&!u&&!w&&"assignment"===D&&Z||(c.startDate=$,M.push({draggedEvent:c,originalStartDate:z})),c.isEvent&&A.add(c),O=!0}n.processEventDrop({eventRecord:c,resourceRecord:q,element:0===t?r.context.element:r.context.relatedElements[t-1],context:r,toScheduler:n,reassignedFrom:K,eventsToAdd:x,addedEvents:B,draggedAssignment:m}),n.trigger("processEventDrop",{originalAssignment:o,draggedAssignment:m,context:r,copyMode:s,isCopy:a}),j=t;case 21:case"end":return e.stop()}}),e)})),j=0;case 9:if(!(j<p.length)){e.next=16;break}return e.delegateYield(N(j),"t0",11);case 11:if(!e.t0){e.next=13;break}return e.abrupt("continue",13);case 13:j++,e.next=9;break;case 16:if(d.remove(T),h.remove(E),f.add(R),a&&d.equals(f)&&(W=t.foregroundCanvas.syncIdMap,Object.entries(V).forEach((function(e){var t=_(e,2),n=t[0],r=t[1],i=W[n];delete W[n],W[r.id]=i}))),x.length&&B.push.apply(B,z(v.add(x))),null==B||B.forEach((function(e){return A.add(e)})),(T.length||E.length||R.length||x.length)&&(I=!0),!I&&!O){e.next=37;break}if(l.constrainDragToTimeline){e.next=32;break}G=L().mark((function e(){var t,i,o,l,s,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=V[p[Y].id]||p[Y],i=t.event,o=(null==B?void 0:B.find((function(e){return e.id===i.id})))||i,l=r.eventBarEls[Y],s=0===Y?r.context.element:r.context.relatedElements[Y-1],d=n.isInTimeAxis(o),delete o.meta.endDateCached,a||fa.removeChild(l.parentElement,l),o.resource&&(c||n.rowManager.getRowFor(t.resource))&&d?(o.parent&&!o.parent.isRoot||(h=pt.from(s,n.foregroundCanvas,!0),f=n.rtl?n.timeAxisViewModel.totalSize-h.right:h.x,li.setTopInsetInlineStart(s,h.y,f),fa.addChild(n.foregroundCanvas,s,o.assignments[0].id),u&&n.processCrossSchedulerEventDrop({eventRecord:o,toScheduler:n})),s.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),s.retainElement=!1):s.remove();case 4:case"end":return e.stop()}}),e)})),Y=0;case 27:if(!(Y<p.length)){e.next=32;break}return e.delegateYield(G(),"t1",29);case 29:Y++,e.next=27;break;case 32:return w&&A.forEach((function(e){return e.beginBatch()})),q=null!==($=v.$master.project)&&void 0!==$?$:n.project,K=null!==(U=h.$master.project)&&void 0!==U?U:t.project,e.next=36,Promise.all([q!==K?q.commitAsync():null,K.commitAsync()]);case 36:w&&A.forEach((function(e){return e.endBatch(!1,!0)}));case 37:I||(I=M.some((function(e){var t=e.draggedEvent,n=e.originalStartDate;return!Pl.isEqual(t.startDate,n)}))),n.resumeRefresh(!1),t.resumeRefresh(!1),p.length>0&&(I?(H.forEach((function(e){return delete e.lastDomConfig})),n.refreshWithTransition(),u&&(t.refreshWithTransition(),n.selectedEvents=B)):r.valid=!1);case 41:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getProductDragContext",value:function(e){var t,n,r=this,i=r.currentOverClient,a=e.browserEvent.target,o=e.newResource||e.resourceRecord,l=e.targetEventRecord,s=i?r.resolveEventRecord(a,i):null;if(e.eventRecords.includes(s)&&(s=null),r.constrainDragToResource?t=e.resourceRecord:r.constrainDragToTimeline?i&&(t=r.resolveResource()||e.newResource||e.resourceRecord):t=r.resolveResource(),s&&!s.isParent&&!s.parent){var u=a.parentElement.dataset.resourceId;if(t&&u!=t.id)s=i.eventStore.getEvents({startDate:e.startDate,endDate:e.endDate,resourceRecord:t})[0]}var c=e.assignmentRecords,d=e.eventRecords,h=o!==t,f=Boolean(t&&!t.isSpecialRow);return!t&&r.externalDropTargetSelector&&(n=a.closest(r.externalDropTargetSelector),f=Boolean(n)),{valid:f,externalDropTarget:n,eventRecords:d,assignmentRecords:c,newResource:t,targetEventRecord:s,dirty:h||s!==l,proxyElements:[e.context.element].concat(z(e.context.relatedElements||[]))}}},{key:"getMinimalDragData",value:function(e){var t=this,n=t.scheduler,r=t.getElementFromContext(e),i=t.resolveEventRecord(r,n),a=n.resolveResourceRecord(r),l=n.resolveAssignmentRecord(r),s=l?[l]:[];return l&&(n.isAssignmentSelected(s[0])||t.drag.startEvent.ctrlKey&&n.multiEventSelect)&&s.push.apply(s,t.getRelatedRecords(l)),s=s.filter((function(e){return n.resourceStore.isAvailable(e.resource)})),{eventRecord:i,resourceRecord:a,assignmentRecord:l,eventRecords:z(new o(s.map((function(e){return e.event})))),assignmentRecords:s}}},{key:"setupProductDragData",value:function(e){var n,r,i=this,a=i.scheduler,o=i.getElementFromContext(e),l=i.getMinimalDragData(e),s=l.eventRecord,u=l.resourceRecord,c=l.assignmentRecord,d=l.assignmentRecords,h=[];if(i.constrainDragToResource&&!u)throw new Error("Resource could not be resolved for event: "+s.id);if(i.constrainDragToTimeline){var f;r=null===(f=i.getDateConstraints)||void 0===f?void 0:f.call(i,u,s);var v=i.constrainRectangle=i.getConstrainingRectangle(r,u,s),g=pt.from(o,a.timeAxisSubGridElement),m=Boolean(r.start);B(t,"setupConstraints",this,3)([v,g,a.timeAxisViewModel.snapPixelAmount,m&&a.isHorizontal,m&&a.isVertical])}return d.forEach((function(e){var t=a.getElementFromAssignmentRecord(e,!0,!1,a.isLockedRowsView);t||(t=a.currentOrientation.addTemporaryDragElement(e.event,e.resource)),h.push(t)})),{record:c,draggedEntities:d,dateConstraints:null!==(n=r)&&void 0!==n&&n.start?r:null,eventBarCopies:h.map((function(e){return i.createProxy(e)})),eventBarEls:h}}},{key:"getDateConstraints",value:function(e,t){var n,r,i,a=this.scheduler,o=null===(n=a.getDateConstraints)||void 0===n?void 0:n.call(a,e,t);return this.constrainDragToTimeSlot?(r=t.startDate,i=t.endDate):o&&(r=o.start||new Date(0),i=o.end||new Date(9999,0,1)),{start:r,end:i}}},{key:"getConstrainingRectangle",value:function(e,t,n){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&t,n,!0,e&&{start:e.start,end:e.end})}},{key:"getDragData",value:function(e){var n=this.getMinimalDragData(e)||{};return F(F(F({},B(t,"getDragData",this,3)([e])),n),{},{initialAssignmentsState:n.assignmentRecords.map((function(e){return{startDate:e.event.startDate,resource:e.resource,assignment:e}}))})}},{key:"getRelatedRecords",value:function(e){return this.scheduler.selectedAssignments.filter((function(t){return t!==e&&!t.resource.readOnly&&t.event.isDraggable}))}},{key:"getCoordinate",value:function(e,t,n){var r=this.currentOverClient;if(r.isHorizontal){var i=n[0];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}var a=n[1];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":a+=t.offsetHeight/2;break;case"end":a+=t.offsetHeight}return a}},{key:"resolveResource",value:function(){var e,t=this,n=t.currentOverClient,r=n.isHorizontal,i=t.dragData,a=i.context,o=i.browserEvent,l=i.dragProxy||a.element,s=pt.from(l,null,!0),u=n.isVertical||t.unifiedDrag?a.clientY:s.center.y,c=pt.from(l,n.timeAxisSubGridElement,!0).center,d=c.x,h=c.y,f=null;if(o.touches?pt.from(n.element).contains(yt.from(o,!0)):n.element.contains(t.getMouseMoveEventTarget(o)))if(r){var v=n.rowManager.getRowAt(u);f=v&&n.store.storage.getAt(v.dataIndex)}else f=n.resolveResourceRecord(n.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[d,h]);return null===(e=f)||void 0===e?void 0:e.$original}},{key:"getRecordElement",value:function(e){return this.client.getElementFromAssignmentRecord(e,!0)}},{key:"getProxyElement",value:function(e){var t,n=this.dragData;if(this.isDragging&&null!=n&&null!==(t=n.proxyElements)&&void 0!==t&&t.length){var r=n.assignmentRecords.indexOf(e);if(r>=0)return n.proxyElements[r]}return null}},{key:"getMouseMoveEventTarget",value:function(e){return e.target}}],[{key:"configurable",get:function(){return{singleDirection:null,constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:function(e,t){},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,snapToResource:Ne.checkVersion("core","7.0",">="),copyKey:"CTRL",copyMode:"auto",mode:"move",alwaysCopy:null}}}]);var n,r,a}(uT.mixin(cT));S(JT,"$name","EventDrag"),JT._$name="EventDrag",Ug.registerFeature(JT,!0,"Scheduler"),Ug.registerFeature(JT,!1,"ResourceHistogram");var QT=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"scheduler",get:function(){return this.client}},{key:"store",get:function(){return this.client.eventStore}},{key:"project",get:function(){return this.client.project}},{key:"updateLockLayout",value:function(e){this.dragActiveCls="b-dragcreating".concat(e?" b-dragcreate-lock":"")}},{key:"handleBeforeDragCreate",value:function(e,t,n){var r,i=this,a=i.scheduler,o=e.resourceRecordLink,l=e.resourceRecord;if(i.disabled||l.readOnly||!(a.resourceStore.isAvailable(l)||o&&a.store.isAvailable(o))||!a.isDateRangeAvailable(e.mousedownDate,e.mousedownDate,null,l))return!1;var s=(!a.isSchedulerPro||t.ignoreResourceCalendar||l.isWorkingTime(e.mousedownDate))&&a.trigger("beforeDragCreate",{resourceRecord:l,date:e.mousedownDate,event:n});return i.dateConstraints=null===(r=a.getDateConstraints)||void 0===r?void 0:r.call(a,l,t),s}},{key:"dragStart",value:function(e){var n,r,i=this,a=i.client;if(null!==(n=a.project)&&void 0!==n&&null!==(n=n.stm)&&void 0!==n&&n.isNavigatingRevisions)return a.trigger("eventDragCreatePrevented",{reason:"revision"}),!1;var o=a.eventStore,l=a.assignmentStore,s=a.enableEventAnimations,u=a.enableTransactionalFeatures,c=e.resourceRecordLink,d=e.resourceRecord,h=i.createEventRecord(e),f=[d];if(h.set("duration",Pl.diff(h.startDate,h.endDate,h.durationUnit,!0)),h.isCreating=!0,h.meta.isDragCreating=!0,a.features.taskEdit&&a.features.taskEdit.doCancel(),!1===i.handleBeforeDragCreate(e,h,e.event))return!1;i.captureStm(!0);var v=[];if(d&&(v=o.usesSingleAssignment||!u?l.assignEventToResource(h,d):[l.createRecord({event:h,resource:d})]),!1===a.trigger("beforeEventAdd",{eventRecord:h,resourceRecords:f,assignmentRecords:v}))return!o.usesSingleAssignment&&u||l.remove(v),!1;i.lockLayout&&(h.meta.excludeFromLayout=!0),null===(r=a.onEventCreated)||void 0===r||r.call(a,h),a.enableEventAnimations=!1;var g=o.add(h);return this.project.commitAsync().then((function(){return a.enableEventAnimations=s})),g?(!o.usesSingleAssignment&&u&&l.add(v[0]),a.isCreating=!0,a.isHorizontal?a.rowManager.renderRows([a.getRowFor(c||d)]):a.refreshRows(),a.isCreating=!1,e.itemElement=e.element=a.getElementFromEventRecord(h),li.isInView(e.itemElement)||a.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:a.barMargin}),B(t,"dragStart",this,3)([e])):(!o.usesSingleAssignment&&u||l.remove(v),!1)}},{key:"checkValidity",value:function(e,t){var n=this,r=n.client,i=e.resourceRecord=n.dragging.resourceRecord;return r.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,i)?n.createValidatorFn.call(n.validatorFnThisObj||n,e,t):{valid:!1,message:n.L("L{EventDrag.eventOverlapsExisting}")}}},{key:"isRowEmpty",value:function(e){var t=this.store.getEventsForResource(e);return!t||!t.length}},{key:"createEventRecord",value:function(e){var t=this,n=t.client,r=n.isHorizontal?"X":"Y",i=n.timeAxis,a=n.eventStore,o=n.weekStartDay,l=e.event,s=e.mousedownDate,u=t.draggingEnd=l["page".concat(r)]>e.startEvent["page".concat(r)],c={name:a.modelClass.fieldMap.name.defaultValue||t.L("L{Object.newEvent}"),startDate:u?Pl.floor(s,i.resolution,null,o):s,endDate:u?s:Pl.ceil(s,i.resolution,null,o)};return n.project.isGanttProjectMixin&&Be.assign(c,{constraintDate:c.startDate,constraintType:"startnoearlierthan"}),a.createRecord(c)}},{key:"internalUpdateRecord",value:(i=f(L().mark((function e(n,r){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"internalUpdateRecord",this,3)([n,r]);case 2:this.client.hasEventEditor||(n.eventRecord.isCreating=!1);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"finalizeDragCreate",value:(r=f(L().mark((function e(n){var r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=n.eventRecord.meta).excludeFromLayout=!1,r.isDragCreating=!1,e.next=5,B(t,"finalizeDragCreate",this,3)([n]);case 5:if(i=e.sent){e.next=11;break}return e.next=9,this.freeStm(!0);case 9:e.next=12;break;case 11:this.hasStmCapture=!1;case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"cancelDragCreate",value:(n=f(L().mark((function e(n){var r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"cancelDragCreate",this,3)([n]);case 2:return e.next=4,this.freeStm(!1);case 4:return e.next=6,null===(r=this.afterCancel)||void 0===r?void 0:r.call(this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getTipHtml",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=B(t,"getTipHtml",this,3)(n),a=this.tip.element;return a.classList.add("b-sch-dragcreate-tooltip"),a.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),i}},{key:"onAborted",value:function(e){var t,n,r=e.eventContexts[0],i=r.eventRecord,a=r.resourceRecord;null===(t=(n=this.store).unassignEventFromResource)||void 0===t||t.call(n,i,a),this.store.remove(i)}}]);var n,r,i}(mT);S(QT,"$name","EventDragCreate"),S(QT,"configurable",{validatorFn:function(){return!0}}),QT._$name="EventDragCreate",Ug.registerFeature(QT,!0,"Scheduler"),Ug.registerFeature(QT,!1,"ResourceHistogram");var eM=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid"),e}return R(t,e),w(t,[{key:"construct",value:function(e,n){e.multiEventSelect=!0,B(t,"construct",this,3)([e,n])}},{key:"onElementMouseDown",value:function(e){var t=this,n=t.client,r=n.foregroundCanvas,i=e.target,a=e.button,o=e.touches,l=e.clientX,s=e.clientY,u=pt.from(r,!0);o||0!==a||t.disabled||!i.matches(t.targetSelector)||!1===n.trigger("beforeEventDragSelect",{event:e})||(n.preventDragSelect=!0,t.startX=l-u.x,t.startY=s-u.y,t.element||(t.element=li.createElement({className:"b-dragselect-rect",retainElement:!0})),n.foregroundCanvas.appendChild(t.element),t.element.style.transform="translate(".concat(t.startX,"px, ").concat(t.startY,"px)"),n.navigator.disabled=!0,t.mouseUpDetacher=fr.on({element:document,mouseup:"onDocumentMouseUp",thisObj:t,capture:!0}))}},{key:"eventRectangles",get:function(){var e=this.client;return Array.from(e.foregroundCanvas.children).filter((function(t){return t.matches("".concat(e.eventSelector,", .b-nested-events-container"))})).map((function(t){var n=e.resolveAssignmentRecord(t);return{rectangle:pt.from(t,!0),record:n,selected:e.selectedAssignments.includes(n)}}))}},{key:"onElementMouseMove",value:function(e){var t=this,n=t.client;if("number"==typeof t.startX){var r=t.rectangle=pt.from(t.client.foregroundCanvas,!0),i=Math.min(Math.max(e.clientX-r.x,0),r.width+1),a=Math.min(Math.max(e.clientY-r.y,0),r.height+1),o=new pt(Math.min(i,t.startX),Math.min(a,t.startY),Math.abs(i-t.startX),Math.abs(a-t.startY));li.setTranslateXY(t.element,o.x,o.y),t.element.style.width="".concat(o.width,"px"),t.element.style.height="".concat(o.height,"px"),t.dragging||(n.element.classList.add("b-dragselecting"),e.ctrlKey||e.metaKey||n.clearEventSelection(),t.originalSelection=n.selectedAssignments.slice(),t.subGridElementRect=pt.from(n.timeAxisSubGridElement,!0),n.navigator.disabled=!0,n.enableScrollingCloseToEdges(n.timeAxisSubGrid),t.dragging=!0),t.updateSelection()}}},{key:"onDocumentMouseUp",value:function(e){var t,n=this,r=n.client,i=r.selectedAssignments,a=r.navigator,o=pt.from(r.timeAxisSubGridElement);(r.disableScrollingCloseToEdges(r.timeAxisSubGrid),!n.dragging&&r.deselectAllOnScheduleClick&&r.clearEventSelection(),n.element&&(n.element.style="",n.element.remove()),r.element.classList.remove("b-dragselecting"),n.startX=n.startY=null,a.skipNextClick=o.contains(yt.from(e,!0)),a.disabled=!1,n.dragging=!1,i.length)&&(a.skipScrollIntoView=!0,r.activeAssignment=i[i.length-1],null===(t=a.activeItem)||void 0===t||t.focus(),a.skipScrollIntoView=!1);n.mouseUpDetacher(),r.trigger("afterEventDragSelect")}},{key:"updateSelection",value:function(){var e,t=this,n=t.rectangle=pt.from(t.element,!0),r=t.eventRectangles,a=t.client,o=a.selectedAssignments.reduce((function(e,t){return a.getElementFromAssignmentRecord(t)||e.push(t),e}),[]),l=D(r);try{for(l.s();!(e=l.n()).done;){var s=e.value;n.intersect(s.rectangle,!0,!0)&&!1!==a.isEventSelectable(s.record.event)&&(s.selected=!0,o.push(s.record))}}catch(e){l.e(e)}finally{l.f()}o.push.apply(o,z(t.originalSelection)),a.selectedAssignments=o;var u=a.getStartEndDatesFromRectangle(n,i,i,i,!1);a.trigger("eventDragSelect",{startDate:u.start,endDate:u.end,rectangle:n,selectedAssignments:a.selectedAssignments,selectedEvents:a.selectedEvents})}}],[{key:"pluginConfig",get:function(){return{chain:["onElementMouseDown","onElementMouseMove"]}}}])}($i(wc));S(eM,"$name","EventDragSelect"),eM._$name="EventDragSelect",Ug.registerFeature(eM,!1,"Scheduler");var tM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"revertFocus",value:function(){var e,n,r=this.owner,i=null===(e=this.focusInEvent)||void 0===e?void 0:e.relatedTarget;i&&!li.isFocusable(i)&&r.isTimelineBase&&(null===(n=r.focusedCell)||void 0===n||null===(n=n.cell)||void 0===n||n.focus());B(t,"revertFocus",this,3)([])}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)(arguments),this.initialTitle=this.title||""}},{key:"chainResourceStore",value:function(){return this.eventEditFeature.resourceStore.chain((function(e){return!e.isSpecialRow}),null,{storeClass:Ff,excludeCollapsedRecords:!1})}},{key:"processWidgetConfig",value:function(e){var n;if(null!==(n=e.type)&&void 0!==n&&n.includes("date")&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"extraItems"===e.type)return!1;var r=this.eventEditFeature,i={};if("resourceField"===e.ref){var a=e.store;e.store=this.chainResourceStore(),a&&e.store.setConfig(a),"multiSelect"in e||(e.multiSelect=!r.eventStore.usesSingleAssignment)}return"startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(i.format=r.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(i.format=r.timeFormat),Object.assign(e,i),B(t,"processWidgetConfig",this,3)([e])}},{key:"setupEditorButtons",value:function(){var e=this.record,t=this.widgetMap.deleteButton;t&&(t.hidden=this.readOnly||e.isCreating)}},{key:"onInternalBeforeShow",value:function(){this.setupUIForEditing()}},{key:"onBeforeToggleReveal",value:function(e){e.reveal&&this.setupUIForEditing()}},{key:"setupUIForEditing",value:function(){var e=this,t=e.record,n=e.titleRenderer;e.setupEditorButtons(),e.ariaLabel=e.L("L{Object.editing}",t.name),n&&(e.title=e.callback(n,e,[t]))}},{key:"onInternalKeyDown",value:function(e){this.trigger("keyDown",{event:e}),"Escape"===e.key?(e.stopImmediatePropagation(),this.eventEditFeature.onCancelClick()):B(t,"onInternalKeyDown",this,3)([e])}},{key:"close",value:function(e){var n=this.eventEditFeature;if(null!=n&&n.editingContext&&e!==n)n.onCancelClick();else if(!this.isClosing){this.isClosing=!0;try{B(t,"close",this,3)([])}finally{this.isClosing=!1}}}},{key:"updateReadOnly",value:function(e){var n=this.widgetMap,r=n.deleteButton,i=n.saveButton,a=n.cancelButton;B(t,"updateReadOnly",this,3)([e]),r&&(r.hidden=e),i&&(i.hidden=e),a&&(a.hidden=e)}}])}(fc);S(tM,"type","eventeditor"),S(tM,"$name","EventEditor"),S(tM,"configurable",{items:[],axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null,maximizeOnMobile:!0,internalListeners:{beforeShow:"onInternalBeforeShow"}}),tM.initClass(),tM._$name="EventEditor";var nM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){return[].concat(z(this.addNone?[{text:"L{None}",value:"NONE"}]:[]),[{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}])}}])}(dv);S(nM,"$name","RecurrenceFrequencyCombo"),S(nM,"type","recurrencefrequencycombo"),S(nM,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1,picker:{align:{matchSize:"min"}}}),nM.initClass(),nM._$name="RecurrenceFrequencyCombo";var rM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){return[{value:"none",text:"L{None}"}].concat(z(B(t,"buildItems",this,3)([])),[{value:this.customValue,text:"L{Custom}",cls:this.splitCls}])}},{key:"value",get:function(){return B(t,"value",this,1)},set:function(e){V(t,"value",e=e||"none",this,1,1)}},{key:"recurrence",set:function(e){var t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}},{key:"isCustomRecurrence",value:function(e){var t=e.interval,n=e.days,r=e.monthDays,i=e.months;return Boolean(t>1||n&&n.length||r&&r.length||i&&i.length)}}],[{key:"defaultConfig",get:function(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}}])}(nM);S(rM,"$name","RecurrenceCombo"),S(rM,"type","recurrencecombo"),rM.initClass(),rM._$name="RecurrenceCombo";var iM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"recurrence",get:function(){return this._recurrence},set:function(e){this._recurrence=e,this.updateLegend()}},{key:"eventStartDate",get:function(){return this._eventStartDate},set:function(e){this._eventStartDate=e,this.updateLegend()}},{key:"updateLegend",value:function(){var e=this.recurrence;this.text=e?lT.getLegend(e,this.eventStartDate):""}},{key:"onLocaleChange",value:function(){this.updateLegend()}},{key:"updateLocalization",value:function(){this.onLocaleChange(),B(t,"updateLocalization",this,3)([])}}],[{key:"defaultConfig",get:function(){return{localizableProperties:[],recurrence:null}}}])}(Nu);S(iM,"$name","RecurrenceLegendButton"),S(iM,"type","recurrencelegendbutton"),iM.initClass(),iM._$name="RecurrenceLegendButton";var aM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){var e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}},{key:"weekDays",get:function(){var e=this;if(!e._weekDays){var t=Pl.weekStartDay,n=Pl.getDayNames().map((function(e,t){return{text:e,value:MS.encodeDay(t)}}));e._weekDays=n.slice(t).concat(n.slice(0,t))}return e._weekDays}},{key:"value",get:function(){var e=B(t,"value",this,1);return e&&Array.isArray(e)&&(e=e.join(",")),e},set:function(e){e&&Array.isArray(e)&&(e=e.join(",")),e&&this.store.findRecord("value",e)||(e=this.defaultValue),V(t,"value",e,this,1,1)}}],[{key:"defaultConfig",get:function(){var e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter((function(e,t){return!Pl.nonWorkingDays[t]})).join(","),nonWorkingDaysValue:e.filter((function(e,t){return Pl.nonWorkingDays[t]})).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}}])}(dv);S(aM,"$name","RecurrenceDaysCombo"),S(aM,"type","recurrencedayscombo"),aM.initClass(),aM._$name="RecurrenceDaysCombo";var oM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateItemText",value:function(e){var t=MS.decodeDay(e.value)[0],n=Pl.getDayName(t);e.text=n.substring(0,this.dayNameLength),e.tooltip=n}},{key:"changeItems",value:function(e){var n=this;if(!0===e){var r=Pl.weekStartDay,i=Pl.getDayNames().map((function(e,t){return{text:e.substring(0,n.dayNameLength),tooltip:e,value:MS.encodeDay(t),pressedCls:n.pressedCls,dataset:{dayIndex:t}}}));e=i.slice(r).concat(i.slice(0,r)),e=B(t,"changeItems",this,3)([e])}return e}},{key:"value",get:function(){var e=B(t,"value",this,1);return e&&Array.isArray(e)&&(e=e.join(this.separator)),e},set:function(e){var n;(null===(n=e)||void 0===n?void 0:n.length)>0&&"number"==typeof e[0]&&(e=e.map((function(e){return MS.encodeDay(e)}))),e&&Array.isArray(e)&&(e=e.join(this.separator)),V(t,"value",e,this,1,1)}},{key:"valueAsDayNumbers",get:function(){return this.value?this.value.split(this.separator).map((function(e){return MS.decodeDay(e)[0]})):[]}},{key:"onLocaleChange",value:function(){this.items.forEach(this.updateItemText,this)}},{key:"updateLocalization",value:function(){this.onLocaleChange(),B(t,"updateLocalization",this,3)([])}}])}(Qv);S(oM,"$name","DayButtons"),S(oM,"type","daybuttons"),S(oM,"defaultConfig",{value:null,items:!0}),S(oM,"configurable",{pressedCls:"b-raised b-blue",dayNameLength:1,separator:",",defaults:{toggleable:!0}}),oM.initClass(),oM._$name="DayButtons";var lM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(oM);S(lM,"$name","RecurrenceDaysButtonGroup"),S(lM,"type","recurrencedaysbuttongroup"),lM.initClass(),lM._$name="RecurrenceDaysButtonGroup";var sM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"minValue",get:function(){return 1}},{key:"maxValue",get:function(){return 31}},{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.items=this.buildItems(),B(t,"construct",this,3)([e])}},{key:"buildItems",value:function(){for(var e=[],t=this.minValue;t<=this.maxValue;t++)e.push({text:t+"",value:t});return e}}])}(Qv);S(sM,"$name","RecurrenceMonthDaysButtonGroup"),S(sM,"type","recurrencemonthdaysbuttongroup"),S(sM,"configurable",{defaults:{toggleable:!0}}),sM.initClass(),sM._$name="RecurrenceMonthDaysButtonGroup";var uM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.items=this.buildItems(),B(t,"construct",this,3)([e])}},{key:"buildItems",value:function(){return Pl.getMonthNames().map((function(e,t){return{text:e.substring(0,3),value:t+1}}))}},{key:"updateItemText",value:function(e){e.text=Pl.getMonthName(e.value-1).substring(0,3)}},{key:"onLocaleChange",value:function(){this.items.forEach(this.updateItemText,this)}},{key:"updateLocalization",value:function(){this.onLocaleChange(),B(t,"updateLocalization",this,3)([])}}])}(Qv.mixin(Vf));S(uM,"$name","RecurrenceMonthsButtonGroup"),S(uM,"type","recurrencemonthsbuttongroup"),S(uM,"configurable",{defaults:{toggleable:!0}}),uM.initClass(),uM._$name="RecurrenceMonthsButtonGroup";var cM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}},{key:"value",get:function(){return B(t,"value",this,1)},set:function(e){V(t,"value",e=e||"never",this,1,1)}},{key:"recurrence",get:function(){return this._recurrence},set:function(e){var t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}])}(dv);S(cM,"$name","RecurrenceStopConditionCombo"),S(cM,"type","recurrencestopconditioncombo"),S(cM,"configurable",{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}),cM.initClass(),cM._$name="RecurrenceStopConditionCombo";var dM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildItems",value:function(){return Ff.new({fields:["value","text","cls"],data:this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])})}},{key:"buildDayNumbers",value:function(){var e=this;return $e.populate(this.maxPosition,(function(t){return{value:t+1,text:e.L("position".concat(t+1))}}))}},{key:"value",get:function(){var e=B(t,"value",this,1);return e?"".concat(e).split(",").map((function(e){return parseInt(e,10)})):[]},set:function(e){e&&Array.isArray(e)&&(e=e.join(",")),e&&this.store.findRecord("value",e)||(e=this.defaultValue),V(t,"value",e,this,1,1)}}],[{key:"defaultConfig",get:function(){return{editable:!1,splitCls:"b-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}}])}(dv);S(dM,"$name","RecurrencePositionsCombo"),S(dM,"type","recurrencepositionscombo"),dM.initClass(),dM._$name="RecurrencePositionsCombo";var hM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeItems",value:function(e,n){var r=B(t,"changeItems",this,3)([e,n]),i=this.widgetMap,a=i.positionAndDayRadioField,o=i.monthDaysNumberRadioField,l=i.monthDaysNumberField;return o?a.label=this.L("L{RecurrenceEditor.the}"):(a.label=this.L("L{RecurrenceEditor.On the}"),l&&r.remove(l)),r}},{key:"setupWidgetConfig",value:function(e){return ne.isMobile&&!("editable"in e)&&(e.editable=!1),B(t,"setupWidgetConfig",this,3)(arguments)}},{key:"updateRecord",value:function(e){B(t,"updateRecord",this,3)([e]);var n=this,r=n.widgetMap,i=r.frequencyField,a=r.daysButtonField,o=r.monthDaysButtonField,l=r.monthDaysNumberField,s=r.monthsButtonField,u=r.monthDaysRadioField,c=r.monthDaysNumberRadioField,d=r.positionAndDayRadioField,h=r.stopRecurrenceField;if(e){var f,v,g,m=e.getDateValues();if(m)null!==(f=e.days)&&void 0!==f&&f.length||(a.value=m.days),null!==(v=e.monthDays)&&void 0!==v&&v.length||(o&&(o.value=m.monthDays),l&&(l.value=m.monthDays[0])),null!==(g=e.months)&&void 0!==g&&g.length||!s||(s.value=m.months[0]);a.value&&e.positions?(d.check(),n.isPainted||u.uncheck()):null!=o&&o.value&&(c&&!c.hidden?c.check():u.check(),n.isPainted&&n.element.isConnected||d.uncheck()),h&&(h.recurrence=e)}else i.value="NONE"}},{key:"valuesCleanState",get:function(){return{frequency:null,interval:null,days:null,months:null,monthDays:null,positions:null,endDate:null,count:null}}},{key:"processValues",value:function(e){"monthDays"in e&&("string"==typeof e.monthDays?e.monthDays=e.monthDays.split(","):e.monthDays=$e.asArray(e.monthDays))}},{key:"values",get:function(){var e=F(F({},this.valuesCleanState),B(t,"values",this,1));return this.processValues(e),e},set:function(e){V(t,"values",e,this,1,1)}},{key:"getValues",value:function(){var e=F(F({},this.valuesCleanState),B(t,"getValues",this,3)(arguments));return this.processValues(e),e}},{key:"syncEventRecord",value:function(e){if(e=e||this.record){var t=this.getValues((function(t){return t.name in e&&!t.disabled}));e.set(t)}}},{key:"toggleStopFields",value:function(e){var t,n=null===(t=this.widgetMap.stopRecurrenceField)||void 0===t?void 0:t.value,r=this.widgetMap,i=r.countField,a=r.endDateField,o=r.frequencyField,l="count"===n&&"NONE"!==o.value,s=!l&&"date"===n;i._userAction=a._userAction=e,i.disabled=i.hidden=!l,a.disabled=a.hidden=!s,i._userAction=a._userAction=!1}},{key:"isWidgetAvailableForFrequency",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.widgetMap.frequencyField.value;return!e.forFrequency||e.forFrequency.includes(t)}},{key:"onFieldChange",value:function(e){e.source;var n=e.userAction,r=this.record;n&&this.autoUpdateRecord&&r&&(r.isSanitizingSuspended=!0),B(t,"onFieldChange",this,3)(arguments),n&&this.autoUpdateRecord&&r&&(r.isSanitizingSuspended=!1,this.setTimeout({fn:function(){return r.sanitize()},delay:50,cancelOutstanding:!0}))}},{key:"onFieldBeforeUpdateDisabled",value:function(e){var t=e.source;!e.disabled&&t._userAction&&t.triggerFieldChange({userAction:!0})}},{key:"onMonthDaysRadioFieldChange",value:function(e){e.source;var t=e.checked,n=e.userAction,r=e.propagatingUserActionFrom,i=this.widgetMap,a=i.monthDaysButtonField,o=i.emptyMonthsHiddenField;a&&(a._userAction=n,a.disabled=!t||!this.isWidgetAvailableForFrequency(a),a._userAction=!1),o&&(o._userAction=n||r,o.disabled=t||!this.isWidgetAvailableForFrequency(o),o._userAction=!1)}},{key:"onMonthsButtonFieldChange",value:function(e){var t=e.value,n=Pl.getMonthNames(),r=this.widgetMap.monthDaysNumberField;t&&r&&(r.hint=t.split(",").map((function(e){return n[e-1]})).join(", "))}},{key:"onMonthDaysNumberRadioFieldChange",value:function(e){var t=e.checked,n=e.userAction,r=this.widgetMap.monthDaysNumberField;r._userAction=n,r.disabled=!t||!this.isWidgetAvailableForFrequency(r),r._userAction=!1}},{key:"onPositionAndDayRadioFieldChange",value:function(e){e.source;var t=e.checked,n=e.userAction,r=this.widgetMap,i=r.daysCombo,a=r.positionsCombo;i._userAction=a._userAction=n,i.disabled=a.disabled=!t||!this.isWidgetAvailableForFrequency(i),i._userAction=a._userAction=!1}},{key:"onStopRecurrenceFieldChange",value:function(e){var t=e.userAction;this.toggleStopFields(t)}},{key:"onFrequencyFieldChange",value:function(e){var t=e.value,n=e.oldValue,r=e.valid,i=e.userAction,a=this,o=a.queryAll((function(e){return"forFrequency"in e})),l=a.widgetMap,s=l.intervalField,u=l.stopRecurrenceField,c="NONE"===t;if(r&&t){var d,h=D(o);try{for(h.s();!(d=h.n()).done;){var f=d.value;f._userAction=i,f.disabled=f.hidden=!a.isWidgetAvailableForFrequency(f,t),f._userAction=!1}}catch(e){h.e(e)}finally{h.f()}a.widgetMap.countField.hidden="NONE"===t,u&&(u.hidden=c),s&&(s.hidden=c,c||(s.hint=a.L("L{RecurrenceEditor.".concat(t,"intervalUnit}"))),"NONE"===n&&null==s.value&&(s.value=1)),a.toggleFieldsState()}}},{key:"toggleFieldsState",value:function(e){var t=this,n=t.widgetMap,r=n.monthDaysRadioField;r&&t.onMonthDaysRadioFieldChange({checked:r.checked,userAction:e}),t.onPositionAndDayRadioFieldChange({checked:n.positionAndDayRadioField.checked,userAction:e}),t.onStopRecurrenceFieldChange({userAction:e})}},{key:"updateLocalization",value:function(){var e=this.widgetMap,n=e.countField,r=e.intervalField,i=e.frequencyField;n.hint=this.L("L{RecurrenceEditor.time(s)}"),i.value&&"NONE"!==i.value&&(r.hint=this.L("L{RecurrenceEditor.".concat(i.value,"intervalUnit}"))),B(t,"updateLocalization",this,3)([])}}])}(uc);S(hM,"$name","RecurrenceEditorPanel"),S(hM,"type","recurrenceeditorpanel"),S(hM,"configurable",{focusable:!1,cls:"b-recurrenceeditor",record:!1,addNone:!1,strictRecordMapping:!0,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysLabel:{type:"label",text:"L{RecurrenceEditor.Days}",weight:18,forFrequency:"WEEKLY",cls:"b-button-group-label"},daysButtonField:{type:"daybuttons",cls:"b-recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY",useGap:!0,required:!0},emptyMonthsHiddenField:{type:"field",inputType:"hidden",name:"monthDays",forFrequency:"MONTHLY",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled",change:function(){this._value=null}}},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange",cls:"b-label-with-checkbox"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY",cls:"b-space-above",required:!0,internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},monthDaysNumberRadioField:{type:"checkbox",weight:53,cls:"b-label-with-checkbox",toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"YEARLY",label:"L{RecurrenceEditor.on}",style:"display:inline-flex;",onChange:"up.onMonthDaysNumberRadioFieldChange"},monthDaysNumberField:{type:"numberfield",weight:56,flex:1,name:"monthDays",forFrequency:"YEARLY",min:1,max:31,required:!0,internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},monthsLabel:{type:"label",text:"L{RecurrenceEditor.Months}",weight:57,forFrequency:"YEARLY",cls:"b-button-group-label"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:58,cls:"b-space-above b-space-below",name:"months",forFrequency:"YEARLY",onChange:"up.onMonthsButtonFieldChange",required:!0},positionAndDayRadioField:{type:"checkbox",weight:60,cls:"b-label-with-checkbox b-space-below",toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY",cls:"b-space-below b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",cls:"b-space-below b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange",cls:"b-no-inner-span"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" ",cls:"b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0,cls:"b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}}}}),hM.initClass(),hM._$name="RecurrenceEditorPanel";var fM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateReadOnly",value:function(e){B(t,"updateReadOnly",this,3)([e]),this.bbar.hidden=e}},{key:"recurrenceEditorPanel",get:function(){return this.widgetMap.recurrenceEditorPanel}},{key:"updateRecord",value:function(e){this.recurrenceEditorPanel.record=e}},{key:"onSaveClick",value:function(){var e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}},{key:"onCancelClick",value:function(){var e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}}],[{key:"configurable",get:function(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",items:{monthDaysNumberRadioField:!1},title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}},scrollable:{overflowY:!0}}}}])}(fc);S(fM,"$name","RecurrenceEditor"),S(fM,"type","recurrenceeditor"),fM.initClass(),fM._$name="RecurrenceEditor";var vM,gM=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeEditorConfig",value:function(e){return e.items=F(F({},e.items),this.recurringEventsItems),e=B(t,"changeEditorConfig",this,3)([e])}},{key:"doDestroy",value:function(){var e,n;null===(e=this._recurrenceConfirmation)||void 0===e||e.destroy(),null===(n=this._recurrenceEditor)||void 0===n||n.destroy(),B(t,"doDestroy",this,3)([])}},{key:"onEditorConstructed",value:function(e){var t,n=this;e.ion({hide:n.onRecurringEventEditorHide,show:n.onRecurringEventEditorShow,reveal:n.onRecurringEventEditorShow,unreveal:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&!1!==n.client.enableRecurringEvents&&n.setTimeout((function(){return n.editRecurrenceButton.menu=n.recurrenceEditor}),100),null===(t=n.recurrenceCombo)||void 0===t||t.ion({change:n.onRecurrenceComboChange,thisObj:n})}},{key:"updateReadOnly",value:function(e){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=e)}},{key:"internalShowEditor",value:function(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}},{key:"toggleRecurringFieldsVisibility",value:function(){var e,t,n,r,a=!(arguments.length>0&&arguments[0]!==i)||arguments[0]?"show":"hide";null===(e=this.editRecurrenceButton)||void 0===e||null===(t=e[a])||void 0===t||t.call(e),null===(n=this.recurrenceCombo)||void 0===n||null===(r=n[a])||void 0===r||r.call(n)}},{key:"onRecurringEventEditorShow",value:function(e){var t,n=e.source;if(this.recurrenceCombo&&null!==(t=n.record)&&void 0!==t&&t.startDate&&!n.record.isRecurring&&this.useContextualRecurrenceRules){var r=this,i=r.recurrenceCombo.store;i.modelClass.fieldMap.isCustom||i.modelClass.addField({name:"isCustom",defaultValue:!1});var a=n.record.startDate,o=a.getDate(),l=a.getDay(),s=MS.encodeDay(l),u=a.getMonth(),c=Math.ceil(o/7),d=r.L("L{RecurrenceLegend.position".concat(c,"}")),h=[{isCustom:!0,text:r.L("L{RecurrenceLegend.Weekly on {1}}",{days:Pl.getDayName(l)}),value:"WEEKLY"},{isCustom:!0,text:r.L("L{RecurrenceLegend.Monthly on {1}}",{days:Pl.format(a,"Do")}),value:"MONTHLY"},{isCustom:!0,text:r.L("L{RecurrenceLegend.Monthly on {1}}",{days:"".concat(d," ").concat(Pl.getDayName(l))}),value:"MONTHLY;BYDAY=".concat(s,";BYSETPOS=").concat(c)},{isCustom:!0,text:r.L("L{RecurrenceLegend.Yearly on {1} of {2}}",{days:Pl.format(a,"Do"),months:Pl.getMonthName(u)}),value:"YEARLY"},{isCustom:!0,text:r.L("L{RecurrenceLegend.Yearly on {1} of {2}}",{days:"".concat(d," ").concat(Pl.getDayName(l)),months:Pl.getMonthName(u)}),value:"YEARLY;BYDAY=".concat(s,";BYMONTH=").concat(u+1,";BYSETPOS=").concat(c)}];r.defaultRules=i.records.slice(),i.add(h),i.filter((function(e){return e.isCustom||"none"===e.value||"DAILY"===e.value}))}}},{key:"onRecurringEventEditorHide",value:function(){if(this.recurrenceCombo){var e=this.recurrenceCombo.store;e&&this.defaultRules&&(e.clearFilters(),e.data=this.defaultRules)}}},{key:"makeRecurrence",value:function(e){var t=this.eventRecord,n=t.copy(),r=t.recurrence;return r=!e&&r?r.copy():new t.recurrenceModel(e?{rule:e}:{}),null!=n.timeZone&&(r.timeZone=n.timeZone),r.timeSpan=n,n.setStartDate(this.values.startDate),r.suspendTimeSpanNotifying(),r}},{key:"onRecurrableEventBeforeSave",value:function(e){var t=e.eventRecord,n=e.context;this.isEditing&&!t.isCreating&&t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(this.recurrenceConfirmation.confirm({actionType:"update",eventRecord:t,changerFn:function(){n.finalize(!0)},cancelFn:function(){n.finalize(!1)}}),n.async=!0)}},{key:"changeRecurrenceConfirmation",value:function(e,t){if(e)return eD.reconfigure(this.client.recurrenceConfirmationPopup,eD.mergeConfigs({owner:this.editor},e),this)}},{key:"recurrenceEditor",get:function(){var e=this,t=e._recurrenceEditor;return t&&t.$$name||(e._recurrenceEditor=t=Lo.create(F({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,minWidth:"auto",constrainTo:r,anchor:!1,rootElement:e.rootElement,saveHandler:e.recurrenceEditorSaveHandler,thisObj:e,internalListeners:{beforeShow:e.onBeforeShowRecurrenceEditor,thisObj:e}},t)),t.readOnly=e._readOnly),t},set:function(e){this._recurrenceEditor=e}},{key:"onBeforeShowRecurrenceEditor",value:function(){var e=this,t=e.recurrenceEditor,n=e.eventRecord;t&&null!=n&&n.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}},{key:"loadRecurrenceData",value:function(e){this.recurrence=e,this.updateRecurrenceFields(e)}},{key:"updateRecurrenceFields",value:function(e){var t=this,n=t.editRecurrenceButton;t.recurrenceCombo&&!t.processingRecurrenceComboChange&&(t.recurrenceCombo.recurrence=e),n&&(n.recurrence=e,n.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?n.show():n.hide())}},{key:"onRecurrenceComboChange",value:function(e){var t=e.source,n=e.value;if(e.userAction){var r=this,i=r.recurrenceEditor;n===t.customValue?(r.recurrenceCombo.recurrence=r.makeRecurrence(),i.centered?i.show():i.show((r.editRecurrenceButton||t).element)):(r.processingRecurrenceComboChange=!0,r.loadRecurrenceData(n&&"none"!==n?r.makeRecurrence("FREQ=".concat(n)):null),r.processingRecurrenceComboChange=!1)}}},{key:"recurrenceEditorSaveHandler",value:function(e,t){e.recurrenceEditorPanel.syncEventRecord(t);var n=this.recurrenceCombo.store;n.clearFilters(),n.remove(n.query((function(e){return e.isCustom}))),this.updateRecurrenceFields(t),e.close()}},{key:"onDatesChange",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(B(t,"onDatesChange",this,3)(n),!this.loadingRecord&&this.editRecurrenceButton){var i=this.values.startDate;i&&(this.editRecurrenceButton.eventStartDate=i)}}},{key:"internalLoadRecord",value:function(e){null!=e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}},{key:"updateRecord",value:function(e){return e.recurrenceRule&&!this.recurrence&&(e.recurrenceRule=null),B(t,"updateRecord",this,3)([e])}}])}(e||Mn),S(t,"$name","RecurringEventEdit"),S(t,"configurable",{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},recurrenceConfirmation:{$config:"lazy",value:{type:"recurrenceconfirmation"}},showRecurringUI:null,useContextualRecurrenceRules:!0}),t},mM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeShowEventColor",value:function(e){return Boolean(e)}},{key:"updateShowEventColor",value:function(e){var t;this.element.classList.toggle("b-show-event-color",Boolean(e)),null===(t=this._picker)||void 0===t||t.element.classList.toggle("b-show-event-color",Boolean(e))}},{key:"changePicker",value:function(e,n){var r;return null===(r=e=B(t,"changePicker",this,3)([e,n]))||void 0===r||r.element.classList.toggle("b-show-event-color",Boolean(this.showEventColor)),e}},{key:"innerElements",get:function(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}},{key:"syncInputFieldValue",value:function(){var e,n,r=this,i=r.resourceIcon,a=r.lastResourceIconCls,o=i.classList,l=null!==(e=null===(n=r.selected)||void 0===n?void 0:n.eventColor)&&void 0!==e?e:"";B(t,"syncInputFieldValue",this,3)([]),i.style.color="",a&&o.remove(a),r.lastResourceIconCls=null,l?(li.isNamedColor(l)?(r.lastResourceIconCls="b-sch-foreground-".concat(l),o.add(r.lastResourceIconCls)):i.style.color=l,o.remove("b-hide-display")):o.add("b-hide-display")}}],[{key:"configurable",get:function(){return{showEventColor:null,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl:function(e){if(this.owner.showEventColor){var t=e.eventColor,n=!li.isNamedColor(t),r=t?n?' style="color:'.concat(t,'"'):"":' style="display:none"',i=!t||n?"":" b-sch-foreground-".concat(t);return'<div aria-hidden="true" class="b-icon b-icon-square'.concat(i,'"').concat(r,"></div>")}return this.multiSelect?'<div aria-hidden="true" class="b-icon b-icon-square"></div>':""}}}}}])}(dv);S(mM,"$name","ResourceCombo"),S(mM,"type","resourcecombo"),mM.initClass(),mM._$name="ResourceCombo";var pM=/[^\w\d]/g,yM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){this.readOnly=e.readOnly,B(t,"construct",this,3)([e,n]),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}},{key:"scheduler",get:function(){return this.client}},{key:"project",get:function(){return this.client.project}},{key:"onClientReadOnlyToggle",value:function(e){var t=e.readOnly;this.readOnly=t,this._editor&&(this.editor.readOnly=t)}},{key:"editor",get:function(){var e,t,n,r,i,a=this,o={beforeHide:"resetEditingContext",beforeShow:"onBeforeEditorShow",keyDown:"onPopupKeyDown",thisObj:a},l=a._editor;if(l)return l;var s=(l=a._editor=Lo.create(a.getEditorConfig())).widgetMap,u=s.startDateField,c=s.startTimeField,d=s.endDateField,h=s.endTimeField;return!u&&c&&(c.label=a.L("L{Start}"),c.flex="1 0 100%"),!d&&h&&(h.label=a.L("L{End}"),h.flex="1 0 100%"),l.floating||l.positioned||(Ne.deprecate("scheduler","7.0.0",'"editorConfig" with "appendTo" deprecated in favor of "drawer : true" config'),l.element.parentNode||a.client.add(l),delete o.beforeHide,delete o.beforeShow,o.beforeToggleReveal="onBeforeEditorToggleReveal"),l.readOnly=a.readOnly,0===l.items.length&&console.warn("Event Editor configured without any `items`"),l.ion(o),a.scheduler.relayEvents(l,["beforeSetRecord"],"eventEdit"),Object.values(l.widgetMap).forEach((function(e){var t=e.ref||e.id;if(t&&!a[t])switch(a[t]=e,e.name){case"startDate":case"endDate":e.ion({change:"onDatesChange",thisObj:a})}})),null===(e=a.onEditorConstructed)||void 0===e||e.call(a,l),null===(t=a.eventTypeField)||void 0===t||t.ion({change:"onEventTypeChange",thisObj:a}),null===(n=a.saveButton)||void 0===n||n.ion({click:"onSaveClick",thisObj:a}),null===(r=a.deleteButton)||void 0===r||r.ion({click:"onDeleteClick",thisObj:a}),null===(i=a.cancelButton)||void 0===i||i.ion({click:"onCancelClick",thisObj:a}),l}},{key:"getEditorConfig",value:function(){var e=this,t=e.cls,n=e.scheduler,i=Be.assign({owner:n,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:"".concat(n.id,"-event-editor"),autoShow:!1,anchor:!0,scrollAction:e.editorConfig.autoUpdateRecord?null:"realign",constrainTo:r,cls:t},e.editorConfig);return Lo.prototype.getRenderContext(i)[0]&&(i.floating=!1),!1!==i.floating||i.positioned||(i.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},i.collapsed=!0,i.hidden=i.anchor=!1,i.hide=function(){this.collapsible.toggleReveal(!1)}),!n.showEventColorPickers&&i.items.colorField&&(i.items.colorField.hidden=!0),i.onElementCreated=e.updateCSSVars.bind(this),i}},{key:"updateCSSVars",value:function(e){var t=e.element,n=new Date(2e3,12,31,23,55,55),r=Pl.format(n,this.dateFormat).replace(pM,"").length,i=Pl.format(n,this.timeFormat).replace(pM,"").length,a=r+i;t.style.setProperty("--date-time-length","".concat(a,"em")),t.style.setProperty("--date-width-difference","".concat((r-i)/2,"em"))}},{key:"internalShowEditor",value:(s=f((function(e,n){var r=this,a=arguments.length>2&&arguments[2]!==i?arguments[2]:null;return L().mark((function i(o){var l,s,u,c,d,h,f,v,g;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=(l=r).scheduler,u=l.editor,c=s.useInitialAnimation,d=(null===(o=a)||void 0===o||null===(o=o.target)||void 0===o?void 0:o.nodeType)===Element.ELEMENT_NODE?a.target:s.getElementFromEventRecord(e,n),h=e.isPartOfStore(s.eventStore),!(a=null!=a?a:{target:d,anchor:!0}).target&&h&&0!==e.resources.length&&!e.isCreating){i.next=22;break}if(s.element.classList.add("b-eventeditor-editing"),l.resourceRecord=n,l.editingContext={eventEdit:l,eventRecord:e,resourceRecord:n,eventElement:d,editor:u,isPartOfStore:h},null===(f=B(t,"internalShowEditor",r,3))||void 0===f||f([e,n,a]),l.typeField&&l.toggleEventType(e.getValue(l.typeField)),l.loadRecord(e,n),u.readOnly=l.readOnly||e.readOnly||s.readOnly,u.title=u.readOnly?l.L("L{Object.information}"):u.initialTitle,!u.collapsed){i.next=17;break}return i.next=14,u.collapsible.toggleReveal(!0);case 14:u.focus(),i.next=18;break;case 17:!u.centered&&u.anchor&&u.floating?!d||e.isCreating&&c&&!0!==c&&"fade-in"!==c?(u.show(),u.updateCentered(!0)):(l.targetEventElement=d,u.showBy(a)):u.show();case 18:"hour"!==(v=s.timeAxisViewModel.timeResolution).unit&&"minute"!==v.unit||(g="".concat(v.increment).concat(v.unit),l.startTimeField&&(l.startTimeField.step=g),l.endTimeField&&(l.endTimeField.step=g)),l.detachListeners("changesWhileEditing"),s.eventStore.ion({change:l.onChangeWhileEditing,refresh:l.onChangeWhileEditing,thisObj:l,name:"changesWhileEditing"});case 22:case"end":return i.stop()}}),i)}))()})),function(e,t){return s.apply(this,arguments)})},{key:"onChangeWhileEditing",value:function(){var e=this;e.editor.autoUpdateRecord||e.isFinalizingEventSave||!e.isEditing||!e.editingContext.isPartOfStore||e.eventRecord.isPartOfStore(e.scheduler.eventStore)||e.onCancelClick()}},{key:"onBeforeEditorShow",value:function(){B(t,"onBeforeEditorShow",this,3)(arguments),this.scheduler.trigger("beforeEventEditShow",F({},this.editingContext))}},{key:"updateTargetEventElement",value:function(e,t){null==e||e.classList.add("b-editing"),null==t||t.classList.remove("b-editing")}},{key:"editEvent",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:null,a=arguments.length>3&&arguments[3]!==i?arguments[3]:null,o=this,l=o.client,s=l.eventStore,u=l.assignmentStore,c=l.enableEventAnimations,d=l.features.simpleEventEdit;e.isModel||(e=s.createRecord(e));var h=!e.isOccurrence&&!s.$master.includes(e);if(h){var f=[];e.isCreating=!0;var v=[];if(t&&!u.includesAssignment(e.id,t.id)&&(f.push(t),v=u.assignEventToResource(e,t)),!1===l.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:f,assignmentRecords:v}))return null==u||u.remove(v),e.isCreating=!1,!1}if(o.isEditing&&o.resetEditingContext(),!(o.disabled||e.isCreating&&null!=d&&d.enabled)){if(!1===l.trigger("beforeEventEdit",{eventEdit:o,eventRecord:e,resourceRecord:t,eventElement:(null===(n=l.getElementFromEventRecord)||void 0===n?void 0:n.call(l,e,t))||r}))return l.element.classList.remove("b-eventeditor-editing"),l.isCalendar&&(e.isCreating=!1),!1;var g;if(a?o.applyStmCapture(a):!1===a||l.isCalendar||o.hasStmCapture||o.captureStm(!0),l.refreshRows)if(h&&(o.enableEventAnimations=!1,s.$master.add(e),l.project.commitAsync().then((function(){return l.enableEventAnimations=c})),l.refreshRows()),e.isCreating)null===(g=l.getElementFromEventRecord)||void 0===g||null===(g=g.call(l,e,t,!0))||void 0===g||g.focus({preventScroll:!0});return o.doEditEvent(e,t,r,a).then((function(e){if(!(o.isDestroying||o.isEditing||l.isCalendar||o.rejectingStmTransaction))return!1!==e&&o.hasStmCapture?o.freeStm(!1):o.freeStm()}))}}},{key:"isEditing",get:function(){var e=this._editor;return Boolean((null==e?void 0:e.isVisible)&&!(e.collapsed&&!e.revealed))}},{key:"doEditEvent",value:(l=f((function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i?arguments[2]:null;return L().mark((function i(){var a,o,l,s;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=(a=n).scheduler,l=e.isCreating,t||(t=e.resource||a.resourceStore.getById(e.resourceId)),l&&Bw.prototype.normalize.call(e),!r&&!l&&0!==e.resources.length){i.next=7;break}return i.abrupt("return",a.internalShowEditor(e,t,r?{target:r}:null));case 7:return s=o.isVertical?"maxHeight":"maxWidth",i.next=10,o.scrollResourceEventIntoView(t,e,S(S(S(S({},s,a.minEditSize),"animate",!0),"edgeOffset",0),"extendTimeAxis",!1));case 10:if(o.isDestroyed){i.next=14;break}return i.next=13,a.internalShowEditor(e,t);case 13:o.isDestroyed||o.element.classList.remove("b-eventeditor-editing");case 14:case"end":return i.stop()}}),i)}))()})),function(e,t){return l.apply(this,arguments)})},{key:"loadRecord",value:function(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}},{key:"eventRecord",get:function(){var e;return null===(e=this._editor)||void 0===e?void 0:e.record}},{key:"internalLoadRecord",value:function(e,n){var r,i=this,a=i.client.eventStore,o=i.editor,l=i.resourceField,s=o.widgetMap.endTimeField;if(i.resourceRecord=n,l&&(null===(r=l.store)||void 0===r?void 0:r.masterStore)!==i.resourceStore&&(l.store=o.chainResourceStore()),s&&(s.min=null),o.record=e,l){var u=a.assignmentStore.getResourcesForEvent(e);o.assigningValues=!0,e.isOccurrence||a.storage.includes(e,!0)||!n?i.assignmentStore&&(i.resourceField.value=u.map((function(e){return e.getValue(i.resourceField.valueField)}))):i.resourceField.value=n.getValue(i.resourceField.valueField),o.assigningValues=!1}B(t,"internalLoadRecord",this,3)([e,n])}},{key:"toggleEventType",value:function(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((function(t){var n;(null===(n=t.dataset)||void 0===n?void 0:n.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}},{key:"finalizeEventSave",value:(o=f(L().mark((function e(t,n,r,i){var a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(a=this).scheduler,l=a.assignmentStore,s=!1,l.suspendAutoCommit(),o.suspendRefresh(),a.onBeforeSave(t),t.beginBatch(),a.updateRecord(t),t.endBatch(),t.isOccurrence?n&&t.set("resourceRecords",n):a.resourceField&&l.assignEventToResource(t,n,null,!0),t.isCreating=!1,s){e.next=13;break}return e.next=13,o.project.commitAsync();case 13:l.resumeAutoCommit(),o.resumeRefresh(!0),s||(o.trigger("afterEventSave",{eventRecord:t}),a.onAfterSave(t)),r(!s&&t);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"save",value:function(){var e=this;return new Promise((function(t,n){var r,i=e,a=i.scheduler,o=i.eventRecord;if(o&&i.editor.isValid){var l=i.eventStore,s=i.values,u=(null===(r=i.resourceField)||void 0===r?void 0:r.records)||(i.resourceRecord?[i.resourceRecord]:[]);if(l&&a.isDateRangeAvailable){var c=s.startDate,d=s.endDate;if(d||(d="duration"in s?Pl.add(c,s.duration,s.durationUnit||o.durationUnit):"fullDuration"in s?Pl.add(c,s.fullDuration):o.endDate),!a.isDateRangeAvailable(c,d,o,u)){var h=e.editor.widgetMap.startDateField;return h&&(h.setError(i.L("L{EventDrag.eventOverlapsExisting}"),!1,!0),h.focus()),void t(!1)}}var f={finalize:function(e){try{!1!==e?i.finalizeEventSave(o,u,t,n):t(!1)}catch(e){n(e)}}},v=a.trigger("beforeEventSave",{eventRecord:o,resourceRecords:u,values:s,context:f});Be.isPromise(v)?v.then((function(e){return g(e,o,f)})):g(v,o,f)}else t(!1);function g(e,n,r){!1===e?t(!1):(i.onRecurrableEventBeforeSave({eventRecord:n,context:r}),r.async||r.finalize())}}))}},{key:"deleteEvent",value:(a=f(L().mark((function e(){var t,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.editor,n=t.autoClose,this.detachListeners("changesWhileEditing"),e.next=4,this.scheduler.removeEvents([this.eventRecord],this.client.isScheduler?function(e){e&&t.containsFocus&&(t.autoClose=!1,t.revertFocus(),t.autoClose=n)}:null,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"onChangeProject",value:function(){this.resourceField&&(this.resourceField.store={})}},{key:"eventStore",get:function(){return this.scheduler.project.eventStore}},{key:"resourceStore",get:function(){return this.scheduler.project.resourceStore}},{key:"assignmentStore",get:function(){return this.scheduler.project.assignmentStore}},{key:"onActivateEditor",value:function(e){var t,n=e.eventRecord,r=e.resourceRecord,i=e.eventElement,a=e.domEvent,o=this.ignoreSelector;o&&null!==(t=a.target)&&void 0!==t&&t.closest(o)||this.editEvent(n,r,i)}},{key:"onDragCreateEnd",value:function(e){var t=e.eventRecord,n=e.resourceRecord,r=e.proxyElement,i=e.stmCapture;this.editEvent(t,n,r,i)}},{key:"onEventEnterKey",value:function(e){var t=e.assignmentRecord,n=e.eventRecord,r=e.target,i=this.client,a=r[r.matches(i.eventSelector)?"querySelector":"closest"](i.eventInnerSelector);t?this.editEvent(n,t.resource,a):n&&this.editEvent(n,n.resource,a)}},{key:"onEventTypeChange",value:function(e){var t=e.value;this.toggleEventType(t)}},{key:"populateEventMenu",value:function(e){var t=e.eventRecord,n=e.resourceRecord,r=e.items,i=this,a=!(i.readOnly||i.scheduler.readOnly||t.readOnly||i.disabled);r.editEvent={text:"L{EventEdit.Edit event}",localeClass:i,icon:"b-icon b-icon-edit",weight:100,hidden:!a,onItem:function(){return i.editEvent(t,n)}},r.showDetails={text:"L{Object.showDetails}",localeClass:i,icon:"b-icon b-icon-show-details",weight:100,hidden:a,onItem:function(){return i.editEvent(t,n)}}}},{key:"onBeforeEditorToggleReveal",value:function(e){var t=e.reveal;t&&this.editor.setupEditorButtons(),this[t?"onBeforeEditorShow":"resetEditingContext"]()}},{key:"resetEditingContext",value:(n=f(L().mark((function e(){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this).detachListeners("changesWhileEditing"),B(t,"resetEditingContext",this,3)([]),!n.hasStmCapture||n.isDeletingEvent||n.isCancelingEdit){e.next=6;break}return e.next=6,n.freeStm(!1);case 6:n.resourceRecord=null;case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"finalizeStmCapture",value:function(e){return this.freeStm(!e)}},{key:"updateLocalization",value:function(){this._editor&&this.updateCSSVars({element:this._editor.element}),B(t,"updateLocalization",this,3)(arguments)}}],[{key:"pluginConfig",get:function(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}}]);var n,a,o,l,s}(wT.mixin(fT,gM,$i));vM=yM,S(yM,"$name","EventEdit"),S(yM,"configurable",{triggerEvent:"eventdblclick",ignoreSelector:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:vM,defaults:{localeClass:vM},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"timefield",clearable:!1,required:!0,ariaLabel:"L{startTime}",name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"timefield",clearable:!1,required:!0,ariaLabel:"L{endTime}",name:"endDate",cls:"b-match-label",weight:600},colorField:{label:"L{SchedulerBase.color}",type:"eventColorField",name:"eventColor",weight:700}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:vM},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null,minEditSize:100}),yM._$name="EventEdit",Ug.registerFeature(yM,!0,"Scheduler"),Ug.registerFeature(yM,!1,["SchedulerPro","ResourceHistogram"]),yM.initClass();var kM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"populateTimeAxisHeaderMenu",value:function(e){var t=e.items,n=this;t.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:n.disabled,localeClass:n,weight:100,menu:{localeClass:n,cls:"b-eventfilter-menu",items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:n,width:200,internalListeners:{change:n.onEventFilterChange,thisObj:n}}},onBeforeShow:function(e){var t=_(e.source.items,1)[0],r=n.store.filters.getBy("property","name");t.value=(null==r?void 0:r.value)||""}}}}},{key:"onEventFilterChange",value:function(e){var t=e.value;""!==t?this.store.filter("name",t):this.store.removeFilter("name")}},{key:"store",get:function(){var e=this.client;return e.isGanttBase?e.store:e.eventStore}}],[{key:"pluginConfig",get:function(){return{chain:["populateTimeAxisHeaderMenu"]}}}])}(wc);S(kM,"$name","EventFilter"),kM.featureClass="b-event-filter",kM._$name="EventFilter",Ug.registerFeature(kM,!0,["Scheduler","Gantt"]),Ug.registerFeature(kM,!1,"ResourceHistogram");var bM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"resourceStore",get:function(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}},{key:"getDataFromEvent",value:function(e){var n,r=B(t,"getDataFromEvent",this,3)([e]),i=r.targetElement,a=this.client,o=a.resolveEventRecord(i),l=o&&(null===(n=a.resolveResourceRecord(i)||this.resourceStore.last)||void 0===n?void 0:n.$original),s=o&&a.resolveAssignmentRecord(i);return Object.assign(r,{date:a.getDateFromXY([e.pageX,e.pageY],null,!1),eventElement:i,eventRecord:o,resourceRecord:l,assignmentRecord:s})}},{key:"getTargetElementFromEvent",value:function(e){var t=e.target;return t.closest(this.client.eventSelector)||t}},{key:"shouldShowMenu",value:function(e){return e.eventRecord}},{key:"showContextMenuFor",value:function(e){var t=(arguments.length>1&&arguments[1]!==i?arguments[1]:{}).targetElement;this.disabled||(t||(t=this.getElementFromRecord(e)))&&li.triggerMouseEvent(t,this.triggerEvent)}},{key:"getElementFromRecord",value:function(e){return this.client.getElementsFromEventRecord(e)[0]}},{key:"populateEventMenu",value:function(e){var t=e.items,n=e.eventRecord,r=e.assignmentRecord,i=this.client;t.deleteEvent={disabled:n.readOnly||(null==r?void 0:r.readOnly),hidden:i.readOnly},t.unassignEvent={disabled:n.readOnly||(null==r?void 0:r.readOnly),hidden:i.readOnly||i.eventStore.usesSingleAssignment},i.showEventColorPickers||i.showTaskColorPickers?t.eventColor={disabled:n.readOnly,hidden:i.readOnly}:t.eventColor={hidden:!0}}},{key:"populateItemsWithData",value:function(e){var n,r=e.items,i=e.eventRecord;B(t,"populateItemsWithData",this,3)(arguments);var a,o=this.client;(o.showEventColorPickers||o.isSchedulerPro&&o.showTaskColorPickers)&&null!==(n=r.eventColor)&&void 0!==n&&n.menu&&pe.merge(r.eventColor.menu.colorMenu,{value:i.eventColor,records:null!==(a=o.selectedRecords)&&void 0!==a?a:[i]})}},{key:"changeItems",value:function(e){var t=this.client;return pe.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",cls:"b-separator",weight:500,onItem:function(e){var n,r=e.menu,i=e.eventRecord,a=null===(n=r.focusInEvent)||void 0===n?void 0:n.relatedTarget;a&&(a.focus(),t.navigator.activeItem=a),t.removeEvents(t.isEventSelected(i)?t.selectedEvents:[i])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem:function(e){var n,r=e.menu,i=e.eventRecord,a=e.resourceRecord,o=e.assignmentRecord,l=null===(n=r.focusInEvent)||void 0===n?void 0:n.relatedTarget;l&&(l.focus(),t.navigator.activeItem=l),t.isAssignmentSelected(o)?t.assignmentStore.remove(t.selectedAssignments):i.unassign(a)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},e)}}],[{key:"configurable",get:function(){return{processItems:null,type:"event"}}},{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateEventMenu"),e}}])}(ST);S(bM,"$name","EventMenu"),bM.featureClass="",bM._$name="EventMenu",Ug.registerFeature(bM,!0,"Scheduler"),Ug.registerFeature(bM,!1,"ResourceHistogram");var CM,wM=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getNonWorkingTimeRanges",value:function(e,t,n){var r=n.getTime()-t.getTime()+864e5;if(!e.getNonWorkingTimeRanges){var i=[];return e.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0,maxRange:r},(function(e,t,n){var r,a=D(n.intervalGroups);try{for(a.s();!(r=a.n()).done;){var o=_(r.value,2),l=o[0];o[1].getIsWorking()||i.push({name:l.name,iconCls:l.iconCls,cls:l.cls,type:l.type,startDate:e,endDate:t})}}catch(e){a.e(e)}finally{a.f()}})),i}return e.getNonWorkingTimeRanges(t,n,r)}},{key:"getCalendarTimeRanges",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this,r=n.client,a=r.timeAxis,o=r.fillTicks,l=a.unit,s=a.increment,u=!n.maxTimeAxisUnit||Pl.compareUnits(l,n.maxTimeAxisUnit)<=0;if(e&&u&&a.count){var c,d=[],h=null,f=D(n.getNonWorkingTimeRanges(e,a.startDate,a.endDate).map((function(e){return new Bw({name:"Week"!==e.type?e.name:"",cls:"b-nonworkingtime ".concat(e.cls||""),startDate:e.startDate,endDate:e.endDate})})));try{for(f.s();!(c=f.n()).done;){var v=c.value;h&&v.startDate<=h.endDate&&(t||v.name===h.name)&&v.duration>0?h.endDate=v.endDate:(d.push(v),v.setData("id","nonworking-".concat(d.length)),h=v)}}catch(e){f.e(e)}finally{f.f()}return o&&(d=d.filter((function(e){return Pl.ceil(e.startDate,{magnitude:s,unit:l})<Pl.floor(e.endDate,{magnitude:s,unit:l})}))).forEach((function(e){return e.setStartEndDate(Pl.ceil(e.startDate,{magnitude:s,unit:l}),Pl.floor(e.endDate,{magnitude:s,unit:l}))})),d}return[]}},{key:"setupDefaultCalendar",value:function(){var e=this.project;this.autoGeneratedWeekends||!e.isSchedulerCoreProjectMixin||e.effectiveCalendar!==e.defaultCalendar||e.defaultCalendar.intervalStore.count||(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}},{key:"updateDefaultCalendar",value:function(){if(this.autoGeneratedWeekends){var e=this.client.project.effectiveCalendar,t=this.defaultNonWorkingIntervals,n=Boolean(t.length);e.ignoreTimeZone=!0,e.clearIntervals(n),n&&e.addIntervals(t)}}},{key:"updateLocalization",value:function(){var e;null===(e=B(t,"updateLocalization",this,3))||void 0===e||e([]),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}},{key:"defaultNonWorkingIntervals",get:function(){var e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return Pl.nonWorkingDaysAsArray.map((function(t){return{recurrentStartDate:"on ".concat(e[t]," at 0:00"),recurrentEndDate:"on ".concat(e[(t+1)%7]," at 0:00"),isWorking:!1}}))}}])}(e),S(t,"$name","NonWorkingTimeMixin"),S(t,"configurable",{maxTimeAxisUnit:"week"}),t},DM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDisable",value:function(e){this.client.refresh(),B(t,"doDisable",this,3)([e])}},{key:"attachToCalendarManagerStore",value:function(e){B(t,"attachToCalendarManagerStore",this,3)([e]);var n=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:n}),n.client.isScheduler&&n.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:n}),n.setupDefaultCalendar()}},{key:"onCalendarChange",value:function(){this.calendarRangeCache.clear()}},{key:"onTimeAxisViewModelUpdate",value:function(){this.calendarRangeCache.clear()}},{key:"getRangeDomConfig",value:function(e,t,n,r){var i=this.client,a=i.getVirtualCoordFromDate(Pl.max(e.startDate,t))-r,o=e.endDate?i.getVirtualCoordFromDate(Pl.min(e.endDate,n))-r:a,l=Math.abs(o-a),s=i.isVertical?"insetBlockStart":"insetInlineStart",u=i.isVertical?"height":"width";return{className:S(S({"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1},e.cls,e.cls),"b-rtl",i.rtl),dataset:{id:e.id},elementData:{timeRange:e},style:S(S({},s,a),u,l>0?l:null)}}},{key:"getCalendarTimeRanges",value:function(e){var n=this.calendarRangeCache.get(e);return n||(n=B(t,"getCalendarTimeRanges",this,3)([e,!0]),this.calendarRangeCache.set(e,n)),n}},{key:"onEventDataGenerated",value:function(e){var t=e.eventRecord,n=e.startMS,r=e.endMS,i=e.start,a=e.end,o=e.left,l=e.top,s=e.children,u=e.bufferBeforeWidth;if(this.enabled){var c,d=this.client.isVertical,h=null!==(c=t.effectiveCalendarsCombination)&&void 0!==c?c:this.client.project.calendar,f=d?l:o;u&&(f+=u);var v,g=D(this.getCalendarTimeRanges(h));try{for(g.s();!(v=g.n()).done;){var m=v.value;if(m.startDateMS<r&&m.endDateMS>n){var p=this.getRangeDomConfig(m,i,a,f);s.push(p)}}}catch(e){g.e(e)}finally{g.f()}}}}],[{key:"pluginConfig",get:function(){return{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}}},{key:"properties",get:function(){return{calendarRangeCache:new a}}}])}(wc.mixin(DR,wM));S(DM,"$name","EventNonWorkingTime"),DM._$name="EventNonWorkingTime",Ug.registerFeature(DM,!1,"Scheduler");var SM=[0,0],xM=[null,[0,10],[10,0]],EM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),"string"==typeof this.align&&(this.align={align:this.align})}},{key:"resolveData",value:function(e,n){var r=this.client,i=B(t,"resolveData",this,3)([e,n]);return i&&F(F({},i),{},{resourceRecord:r.resolveResourceRecord(n),assignmentRecord:r.resolveAssignmentRecord(n)})}},{key:"onInternalPaint",value:function(e){var n=e.firstPaint;if(B(t,"onInternalPaint",this,3)(arguments),n){var r=this.client.features.dependencies;r&&this.tooltip.ion({beforeAlign:function(e){var t=e.source,n=e.offset,i=void 0===n?SM:n,a=vt(t.align.align).edgeAligned,o=r.disabled||!r.allowCreate?SM:xM[a];arguments[0].offset=[i[0]+o[0],i[1]+o[1]]}})}}}],[{key:"defaultConfig",get:function(){return{template:function(e){return"\n                ".concat(e.eventRecord.name?Le.xss(CM||(CM=N(['<div class="b-sch-event-title">',"</div>"])),e.eventRecord.name):"","\n                ").concat(e.startClockHtml,"\n                ").concat(e.endClockHtml)},cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}}])}(RT);S(EM,"$name","EventTooltip"),EM._$name="EventTooltip",Ug.registerFeature(EM,!0,"Scheduler"),Ug.registerFeature(EM,!1,"ResourceHistogram");var RM={update:1,filter:1},TM={add:1,remove:1,update:1,removeAll:1,filter:1},MM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");r.scheduler=e,B(t,"construct",this,3)([e,n]),!r.summaries&&r.renderer&&(r.summaries=[{renderer:r.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:r.onEventStoreChange,thisObj:r}),e.assignmentStore.ion({changePreCommit:r.onAssignmentStoreChange,thisObj:r}),e.ion({timeAxisViewModelUpdate:r.onTimeAxisChange,thisObj:r}),e.project.ion({dataReady:r.onProjectDataReady,thisObj:r}))}},{key:"doDestroy",value:function(){var e;null===(e=this._tip)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"onTimeAxisChange",value:function(){this.scheduler.rowManager.forEach((function(e){e.isGroupFooter&&e.render()}))}},{key:"onEventStoreChange",value:function(e){var t=e.action,n=e.records;if(e.changes,RM[t]){var r=new o;n.forEach((function(e){return e.resources.forEach((function(e){return r.add(e)}))})),this.afterChange(r)}}},{key:"onAssignmentStoreChange",value:function(e){var t=e.action,n=e.records,r=e.changes;if(TM[t]){var i,a=new o;if(n.forEach((function(e){return e.resource&&a.add(e.resource)})),null!=(null==r||null===(i=r.resourceId)||void 0===i?void 0:i.oldValue)){var l=this.scheduler.resourceStore.getById(r.resourceId.oldValue);l&&a.add(l)}this.afterChange(a)}}},{key:"afterChange",value:function(e){var t,n=this.scheduler.resourceStore,r=D(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if("header"===this.target)for(;i&&!i.isGroupHeader;)i=n.getPrev(i);else for(;i&&!i.isGroupFooter;)i=n.getNext(i);var a=this.scheduler.rowManager.getRowFor(i);i&&a&&this.footersToUpdate.add(a)}}catch(e){r.e(e)}finally{r.f()}}},{key:"onProjectDataReady",value:function(){var e=this.footersToUpdate,t=this.client;if(t.isVisible){if(e.size){var n,r=D(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value;null===(i=a.render)||void 0===i||i.call(a)}}catch(e){r.e(e)}finally{r.f()}e.clear()}}else t.whenVisible("refresh",t,[!0])}},{key:"onBeforeRenderRow",value:function(e){var n=e.row,r=e.record;if(n.isGroupFooter&&!r.meta.hasOwnProperty("groupFooterFor")){var i=n.elements.normal.querySelector(".b-sch-timeaxis-cell");i&&(i.innerHTML="")}B(t,"onBeforeRenderRow",this,3)(arguments)}},{key:"generateHtml",value:function(e,n,r,i,a,o){if("timeAxis"===e.type){var l=this,s=l.scheduler,u=s.eventStore,c=s.timeAxisViewModel.columnConfig,d="",h=s.getResourcesEventsPerTick(n,(function(e){var t=e.event;return t.resources.some((function(e){return n.includes(e)}))&&(!u.isFiltered||u.records.includes(t))}));return s.timeAxis.forEach((function(e,t){var r=h[t]||[],f=l.summaries.map((function(t){var l,c,d=null!==(l=null===(c=t.renderer)||void 0===c?void 0:c.call(t,{startDate:e.startDate,endDate:e.endDate,resourceStore:s.resourceStore,events:r,resources:n,eventStore:u,groupRecord:i,groupField:a,groupValue:o}))&&void 0!==l?l:"";return'<div class="b-timeaxis-summary-value">'.concat(d,"</div>")})).join("");d+='<div class="b-timeaxis-tick" style="width: '.concat(c[c.length-1][t].width,'px">').concat(f,"</div>")})),'<div class="b-timeaxis-group-summary">'.concat(d,"</div>")}return B(t,"generateHtml",this,3)([e,n,r])}},{key:"updateSummaryHtml",value:function(e,n,r){var i=B(t,"updateSummaryHtml",this,3)([e,n,r]);if("timeAxis"===n.type){var a={count:0,height:0};return this.summaries.forEach((function(e){e.height?a.height+=e.height:a.count++})),a}return i}},{key:"getTipHtml",value:function(e){var t,n=e.activeTarget,r=this,i=r.client,a=[],o=Array.from(n.parentElement.children).indexOf(n),l=i.timeAxis.getAt(o),s=i.getRecordFromElement(n),u=s.isGroupFooter?s.meta.groupRecord:s,c=i.eventStore,d=u.groupChildren,h=i.getResourcesEventsPerTick(d,(function(e){var t=e.event;return t.resources.some((function(e){return d.includes(e)}))&&(!c.isFiltered||c.includes(t))})),f=!1;return li.forEachSelector(n,".b-timeaxis-summary-value",(function(e,t){var n=r._labels[t],i=e.innerText.trim();a.push({label:n,text:i}),e.innerHTML&&(f=!0)})),t=r.tooltipTemplate({groupSummaryValues:a,startDate:l.startDate,endDate:l.endDate,resourceStore:i.resourceStore,events:h[o]||[],resources:d,eventStore:c,groupRecord:u,groupField:u.meta.groupField,groupValue:u.meta.groupRowFor}),f?t:null}},{key:"tooltipTemplate",value:function(e){var t=e.groupSummaryValues,n=e.startDate;e.endDate,e.events,e.resources,e.eventStore,e.resourceStore,e.groupRecord,e.groupField,e.groupValue;var r=this.client,i="<header>".concat(this.L("L{Summary.Summary for}",r.getFormattedDate(n)),"</header>");return t.forEach((function(e){var t=e.label,n=void 0===t?"":t,r=e.text;i+="<label>".concat(n,'</label><div class="b-timeaxis-summary-value">').concat(r,"</div>")})),i}},{key:"render",value:function(){var e=this,t=e.scheduler;t.isSchedulerBase&&e.showTooltip&&!e._tip&&(e._tip=new pc({id:"".concat(t.id,"-groupsummary-tip"),cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:e.getTipHtml.bind(e)}))}},{key:"removeSummaryElements",value:function(e){var n=e.querySelector(".b-timeaxis-group-summary");null==n||n.remove(),B(t,"removeSummaryElements",this,3)([])}},{key:"hasSummary",value:function(e){return B(t,"hasSummary",this,3)([e])||e.isTimeAxisColumn}},{key:"updateSummaries",value:function(){this._labels=this.summaries.map((function(e){return e.label||""})),this.isConfiguring||B(t,"updateSummaries",this,3)(arguments)}}],[{key:"properties",get:function(){return{footersToUpdate:new o}}},{key:"pluginConfig",get:function(){return{chain:["render"]}}}])}(XC);S(MM,"$name","GroupSummary"),S(MM,"configurable",{showTooltip:!0,summaries:null,renderer:null}),MM._$name="GroupSummary",Ug.registerFeature(MM,!1,"Scheduler");var FM=function(e){var t;return t=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"moveThreshold",3),S(e,"_dragging",!1),e}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.chain(this.client,"onElementMouseDown","onElementMouseDown"),this.chain(this.client,"onElementMouseMove","onElementMouseMove")}},{key:"onElementMouseDown",value:function(e){var t=this;e.touches||0!==e.button||t.disabled||!t.enableDragSelect||e.target.closest(".b-sch-header-timeaxis-cell")&&(t.startX=e.clientX,fr.on({element:li.getRootElement(e.target),mouseup:"onMouseUp",thisObj:t,once:!0}))}},{key:"onElementMouseMove",value:function(e){var t=this;if("number"==typeof t.startX){if(!t._dragging&&Math.abs(t.startX-e.clientX)>=t.moveThreshold){var n=t.client.subGrids.normal.header.headersElement;t.element=li.createElement({parent:n,tag:"div",className:"b-header-drag-selection-rect b-headerzoom-rect"}),t.headerElementRect=pt.from(n),t._dragging=!0}if(t.isDragging){var r=Math.max(e.clientX,t.headerElementRect.left),i=Math.min(t.startX,r),a=Math.abs(t.startX-r),o=new pt(i-t.headerElementRect.x+t.client.scrollLeft,0,a,t.headerElementRect.height);li.setTranslateX(t.element,o.left),t.element.style.width=o.width+"px"}}}},{key:"onMouseUp",value:function(){var e=this;if(e.startX=null,e.isDragging){var t,n=e.client,r=pt.from(e.element),i=n.getDateFromCoordinate(r.left,"round",!1),a=n.getDateFromCoordinate(r.right,"round",!1);e.element.remove(),fr.on({element:li.getRootElement(n.element),thisObj:e,click:function(e){return e.stopPropagation()},capture:!0,expires:50,once:!0}),e._dragging=null,null===(t=e.onTimeSpanDragSelected)||void 0===t||t.call(e,{startDate:i,endDate:a})}}},{key:"isDragging",get:function(){return this._dragging}}])}(e||Mn),S(t,"configurable",{enableDragSelect:!0}),t},AM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onTimeSpanDragSelected",value:function(e){var t=e.startDate,n=e.endDate;this.client.zoomToSpan({startDate:t,endDate:n})}}])}(wc.mixin(FM));S(AM,"$name","HeaderZoom"),AM._$name="HeaderZoom",Ug.registerFeature(AM,!1,"Scheduler");var IM=["top","before","after","bottom"],LM=function(e,t){switch(e){case"top":return"b-b";case"after":return t.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return t.rtl?"l-l":"r-r";case"left":return"r-r"}},OM={top:1,bottom:1},PM={estimate:1,measure:1},_M={before:1,after:1},HM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");r.scheduler=e,B(t,"construct",this,3)([e,n]),(r.top||r.bottom||r.before||r.after)&&r.updateHostClasslist()}},{key:"updateHostClasslist",value:function(){var e=this.top,t=this.bottom,n=this.scheduler.element.classList;n.remove("b-labels-topbottom"),n.remove("b-labels-top"),n.remove("b-labels-bottom"),(e||t)&&(n.add("b-labels-topbottom"),e&&n.add("b-labels-top"),t&&n.add("b-labels-bottom"))}},{key:"onLabelDblClick",value:function(e){var t,n=this,r=null===(t=e.target)||void 0===t?void 0:t.closest("."+n.labelCls);if(r&&!n.scheduler.readOnly){var i=r.dataset.side,a=n[i],o=a.editor,l=a.field;if(o){var s=n.scheduler.resolveEventRecord(e.target);if(s.readOnly)return;return o instanceof Xk||(a.editor=new Xk({blurAction:n.blurAction,inputField:o,scrollAction:"realign"})),a.editor.render(n.scheduler.element),a.editor.startEdit({target:r,align:LM(i,n.client),matchSize:!1,record:s,field:l}),e.stopImmediatePropagation(),!1}}}},{key:"changeTop",value:function(e){return this.processLabelSpec(e,"top")}},{key:"updateTop",value:function(){this.updateHostClasslist()}},{key:"changeAfter",value:function(e){return this.processLabelSpec(e,"after")}},{key:"updateAfter",value:function(){this.updateHostClasslist()}},{key:"changeRight",value:function(e){this[this.client.rtl?"before":"after"]=e}},{key:"changeBottom",value:function(e){return this.processLabelSpec(e,"bottom")}},{key:"updateBottom",value:function(){this.updateHostClasslist()}},{key:"changeBefore",value:function(e){return this.processLabelSpec(e,"before")}},{key:"updateBefore",value:function(){this.updateHostClasslist()}},{key:"changeLeft",value:function(e){this[this.client.rtl?"after":"before"]=e}},{key:"processLabelSpec",value:function(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return null;e=Object.create(e)}var n=this.scheduler,r=n.eventStore,i=n.resourceStore,a=n.taskStore;n.id;var o,l=e,s=l.field,u=l.editor;(OM[t]&&(n.milestoneWidth=null),e.recordType=r&&!a?"event":"task",s)&&(r&&!a&&((o=r.modelClass.fieldMap[s])?(e.fieldDef=o,e.recordType="event"):Reflect.has(r.modelClass.prototype,s)&&(e.recordType="event")),!o&&a&&((o=a.modelClass.fieldMap[s])?(e.fieldDef=o,e.recordType="task"):Reflect.has(i.modelClass.prototype,s)&&(e.recordType="task")),!o&&i&&((o=i.modelClass.fieldMap[s])?(e.fieldDef=o,e.recordType="resource"):Reflect.has(i.modelClass.prototype,s)&&(e.recordType="resource")),u&&!this.editListenerAdded&&(fr.on({element:n.timeAxisSubGrid.element,delegate:"."+this.labelCls,dblclick:"onLabelDblClick",thisObj:this}),this.editListenerAdded=!0));return e}},{key:"doDisable",value:function(e){B(t,"doDisable",this,3)([e]),this.client.isPainted&&this.client.refresh()}},{key:"generateLabelConfigs",value:function(e){for(var t=this,n=[],r=0,i=IM;r<i.length;r++){var a=i[r];if(t[a]){var o,l=t[a],s=l.field,u=l.fieldDef,c=l.recordType,d=l.renderer,h=l.thisObj,f={tag:"label",className:S(S({},t.labelCls,1),"".concat(t.labelCls,"-").concat(a),1),dataset:{side:a,taskFeature:"label-".concat(a)}},v=void 0,g="".concat(c,"Record"),m=e[g];d?"object"===W(v=d.call(h||t.thisObj||t,F(S(S(S(S({},g,m),"resourceRecord",e.resourceRecord),"assignmentRecord",e.assignmentRecord),"domConfig",f),t.scheduler.isSchedulerPro?{eventRecord:m}:{})))&&(Object.assign(f,v),v=null):(v=m.getValue(s),v="date"!==(null==u?void 0:u.type)||d?Le.encodeHtml(v):Pl.format(v,t.client.displayDateFormat)),null!=v&&!1!==v&&(f.html=v),(null!=f.html||null!==(o=f.children)&&void 0!==o&&o.length||null!=f.text)&&n.push(f)}}return n}},{key:"measureLabels",value:function(e,t){var n,r=this,i=r.client.timeAxisViewModel.getSingleUnitInPixels("millisecond"),a=D(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(_M[o.dataset.side]){var l=o.html,s=0;if("estimate"===r.labelLayoutMode)l.includes("<")&&(l=li.stripTags(l)),s=l.length*r.labelCharWidth+18;else{var u=r.labelMeasureElement||(r.labelMeasureElement=li.createElement({className:"b-sch-event-wrap b-measure-label",parent:r.client.foregroundCanvas}));u.retainElement=!0,fa.sync({targetElement:u,domConfig:{onlyChildren:!0,children:[o]}}),s=u.firstElementChild.offsetWidth}var c=s/i;switch(o.dataset.side){case"before":t.startMS-=c;break;case"after":t.endMS+=c}}}}catch(e){a.e(e)}finally{a.f()}}},{key:"onEventDataGenerated",value:function(e){var t;if(!(this.disabled||null!==(t=e.eventRecord)&&void 0!==t&&t.isResourceTimeRange)){var n,r=this.generateLabelConfigs(e);PM[this.labelLayoutMode]&&this.measureLabels(r,e),(n=e.wrapperChildren).push.apply(n,z(r))}}},{key:"updateLabelLayoutMode",value:function(){this.isConfiguring||this.client.refreshWithTransition()}},{key:"updateLabelCharWidth",value:function(){this.isConfiguring||this.client.refreshWithTransition()}}],[{key:"pluginConfig",get:function(){return{chain:["onEventDataGenerated"]}}}])}(wc);S(HM,"$name","Labels"),S(HM,"configurable",{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}),HM.featureClass="b-sch-labels",HM._$name="Labels",Ug.registerFeature(HM,!1,"Scheduler");var BM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDestroy",value:function(){this.attachToCalendar(null),B(t,"doDestroy",this,3)([])}},{key:"onConfigChange",value:function(e){var t=e.name;this.isConfiguring||"fillTicks"!==t||this.refresh()}},{key:"attachToProject",value:function(e){var n=this;B(t,"attachToProject",this,3)([e]),this.attachToCalendar(e.effectiveCalendar),e.graph||this.client.isScheduler||e.ion({name:"project",dataReady:{fn:function(){return n.attachToCalendar(e.effectiveCalendar)},once:!0},thisObj:this}),e.ion({name:"project",calendarChange:function(){return n.attachToCalendar(e.effectiveCalendar)},thisObj:this})}},{key:"onTimeAxisViewModelUpdate",value:function(){this._timeAxisUnitDurationMs=null;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(t,"onTimeAxisViewModelUpdate",this,3)(n)}},{key:"attachToCalendar",value:function(e){var t=this,n=t.project,r=t.client;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:function(){return t.setTimeout((function(){return t.refresh()}),1)},thisObj:t})),!r.isEngineReady||r.project.isDelayingCalculation||r.isDestroying?n.isDestroyed||(t.detachListeners("initialProjectListener"),n.ion({name:"initialProjectListener",refresh:function(e){!1!==e.isCalculated&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t})):t.refresh()}},{key:"calendar",get:function(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}},{key:"timeAxisUnitDurationMs",get:function(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=Pl.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}},{key:"shouldRenderRange",value:function(e,n,r){return B(t,"shouldRenderRange",this,3)([e,n,r])&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}},{key:"timeRanges",get:function(){var e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}}],[{key:"defaultConfig",get:function(){return{hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}},{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("attachToProject","onConfigChange"),e}}])}(TT.mixin(DR,wM));S(BM,"$name","NonWorkingTime"),BM._$name="NonWorkingTime",Ug.registerFeature(BM,!1,"Scheduler"),Ug.registerFeature(BM,!0,["SchedulerPro","Gantt","ResourceHistogram"]);var VM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"targetSelector",get:function(){return".b-sch-timeaxis-cell,.b-tasknonworkingtime,.b-sch-resourcetimerange,.b-timeline-subgrid".concat(this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":"")}},{key:"onElementMouseDown",value:function(e){var t,n=this,r=n.client,i=e.button,a=e.touches,o=e.target,l=e.clientX,s=e.clientY,u=r.features.taskDrag||r.features.eventDrag,c=r.readOnly||!(null!=u&&u.enabled);a||0!==i||n.disabled||!1===r.trigger("beforePan",{event:e})||(o.matches(n.targetSelector)||c&&o.closest(r.eventSelector))&&(n.mouseX=l,n.mouseY=s,n.onHeader=n.enableInHeader&&o.closest(".b-sch-header-timeaxis-cell"),null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.mouseDetacher=fr.on({element:li.getRootElement(r.element),mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:n}))}},{key:"onMouseMove",value:function(e){var t=this,n=t.client,r=n.timeAxisSubGrid.scrollable,i=n.scrollable,a=e.clientX,o=e.clientY;0!==e.buttons?(e.preventDefault(),!t.vertical||!n.isVertical&&t.onHeader||i.scrollBy(0,t.mouseY-o),!t.horizontal||!n.isHorizontal&&t.onHeader||r.scrollBy(t.mouseX-a),n.eventSelectionDisabled||(n.eventSelectionDisabled=!0,t.panControllingEventSelection=!0),t.mouseX=a,t.mouseY=o):t.onMouseUp()}},{key:"onMouseUp",value:function(){var e,t=this,n=this.client;null===(e=this.mouseDetacher)||void 0===e||e.call(this),this.mouseDetacher=null,n.setTimeout((function(){t.panControllingEventSelection&&(n.eventSelectionDisabled=!1,n.panControllingEventSelection=!1)}),50)}},{key:"isActive",get:function(){return Boolean(this.mouseDetacher)}}],[{key:"pluginConfig",get:function(){return{chain:["onElementMouseDown"]}}}])}(wc);S(VM,"$name","Pan"),S(VM,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0}),VM._$name="Pan",Ug.registerFeature(VM,!1,["Scheduler","Gantt"]);var NM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getDataFromEvent",value:function(e){var n=B(t,"getDataFromEvent",this,3)(arguments),r=n.cellElement=e.target.closest(".b-resourceheader-cell"),i=null==r?void 0:r.dataset.resourceId;if(i)return n.resourceRecord=this.client.resourceStore.getById(i),n}},{key:"populateResourceMenu",value:function(e){var t=e.items,n=e.resourceRecord,r=this.client;r.readOnly||(t.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:n.readOnly,onItem:function(){return r.resourceStore.remove(n)}})}},{key:"showMenu",get:function(){return!0}}],[{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateResourceMenu"),e}}])}(op);S(NM,"$name","ResourceMenu"),S(NM,"configurable",{processItems:null,items:null,type:"resource"}),NM.featureClass="",NM._$name="ResourceMenu",Ug.registerFeature(NM,!1,["Scheduler"]);var zM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"attachToProject",value:function(e){var n=this,r=n.client;if(B(t,"attachToProject",this,3)([e]),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=r.resourceTimeRangeStore||new Gx({owner:n});var i=r.crudManager;i&&!i.resourceTimeRangeStore&&(i.resourceTimeRangeStore=e.resourceTimeRangeStore)}var a=e.resourceTimeRangeStore;n.exposedOnScheduler||(r.resourceTimeRanges&&(a.add(r.resourceTimeRanges),delete r.resourceTimeRanges),Object.defineProperty(r,"resourceTimeRanges",{get:function(){return a.records},set:function(e){return a.data=e}}),n.exposedOnScheduler=!0),a.resourceStore||(a.resourceStore=e.resourceStore),n.detachListeners("store"),a.ion({name:"store",change:n.onStoreChange,thisObj:n})}},{key:"attachToResourceTimeRangeStore",value:function(e){this.attachToProject(this.project),this.client.refresh()}},{key:"store",get:function(){return this.project.resourceTimeRangeStore}},{key:"getEventsToRender",value:function(e,t){if(!this.disabled){var n,r=e.$original.timeRanges,i=this.client,a=i.startDate,o=i.endDate,l=i.visibleDateRange;null===(n=this.store.lazyLoad)||void 0===n||n.bufferedLazyLoad({startDate:a,endDate:o,resourceRecord:e,visibleStart:l.startDate,visibleEnd:l.endDate}),null!=r&&r.length&&r.forEach((function(e){e.isRecurring?t.push.apply(t,z(e.getOccurrencesForDateRange(a,o))):t.push(e)}))}return t}},{key:"shouldInclude",value:function(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}},{key:"renderContent",value:function(e,n){var r=this.client,i=n.eventContent;if(r.resourceTimeRangeRenderer){var a=r.resourceTimeRangeRenderer({resourceTimeRangeRecord:e,resourceRecord:n.resourceRecord,renderData:n});Array.isArray(a)?i.children=a:Le.isHtml(a)?(i.children=null,i.html=a):"string"==typeof a||"object"===W(a)?i.children=[a]:null!=a&&(i.text=a)}else B(t,"renderContent",this,3)(arguments)}},{key:"doDestroy",value:function(){var e;(null===(e=this.store)||void 0===e?void 0:e.owner)===this&&this.store.destroy(),B(t,"doDestroy",this,3)([])}}],[{key:"pluginConfig",get:function(){return F(F({},B(t,"pluginConfig",this)),{},{assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]})}}])}(DT);S(zM,"$name","ResourceTimeRanges"),S(zM,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"}),zM.featureClass="",zM._$name="ResourceTimeRanges",Ug.registerFeature(zM,!1,"Scheduler");var jM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onDragStart",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(B(t,"onDragStart",this,3)(n),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}},{key:"onDrop",value:function(){this.rejectFeatureTransaction();for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(t,"onDrop",this,3)(n)}},{key:"onAbort",value:function(){this.rejectFeatureTransaction();for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(t,"onAbort",this,3)(n)}}])}(cT(hw));S(jM,"$name","RowReorder"),jM._$name="RowReorder",Ug.registerFeature(jM,!1,"Scheduler"),Ug.registerFeature(jM,!0,"Gantt");var WM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onResizeStart",value:function(e){var n=e.context;B(t,"onResizeStart",this,3)(arguments);var r,i,a,o=this.client,l=n.record;o.isTimelineBase&&(o.suspendAnimations(),null===(r=o.crudManager)||void 0===r||null===(i=r.suspendAutoSync)||void 0===i||i.call(r),o.features.eventDragCreate&&(this._oldDragCreateDisabled=o.features.eventDragCreate.disabled,o.features.eventDragCreate.disabled=!0));o.isSchedulerBase&&("stack"===(null===(a=o.getEventLayout)||void 0===a?void 0:a.call(o,l).type)&&(n.oldEventLayout=l.eventLayout,l.eventLayout="pack",l.rowHeight=n.elementHeight),n.originalBarMargin=o.getBarMargin(l),n.originalResourceMarginObject=o.getResourceMarginObject(l),n.originalRecordResourceMargin=l.resourceMargin)}},{key:"onResizing",value:function(e){var n=e.context,r=n.record,i=n.newHeight,a=n.elementHeight,o=n.originalBarMargin,l=n.originalResourceMarginObject;if(B(t,"onResizing",this,3)(arguments),!this.applyToAllRows&&!this.client.fixedRowHeight&&n.valid){if(r.beginBatch(),r.rowHeight=i,i<a){var s=i/a;r.barMargin=o*s,l.start===l.end&&(r.resourceMargin=l.start*s)}r.endBatch()}}},{key:"onCancel",value:function(e){var n=e.context;n.record.eventLayout=n.oldEventLayout,n.record.resourceMargin=n.originalRecordResourceMargin,n.record.barMargin=n.originalBarMargin,B(t,"onCancel",this,3)(arguments)}},{key:"cleanup",value:function(){var e,n,r=this.client;r.isTimelineBase&&(r.resumeAnimations(),null===(e=r.crudManager)||void 0===e||null===(n=e.resumeAutoSync)||void 0===n||n.call(e),r.features.eventDragCreate&&(r.features.eventDragCreate.disabled=this._oldDragCreateDisabled));B(t,"cleanup",this,3)([])}}])}(fw);S(WM,"$name","RowResize"),WM._$name="RowResize",Ug.registerFeature(WM,!1);var $M=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"shouldShowMenu",value:function(e){var t=this.client,n=e.targetElement,r=e.resourceRecord,i=t.timeAxisSubGridElement.contains(n);return!n.closest(t.eventSelector)&&i&&!(r&&r.isSpecialRow)}},{key:"getDataFromEvent",value:function(e){if(li.isDOMEvent(e)){var n,r;if(e.target.closest(".b-verticaltimeaxis-cell"))return;var i=this.client,a=null===(n=i.getCellDataFromEvent)||void 0===n?void 0:n.call(i,e),o=null===(r=i.getDateFromDomEvent)||void 0===r?void 0:r.call(i,e,"floor"),l=i.resolveResourceRecord(e)||i.isVertical&&i.resourceStore.last;return Be.assign(B(t,"getDataFromEvent",this,3)([e]),a,{date:o,resourceRecord:l})}return e}},{key:"populateScheduleMenu",value:function(e){var t=e.items,n=e.resourceRecord,r=e.date,i=this.client;!i.readOnly&&i.eventStore&&(t.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:this.disableAddEvent,weight:100,onItem:function(){i.createEvent(r,n,i.getRowFor(n))}})}},{key:"disableAddEvent",get:function(){var e=this.menuContext,t=e.resourceRecord,n=e.date;return!t||t.readOnly||!t.isWorkingTime(n)}}],[{key:"defaultConfig",get:function(){return{type:"schedule",items:null,processItems:null}}},{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateScheduleMenu"),e}}])}(ST);S($M,"$name","ScheduleMenu"),$M.featureClass="",$M._$name="ScheduleMenu",Ug.registerFeature($M,!0,"Scheduler");var UM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"doDisable",value:function(e){this.client.refresh(),B(t,"doDisable",this,3)([e])}},{key:"onPaint",value:function(e){var t=this;if(e.firstPaint){var n=this.client,r=this.renderer,i=n.timeAxisColumn,a=i.defaultRenderer;n.timeAxisSubGrid.scrollable.ion({scrollEnd:function(){n.refreshColumn(i)}}),i.defaultRenderer=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return a.apply(i,n),r.apply(t,n)}}}},{key:"renderer",value:function(e){var t=e.record,n=e.grid.visibleDateRange,r=this.labelRenderer,i=this.forwardIconCls,a=this.backwardIconCls,o=0,l=0;return t.events.forEach((function(e){var t=e.isScheduled,r=e.startDate,i=e.endDate;t&&(i<=n.startDate?l++:r>=n.endDate&&o++)})),{class:"b-scroll-buttons-container",children:[{class:"b-scroll-button-wrap b-scroll-backward ".concat(l>0?"":"b-scroll-button-hidden"),children:[{tag:"i",class:S({"b-icon":1,"b-scroll-button":1},a,1)},r&&{tag:"span",class:"b-scroll-button-content",text:r({resourceRecord:t,isBefore:!0,nbrEvents:l})}]},o>0?{class:"b-scroll-button-wrap b-scroll-forward",children:[r&&{tag:"span",class:"b-scroll-button-content",text:r({resourceRecord:t,isBefore:!1,nbrEvents:o})},{tag:"i",class:S({"b-icon":1,"b-scroll-button":1},i,1)}]}:null]}}},{key:"onElementClick",value:function(e){var t=this.client,n=e.target,r=n.closest(".b-scroll-button-wrap"),i=r&&t.getRecordFromElement(n);if(r&&!1!==t.trigger("scrollButtonClick",{domEvent:e,resourceRecord:i})){var a=t.visibleDateRange;n.closest(".b-scroll-forward")?t.scrollResourceEventIntoView(i,i.getEventStartingAfter(a.endDate),Be.assign({block:"end"},this.scrollOptions)):t.scrollResourceEventIntoView(i,i.getEventEndingBefore(a.startDate),Be.assign({block:"start"},this.scrollOptions))}}}],[{key:"pluginConfig",get:function(){return{chain:["onPaint","onElementClick"]}}}])}(wc);S(UM,"$name","ScrollButtons"),S(UM,"configurable",{backwardIconCls:"b-icon-before",forwardIconCls:"b-icon-after",labelRenderer:null,scrollOptions:{animate:{duration:600,easing:"easeTo"},y:!1,edgeOffset:50},testConfig:{scrollOptions:{animate:{duration:20,easing:"easeTo"},y:!1,edgeOffset:50}}}),UM._$name="ScrollButtons",Ug.registerFeature(UM,!1,"Scheduler");var GM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onInternalPaint",value:function(e){if(e.firstPaint){var t,n=this,r=n.client;r.isSchedulerPro&&n.hideForNonWorkingTime===i&&(n.hideForNonWorkingTime=!0);var a=n.hoverTip=new pc(F(F({id:"".concat(r.id,"-schedule-tip"),cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:r.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event,.b-dragcreating,.b-creating-dependency) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas,.b-group-footer,.b-group-row) *:not(.b-scroll-button-wrap *,.b-sch-dependency)",getHtml:n.getHoverTipHtml.bind(n),onDocumentMouseDown:function(e){a.forElement.contains(e.event.target)&&(t=fr.on({thisObj:n,element:r.timeAxisSubGridElement,mousemove:function(e){return a.internalOnPointerOver(e)},capture:!0}));var i=a.hideAnimation;a.hideAnimation=!1,a.constructor.prototype.onDocumentMouseDown.call(a,e),a.hideAnimation=i}},n.config),{},{internalListeners:n.configuredListeners}));a.ion({pointerover:function(e){var r=e.event,i="buttons"in r?r.buttons>0:r.which>0;if(!i&&t&&t(),n.disabled||i)return a.hide(),!1},innerhtmlupdate:function(e){var t=e.source;n.clockTemplate.updateDateIndicator(t.element,n.lastTime)}}),r.ion({timeAxisViewModelUpdate:"updateTip",thisObj:n}),n.clockTemplate=new sT({scheduler:r})}}},{key:"processConfiguredListeners",value:function(){}},{key:"updateTip",value:function(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}},{key:"doDestroy",value:function(){this.destroyProperties("clockTemplate","hoverTip"),B(t,"doDestroy",this,3)([])}},{key:"getHoverTipHtml",value:function(e){var t=e.tip,n=e.event,r=this,i=r.client,a=n&&i.getDateFromDomEvent(n,"floor",!0),o=r.lastHtml;if(a&&n.target){var l=i.resolveResourceRecord(n);if(l&&(a-r.lastTime!=0||l.id!==r.lastResourceId)){if(r.hideForNonWorkingTime){var s=l.isWorkingTime(a);t.element.classList.toggle("b-nonworking-time",!s)}r.lastResourceId=l.id,o=r.lastHtml=r.generateTipContent({date:a,event:n,resourceRecord:l})}}else t.hide(),r.lastTime=null,r.lastResourceId=null;return o}},{key:"generateTipContent",value:function(e){var t=e.date,n=e.event,r=e.resourceRecord,i=this,a=i.clockTemplate.generateContent({date:t,text:i.client.getFormattedDate(t)}),o=i.messageTemplate({message:i.getText(t,n,r)||""});return i.lastTime=t,a+o}},{key:"getText",value:function(e,t,n){}}],[{key:"configurable",get:function(){return{messageTemplate:function(e){return'<div class="b-sch-hovertip-msg">'.concat(e.message,"</div>")},hideForNonWorkingTime:null}}},{key:"pluginConfig",get:function(){return{chain:["onInternalPaint"]}}}])}(wc);S(GM,"$name","ScheduleTooltip"),GM.featureClass="b-scheduletip",GM._$name="ScheduleTooltip",Ug.registerFeature(GM,!0,"Scheduler"),Ug.registerFeature(GM,!1,"ResourceUtilization");var YM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;r.scheduler=e,e.eventEdit=r,B(t,"construct",this,3)([e,n]),r.clientListenersDetacher=e.ion(S(S(S({},r.triggerEvent,(function(e){var t=e.eventRecord,n=e.eventElement;return r.editEvent(t,t.resource,n)})),"dragcreateend",r.onDragCreateEnd),"thisObj",r))}},{key:"doDestroy",value:function(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"eventStore",get:function(){return this.scheduler.eventStore}},{key:"project",get:function(){return this.client.project}},{key:"editEvent",value:(n=f(L().mark((function e(t,n,r,i){var a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(a=this).scheduler,l=a.client.features.eventEdit,n||(n=t.resource),r||(r=o.getElementFromEventRecord(t)),!(o.readOnly||a.disabled||t.readOnly||n.readOnly||l&&!l.disabled&&!t.isCreating)){e.next=5;break}return e.abrupt("return");case 5:return s=a.editor,r=li.down(r,o.eventInnerSelector)||r,t=t.isAssignment?t.event:t,a.resource=n,a.eventRecord=t,a.element=r,o.element.classList.add("b-eventeditor-editing"),s?s.render(o.timeAxisSubGridElement):(a.editor=s=Xk.new({owner:o.timeAxisSubGrid,appendTo:o.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:o.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:a},onInternalKeyDown:function(e){return e.stopPropagation()}},a.editorConfig),s.revertFocus=function(){return o.getElementFromEventRecord(a.eventRecord,a.resourceRecord,!0).focus({scrollIntoView:!1})},a.relayEvents(a.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),i?a.applyStmCapture(i):!1===i||a.hasStmCapture||a.captureStm(!0),t.isCreating&&(t.name=""),e.next=17,s.startEdit({target:r,record:t,field:a.field});case 17:o.isVertical&&t.startDate<o.visibleDateRange.startDate&&s.element.scrollIntoView(),o.navigator.disabled=!0;case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"onEditorComplete",value:function(){this.eventRecord.isCreating=!1,this.reset(),this.freeStm(!0)}},{key:"onEditorCancel",value:function(){var e=this.eventRecord;this.reset(),this.freeStm(!1),e.isCreating&&e.remove()}},{key:"reset",value:function(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.eventRecord=null,this.resource=null}},{key:"onEventEnterKey",value:function(e){var t=e.assignmentRecord,n=e.eventRecord,r=t?this.scheduler.getElementFromAssignmentRecord(t):this.scheduler.getElementFromEventRecord(n),i=(t||n).resource;this.editEvent(n,i,r)}},{key:"onDragCreateEnd",value:function(e){var t=e.eventRecord,n=e.resourceRecord,r=e.eventElement,i=e.stmCapture;this.element=r,this.editEvent(t,n,r,i)}}],[{key:"defaultConfig",get:function(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}},{key:"pluginConfig",get:function(){return{chain:["onEventEnterKey","editEvent"]}}}]);var n}(wc.mixin(fT));S(YM,"$name","SimpleEventEdit"),YM._$name="SimpleEventEdit",Ug.registerFeature(YM,!1,"Scheduler");var qM=Object.freeze({animate:!1,block:"start"}),KM=Object.freeze({animate:!1,block:"end"}),XM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getClientConfig",value:function(e,n,r,i){var a,o=this.client,l=B(t,"getClientConfig",this,3)([e,n,r,i]);return o.isSchedulerBase||o.isSchedulerProBase||o.isGanttBase?(delete l.store,delete l.events,delete l.resources,delete l.assignments,delete l.dependencies,delete l.resourceTimeRanges,delete l.timeRanges,l.project=o.project,l.assignmentStore=l.project.assignmentStore,l.crudManager=o.crudManager,l.viewPreset=o.viewPreset,l.startDate=o.startDate,l.endDate=o.endDate,l.selectedCollection=o.selectedCollection,l.useInitialAnimation=!1,!1!==(null===(a=l.features)||void 0===a?void 0:a.eventDrag)&&(Be.setPath(l,"features.eventDrag.constrainDragToTimeline",!1),o.features.eventDrag.constrainDragToTimeline=!1),l):l}},{key:"unsplitCleanup",value:function(e){this.client.timeAxisSubGrid.onElementResize()}},{key:"processOptions",value:function(e){var n=this.client,r=e.atDate,i=e.atRecord;if("horizontal"!==e.direction&&!e.atColumn&&!e.atRecord&&!r){var a=pt.from(n.element),o=n.getDateFromCoordinate(a.center.x,"round",!1);o&&(e.atDate=r=o,e.atColumn=n.timeAxisColumn)}return r&&(e.direction||(e.direction=i?"both":"vertical"),e.splitX=n.getVirtualCoordFromDate(r)-n.timeAxisSubGrid.scrollable.x,n.rtl?e.splitX+=n._bodyRectangle.width-pt.from(n.timeAxisSubGridElement).right+li.scrollBarWidth:e.splitX+=pt.from(n.timeAxisSubGridElement,n.bodyContainer).left,e.remainingWidth=pt.from(n.element).width-e.splitX),B(t,"processOptions",this,3)([e])}},{key:"split",value:function(){var e=f((function(){var e=this,n=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return L().mark((function r(){var i,a,o;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e.client,e.detachListeners("onReconfigure"),!i.isVertical){r.next=4;break}throw new Error("Splitting is not supported in vertical mode");case 4:return r.next=6,B(t,"split",e,3)([n]);case 6:if(a=r.sent,o=function(e,t){e.reconfigure({viewPreset:t.viewPreset,startDate:t.startDate,endDate:t.endDate})},!a){r.next=13;break}if(!n.atDate){r.next=12;break}return r.next=12,Promise.all([a[0].scrollToDate(Pl.add(n.atDate,-1,i.timeAxis.unit),KM),a[1].scrollToDate(n.atDate,qM)]);case 12:i.infiniteScroll&&("horizontal"===n.direction&&o(a[1].timeAxis,a[0].timeAxis),"both"===n.direction&&(o(a[2].timeAxis,a[0].timeAxis),o(a[3].timeAxis,a[1].timeAxis)));case 13:return i.timeAxisSubGrid.scrollable.x+=.5,a.forEach((function(t){t.timeAxis.ion({name:"onReconfigure",reconfigure:"onReconfigure",thisObj:e})})),r.abrupt("return",a);case 16:case"end":return r.stop()}}),r)}))()}));return function(){return e.apply(this,arguments)}}()},{key:"populateCellMenu",value:function(){}},{key:"populateScheduleMenu",value:function(e){var t=e.items,n=e.date,r=e.record,i=this,a=i.isSplit,o=i.client.splitFrom;!i.disabled&&i.client.isHorizontal&&(t.splitSchedule={text:"L{split}",localeClass:i,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:a||o,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:i,weight:100,onItem:function(){i.split({atRecord:r,direction:"horizontal"}).then()}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:i,weight:200,onItem:function(){i.split({atDate:n}).then()}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:i,weight:300,onItem:function(){i.split({atDate:n,atRecord:r,direction:"both"}).then()}}}},t.unsplitSchedule={text:"L{unsplit}",localeClass:i,icon:"b-icon b-icon-clear",hidden:!(a||o),weight:550,onItem:function(){(o||i).unsplit()}})}},{key:"onReconfigure",value:function(e){var t=e.suppressRefresh,n=e.config,r=this.client;if(n&&!this.isReconfiguring){this.isReconfiguring=!0;var i,a=r.splitFrom?r.splitFrom:r;if(a.splitDirection&&"vertical"!==a.splitDirection)null===(i=r.syncSplits)||void 0===i||i.call(r,(function(e){var r,i,o=a.subViews,l=o.indexOf(e),s=o.length>2?l+2*(l>1?-1:1):1-l;null===(r=o[l])||void 0===r||r.timeAxis.reconfigure(n,t,!1),null===(i=o[s])||void 0===i||i.timeAxis.reconfigure(n,t,!1)}));this.isReconfiguring=!1}}}],[{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateScheduleMenu"),e}}])}(tw);S(XM,"$name","Split"),S(XM,"configurable",{relayProperties:{value:{barMargin:1,eventColor:1,eventStyle:1,eventLayout:1,fillTicks:1,resourceMargin:1,snap:1,tickSize:1},$config:{merge:"merge"}}}),XM._$name="Split",Ug.registerFeature(XM,!1,"Scheduler");var ZM={width:0,height:0},JM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){B(t,"construct",this,3)([e,n]),e.isVertical&&(this.toUpdate=new o,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}},{key:"onEventDataGenerated",value:function(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=!1===e.eventRecord.stickyContents:(this.syncEventContentPosition(e,i,!0),this.updateStyles())}},{key:"onSchedulerScroll",value:function(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}},{key:"onHorizontalScroll",value:function(e){e.subGrid===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}},{key:"updateStyles",value:function(){var e,t=D(this.toUpdate);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.contentEl,i=n.style;li.applyStyle(r,i)}}catch(e){t.e(e)}finally{t.f()}this.toUpdate.clear()}},{key:"verticalSyncAllEventsContentPosition",value:function(e){var t,n=D(e.currentOrientation.resourceMap.values());try{for(n.s();!(t=n.n()).done;)for(var r=t.value,i=0,a=Object.values(r);i<a.length;i++){var o=a[i],l=o.renderData,s=o.elementConfig,u=[l];s&&l.eventRecord.isResourceTimeRange&&u.push(s.children[0]),this.syncEventContentPosition.apply(this,u)}}catch(e){n.e(e)}finally{n.f()}this.toUpdate.size&&this.updateStyles()}},{key:"syncEventContentPosition",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:e.eventContent,n=arguments.length>2&&arguments[2]!==i&&arguments[2];if(!this.disabled&&!1!==e.eventRecord.stickyContents){var r=this.client,a=e.eventRecord,o=e.resourceRecord,l=e.useEventBuffer,s=e.bufferAfterWidth,u=e.bufferBeforeWidth,c=e.top,d=e.height,h=r.scrollable.y,f=n?null:r.getElementFromEventRecord(a,o,!0),v=f&&fa.getChild(f,"event.content"),g=a.instanceMeta(r),m="string"==typeof t.style?t.style=li.parseStyle(t.style):t.style||(t.style={});if(null==f||!f.classList.contains("b-dragging")){var p=c,y=d,k=p+y;if(l&&(k=(p+=u)+(y=y-u-s)),p<h&&k>=h&&!a.isMilestone){var b=null==v?void 0:v.offsetWidth,C="center"===((null==v?void 0:v.parentNode)&&li.getStyleValue(v.parentNode,"justifyContent"))?(e.width-b)/2:0,w=p;if((!v||b)&&w<h&&w+y-1>=h){var D=this.getEventContentMargins(v),S=v?y-v.offsetHeight-D.height-C:Number.MAX_SAFE_INTEGER,x=Math.min(h-w,S-2);m.transform=x>0?"translateY(".concat(x,"px)"):"",g.stuck=!0}else m.transform="",g.stuck=!1;v&&this.toUpdate.add({contentEl:v,style:m})}else v&&g.stuck&&(m.transform="",g.stuck=!1,this.toUpdate.add({contentEl:v,style:m}))}}}},{key:"getEventContentMargins",value:function(e){return null!=e&&e.classList.contains("b-sch-event-content")?li.getEdgeSize(e,"margin"):ZM}},{key:"doDisable",value:function(){B(t,"doDisable",this,3)(arguments),this.isConfiguring||this.client.refreshWithTransition()}}],[{key:"pluginConfig",get:function(){return{chain:["onEventDataGenerated"]}}}])}(wc);S(JM,"$name","StickyEvents"),S(JM,"type","stickyEvents"),JM._$name="StickyEvents",Ug.registerFeature(JM,!0,"Scheduler"),Ug.registerFeature(JM,!1,"ResourceHistogram");var QM=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onInternalPaint",value:function(e){var t=e.firstPaint,n=this,r=n.client.project,i=r.resourceStore;if(t)if(n.refreshSuspended&&n.client.resumeRefresh(),i.count)n.lockRows();else var a=r.ion({refresh:function(){i.count&&(a(),n.lockRows())}})}},{key:"getClientConfig",value:function(e,t,n,r){var i=this.superGetClientConfig(e,t,n,r);return i.partner=this.client,delete i.crudManager,i}}])}(nw);S(QM,"$name","LockRows");var eF=QM.prototype,tF=XM.prototype;eF.superGetClientConfig=tF.getClientConfig,QM.configurable.relayProperties=XM.configurable.relayProperties,QM._$name="LockRows",Ug.registerFeature(QM,!1,"Scheduler");var nF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;B(t,"construct",this,3)([e,n]),r.summaries||(r.summaries=[{renderer:r.renderer}]),e.isTimelineBase&&(r.updateProject(e.project),e.ion({timeAxisViewModelUpdate:r.renderRows,thisObj:r}))}},{key:"updateProject",value:function(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}},{key:"renderRows",value:function(){var e;this.client.isHorizontal&&(null===(e=this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer"))||void 0===e||e.classList.add("b-sch-summarybar"));B(t,"renderRows",this,3)([]),this.disabled||this.render()}},{key:"summaryBarElement",get:function(){return this.client.element.querySelector(".b-sch-summarybar")}},{key:"render",value:function(){var e=this,t=e.client,n=t.isHorizontal?"width":"height",r=t.timeAxisViewModel.columnConfig,i=e.summaryBarElement;i&&(!e._tip&&e.showTooltip&&e.summaries.some((function(e){return e.label}))&&(e._tip=new pc({id:"".concat(t.id,"-summary-tip"),cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:function(e){return e.activeTarget._tipHtml}})),i.innerHTML=r[r.length-1].map((function(e){return'<div class="b-timeaxis-tick" style="'.concat(n,": ").concat(e.width,'px"></div>')})).join(""),e.updateTimelineSummaries())}},{key:"refresh",value:function(){B(t,"refresh",this,3)([]),this.updateTimelineSummaries()}},{key:"doDisable",value:function(e){var n,r=this.client.isConfiguring;B(t,"doDisable",this,3)([e]),null===(n=this.summaryColumn)||void 0===n||n.toggle(!e),r||e||this.render()}},{key:"doDestroy",value:function(){var e;null===(e=this._tip)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}}],[{key:"configurable",get:function(){return{showTooltip:!0}}},{key:"pluginConfig",get:function(){return{chain:["renderRows","updateProject"]}}}])}(bw);S(nF,"$name","TimelineSummary"),nF._$name="TimelineSummary";var rF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e,n){var r=this;r.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,n.hideFooters=!0,e.add(e.createSubGrid("right")),r.summaryColumn=e.columns.add(Be.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:r.disabled},r.verticalSummaryColumnConfig))[0]),B(t,"construct",this,3)([e,n]),e.isSchedulerBase&&(r.updateEventStore(e.eventStore),r.updateResourceStore(e.resourceStore))}},{key:"updateEventStore",value:function(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}},{key:"updateResourceStore",value:function(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}},{key:"updateTimelineSummaries",value:function(){var e=this,t=e.client,n=t.eventStore,r=t.timeAxis,i=e.summaryBarElement,a=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(i&&t.isEngineReady){var o=t.getResourcesEventsPerTick(a,(function(e){var t=e.event;return!n.isFiltered||n.records.includes(t)}));Array.from(i.children).forEach((function(i,a){var l=r.getAt(a),s=o[a]||[],u="",c="<header>".concat(e.L("L{Summary for}",t.getFormattedDate(l.startDate)),"</header>");e.summaries.forEach((function(r){var a=r.renderer({startDate:l.startDate,endDate:l.endDate,resourceStore:t.resourceStore,eventStore:n,events:s,element:i}),o=a?'<div class="b-timeaxis-summary-value">'.concat(a,"</div>"):"";(e.summaries.length>1||a)&&(u+=o),c+=o?"<label>".concat(r.label||"","</label>")+o:""})),i.innerHTML=u,i._tipHtml=u?c:""}))}}},{key:"updateSummaries",value:function(){this.isConfiguring||this.refreshSummaries()}}],[{key:"configurable",get:function(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}},{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}}])}(nF);S(rF,"$name","Summary"),rF._$name="Summary",Ug.registerFeature(rF,!1,"Scheduler");var iF={maintainVisibleStart:!0},aF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}},{key:"shouldShowMenu",value:function(e){var t=e.column,n=e.targetElement;return this.client.isHorizontal?!1!==(null==t?void 0:t.enableHeaderContextMenu)&&(null==t?void 0:t.isTimeAxisColumn):n.closest(".b-verticaltimeaxis-cell")}},{key:"populateTimeAxisHeaderMenu",value:function(e){var t=e.items,n=this,r=n.client,i={magnitude:r.timeAxis.shiftIncrement,unit:r.timeAxis.shiftUnit};Object.assign(t,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:n,icon:"b-fw-icon b-icon-search-plus",disabled:!r.presets.count||n.disabled,weight:200,menu:{items:{zoomSlider:{type:"slider",weight:210,minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow:function(e){var t=_(e.source.items,1)[0];t.min=r.minZoomLevel,t.max=r.maxZoomLevel,t.value=r.zoomLevel,n.zoomDetacher=t.ion({change:"onZoomSliderChange",thisObj:n})},onHide:function(){var e;null===(e=n.zoomDetacher)||void 0===e||e.call(n),n.zoomDetacher=null}}},dateRange:{text:"L{activeDateRange}",localeClass:n,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:n},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:i,highlightExternalChange:!1,picker:{internalListeners:{beforeShow:n.updateMinAllowedStartDate,thisObj:n}},internalListeners:{change:n.onRangeDateFieldChange,thisObj:n}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:i,highlightExternalChange:!1,picker:{internalListeners:{beforeShow:n.updateMaxAllowedEndDate,thisObj:n}},internalListeners:{change:n.onRangeDateFieldChange,thisObj:n}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:n.onLeftShiftBtnClick,thisObj:n}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,internalListeners:{click:n.onTodayBtnClick,thisObj:n}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:n.onRightShiftBtnClick,thisObj:n}}},internalListeners:{paint:n.initDateRangeFields,thisObj:n}}}})}},{key:"onZoomSliderChange",value:function(e){var t=e.value;this.client.zoomLevel=t}},{key:"initDateRangeFields",value:function(e){var t=e.source;if(e.firstPaint){var n=t.widgetMap;this.startDateField=n.startDateField,this.endDateField=n.endDateField}this.initDates()}},{key:"initDates",value:function(){var e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}},{key:"updateMaxAllowedEndDate",value:function(e){return e.source.maxDate=this.client.getAllowedDateRange().endDate,!0}},{key:"updateMinAllowedStartDate",value:function(e){return e.source.minDate=this.client.getAllowedDateRange().startDate,!0}},{key:"onRangeDateFieldChange",value:function(e){var t=this,n=e.source===t.startDateField,r=t.client,i=r.timeAxis,a=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value,o=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-a?o<a&&(o=Pl.add(a,i.shiftIncrement,i.shiftUnit)):o=Pl.add(o,i.shiftIncrement,i.shiftUnit),r.setTimeSpan(a,o,iF),t.initDates()}},{key:"onLeftShiftBtnClick",value:function(){this.client.timeAxis.shiftPrevious(),this.initDates()}},{key:"onTodayBtnClick",value:function(){var e=Pl.clearTime(new Date);this.client.setTimeSpan(e,Pl.add(e,1,"day")),this.initDates()}},{key:"onRightShiftBtnClick",value:function(){this.client.timeAxis.shiftNext(),this.initDates()}}],[{key:"pluginConfig",get:function(){var e=B(t,"pluginConfig",this);return e.chain.push("populateTimeAxisHeaderMenu"),e}}])}(rw);S(aF,"$name","TimeAxisHeaderMenu"),S(aF,"configurable",{menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",align:{monitorResize:!1},scrollAction:null,constrainTo:r}},processItems:null,items:null,type:"timeAxisHeader"}),aF._$name="TimeAxisHeaderMenu",Ug.registerFeature(aF,!0,["Scheduler","TimelineHistogram","Gantt"]);var oF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"timeRanges",get:function(){var e=this,t=e.store;if(!e._timeRanges){var n,r=[];if(t)if(r=t.records,null!==(n=t.recurringEvents)&&void 0!==n&&n.size){var i=e.client.timeAxis,a=i.startDate,o=i.endDate;r=r.flatMap((function(e){return e.isRecurring?e.getOccurrencesForDateRange(a,o):e}))}e.showCurrentTimeLine&&e.currentTimeLine&&(r=[e.currentTimeLine].concat(z(r))),e._timeRanges=r}return e._timeRanges}},{key:"attachToProject",value:function(e){var n,r,i=this;(i.attachToTimeRangeStore(e.timeRangeStore),B(t,"attachToProject",this,3)([e]),null===(n=i.projectTimeZoneChangeDetacher)||void 0===n||n.call(i),i.showCurrentTimeLine)&&(i.projectTimeZoneChangeDetacher=null===(r=i.client.project)||void 0===r?void 0:r.ion({timeZoneChange:"updateCurrentTimeLine",thisObj:i}),i.currentTimeLine&&i.updateCurrentTimeLine())}},{key:"initCurrentTimeLine",value:function(){var e,t,n,r=this;if(!r.currentTimeLine&&r.showCurrentTimeLine){var i="object"===W(r.showCurrentTimeLine)?r.showCurrentTimeLine:{};r.currentTimeLine=((null===(e=r.store)||void 0===e?void 0:e.modelClass)||Bw).new({id:"currentTime",cls:"b-sch-current-time"},i),r.currentTimeInterval=r.setInterval((function(){return r.updateCurrentTimeLine()}),r.currentTimeLineUpdateInterval),r._timeRanges=null,r.updateCurrentTimeLine(),null===(t=(n=r.client).syncSplits)||void 0===t||t.call(n,(function(e){var t,n;return null===(t=e.features)||void 0===t||null===(t=t.timeRanges)||void 0===t||null===(n=t.initCurrentTimeLine)||void 0===n?void 0:n.call(t)}))}}},{key:"updateCurrentTimeLine",value:function(){var e,t=this,n=t.currentTimeLine,r=t.client;n.timeZone=null===(e=t.project)||void 0===e?void 0:e.timeZone,n.setLocalDate("startDate",new Date),n.endDate=n.startDate,n.originalData.name||(n.name=Pl.format(n.startDate,t.currentDateFormat)),t.renderRanges(),r.trigger("currentTimelineUpdate",{date:n.startDate})}},{key:"hideCurrentTimeLine",value:function(){var e,t,n=this;n.currentTimeLine&&(n.clearInterval(n.currentTimeInterval),n.currentTimeLine=null,n.refresh(),null===(e=(t=n.client).syncSplits)||void 0===e||e.call(t,(function(e){var t,n;return null===(t=e.features)||void 0===t||null===(t=t.timeRanges)||void 0===t||null===(n=t.hideCurrentTimeLine)||void 0===n?void 0:n.call(t)})))}},{key:"updateShowCurrentTimeLine",value:function(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine(),this.client.trigger("stateChange")}},{key:"populateTimeAxisHeaderMenu",value:function(e){var t=this;e.items.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.currentTimeLine,onToggle:function(e){var n=e.checked;t.showCurrentTimeLine?t.updateShowCurrentTimeLine(n):t.showCurrentTimeLine=n}}}},{key:"attachToStore",value:function(e){var t=this;t.storeDetacher&&t.storeDetacher(),t.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:t}),t._timeRanges=null,t.renderRanges()}},{key:"store",get:function(){var e;return null===(e=this.client.project)||void 0===e?void 0:e.timeRangeStore}},{key:"attachToTimeRangeStore",value:function(e){var t=this.client;this.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}},{key:"resolveTimeRangeRecord",value:function(e){var t=e.closest(this.baseSelector).dataset.id;return"currentTime"===t?this.currentTimeLine:this.store.getById(t)}},{key:"onStoreChange",value:function(e){var t=e.type,n=e.action,r=this;r._timeRanges=null,r.disabled||!r.client.isVisible||r.isConfiguring||"refresh"===t&&"batch"!==n||r.client.runWithTransition((function(){return r.renderRanges()}),!r.client.refreshSuspended)}},{key:"onDragStart",value:function(e){var n=this,r=e.context,i=n.resolveTimeRangeRecord(r.element.closest(n.baseSelector)),a=n.getBodyElementByRecord(i);r.relatedElements=[a],Object.assign(r,{record:i,rangeBodyEl:a,originRangeX:e.source.getX(a),originRangeY:e.source.getY(a)}),r.element.retainElement=!0,a.retainElement=!0,B(t,"onDragStart",this,3)([e]),n.showTip(r)}},{key:"onDrop",value:function(e){var n=e.context,r=n.rangeBodyEl;if(n.element.retainElement=i,r.retainElement=i,!n.valid)return this.onInvalidDrop({context:n});var a=this,o=a.client,l=n.record,s=o.isHorizontal?n.newX:n.newY,u=o.getDateFromVirtualCoord({coord:s,roundingMethod:"round"});l.startDate-u!=0?l.setStartDate(u):a.drag.abort(),a.destroyTip(),B(t,"onDrop",this,3)([e])}},{key:"onResizeStart",value:function(e){var n=e.context,r=this,i=r.resolveTimeRangeRecord(n.element.closest(r.baseSelector)),a=r.getBodyElementByRecord(i);Object.assign(n,{record:i,rangeBodyEl:a}),r.showTip(n),B(t,"onResizeStart",this,3)(arguments)}},{key:"onResizeDrag",value:function(e){var t=e.source,n=e.context,r=n.rangeBodyEl,i=this.client,a=i.isHorizontal,o=a?n.newX:n.newY,l=a?n.newX+n.newWidth:n.newY+n.newHeight,s=i.getDateFromVirtualCoord({coord:o,roundingMethod:"round"}),u=i.getDateFromVirtualCoord({coord:l,roundingMethod:"round"});a?("left"===n.edge&&t.setX(r,n.newX),r.style.width=n.newWidth+"px"):("top"===n.edge&&t.setY(r,n.newY),r.style.height=n.newHeight+"px"),this.updateDateIndicator({startDate:s,endDate:u})}},{key:"onResize",value:function(e){var t=e.context;if(!t.valid)return this.onInvalidDrop({context:t});var n=this,r=n.client,i=t.record,a=r.isHorizontal?t.newX:t.newY,o=r.isHorizontal?t.newX+t.newWidth:t.newY+t.newHeight,l=r.getDateFromVirtualCoord({coord:a,roundingMethod:"round"}),s=r.getDateFromVirtualCoord({coord:o,roundingMethod:"round"}),u="left"===t.edge||"top"===t.edge;(u&&i.startDate-l!=0||s&&i.endDate-s!=0)&&s>l?u?i.setStartDate(l,!1):i.setEndDate(s,!1):n.onInvalidResize({context:t}),n.destroyTip()}},{key:"onInvalidResize",value:function(e){var t=e.context,n=this;n.resize.reset(),t.rangeBodyEl.parentElement.lastDomConfig=t.rangeBodyEl.lastDomConfig=t.element.lastDomConfig=null,n.renderRanges(),n.destroyTip()}},{key:"state",get:function(){return{showCurrentTimeLine:this.showCurrentTimeLine}}}])}(TT.mixin(DR));S(oF,"stateProperties",["showCurrentTimeLine"]),S(oF,"$name","TimeRanges"),S(oF,"configurable",{currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:{$config:"lazy",value:null}}),oF._$name="TimeRanges",Ug.registerFeature(oF,!1,["TimelineBase"]);var lF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onUIReady",value:function(){var e=this;B(t,"onUIReady",this,3)([]),e.hoverTooltip&&(e.hoverTooltip.getHtml=function(){return e.tooltipTemplate(F({},e.selectedTimeSpan))}),e.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",timeAxisHeaderClick:"onTimeAxisHeaderClick",thisObj:e})}},{key:"onTimeAxisHeaderMouseDown",value:function(e){e.startDate,e.endDate,!this.disabled&&this.enableDragSelect&&(this.selectedTimeSpan=null)}},{key:"onTimeAxisHeaderClick",value:function(e){var t=e.startDate,n=e.endDate;this.disabled||(this.selectedTimeSpan={startDate:t,endDate:n})}},{key:"onTimeRangeClick",value:function(e){B(t,"onTimeRangeClick",this,3)([e]);var n=this;!n.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?n.selectedTimeSpan=null:n.client.trigger("timeSelectionElementClick",F(F({},n.selectedTimeSpan),{},{domEvent:e})))}},{key:"updateFromCoords",value:function(e,t,n,r){var i=this.client,a=i.isHorizontal?n:r,o=i.isHorizontal?e:t,l=i.getDateFromVirtualCoord({coord:o,roundingMethod:"round"})||i.startDate,s=i.getDateFromVirtualCoord({coord:o+a,roundingMethod:"round"})||i.endDate;this.selectedTimeSpan={startDate:l,endDate:s}}},{key:"onResizeStart",value:function(e){e.source;var n=this.client,r=n.timeAxisViewModel,i=n.timeResolution,a=Pl.asMilliseconds(i.increment,i.unit);this.resize.minWidth=r.getDistanceForDuration(a),B(t,"onResizeStart",this,3)(arguments)}},{key:"onResizeDrag",value:function(e){var t,n,r=e.context;this.updateFromCoords(r.newX,r.newY,null!==(t=r.newWidth)&&void 0!==t?t:r.elementWidth,null!==(n=r.newHeight)&&void 0!==n?n:r.elementHeight)}},{key:"onDragStart",value:function(e){B(t,"onDragStart",this,3)([e]);var n=e.context;n.elementWidth=n.element.offsetWidth,n.elementHeight=n.element.offsetHeight}},{key:"onDrag",value:function(e){var t=e.context;this.updateFromCoords(t.newX,t.newY,t.elementWidth,t.elementHeight)}},{key:"onDrop",value:function(){this.client.element.classList.remove("b-dragging-timerange")}},{key:"onDragReset",value:function(){this.refresh()}},{key:"timeRanges",get:function(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}},{key:"shouldRenderRange",value:function(){return!0}},{key:"changeSelectedTimeSpan",value:function(e){return e&&(e.id="time-selection"),e}},{key:"updateSelectedTimeSpan",value:function(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",F({},null!=e?e:{}))}},{key:"onTimeSpanDragSelected",value:function(e){var t=e.startDate,n=e.endDate;this.selectedTimeSpan={startDate:t,endDate:n}}}],[{key:"configurable",get:function(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},enableDragSelect:!1,headerRenderer:function(e){var t=e.timeRange,n=this.client.timeAxisViewModel.bottomHeader.dateFormat;return'<span class="b-selection-start">'.concat(Pl.format(t.startDate,n),'</span>\n                        <span class="b-selection-end">').concat(Pl.format(t.endDate,n),'</span>\n                        <i class=\'b-icon b-icon-close\' data-ref="closeButton" data-btip="L{Popup.close}"></i>')},selectedTimeSpan:{$config:null,value:null,default:null}}}}])}(TT.mixin(FM));S(lF,"$name","TimeSelection"),lF._$name="TimeSelection",Ug.registerFeature(lF,!1,["TimelineBase"]);var sF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onEditorKeyDown",value:(n=f(L().mark((function e(n){var r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Tab"!==n.key&&"Enter"!==n.key){e.next=20;break}if(i=(r=this).record,a=r.owner,n.preventDefault(),n.stopImmediatePropagation(),"Tab"!==n.key){e.next=12;break}if(!(o=a.getAdjacentDate(i.startDate,!n.shiftKey))){e.next=10;break}return e.next=9,r.completeEdit();case 9:a.editTickCell({id:i.resourceId},o);case 10:e.next=18;break;case 12:if("Enter"!==n.key){e.next=18;break}if(!(l=a.getAdjacentResource(i.resourceId,!n.shiftKey))){e.next=18;break}return e.next=17,r.completeEdit();case 17:a.editTickCell(l,i.startDate);case 18:e.next=21;break;case 20:B(t,"onEditorKeyDown",this,3)([n]);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]);var n}(Xk);S(sF,"$name","TickEditor"),S(sF,"type","tickeditor"),S(sF,"configurable",{appendToTargetParent:!0,cls:"b-tick-editor",inputField:{type:"numberfield",autoSelect:!0}}),sF.initClass(),sF._$name="TickEditor";var uF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeResourceTickStore",value:function(e){return Ff.getStore(e,oT)}},{key:"updateResourceTickStore",value:function(e,t){this.detachStore(t),(e=Ff.getStore(e,oT)).id||(e.id="resourceTicks"),e.storage.addIndex({property:"indexKey"}),this.attachStore(e)}},{key:"detachStore",value:function(e){e&&this.detachListeners(e.$$name)}},{key:"attachStore",value:function(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"internalOnStoreChange",thisObj:this})}},{key:"updateResourceTicksData",value:function(e){this.resourceTickStore.data=e}},{key:"updateClient",value:function(e){e.ion({scheduleDblClick:"onTimeAxisCellDblClick",thisObj:this})}},{key:"getEventsToRender",value:function(e,t){var n=this.client.timeAxis;if(!this.disabled)for(var r=Math.floor(n.getTickFromDate(n.startDate)),i=Math.ceil(n.getTickFromDate(n.endDate)),a=r;a<=i;a++){var o=n.getDateFromTick(a),l=this.getResourceTickRecord(e,o);l&&t.push(l)}return t}},{key:"shouldInclude",value:function(e){return e.isTickCell}},{key:"generateElementId",value:function(e){return"tick-cell-".concat(e.id)}},{key:"getElementFromResourceTimeRangeRecord",value:function(e){return this.canvas.syncIdMap["tick-cell-".concat(e.domId)]}},{key:"tickRenderer",value:function(e){return e.value}},{key:"onEventDataGenerated",value:function(e){var t=this,n=t.client,r=e.eventRecord;if(t.shouldInclude(r)){n.isVertical?e.width=n.getResourceWidth(e.resourceRecord):e.top=0,e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls["b-sch-style-none"]=0,e.wrapperCls["b-sch-color-none"]=0,e.cls[t.cls]=1,e.entityName=t.entityName,e.eventId=t.generateElementId(r);var i=t.tickRenderer(r);n.isVertical&&"object"!==W(i)&&(e.eventContent={text:i}),e.children=$e.asArray(i)}}},{key:"internalOnStoreChange",value:function(e){return this.client.refresh(),this.trigger("change",F(F({store:e.source},e),{},{source:this}))}},{key:"getResourceTickRecord",value:function(e,t){return this.resourceTickStore.storage.getBy("indexKey","".concat(t.getTime(),"-").concat(e.id))}},{key:"editTickCell",value:function(e,t){var n=this,r=n.client,i=n.getResourceTickRecord(e,t);i||(i=_(n.resourceTickStore.add({resourceId:e.id,startDate:t,duration:r.timeAxis.increment,durationUnit:r.timeAxis.unit}),1)[0]);var a=n.getElementFromResourceTimeRangeRecord(i);n.editor=new sF({appendTo:n.canvas,owner:n}),n.editor.startEdit({target:a,record:i,field:"value"})}},{key:"getNextDate",value:function(e){return this.getAdjacentDate(e)}},{key:"getPrevDate",value:function(e){return this.getAdjacentDate(e,!1)}},{key:"getAdjacentDate",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this.client.timeAxis,r=Pl.add(e,n.increment*(t?1:-1),n.unit);return r>=n.startDate&&r<n.endDate?r:null}},{key:"getNextResource",value:function(e){return this.getAdjacentResource(e)}},{key:"getPrevResource",value:function(e){return this.getAdjacentResource(e,!1)}},{key:"getAdjacentResource",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1];return e=this.client.store.getById(e),this.client.store[t?"getNext":"getPrev"](e)}},{key:"onTimeAxisCellDblClick",value:function(e){var t=e.resourceRecord,n=e.tickStartDate;this.showEditor&&this.editTickCell(t,n)}}])}(DT);S(uF,"$name","TickCells"),S(uF,"configurable",{resourceTickStore:{},entityName:"tickCell",rangeCls:"b-sch-tick-cell",cls:"",resourceTicksData:null,showEditor:!0}),uF._$name="TickCells",Ug.registerFeature(uF,!1,["Scheduler","SchedulerPro","Gantt"]);var cF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeRenderer",value:function(e){if(!e)throw new Error("The TreeSummary feature requires defining a `renderer` function");return e}},{key:"onInternalPaint",value:function(e){var n=this,r=e.firstPaint;B(t,"onInternalPaint",this,3)(arguments),r&&this.client.ion({treeGroupChange:function(){return n.updateResourceTickCell()}})}},{key:"attachToEventStore",value:function(e){e.ion({name:"eventStore",change:"onEventStoreChange",buffer:1,thisObj:this})}},{key:"attachToResourceStore",value:function(e){e.ion({name:"resourceStore",change:"onResourceStoreChange",buffer:1,thisObj:this})}},{key:"doDisable",value:function(e){B(t,"doDisable",this,3)([e]),this.isConfiguring||this.client.renderRows()}},{key:"internalOnVisibleDateRangeChange",value:function(){this.disabled||this.updateResourceTickCell()}},{key:"onEventStoreChange",value:(r=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.project.commitAsync();case 2:this.disabled||this.updateResourceTickCell();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"onResourceStoreChange",value:(n=f((function(e){var t=this,n=e.action,r=e.records;return L().mark((function e(){var a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.client.project.commitAsync();case 2:t.disabled||("remove"===n||n===i?t.updateResourceTickCell():(a=new o,r.forEach((function(e){e.bubble((function(t){return a.add(t),!e.isParent}))})),t.updateResourceTickCell(a,!1)));case 3:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"updateDisabled",value:function(e){this.isConfiguring||(e?this.resourceTickStore.removeAll():this.updateResourceTickCell())}},{key:"updateResourceTickCell",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:null,t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n.client,a=n.resourceTickStore,o=r.timeAxis,l=r.visibleDateRange;if(!n.disabled){var s=Math.floor(o.getTickFromDate(l.startDate)),u=Math.ceil(o.getTickFromDate(l.endDate)),c=[];if((e&&0!==e.size?e:r.store.storage.allValues).forEach((function(e){if(null!=e&&e.isParent)for(var t=s;t<u;t++){var i=o.getDateFromTick(t),a=o.getDateFromTick(t+1),l=n.renderer({startDate:i,endDate:a,resourceRecord:e,eventStore:r.eventStore,resourceStore:r.resourceStore,timeline:r});(l||0===l)&&c.push({id:"".concat(t,"-").concat(e.id),startDate:i,endDate:a,value:l,resourceId:e.id})}})),t)n.resourceTicksData=c;else{var d,h=a.storage.allValues,f=[],v=D(e);try{for(v.s();!(d=v.n()).done;){var g,m=d.value,p=D(h);try{for(p.s();!(g=p.n()).done;){var y=g.value;y.resourceId===m.id&&f.push(y)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){v.e(e)}finally{v.f()}r.suspendRefresh(),a.remove(f),a.add(c),r.resumeRefresh(!1),r.refresh()}}}}],[{key:"pluginConfig",get:function(){return{before:["onInternalPaint","internalOnVisibleDateRangeChange"],chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}}]);var n,r}(uF);S(cF,"$name","TreeSummary"),S(cF,"configurable",{rangeCls:"b-sch-tick-summary-cell",cls:"b-tree-summary-cell",showEditor:!1,renderer:!1,enableMouseEvents:!0}),cF._$name="TreeSummary",Ug.registerFeature(cF,!1,["Scheduler","SchedulerPro","Gantt"]);var dF={completeview:"completeview",currentview:"currentview",daterange:"daterange"},hF=function(e){return function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"cloneElement",value:function(e,n,r){var i;B(t,"cloneElement",this,3)([e,n,r]);var a=this.element.querySelector(".b-schedulerbase");null==a||(i=a.classList).remove.apply(i,z(["fade-in","slide-from-left","slide-from-top","zoom-in"].map((function(e){return"b-initial-".concat(e)}))))}},{key:"prepareComponent",value:(o=f(L().mark((function e(n){var r,i,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this,i=n.client,o=i.isVertical,l=i.timeAxisSubGrid.width>0,e.t0=n.scheduleRange,e.next=e.t0===dF.completeview?4:e.t0===dF.currentview?7:11;break;case 4:return n.rangeStart=i.startDate,n.rangeEnd=i.endDate,e.abrupt("break",11);case 7:return s=i.visibleDateRange,u=s.startDate,c=s.endDate,n.rangeStart=u,n.rangeEnd=c,e.abrupt("break",11);case 11:return e.next=13,i.waitForAnimations();case 13:return n.infiniteScroll=i.infiniteScroll,i.infiniteScroll=!1,l&&(n.scheduleRange!==dF.currentview&&i.setTimeSpan(n.rangeStart,n.rangeEnd),n.scheduleRange===dF.daterange&&(n.rangeStart=i.startDate,n.rangeEnd=i.endDate),i.svgCanvas),r._oldEnableEventAnimations=i.enableEventAnimations,i.enableEventAnimations=!1,e.next=20,B(t,"prepareComponent",this,3)([n]);case 20:if(d=r.exportMeta,h=r.element,f=h.querySelector(".b-sch-foreground-canvas"),v=h.querySelector(".b-resource-time-range-canvas"),g=h.querySelector(".b-".concat(o?"vertical":"horizontal","timeaxis")),m=d.subGrids.normal,li.forEachSelector(h,".b-sch-canvas",(function(e){var t,n="",r=D(e.classList.values());try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=".".concat(a)}}catch(e){r.e(e)}finally{r.f()}var o=i.element.querySelector(n);o&&o.clientWidth&&(e.style.width="".concat(o.clientWidth,"px"))})),d.includeTimeline=l,d.timeAxisHeaders=[],d.timeAxisPlaceholders=[],d.headersCollected=!1,d.eventsBoxes=new a,d.resourceTimeRangesMap=new a,d.eventsMap=new a,d.verticalTimeAxisMargin=0,d.isHorizontal=!o,d.client=i,l&&(n.scheduleRange!==dF.completeview?o?(d.totalHeight=i.headerHeight+i.getTimeSpanDistance(n.rangeStart,n.rangeEnd)+i.footerHeight,d.verticalTimeAxisMargin=-1*i.getCoordinateFromDate(n.rangeStart)):(d.totalWidth-=m.width,d.totalWidth+=m.width=i.timeAxisViewModel.getDistanceBetweenDates(n.rangeStart,n.rangeEnd),r.isMultiPageExporter&&(p=Math.ceil(d.totalWidth/d.pageWidth),y=p*d.verticalPages,d.horizontalPages=p,d.totalPages=y),m.scrollLeft=i.getCoordinateFromDate(n.rangeStart)):o&&(d.totalHeight=i.headerHeight+i.timeAxisViewModel.totalSize+i.footerHeight)),l){e.next=35;break}return e.abrupt("return");case 35:li.forEachSelector(g,".b-sch-header-row",(function(e){d.timeAxisPlaceholders.push(r.createPlaceholder(e)),d.timeAxisHeaders.push(new a)})),d.eventsPlaceholder=r.createPlaceholder(f,!1),li.removeEachSelector(f,".b-sch-event-wrap"),li.removeEachSelector(r.element,".b-released"),v&&(d.resourceTimeRangesPlaceholder=r.createPlaceholder(v,!1),li.removeEachSelector(v,".b-sch-resourcetimerange")),k=h.querySelector(".b-column-lines-canvas"),b=h.querySelector(".b-timeranges-header-canvas"),C=h.querySelector(".b-timeranges-body-canvas"),i.hasActiveFeature("columnLines")&&k&&(d.columnLinesPlaceholder=r.createPlaceholder(k),d.columnLines=""),C&&Object.values(i.features).some((function(e){return e instanceof TT}))&&(d.timeRanges={},b&&(d.timeRanges.header="",d.timeRangesHeaderPlaceholder=r.createPlaceholder(b)),d.timeRanges.body="",d.timeRangesBodyPlaceholder=r.createPlaceholder(C)),i.hasActiveFeature("dependencies")&&(i.features.dependencies.fillDrawingCache(),(w=h.querySelector('[id="'.concat(i.svgCanvas.getAttribute("id"),'"]')))&&(d.dependenciesPlaceholder=r.createPlaceholder(w,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),li.removeEachSelector(w,".b-sch-dependency")));case 44:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"restoreComponent",value:(i=f(L().mark((function e(n){var r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=n.client).infiniteScroll=n.infiniteScroll,r.enableEventAnimations=this._oldEnableEventAnimations,e.next=5,B(t,"restoreComponent",this,3)([n]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onRowsCollected",value:(r=f(L().mark((function e(n,r){var i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,e.next=3,B(t,"onRowsCollected",this,3)([n,r]);case 3:i.exportMeta.includeTimeline&&(a=i.getCurrentPageDateRange(r),o=a.pageRangeStart,l=a.pageRangeEnd,o&&l&&(i.renderTimeAxisHeaders(r,o,l),i.renderResourceHeaders(r),i.renderLines(r,o,l),i.renderRanges(r,o,l),i.renderEvents(r,n,o,l)));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"stateNextPage",value:(n=f(L().mark((function e(n){var r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=B(t,"stateNextPage",this,3))||void 0===r?void 0:r([n]);case 2:(a=this).exportMeta.eventsBoxes.clear(),a.exportMeta.eventsMap.clear(),null===(i=a.exportMeta.rowsMap)||void 0===i||i.clear(),a.exportMeta.resourceTimeRangesMap.clear(),a.exportMeta.timeAxisHeaders.forEach((function(e){return e.clear()})),a.exportMeta.columnLines="",a.exportMeta.timeRanges={};case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getCurrentPageDateRange",value:function(e){var t,n,r=e.rangeStart,i=e.rangeEnd,a=e.client,o=this.exportMeta,l=o.horizontalPages,s=o.horizontalPosition,u=o.pageWidth,c=o.subGrids;if(l>1){var d=s*u,h=(s+1)*u,f=c.locked.width+c.locked.splitterWidth;if(h<=f)n=t=null;else{var v=c.normal.scrollLeft,g=void 0===v?0:v;t=a.getDateFromCoordinate(Math.max(d-f+g,0)),n=a.getDateFromCoordinate(h-f+g)||i}}else t=r,n=i;return{pageRangeStart:t,pageRangeEnd:n}}},{key:"prepareExportElement",value:function(){var e=this.element,n=this.exportMeta.subGrids.normal,r=n.id,i=n.headerId,a=n.footerId,o=n.scrollLeft;return e.querySelector('[id="'.concat(r,'"]')).querySelectorAll(".b-sch-canvas").forEach((function(e){e.style.height="",o&&(e.style.marginInlineStart="-".concat(o,"px"))})),o&&[i,a].forEach((function(t){var n=e.querySelector('[id="'.concat(t,'"] .b-widget-scroller'));n&&(n.style.marginInlineStart="-".concat(o,"px"))})),B(t,"prepareExportElement",this,3)([])}},{key:"renderTimeAxisHeaders",value:function(e,t,n){var r=this.exportMeta,i=e.client,a=r.isHorizontal,o=r.timeAxisHeaders,l=(a?i.timeAxisColumn.timeAxisView:i.verticalTimeAxisColumn.view).buildCells(t,n),s=document.createElement("div");fa.sync({targetElement:s,domConfig:l}),li.forEachSelector(s,".b-sch-header-row",(function(e,t){var n=o[t];li.forEachSelector(e,".b-sch-header-timeaxis-cell",(function(e){n.has(e.dataset.tickIndex)||n.set(e.dataset.tickIndex,e.outerHTML)}))}))}},{key:"renderResourceHeaders",value:function(e){var t=e.client;if(!t.isHorizontal){var n=this.exportMeta,r=t.timeAxisColumn.resourceColumns.renderResourceHeaders(0,t.resourceStore.allResourceRecords.length-1),i=document.createElement("div");fa.sync({targetElement:i,domConfig:{onlyChildren:!0,children:r}}),n.resourceHeaders=i.innerHTML}}},{key:"renderEvents",value:function(e,t,n,r){var i=e.client,a=this.exportMeta,o=a.isHorizontal,l=a.eventsMap,s=a.eventsBoxes,u=a.resourceTimeRangesMap,c=li.createElement({parent:document.body,style:"visibility:hidden;",children:[{tag:"div"}]}),d=c.firstChild;if(o){var h,f=D(t);try{for(f.s();!(h=f.n()).done;){var v,g=h.value,m=i.store.getAt(g.dataIndex),p=i.currentOrientation.getResourceLayout(m),y=i.getCoordinateFromDate(n),k=i.getCoordinateFromDate(r),b=D(i.currentOrientation.getEventDOMConfigForCurrentView(p,g,i.rtl?k:y,i.rtl?y:k));try{for(b.s();!(v=b.n()).done;){var C=v.value,w=C.dataset.eventId,S=C.style,x=S.insetInlineStart,E=S.insetBlockStart,R=S.width,T=S.height;fa.sync({targetElement:d,domConfig:C,callback:function(e){var t=e.action,n=e.domConfig,r=e.lastDomConfig,a=e.targetElement,o=e.jsx;return LR(i,!1,{action:t,domConfig:n,lastDomConfig:r,targetElement:a,jsx:o})}});var M=String(w);"resourceTimeRange"===C.elementData.entityName?u.set(M,d.outerHTML):(s.set(M,new pt(x,E,R,T)),l.set(M,d.outerHTML))}}catch(e){b.e(e)}finally{b.f()}}}catch(e){f.e(e)}finally{f.f()}}else i.resources.forEach((function(e){var t,a=D(i.vertical.renderResource(e,n,r));try{for(a.s();!(t=a.n()).done;){var o=t.value,c=o.dataset.eventId,h=o.style,f=h.left,v=h.width,g=h.height,m=h.fontSize,p=o.style.top;fa.sync({targetElement:d,domConfig:o,callback:function(e){var t=e.action,n=e.domConfig,r=e.lastDomConfig,a=e.targetElement,o=e.jsx;return NR(i,!1,{action:t,domConfig:n,lastDomConfig:r,targetElement:a,jsx:o})}}),"resourceTimeRange"===o.elementData.renderData.entityName?u.set(String(c),d.outerHTML):(l.set(c,d.outerHTML),s.set(String(c),new pt(f,p,v,"string"==typeof g?m:g)))}}catch(e){a.e(e)}finally{a.f()}}));c.remove()}},{key:"renderLines",value:function(e,t,n){var r=e.client,i=this.exportMeta;if(i.columnLinesPlaceholder){var a=r.features.columnLines.getColumnLinesDOMConfig(t,n,0,r.resourceStore.allResourceRecords.length-1),o=document.createElement("div");fa.sync({targetElement:o,domConfig:{onlyChildren:!0,children:a}}),i.columnLines=o.innerHTML}}},{key:"renderRanges",value:function(e,t,n){var r=e.client,i=this.exportMeta.timeRanges;if(i){i.body=i.header="";var a,o=D(Object.values(r.features).filter((function(e){return e instanceof TT})));try{var l=function(){var e=a.value.getDOMConfig(t,n),r=document.createElement("div");e.forEach((function(e,t){fa.sync({targetElement:r,domConfig:{children:e,onlyChildren:!0}}),0===t?i.body+=r.innerHTML:i.header+=r.innerHTML}))};for(o.s();!(a=o.n()).done;)l()}catch(e){o.e(e)}finally{o.f()}}}},{key:"buildPageHtml",value:function(){var e=this,t=e.exportMeta,n=t.subGrids,r=t.timeAxisHeaders,i=t.timeAxisPlaceholders,a=t.eventsMap,o=t.eventsPlaceholder,l=t.resourceTimeRangesMap,s=t.resourceHeaders,u=t.resourceHeaderPlaceholder,c=t.columnLines,d=t.columnLinesPlaceholder,h=t.timeRanges,f=t.timeRangesHeaderPlaceholder,v=t.timeRangesBodyPlaceholder,g=t.resourceTimeRangesPlaceholder,m=t.isHorizontal,p=e.prepareExportElement();return m&&Object.values(n).forEach((function(e){var t=e.placeHolder,n=e.rows,r=e.mergedCellsHtml,i=t.outerHTML,a=n.join("");null!=r&&r.length&&(a+='<div class="b-grid-merged-cells-container">'.concat(r.join(""),"</div>")),p=p.replace(i,a)})),o&&(p=p.replace(o.outerHTML,Array.from(a.values()).join(""))),g&&(p=p.replace(g.outerHTML,Array.from(l.values()).join(""))),u&&(p=p.replace(u.outerHTML,s)),r.forEach((function(e,t){p=p.replace(i[t].outerHTML,Array.from(e.values()).join(""))})),c&&(p=p.replace(d.outerHTML,c)),h&&v&&(p=p.replace(v.outerHTML,h.body),f&&(p=p.replace(f.outerHTML,h.header))),p=e.buildDependenciesHtml(p)}},{key:"getEventBox",value:function(e,t){var n=this.exportMeta,r=n.client,i=n.eventsBoxes,a=n.currentPageFirstRowIndex,o=n.exactGridHeight,l=n.totalHeight,s=r.resourceColumnWidth,u=r.rowHeight,c=r.isHorizontal,d=r.resourceStore,h=e&&i.get(String(e.id));if(h&&e.isMilestone&&h.translate(-h.width/2,0),!h){var f=e.assignments.reduce((function(e,t){var n=t.resource;return e=null===e?d.indexOf(n):Math.max(e,d.indexOf(n))}),null);h=c?new pt(0,f<a?2*-u:o+u,10,u):new pt(f*s,l+u,s,u)}return h}},{key:"renderDependencies",value:function(){var e=this,t=e.exportMeta,n=t.client,r=t.eventsBoxes,i=n.dependencies,a=n.features.dependencies,o=li.createElement(),l=!1;return i.forEach((function(t){var n,i;if((r.has(String(null===(n=t.fromEvent)||void 0===n?void 0:n.id))||r.has(String(null===(i=t.toEvent)||void 0===i?void 0:i.id)))&&a.isDependencyVisible(t)){var o=e.getEventBox(t.fromEvent,t),s=e.getEventBox(t.toEvent,t);a.drawDependency(t,!0,{from:null==o?void 0:o.clone(),to:null==s?void 0:s.clone()}),l=!0}})),l&&a.domSync(o,!0),o.innerHTML}},{key:"buildDependenciesHtml",value:function(e){var t=this.exportMeta,n=t.dependenciesPlaceholder,r=t.includeTimeline;if(n&&r){var i=n.outerHTML;e=e.replace(i,this.renderDependencies())}return e}}]);var n,r,i,o}(e)},fF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"stateNextPage",value:(n=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"stateNextPage",this,3)([n]);case 2:this.exportMeta.eventsBoxes.clear();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]);var n}(hF(_m));S(fF,"isHorizontal",!0),S(fF,"$name","MultiPageExporter"),S(fF,"type","multipage"),fF._$name="MultiPageExporter";var vF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"prepareComponent",value:(n=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:n.scheduleRange!==dF.completeview&&this.estimateTotalPages(n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]);var n}(hF(Hm));S(vF,"isHorizontal",!0),S(vF,"$name","MultiPageVerticalExporter"),S(vF,"type","multipagevertical"),vF._$name="MultiPageVerticalExporter";var gF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultConfig",get:function(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems:function(){return Object.entries(dF).map((function(e){var t=_(e,2);return{value:t[0],text:"L{"+t[1]+"}"}}))}}}}])}(dv);S(gF,"$name","ScheduleRangeCombo"),S(gF,"type","schedulerangecombo"),gF.initClass(),gF._$name="ScheduleRangeCombo";var mF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onLocaleChange",value:function(){var e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.items.forEach((function(t){t instanceof Uf?t.labelWidth=e:"rangesContainer"===t.ref&&(t.items[0].width=e)}))}},{key:"applyInitialValues",value:function(e){B(t,"applyInitialValues",this,3)([e]);var n=e.client,r=e.scheduleRange,i=e.items=e.items||{},a=i.scheduleRangeField=i.scheduleRangeField||{},o=i.rangesContainer=i.rangesContainer||{},l=o.items=o.items||{},s=l.filler=l.filler||{},u=l.rangeStartField=l.rangeStartField||{},c=l.rangeEndField=l.rangeEndField||{};s.width=this.L("L{labelWidth}"),a.value=a.value||r,a.value===dF.daterange&&(o.hidden=!1);var d=u.value=u.value||n.startDate;u.max=Pl.max(n.startDate,Pl.add(n.endDate,-1,"d"));var h=c.value||n.endDate;h<=d&&(h=Pl.add(d,1,"d")),c.value=h,c.min=Pl.min(n.endDate,Pl.add(n.startDate,1,"d"))}}],[{key:"configurable",get:function(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",name:"scheduleRange",value:"completeview",weight:150,onChange:function(e){var t=e.value;this.parent.widgetMap.rangesContainer.hidden=t!==dF.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",name:"rangeStart",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange:function(e){var t=e.value;this.parent.widgetMap.rangeEndField.min=t?Pl.add(t,1,"d"):null}},rangeEndField:{type:"datefield",label:"L{Export to}",name:"rangeEnd",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange:function(e){var t=e.value;this.parent.widgetMap.rangeStartField.max=t?Pl.add(t,-1,"d"):null}}}}}}}}])}(jm);S(mF,"$name","SchedulerExportDialog"),S(mF,"type","schedulerexportdialog"),mF._$name="SchedulerExportDialog";var pF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(hF(Bm));S(pF,"isHorizontal",!0),S(pF,"$name","SinglePageExporter"),S(pF,"type","singlepage"),pF._$name="SinglePageExporter";var yF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"cloneElement",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:this.element,r=!(arguments.length>2&&arguments[2]!==i)||arguments[2];B(t,"cloneElement",this,3)([e,n,r])}},{key:"prepareComponent",value:(r=f(L().mark((function e(n){var r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:r=this.exportMeta,i=this.element,a=n.client.timeAxisColumn.resourceColumns,r.resourceHeaderPlaceholder=this.createPlaceholder(i.querySelector("#".concat(a.id))),r.resourceHeaders="";case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onRowsCollected",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]);var n,r}(Om);S(yF,"isHorizontal",!1),yF._$name="VerticalExporter";var kF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"prepareComponent",value:(r=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"renderPage",value:(n=f(L().mark((function e(t){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.exportMeta.totalHeight,e.next=3,this.onRowsCollected([],t);case 3:return this.exportMeta.exactGridHeight=n,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"buildPageHtml",value:function(e){var n=this.exportMeta.subGrids,r=B(t,"buildPageHtml",this,3)([e]);return Object.values(n).forEach((function(e){var t=e.placeHolder.outerHTML;r=r.replace(t,"")})),r}}],[{key:"title",get:function(){return this.localize("L{SinglePageExporter.singlepage}")}}]);var n,r}(hF(yF));S(kF,"$name","SinglePageExporterVertical"),S(kF,"type","verticalsinglepage"),S(kF,"configurable",{centerContentHorizontally:!1}),kF.prototype.pagesExtractor=function(){var e=U(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,g,m,p,y,k,b,C,w;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,r=t.client,i=n.exportMeta,a=i.totalWidth,o=i.verticalTimeAxisMargin,l=n.stylesheets,s=t.orientation===Mm.portrait,u=Em[t.paperFormat],c=n.getPaperWidth(u,s),d=n.getPaperHeight(u,s),e.next=3,v(n.renderPage(t));case 3:return h=e.sent,t.headerTpl&&(f=n.prepareHTML(t.headerTpl({totalWidth:a})),m=n.measureElement(f,"b-export-header"),h+=m),t.footerTpl&&(g=n.prepareHTML(t.footerTpl({totalWidth:a})),p=n.measureElement(g,"b-export-footer"),h+=p),y=n.buildPageHtml(t),k=h,b=Math.min(1,n.getScaleValue(n.inchToPx(c),a)),C=Math.min(1,n.getScaleValue(n.inchToPx(d),h)),w=Math.min(b,C),l.push("<style>\n                #".concat(r.id," {\n                    height: ").concat(k,"px !important;\n                    width: ").concat(a,"px !important;\n                }\n                .b-verticaltimeaxiscolumn {\n                    margin-top: ").concat(o,"px;\n                }\n                .b-page-wrap {\n                    width: ").concat(c,"in;\n                    height: ").concat(d,"in;\n                    ").concat(n.centerContentHorizontally?"display: flex; justify-content: center":"","\n                }\n                .b-print .b-export-content {\n                    scale: ").concat(w,";\n                    transform-origin: top left;\n                    height: calc(100% / ").concat(w,");\n                    width: calc(100% / ").concat(w,");\n                }\n            </style>")),e.next=10,{html:n.pageTpl({html:y,header:f,footer:g,styles:l,paperWidth:c,paperHeight:d,currentPage:0})};case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),kF._$name="SinglePageExporterVertical";var bF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"calculateScale",value:function(){var e=this.exportMeta;return e.scale=this.getScaleValue(e.pageWidth,e.totalWidth)}},{key:"estimateTotalPages",value:function(e){var t,n=this,r=n.exportMeta,i=e.client,a=e.headerTpl,o=e.footerTpl,l=e.repeatHeader,s=e.rangeStart,u=e.rangeEnd,c=r.pageHeight,d=i.timeAxisViewModel.getDistanceBetweenDates(s,u),h=(u-s)/d,f=r.totalWidth=i.timeAxisColumn.resourceColumns.totalWidth+i.subGrids.locked.width+(null===(t=i.subGrids.locked.splitterElement)||void 0===t?void 0:t.offsetWidth)||0,v=n.calculateScale(),g=r.totalHeight=d+i.headerHeight+i.footerHeight,m=c/v;a&&(m-=n.measureElement(a({totalWidth:f,totalPages:-1,currentPage:-1}),"b-export-header")),o&&(m-=n.measureElement(o({totalWidth:f,totalPages:-1,currentPage:-1}),"b-export-footer")),l&&(g-=i.headerHeight);var p=Math.ceil(g/m);l&&(g+=i.headerHeight*p,p=Math.ceil(g/m)),Object.assign(r,{scale:v,contentHeight:m,totalWidth:f,totalHeight:g,verticalPages:p,msPerPixel:h,initialScroll:0,horizontalPages:1,totalPages:p,currentPage:0,firstTickTop:0})}},{key:"stateNextPage",value:(a=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return++this.exportMeta.currentPage,++this.exportMeta.verticalPosition,e.next=4,B(t,"stateNextPage",this,3)([n]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"prepareComponent",value:(i=f(L().mark((function e(n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,"prepareComponent",this,3)([n]);case 2:this.estimateTotalPages(n),this.exportMeta.pageRangeStart=n.rangeStart,this.exportMeta.exactGridHeight=this.exportMeta.totalHeight;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"renderRows",value:(r=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).exportMeta,i=t.client,a=t.rangeEnd,o=t.repeatHeader,l=r.currentPage,s=r.contentHeight,u=r.msPerPixel,c=r.pageRangeStart,d=s,(0===l||o)&&(d-=i.headerHeight),h=d*u,r.firstTickTop=i.timeAxisViewModel.getPositionFromDate(c),r.pageRangeEnd=Pl.min(new Date(c.getTime()+h),a),e.next=8,n.onRowsCollected([],t);case 8:r.pageRangeEnd.getTime()<a.getTime()&&(f=Math.floor(i.timeAxis.getTickFromDate(r.pageRangeEnd,!0)),r.pageRangeStart=i.timeAxis.getAt(f).startDate);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getCurrentPageDateRange",value:function(){return{pageRangeStart:this.exportMeta.pageRangeStart,pageRangeEnd:this.exportMeta.pageRangeEnd}}},{key:"buildPage",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).exportMeta,i=t.headerTpl,a=t.footerTpl,o=r.totalWidth,l=r.totalPages,s=r.currentPage,u=r.subGrids,Object.values(u).forEach((function(e){return e.rows=[]})),i&&(c=n.prepareHTML(i({totalWidth:o,totalPages:l,currentPage:s}))),a&&(d=n.prepareHTML(a({totalWidth:o,totalPages:l,currentPage:s}))),e.next=6,n.renderRows(t);case 6:return h=n.buildPageHtml(t),e.abrupt("return",{html:h,header:c,footer:d});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"title",get:function(){return this.localize("L{MultiPageVerticalExporter.multipagevertical}")}}]);var n,r,i,a}(hF(yF));S(bF,"$name","MultiPageVerticalExporterVertical"),S(bF,"type","verticalmultipagevertical"),bF.prototype.pagesExtractor=function(){var e=U(L().mark((function e(t){var n,r,i,a,o,l,s,u,c,d,h,f,g,m,p,y,k,b,C,w;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(n=this).exportMeta,i=n.stylesheets,a=r.totalPages,o=r.totalWidth,l=r.paperWidth,s=r.paperHeight,u=r.realPaperWidth,c=r.realPaperHeight,d=r.title;case 1:if(!((h=r.currentPage)<a)){e.next=21;break}return n.trigger("exportStep",{text:vF.L(vF.exportingPageText,{currentPage:h,totalPages:a}),progress:Math.round((h+1)/a*90)}),e.next=5,v(n.buildPage(t));case 5:return g=e.sent,m=g.html,p=g.header,y=g.footer,k=n.exportMeta,b=k.scale,C=k.firstTickTop,f="\n            .b-page-".concat(h," .b-grid-vertical-scroller {\n                margin-top: -").concat(C,"px\n            }\n            .b-page-").concat(h," #").concat(t.client.id," {\n                height: ").concat(r.exactGridHeight,"px !important;\n                width: ").concat(o,"px !important;\n            }\n            .b-page-wrap {\n                width: ").concat(u,"in;\n                height: ").concat(c,"in;\n            }\n            .b-print .b-export-viewport {\n                scale: ").concat(b,";\n                transform-origin: top left;\n                height: calc(100% / ").concat(b,");\n                width: calc(100% / ").concat(b,");\n            }\n        "),f=t.repeatHeader?"\n                ".concat(f,"\n                .b-export-body {\n                    height: 100%;\n                    display: flex;\n                }\n                .b-export-viewport {\n                    height: 100%;\n                }\n            "):"\n                ".concat(f,"\n                ").concat(0===h?"":".b-page-".concat(h," .b-grid-header-container {\n                    display: none;\n                }"),"\n                .b-export-body {\n                    overflow: hidden;\n                }\n            "),w=[].concat(z(i),["<style>".concat(f,"</style>")]),e.next=17,v(n.stateNextPage(t));case 17:return e.next=19,{html:n.pageTpl({html:m,title:d,header:p,footer:y,styles:w,paperWidth:l,paperHeight:s,realPaperWidth:u,realPaperHeight:c,currentPage:h})};case 19:e.next=1;break;case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),bF._$name="MultiPageVerticalExporterVertical";var CF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"defaultExportDialogConfig",get:function(){var e=Be.copyProperties(B(t,"defaultExportDialogConfig",this,1),this,["scheduleRange"]),n=this.client.isHorizontal;return n||(e.items.exporterTypeField.value="verticalsinglepage"),Be.merge(e,{items:{columnsField:{hidden:!n},rowsRangeField:{hidden:!n},alignRowsField:{hidden:!n}}}),e.exporters=e.exporters.filter((function(e){return e.isHorizontal===n})),e}},{key:"buildExportConfig",value:function(e){e=B(t,"buildExportConfig",this,3)([e]);var n=this.scheduleRange,r=this.rangeStart,i=this.rangeEnd;return e.columns&&!e.columns.find((function(e){return"timeAxis"===e.type}))&&e.columns.push(e.client.timeAxisColumn.id),Be.assign({scheduleRange:n,rangeStart:r,rangeEnd:i},e)}}],[{key:"defaultConfig",get:function(){return{exporters:[pF,fF,vF,kF,bF],dialogClass:mF,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}}])}($m);S(CF,"$name","PdfExport"),CF._$name="PdfExport",Ug.registerFeature(CF,!1,"Scheduler");var wF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Gm(CF));S(wF,"$name","Print"),wF._$name="Print",Ug.registerFeature(wF,!1,"Scheduler");var DF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];B(t,"construct",this,3)([e].concat(r)),this.eventSortFn||(this.eventSortFn=function(e,t){return e.internalId-t.internalId})}},{key:"normalizeColumns",value:function(e){e.columns=e.resourceColumns||e.columns,B(t,"normalizeColumns",this,3)([e]),e.columns=e.columns.filter((function(e){return!e.isVerticalTimeAxisColumn})),e.eventColumns=e.eventColumns.map((function(e){return"string"==typeof e?{field:e}:e}))}},{key:"generateExportData",value:function(e){var t=this,n=t.generateResourceColumns(e),r=t.target.eventStore?t.generateEventColumns(e):[];return{columns:n.concat(r),rows:t.generateRows(e)}}},{key:"generateEventColumns",value:function(e){var t=this;return e.eventColumns.map((function(n){return t.processEventColumn(n,e)}))}},{key:"generateResourceColumns",value:function(e){var n=this,r=this.target;return r instanceof JR&&r.isHorizontal?B(t,"generateColumns",this,3)([e]):e.columns.map((function(t){return n.processResourceColumn(t,e)}))}},{key:"processEventColumn",value:function(e,t){var n=e.width,r=e.minWidth,i=t.defaultColumnWidth;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}},{key:"processResourceColumn",value:function(e,t){var n=e.width,r=e.minWidth,i=t.defaultColumnWidth;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),type:this.getColumnType(e,this.target.resourceStore)}}},{key:"generateRows",value:function(e){var n,r=this,i=r.target;if(!i.resourceStore||i.isGanttBase)n=B(t,"generateRows",this,3)([e]);else{if(n=[],i.resourceStore.map((function(t){var a=t.events||[];a.sort(r.eventSortFn),i.isSchedulerBase&&!a.length&&a.push(""),a.forEach((function(a){(""===a||i.eventStore.isAvailable(a)&&(e.includeEventsOutsideTimeAxis||a.isScheduled&&i.intersectsVisibleTimeSpan(a)))&&n.push(r.getRowData(e,t,a))}))})),e.includeUnassigned&&e.eventColumns.length){var a=i.eventStore.query((function(e){return!e.resources.length}));if(a.length){var o=new Array(e.columns.length).fill("");o.push(r.L("L{ExcelExporter.No resource assigned}")),n.push(o),a.forEach((function(t){return n.push(r.getRowData(e,null,t))}))}}n=n.filter((function(e){return e.length}))}return n}},{key:"getRowData",value:function(e,t,n){var r=e.columns,i=e.eventColumns,a=[],o=this.processRecord(t,r,e);if(o&&a.push.apply(a,z(o)),!t||!t.isSpecialRow){var l=this.processRecord(n,i,e);l&&a.push.apply(a,z(l))}return a}}])}(Ya(Sw));S(DF,"configurable",{includeUnassigned:!0,includeEventsOutsideTimeAxis:null,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140,type:"date"},{text:"Ends",field:"endDate",width:140,type:"date"}],resourceColumns:null,eventSortFn:null}),DF._$name="ScheduleTableExporter";var SF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Tw);S(SF,"$name","ExcelExporter"),S(SF,"configurable",{exporterClass:DF,exporterConfig:null}),SF._$name="ExcelExporter",Ug.registerFeature(SF,!1,["Scheduler"]);var xF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(JR);S(xF,"$name","Scheduler"),S(xF,"type","scheduler"),xF.initClass(),xF._$name="Scheduler";var EF=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"beforeRenderRow",value:function(e){var n,r=e.record;return null!==(n=this.recordIsReadyForRendering)&&void 0!==n&&n.call(this,r)&&this.unscheduleRecordRefresh(r),B(t,"beforeRenderRow",this,3)(arguments)}},{key:"cleanupScheduledRecord",value:function(){for(var e=this.rowManager,t=this.store,n=0,r=z(this.recordsToRefresh);n<r.length;n++){var i=r[n];i.stores.includes(t)&&e.getRowById(i)||this.recordsToRefresh.delete(i)}}},{key:"renderScheduledRecords",value:function(){var e=this;if(e.refreshSuspended)e.scheduleRecordRefresh();else{e.cleanupScheduledRecord();var t=e.rowManager,n=z(e.recordsToRefresh),r=n.map((function(e){return t.getRowById(e)}));r.length&&(t.renderRows(r),e.trigger("scheduledRecordsRender",{records:n,rows:r})),e.recordsToRefresh.size&&e.scheduleRecordRefresh()}}},{key:"unscheduleRecordRefresh",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=this;!0===e?t.recordsToRefresh.clear():e&&$e.asArray(e).forEach((function(e){return t.recordsToRefresh.delete(e)})),t.scheduledRecordsRefreshTimer&&!t.recordsToRefresh.size&&t.clearTimeout(t.scheduledRecordsRefreshTimer)}},{key:"scheduleRecordRefresh",value:function(e){var t=this;e&&$e.asArray(e).forEach((function(e){return t.recordsToRefresh.add(e)})),t.scheduledRecordsRefreshTimer=t.setTimeout({fn:"renderScheduledRecords",delay:t.scheduledRecordsRefreshTimeout,cancelOutstanding:!0})}},{key:"widgetClass",get:function(){}}],[{key:"properties",get:function(){return{recordsToRefresh:new o}}}])}(e||Mn),S(t,"$name","DelayedRecordsRendering"),S(t,"configurable",{scheduledRecordsRefreshTimeout:15}),t},RF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([]),this.client=e}},{key:"init",value:function(){}},{key:"onTimeAxisViewModelUpdate",value:function(){var e=this.client.timeAxisSubGrid.scrollable;this.updateFromHorizontalScroll(e.x)}},{key:"updateFromHorizontalScroll",value:function(e){var t=this,n=t.client,r=t.scrollBuffer,i=n.timeAxisSubGrid,a=n.timeAxis,o=n.rtl,l=i.width,s=n.timeAxisViewModel.totalSize,u=e,c=0!==i.scrollable.maxX&&Math.abs(i.scrollable.maxX)<=Math.round(u)+5,d=n.getDateFromVirtualCoord({coord:Math.max(0,u-r)}),h=c?a.endDate:n.getDateFromVirtualCoord({coord:u+l+r})||a.endDate;if(d&&!n._viewPresetChanging){t._visibleDateRange={startDate:d,endDate:h,startMS:d.getTime(),endMS:h.getTime()},t.viewportCoords=o?{left:s-e-l+r,right:s-e-r}:{left:e-r,right:e+l+r};var f=n.timeView.range={startDate:d,endDate:h};if(n.internalOnVisibleDateRangeChange(f),!n.refreshSuspended&&n.rowManager.rows.length){if(null===n.rowManager.rows[0].id)return;(t._timeAxisStartDate-a.startDate||t._timeAxisEndDate-a.endDate)&&(t._timeAxisStartDate=a.startDate,t._timeAxisEndDate=a.endDate,n.rowManager.renderRows(n.rowManager.rows))}}}},{key:"onViewportResize",value:function(){}},{key:"refreshRows",value:function(){}},{key:"visibleDateRange",get:function(){return this._visibleDateRange}},{key:"translateToPageCoordinate",value:function(e){var t=this.client,n=t.timeAxisSubGrid.scrollable,r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}},{key:"translateToScheduleCoordinate",value:function(e){var t=this.client,n=t.timeAxisSubGrid.scrollable,i=e-t.timeAxisSubGridElement.getBoundingClientRect().left-r.scrollX;return t.rtl?i+=n.maxX-Math.abs(t.scrollLeft):i+=t.scrollLeft,i}},{key:"getDateFromXY",value:function(e,t,n){var r=arguments.length>3&&arguments[3]!==i&&arguments[3],a=this.client,o=e[0];return n||(o=this.translateToScheduleCoordinate(o)),o=a.getRtlX(o),a.timeAxisViewModel.getDateFromPosition(o,t,r)}}])}(Mn);S(RF,"configurable",{scrollBuffer:0}),RF._$name="TimelineHistogramRendering";var TF={series:null,topValue:null},MF=function(){},FF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateGetRecordData",value:function(e){this._getRecordData=e?this.resolveCallback(e):null}},{key:"updateHardRefreshOnTimeAxisReconfigure",value:function(e){var t="hardRefreshOnTimeAxisReconfigure";e?this.timeAxis.ion({name:t,endReconfigure:"onTimeAxisEndReconfigure",thisObj:this}):this.detachListeners(t)}},{key:"construct",value:function(e){B(t,"construct",this,3)([e]);var n=this;n.scheduleRefreshRows=n.createOnFrame(n.refreshRows,[],n,!0),n.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",thisObj:n})}},{key:"onDestroy",value:function(){var e;this.clearHistogramDataCache(),null===(e=this._histogramWidget)||void 0===e||e.destroy(),this.barTooltip=null}},{key:"resolveTimeSpanRecord",value:function(e){}},{key:"getScheduleMouseEventParams",value:function(e,t){return{record:this.store.getById(e.id)}}},{key:"currentOrientation",get:function(){return this._currentOrientation||(this._currentOrientation=new RF(this)),this._currentOrientation}},{key:"updateSeries",value:function(e){var t=this;t.histogramWidget.series=e,t._series=t.histogramWidget.series,t.isPainted&&!t.isConfiguring&&t.scheduleRefreshRows()}},{key:"getAsyncEventSuffixForStore",value:function(e){return e.isAbstractPartOfProjectStoreMixin?"PreCommit":""}},{key:"scheduleRefreshRows",value:function(){}},{key:"refreshRows",value:function(){this.refreshSuspended?this._refreshRequested++:this._refreshRequested=0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(t,"refreshRows",this,3)(n)}},{key:"getRowHeight",value:function(){return this.rowHeight}},{key:"onInternalPaint",value:function(e){var n=e.firstPaint;B(t,"onInternalPaint",this,3)([{firstPaint:n}]),n&&this.showBarTip&&(this.barTooltip={})}},{key:"changeBarTooltip",value:function(e,t){return null==t||t.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}},{key:"getTipHtml",value:(n=f(L().mark((function e(t){var n,r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.showBarTip||!this.barTooltipTemplate){e.next=8;break}return n=t.activeTarget,r=parseInt(n.dataset.index,10),i=this.getRecordFromElement(n),e.next=6,this.getRecordHistogramData(i);case 6:return a=e.sent,e.abrupt("return",this.barTooltipTemplate(F(F({},t),{},{datum:this.extractHistogramDataArray(a,i)[r],record:i,index:r})));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"collectTicksWidth",value:function(){for(var e=this.timeAxis.ticks,t=e[0].endDate-e[0].startDate,n={0:t},r=t,i=!0,a=1,o=e.length;a<o;a++){var l=e[a],s=l.endDate-l.startDate;t!==s&&(i=!1),r+=s,n[a]=s}if(i)this.ticksWidth=null;else{for(var u={},c=0,d=e.length;c<d;c++)u[c]=n[c]/r;this.ticksWidth=u}}},{key:"changeHistogramWidget",value:function(e){var t,n=this;e&&!e.isHistogram&&(n.getBarTextDOMConfig&&!e.getBarTextDOMConfig&&(e.getBarTextDOMConfig=n.getBarTextDOMConfig),(e=n.histogramWidgetClass.new({owner:n,appendTo:n.element,height:n.rowHeight,width:(null===(t=n.timeAxisColumn)||void 0===t?void 0:t.width)||0,getBarTip:MF,getBarClass:n.getBarClass||n.getBarClassDefault,getBarText:n.getBarText||n.getBarTextDefault,getBarDOMConfig:n.getBarDOMConfig,getOutlineClass:n.getOutlineClass,getOutlineDOMConfig:n.getOutlineDOMConfig},e)).suspendRefresh(),n.getBarTextDefault=n.getBarTextDefault.bind(e));return e}},{key:"getBarClassDefault",value:function(e,t,n){}},{key:"getBarTextDefault",value:function(e,t){}},{key:"updateShowBarTip",value:function(e){this.barTooltip=e}},{key:"onHistogramDataCacheSet",value:function(e){var t=e.record;e.data,this.scheduleRecordRefresh(t)}},{key:"onTimeAxisEndReconfigure",value:function(){this.hardRefreshOnTimeAxisReconfigure&&(this.clearHistogramDataCache(),this.scheduleRefreshRows())}},{key:"onStoreUpdateRecord",value:function(e){var n=e.record,r=e.changes,i=this;return!i.getRecordData&&i.dataModelField&&r[i.dataModelField]&&i.clearHistogramDataCache(n),B(t,"onStoreUpdateRecord",this,3)(arguments)}},{key:"onStoreRemove",value:function(e){var n=e.records;B(t,"onStoreRemove",this,3)(arguments);var r,i=D(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.clearHistogramDataCache(a)}}catch(e){i.e(e)}finally{i.f()}}},{key:"onBeforeRowHeight",value:function(e){var t=e.height;if(this._timeAxisColumn){var n=this._histogramWidget;n&&(n.height=t,n.onElementResize(n.element))}}},{key:"onTimeAxisViewModelUpdate",value:function(){B(t,"onTimeAxisViewModelUpdate",this,3)(arguments);var e=this._histogramWidget;e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element)),this.collectTicksWidth()}},{key:"extractHistogramDataArray",value:function(e,t){return e}},{key:"processRecordRenderData",value:function(e){return e}},{key:"clearHistogramDataCache",value:function(e){var t=$e.asArray(e);if(t){var n,r=D(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.histogramDataByRecord.delete(i)}}catch(e){r.e(e)}finally{r.f()}}else this.histogramDataByRecord.clear()}},{key:"setHistogramDataCache",value:function(e,t){var n={record:e,data:t};this.trigger("beforeHistogramDataCacheSet",n),this.histogramDataByRecord.set(n.record,n.data),this.trigger("histogramDataCacheSet",n)}},{key:"getHistogramDataCache",value:function(e){return e?this.histogramDataByRecord.get(e):this.histogramDataByRecord}},{key:"hasHistogramDataCache",value:function(e){return this.histogramDataByRecord.has(e)}},{key:"finalizeDataRetrievingInternal",value:function(e,t){return this.collectingDataFor.delete(e),this.setHistogramDataCache(e,t),t}},{key:"finalizeDataRetrieving",value:function(e,t){var n=this;return pe.isPromise(t)?(this.collectingDataFor.set(e,t),t.then((function(t){var r;return null===(r=n.finalizeDataRetrievingInternal)||void 0===r?void 0:r.call(n,e,t)}))):this.finalizeDataRetrievingInternal(e,t)}},{key:"getRecordHistogramData",value:function(e){var t=this,n=t.getRecordData,r=t.collectingDataFor.get(e)||t.getHistogramDataCache(e);if(!r&&!t.hasHistogramDataCache(e)){var i;if(n)r=(i=n.handler).call.apply(i,[n.thisObj].concat(Array.prototype.slice.call(arguments)));else r=e.get(t.dataModelField);r=t.finalizeDataRetrieving(e,r)}return r}},{key:"recordIsReadyForRendering",value:function(e){return!this.collectingDataFor.has(e)}},{key:"beforeRenderRow",value:function(e){var n=this,r=n.getRecordHistogramData(e.record);if(!pe.isPromise(r)){var i=r?n.extractHistogramDataArray(r,e.record):[];if(!i)return;if(n.ticksWidth)for(var a=0,o=i.length;a<o;a++)i[a].width=n.ticksWidth[a];var l=pe.merge({topValue:null},n.initialConfig.histogramWidget,{data:i,series:F({},n.series)});e=F(F({},e),{},{histogramConfig:l,histogramData:r,histogramWidget:n.histogramWidget}),n.trigger("beforeRenderHistogramRow",e),delete e.eventName,delete e.source,delete e.type,delete e.oldId,delete e.row,delete e.recordIndex,n._recordRenderData=n.processRecordRenderData(e)}B(t,"beforeRenderRow",this,3)(arguments)}},{key:"applyHistogramWidgetConfig",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.histogramWidget,t=arguments.length>1?arguments[1]:i;Object.assign(e,TF,t)}},{key:"renderRecordHistogram",value:function(e){var t=this,n=e.histogramData,r=e.cellElement;if(n){t.trigger("beforeRenderRecordHistogram",e),delete e.eventName,delete e.type,delete e.source;var i=e.histogramWidget||t.histogramWidget;t.applyHistogramWidgetConfig(i,e.histogramConfig),i.refresh({args:[e]});var a=i.element.cloneNode(!0);a.removeAttribute("id"),a.classList.remove("b-hide-offscreen"),r.innerHTML="",r.appendChild(a)}else r.innerHTML=""}},{key:"histogramRenderer",value:function(e){var t=this,n=e.histogramData||t.getRecordHistogramData(e.record);return pe.isPromise(n)?"":(Object.assign(e,t._recordRenderData),t.renderRecordHistogram.apply(t,arguments))}},{key:"buildGroupHeader",value:function(e){return e.column===this.timeAxisColumn?this.histogramRenderer(e):this.features.group.buildGroupHeader(e)}},{key:"widgetClass",get:function(){}}],[{key:"properties",get:function(){return{histogramDataByRecord:new a,collectingDataFor:new a,_refreshRequested:0}}}]);var n}(gD.mixin(EF));S(FF,"$name","TimelineHistogramBase"),S(FF,"type","timelinehistogrambase"),S(FF,"configurable",{timeCellCls:"b-sch-timeaxis-cell b-timelinehistogram-cell",mode:"horizontal",rowHeight:50,showBarTip:!1,barTooltip:null,barTooltipClass:pc,series:null,dataModelField:"histogramData",getRecordData:null,hardRefreshOnTimeAxisReconfigure:!0,getBarClass:null,getOutlineClass:function(e){return""},getOutlineDOMConfig:function(e,t,n){return t},readOnly:!0,barTooltipTemplate:null,getBarText:null,getBarDOMConfig:null,getBarTextDOMConfig:i,histogramWidgetClass:Gb,histogramWidget:{cls:"b-hide-offscreen b-timelinehistogram-histogram",omitZeroHeightBars:!0,data:[]},fixedRowHeight:!0,timeAxisColumnConfig:{type:"timeAxis",renderer:"up.histogramRenderer"}}),FF.initClass(),FF._$name="TimelineHistogramBase";var AF=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConfigure",value:function(){var e=this;e.internalAggregateDataEntry=e.internalAggregateDataEntry.bind(this),e.internalInitAggregatedDataEntry=e.internalInitAggregatedDataEntry.bind(this),B(t,"afterConfigure",this,3)([]),e.features.treeGroup&&e.features.treeGroup.ion({beforeDataLoad:e.onTreeGroupBeforeDataLoad,thisObj:e})}},{key:"updateAggregateFunctions",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=_(n[t],2),i=r[0],a=r[1];if(a.id=i,a.aliases){var o,l=D(a.aliases);try{for(l.s();!(o=l.n()).done;){e[o.value]=a}}catch(e){l.e(e)}finally{l.f()}}}}},{key:"updateStore",value:function(e){B(t,"updateStore",this,3)(arguments),this.detachListeners("store"),e&&e.ion({name:"store",group:this.onStoreGroup,sort:this.onStoreSort,thisObj:this})}},{key:"changeAggregateDataEntry",value:function(e){return this.bindCallback(e)}},{key:"changeGetDataEntryForAggregating",value:function(e){return this.bindCallback(e)}},{key:"changeInitAggregatedDataEntry",value:function(e){return this.bindCallback(e)}},{key:"onHistogramDataCacheSet",value:function(e){var n=e.record;e.data,B(t,"onHistogramDataCacheSet",this,3)(arguments),this.aggregateHistogramDataForGroups&&this.scheduleRecordParentsRefresh(n)}},{key:"onTreeGroupBeforeDataLoad",value:function(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}},{key:"onStoreGroup",value:function(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}},{key:"onStoreSort",value:function(e){var t=e.source;this.aggregateHistogramDataForGroups&&t.isGrouped&&this.resetGeneratedRecordsHistogramDataCache()}},{key:"getRecordHistogramData",value:function(e,n){var r,i=this;return i.aggregateHistogramDataForGroups&&i.isGroupRecord(e)?(r=i.collectingDataFor.get(e)||i.getHistogramDataCache(e))||i.hasHistogramDataCache(e)||(r=i.getGroupRecordHistogramData(e,n),r=i.finalizeDataRetrieving(e,r)):r=B(t,"getRecordHistogramData",this,3)(arguments),r}},{key:"internalAggregateDataEntry",value:function(e){for(var t=this.aggregateFunctions,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0,o=Object.values(this.series);a<o.length;a++){var l=o[a],s=l.id,u=l.aggregate,c=void 0===u?"sum":u,d=void 0;!1!==c&&(d=t[c].entry)&&(e=d.apply(void 0,[s,e].concat(r)))}return this.aggregateDataEntry?this.aggregateDataEntry.apply(this,[e].concat(r)):e}},{key:"internalInitAggregatedDataEntry",value:function(){for(var e=this.initAggregatedDataEntry?this.initAggregatedDataEntry.apply(this,arguments):{},t=this.aggregateFunctions,n=0,r=Object.values(this.series);n<r.length;n++){var i=r[n],a=i.id,o=i.aggregate,l=void 0===o?"sum":o,s=t[l].init;s&&!1!==l&&s.apply(void 0,[a,e].concat(Array.prototype.slice.call(arguments)))}return e}},{key:"resetGeneratedRecordsHistogramDataCache",value:function(){var e,t=this.store,n=D(this.getHistogramDataCache().keys());try{for(n.s();!(e=n.n()).done;){var r=e.value;(r.isGroupHeader||r.generatedParent||r.isLinked&&!t.includes(r))&&this.clearHistogramDataCache(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"setHistogramDataCache",value:function(e,n){if(B(t,"setHistogramDataCache",this,3)([e,n]),e.isLinked)B(t,"setHistogramDataCache",this,3)([e.$original,n]);else if(e.$links){var r,i=this.store,a=D(e.$links);try{for(a.s();!(r=a.n()).done;){var o=r.value;i.includes(o)&&B(t,"setHistogramDataCache",this,3)([o,n])}}catch(e){a.e(e)}finally{a.f()}}}},{key:"getHistogramDataCache",value:function(e){var n=B(t,"getHistogramDataCache",this,3)([e]);return!n&&e.isLinked&&(n=B(t,"getHistogramDataCache",this,3)([e.$original])),n}},{key:"getGroupRecordHistogramData",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{};t.parentRecord=e;var n=this.aggregateRecordsHistogramData(this.getGroupChildren(e),t);return pe.isPromise(n)?n.then((function(e){return e})):n}},{key:"aggregateRecordsHistogramData",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=this,a=[],o=n.parentRecord,l=!1,s=D(e);try{for(s.s();!(t=s.n()).done;){var u=t.value,c=r.getRecordHistogramData(u,n);l=l||pe.isPromise(c),c&&a.push(c)}}catch(e){s.e(e)}finally{s.f()}return l?Promise.all(a).then((function(t){return n.parentRecord=o,t=t.filter((function(e){return e})),e.length>0&&!r.isDestroyed?r.aggregateHistogramData(t,e,n):[]})):r.aggregateHistogramData(a,e,n)}},{key:"isGroupRecord",value:function(e){return e.isGroupHeader||this.isTreeGrouped&&e.generatedParent}},{key:"getGroupChildren",value:function(e){return e.groupChildren||e.children}},{key:"getRecordParent",value:function(e){return e.instanceMeta(this.store).groupParent||this.isTreeGrouped&&e.parent}},{key:"scheduleRecordParentsRefresh",value:function(e){for(var t,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=this;t=r.getRecordParent(e);)n&&r.clearHistogramDataCache(t),r.scheduleRecordRefresh(t),e=t}},{key:"aggregateHistogramData",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:{},r=this,a=r.aggregateFunctions;n.recordsData=e,n.records=t;for(var o=e.map((function(e,n){return r.extractHistogramDataArray(e,t[n])})),l=$e.aggregate(o,r.getDataEntryForAggregating||function(e){return e},r.internalAggregateDataEntry,r.internalInitAggregatedDataEntry,n),s=0,u=Object.values(r.series);s<u.length;s++){var c=u[s],d=c.id,h=c.aggregate,f=void 0===h?"sum":h,v=a[f].finalize;v&&!1!==f&&v.apply(void 0,[d,l].concat(Array.prototype.slice.call(arguments)))}return l}},{key:"widgetClass",get:function(){}}])}(e||FF),S(t,"$name","TimelineHistogramGrouping"),S(t,"configurable",{aggregateHistogramDataForGroups:!0,aggregateDataEntry:null,getDataEntryForAggregating:null,initAggregatedDataEntry:null,aggregateFunctions:{sum:{aliases:["add"],entry:function(e,t,n){return t[e]=(t[e]||0)+n[e],t}},min:{entry:function(e,t,n){var r=n[e];return r<(t[e]||Number.MAX_VALUE)&&(t[e]=r),t}},max:{entry:function(e,t,n){var r=n[e];return r>(t[e]||Number.MIN_VALUE)&&(t[e]=r),t}},count:{init:function(e,t,n,r){t[e]=r.arrays.length}},avg:{entry:function(e,t,n){return t[e]=(t[e]||0)+n[e],t},finalize:function(e,t,n,r,i){var a=i.arrays.length;t.forEach((function(t){return t[e]/=a}))}}}}),t},IF=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeScalePoints",value:function(e){return null==e||e.sort((function(e,t){return e.value-t.value})),e}},{key:"updateScalePoints",value:function(e){var t=this,n=e[e.length-1];n&&(t.scaleUnit=n.unit,t.calculateTopValueByScalePoints&&(t.histogramWidget.topValue=t.getTopValueByScalePoints(e))),t.scaleColumn&&(t.scaleColumn.scalePoints=e)}},{key:"changeColumns",value:function(e,n){var r=this.getConfig("scaleColumn");if(e&&r){var i,a=Array.isArray(e),o=e;a||(o=e.data);var l=null===(i=o)||void 0===i?void 0:i.length,s=r;o.some((function(e,t){if("scale"===e.type)return l=t,s=Be.assign(e,s),!0})),(o=o.slice())[l]=F({type:"scale"},s),a?e=o:e.data=o}return B(t,"changeColumns",this,3)([e,n])}},{key:"updateColumns",value:function(e,n){B(t,"updateColumns",this,3)([e,n]),e&&(this._scaleColumn=this.columns.find((function(e){return e.isScaleColumn})))}},{key:"onColumnsChanged",value:function(e){var n=e.action;e.changes,e.record,e.records;var r=this.scaleColumn,i=this.columns;!r||"dataset"!==n&&"batch"!==n||i.includes(r)||i.add(r,!0),B(t,"onColumnsChanged",this,3)(arguments)}},{key:"convertUnitsToHistogramValue",value:function(e,t){return e}},{key:"convertHistogramValueToUnits",value:function(e,t){return e}},{key:"extractHistogramDataArray",value:function(e,t){return e}},{key:"getTopValueByScalePoints",value:function(e){var t=this,n=t.scaleColumn,r=e[e.length-1],i=r.value,a=r.unit,o=i;return n&&(o*=1+(n.scaleWidget.scaleMaxPadding||0)),t.convertUnitsToHistogramValue(o,a||t.scaleUnit)}},{key:"processRecordRenderData",value:function(e){e=B(t,"processRecordRenderData",this,3)(arguments);var n=this.scaleColumn;if(n){var r,i=this,a=e,o=a.record,l=a.histogramData,s=a.histogramConfig,u=void 0===s?{}:s,c=null===(r=i.initialConfig.histogramWidget)||void 0===r?void 0:r.topValue,d=i.scalePoints||o.get(n.field);if(!c){if(d&&i.calculateTopValueByScalePoints&&(c=i.getTopValueByScalePoints(d)),!c&&l){var h=e.histogramWidget||i.histogramWidget;Be.assign(h,u),c=h.getDataTopValue(l),d=[{value:i.convertHistogramValueToUnits(c,i.scaleUnit),text:i.convertHistogramValueToUnits(c,i.scaleUnit)}],c+=i.scaleColumn.scaleWidget.scaleMaxPadding*c}e.scaleWidgetConfig={scalePoints:d},e.histogramConfig=F(F({},u),{},{topValue:c})}}return e}},{key:"buildGroupHeader",value:function(e){return e.column===this.scaleColumn?this.scaleColumn.renderer(e):B(t,"buildGroupHeader",this,3)(arguments)}},{key:"beforeRenderCell",value:function(e){return this.scaleColumn&&e.column===this.scaleColumn&&(e.histogramData=this.getRecordHistogramData(e.record),Be.isPromise(e.histogramData)||Object.assign(e,this._recordRenderData)),B(t,"beforeRenderCell",this,3)(arguments)}},{key:"renderRecordScale",value:function(e,t){if(this.scaleColumn){var n=this.getRowFor(e),r=null==n?void 0:n.getCell(this.scaleColumn.id);r&&n.renderCell(r)}}},{key:"widgetClass",get:function(){}}])}(e),S(t,"$name","TimelineHistogramScaleColumn"),S(t,"configurable",{scaleColumn:{},scalePoints:null,calculateTopValueByScalePoints:!0}),t},LF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(FF.mixin(AF,IF));S(LF,"$name","TimelineHistogram"),S(LF,"type","timelinehistogram"),LF.initClass(),LF._$name="TimelineHistogram";var OF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateProject",value:function(e){var t;null!==(t=e.transport.load)&&void 0!==t&&t.url&&(this.value=e.transport.load.url)}},{key:"onInternalChange",value:function(e){var t=e.value;e.userAction&&this.project&&(this.project.transport.load.url=t,this.project.load())}}],[{key:"configurable",get:function(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1,internalListeners:{change:"onInternalChange"}}}}])}(dv);S(OF,"$name","ProjectCombo"),S(OF,"type","projectcombo"),OF.initClass(),OF._$name="ProjectCombo";var PF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"itemIconTpl",value:function(e,t){var n=e.eventColor,r=this.useResourceColor,i=li.isNamedColor(n)&&r?" b-sch-color-".concat(n):"",a=!i&&n&&r?' style="--checkbox-background-color:'.concat(n,'"'):"";return this.multiSelect&&this.callback(this.isSelectable,this,[e])?'<div aria-hidden="true" class="b-selected-icon b-icon'.concat(i,'"').concat(a,"></div>"):""}},{key:"changeStore",value:function(e){if(this.eventStore)return B(t,"changeStore",this,3)(arguments);this._storeConfig=e}},{key:"changeEventStore",value:function(e){return this.getConfig("store"),e}},{key:"updateEventStore",value:function(e){var t,n=this,r=n._storeConfig||{},i=e.resourceStore,a=F(F({},r),{},{syncSort:!0,excludeCollapsedRecords:!1}),o={name:"resourceStore",change:"onStoreChange",thisObj:n};i.tree&&(a.sorters=[]),null===(t=n.store)||void 0===t||t.destroy(),n.detachListeners("project","resourceStore"),(n.store=i.chain(n.masterFilter,null,a)).un(o),i.ion(o),i.count?n.initFilter():i.project.ion({name:"project",refresh:"initFilter",thisObj:n})}},{key:"changeMasterFilter",value:function(e){var t=this;if(!t.filterResources)return function(n){return t.callback(e,t,[n])}}},{key:"initFilter",value:function(){var e=this;if(e.eventStore.resourceStore.count){var t,n=e.selected;if(!n.count)0===(null===(t=e.initialConfig.selected)||void 0===t?void 0:t.length)?e.onInternalSelectionChange({source:n,added:[],removed:[]}):n.add(e.store.allRecords.filter((function(e){return!e.isGroupHeader})));e.detachListeners("project")}}},{key:"onStoreRefresh",value:function(e){var n=e.source;if("filter"===e.action&&this.eventStoreFilter){var r=this.eventStoreFilter,i=r.disabled,a=!n.isFiltered&&this.allSelected;a!==i&&(r.disabled=a,this.applyFilters())}B(t,"onStoreRefresh",this,3)(arguments)}},{key:"onInternalSelectionChange",value:function(e){var n=e.source,r=e.added,i=void 0===r?[]:r,a=e.removed,o=this,l=!o.store.isFiltered&&o.allSelected;B(t,"onInternalSelectionChange",this,3)(arguments);var s=!1;if(o.eventStoreFilter||(o.eventStoreFilter=o.eventStore.addFilter({id:"".concat(o.id,"-filter-instance"),filterBy:function(e){return!e.resource||o.selected.includes(e.resources)},disabled:l},(null==i?void 0:i.length)===o.store.count),s=!0),o.filterResources&&!o.resourceStoreFilter&&(o.resourceStoreFilter=o.eventStore.resourceStore.addFilter({id:"".concat(o.id,"-filter-instance"),filterBy:function(e){return o.selected.includes(e)},disabled:l},(null==i?void 0:i.length)===o.store.count),s=!0),!s){o.eventStoreFilter.disabled=l,o.resourceStoreFilter&&(o.resourceStoreFilter.disabled=l),o.applyFilters();var u=n.values,c=u.concat(a);$e.remove.apply($e,[c].concat(z(i))),o.triggerFieldChange({value:u,oldValue:c})}}},{key:"value",get:function(){return this.selected.values}},{key:"applyFilters",value:function(){this.eventStore.filter(),this.filterResources&&this.eventStore.resourceStore.filter()}},{key:"updateUseResourceColor",value:function(e){this.element.classList.toggle("b-plain-color",!e)}},{key:"doDestroy",value:function(){var e;null===(e=this.store)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}}],[{key:"delayable",get:function(){return{applyFilters:"raf"}}},{key:"configurable",get:function(){return{eventStore:null,multiSelect:!0,useResourceColor:!0,toggleAllIfCtrlPressed:!0,collapsibleGroups:!0,itemTpl:function(e){return Le.encodeHtml(e.name||"")},masterFilter:function(e){return!0},filterResources:null,allowGroupSelect:!1}}}])}(ev);S(PF,"$name","ResourceFilter"),S(PF,"type","resourcefilter"),PF.initClass(),PF._$name="ResourceFilter";var _F=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeEventFilter",value:function(e){if("string"==typeof e){var t=this.resolveCallback(e),n=t.handler,r=t.thisObj;e=n.bind(r)}return e}},{key:"doRefresh",value:function(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),B(t,"doRefresh",this,3)(arguments);this.whenVisible("doRefresh")}},{key:"updateShowEvents",value:function(e,t){var n=this,r=n.contentElement.classList,i=n.eventStore;if(n.requestAnimationFrame((function(){var i;n.element.classList.toggle("b-datepicker-with-events",Boolean(e)),null===(i=n.owner)||void 0===i||i.element.classList.toggle("b-datepicker-with-events",Boolean(e)),e&&r.add("b-show-events-".concat(e)),r.remove("b-show-events-".concat(t))})),e){if(!i){var a=n.up((function(e){return e.eventStore}));if(!a)throw new Error("DatePicker configured with events but no eventStore");n._eventStore=i=a.eventStore}}else n.cellMap=null;n.isConfiguring||(n.updateEventStore(i),n.doRefresh())}},{key:"refreshEventsMap",value:function(){var e=this;e.showEvents&&(e.cellMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.cellMap,filter:e.eventFilter}))}},{key:"updateEventStore",value:function(e){var t;-1===e.findListener("change","refresh",this)&&(null==e||null===(t=e[this.showEvents?"on":"un"])||void 0===t||t.call(e,{change:"refresh",thisObj:this}))}},{key:"cellRenderer",value:function(e){var n,r,i=e.cell,a=e.date,o=this.showEvents,l=null===(n=this.cellMap)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,Pl.makeKey(a)),s=Array.isArray(l)?l.length:l,u="count"===o;delete i.dataset.btip,s&&(!u&&this.eventCountTip&&(i.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",s)),li.createElement(S({dataset:{count:s},class:S(S({},u?"b-cell-events-badge":"b-icon b-icon-circle","heatmap"!==o),t.getEventCountClass(s),1),parent:i},u?"text":"",s)))}},{key:"getCellClassList",value:function(e){var n,r,i=e.date,a=null===(n=this.cellMap)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,Pl.makeKey(i)),o=Array.isArray(a)?a.length:a,l=B(t,"getCellClassList",this,3)(arguments);return l[t.getEventCountClass(o)]=o>0,l}}],[{key:"getEventCountClass",value:function(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-datepicker-7-or-more-events":""}},{key:"setupClass",value:function(e){e.replaceType=!0,B(t,"setupClass",this,2)([e])}}])}(Lk);S(_F,"$name","SchedulerDatePicker"),S(_F,"type","datepicker"),S(_F,"configurable",{showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}}),_F.initClass(),_F._$name="SchedulerDatePicker";var HF=function(e){return e.isProjectConsumer},BF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.stm||(this.scheduler=this.up(HF))}},{key:"changeScheduler",value:function(e){return e.isProjectConsumer?e:t.getById(e)}},{key:"updateScheduler",value:function(e){var t=this,n=e.crudManager;e.ion({projectChange:"onProjectChanged",thisObj:t}),n?t.setupLoadListener(n):t.onLoad(),!t.project&&null!=e&&e.project&&(t.project=e.project),t.stm=e.project.stm}},{key:"setupLoadListener",value:function(e){this.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}},{key:"onLoad",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scheduler.project.commitAsync();case 2:this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onProjectChanged",value:function(e){var t=e.project;this.project=t}},{key:"updateProject",value:function(e){B(t,"updateProject",this,3)(arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}}]);var n}(Bb);S(BF,"$name","UndoRedo"),S(BF,"type","undoredo"),S(BF,"configurable",{scheduler:null,project:null}),BF.initClass(),BF._$name="UndoRedo";var VF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}},{key:"scheduler",get:function(){return this.client||this.up((function(e){return e.isTimelineBase}))||Lo.query((function(e){return e.isTimelineBase}))}},{key:"changeValue",value:function(e,n){return this.getConfig("presets"),B(t,"changeValue",this,3)([e,n])}},{key:"updatePresets",value:function(e){this.store=this.scheduler.presets.chain((function(t){return e.includes(t.id)})),this.store.sort((function(t,n){return e.indexOf(t.id)-e.indexOf(n.id)}))}},{key:"onClientPresetChange",value:function(e){var t=e.preset,n=this;n._isSelecting||(n.isSettingValue=!0,n.store.includes(t.id)?n.value=t:n.clear(),n.isSettingValue=!1)}},{key:"onSelect",value:function(e){var t=e.record;if(!this.isSettingValue){var n=this.scheduler,r=t.mainUnit,i=t.start,a=t.defaultSpan,o={};if(r&&a&&this.useFixedDuration){var l,s=r;if(i&&"string"==typeof i)s=null!==(l=Pl.parseTimeUnit(i))&&void 0!==l?l:i;o.startDate=Pl.startOf(n.viewportCenterDate,s),"number"==typeof i&&(o.startDate=Pl.add(o.startDate,i,r)),o.endDate=Pl.add(o.startDate,a,r)}n.zoomToLevel(t,o)}}},{key:"updateLocalization",value:function(){B(t,"updateLocalization",this,3)([]),this.syncInputFieldValue()}}])}(dv);S(VF,"$name","ViewPresetCombo"),S(VF,"type","viewpresetcombo"),S(VF,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,useFixedDuration:!0,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"}),VF.initClass(),VF._$name="ViewPresetCombo";var NF=function(){function e(t){m(this,e),this.intervalGroups=[],t&&Object.assign(this,t)}return w(e,[{key:"combineWith",value:function(t){var n=this.intervalGroups.slice();return n.push([t.calendar,t]),new e({intervalGroups:n})}},{key:"getIsWorkingForEvery",value:function(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;var e,t=D(this.getGroups());try{for(t.s();!(e=t.n()).done;){var n=_(e.value,2);n[0];if(!n[1][0].isWorking)return this.isWorkingForEvery=!1}}catch(e){t.e(e)}finally{t.f()}return this.isWorkingForEvery=!0}},{key:"getIsWorkingForSome",value:function(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;var e,t=D(this.getGroups());try{for(t.s();!(e=t.n()).done;){var n=_(e.value,2);n[0];if(n[1][0].isWorking)return this.isWorkingForSome=!0}}catch(e){t.e(e)}finally{t.f()}return this.isWorkingForSome=!1}},{key:"getCalendars",value:function(){return this.getGroups(),this.calendars}},{key:"isCalendarWorking",value:function(e){return this.getCalendarsWorkStatus().get(e)}},{key:"getCalendarsWorkStatus",value:function(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;var e,t=new a,n=D(this.getGroups());try{for(n.s();!(e=n.n()).done;){var r=_(e.value,2),i=r[0],o=r[1];t.set(i,o[0].isWorking)}}catch(e){n.e(e)}finally{n.f()}return this.calendarsWorkStatus=t}},{key:"getCalendarsWorking",value:function(){if(this.calendarsWorking)return this.calendarsWorking;var e,t=[],n=D(this.getGroups());try{for(n.s();!(e=n.n()).done;){var r=_(e.value,2),i=r[0];r[1][0].isWorking&&t.push(i)}}catch(e){n.e(e)}finally{n.f()}return this.calendarsWorking=t}},{key:"getCalendarsNonWorking",value:function(){if(this.calendarsNonWorking)return this.calendarsNonWorking;var e,t=[],n=D(this.getGroups());try{for(n.s();!(e=n.n()).done;){var r=_(e.value,2),i=r[0];r[1][0].isWorking||t.push(i)}}catch(e){n.e(e)}finally{n.f()}return this.calendarsNonWorking=t}},{key:"getGroups",value:function(){if(this.intervalsByCalendar)return this.intervalsByCalendar;var e=this.calendars=[],t=new a;return this.intervalGroups.forEach((function(n){var r=_(n,2),i=r[0],a=r[1],o=t.get(i);o||(e.push(i),o=[],t.set(i,o)),o.push.apply(o,a.intervals)})),t.forEach((function(e,n){var r=DE(e);r.sort(SE),t.set(n,r)})),this.intervalsByCalendar=t}}])}(),zF=function(e){function t(e){var n;return m(this,t),(n=g(this,t,[e])).calendarCaches=DE(n.calendarCaches),n.intervalCache=new TE({emptyInterval:new NF,combineIntervalsFn:function(e,t){return e.combineWith(t)}}),n}return R(t,e),w(t,[{key:"fillCache",value:function(e,t){var n=this;this.calendarCaches.forEach((function(r){r.fillCache(e,t),n.includeWrappingRangeFrom(r,e,t)}))}}])}(wE),jF=new a,WF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.grid.ion({beforeResponsiveStateChange:"onBeforeGridResponsiveStateChange",thisObj:this})}},{key:"defaultRenderer",value:function(e){for(var t,n=e.cellElement,r=e.row,i=e.record,a=e.grid,o=e.size,l=this,s=i.events,u=i.date,c=i.data.previousEvents,d=[],h=0;h<s.length;h++){var f=s[h],v=f.endDate||Pl.add(f.startDate,f.duration,f.durationUnit),g=f.startDate<u,m=v>i.tomorrow,p=a.createEventDomConfig({date:i.date,isAllDay:f.allDay||m||g,eventRecord:f});p.className["b-continues-future"]=m,p.className["b-continues-past"]=g,d.push({className:{"b-cal-agenda-event-row":1},dataset:{rowId:f.id},children:[a.callback("eventListEventTimeRenderer",a,[f,u]),p],syncOptions:{syncIdField:"rowId",releaseThreshold:0,strict:!0}})}if(r[c&&c.date.getMonth()!==u.getMonth()?"addCls":"removeCls"]("b-new-month"),null===(t=a._cellRenderer)||void 0===t||t.call.apply(t,[a].concat(Array.prototype.slice.call(arguments))),n.classList[i.isNonWorking?"add":"remove"](a.nonWorkingDayCls),fa.sync({domConfig:{onlyChildren:!0,children:[a.callback("agendaEventDateRenderer",a,[u]),{className:{"b-cal-event-bar-container":1},children:d}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:n}),n.setAttribute("aria-label","".concat(Pl.format(u,"dddd MMMM Do, YYYY"),", ").concat(a.L("eventCount",s.length))),n.setAttribute("tabIndex",-1),n.dataset.date=i.id,!l.autoHeight){var y=n.querySelector(".b-cal-agenda-date"),k=null!=l._cellTbPadding?l._cellTbPadding:l._cellTbPadding=li.getEdgeSize(n,"padding","tb").height,b=null!=l._containerPadding?l._containerPadding:l._containerPadding=li.getEdgeSize(n.querySelector(".b-cal-event-bar-container"),"margin","tb").height,C=null!=l._dateBlockHeight?l._dateBlockHeight:l._dateBlockHeight=pt.outer(y).height;o.height=Math.max(i.events.length*(a.eventHeightInPixels+a.eventRowSpacing)-a.eventRowSpacing+k+b+("small"===a.responsiveState?C:0),86)}}},{key:"onBeforeGridResponsiveStateChange",value:function(){this._cellTbPadding=this._containerPadding=this._dateBlockHeight=this._dateBlockHeight=null}},{key:"getCellClass",value:function(e){var n=B(t,"getCellClass",this,3)([e]);return n["b-sticky-cell"]=n["b-day-of-week-".concat(e.record.day)]=1,n}},{key:"headerRenderer",value:function(e){var t=e.headerElement;t.innerHTML="",fa.sync({domConfig:{className:{"b-cal-agenda-header":1,"b-grid-header":1,"b-last-leaf":1},children:[{className:{"b-cal-agenda-header-date":1},text:"Date"},{className:{"b-cal-agenda-header-time":1},text:"Time"},{className:{"b-cal-agenda-header-event":1},text:"Event"}]},targetElement:t})}}],[{key:"defaults",get:function(){return{id:"agenda",text:"Agenda",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!1,alwaysClearCell:!1}}}])}(yg);S(WF,"$name","AgendaColumn"),S(WF,"type","agendacolumn"),bg.registerColumnType(WF),WF._$name="AgendaColumn";var $F=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"renderer",value:function(e){var t,n,r=e.cellElement,i=e.record,a=e.grid,o=null===(t=a.calendar)||void 0===t?void 0:t.widgetMap.resourceFilter,l=o?i.resources.filter((function(e){return o.selected.includes(e)})):i.resources;null===(n=a._cellRenderer)||void 0===n||n.call.apply(n,[a].concat(Array.prototype.slice.call(arguments))),a.showResourceAvatars=!0,fa.sync({domConfig:{onlyChildren:!0,children:[{class:"b-cal-event-resource-avatars",children:l.map((function(e){return{class:"b-cal-event-resource-avatar-row",children:[a.getResourceAvatar(e),{class:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:e.name},{class:"b-event-column-resource-role",text:e.role}]}]}}))},{class:"b-cal-event-column-event-desc",children:[{class:"b-cal-event-column-event-name",text:i.name}]},{class:"b-cal-event-column-times",children:[a.eventListEventTimeRenderer(i)]}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:r})}}],[{key:"defaults",get:function(){return{id:"calendarevents",text:"Event Details",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!0,alwaysClearCell:!1}}}])}(yg);S($F,"$name","EventColumn"),S($F,"type","calendarevents"),bg.registerColumnType($F),$F.exposeProperties(),$F._$name="EventColumn";var UF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Kx);S(UF,"fields",[{name:"alignment",defaultValue:"start",internal:!0},{name:"color",internal:!0},{name:"footer",internal:!0},{name:"rotation",internal:!0}]),UF._$name="TimeRangeModel";var GF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(Xx);S(GF,"defaultConfig",{modelClass:UF}),GF.initClass(),GF._$name="TimeRangeStore";var YF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t)}(zE);S(YF,"$name","ProjectModel"),S(YF,"configurable",{timeRangeStore:{modelClass:UF}}),S(YF,"defaultConfig",{timeRangeModelClass:UF,timeRangeStoreClass:GF}),YF.applyConfigs=!0,YF.initClass(),YF._$name="ProjectModel";var qF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"buildProjectConfig",value:function(){var e=B(t,"buildProjectConfig",this,3)([]),n=this.timeRangeStore;return n&&(e.timeRangeStore=n),e}},{key:"timeRangeStore",get:function(){return B(t,"timeRangeStore",this,1)},set:function(e){var t;e&&Be.isObject(e)&&(e=Be.assign({modelClass:this.timeRangeClass},e)),this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}}])}(jE);S(qF,"$name","CrudManager"),S(qF,"configurable",{projectClass:YF,timeRangeClass:UF}),qF.initClass(),qF._$name="CrudManager";var KF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getViewZoneType",value:function(e){var t,n=this.zoneTypes;return n&&(t=n[e.type])===i&&(e.isWeekView&&n.week!==i?t=n.week:e.isDayView?t=n.day:e.isMonthView?t=n.month:e.isYearView?t=n.year:e.isResourceView?t=n.resource:e.isAgendaView&&(t=n.agenda)),t}},{key:"updateDisableOnReadOnly",value:function(e){var t=this,n=t.client,r="readonlyToggle",i="onClientReadOnlyToggle";e?(t[i]({readOnly:n.readOnly}),n.ion({name:r,readOnly:i,thisObj:t})):t.detachListeners(r)}},{key:"doDestroy",value:function(){this.syncModes(),B(t,"doDestroy",this,3)([])}},{key:"createZone",value:function(e,t){return new e(F({owner:this},t))}},{key:"onClientReadOnlyToggle",value:function(e){var t=e.readOnly;this.disabled=t}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.client.isPainted&&this.syncModes()}},{key:"onCalendarPaint",value:function(e){e.firstPaint&&this.syncModes()}},{key:"syncModes",value:function(){var e,t,n,r,i,a=this,o=a.client,l=a._modeDetacher,s=a.zones,u=null;if(a.disabled||a.isDestroying||!a.zoneTypes)null==l||l();else for(t in o.isCalendar?(l||(a._modeDetacher=o.ion({addMode:function(){return a.syncModes()}})),e=o.modes):e={view:o},e){var c;if(i=null==s?void 0:s[t],n=e[t],r=a.getViewZoneType(n))(Be.isObject(i)?i.type:null===(c=i)||void 0===c?void 0:c.constructor)===r?delete s[t]:i=n.isPainted?a.createZone(r,{view:n}):a.whenPainted(t,n,r),(u||(u={}))[t]=i}if(a.zones=u,s)for(t in s)s[t].destroy()}},{key:"whenPainted",value:function(e,t,n){var r=this,i={type:n,destroy:t.ion({once:!0,prio:1e4,paint:function(){r.zones[e]===i&&(r.zones[e]=r.createZone(n,{view:t}))}})};return i}}],[{key:"factoryable",get:function(){return{}}}])}(wc.mixin(Za));S(KF,"configurable",{disableOnReadOnly:null,zoneTypes:null}),S(KF,"properties",{clientListeners:{paint:"onCalendarPaint"}}),KF._$name="CalendarFeature";var XF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateView",value:function(e){var t=this,n=e&&t.viewListeners;t.detachListeners("viewListeners"),n&&(null==e||e.ion(Be.merge({thisObj:t,name:"viewListeners"},n)))}}])}(Mn);S(XF,"$name","CalendarZone"),S(XF,"configurable",{owner:null,view:{$config:"nullify",value:null},viewListeners:null}),XF.initClass(),XF._$name="CalendarZone";var ZF=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getItemCls",value:function(e){return li.isNamedColor(e.eventColor)?" b-sch-".concat(e.eventColor):""}},{key:"getItemStyle",value:function(e){return"color:#fff;".concat(e.eventColor&&!li.isNamedColor(e.eventColor)?"background-color:".concat(e.eventColor):"")}},{key:"iconTpl",value:function(e){return li.createElement(this.owner.ownerFeature.client.activeView.getResourceAvatar(e)).outerHTML}}])}(lv);S(ZF,"$name","ResourceChipView"),S(ZF,"type","resourcechipview"),S(ZF,"configurable",{navigator:null,itemsFocusable:!1,closable:!1,scrollable:!1,itemTpl:function(e){var t;return li.createElement({className:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:e.name},null!==(t=e.role)&&void 0!==t&&t.length?{class:"b-event-column-resource-role",text:e.role}:null]}).outerHTML}}),ZF.initClass(),ZF._$name="ResourceChipView";var JF,QF=new String(""),eA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateEventRenderer",value:function(){this.refreshSoon()}},{key:"createEventDomConfig",value:function(e){var t,n,r,a,o,l,s,u,c,d=arguments.length>1&&arguments[1]!==i?arguments[1]:this.eventRenderer,h=this,f=h.intradayCls,v=h.alldayCls,g=h.solidBarCls,m=h.pastEventCls,p=h.showTime,y=h.timeFormat,k=h.eventHeaderRenderer,b=h.rtl,C=h.up("calendar"),w=e.eventRecord,D=e.minimal,x=D?"auto":h.eventHeight,E=e.eventEndDate||w.endingDate,R=h.callback(h.getPrimaryResource,h,[w.isOccurrence?w.recurringEvent:w]),T=w.isRecurring||w.isOccurrence,M="isAllDay"in e?e.isAllDay:null===(t=h.isAllDayEvent)||void 0===t?void 0:t.call(h,w),F={height:"auto"!==x?li.setLength(x):null},A=null==C?void 0:C.eventSelectedCls,I=null==C||null===(n=C.navigator)||void 0===n?void 0:n.focusCls,L=e.dataset={eventId:w.id},O=Object.assign(li.parseStyle(null==R?void 0:R.eventStyle),li.parseStyle(w.style)),P={className:"b-cal-event",style:F},_=e.eventColor||w.color||w.eventColor||(null==R?void 0:R.eventColor)||QF;e.wrapperChildren=[P],e.cls=w.cls.clone(),e.solidBar=M||D,e.iconStyle="header"===h.iconTarget&&h.showTime&&!li.isNamedColor(_)?{color:_}:{},e.iconCls=new Ct(w.iconCls),e.style=O,e.eventColor=_,e.eventHeight=x,e.cls[h.shortEventCls]=w.rawDurationMS<=h.shortEventDuration,e.bodyStyle={},e.resourceRecord=R,e.view=h,null!=R&&R.cls&&e.cls.add(R.cls);var H=null!==(r=h.internalBodyContentRenderer(w,R,e,!D&&d))&&void 0!==r?r:"",B="string"==typeof H,V=!B||Le.isHtml(H);d&&!D&&(e.eventHeight!==x&&(F.height=li.setLength(e.eventHeight)),"string"==typeof e.cls&&(e.cls=new Ct(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new Ct(e.iconCls)),"string"==typeof e.style&&(e.style=li.parseStyle(e.style)),"string"==typeof e.bodyStyle&&(e.bodyStyle=li.parseStyle(e.bodyStyle))),H=[S({className:{"b-cal-event-desc":1,"b-cal-event-desc-complex":V}},B?"html":"children",H)],Object.assign(e.cls,S(S(S(S(S(S(S({"b-cal-event-wrap":1,"b-iscreating":w.isCreating,"b-readonly":w.readOnly,"b-minimal":D,"b-milestone":w.isMilestone&&!M},v,v&&M),g,g&&e.solidBar),f,f&&!M),m,m&&E<new Date),A,(null==C?void 0:C.isEventSelected(w))||e.asSelected),"b-rtl",b),I,(null==C||null===(a=C.navigator.activeItem)||void 0===a?void 0:a.dataset.eventId)===w.id)),_=e.eventColor;var N=e.bodyColor;if(null!=N&&N.length&&(e.cls["b-custom-body-color"]=1,e.bodyStyle["--dayview-body-background-color"]=N),null!==(o=_)&&void 0!==o&&o.length&&(O["--cal-event-color"]=li.createColorStyle(_)),k){var z=h.callback(k,h,[{view:h,eventRecord:w,resourceRecord:R,renderData:e}]),j=Array.isArray(z);j||"object"!==W(z)?H.unshift(S({className:"b-event-header"},j?"children":z.includes("<")?"html":"text",z)):(z.className=Ct.normalize(z.className,"object"),z.className["b-event-header"]=1,H.unshift(z))}else!p||M&&h.showAllDayHeader||H.unshift({className:"b-event-header",children:[{className:"b-event-time",html:h.renderTimes(w,p,y)}]});var $=Boolean(null===(l=e.iconCls)||void 0===l?void 0:l.length),U=!$&&T,G="showBullet"in e?e.showBullet:!0===h.showBullet||(null===(s=h.showBullet)||void 0===s?void 0:s.bar)&&e.solidBar||(null===(u=h.showBullet)||void 0===u?void 0:u.noBar)&&!e.solidBar,Y=!$&&!T&&G,q={tag:"i",className:Object.assign({"b-cal-event-icon":!U,"b-cal-recurrence-icon":U,"b-icon":1,"b-fw-icon":1,"b-icon-circle":Y,"b-icon-recurring":U},e.iconCls),style:e.iconStyle},K=[{className:"b-cal-event-body",children:H,style:e.bodyStyle}],X="header"===h.iconTarget&&h.showTime?(null===(c=H[0].children)||void 0===c?void 0:c.length)>0?H[0].children:H:K;($||U||Y)&&("header"===h.iconTarget&&h.showTime?X.push(q):X.unshift(q)),$&&T&&X.push({tag:"i",className:{"b-cal-recurrence-icon":1,"b-icon":1,"b-fw-icon":1,"b-icon-recurring":1},style:e.iconStyle}),D||(P.children=K);var Z=iL.getStartAndEndDates(h,w),J=Z.startText,Q=Z.endText,ee={role:"button","aria-label":w.name+","+(Q?"".concat(J," ").concat(h.L("L{Object.to}")," ").concat(Q):"".concat(w.isMilestone?h.L("L{Object.at}"):h.L("L{Object.on}")," ").concat(J))+".",dataset:L,tabIndex:D?null:0,className:e.cls,style:e.style,children:e.wrapperChildren};return null==C||C.onEventDataGenerated(e,ee),ee}},{key:"renderTimes",value:function(e,t,n){var r=t.startTime,i=t.endTime,a=!e.isMilestone&&i;return"".concat(r?Pl.format(e.startDate,n):"").concat(r&&a?" ".concat(this.rtl?"←":"→"," "):"").concat(a?Pl.format(e.endDate,n):"")}},{key:"internalBodyContentRenderer",value:function(e,t,n,r){var i,a=this,o=a.showResourceAvatars,l=r&&a.callback(r,a,[{view:a,eventRecord:e,resourceRecord:t,renderData:n}])||Le["auto"===a.eventHeight?"encodeHtmlBR":"encodeHtml"](e.name),s="string"==typeof l,u=Array.isArray(l);if(o&&null!==(i=e.assigned)&&void 0!==i&&i.size){var c=[{class:"b-cal-event-resource-avatars",children:e.resources.map((function(e){return a.getResourceAvatar(e)}))}],d=["last"===o?0:1,0];return"string"==typeof l?d.push({class:"b-cal-event-name",text:l}):d.push[u?"apply":"call"](d,l),c.splice.apply(c,d),c}return u||s?l:[l]}}])}(e||Mn),S(t,"$name","EventRenderer"),S(t,"configurable",{eventRenderer:null,eventHeaderRenderer:null,filterEventResources:null,getPrimaryResource:function(e){var t=e.resources;if(this.resource)return this.resource;if(t.length){var n,r=this.filterEventResources&&(null===(n=this.calendar)||void 0===n||null===(n=n.widgetMap)||void 0===n?void 0:n.resourceFilter);return r?t.find((function(e){return r.selected.includes(e)})):t[0]}}}),t},tA=new String,nA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n,r=this.calendar=null===(n=e.owner||e.parent)||void 0===n?void 0:n.up("calendar");r&&!e.eventStore&&(e.eventStore=r.eventStore),B(t,"construct",this,3)(arguments)}},{key:"changeEventDots",value:function(e){var t=this;return new Proxy(e,{set:function(e){var n=Reflect.set.apply(Reflect,arguments);return t.updateEventDots(e),n}})}},{key:"updateEventDots",value:function(e){var t=e.marginTop,n=e.gap,r=e.size,i=e.stripe,a=this.weeksElement,o=a.style,l=a.classList;o.setProperty("--event-count-margin-top","".concat(t,"px")),o.setProperty("--event-count-dot-size","".concat(r,"px")),o.setProperty("--event-count-dot-gap","".concat(n,"px")),l[i?"add":"remove"]("b-event-count-dots-striped"),this.isConfiguring||this.refresh()}},{key:"updatemaxDots",value:function(e){Ne.deprecate("calendar","7.0.0","maxDots property is deprecated in favor of eventDots"),this.eventDots.max=e,this.updateEventDots(this.eventDots)}},{key:"refreshEventsMap",value:function(){var e,t=this,n=t.eventSorter||(null===(e=t.calendar)||void 0===e||null===(e=e.activeView)||void 0===e?void 0:e.eventSorter);if(t.showEvents&&(t.cellMap=t.eventStore["dots"===t.showEvents?"getEvents":"getEventCounts"]({startDate:t.startDate,endDate:t.endDate,dateMap:t.cellMap||(t.cellMap=new a),filter:t.eventFilter}),"dots"===t.showEvents&&n)){var r,i=D(t.cellMap.values());try{for(i.s();!(r=i.n()).done;){r.value.sort(n)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"cellRenderer",value:function(e){var t,n,r=e.cell,i=e.date,a=this,o=a.showEvents,l="count"===o,s="dots"===o,u=null===(t=a.cellMap)||void 0===t||null===(n=t.get)||void 0===n?void 0:n.call(t,Pl.makeKey(i)),c=s?null==u?void 0:u.length:u,d=l?"b-cell-events-badge":s?"b-cal-minimal-event-container":"b-icon b-icon-circle";if(s&&(r.innerHTML="",li.createElement({class:"b-date-cell-inner",text:i.getDate(),parent:r})),r.parentNode.setAttribute("aria-label","".concat(Pl.format(i,"dddd MMMM Do YYYY")).concat(o?", ".concat(a.L("L{ResourceInfoColumn.eventCountText}",c||0)):"",".")),delete r.parentNode.dataset.btip,c){!l&&a.eventCountTip&&(r.parentNode.dataset.btip=a.L("L{ResourceInfoColumn.eventCountText}",c));var h=S({dataset:{count:c},class:S(S({},d,"heatmap"!==o),_F.getEventCountClass(c),1),parent:r},l?"text":"",c);if(s)for(var f=a.eventDots.max,v=h.children=[],g=0;g<Math.min((null==u?void 0:u.length)||0,f);g++){var m=a.createEventDomConfig({date:i,eventRecord:u[g],eventColor:f>1?null:tA,minimal:!0});v.push(m)}li.createElement(h)}}}],[{key:"setupClass",value:function(e){e.replaceType=!0,B(t,"setupClass",this,2)([e])}}])}(_F.mixin(eA));S(nA,"$name","CalendarDatePicker"),S(nA,"type","datepicker"),S(nA,"configurable",{showEvents:null,maxDots:null,eventDots:{marginTop:4,max:4,gap:3,size:5},eventCountTip:null,alwaysRefreshOnMonthChange:!0}),nA.initClass(),nA._$name="CalendarDatePicker";var rA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"setupWidgetConfig",value:function(e,n){var r,i=this,a=B(t,"setupWidgetConfig",this,3)(arguments);("eventFilter"===a.ref&&(a.store=i.initialConfig.eventStore),"resourceFilter"===a.ref&&(a.type&&a.type!==i.resourceFilter.type||(a=t.mergeConfigs(i.resourceFilter,a))),"datepicker"===a.type)&&(i.element.classList.add("b-has-datepicker"),i.element.classList.toggle("b-datepicker-with-events",Boolean(a.events)),null===(r=i.up("calendar"))||void 0===r||r.ion({rangeChange:"onCalendarViewRangeChange",thisObj:i}));return a}},{key:"onInternalPaint",value:function(e){var n,r,i=e.firstPaint,a=this.widgetMap.datePicker;i&&(this.getConfig("highlightMultiSelectSpan"),null!=a&&a.multiSelect&&(null===(r=this.owner)||void 0===r||r.eachView((function(e){e.isDateRangeOwner&&!e.fixedDuration&&!0===a.multiSelect&&(e.dateFilter=e.resourceDateFilter=function(e){var t=e.date;return a.isSelected(t)})})),this.onDatePickerSelectionChange({source:a,selection:a.selection},!0)));null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n(arguments)}},{key:"updateHighlightMultiSelectSpan",value:function(e){var t=this.widgetMap.datePicker;t&&t.element.classList.toggle("b-highlight-selection",Boolean(e))}},{key:"updateSide",value:function(e,t){var n=this.element.classList;n.remove("b-sidebar-".concat(t)),n.add("b-sidebar-".concat(e)),this.collapsible&&(this.collapsible.direction=e)}},{key:"updateStepUnitText",value:function(e){var t=this,n=t.widgetMap,r=n.prevButtonSidebar,i=n.nextButtonSidebar;r&&(r.tooltip=e?t.L("L{Calendar.previous}",e):"",r.disabled=!e),i&&(i.tooltip=e?t.L("L{Calendar.next}",e):"",i.disabled=!e)}},{key:"updateEventStore",value:function(e){var t=this.widgetMap,n=t.resourceFilter,r=t.datePicker,i=t.eventFilter;i&&(i.store=e),n&&(n.eventStore=e),r&&(r.eventStore=e)}},{key:"onCalendarViewRangeChange",value:function(e){var t=e.source,n=e.new,r=n.startDate,i=n.endDate,a=this.widgetMap.datePicker;t.isEventList&&!t.range&&"range"===(null==a?void 0:a.multiSelect)&&(a.selection=[r,i])}},{key:"onDatePickerSelectionChange",value:function(e,t){var n=e.source,r=e.selection;e.oldSelection;var i=e.userAction,a=this,o=n.multiSelect,l=[r[0],r[r.length-1]],s=l[0],u=l[1];if(a.UIdateChange=i,s){var c,d=new Date(n.month.year,n.month.month,1),h=new Date(n.month.year,n.month.month+1,0),f=o?Pl.max(Pl.min(s,h),d):s,v={};if(o)null===(c=a.owner)||void 0===c||c.eachView((function(e){if(e.isDateRangeOwner&&!e.fixedDuration){var r=e._hidden,i=n.getRange(!0===o);if(e.hasConfig("endDate")?(v.startDate=i.startDate,v.endDate=Pl.add(i.endDate,e.isEventList?0:-1,"d")):v.range=i,!e.initialConfig.shiftIncrement&&a.snapMultiSelectNavigation){var l=!0===o?i:n.getRange(!0);v.shiftIncrement={unit:l.unit,magnitude:1}}t||Pl.betweenLesser(e.date,s,u)||(v.date=f),e._hidden=!0,e.setConfig(v),e._hidden=r}})),a.isConfiguring||a.owner.eventStore.trigger("change");a.inOnDatePickerSelectionChange=!0,a.date=f,a.inOnDatePickerSelectionChange=!1,a.UIdateChange=!1}}},{key:"changeDate",value:function(e,t){if(e="string"==typeof e?Pl.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=Pl.clearTime(e),!t||e-t)return e}},{key:"updateDate",value:function(e,t){var n=this,r=n.widgetMap.datePicker;if(!n.isConfiguring&&r){var i=r.multiSelect,a=r.selection,o=n.owner.views.find((function(e){return e.isDateRangeOwner&&!e.fixedDuration&&e.isVisible}));if(i&&o){var l,s=r.getRange(!0===i),u={date:e};if(!n.inOnDatePickerSelectionChange){if(!0===i){var c=e>t,d={unit:"day",magnitude:Math.abs(Pl.diff(s.startDate,o.startDate,"d"))};if(l=a.map((function(e){return Pl.add(e,d.magnitude*(c?1:-1),d.unit)})),s.wholeMonth){var h=l[l.length-1],f=Pl.getLastDateOfMonth(l[0]).getDate()-l.length;if(f<0)l.length+=f;else if(f)for(var v=Pl.add(h,1,"d");f;f--,v=Pl.add(v,1,"d"))l.push(v)}}else o.range?l=[e=o.snapDate(e),Pl.add(Pl.add(e,s),-1,"d")]:e>a[a.length-1]?(s.magnitude*=-1,l=[Pl.add(Pl.add(e,s),1,"d"),e]):e<a[0]&&(l=[e,Pl.add(Pl.add(e,s),-1,"d")]);l&&(u.selection=l)}r.setConfig(u)}else r.value=e}n.trigger("dateChange",{date:e,oldDate:t,userAction:Boolean(n.UIdateChange)})}}])}(uc.mixin(rC));JF=rA,S(rA,"$name","Sidebar"),S(rA,"type","sidebar"),S(rA,"configurable",{focusable:!1,ignoreParentReadOnly:!0,ariaLabel:"Sidebar",bbar:{cls:"b-cal-nav-item",layout:{justify:"center"},items:{todayButtonSidebar:{text:"L{Calendar.Today}",onClick:"up.shiftToNow",weight:200},prevButtonSidebar:{onClick:"up.shiftPrevious",cls:"b-borderless",icon:"b-icon-previous",weight:300},nextButtonSidebar:{onClick:"up.shiftNext",cls:"b-borderless",icon:"b-icon-next",weight:400}}},items:{datePicker:{type:"datepicker",ariaLabel:"L{Sidebar.selectDate}",weight:100,internalListeners:{selectionChange:"up.onDatePickerSelectionChange"}},eventFilter:{type:"filterfield",field:"name",weight:150,placeholder:"L{Sidebar.matchEvents}",ariaLabel:"L{Sidebar.filterEvents}",localeClass:JF},resourceFilter:{ignoreParentReadOnly:!0,ariaLabel:"L{Sidebar.filterResources}"}},date:{$config:{equal:"date"},value:null},eventStore:null,responsive:{},stepUnitText:null,side:"left",collapsible:{tool:null},resourceFilter:{type:"resourcefilter",flex:"1 1 auto",weight:200,minHeight:110,scrollable:{overflowY:"auto"},store:{sorters:[{field:"name",ascending:!0}]},masterFilter:function(e){return this.eventStore.resourceStore.isAvailable(e)}},highlightMultiSelectSpan:{$config:"lazy",value:null},snapMultiSelectNavigation:!0}),rA.initClass(),rA._$name="Sidebar";var iA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeCrudManager",value:function(e){var t,n=this;e&&!e.isCrudManager&&(e=(e.type||n.crudManagerClass).new({scheduler:n},e));return null===(t=n.bindCrudManager)||void 0===t||t.call(n,e),n._crudManager=null,e}},{key:"updateTimeZone",value:function(e){this.project.timeZone=e}},{key:"timeZone",get:function(){return this.project.timeZone}},{key:"onBeforeTimeZoneChange",value:function(e){var t=e.timeZone,n=e.oldTimeZone;if(!this.isConfiguring){var r=this,i=r.isCalendar?r.activeView:!r.calendar&&r;if(1===(null==i?void 0:i.duration)){var a=i.events.filter((function(e){return e.startDate>=i.startDate&&e.endDate&&e.endDate<=i.endDate}));if(a.length){var o=a.map((function(e){return(e.startDate.getTime()+e.endDate.getTime())/2})),l=new Date(Math.floor(o.reduce((function(e,t){return e+t}),0)/o.length)),s=null!=n?yp.fromTimeZone(l,n):l,u=null!=t?yp.toTimeZone(s,t):s;(u<i.startDate||u>i.endDate)&&((i.calendar||i).date=u)}}}}},{key:"onTimeZoneChange",value:function(){}},{key:"defaultCalendar",get:function(){var e=this.eventStore,t=Be.hasOwn(this,"_defaultCalendar")?this._defaultCalendar:e.defaultCalendarId;if(null!==t)return t!=i?t.isResourceModel?t:e.resourceStore.getById(t):e.resourceStore.first}},{key:"defaultCalendarId",get:function(){return this.eventStore.modelClass.asId(this.defaultCalendar)}},{key:"updateProject",value:function(e,n){B(t,"updateProject",this,3)([e,n]);var r=this;r.getConfig("timeZone"),r.detachListeners("CalendarStores"),e&&(e.ion({name:"CalendarStores",dataReady:"onCalendarStoreChange",refresh:"onProjectRefresh",thisObj:r}),r.isConfiguring||(r.eachView((function(t){t.project=e})),r.onCalendarStoreChange({source:e})))}},{key:"onProjectRefresh",value:function(e){var t=e.source;e.isInitialCommit&&t.eventStore.invalidateDayIndices()}},{key:"updateEventStore",value:function(e){if(e&&!e.isCalendarEventStore){var t=this;Object.defineProperty(e,"defaultCalendar",{get:function(){return t.defaultCalendar}}),e.isCalendarEventStore=!0,"removeUnassignedEvent"in e.initialConfig||(e.removeUnassignedEvent=!1)}}},{key:"widgetClass",get:function(){}}],[{key:"projectStores",get:function(){return{resourceStore:{dataName:"resources",listeners:{changePreCommit:"onCalendarStoreChange"}},eventStore:{dataName:"events",listeners:{changePreCommit:"onCalendarStoreChange"}},assignmentStore:{dataName:"assignments"},timeRangeStore:{dataName:"timeRanges",modelClass:UF},resourceTimeRangeStore:{dataName:"resourceTimeRanges",modelClass:Ux}}}}])}(aR(e||Mn)),S(t,"$name","CalendarStores"),S(t,"configurable",{defaultCalendar:null,crudManagerClass:qF,crudManager:null,timeZone:{$config:"lazy",value:null}}),S(t,"defaultConfig",{projectModelClass:YF}),t},aA=function(e){return e.isCalendarMixin&&e.eventStore},oA=/(click|touch|mouse|pointer|key|context|dbl)(.*)/,lA=function(e,t,n){return"".concat(Le.capitalize(t)).concat(Le.capitalize(n))},sA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"calendarHitTest",value:function(e){var t=this.activeView,n=li.getEventElement(e);return null!=t&&t.element.contains(n)?t.calendarHitTest(e):null}},{key:"timeAxis",get:function(){var e=this;return e._timeAxis||(e._timeAxis={get startDate(){return e.activeView.startDate},get endDateDate(){return e.activeView.endDate},isTimeSpanInAxis:function(e){return Pl.intersectSpans(e.startDate,e.endDate,this.startDate,this.endDate)}}),this._timeAxis}},{key:"timeAxisViewModel",get:function(){var e=this;return e._timeAxisViewModel||(e._timeAxisViewModel={get timeResolution(){return e.activeView.timeResolution||{}}}),this._timeAxisViewModel}},{key:"resolveEventRecord",value:function(e){var t;e instanceof Event&&(e=e.target);var n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(aA);return null==n?void 0:n.getEventRecord(e)}},{key:"resolveAssignmentRecord",value:function(){}},{key:"resolveResourceRecord",value:function(e){var t,n,r=e.nodeType===Node.ELEMENT_NODE?e:e.target;return this.resourceStore.getById(null===(t=r.closest("[data-resource-id]"))||void 0===t?void 0:t.dataset.resourceId)||(null===(n=this.resolveEventRecord(r))||void 0===n?void 0:n.resource)}},{key:"handleEvent",value:function(e){var n=function(e){return e.type.replace(oA,lA)}(e);if(B(t,"handleEvent",this,1))B(t,"handleEvent",this,3)([e]);else if(!e.handled&&!e.schedulerRedirected){var r;if(!1!==this.trigger("beforeElement".concat(n),{event:e,target:e.target}))null===(r=this["onElement".concat(n)])||void 0===r||r.call(this,e);e.schedulerRedirected=!0}}},{key:"getCellDataFromEvent",value:function(e){var n;return null===(n=B(t,"getCellDataFromEvent",this,3))||void 0===n?void 0:n([e])}},{key:"getDateFromDomEvent",value:function(e){var t,n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(aA);if(n)return n.getDateFromDomEvent(e)}},{key:"getDateFromXY",value:function(e,t){var n=!(arguments.length>2&&arguments[2]!==i)||arguments[2],a=this.activeSubView;if(a)return a.getDateFromPosition(e[0]-r.scrollX,e[1]-r.scrollY,n)}},{key:"createEvent",value:function(){var e;(e=this.activeView).createEvent.apply(e,arguments)}},{key:"enableRecurringEvents",get:function(){return!0}},{key:"intersectsVisibleTimeSpan",value:function(e){var t=this.activeView;return Pl.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate)}},{key:"getRowFor",value:function(){}},{key:"suspendRefresh",value:function(){}},{key:"resumeRefresh",value:function(){}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","SchedulerInterface"),t},uA={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,EventEdit:{Calendar:"Calendar","All day":"All day",day:"Day",week:"Week",month:"Month",year:"Year",decade:"Decade"},EventMenu:{duplicateEvent:"Duplicate",copy:"copy"},Calendar:{toggleSidebar:"Toggle sidebar visibility",Today:"Today",Tomorrow:"Tomorrow",next:function(e){return"Next ".concat(e)},previous:function(e){return"Previous ".concat(e)},plusMore:function(e){return"+".concat(e," more")},moreEvents:function(e){return"".concat(e," more events")},allDay:"All day",endsOn:function(e){return"Ends ".concat(e)},weekOfYear:function(e){var t=_(e,2),n=t[0],r=t[1];return"Week ".concat(r,", ").concat(n)},loadFail:"Calendar data load failed. Please contact your system administrator",gotoDate:"Go to date",timeRange:"Time range"},CalendarDrag:{holdCtrlForRecurrence:"Hold CTRL for a recurring event"},CalendarMixin:{eventCount:function(e){return"".concat(e||"No"," event").concat(1===e?"":"s")}},EventTip:{"Edit event":"Edit",timeFormat:"LST"},ModeSelector:{includeWeekends:"Include weekends",weekends:"Weekends"},AgendaView:{Agenda:"Agenda"},MonthView:{Month:"Month",monthUnit:"month"},WeekView:{weekUnit:"week"},YearView:{Year:"Year",yearUnit:"year",noEvents:"No events"},EventList:{List:"List",Start:"Start",Finish:"End",days:function(e){return"".concat(e>1?"".concat(e," "):"","day").concat(1===e?"":"s")}},DayView:{Day:"Day",dayUnit:"day",daysUnit:"days",expandAllDayRow:"Expand all-day section",collapseAllDayRow:"Collapse all-day section",timeFormat:"LST",timeAxisTimeFormat:"LST",noMatchingDates:"No matching dates"},DayAgendaView:{dayAgenda:"Day Agenda"},DayResourceView:{dayResourceView:"Day resources"},Sidebar:{selectDate:"Select calendar date",matchEvents:"Match events",filterEvents:"Filter events by event name",filterResources:"Filter events by selected resource"},WeekExpander:{expandTip:"Click to expand row",collapseTip:"Click to collapse row"}};Pa.publishLocale(uA);var cA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"defaultSorterFn",value:function(e,t){e=e.eventRecord||e,t=t.eventRecord||t;var n=e.startDate,r=t.startDate;return n?r?n-r||t.durationMS-e.durationMS:1:-1}},{key:"interDaySorterFn",value:function(e,t){e=e.eventRecord||e,t=t.eventRecord||t;var n=e,r=n.startDate,i=n.isInterDay,a=t,o=a.startDate,l=a.isInterDay;return r?o?i!==l?Number(l)-Number(i):(i||l)&&(t.durationMS-e.durationMS||t.endingDate-e.endingDate)||r-o:1:-1}}])}(Mn);cA._$name="EventSorter";var dA=Object.freeze({}),hA=fr.eventNameMap,fA=function(e){return e.isCalendarMixin&&e.containsFocus},vA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n,r=this;B(t,"construct",this,3)([e]),r.isYearView||-1===r.element.tabIndex||-1===(null===(n=r.contentElement)||void 0===n?void 0:n.tabIndex)||((r.contentElement||r.element).tabIndex=-1),r.getConfig("avatarRendering"),fr.on({element:r.element,keydown:"onCalendarKeyDown",thisObj:r}),r.handlePointerInteraction&&(fr.on({element:r.element,mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:{handler:"onCalendarPointerInteraction",block:300},dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction",thisObj:r}),fr.on({element:r.element,mouseenter:"onEventMouseEnterLeave",mouseleave:"onEventMouseEnterLeave",capture:!0,thisObj:r}))}},{key:"focusDate",value:function(){var e,t=arguments.length>0&&arguments[0]!==i?arguments[0]:this.date,n=this,r=n.eventContentElement||n.contentElement;t=n.ingestDate(t);var a=null===(e=n.getDayElement)||void 0===e?void 0:e.call(n,t);a&&!li.isFocusable(a)&&(a=a.querySelector('[role="link"]')),a&&li.isFocusable(a)||(a=z(r.querySelectorAll("*")).find(li.isFocusable)),(a||n).focus({preventScroll:!0,focusVisible:!0})}},{key:"getTimeRanges",value:function(e,t){var n=this,r=this.resourceId,i=this.project,a=!r||this.owner.includeTimeRanges,o=null==r||a?null==i?void 0:i.getTimeRanges(e,t):[];if(null!=r){var l=null==i?void 0:i.getResourceTimeRanges(e,t).filter((function(e){return e.resourceId==r}));l.forEach((function(e){e.color||(e.color=n.resource.eventColor)})),o.push.apply(o,z(l))}return o}},{key:"updateIncludeTimeRanges",value:function(){this.isConfiguring||this.refresh()}},{key:"onConfigChange",value:function(e){var n;null!==(n=this.autoRefresh)&&void 0!==n&&n[null==e?void 0:e.name]&&this.refreshSoon(),B(t,"onConfigChange",this,3)([e])}},{key:"changeAvatarRendering",value:function(e){return yc.new({element:this.element},e)}},{key:"updateShowResourceAvatars",value:function(e){e&&(this.avatarRendering||(this.avatarRendering=!0)),this.refresh()}},{key:"getResourceAvatar",value:function(e){return this.avatarRendering.getResourceAvatar({resourceRecord:e,imageUrl:!1===e.image?null:e.imageUrl||e.image&&this.resourceImagePath+e.image,color:e.eventColor,initials:e.initials,dataset:{btip:Le.encodeHtml(e.name),resourceId:e.id}})}},{key:"updateEventHeight",value:function(e){var t=this.element.style;this._eventHeightInPixels=null,t.setProperty("--event-height",li.setLength(e)),t.setProperty("--arrow-width","calc(var(--event-height) / 3)"),t.setProperty("--arrow-margin","calc(var(--event-height) / -3)"),this.isConfiguring||this.refreshSoon()}},{key:"eventHeightInPixels",get:function(){var e=this,t=e.eventHeight,n=e._eventHeightInPixels;return"auto"!==t&&(n||("string"==typeof(n=e._eventHeight)&&(n=li.measureSize(n,e.contentElement.querySelector(".".concat(e.eventBarContainerCls)),!1)),e._eventHeightInPixels=n)),n}},{key:"visibleCellSelector",get:function(){var e=[];return this.hideOtherMonthCells&&e.push(".".concat(this.otherMonthCls)),this.hideNonWorkingDays&&e.push(".".concat(this.nonWorkingDayCls)),".".concat(this.dayCellCls).concat(e.length?":not(".concat(e.join(","),")"):"")}},{key:"activeView",get:function(){return this}},{key:"activeSubView",get:function(){var e;return(null===(e=this.items)||void 0===e||null===(e=e.filter(fA))||void 0===e?void 0:e[0])||this}},{key:"eachView",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:null;this.callback(e,n||this,t||[this])}},{key:"focusElement",get:function(){var e=this.calendar;if(e){var n=e.navigator;return n.activeItem||n.previousActiveItem||this.element.querySelector(n.itemSelector)||B(t,"focusElement",this,1)}}},{key:"captureFocusItem",value:function(e){var n=this,r=this.getEventRecord(e),a=B(t,"captureFocusItem",this,3)([e]);return function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0],t=r&&n.getEventElement(r);t?e?t.focus():t.focus({preventScroll:!0}):null==a||a(e)}}},{key:"refresh",value:function(){this.refreshSoon.cancel(),this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.whenVisible("refreshNow")}},{key:"refreshNow",value:function(){var e=this.captureFocus();this.doRefresh(),e()}},{key:"afterRefresh",value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:{delay:100,forceRefresh:!1};return"object"===W(e)?(n=e,e=null):e&&(e=(e=this.resolveCallback(e,this)).handler.bind(e.thisObj)),"number"==typeof n&&(n={delay:n}),new Promise((function(r){t.ion({name:t.constructor.generateId("refresh-expiry-timer-"),refresh:function(){var t;null===(t=e)||void 0===t||t(),r(!0)},once:!0,expires:{delay:n.delay||100,alt:function(){var i;n.forceRefresh&&t.refresh(),null===(i=e)||void 0===i||i(),r(n.forceRefresh)}}})}))}},{key:"displayName",get:function(){return Le.capitalize(this._displayName||this.title||this.type)}},{key:"hasNonWorkingDays",get:function(){return Boolean(Object.values(this.nonWorkingDays||dA).some((function(e){return e})))&&!(this.isDayView&&1===this.duration)}},{key:"hiddenNonWorkingDays",get:function(){return this.hideNonWorkingDays?this.nonWorkingDays||this.month.nonWorkingDays:dA}},{key:"changeAutoCreate",value:function(e){if(e){var n=W(e);"object"!==n&&(e={gesture:"string"===n?e:"dblclick"}),(e=rn.merge(e,t.$meta.config.autoCreate)).durationUnit=ql.from(e.duration).unit}return e}},{key:"updateDateSeparator",value:function(){this.refreshCalendarDescription()}},{key:"updateDescriptionFormat",value:function(){this.refreshCalendarDescription()}},{key:"refreshCalendarDescription",value:function(){var e=this.calendar;null!=e&&e.isPainted&&e.activeView===this&&e.updateViewDescription()}},{key:"changeShortEventDuration",value:function(e){return isNaN(e)?Pl.as("ms",e):Number(e)}},{key:"updateShortEventDuration",value:function(){this.isConfiguring||this.setTimeout({fn:"whenVisible",delay:200,cancelOutstanding:!0,args:["refreshNow"]})}},{key:"updateLocalization",value:function(){"weekStartDay"in this.initialConfig||(this.weekStartDay=Pl.weekStartDay),"nonWorkingDays"in this.initialConfig||(this.nonWorkingDays=Pl.nonWorkingDays),B(t,"updateLocalization",this,3)([]),this.refreshCalendarDescription()}},{key:"updateAutoCreate",value:function(e){this.updateLocalization()}},{key:"updateWeekStartDay",value:function(e){var n,r=this.refreshCount,i=this.month;null===(n=B(t,"updateWeekStartDay",this,3))||void 0===n||n([e]),i&&(i.weekStartDay=e),this.isPainted&&this.refreshCount===r&&this.refresh()}},{key:"changeNonWorkingDays",value:function(e){var t=this,n=new Proxy(Be.assign({},e),{set:function(e){var n=Reflect.set.apply(Reflect,arguments);return t.updateNonWorkingDays(e),n},deleteProperty:function(e){var n=Reflect.deleteProperty.apply(Reflect,arguments);return t.updateNonWorkingDays(e),n}});return n}},{key:"updateNonWorkingDays",value:function(e){var n,r=this.refreshCount,i=this.month;null===(n=B(t,"updateNonWorkingDays",this,3))||void 0===n||n([e]),i&&(i.nonWorkingDays=e),this.isPainted&&this.refreshCount===r&&this.refresh()}},{key:"dayOfDate",value:function(e){return Pl.clearTime(e)}},{key:"ingestDate",value:function(e){if(e="string"==typeof e?Pl.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");return this.dayOfDate(e)}},{key:"changeDate",value:function(e,t){var n=this,r=n.isEventList,i=n.ingestDate(e),a=r&&!n.range?"betweenLesserEqual":"betweenLesser";if(e=n.constrainTargetDate(i),1===arguments.length)return e;if((!t||e-t)&&!1!==n.trigger("beforeDateChange",{date:e,oldDate:t})){var o=Pl.diff(i,e,"d");if(!o||!Pl[a](e,n.startDate,n.endDate))return e;if(r&&n.rowManager.rowCount){var l=n[o<0?"lastFullyVisibleRow":"firstFullyVisibleRow"],s=l&&n.getDateFromElement(l.cells[0]);s&&(e=s)}n._date=e}}},{key:"constrainTargetDate",value:function(e,t){var n,r,i=this,a=i.minDate||(null===(n=i.calendar)||void 0===n?void 0:n.minDate),o=i.maxDate||(null===(r=i.calendar)||void 0===r?void 0:r.maxDate);if(!(i.isInCoerceTargetDate||isNaN(a)&&isNaN(o))){i.isInCoerceTargetDate=!0;var l=t?i["change".concat(Le.capitalize(t),"Date")](e,null):e;if(i.isInCoerceTargetDate=!1,!isNaN(a)&&l<a)return a;if(!isNaN(o)&&l>o)return o}return e}},{key:"changeStartDate",value:function(e){if(e)return this.ingestDate(e)}},{key:"changeEndDate",value:function(e){if(e)return this.ingestDate(e)}},{key:"scrollTo",value:(a=f(L().mark((function e(t,n){var r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=this).scrollable,e.next=3,r.scrollPromise;case 3:if(n=Be.assign({},r.defaultScrollOptions,"boolean"==typeof n?{animate:n}:n),t.isEvent?(a=t,Pl.intersectSpans(r.startDate,r.endDate,t.startDate,t.endDate)||(r.date=t.startDate),(t=r.getEventElement(t))||(r.refresh(),t=r.getEventElement(a))):(t=r.ingestDate(t),Pl.betweenLesser(t,r.startDate,r.endDate)&&r.getDayElement(t,!0)||(r.date=t),t=r.getDayElement(t)),null!=t){e.next=7;break}return e.abrupt("return");case 7:return i?r.scrollPromise=i.scrollIntoView(t,n).then((function(){return r.scrollPromise=null})):n.highlight&&("boolean"==typeof n.highlight?li.highlight(pt.from(t)):r.callback(n.highlight,r,[t,r])),e.abrupt("return",r.scrollPromise);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"checkAutoCreateGesture",value:(r=f(L().mark((function e(t,n,r){var a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=(o=this).autoCreate,!n||!o.isVisible||o.readOnly||t.type!==(null==l||null===(a=l.gesture)||void 0===a?void 0:a.toLowerCase())){e.next=5;break}if(s=Pl.startOf(n,i,i,o.weekStartDay),u=isNaN(l.startHour)?Pl.getTimeOfDay(Pl.parse(l.startHour,"HH:mm:ss")):1e3*l.startHour*60*60,!1===o.trigger("beforeAutoCreate",{view:o,domEvent:t,date:o.isDayView?Pl[l.snapType](n,l.step):Pl.add(s,u),resourceRecord:r})){e.next=5;break}return e.abrupt("return",o.createEvent(n,r,!0));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"createEvent",value:function(e,t,n){var r;(this.calendar||(null===(r=this.owner)||void 0===r?void 0:r.calendar)||this).doCreateEvent(e,t,this,n)}},{key:"doCreateEvent",value:(n=f((function(e,t){var n=this,r=arguments.length>2&&arguments[2]!==i?arguments[2]:this,a=arguments.length>3?arguments[3]:i;return L().mark((function i(o){var l,s,u,c,d,h,f,v,g,m,p,y,k,b,C,w,D,x,E,R,T,M,F;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t=null!=t?t:n.defaultCalendar,s=(l=n).viewType||l,u=s.isDayView,c=l.calendar||(null===(o=l.owner)||void 0===o?void 0:o.calendar),d=(null==c?void 0:c.eventStore)||l.eventStore,h=r.autoCreate||r.changeAutoCreate(!0),f=d.modelClass,v=h.newName,(null==e||!u&&a)&&(g=l.activeView,m=g.dayStartHour,p=g.dayEndHour,y=Math.min(Math.max(h.startHour,m),p),k=y===p?m:y,b=isNaN(k)?isNaN(h.startHour)?Pl.getTimeOfDay(Pl.parse(h.startHour,"HH:mm:ss")):36e5*h.startHour:36e5*k,e=Pl.add(e||l.date,b)),C=Pl.parseDuration(h.duration),w=new Date(e.getTime()+(l.dayStartShift||0)),D=u?Pl[h.snapType](e,h.step):w,x=u&&a?{magnitude:l.dayTime.startShift?Math.min(C.magnitude,Pl.diff(D,Pl.add(l.dayTime.startOfDay(e),l.dayTime.duration(),"ms"),C.unit)):Math.min(C.magnitude,Pl.diff(D,Pl.add(Pl.startOf(e),l.dayTime.timeEnd),C.unit)),unit:C.unit}:C,E=Pl.add(D,x.magnitude,x.unit),R=l.resolveCallback(v,l,!1)?l.callback(v,l,[l,D,t]):v,T=S(S(S(S(S(S({},f.getFieldDataSource("name"),R),f.getFieldDataSource("startDate"),D),f.getFieldDataSource("endDate"),E),f.getFieldDataSource("duration"),x.magnitude),f.getFieldDataSource("durationUnit"),x.unit),"allDay",1===Pl.diff(D,E,"day")),M=r.isEventList&&!r.range?"betweenLesserEqual":"betweenLesser",F=d.createRecord(T),null!=c&&c.features.eventEdit&&!c.features.eventEdit.disabled&&(F.isCreating=!0),t&&d.assignmentStore.assignEventToResource(F,t),i.next=8,d.addAsync(F);case 8:Pl[M](D,r.startDate,r.endDate)&&(r.getEventElement(F,D)?r.editAutoCreatedEvent(F):r.ion({refresh:function(e){var t,n=e.source;null===(t=n.editAutoCreatedEvent)||void 0===t||t.call(n,F)},once:!0,prio:-1e4,buffer:100,expires:500}));case 9:case"end":return i.stop()}}),i)}))()})),function(e,t){return n.apply(this,arguments)})},{key:"editAutoCreatedEvent",value:function(e){this.trigger("eventAutoCreated",{eventRecord:e})}},{key:"duration",get:function(){return this.endDate?this.calculateDuration(this.startDate,this.endDate):1}},{key:"calculateDuration",value:function(e,t){return Pl.diff(e,t,"day")}},{key:"next",value:function(){this.date=Pl.add(this.date,this.duration,"day")}},{key:"previous",value:function(){this.date=Pl.add(this.date,-this.duration,"day")}},{key:"eventContentElement",get:function(){return this.contentElement}},{key:"eventCount",get:function(){var e,t=this,n=t.dateFilter,r=t.hiddenNonWorkingDays;return t.views?t.views.reduce((function(e,t){return e+(t.eventCount||0)}),0):t.cellMap?[].concat(z(t.cellMap.values()),z((null===(e=t.allDayEvents)||void 0===e?void 0:e.cellMap.values())||[])).reduce((function(e,i){return n&&!t.callback(n,t,[i])||r[i.day]||(e+=i.events.length),e}),0):t.eventStore.getEvents({startDate:t.startDate,endDate:t.endDate}).length}},{key:"firstVisibleCell",get:function(){return this.eventContentElement.querySelector(this.visibleCellSelector)}},{key:"lastVisibleCell",get:function(){var e=this.contentElement.querySelectorAll(this.visibleCellSelector);return e[e.length-1]}},{key:"firstVisibleDate",get:function(){for(var e=this,t=new Date(e.startDate),n=e.month.month,r=e.duration;r&&(e.hideOtherMonthCells&&t.getMonth()!==n||e.hiddenNonWorkingDays[t.getDay()]);)t.setDate(t.getDate()+1),r--;return t}},{key:"lastVisibleDate",get:function(){for(var e=this,t=Pl.add(e.endDate,-1,"d"),n=e.month.month,r=e.duration;r&&(e.hideOtherMonthCells&&t.getMonth()!==n||e.hiddenNonWorkingDays[t.getDay()]);)t.setDate(t.getDate()-1),r--;return t}},{key:"updateHideNonWorkingDays",value:function(e){var n,r,i=this,a=i.month,o=i.calendar;if(null===(n=i.contentElement)||void 0===n||n.classList[e?"add":"remove"](i.hideNonWorkingDaysCls),null!=a){var l,s,u,c;if(!i.isConfiguring&&e)u=null===(c=s=i.date)||void 0===c?void 0:c.getDay(),s&&i.nonWorkingDays[u]&&i.getDayElement(s)&&(l=a.visibleDayColumnIndex[u]);if(a.hideNonWorkingDays=e,null===(r=B(t,"updateHideNonWorkingDays",this,3))||void 0===r||r([e]),"number"==typeof l){for(var d=a.getWeekStart(a.getWeekNumber(s)),h=Math.min(l,a.visibleColumnCount-1),f=-1;"number"!=typeof a.visibleDayColumnIndex[d.getDay()]||++f!==h;d.setDate(d.getDate()+1));i.date=d,o&&(o.date=s)}}}},{key:"onCalendarStoreChange",value:function(e){var t,n=e.source,r=this;("dataset"!==e.action||n.isChained)&&(r.project.isInitialCommitPerformed&&!r.project.isWritingData&&r.project.isEngineReady()&&(null===(t=r._cellMap)||void 0===t||t.clear(),r.isVisible&&null==r.allowTransitionsOnRefresh&&(r.allowTransitionsOnRefresh=!0),r.refreshSoon()))}},{key:"refreshSoon",value:function(){this.refresh()}},{key:"onEventCreated",value:function(e){}},{key:"getEventRecord",value:function(e){var t,n,r=e instanceof Event?e.target:e;return(r=null===(t=r)||void 0===t||null===(n=t.closest)||void 0===n?void 0:n.call(t,"[data-event-id]"))&&this.eventStore.getById(r.dataset.eventId)}},{key:"getResourceRecord",value:function(e){var t,n=e instanceof Event?e.target:e;return(n=(null===(t=n)||void 0===t?void 0:t.closest("[data-resource-id]"))||null)&&this.resourceStore.getById(n.dataset.resourceId)}},{key:"resolveEventRecord",value:function(e){return this.getEventRecord(e)}},{key:"getDateFromElement",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:null,r=arguments.length>2&&arguments[2]!==i&&arguments[2],a=null==e?void 0:e.closest("[data-date],[data-header-date],[data-month-date]");if(a){var o=a.dataset.date||a.dataset.headerDate||a.dataset.monthDate;return r?o:(n||(this.isDayView?this.dayTime:Pl)).parseKey(o)}if(a=null==e?void 0:e.closest("[data-week]"))return null===(t=this.month)||void 0===t?void 0:t.getWeekStart(a.dataset.week.split(",").map(Number))}},{key:"getDateFromDomEvent",value:function(e){return this.getDateFromElement(li.getEventElement(e))}},{key:"getDateFromPosition",value:function(){return null}},{key:"dateKey",value:function(e){return Pl.makeKey(e)}},{key:"getDayElement",value:function(e,t){return"string"!=typeof e&&(e=this.dateKey(e)),this.eventContentElement.querySelector('[data-date="'.concat(e,'"]'))}},{key:"getDayElementFromX",value:function(e){for(var t,n,r=this.eventContentElement.querySelectorAll("[data-date]"),i=0,a=r.length;i<a;i++)if(e>=(t=(n=r[i]).getBoundingClientRect()).x&&e<=t.x+t.width)return n;return r[0]}},{key:"getEventElement",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:Math.max(e.startDate,this.firstVisibleDate||this.startDate),r=this,a=null===(t=r.calendar)||void 0===t?void 0:t.navigator.activeItem,o=r.getDateFromElement(a),l=r.eventStore.modelClass.asId(e);if(document.contains(a)&&(null==a?void 0:a.dataset.eventId)===String(l)&&o&&!(n-o))return a;if(n){var s=r.getDayElement(n);if(s)return li.down(s,'[data-event-id="'.concat(l,'"]'))}return r.getEventElements(e)[0]}},{key:"getEventElements",value:function(e){var t=this.eventStore.modelClass.asId(e);return this.eventContentElement.querySelectorAll('[data-event-id="'.concat(t,'"]'))}},{key:"onEventMouseOverOut",value:function(e){var t=this,n=t.currentOverEventEl,r="mouseout"===e.type,i=e[r?"relatedTarget":"target"],a=(null==i?void 0:i.closest(".b-cal-event-wrap"))||null;if(a!==(n||null))return r?(t.currentOverEventEl=null,n&&Object.defineProperty(e,"target",{configurable:!0,get:function(){return n}}),t.onCalendarPointerInteraction(e)):(t.currentOverEventEl=a,t.onCalendarPointerInteraction(e))}},{key:"onEventMouseEnterLeave",value:function(e){if(e.target.classList.contains("b-cal-event"))return this.onCalendarPointerInteraction(e)}},{key:"calendarHitTest",value:function(e){var t,n,r=this,i=r.monthSelector,a=r.getDateFromDomEvent(e),o=li.getEventElement(e),l=null;if((t=o.closest(".b-cal-event-wrap"))&&(n=r.eventStore.getById(t.dataset.eventId)))l={type:"event",eventElement:t,eventRecord:n};else if(t=o.closest(r.dayNameSelector))l={type:"dayNumber",dayNumberElement:t};else if(t=o.closest(".b-week-num,.b-week-number-cell")){var s=o.closest(".b-calendar-week");s&&s.dataset.week&&(l={type:"weekNumber",week:s.dataset.week.split(",").map(Number),weekNumberElement:t,weekElement:s})}else i&&o.closest(i)&&(l={type:"monthName",month:a.getMonth(),date:a});return l||((t=o.closest(".b-cal-cell-overflow"))?l={type:"cellOverflow",cellOverflowElement:t}:a&&(l={type:"schedule"})),l&&(l.resource=r.getResourceRecord(e),l.cell=o.closest(".b-calendar-cell"),l.date=a,l.view=r),l}},{key:"onCalendarPointerInteraction",value:function(e){var t,n=this,r=n.monthSelector,a=e.target,o=Boolean(a.closest(".b-overflowpopup")),l=hA[e.type],s=a.closest(".b-cal-event-wrap"),u=s?n.eventStore.getById(s.dataset.eventId):n.getEventRecord(a),c=!o&&n.isDayCellRenderer&&(null==u?void 0:u.isInterDay),d=!e.key&&c?n.getDateFromXY([e.clientX,e.clientY]):n.getDateFromDomEvent(e),h=s||u&&n.getEventElement(u,d),f=a.closest("[data-resource-id]"),v=f&&n.resourceStore.getById(f.dataset.resourceId);if(v&&(t=n.trigger("resource".concat(l),{domEvent:e,date:d,eventElement:h,eventRecord:u,resourceRecord:v,fromOverflowPopup:o})),a.closest(n.dayNameSelector)&&!1===(t=n.trigger("dayNumber".concat(l),{domEvent:e,date:d,cellData:n.cellMap.get(d)||n.createCellData(d),resourceRecord:v,fromOverflowPopup:o})))return t;if(o||n.eventContentElement.contains(a)){if(!1!==t&&u){var g=n.trigger("event".concat(l),{domEvent:e,date:d,eventElement:h,eventRecord:u,resourceRecord:v,fromOverflowPopup:o});g&&(t=g)}if(u)return t;if(a.closest(".b-week-num,.b-week-number-cell")){var m=e.target.closest("[data-week]");if(m)return n.trigger("weekNumber".concat(l),{domEvent:e,week:m.dataset.week.split(",").map(Number),date:n.getDateFromElement(m.querySelector(".b-calendar-cell")),fromOverflowPopup:o})}if(r&&a.closest(r))return n.trigger("monthName".concat(l),{domEvent:e,month:d.getMonth(),date:d,fromOverflowPopup:o});if(!a.closest(".b-cal-cell-overflow")||!1===n.trigger("cellOverflow".concat(l),{domEvent:e,date:d,fromOverflowPopup:o,resourceRecord:v}))return d&&n.dayCellCls&&e.target.closest(".".concat(n.dayCellCls))&&!1===(t=n.trigger("schedule".concat(l),{domEvent:e,date:d,fromOverflowPopup:o,resourceRecord:v}))||n.checkAutoCreateGesture(e,n.getDateFromDomEvent(e,!0),v||i),t}}},{key:"undoRedoDataChange",value:function(e){var t,n;if(null!==(t=this.calendar)&&void 0!==t&&t.enableUndoRedoKeys)return null===(n=this.project)||void 0===n||null===(n=n.stm)||void 0===n?void 0:n.onUndoKeyPress(e)}},{key:"onCalendarKeyDown",value:function(e){this.onCalendarPointerInteraction(e)}},{key:"isAllDayEvent",value:function(e){return e.allDay||(e.isScheduled&&this.dayTime?this.dayTime.isInterDay(e):e.isInterDay)}},{key:"sortEvents",value:function(e){e.sort(this.eventSorter)}},{key:"preProcessCurrentConfigs",value:function(e){B(t,"preProcessCurrentConfigs",this,3)([e]),delete e.calendar,delete e.project}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return delete n.project,n}}],[{key:"configurable",get:function(){return{localizableProperties:["autoCreate.newName","timeFormat","shortDateFormat","shortDateTimeFormat"],contentElMutationObserver:null,eventStore:null,resourceStore:null,eventSorter:cA.defaultSorterFn,responsive:{},hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",weekStartDay:Pl.weekStartDay,nonWorkingDays:{value:Pl.nonWorkingDays,$config:{merge:"replace"}},nonWorkingDayCls:"b-nonworking-day",dayCellCls:"b-calendar-cell",weekendCls:"b-weekend",todayCls:"b-today",pastEventCls:"b-past-event",shortEventCls:"b-short-event",shortEventDuration:"30 minutes",eventHeight:25,eventSpacing:2,intradayCls:"b-intraday",alldayCls:"b-allday",solidBarCls:"b-solid-bar",dayNameSelector:".b-day-name",showTime:!1,timeFormat:{value:"LT",$config:{localeKey:"L{timeFormat}"}},showBullet:{bar:!1,noBar:!0},eventColourStyleProperty:"color",handlePointerInteraction:!0,shortDateFormat:{value:"ll",$config:{localeKey:"L{shortDateFormat}"}},title:null,shortDateTimeFormat:{value:"ll LT",$config:{localeKey:"L{shortDateTimeFormat}"}},readOnly:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",snapType:"round",duration:"1 hour",startHour:8},dragUnit:"hour",autoRefresh:{$config:{merge:"classList"},value:null},allowOverlap:!0,syncViewDate:!0,syncCalendarDate:!0,focusable:!1,avatarRendering:{$config:"lazy",value:null},showResourceAvatars:null,resourceImagePath:null,minDate:null,maxDate:null,animateTimeShift:!0,includeTimeRanges:null,defaultScrollOptions:{animate:!0},selectorButton:null,selectorMenuItem:null,testConfig:{animateTimeShift:!1},extendAllDayEndDay:null,activationKey:null,keyMap:{"Ctrl+z":"undoRedoDataChange","Shift+Ctrl+z":"undoRedoDataChange"}}}},{key:"delayable",get:function(){return{refreshSoon:{type:"raf",cancelOutstanding:!0}}}},{key:"featureable",get:function(){return{factory:KF}}}]);var n,r,a}((e||Mn).mixin(qE,sA,ry,iA,eA,rC)),S(t,"$name","CalendarMixin"),t},gA=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"firstFreeSlot",0),e}return R(t,e),w(t,[{key:"set",value:function(e,t){var n=this;if(null==e)return n.add(t);if(n[e]=t,n.firstFreeSlot===e)for(;n[n.firstFreeSlot];)n.firstFreeSlot++}},{key:"add",value:function(e){var t=this.firstFreeSlot;for(this[t]=e;this[this.firstFreeSlot];)this.firstFreeSlot++;return t}},{key:"setEvents",value:function(e){for(var t=this.length=this.firstFreeSlot=e.length,n=0;n<t;n++)this[n]=e[n]}}])}(Y(Array));gA._$name="EventSlots";var mA=function(e,t){var n=e.key,r=t.key;return n<r?-1:r<n?1:0},pA=function(e){return e.endDate||Pl.add(e.startDate,e.duration,e.durationUnit)},yA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dayTime",get:function(){return my.MIDNIGHT}},{key:"cellMonth",get:function(){return this._cellMonth||(this._cellMonth=new Cy({}))}},{key:"changeEventFilter",value:function(e){if("string"==typeof e){var t=this.resolveCallback(e),n=t.handler,r=t.thisObj;e=n.bind(r)}return e}},{key:"updateStackMultiDayEvents",value:function(){this.whenVisible("refresh")}},{key:"createCellMap",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this,n=e,r=n.filter,a=n.skipPropagate,o=t.eventFilter,l=t.cellMonth,s=t.lastVisibleDate,u=e.cellMap||t._cellMap||(t._cellMap=new kA);t.stackMultiDayEvents&&(t.eventSorter=cA.defaultSorterFn),s&&s.setDate(s.getDate()+1);var c=e.startDate||t.firstVisibleDate||t.startDate,d=e.endDate||s||t.endDate;if(l.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:c}),t.eventStore){e=Be.assign({dayTime:my.MIDNIGHT},e,{filter:r&&o?function(e){return r(e)&&o(e)}:r||o,dateMap:u,startDate:c,endDate:d}),t.collectEvents(e),c=e.startDate,d=e.endDate;for(var h=function(){var n=v[f],r=0,i=e.dayTime,o=i.dayOfDate(Pl.parseKey(n)),l=t.createCellData(o),s={events:u.get(n),date:o};t.sortEvents(s.events,o),t.trigger("dayCellPopulated",s);var h=s.events;if(e.rawEvents?(r=Math.min(d,Math.max.apply(Math,h.map(pA))),l.events=h):l.events=h.map((function(e){var n=e.endingDate,i=n>l.tomorrow,s={isAllDay:t.isAllDayEvent(e),isOverflow:e.startDate<l.date&&o-c,eventRecord:e,eventEndDate:n,overflows:i,date:o};return a||(r=Math.min(d,Math.max(r,n)),i&&(s.propagateEndDate=t.calculatePropagateEndDate(s,d))),s})),!a)for(;o<r;o.setDate(o.getDate()+1)){var g=i.dateKey(o);u.has(g)||u.set(g,t.createCellData(o))}u.set(n,l)},f=0,v=z(u.keys());f<v.length;f++)h();if(u.size){var g,m=z(u.values()).sort(mA);u.clear(),m.forEach((function(e){u.set(e.key,e),g&&(g.nextEvents=e,e.previousEvents=g),g=e})),a||t.propagateCellEvents(m[0],u)}}return u.populated=!0,t.trigger("cellMapPopulated",{cellMap:u}),u}},{key:"calculatePropagateEndDate",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.endDate,n=e.eventEndDate,r=this.dayTime.startOfDay(n);return e.propagateEndDate=new Date(Math.min(n>r?Pl.add(r,1,"day"):n,t)),this.trigger("eventPropagate",e),e.propagateEndDate}},{key:"collectEvents",value:function(e){return this.eventStore.getEvents(e)}},{key:"propagateCellEvents",value:function(e,t){for(var n=this,r=e.events,i=e.renderedEvents,a=e.previousEvents,o=e.nextEvents,l=e.date,s=n.stackMultiDayEvents,u=n.getEventsPerCell(l),c=r.length,d=0;d<c;d++){var h=r[d],f=h.eventRecord,v=h.propagateEndDate,g=h.eventEndDate,m=i.add(h);if(h.overflows){for(var p=e.visible,y=void 0,k=o;k&&k.date<v;k=k.nextEvents)k.columnIndex&&!s||(m=k.renderedEvents.firstFreeSlot),k.renderedEvents.set(m,y={eventRecord:f,eventEndDate:g,propagateEndDate:v,isAllDay:h.isAllDay,isOverflow:p,overflows:!0}),p=p||k.visible;y&&(y.overflows=!1)}}e.maxRow=i.length;var b=i[u-1];if(i.length===u)null!=b&&b.isOverflow&&null!=a&&a.hasOverflow&&(e.maxRow--,e.hasOverflow=!0);else if(i.length>u&&(e.maxRow=u-1,e.hasOverflow=!0,null!=b&&b.isOverflow&&!n.hiddenNonWorkingDays[e.day]))for(var C,w=(null===(C=n.getWeekContext)||void 0===C?void 0:C.call(n,l).visibleWeekStart)||n.firstVisibleDate,D=Pl.clearTime(b.eventRecord.startDate).valueOf(),S=t.get(Pl.makeKey(new Date(Math.max(w,D))));S.key!==e.key;)S.hasOverflow=!0,S.maxRow=u-1,S=S.nextEvents;o&&n.propagateCellEvents(o,t)}},{key:"createCellData",value:function(e){return Object.assign(this.cellMonth.getCellData(e,this.month,this.dayTime),{view:this,events:[],resource:this.resource,renderedEvents:new gA})}}])}(e||Mn),S(t,"$name","DayCellCollecter"),S(t,"configurable",{eventFilter:{$config:"lazy",value:null},stackMultiDayEvents:null}),t},kA=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"populated",!1),e}return R(t,e),w(t,[{key:"get",value:function(e,n){return B(t,"get",this,3)([Pl.makeKey(e),n])}},{key:"set",value:function(e,n){return e=Pl.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),B(t,"set",this,3)([e,n])}},{key:"delete",value:function(e,n){return e=Pl.makeKey(e),this.has(e)&&this.generation++,B(t,"delete",this,3)([e,n])}},{key:"has",value:function(e){return B(t,"has",this,3)([Pl.makeKey(e)])}},{key:"clear",value:function(){if(this.populated)return this.populated=!1,this.generation=(this.generation||0)+1,B(t,"clear",this,3)([])}}])}(Y(a)),bA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"calendarHitTest",value:function(e){var t,n=li.getEventElement(e).closest(".b-cal-event-wrap");return n&&(t=this.owner.eventStore.getById(n.dataset.eventId))?{eventRecord:t,type:"event",eventElement:n,view:this}:null}},{key:"onPanelHeaderClick",value:function(e){var n,r=e.event;r.target.closest(".b-header-title")?null===(n=this.owner)||void 0===n||n.trigger("dayNumberClick",{domEvent:r,date:this.activeDate,cellData:this.cellData,source:this.owner,fromOverflowPopup:!0}):B(t,"onPanelHeaderClick",this,3)(arguments)}},{key:"focusElement",get:function(){var e,n=li.getActiveElement(this);return this.element.contains(n)?n:(null===(e=this.eventList)||void 0===e||null===(e=e.element)||void 0===e?void 0:e.firstElementChild)||B(t,"focusElement",this,1)}},{key:"getDateFromPosition",value:function(){return this.activeDate}},{key:"getEventElement",value:function(e){return this.contentElement.querySelector('[data-event-id="'.concat(e.id,'"]'))}},{key:"showOverflow",value:function(e,t){var n,r=this,i=r.activeDate=t.date;(r.cellData=t,r.targetCell=e,t.resource&&(r.element.dataset.resourceId=t.resource.id),r.refresh(t),r.showBy(e),r.isVisible)&&(null===(n=r.owner)||void 0===n||n.trigger("showOverflowPopup",{cell:e,cellData:t,date:i,overflowPopup:r}))}},{key:"onCalendarStoreChange",value:function(){var e=this;e.isVisible&&(e.cellData=e.owner.cellMap.get(Pl.makeKey(e.activeDate)),e.refresh(e.cellData))}},{key:"refresh",value:function(e){var t,n;if(this.eventList){e?this.cellData=e:e=this.cellData;var r=this,i=r.owner,a=r.eventRenderer,o=r.eventSorter,l=r.eventList.element,s=r.onlyShowOverflow?Math.max(i.eventsPerCell-1,0):0,u=null===(t=e)||void 0===t?void 0:t.renderedEvents.slice(s),c=[];if(null==u||!u.length||(null===(n=e)||void 0===n||!n.hasOverflow)&&!i.isYearView)return r.hide();o&&u.sort(o);for(var d=0,h=0,f=u.length;d<f;d++,h++){var v=u[d];if(v){var g=i.createEventDomConfig(v,a);Object.assign(g.className,{"b-continues-past":v.eventRecord.startDate<e.date,"b-continues-future":v.eventRecord.endDate>e.tomorrow}),g.style.marginBottom="".concat(i.eventSpacing,"px"),c.push(g)}}fa.sync({domConfig:{children:c},targetElement:l}),l.dataset.date=e.key,l.classList.add("b-day-of-week-".concat(e.day)),l.classList.remove("b-day-of-week-".concat(r.lastRefreshDay)),r.lastRefreshDay=e.day,r.realign()}}},{key:"changeItems",value:function(e){var n=this.eventList;n&&(e.eventList=n);var r=B(t,"changeItems",this,3)([e]);return n&&(this.eventList=this.widgetMap.eventList),r}},{key:"changeActiveDate",value:function(e,t){if(e="string"==typeof date?Pl.parse(e):new Date(e),isNaN(e))throw new Error("OverflowPopup date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}},{key:"updateActiveDate",value:function(e){this.element.dataset.date=Pl.makeKey(e),this.title='<span tabIndex="0" role="link" aria-label="'.concat(Pl.format(e,"dddd, D MMMM"),'">').concat(Pl.format(e,this.dateFormat),"</span>")}},{key:"onDocumentMouseDown",value:function(e){var n,r=e.event,i=null===(n=this.lastAlignSpec)||void 0===n?void 0:n.target,a=r.target;if(null!=i&&i.contains(a)){var o=a.closest(".b-cal-cell-overflow");if(a.closest(".b-cal-event-bar-container")||a.matches(".b-cal-cell-overflow")||1===(null==o?void 0:o.children.length))return r.preventDefault()}B(t,"onDocumentMouseDown",this,3)(arguments)}}])}(fc);S(bA,"$name","OverflowPopup"),S(bA,"type","overflowpopup"),S(bA,"configurable",{defaultFocus:".b-cal-event-wrap",textContent:!1,autoShow:!1,floating:!1,cls:"b-cal-event-list",closable:!0,draggable:{handleSelector:":not(.b-cal-event-wrap)"},anchor:!0,layout:"vbox",eventRenderer:null,eventSorter:null,eventList:{type:"widget",cls:"b-cal-event-bar-container",weight:500},items:{},tools:{maximize:null},dateFormat:"dddd, MMM DD",activeDate:{$config:{equal:"date"},value:null},scrollAction:"realign",align:{axisLock:"flexible",constrainPadding:20,minHeight:400},scrollable:{overflowY:"auto"},onlyShowOverflow:null}),bA.initClass(),bA._$name="OverflowPopup";var CA=function(){},wA=fr.eventNameMap,DA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onCalendarStoreChange",value:function(){var e,n;(B(t,"onCalendarStoreChange",this,3)(arguments),null!==(e=this._overflowPopup)&&void 0!==e&&e.isVisible)&&(n=this._overflowPopup).onCalendarStoreChange.apply(n,arguments)}},{key:"onCellOverflowGesture",value:function(e){var t=e.domEvent,n=e.date,r=this,i=r.cellMap.get(Pl.makeKey(n));if(i){var a=r.overflowPopup,o=r.getCellFromEvent(t);a&&r.trigger("beforeShowOverflowPopup",{cell:o,cellData:i,date:n,overflowPopup:a})&&a.showOverflow(o,i)}}},{key:"getCellFromEvent",value:function(e){return e.target.closest(".b-calendar-cell[data-date]")}},{key:"changeOverflowPopupTrigger",value:function(e){return"mouseover"!==(e=e.toLowerCase())&&"hover"!==e||(e="mouseOver"),e}},{key:"updateOverflowPopupTrigger",value:function(e,t){t&&(this["onCellOverflow".concat(Le.capitalize(t))]=CA),this["onCellOverflow".concat(Le.capitalize(e))]=this.onCellOverflowGesture}},{key:"onEventMouseOverOut",value:function(e){var t=e.target,n=e.relatedTarget,r=e.type;if("mouseOver"===this.overflowPopupTrigger&&t.closest(".b-cal-cell-overflow")&&!n.closest(".b-cal-cell-overflow")){if("mouseover"===r)return this.onCalendarPointerInteraction.apply(this,arguments);var i;null===(i=this._overflowPopup)||void 0===i||i.hide()}return this.onCalendarPointerInteraction.apply(this,arguments)}},{key:"changeOverflowPopup",value:function(e,t){var n,i=this,a=i.up("calendar")||i.owner||i,o=bA.reconfigure(t,e,{owner:i,defaults:{positioned:!(null!=e&&e.floating),owner:i,align:{constrainTo:(null===(n=i.up("popup"))||void 0===n?void 0:n.contentElement)||r}}});if(o){var l=o.element,s=i.eventHeightInPixels;o.element.classList.add("b-".concat(i.type,"-overflowpopup")),o.positioned&&o.render(a.isCalendar?a.element:a.contentElement),s&&(l.style.setProperty("--event-height","".concat(s,"px")),l.style.setProperty("--arrow-width","".concat(s/3,"px"))),o!==t&&a!==i&&(fr.on({thisObj:i,element:o.bodyElement,delegate:".b-cal-event-wrap",mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}),o.headerElement&&fr.on({thisObj:i,element:o.headerElement,mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}))}return o}},{key:"onInternalResize",value:function(e,n,r,i,a){var o=this._eventsPerCell,l=this._eventContainerTop;B(t,"onInternalResize",this,3)([e,n,r,i,a]),this.rendered&&r!==a&&this.performResizeRefresh(o,l)}},{key:"performResizeRefresh",value:function(e,t,n){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null;var r=this,i=r.eventsPerCell,a=r._overflowPopup;i!==e&&r.trigger("eventsPerCellChange",{value:i,oldValue:e}),r.eventContainerTop===t&&i===e||(n?r.doRefresh():r.refresh(),null!=a&&a.isVisible&&a.refresh(r._cellMap.get(Pl.makeKey(a.activeDate))))}},{key:"updateEventHeight",value:function(){B(t,"updateEventHeight",this,3)(arguments),this._eventsPerCell=null,this.element.style.setProperty("--event-height-px","".concat(this.eventHeightInPixels,"px"))}},{key:"updateEventSpacing",value:function(e){this._eventsPerCell=null,this.isConfiguring||this.refreshSoon(),this.element.style.setProperty("--event-spacing","".concat(e,"px"))}},{key:"weeksElement",get:function(){return this.contentElement}},{key:"eventContainerHeight",get:function(){if(null==this._eventContainerHeight&&this.isVisible&&!this.isConfiguring){var e=this.firstVisibleCell;this._eventContainerHeight=e?e.offsetHeight-this.eventContainerTop:NaN}return this._eventContainerHeight}},{key:"eventContainerTop",get:function(){var e=this;if(null==e._eventContainerTop&&e.isVisible&&!e.isConfiguring){var t=e.firstVisibleCell,n=t&&t.querySelector(".b-cal-cell-header"),r=n?n.getBoundingClientRect().height:0;e._eventContainerTop=0===r?null:r,e.element.style.setProperty("--event-top","".concat(e._eventContainerTop,"px"))}return e._eventContainerTop||0}},{key:"getEventsPerCell",value:function(e){return this.eventsPerCell}},{key:"eventsPerCell",get:function(){var e=this;return null==e._eventsPerCell&&(e._eventsPerCell=Math.floor((e.eventContainerHeight+e.eventSpacing)/(e.eventHeightInPixels+e.eventSpacing))),e._eventsPerCell}},{key:"cellMap",get:function(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}},{key:"cellRenderer",value:function(e){var t=e.cell,n=this.getCellDomConfig.apply(this,arguments);fa.sync({domConfig:n,targetElement:t})}},{key:"getCellDomConfig",value:function(e){var t,n,r,i,a,o,l=e.cell,s=e.columnIndex,u=e.row,c=e.date,d=e.day,h=e.dayTime,f=void 0===h?my.MIDNIGHT:h,v=e.visibleColumnIndex,g=e.key,m=!this.isConfiguring&&this.cellMap.get(Pl.makeKey(c)),p=this,y=p.isMonthView,k=p.eventHeightInPixels,b=p.eventSpacing,C=p.weekLength,w=p.todayCls,D=p.emptyCellRenderer,x=p.dayCellNameFormat,E=p.resource,R={tabIndex:y?0:-1,role:y?"link":"columnheader","aria-label":"".concat(Pl.format(c,"dddd Do MMMM")).concat(E?" ".concat(E.name):"","."),dataset:{headerDate:g}},T=p.dayTime.startOfDay((null===(t=p.calendar)||void 0===t?void 0:t.dateTimeNow)||new Date),M=c.getTime()===T.getTime(),F=c.getDate(),A={className:p.eventBarContainerCls,role:"presentation",children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}},I={style:{},className:new Ct(S({"b-cal-cell-header":!0},w,M))},L={tabIndex:-1,role:"gridcell","aria-label":"".concat(Pl.format(c,"dddd Do MMMM")).concat(E?" ".concat(E.name):"",",  ").concat(p.L("eventCount",(null===(n=(null===(r=m)||void 0===r?void 0:r.renderedEvents)||(null===(i=m)||void 0===i?void 0:i.events))||void 0===n?void 0:n.length)||0),"."),dataset:{},style:{},className:new Ct(null==l?void 0:l.className),children:[I,A]},O=!(c-(p.firstVisibleDate||-1));if(L.className[w]=M,p.addCellHeaderContent?a=p.addCellHeaderContent(I,m||(m=p.createCellData(c))):I.children=[a={className:{"b-day-name":!0}}],y?Object.assign(a,R):Object.assign(I,R),p.dayCellRenderer&&!p.isConfiguring){m||(m=p.createCellData(c)),m.style=L.style,m.cls=L.className,m.headerStyle=I.style,m.headerCls=I.className;var P=m&&m.isNonWorking,_=p.callback(p.dayCellRenderer,p,[m,L]);"string"==typeof m.cls&&(L.className=new Ct(m.cls)),"string"==typeof m.style&&(L.style=li.parseStyle(m.style)),"string"==typeof m.headerCls&&(I.className=new Ct(m.headerCls)),"string"==typeof m.headerStyle&&(I.style=li.parseStyle(m.headerStyle)),null!=_&&("string"==typeof _?a.html=_:(a.text=null,a.children=$e.asArray(_))),o=!P&&m.isNonWorking}if(a&&(a.text||a.html||(x?a.html=Pl.format(c,p.dayCellNameFormat):a.text=F),1===F&&(a.dataset={startOf:Pl.format(c,"MMM")}),String(a.text||a.html).endsWith(F)&&(a.className["b-day-num"]=!0)),m.visible){var H=m,B=H.hasOverflow,V=H.renderedEvents,N=H.maxRow,z=p.stackMultiDayEvents,j=V,$=j.length,U=A.children;L.className[p.nonWorkingDayCls]=m.isNonWorking,L.className[p.dynamicHideNonWorkingdayCls]=o,L.className[p.weekendCls]=Pl.weekends[d];for(var G=0,Y=0,q=0;G<N;G++,Y++){var K=j[G];if(K){var X=K.eventRecord,Z=K.isOverflow,J=K.propagateEndDate,Q=K.eventEndDate||X.endingDate,ee=Math.max(1,p.getDaySpan(c,J||Q,f)),te=p.getDaySpan(c,Q,f,!0),ne=C-v,re=!z&&v&&Z,ie=li.percentify(Be.round((re||z?1:Math.min(ee,ne))/C*100,4)),ae=p.createEventDomConfig(K);Object.assign(ae.style,{width:ie,top:"".concat(Y*k+Y*b+p.eventContainerTop,"px")}),Object.assign(ae.className,{"b-overflow":re,"b-continues-past":!re&&(!v||z||O)&&X.startDate<c,"b-continues-future":!re&&(te>ne||te>ee||z&&te>1)}),U.push(ae)}}for(;G<$;)j[G++]&&q++;if(B?(u.classList.add("b-has-overflow"),L.children.push(p.getOverflowButtonDomConfig(q))):s||u.classList.remove("b-has-overflow"),(L.className[p.emptyCellCls]=!j.length)&&D){var oe=W(D),le="function"===oe||"string"===oe?p.resolveCallback(D,p,!1):null;(null!=le&&le.handler?le.handler.call(le.thisObj,m):D)&&(A.children[0]={tag:"button",class:"b-cal-cell-no-content",children:[null!=le&&le.handler?le.handler.call(le.thisObj,m):D]})}}return L}},{key:"onCalendarPointerInteraction",value:function(e){var n=this,r=e.target;return!(r.closest(".".concat(n.emptyCellCls," .").concat(n.eventBarContainerCls))&&(!n.emptyCellRenderer||r.closest(".b-cal-cell-no-content"))&&!1===n.trigger("emptyCell".concat(wA[e.type]),{date:n.getDateFromDomEvent(e),domEvent:e}))&&B(t,"onCalendarPointerInteraction",this,3)([e])}},{key:"getDaySpan",value:function(e,t,n,r){if(this.hideNonWorkingDays&&!r){for(var i=0,a=new Date(e),o=n.ceil(t,"1 day");a<o;a.setDate(a.getDate()+1))this.nonWorkingDays[a.getDay()]||i++;return i}return Math.max(Pl.diff(e,n.ceil(t,"1 day"),"day"),1)}},{key:"getOverflowButtonDomConfig",value:function(e){var t=this.overflowButtonRenderer,n={tag:"button","aria-label":"".concat(this.L("L{Calendar.moreEvents}",e),"."),className:{"b-cal-cell-overflow":1},text:this.L("L{Calendar.plusMore}",e),style:{},dataset:{eventId:"overflow"}};return t?this.callback(t,this,[n,e]):n}},{key:"getCell",value:function(e){return"string"!=typeof e&&(e=this.dayTime.dateKey(e)),this.contentElement.querySelector('[data-date="'.concat(e,'"]'))}},{key:"getCellOverflowButton",value:function(e){var t;return null===(t=this.getCell(e))||void 0===t?void 0:t.querySelector(".b-cal-cell-overflow")}}],[{key:"configurable",get:function(){return{monitorResize:!0,dayCellRenderer:null,dynamicHideNonWorkingdayCls:"b-dynamic-nonworking-day",overflowPopup:{$config:["lazy","nullify"],value:{type:"overflowpopup"}},overflowPopupTrigger:"click",eventBarContainerCls:"b-cal-event-bar-container",overflowButtonRenderer:null,dayCellNameFormat:null,eventSpacing:2,emptyCellCls:"b-cal-empty-cell",emptyCellRenderer:null}}}])}(e||Mn),S(t,"$name","DayCellRenderer"),t},SA={day:1,week:1,month:1,year:1,decade:1},xA=function(e,t){return e&&t?e.unit===t.unit&&e.magnitude===t.magnitude:e===t},EA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"previous",value:function(){this.move(-1)}},{key:"next",value:function(){this.move(1)}},{key:"move",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:1;e=Math.sign(e);var t=this,n=t.shiftIncrement;t.range?n&&(t.isShifting=!0,t.date=Pl.add(t.date,{unit:n.unit,magnitude:e*n.magnitude}),t.isShifting=!1):t.startDate=Pl.add(t.startDate,e*t.duration,"day")}},{key:"changeDate",value:function(e,n){if(e=B(t,"changeDate",this,3)([e||this.startDate,n]),this.isConfiguring||this.isValidRange(this.range,e))return e}},{key:"updateDate",value:function(e){var n,r=this,i=r.changeStartDate(e),a=r.startDate,o=r._month,l=null==o?void 0:o.generation;if(!a||i-a)if(r.hasConfig("endDate")||"day"===r.range.unit){var s=r.endDate,u=r.duration,c=r.isEventList&&!r.range?"betweenLesserEqual":"betweenLesser";r.isConfiguring&&a&&Pl[c](e,a,s)||(!a||!s||e<a?r.startDate=e:(r.isEventList?e>s:e>=s)&&(r.startDate=Pl.add(e,-(u-1),"day")))}else r.startDate=Pl.floor(e,r.isShifting?r.shiftIncrement:r.range,r.startDate,r.weekStartDay);o&&o.generation===l?o.date=e:r.isConfiguring||!1===r.scrollToDateOnDateChange||r.whenVisible("scrollTo",r,[e]),null===(n=B(t,"updateDate",this,3))||void 0===n||n(arguments)}},{key:"changeStartDate",value:function(e,n){var r=this;return e=B(t,"changeStartDate",this,3)([r.snapDate(r.ingestDate(e)),n]),!n||n-e||r.afterStartDateSet(e,n),e}},{key:"updateStartDate",value:function(e,n){var r,i=this,a=i._month;i.hasConfig("date")||i.date||(i.date=e),a&&(a.date=e),null===(r=B(t,"updateStartDate",this,3))||void 0===r||r(arguments),i.afterStartDateSet(e,n)}},{key:"afterStartDateSet",value:function(e,t){var n,r=this,i=r.refreshCount,a=r._endDate,o=r.peekEndDate(),l=o&&a&&!Boolean(o-a);if(r.hasConfig("endDate")&&(!o||r.isConfiguring)){var s=Pl.diff(t||e,r.endDate,"day");r.endDate=Pl.add(e,s,"day")}r.isConfiguring||o&&!l||r.refreshCount!==i||(null===(n=r._cellMap)||void 0===n||n.clear(),r.refresh(),r.triggerRangeChange(e,r.endDate))}},{key:"peekEndDate",value:function(){var e=this.peekConfig("endDate");if(e)return this.changeEndDate(e)}},{key:"updateEndDate",value:function(e){var n,r,i=this,a=i.duration;(null===(n=B(t,"updateEndDate",this,3))||void 0===n||n(arguments),i.isConfiguring)||(i.element.style.setProperty("--range-magnitude",a),i.element.dataset.duration=a,null===(r=i._cellMap)||void 0===r||r.clear(),i.refresh(),i.triggerRangeChange(i.startDate,e))}},{key:"triggerRangeChange",value:function(e,t){var n=this,r=n.lastRangeAnnounced;(!r||r.startDate-e||r.endDate-t)&&(n.peekConfig("date")||(n.date=Pl.constrain(n.date,e,Pl.add(t,n.isEventList&&!n.range?0:-1,"d"))),n.trigger("rangeChange",{old:r,new:n.lastRangeAnnounced={startDate:e,endDate:t}}))}},{key:"range",get:function(){return this.hasConfig("endDate")?null:this._range}},{key:"shiftIncrement",get:function(){if(null!==this._shiftIncrement)return this._shiftIncrement||this.range||{magnitude:this.duration,unit:"day"}}},{key:"stepUnit",get:function(){var e=this.shiftIncrement;if(e)return 1===e.magnitude?Pl.getLocalizedNameOfUnit(e.unit):"".concat(e.magnitude," ").concat(Pl.getLocalizedNameOfUnit(e.unit,!0))}},{key:"endDate",get:function(){var e=this;return e.hasConfig("endDate")?e._endDate:e.startDate&&Pl.add(e.startDate,e.range.magnitude,e.range.unit)}},{key:"snapDate",value:function(e,t){var n=this,r=n._endDate||n.peekEndDate()?null:n.range;return r&&"day"!==r.unit&&e?Pl[t?"ceil":"floor"](e,r,i,n.weekStartDay):e}},{key:"parseRange",value:function(e){if(e){if("string"==typeof e){var t=Pl.parseTimeUnit(e);e=t?{magnitude:1,unit:t}:Pl.parseDuration(e)}else{if("number"==typeof e)return{magnitude:e,unit:"day"};e.unit=Pl.parseTimeUnit(e.unit)}if(!SA[e.unit])throw new Error("Range must be in days, weeks, months, years or decades")}return e}},{key:"changeRange",value:function(e){if(!e||this.hasConfig("endDate")||(e=this.parseRange(e),!this._date||this.isValidRange(e)))return e}},{key:"changeShiftIncrement",value:function(e){return this.changeRange(e)}},{key:"updateShiftIncrement",value:function(e,t){this.trigger("shiftIncrementChange",{old:e,new:t})}},{key:"isValidRange",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:this.date,a=this.minDate||(null===(t=this.calendar)||void 0===t?void 0:t.minDate),o=this.maxDate||(null===(n=this.calendar)||void 0===n?void 0:n.maxDate);if(e&&!isNaN(a)||!isNaN(o)){var l=this.calculateDateRange(e,r);if(!isNaN(a)&&l.endDate<=a)return!1;if(!isNaN(o)&&l.startDate>o)return!1}return!0}},{key:"updateRange",value:function(e){var t=this,n=t.date,r=t._startDate,i=function(){var e=t.duration;t.element.style.setProperty("--range-magnitude",e),t.element.dataset.duration=e};e&&n&&!t.hasConfig("endDate")&&(!r||r-n?t.startDate=n:t.updateStartDate(t._startDate=t.snapDate(r),r)),t.isConfiguring?t.whenVisible(i):i()}},{key:"calculateDateRange",value:function(e,t){if(t)return"day"!==e.unit?{startDate:Pl.floor(t,e,i,this.weekStartDay),endDate:Pl.ceil(Pl.add(t,1,"day"),e,i,this.weekStartDay)}:{startDate:t,endDate:Pl.add(t,e.magnitude,"day")}}},{key:"changeMonth",value:function(e){var n,r=this,i=r.date;return B(t,"changeMonth",this,1)?B(t,"changeMonth",this,3)(arguments):(null!==(n=e)&&void 0!==n&&n.isMonth||(e=new Cy({date:i,weekStartDay:r.weekStartDay,hideNonWorkingDays:r.hideNonWorkingDays,nonWorkingDays:r.nonWorkingDays}),null==r.nonWorkingDays&&(r.nonWorkingDays=e.nonWorkingDays),null==r.weekStartDay&&(r.weekStartDay=e.weekStartDay)),e)}},{key:"dateBounds",get:function(){return[this.startDate,this.lastDate]}},{key:"getDuration",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.startDate,t=this.range;return t?e?Pl.diff(e,Pl.add(e,t.magnitude,t.unit),"d"):Pl.as("d",t.magnitude,t.unit):Pl.diff(e,this.peekEndDate()||this._endDate,"day")}},{key:"duration",get:function(){return this.getDuration()}},{key:"lastDate",get:function(){var e=this.endDate;return e&&Pl.add(e,-1,"day")}}])}(e||Mn),S(t,"$name","DateRangeOwner"),S(t,"configurable",{month:!0,date:{$config:{equal:"date"},value:null},range:{$config:{lazy:!0,equal:xA},value:null},shiftIncrement:{$config:{lazy:!0,equal:xA},value:null},startDate:{$config:{equal:"date"}},endDate:{$config:{equal:"date"}}}),t},RA=Object.freeze({}),TA={shrinkwrap:1,expand:1},MA=function(e,t,n,r,i){var a=Pl.format(n,e);return r?"".concat(a).concat(i?t.trim():t).concat(Pl.format(r,e).slice(i?-1:0)):a},FA=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"heightAnimation",Promise.resolve),e}return R(t,e),w(t,[{key:"compose",value:function(){return{children:{headerElement:{className:"b-calendarrow-header",children:{headerCellContainer:{role:"row",className:"b-calendarrow-header-container"},scrollPadElement:F({},li.scrollBarPadElement)}},bodyElement:{className:"b-calendarrow-body",children:{cellContainer:{role:"row",reference:"cellContainer",className:"b-calendarrow-cell-container"}}}}}}},{key:"onInternalPaint",value:function(e){if(e.firstPaint){var t=this,n=document.fonts,r=function(){t._eventContainerTop=t._eventContainerHeight=null,t.eventStore.count&&t.performResizeRefresh(null,null,!0)};"loaded"!==(null==n?void 0:n.status)&&n.ready.then((function(){return!t.isDestroyed&&r()})),r()}}},{key:"changeDaySeparator",value:function(e){return Array.isArray(e)?e:[e,e]}},{key:"changeElement",value:function(){var e=B(t,"changeElement",this,3)(arguments);return this.scrollable.addPartner(this.headerScroller,"x"),e}},{key:"changeHeaderScroller",value:function(e,t){return e?e=Oa.new({_id:"".concat(this.id,"-header-scroller"),element:this.headerCellContainer,widget:this},e):null==t||t.destroy(),e}},{key:"scrollTo",value:(s=f(L().mark((function e(n){var r,i,a=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=this).eventFilter,n.isEvent&&(!i||i(n))&&Pl.intersectSpans(r.startDate,r.endDate,n.startDate,n.endDate)&&(r.getEventElement(n)||r.expanded||r.autoHeight||r.toggleExpandCollapse()),e.abrupt("return",B(t,"scrollTo",this,3)(a));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"updateDate",value:function(e,n){var r,i,a,o=n&&this.getDayHeader(n);null===(r=o)||void 0===r||r.classList.remove("b-selected-date"),null===(i=B(t,"updateDate",this,3))||void 0===i||i([e,n]),null===(a=o=e&&this.getDayHeader(e))||void 0===a||a.classList.add("b-selected-date")}},{key:"getDayHeader",value:function(e){return"string"!=typeof e&&(e=this.dateKey(e)),this.headerCellContainer.querySelector('.b-cal-cell-header[data-header-date="'.concat(e,'"]'))}},{key:"overflowElement",get:function(){return this.bodyElement}},{key:"maxHeightElement",get:function(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.alldayRowElement)||B(t,"maxHeightElement",this,1)}},{key:"createCellMap",value:function(){var e,n=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=this,a=r.hideNonWorkingDays?r.nonWorkingDays:RA,o=r.maxEventCount,l=Be.assign({dayTime:r.dayTime,getDateIndex:function(e){return Number(e)===Number(r.firstVisibleDate||r.startDate)?"date":"startDate"}},n),s=B(t,"createCellMap",this,3)([l]),u=r.owner,c=0;return s.forEach((function(t){a[t.day]||(e=t),c=Math.max(c,t.renderedEvents.length)})),r.maxEventCount=c,c!==o?(s.clear(),r.createCellMap(l)):(e&&(e.isRowEnd=!0),null==u||u.element.classList.toggle("b-has-allday-events",Boolean(s.size)),s)}},{key:"collectEvents",value:function(e){var n=this;return e=Be.assign({dayTime:this.dayTime},e,{getDateIndex:function(e){return Number(e)===Number(n.firstVisibleDate||n.startDate)?"date":"startDate"}}),B(t,"collectEvents",this,3)([e])}},{key:"createCellData",value:function(e){var n=Pl.diff(this.startDate,e,"day"),r=n;return Object.assign(B(t,"createCellData",this,3)([e]),{visibleColumnIndex:r,columnIndex:n,isRowStart:0===r,isRowEnd:!1,renderedEvents:new gA})}},{key:"dayStartShift",get:function(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.startShift)&&void 0!==e?e:this._dayStartShift}},{key:"updateDayStartShift",value:function(e){this.element.classList.toggle("b-shifted-day",Boolean(e)),this.dayTime=new my(e)}},{key:"changeDayTime",value:function(e){var t;if(e||(e=new my(this.dayStartShift)),e.isDayTime||(e=new my(e)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}},{key:"dayOfDate",value:function(e){return this.dayTime.dayOfDate(e)}},{key:"updateMinDayWidth",value:function(e){var t=this.element.style;t.setProperty("--min-day-width",e?li.setLength(e):0),t.setProperty("--cell-container-overflow",e?"visible":"hidden"),this.afterUpdateMinDayWidth()}},{key:"afterUpdateMinDayWidth",value:function(){var e=this.headerScroller,t=this.minDayWidth,n=this.scrollable,r=n.element;t&&r.scrollWidth>r.clientWidth?n.overflowX=e.overflowX="hidden-scroll":n.overflowX=e.overflowX=!1}},{key:"updateEventHeight",value:function(){B(t,"updateEventHeight",this,3)(arguments),this.autoHeight||this.isConfiguring||this.expanded||this.setEventContentHeight(this.cellContentHeight)}},{key:"updateGutterHeight",value:function(){this.isConfiguring||this.setEventContentHeight(this.cellContentHeight)}},{key:"updateNonWorkingDays",value:function(){this.onVisibleDateRangeChange()}},{key:"updateHideNonWorkingDays",value:function(){B(t,"updateHideNonWorkingDays",this,3)(arguments),this.onVisibleDateRangeChange()}},{key:"onCellOverflowGesture",value:function(e){e.date,TA[this.overflowClickAction.toLowerCase()]?this.expanded=!0:B(t,"onCellOverflowGesture",this,3)(arguments)}},{key:"onVisibleDateRangeChange",value:function(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}},{key:"changeAutoHeight",value:function(e){var t=this,n=t.eventsPerCell;t._autoHeight=e,t.setEventContentHeight(t.cellContentHeight),t.isConfiguring||t.performResizeRefresh(n,t.eventContainerTop,!0)}},{key:"setEventContentHeight",value:(l=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).cellContainer,a=r.parent,r._eventContentHeight===t){e.next=14;break}if(!n&&null!=a&&a.isDayView&&null!==(o=a.parent)&&void 0!==o&&o.isResourceView&&(l=a.parent.items.map((function(e){return e.allDayEvents})).filter((function(e){return e&&e!==r})),t=Math.max.apply(Math,[t||0].concat(z(l.filter((function(e){return!e.owner.isResourceDayViewTimeAxis})).map((function(e){return e.calculateCellContentHeight()||0}))))),null==l||l.forEach((function(e){e.setEventContentHeight(t,!0)}))),s=r.height,u=r.animate,r.isAnimating=u,(c=li.getPropertyTransitionDuration(i,"height"))||(r.isAnimating=u=!1),i.style.height="".concat(t||1,"px"),r.bodyElement.classList.toggle("b-zero-height",!Boolean(t)),!u){e.next=13;break}return e.next=13,r.heightAnimation=fr.waitForTransitionEnd({property:"height",element:i,duration:c});case 13:r.isDestroyed||(f=r.height,r.isAnimating=!1,r._eventContentHeight=t,null===(d=r.owner)||void 0===d||null===(h=d.syncScrollbarPadding)||void 0===h||h.call(d),f!==s&&r.trigger("heightChange",{height:f,oldHeight:s}));case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"hasOverflow",get:function(){return!this.autoHeight&&this.maxEventCount>this.defaultEventRowCount}},{key:"eventsPerCell",get:function(){var e=this,t=e.maxEventCount;return e.expanded||e.autoHeight?t:Math.min(t,e.defaultEventRowCount)}},{key:"cellContentHeight",get:function(){var e;return!1===(null===(e=this.owner)||void 0===e?void 0:e.showAllDayHeader)?0:this.calculateCellContentHeight()}},{key:"calculateCellContentHeight",value:function(){var e=this,t=e.gutterHeight,n=Math.ceil(e.eventContainerTop+e.eventsPerCell*(e.eventHeightInPixels+e.eventSpacing));return t&&(e.eventsPerCell&&(n-=e.eventSpacing),isNaN(t)?n="calc(".concat(n,"px + ").concat(t,")"):n+=Number(t)),n}},{key:"getDateFromPosition",value:function(e,t){var n=arguments.length>3?arguments[3]:i,r=this,a=r.eventContentElement,o=a.getBoundingClientRect(),l=r.rtl?o.right-e:e-o.left,s=a.scrollWidth,u=r.getDayElementFromX(e);return l<0||s<l||t<o.top||o.bottom<t?null:r.getDateFromElement(u,n)}},{key:"toggleExpandCollapse",value:(o=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.expanded,e.next=3,this.updateExpanded(!Boolean(t),t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"updateExpanded",value:(a=f(L().mark((function e(t,n){var r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this)._expanded=n,i=r.eventsPerCell,r._expanded=t,!r.expanded){e.next=11;break}if(!r.isVisible){e.next=9;break}return r.performResizeRefresh(i,r.eventContainerTop,!0),e.next=9,r.heightAnimation;case 9:e.next=15;break;case 11:return r.scrollable.overflowY="hidden",e.next=14,r.setEventContentHeight(r.cellContentHeight);case 14:n&&!r.isDestroyed&&r.performResizeRefresh(i,r.eventContainerTop,!0);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"visibleDateHeaders",get:function(){var e,t,n=this;if(n.fullWeek){for(e=n.month.getWeekStart(n.month.getWeekNumber(n.startDate));n.hiddenNonWorkingDays[e.getDay()];)e.setDate(e.getDate()+1);for(t=Pl.add(e,6,"d");n.hiddenNonWorkingDays[t.getDay()];)t.setDate(t.getDate()-1)}else e=n.firstVisibleDate,t=n.lastVisibleDate;return[e,t]}},{key:"doRefresh",value:function(){var e,t,n;null===(e=this._cellMap)||void 0===e||e.clear();var r=this,i=r.dayTime,a=r.fullWeek,o=r.startDate,l=r.endDate,s=r.headerCellContainer,u=r.cellContainer,c=r.dayHeaderRenderer,d=r.hiddenNonWorkingDays,h=r.hideEmptyDays,f=r.dateFilter,v=r.owner,g=_(r.visibleDateHeaders,2),m=g[0],p=g[1],y=(o||l)&&r.cellMap,k=null!==(t=r.nonWorkingDays)&&void 0!==t?t:r.month.nonWorkingDays,b=[],C=[],w=[];if(y){for(var D,x,E,R=0,T=0,M=m;!(p<M);M.setDate(M.getDate()+1),R++){var F=y.get(i.dateKey(M))||r.createCellData(M),A=F.day,I=F.key,L=h&&(v?v.getEventsForDay(I,r.startDate):F.renderedEvents),O=h&&!(null!=L&&L.length)||f&&!r.callback(f,r,[F]);d[A]||O||(F.columnIndex=F.cellIndex=R++,F.isRowStart=0===T,F.visibleColumnIndex=T,a||T++,b.push(F))}r.weekLength=a?1:T;var P=b.length;for(x=0;x<P;x++){var H=b[x],B=H.day,V=H.key,N=k[B],z="b-day-of-week-".concat(B);D=!(H.date-((null==v?void 0:v.date)||r.date)),H.cell=r.getCell(V),H.row=r.cellContainer;var j=r.getCellDomConfig(H);if(j){var W=pe.merge({dataset:{headerDate:V}},j.children[0]);W.className["b-selected-date"]=D,W.className["b-current-date"]=a&&D,W.className[z]=1,c&&r.callback(c,r,[W,H]),j.dataset.date=V,Object.assign(j.className,S(S(S(S({"b-dayview-allday":1},r.nonWorkingDayCls,N),r.weekendCls,Pl.weekends[B]),r.dayCellCls,1),z,1)),j.children.shift(),w.push(W),a&&!D||(C.push(j),N||(E=j))}}E&&(E.className["b-last-working-day"]=1),fa.sync({targetElement:s,domConfig:{children:w,onlyChildren:!0,syncOptions:{releaseThreshold:0,strict:!0}}}),fa.sync({targetElement:u,domConfig:{children:C,onlyChildren:!0,syncOptions:{releaseThreshold:0,strict:!0}}}),r.refreshCount=(r.refreshCount||0)+1,r.collapseGutter(),r.setEventContentHeight(!1===(null===(n=this.owner)||void 0===n?void 0:n.showAllDayHeader)?0:r.cellContentHeight),r.trigger("refresh")}}},{key:"eventContainerTop",get:function(){return 0}},{key:"expandGutter",value:(r=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this)._isTemporarilyExpanded){e.next=6;break}return t.gutterHeight=(t.gutterHeight||0)+t.eventHeightInPixels+t.eventSpacing,e.next=5,t.setEventContentHeight(t.cellContentHeight);case 5:t._isTemporarilyExpanded=!0;case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"collapseGutter",value:(n=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this)._isTemporarilyExpanded){e.next=6;break}return t.gutterHeight=t.gutterHeight-(t.eventHeightInPixels+t.eventSpacing),e.next=5,t.setEventContentHeight(t.cellContentHeight);case 5:t._isTemporarilyExpanded=!1;case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onCalendarKeyDown",value:function(e){var n,r,i,a=this.dayTime,o=this.element,l=this.owner,s=e.target,u=".".concat(this.dayCellCls),c=s.closest(".b-cal-cell-header,".concat(u))||s,d=c.matches(".b-cal-cell-header"),h=c.matches(u),f=h?"date":"header-date",v=1===this.duration&&"ArrowDown"===e.key?a.dateKey(this.date):c.dataset[h?"date":"headerDate"],g=a.parseKey(v),m=d?".b-cal-cell-header":u;switch(e.key){case"ArrowUp":var p;if(h)e.preventDefault(),null===(p=o.querySelector('.b-cal-cell-header[data-header-date="'.concat(v,'"]')))||void 0===p||p.focus();break;case"ArrowDown":var y;if(d&&li.isInView(i=o.querySelector("".concat(u,'[data-date="').concat(v,'"]'))))e.preventDefault(),null===(y=i)||void 0===y||y.focus();else if(l.isDayView){var k;e.preventDefault(),null===(k=l.eventContentElement.querySelector(".".concat(l.dayCellCls,'[data-date="').concat(v,'"]')))||void 0===k||k.focus()}break;case"ArrowLeft":e.preventDefault(),null===(n=o.querySelector("".concat(m,"[data-").concat(f,'="').concat(a.dateKey(Pl.add(g,-1,"d")),'"]')))||void 0===n||n.focus();break;case"ArrowRight":e.preventDefault(),null===(r=o.querySelector("".concat(m,"[data-").concat(f,'="').concat(a.dateKey(Pl.add(g,1,"d")),'"]')))||void 0===r||r.focus();break;default:return B(t,"onCalendarKeyDown",this,3)([e])}}},{key:"addCellHeaderContent",value:function(e,t){var n,r=this,i=r.resource,a=t.date,o=t.day,l=t.tomorrow,s=r.dayNameFormat,u=r.dayNumberCompress,c=r.daySeparator,d=null==r||null===(n=r.dayTime)||void 0===n?void 0:n.startShift;e.children=[{className:"b-day-name-part b-day-name-day".concat(u?" b-day-name-short":""),html:MA(s,c[0],a,d&&l)},{tabIndex:0,role:"link",className:"b-day-name-part b-day-name-date","aria-label":"".concat(Pl.format(a,"dddd Do MMMM")).concat(i?" ".concat(i.name):"","."),html:MA(r.dayNumberFormat,c[1],a,d&&l,u)}],e.className[r.nonWorkingDayCls]=t.isNonWorking,e.className[r.weekendCls]=Pl.weekends[o]}},{key:"updateLocalization",value:function(){this.isConfiguring||this.refresh(),B(t,"updateLocalization",this,3)([])}},{key:"updateFullWeek",value:function(){this.isConfiguring||this.refresh()}}],[{key:"configurable",get:function(){return{cls:"b-calendar-days",dragUnit:"day",animate:!0,autoHeight:null,autoRefresh:["dayNameFormat","dayNumberCompress","dayNumberFormat","daySeparator","hideEmptyDays","dateFilter"],descriptionFormat:[!0,!0],dayStartShift:null,dayTime:0,defaultEventRowCount:3,fullWeek:null,minDayWidth:null,scrollable:{overflowX:"hidden",overflowY:"hidden",propagateSync:!0},headerScroller:{$config:["lazy","nullify"],value:{overflowX:"hidden",overflowY:"hidden",propagateSync:!0}},dayNameFormat:"ddd",dayNumberCompress:null,dayNumberFormat:"D",daySeparator:"-",responsive:{small:{dayNameFormat:"d1",dayNumberCompress:!0,daySeparator:"/"},"*":{dayNameFormat:"ddd",dayNumberCompress:!1,daySeparator:"-"}},dayNameSelector:".b-cal-cell-header",monitorResize:!1,gutterHeight:null,expanded:null,overflowClickAction:"popup",dayHeaderRenderer:null,hideEmptyDays:null,dateFilter:null}}}]);var n,r,a,o,l,s}(Lo.mixin(vA,yA,DA,EA));S(FA,"$name","CalendarRow"),S(FA,"type","calendarrow"),S(FA,"delayable",{afterUpdateMinDayWidth:{type:"raf",cancelOutstanding:!0}}),FA.initClass(),FA._$name="CalendarRow";var AA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"afterConfigure",value:function(){var e,n=this,r=n.owner;B(t,"afterConfigure",this,3)([]),null===(e=r.scrollable)||void 0===e||e.ion({overflowChange:"onOwnerOverflowChange",thisObj:n}),r.descriptionRenderer=n.descriptionRenderer.bind(n),Tt.before(r,"updateDate",this.beforeOwnerDateUpdate,this)}},{key:"beforeOwnerDateUpdate",value:function(e){this.isShifting=!0,this.date=e,this.isShifting=!1}},{key:"onOwnerOverflowChange",value:function(e){var t=e.y;this.headerElement.classList.toggle("b-show-yscroll-padding",Boolean(t))}},{key:"onDayNumberClick",value:function(e){var t=e.date;return this.owner&&(this.owner.date=t),!1}},{key:"scrollTo",value:function(){}},{key:"descriptionRenderer",value:function(){var e=this.startDate,t=this.endDate,n=this.owner,r=e.getMonth()===t.getMonth()?Pl.format(e,"MMMM"):"".concat(Pl.format(e,"MMM")," - ").concat(Pl.format(t,"MMM")),i=n.month.getWeekNumber(e);return"".concat(this.L("L{Object.Week}")," ").concat(i[1],", ").concat(r," ").concat(i[0])}}])}(FA);S(AA,"$name","DaySelector"),S(AA,"type","dayselector"),S(AA,"configurable",{readOnly:!0,autoCreate:!1,flex:"0 0 auto",dock:"top"}),AA.initClass(),AA._$name="DaySelector";var IA=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeDaySelector",value:function(e,t){var n=this;if(e){n.range="1 day",n.settings=null,n.hideHeaders=!0;var r=n.dayTime.shiftDate(n.month.getWeekStart(n.month.getWeekNumber(n.startDate))),i=AA.reconfigure(t,e,{owner:n,defaults:{type:"dayselector",calendar:n.calendar,parent:n,cls:S({},"b-".concat(n.type,"-dayselector"),1),dayStartShift:n.dayStartShift,dayTime:n.dayTime,month:n.month,date:n.date,startDate:r,range:{magnitude:1,unit:"week"},shiftIncrement:{unit:"d",magnitude:n.duration},hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay}});return n.element.classList.add("b-".concat(n.type,"-with-dayselector")),n.tbar=i,i}null==t||t.destroy()}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return delete n.daySelector,n}}],[{key:"configurable",get:function(){return{daySelector:null}}}])}(e||Mn),S(t,"$name","CalendarMixin"),t},LA=function(e){return null==e?void 0:e.eventStore},OA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.ion({beforeShow:"syncRangeOptions",toggle:"syncViewRange",thisObj:this})}},{key:"syncViewRange",value:function(e){if(e.checked){var t=this.view,n=t.date;t.range||(t._date=t._endDate=null),t.setConfig({range:e.item.range,date:n}),e.bubbles=!1}}},{key:"syncRangeOptions",value:function(){var e=this.view.range;if(e)for(var t=e.unit,n=e.magnitude,r=0,i=Object.values(this.items);r<i.length;r++){var a=i[r];if(a){var o={};a._unit===t?(o.checked=!0,o.range={unit:t,magnitude:n},o.text=1===n?Le.capitalize(Pl.getLocalizedNameOfUnit(t)):Pl.formatDelta(o.range)):(o.checked=!1,o.text=Le.capitalize(Pl.getLocalizedNameOfUnit(a._unit)),o.range=a._unit),a.setConfig(o)}}}},{key:"changeItems",value:function(e){var n=this,r=n.view||(n.view=n.up(LA)),i="".concat(r.id,"-range-items");return Object.values(e).forEach((function(e){e&&(e.toggleGroup=i)})),B(t,"changeItems",this,3)([e])}},{key:"updateView",value:function(e){var t=this;null==e||e.scrollable.ion({overflowChange:function(){var e;return null===(e=t.realign)||void 0===e?void 0:e.call(t)}})}}])}(ap);S(OA,"$name","RangeMenu"),S(OA,"type","rangemenu"),S(OA,"configurable",{autoShow:!1,view:null,floating:!1,positioned:!0,anchor:!0,defaults:{checked:!1},items:{listRangeDayItem:{range:"day",text:"L{EventEdit.day}",_unit:"day"},listRangeWeekItem:{range:"week",text:"L{EventEdit.week}",_unit:"week"},listRangeMonthItem:{range:"month",text:"L{EventEdit.month}",_unit:"month"},listRangeYearItem:{range:"year",text:"L{EventEdit.year}",_unit:"year"},listRangeDecadeItem:{range:"decade",text:"L{EventEdit.decade}",_unit:"decade"}}}),OA.initClass(),OA._$name="RangeMenu";var PA=function(e,t){return e.startDate.valueOf()-t.startDate.valueOf()},_A=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e=this,n=Be.getPropertyDescriptor(this,"features");Object.defineProperty(this,"features",{get:function(){return n.get.call(e)||{}},set:function(t){var r;(!0===t&&(t={}),t.print)||(t.print=Boolean(null===(r=e.calendar)||void 0===r?void 0:r.features.print));n.set.call(e,t)},configurable:!0});for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];B(t,"construct",this,3)(i)}},{key:"doRefresh",value:function(){this.refreshRows()}},{key:"getEventElement",value:function(e){var n=arguments.length>1&&arguments[1]!==i?arguments[1]:Math.max(e.startDate,this.firstVisibleDate||this.startDate);return this.eventContentElement.querySelector('.b-grid-row[data-event-id="'.concat(e.id,'"][data-date="').concat(Pl.makeKey(n),'"]'))||B(t,"getEventElement",this,3)(arguments)}},{key:"containsDate",value:function(e){var t=this.range?"betweenLesser":"betweenLesserEqual";return Pl[t](e,this.startDate,this.endDate)}},{key:"eventListEventTimeRenderer",value:function(e,t){var n,r=this,i="string"==typeof(n=r.eventTimeRenderer?r.callback(r.eventTimeRenderer,r,arguments):r.defaultEventTimeRenderer(e,t))?"text":"children";return S({className:{"b-cal-eventlist-event-time":1},"aria-hidden":!0},i,"text"===i?n:$e.asArray(n))}},{key:"defaultEventTimeRenderer",value:function(e,t){var n=this,r=e.startDate,i=e.endDate,a=e.allDay,o=Pl.clearTime(r),l=Pl.clearTime(i),s=l&&(i-l?i:Pl.add(l,-1,"d"));return!e.isMilestone&&(i-l?l:s)-o?a||t-o?a||t-l?n.L("L{Calendar.endsOn}",Pl.format(s,"DD MMM")):n.L("L{Calendar.endsOn}",Pl.format(i,n.eventListTimeFormat)):"".concat(Pl.format(r,n.eventListTimeFormat)," - ").concat(Pl.format(s,"DD MMM")):a?n.L("L{Calendar.allDay}"):"".concat(Pl.format(e.startDate,n.eventListTimeFormat)," - ").concat(Pl.format(i,n.eventListTimeFormat))}},{key:"agendaEventDateRenderer",value:function(e){return{className:{"b-day-name":1,"b-cal-agenda-date":1,"b-today":!Boolean(Pl.clearTime(new Date)-Pl.clearTime(e))},"aria-hidden":!0,children:[{className:{"b-cal-agenda-date-date-number":1},text:e.getDate()},{className:{"b-cal-agenda-date-date-text":1},children:[{text:Pl.format(e,"dddd")},{text:Pl.format(e,"MMM YYYY")}]}]}}},{key:"destroy",value:function(){for(var e=0,n=Object.values(this.features);e<n.length;e++){var r,i=n[e];null===(r=i.destroy)||void 0===r||r.call(i)}B(t,"destroy",this,3)([])}},{key:"populateHeaderMenu",value:function(e){var n=e.items,r=this.listRangeMenu;r&&(r.appendTo=this.element,n.listRangeItem={weight:-1e3,icon:"b-icon-calendar-week",text:"L{Calendar.timeRange}",menu:r}),B(t,"populateHeaderMenu",this,3)(arguments)}},{key:"refreshVirtualScrollbars",value:function(){B(t,"refreshVirtualScrollbars",this,3)([]),this.bodyElement.classList[li.scrollBarWidth&&this.hasVerticalOverflow?"add":"remove"]("b-has-scrollbar")}},{key:"changeListRangeMenu",value:function(e){if(e)return OA.mergeConfigs({view:this,floating:!1},e)}},{key:"updateRowManager",value:function(e){var n;null===(n=B(t,"updateRowManager",this,3))||void 0===n||n(arguments),e.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this})}},{key:"onBeforeRenderRow",value:function(e){var t=e.row,n=e.record,r=t._elementsArray,i=n.id,a=n.startDate;if(n.isSpecialRow)t.eachElement((function(e){return delete e.dataset.eventId}));else if(n.isEventModel){for(var o,l,s=0,u=r.length;s<u;s++)r[s].dataset.eventId=i,r[s].dataset.date=Pl.makeKey(a);t.cls["b-day-of-week-".concat(a.getDay())]=1,null===(o=this.calendar)||void 0===o||null===(l=o.beforeListRenderRow)||void 0===l||l.call(o,{row:t,record:n})}}},{key:"onInternalKeyDown",value:function(e){}},{key:"displayName",get:function(){var e=this.title;return"string"!=typeof e&&(e=this.type),Le.capitalize(e)}},{key:"scrollTo",value:(n=f(L().mark((function e(t,n){var r,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,n=Be.assign({},r.defaultScrollOptions,"boolean"==typeof n?{animate:n}:n),!(t instanceof r.store.modelClass)){e.next=8;break}return e.next=5,r.scrollRowIntoView(t,Object.assign({},n,{highlight:!1}));case 5:n.highlight&&(t=r.getEventElement(t,t.startDate),"boolean"==typeof n.highlight?li.highlight(t,r):(r.widget||r).callback(n.highlight,null,[t])),e.next=15;break;case 8:if(!Be.isDate(t=r.ingestDate(t))||!r.store.count){e.next=15;break}return i=Pl.makeKey(t=r.findClosestOccupiedDate(t)),r.scrollingToDate=!0,e.next=13,r.scrollRowIntoView(r.dateIndex[i],n);case 13:r.scrollingToDate=!1,r.scrolledToDate=t;case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"findClosestOccupiedDate",value:function(e){var t=this.dayTime,n=this.dateIndex;if(!Object.keys(n).length||n[t.dateKey(e)])return e;for(var r=Number.MAX_SAFE_INTEGER,i=Object.keys(n),a=0,o=i.length;a<o;a++){var l=t.parseKey(i[a]);Math.abs(l-e)<Math.abs(r-e)&&(r=l)}return new Date(r)}},{key:"updateStartDate",value:function(){var e=this.refreshCount;this.preventScroll=!0,B(t,"updateStartDate",this,3)(arguments),this.preventScroll=!1,this.isConfiguring||this.refreshCount!==e||this.populateStoreSoon()}},{key:"updateEndDate",value:function(){var e,n=this.refreshCount;null===(e=B(t,"updateEndDate",this,3))||void 0===e||e(arguments),this.isConfiguring||this.refreshCount!==n||this.populateStoreSoon()}},{key:"dateBounds",get:function(){return[this.startDate,this.endDate]}},{key:"descriptionFormat",get:function(){return B(t,"descriptionFormat",this,1)||[this.shortDateFormat,"S{".concat(this.shortDateFormat,"} - E{").concat(this.shortDateFormat,"}")]},set:function(e){V(t,"descriptionFormat",e,this,1,1)}},{key:"descriptionRenderer",value:function(){return"".concat(this.formattedDescription,". ").concat(this.L("L{eventCount}",this.eventCount))}},{key:"count",get:function(){return Ne.deprecate("calendar","7.0.0","count property is deprecated in favor of eventCount"),this.eventCount}},{key:"eventCount",get:function(){return this.store.getAllDataRecords().length}},{key:"store",get:function(){return B(t,"store",this,1)},set:function(e){e&&!e.modelClass&&this.project&&(e.modelClass=this.project.eventStore.modelClass),V(t,"store",e,this,1,1)}},{key:"updateEventStore",value:function(e){var n;null===(n=B(t,"updateEventStore",this,3))||void 0===n||n([e]),this.detachListeners("eventStore"),e.ion({name:"eventStore",refresh:"onCalendarStoreChange",thisObj:this}),this.populateStoreSoon()}},{key:"changeStore",value:function(e){var n,r=this;return e&&(e=Ff.mergeConfigs({useRawData:{ignoreDefaults:!0,disableDefaultValue:!0,disableTypeConversion:!0,enabled:!0},modelClass:r.modelClass},e)),null!==(n=e=B(t,"changeStore",this,3)([e]))&&void 0!==n&&n.modelClass.isEventModel&&(r.nonWorkingDaysFilter=e.addFilter({id:"".concat(r.id,"-nonworkingday-filter"),filterBy:function(e){return!r.dayTime.isIntraDay(e)||!r.hiddenNonWorkingDays[e.startDate.getDay()]},disabled:!r.hideNonWorkingDays},!0)),e}},{key:"updateHideNonWorkingDays",value:function(e){var n=this,r=n.store;B(t,"updateHideNonWorkingDays",this,3)([e]),r&&(n.nonWorkingDaysFilter.disabled=!e,r.filter()),n.trigger("refresh")}},{key:"afterRemove",value:function(e){var n=e.records;this.eventStore.remove(n),B(t,"afterRemove",this,3)(arguments)}},{key:"modelClass",get:function(){return this.eventStore.modelClass}},{key:"populateStoreSoon",value:function(){var e=this,t=e.project;e.isVisible?(t.isInitialCommitPerformed&&!t.isWritingData||!t.eventStore.count)&&e.populateStore():e.whenVisible("populateStore")}},{key:"duration",get:function(){return B(t,"duration",this,1)+(this.range?0:1)}},{key:"populateStore",value:function(){var e,t=this,n=t.features.cellEdit,r=null==n?void 0:n.editorContext,i=t.eventStore.getEvents({startDate:t.startDate,endDate:Pl.add(t.endDate,t.range?0:1,"d"),filter:t.eventFilter}).sort(PA);t.dateIndex=i.reduce((function(e,t){var n=Pl.makeKey(t.startDate);return e[n]||(e[n]=t),e}),{}),r&&n.cancelEditing(),t.store.data=i,t.trigger("refresh"),r&&n.startEditing(r),null===(e=t.calendar)||void 0===e||e.syncUIWithActiveView(this)}},{key:"changeMonth",value:function(){var e=B(t,"changeMonth",this,3)(arguments);return e.ion({dateChange:"onMonthChange",thisObj:this}),e}},{key:"onMonthChange",value:function(e){var t=e.newDate,n=this,r=n.startDate,i=n.changeStartDate(t);(!r||i-r&&!n.containsDate(i))&&n.updateRange(n.range),!n.preventScroll&&n.isVisible&&n.store.count&&(n.populateStoreSoon.flush(),n.scrollTo(t))}},{key:"onCalendarStoreChange",value:function(e){var t=e.source;this.date||(this.date=t.map((function(e){return e.startDate})).sort((function(e,t){return e.valueOf()-t.valueOf()}))[0]),this.populateStoreSoon()}},{key:"changeSettingsButton",value:function(e,t){return e&&Nu.reconfigure(t,Nu.mergeConfigs({type:"button",positioned:!0,icon:"b-icon-cog",menuIcon:null,cls:"b-blue b-cal-widget-settings-button",insertBefore:this.bodyWrapElement},e),this)}},{key:"getCurrentConfig",value:function(e){var n=B(t,"getCurrentConfig",this,3)([e]);return delete n.store,delete n.data,n}}]);var n}(Fw.mixin(vA,yA,IA,EA));S(_A,"$name","EventList"),S(_A,"type","eventlist"),S(_A,"configurable",{preserveScrollOnDatasetChange:!0,cls:"b-slide-vertical",eventFilter:null,localizableProperties:["title","text"],title:"L{List}",range:"1 month",month:!0,columns:{$config:{merge:function(e,t){if(t){if(e=e.data||e,Be.isObject(e)){var n=t.slice(),r=function(t){var r=e[t],i=n.findIndex((function(e){return e.id===t||e.field===t}));if(r){var a=rn.merge(r,n[i]);a.id=t,n[-1===i?n.length:i]=a}else i>-1&&n.splice(i,1)};for(var i in e)r(i);return n}var a;t=new us({values:t,idProperty:"field"});for(var o=0,l=e.length;o<l;o++){var s=e[o],u=t.get(s.field);u&&(e[o]=rn.merge(s,u),t.remove(u))}return(a=e).push.apply(a,z(t.values)),e}return e}},value:[{text:"L{EventEdit.Name}",field:"name",flex:"1 0 12em"},{text:"L{EventList.Start}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"startDate",width:"16.5em",format:"L LT",renderer:function(e){var t=e.record,n=e.value;return t.allDay?Pl.format(n,"L"):this.defaultRenderer.apply(this,arguments)}},{text:"L{EventList.Finish}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"endDate",width:"16.5em",format:"L LT",renderer:function(e){var t=e.record,n=e.value;return t.allDay?Pl.format(n,"L"):this.defaultRenderer.apply(this,arguments)}},{type:"widget",text:"Resources",field:"resources",minWidth:250,autoHeight:!0,widgets:[{type:"chipview",valueProperty:"items",displayField:"name",itemsFocusable:!1,navigator:null,closable:!1,style:{flexFlow:"row nowrap",display:"flex",padding:"5px 0 3px 0"},scrollable:{overflowX:"hidden-scroll",overflowY:!1},getItemCls:function(e){return li.isNamedColor(e.eventColor)?" b-sch-".concat(e.eventColor):""},getItemStyle:function(e){return"color:#fff;".concat(e.eventColor&&!li.isNamedColor(e.eventColor)?"background-color:".concat(e.eventColor):"")}}],editor:!1}]},features:{group:!1,rowCopyPaste:!1,columnPicker:{createColumnsFromModel:!0}},internalListeners:{beforeCellEditStart:function(e){var t,n,r=e.editorContext,i=r.editor,a=r.record;if(a.isRecurring||a.isOccurrence)return Wm.show({html:"Please use EventEdit to edit recurring events"}),!1;null===(t=this.calendar)||void 0===t||null===(t=t.features.eventTooltip)||void 0===t||null===(t=t._tooltip)||void 0===t||t.hide(),null===(n=i.timeField)||void 0===n||n[a.allDay?"hide":"show"]()}},settingsButton:{$config:"lazy",value:null},listRangeMenu:{$config:"lazy",value:{type:"rangemenu"}},eventListTimeFormat:"HH:mm",eventTimeRenderer:null}),S(_A,"delayable",{populateStoreSoon:{type:"raf",cancelOutstanding:!0}}),_A.initClass(),_A._$name="EventList";var HA={mouseover:1,mouseout:1},BA={mousedown:1,mouseup:1,click:1,dblclick:1,contextmenu:1},VA=function(e,t){return e.date-t.date},NA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=this,r=Be.getPropertyDescriptor(this,"features");Object.defineProperty(this,"features",{get:function(){return r.get.call(n)},set:function(e){var t,i=Ug.getInstanceDefaultFeatures(n);for(var a in i)i[a]=!1;i.print=(null==e?void 0:e.print)||Boolean(null===(t=n.calendar)||void 0===t?void 0:t.features.print),r.set.call(n,i)},configurable:!0}),B(t,"construct",this,3)([e]),this.keyMap=vA().$meta.config.keyMap}},{key:"onCalendarKeyDown",value:function(e){var n,r,i=this.eventContentElement,a=e.target,o=".".concat(this.dayCellCls),l=a.closest(o);if(!l)return B(t,"onCalendarKeyDown",this,3)([e]);switch(e.key){case"ArrowUp":e.preventDefault(),null===(n=Ev.getVisitor(i,o).previous(l))||void 0===n||n.focus();break;case"ArrowDown":e.preventDefault(),null===(r=Ev.getVisitor(i,o).next(l))||void 0===r||r.focus();break;default:return B(t,"onCalendarKeyDown",this,3)([e])}}},{key:"initScroll",value:function(){B(t,"initScroll",this,3)(arguments),this.scrollable.ion({scroll:"onAgendaViewScroll",scrollEnd:"onAgendaViewScroll",thisObj:this})}},{key:"onResponsiveStateChange",value:function(e){var n,r=e.state,i=e.oldState;null===(n=B(t,"onResponsiveStateChange",this,3))||void 0===n||n(arguments),!i||"small"!==i&&"small"!==r||this.refresh()}},{key:"onAgendaViewScroll",value:function(){if(!this.scrollingToDate){var e=this.firstVisibleRow;e&&(this.topDate=this.getDateFromElement(e.cells[0]))}}},{key:"updateRange",value:function(e,n){var r=this,i=r.rowManager;if(n&&i.rowCount){var a=r.dayTime,o=a.parseKey(i.topRow.id),l=a.parseKey(i.bottomRow.id);if(!Pl.betweenLesserEqual(r.date,o,l))return r.scrollToDateOnDateChange=!1,r._startDate=Pl.floor(r._startDate,e,null,r.weekStartDay),r.date=r.firstVisibleRow.id,void(r.scrollToDateOnDateChange=!0)}B(t,"updateRange",this,3)(arguments)}},{key:"updateTopDate",value:function(e){this.trigger("topDateChange",{date:e})}},{key:"changeColumns",value:function(){var e,n=this,r=B(t,"changeColumns",this,3)(arguments);return null==r||null===(e=r.forEach)||void 0===e||e.call(r,(function(e){e.autoHeight=Boolean(!e.isAgendaColumn||e.renderer!==e.defaultRenderer||n.eventRenderer)})),r}},{key:"onFocusGesture",value:function(){}},{key:"onGridElementFocus",value:function(){}},{key:"onGridBodyFocusIn",value:function(){}},{key:"focusCell",value:function(){}},{key:"setHoveredRow",value:function(){}},{key:"onElementKeyDown",value:function(){}},{key:"onElementMouseDown",value:function(){}},{key:"editAutoCreatedEvent",value:function(e,n){this.populateStoreSoon.now(),B(t,"editAutoCreatedEvent",this,3)([e,n])}},{key:"handleEvent",value:function(e){var n=e.type;B(t,"handleEvent",this,3)([e]),HA[e.type]?this.onEventMouseOverOut(e):!1!==this.consumeGridPointerEvents&&BA[n]&&this.onCalendarPointerInteraction(e)}},{key:"getCellDataFromEvent",value:function(e){if(e.target.closest(".b-grid-cell")){var n=B(t,"getCellDataFromEvent",this,3)([e]);return n&&(n.record=this.getEventRecord(e.target)),n}}},{key:"getDateFromPosition",value:function(e,t){var n=this.rowManager.getRowAt(t),r=null==n?void 0:n._cells.normal[0];return r&&this.getDateFromElement(r)}},{key:"updateOffsetStartsBeforeEvents",value:function(e){this.element.classList.toggle("b-offset-continues-past",Boolean(e))}},{key:"updateEventRowSpacing",value:function(e){this.contentElement.style.setProperty("--event-row-spacing",li.setLength(e))}},{key:"updateSuppressLongEvents",value:function(){this.fillFromMaster()}},{key:"onCalendarStoreChange",value:function(e){var t=e.action;e.oldCount;var n=e.records,r=e.removed,i=e.added,a=this;if(a.isPainted){if(!("filter"!==t||null!=r&&r.length||null!=i&&i.length))return;if("dataset"===t)return;if("remove"===t&&1===n.length&&n[0].isEventModel){var o=a.store,l=n[0],s=Pl.clearTime(l.startDate),u=Pl.clearTime(l.endDate);do{var c=Pl.makeKey(s),d=a.cellMap.get(c);d&&($e.remove(d.events,l),d.events.length?a.onStoreUpdateRecord({source:o,record:a.store.getById(c),changes:{}}):(a.cellMap.delete(c),delete a.dateIndex[c],o.remove(c,!0))),s.setDate(s.getDate()+1)}while(s<u);return}}a.populateStoreSoon()}},{key:"cellMap",get:function(){var e,t=this;return null!==(e=t._cellMap)&&void 0!==e&&e.populated?t._cellMap:t.createCellMap({endDate:Pl.add(t.endDate,t.range?0:1,"d"),rawEvents:!0,skipPropagate:!0})}},{key:"onMonthChange",value:function(){var e;B(t,"onMonthChange",this,3)(arguments),null!==(e=this._cellMap)&&void 0!==e&&e.size||!this.alwaysShowCurrentDate||this.populateStoreSoon()}},{key:"populateStore",value:function(){var e,t;null===(e=this._cellMap)||void 0===e||e.clear();var n=this,r=n.store,i=n.rowManager,a=n.dateFilter,o=n.hiddenNonWorkingDays,l=n.dayTime,s=n.scrollable,u=n.initialScrollDone,c=isNaN(n.eventHeight)?25:n.eventHeight,d=i.firstVisibleRow,h=null==d?void 0:d.id,f=d?d.top-s.y:0;n._eventCount=0,n.populateStoreSoon.cancel(),n.element.dataset.duration=n.duration,n.date||(n.isConfiguring=!0,n.date=n.eventStore.map((function(e){return e.startDate})).sort((function(e,t){return e.valueOf()-t.valueOf()}))[0],n.isConfiguring=!1);for(var v=n.cellMap,g=n.firstVisibleDate,m=n.eventRowSpacing,p=Pl.add(n.endDate,n.range?0:1,"d"),y=n.showEmptyDates?n.createRangeCellMapEntries():z(v.values()),k=[],b=n.dateIndex={},C=0,w=y.length;C<w;C++){var D=y[C],S=D.date;if(S>=g&&S<p&&(!a||n.callback(a,n,[D]))&&!o[S.getDay()]){var x=r.createRecord(D),E=$e.findInsertionIndex(x,k,VA);k.splice(E,0,x),b[D.id]=x}}if(n.alwaysShowCurrentDate&&!(r.isFiltered?k.filter(r.filtersFunction):k).length){var R=r.createRecord(F(F({},n.createCellData(n.date)),{},{cls:"b-current-date-placeholder"}));k.push(R),b[R.id]=R}r.suspendEvents(),r.loadData(k),r.resumeEvents(),n.onAgendaStoreFilter();var T=r.count,M=T?r.records.map((function(e){return e.events.length})).reduce((function(e,t){return e+t}),0)/T:0,A=n.findClosestOccupiedDate(n.date),I=r.getById(u?h:l.dateKey(A));if(i._rowHeight=i.minRowHeight=Math.max(M*(c+m)-m,70),i.calculateRowCount(!1,!0,!0),i.estimateTotalHeight(!0),T){var L=i.topRow,O=Math.max(r.indexOf(I)-i.prependRowBuffer,0);i.topIndex=L.dataIndex=O,L.setTop(i.rowHeight*O)}if(i.refresh(),I){var P=i.getRecordCoords(I,!0),_=u?{animate:!1,block:"start",edgeOffset:f}:{animate:!1};s.y+=s.getDeltaTo(P,_).yDelta,i.lastScrollTop=s.y,n.scrollTo(I,_),n.initialScrollDone=!0}n.refreshCount=(n.refreshCount||0)+1,n.trigger("refresh"),null===(t=n.calendar)||void 0===t||t.syncUIWithActiveView(n),n.columns.forEach((function(e){var t,n;return null===(t=(n=e.constructor).exposeProperties)||void 0===t?void 0:t.call(n)})),n.getConfig("settingsButton")}},{key:"createRangeCellMapEntries",value:function(){for(var e=this,t=e.cellMap,n=e.startDate,r=e.endDate,i=[],a=new Date(n);a<r;a.setDate(a.getDate()+1))i.push(t.get(Pl.makeKey(a))||e.createCellData(a));return i}},{key:"toggleEmptyText",value:function(){var e,t=this.store,n=!((1!==t.count||null!==(e=t.first)&&void 0!==e&&e.events.length?t.count:0)>0||t.isLoading||t.isCommitting);this.element.classList.toggle("b-grid-empty",n)}},{key:"scrollRowIntoView",value:function(e){var n=this.scrollable,r=this.rowManager,i=this.store.getById(e);if(!r.getRowFor(i)){var a=this.columns.find((function(e){return"agendacolumn"===e.type}));if(a.renderer===a.defaultRenderer){var o=this.calculateRowTop(i);n.y=o<r.firstVisibleRow.top?o+r.averageRowHeight:o-n.clientHeight,r.jumpToPosition(n.y)}}B(t,"scrollRowIntoView",this,3)(arguments)}},{key:"calculateRowTop",value:function(e){var t=0;if(this.rowManager.rowCount)for(var n,r=this,i=isNaN(r.eventHeight)?25:r.eventHeight,a=r.eventRowSpacing,o=r.rowManager.topRow.cells[0],l=li.getEdgeSize(o,"padding","tb").height,s=((null===(n=o.querySelector(".b-cal-agenda-date"))||void 0===n?void 0:n.offsetHeight)||0)+l,u=0,c=r.store.count;u<c;u++){var d=r.store.getAt(u),h=Math.max(d.events.length*(i+a)-a+l,s);if(d===e)break;t+=h}return t}},{key:"eventCount",get:function(){return this._eventCount}},{key:"collectEvents",value:function(e){var n=this;return e.getDateIndex=function(e){return Number(e)!==Number(n.startDate)&&n.hideEventOverflow?"startDate":"date"},B(t,"collectEvents",this,3)([e])}},{key:"changeStore",value:function(e){return(e=B(t,"changeStore",this,3)([e]))&&(this.nonWorkingDaysFilter=e.addFilter({id:"".concat(this.id,"-nonworkingday-filter"),filterBy:function(e){return!e.isNonWorking},disabled:!this.hideNonWorkingDays},!0),this.detachListeners("agendaStoreFilter"),e.ion({name:"agendaStoreFilter",filter:"onAgendaStoreFilter",thisObj:this}),e.reapplyFilterOnAdd=!0),e}},{key:"onAgendaStoreFilter",value:function(){var e=this;e._eventCount=e.store.reduce((function(t,n,r){for(var i=n.events,a=n.date,o=0,l=i.length;o<l;o++){var s=i[o];e.isAllDayEvent(s)&&r&&Pl.clearTime(s.startDate).valueOf()!==a.valueOf()||t++}return t}),0)}},{key:"updateHideEventOverflow",value:function(){this.refresh()}},{key:"updateHideNonWorkingDays",value:function(e){this.isConfiguring||(this.nonWorkingDaysFilter.disabled=!e),this.refresh()}},{key:"doRefresh",value:function(){this.populateStore()}},{key:"createCellData",value:function(e){return Object.assign(this.cellMonth.getCellData(e,this.month),{view:this,id:Pl.makeKey(e),events:[]})}},{key:"cellRenderer",set:function(e){this._cellRenderer=e}},{key:"changeSettingsButton",value:function(e){var n=this.listRangeMenu;return n&&(n.appendTo=this.element),(e=e&&n&&B(t,"changeSettingsButton",this,3)([this.constructor.mergeConfigs({menu:n},e)]))&&this.addKeyBinding(e.actionKey,(function(){e.focus,e.element.click()})),e}}])}(_A.mixin(rC));S(NA,"$name","AgendaView"),S(NA,"type","agendaview"),S(NA,"configurable",{eventSorter:function(e,t){var n=e.startDate,r=e.isInterDay,i=t.startDate,a=t.isInterDay;return r!==a?Number(a)-Number(r):r||a?n-i||t.durationMS-e.durationMS||t.endingDate-e.endingDate:n-i},eventRowSpacing:8,title:"L{Agenda}",range:"year",hideEventOverflow:null,offsetStartsBeforeEvents:!0,handlePointerInteraction:!1,hideHeaders:!0,columns:{name:null,startDate:null,endDate:null,resources:null,agenda:{type:"agendacolumn"}},enableSticky:!0,preserveScrollOnDatasetChange:!0,positionMode:"position",settingsButton:{actionKey:"Ctrl+R",ariaLabel:"L{settings}",keyMap:{Escape:"revertFocus"}},cellTabIndex:null,rowCls:{"b-cal-agenda-grid-row":1},cellCls:{"b-calendar-cell":1},eventBarContainerCls:"b-cal-event-bar-container",keyMap:null,store:{modelClass:Cg},listRangeMenu:{align:{align:"t100-b100"}},dateFilter:null,alwaysShowCurrentDate:null,showEmptyDates:null,emptyText:"L{YearView.noEvents}",topDate:{$config:{equal:"date"},value:null}}),NA.initClass(),NA._$name="AgendaView";var zA=/^[+-]?\d+(?:\.\d+)?(?:%|px)?$/,jA=function(){function e(t,n){m(this,e),this.r=t,this.d=n}return w(e,[{key:"add",value:function(t){return(t=e.from(t))?new e(this.r+t.r,this.d+t.d):this}},{key:"adjust",value:function(e,t){return this.r+=e||0,this.d+=t||0,this}},{key:"freeze",value:function(){return Object.freeze(this)}},{key:"px",value:function(e){return this.r*(e||100)+this.d}},{key:"sub",value:function(t){return(t=e.from(t))?new e(this.r-t.r,this.d-t.d):this}},{key:Symbol.iterator,value:L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,"r";case 2:return e.next=4,"d";case 4:case"end":return e.stop()}}),e)}))},{key:"stringify",value:function(){var e=this.toString();return zA.test(e)?e:"calc(".concat(e,")")}},{key:"toString",value:function(){var e,t=this.r,n=this.d;return t?(e=li.percentify(100*t),n&&(e="".concat(e," + ").concat(n,"px").replace("+ -","- "))):e=n?"".concat(n,"px"):"0",e}}],[{key:"from",value:function(t){return null==t?null:t instanceof e?t:(Array.isArray(t)||"string"==typeof t&&isNaN(t)||(t=0===(t=Number(t))?[0,new Number(0)]:t<1?[t,0]:[0,t]),b(e,z(t)))}},{key:"get",value:function(t){return e.from(t)||e.ZERO}}])}();jA.ZERO=new jA(0,0).freeze(),jA._$name="LayoutDim";var WA=function(e){var t,n,r=this;return S(S(S(S(S({},e?"right":"left",null===(t=r.left)||void 0===t?void 0:t.stringify()),"top",r.top.stringify()),"width",null===(n=r.width)||void 0===n?void 0:n.stringify()),"height",r.height.stringify()),"minWidth",r.minWidth)},$A=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"beforeLayoutEvents",value:function(e){return this.owner.trigger("beforeLayoutEvents",{context:e}),e}},{key:"clusterize",value:function(e,t,n,r){var i=e[e.length-1]||null;t.push(n),i&&this.overlaps(i,n)?(n.cluster=i,i.end=Math.max(i.end,n.end),i.items.push(n)):e.push(n.cluster={context:r,start:n.start,end:n.end,items:[n]})}},{key:"createLayoutContext",value:function(e,t){var n=null==e?void 0:e.events;return{cellData:e,dayDomConfig:t,events:(null==n?void 0:n.length)>1?e.dayTime.sortEvents(e.date,n.slice()):n||[],clusters:[],items:[],layout:this}}},{key:"layoutEvents",value:function(e,t){var n,r,i,a,o,l=this,s=l.beforeLayoutEvents(l.createLayoutContext(e,t)),u=s.clusters,c=s.events,d=s.items,h=D(c);try{for(h.s();!(o=h.n()).done;)n=o.value,i=l.createLayoutItem(n,s),l.clusterize(u,d,i,s)}catch(e){h.e(e)}finally{h.f()}for(r=0,a=u.length;r<a;++r)l.layoutCluster(u[r]);return l.owner.trigger("layoutEvents",{context:s}),s}},{key:"createLayoutItem",value:function(e,t){var n=t.cellData,r=n.date,i=n.tomorrow,a=n.dayEnd,o=n.dayTime,l=e.allDay,s=e.startDate,u=e.endingDate,c=l||s<r?0:o.delta(s,"s"),d=ql.from(e.preamble),h=ql.from(e.postamble),f=l||u>=i?a:o.delta(u,"s");!e.isMilestone||e.isTimeRangeModel||e.allDay||(f=c+this.owner.milestoneDuration/1e3);var v=Math.max(c,0),g=Math.min(f,a),m=jA.from(v/a);return{eventRecord:e,getStyles:WA,start:v,end:g,top:m,id:e.id,height:new jA(g/a,0).sub(m),startsBefore:s<r||c<0,endsAfter:i<u||f>a,preambleSec:d?Pl.as("s",d):0,postambleSec:h?Pl.as("s",h):0}}},{key:"overlaps",value:function(e,t,n,r){return"string"==typeof n&&(r=n,n=null),r=r||"end",n=null!=n?n:60*this.overlapTolerance||0,e.start<t[r]-n&&t.start<e[r]-n}},{key:"syncGutter",value:function(){this.owner.setStyle("--dayview-cell-gutter",String(jA.get(this.gutter&&this.gutterWidth)))}},{key:"updateGutter",value:function(){this.syncGutter()}},{key:"updateGutterWidth",value:function(){this.syncGutter()}},{key:"updateInset",value:function(e){this.owner.setStyle("--dayview-cell-inset-size",String(jA.get(e)))}}])}(Mn.mixin(Za));S($A,"factoryable",{}),S($A,"configurable",{gutter:!0,gutterWidth:5,inset:40,overlapTolerance:null,owner:null}),$A._$name="DayLayout";var UA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"pack",value:function(e){var t=e.map((function(e){var t=e.eventRecord.startDate,n=new Date(t);return n.setSeconds(n.getSeconds()+e.maxEnd-e.start),{item:e,start:t,end:n,x:0}}));this.packEventsInBands(t,(function(e,t,n,r){e.width=r,e.w=r*GA,e.x+=(e.left=n.start+t*r)*GA,e.item.x=e.x,e.item.w=e.w}))}}],[{key:"defaultConfig",get:function(){return{coordProp:"left",sizeProp:"width"}}}])}(eR()),GA=1e4,YA=Object.freeze([]),qA=new UA,KA=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"createLayoutContext",value:function(e,n){var r=this,i=B(t,"createLayoutContext",this,3)([e,n]),a=r.staggerWidth;return Object.assign(i,{indentWidth:jA.get(r.indentWidth),stagger:new jA,staggerMaximum:jA.from(r.staggerMaximum),staggerMinimum:r.staggerMinimum,staggerWidth:jA.from(!0===a?r.gutterWidth:a),stretch:r.stretch})}},{key:"layoutCluster",value:function(e){var t=e.context,n=e.items,r=t.indentWidth,i=t.stagger,a=t.staggerMaximum,o=t.staggerMinimum,l=t.staggerWidth,s=t.stretch,u=this.treeify(n);this._assignSizes(n,u);var c,d=D(n);try{for(d.s();!(c=d.n()).done;){var h,f=c.value,v=f.depth,g=new jA,m=new jA,p=f.majorParent||f,y=D(i);try{for(y.s();!(h=y.n()).done;){var k=h.value;i[k]=l[k]*(v.height+v.overlap),i[k]=null!=a&&a[k]?Math.min(a[k],i[k]):i[k]}}catch(e){y.e(e)}finally{y.f()}g.r=p.x+v.minor*r.r*p.w,g.d=v.minor*r.d,m.r=s?1-g.r:p.w-g.r+p.x,m.d=-g.d,o&&(f.minWidth="calc(".concat(o," * (").concat(m,"))")),m.r-=i.r*p.w,m.d-=i.d,f.left=g,f.width=m}}catch(e){d.e(e)}finally{d.f()}}},{key:"treeify",value:function(e){for(var t=[],n=0;n<e.length;n++)this._addChild(e[n],n,t);return t}},{key:"_addChild",value:function(e,t,n){var r=this,i=r.clearanceMinutes,a=r.escapeMinutes,o=r.stretch,l=60*i,s=l+60*a,u=60*(r.overlapTolerance||0),c=function(e){return 10*e.depth.minor+e.depth.major*(o?1:0)},d={depth:0,height:0,heightMajor:0,overlap:0,major:0,minor:0};if(e.parent=null,e.maxEnd=e.maxEndMajor=e.end,e.depth=d,e.order=t,!n.length)return n[0]=e,void(e.barriers=YA);var h,f,v,g,m,p,y,k,b,C=0,w=D(n);try{for(w.s();!(y=w.n()).done;){if(h=(g=y.value).lastItem||g,!r.overlaps(e,g,u,"maxEnd")){m=g.parent,f=!0;break}if(k=e,b=h,Math.abs(b.start-k.start)>=l){for(v=!0,f&&(f=!1,m=null);h!==g&&!r.overlaps(h,e,u);h=h.parent);p=c(h),(!m||p<C)&&(m=h,C=p)}else v||(f=!0,m=g)}}catch(e){w.e(e)}finally{w.f()}if(f)v=0,g=m=n[(f=m?m.depth.major+1:0)-1]||null;else{for(g=m.majorParent||m;s&&m!==g&&!(r.overlaps(m,e,u)&&e.start-m.start<s);m=m.parent);v=m.depth.minor+1,f=m.depth.major}e.parent=m,d.major=f,d.minor=v,d.depth=m?m.depth.depth+1:0,v?(e.majorParent=g,e.previousItem=g.lastItem,g.lastItem=e):r._addMajor(e,n),r._adjustOverlap(e),r._adjustParents(e)}},{key:"_addMajor",value:function(e,t){var n=this,r=n.stretch;if(t[e.depth.major]=e,e.barriers=n._getOverlaps(t,e,1),r||e.barriers.length){var i,a=D(n._getOverlaps(t,e,-1));try{for(a.s();!(i=a.n()).done;){var o=i.value,l=o.barriers.filter((function(t){return!e.barriers.includes(t)}));(r||l.length<o.barriers.length)&&(o.barriers=l,l.push(e))}}catch(e){a.e(e)}finally{a.f()}}}},{key:"_adjustOverlap",value:function(e){if(e.depth.minor){var t,n;for(n=e;n.depth.minor>1;n=n.parent);for(t=0;n=n.previousItem;)this.overlaps(n,e)&&(t=Math.max(t,n.depth.height+n.depth.overlap+1));e.depth.overlap=t}}},{key:"_adjustParents",value:function(e){for(var t,n=e.depth,r=e.end,i=n.minor+n.overlap,a=e;a=a.parent;)if((t=a.depth).major===n.major)for(a.maxEnd=Math.max(a.maxEnd,r);t.height<i-t.minor;)++t.height,t.overlap&&--t.overlap;else t.heightMajor=Math.max(t.heightMajor,n.major-t.major)}},{key:"_assignSizes",value:function(e,t){var n=this.complexityLimit,r=this.stretch,i=e.filter((function(e){return!e.depth.minor}));if(n){var a,o=D(i);try{var l=function(){var e=a.value,i=e.barriers.map((function(e){return[e]})),o=e.parent,l=e.depth.heightMajor+1;e.x=o?o.x+o.w:0;var s,u,c,d,h,f,v,g=(1-e.x)/l;if(i.length){for(s=0;s<i.length;){if(d=i[s],c=c||d,s>n){g=1/t.length;break}if((h=d[d.length-1]).order<e.order)++s,v=h.x,u=0;else{if(h.barriers.length){i.splice.apply(i,[s,1].concat(z(h.barriers.map((function(e){return d.concat(e)}))))),c===d&&(c=null);continue}++s,v=1,u=1}(f=(v-e.x)/(u+d.length))<g&&(g=f,c=d)}if(r){for(f=c.reduce((function(e,t){return e+t.depth.height+1}),0),s=e.lastItem;s;s=s.previousItem)s.depth.overlap+=f;e.depth.overlap+=f}}e.w=g};for(o.s();!(a=o.n()).done;)l()}catch(e){o.e(e)}finally{o.f()}}else{qA.pack(i);var s,u=D(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;c.x/=GA,c.w/=GA}}catch(e){u.e(e)}finally{u.f()}}}},{key:"_getOverlaps",value:function(e,t,n){var r,i,a,o=t.end,l=n<0?-1:e.length,s=t.start;for(r=t.depth.major+n;r!==l&&s<o;r+=n)s<(i=e[r]).maxEnd&&i.start<o&&((a||(a=[])).push(i),s=i.maxEnd);return a||YA}}])}($A);S(KA,"type","fluid"),S(KA,"configurable",{clearanceMinutes:45,complexityLimit:2e3,escapeMinutes:null,indentWidth:10,staggerMaximum:null,staggerMinimum:.4,staggerWidth:!0,stretch:null}),KA.initClass(),KA._$name="FluidDayLayout";var XA=my.MILLIS_PER_HOUR,ZA=new Date(2020,11,22,22,59,59),JA={paint:1,refresh:1,resize:1,eventspercellchange:1,rangechange:1,beforedatechange:1,localized:1},QA=function(e){e.stopImmediatePropagation()},eI=function(e){return e.ctrlKey&&e.preventDefault()},tI={level:0,step:"1 hour"},nI=new pt(0,0,0,0),rI=["30 minutes","15 minutes","10 minutes","5 minutes"],iI=["30 minutes","12 minutes","6 minutes"],aI=function(e){return e.eventRecord||e},oI=Object.freeze([]),lI=function(e){return"string"==typeof e?{text:e}:e},sI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n,r=this;r.configuredHiddenVerticalScroll="hidden-scroll"===(null===(n=e.scrollable)||void 0===n?void 0:n.overflowY),r.cellMapEventFilter=r.cellMapEventFilter.bind(r),B(t,"construct",this,3)(arguments),r.startDate||(r.startDate=r.month.date),Wn.ion({theme:"onThemeChange",thisObj:r})}},{key:"startConfigure",value:function(e){this.hasConfig("fixedDuration")||this.isDayResourceView||(this.fixedDuration=!(this.initialConfig.range||this.initialConfig.endDate)),B(t,"startConfigure",this,3)([e])}},{key:"updateProject",value:function(e,n){this.isConfiguring||this.allDayEvents&&(this.allDayEvents.project=e),B(t,"updateProject",this,3)([e,n])}},{key:"updateZoomOnMouseWheel",value:function(e){var t;e?this.zoomListener=fr.on({element:this.dayContentElement,wheel:"onDayContentMousewheel",thisObj:this,throttled:{buffer:100,alt:eI}}):null===(t=this.zoomListener)||void 0===t||t.call(this)}},{key:"childItems",get:function(){var e=this.allDayEvents,n=B(t,"childItems",this,1);return e&&n.push(e),n}},{key:"dayEndTime",get:function(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.timeEnd)&&void 0!==e?e:this._dayEndTime}},{key:"dayStartTime",get:function(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.timeStart)&&void 0!==e?e:this._dayStartTime}},{key:"dayStartShift",get:function(){var e,t;return null!==(e=null===(t=this.dayTime)||void 0===t?void 0:t.startShift)&&void 0!==e?e:this._dayStartShift}},{key:"changeDayEndTime",value:function(e){return this.adjustCoreHours(),Math.ceil((this.configuredDayEndTime=my.parse(e))/XA)*XA}},{key:"updateDashedSubticks",value:function(e){this.dayContainerElement.classList.toggle("b-dashed-subticks",Boolean(e))}},{key:"updateDayEndTime",value:function(e){this._dayTime=null,this.dayTime=new my({startShift:this.dayStartShift,timeStart:this.dayStartTime,timeEnd:e})}},{key:"changeDayStartTime",value:function(e){return this.adjustCoreHours(),Math.floor((this.configuredDayStartTime=my.parse(e))/XA)*XA}},{key:"adjustCoreHours",value:function(){if(null==this.initialConfig.coreHours){var e=this._dayStartTime,t=this._dayEndTime,n=this.configuredDayStartTime,r=this.configuredDayEndTime;this.coreHours=e<n||t>r?{start:n||0,end:r||24,overlayDay:!0}:null}}},{key:"updateDate",value:function(e,n){var r=this.allDayEvents;r&&(r.date=e),B(t,"updateDate",this,3)([e,n])}},{key:"updateDayStartTime",value:function(e){this._dayTime=null,this.dayTime=new my({startShift:this.dayStartShift,timeStart:e,timeEnd:this.dayEndTime})}},{key:"updateDayStartShift",value:function(e){this._dayTime=null,this.dayTime=new my({startShift:e,timeStart:this.dayStartTime,timeEnd:this.dayEndTime})}},{key:"changeDayTime",value:function(e){var t;if(e||(e=new my(this)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}},{key:"updateDayTime",value:function(e,t){var n=this,r=n.eventStore;if(r&&(r.registerDayIndex(e),t&&r.unregisterDayIndex(t)),!n.isConfiguring&&(n.syncHours(),e.startShift!==(null==t?void 0:t.startShift))){var i,a=e.startOfDay(n.startDate),o=e.startOfDay(n.date);n.setConfig({date:o,startDate:a}),null===(i=n.allDayEvents)||void 0===i||i.setConfig({date:o,dayTime:e,startDate:a})}}},{key:"dateKey",value:function(e){return this.dayTime.dateKey(e)}},{key:"dayOfDate",value:function(e){return e&&this.dayTime.dayOfDate(e)}},{key:"scrollTo",value:(s=f(L().mark((function e(n,r){var i,a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(i=this).allDayEvents,o=[],s=(l="number"==typeof n)?Pl.add(i.startDate,n,"hour"):"string"==typeof n?Pl.parse(n):new Date(n),u=!isNaN(s),e.next=3,i.scrollPromise;case 3:return e.next=5,null==a?void 0:a.heightAnimation;case 5:if(!i.isDestroyed){e.next=7;break}return e.abrupt("return");case 7:return r=Be.assign({},i.defaultScrollOptions,"boolean"==typeof r?{animate:r}:r),e.t0=o,e.next=11,B(t,"scrollTo",this,3)([u?s:n,F(F({},r),{},{y:!u,highlight:!1})]);case 11:if(e.t1=e.sent,e.t0.push.call(e.t0,e.t1),!u){e.next=31;break}d=i.firstVisibleDate,h=i.lastVisibleDate,d.setHours(i.dayStartHour),h.setHours(i.dayEndHour),s.setTime(Pl.clamp(s,d,h)),f=-1;case 19:if(i.getDayElement(s)){e.next=27;break}if(!(s<d||s>h)){e.next=24;break}if(!((f=-f)<0)){e.next=24;break}return e.abrupt("return");case 24:s.setDate(s.getDate()+f),e.next=19;break;case 27:(c=i.getDayElement(s))&&!1!==r.y&&(n=s.getHours()+s.getMinutes()/60,o.push(i.scrollable.scrollTo(null,i.getPositionFromTime(n),r))),e.next=33;break;case 31:(c=i.getEventElement(n))&&(v=pt.from(c.closest(".b-calendar-cell")),g=pt.from(c),r.edgeOffset={end:i.rtl?g.x-v.x:v.right-g.right});case 33:return c&&(!u||i.duration>1&&!l)&&o.push(i.horizontalScroller.scrollIntoView(c,r)),e.abrupt("return",i.scrollPromise=Promise.all(o).then((function(){return i.scrollPromise=null})));case 35:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getEventElement",value:function(e,n){var r;return B(t,"getEventElement",this,3)([e,n])||(null===(r=this.allDayEvents)||void 0===r?void 0:r.getEventElement(e,n))}},{key:"getEventElements",value:function(e){var n;return B(t,"getEventElements",this,3)([e])||(null===(n=this.allDayEvents)||void 0===n?void 0:n.getEventElements(e))}},{key:"getPositionFromTime",value:function(e){return my.parse(e)<my.parse(this.dayStartTime)-this.dayStartShift?0:this.dayTime.delta(e,"h")*this.hourHeight}},{key:"updateShowAllDayHeader",value:function(e){var t,n,r=this,i=r._allDayEvents;(null===(t=r._cellMap)||void 0===t||t.clear(),r.element.classList.toggle("b-hide-allday-header",!e),i)&&(null===(n=i._cellMap)||void 0===n||n.clear(),i.element.classList.toggle("b-hide-allday-header",!e),i.refresh());r.isConfiguring||r.refresh()}},{key:"changeAllDayEvents",value:function(e,t){var n,r;if(!e)return null==t?void 0:t.destroy();this.getConfig("date"),e.maxHeight&&(this.maxAllDayHeight=e.maxHeight,e.maxHeight=null);var o=this,l=o.autoCreate,s=o.dayHeaderRenderer,u=o.overflowButtonRenderer,c=o.overflowClickAction,d=o.overflowPopup,h=o.avatarRendering,f=o.range,v=o.shiftIncrement,g=o.isConfiguring?o.peekConfig("showAllDayHeader"):o.showAllDayHeader,m=FA.reconfigure(t,e,{owner:o,defaults:(r={calendar:o.calendar,parent:o,rtl:o.rtl,cls:{"b-dayview-schedule-container":1,"b-dayview-initializing":1,"b-hide-allday-header":!g}},S(S(S(S(S(S(S(S(S(S(r,d!==i?"overflowPopup":"_",d),u?"overflowButtonRenderer":"_",u),c?"overflowClickAction":"_",c),s?"dayHeaderRenderer":"_",s),h?"avatarRendering":"_",h),v?"shiftIncrement":"_",v),"autoCreate",!1!==l&&{newName:l.newName,gesture:l.gesture,startHour:0,duration:null!==(n=o.initialConfig.autoCreate)&&void 0!==n&&n.duration?"".concat(Pl.as(l.durationUnit,"1 day")," ").concat(l.durationUnit):"1 day"}),o.initialConfig.dragUnit?"dragUnit":"_",o.dragUnit),"dayNameSelector",".b-day-name-date"),"eventFilter",(function(e){return o.showAllDayHeader&&o.isAllDayEvent(e)&&(!o.eventFilter||o.eventFilter(e))})),S(S(S(S(S(S(S(S(S(S(r,"dayStartTime",o.dayStartTime),"dayEndTime",o.dayEndTime),"dayStartShift",o.dayStartShift),"eventRenderer",o.eventRenderer),"eventStore",o.eventStore),"month",o.month),"fullWeek",1===o.duration&&o.fixedDuration&&!o.dayTime.startShift),"filterEventResources",o.filterEventResources),"startDate",o.startDate),f?"range":"_",f),S(S(S(S(S(S(S(S(S(S(r,f?"_":"endDate",o.endDate),"nonWorkingDays",o.nonWorkingDays),"dateFilter",o.dateFilter),"nonWorkingDayCls",o.nonWorkingDayCls),"weekendCls",o.weekendCls),"weekStartDay",o.weekStartDay),"defaultCalendar",o.defaultCalendar),"emptyCellRenderer",o.emptyCellRenderer),"hideEmptyDays",o.hideEmptyDays),"syncCalendarDate",o.syncCalendarDate),S(S(S(S(r,"internalListeners",{heightChange:"updateElementLayout",refresh:"updateElementLayout",catchall:"relayAllDayEvents",showoverflowpopup:"onAllDayOverflowPopupShown",thisObj:o}),"editAutoCreatedEvent",(function(e){(o.showAllDayHeader?this:o).trigger("eventAutoCreated",{eventRecord:e})})),"createCellMap",(function(){var e;return o.showAllDayHeader?(e=this.constructor.prototype.createCellMap).call.apply(e,[this].concat(Array.prototype.slice.call(arguments))):o.emptyMap||(o.emptyMap=new a)})),"actionButtons",o.actionButtons)),setup:function(e){e.hideNonWorkingDays=!(1===o.duration&&!e.fullWeek)&&o._hideNonWorkingDays}});return m&&(m.height=m.flex=null,o.originalAllDayEventsScrollTo=m.scrollTo,m.scrollTo=o.allDayEventsScrollTo.bind(o)),m}},{key:"onAllDayOverflowPopupShown",value:function(e){var t=e.overflowPopup;this._overflowPopup=t}},{key:"allDayEventsScrollTo",value:function(e){var t,n=this,r=e.isEvent?e.startDate:n.changeEndDate(e);if(e.isEvent?Pl.intersectSpans(n.startDate,n.endDate,e.startDate,e.endDate):Pl.betweenLesser(r,n.startDate,n.endDate))return(t=n.originalAllDayEventsScrollTo).call.apply(t,[n.allDayEvents].concat(Array.prototype.slice.call(arguments)));n.date=r}},{key:"updateAutoCreate",value:function(e){var n,r=this._allDayEvents;null===(n=B(t,"updateAutoCreate",this,3))||void 0===n||n([e]),r&&(r.autoCreate=!!e&&{newName:e.newName,gesture:e.gesture,startHour:0,duration:"1 day"})}},{key:"updateWeekStartDay",value:function(e,n){var r;null===(r=B(t,"updateWeekStartDay",this,3))||void 0===r||r([e]),!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.weekStartDay=e)}},{key:"updateEventStore",value:function(e,n){B(t,"updateEventStore",this,3)([e,n]);var r=this.dayTime;r&&(null==e||e.registerDayIndex(r),null==n||n.unregisterDayIndex(r))}},{key:"overflowPopup",get:function(){var e;return(null===(e=this._allDayEvents)||void 0===e?void 0:e.overflowPopup)||this._overflowPopup}},{key:"description",get:function(){var e=this,n=e.range,r=e.shortDateFormat;return e.descriptionRenderer||e.fixedDuration||1===e.duration||1===(null==n?void 0:n.magnitude)&&"day"===n.unit?B(t,"description",this,1):n&&!e.dateFilter?"".concat(Pl.format(e.startDate,r),", ").concat(n.magnitude," ").concat(Pl.getLocalizedNameOfUnit(n.unit,n.magnitude>1)):"".concat(Pl.format(e.startDate,r)," - ").concat(Pl.format(Pl.add(e.endDate,-1,"d"),r))}},{key:"eventContentElement",get:function(){return this.dayContainerElement}},{key:"getDateFromDomEvent",value:function(e){var n=arguments.length>1&&arguments[1]!==i&&arguments[1],r=B(t,"getDateFromDomEvent",this,3)([e]),a=this,o=li.getEventElement(e);if(r&&o!==e&&a.dayContainerElement.contains(o)){var l=(e.clientY||o.getBoundingClientRect().y)-.5;r=Pl.add(r,a.dayStartHour-a.dayStartShift/36e5+(l-a.scrollable.element.getBoundingClientRect().y+a.scrollable.y)/a.hourHeight,"hour"),n||(r=Pl[a.timeSnapType](r,a.increment))}return r}},{key:"getDateFromPosition",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3?arguments[3]:i,a=this,o=a.eventContentElement,l=a.allDayEvents,s=n?nI:pt.fromScreen(o).roundPx().translate(-o.scrollLeft),u=o.scrollWidth,c=n?e:e-s.x,d=a.rtl?a.eventContentElement.offsetWidth-c:c,h=t-s.y,f=a.getDayElementFromX(e),v=(null==f?void 0:f.offsetHeight)||a.hourHeight*a.getDayLength("hour"),g=a.getDateFromElement(f,r)||a.date;return l&&(d<0||u<d||h<0||v<h)?l.getDateFromPosition(e,t,r):(Pl.clearTime(g,!1),g.setMilliseconds(g.getMilliseconds()+a.dayStartMs+Math.floor(h/v*a.getDayLength())),Pl[a.timeSnapType](g,a.increment))}},{key:"doRefresh",value:function(){var e=this,t=e.element,n=e.noMatchingDates,r=e.resolveCallback(e.columnHeaderRenderer,e,!1);if(e.isVisible){var i,a;e.allowTransitionsOnRefresh||li.addTemporaryClass(t,"b-no-transitions",200,e),e.allowTransitionsOnRefresh=null;var o=[],l=[];e.today=e.dayTime.startOfDay((null===(i=e.calendar)||void 0===i?void 0:i.dateTimeNow)||new Date);for(var s=0,u=new Date(e.startDate);u<e.endDate;s++,u.setDate(u.getDate()+1)){var c=e.getDayDomConfig(u);if(c&&(l.push(c),r))if(l[s]){var d=e.dayTime.dateKey(u),h={dataset:{syncId:d},className:{"b-day-column-header-cell":1}},f=r.handler.call(r.thisObj,e.cellMap.get(d));f&&(h["string"==typeof f?"html":"children"]=f),o.push(h)}else o.push(null)}r?(t.classList.add("b-has-day-header"),fa.sync({targetElement:e.dayHeaderContentElement,domConfig:{onlyChildren:!0,children:o,syncOptions:{syncIdField:"syncId",releaseThreshold:0,strict:!0}}})):t.classList.remove("b-has-day-header"),t.classList.toggle("b-multidayview",l.length>1),t.style.setProperty("--visible-column-count",l.length),null===(a=e.onDayCellConfigGenerated)||void 0===a||a.call(e,l),fa.sync({targetElement:e.dayContainerElement,domConfig:{onlyChildren:!0,children:l.length?l:[S({className:"b-empty-text"},null!=n&&n.includes("<")?"html":"text",n)],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:l.length>0}}}),e.element.classList.toggle("b-no-days",!l.length),e.refreshDayBackground(),e.refreshCount=(e.refreshCount||0)+1,e.syncCurrentTimeIndicators(),e.trigger("refresh")}}},{key:"getEventsForDay",value:function(e,t){var n,r,i=this,a="string"==typeof e?e:i.dayTime.dateKey(e),o=i.allDayEvents;t&&i.startDate-t&&(null===(r=i._cellMap)||void 0===r||r.clear(),i.startDate=t);var l=(null===(n=i.cellMap.get(a))||void 0===n||null===(n=n.events)||void 0===n?void 0:n.slice())||[];if(o){var s,u;if(o.startDate-i.startDate)null===(u=o._cellMap)||void 0===u||u.clear(),o.startDate=i.startDate;l.push.apply(l,(null===(s=o.cellMap.get(a))||void 0===s?void 0:s.renderedEvents)||oI)}return l.map(aI)}},{key:"getBaseDayDomConfig",value:function(e){var t=this,n=t.dateFilter,r=t.resource,i=t.dayTime.dateKey(e),a=t.cellMap.get(i)||t.cellMap.set(i,t.createCellData(e)).get(i),o=a.day;if(!(t.hiddenNonWorkingDays[o]&&1!==t.duration||t.hideEmptyDays&&!t.getEventsForDay(i).length||n&&!t.callback(n,t,[a]))){var l,s=t.nonWorkingDays||t.month.nonWorkingDays;return[a,{tabIndex:-1,role:"gridcell","aria-label":"".concat(Pl.format(e,"dddd Do MMMM")).concat(r?" ".concat(r.name):"",", ").concat(t.L("eventCount",(null===(l=a.events)||void 0===l?void 0:l.length)||0),"."),dataset:{date:i},className:S(S(S(S(S(S(S({"b-dayview-day-detail":1},t.dayCellCls,1),t.nonWorkingDayCls,s[o]||!1),t.weekendCls,Pl.weekends[o]),t.todayCls,!(e-t.today)),"b-last-cell",!(e-t.lastVisibleDate)),"b-day-of-week-".concat(o),1),"b-past-date",e<t.today),style:{},children:F({inset:{className:{"b-dayview-inset":1}},events:{className:{"b-dayview-event-container":1},children:[]}},t.renderTickBackground(a,r)),syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}}},{key:"renderTickBackground",value:function(e,t){var n=this,r=n.resolveCallback(n.tickRenderer,n,!1),i={};if(r){var a,o,l,s=parseInt(li.getStyleValue(n.contentElement,"--subtick-count")),u=n.getDayLength("h"),c=u*s,d=u/c,h=n.dayTime.startHour,f=new Date(e.date);f.setHours(h);var v=function(){var n=f;if(f=Pl.add(f,d,"h"),a=r.handler.call(r.thisObj,{events:e.events.filter((function(e){return Pl.intersectSpans(n,f,e.startDate,e.endingDate)})),startTime:n,endTime:f,tickIndex:o,subtickIndex:l,subTickCount:s,resourceRecord:t})){"string"==typeof a?a={text:a}:Array.isArray(a)&&(a={children:a.map(lI)});var u=!f.getMinutes(),c=a.rowspan||a.rowSpan;"string"==typeof a.style&&(a.style=li.parseStyle(a.style)),(a.style||(a.style={}))["--tick-index"]=o,c&&(a.style["--tick-rowspan"]=c,a.rowspan=a.rowSpan=null),a.className=F(F({},Ct.from(a.className,!0)),{},{"b-dayview-subtick":1,"b-last-in-hour":u}),(a.dataset||(a.dataset={})).hour=n.getHours(),a.dataset.minute=n.getMinutes(),a.dataset.index=l++,u&&(l=0),i["subtick-".concat(o)]=a}};for(o=0,l=0;o<c;o++)v()}return i}},{key:"getDayDomConfig",value:function(e){var t=this,n=t.getBaseDayDomConfig(e);if(n){var r=t.dayCellRenderer,i=_(n,2),a=i[0],o=i[1];return t.coreHours&&(o.style.backgroundImage=t.getCoreHoursGradient(t.getCoreHoursForDate(e))),t.renderEvents(a,o),li.normalizeChildren(r?t.callback(r,t,[o,a]):o)}}},{key:"onCalendarKeyDown",value:function(e){var n,r,i,a=e.target,o=this.dayCellCls,l=this.allDayEvents,s=(null!==(n=this.owner)&&void 0!==n&&n.isCalendarMixin?this.owner:this).eventContentElement;if(s.contains(a)){var u,c="".concat(a.matches(".b-dayview-day-detail")?".b-dayview-day-detail":"",".").concat(o),d=a.closest(c)||a,h=null===(u=d.closest("[data-date]"))||void 0===u?void 0:u.dataset.date,f=d.matches(c),v=d.dataset.resourceId,g=v?' [data-resource-id="'.concat(v,'"]'):"";switch(e.key){case"ArrowUp":if(f&&l){var m;e.preventDefault();var p=l.eventContentElement.querySelector(".".concat(l.dayCellCls,'[data-date="').concat(h,'"]').concat(g));li.isFocusable(p)&&li.isInView(p)||(p=l.headerCellContainer.querySelector('[data-header-date="'.concat(h,'"]')).focus()),null===(m=p)||void 0===m||m.focus()}return;case"ArrowLeft":return e.preventDefault(),void(null===(r=Ev.getVisitor(s,c).previous(d))||void 0===r||r.focus());case"ArrowRight":return e.preventDefault(),void(null===(i=Ev.getVisitor(s,c).next(d))||void 0===i||i.focus())}return B(t,"onCalendarKeyDown",this,3)([e])}}},{key:"getCoreHoursGradient",value:function(e){if(!e)return"";for(var t=this.dayTime,n=t.duration("h"),r=["linear-gradient(to bottom"],i=0,a=0,o=(e=$e.asArray(e)).length;a<o;a++){var l=e[a],s=Math.max(t.delta(l.start,"h"),0)/n*100,u=Math.min(t.delta(l.end,"h"),n)/n*100;if(1===o&&0===s&&100===u)return"";i<s&&r.push("var(--dayview-outside-core-hours-color) ".concat(li.percentify(i),", var(--dayview-outside-core-hours-color) ").concat(li.percentify(s))),r.push("transparent ".concat(li.percentify(s),", transparent ").concat(li.percentify(u))),i=u}return i<100&&r.push("var(--dayview-outside-core-hours-color) ".concat(li.percentify(i),", var(--dayview-outside-core-hours-color) 100%")),r.join(",")+")"}},{key:"getCoreHoursForDate",value:function(e){var t=this.coreHours;return 7===t.length?t[e.getDay()]:"object"===W(t)?t.overlayDay?t:null:this.callback(t,this,[e])}},{key:"refreshDayEvents",value:function(e){var t=this;e=t.changeEndDate(e),t.today=t.dayTime.startOfDay(new Date);var n=t.getDayDomConfig(e);li.addTemporaryClass(t.element,"b-no-transitions",200,t),n.onlyChildren=!0,fa.sync({targetElement:t.getDayElement(e),domConfig:n})}},{key:"renderEvents",value:function(e,t){var n,r=this,i=r.eventLayout.layoutEvents(e,t),a=i.items,o=r.eventSpacing,l=r.rtl,s=D(a);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=r.createEventDomConfig({date:e.date,eventRecord:u.eventRecord});r.insertActionButtons(c.children[0].children[0].children,u.eventRecord,e),c.className["b-starts-above"]=u.startsBefore,c.className["b-ends-below"]=u.endsAfter,u.cluster.items.length>1&&(c.className["b-cal-in-cluster"]=1),Object.assign(c.style,F(S({},o?"padding-bottom":"","".concat(o,"px")),u.getStyles(l))),t.children.events.children.push(c)}}catch(e){s.e(e)}finally{s.f()}r.trigger("renderEvents",{context:i})}},{key:"changeActionButtons",value:function(e){var t,n=Array.isArray(e);return n&&e.forEach((function(e,t){"ref"in e||(e.ref="action-button-".concat(t+1))})),this._actionButtonsObject=n?Be.transformArrayToNamedObject(e):e,new Proxy(e,{deleteProperty:function(e,n){return delete(t||(t=Be.clone(e)))[n]},get:function(e,n){return"$value"===n?t||e:"$reset"===n?function(){return t=null}:Array.isArray(e)&&"function"==typeof e[n]?(t||(t=Be.clone(e)))[n].bind(t):Reflect.get.apply(Reflect,arguments)},set:function(e,n,r){return Reflect.set(t||(t=Be.clone(e)),n,r)}})}},{key:"insertActionButtons",value:function(e,t,n){var r=this.actionButtons;if(r){var i=r.$value,a=Array.isArray(i)?i:Be.transformNamedObjectToArray(i);a.length&&e.push({className:"b-event-action-buttons",children:a.sort(Lo.weightSortFn).map((function(e,t){var n=e.cls,r=e.tooltip,i=e.ref;return{tag:"button",className:S({"b-tool":1,"b-icon":1},n,1),dataset:{ref:i,btip:r},"aria-label":r}}))}),r.$reset()}}},{key:"onEventClick",value:function(e){var t=e.domEvent.target.closest(".b-event-action-buttons button[data-ref]");if(t)return this.callback(this._actionButtonsObject[t.dataset.ref].handler,this,arguments),!1}},{key:"overflowElement",get:function(){return this.dayContentElement}},{key:"cellMap",get:function(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}},{key:"bodyConfig",get:function(){var e=this,n=e.allDayEvents,r=e.maxAllDayHeight;return Object.assign(B(t,"bodyConfig",this,1),{children:{alldayRowElement:n?{className:{"b-dayview-allday-row":1},style:S({},r?"maxHeight":"",li.setLength(r)),children:{cornerElement:{className:{"b-dayview-allday-row-start":1,"b-dayview-allday-autoheight":n.autoHeight},children:{allDayTextElement:{className:"b-dayview-allday-text",html:e.L("L{EventEdit.All day}")},allDayToggleIcon:{tag:"button",className:"b-expand-allday-button b-icon b-icon-expand-row",dataset:{btip:e.L("L{DayView.expandAllDayRow}")},"aria-label":e.L("L{DayView.expandAllDayRow}"),"aria-expanded":!1}}},allDayEvents:null==n?void 0:n.element,$scrollerPad:li.scrollBarPadElement}}:null,dayHeaderElement:{className:"b-day-column-header",children:{dayHeaderScrollerElement:{className:"b-day-column-header-scroller",children:{dayHeaderContentElement:{className:"b-day-column-content"}}},$scrollerPad:li.scrollBarPadElement}},dayContentElement:{role:"presentation",className:{"b-dayview-day-content":1},children:{timeAxisElement:{children:e.getTimeElementConfigs(),className:{"b-timeaxis-container":1},"aria-hidden":!0},dayContainerElement:{role:"row",className:{"b-dayview-day-container":1}}}},horizontalScrollerElement:{className:"b-virtual-scrollers b-hide-display",children:[{className:"b-virtual-scroller"},li.scrollBarPadElement]}}})}},{key:"onDayContentMousewheel",value:(l=f(L().mark((function e(t){var n,r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ctrlKey){e.next=6;break}return t.preventDefault(),n=this.zoomOnMouseWheel,r="number"==typeof n?n:1,i=t.clientY-this.scrollable.element.getBoundingClientRect().y,a=-Math.min(Math.abs(t.deltaY),10)*Math.sign(t.deltaY),e.next=5,this.zoomPromise;case 5:this.zoomPromise=this.zoomBy(a*r,i,this.allowZoomUnderflow);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"zoomIn",value:function(){this.zoomBy(2)}},{key:"zoomOut",value:function(){this.zoomBy(-2,i,!0)}},{key:"zoomBy",value:function(e){var t=this,n=arguments.length>1&&arguments[1]!==i?arguments[1]:Math.min(this.scrollable.scrollHeight,this.scrollable.clientHeight)/2-1,r=arguments.length>2?arguments[2]:i;return new Promise((function(i){var a=t,o=a.getDayLength("h"),l=a.hourHeight*o;a.updateElementLayout.cancel(),n=Math.min(n,l);var s=a.scrollable,u=a.hourHeight,c=s.clientHeight,d=s.element.scrollTop,h=e<0&&l>=c-5&&!r,f=Pl.round("number"==typeof n?a.getDateFromPosition(a.dayContainerElement.offsetWidth/2,n+d,!0):Pl.parse(n,"HH:mm:ss"),a.increment),v=h?a.dayContentClientHeight/o:a.minHourHeight,g=a.getPositionFromTime(f)-d,m=Math.max(Math.max(u+e,v),a.minHourHeight);if(h&&m*o<c)return a.fitHours=!0,i();u!==m?(s.overflowY=a.configuredOverflowY,a.ion({layoutUpdate:function(){s.scrollTo(null,a.getPositionFromTime(f)-g),s.syncPartners(!1,!0),i()},once:!0,prio:1e3}),a.fitHours=!1,a.hourHeight=m):(a.configuredOverflowY=s.overflowY,m===v&&(s.overflowY="hidden"),i())}))}},{key:"zoomTo",value:function(e,t){return this.zoomBy(e-this.hourHeight,t,!0)}},{key:"zoomToFit",value:(o=f(L().mark((function e(t){var n,r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).eventStore.getEvents({startDate:n.startDate,endDate:n.endDate,filter:function(e){return!e.isInterDay}}),i=r.reduce((function(e,t){var n=Pl.getTimeOfDay(Pl.floor(t.startDate,"0.5h"),"h"),r=Pl.getTimeOfDay(Pl.ceil(t.endDate,"0.5h"),"h");return[n<e[0]?n:e[0],r>e[1]?r:e[1]]}),[24,0]),a=_(i,2),o=a[0],l=a[1],e.next=3,n.zoomTo(Math.floor(n.scrollable.clientHeight/(l-o)));case 3:return e.next=5,n.scrollTo(o,t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createCellMap",value:function(){var e=this.showAllDayHeader;return B(t,"createCellMap",this,3)([{dayTime:this.dayTime,startOnly:e,allowPartial:!e,skipPropagate:!0,rawEvents:!0,filter:this.cellMapEventFilter}])}},{key:"cellMapEventFilter",value:function(e){var t=this.dayTime,n=this.hiddenNonWorkingDays;return(!this.showAllDayHeader||t.isIntraDay(e)&&!e.allDay)&&t.intersects(e)&&!n[t.dayOfWeek(e.startDate)]}},{key:"getDayLength",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:"ms";return this.dayTime.duration(e)}},{key:"changeIncrement",value:function(e){return"string"==typeof e?(e=Pl.parseDuration(e),Pl.as("ms",e.magnitude,e.unit)):e}},{key:"dayStartHour",get:function(){return null==this.dayStartTime?0:Math.floor(this.dayStartTime/XA)}},{key:"dayEndHour",get:function(){return null==this.dayEndTime?24:Math.ceil(this.dayEndTime/XA)}},{key:"dayStartMs",get:function(){return null==this.dayStartTime?0:this.dayStartTime}},{key:"dayEndMs",get:function(){return null==this.dayEndTime?24*XA:this.dayEndTime}},{key:"dayStartOffset",get:function(){return this.dayTime.startTimeOffsetMs/XA*this.hourHeight}},{key:"changeEventFilter",value:function(e){var t=this;return e===i&&(e=function(e){return!t.isAllDayEvent(e)}),e}},{key:"changeEventLayout",value:function(e,t){return $A.reconfigure(t,e,{owner:this,defaults:{owner:this}})}},{key:"updateHideEmptyDays",value:function(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.hideEmptyDays=e)}},{key:"updateDateFilter",value:function(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.dateFilter=e)}},{key:"updateNonWorkingDays",value:function(e){var n,r,i=this;(null===(n=B(t,"updateNonWorkingDays",this,3))||void 0===n||n([e]),i._allDayEvents&&(i._allDayEvents.nonWorkingDays=e),i.isConfiguring)||(null===(r=i._cellMap)||void 0===r||r.clear(),i.refresh())}},{key:"updateMaxAllDayHeight",value:function(e){this.alldayRowElement&&li.setLength(this.alldayRowElement,"max-height",e)}},{key:"hideNonWorkingDays",get:function(){return(!0!==this._hideNonWorkingDays||1!==this.duration)&&this._hideNonWorkingDays},set:function(e){V(t,"hideNonWorkingDays",e,this,1,1)}},{key:"updateHideNonWorkingDays",value:function(e){var n,r=this,i=r._allDayEvents;(B(t,"updateHideNonWorkingDays",this,3)([e]),i&&(i.hideNonWorkingDays=!(1===r.duration&&!i.fullWeek)&&r._hideNonWorkingDays),r.isConfiguring)||(null===(n=r._cellMap)||void 0===n||n.clear(),r.refresh())}},{key:"updateSyncCalendarDate",value:function(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.syncCalendarDate=e)}},{key:"syncHours",value:function(){var e,t=this;null===(e=t._cellMap)||void 0===e||e.clear(),fa.sync({targetElement:t.timeAxisElement,domConfig:{onlyChildren:!0,children:t.getTimeElementConfigs()}}),t.updateElementLayout.now(),t.refresh()}},{key:"syncCurrentTimeIndicators",value:function(){var e,t=this,n=(null===(e=t.calendar)||void 0===e?void 0:e.dateTimeNow)||new Date,r=t.showCurrentTime,i=t.dayTime,a=t.currentTimeIndicatorRenderer,o=t.element.style,l=null!=r&&r.showTime?Pl.round(n,{unit:"minute",magnitude:1}):n;if(i.contains(n)?(o.setProperty("--current-time",'"'.concat(Pl.format(l,t.timeAxisTimeFormat),'"')),o.setProperty("--current-time-seconds",i.delta(l,"second"))):(o.setProperty("--current-time",""),o.setProperty("--current-time-seconds","")),r&&Pl.betweenLesser(n,t.startDate,t.endDate)&&i.contains(n)){var s,u=t.currentTimeElement,c=t.timeAxisElement;if(r.showTime?u.parentNode!==c&&(null==c||c.insertBefore(u,c.firstChild)):u.remove(),a)null===(s=t.getDayElement(n))||void 0===s||s.appendChild(t.currentTimeIndicator)}else{var d,h;null===(d=t._currentTimeIndicator)||void 0===d||d.remove(),null===(h=t._currentTimeElement)||void 0===h||h.remove()}}},{key:"updateShowCurrentTime",value:function(e){var t=this.dayContentElement;t.classList.toggle("b-custom-current-time",Boolean(this.currentTimeIndicatorRenderer)),t.classList.toggle("b-hide-current-time",!Boolean(e)),t.classList.toggle("b-show-current-time",Boolean(null==e?void 0:e.showTime)),t.classList.toggle("b-show-time-full-width",Boolean(null==e?void 0:e.fullWidth)),t.classList.toggle("b-show-time-on-top",Boolean(null==e?void 0:e.onTop)),this.isConfiguring||this.syncCurrentTimeIndicators()}},{key:"currentTimeIndicator",get:function(){var e=this._currentTimeIndicator||(this._currentTimeIndicator=li.createElement(this.callback(this.currentTimeIndicatorRenderer,this)));return e.style.top="var(--current-time-position)",e}},{key:"currentTimeElement",get:function(){return this._currentTimeElement||(this._currentTimeElement=li.createElement({retainElement:!0,className:"b-time-axis-current-time",children:[{className:"b-current-time-text"}]}))}},{key:"eachHour",value:function(e){var t=this.dayTime,n=t.startHour,r=t.duration("h");e=this.resolveCallback(e);for(var i=new Date(2e3,5,15,n,0,0),a=0;a<r;a++)e.handler.call(e.thisObj,i.getHours(),new Date(i),a),i.setHours(i.getHours()+1)}},{key:"getTimeElementConfigs",value:function(){var e=this,t=e.dayTime.startHour,n=[];return e.eachHour((function(r,i,a){var o=e.createLeafTicks(i);!a&&e.showDayStartHour&&o.unshift({className:"b-dayview-timeaxis-tick b-dayview-hour-tick b-dayview-start-hour",text:Pl.format(new Date(2e3,5,15,t,0,0),e.timeAxisTimeFormat)}),i.setHours(r=i.getHours()+1),i.setMinutes(0),n.push({className:"b-dayview-timeaxis-time b-dayview-timeaxis-time-".concat(r<10?"0":"").concat(r),children:o.concat([{className:"b-dayview-timeaxis-tick b-dayview-hour-tick",text:Pl.format(i,e.timeAxisTimeFormat)}])})})),e.coreHours&&e._simpleCoreHours&&n.unshift({className:"b-dayview-timeaxis-background",style:{backgroundImage:e.getCoreHoursGradient(e.coreHours)}}),n}},{key:"createLeafTicks",value:function(e){return this[this.sixMinuteTicks?"createSixMinuteTicks":"createFiveMinuteTicks"](e)}},{key:"createFiveMinuteTicks",value:function(e){for(var t=[],n=1;n<12;n++)e.setMinutes(5*n),t.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-4":1,"b-dayview-tick-level-3":!(1&n),"b-dayview-tick-level-2":!(n%3),"b-dayview-tick-level-1":6===n},text:Pl.format(e,this.timeAxisTimeFormat)});return t}},{key:"createSixMinuteTicks",value:function(e){for(var t=[],n=1;n<10;n++)e.setMinutes(6*n),t.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-3":1,"b-dayview-tick-level-2":!(1&n),"b-dayview-tick-level-1":5===n},text:Pl.format(e,this.timeAxisTimeFormat)});return t}},{key:"changeCoreHours",value:function(e){var t=this;return t._simpleCoreHours=Be.isObject(e)||Array.isArray(e)&&7!==e.length,t._simpleCoreHours&&((e=Be.clone(e))._overlayDay=e.overlayDay,Object.defineProperty(e,"overlayDay",{set:function(e){this._overlayDay=e,t.updateCoreHours()},get:function(e){return this._overlayDay}})),e}},{key:"updateCoreHours",value:function(){this.isConfiguring||this.syncHours()}},{key:"changeScrollable",value:function(){this.refreshDayBackground();var e=B(t,"changeScrollable",this,3)(arguments);return this.configuredOverflowY=null==e?void 0:e.overflowY,e}},{key:"changeShowTime",value:function(e){return!0===e?{startTime:!0,endTime:!1}:e}},{key:"updateShowTime",value:function(){this.isConfiguring||this.refresh()}},{key:"changeStartDate",value:function(){return this.dayOfDate(B(t,"changeStartDate",this,3)(arguments))}},{key:"updateRange",value:function(e){!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.range=e),B(t,"updateRange",this,3)(arguments)}},{key:"updateShiftIncrement",value:function(e){var n;!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.shiftIncrement=e),null===(n=B(t,"updateShiftIncrement",this,3))||void 0===n||n(arguments)}},{key:"updateStartDate",value:function(e){var n=this._allDayEvents;if(n){var r=!this.range&&this.peekConfig("endDate"),i={startDate:e};r&&(i.endDate=r),null==n||n.setConfig(i)}B(t,"updateStartDate",this,3)(arguments)}},{key:"changeEndDate",value:function(){return this.dayOfDate(B(t,"changeEndDate",this,3)(arguments))}},{key:"updateEndDate",value:function(e){var n,r;(null===(n=B(t,"updateEndDate",this,3))||void 0===n||n(arguments),this.updatingRange)||(null===(r=this._allDayEvents)||void 0===r||r.setConfig({date:this.date,endDate:e}))}},{key:"changeMinDayWidth",value:function(e){return"number"==typeof e?Math.max(e,50):"string"==typeof e?e:null}},{key:"updateMinDayWidth",value:function(e){this.element.style.setProperty("--min-day-width",e?li.setLength(e):null),this._allDayEvents&&(this._allDayEvents.minDayWidth=e),this.updateElementLayout()}},{key:"updateMinHourHeight",value:function(e){this.hourHeight=Math.max(this.hourHeight,e)}},{key:"changeHourHeight",value:function(e){if(e)return Math.max(e,this.minHourHeight)}},{key:"updateHourHeight",value:function(e){this.isConfiguring&&(this.milestoneHeight=Math.max(Math.min(e/2,this.shortEventHeight),22)),this.milestoneDuration=36e5/(e/this.milestoneHeight),this.shortEventDuration=36e5/(e/this.shortEventHeight),this.isConfiguring||(this.updateElementLayout(),this.fitHours&&this.refresh())}},{key:"updateShortEventHeight",value:function(e){this.updateHourHeight(this.hourHeight)}},{key:"updateMinEventHeight",value:function(e){this.contentElement.style.setProperty("--dayview-min-event-height",li.setLength(e))}},{key:"hourHeight",get:function(){return!this.isConfiguring&&this.fitHours?Math.max(this.dayContentClientHeight/this.getDayLength("hour"),this.minHourHeight):this._hourHeight}},{key:"changeFitHours",value:function(e){var t=this;return e?t.configuredMinHourHeight=t.minHourHeight:t.configuredMinHourHeight&&(t.minHourHeight=t.configuredMinHourHeight),e}},{key:"dayContentClientHeight",get:function(){return li.floorPx(pt.client(this.dayContentElement).height)}},{key:"updateFitHours",value:function(e){var t=this;e&&(e.minHeight?t.minHourHeight=Math.max(e.minHeight,9):t.minHourHeight=17),t.isConfiguring||e&&(t.hourHeight=Math.max(t.dayContentClientHeight/t.getDayLength("hour"),t.minHourHeight)),t.element.classList.toggle("b-fit-hours",Boolean(e)),t.monitorResize=li.scrollBarWidth||e}},{key:"updateEventSpacing",value:function(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}},{key:"onInternalPaint",value:function(e){var n,r=e.firstPaint,i=this,a=i.dayContainerElement,o=i.horizontalScrollerElement,l=li.scrollBarWidth;if(null===(n=B(t,"onInternalPaint",this,3))||void 0===n||n(arguments),r){var s=i.allDayEvents;i.horizontalScroller=new Oa({widget:i,element:a,overflowX:!l||"hidden-scroll",overflowY:"clip",propagateSync:!0,internalListeners:{overflowChange:"updateElementLayout",thisObj:i}}),i.dayHeaderScroller=new Oa({_id:"".concat(i.id,"-dayheader-scroller"),widget:i,element:i.dayHeaderScrollerElement,overflowX:!l||"hidden-scroll",overflowY:"clip",propagateSync:!0}),i.horizontalScroller.addPartner(i.dayHeaderScroller),s&&(s.element.classList.remove("b-dayview-initializing"),i.horizontalScroller.addPartner(s.headerScroller)),ya.addResizeListener(i.dayContainerElement,i.onDayContainerResize.bind(i)),i.scrollbarScroller=new Oa({_id:"".concat(i.id,"-scrollbar-scroller"),widget:i,element:o.firstChild,scrollWidth:a.scrollWidth-l,overflowX:!0,overflowY:!1}),i.horizontalScroller.addPartner(i.scrollbarScroller),i.updateElementLayout.now(),i.setInterval(i.syncCurrentTimeIndicators.bind(i),15e3,"syncCurrentTimeIndicators"),s&&(fr.on({click:{element:i.cornerElement,handler:"onCornerClick"},mousemove:{element:i.allDayEvents.element.nextSibling,handler:QA,capture:!0},thisObj:i}),i.scrollable.ion({overflowChange:"syncScrollbarPadding",thisObj:i}))}}},{key:"afterInternalPaint",value:function(e){var n,r=e.firstPaint;null===(n=B(t,"afterInternalPaint",this,3))||void 0===n||n(arguments),r&&this.refresh()}},{key:"scrollToVisibleStartTime",value:function(){var e=!(arguments.length>0&&arguments[0]!==i)||arguments[0];if(null!=this.visibleStartTime){var t=this,n=t.scrollable,r=t.allDayEvents,a=t.eventStore,o=t.getPositionFromTime(t.visibleStartTime),l=function(){var e=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=n.scrollTo)||void 0===t||t.call(n,null,o,{animate:!1,block:"start"});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();o&&(o>n.maxY&&r&&!1!==t.showAllDayHeader?e&&!a.storage.generation?a.ion({refresh:function(){return t.scrollToVisibleStartTime(!1)},once:!0,expires:{delay:2e3,alt:l}}):t.scrollToStartTimer=t.allDayEvents.ion({heightChange:l,once:!0,expires:{delay:500,alt:l}}):l())}}},{key:"relayAllDayEvents",value:function(e){if(!JA[e.type])return this.trigger(e.eventName,e)}},{key:"onCornerClick",value:(r=f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.allDayEvents).isAnimating){e.next=5;break}return e.next=4,t.toggleExpandCollapse();case 4:this.isDestroyed||(this.allDayToggleIcon.setAttribute("aria-label",t.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}")),this.allDayToggleIcon.setAttribute("aria-expanded",t.expanded));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"syncScrollbarPadding",value:function(){if(!this.configuredHiddenVerticalScroll&&this.allDayEvents)if(li.scrollBarWidth){if(!this.allDayEvents.isAnimating){var e=this.allDayEvents,t=this.alldayRowElement,n=this.dayHeaderElement,r=this.scrollable,i=this.fitHours&&r.clientHeight/this.getDayLength("hour")>=this.minHourHeight,a=!i&&r.hasOverflow(),o=e.headerElement,l=e.scrollable,s=e.expanded||e.autoHeight,u=Boolean(s&&l.hasOverflow());n.classList[a||u?"add":"remove"]("b-show-yscroll-padding"),a&&u?(o.classList.add("b-show-yscroll-padding"),t.classList.remove("b-show-yscroll-padding"),r.overflowY=l.overflowY="auto"):u!==a?u?(o.classList.add("b-show-yscroll-padding"),l.overflowY="auto",r.overflowY="scroll"):(o.classList.remove("b-show-yscroll-padding"),t.classList.add("b-show-yscroll-padding"),l.overflowY="hidden",r.overflowY=!i&&"auto"):(t.classList.remove("b-show-yscroll-padding"),o.classList.remove("b-show-yscroll-padding"),r.overflowY=!i&&"auto",l.overflowY="hidden")}}else this.scrollable.overflowY=this.allDayEvents.scrollable.overflowY="auto"}},{key:"onInternalResize",value:function(e,n,r,i,a){var o,l=this._allDayEvents;(B(t,"onInternalResize",this,3)([e,n,r,i,a]),a)&&((null==l||null===(o=l.cellMap)||void 0===o?void 0:o.size)&&(null==l||l.performResizeRefresh(l.eventsPerCell,l.eventContainerTop)),r!==a&&(this.updateElementLayout(),this.syncScrollbarPadding()))}},{key:"onThemeChange",value:function(){this.updateElementLayout()}},{key:"onDayContainerResize",value:function(e){var t=(arguments.length>1&&arguments[1]!==i?arguments[1]:{}).height,n=(arguments.length>2?arguments[2]:i).height;t&&(n!==t||li.scrollBarWidth&&this.minDayWidth)&&(this.updateElementLayout(),this.fitHours&&this.updateFitHours(this.fitHours))}},{key:"updateElementLayout",value:(n=f(L().mark((function e(){var t,n,r,i,a,o,l,s,u,c,d,h,f,v,g,m,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.owner)||void 0===t||!t.isDestroyed){e.next=2;break}return e.abrupt("return");case 2:for(r=(n=this).dayHeaderContentElement,i=n.dayContainerElement,a=n.horizontalScrollerElement,o=n.dayHeaderScroller,l=n.horizontalScroller,s=n.scrollbarScroller,u=n.allDayEvents,c=i.querySelectorAll("[data-date]"),d=li.scrollBarWidth,u&&n.refreshCount&&(v=n.cornerElement.classList,u.hasOverflow?(v.add("b-has-cell-overflow"),v.toggle("b-expanded",Boolean(u.expanded))):v.remove("b-has-cell-overflow")),n.refreshDayBackground.now(),h=0,f=c.length-1;h<=f;h++)c[h].classList.toggle("b-last-cell",h===f);u&&n.syncScrollbarPadding(),d&&a.classList.toggle("b-show-yscroll-padding",n.scrollable.hasOverflow()),c.length&&(g=pt.from(c[c.length-1],i),m=li.roundPx(pt.client(i).width),(p=li.roundPx(n.rtl?m-g.left:g.right-1))>m?(a.classList.remove("b-hide-display"),o.scrollWidth=p,r.style.minWidth="".concat(p,"px"),s.scrollWidth=p,l.overflowX="hidden-scroll"):(a.classList.add("b-hide-display"),o.scrollWidth=null,r.style.minWidth="",s.scrollWidth=null,l.overflowX=!1),n.peekConfig("visibleStartTime")&&n.scrollToVisibleStartTime()),n.hasPainted&&n.trigger("layoutUpdate");case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"refreshDayBackground",value:function(){var e,t=this,n=t.contentElement,r=t.hourHeight,i=t.dayStartOffset,a=t._hourHeightLevel,o=t.hourHeightLevel,l=new Ct(n.classList),s=t.getDayLength("hour"),u=r*s,c=r/3600,d=(r-2)/2,h=(r-4)/4,f=(r-5)/5,v=(r-6)/6,g=(r-10)/10,m=(r-12)/12,p=n.style,y=Math.ceil(Pl.format(ZA,t.timeAxisTimeFormat).length/2);l.remove("b-dayview-hourheight-level-1","b-dayview-hourheight-level-2","b-dayview-hourheight-level-3","b-dayview-hourheight-level-4"),o.level&&l.add("b-dayview-hourheight-level-".concat(o.level)),l.toggle("b-six-minute-ticks",Boolean(t.sixMinuteTicks)),li.syncClassList(n,l),t.element.style.setProperty("--time-axis-width","".concat(y,"em")),p.setProperty("--day-length",s),p.setProperty("--day-height","".concat(u,"px")),p.setProperty("--hour-height","".concat(r,"px")),p.setProperty("--half-hour-height","".concat(d,"px")),p.setProperty("--fifteen-minute-height","".concat(h,"px")),p.setProperty("--twelve-minute-height","".concat(f,"px")),p.setProperty("--ten-minute-height","".concat(v,"px")),p.setProperty("--six-minute-height","".concat(g,"px")),p.setProperty("--five-minute-height","".concat(m,"px")),p.setProperty("--leaf-tick-height","".concat(t.sixMinuteTicks?g:m,"px")),p.setProperty("--second-height","".concat(c,"px")),p.setProperty("--day-start-offset","".concat(i,"px")),p.setProperty("--short-event-height","".concat(li.setLength(t.shortEventHeight||""))),null===(e=t.onRefreshDayBackground)||void 0===e||e.call(t),o.level!==(null==a?void 0:a.level)&&(t.tickRenderer&&t.doRefresh(),t.trigger("tickChange",{old:a||tI,new:o}))}},{key:"updateSixMinuteTicks",value:function(e){this.isConfiguring||this.updateElementLayout()}},{key:"changeHourHeightBreakpoints",value:function(e){return Array.isArray(e)?e:Object.values(e)}},{key:"updateHourHeightBreakpoints",value:function(){this.isConfiguring||this.updateElementLayout()}},{key:"hourHeightLevel",get:function(){for(var e=this,t=e.hourHeight,n=e.hourHeightBreakpoints,r=e.sixMinuteTicks,i=r?iI:rI,a=r?2:3;a>=0;a--)if(t>=n[a])return e._hourHeightLevel={level:a+1,step:i[a]};return e._hourHeightLevel=tI}},{key:"updateLocalization",value:function(){!this.isConfiguring&&this.allDayTextElement&&fa.sync({targetElement:this.allDayTextElement,domConfig:{text:this.L("L{EventEdit.All day}")}}),B(t,"updateLocalization",this,3)([])}}],[{key:"delayable",get:function(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0},adjustCoreHours:{type:"raf",cancelOutstanding:!0}}}},{key:"configurable",get:function(){return{role:"grid",localizableProperties:["timeFormat","timeAxisTimeFormat","noMatchingDates"],layout:"vbox",textContent:!1,scrollable:{overflowY:!0,propagateSync:!0},title:"L{Day}",eventHeight:"auto",hourHeight:42,minHourHeight:15,range:{magnitude:1,unit:"day"},fixedDuration:null,visibleStartTime:{$config:"lazy",value:7},dayStartShift:null,dayStartTime:null,dayEndTime:null,dayTime:0,increment:"15 min",timeSnapType:"round",intradayCls:null,showTime:!0,showBullet:!1,iconTarget:"header",eventLayout:{type:"fluid"},minDayWidth:null,eventColourStyleProperty:"backgroundColor",monitorResize:Boolean(li.scrollBarWidth),eventFilter:null,snapRelativeToEventStartDate:!1,timeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},timeAxisTimeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},allDayEvents:{$config:["lazy","nullify"],value:{type:"calendarrow"}},overflowPopup:null,showAllDayHeader:{value:null,$config:null,default:!0},eventSpacing:1,responsive:{small:{descriptionFormat:"MMMM YYYY"},"*":{descriptionFormat:null}},maxAllDayHeight:null,fitHours:null,dayCellRenderer:null,tickRenderer:null,coreHours:null,zoomOnMouseWheel:!0,allowZoomUnderflow:!1,hourHeightBreakpoints:[70,140,300,500],sixMinuteTicks:null,minEventHeight:"1em",shortEventHeight:32,currentTimeIndicatorRenderer:null,actionButtons:null,hideEmptyDays:null,dateFilter:null,autoRefresh:["hideEmptyDays","dateFilter"],dashedSubticks:null,columnHeaderRenderer:null,showCurrentTime:{$config:"lazy",value:{onTop:!0}},noMatchingDates:"L{noMatchingDates}",interDayResize:null,interDayDrag:null,keyMap:{"+":"zoomIn","Shift++":"zoomIn","-":"zoomOut"}}}}]);var n,r,o,l,s}(uc.mixin(vA,yA,IA,EA));S(sI,"$name","DayView"),S(sI,"type","dayview"),sI.initClass(),sI._$name="DayView";var uI=my.MILLIS_PER_HOUR,cI=new pt(0,0,0,0),dI={column:"column",vertical:"column",row:"row",horizontal:"row"},hI=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"allowDragCreate",!1),S(e,"allowDragResizee",!1),e}return R(t,e),w(t,[{key:"getPositionFromTime",value:function(e){var t;if(my.parse(e)<my.parse(this.dayStartTime)-this.dayStartShift)return 0;var n=my.parse(e)/36e5,r=null===(t=this.eventContentElement.querySelector("[data-date]"))||void 0===t?void 0:t.querySelector('[data-hour="'.concat(n,'"]'));return r?r.offsetTop+r.offsetHeight:0}},{key:"getDateFromDomEvent",value:function(e){var t=this,n=li.getEventElement(e),r=this.getDateFromElement(n);if(r&&n!==e&&t.dayContainerElement.contains(n)){var i,a,o=n.closest("[data-hour]"),l=parseInt((null===(i=o)||void 0===i?void 0:i.dataset.hour)||0);if(!o)o=z(n.querySelectorAll("[data-hour]".concat(t.hideEmptyHours?".b-has-events":""))).at(-1),l=Math.min(parseInt((null===(a=o)||void 0===a?void 0:a.dataset.hour)||-1)+1,t.dayEndHour-1);r.setHours(l)}return r}},{key:"getDateFromPosition",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=arguments.length>3?arguments[3]:i,a=this,o=a.eventContentElement,l=a.allDayEvents,s=n?cI:pt.fromScreen(o).roundPx().translate(-o.scrollLeft),u=o.scrollWidth,c=n?e:e-s.x,d=a.rtl?a.eventContentElement.offsetWidth-c:c,h=t-s.y,f=a.getDayElementFromX(e),v=f.offsetHeight,g=a.getDateFromElement(f,r)||a.date;if(l&&(d<0||u<d||h<0||v<h))return l.getDateFromPosition(e,t,r);Pl.clearTime(g,!1);var m,p,y=z(f.querySelectorAll(".b-day-agenda-hour"));for(m=y[p=0];p<y.length&&h>=m.offsetTop&&h>m.offsetTop+m.offsetHeight;m=y[p],p++);g.setHours(parseInt(m.dataset.hour));var k=(h-m.offsetTop)/m.offsetHeight;return g.setMilliseconds(g.getMilliseconds()+k*uI),Pl[a.timeSnapType](g,a.increment)}},{key:"getBaseDayDomConfig",value:function(e){var t=this,n=t.dateFilter,r=t.resource,i=t.dayTime.dateKey(e),a=t.cellMap.get(i)||t.cellMap.set(i,t.createCellData(e)).get(i),o=a.day,l=t.hiddenNonWorkingDays[o]&&1!==t.duration||t.hideEmptyDays&&!t.getEventsForDay(i).length||n&&!t.callback(n,t,[a]);if(t.getConfig("showCurrentTime"),!l){var s,u=t.nonWorkingDays||t.month.nonWorkingDays,c=[];return t.eachHour((function(e,n){n.setHours(e),c.push({className:{"b-day-agenda-hour":1,"b-has-events":0},dataset:{hour:e},children:{time:{className:{"b-day-agenda-hour-time":1},text:Pl.format(n,t.timeAxisTimeFormat)},events:{className:{"b-day-agenda-hour-events":1},children:[]}}})})),[a,{tabIndex:-1,role:"gridcell","aria-label":"".concat(Pl.format(e,"dddd Do MMMM")).concat(r?" ".concat(r.name):"",", ").concat(t.L("L{eventCount}",(null===(s=a.events)||void 0===s?void 0:s.length)||0),"."),dataset:{date:i},className:S(S(S(S(S(S({"b-dayview-day-detail":1},t.dayCellCls,1),t.nonWorkingDayCls,u[o]||!1),t.weekendCls,Pl.weekends[o]),t.todayCls,!(e-t.today)),"b-last-cell",!(e-t.lastVisibleDate)),"b-day-of-week-".concat(o),1),style:{},children:c,syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}}},{key:"getDayDomConfig",value:function(e){var t=this,n=t.getBaseDayDomConfig(e);if(n){var r=t.dayCellRenderer,i=_(n,2),a=i[0],o=i[1];return t.renderEvents(a,o),li.normalizeChildren(r?t.callback(r,t,[o,a]):o)}}},{key:"renderEvents",value:function(e,t){var n,r=D(e.events);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=t.children[i.startDate.getHours()-this.dayTime.startHour];if(a){var o=this.createEventDomConfig({date:e.date,eventRecord:i});this.insertActionButtons(o.children[0].children[0].children,i,e),a.className["b-has-events"]=1,a.children.events.children.push(o)}}}catch(e){r.e(e)}finally{r.f()}this.trigger("renderEvents",e)}},{key:"onInternalResize",value:function(e,n,r,i){B(t,"onInternalResize",this,3)(arguments),n!==i&&this.syncHourHeights&&this.syncHeights()}},{key:"changeShowCurrentTime",value:function(){return!1}},{key:"onDayContentMousewheel",value:function(){}},{key:"zoomBy",value:function(){}},{key:"zoomTo",value:function(){}},{key:"zoomToFit",value:(n=f(L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"dayStartOffset",get:function(){return 0}},{key:"changeEventLayout",value:function(){}},{key:"syncCurrentTimeIndicators",value:function(){}},{key:"updateEventSpacing",value:function(e){this.element.style.setProperty("--event-spacing",li.setLength(e)),this.refreshDayBackground()}},{key:"updateMinEventWidth",value:function(e){this.element.style.setProperty("--min-event-width",li.setLength(e)),this.refreshDayBackground()}},{key:"updateHourSpacing",value:function(e){this.element.style.setProperty("--hour-event-padding-top",li.setLength(e)),this.refreshDayBackground()}},{key:"updateGutterWidth",value:function(e){this.element.style.setProperty("--gutter-width",li.setLength(e)),this.refreshDayBackground()}},{key:"updateHideEmptyHours",value:function(e){this.element.classList.toggle("b-hide-empty-hours",Boolean(e)),this.refreshDayBackground()}},{key:"updateHideTimeAxis",value:function(e){this.element.classList.toggle("b-hide-timeaxis",Boolean(e)),this.refreshDayBackground()}},{key:"updateHideBorders",value:function(e){this.element.classList.toggle("b-hide-borders",Boolean(e)),this.refreshDayBackground()}},{key:"updateBorderColor",value:function(e){this.element.style.setProperty("--hour-border-color",e)}},{key:"changeEventFlowDirection",value:function(e){return dI[e]}},{key:"updateEventFlowDirection",value:function(e){this.element.style.setProperty("--event-flow-direction",e),this.element.classList.toggle("b-event-flow-row","row"===e),this.refreshDayBackground()}},{key:"updateSyncHourHeights",value:function(e){this.element.classList.toggle("b-synced-hour-heights",Boolean(e)),this.refresh()}},{key:"updateOverHour",value:function(e,t){var n,r;t&&(null===(n=this.getHourElement(t))||void 0===n||n.classList.toggle("b-hover-hour",!1)),e&&(null===(r=this.getHourElement(e))||void 0===r||r.classList.toggle("b-hover-hour",!0))}},{key:"getHourElement",value:function(e){var t;return null===(t=this.getDayElement(e))||void 0===t?void 0:t.querySelector('[data-hour="'.concat(e.getHours(),'"]'))}},{key:"onDayCellConfigGenerated",value:function(e){if(this.syncHourHeights){var t=this.timeAxisElement;this.eachHour((function(n,r,i){var a=e.some((function(e){return e.children[i].className["b-has-events"]})),o=t.querySelector('[data-hour="'.concat(n,'"]'));e.forEach((function(e){return e.children[i].className["b-has-events"]=a})),o.classList.toggle("b-has-events",a)}))}}},{key:"onRefreshDayBackground",value:function(){var e;null===(e=B(t,"onRefreshDayBackground",this,3))||void 0===e||e([]),this.whenVisible("syncHeights")}},{key:"syncHeights",value:function(){var e=this,t=e.timeAxisElement,n=e.dayContainerElement,r=e.syncHourHeights;e.contentElement.style.setProperty("--hour-height",e.hideEmptyHours&&e.hideBorders?"auto":"".concat(e.hourHeight,"px")),n.querySelectorAll(".b-day-agenda-hour").forEach((function(e){return e.style.minHeight=""})),e.eachHour((function(e){var i=z(n.querySelectorAll('.b-day-agenda-hour[data-hour="'.concat(e,'"]'))),a=r?"".concat(Math.max.apply(Math,z(i.map((function(e){return e.offsetHeight})))),"px"):"",o=t.querySelector('[data-hour="'.concat(e,'"]'));i.forEach((function(e){e.style.minHeight=a})),o.style.minHeight=a}))}},{key:"getTimeElementConfigs",value:function(){var e=this,t=[];return this.eachHour((function(n,r){t.push({className:{"b-day-agenda-hour":1},dataset:{hour:n},children:[{className:"b-day-agenda-hour-time",text:Pl.format(r,e.timeAxisTimeFormat)}]})})),t}}],[{key:"delayable",get:function(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0},scrollToVisibleStartTime:{type:"raf",cancelOutstanding:!0}}}}]);var n}(sI);S(hI,"$name","DayAgendaView"),S(hI,"type","dayagenda"),S(hI,"configurable",{shortEventCls:"",increment:"1 h",showCurrentTime:!1,hourHeight:55,showTime:{startTime:!0,endTime:!0},hourSpacing:"0.5em",hideEmptyHours:null,hideTimeAxis:null,borderColor:null,hideBorders:null,title:"L{dayAgenda}",timeSnapType:"floor",gutterWidth:10,eventFlowDirection:null,eventSpacing:5,syncHourHeights:null,minEventWidth:null,overHour:null}),hI.initClass(),hI._$name="DayAgendaView";var fI=/^(\d+)ev$/,vI={shrinkwrap:1,expand:1},gI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onCalendarKeyDown",value:function(e){var n,r,i,a=this,o=a.dayTime,l=a.eventContentElement,s=e.target,u=".".concat(this.dayCellCls),c=s.closest(u)||s,d=c.matches(u),h=d?"date":"header-date",f=c.dataset[d?"date":"headerDate"],v=o.parseKey(f);switch(e.key){case"ArrowUp":e.preventDefault(),r=-7;break;case"ArrowDown":e.preventDefault(),r=7;break;case"ArrowLeft":e.preventDefault(),r=-1;break;case"ArrowRight":e.preventDefault(),r=1;break;default:return B(t,"onCalendarKeyDown",this,3)([e])}for(var g=Pl.add(v,r,"d"),m=r>0?a.nextSibling:a.previousSibling;a.hiddenNonWorkingDays[g.getDay()];)g.setDate(g.getDate()+Math.sign(r));if(!(i=l.querySelector("".concat(u,"[data-").concat(h,'="').concat(o.dateKey(g),'"]')))&&m){var p=r>0?a.firstVisibleDate:a.lastVisibleDate;i=m.eventContentElement.querySelector("".concat(u,"[data-").concat(h,'="').concat(o.dateKey(p),'"]'))}null===(n=i)||void 0===n||n.focus()}},{key:"eventContainerHeight",get:function(){var e=this,n=e.weeksElement.classList;return null==e._eventContainerHeight&&e.isVisible&&!e.isConfiguring&&(n.add("b-measuring-container-height"),e._eventContainerHeight=B(t,"eventContainerHeight",this,1),n.remove("b-measuring-container-height")),e._eventContainerHeight}},{key:"onCalendarStoreChange",value:function(){B(t,"onCalendarStoreChange",this,3)(arguments),this.syncShrinkwrappedRows()}},{key:"onDateChange",value:function(e){if(e.changes.m){var t=this,n=t.autoRowHeight;n&&t.weekElements.forEach((function(e){return e.classList.add("b-shrinkwrapped")})),t.persistShrinkWrappedRows||n?t.syncShrinkwrappedRows():t.shrinkwrappedRows.forEach((function(e){return t.flexWeekRow(e)}))}}},{key:"onCellOverflowGesture",value:function(e){var n=e.date;vI[this.overflowClickAction.toLowerCase()]?this.shrinkwrapWeekRow(n):B(t,"onCellOverflowGesture",this,3)(arguments)}},{key:"addCellHeaderContent",value:function(e,t){var n={className:{"b-day-name":!0},role:"button"};return e.children=[t.visibleColumnIndex||this.showWeekColumn?null:{tabIndex:0,role:"link","aria-label":this.L("L{Calendar.weekOfYear}",t.week),className:"b-week-num",text:t.week[1]},n],n}},{key:"shrinkwrappedRows",get:function(){return this.weeksElement.querySelectorAll(".b-shrinkwrapped")}},{key:"shrinkwrapRowHeights",get:function(){var e=this,t=[],n=e.cellMap;return e.month.eachWeek((function(e,r){for(var i=_(r,1)[0],a=0,o=0;o<7;o++,i.setDate(i.getDate()+1)){var l=n.get(Pl.makeKey(i));l&&(a=Math.max(a,l.renderedEvents.length))}t.push(a)})),t.map((function(t){return e.eventHeightInPixels*t+e.eventSpacing*(t+1)+Math.ceil(e._eventContainerTop)}))}},{key:"getEventsPerCell",value:function(e){var t=this;if(t.hasShrinkwrappedRows){var n=Math.floor(Pl.diff(t.startDate,e,"d")/7);if(t.weekElements[n].classList.contains("b-shrinkwrapped"))return t.maxEventsPerCell;var r=t.weekElements[n].querySelector(t.visibleCellSelector).offsetHeight-t.eventContainerTop;return Math.floor((r+t.eventSpacing)/(t.eventHeightInPixels+t.eventSpacing))}return t.eventsPerCell}},{key:"getMaxEventsForWeek",value:function(e){var t=this,n=this.getWeekContext(e).row;return Math.max.apply(Math,z(Array.from(n.querySelectorAll(this.visibleCellSelector)).map((function(e){var n=t.cellMap.get(e.dataset.date);return(null==n?void 0:n.renderedEvents.length)||0}))))}},{key:"getWeekContext",value:function(e){var t,n,r,i,a=this;if("number"==typeof e)r=e,t=Pl.parseKey(null===(i=a.weekElements[e].querySelector("[data-date]"))||void 0===i?void 0:i.dataset.date);else if(1===e.nodeType){var o;t=Pl.parseKey(null===(o=e.closest(".b-calendar-row").querySelector("[data-date]"))||void 0===o?void 0:o.dataset.date),r=Math.floor(Pl.diff(a.startDate,t,"d")/7)}else{var l=(e.getDay(e)-a.weekStartDay+7)%7;t=Pl.add(Pl.clearTime(e),-l,"d"),r=Math.floor(Pl.diff(a.startDate,e,"d")/7)}if(t)for(n=new Date(t);a.hiddenNonWorkingDays[n.getDay()];)n.setDate(t.getDate()+1);return{rowIndex:r,weekStart:t,visibleWeekStart:n,row:a.weekElements[r]}}},{key:"shrinkwrapWeekRow",value:function(e){var t=!(arguments.length>1&&arguments[1]!==i)||arguments[1],n=this,r=n.getWeekContext(e),a=r.weekStart,o=r.row,l=n.maxEventsPerCell,s=n.eventContainerTop,u=o.classList.contains("b-shrinkwrapped"),c=n.getMaxEventsForWeek(e),d=l?Math.min(l,c):c,h=n.eventHeightInPixels*d+n.eventSpacing*(d+1)+Math.ceil(s),f=c>n.eventsPerCell,v=o.querySelector(".b-week-toggle-tool");if(t&&(n.scrollable={overflowY:"auto"}),o.classList.add("b-shrinkwrapped"),o.classList.contains("b-empty-row")?o.style.flex="":(v&&(v.dataset.btip=n.L("L{WeekExpander.collapseTip}")),o.classList.remove("b-has-overflow"),o.classList.toggle("b-expanded",f),o.style.flex=f?"0 0 ".concat(h,"px"):"1 0 ".concat(h,"px")),n.hasShrinkwrappedRows=!0,t&&n.refresh(),u||n.trigger("weekShrinkwrap",{weekStart:a,element:o}),t)return n.isAnimating||(n.isAnimating=!0),new Promise((function(e){fr.onTransitionEnd({element:o,property:"flex-basis",handler:"onAllWeekElementsExpanded",thisObj:n,args:[e]})}))}},{key:"onAllWeekElementsExpanded",value:function(e,t,n){this.isAnimating=!1,this.syncCalendarWeekDaysWithScrollable(),n()}},{key:"flexWeekRow",value:(a=f((function(e){var t=this,n=!(arguments.length>1&&arguments[1]!==i)||arguments[1],r=arguments.length>2&&arguments[2]!==i&&arguments[2];return L().mark((function i(){var a,o,l,s,u;return L().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=(a=t).getWeekContext(e),l=o.weekStart,s=o.row,u=s.querySelector(".b-week-toggle-tool"),!s.classList.contains("b-shrinkwrapped")){i.next=11;break}if(s.style.flex="",s.classList.add("b-flexing"),u&&(u.dataset.btip=t.L("L{WeekExpander.expandTip}")),a.trigger("weekFlex",{weekStart:l,element:s}),a._autoRowHeight=!1,!n||a.isAnimating){i.next=10;break}return i.next=10,a.executeAndAwaitAnimations(a.element,(function(){return a.isAnimating=!0}));case 10:n?a.onAllWeekElementsFlexed(s,r):a.onWeekElementFlexed(s);case 11:case"end":return i.stop()}}),i)}))()})),function(e){return a.apply(this,arguments)})},{key:"onWeekElementFlexed",value:function(e){e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded")}},{key:"onAllWeekElementsFlexed",value:function(e,t){var n=this;n.scrollable.overflowY=n.scrollable.hasOverflow("y"),t?n.shrinkwrappedRows.forEach((function(e){return e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded")})):e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),n.isAnimating=!1,n.hasShrinkwrappedRows=n.shrinkwrappedRows.length,n.refresh(),n.syncCalendarWeekDaysWithScrollable()}},{key:"syncCalendarWeekDaysWithScrollable",value:function(){var e;this.weekdaysHeader.classList[null!==(e=this.scrollable)&&void 0!==e&&e.hasScrollbar()?"add":"remove"]("b-show-yscroll-padding")}},{key:"updateHideOtherMonthCells",value:function(){B(t,"updateHideOtherMonthCells",this,3)(arguments),this.refresh()}},{key:"updateEventHeight",value:function(e,n){var r=this;if(B(t,"updateEventHeight",this,3)([e,n]),!r.isConfiguring){var i;null!==(i=r.minRowHeight)&&void 0!==i&&i.match(fI)&&r.updateMinRowHeight(r._minRowHeight),r.syncShrinkwrappedRows();var a=li.getEdgeSize(r.element,"padding","tb");r.minHeight=6*(2*(r.eventHeightInPixels+1)+3*r.eventSpacing+Math.ceil(r.eventContainerTop))+r.weekdaysHeader.offsetHeight+7+a.height}}},{key:"updateMinRowHeight",value:function(e){var n,r,i=this,a=parseInt(null===(n=e)||void 0===n||null===(r=n.match)||void 0===r||null===(r=r.call(n,fI))||void 0===r?void 0:r[1]);if(!isNaN(a)){if(i.isConfiguring)return i.ion({paint:"updateMinRowHeight",args:[e],once:!0});e=i.eventHeightInPixels*a+i.eventSpacing*(a+1)+Math.ceil(i.eventContainerTop)}B(t,"updateMinRowHeight",this,3)([e]),i.isAnimating?i.ion({animationEnd:"performResizeRefresh",thisObj:i,args:[i._eventsPerCell,i._eventContainerTop],once:!0}):i.performResizeRefresh(i._eventsPerCell,i._eventContainerTop)}},{key:"changeMaxEventsPerCell",value:function(e){return null==e?this.constructor.configurable.maxEventsPerCell:e}},{key:"updateMaxEventsPerCell",value:function(){this.isConfiguring||this.syncShrinkwrappedRows()}},{key:"updateAutoRowHeight",value:(r=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.initializingAutoRowHeight||t!==Boolean(n)){e.next=2;break}return e.abrupt("return");case 2:if(o=(a=this).visibleWeekCount,(l=null===(r=a.features||(null===(i=a.calendar)||void 0===i?void 0:i.features))||void 0===r?void 0:r.weekExpander)&&t&&(l.disabled=l.disabledByAutoRowHeight=!0),t)for(u=0;u<o;u++)s=a.shrinkwrapWeekRow(u,u===o-1);else for(c=0;c<o;c++)s=a.flexWeekRow(c,c===o-1,!0);return e.next=7,s;case 7:l&&t&&l.disabledByAutoRowHeight&&(l.disabled=l.disabledByAutoRowHeight=!1),t||(a._eventContainerHeight=a._eventsPerCell=null,a.refresh());case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"syncShrinkwrappedRows",value:function(){if(this.isVisible)for(var e=this.shrinkwrappedRows,t=0,n=Math.min(e.length,this.visibleWeekCount);t<n;t++)this.shrinkwrapWeekRow(e[t],t===n-1);else this.whenVisible("refreshNow"),this.whenVisible("syncShrinkwrappedRows")}},{key:"changeScrollable",value:function(e,n){var r;return null!==(r=e=B(t,"changeScrollable",this,3)([e,n]))&&void 0!==r&&r.overflowX&&(this.weekdaysScrollable||(this.weekdaysScrollable=new Oa({widget:this,element:this.weekdaysHeader,overflowX:"hidden-scroll"})),e.addPartner(this.weekdaysScrollable,"x")),e}},{key:"scrollTo",value:(n=f(L().mark((function e(n,r){var i,a,o,l,s,u,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(i=this).scrollable,o="string"==typeof n?Pl.parse(n):new Date(n),l=!isNaN(o),e.next=3,i.scrollPromise;case 3:if(!i.isDestroyed){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,B(t,"scrollTo",this,3)([l?o:n,{x:!1,y:!1}]);case 7:if(!l||!a){e.next=22;break}s=i.firstVisibleDate,(u=i.lastVisibleDate).setHours(23,59,59),o.setTime(Pl.clamp(o,s,u)),c=o.getDay()===(i.weekStartDay+6)%7?-1:1;case 12:if(li.isVisible(i.getDayElement(o))){e.next=20;break}if(!(o<s||o>u)){e.next=17;break}if(!((c=-c)<0)){e.next=17;break}return e.abrupt("return");case 17:o.setDate(o.getDate()+c),e.next=12;break;case 20:(n=i.getDayElement(o))&&a.scrollIntoView(n,Be.assign({},i.defaultScrollOptions,"boolean"==typeof r?{animate:r}:r));case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"collectEvents",value:function(e){var n=this;if(this.hideOtherMonthCells){var r=this.month,i=r.year,a=r.month;e.startDate=new Date(i,a,1),e.endDate=new Date(i,a+1,1)}return e.getDateIndex=function(e){return Number(e)===Number(n.firstVisibleDate||n.startDate)?"date":"startDate"},B(t,"collectEvents",this,3)([e])}},{key:"getDayElement",value:function(e,n){if("string"!=typeof e&&(e=Pl.makeKey(e)),!n||parseInt(e.substr(5,2))===this.month.month+1)return B(t,"getDayElement",this,3)([e])}},{key:"calendarHitTest",value:function(e){var n=B(t,"calendarHitTest",this,3)([e]),r=li.getEventElement(e);if(n){var i;if(n.date.getMonth()!==this.month.month&&(this.disableOtherMonthCells||this.hideOtherMonthCells))return;var a,o=r.closest(".b-calendar-week"),l=null==o||null===(i=o.dataset.week)||void 0===i?void 0:i.split(",").map(Number);if(l)n.cell=n.cell||r.closest(".b-calendar-cell"),n.dayNumber=Number(null===(a=n.cell)||void 0===a?void 0:a.dataset.columnIndex),n.week=l,n.weekElement=o,n.weekNumber=l[1],n.weekOffset=l[1]-Number(this.weeksElement.firstElementChild.dataset.week.split(",")[1])}return n}},{key:"getDateFromPosition",value:function(e,t){for(var n,r=this,i=r.weeksElement.childNodes,a=0;a<i.length;++a)if((n=i[a].getBoundingClientRect()).top<=t&&t<n.bottom&&n.left<=e&&e<n.right){var o=r.rtl?n.right-e:e-n.x,l=Math.floor(o*r.weekLength/n.width);if(r.hideNonWorkingDays)return Array.from(i[a].querySelectorAll(r.visibleCellSelector)).map((function(e){return r.getDateFromElement(e)}))[l];var s=r.getDateFromElement(i[a].querySelector(r.visibleCellSelector));return s.setDate(s.getDate()+l),s}return null}},{key:"getWeekElementFor",value:function(e){var t=li.getEventElement(e);return(null==t?void 0:t.closest(".b-calendar-week"))||null}},{key:"updateEventStore",value:function(e,n){var r;null===(r=B(t,"updateEventStore",this,3))||void 0===r||r([e,n]),Gy.prototype.doRefresh.call(this)}},{key:"updateOverflowClickAction",value:function(){this.refresh()}},{key:"updateSixWeeks",value:function(){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null,B(t,"updateSixWeeks",this,3)(arguments)}},{key:"onMonthDateChange",value:function(e){e.changes.r&&!this.sixWeeks&&(this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null),B(t,"onMonthDateChange",this,3)(arguments)}},{key:"doRefresh",value:function(){var e,n=this,r=n.weekElements;n.isConfiguring||(n.getConfig("autoRowHeight"),null===(e=n._cellMap)||void 0===e||e.clear());for(var i=B(t,"doRefresh",this,3)([]),a=0,o=r.length;a<o;a++){var l=r[a],s=Array.prototype.reduce.call(l.querySelectorAll(n.visibleCellSelector),(function(e,t){var r=n.cellMap.get(t.dataset.date);return e+((null==r?void 0:r.renderedEvents.length)||0)}),0);l.classList.toggle("b-empty-row",!s)}return n.syncCalendarWeekDaysWithScrollable(),i}},{key:"showEvent",value:function(e){this.setDate(e.startDate)}},{key:"changeDayNumberCentered",value:function(e){return Boolean(e)}},{key:"updateShowWeekColumn",value:function(e){e||this.element.querySelector(".b-week-num")||this.doRefresh(),B(t,"updateShowWeekColumn",this,3)([e])}},{key:"updateShowWeekNumber",value:function(e){this.element.classList.toggle("b-show-week-number",e)}},{key:"updateHideNonWorkingDays",value:function(e){var n;null===(n=B(t,"updateHideNonWorkingDays",this,3))||void 0===n||n([e]),this.isConfiguring||this.refresh()}},{key:"updateDayNumberCentered",value:function(e){var t=this;t._dayNumberCentered||"nonCenteredDayNumShowWeekColumn"in t||(t.nonCenteredDayNumShowWeekColumn=t.showWeekColumn),t._dayNumberCentered=e,t.element.classList[e?"add":"remove"]("day-number-center"),t.showWeekColumn=!!e||t.nonCenteredDayNumShowWeekColumn}},{key:"dayNameSelector",get:function(){return this.showWeekColumn?".b-cal-cell-header":B(t,"dayNameSelector",this,1)},set:function(e){this._dayNameSelector=e}},{key:"startDate",get:function(){return B(t,"startDate",this,1)},set:function(e){this.date=e}},{key:"next",value:function(){this.date=Pl.add(this.date||this.startDate,1,"month")}},{key:"previous",value:function(){this.date=Pl.add(this.date||this.startDate,-1,"month")}}],[{key:"configurable",get:function(){return{eventSorter:cA.interDaySorterFn,localizableProperties:["title","stepUnit"],title:"L{Month}",stepUnit:"L{monthUnit}",dragUnit:"day",localeClass:this,descriptionFormat:"MMMM YYYY",dayNumberCentered:null,showWeekNumber:!0,eventHeight:20,minHeight:485,autoRowHeight:{$config:"lazy",value:!1},persistShrinkWrappedRows:null,maxEventsPerCell:100,minRowHeight:null,overflowClickAction:"popup",alwaysRefreshOnMonthChange:!0}}}]);var n,r,a}(Gy.mixin(vA,yA,DA));S(gI,"$name","MonthView"),S(gI,"type","monthview"),S(gI,"delayable",{syncCalendarWeekDaysWithScrollable:{type:"raf",cancelOutstanding:!0},onAllWeekElementsFlexed:{type:"raf",cancelOutstanding:!0}}),gI.initClass(),gI._$name="MonthView";var mI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"calculateDuration",value:function(){return 7}},{key:"updateWeekStartDay",value:function(e,n){var r;if(null===(r=B(t,"updateWeekStartDay",this,3))||void 0===r||r([e]),!this.isConfiguring){var i=new Date(this.startDate);i.setDate(i.getDate()+e-n),this.startDate=i}}},{key:"changeMonth",value:function(){var e=B(t,"changeMonth",this,3)(arguments);return e.ion({weekChange:"onMonthWeekChange",thisObj:this}),e}},{key:"onMonthWeekChange",value:function(e){var t,n=e.source,r=e.newDate;"week"===(null===(t=this.range)||void 0===t?void 0:t.unit)&&(this.week=n.getWeekNumber(r))}},{key:"changeWeek",value:function(e,t){var n=this;if(e=Array.isArray(e)?e:[n.month.year,e],!Be.isEqual(e,t)){var r,i,a=n.minDate||(null===(r=n.calendar)||void 0===r?void 0:r.minDate),o=n.maxDate||(null===(i=n.calendar)||void 0===i?void 0:i.maxDate);if(!isNaN(a)||!isNaN(o)){var l=n.month,s=l.getWeekStart(e),u=Pl.add(s,n.duration,"d");if(!isNaN(a)&&u<=a)return l.getWeekNumber(a);if(!isNaN(o)&&s>o)return l.getWeekNumber(o)}return e}}},{key:"updateWeek",value:function(e){var t=this,n=t.month,r=t.date,i=t.dayTime;r&&Be.isEqual(n.getWeekNumber(r),e)||(t.date=i.shiftDate(n.getWeekStart(e))),t.week=n.getWeekNumber(t.date)}}],[{key:"configurable",get:function(){return{localizableProperties:["title"],title:"L{Week}",range:{magnitude:1,unit:"week"},responsive:{small:{descriptionFormat:"Wp YYYY"},large:{descriptionFormat:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"]},"*":{descriptionFormat:["MMMM YYYY","S{MMM} - E{MMM YYYY}"]}},week:null,fixedDuration:!0}}}])}(sI);S(mI,"$name","WeekView"),S(mI,"type","weekview"),mI.initClass(),mI._$name="WeekView";var pI={hover:1,mouseover:1},yI=new String,kI=function(e,t){return e+t.renderedEvents.filter((function(e){return!e.isOverflow})).length},bI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onCalendarKeyDown",value:function(e){var n,r,i,a,o,l,s,u,c,d,h,f,v,g,m,p,y=this.dayTime,k=this.eventContentElement,b=e.target,C=".".concat(this.dayCellCls,":not(.b-other-month)"),w="".concat(C,">[tabIndex]"),D=":is(.b-week-number-cell>[tabIndex],".concat(w,")"),S=b.closest(w)||b;if("Escape"===e.key)return e.preventDefault(),void(null===(p=S.closest(".b-yearview-month"))||void 0===p||null===(p=p.querySelector(".b-yearview-month-name"))||void 0===p||p.focus());if(S.matches(w)){var x=y.parseKey(S.parentNode.dataset.date);switch(e.key){case"ArrowUp":e.preventDefault(),null===(n=k.querySelector("".concat(C,'[data-date="').concat(y.dateKey(Pl.add(x,-7,"d")),'"]>[tabIndex]')))||void 0===n||n.focus();break;case"ArrowDown":e.preventDefault(),null===(r=k.querySelector("".concat(C,'[data-date="').concat(y.dateKey(Pl.add(x,7,"d")),'"]>[tabIndex]')))||void 0===r||r.focus();break;case"ArrowLeft":e.preventDefault(),null===(i=Ev.getVisitor(k,D).previous(S))||void 0===i||i.focus();break;case"ArrowRight":e.preventDefault(),null===(a=Ev.getVisitor(k,D).next(S))||void 0===a||a.focus();break;case"PageUp":e.preventDefault(),x.setMonth(x.getMonth()-1),x.setDate(Math.min(x.getDate(),Pl.getLastDateOfMonth(x))),null===(o=k.querySelector("".concat(C,'[data-date="').concat(y.dateKey(x),'"]>[tabIndex]')))||void 0===o||o.focus();break;case"PageDown":e.preventDefault(),x.setMonth(x.getMonth()+1),x.setDate(Math.min(x.getDate(),Pl.getLastDateOfMonth(x))),null===(l=k.querySelector("".concat(C,'[data-date="').concat(y.dateKey(x),'"]>[tabIndex]')))||void 0===l||l.focus();break;default:return B(t,"onCalendarKeyDown",this,3)([e])}}else if(S.matches(".b-week-number-cell > [tabIndex]")){var E,R,T=y.parseKey(S.parentNode.nextSibling.dataset.date);switch(e.key){case"ArrowUp":e.preventDefault(),E=Pl.getWeekNumber(Pl.add(T,-1,"w")),R='[data-week="'.concat(E[0],",").concat(E[1],'"]:not(.b-other-month)>.b-week-number-cell>[tabIndex]'),null===(s=S.closest(".b-yearview-month").querySelector(R)||k.querySelector(R))||void 0===s||s.focus();break;case"ArrowDown":e.preventDefault(),E=Pl.getWeekNumber(Pl.add(T,1,"w")),null===(u=k.querySelector('[data-week="'.concat(E[0],",").concat(E[1],'"]:not(.b-other-month)>.b-week-number-cell>[tabIndex]')))||void 0===u||u.focus();break;case"ArrowLeft":e.preventDefault(),null===(c=Ev.getVisitor(k,D).previous(S))||void 0===c||c.focus();break;case"ArrowRight":e.preventDefault(),null===(d=Ev.getVisitor(k,D).next(S))||void 0===d||d.focus();break;case"PageUp":e.preventDefault(),E=Pl.getWeekNumber(Pl.add(T,-6,"w")),null===(h=k.querySelector('[data-week="'.concat(E[0],",").concat(E[1],'"]>.b-week-number-cell>[tabIndex]')))||void 0===h||h.focus();break;case"PageDown":e.preventDefault(),E=Pl.getWeekNumber(Pl.add(T,6,"w")),null===(f=k.querySelector('[data-week="'.concat(E[0],",").concat(E[1],'"]>.b-week-number-cell>[tabIndex]')))||void 0===f||f.focus();break;default:return B(t,"onCalendarKeyDown",this,3)([e])}}else{if(!S.matches(".b-yearview-month-name"))return B(t,"onCalendarKeyDown",this,3)([e]);var M=y.parseKey(S.dataset.monthDate);switch(e.key){case"ArrowDown":e.preventDefault(),null===(v=S.parentElement.querySelector(D))||void 0===v||v.focus();break;case"ArrowLeft":e.preventDefault(),null===(g=k.querySelector('[data-month-date="'.concat(y.dateKey(Pl.add(M,-1,"M")),'"]')))||void 0===g||g.focus();break;case"ArrowRight":e.preventDefault(),null===(m=k.querySelector('[data-month-date="'.concat(y.dateKey(Pl.add(M,1,"M")),'"]')))||void 0===m||m.focus();break;default:return B(t,"onCalendarKeyDown",this,3)([e])}}}},{key:"createCellMap",value:function(e){var n,r=B(t,"createCellMap",this,3)([e=F({skipPropagate:!0},e)]),i=D(r.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;a.renderedEvents.setEvents(a.events)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"date",get:function(){return this._date||!this.isConfiguring&&this.firstEventDate||new Date(this.year,0,1)}},{key:"next",value:function(){this.date=new Date(this.year+1,this.date.getMonth(),this.date.getDate())}},{key:"previous",value:function(){this.date=new Date(this.year-1,this.date.getMonth(),this.date.getDate())}},{key:"firstEventDate",get:function(){var e=z(this.cellMap.values());if(e.length)return e[0].date}},{key:"lastEventDate",get:function(){var e=z(this.cellMap.values());if(e.length)return e[e.length-1].date}},{key:"onCalendarPointerInteraction",value:function(e){var n,r,i=this,a=B(t,"onCalendarPointerInteraction",this,1),o=e.target,l=e.type;if(("mousedown"===l||l.endsWith("click"))&&i.clearTimeout(i.cellOverflowTimer),"mousedown"===l&&null!==(n=i._overflowPopup)&&void 0!==n&&n.isVisible&&o.closest(".b-cal-cell-overflow")&&e.preventDefault(),"click"!==i.overflowPopupTrigger||"dblclick"!==(null===(r=i.autoCreate)||void 0===r?void 0:r.gesture)||"click"!==l||!o.closest(".".concat(i.emptyCellCls))||i.emptyCellRenderer)return a.apply(i,arguments);i.cellOverflowTimer=i.setTimeout({fn:a,delay:300,args:[e]})}},{key:"changeMonth",value:function(e,t){var n=this,r={name:"yearChangeListener",yearChange:"onMonthYearChange",thisObj:n};return n.detachListeners("yearChangeListener"),e instanceof Cy?(e.ion(r),n._year=e.year):e=new Cy({date:new Date(n.year||(new Date).getFullYear(),0,1),weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,sixWeeks:n.sixWeeks,internalListeners:r}),null==n.nonWorkingDays&&(n.nonWorkingDays=n._month.nonWorkingDays),n._year=e.year,e}},{key:"onMonthYearChange",value:function(e){var t,n=e.source,r=n.year,i=n.date,a=this;(a._year=r,a.isConfiguring)||(null===(t=a._cellMap)||void 0===t||t.clear(),a.date=i,a.refresh())}},{key:"scrollTo",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{animate:!0},n=this;if(e=n.ingestDate(e.isEventModel?e.startDate:e),Pl.betweenLesser(e,n.startDate,n.endDate)&&n.getDayElement(e,!0)){var r=n.eventContentElement.querySelector('[data-month-index="'.concat(e.getMonth(),'"]'));r&&n.scrollable.scrollIntoView(r,t)}else n.date=e}},{key:"eventsPerCell",get:function(){return 0}},{key:"startDate",get:function(){return this.month.getOtherMonth(new Date(this.year,0,1)).startDate},set:function(e){this.date=e}},{key:"endDate",get:function(){return Pl.add(this.month.getOtherMonth(new Date(this.year,11,1)).endDate,1,"day")}},{key:"updateDate",value:function(e){this.month.date=e,this.isVisible&&!this.isConfiguring&&this.scrollTo(e)}},{key:"changeYear",value:function(e){return this.isConfiguring?e:(this.month.year=e,this.month.year)}},{key:"changeShowEvents",value:function(e,t){return!0===e?"heatmap":e}},{key:"updateShowEvents",value:function(e,t){var n=this,r=n.contentElement.classList;e&&r.add("b-show-events-".concat(e)),r.remove("b-show-events-".concat(t)),n.isConfiguring||n.whenVisible((function(){n.doRefresh(),n.scrollTo(n.date)}))}},{key:"changeEventDots",value:function(e){var t=this;return new Proxy(e,{set:function(e){var n=Reflect.set.apply(Reflect,arguments);return t.updateEventDots(e),n}})}},{key:"updateEventDots",value:function(e){var t=e.marginTop,n=e.gap,r=e.size,i=e.stripe,a=this.contentElement,o=a.style,l=a.classList;o.setProperty("--event-count-margin-top","".concat(t,"px")),o.setProperty("--event-count-dot-size","".concat(r,"px")),o.setProperty("--event-count-dot-gap","".concat(n,"px")),l[i?"add":"remove"]("b-event-count-dots-striped"),this.isConfiguring||this.refresh()}},{key:"updatemaxDots",value:function(e){Ne.deprecate("calendar","7.0.0","maxDots property is deprecated in favor of eventDots"),this.eventDots.max=e,this.updateEventDots(this.eventDots)}},{key:"updateShowWeekNumber",value:function(){this.bodyElement.classList[this.showWeekColumn?"remove":"add"](this.hideWeekColumnCls)}},{key:"createCellData",value:function(e){return this.month.month=e.getMonth(),B(t,"createCellData",this,3)([e])}},{key:"doRefresh",value:function(){for(var e,t=this,n=t.bodyElement,r=t.month,i=t.dayCellCls,a=t.otherMonthCls,o=t.weekendCls,l=t.todayCls,s=t.nonWorkingDayCls,u=t.emptyCellCls,c=t.cellMap,d=t.showEvents,h=t.eventCountTip,f=[],v=(null===(e=t.calendar)||void 0===e?void 0:e.today)||new Date,g=Pl.makeKey(v),m=function(e){r.month=e;var n="".concat(r.year,"-").concat(String(r.month+101).substring(1)),v=z(c.values()).filter((function(e){return e.key.startsWith(n)})).reduce(kI,0),m=Pl.getMonthName(e),p={tabIndex:0,role:"link",className:"b-yearview-month-name",html:m,"aria-label":"".concat(m," ").concat(t.year,". ").concat(t.L("eventCount",v)),dataset:{monthDate:Pl.makeKey(new Date(t.year,e,1))}},y=[{className:"b-week-number-cell"}],k={role:"grid",className:"b-calendar-weeks",children:[]},b={role:"presentation",className:"b-yearview-month",children:[p,{"aria-hidden":!0,className:"b-calendar-week b-calendar-weekdays",children:y},k],dataset:{monthIndex:e}},C=k.children;f.push(b);var w=0;r.eachWeek((function(n,f,v,m){if(1===y.length)for(var p=0;p<7;p++)y.push({className:S({"b-yearview-weekday-cell":1},s,t.nonWorkingDays[r.canonicalDayNumbers[p]]),text:Pl.format(f[p],"d1")});var k=0===e&&0===v,b=11===e&&m,D={role:"row",className:{"b-calendar-week":1},dataset:{week:"".concat(n[0],",").concat(n[1])}},x=D.children=[{role:"gridcell",className:"b-week-number-cell"}];C.push(D);for(var E=0,R=0,T=0;T<7;T++){var M=f[T],A=M.getMonth()!==r.month,I=Pl.makeKey(M),L=M.getDay(),O=!t.isConfiguring&&c.get(I),P=null==O?void 0:O.events,_=A?0:(null==P?void 0:P.length)||0,H=_,B={role:"gridcell",style:{},className:S(S({"b-day-name":1},i,1),u,!_),dataset:{date:I,cellIndex:w,columnIndex:T}};E+=_;var V=String(M.getDate());if(Object.assign(B.className,S(S(S(S(S(S(S({},o,Pl.weekends[L]),l,I===g&&!A),s,t.nonWorkingDays[L]),a,A),"b-cal-cell-overflow",H),_F.getEventCountClass(_),H),"b-day-of-week-".concat(L),1)),t.dayCellRenderer){var N,z=t.callback(t.dayCellRenderer,t,[{cellConfig:B,date:M,events:(null==O||null===(N=O.events)||void 0===N?void 0:N.map((function(e){return e.eventRecord})))||[]}]);null!=z&&(V=z)}if(h&&!pI[t.overflowPopupTrigger]){var j=_?t.L("L{ResourceInfoColumn.eventCountText}",_):h.showNoEvents?t.L("L{noEvents}"):null;if(j){var $=pc.encodeConfig(h);B.dataset=F(F(F({},B.dataset),$),{},{btip:j})}}if("dots"===d){for(var U=t.eventDots.max,G=[],Y=0;Y<Math.min(_||0,U);Y++){var q=t.createEventDomConfig({date:M,eventRecord:P[Y].eventRecord,eventColor:U>1?null:yI,minimal:!0});G.push(q)}V=["object"===W(V)?V:{tag:"span",html:V},{className:"b-cal-minimal-event-container",children:G}]}else if("count"===d){var K=_;V=["object"===W(V)?V:{tag:"span",html:V},K?{dataset:{count:K},class:{"b-cell-events-badge":1},text:K}:null]}B.children=[S({className:"b-calendar-cell-inner"},"string"==typeof V?"html":"children",V)],A?R++:(B.children[0].role="link",B.children[0].tabIndex=-1,B.children[0]["aria-label"]="".concat(Pl.format(M,"dddd Do MMMM"),", ").concat(t.L("eventCount",_))),x.push(B),w++}7===R?x[0].text=n[1]:x[0].children=[{className:"b-calendar-cell-inner",tabIndex:-1,role:"link",text:n[1],"aria-label":"".concat(t.L("L{Calendar.weekOfYear}",n),", ").concat(t.L("eventCount",E))}],D.className["b-other-month"]=7===R||R>3&&!k&&!b?1:0}))},p=0;p<12;p++)m(p);fa.sync({targetElement:n,domConfig:{children:f}}),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}},{key:"getDayElement",value:function(e,t){if("string"!=typeof e&&(e=Pl.makeKey(e)),!t||parseInt(e.substr(0,4))===this.year)return this.contentElement.querySelector('.b-calendar-cell[data-date="'.concat(e,'"]:not(.b-other-month)'))}},{key:"getCell",value:function(){return this.getDayElement.apply(this,arguments)}},{key:"onInternalPaint",value:function(e){var t=this;e.firstPaint&&this.refresh(),this.setTimeout((function(){return t.scrollTo(t.date,{animate:!1})}),10)}}],[{key:"configurable",get:function(){return{textContent:!1,localizableProperties:["title","stepUnit"],title:"L{Year}",scrollable:{overflowY:!0},stepUnit:"L{yearUnit}",dragUnit:"day",month:!0,date:{$config:{equal:"date"},value:null},descriptionFormat:"YYYY",year:null,monitorResize:!1,showWeekColumn:!0,hideWeekColumnCls:"b-hide-week-numbers",otherMonthCls:"b-other-month",sixWeeks:!0,dayCellRenderer:null,monthSelector:".b-yearview-month-name",focusable:!1,showEvents:"heatmap",maxDots:null,eventDots:{marginTop:4,max:4,gap:3,size:5},eventCountTip:null}}}])}(uc.mixin(vA,yA,DA));S(bI,"$name","YearView"),S(bI,"type","yearview"),bI.initClass(),bI._$name="YearView";var CI=Pl.startOf(new Date),wI=Object.freeze(new a),DI={hourHeight:1,showAllDayHeader:1,dayStartTime:1,dayEndTime:1},SI=["range","shiftIncrement","allowOverlap","timeFormat","coreHours","fitHours","hourHeight","visibleStartTime","dateFormat","dayStartTime","dayEndTime","hideNonWorkingDays","nonWorkingDays","readOnly","zoomOnMouseWheel","filterEventResources","tickRenderer","project"],xI=function(e,t,n){if(t){var r,a=D(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;o in e||t[o]===i||(e[o]=t[o])}}catch(e){a.e(e)}finally{a.f()}}return e},EI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){var e;B(t,"construct",this,3)(arguments),null===(e=this.calendar)||void 0===e||null===(e=e.sidebar)||void 0===e||null===(e=e.widgetMap.resourceFilter)||void 0===e||e.ion({change:"onResourceFilterSelectionChange",thisObj:this})}},{key:"isDateRangeOwner",get:function(){return this.viewType.isDateRangeOwner}},{key:"snapDate",value:function(e){var t,n;return(null===(t=(n=this.views[0]).snapDate)||void 0===t?void 0:t.call.apply(t,[n].concat(Array.prototype.slice.call(arguments))))||e}},{key:"isAnimating",get:function(){return B(t,"isAnimating",this,1)||this.items.some((function(e){return e.isAnimating}))}},{key:"changeScrollable",value:function(e){return(e=B(t,"changeScrollable",this,3)(arguments))&&Object.defineProperty(e,"viewport",{get:this.getScrollingViewport.bind(this)}),e}},{key:"getScrollingViewport",value:function(){var e=this.dayViewTimeAxis,t=this.dayViewScroller,n=t.isVisible?t.width:0,r=pt.client(this.scrollable.element);return this.rtl?r.adjust(n,0,-e.width,0):r.adjust(e.width,0,-n,0)}},{key:"changeView",value:function(e){var t=this,n=new Proxy(Be.assign({},e),{set:function(e,n,r){var i=Reflect.set.apply(Reflect,arguments);return t.syncViewConfig(n,r),i},deleteProperty:function(e,n){var r=Reflect.deleteProperty.apply(Reflect,arguments);return t.syncViewConfig(n,null),r}});return t.viewType=bryntum.Calendar.Modes.resolveType(e.type),n}},{key:"eachView",value:function(e,t){for(var n=arguments.length>2&&arguments[2]!==i?arguments[2]:null,r=null==t,a=z(this.viewCache),o=0,l=a.length;o<l;o++){var s=a[o];if(r&&(t=[s,o]),!1===s.callback(e,n||s,t))return}}},{key:"views",get:function(){return z(this.viewCache)}},{key:"updateResourceStore",value:function(e){var n;this.detachListeners("resourceViewResourceChange"),null===(n=B(t,"updateResourceStore",this,3))||void 0===n||n([e]),e.ion({name:"resourceViewResourceChange",change:"onResourceStoreChange",sort:"onResourceStoreSort",thisObj:this}),this.refreshSoon()}},{key:"updateViewGap",value:function(e){this.element.style.setProperty("--view-gap",li.setLength(e||-1))}},{key:"onResourceStoreChange",value:function(){this.refreshSoon()}},{key:"onResourceStoreSort",value:function(e){var t=this,n=e.source,r=this.items.filter((function(e){return e.isVisible&&!e.isResourceDayViewTimeAxis})),i=n.map((function(e){return t.createViewId(e)})),a=r.map((function(e){return e.id}));Be.isEqual(i,a)||(this.remove.apply(this,z(r)),this.refreshSoon())}},{key:"onResourceFilterSelectionChange",value:function(){this.refreshSoon()}},{key:"changeViewCache",value:function(e,t){if(e)return new hs;t&&(t.forEach((function(e){return e.destroy()})),t.clear())}},{key:"getResourceView",value:function(e){return e=e.isResourceModel?e:this.resourceStore.getById(e),this.viewCache.get(this.createViewId(e))||this.createView(e)}},{key:"doRefresh",value:function(){var e,t=this,n=li.scrollBarWidth,r=t.calendar,i=t._items,a=t.resourceStore,o=null==r?void 0:r.widgetMap.resourceFilter,l=t.resourceStore.records.filter((function(e){return(!o||o.value.includes(e))&&!e.isSpecialRow})),s=l.length,u=[],c=[],d={};if(!a.count){var h=t.weekStartDay,f=Pl.getFirstDateOfMonth(t.date),v=Pl.add(f,1,"month");t.eventStore.getEvents({startDate:Pl.add(f,-(f.getDay()-h+7)%7,"d"),endDate:Pl.add(v,7-(v.getDay()-h+7)%7,"d")})}t.refreshSoon.cancel();for(var g=0,m=0;m<s;m++){var p=t.getResourceView(l[m]),y=i.includes(p);a.getById(p.resourceId)?(p.title=t.titleTemplate(p.resource),y?g++:u.push(p),d[p.id]=1):y&&c.push(p)}g<i.count&&(t.eachView((function(e){d[e.id]||c.push(e)})),t.remove(c)),t.viewType.isDayView&&(i.includes(t.dayViewTimeAxis)||u.unshift(t.dayViewTimeAxis),n&&!i.includes(t.dayViewScroller)&&u.push(t.dayViewScroller));var k=null===(e=t.items[0])||void 0===e||null===(e=e.scrollable)||void 0===e?void 0:e.y;if(t.add.apply(t,u),null!=k&&u.forEach((function(e){e.scrollable.element.scrollTop=k,e.removeListener("scrollToVisibleStartTime")})),u.length||c.length){for(var b,C=0,w=t.items,D=w.length;C<D;C++){var S,x=w[C],E=x.scrollable;x.element.classList.remove("b-last-resource-view"),x.isResourceDayViewTimeAxis||(x.element.classList[C>1?"remove":"add"]("b-first-resource-view"),b=x),E&&(E.clearPartners(),C&&x.scrollable.addPartner(w[C-1].scrollable,"y")),null===(S=x.allDayEvents)||void 0===S||S.refresh()}if(b&&b.element.classList.add("b-last-resource-view"),t.viewType.isDayView){var R=t.views.filter((function(e){return e.allDayEvents&&e.isVisible})),T=R.length&&Math.max.apply(Math,z(R.map((function(e){return e.allDayEvents.cellContentHeight}))));T&&i.forEach((function(e){var t;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(T,!1,!0)}))}}t.viewType.isDayView&&t.syncDayViewScrollerVisibility(),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}},{key:"onCalendarPointerInteraction",value:function(){}},{key:"onCalendarStoreChange",value:function(){}},{key:"onChildAdd",value:function(e){B(t,"onChildAdd",this,3)([e]),Tt.before(e,"onConfigChange","onChildViewConfigChange",this,{return:!1})}},{key:"onChildViewConfigChange",value:function(e){var t=e.name,n=e.value,r=this;2!==e.applied||r.syncingChildViewConfigs||r.syncingViewConfig||!r.timeAxisConfigs.includes(t)||(r.viewSyncConfigs||(r.viewSyncConfigs={},r.queueMicrotask("flushViewSyncConfigs")),r.viewSyncConfigs[t]=n)}},{key:"flushViewSyncConfigs",value:function(){var e,t=this,n=t.viewSyncConfigs,r=Be.copyProperties({},n,["startDate","endDate"]);delete n.startDate,delete n.endDate,Object.assign(r,n);var i=new o(t.items.concat(z(t.viewCache)));t.syncingChildViewConfigs=!0,i.forEach((function(e){return e.setConfig(r)})),t.views.length&&(t.date=null===(e=t.views[0])||void 0===e?void 0:e.date),t.syncingChildViewConfigs=t.viewSyncConfigs=!1}},{key:"createViewConfig",value:function(e){var t=this,n=e.id,r=t.viewCache,i=t.viewType,a=z(r)[0]||t,o=pe.merge({calendar:t.calendar,id:t.createViewId(e),cls:"b-resourceview-resource",defaultCalendar:n,resource:e,resourceId:n,includeTimeRanges:t.includeTimeRanges,weekStartDay:t.weekStartDay,parent:t,date:t.date,dateFormat:t.dateFormat,autoCreate:t.autoCreate,title:t.titleTemplate(e),syncCalendarDate:t.syncCalendarDate,showCurrentTime:F(F({},t.showCurrentTime),{},{showTime:!1})},t.view);return xI(o,a,t.sharedConfigs),i.isDateRangeOwner&&a._endDate&&(o.endDate=a._endDate),t.visibleStartTime&&(o.visibleStartTime=t.visibleStartTime),t.hasConfig("startDate")&&(o.startDate=t.startDate,t.timeAxisConfigs.unshift("startDate")),i.isDayView&&(null!==o.allDayEvents&&(o.allDayEvents=F(F({},o.allDayEvents),{},{fullWeek:!1,resource:e})),li.scrollBarWidth&&(o.scrollable={overflowX:!1,overflowY:"hidden-scroll"})),o}},{key:"createView",value:function(e){var t,n=this,r=n.resourceStore,i=n.viewCache,a=e.id,o=n.createViewConfig(e),l=bryntum.Calendar.Modes.create(o);return l.range||n.timeAxisConfigs.unshift("endDate"),l.ion({catchAll:"onChildViewCatchAll",thisObj:n}),l.element.removeAttribute("tabIndex"),l.element.dataset.resourceId=a,null===(t=l.contentElement)||void 0===t||t.removeAttribute("tabIndex"),Object.defineProperties(l,{weight:{get:function(){return n.stableResourceOrder?r.allIndexOf(a):0}},resource:{get:function(){return r.getById(a)}},eventFilter:{get:function(){var e=this;return function(t){return t.resources.includes(e.resource)}}}}),i.add(l),n.trigger("viewCreate",{view:l}),l}},{key:"onChildViewCatchAll",value:function(e){var t=this,n=e.type;e.resourceRecord||(e.resourceRecord=e.source.resource),"rangechange"===n?t.triggerRangeChangeTimer||(t.triggerRangeChangeTimer=t.queueMicrotask((function(){t.triggerRangeChangeTimer=null,t.trigger(e.eventName,F(F({},e),{},{source:t}))}))):"heightchange"===n?t.syncDayViewScrollerVisibility():"paint"!==n&&t.trigger(e.eventName,e)}},{key:"changeAvatarRendering",value:function(e){if(e)return yc.new({element:this.element},e)}},{key:"titleTemplate",value:function(e){var t=this,n=t.meta,r="string"==typeof n?e[n]:null==n?void 0:n(e),i=li.isNamedColor(e.eventColor)&&e.eventColor,a=!i&&e.eventColor;return{class:{"b-resourceview-title":1,"b-has-meta":r},children:[t.showAvatars&&Be.merge({class:S({},"b-sch-foreground-".concat(i),i),style:{color:a||null},reference:"resourceAvatar"},t.getResourceAvatar(e)),{class:"b-resource-name",text:e.name,reference:"resourceName"},r&&{class:"b-resource-meta",text:r,reference:"resourceMeta"}]}}},{key:"getEventElement",value:function(e){var t,n=arguments.length>1&&arguments[1]!==i?arguments[1]:e.startDate,r=arguments.length>2?arguments[2]:i;return null===(t=this.getResourceView(e.resource||r))||void 0===t?void 0:t.getEventElement(e,n)}},{key:"dayViewTimeAxis",get:function(){var e=this;if(!e._dayViewTimeAxis){var t=xI({},e,e.timeAxisConfigs);xI(t,e.view,e.timeAxisConfigs),delete t.endDate,e._dayViewTimeAxis=TI.create(F(F({},t),{},{weight:-1,project:e.project,type:"resourcedayviewtimeaxis",minWidth:0,cls:"b-resource-dayview-timeaxis",startDate:e.date,scrollable:{overflowX:!1,overflowY:"hidden-scroll"},onCornerClick:function(){var t=e.firstChild.allDayEvents.expanded,n=[],r=null;e.eachView((function(e){var n=e.allDayEvents;t?(!r||n.maxEventCount<r.maxEventCount)&&(r=n):(!r||n.maxEventCount>r.maxEventCount)&&(r=n)}));var i=r.refreshCount;r.expanded=!t,r.refreshCount===i&&n.push(r),e.items.forEach((function(e){if(e!==r){var i=e.allDayEvents,a=i.refreshCount;e.allDayEvents.expanded=!t,i.refreshCount===a&&n.push(i)}}));for(var a=0,o=n.length;a<o;a++)n[a].doRefresh()}}),e),ya.addResizeListener(e._dayViewTimeAxis.timeAxisElement,e.syncDayViewScrollerVisibility.bind(e))}return e._dayViewTimeAxis}},{key:"dayViewScroller",get:function(){var e=this;if(!e._dayViewScroller){var t=xI({},e,e.timeAxisConfigs);xI(t,e.view,e.timeAxisConfigs),delete t.endDate,e._dayViewScroller=TI.create(F(F({},t),{},{weight:999,project:e.project,type:"resourcedayviewtimeaxis",flex:"0 0 ".concat(li.scrollBarWidth,"px"),minWidth:li.scrollBarWidth,cls:"b-resource-dayview-scroller",startDate:CI,scrollable:{overflowX:!1,overflowY:"scroll"}}),e),e._dayViewScroller.scrollable.addPartner(e.dayViewTimeAxis.scrollable,"y"),e.monitorResize=!0}return e._dayViewScroller}},{key:"onElementResize",value:function(){B(t,"onElementResize",this,3)([]),li.scrollBarWidth&&this.syncDayViewScrollerVisibility()}},{key:"syncDayViewScrollerVisibility",value:function(){if(this._dayViewScroller){var e=this.dayViewTimeAxis.scrollable.hasOverflow("y");this.dayViewScroller.isVisible!==e&&this.dayViewScroller[e?"show":"hide"]()}}},{key:"scrollTo",value:(n=f(L().mark((function e(t,n){var r,i,a,o=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.views,!t.isEventModel){e.next=7;break}if(null==(a=i.find((function(e){return e.eventStore.includes(t)})))||a.scrollTo.apply(a,o),!(t=a.getEventElement(t))){e.next=7;break}return e.abrupt("return",this.scrollable.scrollIntoView(t,n));case 7:return e.abrupt("return",(r=i[0]).scrollTo.apply(r,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"createViewId",value:function(e){return"".concat(this.id,"-resource").concat(this.config.view.type,"-").concat(e.id)}},{key:"updateDate",value:function(e){var t=this,n=t._dayViewTimeAxis;t.suspendVisibility(),t.viewCache.forEach((function(t){t.date=e})),t.resumeVisibility(),t.viewType.isDayView&&(t.items.forEach((function(e){var t,n;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(null===(n=e.allDayEvents)||void 0===n?void 0:n.cellContentHeight)})),n&&(n.showCurrentTime=t.showCurrentTime,n.date=e))}},{key:"updateResourceWidth",value:function(e){this.contentElement.style.setProperty("--resource-width",li.setLength(e))}},{key:"updateShowCurrentTime",value:function(e){this.dayViewTimeAxis&&(this.dayViewTimeAxis.showCurrentTime={showTime:null==e?void 0:e.showTime}),this.isConfiguring||this.syncViewConfig("showCurrentTime",F(F({},e),{},{showTime:!1}))}},{key:"updateWeekStartDay",value:function(e,n){var r;null===(r=B(t,"updateWeekStartDay",this,3))||void 0===r||r([e]),this.isConfiguring||this.syncViewConfig("weekStartDay",e)}},{key:"updateHideNonWorkingDays",value:function(e){this.isConfiguring||this.syncViewConfig("hideNonWorkingDays",e)}},{key:"updateNonWorkingDays",value:function(e){this.isConfiguring||this.syncViewConfig("nonWorkingDays",e)}},{key:"updateIncludeTimeRanges",value:function(e){this.isConfiguring||this.syncViewConfig("includeTimeRanges",e)}},{key:"updateSyncCalendarDate",value:function(e){this.isConfiguring||this.syncViewConfig("syncCalendarDate",e)}},{key:"syncViewConfig",value:function(e,t){var n=function(n){n[e]=t};this.syncingViewConfig=!0,DI[e]?this.items.forEach(n):this.eachView(n),this.syncingViewConfig=!1}},{key:"descriptionRenderer",value:function(){var e;return(null===(e=z(this.viewCache.items)[0])||void 0===e?void 0:e.description)||"No resources"}},{key:"updateRange",value:function(e){this.isConfiguring||this.views[0]&&(this.views[0].range=e)}},{key:"startDate",get:function(){var e=this.views;return e.length?e[0].startDate:this._startDate||this.date},set:function(e){var t,n=this;if(n._startDate=n.changeDate(e),null!==(t=n.views)&&void 0!==t&&t.length){var r={startDate:e},i=n.peekConfig("endDate");i&&(r.endDate=i),n.views[0].setConfig(r)}}},{key:"date",get:function(){var e;return(null===(e=this.views[0])||void 0===e?void 0:e.date)||this._date}},{key:"changeEndDate",value:function(e){return this.changeDate(e)}},{key:"updateEndDate",value:function(e){var t;null!==(t=this.views)&&void 0!==t&&t.length&&(this.views[0].endDate=e)}},{key:"endDate",get:function(){var e,t,n=this,r=n.viewType,i=(null===(e=n.views[0])||void 0===e?void 0:e.endDate)||n._endDate||(t=n.createViewConfig({id:"dummy"})).endDate;if(!i){var a=t.range||r.$meta.config.range;i=Pl.add(n.startDate,r.prototype.parseRange(a))}return i}},{key:"fixedDuration",get:function(){var e=this.viewType;if(e.isDayView){var t=z(this.viewCache)[0];if(t)return t.fixedDuration;var n=this.createViewConfig({id:"dummy"});return!(n.range||n.endDate)}return!e.isDateRangeOwner}},{key:"shiftIncrement",get:function(){var e=z(this.viewCache)[0];return null==e?void 0:e.shiftIncrement},set:function(e){(this.view||(this.view={})).shiftIncrement=e}},{key:"stepUnit",get:function(){var e=z(this.viewCache)[0];return null==e?void 0:e.stepUnit}},{key:"firstChild",get:function(){return this.items.filter((function(e){return!e.isResourceDayViewTimeAxis}))[0]}},{key:"tickRenderer",set:function(e){(this.view||(this.view={})).tickRenderer=e}},{key:"hourHeight",get:function(){var e,t;return(null===(e=this.views)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.hourHeight)||(null===(t=this.view)||void 0===t?void 0:t.hourHeight)||sI.configurable.hourHeight},set:function(e){(this.view||(this.view={})).hourHeight=e}},{key:"previous",value:function(){var e;null===(e=z(this.viewCache)[0])||void 0===e||e.previous()}},{key:"next",value:function(){var e;null===(e=z(this.viewCache)[0])||void 0===e||e.next()}},{key:"zoomTo",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null!==(e=this.views)&&void 0!==e&&null!==(e=e[0])&&void 0!==e&&e.zoomTo&&this.eachView((function(e){e.isVisible&&e.zoomTo.apply(e,n)}))}},{key:"zoomBy",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null!==(e=this.views)&&void 0!==e&&null!==(e=e[0])&&void 0!==e&&e.zoomBy&&this.eachView((function(e){e.isVisible&&e.zoomBy.apply(e,n)}))}},{key:"getDateFromPosition",value:function(e,t){var n,r=D(this.views);try{for(r.s();!(n=r.n()).done;){var i=n.value.getDateFromPosition(e,t);if(i)return i}}catch(e){r.e(e)}finally{r.f()}}}]);var n}(uc.mixin(vA));S(EI,"$name","ResourceView"),S(EI,"type","resourceview"),S(EI,"configurable",{layout:"box",textContent:!1,scrollable:{overflowX:!0},date:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},view:{type:"weekview"},viewGap:"0.5em",stableResourceOrder:!0,resourceWidth:null,hideNonWorkingDays:null,viewCache:{$config:["lazy","nullify"],value:!0},avatarRendering:{},meta:null,showAvatars:!0,includeTimeRanges:null,responsiveRoot:!0,range:null}),S(EI,"properties",{sharedConfigs:SI,timeAxisConfigs:["allDayEvents"].concat(SI)});var RI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"hasOverflow",get:function(){return this.up("resourceview").views.some((function(e){var t;return null===(t=e.allDayEvents)||void 0===t?void 0:t.hasOverflow}))}},{key:"createCellMap",value:function(){return wI}}])}(FA);S(RI,"$name","ResourceDayViewAllDayEvents"),S(RI,"type","resourcedayviewalldayevents");var TI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){return B(t,"compose",this,3)([])}},{key:"onCalendarStoreChange",value:function(){}},{key:"doRefresh",value:function(){this.syncCurrentTimeIndicators()}},{key:"scrollToVisibleStartTime",value:function(){}},{key:"createCellMap",value:function(){return wI}},{key:"calculateCellContentHeight",value:function(){return 0}},{key:"getDateFromPosition",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i&&arguments[2],r=this,a=r.startDate,o=n?0:r.dayContentElement.getBoundingClientRect().y,l=r.timeAxisElement.offsetHeight,s=t-o;return Pl.round(Pl.add(Pl.clearTime(a),r.dayStartMs+Math.floor(s/l*r.getDayLength()),"ms"),r.increment)}}])}(sI);S(TI,"$name","ResourceDayViewTimeAxis"),S(TI,"type","resourcedayviewtimeaxis"),S(TI,"configurable",{range:"1 day",allDayEvents:{type:"resourcedayviewalldayevents",disabled:"inert"}}),RI.initClass(),TI.initClass(),EI.initClass(),EI._$name="ResourceView";var MI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"eventContentElement",get:function(){return this.bodyElement}},{key:"expandGutter",value:function(){}},{key:"viewResources",get:function(){var e,t=this.resourceStore,n=null===(e=this.calendar)||void 0===e?void 0:e.widgetMap.resourceFilter;return t.records.filter((function(e){return(!n||n.value.includes(e))&&!e.isSpecialRow}))}},{key:"onCellOverflowGesture",value:function(e){var n=e.resourceRecord,r=e.date,i=this.cellMap.get(Pl.makeKey(r)),a=i.renderedEvents;i.renderedEvents=a.filter((function(e){var t;return null===(t=e.eventRecord.resources)||void 0===t?void 0:t.includes(n)})),B(t,"onCellOverflowGesture",this,3)(arguments),i.renderedEvents=a}},{key:"getCellFromEvent",value:function(e){return e.target.closest(".b-calendar-cell[data-date] [data-resource-id]")}},{key:"createCellMap",value:function(){var e=this,n=B(t,"createCellMap",this,3)(arguments),r=this.viewResources;return this.maxEventCount=0,n.forEach((function(t){for(var n=function(n){e.maxEventCount=Math.max(e.maxEventCount,t.renderedEvents.filter((function(e){var t;return null===(t=e.eventRecord.resources)||void 0===t?void 0:t.includes(r[n])})).length)},i=0,a=r.length;i<a;i++)n(i)})),n}},{key:"getCellDomConfig",value:function(e){var n,r,a=this,o=this,l=o.viewResources,s=o.eventsPerCell,u=o.showHeaderAvatars,c=o.hideEmptyResources,d=o.resourceDateFilter,h=o.resourceHeaderRenderer,f=o.resourceHeaderExtraRenderer,v=e.renderedEvents,g=e.date,m=[],p=o.dayTime.startOfDay((null===(n=o.calendar)||void 0===n?void 0:n.dateTimeNow)||new Date),y=g.getTime()===p.getTime(),k=e.maxRow,b=e.day,C=o.nonWorkingDays||o.month.nonWorkingDays,w=c&&((null===(r=o.owner)||void 0===r?void 0:r.getEventsForDay(e.key,o.startDate))||v),D=l.reduce((function(t,n){var r;e.resource=n;var i=null==w||null===(r=w.filter)||void 0===r?void 0:r.call(w,(function(e){var t;return null===(t=e.resources)||void 0===t?void 0:t.includes(n)}));return c&&!(null!=i&&i.length)||d&&!o.callback(d,o,[e])||t.push(n),t}),[]);o.weekLength=1;for(var x=function(){var n=D[E];e.renderedEvents=v.filter((function(e){var t;return null===(t=e.eventRecord.resources)||void 0===t?void 0:t.includes(n)})),e.visibleColumnIndex=e.columnIndex=0,e.maxRow=e.renderedEvents.length>s?k:s;var r=B(t,"getCellDomConfig",a,3)([e]);r.children[1].dataset={resourceId:n.id},m.push({className:"b-resourcecalendarrow-column-resource-cell",dataset:{resourceId:n.id},children:[r.children[1],e.hasOverflow&&e.renderedEvents.length>s?r.children[2]:null]})},E=0,R=D.length;E<R;E++)x();m.length||m.push({className:"b-resourcecalendarrow-column-resource-cell"}),e&&(e.renderedEvents=v);var T={role:"gridcell",tabIndex:-1,className:{"b-dayresourcecalendarrow-column":1},style:{"--visible-resource-count":D.length},children:[{style:{"--visible-resource-count":D.length},role:"gridcell",tabIndex:-1,className:S(S(S(S({"b-dayresource-allday":1,"b-cal-cell-header":1},o.todayCls,y),o.nonWorkingDayCls,C[b]||!1),o.weekendCls,Pl.weekends[b]),"b-day-of-week-".concat(b),1),children:[{className:{"b-dayname-date":1}}].concat(z(D.length?D.map((function(t){var n;if(h||f){var r=t.events.filter((function(t){return Pl.intersectSpans(t.startDate,t.endDate,g,e.tomorrow)}));n=F(F({},e),{},{resourceDayEvents:r})}return{className:{"b-dayresourcecalendarrow-resource-header":1,"b-avatar-after":"last"===u,"b-has-info":Boolean(f)},html:h?o.callback(h,o,[t,n]):i,children:h?i:[u?o.getResourceAvatar(t):null,{className:"b-dayresourcecalendarrow-resource-name",text:o.resourceNameRenderer(t)},f?{className:"b-dayresourcecalendarrow-resource-info",html:o.callback(f,o,[t,n])}:i],dataset:{resourceId:t.id}}})):[o.dummyResourceHeader]))}].concat(m),dataset:{}};return o.addCellHeaderContent(T.children[0].children[0],e),T}},{key:"dummyResourceHeader",get:function(){return{className:{"b-dayresourcecalendarrow-resource-header":1},children:[this.showHeaderAvatars?{class:"b-resource-avatar"}:null,{className:"b-dayresourcecalendarrow-resource-name",text:" "}]}}},{key:"updateMinResourceWidth",value:function(e){var t=this.scrollable,n=this.headerScroller;this.element.style.setProperty("--cell-container-overflow",e?"visible":"hidden"),t.overflowX=n.overflowX=!!e&&"hidden-scroll"}},{key:"resourceNameRenderer",value:function(e){return e.name}},{key:"updateShowHeaderAvatars",value:function(e){e&&(this.avatarRendering||(this.avatarRendering=!0)),this.refresh()}},{key:"changeFullWeek",value:function(){}}])}(FA);S(MI,"$name","DayResourceCalendarRow"),S(MI,"type","dayresourcecalendarrow"),S(MI,"configurable",{showHeaderAvatars:!0,resourceHeaderRenderer:null,resourceHeaderExtraRenderer:null,responsive:{small:{dayNameFormat:"ddd",dayNumberCompress:!1}},autoRefresh:["hideEmptyResources","resourceDateFilter"],hideEmptyResources:null,resourceDateFilter:null}),MI.initClass(),MI._$name="DayResourceCalendarRow";var FI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeAllDayEvents",value:function(){var e=B(t,"changeAllDayEvents",this,3)(arguments);return e&&(e.hideEmptyResources=this.hideEmptyResources,e.resourceDateFilter=this.resourceDateFilter),e}},{key:"checkAutoCreateGesture",value:function(e,n,r){if(r)return B(t,"checkAutoCreateGesture",this,3)(arguments)}},{key:"onLayoutUpdate",value:function(){var e;this.syncNarrowResourceWidth(),null===(e=B(t,"onLayoutUpdate",this,3))||void 0===e||e(arguments)}},{key:"onDayContainerResize",value:function(){var e;return this.syncNarrowResourceWidth(),null===(e=B(t,"onDayContainerResize",this,3))||void 0===e?void 0:e(arguments)}},{key:"syncNarrowResourceWidth",value:function(){var e=this.element.querySelector(".b-dayresourcecalendarrow-resource-header");e&&this.allDayEvents.element.classList.toggle("b-narrow-resource-header",e.offsetWidth<100)}},{key:"updateHideResourceNameWhenNarrow",value:function(e){var t;null===(t=this.allDayEvents)||void 0===t||t.element.classList.toggle("b-hide-resource-name-when-narrow",Boolean(e))}},{key:"updateHideEmptyResources",value:function(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.hideEmptyResources=e)}},{key:"updateResourceDateFilter",value:function(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.resourceDateFilter=e)}},{key:"changeMinResourceWidth",value:function(e){return e||this.constructor.configurable.minResourceWidth}},{key:"updateMinResourceWidth",value:function(e){var t;this.element.style.setProperty("--min-resource-width",li.setLength(e)),this.updateElementLayout(),null===(t=this.allDayEvents)||void 0===t||t.updateMinResourceWidth(e)}},{key:"updateShowHeaderAvatars",value:function(e){var t=this.allDayEvents;t&&(t.resourceImagePath=this.resourceImagePath,t.showHeaderAvatars=e)}},{key:"updateWeekStartDay",value:function(e,n){var r;if(null===(r=B(t,"updateWeekStartDay",this,3))||void 0===r||r([e]),!this.isConfiguring){var i=new Date(this.startDate);"week"===this.range.unit&&(i.setDate(i.getDate()+e-n),this.startDate=i)}}},{key:"getDayDomConfig",value:function(e){var n=this,r=this,i=r.hideEmptyDays,a=r.hideEmptyResources,o=r.dateFilter,l=r.resourceDateFilter,s=r.dayTime.dateKey(e),u=e.getDay(),c=r.cellMap.get(s)||r.createCellData(e),d=(i||a)&&r.getEventsForDay(s);if(!(r.hiddenNonWorkingDays[u]&&1!==r.duration||r.hideEmptyDays&&!r.getEventsForDay(s).length||o&&!r.callback(o,r,[c]))){for(var h,f=r.dayTime.dateKey(e),v=c.events,g=[],m=r.calendar,p=r.resourceStore,y=null==m?void 0:m.widgetMap.resourceFilter,k=p.records.filter((function(e){return(!y||y.value.includes(e))&&!e.isSpecialRow})),b=function(i){var o=r.resource=c.resource=k[C],s=function(e){var t;return null===(t=e.resources)||void 0===t?void 0:t.includes(o)},u=a&&!d.filter(s).length||l&&!r.callback(l,r,[c]);r.resourceId=o.id,c.events=v.filter(s),r._hideEmptyDays=!1,u||(delete(i=B(t,"getDayDomConfig",n,3)([e])).dataset.date,i.dataset.resourceId=o.id,g.push(i)),r.resource=r.resourceId=null,h=i},C=0,w=k.length;C<w;C++)b(h);if(!g.length){c.events.length=0;var D=B(t,"getDayDomConfig",this,3)([e]);delete D.dataset.date,g.push(D)}return c.events=v,r._hideEmptyDays=i,{className:S({"b-dayresourceview-column":1},"b-day-of-week-".concat(c.day),1),dataset:{date:f},children:g}}}}])}(sI);S(FI,"$name","DayResourceView"),S(FI,"type","dayresource"),S(FI,"configurable",{minResourceWidth:"4em",showAvatars:!0,title:"L{dayResourceView}",allDayEvents:{type:"dayresourcecalendarrow"},range:"1w",showHeaderAvatars:!0,autoRefresh:["hideEmptyResources","resourceDateFilter"],hideEmptyResources:null,resourceDateFilter:null,hideResourceNameWhenNarrow:null}),FI.initClass(),FI._$name="DayResourceView";var AI=function(e){return e.isCalendarMixin||e.isScheduler},II=function(e){return function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"normalizeTarget",value:function(e){return e.eventRecord}},{key:"processEvent",value:function(e){var n=e.target;if("Enter"===e.key){if(n.closest(".b-sch-event-wrap"))return;if("link"===n.role&&n.closest(".b-overflowpopup"))return li.triggerMouseEvent(n,"click"),e}return B(t,"processEvent",this,3)(arguments)}},{key:"changeNavigator",value:function(e){var n=this;return n.getConfig("eventCls"),B(t,"changeNavigator",this,3)([n.constructor.mergeConfigs({target:n.element,itemSelector:".b-cal-cell-overflow,.b-cal-cell-no-content,".concat(n.eventSelector,":not(.b-minimal),.b-sch-event-wrap"),skipScrollIntoView:!0},e)])}},{key:"onViewRefresh",value:function(){var e,n,r=this.navigator.activeItem;if(null===(e=B(t,"onViewRefresh",this,3))||void 0===e||e(arguments),r&&(null===(n=this.activeView._overflowPopup)||void 0===n||!n.containsFocus)){var i=this.getEventRecord(r);this.navigator.updateActiveItem(i?this.getElementFromEventRecord(i):null,r)}}},{key:"onCalendarStoreChange",value:function(e){var n,r;e.action,e.records;var i=this,a=i.navigator,o=null==a?void 0:a.activeItem,l=null===(n=pt.from(o))||void 0===n?void 0:n.center,s=li.usingKeyboard;if(o&&"eventId"in o.dataset&&!i.eventStore.includes(o.dataset.eventId)){var u=i.constructor.fromElement(o,AI)||i.activeView,c=u._overflowPopup,d=u.isScheduler,h=d?u.navigator:i.navigator,f=h.next,v=li.findParent(o,li.isFocusable);if(d){var g=u.getCellElementFromDomEvent({target:o,clientY:l.y});return(f||h.previous||g).focus({preventScroll:!s})}if(f!==o.nextSibling||f.parentNode.syncIdMap){var m=f||h.previous;if(m&&v.contains(m)||(m=v),null!=c&&c.containsFocus&&!c.contentElement.contains(m)){var p=c.lastAlignSpec.target;m=h.getAdjacent(1,p.nextSibling)||h.getAdjacent(-1,p)}if(m&&i.element.contains(m)){var y=d?u.getDateFromXY([l.x,l.y],null,!1):u.getDateFromElement(m),k=m.dataset.eventId,b=i.constructor.fromElement(m).closest(AI);m.focus({preventScroll:!s}),b.ion({refresh:function(){var e;k?((m=b.getEventElement(k,y))&&(m===li.getActiveElement(m)?h.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:m},m):m.focus({preventScroll:!s})),h.updateActiveItem(m,o)):b.isCalendarRow&&null!==(e=b.parent)&&void 0!==e&&e.isDayView&&!b.cellMap.size&&b.requestAnimationFrame((function(){return b.parent.focusDate(m.dataset.date)}))},once:!0})}else i.widgetMap.viewContainer.revertFocus(!0)}else h.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:f},f)}null===(r=B(t,"onCalendarStoreChange",this,3))||void 0===r||r(arguments)}},{key:"onElementKeyDown",value:function(e){var n;e.target.closest(this.navigator.itemSelector)&&(null===(n=B(t,"onElementKeyDown",this,3))||void 0===n||n([e]))}},{key:"activeEvent",get:function(){var e=this.navigator.activeItem;if(e)return this.resolveEventRecord(e)}},{key:"widgetClass",get:function(){}}],[{key:"configurable",get:function(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,datasetIdProperty:"eventId",itemsTabbable:!0,keys:{ArrowUp:null,ArrowDown:null,Escape:null,Tab:null,"SHIFT+Tab":null}}}}}])}(kR(e||Mn))},LI=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"normalizeTarget",value:function(e){return e.eventRecord}},{key:"updateDeselectAllOnScheduleClick",value:function(e){this[e?"ion":"un"]({scheduleClick:"clearEventSelection"})}},{key:"onSelectedCollectionChange",value:function(e){var t=e.added,n=e.removed,r=this,i=r.selectedCollection,a=t||[],o=n||[];if(r.updateSelected(),!r.silent){var l=i.count>0?a.length>0&&o.length>0?"update":a.length>0?"select":"deselect":"clear";r.trigger("selectionChange",{action:l,selection:i.values,selected:a,deselected:o})}}},{key:"onCalendarStoreChange",value:function(e){var n,r,i=e.action,a=e.records;"remove"===i&&(r=this.selectedCollection).remove.apply(r,z(a));null===(n=B(t,"onCalendarStoreChange",this,3))||void 0===n||n(arguments)}},{key:"clearEventSelection",value:function(){this.selectedCollection.clear()}},{key:"selectedEvents",get:function(){return this.selectedCollection.values},set:function(e){e=$e.asArray(e),this.selectedCollection.splice(0,this.selectedCollection.count,e)}},{key:"isEventSelected",value:function(e){return this.selectedCollection.includes(e)}},{key:"select",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1];this.selectEvent(e,t)}},{key:"selectEvent",value:function(e){var t=arguments.length>1&&arguments[1]!==i&&arguments[1],n=this.selectedCollection;this.isEventSelected(e)||!1===this.isEventSelectable(e)||(t?n.add(e):n.splice(0,n.count,e))}},{key:"deselect",value:function(e){this.deselectEvent(e)}},{key:"deselectEvent",value:function(e){this.isEventSelected(e)&&this.selectedCollection.remove(e)}},{key:"selectEvents",value:function(e){var t=this;this.selectedCollection.add(e.filter((function(e){return!1!==t.isEventSelectable(e)})))}},{key:"deselectEvents",value:function(e){this.selectedCollection.remove(e)}},{key:"onEventSelectionClick",value:function(e){this.isEventSelected(e)?Wn.ctrlKeyDown&&this.deselectEvent(e):this.selectEvent(e,this.multiEventSelect&&Wn.ctrlKeyDown)}},{key:"onEventNavigate",value:function(e){var t=e.event,n=e.item;if(n){var r=this.activeView.getEventRecord(n);if(r){if(2===t.button&&this.isEventSelected(r))return;this.onEventSelectionClick(r)}else this.deselectAllOnScheduleClick&&this.clearEventSelection()}}},{key:"widgetClass",get:function(){}}])}(hR(e||Mn)),S(t,"configurable",{deselectAllOnScheduleClick:!0,eventSelectedCls:"b-selected"}),t},OI={hide:function(){this.$overflowClone.hide()},show:function(){this.$overflowClone.show()}},PI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"childItems",get:function(){var e=B(t,"childItems",this,1),n=this._button;return n&&e.push(n),e}},{key:"hideNonWorkingDays",get:function(){var e;return null===(e=this.calendar)||void 0===e?void 0:e.hideNonWorkingDays},set:function(e){var t=this.calendar;t&&(e||null!=t.hideNonWorkingDays)&&(t.hideNonWorkingDays=e)}},{key:"configure",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};this.isConstructing&&"minified"in e&&!("minifiable"in e)&&(e=Be.assign({minifiable:!1},e)),B(t,"configure",this,3)([e])}},{key:"changeIncludeWeekendsButton",value:function(e,t){var n,r=this,i=e&&(null===(n=r.calendar)||void 0===n?void 0:n.includeWeekendsButton);return i&&(e=Nu.mergeConfigs(e,i)),e&&!t?r.add(e):Nu.reconfigure(t,e,r)}},{key:"updateIncludeWeekendsButton",value:function(e){e&&(e.toggleGroup=null),this.syncFullWeek()}},{key:"changeIncludeWeekendsMenuItem",value:function(e,t){var n,r=null==this||null===(n=this.button)||void 0===n?void 0:n.menu;return e&&!t?null==r?void 0:r.add(e):np.reconfigure(t,e,r)}},{key:"updateIncludeWeekendsMenuItem",value:function(){this.syncFullWeek()}},{key:"onBeforeFirstShowModeMenu",value:function(e){for(var t,n,r=e.menu,i=this,a=i.calendar,o=a.activeView,l=0,s=Object.values(a.modes);l<s.length;l++)(t=(n=s[l]).$modeMenuItem).hidden=n.$modeSelectorItem.hidden,r.add(t),t.checked=n===o,t.onToggle="up.onToggleMenuItem";i.getConfig("includeWeekendsMenuItem"),i.syncFullWeek(),i.menuReady=!0}},{key:"addMode",value:function(e,t,n){var r=this,i=r.buttonBar,a=r.calendar,o=t[r.titleProperty]||t.displayName||t.type,l=t.activationKey||o.charAt(0).toLowerCase(),s=o.toLowerCase().indexOf(l),u=t.$modeMenuItem=np.reconfigure(t.$modeMenuItem,np.mergeConfigs({type:np,view:t,ref:"".concat(e,"ShowMenuItem"),checked:!1,closeParent:!0,toggleGroup:"".concat(r.id,"-modeSelectorMenuItem"),localizable:!1,text:[{text:o},{text:l.toUpperCase(),class:"b-menuitem-key"}],weight:0},n,t.selectorMenuItem)),c=t.$modeSelectorItem=u.$overflowClone=i.add(Nu.mergeConfigs({view:t,ref:"".concat(e,"ShowButton"),toggleGroup:"".concat(r.id,"-modeSelectorButton"),text:s<0?[o,{text:l.toUpperCase(),class:"b-button-key b-align-end"}]:[s?o.substring(0,s):null,{text:l[s?"toLowerCase":"toUpperCase"](),class:"b-button-key"},o.substring(s+1)],ariaLabel:o,localizable:!1,onBeforeToggle:"up.onBeforeToggleButton",onToggle:"up.onToggleButton",weight:0},n,t.selectorButton));t.$activateMode=function(e){var n;return a.setConfig({date:(null===(n=e.target.closest("[data-date]"))||void 0===n?void 0:n.dataset.date)||a.date,mode:t})},u.ion(OI),(r.ownedWidgets||(r.ownedWidgets={}))[u.id]=u,a.addKeyBinding(l,t.$activateMode),a.addDescendant(u),r.getConfig("includeWeekendsButton"),t.ion({thisObj:r,localized:function(){var e=t[r.titleProperty]||t.displayName||t.type,n=(t.activationKey||e.charAt(0)).toLowerCase(),i=e.toLowerCase().indexOf(n);n!==l&&(a.removeKeyBinding(l,t.$activateMode),a.addKeyBinding(n,t.$activateMode)),c.text=i<0?[{text:e},{text:n.toUpperCase(),class:"b-button-key"}]:[i?{text:e.substring(0,i)}:null,{text:n.toUpperCase(),class:"b-button-key"},{text:e.substring(i+1)}],u.text=[{text:e},{text:n.toUpperCase(),class:"b-menuitem-key"}]}})}},{key:"onBeforeToggleButton",value:function(e){if(e.pressed&&this.calendar.viewContainer.layout.isChangingCard)return!1}},{key:"onToggleButton",value:function(e){var t=e.source;e.pressed&&(this.calendar.mode=t.view)}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.buttonBar.items.forEach((function(t){e&&t.containsFocus||(t.disabled=e)}))}},{key:"onToggleMenuItem",value:function(e){var t=e.source;e.checked&&(this.calendar.mode=t.view)}},{key:"onToggleWorkingDaysButton",value:function(e){var t=e.pressed;this.hideNonWorkingDays=!t}},{key:"onToggleWorkingDaysMenu",value:function(e){var t=e.checked;this.hideNonWorkingDays=!t}},{key:"syncActiveMode",value:function(e){var t,n=this,r=n.buttonBar.items;n.button.text=e.displayName,n.includeWeekendsButton.hidden=!e.hasNonWorkingDays,n.syncFullWeek();var i,a=D(r);try{for(a.s();!(i=a.n()).done;)(t=i.value).view&&(t.pressed=t.view===e)}catch(e){a.e(e)}finally{a.f()}if(n.menuReady){var o,l=D(n.button.menu.items);try{for(l.s();!(o=l.n()).done;){var s;(null===(s=(t=o.value).view)||void 0===s?void 0:s.$modeMenuItem)===t&&(t.checked=t.view===e)}}catch(e){l.e(e)}finally{l.f()}}n[r.length>1?"show":"hide"]()}},{key:"syncFullWeek",value:function(){var e=this.calendar,t=this.hideNonWorkingDays,n=this._includeWeekendsButton,r=this._includeWeekendsMenuItem,i=!t;e.isConfiguring||(n&&(n.pressed=i),r&&(r.checked=i))}},{key:"changeButton",value:function(e,t){return Nu.reconfigure(t,e)}},{key:"updateButton",value:function(e){e&&this.add(e)}},{key:"changeButtonBar",value:function(e,t){return Qv.reconfigure(t,e)}},{key:"updateButtonBar",value:function(e){e&&this.add(e)}},{key:"changeCalendar",value:function(e){return e&&!e.isWidget&&(e=this.up(e)),e}},{key:"updateCalendar",value:function(e){this.detachListeners("cal"),this.syncFullWeek(),null==e||e.ion({name:"cal",changeHideNonWorkingDays:"syncFullWeek",thisObj:this})}}])}(Ss.mixin(Ap,Kb,rC));S(PI,"$name","ModeSelector"),S(PI,"type","calendarmodeselector"),S(PI,"configurable",{minifiable:!0,titleProperty:"title",minified:null,button:{ref:"modeSelectorButton",type:"button",icon:"b-icon-calendar-days",cls:"b-calendar-mode-button",menu:[],internalListeners:{beforeShowMenu:"up.onBeforeFirstShowModeMenu",once:!0}},buttonBar:{type:"buttongroup",ignoreParentReadOnly:!0},calendar:{value:"calendar",$config:"lazy"},includeWeekendsButton:{$config:"lazy",value:{ref:"weekendsButton",type:"button",cls:"b-calendar-fullweek-button",toggleGroup:"no",text:"L{ModeSelector.weekends}",tooltip:"L{ModeSelector.includeWeekends}",onToggle:"up.onToggleWorkingDaysButton",weight:-1}},includeWeekendsMenuItem:{$config:"lazy",value:{ref:"weekendsMenuItem",separator:!0,text:"L{ModeSelector.includeWeekends}",checked:!1,onToggle:"up.onToggleWorkingDaysMenu",weight:10}},layout:{type:"box",wrap:!1},overflowable:"none",responsive:{large:{minifiable:!0,minified:null},"*":{minifiable:!1,minified:!0}},responsiveTarget:"@calendar"}),S(PI,"fenced",{onToggleButton:!0,onToggleMenuItem:!0,syncFullWeek:!0,syncActiveMode:{all:"syncActiveMode",lock:["onToggleButton","onToggleMenuItem","syncActiveMode"]}}),PI.initClass(),PI._$name="ModeSelector";var _I=function(e){function t(e){var n;return m(this,t),(n=g(this,t,[e.client,e])).client.ion({cellOverFlowClick:"onScheduleClick",thisObj:n}),fr.on({element:n.client.element,focusmove:"onFocusMove",thisObj:n}),n}return R(t,e),w(t,[{key:"onFocusMove",value:function(e){var t=this,n=t.client,r=e._target,i=n.getDateFromDomEvent(r);if(i){var a=n.getEventRecord(r.closest("[class*=-event-wrap]"));a?t.targetTime=a.startDate:t.targetTime&&Pl.copyTimeValues(i,t.targetTime),t._cellClickedContext={date:i,domEvent:e,source:n.activeView,view:n.activeView,resourceRecord:t.client.resolveResourceRecord(r)}}else t._cellClickedContext}},{key:"populateEventMenu",value:function(e){var n=this,r=this.client;this.fixEventData(e),B(t,"populateEventMenu",this,3)([e]),r.activeView.isEventList&&!r.readOnly&&!1!==this.hasClipboardData()&&(e.items.pasteEvent={text:"L{pasteEvent}",localeClass:this,icon:"b-icon b-icon-paste",disabled:0===r.resourceStore.count||e.resourceRecord.readOnly,weight:110,onItem:function(e){var t=e.eventRecord;n.pasteEvents(t.startDate)}})}},{key:"onScheduleMenuPasteClick",value:function(e){var t=e.date,n=e.resourceRecord;e.domEvent;var r=e.feature,i=this.client,a=i.activeView,o=i.constructor.fromElement(r.menuContext.targetElement,(function(e){return e.isCalendarMixin}));a.isResourceView||a.isDayResourceView||(n=null),null!=o&&o.parent&&o.parent.allDayEvents===o&&(this._isPastingIntoAllDay=!0),this.pasteEvents(t,n)}},{key:"onEventDataGenerated",value:function(e){this.fixEventData(e),B(t,"onEventDataGenerated",this,3)([e])}},{key:"fixEventData",value:function(e){if(!e.assignmentRecord){var t,n=e.eventRecord,r=e.resourceRecord;e.assignmentRecord=null!==(t=r&&n.assignments.find((function(e){return e.eventId===n.id&&e.resourceId===r.id})))&&void 0!==t?t:n}}},{key:"copyEvents",value:function(e,n){var r;return null!==(r=e)&&void 0!==r&&r[0].isAssignmentModel&&(e=e.map((function(e){return e.event}))),B(t,"copyEvents",this,3)([e,n])}},{key:"pasteEvents",value:function(e,n){var r=this._cellClickedContext,i=this.client.activeView,a=i.isResourceView,o=i.isDayResourceView;return e&&(this.targetTime=e),e||n||!r||!a&&!o?B(t,"pasteEvents",this,3)(arguments):B(t,"pasteEvents",this,3)([r.date,r.resourceRecord])}},{key:"cloneData",value:function(e){var n,r,i=e.data,a=e.isPaste,o=B(t,"cloneData",this,3)([{data:i,isPaste:a}]);(o.assignmentRecords=i.assignmentRecords.map((function(e){var t=e.copy(),n=i.eventRecords.find((function(e){return e.id===t.eventId}));return t.event=o.eventRecords.find((function(e){return e.originalInternalId===n.internalId})),t})),null===(n=o.eventRecords)||void 0===n||n.forEach((function(e){return delete e.meta.originalResourceId})),a&&this._isPastingIntoAllDay)&&(null===(r=o.eventRecords)||void 0===r||r.forEach((function(e){return e.allDay=!0})),this._isPastingIntoAllDay=!1);return o}},{key:"refreshClient",value:function(){var e,t=this.client.activeView;this.client.refresh(),null!==(e=t._overflowPopup)&&void 0!==e&&e.isVisible&&t._overflowPopup.refresh(),t.isResourceView&&t.eachView((function(e){return e.refresh()}))}},{key:"beforeListRenderRow",value:function(e){var t=e.row,n=e.record;t.cls["b-cut-item"]=n.assignments.some((function(e){return e.meta.isCut}))}}],[{key:"pluginConfig",get:function(){var e={};for(var n in B(t,"pluginConfig",this))e[n]=z(B(t,"pluginConfig",this)[n]);return e.assign.push("beforeListRenderRow"),e}}])}(ZT);S(_I,"$name","EventCopyPaste"),S(_I,"type","eventCopyPaste"),S(_I,"configurable",{allowNoAssignments:!0}),KF.register(_I.type,_I),_I._$name="EventCopyPaste";var HI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateRecord",value:function(e){this.fixTimeFieldVisibility(e.allDay),B(t,"updateRecord",this,3)([e])}},{key:"onAllDayChange",value:function(e){var t=e.value,n=e.userAction;this.fixTimeFieldVisibility(t,n)}},{key:"fixTimeFieldVisibility",value:function(e,t){var n=e?"hide":"show",r=this.widgetMap,i=r.startDateField,a=r.startTimeField,o=r.endDateField,l=r.endTimeField;null==a||a[n](),null==l||l[n](),!e&&t&&(i&&(i.value=a.value=this.record.getData("startDate")),o&&(o.value=l.value=this.record.getData("endDate")))}},{key:"onFocusOut",value:function(){B(t,"onFocusOut",this,3)(arguments),this.owner=this.initialConfig.owner}}])}(tM);S(HI,"$name","EventEditor"),S(HI,"type","calendareventeditor"),S(HI,"configurable",{align:{monitorResize:!0}}),HI.initClass(),HI._$name="EventEditor";var BI=function(e){return e.isCalendar},VI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){B(t,"construct",this,3)([e.client,e])}},{key:"onDragCreateEnd",value:(a=f((function(e){var t=this,n=e.eventRecord,r=e.resourceRecord;return L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n._dragCreated=!0,e.next=3,t.editNewlyCreatedEvent(n,r);case 3:n._dragCreated=null;case 4:case"end":return e.stop()}}),e)}))()})),function(e){return a.apply(this,arguments)})},{key:"onEventAutoCreated",value:function(e){var t=e.eventRecord;this.editNewlyCreatedEvent(t)}},{key:"editNewlyCreatedEvent",value:function(e,t){if(!this.disabled)return e.isCreating=!0,this.editEvent(e,t,null,!1)}},{key:"doEditEvent",value:(i=f(L().mark((function e(n,r,i){var a,o,l,s,u,c,d,h,f,v,g,m,p,y,k,b,C=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(l=this).client,u=s.eventStore,c=n.startDate,d=n.endDate,!(h=s.eventSource||s.activeSubView).isScheduler){e.next=8;break}return l.client=h,e.next=6,B(t,"doEditEvent",this,3)(C);case 6:return l.client=s,e.abrupt("return");case 8:if(h.isCalendarMixin&&(null===(a=h.features)||void 0===a||null===(a=a.cellEdit)||void 0===a||!a.isEditing)){e.next=10;break}return e.abrupt("return");case 10:if(n.startDate&&n.endDate&&!Pl.intersectSpans(c,d,h.startDate,h.endDate)&&(s.date=n.startDate),h.allDayEvents&&h.isAllDayEvent(n)&&h.showAllDayHeader&&(h=h.allDayEvents),n.isOccurrence){e.next=17;break}if(u.includes(n)||(u.add(n),f=!0),!f&&!n._dragCreated){e.next=17;break}return e.next=17,h.afterRefresh({forceRefresh:!0});case 17:if(v=h._overflowPopup,g=h.getDateFromElement(i),m=null==v?void 0:v.isVisible,p=m?v.getEventElement(n):h.getEventElement(n,g),m&&(p?m=!1:p=v.getEventElement(n)),n.isCreating&&(null===(y=s.onEventCreated)||void 0===y||y.call(s,n)),!p&&h.isEventList&&(p=null===(k=h)||void 0===k||null===(k=k.rowManager)||void 0===k||null===(k=k.getRowFor(n))||void 0===k?void 0:k.element),!m){e.next=26;break}p.focus(),e.next=43;break;case 26:if(!p){e.next=36;break}if(!(!(b=li.isInView(p))||b.height<100&&p.offsetHeight>Math.ceil(b.height)||b.width<p.getBoundingClientRect().width)){e.next=33;break}return e.next=31,Oa.scrollIntoView(p,{animate:!0,focus:!0,maxHeight:100});case 31:e.next=34;break;case 33:p.focus({preventScroll:!0});case 34:e.next=43;break;case 36:if(h.isAllDayEvent(n)||c&&!h.hiddenNonWorkingDays[c.getDay()]){e.next=39;break}return l.internalShowEditor(n,null,{target:!0}),e.abrupt("return");case 39:if(!c||n.isCreating&&n._dragCreated){e.next=42;break}return e.next=42,h.scrollTo(n);case 42:p=h.getEventElement(n);case 43:if(p||i||!h.isDayCellRenderer||(p=h.getCell(n.startDate)),!l.isDestroyed){e.next=46;break}return e.abrupt("return");case 46:l.internalShowEditor(n,null,{target:p||i,allowTargetOut:h.isAnimating}),null!==(o=l.editor)&&void 0!==o&&o.lastAlignSpec&&(l.editor.lastAlignSpec.allowTargetOut=!1);case 48:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"onSaveClick",value:(r=f(L().mark((function e(){var n,r,i,a,o,l=arguments;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).eventRecord,i=r.meta.isCreating,n.isValid&&(r.isCreating=!1),e.next=4,B(t,"onSaveClick",this,3)(l);case 4:a=e.sent,i&&a&&(n.eventStore.added.add(r),n.eventStore.usesSingleAssignment||n.assignmentStore.added.add(r.assignments),null===(o=n.client.crudManager)||void 0===o||o.onCrudStoreChange());case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"internalShowEditor",value:function(){var e,n,r,i=this.client,a=this.editor,o=this.startTimeField,l=this.endTimeField,s=i.closest(BI)||i,u=null!==(e=null===(n=s.activeView)||void 0===n?void 0:n.autoCreate)&&void 0!==e?e:s.autoCreate||i.constructor.configurable.autoCreate,c=null==u?void 0:u.step,d=s.activeSubView,h=null==d?void 0:d._overflowPopup;null===(r=(i.isSchedulerBase?i.calendar:i).features.eventTooltip)||void 0===r||null===(r=r._tooltip)||void 0===r||r.hide(),a.owner=null!=h&&h.isVisible?h:d,!1!==B(t,"internalShowEditor",this,3)(arguments)?c&&(o&&!o.initialConfig.step&&(o.step=c),l&&!l.initialConfig.step&&(l.step=c)):a.owner=a.initialConfig.owner}},{key:"finalizeStmCapture",value:(n=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]);var n,r,i,a}(yM);S(VI,"$name","EventEdit"),S(VI,"type","eventEdit"),S(VI,"configurable",{editorConfig:{type:"calendareventeditor",items:{resourceField:{label:"L{Calendar}",showEventColor:!0},allDay:{type:"checkbox",cls:"b-match-label",name:"allDay",weight:250,label:"L{All day}",internalListeners:{change:"up.onAllDayChange"}}}}}),KF.register(VI.type,VI),VI._$name="EventEdit";var NI=function(e){return e.eventStore},zI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"populateEventMenu",value:function(e){var n=e.items,r=e.eventRecord,i=e.assignmentRecord;B(t,"populateEventMenu",this,3)(arguments);var a=this.client;n.duplicate={disabled:r.readOnly||(null==i?void 0:i.readOnly),hidden:a.readOnly}}},{key:"getDataFromEvent",value:function(e){var n=this.client,r=n.activeView,i=n.features.eventTooltip;if("contextmenu"!==this.triggerEvent||"contextmenu"!==(null==i?void 0:i.showOn)||!i.enabled){var a;if(r.isScheduler)this.client=r;else null===(a=e.target.closest(".b-cal-event-wrap"))||void 0===a||a.focus();var o=B(t,"getDataFromEvent",this,3)([e]);return this.client=n,o}e.preventDefault()}},{key:"changeMenu",value:function(){var e=this,n=B(t,"changeMenu",this,3)(arguments);return null==n||n.ion({beforeShow:function(t){var n=t.source,r=e.client.activeSubView,i=r._overflowPopup;n.owner=null!=i&&i.containsFocus?i:r}}),n}},{key:"changeItems",value:function(e){return(e=B(t,"changeItems",this,3)(arguments)).unassignEvent=null,e}}])}(bM);S(zI,"$name","EventMenu"),S(zI,"type","eventMenu"),S(zI,"configurable",{menu:{scrollAction:"realign"},items:{duplicate:{text:"L{EventMenu.duplicateEvent}",icon:"b-icon b-icon-copy",weight:400,onItem:function(e){var t=e.eventRecord,n=t.copy(null,{skipFieldIdentifiers:!0}),r=this.up(NI).eventStore,i=t.resources;n.name="".concat(t.name," (").concat(this.L("L{EventMenu.copy}"),")"),n.recurrence=null,null!=i&&i.length&&r.assignmentStore.assignEventToResource(n,i),r.add(n)}}},triggerEvent:null}),KF.register(zI.type,zI),zI._$name="EventMenu";var jI=function(e){return e.eventStore},WI=["activeElement","client","clientListeners","disabled","showOn","tooltip"],$I=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"isVisible",get:function(){return!0}},{key:"changeRecurrenceConfirmation",value:function(e,t){return e&&(e.rootElement=this.owner.rootElement),Lo.reconfigure(t,e,{owner:this})}},{key:"changeTooltip",value:function(e,t){var n=this,r=n.config;return e&&(e=lL.mergeConfigs({ownerFeature:n,forElement:n.client.element,id:"".concat(n.client.id,"-event-tip"),forSelector:"hover"===n.showOn&&".b-cal-event-wrap,.b-sch-event-wrap,.b-gantt-task-wrap,.b-taskboard-card",resources:n.resources,disabled:n.disabled,internalListeners:{thisObj:n,delete:"onDeleteClick",edit:"onEditClick",overTarget:"onTipPointerOver"}},e),Object.keys(r).forEach((function(t){WI[t]||!n.hasConfig(t)&&!(t in n.initialConfig)||(e[t]=r[t])}))),lL.reconfigure(t,e,n)}},{key:"render",value:function(){var e=this,t={eventsPerCellChange:"onClientEventsPerCellChange",navigate:"onClientNavigate",renderEvents:"onRenderEvents",thisObj:e};"hover"===e.showOn?e.getConfig("tooltip"):("contextmenu"===e.showOn&&(e.alignToDomEvent=!0),t["event".concat(e.showOn)]=t["task".concat(e.showOn)]="onClientTooltipGesture"),e.client.ion(t)}},{key:"owner",get:function(){var e;return null!==(e=this.client.activeView._overflowPopup)&&void 0!==e&&e.containsFocus?this.client.activeView.overflowPopup:this.client}},{key:"addListener",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null===(e=this.tooltip)||void 0===e||e.addListener.apply(e,n)}},{key:"removeListener",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];null===(e=this.tooltip)||void 0===e||e.removeListener.apply(e,n)}},{key:"onEditClick",value:function(){var e,t,n=this.client,r=this.activeClient,i=this.tooltip,a=r.overflowPopup,o=(null==r||null===(e=r.features)||void 0===e?void 0:e.eventEdit)||n.features.eventEdit,l=(null==a||null===(t=a.element)||void 0===t?void 0:t.contains(i.activeTarget))?a.targetCell:i.activeTarget;o&&!o.disabled&&(o.editEvent(this.eventRecord,null,l,!1),i.hide())}},{key:"onDeleteClick",value:function(){var e=this;this.activeClient.calendar.removeEvents([this.eventRecord],(function(){var t;return null===(t=e.tooltip)||void 0===t?void 0:t.hide()}),this.tooltip)}},{key:"onClientEventsPerCellChange",value:function(){var e,t;null===(e=this._tooltip)||void 0===e||e.requestAnimationFrame(null===(t=this._tooltip)||void 0===t?void 0:t.hide)}},{key:"onClientNavigate",value:function(e){var t,n=this._tooltip;null!=n&&n.activeTarget&&(!this.owner.owns(e.event)||e.item&&e.item!==n.activeTarget)&&!n.owns(null===(t=e.event)||void 0===t?void 0:t.relatedTarget)&&n.hide()}},{key:"onRenderEvents",value:function(e){var t=this._tooltip;null!=t&&t.activeTarget&&!this.activeClient.element.contains(this.tooltip.activeTarget)&&t.hide()}},{key:"onClientTooltipGesture",value:function(e){var t=e.domEvent,n=e.event,r=e.eventElement,i=e.eventRecord,a=e.source,o=this.tooltip;t=t||n,!1!==this.onTipPointerOver({event:t,newTarget:r,eventRecord:i,owningCalendarWidget:a})&&(r.classList.contains("b-cal-in-cluster")&&(this.alignToDomEvent||2===vt(o.align.align).edgeAligned)?o.setTimeout({fn:"showByEvent",args:[t,r],delay:130}):o.showByEvent(t,r.closest("[data-event-id],[data-task-id]")))}},{key:"onTipPointerOver",value:function(e){var t,n,r,i=e.event,a=e.newTarget,o=e.owningCalendarWidget,l=e.eventRecord,s=this.tooltip,u=this.client;o||(o=null===(r=Lo.fromElement(a))||void 0===r?void 0:r.closest(jI));return l||(l=o.getEventRecord(a)),!(null!==(t=u.features)&&void 0!==t&&null!==(t=t.eventEdit)&&void 0!==t&&t.isEditing||null!==(n=u.activeView.features)&&void 0!==n&&null!==(n=n.cellEdit)&&void 0!==n&&n.isEditing)&&(!u.floatRoot.querySelector(".b-eventeditor,.b-taskeditor")&&(o&&(i&&(s.triggeredByEvent=i,s.activeTarget=a),this.activeClient=o,l=o.getEventRecord(a),s.eventRecord=this.eventRecord=l),null!=l))}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this._tooltip&&(this._tooltip.disabled=e)}}],[{key:"pluginConfig",get:function(){return{chain:["render"]}}}])}(KF);S($I,"$name","EventTooltip"),S($I,"type","eventTooltip"),S($I,"configurable",{showOn:"click",closable:!0,axisLock:"flexible",tooltip:{$config:["lazy","nullify"],value:{type:"eventTip"}},titleRenderer:function(e){return Le.encodeHtml(e.name)},renderer:null,recurrenceConfirmation:{$config:["lazy","nullify"],value:{type:"recurrenceconfirmation"}},extendAllDayEndDay:null,align:null,revealEventsInCluster:!0,resources:null,clickDelay:null,alignToDomEvent:null}),$I.initClass(),$I._$name="EventTooltip";var UI=function(e){return e.isCalendarMixin},GI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeTooltip",value:function(e,t){if(e){var n=this,r=n.client,i=pc.reconfigure(t,Be.assign({},e,{id:"".concat(r.id,"-schedule-tip"),owner:r,forElement:r.viewContainer.element,getHtml:n.getHtml.bind(n),filterTarget:n.filterTarget.bind(n),internalListeners:{innerHtmlUpdate:function(e){var t=e.source;n.clockTemplate.updateDateIndicator(t.element,n.lastTime)}}}));return n.clockTemplate=new sT({scheduler:r,mode:"hour"}),i}}},{key:"filterTarget",value:function(e){var t,n=e.target;if(!Wn.isMouseDown()&&this.callback(this.showScheduleTip,this,[null===(t=Lo.fromElement(n))||void 0===t?void 0:t.closest(UI)]))return n.closest(".b-cal-event-wrap")?null:n}},{key:"getHtml",value:function(e){var t,n,r=e.tip,i=e.event,a=e.activeTarget,o=this,l=null===(t=Lo.fromElement(a))||void 0===t?void 0:t.closest(UI),s=o.callback(o.showScheduleTip,o,[l])&&l.getDateFromDomEvent(i);if(s&&("pointermove"!==i.type||"touch"!==i.pointerType||!Object.values((null===(n=o.client.features.drag)||void 0===n?void 0:n.zones)||{}).some((function(e){return e.dragging})))){var u=l.isDayView,c=Pl.format(s,"".concat(l.dateFormat).concat(u?" "+(l.timeFormat||"LST"):""));return o.lastTime=s,u?o.clockTemplate.generateContent({date:s,text:c}):c}r.hide()}},{key:"onCalendarScroll",value:function(){var e=this.tooltip;if(e.isVisible){var t=e.triggeredByEvent;li.elementFromPoint(t.clientX,t.clientY).dispatchEvent(new ne.PointerEventConstructor("pointermove",t))}}},{key:"render",value:function(){this.getConfig("tooltip"),fr.on({element:this.client.element,scroll:"onCalendarScroll",thisObj:this,capture:!0})}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this._tooltip&&(this._tooltip.disabled=e)}}],[{key:"pluginConfig",get:function(){return{chain:["render"]}}}])}(KF);S(GI,"$name","ScheduleTooltip"),S(GI,"type","ScheduleTooltip"),S(GI,"configurable",{showScheduleTip:function(e){var t;return(null==e?void 0:e.isDayView)||(null==e||null===(t=e.viewType)||void 0===t?void 0:t.isDayView)},tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",allowOver:!0,hoverDelay:0,hideDelay:100,forSelector:"*",showOnHover:!0,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,layoutStyle:"white-space:nowrap"}}}),KF.register(GI.type,GI,!0),GI._$name="ScheduleTooltip";var YI=function(e){return e.isCalendarMixin},qI=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getDataFromEvent",value:function(e){var n=this.client,r=n.activeView,i=n.resolveResourceRecord(e)||n.defaultCalendar;r.isScheduler&&(this.client=r);var a=B(t,"getDataFromEvent",this,3)([e]);return a.resourceRecord||(a.resourceRecord=i),this.client=n,a}},{key:"shouldShowMenu",value:function(e){var n=e.date,r=e.targetElement,i=this.client,a=i.activeView;if(a.isEventList&&!a.isAgendaView)return!1;if(a.isScheduler){this.client=a;var o=B(t,"shouldShowMenu",this,3)(arguments);return this.client=i,o}return Boolean(n&&!r.closest(i.eventSelector))}},{key:"populateScheduleMenu",value:function(e){var n=e.items,r=e.domEvent,i=e.date;B(t,"populateScheduleMenu",this,3)(arguments);var a=this.client,o=n.addEvent,l=a.constructor.fromElement(this.menuContext.targetElement,YI);o&&(o.disabled=this.disableAddEvent,o.onItem=function(){var e=a.activeView.getResourceRecord(r);!1!==a.activeView.trigger("beforeAutoCreate",{view:l,domEvent:r,date:i,resourceRecord:e})&&(l||a).createEvent(i,e,!0)})}},{key:"disableAddEvent",get:function(){var e=this.menuContext,t=e.resourceRecord,n=e.date;return!!t&&(t.readOnly||!t.isWorkingTime(n))}},{key:"changeMenu",value:function(){var e=this,n=B(t,"changeMenu",this,3)(arguments);return null==n||n.ion({beforeShow:function(t){var n=t.source,r=e.client.activeSubView,i=r._overflowPopup;n.owner=null!=i&&i.containsFocus?i:r}}),n}}])}($M);S(qI,"$name","ScheduleMenu"),S(qI,"type","scheduleMenu"),S(qI,"configurable",{menu:{scrollAction:"realign"},triggerEvent:null}),KF.register(qI.type,qI,!0),qI._$name="ScheduleMenu";var KI=/^refresh$|.*event.*|.*resource.*|.*cell.*|.*row.*|.*schedule.*|daynumber.*|weeknumber.*|monthname.*|weekname.*$|beforedatechange|tickchange|.*showoverflowpopup|beforeautocreate|rangechange|weekflex|layoutupdate/,XI=function(e){return e.isCalendarMixin&&e.containsFocus},ZI=Object.freeze([]),JI=function(e){return null!=e.weight},QI={weeknumberclick:1,monthnameclick:1},eL=function(e){var t;return e.isMonthView||"monthview"===(null===(t=e.view)||void 0===t?void 0:t.type)},tL=function(e){var t;return e.isWeekView||"weekview"===(null===(t=e.view)||void 0===t?void 0:t.type)},nL=function(e){var t;return"presentation"!==(null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"role"))&&li.isFocusable(e)},rL=function(e,t){return Be.hasOwn(e,t)&&(null===e[t]||!1===e[t])},iL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"compose",value:function(){var e=this.includeWeekendsButton,t=this.navigatorPlacement;return{class:S(S({},"b-calendar-nav-".concat(t||"toolbar"),1),"b-calendar-include-weekends-button",e)}}},{key:"applyState",value:function(){this._hidden=!0,B(t,"applyState",this,3)(arguments),this._hidden=!1,this.triggerPaint()}},{key:"onPaintOverride",value:function(){}},{key:"onInternalPaint",value:function(){this.onPaintOverride()||B(t,"onInternalPaint",this,3)([])}},{key:"onShowOverflowPopup",value:function(e){var t=this,n=e.overflowPopup;this.element.classList.add("b-overflow-popup-visible"),n.ion({hide:function(){return t.element.classList.remove("b-overflow-popup-visible")},once:!0})}},{key:"dateTimeNow",get:function(){return null!=this.timeZone?yp.toTimeZone(new Date,this.timeZone):new Date}},{key:"today",get:function(){var e=this.dateTimeNow;return e.setHours(0,0,0,0),e}},{key:"finalizeInit",value:function(){var e;B(t,"finalizeInit",this,3)([]);var n=this,r=null===(e=n.activeView)||void 0===e?void 0:e.hideNonWorkingDays;null!=r&&null==n.hideNonWorkingDays&&(n.hideNonWorkingDays=r)}},{key:"toggleEmptyText",value:function(){var e=this.crudManager,t=(e||this).eventStore;li.toggleClasses(this.contentElement,"b-calendar-empty",!(t.count||null!=e&&e.isLoading))}},{key:"refresh",value:function(){this.eachView((function(e){var t;return null===(t=e.refresh)||void 0===t?void 0:t.call(e)}))}},{key:"views",get:function(){var e=this.modes;return e?Object.values(e):[]}},{key:"activeView",get:function(){return this.viewContainer.layout.activeItem}},{key:"activeSubView",get:function(){var e,t=this.activeView;return(null===(e=t.items.filter(XI))||void 0===e?void 0:e[0])||t}},{key:"captureFocus",value:function(){return this.activeView.captureFocus()}},{key:"getEventRecord",value:function(e){return this.activeView.getEventRecord(e)}},{key:"resolveEventRecord",value:function(e){return this.getEventRecord(e)}},{key:"onBeforeViewContainerCardChange",value:function(e){var t,n,r=e.prevActiveItem,i=e.activeItem;if(!1===this.trigger("beforeActiveItemChange",arguments[0]))return!1;if(null===(t=r._overflowPopup)||void 0===t||null===(n=t.hide)||void 0===n||n.call(t),"date"in i&&!1!==i.syncViewDate){var a=this.date||r.date;a&&(i.isCalendarMixin?i.date=a:i.whenVisible((function(){return i.date=a})))}}},{key:"onViewContainerCardChange",value:function(e){if(this.trigger("activeItemChange",e),e.containedFocus){var t,n=e.activeItem;null===(t=n.focusDate||n.focus)||void 0===t||t.call(n,this.date)}}},{key:"onToggleSidebarClick",value:function(){var e=this.sidebar,t=e.collapsible;null!=t&&t.isPanelCollapserOverlay?t.revealing||t.toggleReveal(!e.revealed):e.toggleCollapsed()}},{key:"onEnterKey",value:function(e){var n=e.target,r=t.fromElement(n),i=r.dayContentElement,a=n.getAttribute("role"),o=r.isDayView?{clientY:i.getBoundingClientRect().top+r.hourHeight*r.autoCreate.startHour-i.scrollTop}:{};return("link"===a||"columnheader"===a||n.matches(".b-calendar-cell,.b-day-cell"))&&(li.triggerMouseEvent(n,"link"===a?"click":"dblclick",o),e.stopPropagation()),!1}},{key:"onEscapeKey",value:function(e){var t;this.element.matches(".b-draghelper-active")||(null===(t=li.findParent(e.target,nL,this.element))||void 0===t||t.focus(),e.preventDefault(),e.stopPropagation());return!1}},{key:"onDigitKey",value:function(e){return!li.isEditable(e.target)&&e.key.match(/\d/)&&(this.mode=this.viewContainer.items[Number(e.key)-1]),!1}},{key:"focusModeSelector",value:function(){var e,t,n=null===(e=this.widgetMap.modeSelector)||void 0===e?void 0:e.widgetMap;n&&(null===(t=[n["".concat(this.activeView.modeName,"ShowButton")],n.modeSelectorButton].find((function(e){return null==e?void 0:e.isFocusable})))||void 0===t||t.focus())}},{key:"gotoDate",value:function(){var e=this.gotoDatePopup;e.widgetMap.dateField.value=this.date,e.show()}},{key:"changeGotoDatePopup",value:function(e){return fc.create(fc.mergeConfigs({appendTo:this.contentElement},e))}},{key:"onGotoDateClick",value:function(){var e,t=this.gotoDatePopup,n=this.activeView,r=t.widgetMap.dateField;(t.hide(),r.isValid)&&(this.date=r.value,null===(e=n.focusDate||n.focus)||void 0===e||e.call(n,this.date))}},{key:"focusEventFilter",value:function(){var e;null===(e=this.widgetMap.eventFilter)||void 0===e||e.focus()}},{key:"focusCurrentDate",value:function(){var e,t=this.activeView;null===(e=t.focusDate||t.focus)||void 0===e||e.call(t,this.date)}},{key:"shiftToNow",value:function(){var e,t,n=this,r=n.activeView,i=null===(e=n.sidebar)||void 0===e?void 0:e.widgetMap.datePicker,a=r.dayTime,o=new Date,l=a?a.startOfDay(o):Pl.clearTime(o);n.date=l,r.isScheduler?r.updateDate(l,l):r.scrollTo(l,{y:!r.isDayView}),i&&(i.date=l),n.updateViewDescription(),null===(t=r.focusDate||r.focus)||void 0===t||t.call(r,l)}},{key:"shiftPrevious",value:function(e){var t,n=this.viewContainer.layout.activeItem,r=n.startDate;null!=n&&n.previous&&(n.previous(),this.updateViewDescription(n),n.startDate-r&&n.animateTimeShift&&li.slideIn(n.contentElement,-1),null!=e&&e.type.startsWith("key")&&(null===(t=n.focusDate||n.focus)||void 0===t||t.call(n,this.date)))}},{key:"shiftNext",value:function(e){var t,n=this.viewContainer.layout.activeItem,r=n.startDate;null!=n&&n.next&&(n.next(),this.updateViewDescription(n),n.startDate-r&&n.animateTimeShift&&li.slideIn(n.contentElement,1),null!=e&&e.type.startsWith("key")&&(null===(t=n.focusDate||n.focus)||void 0===t||t.call(n,this.date)))}},{key:"onCalendarSidebarToggle",value:function(e){e.source=this,this.trigger("sidebar".concat(Le.capitalize(e.type)),e)}},{key:"onCalendarDateChange",value:(r=f((function(e){var t=this,n=e.date,r=e.oldDate,i=e.userAction;return L().mark((function e(){var a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(a=t).viewContainer.layout,l=o.isChangingCard?o.animateDetacher.event:o,s=l.activeItem,u=a.highlightDate,!s||!1===s.syncViewDate||!("date"in s)){e.next=14;break}if(c=s.getDayElement,Pl.betweenLesser(n,s.startDate,s.endDate)||null===(d=s._overflowPopup)||void 0===d||null===(h=d.hide)||void 0===h||h.call(d),s.date=n,i&&!(s.isAgendaView||s.isYearView||s.isScheduler)&&(null===(f=s.scrollTo)||void 0===f||f.call(s,n,{y:!s.isDayView})),n=a.date=s.date,!(i&&u&&c)){e.next=14;break}if(!s.scrollTo){e.next=12;break}return e.next=11,s.scrollTo(n);case 11:s.scrolledToDate&&(n=s.scrolledToDate);case 12:(g=null===(v=s.getDayElement)||void 0===v?void 0:v.call(s,n))&&(isNaN(u)?a.callback(u,a,[g,a]):li.highlight(pt.from(g)));case 14:a.syncViewActiveDates(r,n),a.trigger("dateChange",{oldDate:r,date:n});case 16:case"end":return e.stop()}}),e)}))()})),function(e){return r.apply(this,arguments)})},{key:"updateActiveDateCls",value:function(e,t){this.syncViewActiveDates(this.date,this.date,t)}},{key:"syncViewActiveDates",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.date,n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.activeDateCls,r=this.activeDateCls,a=this.viewContainer.contentElement;if(n)for(var o=e?a.querySelectorAll('[data-date="'.concat(Pl.makeKey(e),'"],[role="gridcell"][data-header-date="').concat(Pl.makeKey(e),'"]')):ZI,l=0,s=o.length;l<s;l++)o[l].classList.remove(n);if(r)for(var u=a.querySelectorAll('[data-date="'.concat(Pl.makeKey(t),'"],[role="gridcell"][data-header-date="').concat(Pl.makeKey(t),'"]')),c=0,d=u.length;c<d;c++)u[c].classList.add(r)}},{key:"updateViewDescription",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.activeView,t=this,n=t.tbar,r=t.widgetMap,a=t.element,o=r.viewDescription,l=(null==e?void 0:e.description)||"Calendar",s='<span class="b-calendar-view-desc-text">'.concat(l,"</span>");if(a.dataset.mode=t.activeView.modeName,a.setAttribute("aria-label",l),e){n&&o&&o.content!==s&&(o.content=s);var u=e.date||e.startDate;u&&(this.date=u)}}},{key:"getStepUnitText",value:function(){return(arguments.length>0&&arguments[0]!==i?arguments[0]:this.activeView).stepUnit}},{key:"syncUIWithActiveView",value:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:this.activeView,t=this,n=t.tbar,r=t.sidebar,a=t.widgetMap;if(n&&null!=e&&e.isVisible){var o=a.prevButton,l=a.nextButton,s=a.modeSelector,u=t.getStepUnitText(e);null==s||s.syncActiveMode(e),r&&(r.stepUnitText=u),t.updateViewDescription(e),o&&(o.tooltip=u?t.L("L{previous}",u):"",o.disabled=!u||!e.previous),l&&(l.tooltip=u?t.L("L{next}",u):"",l.disabled=!u||!e.next)}}},{key:"updateEventStore",value:function(e){this.detachListeners("eventStoreDateRange"),this.features.loadOnDemand,this.processConfiguredListeners(),e.ion({loadDateRange:"onEventStoreDateRangeRequested",name:"eventStoreDateRange",thisObj:this}),this.sidebar&&(this.sidebar.eventStore=e)}},{key:"eachView",value:function(e,t){var n,r=arguments.length>2&&arguments[2]!==i?arguments[2]:null,a=null==t,o=D(this.views);try{for(o.s();!(n=o.n()).done;){var l=n.value;if(a&&(t=[l]),!1===l.callback(e,r||l,t))return}}catch(e){o.e(e)}finally{o.f()}}},{key:"onEventStoreDateRangeRequested",value:function(e){e.changed&&this.trigger("dateRangeChange",e),this.trigger("dateRangeRequested",e)}},{key:"onModeSelectorToggle",value:(n=f((function(e){var t=this,n=e.source,r=e.pressed;return L().mark((function e(){var i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return a=(i=t).viewContainer.layout,o=n.view,e.next=4,i.modeSelectionPromise;case 4:i.modeSelectionPromise=a.setActiveItem(o).promise;case 5:case"end":return e.stop()}}),e)}))()})),function(e){return n.apply(this,arguments)})},{key:"updateMode",value:function(e,t){var n=this,r=n.isConfiguring,a=n.viewContainer.layout,o=n.initialConfig||{};r||n._responsiveUpdating&&("mode"in o||"activeIndex"in o)||((e="string"==typeof e?n.modes[e]:e)?e!==n.activeView&&(a.setActiveItem(e,i,{animation:!n.isResponsiveUpdating}),r||a.activeItem===e||(n._mode=t,n.syncUIWithActiveView())):n._mode=t)}},{key:"onEventStoreRefresh",value:function(){this.isConfiguring||this.syncUIWithActiveView(this.viewContainer.layout.activeItem)}},{key:"handleViewRangeChange",value:function(){this.syncUIWithActiveView()}},{key:"handleViewPaint",value:function(e){var t=e.source;this.syncUIWithActiveView(t),this._mode=t.modeName,this.trigger("viewPaint",F({},arguments[0]))}},{key:"onViewRefresh",value:function(e){var n,r=e.source;null===(n=B(t,"onViewRefresh",this,3))||void 0===n||n(arguments),r.isVisible&&(r===this.activeView?this.updateViewDescription(r):this.activeView.owns(r)&&this.syncUIWithActiveView(this.activeView)),this.syncViewActiveDates()}},{key:"updateEventCls",value:function(e){this.initialConfig.eventInnerSelector||(this.eventInnerSelector=".".concat(e)),this.initialConfig.eventSelector||(this.eventSelector="".concat(this.eventInnerSelector,"-wrap"))}},{key:"changeModes",value:function(e,t){var n,r=this,a=r.modeDefaults,o=[];for(var l in r.getConfig("crudManager","defaultCalendar","eventCls"),e){var s,u;if(n=e[l])o.push(Be.assign({modeType:l,weight:null!==(s=null!==(u=n.weight)&&void 0!==u?u:null==a?void 0:a.weight)&&void 0!==s?s:0},n))}if(o.some(JI)){e={},o.sort(Lo.weightSortFn);for(var c=0,d=o.length;c<d;c++)e[(n=o[c]).modeType]=n}var h=r.tbar,f=r.element,v={thisObj:r,descriptionChange:"onViewDescriptionChange",weekNumberClick:"onViewWeekNumberClick",monthNameClick:"onViewMonthNameClick",dayNumberClick:"onViewDayNumberClick",beforeEventAdd:"onViewBeforeEventAdd",catchAll:{fn:"onViewCatchAll",prio:1e4},dateRangeChange:"handleViewRangeChange",shiftIncrementChange:"handleViewRangeChange",rangeChange:"handleViewRangeChange",paint:"handleViewPaint",refresh:"onViewRefresh"},g=r.$modes||(r.$modes=new du({factory:aL,inferType:!0,owner:r,ownerName:"calendar",created:function(e,t){var n;if(e.modeName=t,e.isScheduler){var i=e.features,a=r.features.eventEdit;if(a&&(a.applyPluginConfig(e),e.editEvent=r.editEvent.bind(r)),e.ion({renderrow:function(){return r.syncUIWithActiveView()}}),!rL(i,"timeAxisHeaderMenu")){var o,l=e.listRangeMenu;Be.setPath(i.timeAxisHeaderMenu||(i.timeAxisHeaderMenu={}),"items.dateRange",!1),rL(i.timeAxisHeaderMenu.items,"setRange")||(i.timeAxisHeaderMenu.items.setRange={text:"L{Calendar.timeRange}",icon:"b-fw-icon b-icon-calendar",weight:300,menu:l}),null!==(o=r.sidebar)&&void 0!==o&&o.widgetMap.eventFilter&&(i.timeAxisHeaderMenu.items.eventsFilter=!1)}}f.classList.add("b-cal-".concat(t)),e.ion(v),r.relayEvents(e,["eventPropagate"]),r.isConfiguring||r.trigger("addMode",{mode:e});var s=null==h||null===(n=h.widgetMap)||void 0===n?void 0:n.modeSelector;s&&(s.calendar=r,s.addMode(t,e)),Be.getPropertyDescriptor(e,"eventCount")||Object.defineProperty(e,"eventCount",{get:function(){return this.eventStore.getEvents({startDate:this.startDate,endDate:this.endDate}).length}})},setup:function(e,t){var n=r.defaultCalendar,o=aL.resolveType(e.type);if(a&&(e=Be.merge({},a,e)),o.isSchedulerBase){var l=e.features||(e.features={});l.eventTooltip=l.eventMenu=l.eventEdit=l.scheduleMenu=!1,"syncCalendarDate"in e||(e.syncCalendarDate=!0)}else e.eventSelector=r.eventSelector,e.eventInnerSelector=r.eventInnerSelector;return"list"===e.type&&(e.selectedRecordCollection=r.selectedCollection),"autoCreate"in r.initialConfig&&!("autoCreate"in e)&&(e.autoCreate=r.autoCreate),Be.hasOwn(r,"_defaultCalendar")?e.defaultCalendar=r._defaultCalendar:null!=n&&(e.defaultCalendar=n),function(e,t,n){for(var r=0,a=n.length;r<a;r++){var o=n[r];o in e||t[o]===i||(e[o]=t[o])}}(e,r,r.propagatedConfigs),!1===r.trigger("beforeCreateMode",{config:e})?null:e}}));if(g.update(e),!t)return g.target}},{key:"changeModeDefaults",value:function(e){var t=this,n=new Proxy(F({},e),{set:function(e,n,r){var i=Reflect.set.apply(Reflect,arguments);return t.updateModeDefaults(S({},n,r)),i},deleteProperty:function(e,n){var r=Reflect.deleteProperty.apply(Reflect,arguments);return t.updateModeDefaults(S({},n,null)),r}});return n}},{key:"updateModeDefaults",value:function(e){this.isConfiguring||this.eachView((function(t){return t.setConfig(e)}))}},{key:"collapsibleConfig",get:function(){var e=this.peekConfig("overlaySidebar"),t={type:e?"overlay":"inline",tool:null};return e&&(t.recollapseTool=null),t}},{key:"updateOverlaySidebar",value:function(e){var t=this.sidebar,n=this.collapsibleConfig,r=null==t?void 0:t.collapsible;r&&(r.type!==n.type&&(t.collapsible=n),e?t.collapsed||(t.collapsed=!0,t.collapsedDueToOverlay=!0):(t.collapsedDueToOverlay||t.isVisible&&r.isPanelCollapserOverlay)&&(t.collapsed=!1,t.collapsedDueToOverlay=!1))}},{key:"changeSidebar",value:function(e,n){var r,i=this,a=i.datePicker,o=i.statefulId;if(e){var l=e.items||(e.items={}),s=l.datePicker;return a?null!==s&&!1!==s&&(l.datePicker=t.mergeConfigs(l.datePicker,a)):l.datePicker=null,rA.reconfigure(n,e,{owner:i,setup:function(e,t){return i.setupWidgetConfig(e,t)},defaults:{stateId:o&&"".concat(o,":sidebar"),eventStore:i.eventStore,date:i.date,weight:"right"===(null==e?void 0:e.side)||"end"===(null==e?void 0:e.side)?200:-10,collapsible:i.collapsibleConfig,items:{datePicker:{weekStartDay:i.weekStartDay}}}})}null==n||n.destroy(),null===(r=i.tbar)||void 0===r||null===(r=r.widgetMap.toggleSidebar)||void 0===r||r.hide()}},{key:"changeTbar",value:function(e){null!=e&&e.toggleSideBar&&!e.isWidget&&(Ne.deprecate("calendar","7.0.0","toggleSideBar ref is deprecated in favor of toggleSidebar"),e.toggleSidebar=e.toggleSideBar,delete e.toggleSideBar);var n,r=B(t,"changeTbar",this,3)(arguments);r&&!this.hasConfig("sidebar")&&(null===(n=r.widgetMap.toggleSidebar)||void 0===n||n.hide());return r}},{key:"changeDatePicker",value:function(e){if(e)return Object.assign(e,{eventStore:this.eventStore,date:this.date,minDate:this.minDate,maxDate:this.maxDate})}},{key:"datePicker",get:function(){var e;return this.isConfiguring?this._datePicker:null===(e=this.sidebar)||void 0===e||null===(e=e.widgetMap)||void 0===e?void 0:e.datePicker}},{key:"changeItems",value:function(e){var n=this.modes,r=this.sidebar;r&&(e.sidebar=r),e.viewContainer=this.viewContainer,e.viewContainer.items=n,e.viewContainer.activeIndex=Math.max(Object.keys(n).indexOf(this.mode),0),this.activeModeIndex&&(e.viewContainer.layout.activeIndex=this.activeModeIndex);var i=B(t,"changeItems",this,3)([e]);return this._viewContainer=this.widgetMap.viewContainer,i}},{key:"onViewCatchAll",value:function(e){var t=this,n=e.fromOverflowPopup,r=e.type,i=e.source;if(!e.bubbles){var a,o,l=e.domEvent;if(!l&&li.isDOMEvent(e.event)&&(l=e.event),t.eventSource=i,!l||!1!==t.handleEvent(l)){var s,u=r.startsWith("emptycell"),c=i.isEventList&&!i.range?"betweenLesserEqual":"betweenLesser";if(r.endsWith("click")&&!QI[r]&&(o=e.date||(null===(s=i.getDateFromDomEvent)||void 0===s?void 0:s.call(i,l)))){i.isDayView&&i.dayTime&&(o=i.dayTime.startOfDay(o));var d=n||"celloverflowclick"===r||l.target.closest(".b-cal-cell-overflow"),h=i.getDayElement&&!i.getDayElement(o,!0)||i.isDateRangeOwner&&!Pl[c](o,i.startDate,i.endDate);i.syncCalendarDate&&(i.isCalendarRow||!(n&&h)&&!u&&!(i.isDateRangeOwner&&h)&&("daynumberclick"===r||!(h&&(d||r.startsWith("event")||r.startsWith("schedule")))))&&(i.preventScroll=!0,t.date=o,i.preventScroll=!1)}(u||KI.test(r))&&(!e.view&&(e.view=i),a=t.trigger(e.eventName,e))}return t.eventSource=null,a}}},{key:"onViewDescriptionChange",value:function(){this.updateViewDescription()}},{key:"onViewWeekNumberClick",value:function(e){var t=e.date,n=e.week,r=this.modes.week||this.viewContainer.query(tL);r&&(r.week=n,Pl.betweenLesser(this.date,r.startDate,r.endDate)||(this.date=t),this.viewContainer.layout.activeItem=r)}},{key:"onViewMonthNameClick",value:function(e){var t=e.date,n=this.modes.month||this.viewContainer.query(eL);n?(n.getDayElement(t,!0)||(this.date=t),this.viewContainer.layout.activeItem=n):this.date=t}},{key:"onViewDayNumberClick",value:function(e){var t,n=e.source,r=e.date,i=e.cellData,a=e.fromOverflowPopup;e.domEvent;var o=this.activeView,l=n.isYearView&&("click"!==n.overflowPopupTrigger||a||!n.overflowPopup||i.isOtherMonth||!(null!==(t=i.events)&&void 0!==t&&t.length)&&!n.emptyCellRenderer);if((!o.isDayView||1!==o.duration)&&(n.isCalendarRow||n.isMonthView||l||n.isAgendaView)){var s=this.viewContainer,u=this.modes.day||s.query((function(e){var t;return"dayview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));if(u&&n!==u.allDayEvents){var c=s.layout.activeItem,d=c.syncViewDate;return c.syncViewDate=!1,this.date=r,s.layout.activeItem=u,c.syncViewDate=d,!1}}}},{key:"onViewBeforeEventAdd",value:function(e){var t=e.eventRecord,n=e.assignmentRecords,r=this.features.eventEdit,i=r&&!r.disabled;t.isCreating=i,null==n||n.forEach((function(e){return e.isCreating=i}))}},{key:"createEvent",value:function(e,t){this.doCreateEvent(e,t)}},{key:"doCreateEvent",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:this.activeSubView,r=arguments.length>3?arguments[3]:i,a=this.modes,o=n.isYearView&&(a.week||a.month||a.day)||n;if(this.activeView.owns(o))n.doCreateEvent?n.doCreateEvent(e,t,o,r):n.createEvent(e,t,r);else{var l=this.widgetMap.viewContainer,s=l.layout;if(o)return l.ion({activeItemChange:"doCreateEvent",thisObj:n,once:!0,args:[e,t,o]}),e&&(this.date=e),s.activeItem=o,!1}}},{key:"changeDate",value:function(e,t){if(e="string"==typeof e?Pl.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=Pl.clearTime(e),!t||e-t)return e}},{key:"changeMinDate",value:function(e){return this.changeDate(e)}},{key:"changeMaxDate",value:function(e){return this.changeDate(e)}},{key:"updateMinDate",value:function(e){this.isConfiguring||(this.syncCommonConfig("minDate"),this.datePicker&&(this.datePicker.minDate=e))}},{key:"updateMaxDate",value:function(e){this.isConfiguring||(this.syncCommonConfig("maxDate"),this.datePicker&&(this.datePicker.maxDate=e))}},{key:"updateAutoCreate",value:function(){this.isConfiguring||this.syncCommonConfig("autoCreate")}},{key:"updateDate",value:function(e,t){if(!this.isConfiguring){var n=this.sidebar;n?n.date=e:this.onCalendarDateChange({date:e,oldDate:t})}}},{key:"updateDateFormat",value:function(){this.isConfiguring||this.syncCommonConfig("dateFormat")}},{key:"changeIncludeWeekendsButton",value:function(e){return!0===e?{}:e}},{key:"updateIncludeWeekendsButton",value:function(e){!this.isConstructing&&e&&Be.isObject(e)&&(this.widgetMap.modeSelector.includeWeekendsButton=e)}},{key:"changeScrollManager",value:function(e,t){if(null==t||t.destroy(),!this.isDestroying)return new vg(Object.assign({element:this.element},e))}},{key:"updateDefaultCalendar",value:function(){this.isConfiguring||this.syncCommonConfig("defaultCalendar")}},{key:"changeWeekStartDay",value:function(e){return!1===e&&(e=Pl.weekStartDay),e}},{key:"updateReadOnly",value:function(){B(t,"updateReadOnly",this,3)(arguments),this.isConfiguring||this.syncCommonConfig("readOnly")}},{key:"updateWeekStartDay",value:function(e){var t;this.isConfiguring||(this.syncCommonConfig("weekStartDay"),null!==(t=this.sidebar)&&void 0!==t&&t.widgetMap.datePicker&&(this.sidebar.widgetMap.datePicker.weekStartDay=e))}},{key:"changeHideNonWorkingDays",value:function(e){return Boolean(e)}},{key:"updateHideNonWorkingDays",value:function(e,t){this.isConfiguring||(this.syncCommonConfig("hideNonWorkingDays"),this.trigger("changeHideNonWorkingDays",{value:e,was:t}))}},{key:"changeNonWorkingDays",value:function(e){!1===e&&(e=Pl.nonWorkingDays);var t=this,n=new Proxy(F({},e),{set:function(e){var n=Reflect.set.apply(Reflect,arguments);return t.updateNonWorkingDays(e),n},deleteProperty:function(e){var n=Reflect.deleteProperty.apply(Reflect,arguments);return t.updateNonWorkingDays(e),n}});return n}},{key:"updateNonWorkingDays",value:function(){this.isConfiguring||this.syncCommonConfig("nonWorkingDays")}},{key:"updateCoreHours",value:function(){this.isConfiguring||this.syncCommonConfig("coreHours")}},{key:"syncCommonConfig",value:function(e){var t=this;this.eachView((function(n){n[e]=t[e]}))}},{key:"onCalendarStoreChange",value:function(){var e;if(this.isPainted){var n=this.element,r=this.resourceStore,i=this.widgetMap.resourceFilter,a=(i?r.records.filter((function(e){return i.value.includes(e)})):r.records).length;n.classList.toggle("b-no-visible-resources",Boolean(i&&!a)),n.style.setProperty("--visible-resource-count",a)}null===(e=B(t,"onCalendarStoreChange",this,3))||void 0===e||e(arguments)}},{key:"updateSelected",value:function(){for(var e=this.viewContainer.contentElement.querySelectorAll(".b-cal-event-wrap"),t=0,n=e.length;t<n;t++)e[t].classList.toggle(this.eventSelectedCls,this.isEventSelected(e[t].dataset.eventId))}},{key:"getElementFromEventRecord",value:function(e,t){return this.activeView.getEventElement(e,i,t)}},{key:"getElementsFromEventRecord",value:function(e,t){return[this.getElementFromEventRecord(e,t)]}},{key:"updateLocalization",value:function(){var e=this;if(e.isPainted){var n=!1;"weekStartDay"in e.initialConfig||e.weekStartDay===Pl.weekStartDay||(e.weekStartDay=Pl.weekStartDay,n=!0),"nonWorkingDays"in e.initialConfig||Be.isEqual(e.nonWorkingDays,Pl.nonWorkingDays)||(e.nonWorkingDays=Pl.nonWorkingDays,n=!0),n||e.refresh(),e.syncUIWithActiveView()}B(t,"updateLocalization",this,3)([])}},{key:"onEventDataGenerated",value:function(e,t){}}],[{key:"configurable",get:function(){return{layout:"hbox",enableRecurringEvents:!0,localizableProperties:["autoCreate.newName"],crudManager:null,features:{drag:{},eventCopyPaste:{},eventEdit:{},eventTooltip:{},scheduleMenu:{},eventMenu:{}},navigatorPlacement:null,eventContainerSelector:".b-eventrenderer,.b-overflowpopup",responsive:{small:{when:600,once:{mode:"day"},dateFormat:"MMM DD, YYYY"},medium:{when:800},large:{overlaySidebar:!1},"*":{overlaySidebar:!0,once:{mode:"week"}}},responsiveRoot:!0,stateful:["hideNonWorkingDays","mode"],tbar:{cls:"b-calendar-toolbar",items:{toggleSidebar:{icon:"b-icon-menu-vertical",cls:"b-sidebar-toggle b-borderless b-transparent",onClick:"up.onToggleSidebarClick",tooltip:"L{Calendar.toggleSidebar}",weight:100},todayButton:{text:"L{Calendar.Today}",cls:"b-cal-nav-item b-calendar-today-button",icon:"b-icon-calendar-day",onClick:"up.shiftToNow",weight:200},prevButton:{onClick:"up.shiftPrevious",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-previous",weight:300},nextButton:{onClick:"up.shiftNext",cls:"b-cal-nav-item b-borderless b-transparent b-cal-nav-next",icon:"b-icon-next",weight:400},viewDescription:{cls:"b-calendar-view-desc",type:"widget",flex:"",html:" ",overflowable:"none",weight:500},spacer:{type:"widget",cls:"b-toolbar-fill",weight:600},modeSelector:{type:"calendarModeSelector",weight:700}}},items:{},viewContainer:{$config:"lazy",value:{type:"container",role:"presentation",weight:100,cls:{"b-calendar-viewcontainer":1},flex:"1 1 100%",layout:{type:"card"},scrollable:{overflowY:!0,overflowX:!0},suppressChildHeaders:!0,layoutStyle:{padding:0},internalListeners:{beforeActiveItemChange:"up.onBeforeViewContainerCardChange",activeItemChange:"up.onViewContainerCardChange"}}},includeWeekendsButton:!1,layoutStyle:{padding:0,flexFlow:"row nowrap"},modes:{day:{},week:{},month:{},year:{},agenda:{}},mode:{$config:"lazy",value:"week"},modeDefaults:{value:null},sidebar:{$config:{merge:"objects"},value:{type:"sidebar",side:"left",scrollable:{overflowY:!0},internalListeners:{dateChange:"up.onCalendarDateChange",collapse:"up.onCalendarSidebarToggle",expand:"up.onCalendarSidebarToggle"}}},datePicker:{$config:{merge:"objects"},value:{weight:100,dayNameFormat:"d1",editMonth:null,trapFocus:!1}},overlaySidebar:null,date:{$config:{equal:"date"},value:new Date},dateFormat:"MMMM DD, YYYY",scrollManager:{$config:["lazy","nullify"],value:{direction:"vertical"}},viewUpdateDelay:2e3,readOnly:null,allowOverlap:!0,testConfig:{viewUpdateDelay:5,loadMask:{text:"L{GridBase.loadMask}",showDelay:0}},highlightDate:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},focusable:!1,eventCls:"b-cal-event",weekStartDay:!1,hideNonWorkingDays:null,nonWorkingDays:!1,coreHours:null,contextMenuTriggerEvent:"contextmenu",enableUndoRedoKeys:!0,resourceImagePath:null,minDate:null,maxDate:null,filterEventResources:null,activeDateCls:null,keyMap:S({Enter:"onEnterKey",Escape:"onEscapeKey",Home:"focusModeSelector",p:"shiftPrevious",n:"shiftNext",t:"shiftToNow",g:"gotoDate","Ctrl+d":"focusCurrentDate","/":"focusEventFilter"},/\d/,"onDigitKey"),gotoDatePopup:{$config:"lazy",value:{cls:"b-calendar-goto-date-popup",type:"popup",title:"L{Calendar.gotoDate}",floating:!1,positioned:!0,centered:!0,items:{dateField:{type:"datefield"}},bbar:{items:{cancel:{text:"L{Object.Cancel}",onClick:"up.close"},go:{text:"L{Object.go}",onClick:"up.onGotoDateClick"}}},keyMap:{Enter:"up.onGotoDateClick"}}},propagatedConfigs:{value:["dateFormat","date","rtl","project","readOnly","weekStartDay","nonWorkingDays","hideNonWorkingDays","coreHours","timeZone","minDate","maxDate","resourceImagePath","visibleStartTime","visibleEndTime","filterEventResources"],$config:{merge:"distinct"}}}}},{key:"delayable",get:function(){return{refresh:{type:"raf",cancelOutstanding:!0},syncUIWithActiveView:{type:"buffer",delay:1,cancelOutstanding:!0}}}},{key:"getStartAndEndDates",value:function(e,t){var n=arguments.length>2&&arguments[2]!==i?arguments[2]:"dddd Do MMMM",r=arguments.length>3&&arguments[3]!==i?arguments[3]:e.timeFormat||"LT",a=arguments.length>4&&arguments[4]!==i?arguments[4]:null==e?void 0:e.extendAllDayEndDay,o=e.dayTime||(e.dayTime=new my(0)),l=t.allDay,s=t.startDate,u=t.endDate||Pl.add(s,t.fullDuration),c=l?a?Pl.ceil(u,"1 day"):Pl.add(u,-1,"day"):u,d=o.startOfDay(s)<o.startOfDay(c),h=!l&&Pl.clearTime(s)<s||Pl.clearTime(u)<c?d?"".concat(n," ").concat(r):r:n,f=t.isMilestone||l&&!d;return{multiDay:d,startDate:s,startText:Pl.format(s,h),endDate:c,endText:f?null:Pl.format(c,h)}}},{key:"featureable",get:function(){return{factory:KF}}}]);var n,r}(uc.mixin(sA,iA,ry,CR,II,LI,UE,rC,wu,tD));S(iL,"$name","Calendar"),S(iL,"type","calendar"),iL.initClass(),r.bryntum&&(r.bryntum.Calendar=iL);var aL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,null,[{key:"factoryable",get:function(){return{extends:Lo}}}])}(Mn.mixin(Za));aL.register("agenda",NA),aL.register("year",bI),aL.register("month",gI),aL.register("week",mI),aL.register("day",sI),aL.register("dayagenda",hI),aL.register("list",_A),aL.register("resource",EI),aL.register("dayresource",FI),iL.Modes=aL,Ne.setVersion("calendar","6.2.2"),iL._$name="Calendar";var oL=function(e){return e.eventStore},lL=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"clockTemplate",new sT({})),e}return R(t,e),w(t,[{key:"owner",get:function(){return pc.fromElement(this.activeTarget)||this.ownerFeature.client}},{key:"onEditClick",value:function(){this.trigger("edit")}},{key:"onDeleteClick",value:function(){this.trigger("delete")}},{key:"getHtml",value:function(e){var t=this,n=t.eventRecord;if(n)return e.eventRecord=n,t.title=t.titleRenderer?t.callback(t.titleRenderer,t,[n]):"",t.callback(t.renderer||t.internalRenderer,t,[F(F({},e),{},{eventRecord:n})])}},{key:"internalRenderer",value:function(e){var t,n=e.eventRecord,r=this.clockTemplate,i=this.recurrenceHint,a=n.allDay,o=n.recurrence,l=(null===(t=pc.fromElement(this.activeTarget))||void 0===t?void 0:t.closest(oL))||this.owner.activeView,s=o?lT.getLegend(o):i,u=Pl.formatDelta(Pl.diff(n.startDate,n.endDate),a?{precision:"d"}:null),c=iL.getStartAndEndDates(l,n,this.dateFormat,this.timeFormat,this.extendAllDayEndDay),d=c.multiDay,h=c.startDate,f=c.startText,v=c.endDate,g=c.endText;return r.mode=d?"day":"hour",r.template({date:h,text:f,cls:"b-sch-tooltip-startdate"})+(g?r.template({date:v,text:g,cls:"b-sch-tooltip-enddate"}):"")+(n.isMilestone?"":'<div class="b-cal-tooltip-duration b-icon b-icon-duration">'.concat(u,"</div>"))+(s?'<div class="b-cal-tooltip-recurrence b-icon b-icon-recurring">'.concat(s,"</div>"):"")}},{key:"showByEvent",value:function(e){var t,n,r=arguments.length>1&&arguments[1]!==i?arguments[1]:e.target,a=this,o=null===(t=a.ownerFeature)||void 0===t?void 0:t.clickDelay;if(a.activeTarget=r,a.pointerEvent=e,a.updateContent(),null!==(n=a.ownerFeature)&&void 0!==n&&n.alignToDomEvent&&(e.target.dataset.eventId=r.dataset.eventId,r={domEvent:e,anchor:!1,align:"s0-e100",axisLock:!0}),"click"!==e.type||!o)return a.showBy(r);a.hasTimeout("show")?a.clearTimeout("show"):(a.hoverDelay=o,e.type="pointerover",a.delayShow(r))}},{key:"afterShowByTarget",value:function(){var e,n=this.tools.delete;this.activeClient=null===(e=pc.fromElement(this.activeTarget))||void 0===e?void 0:e.closest(oL),B(t,"afterShowByTarget",this,3)([]),n&&(n.disabled=this.ownerFeature.client.readOnly)}},{key:"afterHide",value:function(){B(t,"afterHide",this,3)(arguments),this.activeClient=null}},{key:"updateActiveTarget",value:function(e,n){var r;null===(r=B(t,"updateActiveTarget",this,3))||void 0===r||r(arguments),null==n||n.classList.remove("b-cal-event-reveal"),e?e.classList.contains("b-cal-in-cluster")&&this.revealEventsInCluster&&e.classList.add("b-cal-event-reveal"):this.eventRecord=null}},{key:"refreshContent",value:function(){this.eventRecord&&this.updateContent()}},{key:"updateEventRecord",value:function(e){var t,n=this;null===(t=n._changeHook)||void 0===t||t.call(n),n._changeHook=e&&Tt.after(e,"afterChange",n.refreshContent,n),e&&(n.tools.delete&&(n.tools.delete.hidden=e.readOnly),n.tools.edit&&(n.tools.edit.hidden=e.readOnly))}},{key:"updateContent",value:function(){var e=this.clockTemplate,n=this.element,r=this.eventRecord,i=B(t,"updateContent",this,3)([]),a=n.querySelector(".b-sch-tooltip-startdate"),o=n.querySelector(".b-sch-tooltip-enddate"),l=this.tools,s=l.edit,u=l.delete,c=this.ownerFeature.client,d=c.features.eventEdit,h=c.readOnly||r.readOnly;if(a&&e.updateDateIndicator(a,r.startDate),o&&e.updateDateIndicator(o,r.endDate),s&&(s.hidden=h||!(null!=d&&d.enabled)),u&&(u.hidden=h),this.resources){var f,v=this.chipView;v.items=r.resources,null===(f=this.contentElement.querySelector(".b-resourcechipview"))||void 0===f||f.remove(),this.contentElement.appendChild(v.element.cloneNode(!0))}return i}},{key:"realign",value:function(){var e,n=this.lastAlignSpec;this.isVisible&&null!=n&&n.aligningToElement&&n.target.dataset.eventId!==String(null===(e=this.eventRecord)||void 0===e?void 0:e.id)&&this.hide(),B(t,"realign",this,3)(arguments)}},{key:"updateActiveClient",value:function(e){this.detachListeners("clientOverflowChange"),e&&e.ion({name:"clientOverflowChange",eventsPerCellChange:"onClientOverflowChange",thisObj:this})}},{key:"onClientOverflowChange",value:function(){li.isVisible(this.lastAlignSpec.target)||this.hide()}},{key:"onDocumentMouseDown",value:function(e){var n=e.event;if(n.button||"click"!==this.ownerFeature.showOn||!this.activeTarget.contains(n.target))return B(t,"onDocumentMouseDown",this,3)(arguments)}},{key:"chipView",get:function(){var e=this;return e._chipView||(e._chipView=new ZF({parent:e}),Object.defineProperty(e.chipView,"isVisible",{get:function(){return!0}}),e.chipView.triggerPaint()),e._chipView}}],[{key:"configurable",get:function(){return{localizableProperties:["timeFormat"],align:{monitorResize:!0},dateFormat:"ll",eventRecord:{$config:"nullify",value:null},recurrenceHint:"",timeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},axisLock:"flexible",closable:null,forSelector:".b-cal-event-wrap",maxWidth:"30em",minWidth:"14em",scrollAction:"realign",cls:{"b-sch-event-tooltip":1},tools:{edit:{cls:"b-icon-edit",handler:"up.onEditClick",tooltip:"L{EventEdit.Edit event}",weight:100},delete:{cls:"b-icon-trash",handler:"up.onDeleteClick",tooltip:"L{SchedulerBase.Delete event}",weight:0},maximize:null},titleRenderer:function(e){return Le.encodeHtml(e.name)},renderer:null,extendAllDayEndDay:null,activeClient:null,revealEventsInCluster:!0}}},{key:"delayable",get:function(){return{refreshContent:20}}}])}(pc);S(lL,"$name","EventTip"),S(lL,"type","eventtip"),lL.initClass(),lL._$name="EventTip";var sL=/^b-hover-(top|right|bottom|left)$/,uL=Symbol("eventDragMode"),cL=function(e,t){var n;return"b-cal-event-body"===e.className?e.children.push(n=t):Array.isArray(e.children)&&e.children.forEach((function(e){!n&&e&&(n=cL(e,t))})),n},dL=function(e){return Object.freeze(S({type:e,create:!1,move:!1,resize:!1},e,!0))},hL={create:{finisher:"finishDropCreate",mode:dL("create"),validatorFn:"validateCreateFn"},move:{finisher:"finishDropMove",mode:dL("move"),validatorFn:"validateMoveFn"},resize:{finisher:"finishDropResize",mode:dL("resize"),validatorFn:"validateResizeFn"}},fL={calendarrow:!0,monthview:!0,dayresourcecalendarrow:!0},vL=Symbol("meta"),gL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dayTime",get:function(){var e;return null===(e=this.view)||void 0===e?void 0:e.dayTime}},{key:"clearTime",value:function(e){return this.dayTime.startOfDay(e)}},{key:"findRootElement",value:function(e){return e.contentElement}},{key:"getDateFromPosition",value:function(e,t){return this.view.getDateFromPosition(e,t,!1,this.view.dayTime)}},{key:"dragEventer",get:function(){return this.owner}},{key:"beforeDrag",value:function(e){var t,n,r=this,i=r.owner,a=r.hitTest(e),o=null==a?void 0:a.eventRecord,l=r.view.rtl?"right":"left";if(!a||null!=o&&o.readOnly||null!=o&&o.isCreating)return!1;switch(a.date&&e.set("date",a.date),a.resource&&e.set("resource",a.resource),a.type){case"event":e.set("eventRecord",o),e.set("eventSourceHit",a),e.set("eventInset",a.eventElement.style[l]),e.set("eventWidth",a.eventElement.offsetWidth),t="move",(n=!i.draggable||!o.isDraggable||!1===r.draggable)||r.captureDragOffset(o,a,e);break;case"resize":e.set("eventRecord",o),e.set("eventSourceHit",a),e.set("eventInset",a.eventWrap.style[l]),e.set("eventWidth",a.eventWrap.offsetWidth),t="resize",n=!i.resizable||!o.resizable||!1===r.resizable;break;case"schedule":case"dayNumber":e.set("eventCreate",a),t="create",n=!i.creatable||!1===r.creatable;break;default:return!1}return!n&&(!1!==r.view["allowDrag".concat(Le.capitalize(t))]&&void e.set("eventDragMode",e[uL]=hL[t].mode))}},{key:"dragStart",value:function(){var e,t,n=this,r=n.dragging,i=n.owner,a=n.view,o=i.client,l=function(){r.lastMoveEvent&&r.move(r.lastMoveEvent)},s={scrollables:o.scrollManager?[{element:o.viewContainer.element,callback:l}]:[]};((n.isResizing||n.isMoving)&&(n.refocus=i.client.captureFocus()),n.isResizing)&&(null===(t=r.itemElement)||void 0===t||t.classList.add("b-resizing"));a.scrollable&&s.scrollables.push({element:a.scrollable.element,callback:l}),a.horizontalScroller&&s.scrollables.push({element:a.horizontalScroller.element,callback:l}),null===(e=o.scrollManager)||void 0===e||e.startMonitoring(s)}},{key:"captureDragOffset",value:function(){}},{key:"cleanupDrag",value:function(){var e,t=this,n=t.dragProxy,r=t.dragging,i=n.tooltip,a=t.view.isOverflowPopup?t.view.owner:t.view,o=t.owner.client,l=li.getActiveElement(o);null==r||null===(e=r.itemElement)||void 0===e||e.classList.remove("b-resizing"),null!=r&&r.aborted&&(t.days=null),a.afterRefresh((function(){var e;(t.eventRecord&&(t.days=null),li.getActiveElement(o)===l)&&(null===(e=t.refocus)||void 0===e||e.call(t,!1,!0));t.refocus=null})),i&&(i.hide(),n.tooltip=null)}},{key:"dragEnd",value:function(){var e;null===(e=this.owner.client)||void 0===e||null===(e=e._scrollManager)||void 0===e||e.stopMonitoring(),this.cleanupDrag()}},{key:"makeDays",value:function(e,t){var n=this.view,r=n.dayTime,i=n.firstVisibleDate,a=n.lastVisibleDate,o=[],l=_([e,t=Pl.add(t,-1,"d")].map((function(e){return e<i?i:a<e?a:e})),2);e=l[0],t=l[1];for(var s=r.startOfDay(e),u=r.ceil(t);!(u<s);s=Pl.add(s,1,"day"))o.push(r.dateKey(s));return o}},{key:"onShowOverflowPopup",value:function(e){var t=e.overflowPopup;this.overflow||(this.overflow=new DL({owner:this.owner,view:t}))}},{key:"calendarCellSelector",get:function(){return this.view.visibleCellSelector}},{key:"calendarCells",get:function(){var e=this.dropRootElement;return e&&li.children(e,this.calendarCellSelector)}},{key:"isCreating",get:function(){var e;return null===(e=this.dropping)||void 0===e||null===(e=e[uL])||void 0===e?void 0:e.create}},{key:"isMoving",get:function(){var e,t,n,r=(null===(e=this.dropping)||void 0===e?void 0:e[uL])||(null===(t=this.dragging)||void 0===t?void 0:t[uL]);return r?r.move:Boolean(null===(n=this.dropping)||void 0===n?void 0:n.peek("eventRecord"))}},{key:"isResizing",get:function(){var e;return null===(e=this.dragging)||void 0===e||null===(e=e[uL])||void 0===e?void 0:e.resize}},{key:"recurrable",get:function(){return this.isDayZone||this.isMonthZone}},{key:"cleanupDrop",value:function(){this.eventRecord=this.eventDom=this.days=null,this.noTip=!1}},{key:"createEvent",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.dropping,n=(null==t?void 0:t[uL])||hL.create.mode;this.setupEvent(e,n.create)}},{key:"dragDrop",value:(c=f(L().mark((function e(t){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isResizing&&t.target!==this){e.next=2;break}return e.abrupt("return",t.finalizer=this.finishDrop(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"dragEnter",value:function(e){var t=this,n=e[uL],r=e.source===t&&e.peek("eventSourceHit")||t.hitTest(e);if(t.isMoving)t._hit=r,t.startMove(e.peek("eventRecord"));else{if(!n||e.source!==t)return!1;if(n.resize)t._hit=r,t.startResize(r);else{if(!n.create)return!1;t._hit=r,t.startCreate(e.peek("date"),e.peek("eventCreate"))}}}},{key:"dragLeave",value:function(){this.isResizing||this.cleanupDrop()}},{key:"dragMove",value:function(e){this.hit=this.pickDropTarget(e)}},{key:"dropHitMove",value:function(e,t,n){var r=this,i=n.isScheduled?n:r.eventRecord,a=i.endDate,o=i.startDate,l=Pl.diff(o,a,"s"),s=t.date,u=t.resource;s=r.clearTime(s),n.allDay||(s=Pl.add(s,Pl.diff(r.clearTime(o),o,"s"),"s"));var c={startDate:s=r.applyDragOffset(s,e),endDate:Pl.add(s,l,"s")};null!=u&&u.eventColor&&(c.eventColor=u.eventColor),r.setEventData(c)}},{key:"dropHitNowhere",value:function(){this.days=null}},{key:"dropHitResize",value:function(e,t,n){var r,i,a=this,o=a.eventRecord,l=o.startDate,s=o.endDate,u=a.clearTime(t.date);(r=n.atEnd?{startDate:l,endDate:l<(i=Pl.add(u,1,"d"))?i:Pl.add(l,1,"d")}:{startDate:u<s?u:Pl.add(s,-1,"d"),endDate:s}).duration=Pl.diff(r.startDate,r.endDate,o.durationUnit),a.setEventData(r)}},{key:"finishDrop",value:(u=f(L().mark((function e(t){var n,r,i,a,o,l,s,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=this).eventRecord,i=n.owner,a=n.view,o=a.eventStore,l=t[uL],!(s=hL[(null==l?void 0:l.type)||"move"])||!n.hit){e.next=13;break}if(!s.validatorFn){e.next=8;break}return e.next=5,i.callback(i[s.validatorFn],i,[{drag:t,eventRecord:r,event:t.event}]);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=!0;case 9:if(!1===(u=e.t0)){e.next=13;break}return e.next=13,n[s.finisher](t,i,r,o,u,function(){var e=f(L().mark((function e(o,s,c){var d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d={drag:t,eventRecord:r,newStartDate:r.startDate,newEndDate:r.endDate,resourceRecord:n.hit.resource||a.resource,validation:u,event:t.event,feature:i,view:t[n.isResizing?"source":"target"].view},e.next=3,i.client.trigger("before"+Le.capitalize(o),d);case 3:if(!1!==e.sent){e.next=10;break}return d=!1,e.next=8,null==c?void 0:c();case 8:e.next=17;break;case 10:return a.allowTransitionsOnRefresh=!1,e.next=13,null==s?void 0:s();case 13:delete d.newStartDate,delete d.newEndDate,"create"!==(null==l?void 0:l.type)&&(d.eventRecord=t.peek("eventRecord")||r),i.client.trigger(o,d);case 17:return e.abrupt("return",d);case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}());case 13:n.isFinishing=!0,n.cleanupDrop();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"finishDropCreate",value:(s=f(L().mark((function e(t,n,r,i,a,o){var l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=!1!==(null==a?void 0:a.add),e.next=3,o("dragCreateEnd");case 3:!1===e.sent?l&&i.remove(r):l&&!i.includes(r)&&i.add(r);case 5:case"end":return e.stop()}}),e)}))),function(e,t,n,r,i,a){return s.apply(this,arguments)})},{key:"finishDropMove",value:(l=f(L().mark((function e(t,n,r,i,a,o){var l,s,u,c,d,h,v,g,m,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("eventRecord");case 2:return s=e.sent,c=(u=this).view,d=s.isOccurrence?s.recurringTimeSpan:s,h=t.source,e.next=9,t.get("resource");case 9:if(v=e.sent,g=u.hit.resource,h===u||null===(l=h.view)||void 0===l||!l.eventStore||!c.eventStore||h.view.eventStore===c.eventStore){e.next=16;break}e.t0=h.view.eventStore,e.next=19;break;case 16:return e.next=18,t.get("sourceStore");case 18:e.t0=e.sent;case 19:if(m=e.t0,(p=g&&g!==v)||t.source!==t.target||!Pl.isEqual(r.startDate,s.startDate)||!Pl.isEqual(r.endDate,s.endDate)){e.next=24;break}if(s.eventStore!==i){e.next=24;break}return e.abrupt("return");case 24:return e.next=26,o("dragMoveEnd",f(L().mark((function e(){var n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.getByInternalId(d.internalId)){e.next=10;break}return m?u.owner.removeFromExternalStore?m.remove(s):s=s.copy():s=r,s.setData("resourceId",null),i.add(s),e.next=6,u.moveEventTo(t,s);case 6:null!=(n=null!=g?g:!p&&!c.project.resourceStore.includes(s.resource)&&u.owner.client.defaultCalendarId)&&c.project.resourceStore.includes(n)?s.assign(n):c.project.resourceStore.includes(s.resource)||(s.resources=[]),e.next=17;break;case 10:return e.next=12,u.finishDropConfirm(s);case 12:if(!(s=e.sent)){e.next=17;break}return e.next=16,u.moveEventTo(t,s);case 16:p&&(s.isOccurrence&&s.convertToRealEvent(),s.assign(g),s.unassign(v));case 17:return e.next=19,c.project.commitAsync();case 19:case"end":return e.stop()}}),e)}))));case 26:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,a){return l.apply(this,arguments)})},{key:"finishDropResize",value:(a=f(L().mark((function e(t,n,r,i,a,o){var l,s,u,c,d,h=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.view,e.next=4,t.get("eventSourceHit");case 4:if(s=e.sent,u=s.eventRecord,c=s.edge,d=c.bottom||(l.rtl?c.left:c.right)?"endDate":"startDate",r[d]-u[d]){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,o("dragResizeEnd",f(L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.finishDropConfirm(u);case 2:return(t=e.sent)&&t.set({startDate:r.startDate,endDate:r.endDate,duration:Pl.diff(r.startDate,r.endDate,t.durationUnit)}),e.next=6,l.project.commitAsync();case 6:case"end":return e.stop()}}),e)}))));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,o){return a.apply(this,arguments)})},{key:"finishDropConfirm",value:(r=f(L().mark((function e(t){var n=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isOccurrence&&!t.isRecurring){e.next=2;break}return e.abrupt("return",new Promise((function(e){var r=n.owner.client.recurrenceConfirmationPopup;r.owner=n.owner,r.confirm({actionType:"update",eventRecord:t,cancelFn:function(){e(null)},changerFn:function(t){e(t)}})})));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"moveEventTo",value:(n=f(L().mark((function e(t,n){var r,i,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=this).view.getDateFromElement(t.targetElement),n.startDate&&(i=Pl.copyTimeValues(r.clearTime(i),n.startDate)),i=r.applyDragOffset(i,t),t.peek("sourceStore")===r.view.eventStore||n.startDate||(a=t.target.view.autoCreate||r.owner.client.autoCreate,i.setHours((null==a?void 0:a.startHour)||8)),e.next=7,r.setStartDate(n,i);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"pickDropTarget",value:function(e){var t,n=this.hitTest(e);return!n&&this.isResizing&&(n=this.hit),null!==(t=n)&&void 0!==t&&t.date?n:null}},{key:"setStartDate",value:function(e,t){return e.set({startDate:t,endDate:Pl.add(t,e.fullDuration)})}},{key:"getHoverHandleCls",value:function(e){return e?"":"b-gripper-vert"}},{key:"hoverEnter",value:function(){var e,t,n=this,r=n.hitTest(n.hoverTarget),i=n.owner.gripper,a=n.getHoverHandleCls(),o=n.getHoverHandleCls(!0);o&&i.classList.remove(o),!1===(null==r||null===(e=r.eventRecord)||void 0===e?void 0:e.resizable)||null!=r&&null!==(t=r.eventRecord)&&void 0!==t&&t.readOnly||(a&&i.classList.add(a),n.hoverTarget.appendChild(i))}},{key:"hoverLeave",value:function(e){var t=this.owner.gripper,n=this.getHoverHandleCls();t.parentNode===e&&(n&&t.classList.remove(n),e.removeChild(t))}},{key:"applyDragOffset",value:function(e,t){var n,r=t.peek("eventOffset");e&&null!=r&&r[0]&&(t.source.constructor===(null===(n=t.target)||void 0===n?void 0:n.constructor)&&(e=Pl.add(e,-r[0],r[1])));return e}},{key:"hitTest",value:function(e){var t,n,r=this,i=null==e?void 0:e.isDragContext,a=i?e.event:e,o=i&&e.targetElement||li.getEventElement(a),l=r.view,s=null;if(o){l.calendarHitTest||(l=r.owner.client);var u=l.rtl?"right":"left";(s=l.calendarHitTest(o))&&(s.eventWrap=n=o.closest(".b-cal-event-wrap"),o.classList.contains("b-gripper")?(s={type:"resize",cell:s.cell,date:s.date,edge:t={},eventRecord:s.eventRecord,resource:s.resource,eventWrap:n,gripper:o,view:s.view},Ct.normalize(n.className,"array").forEach((function(e){(e=sL.exec(e))&&(t[e[1]]=!0)})),s.atEnd=!(t.top||t[u])):s.eventRecord||(n=null),n&&(s.eventTop=n.style.top),o!==a&&(s.date=r.getDateFromPosition(a.clientX,a.clientY)||s.date))}return s}},{key:"renderEvent",value:function(e,t,n){var r,i,a=this.view,o=this.owner;Object.defineProperty(e,"assigned",this.assignmentsProperty);var l=a.createEventDomConfig({eventRecord:e,isAllDay:fL[a.type],asSelected:e.data.realEventId&&(null===(r=(i=o.client).isEventSelected)||void 0===r?void 0:r.call(i,e.data.realEventId))});if(l.className["b-cal-tentative-event"]=1,l.className["b-cal-tentative-event-first"]=t,l.className["b-cal-tentative-event-last"]=n,delete e.assigned,n){var s=o.footer;s&&!a.showTime.endTime&&cL(l,Be.assign({html:Pl.format(e.endDate,a.timeFormat)},s))}return l}},{key:"setEventData",value:function(e,t){var n=this,r=n.eventRecord,i=n.view,a=e,o=a.duration,l=a.startDate;if(l&&null!=o&&!e.endDate&&(e=F(F({},e),{},{endDate:Pl.add(l,o,r.durationUnit)})),r.set(e),n.eventDom)n.eventDom.className[i.shortEventCls]=r.rawDurationMS<=i.shortEventDuration;else{if(t){var s,u=n.owner.newName;if(u){var c=n.view.resolveCallback(u,i,!1);s=(null==c?void 0:c.handler.call(i,r))||u}else u=i.autoCreate.newName,s=i.resolveCallback(u,i,!1)?i.callback(u,i,[i,r.startDate,i.resource||i.defaultCalendar]):u;r.name=s}n.eventDom=n.renderEvent(r)}}},{key:"setupEvent",value:function(e,t){var n,r=this,i=r.owner,a=r.view,l=a.defaultCalendar,s=a.eventStore,u=i.tooltip,c=r.eventRecord=i.eventRecord=s.createRecord({}),d=t?new o([s.assignmentStore.createRecord({event:c,resource:l})]):e.assigned;r.assignmentsProperty={configurable:!0,value:d},delete e.assigned,e[vL]&&(c.meta=e[vL]),r.setEventData(e,t),r.isCreating&&l&&s.assignmentStore.assignEventToResource(c,l);var h=r.eventDom;return h.className["b-cal-tentative-event"]=1,r.noTip||u.disabled||null===(n=r.dragging)||void 0===n||!n.has("eventCreate")||(u.eventRecord=c,u.recurrenceHint=t&&r.recurrable?i.recurrenceTip:"",r.dragProxy.tooltip=u),h}},{key:"startCreate",value:function(e){this.createEvent({allDay:!0,startDate:e,durationUnit:this.durationUnit,endDate:Pl.add(e,1,"d")})}},{key:"durationUnit",get:function(){return this.view.dragUnit||ql.from(this.view.autoCreate.duration).unit||this.owner.durationUnit}},{key:"startMove",value:function(e){var t,n,r,i,a=this,o=Be.clone(e.dataByFieldName),l=a.dropping,s=a.hit,u=null!==(t=null==s||null===(n=s.resource)||void 0===n?void 0:n.eventColor)&&void 0!==t?t:null===(r=l.peek("resource"))||void 0===r?void 0:r.eventColor;(u&&!o.eventColor&&(o.eventColor=u),o.assigned=e.assigned,o.startDate||(o.startDate=(null==s?void 0:s.date)||new Date,o.endDate=Pl.add(o.startDate,e.duration||1,e.durationUnit||"h")),null!=s&&s.resource&&(o.resourceId=s.resource.id),o.resourceId)||(o.resourceId=l.peek("resourceId")||(null===(i=a.owner.client)||void 0===i?void 0:i.defaultCalendarId));o.realEventId=o.id,delete o.id,o[vL]=Be.clone(e.meta),a.setupEvent(o)}},{key:"startResize",value:function(e){var t,n=e.eventRecord,r=Be.clone(n.dataByFieldName);r[vL]=Be.clone(n.meta),this.createEvent(F(F({},r),{},{assigned:n.assigned,id:"dragResize-event-".concat(r.id),eventColor:r.eventColor||(null===(t=n.resource)||void 0===t?void 0:t.eventColor),recurrenceRule:null,realEventId:r.id}))}},{key:"configureListeners",value:function(e){var n=B(t,"configureListeners",this,3)([e]);return n.element=this.view.rootElement,n}},{key:"updateHit",value:function(e){var t=this,n=t.dropping,r=e&&n[uL];e?t.isMoving?t.dropHitMove(n,e,n.peek("eventRecord")):null!=r&&r.create?t.dropHitCreate(n,e,n.peek("eventCreate")):null!=r&&r.resize&&t.dropHitResize(n,e,n.peek("eventSourceHit")):t.dropHitNowhere(n)}},{key:"updateDays",value:function(e){var t,n,r,i,a,o=this,l=o.calendarCells,s=o.eventDom,u=o.dayValues,c=l&&{},d=!0;if(o.dayValues=c,l&&s){for(i=0;i<l.length;++i)t=l[i],null!=e&&e.includes(t.dataset.date)&&(a=t);for(i=0;i<l.length;++i)n=(t=l[i]).dataset.date,null!=e&&e.includes(n)&&((r=null==u?void 0:u[n])?delete u[n]:(r=o.includeDay(n,t,d,t===a)||!0,d=!1),c[n]=r);if(u){var h=function(){for(i in u)o.removeDay(i,u[i],o.isCreating)};e||!o.isCreating||o.dragging.aborted?h():o.view.afterRefresh(h)}}}},{key:"updateEventRecord",value:function(e){this.owner.eventRecord=e}},{key:"updateOverflow",value:function(e,t){return!e&&t&&t.destroy(),e}},{key:"updateOwner",value:function(e){this.hoverIgnoreElement=null==e?void 0:e.gripper}},{key:"updateRootElement",value:function(e){var t=this;t.dragRootElement=e,t.dropRootElement=t.droppable?e:null,t.owner.resizable||(t.hoverable=!1),t.hoverRootElement=t.hoverable?e:null}},{key:"updateView",value:function(e,n){var r;B(t,"updateView",this,3)([e,n]);var i=this;i.rootElement=e?i.findRootElement(e):null,null===(r=i._overflowDetacher)||void 0===r||r.call(i),null!=e&&e.isDayCellRenderer&&(i._overflowDetacher=e.ion({thisObj:i,showOverflowPopup:"onShowOverflowPopup"}))}}],[{key:"configurable",get:function(){return{droppableSelector:"*",droppable:!0,hoverable:null,hoverAnimationCls:"b-hover-anim",days:{$config:{equal:function(e,t){return Be.isEqual(e,t)&&(null==e?void 0:e.resource)===(null==t?void 0:t.resource)}},value:null},dragProxy:{type:"tip",tooltip:null},eventRecord:null,hit:null,dragItemSelector:".b-cal-event-wrap",overflow:{$config:"nullify",value:null},rootElement:null}}}]);var n,r,a,l,s,u,c}(XF.mixin(ty,ny,dy));S(gL,"$name","Zone"),gL.prototype._eventRecord=null;var mL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getHoverHandleCls",value:function(e){var t=this.isAllDayZone;return e&&(t=!t),"b-gripper-".concat(t?"vert":"horz")}}],[{key:"configurable",get:function(){return{hoverSelector:".b-cal-event-wrap",draggingClsSelector:".b-dayview-content"}}}])}(gL);S(mL,"$name","BaseDayZone");var pL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"dragEnter",value:function(e){return this.view.eventsPerCell||this.view.expandGutter(),B(t,"dragEnter",this,3)([e])}},{key:"dragLeave",value:function(e){this.view.collapseGutter(),B(t,"dragLeave",this,3)([e])}},{key:"captureDragOffset",value:function(e,t,n){n.set("eventOffset",[Math.max(Math.floor(Pl.diff(e.startDate,t.date,"d")),0),"d"])}},{key:"dropHitCreate",value:function(e,t,n){var r=this.clearTime(t.date),i=this.clearTime(n.date);if(r<i){var a=[r,i];i=a[0],r=a[1]}this.setEventData({startDate:i,duration:Pl.as(this.eventRecord.durationUnit,Pl.diff(i,r,"d")+1,"d")})}},{key:"moveEventTo",value:(n=f(L().mark((function e(t,n){var r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).hitTest(t),a=r.applyDragOffset(null==i?void 0:i.date,t),o=new Date(n.startDate),!a){e.next=8;break}return o.setFullYear(a.getFullYear()),o.setMonth(a.getMonth()),o.setDate(a.getDate()),r.view.dayTime.startShift?(o.setHours(a.getHours()),o.setMinutes(a.getMinutes()),o.setSeconds(a.getSeconds()),n.duration=1):r.view.isAllDayEvent(n)||(n.allDay=!0),e.next=8,r.setStartDate(n,o);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"setEventData",value:function(e,n){B(t,"setEventData",this,3)([e,n]);var r=this,i=r.eventRecord,a=i.startDate,o=i.endDate;n&&!r.view.dayTime.startShift&&(i.allDay=!0),r.days=r.makeDays(a,o)}},{key:"updateDays",value:function(e){var t=this,n=t.eventEl;if(null!=e&&e.length){var r;n||(t.eventEl=n=li.createElement(F({},t.eventDom)),n.classList.add("b-allday"));var i=t.dropRootElement,a=t.view,o=a.visibleCellSelector,l=a.weekLength,s=null===(r=t.dragging)||void 0===r||null===(r=r.peek("eventSourceHit"))||void 0===r?void 0:r.eventTop,u=li.children(i,o),c=li.down(i,"".concat(o,"[data-date='").concat(e[e.length-1],"']"));li.down(c,".b-cal-event-bar-container").appendChild(n),n.style[t.view.rtl?"right":"left"]=li.percentify(100*(u.indexOf(c)-e.length+1)/l),n.style.width=li.percentify(100*e.length/l),s&&(n.style.top=s),t.view.scrollable.scrollIntoView(n,!0)}else n&&(n.classList.contains("b-cal-tentative-event")&&n.remove(),t.eventEl=null)}},{key:"updateView",value:function(e,n){if(e){var r=Pl.diff(e.startDate,e.endDate,"d")>1;this.hoverable=r,this.draggable=r||this.view.owner.isDayView}B(t,"updateView",this,3)([e,n])}}],[{key:"configurable",get:function(){return{hoverEdges:"lr"}}}]);var n}(mL);S(pL,"$name","AllDayZone");var yL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];B(t,"construct",this,3)(n);var i=this,a=i.view.allDayEvents;a&&!1!==i.view.showAllDayHeader&&(i.allDayZone=new i.allDayZoneClass({owner:i.owner,view:a,resource:i.resource}))}},{key:"syncDraggingElements",value:function(e,t){var n,r,i=this.dragging,a=i.source.draggingItemCls,o=i.itemElement.closest(".b-dayview-day-container"),l=D(null!==(n=null==o?void 0:o.querySelectorAll('[data-event-id="'.concat(e,'"]')))&&void 0!==n?n:[]);try{for(l.s();!(r=l.n()).done;){r.value.classList.toggle(a,t)}}catch(e){l.e(e)}finally{l.f()}}},{key:"hitTest",value:function(e){var n=this.view,r=this.dragging,i=n.dayTime,a=B(t,"hitTest",this,3)([e]);if(a){var o=a.date,l=null!=e&&e.isDragContext?n.getDateFromPosition(e.event.clientX,pt.fromScreen(n.dayContainerElement).y+1,!1,i):i.startOfDay(a.date);if(r&&!this.isMoving&&!1===n.interDayResize||this.isMoving&&!1===n.interDayDrag){var s=r.peek("date");o.setDate(s.getDate()),o.setMonth(s.getMonth()),o.setFullYear(s.getFullYear()),l&&(l.setDate(s.getDate()),l.setMonth(s.getMonth()),l.setFullYear(s.getFullYear()))}a.overDate=l}return a}},{key:"updateDragEventId",value:function(e,t){t&&this.syncDraggingElements(t,!1),e&&this.syncDraggingElements(e,!0)}},{key:"eventRecord",get:function(){var e;return B(t,"eventRecord",this,1)||(null===(e=this.allDayZone)||void 0===e?void 0:e.eventRecord)},set:function(e){V(t,"eventRecord",e,this,1,1)}},{key:"recurring",get:function(){var e;return this.isCreating&&null!=(null===(e=this.eventRecord)||void 0===e?void 0:e.recurrenceRule)}},{key:"droppingAllDay",get:function(){var e,t,n=null===(e=this.dropping)||void 0===e?void 0:e.peek("eventRecord");return(null==n?void 0:n.startDate)&&(null===(t=this.view)||void 0===t?void 0:t.isAllDayEvent(n))||!1}},{key:"useAllDay",get:function(){return this.droppingAllDay&&this.view.showAllDayHeader&&this.dropping.source!==this.allDayZone}},{key:"wasAllDay",get:function(){return this.droppingAllDay&&this.dropping.source===this.allDayZone}},{key:"doDestroy",value:function(){var e;null===(e=this.allDayZone)||void 0===e||e.destroy(),B(t,"doDestroy",this,3)([])}},{key:"dragStart",value:function(){var e,n;B(t,"dragStart",this,3)([]),this.dragEventId=null!==(e=null===(n=this.dragging.peek("eventRecord"))||void 0===n?void 0:n.id)&&void 0!==e?e:null}},{key:"findRootElement",value:function(e){return e.eventContentElement}},{key:"captureDragOffset",value:function(e,t,n){n.set("eventOffset",[Math.floor(Pl.diff(e.startDate,t.date,"m")),"m"])}},{key:"cleanupDrag",value:function(){var e;this.dragEventId=null,B(t,"cleanupDrag",this,3)([]),null===(e=this.allDayZone)||void 0===e||e.cleanupDrag()}},{key:"cleanupDrop",value:function(){var e,n;B(t,"cleanupDrop",this,3)([]),null===(e=this.owner.client)||void 0===e||null===(e=e._scrollManager)||void 0===e||e.stopMonitoring(),null===(n=this.allDayZone)||void 0===n||n.cleanupDrop()}},{key:"dropHitCreate",value:function(e,t){var n,r,i=this,a=i.eventRecord.durationUnit,o=t.date,l=e.peek("eventCreate").date,s=o,u=l,c=!(i.clearTime(l)-i.clearTime(o)),d=e.ctrlKey&&!c;if(d||c){if(s=i.clearTime(o),l-=u=i.clearTime(l),o-=s,s<u){var h=[s,u];u=h[0],s=h[1]}if(o<l){var f=[o,l];l=f[0],o=f[1]}u.setTime(u.getTime()+l),n=Pl.as(a,Math.max(i.view.increment,Math.floor(o-l))),d&&(r=Pl.diff(i.clearTime(u),i.clearTime(s),"d")+1)}else{if(s<u){var v=[s,u];u=v[0],s=v[1]}n=Pl.as(a,Math.floor((s-u)/6e4),"m")}i.setEventData({startDate:u,duration:n,recurrenceRule:d?"FREQ=DAILY;COUNT=".concat(r):null})}},{key:"dropHitMove",value:function(e,t,n){var r=t.date,i=this,a=i.view,o=a.dayTime.startOfDay(r);if(i.useAllDay)i.allDayZone.dropHitMove(e,t,n);else{if(n=i.eventRecord,r=i.applyDragOffset(r,e),a.showAllDayHeader&&r<o)r=o;else if(!a.snapRelativeToEventStartDate){var l=e.event.clientX>e.startEvent.clientX?"ceil":"floor";r=Pl[l](r,a.increment)}i.setEventData({startDate:r,endDate:Pl.add(r,n.duration,n.durationUnit),duration:n.duration})}}},{key:"applyDragOffset",value:function(e,n){var r=B(t,"applyDragOffset",this,3)([e,n]);if(this.constrainToDay){var i=this.hit.overDate;r=new Date(Math.max(Math.min(r,i.getTime()+this.view.dayTime.timeEnd-this.eventRecord.rawDurationMS),i))}return r}},{key:"dropHitResize",value:function(e,t,n){var r=this,i=r.eventRecord,a=t.date;n.atEnd?i.startDate<a&&r.setEventData({endDate:a}):a<i.endDate&&r.setEventData({startDate:a})}},{key:"moveEventTo",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).hitTest(t),!(a=null==i?void 0:i.date)){e.next=11;break}if(!r.useAllDay){e.next=7;break}return e.next=5,r.allDayZone.moveEventTo(t,n);case 5:e.next=11;break;case 7:return o=r.view,l=r.applyDragOffset(a,t),s=t.event.clientX>t.startEvent.clientX?"ceil":"floor",u=o.snapRelativeToEventStartDate?l:Pl[s](l,o.increment),r.wasAllDay&&(c=Pl.add(o.dayTime.startOfDay(u),24,"h"),d=Pl.add(u,n.duration,n.durationUnit),n.allDay=!1,d>c&&(h=o.autoCreate||o.changeAutoCreate(!0),f=Pl.parseDuration(h.duration),v=new Date(Math.min(Pl.add(u,f.magnitude,f.unit),c)),g=Pl.diff(u,v,n.durationUnit),n.setDuration(g,n.unit))),e.next=11,r.setStartDate(n,u);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"startCreate",value:function(e){this.createEvent({duration:0,durationUnit:this.durationUnit,startDate:e,isCreating:!0})}},{key:"includeDay",value:function(e,t,n,r){return li.createElement(F({parent:t.querySelector(".b-dayview-event-container")},this.renderEvent(this.eventRecord,n,r)))}},{key:"removeDay",value:function(e,t){t.classList.contains("b-cal-tentative-event")&&t.remove()}},{key:"setEventData",value:function(e,n){var r=this;if(r.useAllDay)r.allDayZone.setEventData(e,n);else{B(t,"setEventData",this,3)([e,n]);var i=r.eventRecord,a=i.endDate,o=i.startDate,l=r.view.dayTime,s=a;r.recurring&&(s=Pl.add(s,i.recurrence.count-1,"d")),r.days=r.makeDays(o,s),r.times=[l.delta(o,"s"),l.delta(a,"s")]}}},{key:"setupEvent",value:function(e,n){this.useAllDay?this.allDayZone.setupEvent(e,n):(this.wasAllDay&&(e.allDay=!1,e.endDate=Pl.add(e.startDate,e.duration=1,e.durationUnit="hour")),B(t,"setupEvent",this,3)([e,n]))}},{key:"updateDays",value:function(e,n){B(t,"updateDays",this,3)([e,n]),this.updateTimes(this.times,null)}},{key:"updateTimes",value:function(e){if(e){var t,n,r,i,a,o,l,s,u=this,c=u.allDayZone,d=u.dayValues,h=u.dragging,f=u.eventRecord,v=u.isResizing,g=u.recurring,m=u.view,p=m.dayTime,y=m.eventSpacing,k=f.endDate,b=f.startDate,C=_(e,2),w=C[0],D=C[1],S=!(null!=h&&h.aborted)&&(null==h?void 0:h.peek("eventInset")),x=!(null!=h&&h.aborted)&&(null==h?void 0:h.peek("eventWidth")),E=m.rtl?"right":"left",R=p.dateKey(b),T=p.dateKey(k),M=p.startOfDay(b)<p.startOfDay(k),F=100/p.duration("s"),A=u.days;if(A){for(t in d)r=t===R,l=(n=d[t]).style,s=w*F,i=(D-w)*F,fa.sync({targetElement:n,domConfig:u.renderEvent(u.eventRecord,r,t===A[A.length-1])}),!g&&M&&(i=r?100-s:t===T?s+i:100),l.top=g||r?li.percentify(s):0,l.height=li.percentify(i),l.paddingBottom=li.setLength(y),v&&(S&&(l[E]=S),x&&(l.width="".concat(x,"px"))),(a=pt.from(n.querySelector(".b-cal-event-desc")))&&(o=pt.from(n.querySelector(".b-cal-event-footer")))&&n.classList.toggle("b-cal-event-footer-desc-overlap",Boolean(a.intersect(o)));if(!A||A.length<2||g)null==c||c.cleanupDrop(),A=null;else if(c&&m.showAllDayHeader){if(!c.eventRecord){c.noTip=!0;var I={startDate:f.startDate,endDate:f.endDate};if(v){var L=h.peek("eventRecord");I.assigned=L.assigned,I.eventColor=L.eventColor}c.createEvent(I,u.dropping)}c.eventRecord.set({startDate:f.startDate,endDate:Pl.add(f.startDate,A.length-1,"d")}),c.days=A}}}}}]);var n}(mL);S(yL,"$name","DayZone"),S(yL,"configurable",{dragEventId:null,hoverable:!0,hoverEdges:"tb",times:{$config:{equal:"array"},value:null},allDayZoneClass:pL,constrainToDay:!1});var kL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"findRootElement",value:function(){return this.view.eventContentElement}},{key:"hitTest",value:function(e){var t,n,r=gL.prototype.hitTest.call(this,e);r&&(r.hourElement=null===(t=(null===(n=e.event||e.domEvent)||void 0===n?void 0:n.target)||e)||void 0===t?void 0:t.closest("[data-hour]"));return r}},{key:"setEventData",value:function(){return gL.prototype.setEventData.apply(this,arguments)}},{key:"dropHitMove",value:function(e,t,n){var r=t.date,i=this,a=i.view,o=a.dayTime.startOfDay(r);if(n=i.eventRecord,r<o)r=o;else if(!a.snapRelativeToEventStartDate){var l=e.event.clientX>e.startEvent.clientX?"ceil":"floor";r=Pl[l](r,a.increment)}i.setEventData({startDate:r,endDate:Pl.add(r,n.duration,n.durationUnit),duration:n.duration})}},{key:"moveEventTo",value:(n=f(L().mark((function e(t,n){var r,i,a,o,l,s,u,c,d,h,f,v,g;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=this).hitTest(t),a=i.date,o=i.hourElement,!a||!o){e.next=6;break}return l=r.view,s=t.event.clientX>t.startEvent.clientX?"ceil":"floor",u=l.snapRelativeToEventStartDate?a:Pl[s](a,l.increment),r.wasAllDay&&(c=Pl.add(l.dayTime.startOfDay(u),24,"h"),d=Pl.add(u,n.duration,n.durationUnit),n.allDay=!1,d>c&&(h=l.autoCreate||l.changeAutoCreate(!0),f=Pl.parseDuration(h.duration),v=new Date(Math.min(Pl.add(u,f.magnitude,f.unit),c)),g=Pl.diff(u,v,n.durationUnit),n.setDuration(g,n.unit))),e.next=6,r.setStartDate(n,u);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}],[{key:"$name",get:function(){return"DayAgendaZone"}}]);var n}(yL);S(kL,"configurable",{hoverable:!1,dragProxy:{type:"default",open:function(e){var t=this,n=e.source,r=e.element.closest(".b-cal-event-wrap");t.proxyEl=r.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width="".concat(r.offsetWidth,"px"),t.proxyEl.style.setProperty("--cal-event-color",r.style.getPropertyValue("--cal-event-color")),t.proxyOffset=fr.getClientPoint(e.startEvent).getDelta(pt.from(r)),n.view.firstVisibleCell.appendChild(t.proxyEl)},dragMove:function(e){var t=e.source,n=t.view,r=t.eventRecord;t.hit&&this.proxyEl?(fa.sync({targetElement:this.proxyEl,domConfig:F(F({},t.renderEvent(r)),{},{onlyChildren:!0})}),li.alignTo(this.proxyEl,fr.getClientPoint(e.event).translate(20,20),{align:"t0-t0",constrainTo:t.dragRootElement}),n.overHour=t.hit.date):n.overHour=null},close:function(e){var t;e.source.view.overHour=null,null===(t=this.proxyEl)||void 0===t||t.remove()}}});var bL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"syncHoverListeners",value:function(){}},{key:"beforeDrag",value:function(e){var n=this.hitTest(e);return!(null==n||!n.resource||"resize"===n.type||"schedule"===n.type)&&B(t,"beforeDrag",this,3)([e])}},{key:"setupEvent",value:function(){return this.view.defaultCalendar=(this.dragging||this.dropping).peek("resource"),B(t,"setupEvent",this,3)(arguments)}},{key:"updateHit",value:function(e,n){e&&!e.resource||B(t,"updateHit",this,3)([e,n])}},{key:"makeDays",value:function(e){var n,r=this,i=r.isMoving,a=r.dragging||r.dropping,o=i?new Date(Math.max(e,r.view.firstVisibleDate)):a.peek("date"),l=B(t,"makeDays",this,3)([o,Pl.add(o,1,"d")]);return l.resource=null===(n=r.hit)||void 0===n?void 0:n.resource,l}},{key:"updateDays",value:function(e){var t=this,n=t.view,r=t.eventEl;if(null!=e&&e.length){var i;r||(t.eventEl=r=li.createElement(F({},t.eventDom)),r.classList.add("b-allday"));var a=null===(i=t.dragging)||void 0===i||null===(i=i.peek("eventSourceHit"))||void 0===i?void 0:i.eventTop;li.down(t.dropRootElement,"".concat(n.visibleCellSelector,":is(").concat(e.map((function(e){return'[data-date="'.concat(e,'"]')})).join(","),') [data-resource-id="').concat(e.resource.id,'"] > .b-cal-event-bar-container')).appendChild(r),r.style.width="100%",a&&(r.style.top=a),n.scrollable.scrollIntoView(r,!0)}else r&&(r.classList.contains("b-cal-tentative-event")&&r.remove(),t.eventEl=null)}}])}(pL);S(bL,"$name","ResourceCalendarRowZone"),S(bL,"configurable",{droppableSelector:".b-calendarrow-cell-container,.b-dayresourcecalendarrow-cell-resources,.b-dayresource-allday.b-cal-cell-header"});var CL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"beforeDrag",value:function(e){var n=this.hitTest(e);return!(null==n||!n.resource)&&B(t,"beforeDrag",this,3)([e])}},{key:"setupEvent",value:function(){return this.view.defaultCalendar=(this.dragging||this.dropping).peek("resource"),B(t,"setupEvent",this,3)(arguments)}},{key:"hitTest",value:function(e){var n=this.dragging||this.dropping,r=B(t,"hitTest",this,3)([e]);if(r&&n&&!this.isMoving){var i=n.peek("date");r.resource=n.peek("resource"),r.date.setDate(i.getDate()),r.date.setMonth(i.getMonth()),r.date.setFullYear(i.getFullYear())}return r}},{key:"updateHit",value:function(e,n){e&&!e.resource||B(t,"updateHit",this,3)([e,n])}},{key:"makeDays",value:function(e,n){var r,i=this,a=i.isMoving,o=i.dragging||i.dropping,l=a?e:o.peek("date"),s=B(t,"makeDays",this,3)([l,Pl.add(l,1,"d")]);return s.resource=null===(r=i.hit)||void 0===r?void 0:r.resource,s}},{key:"updateDays",value:function(e){var t=this,n=t.eventEl;if(null!=e&&e.length){var r=li.down(t.dropRootElement,":is(".concat(e.map((function(e){return'[data-date="'.concat(e,'"]')})).join(","),") ").concat(t.view.visibleCellSelector,'[data-resource-id="').concat(e.resource.id,'"] .b-dayview-event-container'));n||(t.eventEl=n=li.createElement(F({},t.eventDom))),r.appendChild(n)}else n&&(n.classList.contains("b-cal-tentative-event")&&t.view.setTimeout((function(){return n.remove()}),100),t.eventEl=null);t._times=null}},{key:"updateTimes",value:function(e){if(e&&this.days){var t=this,n=t.view,r=n.dayTime,i=n.eventSpacing,a=_(e,2),o=a[0],l=a[1],s=100/r.duration("s"),u=t.eventEl.style,c=o*s,d=(l-o)*s;fa.sync({targetElement:t.eventEl,domConfig:t.renderEvent(t.eventRecord,!0,!0)}),u.top=li.percentify(c),u.height=li.percentify(d),u.paddingBottom=li.setLength(i),u.width="100%"}}}])}(yL);S(CL,"$name","DayResourceZone"),S(CL,"configurable",{allDayZoneClass:bL});var wL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"findRootElement",value:function(e){return e.weeksElement}},{key:"captureDragOffset",value:function(e,t,n){n.set("eventOffset",[Math.floor(Pl.diff(this.clearTime(e.startDate),t.date,"d")),"d"])}},{key:"cleanupDrag",value:function(){var e=this;B(t,"cleanupDrag",this,3)([]);var n=function(){return e.coverage=null};this.isCreating?this.view.afterRefresh(n):n()}},{key:"cleanupDrop",value:function(){var e,n=this;B(t,"cleanupDrop",this,3)([]),null===(e=this.owner.client)||void 0===e||null===(e=e._scrollManager)||void 0===e||e.stopMonitoring();var r=function(){return n.coverage=null};this.isCreating?this.view.afterRefresh(r):r()}},{key:"dropHitCreate",value:function(e,t){var n,r,i,a,o,l,s,u=this,c=e.ctrlKey,d=e.peek("eventCreate"),h=null;if(a=u.clearTime(t.date),o=u.clearTime(d.date),r=d.dayNumber,i=t.dayNumber,l=d.weekOffset,(s=t.weekOffset)<l){var f=[s,l];l=f[0],s=f[1]}if(c){if(h=(n=s-l+1)>1?"FREQ=WEEKLY;COUNT=".concat(n):null,a<o?(o=a,r<i&&(o=Pl.add(o,r-i,"d"))):i<r&&(o=Pl.add(o,i-r,"d")),i<r){var v=[i,r];r=v[0],i=v[1]}}else if(a<o){var g=[a,o];o=g[0],a=g[1];var m=[i,r];r=m[0],i=m[1]}u.setEventData({startDate:o,duration:Pl.as(u.eventRecord.durationUnit,(c?i-r:Pl.diff(o,a,"d"))+1,"d"),recurrenceRule:h})}},{key:"dropHitNowhere",value:function(e){B(t,"dropHitNowhere",this,3)([e]),this.coverage=null}},{key:"setEventData",value:function(e,n){B(t,"setEventData",this,3)([e,n]);var r=this.dropping,i=this.eventRecord,a=this.view,o=a.visibleCellSelector,l=li.children(a.weeksElement,"> .b-calendar-week"),s={},u=function(e){for(var t,n,r,i,u=e.startDate,c=e.endDate,d=0;d<l.length;++d){for(i=(t=li.children(l[d],o)).length,n="",r=0;r<i;++r){var h=a.getDateFromElement(t[r]),f=Pl.add(h,1,"d");u<f&&h<c&&(!r&&u<h&&(n="<"),n+=r,r===i-1&&f<c&&(n+=">"))}n&&(s[d]||(s[d]=[])).push(n)}};null!=r&&r.has("eventRecord")||!i.recurrence?u(i):i.recurrence.forEachOccurrence(a.startDate,a.endDate,u),this.coverage=s}},{key:"updateCoverage",value:function(e){var t,n,r,i,a,o,l,s,u,c,d,h=this,f=h.dragging,v=h.weekValues,g=h.view,m=g.rtl,p=g.visibleCellSelector,y=e&&(null==f?void 0:f.peek("eventSourceHit")),k=null==y?void 0:y.eventTop,b={},C=g.getWeekElementFor(null==y?void 0:y.eventElement),w=g.weekElements;for(h.weekValues=b,u=0;u<w.length;++u)if(i=null==e?void 0:e[u])for(d=w[u],n=li.children(d,p),c=0;c<i.length;++c){var D;(o=null==v||null===(D=v[u])||void 0===D?void 0:D.shift())||(o=li.createElement(h.eventDom)),(b[u]||(b[u]=[])).push(o),l=(r=i[c]).includes("<")?1:0,s=r.includes(">")?1:0,r=r.substr(l,r.length-s-l),o.classList[l?"add":"remove"]("b-continues-past"),o.classList[s?"add":"remove"]("b-continues-future"),o.style[m?"right":"left"]=li.percentify(100*Number(r[0])/n.length),o.style.width=li.percentify(100*r.length/n.length),k&&d===C&&(o.style.top=k),t=n[Number(r[r.length-1])],(a=li.down(t,".b-cal-event-bar-container"))!==o.parentNode&&a.appendChild(o)}if(v)for(u in v)v[u].forEach((function(e){e.classList.contains("b-cal-tentative-event")&&e.remove()}))}}],[{key:"configurable",get:function(){return{coverage:{$config:{equal:Be.isEqual},value:null},hoverable:!0,hoverEdges:"lr",hoverSelector:".b-cal-event-wrap.b-allday"}}}])}(gL);S(wL,"$name","MonthZone");var DL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"findRootElement",value:function(e){return e.contentElement}},{key:"beforeDrag",value:function(e){var t=this.hitTest(e);if("event"!==(null==t?void 0:t.type)||!this.owner.draggable||!t.eventRecord.isDraggable)return!1;e.set("eventRecord",t.eventRecord),e.set("eventDragMode",e[uL]=hL.move.mode)}},{key:"dragStart",value:function(){this.view.hide()}}],[{key:"configurable",get:function(){return{droppable:!1,dragProxy:{type:"default",open:function(e){var t=this,n=e.source.view.owner,r=e.element.closest(".b-cal-event-wrap");n.isYearView&&(t.proxyEl=r.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width="".concat(r.offsetWidth,"px"),t.proxyOffset=fr.getClientPoint(e.startEvent).getDelta(pt.from(r)),n.contentElement.appendChild(t.proxyEl))},dragMove:function(e){this.proxyEl&&li.alignTo(this.proxyEl,fr.getClientPoint(e.event).translate(15,15),{align:"t0-t0"})},close:function(){var e;null===(e=this.proxyEl)||void 0===e||e.remove()}}}}}])}(gL);S(DL,"$name","OverflowZone");var SL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"startCreate",value:function(){var e;null===(e=this.view._overflowPopup)||void 0===e||e.hide(),B(t,"startCreate",this,3)(arguments)}},{key:"dragEnter",value:function(e){var n=B(t,"dragEnter",this,3)([e]);return!1!==n&&this.view.contentElement.classList.add(this.draggingCls),n}},{key:"dragLeave",value:function(e){B(t,"dragLeave",this,3)([e]),this.view.contentElement.classList.remove(this.draggingCls)}},{key:"dropHitCreate",value:function(e,t,n){var r=this,i=r.clearTime(t.date),a=r.clearTime(n.date);if(i<a){var o=[i,a];a=o[0],i=o[1]}r.setEventData({startDate:a,endDate:Pl.add(i,1,"d")}),r.days=r.makeDayRange(a,i)}},{key:"dropHitMove",value:function(e,n,r){B(t,"dropHitMove",this,3)([e,n,r]);var i=this,a=i.eventRecord,o=a.endDate;a.allDay&&(o=Pl.add(o,-1,"d")),i.days=i.makeDayRange(a.startDate,o)}},{key:"includeDay",value:function(e){var t=this,n=li.children(this.view.bodyElement,"[data-date='".concat(e,"']"));return n.forEach((function(e){return e.classList.add("b-cal-tentative-event".concat(t.view.hideNonWorkingDays?":not(.b-nonworking-day)":""))})),n}},{key:"makeDayRange",value:function(e,t){for(var n=[],r=e;r<=t;r=Pl.add(r,1,"d"))n.push(Pl.format(r,"YYYY-MM-DD"));return n}},{key:"removeDay",value:function(e,t){t.forEach((function(e){return e.classList.remove("b-cal-tentative-event")}))}}])}(gL);S(SL,"$name","YearZone");var xL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"updateView",value:function(e){var t=this;e.eachView((function(e){t.onResourceViewViewCreate({view:e})})),e.ion({viewCreate:"onResourceViewViewCreate",thisObj:this})}},{key:"onResourceViewViewCreate",value:function(e){var t=e.view,n=this.zones,r=this.owner,i=r.client.constructor.Modes,a=r.getViewZoneType(i.resolveType(t.type));a&&n.push(r.createZone(a,{view:t,resource:t.defaultCalendar}))}},{key:"changeZones",value:function(e,t){if(null!=t&&t.length&&!e)for(var n=0,r=t.length;n<r;n++)t[n].destroy();return e}}],[{key:"configurable",get:function(){return{view:null,zones:{$config:["nullify"],value:[]}}}}])}(Mn),EL=function(e){function t(){var e;m(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return S(e=g(this,t,[].concat(r)),"callOnFunctions",!0),e}return R(t,e),w(t,[{key:"onBeforeDragStart",value:function(e){var t,n=this.client,r=e.drag,i=e.event,a=r.source.view,o=r[uL].type,l=null===(t=a.getResourceRecord)||void 0===t?void 0:t.call(a,r.element),s=r.peek("date"),u={drag:r,domEvent:i,view:a,date:s,resourceRecord:l,eventRecord:r.peek("eventRecord"),feature:this.owner};return!1!==n.trigger("beforeDrag".concat(Le.capitalize(o)),u)&&("create"===r.peek("eventDragMode").type?n.trigger("beforeAutoCreate",{view:a,domEvent:i,date:s,resourceRecord:l}):void 0)}},{key:"changeGripper",value:function(e,t){return null==t||t.remove(),e&&li.createElement(e)}},{key:"changeTooltip",value:function(e,t){return e&&(e=!0===e?this.constructor.configurable.tooltip.value:e,this.initialConfig.tooltip&&(e.disabled=!1),e.ownerFeature=this),Lo.reconfigure(t,e,this)}}],[{key:"configurable",get:function(){return{disableOnReadOnly:!0,localizableProperties:["newName","recurrenceTip"],creatable:!0,draggable:!0,durationUnit:null,footer:{className:"b-cal-event-footer"},gripper:{class:"b-gripper"},newName:"L{newEvent}",recurrenceTip:"(L{holdCtrlForRecurrence})",resizable:!0,tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",disabled:!0,forSelector:null,tools:null}},validateCreateFn:function(){},validateMoveFn:function(){},validateResizeFn:function(){},zoneTypes:{day:yL,dayagenda:kL,month:wL,year:SL,resource:xL,dayresource:CL},removeFromExternalStore:!0}}}])}(KF);S(EL,"$name","CalendarDrag"),S(EL,"type","drag"),EL.initClass(),EL._$name="CalendarDrag";var RL={wrapStartDate:{get:function(){return Pl.add(this.startDate,ql.from(this.preamble).negate())}},wrapEndDate:{get:function(){return Pl.add(this.endDate,ql.from(this.postamble))}},outerStartDate:{get:function(){return this.wrapStartDate}},outerEndDate:{get:function(){return this.wrapEndDate}}},TL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onEventDataGenerated",value:function(e,t){var n=e.eventRecord,r=e.resourceRecord,a=e.view,o=t.children;if(Object.getOwnPropertyDescriptor(n.constructor.prototype,"wrapStartDate")||Object.defineProperties(n.constructor.prototype,RL),this.enabled&&a.isDayView){var l,s,u=this.showDuration,c=this.renderer,d={},h={},f=ql.from(n.preamble),v=ql.from(n.postamble);c&&a.callback(c,a,[{eventRecord:n,resourceRecord:r,preambleConfig:d,postambleConfig:h}]),null!==(l=f)&&void 0!==l&&l.magnitude||(f=null),null!==(s=v)&&void 0!==s&&s.magnitude||(v=null);var g=f?Pl.as("minute",f):0,m=v?Pl.as("minute",v):0;if(f){var p,y={className:S({"b-cal-event-buffer":1,"b-cal-preamble":1},d.cls,d.cls),style:{height:"calc(var(--hour-height) * ".concat(g/60," + 1px)")},children:u?[{className:"b-travel-time-label",children:[d.icon?{tag:"i",className:d.icon}:i,{tag:"span",className:"b-buffer-label",text:null!==(p=d.text)&&void 0!==p?p:f.toString()}]}]:i};u&&d.tooltip&&(y.children[0].dataset={btip:d.tooltip}),o.push(y)}if(v){var k,b={className:S({"b-cal-event-buffer":1,"b-cal-postamble":1},h.cls,h.cls),style:{height:"calc(var(--hour-height) * ".concat(m/60," + 1px)")},children:u?[{className:"b-travel-time-label",children:[h.icon?{tag:"i",className:h.icon}:i,{tag:"span",className:"b-buffer-label",text:null!==(k=h.text)&&void 0!==k?k:v.toString()}]}]:i};u&&h.tooltip&&(b.children[0].dataset={btip:h.tooltip}),o.push(b)}}}},{key:"updateShowDuration",value:function(){this.isConfiguring||this.client.eachView("refresh")}},{key:"doDisable",value:function(){this.isConfiguring||this.client.eachView("refresh")}}],[{key:"pluginConfig",get:function(){return{chain:["onEventDataGenerated"]}}}])}(KF);S(TL,"$name","EventBuffer"),S(TL,"type","eventBuffer"),S(TL,"configurable",{showDuration:!0,renderer:null}),KF.register(TL.type,TL),TL._$name="EventBuffer";var ML={magnitude:1,unit:"hour"},FL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"beforeDrag",value:function(e){return this.owner.onDragStart(e)}},{key:"dragEnter",value:function(e){e.source.isMoving&&(e.element=e.targetElement,this.dragProxy.open(e))}},{key:"dragMove",value:function(e){if(e.source.isMoving&&this.dragProxy.dragMove(e),e.source.isMoving||e.source.isExternalZone)return this.owner.onDragMove(e)}},{key:"dragDrop",value:function(e){if(e.source.isMoving&&this.dragProxy.close(),e.target===this&&(e.source.isMoving||e.source.isExternalZone))return this.owner.onDragDrop(e)}}],[{key:"configurable",get:function(){return{dragItemSelector:".b-grid-row",dragProxy:{type:"default",open:function(e){var t=this.owner.owner,n=t.openProxy(e);return e.cleaners.push((function(){t.insertionPoint=null,n.remove()})),n},dragMove:function(e){return this.owner.owner.moveProxy(e)},close:function(){var e;null===(e=this.owner.owner.proxyEl)||void 0===e||e.remove()}}}}}])}(Mn.mixin(ty,ny));S(FL,"$name","ExternalZone");var AL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.client.isPainted&&this.onCalendarPaint({source:this.client,firstPaint:!0})}},{key:"onCalendarPaint",value:function(e){var t=e.source;if(e.firstPaint){var n=this.draggable,r=void 0===n?{}:n,i=this.droppable,a=void 0===i?{}:i,o=new FL(F(F({view:this.grid},r),a));this._draggable&&(this._draggable=o),this._droppable&&(this._droppable=o)}t.ion({beforeDragMoveEnd:"onBeforeDragMoveEnd",dragMoveEnd:"onDragMoveEnd",thisObj:this})}},{key:"onBeforeDragMoveEnd",value:function(e){var t=e.drag;if(t.source===this.draggable){var n;t.dropOnCalendar=!0;var r=null===(n=this.grid)||void 0===n?void 0:n.store,i=this.client.trigger("beforeDropExternal",t);return(null==r?void 0:r.isChained)&&r.fillFromMaster(),i}}},{key:"onDragMoveEnd",value:function(e){var t=e.drag;if(t.source===this.draggable)return this.client.trigger("dropExternal",t)}},{key:"onDragStart",value:function(e){var t,n=this,r=n.client,i=n.grid,a=r.eventStore,o=a.modelClass;if(!e.itemElement)return!1;var l=n.callback(n.getRecordFromElement,n,[e.itemElement]);if(l.isModel)i&&e.set("sourceStore",i.store),l.isEventModel||(l=a.createRecord(l.data));else{if("string"==typeof l){var s=r.activeView.autoCreate||r.autoCreate,u=Pl.parseDuration((null==s?void 0:s.duration)||ML);l=S(S(S({},o.getFieldDataSource("name"),l),o.getFieldDataSource("duration"),u.magnitude),o.getFieldDataSource("durationUnit"),u.unit)}l=a.createRecord(l)}e.set("sourceStore",null===(t=n.grid)||void 0===t?void 0:t.store),e.set("eventRecord",l),e.eventRecord=l}},{key:"onDragMove",value:function(e){var t=this.grid;if(t){var n=t.rowManager.getRowFor(e.targetElement),r=n&&t.store.getAt(n.index);if(n){var i=e.lastMoveEvent.clientY<n.getRectangle(Object.keys(t.subGrids)[0]).center.y;e.overIndex=n.index,e.overRecord=r,e.isAbove=i,this.insertionPoint=r===e.peek("eventRecord")?{}:{row:n,isAbove:i}}else if(t.contains(e.targetElement)){var a=t.headerContainer.classList,o=t.rowManager.bottomRow;e.overIndex=(null==o?void 0:o.index)||-1,e.overRecord=o?t.store.getById(o.id):null,e.isAbove=!1,this.insertionPoint={row:o||{addCls:function(e){return a.add(e)},removeCls:function(e){return a.remove(e)}}}}else e.overIndex=NaN,this.insertionPoint=null}e.eventRecord=e.data.get("eventRecord"),this.client.trigger("dragMoveExternal",e)}},{key:"changeInsertionPoint",value:function(e,t){if((null==e?void 0:e.row)!==(null==t?void 0:t.row)||(null==e?void 0:e.isAbove)!==(null==t?void 0:t.isAbove))return e}},{key:"updateInsertionPoint",value:function(e,t){var n,r;null==t||null===(n=t.row)||void 0===n||n.removeCls(t.isAbove?"b-drop-above":"b-drop-below"),null==e||null===(r=e.row)||void 0===r||r.addCls(e.isAbove?"b-drop-above":"b-drop-below")}},{key:"onDragDrop",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.client,r=this.grid,i=n.eventStore,a=t.eventRecord,o=null==r?void 0:r.store,l=o===i||(null==o?void 0:o.masterStore)===i,!1!==n.trigger("beforeDropExternal",t)){e.next=4;break}return(null==o?void 0:o.isChained)&&o.fillFromMaster(),e.abrupt("return");case 4:isNaN(t.overIndex)||(!i.includes(a)||l||t.source.view.resource||i.remove(a),l?i.move(a,i.getAt(t.overIndex+t.isAbove?1:0)):o.insert(t.overIndex+(t.isAbove?0:1),a),(null==o?void 0:o.isChained)&&o.fillFromMaster()),n.trigger("dropExternal",t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"openProxy",value:function(e){var t,n=this.grid,r=this.dragRootElement,i=this.client,a=e.element.closest(this.draggable.dragItemSelector)||e.element,o=n?a.querySelector('[data-column="name"]'):a,l=this.proxyEl||(this.proxyEl=li.createElement({className:"b-grid-to-cal-drag-proxy"})),s=(null==n?void 0:n.element)||r.parentNode,u=i.element.contains(s)?i.element:s;return l.innerHTML=(null===(t=e.peek("eventRecord"))||void 0===t?void 0:t.name)||(null==o?void 0:o.innerHTML)||this.owner.L("L{newEvent}"),this.proxyOffset=fr.getClientPoint(e.event).getDelta(pt.from(a)),u.appendChild(l),l}},{key:"moveProxy",value:function(e){var t,n=this.proxyEl,r=e.targetElement,i=this.client.activeView;n&&((i.eventContentElement.contains(r)||(null===(t=i.allDayEvents)||void 0===t?void 0:t.contains(r)))&&this.hideExternalProxy?n.classList.add("b-hide-display"):(n.classList.remove("b-hide-display"),li.alignTo(n,fr.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})))}},{key:"changeDragRootElement",value:function(e){return"string"==typeof e&&(e=document.querySelector(e)||document.getElementById(e)),e}},{key:"changeDraggable",value:function(e){var n=this.grid,r=(null==n?void 0:n.contentElement)||this.dragRootElement,i=this.dragItemSelector;return e=t.mergeConfigs({owner:this,grid:n},e),r&&(e.dragRootElement=r),i&&(e.dragItemSelector=i),e}},{key:"changeDroppable",value:function(e){var n=this.grid,r=(null==n?void 0:n.contentElement)||this.dropRootElement;return e&&(e=t.mergeConfigs({owner:this,grid:n},e),r&&(e.dropRootElement=r)),e}},{key:"changeGrid",value:function(e){if(e){var t=W(e),n=this.client,r=n.resourceStore,i=n.project;"string"===t&&(e=Lo.getById(e)),e.setConfig({resourceStore:r,project:i})}return e}}],[{key:"delayable",get:function(){return{onCalendarPaint:"raf"}}},{key:"configurable",get:function(){return{grid:{$config:["lazy"],value:null},dragRootElement:{$config:"lazy",value:null},dragItemSelector:null,getRecordFromElement:function(e){var t=this.grid||(this.grid=Lo.fromElement(e,"grid"));return t?t.getRecordFromElement(e):e.innerText},hideExternalProxy:!0,draggable:{$config:["lazy"],value:{}},droppable:{$config:["lazy"],value:null},insertionPoint:null}}}]);var n}(KF.mixin($i));S(AL,"$name","ExternalEventSource"),S(AL,"type","externalEventSource"),AL.initClass(),AL._$name="ExternalEventSource";var IL=function(e){function t(e){return m(this,t),g(this,t,[e.client,e])}return R(t,e),w(t,[{key:"exporter",get:function(){var e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}])}(SF);S(IL,"$name","ExcelExporter"),S(IL,"type","excelExporter"),KF.register(IL.type,IL),IL._$name="ExcelExporter";var LL,OL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(e){var n=e.client;n.eventStore.syncDataOnLoad=!1,n.ion({dateRangeRequested:"onClientDateRangeRequested",thisObj:this}),n.crudManager.ion({beforeLoadApply:"onCrudManagerBeforeApply",thisObj:this,prio:9999}),B(t,"construct",this,3)(arguments)}},{key:"hasOutstandingLoadFor",value:function(e,t){var n=this.client.crudManager.activeRequests.load;if(n){var r,i=null===(r=n.options)||void 0===r?void 0:r.dateRangeRequested;if(i&&Pl.timeSpanContains(i.startDate,i.endDate,e,t))return!0}}},{key:"onCrudManagerBeforeApply",value:function(e){var t=e.response,n=e.options;this.lastRangeLoaded=t.success&&(null==n?void 0:n.dateRangeRequested)}},{key:"onClientDateRangeRequested",value:function(e){var t=e.new,n=t.startDate,r=t.endDate,i=e.changed,a=this,o=a.client;if(i||!a.alwaysLoadNewRange){if(a.lastRangeLoaded&&!a.alwaysLoadNewRange){var l=a.lastRangeLoaded,s=l.startDate,u=l.endDate;if(Pl.timeSpanContains(s,u,n,r))return}i&&(li.addTemporaryClass(o.element,"b-notransition",100,o),a.clearOnNewRange&&(o.eventStore.clear(!0),a.lastRangeLoaded=null)),a.disabled||a.hasOutstandingLoadFor(n,r)||a.loadDateRange(n,r)}}},{key:"refresh",value:function(){var e=this.lastRangeLoaded;e&&this.loadDateRange(e.startDate,e.endDate)}},{key:"loadDateRange",value:function(e,t){var n=this,r=n.pendingLoad,i=n.client,a=i.datePicker;if(null!=a&&a.showEvents){var o=i.activeView;e=new Date(Math.min(o.startDate,a.startDate)),t=new Date(Math.max(o.endDate,a.endDate))}r?(r.startDate=Pl.min(e,r.startDate),r.endDate=Pl.max(t,r.endDate)):(n.pendingLoad={startDate:e,endDate:t},n.client.requestAnimationFrame((function(){return n.load()})))}},{key:"load",value:(n=f(L().mark((function e(){var t,n,r,i,a,o,l,s,u,c,d;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=this).client,r=t.beforeRequest,i=t.dateFormat,a=n.crudManager,o=a.activeRequests.load,l=t.pendingLoad,s=l.startDate,u=l.endDate,c={dateRangeRequested:t.pendingLoad,request:{params:S(S({},t.startDateParamName,Pl.format(s,i)),t.endDateParamName,Pl.format(u,i))}},t.pendingLoad=null,r&&t.callback(r,n,[c]),!o){e.next=14;break}if(!t.hasOutstandingLoadFor(s,u)){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,a.cancelRequest(o.desc,o.reject);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(7);case 14:return e.prev=14,e.next=17,a.load(c);case 17:d=e.sent,e.next=23;break;case 20:e.prev=20,e.t1=e.catch(14),n.isDestroyed||e.t1.cancelled||!1===n.trigger("loadOnDemandFail",e.t1)||vb.alert({title:n.L("L{Calendar.loadFail}"),message:e.t1.message});case 23:d&&!n.isDestroyed&&n.trigger("dateRangeLoad",{response:d.response,options:c,startDate:s,endDate:u});case 24:case"end":return e.stop()}}),e,this,[[7,12],[14,20]])}))),function(){return n.apply(this,arguments)})}]);var n}(KF);S(OL,"$name","LoadOnDemand"),S(OL,"type","loadOnDemand"),S(OL,"configurable",{startDateParamName:"startDate",endDateParamName:"endDate",dateFormat:"YYYY-MM-DD",beforeRequest:null,alwaysLoadNewRange:null,clearOnNewRange:null}),OL.initClass(),OL._$name="LoadOnDemand";var PL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"restoreState",value:function(e){e.client}},{key:"saveState",value:function(e){e.client}},{key:"cloneElement",value:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:this.element;(!(arguments.length>2&&arguments[2]!==i)||arguments[2])&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0))}},{key:"pageTpl",value:function(e){var t=e.config,n=e.title,r=e.header,i=e.footer,a=e.styles,o=e.htmlClasses,l=e.bodyStyle,s=e.bodyClasses,u=void 0===s?["b-".concat(this.constructor.type)].concat(z(this.owner.bodyClasses),z(Lo.outerCls)):s,c=e.paperHeight,d=e.paperWidth,h=e.html,f=ne.isSafari?"":"window.removeElement && window.removeElement();",v=null!=t&&t.debug?"":"<script type=\"text/javascript\">window.addEventListener('load', function() { window.print(); ".concat(f," });<\/script>");return Kf.tpl(LL||(LL=N(['\n            <!DOCTYPE html>\n            <html class="','" style="width: ',"in; height: ",'in;">\n                <head>\n                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />\n                    <title>',"</title>\n                    ",'\n                </head>\n                <body class="b-print ','" style="width: ',"in; height: ","in; ",'">\n                    <div class="b-print-content">\n                        ','\n                        <div class="b-print-body"><div class="b-print-viewport">',"</div></div>\n                        ","\n                    </div>\n                    ","\n                </body>\n            </html>"])),o,d,c,n,a.join(""),u.join(" "),d,c,l,r&&'<div class="b-print-header" style="width: 100%">'.concat(r,"</div>"),h,i&&'<div class="b-print-footer" style="width: 100%">'.concat(i,"</div>"),v)}}])}(Pm);PL._$name="Printer";var _L={configurable:!0,get:function(){return Number.MAX_SAFE_INTEGER}},HL=function(e,t){return e+t},BL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"getTotalHeight",value:function(e){var t=e.activeView;switch(e.mode){case"agenda":return t.virtualScrollHeight;case"day":case"week":return t.dayContentElement.scrollHeight+t.alldayRowElement.offsetHeight;case"month":if(this.owner.wysiwyg)return t.weeksElement.scrollHeight+t.weekdaysHeader.offsetHeight+10;break;case"year":return this.inchToPx(Em.A4.width)}}},{key:"getTotalWidth",value:function(e){return"year"===e.mode?this.inchToPx(Em.A4.height):this.inchToPx(Em.A4.width)}},{key:"prepareComponent",value:(n=f(L().mark((function e(t){var n,r,i,a,o,l,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(n=this).owner,i=r.wysiwyg,a=!i,o=t.client,l=o.activeView,n.exportMeta={title:r.callback(r.titleRenderer,r,[l]),totalWidth:n.getTotalWidth(o),totalHeight:n.getTotalHeight(o),subGrids:{}},"month"===o.mode&&a&&(Object.defineProperty(l,"eventsPerCell",_L),Object.defineProperty(l,"maxEventsPerCell",_L),l.doRefresh()),n.cloneElement(l.currentElement),"month"===o.mode&&(a&&(s=l.shrinkwrapRowHeights,delete l.eventsPerCell,delete l.maxEventsPerCell,l.doRefresh(),n.exportMeta.totalHeight=s.reduce(HL,l.weekdaysHeader.offsetHeight)),l.weekElements.forEach((function(e,t){var r=n.element.querySelector('[data-week="'.concat(e.dataset.week,'"]'));r.style.minHeight="",r.style.flex=a?"0 0 ".concat(s[t],"px"):i?"1 0 ".concat(e.offsetHeight,"px"):"1 0 ".concat(250/6,"mm")})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"pxToInch",value:function(e){return(e/96).toFixed(2)}}]);var n}(PL);S(BL,"$name","CalendarPrinter"),S(BL,"type","calendar"),BL.prototype.pagesExtractor=function(){var e=U(L().mark((function e(t){var n,r,i,a,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=this).exportMeta,i=r.totalHeight,a=r.totalWidth,o=r.title,e.next=3,{html:n.pageTpl({config:t,title:o,html:n.prepareExportElement(),styles:n.stylesheets,paperWidth:n.pxToInch(a),paperHeight:n.pxToInch(i)})};case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),BL._$name="CalendarPrinter";var VL=Object.freeze([]),NL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"construct",value:function(){B(t,"construct",this,3)(arguments),this.client.print=this.print.bind(this)}},{key:"changePrinter",value:function(e){var t=this,n=t.printersMap||(t.printersMap=new a);if(e){var r,i=e.type;if(n.has(i))(r=n.get(i)).setConfig(e);else{var o=t.printers.get(i);if(!o)throw new Error("Printer type ".concat(i," is not found. Make sure you've configured it"));(e=Be.clone(e)).owner=t,(r=new o(e)).relayAll(t),n.set(i,r)}return r}n.forEach((function(e){return e.destroy()}))}},{key:"bodyClasses",get:function(){return this.shrinkwrapRowHeights?["b-shrinkwrap-row-heights"]:VL}},{key:"print",value:(n=f((function(){var e=this,t=arguments.length>0&&arguments[0]!==i?arguments[0]:{};return L().mark((function n(){var r,i,a,o,l,s,u;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(r=e).client,a=r.printer,o="".concat(i.id,"-print-iframe"),!1===i.trigger("beforePrint",{config:t,printer:a})){n.next=22;break}if(!i.activeView.isEventList){n.next=8;break}return n.next=5,i.activeView.print(Be.assign({exporterType:"multipagevertical",useRenderedColumnWidth:!0},e.gridPrintConfig||{}));case 5:i.trigger("print"),n.next=22;break;case 8:return t.client=i,n.next=11,r.printer.export(t);case 11:if(l=n.sent,!t.debug){n.next=16;break}i.trigger("print",l),n.next=22;break;case 16:return null===(s=document.getElementById(o))||void 0===s||s.remove(),(u=li.createElement({id:o,class:"b-calendar-print-iframe",tag:"iframe",parent:document.body})).contentWindow.removeElement=function(){u.remove(),i.trigger("print",l)},u.contentWindow.document.write(l[0].html),u.contentWindow.document.close(),n.abrupt("return",l);case 22:case"end":return n.stop()}}),n)}))()})),function(){return n.apply(this,arguments)})}],[{key:"configurable",get:function(){return{printer:{$config:["lazy","nullify"],value:{type:"calendar"}},wysiwyg:!1,titleRenderer:function(e){return e.description},printers:new a([[BL.type,BL]]),gridPrintConfig:null}}}]);var n}(KF);S(NL,"$name","Print"),S(NL,"type","print"),NL.initClass(),NL._$name="Print";var zL=function(e){return{className:e.cls,style:e.style}},jL={end:"pos",start:"neg"},WL={end:"start",start:"end"},$L=Object.entries({alignment:"alignment",color:"color",footer:"footer",header:"name",rotation:"rotation"}),UL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"onBeforeLayoutEvents",value:function(e){var t=this,n=e.source,r=e.context,i=_(n.isDayView?[Pl.add(r.cellData.date,n.dayStartMs),Pl.add(r.cellData.date,n.dayEndMs)]:[r.cellData.date,r.cellData.tomorrow],2),a=i[0],o=i[1],l=n.getTimeRanges(a,o);if(l.length){var s,u,c=r.layout,d={},h={},f=[],v=[];r.timeRangeHeaders=h,r.timeRanges=l;var g,m=D(l);try{var p=function(){var e=g.value;(u=c.createLayoutItem(e,r)).values=Object.fromEntries($L.map((function(t){var n=_(t,2),r=n[0],i=n[1];return[r,e[i]]}))),u.values.rotation=u.values.rotation||jL[u.values.alignment],c.clusterize(f,v,u,r),(s=(s=r.dayDomConfig.children.inset).children||(s.children=[])).push(t.renderTimeSpan(r,u,h,d))};for(m.s();!(g=m.n()).done;)p()}catch(e){m.e(e)}finally{m.f()}(h.end||d.end)&&(r.dayDomConfig.className["b-dayview-inset-after"]=1),(h.start||d.start)&&(r.dayDomConfig.className["b-dayview-inset-before"]=1)}}},{key:"renderPart",value:function(e,t,n,r,i,a,o){var l,s,u,c,d,h,f="footer"===r,v=n.record,g={timeRange:v},m=n;if("string"==typeof r?(n[r]=m=Be.merge({part:r,record:v,outer:n,cls:S({},"b-cal-timerange-".concat(r),1)},o),null!=(h=n.values[r])&&(g.value=m.value=h)):(d=r,r="outer"),e=null===(l=e)||void 0===l?void 0:l[r],t=null===(s=t)||void 0===s?void 0:s[r],g.renderData=m,g.domConfig=d,t){m.style={};var p=t(g);"string"==typeof p?d=Object.assign({html:p},d):Be.isObject(p)&&(c=p)}return c=c||(null===(u=e)||void 0===u?void 0:u(g)),d&&(c=Be.merge(c||{},d)),i&&c&&(i[a=f&&WL[a]||a]=(i[a]||0)+1),m.domConfig=c,c}},{key:"renderTimeSpan",value:function(e,t,n,r){var i=this,a=i.owner,o=a.defaultRenderer,l=a.renderer,s=t.eventRecord,u=isNaN(t.end)?0:Math.abs(t.end-t.start),c=u>1,d=!c,h=e.layout.owner.rtl,f=t.values,v=f.alignment,g=f.color,m=f.rotation,p={color:g,values:f,isLine:d,record:s,layoutContext:e,cls:S(S({"b-readonly":s.readOnly,"b-rtl":h,"b-cal-timerange":1,"b-cal-timerange-line":d,"b-cal-timerange-narrow":c&&u<=60*a.narrowThreshold},"b-cal-timerange-align-".concat(v),v),"b-cal-timerange-rotate-".concat(m),c&&m)};c&&t.height.adjust(0,-1);var y=t.getStyles(h);return li.normalizeChildren(i.renderPart(o,l,p,{dataset:{"timerange-id":s.id,btip:d&&f.header||null},className:S({},s.cls,s.cls),elementData:{timeRange:s},style:{top:y.top,height:y.height},children:c&&{header:i.renderPart(o,l,p,"header",n,v,{cls:S({},s.iconCls,s.iconCls)}),body:i.renderPart(o,l,p,"body"),footer:i.renderPart(o,l,p,"footer",r,v)}}))}}])}(XF);S(UL,"$name","DayZone"),S(UL,"configurable",{viewListeners:{beforeLayoutEvents:"onBeforeLayoutEvents"}});var GL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"attachToProject",value:function(e){var n,r;B(t,"attachToProject",this,3)([e]),this.detachListeners("project"),null===(n=e.timeRangeStore)||void 0===n||n.ion({name:"project",change:"refresh",thisObj:this}),null===(r=e.resourceTimeRangeStore)||void 0===r||r.ion({name:"project",change:"refresh",thisObj:this})}},{key:"changeRenderer",value:function(e){return"function"==typeof e&&(e={header:e}),e}},{key:"updateHeaderWidth",value:function(e){var t,n,r=null===(t=this.owner)||void 0===t?void 0:t.element;r&&r.style.setProperty("--timerange-header-width",null===(n=jA.from(e))||void 0===n?void 0:n.toString())}},{key:"refresh",value:function(){this.client.refresh()}}])}(KF.mixin(DR));S(GL,"$name","TimeRanges"),S(GL,"type","timeRanges"),S(GL,"configurable",{defaultRenderer:{outer:function(e){var t,n=e.renderData,r=zL(n),i=n.color;return i&&(li.isNamedColor(i)?r.className["b-cal-color-".concat(i)]=1:(r.style||(r.style={}))["--timerange-color"]=i),r.className["b-cal-timerange-has-header"]=null===(t=n.header)||void 0===t?void 0:t.domConfig,r},body:function(e){var t=e.renderData;return zL(t)},header:function(e){var t=e.renderData,n=e.value;return n?F(F({},zL(t)),{},{children:[{className:{"b-cal-timerange-header-text":1},text:n}]}):null},footer:function(e){var t=e.renderData,n=e.value;return n?F(F({},zL(t)),{},{children:[{className:{"b-cal-timerange-footer-text":1},text:n}]}):null}},headerWidth:40,narrowThreshold:60,renderer:null,zoneTypes:{day:UL,resource:UL}}),KF.register(GL.type,GL),GL._$name="TimeRanges";var YL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"render",value:function(){var e=this.client,t=this.monthView=e.isMonthView?e:e.modes.month;if(t){var n=this.weekRenderer;t.showWeekColumn=!0,t.weekRenderer=t.weekRenderer?Tt.createSequence(t.weekRenderer,n):n,t.ion({weeknumberclick:"onWeekNumberClick",thisObj:this,prio:1e4})}}},{key:"weekRenderer",value:function(e,t){var n=_(t,2);n[0],n[1],e.querySelector(".b-week-toggle-tool-wrap")||li.createElement({parent:e,className:"b-week-toggle-tool-wrap",children:[{className:"b-icon b-week-toggle-tool",dataset:{btip:this.L("L{WeekExpander.expandTip}")}}]})}},{key:"onWeekNumberClick",value:function(e){var t=e.domEvent,n=e.date,r=t.target.closest(".b-week-toggle-tool");if(r&&!this.disabled){var i=t.target.closest(".b-calendar-row");return i.classList.contains("b-shrinkwrapped")?(this.monthView.flexWeekRow(n,!0),r.dataset.btip=this.L("L{expandTip}")):i.classList.contains("b-has-overflow")&&(this.monthView.shrinkwrapWeekRow(n),r.dataset.btip=this.L("L{collapseTip}")),!1}}},{key:"updateDisabled",value:function(e,n){B(t,"updateDisabled",this,3)([e,n]),this.client.element.classList.toggle("b-weekexpander",!e)}}],[{key:"pluginConfig",get:function(){return{chain:["render"]}}}])}(KF);S(YL,"$name","WeekExpander"),S(YL,"type","weekExpander"),YL.initClass(),YL._$name="WeekExpander";var qL=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"checkAutoCreateGesture",value:function(e){this.agenda.eventContentElement.contains(e.target)&&B(t,"checkAutoCreateGesture",this,3)(arguments)}},{key:"description",get:function(){var e=this.agenda.date,n=Pl.clearTime(new Date);return n-e?Pl.diff(e,Pl.add(n,1,"d"))?B(t,"description",this,1):this.L("L{Calendar.Tomorrow}"):this.L("L{Calendar.Today}")}},{key:"agendaHeaderRenderer",value:function(e){}},{key:"changeShiftIncrement",value:function(e){return ql.from(e)}},{key:"stepUnit",get:function(){var e=this.shiftIncrement;return e?1===e.magnitude?Pl.getLocalizedNameOfUnit(e.unit):"".concat(e.magnitude," ").concat(Pl.getLocalizedNameOfUnit(e.unit,!0)):this.agenda.stepUnit}},{key:"getEventElement",value:function(){var e;return(e=this.agenda).getEventElement.apply(e,arguments)}},{key:"next",value:function(){var e=this.date,t=this.animateTimeShift,n=Pl.add(e,ql.from(this.shiftIncrement));this.animateTimeShift=n.getMonth()!==e.getMonth(),this.date=n,this.animateTimeShift=t}},{key:"previous",value:function(){var e=this.date,t=this.animateTimeShift,n=Pl.add(e,ql.from(this.shiftIncrement).negate());this.animateTimeShift=n.getMonth()!==e.getMonth(),this.date=n,this.animateTimeShift=t}},{key:"changeAgenda",value:function(e,n){if(n&&this.remove(n),e){var r=this,i=r.date;e=t.reconfigure(n,t.mergeConfigs({date:i,flex:1,project:r.project,title:r.callback(r.agendaHeaderRenderer,r,[i]),ref:"agenda",cls:{"b-monthagenda-agenda":1},range:"day",settingsButton:null,alwaysShowCurrentDate:!0,consumeGridPointerEvents:!1,defaultScrollOptions:{block:"start"},internalListeners:{topDateChange:"onAgendaTopDateChange",rangeChange:"onAgendaRangeChange",thisObj:r}},e),r),r.add(e),r.eventSorter=e.eventSorter;var a=e.element.classList;a.remove("b-slide-vertical"),a.add("b-slide-horizontal")}else null==n||n.destroy();return e}},{key:"onAgendaTopDateChange",value:function(e){var t=e.source,n=e.date;t.scrollable.scrollAnimation||(t.preventScroll=!0,this.date=n,t.preventScroll=!1)}},{key:"onAgendaRangeChange",value:function(e){var t=e.source;if(t.isAgendaView&&t.store.count>1){var n=new Date(Math.min(Math.max(this.date,t.store.first.date),t.store.last.date));t.scrollTo(n,{animate:!1,block:"start"})}}},{key:"createCellData",value:function(){var e;return(e=this.agenda).createCellData.apply(e,arguments)}},{key:"updateDate",value:function(e,n){var r=this.agenda;this.selection=e,B(t,"updateDate",this,3)([e]),r&&(r.date=e,r.title=this.callback(this.agendaHeaderRenderer,this,[e]),1===r.duration&&li.slideIn(r.element,e-n))}},{key:"getDateFromDomEvent",value:function(e){return B(t,"getDateFromDomEvent",this,3)([e])||this.agenda.getDateFromDomEvent(e)}}])}(nA.mixin(vA));S(qL,"$name","MonthAgendaView"),S(qL,"type","monthagenda"),S(qL,"delayable",{refresh:"raf"}),S(qL,"configurable",{title:"L{MonthView.Month}",showEvents:"dots",tbar:null,animateTimeShift:!1,eventHeight:"auto",trapFocus:!1,focusable:!0,shiftIncrement:{unit:"day",magnitude:1},agendaDateFormat:"dddd DD MMMM YYYY",agendHeaderRenderer:null,agenda:{type:"agendaview"}}),qL.initClass(),qL._$name="MonthAgendaView",e.AbstractAssignmentStoreMixin=yx,e.AbstractCalendarManagerStoreMixin=OE,e.AbstractCalendarMixin=IE,e.AbstractCrudManager=Wx,e.AbstractCrudManagerMixin=Hx,e.AbstractCrudManagerValidation=Ax,e.AbstractDateRange=_k,e.AbstractDependencyStoreMixin=Rx,e.AbstractEventStoreMixin=ax,e.AbstractHasAssignmentsMixin=QS,e.AbstractPartOfProjectGenericMixin=JD,e.AbstractPartOfProjectModelMixin=tS,e.AbstractPartOfProjectStoreMixin=eS,e.AbstractRecurrenceIterator=PS,e.AbstractResourceStoreMixin=lS,e.AbstractTimeRanges=TT,e.ActionBase=ih,e.ActionColumn=qm,e.AddAction=Mh,e.AgendaColumn=WF,e.AgendaView=NA,e.AggregateColumn=aC,e.AjaxHelper=Ba,e.AjaxStore=Pf,e.AjaxStoreLazyLoadPlugin=Af,e.AjaxTransport=Bx,e.Animator=_s,e.ArrayDataField=Nc,e.ArrayHelper=$e,e.AssignmentModel=vx,e.AssignmentModelMixin=dx,e.AssignmentStore=Cx,e.AssignmentStoreMixin=gx,e.AsyncHelper=Ge,e.AttachToProjectMixin=DR,e.AvatarRendering=yc,e.Badge=Pu,e.Bag=hs,e.Bar=Mg,e.Base=Mn,e.BooleanCombo=Wy,e.BooleanDataField=zc,e.Box=Lu,e.BrowserHelper=ne,e.Button=Nu,e.ButtonGroup=Qv,e.CI=HD,e.CIFromSetOrArrayOrValue=mx,e.CSSHelper=Ii,e.Calendar=iL,e.CalendarCache=wE,e.CalendarCacheInterval=xE,e.CalendarCacheIntervalMultiple=NF,e.CalendarCacheMultiple=zF,e.CalendarCacheSingle=FE,e.CalendarDatePicker=nA,e.CalendarDrag=EL,e.CalendarFeature=KF,e.CalendarIntervalMixin=pE,e.CalendarIntervalStore=yE,e.CalendarMixin=vA,e.CalendarPanel=Gy,e.CalendarRow=FA,e.CalendarStores=iA,e.Card=Lb,e.Carousel=ck,e.CellCopyPaste=yC,e.CellEdit=DC,e.CellMenu=SC,e.CellTooltip=xC,e.CheckColumn=sC,e.Checkbox=Jg,e.CheckboxGroup=vk,e.ChecklistFilterCombo=NC,e.ChipView=lv,e.ChronoMixinBase=ZD,e.ClickRepeater=Hs,e.Clipboardable=Gp,e.ClockTemplate=sT,e.CodeEditor=mk,e.CollapseTool=Us,e.Collection=us,e.CollectionFilter=Jl,e.CollectionSorter=Ql,e.ColorColumn=uC,e.ColorField=yk,e.ColorPicker=pk,e.Column=yg,e.ColumnAutoWidth=FC,e.ColumnDragToolbar=AC,e.ColumnLines=FT,e.ColumnPicker=IC,e.ColumnRename=LC,e.ColumnReorder=OC,e.ColumnResize=PC,e.ColumnStore=bg,e.Combo=dv,e.ComboModel=Qm,e.Config=rn,e.ConfirmationBar=xk,e.Container=Ss,e.ContextMenuBase=op,e.CopyPasteBase=pC,e.CoreAssignmentMixin=fx,e.CoreAssignmentStoreMixin=bx,e.CoreCalendarManagerStoreMixin=PE,e.CoreCalendarMixin=LE,e.CoreDependencyMixin=Sx,e.CoreDependencyStoreMixin=Mx,e.CoreEventMixin=JS,e.CoreEventStoreMixin=ox,e.CoreHasAssignmentsMixin=ex,e.CoreHasDependenciesMixin=tx,e.CorePartOfProjectGenericMixin=QD,e.CorePartOfProjectModelMixin=nS,e.CorePartOfProjectStoreMixin=aS,e.CoreResourceMixin=rS,e.CoreResourceStoreMixin=sS,e.CrudManager=qF,e.CrudManagerView=CR,e.DailyRecurrenceIterator=_S,e.DataField=Vc,e.DataGenerator=Dp,e.DateColumn=cC,e.DateDataField=jc,e.DateField=Pk,e.DateHelper=Pl,e.DatePicker=Lk,e.DateRangeField=Wk,e.DateRangeOwner=EA,e.DateRangePicker=zk,e.DateStoreLazyLoadPlugin=hS,e.DateTimeField=Uk,e.DayAgendaView=hI,e.DayButtons=oM,e.DayCellCollecter=yA,e.DayCellRenderer=DA,e.DayLayout=$A,e.DayResourceCalendarRow=MI,e.DayResourceView=FI,e.DaySelectable=IA,e.DaySelector=AA,e.DayTime=my,e.DayView=sI,e.Delayable=$i,e.DelayableWrapper=VE,e.DelayedRecordsRendering=EF,e.DemoBot=xp,e.DemoCodeEditor=Gk,e.DemoHeader=Yk,e.Dependencies=UT,e.DependencyBaseModel=Dx,e.DependencyCreation=AT,e.DependencyEdit=qT,e.DependencyMenu=KT,e.DependencyModel=xx,e.DependencyStore=Fx,e.DependencyStoreMixin=Ex,e.DependencyTooltip=jT,e.Describable=qE,e.DisplayField=Tk,e.DomClassList=Ct,e.DomDataStore=wa,e.DomHelper=li,e.DomSync=fa,e.DragBase=uT,e.DragContext=Qp,e.DragCreateBase=mT,e.DragHelper=Qi,e.DragProxy=ey,e.DragTipProxy=jy,e.Draggable=ty,e.Droppable=ny,e.Duration=ql,e.DurationColumn=Pw,e.DurationField=qk,e.DurationUnitDataField=$c,e.DynamicObject=du,e.EditBase=wT,e.Editor=Xk,e.ElementResizeHelper=dc,e.ElementVisitor=Ev,e.EventBuffer=TL,e.EventColorColumn=tT,e.EventColorField=eT,e.EventColorPicker=QR,e.EventColumn=$F,e.EventCopyPaste=_I,e.EventDayIndex=CS,e.EventDrag=JT,e.EventDragCreate=QT,e.EventDragSelect=eM,e.EventEdit=VI,e.EventEditor=HI,e.EventFilter=kM,e.EventHelper=fr,e.EventList=_A,e.EventMenu=zI,e.EventModel=rx,e.EventModelMixin=ZS,e.EventNavigation=II,e.EventNonWorkingTime=DM,e.EventRenderer=eA,e.EventResize=hT,e.EventSelection=LI,e.EventSlots=gA,e.EventSorter=cA,e.EventStore=lx,e.EventStoreMixin=vS,e.EventTip=lL,e.EventTooltip=$I,e.Events=_n,e.ExcelExporter=IL,e.ExportDialog=jm,e.ExportOrientationCombo=Nm,e.ExportRowsCombo=Vm,e.Exporter=Pm,e.ExporterBase=Om,e.ExternalEventSource=AL,e.Factoryable=Za,e.Featureable=ry,e.Fencible=Ap,e.Field=Uf,e.FieldContainer=Nf,e.FieldFilterPicker=ab,e.FieldFilterPickerGroup=sb,e.FieldSet=dk,e.FileDrop=Mw,e.FileField=ub,e.FileFormat=Fm,e.FilePicker=cb,e.FillHandle=_C,e.Filter=UC,e.FilterBar=YC,e.FilterField=db,e.Finalizable=Yp,e.Fit=Gf,e.FluidDayLayout=KA,e.Footer=Lg,e.Formatter=zl,e.FormulaField=rv,e.FormulaProvider=Hc,e.Fullscreen=va,e.FunctionHelper=Tt,e.GetEventsMixin=mS,e.GlobalEvents=Wn,e.Grid=Fw,e.GridBase=Dm,e.GridEditBase=kC,e.GridElementEvents=Vg,e.GridExcelExporter=Tw,e.GridFeatureManager=Ug,e.GridFeatures=Yg,e.GridFieldFilterPicker=HC,e.GridFieldFilterPickerGroup=BC,e.GridGroupSummary=XC,e.GridLocation=cg,e.GridLockRows=nw,e.GridMultiPageExporter=_m,e.GridMultiPageVerticalExporter=Hm,e.GridPdfExport=$m,e.GridPrint=Ym,e.GridResponsive=Xg,e.GridRowModel=Cg,e.GridRowReorder=hw,e.GridRowResize=fw,e.GridSelection=nm,e.GridSinglePageExporter=Bm,e.GridSplit=tw,e.GridState=lm,e.GridSubGrids=fm,e.GridSummary=bw,e.Group=qC,e.GroupBar=Lw,e.GroupSummary=MM,e.Header=Ig,e.HeaderMenu=rw,e.HeaderZoom=AM,e.Helpers=te,e.Hint=py,e.HintFlow=by,e.Histogram=Gb,e.HorizontalLayoutPack=tR,e.HorizontalLayoutStack=JE,e.HorizontalRendering=IR,e.HorizontalTimeAxis=$R,e.Hoverable=dy,e.IdHelper=ba,e.Identifiable=eo,e.InfinityAxis=_p,e.InfinityScrollable=$p,e.InfinityScroller=Wp,e.InsertAction=Oh,e.InsertChildAction=wh,e.InstancePlugin=wc,e.IntegerDataField=Uc,e.IntervalCache=TE,e.IntervalSorterFn=SE,e.JsonEncoder=Vx,e.KeyMap=ro,e.Label=lb,e.Labelable=Bf,e.Labels=HM,e.Layout=Po,e.LayoutDim=jA,e.LazyLoadCrudManager=jx,e.LazyLoadView=wR,e.List=ev,e.LoadMaskable=vm,e.LoadOnDemand=OL,e.LocaleHelper=Pa,e.LocaleManager=Na,e.Localizable=Ya,e.LockRows=QM,e.MAX_DATE=bE,e.MI=VD,e.MIN_DATE=kE,e.Mask=gs,e.Menu=ap,e.MenuItem=np,e.MergeCells=aw,e.MessageDialog=vb,e.Minifiable=Kb,e.ModeSelector=PI,e.Model=od,e.ModelDataField=Gc,e.ModelLink=Ic,e.ModelStm=Ec,e.Month=Cy,e.MonthAgendaView=qL,e.MonthPicker=Ek,e.MonthView=gI,e.MonthlyRecurrenceIterator=BS,e.MultiDatePicker=Nk,e.MultiPageExporter=fF,e.MultiPageVerticalExporter=vF,e.Navigator=Jf,e.NonWorkingTime=BM,e.NonWorkingTimeMixin=wM,e.NumberColumn=iC,e.NumberDataField=Yc,e.NumberField=ng,e.NumberFormat=Yl,e.ObjectDataField=qc,e.ObjectHelper=Be,e.Objects=pe,e.Orientation=Mm,e.OverflowPopup=bA,e.Override=We,e.PackMixin=eR,e.PagingToolbar=gb,e.Pan=VM,e.Panel=uc,e.PanelCollapser=uu,e.PanelCollapserOverlay=kb,e.PaperFormat=Em,e.Parser=zy,e.PartOfBaseProject=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"assignmentStore",get:function(){return this.project.assignmentStore}},{key:"calendarManagerStore",get:function(){return this.project.calendarManagerStore}},{key:"dependencyStore",get:function(){return this.project.dependencyStore}},{key:"eventStore",get:function(){return this.project.eventStore}},{key:"resourceStore",get:function(){return this.project.resourceStore}}])}(e),S(t,"$name","PartOfBaseProject"),t},e.PartOfProject=pD,e.PasswordField=bb,e.PdfExport=CF,e.PercentColumn=dC,e.PickerField=ov,e.Pluggable=Dc,e.Point=yt,e.Popup=fc,e.PresetManager=jw,e.PresetStore=Nw,e.Print=NL,e.PrintMixin=Gm,e.ProjectCombo=OF,e.ProjectConsumer=aR,e.ProjectCrudManager=Nx,e.ProjectModel=YF,e.ProjectModelCommon=$x,e.ProjectModelMixin=Zx,e.ProjectModelTimeZoneMixin=qx,e.Promissory=xs,e.QuickFind=lw,e.RTL=io,e.Radio=hk,e.RadioGroup=fk,e.RandomGenerator=Cp,e.RangeMenu=OA,e.RatingColumn=hC,e.Rectangle=pt,e.RectangularPathFinder=PT,e.RecurrenceCombo=rM,e.RecurrenceConfirmationPopup=eD,e.RecurrenceDayRuleEncoder=MS,e.RecurrenceDaysButtonGroup=lM,e.RecurrenceDaysCombo=aM,e.RecurrenceEditor=fM,e.RecurrenceEditorPanel=hM,e.RecurrenceFrequencyCombo=nM,e.RecurrenceLegend=lT,e.RecurrenceLegendButton=iM,e.RecurrenceModel=GS,e.RecurrenceMonthDaysButtonGroup=sM,e.RecurrenceMonthsButtonGroup=uM,e.RecurrencePositionsCombo=dM,e.RecurrenceStopConditionCombo=cM,e.RecurringEventEdit=gM,e.RecurringEvents=tD,e.RecurringEventsMixin=ES,e.RecurringTimeSpan=XS,e.RecurringTimeSpansMixin=xS,e.RegionResize=sw,e.RemoveAction=Bh,e.RemoveAllAction=zh,e.RemoveChildAction=Eh,e.Resizable=hc,e.ResizeHelper=sp,e.ResizeMonitor=ya,e.ResourceCollapseColumn=nT,e.ResourceCombo=mM,e.ResourceFilter=PF,e.ResourceHeader=UR,e.ResourceInfoColumn=rT,e.ResourceMenu=NM,e.ResourceModel=iS,e.ResourceModelMixin=yD,e.ResourceStore=uS,e.ResourceStoreMixin=mD,e.ResourceTickModel=aT,e.ResourceTickStore=oT,e.ResourceTimeRangeModel=Ux,e.ResourceTimeRangeStore=Gx,e.ResourceTimeRanges=zM,e.ResourceTimeRangesBase=DT,e.ResourceView=EI,e.Responsive=rC,e.RevisionException=Pd,e.Ripple=Bo,e.Rotatable=zs,e.Row=hg,e.RowCopyPaste=cw,e.RowEdit=dw,e.RowExpander=Jm,e.RowManager=xg,e.RowNumberColumn=Qg,e.RowReorder=jM,e.RowResize=WM,e.RowsRange=xm,e.Scale=qb,e.ScaleColumn=iT,e.ScheduleContext=XT,e.ScheduleMenu=qI,e.ScheduleRange=dF,e.ScheduleRangeCombo=gF,e.ScheduleTableExporter=DF,e.ScheduleTooltip=GI,e.Scheduler=xF,e.SchedulerBase=JR,e.SchedulerCoreEvent=nx,e.SchedulerCoreProjectMixin=NE,e.SchedulerCrudManager=jE,e.SchedulerDatePicker=_F,e.SchedulerDom=KE,e.SchedulerDomEvents=XE,e.SchedulerEventCopyPaste=ZT,e.SchedulerEventEdit=yM,e.SchedulerEventEditor=tM,e.SchedulerEventMenu=bM,e.SchedulerEventNavigation=kR,e.SchedulerEventRendering=rR,e.SchedulerEventSelection=hR,e.SchedulerEventTooltip=EM,e.SchedulerExcelExporter=SF,e.SchedulerExportDialog=mF,e.SchedulerPrint=wF,e.SchedulerProjectModel=zE,e.SchedulerRegions=uR,e.SchedulerResourceRendering=nR,e.SchedulerScheduleMenu=$M,e.SchedulerScheduleTooltip=GM,e.SchedulerScroll=sR,e.SchedulerState=dR,e.SchedulerStores=oR,e.SchedulerTimeRangeModel=Kx,e.SchedulerTimeRangeStore=Xx,e.SchedulerTimeRanges=oF,e.ScrollButtons=UM,e.ScrollManager=vg,e.Scroller=Oa,e.Search=gw,e.Sidebar=rA,e.SimpleEventEdit=YM,e.SinglePageExporter=pF,e.SlideToggle=Db,e.Slider=wb,e.Sort=pw,e.SortedMap=RE,e.Split=XM,e.Splitter=Rb,e.State=wu,e.StateBase=Bd,e.StateProvider=ku,e.StateStorage=hu,e.StateTrackingManager=pf,e.StickyCells=yw,e.StickyEvents=JM,e.Store=Ff,e.StoreCRUD=ud,e.StoreChained=Ed,e.StoreChanges=cd,e.StoreDataField=Xc,e.StoreFilter=dd,e.StoreGroup=gd,e.StoreLazyLoadPlugin=bf,e.StorePaging=pd,e.StoreProxy=yd,e.StoreRelation=kd,e.StoreSearch=Dd,e.StoreSort=Sd,e.StoreState=Rd,e.StoreStm=yf,e.StoreSum=bd,e.StoreSync=Od,e.StoreTimeZonePlugin=Yx,e.StoreTree=Ld,e.StringDataField=Wc,e.StringHelper=Le,e.Stripe=kw,e.Styleable=function(e){var t;return t=function(e){function t(){return m(this,t),g(this,t,arguments)}return R(t,e),w(t,[{key:"changeCssVarPrefix",value:function(e){return Be.assertString(e,"prefix"),e&&!e.endsWith("-")&&(e+="-"),e||""}},{key:"changeCss",value:function(e){Be.assertObject(e,"css");var t=this;if(!r.Proxy)throw new Error("Proxy not supported");var n=new Proxy({},{get:function(e,n){var r;return null===(r=getComputedStyle(t.element||document.documentElement).getPropertyValue("--".concat(t.cssVarPrefix).concat(Le.hyphenate(n))))||void 0===r?void 0:r.trim()},set:function(e,n,r){return(t.element||document.documentElement).style.setProperty("--".concat(t.cssVarPrefix).concat(Le.hyphenate(n)),r),!0}});return e&&(t._element?Be.assign(n,e):t.$initialCSS=e),n}},{key:"updateElement",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];B(t,"updateElement",this,3)([e].concat(r)),this.$initialCSS&&Be.assign(this.css,this.$initialCSS)}},{key:"widgetClass",get:function(){}}])}(e||Mn),S(t,"$name","Styleable"),S(t,"configurable",{cssVarPrefix:"",css:{}}),t},e.SubGrid=hm,e.Summary=rF,e.Tab=Tb,e.TabBar=Fb,e.TabPanel=Pb,e.TableExporter=Sw,e.TaskEditStm=fT,e.TaskEditTransactional=vT,e.TemplateColumn=fC,e.TemplateHelper=Kf,e.TextAreaField=_b,e.TextAreaPickerField=Hb,e.TextField=iv,e.TickCells=uF,e.TimeAxis=$w,e.TimeAxisColumn=GR,e.TimeAxisHeaderMenu=aF,e.TimeAxisSubGrid=hD,e.TimeAxisViewModel=Uw,e.TimeColumn=vC,e.TimeField=Kv,e.TimePicker=jv,e.TimeRangeModel=UF,e.TimeRangeStore=GF,e.TimeRanges=GL,e.TimeSelection=lF,e.TimeSpan=Bw,e.TimeSpanMenuBase=ST,e.TimeZoneHelper=yp,e.TimeZonedDatesMixin=Hw,e.TimelineBase=gD,e.TimelineDateMapper=qw,e.TimelineDomEvents=Xw,e.TimelineEventRendering=nD,e.TimelineHistogram=LF,e.TimelineHistogramBase=FF,e.TimelineHistogramGrouping=AF,e.TimelineHistogramScaleColumn=IF,e.TimelineScroll=lD,e.TimelineState=cD,e.TimelineSummary=nF,e.TimelineViewPresets=Zw,e.TimelineZoomable=Jw,e.Toast=Wm,e.Tool=js,e.Toolable=Eu,e.Toolbar=Zu,e.Tooltip=pc,e.TooltipBase=RT,e.Transaction=Jh,e.TransactionalFeature=cT,e.TransactionalFeatureMixin=bR,e.Tree=ww,e.TreeColumn=gC,e.TreeCombo=Ow,e.TreeGrid=Aw,e.TreeGroup=Dw,e.TreeNode=Mc,e.TreeSummary=cF,e.UndoRedo=BF,e.UndoRedoBase=Bb,e.UnspecifiedTimeIntervalModel=AE,e.UpdateAction=mh,e.VALUE_COUNT=VC,e.VBox=Ou,e.Validatable=Vf,e.VersionHelper=Ne,e.VerticalRendering=VR,e.VerticalTimeAxisColumn=qR,e.ViewPreset=Vw,e.ViewPresetCombo=VF,e.WalkHelper=ld,e.Wbs=Md,e.WeekExpander=YL,e.WeekView=mI,e.WeeklyRecurrenceIterator=HS,e.Widget=Lo,e.WidgetColumn=lC,e.WidgetHelper=kp,e.WriteExcelFileProvider=Rw,e.XMLHelper=bp,e.XlsProviderBase=xw,e.YearPicker=Rk,e.YearView=bI,e.YearlyRecurrenceIterator=VS,e.binarySearch=EE,e.combineCalendars=function(e){var t=DE(e);if(0===t.length)throw new Error("No calendars to combine");t.sort((function(e,t){return e.internalId<t.internalId?-1:1}));var n=t.map((function(e){return e.internalId+"/"})).join(""),r=t.map((function(e){return e.version+"/"})).join(""),i=jF.get(n);return i&&i.versionsHash===r?i.cache:new zF({calendarCaches:t.map((function(e){return e.calendarCache}))})},e.delay=px,e.format=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.replace(/{(\d+)}/g,(function(e,t){return void 0!==n[t]?n[t]:e}))},e.isDateFinite=function(e){if(!e)return!1;var t=e.getTime();return t!==kE.getTime()&&t!==bE.getTime()},e.isEqualEffectiveDirection=function(e,t){return!(e&&!t||!e&&t)&&(!e&&!t||e.direction===t.direction&&("own"===e.kind&&"own"===t.kind||"enforced"===e.kind&&"enforced"===t.kind&&e.enforcedBy===t.enforcedBy||"inherited"===e.kind&&"inherited"===t.kind&&e.inheritedFrom===t.inheritedFrom))},e.isNotNumber=function(e){return Number(e)!==e},e.later=cE,e.stripDuplicates=DE,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=calendar.lwc.module.min.js.map