/*!
 *
 * Bryntum Calendar 6.2.2
 *
 * Copyright(c) 2025 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 * Bryntum incorporates third-party code licensed under the MIT and Apache-2.0 licenses.
 * See the licenses below or visit https://bryntum.com/products/calendar/docs/guide/Calendar/licenses
 *
 * # Third Party Notices
 * 
 * Bryntum uses the following third party libraries:
 * 
 * * [Font Awesome 6 Free](https://fontawesome.com/license/free) (MIT/SIL OFL 1.1)
 * * [Roboto font](https://github.com/google/roboto) (Apache-2.0)
 * * [Styling Cross-Browser Compatible Range Inputs with Sass](https://github.com/darlanrod/input-range-sass) (MIT)
 * * [Tree Walker polyfill (only applies to Salesforce)](https://github.com/Krinkle/dom-TreeWalker-polyfill) (MIT)
 * * [chronograph](https://github.com/bryntum/chronograph) (MIT)
 * * [later.js](https://github.com/bunkat/later) (MIT)
 * * [Monaco editor (only used in our demos)](https://microsoft.github.io/monaco-editor) (MIT)
 * * Map/Set polyfill to fix performance issues for Salesforce LWS (MIT)
 * 
 * Note: the **chronograph** and **later.js** libraries are used in Bryntum Scheduler Pro and Bryntum Gantt, but they are
 * listed for all Bryntum products since the distribution contains trial versions of the thin bundles for all other
 * products. TreeWalker is only used in the LWC bundle for Salesforce. Roboto font is only used in the material theme.
 * 
 * ## Font Awesome 6 Free
 * 
 * [Font Awesome Free 6 by @fontawesome](https://fontawesome.com/)
 * 
 * Font Awesome Free is free, open source, and GPL friendly. You can use it for commercial projects, open source projects,
 * or really almost whatever you want.
 * 
 * [Full Font Awesome Free license](https://fontawesome.com/license/free)
 * 
 * ## Roboto font
 * 
 * [Apache License Version 2.0, January 2004](https://www.apache.org/licenses/LICENSE-2.0)
 * 
 * TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
 * 
 * 1. Definitions.
 * 
 * "License" shall mean the terms and conditions for use, reproduction, and distribution as defined by Sections 1 through 9
 * of this document.
 * 
 * "Licensor" shall mean the copyright owner or entity authorized by the copyright owner that is granting the License.
 * 
 * "Legal Entity" shall mean the union of the acting entity and all other entities that control, are controlled by, or are
 * under common control with that entity. For the purposes of this definition,
 * "control" means (i) the power, direct or indirect, to cause the direction or management of such entity, whether by
 * contract or otherwise, or (ii) ownership of fifty percent (50%) or more of the outstanding shares, or (iii) beneficial
 * ownership of such entity.
 * 
 * "You" (or "Your") shall mean an individual or Legal Entity exercising permissions granted by this License.
 * 
 * "Source" form shall mean the preferred form for making modifications, including but not limited to software source code,
 * documentation source, and configuration files.
 * 
 * "Object" form shall mean any form resulting from mechanical transformation or translation of a Source form, including
 * but not limited to compiled object code, generated documentation, and conversions to other media types.
 * 
 * "Work" shall mean the work of authorship, whether in Source or Object form, made available under the License, as
 * indicated by a copyright notice that is included in or attached to the work
 * (an example is provided in the Appendix below).
 * 
 * "Derivative Works" shall mean any work, whether in Source or Object form, that is based on (or derived from) the Work
 * and for which the editorial revisions, annotations, elaborations, or other modifications represent, as a whole, an
 * original work of authorship. For the purposes of this License, Derivative Works shall not include works that remain
 * separable from, or merely link (or bind by name) to the interfaces of, the Work and Derivative Works thereof.
 * 
 * "Contribution" shall mean any work of authorship, including the original version of the Work and any modifications or
 * additions to that Work or Derivative Works thereof, that is intentionally submitted to Licensor for inclusion in the
 * Work by the copyright owner or by an individual or Legal Entity authorized to submit on behalf of the copyright owner.
 * For the purposes of this definition, "submitted"
 * means any form of electronic, verbal, or written communication sent to the Licensor or its representatives, including
 * but not limited to communication on electronic mailing lists, source code control systems, and issue tracking systems
 * that are managed by, or on behalf of, the Licensor for the purpose of discussing and improving the Work, but excluding
 * communication that is conspicuously marked or otherwise designated in writing by the copyright owner as "Not a
 * Contribution."
 * 
 * "Contributor" shall mean Licensor and any individual or Legal Entity on behalf of whom a Contribution has been received
 * by Licensor and subsequently incorporated within the Work.
 * 
 * 2. Grant of Copyright License. Subject to the terms and conditions of this License, each Contributor hereby grants to
 *    You a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce,
 *    prepare Derivative Works of, publicly display, publicly perform, sublicense, and distribute the Work and such
 *    Derivative Works in Source or Object form.
 * 
 * 3. Grant of Patent License. Subject to the terms and conditions of this License, each Contributor hereby grants to You a
 *    perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 *    (except as stated in this section) patent license to make, have made, use, offer to sell, sell, import, and otherwise
 *    transfer the Work, where such license applies only to those patent claims licensable by such Contributor that are
 *    necessarily infringed by their Contribution(s) alone or by combination of their Contribution(s)
 *    with the Work to which such Contribution(s) was submitted. If You institute patent litigation against any entity (
 *    including a cross-claim or counterclaim in a lawsuit) alleging that the Work or a Contribution incorporated within
 *    the Work constitutes direct or contributory patent infringement, then any patent licenses granted to You under this
 *    License for that Work shall terminate as of the date such litigation is filed.
 * 
 * 4. Redistribution. You may reproduce and distribute copies of the Work or Derivative Works thereof in any medium, with
 *    or without modifications, and in Source or Object form, provided that You meet the following conditions:
 * 
 * (a) You must give any other recipients of the Work or Derivative Works a copy of this License; and
 * 
 * (b) You must cause any modified files to carry prominent notices stating that You changed the files; and
 * 
 * (c) You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark,
 * and attribution notices from the Source form of the Work, excluding those notices that do not pertain to any part of the
 * Derivative Works; and
 * 
 * (d) If the Work includes a "NOTICE" text file as part of its distribution, then any Derivative Works that You distribute
 * must include a readable copy of the attribution notices contained within such NOTICE file, excluding those notices that
 * do not pertain to any part of the Derivative Works, in at least one of the following places: within a NOTICE text file
 * distributed as part of the Derivative Works; within the Source form or documentation, if provided along with the
 * Derivative Works; or, within a display generated by the Derivative Works, if and wherever such third-party notices
 * normally appear. The contents of the NOTICE file are for informational purposes only and do not modify the License. You
 * may add Your own attribution notices within Derivative Works that You distribute, alongside or as an addendum to the
 * NOTICE text from the Work, provided that such additional attribution notices cannot be construed as modifying the
 * License.
 * 
 * You may add Your own copyright statement to Your modifications and may provide additional or different license terms and
 * conditions for use, reproduction, or distribution of Your modifications, or for any such Derivative Works as a whole,
 * provided Your use, reproduction, and distribution of the Work otherwise complies with the conditions stated in this
 * License.
 * 
 * 5. Submission of Contributions. Unless You explicitly state otherwise, any Contribution intentionally submitted for
 *    inclusion in the Work by You to the Licensor shall be under the terms and conditions of this License, without any
 *    additional terms or conditions. Notwithstanding the above, nothing herein shall supersede or modify the terms of any
 *    separate license agreement you may have executed with Licensor regarding such Contributions.
 * 
 * 6. Trademarks. This License does not grant permission to use the trade names, trademarks, service marks, or product
 *    names of the Licensor, except as required for reasonable and customary use in describing the origin of the Work and
 *    reproducing the content of the NOTICE file.
 * 
 * 7. Disclaimer of Warranty. Unless required by applicable law or agreed to in writing, Licensor provides the Work (and
 *    each Contributor provides its Contributions) on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 *    either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT,
 *    MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. You are solely responsible for determining the appropriateness
 *    of using or redistributing the Work and assume any risks associated with Your exercise of permissions under this
 *    License.
 * 
 * 8. Limitation of Liability. In no event and under no legal theory, whether in tort (including negligence), contract, or
 *    otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing,
 *    shall any Contributor be liable to You for damages, including any direct, indirect, special, incidental, or
 *    consequential damages of any character arising as a result of this License or out of the use or inability to use the
 *    Work (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or
 *    any and all other commercial damages or losses), even if such Contributor has been advised of the possibility of such
 *    damages.
 * 
 * 9. Accepting Warranty or Additional Liability. While redistributing the Work or Derivative Works thereof, You may choose
 *    to offer, and charge a fee for, acceptance of support, warranty, indemnity, or other liability obligations and/or
 *    rights consistent with this License. However, in accepting such obligations, You may act only on Your own behalf and
 *    on Your sole responsibility, not on behalf of any other Contributor, and only if You agree to indemnify, defend, and
 *    hold each Contributor harmless for any liability incurred by, or claims asserted against, such Contributor by reason
 *    of your accepting any such warranty or additional liability.
 * 
 * END OF TERMS AND CONDITIONS
 * 
 * APPENDIX: How to apply the Apache License to your work.
 * 
 * To apply the Apache License to your work, attach the following boilerplate notice, with the fields enclosed by
 * brackets "[]"
 * replaced with your own identifying information. (Don't include the brackets!)  The text should be enclosed in the
 * appropriate comment syntax for the file format. We also recommend that a file or class name and description of purpose
 * be included on the same "printed page" as the copyright notice for easier identification within third-party archives.
 * 
 * Copyright [yyyy] [name of copyright owner]
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the
 * License. You may obtain a copy of the License at
 * 
 * [APACHE LICENSE, VERSION 2.0](http://www.apache.org/licenses/LICENSE-2.0)
 * 
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "
 * AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 * 
 * ## Styling Cross-Browser Compatible Range Inputs with Sass
 * 
 * Github: [input-range-sass](https://github.com/darlanrod/input-range-sass)
 * 
 * Author: [Darlan Rod](https://github.com/darlanrod)
 * 
 * Version 1.4.1
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2016 Darlan Rod
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Tree Walker polyfill
 * 
 * The MIT License (MIT)
 * 
 * [Copyright 2013–2017 Timo Tijhof](https://github.com/Krinkle/dom-TreeWalker-polyfill)
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## chronograph
 * 
 * GitHub: [chronograph](https://github.com/bryntum/chronograph)
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2023 Bryntum
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## later.js
 * 
 * GitHub: [later.js](https://github.com/bunkat/later)
 * 
 * The MIT License (MIT)
 * 
 * Copyright © 2013 BunKat
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Monaco editor
 * 
 * GitHub: [Monaco editor](https://microsoft.github.io/monaco-editor) (MIT)
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2016 - present Microsoft Corporation
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Map/Set polyfill to fix performance issues for Salesforce LWS
 * 
 * Copyright © 2024 Certinia Inc.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var VE=Object.defineProperty,NE=(i,e,t)=>e in i?VE(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,y=(i,e,t)=>(NE(i,typeof e!="symbol"?e+"":e,t),t),Iv=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Av=(i,e,t)=>(Iv(i,e,"read from private field"),t?t.call(i):e.get(i)),Lv=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Bs=(i,e,t,r)=>(Iv(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),xo=Object.create(null),Ag=["Array","Browser",["Css","CSSHelper"],"Date","Dom","Event","Function","Object","String","TimeZone","Version"].map(i=>Array.isArray(i)?i:[i,`${i}Helper`]),Pv=i=>Object.assign(Object.create(null),Object.fromEntries(i)),Ov=Pv(Ag),BE=Pv(Ag.map(([i,e])=>[e,i])),Lg=i=>(e,t)=>{throw new Error(`Cannot ${i} "Helpers.${t}": object is readonly`)},zE=new Proxy(xo,{defineProperty:Lg("define property"),deleteProperty:Lg("delete"),set:Lg("assign"),get(i,e){const t=xo[e];if(!t)throw new Error(`Property not defined "Helpers.${e}": ${e in Ov?`import ${Ov[e]} before using it`:"invalid helper name"}`);return t}});Object.defineProperty(xo,"register",{value(i){const e=i.$name,t=BE[e];xo[t]=i}}),Ag.forEach(i=>xo[i[0]]=null);var _e=zE,$v,Y=class{static cacheFlags(i=navigator.platform,e=navigator.userAgent){const t=this;t._isLinux=!!i.match(/Linux/),t._isMac=!!i.match(/Mac/),t._isWindows=!!i.match(/Win32/),t._isMobile=!!(e.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||typeof globalThis.orientation=="number"),t._isWebkit=!!(e.match(/WebKit/)&&!e.match(/Edg/)),t._firefoxVersion=t.getVersion(e,/Firefox\/(\d+)\./),t._isFirefox=t._firefoxVersion>0,t._chromeVersion=t.getVersion(e,/Chrom(?:e|ium)\/(\d+)\./),t._isChrome=t._chromeVersion>0,t._isSafari=!!e.match(/Safari/)&&!t._isChrome,t._isMobileSafari=!!e.match(/Mobile.*Safari/),t._safariVersion=t.getVersion(e,/Version\/(.*).Safari/),t._isAndroid=!!e.match(/Android/g)}static get supportsOverflowClip(){if(this._supportsOverflowClip==null){const i=document.createElement("div");i.style.overflow="clip",i.style.display="none",document.documentElement.appendChild(i),this._supportsOverflowClip=i.ownerDocument.defaultView.getComputedStyle(i).getPropertyValue("overflow")==="clip",i.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(i,e){const t=i.match(e);return t?parseFloat(t[1]):0}static get isTouchDevice(){return this._isTouchDevice===void 0&&(this._isTouchDevice=globalThis.matchMedia("(any-pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return this._isHoverableDevice===void 0&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return typeof window!="undefined"}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get isMobile(){return this._isMobile}static get platform(){const i=this;return i._isLinux?"linux":i._isMac?"mac":i._isWindows?"windows":i._isAndroid?"android":i._isMobileSafari?"ios":null}static get supportsRandomUUID(){var i,e;if(this._supportsRandomUUID===void 0)try{this._supportsRandomUUID=((e=(i=globalThis.crypto).randomUUID)==null?void 0:e.call(i).length)>0}catch(t){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let i,e;try{return i=localStorage,e="__storage_test__",i.setItem(e,e),i.removeItem(e),!0}catch(t){return t instanceof DOMException&&(t.code===22||t.code===1014||t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&i.length!==0}}static setLocalStorageItem(i,e){this.storageAvailable&&localStorage.setItem(i,e)}static getLocalStorageItem(i){return this.storageAvailable&&localStorage.getItem(i)}static removeLocalStorageItem(i){this.storageAvailable&&localStorage.removeItem(i)}static get ctrlKey(){return this.isMac?"metaKey":"ctrlKey"}static get metaKey(){return this.isMac?"ctrlKey":"metaKey"}static searchParam(i,e=null,t=document.location.search){const r=new RegExp(`[?&]${i}=?([^&]*)`),n=t.match(r);return n&&n[1]||e}static getCookie(i){const e=encodeURIComponent(i)+"=",t=document.cookie.split(";");for(let r=0;r<t.length;r++){let n=t[r];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(e)===0)return decodeURIComponent(n.substring(e.length,n.length))}return""}static download(i,e){const t=document.createElement("a");t.download=i,t.href=e||i,t.style.cssText="display:none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}static downloadBlob(i,e){const t=globalThis.URL.createObjectURL(i);this.download(e,t),globalThis.URL.revokeObjectURL(t)}static get queryString(){var i;const e=new URL(globalThis.location.href).searchParams;return(i=Object.fromEntries)==null?void 0:i.call(Object,e.entries())}static copyToClipboard(i){let e=!0;const t=document.createElement("textarea");t.value=i,t.style.height=t.style.width=0,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(r){e=!1}return t.remove(),e}static isBryntumOnline(i){return i=Array.isArray(i)?i:[i],!!(/^(www\.)?bryntum\.com$/.test(globalThis.location.host)||i!=null&&i.some(e=>this.queryString[e]!=null))}static get isCSP(){const{bryntum:i,document:e}=globalThis;return i.CSP==null&&(i.CSP=!!e.querySelector('meta[http-equiv="Content-Security-Policy"]')),i.CSP}};y(Y,"$name","BrowserHelper"),y(Y,"supportsPointerEvents",!!(globalThis.PointerEvent||globalThis.MSPointerEvent)),y(Y,"supportsPointerEventConstructor",typeof PointerEvent!="undefined"),y(Y,"PointerEventConstructor",globalThis.PointerEvent||globalThis.CustomEvent),y(Y,"isPhone",($v=globalThis.matchMedia)==null?void 0:$v.call(globalThis,"(max-height:414px) or (max-width:414px)").matches),_e.register(Y),Y.isBrowserEnv&&Y.cacheFlags(),Y._$name="BrowserHelper";var{hasOwnProperty:WE,propertyIsEnumerable:jE,toString:UE}=Object.prototype,{isFrozen:Hv}=Object,GE=/\s*<\s*/,YE=/\s*>\s*/,Vv={},Nv={},Bv=Object.freeze({}),Z=class ct{static assign(e,...t){for(let r,n,s=0;s<t.length;s++)if(r=t[s],r)for(n in r)n!=="__proto__"&&n!=="constructor"&&(e[n]=r[n]);return e}static assignIf(e,...t){for(let r,n,s=0;s<t.length;s++)if(r=t[s],r)for(n in r)n!=="__proto__"&&n!=="constructor"&&(!(n in e)||e[n]===void 0)&&(e[n]=r[n]);return e}static blend(e,t,r){r=r||Vv,e=e||{};const{clone:n=ct.clone,merge:s=ct.blend}=r;if(Array.isArray(t)){if(t.length>1)return t.forEach(a=>{e=ct.blend(e,a,r)}),e;t=t[0]}if(t){let a,l,o;for(l in t)l!=="__proto__"&&l!=="constructor"&&(o=t[l],o&&ct.isObject(o)&&(a=e[l],r.key=l,a&&ct.isObject(a)?(Hv(a)&&(e[l]=a=n(a,r)),o=s(a,o,r)):o=Hv(o)?o:n(o,r)),e[l]=o)}return e}static clone(e,t){let r=e,n;if(e&&typeof e=="object"&&!(e instanceof Event))if(t&&typeof t=="object"&&t&&(t=null),ct.isObject(e))if(e.skipClone)r=e;else{r={};for(n in e)n!=="__proto__"&&n!=="constructor"&&(r[n]=ct.clone(e[n]))}else if(Array.isArray(e))for(r=[],n=e.length;n-- >0;)r[n]=ct.clone(e[n]);else ct.isDate(e)?r=new Date(e.getTime()):t&&(r=t(e));return r}static mergeUniformObjects(e,...t){for(const r of t)for(const n in r)if(n!=="__proto__"&&n!=="constructor"){const s=r[n];s&&(this.isObject(s)?this.mergeUniformObjects(e[n]||(e[n]={}),s):Array.isArray(s)?(n in e||(e[n]=[]),this.mergeArrayOfIdentityObjects(e[n],s)):e[n]=this.clone(s))}return e}static mergeArrayOfIdentityObjects(e,t){for(const r of t)if(this.isObject(r)){const n=e.find(s=>s.id===r.id);n?this.mergeUniformObjects(n,r):e.push(this.clone(r))}else e.push(r)}static createTruthyKeys(e){const t=O.split(e),r=t&&{};if(t)for(const n of t)n&&(r[n]=!0);return r}static getPath(e,t){return t.split(".").reduce((r,n)=>(r||Bv)[n],e)}static getPathDefault(e,t,r){const n=Array.isArray(t)?t:typeof t=="string"?t.split("."):[t],s=n.length-1;return n.reduce((a,l,o)=>(r&&!(l in a)&&(a[l]=o===s?r:{}),(a||Bv)[l]),e)}static getPropertyDescriptor(e,t){let r=null;for(let n=e;n&&!r&&!ct.hasOwn(n,"isBase");n=Object.getPrototypeOf(n))r=Object.getOwnPropertyDescriptor(n,t);return r}static hasPath(e,t){return t.split(".").every(r=>e&&r in e?(e=e[r],!0):!1)}static getTruthyKeys(e){let t;if(typeof e=="string")t=[e];else if(Array.isArray(e))t=e.slice();else if(t=[],e)for(const r in e)e[r]&&t.push(r);return t}static getTruthyValues(e){const t=[];if(e)for(const r in e)e[r]&&t.push(e[r]);return t}static isClass(e){var t;return typeof e=="function"&&((t=e.prototype)==null?void 0:t.constructor)===e}static isDate(e){return!!(e!=null&&e.getUTCDate)&&ct.typeOf(e)==="date"}static isPromise(e){if(Promise!=null&&Promise.resolve)return Promise.resolve(e)===e||typeof(e==null?void 0:e.then)=="function";throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&typeof e=="object")for(const t in e)return!1;return!0}static isObject(e){const t=e==null?void 0:e.constructor;return!!(t&&typeof t=="function"&&!ct.hasOwn(e,"constructor")&&!jE.call(e,"constructor")?(t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype))&&e!==globalThis:e&&typeof e=="object")}static isInstantiated(e){return e?typeof e=="object"&&!ct.isObject(e):!1}static merge(e,...t){return ct.blend(e,t)}static mergeItems(e,t,r){r=r||Vv;let n,s,a,l,o,d,c;const{merge:u=ct.blend}=r;if(e=e||{},Array.isArray(t))t.forEach(h=>{e=ct.mergeItems(e,h,r)});else if(t){for(o in t)if(o!=="__proto__"&&o!=="constructor")if(c=t[o],n=null,o.includes(">")?([o,n]=o.split(YE),s=0):o.includes("<")&&([n,o]=o.split(GE),s=1),o in e)c&&e[o]&&u&&(r.key=o,c=u(e[o],c,r)),e[o]=c;else if(!n)e[o]=c,l==null||l.set(o,l.size);else{if(!l){l=new Map,a=0;for(const h in e)l.set(h,a++)}if(a=l.get(n),e[o]=c,a==null&&s)a=l.size;else{d=d||[],a=(a||0)+s;for(const h of l){const[g,f]=h;a<=f&&(d&&(d[l.size-f-1]=g),l.set(g,f+1))}if(d)for(;d.length;){const h=d.pop(),g=e[h];delete e[h],e[h]=g}}l.set(o,a)}}return e}static setPath(e,t,r){return t.split(".").reduce((n,s,a,l)=>a===l.length-1?n[s]=r:(n[s]instanceof Object||(n[s]={}),n[s]),e),e}static typeOf(e){let t,r;return e===null?r="null":e!==e?r="nan":(r=typeof e,r==="object"?e.isBase?r="instance":Array.isArray(e)?r="array":(r=Nv[t=UE.call(e)])||(Nv[t]=r=t.slice(8,-1).toLowerCase()):r==="function"&&e.isBase&&(r="class")),r}};Object.defineProperty(Z,"hasOwn",{value:Object.hasOwn||((i,e)=>WE.call(i,e))}),Z._$name="Objects";var zv,Wv,jv,Uv,Gv=/([a-z])([A-Z])/g,qE=/[\n\r]/g,KE=/[.*+?^${}()|[\]\\]/g,XE=/[&<]/,ZE=/(^[^a-z]+[^\w]+)/gi,JE=/\s+/,QE=/^[^a-z]+|[^\w:.-]+/gi,ex=(i,e)=>Wv[e.toLowerCase()]||String.fromCharCode(parseInt(e.substr(2),10)),tx=(i,e)=>zv[e],ix=(i,e,t)=>`${e}-${t.toLowerCase()}`,rx=(i,e,t)=>`${e} ${t.toLowerCase()}`,nx=i=>i?`_x${[...i].map(e=>e.charCodeAt(0).toString(16)).join("")}`:"__blank__",Yv={},qv={},pn=[],Pg=class gn{static circularReplacer(e,t){if(t!=null&&t.isBase)return t.id;if(t&&typeof t=="object"){for(;pn.length&&pn[pn.length-1]!==this;)pn.pop();if(pn.includes(t))return"[Circular]";pn.push(t)}return t}static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=Yv[e];return t||(Yv[e]=e.replace(Gv,ix))}static hyphenateAttributeName(e){return/^(data|aria)[A-Z]/.test(e)?e.replace(/^(data|aria)([A-Z])/,(t,r,n)=>`${r}-${n}`).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase():e}static separate(e){const t=qv[e];return t||(qv[e]=this.capitalize(e.replace(Gv,rx)))}static createId(e){return String(e).replace(ZE,nx)}static makeValidDomId(e,t=""){return e==null?null:String(e).replace(QE,t)}static escapeRegExp(e,t){let r=e.replace(KE,"\\$&");return t!==void 0&&(r=new RegExp(r,t)),r}static decodeHtml(e){return e&&String(e).replace(Uv,ex)}static encodeHtml(e=""){return e&&String(e).replace(jv,tx)}static encodeHtmlBR(e){var t;return(t=gn.encodeHtml(e))==null?void 0:t.replace(qE,"<br>")}static isHtml(e){return typeof e=="string"&&XE.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);zv=e,Wv=t.reduce((r,n)=>(r[e[n]]=n,r),{}),jv=new RegExp(`([${t.map(r=>"[-]".includes(r)?"\\"+r:r).join("")}])`,"g"),Uv=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(r){}return t}static safeJsonStringify(e,t=null,r=null){let n=null;try{t==="circular"&&(pn.length=0,t=this.circularReplacer),n=JSON.stringify(e,t,r)}catch(s){}return n}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=JE){let r=e;return typeof r=="string"&&(r=e.trim(),r=r?r.split(t):[]),r}static xss(e,...t){const r=[];let n=t.length;for(r[n]=e[n];n-- >0;)r[n]=e[n]+gn.encodeHtml(t[n]);return r.join("")}static xssBR(e,...t){const r=[];let n=t.length;for(r[n]=e[n];n-- >0;)r[n]=e[n]+gn.encodeHtmlBR(t[n]);return r.join("")}static toJavaScriptValue(e,t){const r=Z.typeOf(e);if(r==="boolean"||r==="string"||r==="number"||e===null)return gn.safeJsonStringify(e);if(e===globalThis)return"window";if(r==="date")return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if(r==="array")return`[${e.map(n=>gn.toJavaScriptValue(n,t))}]`;if(r==="object"||r==="instance")return this.toJavaScriptString(e,t);if(r==="function"){let n=e.toString();return n.match(/^async (\w+?)\(/)?n=n.replace(/^async (\w+?)\(/,"async function("):!n.startsWith("async(")&&n.match(/^(\w+?)\(/)&&(n=n.replace(/^(\w+?)\(/,"function(")),n}if(r==="class")return e.toJavaScriptValue?e.toJavaScriptValue(t):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name}static toJavaScriptString(e,t={}){var r;const n=(r=t.level)!=null?r:0,s=2;return`{
`+Object.keys(e).map(a=>" ".repeat((n+1)*s)+(a.match(/[- *]/)?`"${a}"`:a)+`: ${gn.toJavaScriptValue(e[a],{...t,level:n+1})}`).join(`,
`)+`
`+" ".repeat(n*s)+"}"}static encodeAttributeSelector(e,t){return`[${e}="${String(t).replace(/["\\]/g,"\\$&")}"]`}static generateUUID(){var e;return Y.supportsRandomUUID?globalThis.crypto.randomUUID():(e=globalThis.crypto)!=null&&e.getRandomValues?("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)):`${Date.now()}-${++gn.fakeNodeUUIDIndex}`}};y(Pg,"$name","StringHelper"),y(Pg,"fakeNodeUUIDIndex",0);var O=Pg;O.initHtmlEntities(),_e.register(O),O._$name="StringHelper";var sx=Object.freeze([]),{hasOwn:Kv}=Z,ax=async(i,e)=>{let t=e;for await(t of i)break;return t},Xv=1.005.toFixed(2)==="1.01"?null:(i,e)=>{const t=i.toString().split("."),r=+(t[1]?t.join(".")+"1":t[0]);return i.toFixed.call(r,e)},Zv=class Jc extends Z{static forEach(e,t){let r;if(e)if(Array.isArray(e))e.forEach(t);else for(r in e)t(e[r],r)}static transformArrayToNamedObject(e,t="ref"){const r={};return e.forEach((n,s)=>{const a=n[t]!=null&&n[t].toString().length?n[t]:s;r[a]=n}),r}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter(r=>e[r]).map(r=>{const n=e[r];return n[t]=r,n})}static isEqual(e,t,r=!1,n=!1){if(!n&&(e===null&&t!==null||e===void 0&&t!==void 0||t===null&&e!==null||t===void 0&&e!==void 0))return!1;if(e==null||t==null)return e==null&&t==null;if(e===t)return!0;const s=typeof e;if(s===typeof t){switch(s){case"number":case"string":case"boolean":return e===t}switch(!0){case(e.isModel&&t.isModel):return e.equals(t);case(e.isBase&&t.isBase):return e===t;case(e instanceof Date&&t instanceof Date):return e.getTime()===t.getTime();case(Array.isArray(e)&&Array.isArray(t)):return e.length===t.length?e.every((l,o)=>Tt.isEqual(l,t[o],r)):!1;case(s==="object"&&e.constructor.prototype===t.constructor.prototype):return r?Tt.isDeeplyEqual(e,t,r):_e.String.safeJsonStringify(e,"circular")===_e.String.safeJsonStringify(t,"circular")}}return String(e)===String(t)}static isDeeplyEqual(e,t,r={}){if(e===t)return!0;if(!e||!t)return!1;const n=Tt.keys(e,r.ignore),s=Tt.keys(t,r.ignore);if(n.length!==s.length)return!1;for(let a=0;a<n.length;a++){const l=n[a],o=s[a];if(l!==o)return!1;const d=e[l],c=t[o];if(!(r.shouldEvaluate&&r.shouldEvaluate(l,{value:d,object:e},{value:c,object:t})===!1)){if(r.evaluate){const u=r.evaluate(l,{value:d,object:e},{value:c,object:t});if(u===!1)return!1;if(u===!0)continue}if(!Tt.isEqual(d,c,r))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),e.indexOf(t)!==-1}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?_e.Date.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?_e.Date.isAfter(e,t):e>t}static first(e,t){let r=t,n;if(e){if(e[Symbol.iterator])for(r of e)break;else if(e[Symbol.asyncIterator])r=ax(e,t);else if(Jc.isObject(e)){r===void 0&&(r=sx);for(n in e){r=[n,e[n]];break}}}return r}static fork(e){let t,r,n;if(e&&e.constructor===Object){t=Object.create(e);for(r in e)n=e[r],n&&(n.constructor===Object?t[r]=Tt.fork(n):n instanceof Array&&(t[r]=n.slice()))}else t=e;return t}static copyProperties(e,t,r){let n,s;for(s=0;s<r.length;s++)n=r[s],n in t&&(e[n]=t[n]);return e}static copyPropertiesIf(e,t,r){if(t)for(const n of r)!(n in e)&&n in t&&(e[n]=t[n]);return e}static copyPropertiesExcept(e,t,r){if(t)for(const n in t)r!=null&&r[n]||(e[n]=t[n]);return e}static entries(e,t){const r=[],n=typeof t=="function";if(e)for(const s in e)(n?!t(s,e[s]):!(t!=null&&t[s]))&&r.push([s,e[s]]);return r}static fromEntries(e,t){if(t=t||{},e)for(let r=0;r<e.length;++r)t[e[r][0]]=e[r][1];return t}static keys(e,t,r){const n=[],s=typeof t=="function";if(e){let a=0;for(const l in e)(s?!t(l,e[l]):!(t!=null&&t[l]))&&(n.push(r?r(l,a):l),++a)}return n}static values(e,t,r){const n=[],s=typeof t=="function";if(e){let a=0;for(const l in e)(s?!t(l,e[l]):!(t!=null&&t[l]))&&(n.push(r?r(e[l],a):e[l]),++a)}return n}static pathExists(e,t){return t.split(".").every(n=>!e||!(n in e)?!1:(e=e[n],!0))}static pathifyKeys(e,t){const r={};for(const n in e)if(Kv(e,n)){const s=t==null?void 0:t[n],a=(s==null?void 0:s.type)==="object"||(s==null?void 0:s.complexMapping)||!t;if(a&&Array.isArray(e[n]))r[n]=e[n].slice();else if(a&&e[n]instanceof Object){const l=this.pathifyKeys(e[n]);for(const o in l)r[`${n}.${o}`]=l[o]}else r[n]=e[n]}return r}static deletePath(e,t){t.split(".").reduce((r,n,s,a)=>{if(r==null)return null;if(Kv(r,n))if(s===a.length-1)delete r[n];else return r[n]},e)}static coerce(e,t){const r=Z.typeOf(e),n=Z.typeOf(t),s=typeof e=="string";if(r!==n)switch(n){case"string":return String(e);case"number":return Number(e);case"boolean":return s&&(!e||e==="false"||e==="0")?!1:!!e;case"null":return s&&(!e||e==="null")?null:!1;case"undefined":return s&&(!e||e==="undefined")?void 0:!1;case"date":return s&&isNaN(e)?_e.Date.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,r,n,s=!0){const a={};let l=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(l,t);for(;!o&&l&&s;)l=Object.getPrototypeOf(l),l&&(o=Object.getOwnPropertyDescriptor(l,t));o?(o.set?a.set=d=>{o.set.call(e,d),n&&n.call(e,o.get.call(e))}:a.set=n,o.get?a.get=()=>{let d=o.get.call(e);return r&&(d=r.call(e,d)),d}:a.get=r):(a.set=d=>{e[`_${t}`]=d,n&&n.call(e,d)},a.get=()=>{let d=e[`_${t}`];return r&&(d=r.call(e,d)),d}),Object.defineProperty(e,t,a)}static hookProperty(e,t,r){const n=Jc.getPropertyDescriptor(r.prototype,"value"),s=Jc.getPropertyDescriptor(e,t),a=`_${t}`,l=class{get value(){return s?s.get.call(this):this[a]}set value(d){s?s.set.call(this,d):this[a]=d}},o=Jc.getPropertyDescriptor(l.prototype,"value");return Object.setPrototypeOf(r.prototype,l.prototype),Object.defineProperty(e,t,{configurable:!0,get:n.get||o.get,set:n.set||o.set}),()=>delete e[t]}static cleanupProperties(e,t=!1){return Object.entries(e).forEach(([r,n])=>{t?n===void 0&&delete e[r]:n==null&&delete e[r]}),e}static removeAllProperties(e){return Object.keys(e).forEach(t=>delete e[t]),e}static assertType(e,t,r){const n=Z.typeOf(e);if(e!=null&&n!==t)throw new Error(`Incorrect type "${n}" for ${r}, expected "${t}"`)}static assertObject(e,t){Tt.assertType(e,"object",t)}static assertInstance(e,t){Tt.assertType(e,"instance",t)}static assertClass(e,t){Tt.assertType(e,"class",t)}static assertFunction(e,t){if(typeof e!="function"||e.isBase||e.$$name)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a function)`)}static assertNumber(e,t,r){const n=Number(e);if(typeof e!="number"||isNaN(n)||r&&e<0)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a ${r?"positive ":""}Number)`)}static assertBoolean(e,t){Tt.assertType(e,"boolean",t)}static assertString(e,t){Tt.assertType(e,"string",t)}static assertArray(e,t){Tt.assertType(e,"array",t)}static toFixed(e,t){return Xv?Xv(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(t==null)return e;const r=10**t;return Math.round(e*r)/r}static getMapPath(e,t,r){const n=Array.isArray(t)?t:typeof t=="string"?t.split("."):[t],s=n.length===1,a=n[0],l=e.has(a)?e.get(a):e.set(a,s?r:{}).get(a);return s?l:Tt.getPathDefault(l,n.slice(1),r)}};y(Zv,"$name","ObjectHelper");var T=Zv;_e.register(T);var Tt=T;T._$name="ObjectHelper";var Jv=class Rg{static setVersion(e,t){e=e.toLowerCase(),Ht[e]={version:t,isNewerThan(s){return Rg.semanticCompareVersion(s,t,"<")},isOlderThan(s){return Rg.semanticCompareVersion(s,t,">")}};let r="";typeof productName!="undefined"&&(r=`${productName}.`);const n=`${r}${e}${t.replace(/\./g,"-")}`;if(Y.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(globalThis.bryntum[n]===!0)if(this.isTestEnv)globalThis.BUNDLE_EXCEPTION=!0;else{let s=r||e;s==="core"&&(s="grid");let a=O.capitalize(s);throw s==="schedulerpro"&&(a="SchedulerPro"),new Error(`The Bryntum ${a} bundle was loaded multiple times by the application.

Common reasons you are getting this error includes:

* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)
* Imports point to both sources and bundle
* Imports do not use the shortest relative path, JS treats them as different files
* Cache busters differ between imports, JS treats ${s}.module.js?1 and ${s}.module.js?2 as different files
* Imports missing file type, verify they all end in .js

See https://bryntum.com/products/${s}/docs/guide/${a}/gettingstarted/es6bundle#troubleshooting for more information

`)}else globalThis.bryntum[n]=!0}static getVersion(e){if(e=e.toLowerCase(),!Ht[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return Ht[e].version}static semanticCompareVersion(e,t,r="="){e=e||"",t=t||"";const n=e.split(/[-.]/),s=t.split(/[-.]/),a=r.includes("<"),l=(d,c)=>{const u=["rc","beta","alpha"],h=d.map(g=>{if(u.includes(g))return-u.indexOf(g)-2;const f=Number.parseInt(g);return Number.isNaN(f)?-u.length:f});for(;h.length<c;)h.push(-1);return h},o=()=>{const d=Math.max(n.length,s.length),c=l(n,d),u=l(s,d);for(let h=0;h<d;h++)if(c[h]!==u[h])return a?c[h]<u[h]:c[h]>u[h];return!0};switch(r){case"=":return e===t;case"<=":case">=":return e===t||o();case"<":case">":return e!==t&&o()}return!1}static checkVersion(e,t,r){return Rg.semanticCompareVersion(Ht.getVersion(e),t,r)}static deprecate(e,t,r){if(Ht.checkVersion(e,t,"<"))console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${r}`);else throw new Error(`Deprecated API use. ${r}`)}static get isTestEnv(){var e,t,r;const n=!!((e=globalThis.bryntum)!=null&&e.isTestEnv);try{return n||!!((r=(t=globalThis.parent)==null?void 0:t.bryntum)!=null&&r.isTestEnv)}catch(s){return n}}static get isDebug(){return!1}};y(Jv,"$name","VersionHelper");var re=Jv,Ht=re;Y.isBrowserEnv&&(Ht.isTestEnv&&(Y._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:Ht.getVersion.bind(Ht),checkVersion:Ht.checkVersion.bind(Ht),deprecate:Ht.deprecate.bind(Ht),license:"9867512b-2f0e-11f0-ab90-0aa8b363f5dd"})),_e.register(re),re._$name="VersionHelper";var Qv=/,\s*/,Og=Symbol("decompiled"),lx=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,ox=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,dx=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:cx}=Object.prototype,ey=class yv{static after(e,t,r,n,s){const a=typeof r=="string",l=(s==null?void 0:s.return)!==!1,o=(...d)=>{const c=o.$nextHook.call(e,...d),u=n!=null&&n.isDestroyed?void 0:l?a?n[r](c,...d):r.call(n,c,...d):a?n[r](...d):r.call(n,...d);return u===void 0?c:u};return yv.hookMethod(e,t,o)}static before(e,t,r,n){const s=typeof r=="string",a=(...l)=>{const o=n!=null&&n.isDestroyed?0:s?n[r](...l):r.call(n,...l);return o===!1?o:a.$nextHook.call(e,...l)};return yv.hookMethod(e,t,a)}static curry(e){return function t(...r){return r.length>=e.length?e.apply(this,r):function(...n){return t.apply(this,r.concat(n))}}}static bindAll(e){for(const t in e)typeof e[t]=="function"&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,r){return function(...n){const s=r||this;return t.call(s,...n)!==!1?e.call(s,...n):!1}}static createSequence(e,t,r,n){return function(...s){const a=e.call(r=r||this,...s),l=t.call(n||r,...s);return l===void 0?a:l}}static createThrottled(e,t,r,n,s){let a=-Number.MAX_VALUE,l,o;const d=()=>{o=0,a=performance.now(),l.push.apply(l,n),e.apply(r,l)},c=function(...u){const h=performance.now()-a;l=u,h>=t?(clearTimeout(o),d()):(o||(o=setTimeout(d,t-h)),s&&(l.push.apply(l,n),s.apply(r,l)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,t,r,n){let s,a;const l=()=>{a=0,o.isPending=!1,s.push.apply(s,n),e.apply(r,s)},o=function(...d){s=d,a&&clearTimeout(a),o.isPending=!0,a=setTimeout(l,t)};return o.cancel=()=>{o.isPending=!1,clearTimeout(a)},o}static decompile(e){if(!(Og in e)){const t=e.toString();let r=lx.exec(t),n,s,a,l,o;r?(n=[r[2]],s=r[3]):(r=ox.exec(t))?(o=r[2].trim(),n=o?o.split(Qv):[],s=r[3]):(r=dx.exec(t))&&(a=r[2],o=r[3].trim(),n=o?o.split(Qv):[],s=r[4]),s=s==null?void 0:s.trim(),e[Og]=l=r&&{args:n,async:!!r[1],body:s!=null&&s.startsWith("{")?s.substring(1,s.length-1).trim():s},a&&(l.name=a)}return e[Og]}static hookMethod(e,t,r){return r.$nextHook=e[t],e[t]=r,()=>{var n;if(cx.call(e,t)){let s=e[t],a;if(s===r)((n=Object.getPrototypeOf(e))==null?void 0:n[t])===r.$nextHook?delete e[t]:e[t]=r.$nextHook;else for(;a=s==null?void 0:s.$nextHook;s=a)if(a===r){s.$nextHook=r.$nextHook;break}}}}static noThrow(e,t,r){const n=e[t];e[t]=(...s)=>{try{return n.apply(e,s)}catch(a){return r==null?void 0:r(a)}}}static returnTrue(){return!0}static animate(e,t,r,n="linear"){let s=!1;const a=new Promise(l=>{const o=performance.now(),d=()=>{const c=Math.min((performance.now()-o)/e,1),u=r!=null&&r.setTimeout?r:globalThis;s||t.call(r,this.easingFunctions[n](c))===!1&&l(),s||c===1?u.requestAnimationFrame(()=>l()):u.requestAnimationFrame(d)};d()});return a.cancel=()=>(s=!0,a.cancelled=!0,!1),a}};y(ey,"$name","FunctionHelper");var be=ey;_e.register(be);var Ae=.5,Sr=1.70158,Vt=7.5625,iu=1.525,$g=2/2.75,Hg=2.25/2.75,Vg=1/2.75,Ng=1.5/2.75,Bg=2.5/2.75,zg=2.625/2.75,Wg=.75,jg=.9375,Ug=.984375,ux=1.70158,hx=1.70158;be.easingFunctions={linear:i=>i,easeInQuad:i=>Math.pow(i,2),easeOutQuad:i=>-(Math.pow(i-1,2)-1),easeInOutQuad:i=>(i/=Ae)<1?Ae*Math.pow(i,2):-Ae*((i-=2)*i-2),easeInCubic:i=>Math.pow(i,3),easeOutCubic:i=>Math.pow(i-1,3)+1,easeInOutCubic:i=>(i/=Ae)<1?Ae*Math.pow(i,3):Ae*(Math.pow(i-2,3)+2),easeInQuart:i=>Math.pow(i,4),easeOutQuart:i=>-(Math.pow(i-1,4)-1),easeInOutQuart:i=>(i/=Ae)<1?Ae*Math.pow(i,4):-Ae*((i-=2)*Math.pow(i,3)-2),easeInQuint:i=>Math.pow(i,5),easeOutQuint:i=>Math.pow(i-1,5)+1,easeInOutQuint:i=>(i/=Ae)<1?Ae*Math.pow(i,5):Ae*(Math.pow(i-2,5)+2),easeInSine:i=>-Math.cos(i*(Math.PI/2))+1,easeOutSine:i=>Math.sin(i*(Math.PI/2)),easeInOutSine:i=>-Ae*(Math.cos(Math.PI*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>i===0?0:i===1?1:(i/=Ae)<1?Ae*Math.pow(2,10*(i-1)):Ae*(-Math.pow(2,-10*--i)+2),easeInCirc:i=>-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-Math.pow(i-1,2)),easeInOutCirc:i=>(i/=Ae)<1?-Ae*(Math.sqrt(1-i*i)-1):Ae*(Math.sqrt(1-(i-=2)*i)+1),easeOutBounce:i=>i<Vg?Vt*i*i:i<$g?Vt*(i-=Ng)*i+Wg:i<Bg?Vt*(i-=Hg)*i+jg:Vt*(i-=zg)*i+Ug,easeInBack:i=>i*i*((Sr+1)*i-Sr),easeOutBack:i=>(i=i-1)*i*((Sr+1)*i+Sr)+1,easeInOutBack:i=>{let e=ux;return(i/=Ae)<1?Ae*(i*i*(((e*=iu)+1)*i-e)):Ae*((i-=2)*i*(((e*=iu)+1)*i+e)+2)},elastic:i=>-1*Math.pow(4,-8*i)*Math.sin((i*6-1)*(2*Math.PI)/2)+1,swingFromTo:i=>{let e=hx;return(i/=Ae)<1?Ae*(i*i*(((e*=iu)+1)*i-e)):Ae*((i-=2)*i*(((e*=iu)+1)*i+e)+2)},swingFrom:i=>i*i*((Sr+1)*i-Sr),swingTo:i=>(i-=1)*i*((Sr+1)*i+Sr)+1,bounce:i=>i<Vg?Vt*i*i:i<$g?Vt*(i-=Ng)*i+Wg:i<Bg?Vt*(i-=Hg)*i+jg:Vt*(i-=zg)*i+Ug,bouncePast:i=>i<Vg?Vt*i*i:i<$g?2-(Vt*(i-=Ng)*i+Wg):i<Bg?2-(Vt*(i-=Hg)*i+jg):2-(Vt*(i-=zg)*i+Ug),easeFromTo:i=>(i/=Ae)<1?Ae*Math.pow(i,4):-Ae*((i-=2)*Math.pow(i,3)-2),easeFrom:i=>Math.pow(i,4),easeTo:i=>Math.pow(i,.25)},be._$name="FunctionHelper";var{defineProperty:ru,getOwnPropertyDescriptor:ty}=Reflect,{hasOwnProperty:gx,toString:Gg}=Object.prototype,Yg=Symbol("instanceProperties"),iy=Symbol("configuring"),zs=Symbol("lazyConfigValues"),ry=Gg.call(new Date),fx=/\s+/,ny=Object.hasOwn||((i,e)=>gx.call(i,e)),sy=(i,e)=>i===e?!0:i&&e&&Gg.call(i)===ry&&Gg.call(e)===ry?i.getTime()===e.getTime():!1,qg=(i,e)=>(i.setHours(0,0,0,0),e&&i.setDate(i.getDate()+e),i),ay={now:()=>new Date,today:()=>qg(new Date),tomorrow:()=>qg(new Date,1),yesterday:()=>qg(new Date,-1)},mx=(i,e)=>(i[e]=1,i),px=(i,e)=>function(){var t;return(t=this.configObserver)==null||t.get(i,this),e.call(this)},Re=class Hs{static get(e,t){const{cache:r}=this,n=r[e]||(r[e]=new Hs(e));let s=n,a;return t&&(a=Hs.makeCacheKey(e,t),(s=a&&r[a])||(s=n.extend(t),a&&(r[a]=s))),s}constructor(e){const t=this,r=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=r,t.changer="change"+r,t.initializing="initializing"+r,t.updater="update"+r,t.updaterResult=`${e}Updated`}get descriptor(){let e=this._descriptor;return(!e||!ny(this,"_descriptor"))&&(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return(!e||!ny(this,"_initDescriptor"))&&(this._initDescriptor=e=this.makeInitter()),e}convert(e,t){return e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{convert:r,equal:n,merge:s}=e,{convertMethods:a,equalityMethods:l}=Hs;return typeof r=="string"&&!(t.convert=a[r])&&r.endsWith("[]")&&(t.convert=a[r]=Hs.makeArrayConvert(a[r.slice(0,-2)])),typeof n=="string"&&!(t.equal=l[n])&&n.endsWith("[]")&&(t.equal=l[n]=Hs.makeArrayEquals(l[n.slice(0,-2)])),typeof s=="string"&&(t.merge=Hs.mergeMethods[s]),t}define(e){const{name:t}=this,r=ty(e,t);let n=this.descriptor;r!=null&&r.get&&(n=Object.assign({},n),n.get=px(t,r.get)),ru(e,t,n)}defineInitter(e,t){const r=this,{name:n}=r,s=e[Yg];let a,l;!s[n]&&(l=ty(e,n))&&!("value"in l)&&(s[n]=l),ru(e,n,r.initDescriptor),r.lazy&&(a=e[zs]||(e[zs]=new Map),a.set(n,t))}static makeArrayConvert(e){return function(t,r){return t!=null&&(Array.isArray(t)?t=t.map((n,s)=>e.call(this,n,r)):t=[e.call(this,t,r)]),t}}static makeArrayEquals(e){return(t,r)=>{let n,s=t&&r&&t.length===(n=r.length);if(s&&Array.isArray(t)&&Array.isArray(r))if(e)for(;s&&n-- >0;)s=e(t[n],r[n]);else for(;s&&n-- >0;)s=t[n]===r[n];else s=e?e(t,r):t===r;return s}}static makeCacheKey(e,t){const r=Object.keys(t).sort();for(let n,s,a,l=r.length;l-- >0;)if(a=t[n=r[l]],a==null&&a===!1)r.splice(l,1);else{if(s=typeof a,s==="function")return null;s==="string"?r[l]=`${n}:"${a}"`:s==="number"&&(r[l]=`${n}:${a}`)}return r.length?`${e}>${r.join("|")}`:e}makeDescriptor(){const{base:e,field:t,changer:r,updater:n,name:s,updaterResult:a}=this;return e!==this?e.descriptor:{get(){var l;return(l=this.configObserver)==null||l.get(s,this),this[t]},set(l){var o,d;const c=this,u=l,h=c.$meta.configs[s];let g=c[t],f,m;if(typeof l=="string"){let p=l;l.startsWith("up.")?p=(o=c.owner)==null?void 0:o.resolveProperty(l.slice(3)):l.startsWith("this.")&&(p=c.resolveProperty(l.slice(5))),p!==void 0&&typeof p!="function"&&(l=p)}h.convert!==ly&&(l=h.convert(l,c)),c[r]&&(f=(m=c[r](l,g))===void 0&&1,f||(l=m,g=c[t])),!f&&!(h.equal===oy?g===l:h.equal(g,l))&&(c[t]=l,f=2,c[a]=(d=c[n])==null?void 0:d.call(c,l,g)),f&&!c.isDestroyed&&!c.onConfigChange.$nullFn&&c.onConfigChange({name:s,value:l,was:g,config:h,applied:f,origPassedValue:u})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:r}=e;return{configurable:!0,get(){const n=this;return e.removeInitter(n),n[t]=!0,n[r]=n[iy][r],n[t]=!1,n.configDone[r]=!0,n[r]},set(n){e.removeInitter(this),this.configDone[r]=!0,this[r]=n}}}makeLazyInitter(){const e=this,{initializing:t,name:r}=e;return{configurable:!0,get(){const n=this,s=n[zs].get(r);return e.removeInitter(n),n.isDestroying||(n[t]=!0,n[r]=s,n[t]=!1),n[r]},set(n){e.removeInitter(this),this[r]=n}}}removeInitter(e){const{name:t}=this,r=e[Yg][t],n=e[zs];r?ru(e,t,r):delete e[t],n!=null&&n.delete(t)&&!n.size&&delete e[zs]}setDefault(e,t){ru(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}merge(e,t){if(t&&e&&Z.isObject(e)){if(t.isBase)return t.setConfig(e);Z.isObject(t)&&(e=Z.merge(Z.clone(t),e))}return e}},{prototype:Ro}=Re,{convert:ly,equal:oy}=Ro;Re.symbols={configuring:iy,instanceProperties:Yg,lazyConfigs:zs},Re.cache=Object.create(null),Re.convertMethods={array:Re.makeArrayConvert(ly),date(i,e){let t=i,r,n,s;if(ay[i])t=ay[i]();else if(i!=null){if(typeof i!="string")r=new Date(i);else{if(s=this.formats,s){s=s.flatMap(a=>a in e?e[a]:a);for(n of s)if(r=n&&_e.Date.parse(i,n),r)break}r||(r=_e.Date.parse(i))}if(isNaN(r)){if(this.strict)throw new Error(`Invalid date: ${i}`)}else t=r}return t},day(i,e){return i=Re.convertMethods.date.call(this,i,e),i==null||i.setMinutes(0,0,0),i}},Re.equalityMethods={array:Re.makeArrayEquals(),date:sy,day:sy,strict:Re.equal=oy},Re.mergeMethods={distinct(i,e){let t=e?e.slice():[];if(i!=null)if(Z.isObject(i))if(e===void 0)t=i;else{let r,n;for(r in i)n=t.indexOf(r),i[r]?n<0&&t.push(r):n>-1&&t.splice(n,1)}else Array.isArray(i)?i.forEach(r=>!t.includes(r)&&t.push(r)):t.includes(i)||t.push(i);return t},merge:Re.merge=Ro.merge,classList(i,e){if(typeof i=="string"){if(!i.length)return e;i=i.split(fx)}return Array.isArray(i)&&(i=i.reduce(mx,{})),Re.merge(i,e)},objects(i,e){return i===!0?e||{}:Re.merge(i,e)},replace(i){return i},items(i,e,t,r){return r?Z.mergeItems(e,i,{merge:(n,s)=>Ro.merge(s,n)}):Ro.merge(i,e)}},Object.assign(Ro,{_descriptor:null,_initDescriptor:null,date:!1,lazy:!1,nullify:!1,render:!1}),Re._$name="Config";var vx=class{constructor(i,e,t,r){const n=this;let s,a;n.destroyed=!1,n.mapFwd={},n.mapRev={},n.source=i,n.syncing=!1,n.target=e,n.sourceHook=_e.Function.after(i,"onConfigChange",l=>n.onConfigChange(l,!0),n,hy),n.targetHook=r!=null&&r.oneway?null:_e.Function.after(e,"onConfigChange",l=>n.onConfigChange(l,!1),n,hy);for(s in t)a=t[s],a&&(typeof a!="string"&&(a=s),n.mapFwd[s]=a,n.mapRev[a]=s);n.unbind=n.destroy.bind(n),n.unbind.binding=n}destroy(){var i,e;this.destroyed||(this.destroyed=!0,(i=this.sourceHook)==null||i.call(this),(e=this.targetHook)==null||e.call(this))}onConfigChange(i,e){const t=this;(e?t.mapFwd:t.mapRev)[i.name]&&t.sync(e)}sync(i){i=i!==!1;const e=this,[t,r,n]=i?[e.source,e.target,e.mapFwd]:[e.target,e.source,e.mapRev];if(!e.syncing&&!t.isDestroying&&!r.isDestroying){let s=0,a,l,o,d,c,u;e.syncing=!0;for(l in n)d=n[l],o=t[l],o!==r[d]&&(++s,(a||(a={}))[c=d]=u=o);s>1?r.setConfig(a):s&&(r[c]=u),e.syncing=!1}}},dy=class{constructor(i){i&&Object.assign(this,i)}getInherited(i,e=!0){var t;let r=this[i];return i in this||(r=(t=this.super)==null?void 0:t.getInherited(i,e),(r||e)&&(this[i]=r=Object.create(r||null),Kg(r,"$meta",{value:this}))),r}},{getPrototypeOf:cy}=Object,{defineProperty:Kg}=Reflect,mi=(i=>(e,t)=>i.call(e,t))(Object.prototype.hasOwnProperty),nu=Symbol("classMetaData"),uy=Symbol("mixinTag"),Xg=Symbol("originalConfig"),FP=Symbol("createdAt"),pi=Re.symbols.configuring,yx=Re.symbols.instanceProperties,vn=Re.symbols.lazyConfigs,bx={merge:"replace",simple:!0},Zg=i=>_e.Object.clone(i),Jg=()=>{},Cx=i=>new dy(i),To=i=>_e.Object.isObject(i),hy={return:!1},gy={},wx=Object.freeze({}),fy=Object.freeze([]),Sx=/^(date|day)(\[])?$/,$=class mr{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,r=t.constructor;t.$meta.class!==r&&(r.$meta.initialized=!0),t.construct(...e),t.afterConstruct(),t.isConstructing=!1}static new(...e){return e=e.filter(t=>t),e=e.length>1?this.mergeConfigs(...e):e[0],new this(e)}construct(...e){e[0]!==null&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=r=>{r!=null&&r.destroy?r.destroy():Array.isArray(r)&&r.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=Jg,e.doDestroy(),Object.setPrototypeOf(e,null);for(const r in e)r!=="destroy"&&r!=="isDestroying"&&delete e[r];delete e[Xg],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return mi(this,"$name")&&this.$name||mi(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}animateProperty(e,t,r=1e3,n){const s=t==null,a=this[e]||0,l=(t||0)-a,o=be.animate(r,d=>this[e]=a+l*d,null,n);return s&&o.then(()=>this[e]=null),o}callback(e,t,r=fy){const{handler:n,thisObj:s}=this.resolveCallback(e,t==="this"?this:t)||wx;return n==null?void 0:n.apply(s,r)}resolveProperty(e){let t=this;for(;t;){if(mr.hasConfigPath(t,e,!0))return _e.Object.getPath(t,e);t=t.owner}}resolveCallback(e,t=this,r=!0){if(e!=null&&e.substring){if(e.endsWith("?")&&(r=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substring(5),t=this);if(!t||!(t instanceof Object))return;e=t[e]}if(typeof e=="function")return{handler:e,thisObj:t};if(r)throw new Error(`No method named ${e} on ${t.$$name||"thisObj object"}`)}bindCallback(e,t=this){if(e){const{handler:r,thisObj:n}=this.resolveCallback(e,t);if(r)return r.bind(n)}}delay(e,t,r=e.name||e){return e=this.setTimeout?e:e.bind(this),(this.setTimeout?this:globalThis)[typeof t=="number"?"setTimeout":"requestAnimationFrame"](e,t,r)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let r=0;r<t.length;++r)e[t[r].field]!=null&&(e[t[r].name]=null)}destroyProperties(...e){var t,r;const n=this;let s;for(s of e)s in n&&(!n[pi]||!n[pi][s])&&((r=(t=n[s])==null?void 0:t.destroy)==null||r.call(t),delete n[s])}configure(e={}){const t=this,r=t.$meta,{beforeConfigure:n}=t.initialConfig=e,{configs:s}=r,a=t.getDefaultConfiguration();let l,o,d;t.isConfiguring=!0,Object.assign(t,t.getProperties());for(o in e)d=e[o],l=s[o],a[o]=l?l.merge(d,a[o],null,r):d;n&&(delete a.beforeConfigure,n(t,a)),t.setConfig(t[Xg]=a,!0),t.isConfiguring=!1}bindConfigs(e,t,r){const n=new vx(this,e,t,r);return(r==null?void 0:r.sync)!==!1&&n.sync(),n.unbind}getConfig(e,...t){const r=this[e];return t.length?[r,...t.map(n=>this[n])]:r}updateConfiguration(e){var t;const r=this,{configDone:n}=r,{configs:s}=r.$meta,a=r[pi],l=r[vn];r.recompose.suspend();for(const o in e)n[o]?r[o]=e[o]:(t=s[o])!=null&&t.lazy?l.set(o,e[o]):a[o]=e[o];r.recompose.resume(),r.recompose.flush()}setConfig(e,t=!1){var r;const n=this,s=n[pi],a=s?n.configDone:n.configDone={},l=n.$meta.configs,o=n[vn];let d,c;n[yx]={},n[pi]=s?Object.assign(Object.create(s),e):e;for(c in e)d=l[c]||Re.get(c),e[c]!==null||mi(e,c)||d.default===null?(o!=null&&o.has(c)||d.defineInitter(n,e[c]),t||(a[c]=!1)):a[c]=!0;t&&n.startConfigure(e);for(c in e)!a[c]&&!(t&&((r=l[c])!=null&&r.lazy))&&(n[c]=e[c]);return s?n[pi]=s:delete n[pi],t&&n.finishConfigure(e),n}hasConfig(e){var t;const r=this,n=r[pi];return!!(r["_"+e]!=null||((t=r[vn])==null?void 0:t.get(e))!=null||!r.configDone[e]&&n&&(n[e]!=null||mi(n,e)))}static hasConfigPath(e,t){return t.split(".").every(r=>{var n,s,a;const l=(s=(n=e==null?void 0:e.$meta)==null?void 0:n.configs)==null?void 0:s[r];return(l&&l.descriptor.get===((a=_e.Object.getPropertyDescriptor(e,r))==null?void 0:a.get)?e.hasConfig(r):r in e)?(e=e[r],Object!==void 0):!1})}peekConfig(e){const t=this,r=t[vn],n=t[pi];if(r!=null&&r.has(e))return r.get(e);if(n&&e in n){if(t.configDone[e])return t[e];if(n[e]!=null||mi(n,e))return n[e]}}triggerConfig(e){const t=this,{configDone:r}=t,n=t[vn],s=t[pi],a=n!=null&&n.has(e)||s&&(s[e]!=null||mi(s,e))?!r[e]:null;return a&&t.getConfig(e),a}triggerConfigs(e){const t=this,r=t.$meta.configs,n=t[vn],s=n?[...n.keys()].filter(a=>r[a].lazy===e):fy;for(const a of s)t.triggerConfig(a);return s.length?s:null}onConfigChange(){}get config(){const e={},t=this[Xg];for(const r in t)e[r]=t[r];return e}static processConfigValue(e,t){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map(r=>mr.processConfigValue(r,t));if(e instanceof mr)return t.visited.has(e)?void 0:e.getCurrentConfig(t);if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(To(e)){const r={};for(const n in e)n!=="owner"&&(r[n]=mr.processConfigValue(e[n],t));return r}return e}getConfigValue(e,t){var r;const n=this,s=n[vn];if(!((r=n.$meta.configs[e])!=null&&r.lazy))return mr.processConfigValue(n[e],t);if(s!=null&&s.has(e))return mr.processConfigValue(s.get(e),t)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const t=this,r=e.configs==="all"?t.config:Zg(t.initialConfig),n=e.skip||{},s=e.visited||(e.visited=new Set),a=e.depth||(e.depth=0),l={};if(!s.has(t)){s.add(t),this.preProcessCurrentConfigs(r);for(const o in r){if(n[o])continue;const d=t.getConfigValue(o,{...e,depth:a+1});d!==void 0&&(l[o]=d)}return l}}getConfigString(e={}){return _e.String.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const t=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(t){const r=t.toLowerCase(),n=`../../build/${r}.module.js`;let s,a;e.import==="static"?(s=`import * as module from "${n}";Object.assign(window, module);`,a=""):(s=`import("${n}").then(module => { Object.assign(window, module);
`,a="});");const l=re.getVersion(r);return l&&(s+=`
console.log('${t} ${l}');
`),`${s}      
const ${r} = new ${t}(${this.getConfigString(e)});
${a}`}}downloadTestCase(e={}){e.output="return";const t=this.getTestCase(e);_e.Browser.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}static initClass(){return this.$meta.class}static get $meta(){if(!mi(this,nu)){const e=this[nu]=new dy;return e.class=this,this.setupClass(e),e}return this[nu]}static onClassMixedIn(){}static mergeConfigs(e,...t){const r=this.$meta.configs,n=Zg(e)||{};let s,a,l,o;for(a=0;a<t.length;++a)if(s=t[a],s)for(l in s)o=s[l],r[l]?o=r[l].merge(o,n[l]):n[l]&&o&&(o=Re.merge(o,n[l])),n[l]=o;return n}static mixin(...e){let t=this,r;for(r=0;r<e.length;++r){const n=e[r],s=n[uy]||(n[uy]=Symbol("mixinTag"));t[s]||(t=n(t),t[s]=!0,mi(t,"onClassMixedIn")&&t.onClassMixedIn())}return t}static setupClass(e){var t;const r=e.class,n=cy(r).$meta,s=r.$$name,a=n.names,l=r.prototype;if(Kg(l,"$meta",{value:e}),Object.assign(e,{super:n,config:Object.create(n.config),configs:Object.create(n.configs),declarables:n.declarables,forkConfigs:n.forkConfigs,hierarchy:Object.freeze([...n.hierarchy,r]),names:a.includes(s)?a:Object.freeze([...a,s]),properties:n.properties,nullify:(t=n.nullify)==null?void 0:t.slice()}),a!==e.names){const o=`is${s}`,d=c=>{mi(c,o)||Kg(c,o,{get(){return!0}})};d(l),d(r)}for(let o,d,c=0;c<e.declarables.length;++c)o=e.declarables[c],mi(r,o)&&(d=gy[o]||(gy[o]=`setup${_e.String.capitalize(o)}`),r[d](r,e))}static setupConfigs(e,t,r){const n=e.config,s=e.configs,a=e.class,l=e.super;let{nullify:o}=e,d,c,u,h,g,f;for(const m in t)g=t[m],r?(d=s[m])?g=d.merge(g,n[m],e,l):d=Re.get(m,bx):(c=u=h=void 0,g&&typeof g=="object"&&"$config"in g&&(u=g.$config,Sx.test(String(u))&&(u={type:u}),u&&(To(u)?u.type&&(u={convert:u.type,equal:u.type,...u},delete u.type):u=_e.Object.createTruthyKeys(u)),h="default"in g,c=h?g.default:c,g="value"in g?g.value:null),(d=s[m])?(f=d.nullify,u&&(d=d.extend(u)),g=d.merge(g,n[m],e,l)):(d=Re.get(m,u),d.define(a.prototype),h=!(d.field in a.prototype),f=!1),h&&d.setDefault(a,c),d.nullify&&!f&&(o||(o=e.nullify||(e.nullify=[]))).push(d)),g&&(To(g)||Array.isArray(g))&&!Object.isFrozen(g)&&(e.forkConfigs=!0),s[m]=d,n[m]=g}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const r=e.declarable;let n=t.declarables,s,a;for(a=0;a<r.length;++a)n.includes(r[a])||(s||(t.declarables=s=n=n.slice()),n.push(r[a]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}static fork(e){let t=e,r,n;if(e&&To(e)&&!Object.isFrozen(e)){t=Object.create(e);for(r in e)n=e[r],n&&(To(n)?t[r]=mr.fork(n):Array.isArray(n)&&(t[r]=n.slice()))}return t}static getDefaultConfiguration(){return this.$meta.class.prototype.getDefaultConfiguration()}getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?mr.fork(e.config):Object.create(e.config);if(re.isTestEnv&&_e.Browser.isBrowserEnv&&t.testConfig&&globalThis.__applyTestConfigs)for(const r in t.testConfig)t[r]=t.testConfig[r];return t}getProperties(){const e=this.$meta.properties,t={};for(let r=0;r<e.length;r++){const n=Object.getOwnPropertyDescriptor(e[r],"properties");Object.assign(t,n.get!==void 0?e[r].properties:Zg(n.value))}return t}static applyDefaults(e){for(const t in e)this.$meta.config[t]=e[t]}static get superclass(){return cy(this)}classHierarchy(e){const t=this.$meta.hierarchy,r=e?t.indexOf(e):0;return r>0?t.slice(r):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(...e){const{$detachers:t}=this;if(t){for(let r=0,{length:n}=e,s;r<n;r++)if(s=t[e[r]])for(;s.length;)s.pop()()}}trackDetacher(e,t){const r=this.$detachers||(this.$detachers={});(r[e]||(r[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const r in t){const n=t[r];for(let s=n.length;s-- >0;)n[s].eventer===e&&n.splice(s,1)}}},Qg=$.prototype;Qg.onConfigChange.$nullFn=Jg.$nullFn=!0,$[nu]=Qg.$meta=Cx({class:$,config:Object.freeze({}),configs:Object.create(null),declarables:$.declarable,forkConfigs:!1,hierarchy:Object.freeze([$]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(Qg,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),$.emptyFn=Jg,re.setVersion("core","6.2.2"),$._$name="Base";var my=class yE{static clean(e){return e.reduce((t,r)=>(r!=null&&!(Array.isArray(r)&&r.length===0)&&r!==""&&t.push(r),t),[])}static from(e,t,r){const n=[];if(e)for(const s of e)(!t||t(s))&&n.push(r?r(s):s);return n}static remove(e,...t){let r,n,s=!1;t=t[0]instanceof Set?[...t[0]]:t;for(let a=0;a<t.length;a++)n=t[a],(r=e.indexOf(n))!==-1&&(e.splice(r,1),s=!0);return s}static findInsertionIndex(e,t,r=this.lexicalCompare,n){const s=t.length;let a,l;return n<s&&(a=n>0?r(t[n-1],e):0,l=n<s-1?r(e,t[n]):0,a<1&&l<1)?n:this.binarySearch(t,e,r)}static findLast(e,t,r){for(let{length:n}=e,s=n-1;s>=0;s--)if(t.call(r,e[s],s,e))return e[s]}static binarySearch(e,t,r=0,n=e.length,s=this.lexicalCompare){const a=e.length;let l,o;for(r instanceof Function?(s=r,r=0):n instanceof Function&&(s=n,n=a),--n;r<=n;)l=r+n>>1,o=s(t,e[l]),o>=0?r=l+1:o<0&&(n=l-1);return r}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return e=String(e),t=String(t),e<t?-1:e>t?1:0}static fill(e,t={},r=null){const n=[],s=Array.isArray(t)?t:[t];for(let a=0;a<e;a++)for(const l of s){const o=Object.assign({},l);r&&r(o,a),n.push(o)}return n}static populate(e,t,r=!1){const n=[];for(let s=0;s<e;s++)n.push(t(s+(r?1:0)));return n}static include(e,...t){for(const r of t)e.includes(r)||e.push(r)}static unique(e){return[...new Set(e)]}static countUnique(e){const t=new Map;for(const r of e){const n=t.get(r);t.set(r,n===void 0?1:n+1)}return[...t.entries()].map(([r,n])=>({value:r,count:n}))}static allowNegative(e){return new Proxy(e,{get(t,r,n){if(typeof r!="string")return Reflect.get(t,r,n);const s=Number(r);return Number.isNaN(s)?Reflect.get(t,r,n):t[s<0?t.length+s:s]},set(t,r,n,s){if(typeof r!="string")return Reflect.set(t,r,n,s);const a=Number(r);return Number.isNaN(a)?Reflect.set(t,r,n,s):(t[a<0?t.length+a:a]=n,!0)}})}static delta(e,t,r=!1){if(!t)return r?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const n=[],s=[],a=new Set,l=new Set(t);for(let o=0;o<e.length;o++){const d=e[o];l.has(d)?a.add(d):n.push(d)}for(let o=0;o<t.length;o++){const d=t[o];a.has(d)||s.push(d)}return r?{toAdd:n,toRemove:s,toKeep:a}:{onlyInA:n,onlyInB:s,inBoth:[...a]}}static asArray(e){return e==null?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,t,r=yE.identity){const n=typeof t=="string"?a=>a==null?void 0:a[t]:t,s=typeof r=="string"?a=>a==null?void 0:a[r]:r;return e.reduce((a,l)=>(a[n(l)]=s(l),a),{})}static aggregate(e,t,r,n,s={}){const a=e.length,l=[];if(!a)return l;const o=e[0].length;s.targetArray=l,s.arrays=e;for(let d=0;d<o;d++)s.entryIndex=d,l.push(n(d,s));for(let d=0;d<a;d++){const c=e[d];s.rowIndex=d;for(let u=0;u<o;u++){s.entryIndex=u;const h=t(c[u],s);l[u]=r(l[u],h,d,u,s)}}return l}static groupBy(e,t){const r=typeof t=="string"?n=>n==null?void 0:n[t]:t;return e.reduce((n,s)=>{const a=r(s);return(n[a]=n[a]||[]).push(s),n},{})}static groupByIndexed(e,t){return e.reduce((r,n)=>{const s=t(n);let a=r.get(s);return a===void 0&&(a=new Set,r.set(s,a)),a.add(n),r},new Map)}};y(my,"$name","ArrayHelper");var B=my;_e.register(B),B._$name="ArrayHelper";var{isArray:py}=Array,{hasOwnProperty:Dx}=Object.prototype,vy={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},yy=(i,e)=>e.prio-i.prio,by=(i,e)=>{if(i!==null){if(!i)return e;e&&(i=i?[i]:[],i.push[py(e)?"apply":"call"](i,e))}return i},Fe=i=>{var e;return e=class extends(i||$){constructor(){super(...arguments),y(this,"eventsSuspended",null)}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(t,r){const n=r.getInherited("deprecatedEvents"),s=t.deprecatedEvents;for(const a in s)n[a.toLowerCase()]=n[a]=s[a]}static get configurable(){return{listeners:{value:null,$config:{merge:by}},internalListeners:{value:null,$config:{merge:by}},bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(t,...r){(this.configuredListeners=t==null?void 0:t.listeners)&&(t=Z.assign({},t),delete t.listeners),super.construct(t,...r),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const t=this,{isConfiguring:r}=t;t.isConfiguring=!1,t.listeners=t.configuredListeners,t.configuredListeners=null,t.isConfiguring=r}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(t){super.setupClass(t),e.prototype.onListen.$nullFn=!0,e.prototype.onUnlisten.$nullFn=!0}addListener(t,r,n){var s;if(py(t)){for(let o=0,{length:d}=t;o<d;o++)this.addListener(t[o],r);return}const a=this,l=a.$meta.getInherited("deprecatedEvents");if(typeof t=="string")return a.addListener({[t]:r,detachable:r.detachable!==!1,thisObj:n});{r=t.thisObj=t.thisObj!==void 0?t.thisObj:r;for(const u in t)if(!vy[u]&&t[u]!=null){const h=u.toLowerCase(),g=l==null?void 0:l[h],f=a.eventListeners||(a.eventListeners={}),m=B.asArray(t[u]);if(g){const{product:p,invalidAsOfVersion:v,message:b}=g;re.deprecate(p,v,b)}for(const p of m){const v=p.expires||t.expires,b={fn:typeof p=="object"?p.fn:p,thisObj:p.thisObj!==void 0?p.thisObj:r,args:p.args||t.args,prio:p.prio!==void 0?p.prio:t.prio!==void 0?t.prio:0,once:p.once!==void 0?p.once:t.once!==void 0?t.once:!1,buffer:p.buffer||t.buffer,throttle:p.throttle||t.throttle,$internal:t.$internal,catchAll:u==="catchAll"};if(v){const{alt:D}=v,S=D?v.delay:v,x=t.name||u,R=()=>{a.un(h,b),D&&!b.called&&a.callback(D,r)};a.isDelayable?a.setTimeout({fn:R,name:x,cancelOutstanding:!0,delay:S}):globalThis.setTimeout(R,S)}let w=f[h]||(f[h]=[]);w.$firing&&(f[h]=w=w.slice()),w.splice(B.findInsertionIndex(b,w,yy,w.length),0,b),!a.onListen.$nullFn&&w.length<2&&a.onListen(h),(s=a.afterAddListener)==null||s.call(a,h,b)}}t.relayAll&&a.relayAll(t.relayAll),r&&r!==a&&a.attachAutoDetacher(t,r);const o=t.detachable!==!1,d=t.name,c=t.expires||o||d?()=>{a.isDestroyed||a.removeListener(t,r)}:null;if(c&&(c.eventer=a,c.listenerName=d,d&&(r!=null&&r.trackDetacher)&&r.trackDetacher(d,c),t.expires&&a.delay(c,isNaN(t.expires)?t.expires.delay:t.expires,d),o))return c}}on(t,r,n){return this.addListener(t,r,n)}ion(t){return t.$internal=!0,this.on(t)}un(...t){this.removeListener(...t)}updateInternalListeners(t,r){r==null||r.detach(),t&&(t.detach=this.ion(t))}get listeners(){return this.eventListeners}changeListeners(t){if(this.isConfiguring)this.getConfig("internalListeners"),t&&this.on(t,this);else{if(Array.isArray(t))for(let r=0,n=t[0],{length:s}=t;r<s;n=t[++r])"thisObj"in n||(t[r]=Z.assign({thisObj:this},n));else t&&!("thisObj"in t)&&(t=Z.assign({thisObj:this},t));return t}}updateListeners(t,r){r&&this.un(r),t&&this.on(t)}removeListener(t,r=t.thisObj,n){var s;const a=this;if(typeof t=="string")return a.removeListener({[t]:r},n);for(let l in t){const o=t[l];if(!vy[l]&&o!=null){l=l.toLowerCase();const{eventListeners:d}=a,c=a.findListener(l,o,r);if(c>=0){let u=d[l];(s=a.afterRemoveListener)==null||s.call(a,l,u[c]),u.length>1?(u.$firing&&(d[l]=u=u.slice()),u.splice(c,1)):(delete d[l],a.onUnlisten.$nullFn||a.onUnlisten(l))}}}t.thisObj&&!t.thisObj.isDestroyed&&a.detachAutoDetacher(t)}findListener(t,r,n){var s;const a=(s=this.eventListeners)==null?void 0:s[t],l=r.fn||r,o=r.thisObj||n;if(a){for(let d,c=0,{length:u}=a;c<u;c++)if(d=a[c],d.fn===l&&d.thisObj===o)return c}return-1}hasListener(t){var r;return!!((r=this.eventListeners)!=null&&r[t==null?void 0:t.toLowerCase()])}relayAll(t,r,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const{relayAllTargets:s}=this;t.ion({beforeDestroy:({source:a})=>{a===t&&s.filter(o=>o.through===t).forEach(o=>B.remove(s,o))}}),s.push({through:t,prefix:r,transformCase:n})}removeAllListeners(t=!0){var r;const n=this.eventListeners;let s,a;for(const l in n){const o=n[l];for(s=o.length;s-- >0;){const d=o[s];(!d.$internal||!t)&&(this.removeListener(l,d),a=d.thisObj,(r=a==null?void 0:a.untrackDetachers)==null||r.call(a,this))}}}relayEvents(t,r,n="",s){const a={detachable:!0,thisObj:this};return r.forEach(l=>{n&&(l=O.capitalize(l)),a[l]=(o,...d)=>(s&&(o=Object.assign({},o,{source:this})),this.trigger(n+l,o,...d))}),t.on(a)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:t,target:r,oldDestructor:n}=this;for(let s=0;s<t.length;s++){const{dispatcher:a,config:l}=t[s];a.isDestroyed||a.removeListener(l,r)}n.call(r)}attachAutoDetacher(t,r){const n=t.thisObj||r,s="doDestroy"in n?"doDestroy":"destroy";if(s in n){let{$autoDetachers:a}=n;a||(n.$autoDetachers=a=[]),n.$oldDestructor||(n.$oldDestructor=n[s],n[s]=this.destructorInterceptor.bind({autoDetachers:a,oldDestructor:n.$oldDestructor,target:n})),a.push({config:t,dispatcher:this})}else n[s]=()=>{this.removeListener(t)}}detachAutoDetacher(t){const r=t.thisObj;r.$oldDestructor&&!r.isDestroying&&(B.remove(r.$autoDetachers,r.$autoDetachers.find(n=>n.config===t&&n.dispatcher===this)),r.$autoDetachers.length||(r["doDestroy"in r?"doDestroy":"destroy"]=r.$oldDestructor,r.$oldDestructor=null))}once(t,r){return this.ion({[t]:n=>this.callback(r,this,[n]),once:!0})}await(t,r={checkLog:!0,resetLog:!0,args:null,expires:null}){const n=this;r===!1&&(r={checkLog:!1});const{args:s}=r;return new Promise(a=>{var l;if(r.checkLog&&((l=n._triggered)!=null&&l[t])&&(a(),r.resetLog&&n.clearLog(t)),s){const o=n.on({[t]:(...d)=>{(typeof s=="function"?s(...d):Object.keys(s).every(u=>u in d[0]&&d[0][u]===s[u]))&&(a(...d),r.resetLog&&n.clearLog(t),o())},expires:r.expires,prio:-1e4})}else n.on({[t]:(...o)=>{a(...o),r.resetLog&&n.clearLog(t)},expires:r.expires,prio:-1e4,once:!0})})}clearLog(t){this._triggered&&(t?delete this._triggered[t]:this._triggered={})}trigger(t,r){var n,s,a,l;const o=this,d=t.toLowerCase(),{eventsSuspended:c,relayAllTargets:u,callOnFunctions:h}=o;let g=(n=o.eventListeners)==null?void 0:n[d],f;if(o._triggered||(o._triggered={}),o._triggered[t]=!0,c)return c.shouldQueue&&c.queue.push(arguments),!0;if((s=o.eventListeners)!=null&&s.catchall&&((g=g?g.slice():[]).push(...o.eventListeners.catchall),g.sort(yy)),!g&&!u&&!h)return!0;if(r?"source"in r||(Object.isExtensible(r)?r.source=o:(r=Object.create(r),Object.assign(r,{source:o}))):r={source:o},r.type!==d&&(r.constructor!==Object?Reflect.defineProperty(r,"type",{get:()=>d}):r.type=d),r.eventName=t,!("bubbles"in r)&&((a=o.bubbleEvents)!=null&&a[t])&&(r.bubbles=o.bubbleEvents[t]),h){const p="on"+O.capitalize(t);if(p in o){const v=o[p]?o.callback(o[p],o,[r]):!0;let b;if(Z.isPromise(v)?(f||(f=[])).push(v):b=v===!1||b,!o.isDestroyed&&Dx.call(o,p)&&!((l=o.pluginFunctionChain)!=null&&l[p])){const w=Object.getPrototypeOf(o);if(p in w){const D=w[p].call(o,r);if(Z.isPromise(D)?(f||(f=[])).push(D):b=D===!1||b,o.isDestroyed)return}}if(b)return!1}}let m;if(g){let p=0,v=!1;for(g.$firing=!0,p;p<g.length&&!o.isDestroyed&&!v;p++){const b=g[p];if(m===!1&&!b.$internal)continue;let w,D=b.thisObj;if(!D||!D.isDestroyed){if(b.called=!0,b.once&&o.removeListener(d,b),typeof b.fn=="string"){if(D&&(w=D[b.fn]),!w){const x=o.resolveCallback(b.fn);w=x.handler,D=x.thisObj}}else w=b.fn;if(b.buffer){if(!b.bufferFn){const x=Number(b.buffer);if(typeof x!="number"||isNaN(x))throw new Error(`Incorrect type for buffer, got "${x}" (expected a Number)`);b.bufferFn=be.createBuffered(w,x,D,b.args)}w=b.bufferFn}if(b.throttle){const x=Number(b.throttle);if(typeof x!="number"||isNaN(x))throw new Error(`Incorrect type for throttle, got "${x}" (expected a Number)`);b.throttledFn||(b.throttledFn=be.createThrottled(w,x,D,b.args)),w=b.throttledFn}const S=w.call(D||o,...b.args||[],r);m!==!1&&(m=S),b.$internal&&S===!1&&(v=!0),Z.isPromise(S)&&(S.$internal=b.$internal,(f||(f=[])).push(S))}}if(g.$firing=!1,v)return!1}return u==null||u.forEach(p=>{let v=t;if(p.transformCase&&(v=O.capitalize(v)),p.prefix&&(v=p.prefix+v),p.through.trigger(v,r)===!1)return!1}),r.bubbles&&o.owner&&!o.owner.isDestroyed?o.owner.trigger(t,r):(f=f==null?void 0:f.filter(p=>m!==!1||p.$internal),f!=null&&f.length?new Promise(p=>{Promise.allSettled(f).then(v=>{const b=!v.some(w=>w.status==="fulfilled"&&w.value===!1);p(b)})}):m!==!1)}suspendEvents(t=!1){const r=this.eventsSuspended||(this.eventsSuspended={shouldQueue:t,queue:[],count:0});r.count++}resumeEvents(){const t=this.eventsSuspended;if(t&&--t.count===0&&(this.eventsSuspended=null,t.shouldQueue))for(const r of t.queue)this.trigger(...r);return!this.eventsSuspended}},y(e,"$name","Events"),e},Qe=class{static animationFrame(){return new Promise(i=>{requestAnimationFrame(i)})}static sleep(i){return new Promise(e=>{setTimeout(()=>{e()},i)})}static waitFor(i,e=6e4,t=100){let r;const n=new Promise((s,a)=>{r=s;let l;const o=()=>{const d=i();if(d)return clearInterval(l),s(d),!0};o()||(l=setInterval(o,t),e&&setTimeout(()=>{clearInterval(l),e>0?a():s()},Math.abs(e)))});return n.resolve=r,n}static yield(){return Promise.resolve()}};Qe._$name="AsyncHelper";var ef,Cy=["border-top-width","border-right-width","border-bottom-width","border-left-width"],Ex=["margin-top","margin-right","margin-bottom","margin-left"],xx=["padding-top","padding-right","padding-bottom","padding-left"],Dr={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},su={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},wy=/^([trblc])(\d*)-([trblc])(\d*)$/i,Rx=/^([trblc])(\d*)$/i,au=["top","right","bottom","left"],Mo={t:0,r:1,b:2,l:3},tf=["b-t","l-r","t-b","r-l"],Tx={bt:1,tb:1,lr:2,rl:2},Sy=Object.freeze([0,0]),Mx=["width","height"],rf=(i,e=i,t=i,r=e)=>Array.isArray(i)?rf.apply(null,i):[i,e,t,r],Dy=(i,e,t,r)=>Array.isArray(i)?rf.apply(null,i):typeof i.top=="number"?[i.top,i.right,i.bottom,i.left]:[i,e,t,r],nf=(i,e)=>{const t=wy.exec(i),r=t[1],n=t[3],s=parseInt(t[2]||50),a=parseInt(t[4]||50),l=e&&!(Mo[r]&1)?100-s:s,o=e&&!(Mo[n]&1)?100-a:a,d=Tx[r+n];return{myAlignmentPoint:r+l,myEdge:r,myOffset:l,targetAlignmentPoint:n+o,targetEdge:n,targetOffset:o,startZone:Mo[n],edgeAligned:d}},_x=i=>`${au[(Mo[i.myEdge]+2)%4][0]}${i.myOffset}-${au[(Mo[i.targetEdge]+2)%4][0]}${i.targetOffset}`,kx=i=>i==null?Sy:typeof i=="number"?[i,i]:i,Ey={hidden:1,clip:1},L=class Rt{constructor(e,t,r,n,s=!0){y(this,"isRectangle",!0),s&&(T.assertNumber(e,"Rectangle.x"),T.assertNumber(t,"Rectangle.y"),T.assertNumber(r,"Rectangle.width",!0),T.assertNumber(n,"Rectangle.height",!0));const a=this;r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),a._x=e,a._y=t,a._width=r,a._height=n}static from(e,t,r){if(typeof e=="string"?e=document.querySelector(e):(e==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),typeof t=="string"&&(t=document.querySelector(t)),e==null||e.isRectangle)return e;if(e=e.element||e,r===void 0&&typeof t=="boolean"&&(r=t,t=null),!(t!=null&&t.isRectangle))if(t){let{scrollLeft:d,scrollTop:c}=t;Y.isSafari&&t===document.body&&(d=c=0),t=Rt.from(t).translate(-d,-c)}else ef||(ef=new Rt(0,0,0,0)),t=ef;const n=e===document||e===globalThis,s=e===document.body&&document.body.offsetHeight===0,a=s&&e.getBoundingClientRect(),l=s?new Rt(a.left,a.top,a.width,document.body.parentElement.scrollHeight):n?new Rt(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),o=r||n?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new Rt(l.left+o[0]-t.x,l.top+o[1]-t.y,l.width,l.height)}static fromScreen(e,t){return Rt.from(e,t,!0)}static inner(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const s=E.getStyleValue(e,Cy);n.x+=parseFloat(s[Dr.l]),n.y+=parseFloat(s[Dr.t]),n.right-=parseFloat(s[Dr.r]),n.bottom-=parseFloat(s[Dr.b])}return n}static content(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const s=E.getStyleValue(e,Cy),a=E.getStyleValue(e,xx);n.x+=parseFloat(s[Dr.l])+parseFloat(a[su.l]),n.y+=parseFloat(s[Dr.t])+parseFloat(a[su.t]),n.right-=parseFloat(s[Dr.r])+parseFloat(a[su.r]),n.bottom-=parseFloat(s[Dr.b])+parseFloat(a[su.b])}return n}static client(e,t,r=!1,n,s,a=!0){const l=this[a?"content":"inner"](e,t,r),o=E.scrollBarWidth;let d;return o&&!e.classList.contains("b-hide-scroll")&&(e.scrollHeight>e.clientHeight&&!Ey[E.getStyleValue(e,"overflow-y")]&&(d=a?parseFloat(E.getStyleValue(e,"padding-inline-end")):0,E.getStyleValue(e,"direction")==="rtl"?l.x+=d+Math.max(d,o):l.right+=d-Math.max(d,o)),e.scrollWidth>e.clientWidth&&!Ey[E.getStyleValue(e,"overflow-x")]&&(d=a?parseFloat(E.getStyleValue(e,"padding-bottom")):0,l.bottom+=d-Math.max(d,o))),n&&this.clipStickies(l,e,t,r=!1,s),l}static clipStickies(e,t,r,n=!1,s){let a=[...t.children].filter(l=>E.getStyleValue(l,"position")==="sticky");if(s){const l=s&&Rt.from(s,r,n);a=a.filter(o=>!o.contains(s)&&l.intersect(Rt.from(o)))}for(let l=0,{length:o}=a;l<o;l++){const d=a[l],c=this.fromScreen(d);parseFloat(E.getStyleValue(d,"left"))===0?e.x+=c.width:parseFloat(E.getStyleValue(d,"right"))===0?e.right-=c.width:parseFloat(E.getStyleValue(d,"top"))===0?e.y+=c.height:parseFloat(E.getStyleValue(d,"bottom"))===0&&(e.bottom-=c.height)}return e}static outer(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const s=E.getStyleValue(e,Ex);n.x-=parseFloat(s["margin-left"]),n.y-=parseFloat(s["margin-top"]),n.right+=parseFloat(s["margin-right"]),n.bottom+=parseFloat(s["margin-bottom"])}return n}static union(...e){let{x:t,y:r,right:n,bottom:s}=e[0],a;if(e.length>1)for(let l=1;l<e.length;l++)a=e[l],a.x<t&&(t=a.x),a.y<r&&(r=a.y),a.right>n&&(n=a.right),a.bottom>s&&(s=a.bottom);return new Rt(t,r,n-t,s-r)}roundPx(e=globalThis.devicePixelRatio||1){const t=this;return t._x=E.roundPx(t._x,e),t._y=E.roundPx(t._y,e),t._width=E.roundPx(t._width,e),t._height=E.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}clone(){const e=this,t=new Rt(e.x,e.y,e.width,e.height,!1);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return e.isRectangle?e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom:!1}exclude(...e){var t,r;const n=this;let s,a=n.clone();for(s of Array.from(e).flat()){let l,o,d=[0,0,0,0];((l=s.x<=n.x)||s.right>=n.right)&&((t=o=s.intersect(n))==null?void 0:t.height)>=n.height?d[l?3:1]=-o.width:((l=s.y<=n.y)||s.bottom>=n.bottom)&&((r=o=s.intersect(n))==null?void 0:r.width)>=n.width&&(d[l?0:2]=-o.height),a=a.inflate(...d)}return a}intersect(e,t=!1,r=!1){const n=this,s=Math.max(n.y,e.y),a=Math.min(n.right,e.right),l=Math.min(n.bottom,e.bottom),o=Math.max(n.x,e.x);return(r?l>=s&&a>=o:l>s&&a>o)?t?!0:new Rt(o,s,a-o,l-s):!1}equals(e,t=!1){const r=t?n=>Math.round(n):n=>n;return e.isRectangle&&r(e.x)===r(this.x)&&r(e.y)===r(this.y)&&r(e.width)===r(this.width)&&r(e.height)===r(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return e!=null&&(this._x=e),t!=null&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){const e=new ti(this.x+this.width/2,this.y+this.height/2,0,0);return e.target=this.target,e}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){T.assertNumber(e,"Rectangle.width",!this._allowNegative),this._width=e}get width(){return this._width}set height(e){T.assertNumber(e,"Rectangle.height",!this._allowNegative),this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,t=!0){return t?e?this.right:this.left:this.top}getEnd(e,t=!0){return t?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,r,n,s){const a=this;return a._allowNegative=s,a.x+=e,a.y+=t,a.width+=r,a.height+=n,a}inflate(e,t=e,r=e,n=t){return[e,t,r,n]=Dy(e,t,r,n),this.adjust(-n,-e,t,r)}deflate(e,t=e,r=e,n=t){return[e,t,r,n]=Dy(e,t,r,n),this.adjust(n,e,-t,-r)}constrainTo(e,t){const r=this,n=r.height,s=r.y,a=r.minWidth||r.width,l=r.minHeight||r.height;if(r.height>=e.height){if(t&&l>e.height)return!1;r._y=e.y,r.height=e.height}if(r.width>=e.width){if(t&&a>e.width)return r.y=s,r.height=n,!1;r._x=e.x,r.width=e.width}return r.translate.apply(r,r.constrainVector=[Math.min(e.right-r.right,0),Math.min(e.bottom-r.bottom,0)]),r.translate(Math.max(e.x-r.x,0),Math.max(e.y-r.y,0)),r}alignTo(e){let t=this.clone(),{target:r,constrainTo:n,constrainPadding:s,inflate:a}=e,l,o,d,c;if(r&&(r=r.isRectangle?r.clone():Rt.from(r.element?r.element:r),a&&r.inflate.apply(r,Array.isArray(a)?a:[a])),n){if(!n.isRectangle){c=n===globalThis||n===document;const F="ignorePageScroll"in e?e.ignorePageScroll:!c;n=Rt.from(n.element?n.element:n,null,F)}s&&(s=rf(s),s[0]=Math.min(s[0],r.top),s[1]=Math.min(s[1],n.right-r.right),s[2]=Math.min(s[2],n.bottom-r.bottom),s[3]=Math.min(s[3],r.left),n=n.deflate.apply(n.clone(),s))}const u=this,h=kx(e.offset),{align:g,axisLock:f,anchorSize:m,anchorPosition:p,matchSize:v,position:b,rtl:w}=e,D=r&&r.width<2&&r.height<2,S=nf(g,w),x=n&&n.clone(),R=[],M=[{zone:o=S.startZone,align:g}],_=v&&Mx[S.startZone&1],k=u[_];if(_&&f?t[_]=v==="min"?Math.max(t.width,r[_]):r[_]:!S.edgeAligned&&v&&(t.width=r.width,t.height=r.height),n&&t.constrainTo(n),n&&S.startZone!=null)if(f)M.push({zone:o=(o+2)%4,align:_x(S)}),f==="flexible"&&(M.push({zone:o=(S.startZone+1)%4,align:tf[o]}),M.push({zone:o=(o+2)%4,align:tf[o]}));else for(let F=1;F<4;F++)M.push({zone:o=(o+1)%4,align:tf[o]});if(p){const F=S.startZone&1?"y":"x";l={[F]:p[F],edge:au[(S.startZone+2)%4]}}if(x&&r&&(x.adjust(-r.width,-r.height,r.width,r.height),r.constrainTo(x)),t.minWidth=u.minWidth,t.minHeight=u.minHeight,b)t.moveTo(b.x,b.y),t.translate.apply(t,h),n&&t.constrainTo(n);else{const F=S.myEdge==="c"||S.targetEdge==="c",I=m&&!F?[m[1]+h[0],m[1]+h[1]]:h,A=r.getAlignmentPoint(S.targetAlignmentPoint),P=r.getAlignmentPoint(S.targetAlignmentPoint,I);let H=t.getAlignmentPoint(S.myAlignmentPoint),G=!D&&t.clone().translate(A[0]-H[0],A[1]-H[1]).intersect(r,!0);if(t.translate(P[0]-H[0],P[1]-H[1]),G)t.translate(-(P[0]-H[0]),-(P[1]-H[1])),H=t.getAlignmentPoint(S.myAlignmentPoint),t.translate(A[0]-H[0],A[1]-H[1]),t.translate(...I),n&&t.constrainTo(n),d=S.startZone;else if(n&&!n.contains(t)){const q=t.clone(),W=[];let j,se;l=null,R[0]=j=n.clone(),j.bottom=r.y-I[1],R[1]=j=n.clone(),j.x=r.right+I[0],R[2]=j=n.clone(),j.y=r.bottom+I[1],R[3]=j=n.clone(),j.right=r.x-I[0];for(let J=0;J<M.length;J++){if(_&&J===2&&(t[_]=k),j=R[d=M[J].zone],t=t.alignTo({target:r,offsets:I,align:M[J].align}),t.constrainTo(j,!0)&&(W.push({result:t,zone:d}),!se||t.width<u.width||t.height<u.height)){t.align=M[J].align;break}if(!se||j.area>se.area){const Q=t.clone();switch(d){case 0:Q.moveTo(null,j.bottom-Q.height);break;case 1:Q.moveTo(j.left);break;case 2:Q.moveTo(null,j.top);break;case 3:Q.moveTo(j.right-Q.width);break}se={area:j.area,result:Q,zone:d}}}W.length?(W.length>1&&!f&&W.sort((J,Q)=>{const X=Math.sqrt((q.x-J.result.x)**2+(q.y-J.result.y)**2),ee=Math.sqrt((q.x-Q.result.x)**2+(q.y-Q.result.y)**2);return X-ee}),t=W[0].result,d=W[0].zone):(t=se.result,d=se.zone,c&&t.constrainTo(n))}else d=S.startZone;if(D?t.overlap=G=!1:t.overlap=G=t.intersect(r,!0),t.zone=d,m&&!G){if(!l){const q=d&1,W=q?"y":"x",j=q?"bottom":"right",se=Math.max(r[W],t[W]),J=Math.min(r[j],t[j]);let Q=se+(J-se)/2-m[0]/2;const X=Q+m[0];X>t[j]&&(Q-=X-t[j]),Q<t[W]&&(Q+=t[W]-Q),l={[W]:Q-t[W],edge:au[(d+2)%4]}}t.anchor=l}}return t}getAlignmentPoint(e,t=Sy){e=String(e);const r=this,n=Rx.exec(e)||wy.exec(e),s=n&&n[1].toLowerCase(),a=n&&Math.min(Math.max(parseInt(n[2]||50),0),100)/100;switch(s){case"t":return[r.x+r.width*a,r.y-t[1]];case"r":return[r.right+t[0],r.y+r.height*a];case"b":return[r.x+r.width*a,r.bottom+t[1]];case"l":return[r.x-t[0],r.y+r.height*a];case"c":return[r.x+r.width/2,r.y+r.height/2]}}highlight(){const e=this,t=E.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;
                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return E.highlight(t).then(()=>t.remove())}visualize(e,t=!1,r=!1){const n=this,s=T.merge({style:{width:`${n.width}px`,height:`${n.height}px`,pointerEvents:"none",...e.class?{}:{position:"absolute","z-index":9999999},...r?{insetInlineStart:n.x,top:n.y}:{left:0,top:0,transform:`translate(${n.x}px, ${n.y}px)`}}},e);return t?s:E.createElement(s)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}},ti=class extends L{static from(i,e=!0){const t=e?"client":"screen";i.changedTouches&&(i=i.changedTouches[0]);const r=i[`${t}X`],n=i[`${t}Y`];return new this(r,n)}constructor(i,e){super(i,e,0,0)}constrain(i){return this.x=Math.min(Math.max(this.x,i.x),i.right-1),this.y=Math.min(Math.max(this.y,i.y),i.bottom-1),this}toArray(){return[this.x,this.y]}};L._$name="Rectangle";var yn=Symbol("value"),xy=Symbol("length"),te=class gi{static change(e,t,r,n="string"){r=gi.normalize(r,"object");const s=gi.normalize(e,"array").filter(a=>!r[a]);if(t){t=gi.normalize(t,"array");for(let a=0;a<t.length;++a)s.includes(t[a])||s.push(t[a])}return gi.normalize(s,n)}static from(e,t){return e&&(e.isDomClassList?t=t!=null?t:!0:(t=t!=null?t:Z.isObject(e)&&!Z.isEmpty(e),e=new gi(e)),!e.value&&!t&&(e=null)),e||(t?new gi:null)}static normalize(e,t="string"){e=e||"";const r=typeof e,n=t==="array",s=t==="object",a=!n&&!s;let l=r==="string",o,d,c;for(r==="object"&&(e.nodeType===Element.ELEMENT_NODE&&typeof e.getAttribute=="function"?(e=e.getAttribute("class")||"",l=!0):e!=null&&e.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter(u=>e.get(u)):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=Z.getTruthyKeys(e))),l&&(e=O.split(e)),d=e.length;d-- >0;)o=e[d],o.length?o.includes(" ")&&e.splice(d,1,...O.split(o)):e.splice(d,1);if(e=[...new Set(e)],n)c=e;else if(a)c=e.join(" ");else for(c=Object.create(null),d=0;d<e.length;++d)c[e[d]]=!0;return c}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new gi(this)}contains(e){return typeof e=="string"&&e?!!this[e]:!1}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=gi.normalize(e,"array"),r=t.length;if(this.length===r){for(let n=0;n<r;n++)if(!this[t[n]])return!1;return!0}return!1}get value(){let e=this[yn],t;return e==null&&(t=Z.getTruthyKeys(this),this[xy]=t.length,this[yn]=e=t.join(" ")),e}set value(e){const t=this,r=Object.keys(t),n=r.length;for(let s=0;s<n;s++)delete t[r[s]];e?t.process(1,[e]):delete t[yn]}get values(){return Z.getTruthyKeys(this)}get length(){return this.value?this[xy]:0}process(e,t){for(let r,n,s=0;s<t.length;s++)if(t[s])if(r=t[s],r.isDomClassList||Z.isObject(r))for(n in r)this[n]=e?r[n]:!r[n];else for(r=gi.normalize(t[s],"array"),n=0;n<r.length;++n)this[r[n]]=e;return delete this[yn],this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[yn]);return this}assignTo(e){const t=e.nodeType===Element.ELEMENT_NODE?e.classList:e,r=gi.from(t);r.add(this),t.value=r.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,t=!this[e]){if(t=!!t,!!this[e]!==t)return this[e]=t,delete this[yn],!0}split(){return Z.getTruthyKeys(this)}forEach(e){return Z.getTruthyKeys(this).forEach(e)}};te.prototype[yn]=null,te._$name="DomClassList";var Fx=["clientX","clientY","pageX","pageY","screenX","screenY"],Ix={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1,raw:1,fromGlobal:1},Ax={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},Lx={Control:"ctrl",Alt:"alt",Shift:"shift",Meta:"meta"},Px=/^(ctrl|shift|alt|meta)$/,Ox=["altKey","bubbles","button","buttons","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"],$x=(...i)=>i.reduce((e,t)=>{for(let r=0,n=e.length;r<n;++r)e.push(r?`${e[r]}+${t}`:t);return e},[""]),Hx=Object.fromEntries("abcdefghijklmnopqrstuvwxyz".split("").map(i=>[i,i.toUpperCase()])),Vx=$x("Ctrl","Alt","Meta","Shift"),Ry=i=>Vx[(i.ctrlKey&&1)|(i.altKey&&2)|(i.metaKey&&4)|(i.shiftKey&&8)],Nx=i=>{const e=[Ry(i)],{code:t,key:r}=i;return e[e[0]?1:0]=t!=null&&t.includes("Numpad")?t:Hx[r]||r,e.join("+")},{isSafari:Ty}=Y,sf=new WeakMap,lu=i=>(i==null?void 0:i.nodeType)===Element.TEXT_NODE?i.parentElement:i,af=class bE{static normalizeEvent(e){return T.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],Fx)}static copyEvent(e,t){return T.copyProperties(e,t,Ox)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t,r){const n=et.getXY(e),s=et.getXY(t),a=n[0]-s[0],l=n[1]-s[1];return r!=null&&r.x?a:r!=null&&r.y?l:Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}static getPagePoint(e){return new ti(e.pageX,e.pageY)}static getClientPoint(e){return new ti(e.clientX,e.clientY)}static addListener(e,t,r,n){return e.nodeType?typeof t=="string"?n=Object.assign({element:e,[t]:r},n):n=Object.assign({element:e},t):n=e,et.on(n)}static on(e){const t=e.element,r=e.thisObj,n=[];for(const a in e)if(!Ix[a]){let l=e[a];typeof l!="object"&&(l={handler:l});const o=l.element||t;n.push(et.addElementListener(o,a,l,e))}const s=()=>{for(let a,l=0;l<n.length;l++)a=n[l],et.removeEventListener(a[0],a[1],a[2]);n.length=0};return r&&e.autoDetach!==!1&&(r.doDestroy=be.createInterceptor(r.doDestroy,s,r)),s}static addElementListener(e,t,r,n){const s=et.createHandler(e,t,r,n),{spec:a}=s,l=r.expires||n.expires,o=a.capture!=null||a.passive!=null?{capture:a.capture,passive:a.passive}:void 0;if(e.addEventListener(t,s,o),l){const d=r.thisObj||n.thisObj,c=d!=null&&d.isDelayable?d:globalThis,{alt:u}=l,h=u?l.delay:l,{spec:g}=s;g.expires=l,g.timerId=c[typeof h=="number"?"setTimeout":"requestAnimationFrame"](()=>{g.timerId=null,et.removeEventListener(e,t,s),u&&!s.called&&(typeof u=="string"?d[u]:u).call(d)},h,`listener-timer-${performance.now()}`)}return[e,t,s,o]}static getComposedPathTarget(e){var t;return e.composedPath()[0]||((t=e.path)==null?void 0:t[0])}static fixEvent(e,t){var r,n;if(e.isBryntumEvent)return e;if(sf.has(e))return sf.get(e);const{ctrlKey:s,metaKey:a,type:l,target:o}=e,d=this.getComposedPathTarget(e),c=((n=(r=d==null?void 0:d.getRootNode)==null?void 0:r.call(d))==null?void 0:n.mode)==="open",u={set(g,f,m){var p;return f in g&&((p=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(g),"type"))!=null&&p.set)?Reflect.set(g,f,m):(u[f]=m,!0)},get(g,f){if(T.hasOwn(u,f))return u[f];switch(f){case"fixed":case"isBryntumEvent":return!0;case"key":return Ax[g.key]||g.key;case"code":return g.key===" "&&!g.code?"Space":g.code;case"ctrlKey":return Y.isMac&&a!==s?a:s;case"metaKey":return Y.isMac&&a!==s?s:a;case"virtualKey":return Nx(h);case"virtualModKeys":return Ry(h);case"borderOffsetX":return isNaN(g.offsetX)?void 0:g.offsetX+(Ty?0:parseInt(o.ownerDocument.defaultView.getComputedStyle(lu(o)).getPropertyValue("border-left-width")));case"borderOffsetY":return isNaN(g.offsetY)?void 0:g.offsetY+(Ty?0:parseInt(o.ownerDocument.defaultView.getComputedStyle(lu(o)).getPropertyValue("border-top-width")));case"target":return c?d:lu(g.target);case"relatedTarget":return lu(g.relatedTarget);case"originalTarget":return o;case"deepTarget":return d;case"currentTarget":return u.delegatedTarget||g.currentTarget;case"browserEvent":return g;default:if(f in u)return u[f];{const m=Reflect.get(g,f);return typeof m=="function"?m.bind(g):m}}},has(g,f){return f in g||f in u}},h=new Proxy(e,u);if(sf.set(e,h),l.startsWith("touch")&&this.normalizeEvent(h),!t)switch(l){case"keydown":le.currentKeyDown=h;break;case"mousedown":le.currentMouseDown=h;break;case"pointerdown":le.currentPointerDown=h;break;case"touchstart":le.currentTouch=h}return h}static createHandler(e,t,r,n){const s=r.delay||n.delay,a=r.throttled||n.throttled,l=r.block||n.block,o="once"in r?r.once:n.once,d="capture"in r?r.capture:n.capture,c="passive"in r?r.passive:n.passive,u="delegate"in r?r.delegate:n.delegate,h="fromGlobal"in r?r.fromGlobal:n.fromGlobal,g=r.handler,f=r.expires,m=r.thisObj||n.thisObj;let p=(v,...b)=>{et.playingDemo&&v.isTrusted||m!=null&&m.isDestroyed||(p.called=!0,(typeof g=="string"?m[g]:g).call(m,et.fixEvent(v,h),...b))};if(l){const v=p;let b,w;p=(D,...S)=>{const x=performance.now();(!b||D.target!==w||x-b>l)&&(w=D.target,b=x,v(D,...S))}}if(s!=null){const v=p,b=m!=null&&m.setTimeout?m:globalThis;p=(...w)=>{b.setTimeout(()=>{v(...w)},s)}}if(a!=null){let v,b=a;a.buffer&&(v=w=>a.alt.call(et,et.fixEvent(w,h)),b=a.buffer),m!=null&&m.isDelayable?p=m.throttle(p,{delay:b,throttled:v}):p=be.createThrottled(p,b,m,null,v)}if(o){const v=p;p=(...b)=>{et.removeEventListener(e,t,p),v(...b)}}if(u){const v=p;p=(b,...w)=>{var D,S;b=et.fixEvent(b,h);const x=(S=(D=b.target).closest)==null?void 0:S.call(D,u);x&&(b.delegatedTarget=x,v(b,...w))}}return r.thisObj&&r.autoDetach!==!1&&(m.doDestroy=be.createInterceptor(m.doDestroy,()=>et.removeEventListener(e,t,p),m)),p.spec={delay:s,throttled:a,block:l,once:o,thisObj:m,capture:d,expires:f,passive:c,delegate:u},p}static removeEventListener(e,t,r){const{expires:n,timerId:s,thisObj:a,capture:l}=r.spec;n!=null&&n.alt&&s&&(a!=null&&a.isDelayable?a:globalThis)[typeof n.delay=="number"?"clearTimeout":"cancelAnimationFrame"](s),e.removeEventListener(t,r,l)}static onTransitionEnd({element:e,animationName:t,property:r,handler:n,mode:s=t?"animation":"transition",duration:a=E[`get${s==="transition"?"Property":""}${O.capitalize(s)}Duration`](e,r),timeout:l,thisObj:o=globalThis,args:d=[],timerSource:c,runOnDestroy:u}){let h,g;c=c||(o.isDelayable?o:globalThis);const{isDelayable:f}=c,m=performance.now(),p=`transitionTimer${m}`,v=`timeoutTimer${m}`,b=[e,r,...d],w=()=>{var S;D(),o.isDestroyed||((S=o.$meta)!=null&&S.class.isBase?o.callback(n,o,b):n.apply(o,b))},D=et.on({element:e,[`${s}end`]({animationName:S,propertyName:x,target:R}){var M,_;R===e&&(x===r||S!=null&&S.match(t))&&(h&&(g&&((M=c.clearTimeout)==null||M.call(c,f?v:g)),(_=c.clearTimeout)==null||_.call(c,f?p:h),h=null),w())}});return l&&(g=c.setTimeout(w,Math.max(l,(a||0)+100),v)),a!=null&&(h=c.setTimeout(w,a+50,p,u)),D}static async waitForTransitionEnd(e){return new Promise(t=>{e.handler=t,bE.onTransitionEnd(e)})}static createDblClickWrapper(e,t,r){let n,s,a;return()=>{s||(s=et.on({element:e,touchstart:l=>{n=l.changedTouches[0].identifier,l.preventDefault()},touchend:l=>{if(l.changedTouches[0].identifier===n){l.preventDefault(),clearTimeout(a),n=s=null;const o=L.from(l.changedTouches[0].target,null,!0),d=l.changedTouches[0].pageX-o.x,c=l.changedTouches[0].pageY-o.y,u=Object.assign({browserEvent:l},l),h=new MouseEvent("dblclick",u);Object.defineProperties(h,{target:{value:l.target},offsetX:{value:d},offsetY:{value:c}}),typeof t=="string"&&(t=r[t]),t.call(r,h)}},once:!0}),a=setTimeout(()=>{s(),n=s=null},et.dblClickTime))}}static toSpecialKey(e,t="ctrlKey"){let r=!1;return e===!0?r=t:typeof e=="string"&&(e=e.toLowerCase(),e.match(Px)&&(r=`${e}Key`)),r}static specialKeyFromEventKey(e){return Lx[e]||"no-special-key"}};y(af,"$name","EventHelper"),y(af,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseenter:"MouseEnter",mouseleave:"MouseLeave",mousemove:"MouseMove",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"});var V=af;_e.register(V);var et=V;et.longPressTime=700,et.dblClickTime=300,Y.isTouchDevice&&et.on({element:document,touchmove:i=>{i.target.closest(".b-dragging")&&i.preventDefault()},passive:!1,capture:!0}),V._$name="EventHelper";var Bx=14,zx={align:"t0-t0"},_o=Node.ELEMENT_NODE,ou=Node.TEXT_NODE,My={text:1,password:1,date:1,search:1,email:1,number:1,time:1,"datetime-local":1,tel:1,url:1,month:1,week:1},{isObject:Wx}=T,_y=/[+-]?\d*\.?\d+[eE]?-?\d*/g,vi=_y.source,jx=new RegExp(`matrix\\((?:${vi}),\\s?(?:${vi}),\\s?(?:${vi}),\\s?(?:${vi}),\\s?(${vi}),\\s?(${vi})`),Ux=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),du=new RegExp(`(?:${jx.source})|(?:${Ux.source})`),Gx=new RegExp(`translate(3d|X)?\\((${vi})px(?:,\\s?(${vi})px)?`),Yx=new RegExp(`translate(3d|Y)?\\((${vi})px(?:,\\s?(${vi})px)?`),qx=/\s+/,Kx=/\s*;\s*/,Xx=/\s*:\s*/,Zx=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,Jx="$bryntum",ky={},Qx={elementData:"",for:"htmlFor",retainElement:""},eR={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},tR=[["f","focusable"],["n","natural"],["p","programmatic"],["t","tabbable"]],iR=i=>Object.freeze(Object.fromEntries(tR.map(([e,t])=>[t,i.includes(e)]))),Fy={length:1,parentRule:1,style:1},Iy={INPUT:1,TEXTAREA:1},rR={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},lf=globalThis,tt=document,nR=Object.freeze({}),of=Array.prototype.slice,sR=Promise.resolve(),aR=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],lR=i=>i._hidden,oR=(i,e,t)=>t.key==="children"?T.mergeItems(i,e,t):T.blend(i,e,t),df=(i,e)=>{if(i.isConnected){const t=i.ownerDocument.defaultView.getComputedStyle(i);return t.getPropertyValue("display")!=="none"&&(e||t.getPropertyValue("visibility")!=="hidden")}},Er=i=>i&&i.isConnected&&(i===tt.body||!!i.offsetParent||(i.ownerDocument.defaultView&&"offsetParent"in i&&E.getStyleValue(i,"position")!=="fixed"?i.offsetParent:Er(i.parentNode))),Ay=i=>i instanceof Node?i:typeof i=="string"?U.createElementFromTemplate(i):U.createElement(i),ko=Object.create(null),Ly=(i,e)=>{const t=ko[i]||[O.hyphenate(i),e];return ko[i]||(ko[t[0]]=ko[i]=t),t},dR=/b-slide-in-from-\w+/,Ws=(i,e)=>{if(i){const t=(i.ownerSVGElement||i)[e&&E.getStyleValue(i,"position")!=="static"?"offsetParent":"parentNode"]||Ws(i.target,e);return(t==null?void 0:t.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?t.host:t}},cu=i=>(i==null?void 0:i.nodeType)===Node.ELEMENT_NODE,Py=(i=tt)=>{var e;return((e=i.getAnimations())==null?void 0:e.reduce((t,{effect:r,playState:n})=>(n==="running"&&r.getTiming().iterations!==1/0&&t.push(r.target),t),[]))||[]};["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","insetBlockEnd","insetBlockStart","insetInlineEnd","insetInlineStart","marginTop","marginRight","marginBottom","marginLeft","marginInlineStart","marginInlineEnd","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing","insetInlineStart","insetBlockStart","insetInlineEnd","insetBlockEnd"].forEach(i=>Ly(i,!0));var js=null,cR=0,bn=null,cf,Oy,$y,uu=class Qt{static get devicePixelRatio(){let e=globalThis.devicePixelRatio;if(e==null){const s=a=>`(-webkit-min-device-pixel-ratio: ${a}),
                (min--moz-device-pixel-ratio: ${a}),
                (min-resolution: ${a}dppx)`;for(let a=5*100;a>=.5*100;a-=.05*100)if(globalThis.matchMedia(s(a/100)).matches){e=a/100;break}}return e}static get usingKeyboard(){return U._usingKeyboard}static set usingKeyboard(e){return U._usingKeyboard=e}static setUsingKeyboard(e,t){U.setFocusRendition(e,t),U._usingKeyboard=t}static setFocusRendition(e,t){var r;U.enableKeyboardCssModifiers&&(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t?Array.from(e.children).forEach(n=>{var s;return((s=n.matches)==null?void 0:s.call(n,".b-outer"))&&n.classList.add("b-using-keyboard")}):U.removeClsGlobally(e,"b-using-keyboard"):(r=e.classList)==null||r.toggle("b-using-keyboard",t))}static findParent(e,t,r){return this.closest(e==null?void 0:e.parentNode,t,r)}static closest(e,t,r){if(e&&e!==r)return t(e)?e:this.closest(e.parentNode,t,r)}static async slideIn(e,t=1){const r=`b-slide-in-${t>0?"next":"previous"}`,{classList:n,parentNode:{classList:s}}=e;s.add("b-sliding-child-element"),n.add(r),await V.waitForTransitionEnd({element:e,animationName:dR}),n.remove(r),s.remove("b-sliding-child-element")}static getFocusability(e){let t="";if(e&&!e.hasAttribute("inert")){const{nodeName:r}=e,n=e.getAttribute("tabIndex");t=rR[r]||(r==="A"||r==="LINK")&&e.href||e.contentEditable==="true"?"n":"",n==="-1"?t+="fp":(t||n!=null)&&(t+="ft")}return ky[t]||(ky[t]=iR(t))}static isFocusable(e,t){return e&&!t&&(!U.isVisible(e)||U.Widget.fromElement(e,lR))?!1:U.getFocusability(e).focusable}static isEditable(e,t){return!!((e.isContentEditable||Iy[e.nodeName])&&(!t||e.nodeName!=="INPUT"||My[e.type.toLowerCase()])&&!(e.readOnly||e.disabled||e.closest("[inert]")))}static isTextualInput(e){return Iy[e.nodeName]&&(e.nodeName!=="INPUT"||My[e.type.toLowerCase()])}static isInView(e,t=!1,r){if(!e||!Er(cu(e.target)?e.target:e))return!1;const n=(r==null?void 0:r.positioned)&&Qt.getStyleValue(r.element,"position")!=="fixed",s=L.from(globalThis),a=t?"contains":"intersect",l=n&&r.element.offsetParent,o=n&&L.from(l);if(s.height=tt.scrollingElement.scrollHeight,e===tt.body)return s;const d=this.getViewportIntersection(e,s,a);return d&&n&&d.translate(tt.scrollingElement.scrollLeft,tt.scrollingElement.scrollTop),n&&d?d.translate(-o.x+l.scrollLeft,-o.y+l.scrollTop):d}static getViewportIntersection(e,t,r){var n;const s=cu(e.target)?e.target:null,a=s||e,l=Qt.getVisibleViewport(Ws(a,1),t,a),o=L.from(a,null,!0);return s&&(o.translate(e.offsetX+1,e.offsetY+1),o.height=o.width=0),(n=l==null?void 0:l[r])==null?void 0:n.call(l,o,!1,!0)}static getVisibleViewport(e,t,r){const{fullscreenElement:n}=tt;let s=t,a,l,o,d,c;for(c=e;!l&&c&&c!==tt.body;c=Ws(c,1))if((a=l=c===n)||(d=c.ownerDocument.defaultView.getComputedStyle(c),a=(d.overflowX!=="visible"||d.overflowY!=="visible")&&d.display!=="contents"),a){const u=L.client(c,null,!0,!1,r,!1);if(!u.height||!u.width)return!1;s=(s==null?void 0:s.intersect(u))||u,o=c}return o&&(s=L.clipStickies(s,o,null,!0,r)),s}static isVisible(e){var t;let r=!1;for(;e;e=Ws(e)){if(e.nodeType===Element.DOCUMENT_NODE)return!0;if(e.nodeType===Element.ELEMENT_NODE){const n=(t=e.ownerDocument)==null?void 0:t.defaultView.getComputedStyle(e);if(r=r||n.getPropertyValue("visibility")==="visible",cu(e)&&!df(e,r))return!1}}return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return T.blend(e,t,{merge:oR})}static normalizeChildren(e,t,r){var n;let s=e==null?void 0:e.children,a,l,o,d,c;if((n=e==null?void 0:e.syncOptions)!=null&&n.ignoreRefs&&(r=!0),s&&!(e instanceof Node))if(Array.isArray(s))for(l=0;l<s.length;++l)U.normalizeChildren(s[l],t,r);else{d=s,e.children=s=[];for(o in d)a=d[o],a!=null&&a.isWidget&&(a=a.element),c=!o.startsWith("$")&&!U.isElement(a),c&&(t==null||t(o,!r)),a&&(a instanceof Node||(a.reference===!1?delete a.reference:c&&typeof a!="string"&&(a.reference=o),U.normalizeChildren(a,t,r)),s.push(a))}return e}static roundPx(e,t=globalThis.devicePixelRatio||1){const r=1/t;return Math.round(e/r)*r}static floorPx(e,t=globalThis.devicePixelRatio||1){const r=1/t;return Math.floor(e*r)/r}static isCustomElement(e){return!!(e!=null&&e.shadowRoot)}static elementFromPoint(e,t){let r=document.elementFromPoint(e,t);return U.isCustomElement(r)&&(r=r.shadowRoot.elementFromPoint(e,t)||r),r}static childFromPoint(e,t,r,n=e){const s=r==null?t:new L(t,r,0,0);let a=null;return Array.from(e.children).reverse().some(l=>{if(L.from(l,n).contains(s))return a=l.children.length&&U.childFromPoint(l,s,null,n)||l,!0}),a}static unitize(e,t,r="px"){const[n,s]=Ly(e);return t!=null&&(t=String(t),t=s&&Zx.test(t)?t+r:t),[n,t]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){e!=null&&e.isWidget&&(e=e.element);let t=((e==null?void 0:e.getRootNode())||document).activeElement;for(;t!=null&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}static getRootElement(e){var t;const r=(t=e.getRootNode)==null?void 0:t.call(e),{nodeType:n}=r;return n===Node.DOCUMENT_NODE?r.body:n===Node.DOCUMENT_FRAGMENT_NODE?r:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var t;const r=(t=e.getRootNode)==null?void 0:t.call(e);if(r!=null&&r.body)return r==null?void 0:r.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){var t;return((t=e.tagName)==null?void 0:t.toUpperCase())==="BODY"||e.getRootNode().nodeType===Node.DOCUMENT_FRAGMENT_NODE}static getId(e){return e.id||(e.id="b-element-"+ ++cR)}static getCommonAncestor(e,t){var r,n;if(e===t)return e;for(;e&&!((r=e[e.isWidget?"owns":"contains"])!=null&&r.call(e,t)||e===t);)e=cu(e)?Ws(e):(n=e.owner)!=null&&n.isWidget&&e.owner!==e?e.owner:null;return e}static waitForSelector(e,t=5e3,r=100){var n;if(e!=null){const s=(n=e.endsWith)==null?void 0:n.call(e,"?"),a=e.nodeType?e:document.querySelector(s?e.substring(0,e.length-1):e);if(s){if(!a)return;t>0&&(t=-t)}return!a||!Qt.isVisible(a)||Py().some(l=>l.contains(a))||!Qt.isInView(a,!1)?Qe.waitFor(()=>{const l=a||document.querySelector(e);if(l&&Qt.isVisible(l)&&!Py().some(o=>o.contains(l))&&Qt.isInView(l,!1))return l},t,r):a}}static getElement(e){return typeof e=="string"?tt.querySelector(e):e}static setAttributes(e,t){const r=U.getElement(e);if(r&&t)for(const n in t)t[n]==null?r.removeAttribute(n):r.setAttribute(n,t[n])}static toggleAttribute(e,t,r){const n=U.getElement(e);n&&(n.toggleAttribute?n.toggleAttribute(t,r):r!=null?n[r?"setAttribute":"removeAttribute"](t,""):n.hasAttribute(t)?n.removeAttribute(t):n.setAttribute(t,""))}static addAttributeValue(e,t,r){var n;const s=U.getElement(e);s&&r&&s.setAttribute(t,[...new Set((n=s.getAttribute(t))==null?void 0:n.split(" ")).add(r)].join(" "))}static removeAttributeValue(e,t,r){var n;const s=U.getElement(e);if(s&&r){const a=new Set((n=s.getAttribute(t))==null?void 0:n.split(" "));a.delete(r),a.size?s.setAttribute(t,[...a].join(" ")):s.removeAttribute(t)}}static setLength(e,t,r){return arguments.length===1?r=typeof e=="number"?`${e}px`:e!=null?e:"":(e=U.getElement(e),r=e.style[t]=typeof r=="number"?`${r}px`:r!=null?r:""),r}static percentify(e,t=2){const r=Math.pow(10,t);return e==null||e===""||isNaN(e)?"":`${Math.round(e*r)/r}%`}static getChild(e,t){return e.querySelector(":scope>"+t)}static hasChild(e,t){return U.getChild(e,t)!=null}static children(e,t){return(t[0]===">"||t.startsWith("# "))&&(t[0]==="#"&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){var r;return e?(r=e.matches)!=null&&r.call(e,t)?e:(t=":scope "+t,e.querySelector(t)):null}static isDescendant(e,t){const r=e.contains(t);if(!r&&t){const n=U.getRootElement(e),s=U.getRootElement(t);if(s&&n!==s&&s.host)return U.isDescendant(n,s.host)}return r}static getEventElement(e,t="target"){return!e||U.isElement(e)?e:e[t]}static isElement(e){return(e==null?void 0:e.nodeType)===document.ELEMENT_NODE&&U.isNode(e)}static isReactElement(e){var t,r;return!!((r=(t=globalThis.bryntum)==null?void 0:t.react)!=null&&r.isReactElement(e))}static handleReactElement(e,t){var r,n;return!!((n=(r=globalThis.bryntum)==null?void 0:r.react)!=null&&n.handleReactElement(e,t))}static handleReactHeaderElement(e,t,r){var n,s;return!!((s=(n=globalThis.bryntum)==null?void 0:n.react)!=null&&s.handleReactHeaderElement(e,t,r))}static isVueConfig(e){var t,r;return!!((r=(t=globalThis.bryntum)==null?void 0:t.vue)!=null&&r.isVueConfig(e))}static handleVueContent(e,t){var r,n;(n=(r=globalThis.bryntum)==null?void 0:r.vue)==null||n.handleVueContent(e,t)}static isNode(e){return!!e&&typeof e.nodeType=="number"&&!Wx(e)}static forEachSelector(e,t,r){if(typeof e=="string")throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");U.children(e,t).forEach(r)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){U.forEachSelector(e,t,r=>r.remove())}static removeClsGlobally(e,...t){t.forEach(r=>U.forEachSelector(e,"."+r,n=>n.classList.remove(r)))}static getAncestor(e,t,r=null){let n=!1,s,a=e;for(t=B.asArray(t);a=a.parentElement;){if(t.includes(a)){n=!0;break}if(r&&a===r)break;s=a}return n?s||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return O.makeValidDomId(e,t)}static createElement(e={},t){var r,n;let s=t,a,l,o,d,c,u,h,g,f,m,p;if(typeof s=="boolean")throw new Error("Clean up");t&&(c=t.ignoreRefs,f=t.refOwner,m=t.refs,s=t.returnAll,p=t.syncIdField,c&&(o=!0,c=c!=="children")),typeof e.parent=="string"&&(e.parent=document.getElementById(e.parent));const v=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:b,html:w,reference:D,syncOptions:S,text:x}=e;if(S&&(p=S.syncIdField||p,d=S.ignoreRefs,d&&(o=!0,c=d!=="children",t={...t,ignoreRefs:!0})),c&&(f=null),e.ns?a=tt.createElementNS(e.ns,e.tag||"svg"):a=tt.createElement(e.tag||"div"),x!=null?U.setInnerText(a,x):w!=null&&(w instanceof DocumentFragment?a.appendChild(w):a.innerHTML=w),e.tooltip&&U.Widget.attachTooltip(a,e.tooltip),e.style&&U.applyStyle(a,e.style),b)for(h in b)g=b[h],g!=null&&(a.dataset[h]=g);v&&this.addChild(v,a,e.nextSibling),f&&(a.$refOwnerId=f.id),D&&!c&&(f?(a.$reference=D,f.attachRef(D,a,e)):(m||(t=Object.assign({},t),t.refs=m={}),m[D]=a,a.setAttribute("data-reference",D)));const R=e.className||e.class,M=Object.keys(e);for(R&&a.setAttribute("class",te.normalize(R)),l=0;l<M.length;++l)h=M[l],g=e[h],(u=Qx[h])!=null?a[u||h]=g:!eR[h]&&h&&g!=null&&a.setAttribute(h,g);!e["aria-hidden"]&&!("role"in e)&&!e.tabIndex&&!e.alt&&!Qt.isFocusable(a,!0)&&!a.htmlFor&&a.setAttribute("role","presentation"),(n=t==null?void 0:t.callback)==null||n.call(t,{action:"newElement",domConfig:e,targetElement:a,syncId:f?D:t.syncIdField&&((r=e.dataset)==null?void 0:r[t.syncIdField])}),s===!0?t.returnAll=s=[a]:Array.isArray(s)&&s.push(a),e.children&&(p&&(a.syncIdMap={}),B.asArray(e.children).forEach(k=>{var F,I,A,P;if(k)if(typeof k=="string"){const H=document.createTextNode(k);f&&(H.$refOwnerId=f.id),a.appendChild(H)}else if(this.isReactElement(k))(F=t==null?void 0:t.reactCallback)==null||F.call(t,{jsx:k,domConfig:e,targetElement:a});else if(isNaN(k.nodeType)){k.parent=a,!k.ns&&e.ns&&(k.ns=e.ns);const H=U.createElement(k,{...t,ignoreRefs:(A=(I=e.syncOptions)==null?void 0:I.ignoreRef)!=null?A:o}),G=(P=k.dataset)==null?void 0:P[p];G!=null&&(a.syncIdMap[G]=H),delete k.parent}else a.appendChild(k)})),a.lastDomConfig=e;const _=m||s||a;return e.replaceElement&&e.replaceElement.replaceWith(_),_}static createElementFromTemplate(e,t=nR){const{array:r,raw:n,fragment:s}=t;let a;if(U.supportsTemplate){if((cf||(cf=tt.createElement("template"))).innerHTML=e,a=cf.content,s)return a.cloneNode(!0)}else if(a=(Oy||(Oy=new DOMParser)).parseFromString(e,"text/html").body,s){const l=a.childNodes;for(a=document.createDocumentFragment();l.length;)a.appendChild(l[0]);return a}return n?a=a.childNodes:a=a.children,a.length===1&&!r?a[0]:of.call(a)}static triggerMouseEvent(e,t="contextmenu",r={}){const n=this.isInView(e),s=n==null?void 0:n.center;if(n){const a=new MouseEvent(t,{clientX:s.x,clientY:s.y,offsetX:n.width/2,offsetY:n.height/2,bubbles:!0,...r});return e.dispatchEvent(a),a}}static insertFirst(e,t){return t&&t.nodeType!==_o&&t.tag&&(t=U.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,r){return t&&t.nodeType!==_o&&t.tag&&(t=U.createElement(t)),r?e.insertBefore(t,r):U.insertFirst(e,t)}static insertAt(e,t,r){const n=Array.from(e.children);if(r>=n.length)return U.append(e,t);const s=n[r];return U.insertBefore(e,t,s)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map(r=>Ay(r))),e.append)e.append(...t);else{const r=document.createDocumentFragment();t.forEach(function(n){r.appendChild(n)}),e.appendChild(r)}return t}else return e.appendChild(Ay(t))}static getTranslateX(e){const t=e.style.transform;let r=Gx.exec(t);return r?parseFloat(r[2]):(r=du.exec(t)||du.exec(U.getStyleValue(e,"transform")),r?parseFloat(r[1]||r[3]):0)}static getTranslateY(e){const t=e.style.transform;let r=Yx.exec(t);if(r){const n=parseFloat(r[r[1]==="Y"?2:3]);return isNaN(n)?0:n}else return r=du.exec(t)||du.exec(U.getStyleValue(e,"transform")),r?parseFloat(r[2]||r[4]):0}static getTranslateXY(e){return[U.getTranslateX(e),U.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[U.getOffsetX(e,t),U.getOffsetY(e,t)]}static getPageX(e){return e.getBoundingClientRect().left+lf.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+lf.pageYOffset}static getExtremalSizePX(e,t){const r=O.hyphenate(t),n=r.split("-")[1];let s=U.getStyleValue(e,r);return/%/.test(s)?e.parentElement?s=parseInt(U.getStyleValue(e.parentElement,n),10):s=NaN:s=parseInt(s,10),s}static setScale(e,t,r=t){const n=U.getStyleValue(e,"transform").split(/,\s*/);n.length>1?(n[0].startsWith("matrix3d")?(n[0]=`matrix3d(${t}`,n[5]=r):(n[0]=`matrix(${t}`,n[3]=r),e.style.transform=n.join(",")):e.style.transform=`scale(${t}, ${r})`}static setTranslateX(e,t){const r=U.getStyleValue(e,"transform").split(/,\s*/);t=U.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?12:4]=t,e.style.transform=r.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const r=U.getStyleValue(e,"transform").split(/,\s*/);t=U.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?13:5]=t,e.style.transform=r.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){U.setLength(e,"top",t)}static setLeft(e,t){U.setLength(e,"left",t)}static setTopLeft(e,t,r){U.setLength(e,"top",t),U.setLength(e,"left",r)}static setTopInsetInlineStart(e,t,r){U.setLength(e,"top",t),U.setLength(e,"inset-inline-start",r)}static setRect(e,{x:t,y:r,width:n,height:s}){U.setTopInsetInlineStart(e,r,t),U.setLength(e,"width",n),U.setLength(e,"height",s)}static setTranslateXY(e,t,r){if(t==null)return U.setTranslateY(e,r);if(r==null)return U.setTranslateX(e,t);t=U.roundPx(t),r=U.roundPx(r);const n=U.getStyleValue(e,"transform").split(/,\s*/),s=n[0].startsWith("matrix3d");n.length>1?(n[s?12:4]=t,n[s?13:5]=r,e.style.transform=n.join(",")+")"):e.style.transform=`translate(${t}px, ${r}px)`}static addTranslateX(e,t){U.setTranslateX(e,U.getTranslateX(e)+t)}static addTranslateY(e,t){U.setTranslateY(e,U.getTranslateY(e)+t)}static addLeft(e,t){U.setLeft(e,U.getOffsetX(e)+t)}static addTop(e,t){U.setTop(e,U.getOffsetY(e)+t)}static alignTo(e,t,r=zx,n,s="translate"){t=t instanceof L?t:L.from(t,!0);const a=L.from(e,!0);n&&(a.roundPx(),t.roundPx());const l=a.alignTo(Object.assign(r,{target:t}));if(s==="topInset"){const o=[parseInt(e.style.insetInlineStart||0,10),parseInt(e.style.top||0,10)];U.setTopInsetInlineStart(e,o[1]+l.y-a.y,o[0]+l.x-a.x)}else if(s==="topLeft"){const o=[parseInt(e.style.left||0,10),parseInt(e.style.top||0,10)];U.setTopLeft(e,o[1]+l.y-a.y,o[0]+l.x-a.x)}else{const o=U.getTranslateXY(e);U.setTranslateXY(e,o[0]+l.x-a.x,o[1]+l.y-a.y)}}static getStyleValue(e,t,r,n){const s=r?e.style:e.ownerDocument.defaultView.getComputedStyle(e,n);if(Array.isArray(t)){const a={};for(const l of t)a[l]=s.getPropertyValue(O.hyphenate(l));return a}return s.getPropertyValue(O.hyphenate(t))}static getEdgeSize(e,t,r){const n=t==="border"?"-width":"",s={raw:{}};for(const a of["top","right","bottom","left"])(!r||r.includes(a[0]))&&(s[a]=parseFloat(s.raw[a]=U.getStyleValue(e,`${t}-${a}${n}`)));return s.width=(s.left||0)+(s.right||0),s.height=(s.top||0)+(s.bottom||0),s}static parseStyle(e){if(typeof e=="string"){const t=e.split(Kx);e={};for(let r=0,{length:n}=t;r<n;r++){const s=t[r].split(Xx);e[s[0]]=s[1]}}return e||{}}static applyStyle(e,t,r=!1){if(typeof t=="string")r?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){r&&(e.style.cssText=""),t.style&&typeof t.style!="string"&&(t=T.assign({},t,t.style));let n,s;for(n in t)Fy[n]||([n,s]=U.unitize(n,t[n]),s==null?e.style.removeProperty(n):e.style.setProperty(n,s));typeof t.style=="string"&&(e.style.cssText+=t.style)}}static getCSSText(e){if(typeof e=="string")return e;let t="";for(const r in e)Fy[r]||(t+=`${O.hyphenate(r)}:${e[r]};`);return t}static assignClasses(e,t){T.forEach(t,(r,n)=>e.classList.toggle(n,!!r))}static toggleClasses(e,t,r=null){t=B.asArray(t),r===!0?e.classList.add(...t):r===!1?e.classList.remove(...t):t.forEach(n=>e.classList.toggle(n))}static addTemporaryClass(e,t,r,n=globalThis,s=t){r>0&&(e.classList.add(t),n===globalThis?n.setTimeout(()=>e==null?void 0:e.classList.remove(t),r):n.setTimeout({fn:a=>e.classList.remove(a),delay:r,name:s,args:[t],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,t){const r=globalThis.getComputedStyle(e),n=r.transitionProperty.split(", "),s=r.transitionDuration.split(", "),a=n.indexOf(O.hyphenate(t));let l;return a!==-1&&(l=parseFloat(s[a])*1e3),l}static getAnimationDuration(e){return parseFloat(U.getStyleValue(e,"animation-duration"))*1e3}static highlight(e,t=globalThis){return e instanceof L?e.highlight():new Promise(r=>{t.setTimeout(()=>{e.classList.add("b-fx-highlight"),t.setTimeout(()=>{e.classList.remove("b-fx-highlight"),r()},2e3)},0)})}static get scrollBarWidth(){if(js===null){const e=$y||($y=U.createElement({parent:tt.documentElement,className:"b-scrollbar-measure-element",style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==tt.documentElement&&tt.documentElement.appendChild(e),js=e.offsetWidth,tt.documentElement.style.setProperty("--b-scrollbar-width",`${js}px`)}return js}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static get scrollLimit(){const e=Qt.createElement({parent:document.body,style:"position:absolute; left:-999px; top:0; width:5px; height:5px",children:[{style:"position:absolute; width:1px; height:1px"}]}),t=e.firstElementChild;let r=0,n=2e7;for(;n>1e6&&(t.style.transform=`translateY(${n}px)`,e.style.lineHeight=`${r=1-r}`,!(e.scrollHeight>=n));)n-=1e6;return Object.defineProperty(Qt,"scrollLimit",{value:n}),e.remove(),n}static resetScrollBarWidth(){js=null}static measureText(e,t,r=!1,n=void 0){const s=U.getMeasureElement(t,n);s[r?"innerHTML":"innerText"]=e;const a=s.clientWidth;return s.className="",a}static measureSize(e,t,r=!0){var n;if(!e)return 0;if(typeof e=="number")return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const s=(n=e.includes)==null?void 0:n.call(e,"%"),a=U.getMeasureElement(t,s?t.parentNode:void 0),{parentElement:l}=a;a.innerHTML="",s&&(l.style.display="contents"),a.style.minWidth=a.style.maxWidth=U.setLength(e);const o=r?a.offsetWidth:a.getBoundingClientRect().width;return l.style.display="",a.style.minWidth=a.style.maxWidth=a.className="",o}return/^\d+em$/.test(e)?parseInt(e)*Bx:isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t){t=t||tt.body;const r=lf.getComputedStyle(e),n=t.offScreenDiv=t.offScreenDiv||U.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return aR.forEach(s=>{n.style[s]!==r[s]&&(n.style[s]=r[s])}),n.className=e.className,n.parentElement.parentElement!==t&&t.appendChild(n.parentElement),n}static stripTags(e){return(U.$domParser||(U.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if(typeof e=="string")if(e===""){t.innerHTML="";return}else e=U.createElementFromTemplate(e);return U.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML?(U.syncAttributes(e,t),U.syncContent(e,t),U.syncChildren(e,t),!0):!1}static getSyncAttributes(e){const t={},r=[];for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n];if(s.specified){const a=s.name.toLowerCase();t[a]=s.value,r.push(a)}}return{attributes:t,names:r}}static syncAttributes(e,t){const{attributes:r,names:n}=U.getSyncAttributes(e),{attributes:s,names:a}=U.getSyncAttributes(t),l=n.includes("dataset"),o=n.filter(u=>!a.includes(u)),d=a.filter(u=>!n.includes(u)&&(!l||!u.startsWith("data-"))),c=n.filter(u=>a.includes(u));if(o.length>0)for(let u=0;u<o.length;u++){const h=o[u];h==="style"?U.applyStyle(t,r.style,!0):h==="dataset"?Object.assign(t.dataset,r.dataset):t.setAttribute(h,r[h])}if(d.length>0)for(let u=0;u<d.length;u++)t.removeAttribute(d[u]);if(c.length>0)for(let u=0;u<c.length;u++){const h=c[u];if(h==="style")U.applyStyle(t,r.style,!0);else if(h==="dataset")Object.assign(t.dataset,r.dataset);else if(h==="class"&&(r.class.isDomClassList||typeof r.class=="object")){let g;r.class.isDomClassList?g=r.class:g=new te(r.class),g.isEqual(s.class)||t.setAttribute("class",g)}else s[h]!==r[h]&&t.setAttribute(h,r[h])}}static syncContent(e,t){U.getChildElementCount(e)===0&&(t.innerText=e.innerText)}static setInnerText(e,t){const{firstChild:r}=e;(r==null?void 0:r.nodeType)===Element.TEXT_NODE?r.data=t:e.textContent=t}static syncChildren(e,t){const r=this,n=of.call(e.childNodes),s=of.call(t.childNodes);for(;n.length;){const a=n.shift(),l=s.shift();if(a&&a.nodeType!==ou&&a.nodeType!==_o)throw new Error(`Source node type ${a.nodeType} not supported by DomHelper.sync()`);if(l&&l.nodeType!==ou&&l.nodeType!==_o)throw new Error(`Target node type ${l.nodeType} not supported by DomHelper.sync()`);if(!l)t.appendChild(a);else if(a.nodeType===l.nodeType)a.nodeType===ou?l.data=a.data:a.tagName===l.tagName?r.performSync(a,l):(t.insertBefore(a,l),l.remove());else if(a.nodeType===ou&&l.nodeType===_o)t.innerText=a.data.trim();else{const o=a.parentElement||a;throw new Error(`Currently no support for transforming nodeType.
${o.outerHTML}`)}}s.forEach(a=>{a.remove()})}static syncClassList(e,t){const{classList:r}=e,n=typeof t=="string",s=n?t.split(qx):te.normalize(t,"array"),a=s.length;let l=r.length!==a,o;for(o=0;!l&&o<a;o++)l=!r.contains(s[o]);return l&&(e.className=n?t:s.join(" ")),l}static updateClassList(e,t){const{classList:r}=e;let n,s,a=!1;for(n in t)s=!!t[n],r.contains(n)!==s&&(r[s?"add":"remove"](n),a=!0);return a}static setTheme(e,t){e=e.toLowerCase();const{head:r}=document,n=U.getThemeInfo(t).name.toLowerCase();let s=r.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),a=0;if(n===e)return sR;U.removeEachSelector(r,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const l={theme:e,prev:n};function o(d,c,u){const h=Qt.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:d.href.replace(n,e),nextSibling:d});h.addEventListener("load",()=>{delete h.dataset.loading,bn=null,++a===s.length&&(s.forEach(g=>g.remove()),le.trigger("theme",l),c(l))}),h.addEventListener("error",g=>{delete h.dataset.loading,u(g)})}if(s.length)return new Promise((d,c)=>{s.forEach((u,h)=>{o(u,d,c,h===s.length-1)})});{const d=r.querySelector("#bryntum-theme:not([data-loading])")||r.querySelector(`[href*="${n}.css"]:not([data-loading])`);if(!(d!=null&&d.href.includes(`${n}.css`)))throw new Error(`Theme link for ${n} not found`);return s=[d],new Promise((c,u)=>o(d,c,u))}}static get themeInfo(){return Qt.getThemeInfo()}static getThemeInfo(e){if(!bn){const t=U.createElement({parent:document.body,className:"b-theme-info"}),r=U.getStyleValue(t,"content",!1,":before");if(r)try{bn=JSON.parse(r.replace(/^["']|["']$|\\/g,""))}catch(n){bn=null}bn=bn||(e?{name:e}:null),t.remove()}return bn}static async transition({element:e,selector:t="[data-dom-transition]",duration:r,action:n,thisObj:s=this,addTransition:a={},removeTransition:l={}}){const o=new Set,d=!e.style.height,c=Array.from(e.querySelectorAll(t)),u=new Map(c.map(m=>{let p=0,v=m.parentElement;for(;v&&v!==e;)p++,v=v.parentElement;m.$depth=p,m.scrollHeight>m.offsetHeight&&getComputedStyle(m).overflow==="auto"&&(m.$scrollTop=m.scrollTop,o.add(m));const{parentElement:b}=m,w=L.from(m,e),D=L.from(m,b),S=getComputedStyle(b),x=parseFloat(S.borderLeftWidth);return x&&(w.left-=x,D.left-=x),[m.id,{element:m,globalBounds:w,localBounds:D,depth:p,parentElement:b}]}));d&&(e.style.height=e.offsetHeight+"px"),n.call(s);const h=Array.from(e.querySelectorAll(t)),g=new Map(h.map(m=>{const p=L.from(m,e),v=L.from(m,m.parentElement),b=globalThis.getComputedStyle(m.parentElement),w=parseFloat(b.borderLeftWidth);return w&&(p.left-=w,v.left-=w),[m.id,{element:m,globalBounds:p,localBounds:v}]})),f=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];e.classList.add("b-dom-transition-snapshot");for(const[m,p]of u){const v=g.get(m);if(v){const{element:b}=v,{style:w,parentElement:D}=b,S=parseInt(U.getStyleValue(b,"zIndex")),{globalBounds:x,localBounds:R,depth:M,parentElement:_}=p,k=_!==D;T.copyProperties(b.$initial={parentElement:D},w,f);let F;k?(v.bounds=v.globalBounds,F=x,e.appendChild(b)):(v.bounds=v.localBounds,F=R,_.appendChild(b));let I="hidden";o.has(b)&&(b.$scrollPlaceholder=U.createElement({parent:b,style:{height:b.scrollHeight}}),I="auto");const A={position:"absolute",top:`${F.top}px`,left:`${F.left}px`,width:`${F.width}px`,height:`${F.height}px`,minWidth:0,minHeight:0,margin:0,zIndex:M+(S||0),overflow:I};b.dataset.domTransition!=="preserve-padding"&&(A.padding=0),Object.assign(w,A),v.processed=!0}else{const{element:b,localBounds:w,depth:D,parentElement:S}=p;b.$initial={removed:!0},Object.assign(b.style,{position:"absolute",top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,height:`${w.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:D,overflow:"hidden"}),S.appendChild(b),g.set(m,{element:b,bounds:w,removed:!0,processed:!0}),h.push(b)}}for(const[,m]of g)if(!m.processed){const{element:p}=m,{style:v,parentElement:b}=p,w=m.bounds=m.localBounds;p.classList.add("b-dom-transition-adding"),T.copyProperties(p.$initial={parentElement:b},v,f),Object.assign(v,{position:"absolute",top:a.top?0:`${w.top}px`,left:a.left?0:`${w.left}px`,width:a.width?0:`${w.width}px`,height:a.height?0:`${w.height}px`,opacity:a.opacity?0:null,zIndex:b.$depth+1,overflow:"hidden"})}for(const m of o)m.scrollTop=m.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:m,bounds:p,removed:v}]of g)v?Object.assign(m.style,{top:l.top?0:`${p.top}px`,left:l.left?0:`${p.left}px`,width:l.width?0:`${p.width}px`,height:l.height?0:`${p.height}px`,opacity:l.opacity?0:m.$initial.opacity}):Object.assign(m.style,{top:`${p.top}px`,left:`${p.left}px`,width:`${p.width}px`,height:`${p.height}px`,opacity:m.$initial.opacity});await Qe.sleep(r),e.classList.remove("b-dom-transition","b-dom-transition-snapshot");for(const m of h)m.$initial&&(m.$initial.removed?m.remove():(T.copyProperties(m.style,m.$initial,f),m.$scrollPlaceholder&&(m.$scrollPlaceholder.remove(),delete m.$scrollPlaceholder),m.classList.remove("b-dom-transition-adding"),m.$initial.parentElement.appendChild(m)));d&&(e.style.height="");for(const m of o)m.scrollTop=m.$scrollTop,delete m.$scrollTop}static async loadScript(e){return new Promise((t,r)=>{const n=document.createElement("script");n.src=e,n.onload=t,n.onerror=r,document.head.appendChild(n)})}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb|lab|lch|oklab|oklch)/.test(e)}static createColorStyle(e){return e!=null&&e.length?this.isNamedColor(e)?`var(--cal-color-${e})`:e:""}static get NodeFilter(){return NodeFilter}static addChild(e,t,r){e.insertBefore(t,r)}static cloneStylesIntoShadowRoot(e,t){return new Promise((r,n)=>{t&&e.querySelectorAll('style, link[rel="stylesheet"]').forEach(l=>l.remove());const s=document.querySelectorAll('link[rel="stylesheet"]');let a=0;s.forEach(l=>{const o=l.cloneNode();o.addEventListener("load",()=>{a+=1,a===s.length&&r()}),o.addEventListener("error",d=>{n(o.href)}),e.appendChild(o)}),document.querySelectorAll("style").forEach(l=>{const o=l.cloneNode();o.innerHTML=l.innerHTML,e.appendChild(o)}),s.length||r()})}};y(uu,"_usingKeyboard",!1),y(uu,"enableKeyboardCssModifiers",!0),y(uu,"$name","DomHelper");var E=uu;_e.register(E);var U=E,Hy,uR=()=>U.isTouchEvent=!1,Vy=()=>{U.isTouchEvent=!0,clearTimeout(Hy),Hy=setTimeout(uR,400)};tt.addEventListener("touchstart",Vy,!0),tt.addEventListener("touchend",Vy,!0),U.canonicalStyles=ko,U.supportsTemplate="content"in tt.createElement("template"),U.elementPropKey=Jx,U.numberRe=_y,Node.prototype.closest=function(i){var e;return(e=this.parentNode)==null?void 0:e.closest(i)},globalThis.addEventListener("resize",()=>js=null),E._$name="DomHelper";var hu=new Map,hR=5,gR=i=>i.floating,fR={touchend:1,pointerup:1},mR={Meta:1,Control:1,Alt:1,Shift:1},Ny=i=>{(Us==null?void 0:Us.pointerId)===i.pointerId&&(Us=null)},uf=i=>{const{touches:e}=i;if(hu.clear(),e)for(let t=0;t<e.length;t++){const r=e.item(t);hu.set(r.identifier,[r,i])}},Mt=new class extends $.mixin(Fe){suspendFocusEvents(){gu=!0}resumeFocusEvents(){gu=!1}setupFocusListenersOnce(e,t){e&&!Mt.observedElements.has(e)&&(Mt.setupFocusListeners(e,t),Mt.observedElements.add(e))}detachFocusListeners(e){e.$globalEventsDetacher&&(e.$globalEventsDetacher(),e.$globalEventsDetacher=null,Mt.observedElements.delete(e))}setupFocusListeners(e=document,t,r=!1){let n,s,a;const l={element:e,fromGlobal:!0,touchstart(o){const{touches:d}=o;if(uf(o),d.length===2&&d[0].target.closest(".b-widget")&&d[1].target.closest(".b-widget")){n=[d[0],d[1]],s=[(n[0].clientX+n[1].clientX)/2,(n[0].clientY+n[1].clientY)/2],a=E.elementFromPoint(s[0],s[1]);return}if(!_t&&o.changedTouches.length===1){if(_t=o.changedTouches[0],!Y.isAndroid){const c=({clientX:g,clientY:f,type:m})=>{(fR[m]||!_t||Math.max(Math.abs(g-_t.clientX),Math.abs(f-_t.clientY))>hR)&&(hf=null,u(),clearTimeout(h))},u=t.on({element:document,touchmove:c,touchend:c,pointermove:c,pointerup:c,capture:!0}),h=setTimeout(()=>{hf=_t.identifier,u(),o.target.dispatchEvent(new MouseEvent("contextmenu",t.copyEvent({},o)))},t.longPressTime)}}else _t=null},touchmove:{passive:!1,handler:o=>{const{touches:d}=o;if(d.length===2&&n){const c=[d[0],d[1]],u=t.getDistanceBetween(n[0],n[1])-t.getDistanceBetween(c[0],c[1]),h=Math.abs(n[0].clientX-n[1].clientX)-Math.abs(c[0].clientX-c[1].clientX),g=Math.abs(n[0].clientY-n[1].clientY)-Math.abs(c[0].clientY-c[1].clientY);if(Math.abs(u)>2){const f={clientX:s[0],clientY:s[1],bubbles:!0};if(Mt.Widget.convertPinchToMousewheel){o.preventDefault(),o.stopImmediatePropagation();const p=new MouseEvent("wheel",{...f,ctrlKey:!0});p.deltaY=g,p.deltaX=h,a.dispatchEvent(p)}const m=new MouseEvent("bryntum-pinch",f);m.deltaY=g,m.deltaX=h,m.touchMove=o,a.dispatchEvent(m)}n=c}}},touchend:{passive:!1,handler:o=>{uf(o),o.touches.length!==2&&(n=null),_t&&(o.changedTouches[0].identifier===hf?(o.stopImmediatePropagation(),o.cancelable!==!1&&o.preventDefault()):o.changedTouches.length===1&&o.changedTouches[0].identifier===_t.identifier&&Mt.trigger("globaltap",{event:o}),_t=null)}},touchcancel:{passive:!1,handler:uf},mousedown:{handler:o=>{fu="mouse",_t||Mt.trigger("globaltap",{event:o}),xr=o;const d=o.ctrlKey||o.altKey||o.shiftKey||o.metaKey;!Ke&&d?Ke=new KeyboardEvent("keydown",{key:o.ctrlKey?"Control":o.shiftKey?"Shift":o.altKey?"Alt":"Meta",ctrlKey:o.ctrlKey,altKey:o.altKey,shiftKey:o.shiftKey,metaKey:o.metaKey}):Ke&&!d&&(Ke=null)},passive:!1},mouseup:{handler:o=>{Mt.trigger("mouseup",{event:o}),xr=null},passive:!1},pointerdown:{passive:!1,handler:o=>{Us=o,E.setUsingKeyboard(e,!1)}},pointerup:{passive:!1,handler:Ny},pointercancel:{passive:!1,handler:Ny},keydown(o){const{key:d,target:c}=o;if(fu="key",Ke=o,gf=c,!mR[d]){if(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(const u of e.children)u.matches(".b-outer")&&E.setUsingKeyboard(u,!0);else E.setUsingKeyboard(e,!0);d==="Escape"&&Mt.Widget.queryAll(u=>u.isTooltip&&u.isVisible).forEach(u=>u.hide())}},mouseenter(o){gf=o.target},keypress(){fu="key"},keyup(){Ke=null},focusin(o){var d;const{Widget:c}=Mt,{target:u}=o;if(u!=null&&u.shadowRoot||u!=null&&u._shadowRoot)return;if(Y.supportsPointerEvents&&(u!=null&&u.matches(":focus-visible"))&&!bryntum.fromElement(u,x=>x.isDestroying||x.isDestroyed)){const x=u.matches("[class*=event-wrap],[class*=task-wrap]")?u.firstElementChild:u,R=L.from(x),M=R.center;x.dispatchEvent(new PointerEvent("pointerover",{bubbles:!0,clientX:M.x,clientY:M.y,pointerType:"focus"}))}if(gu||u&&!u.isConnected)return;const h=o.relatedTarget?o.relatedTarget instanceof HTMLElement?o.relatedTarget:document.body:null,g=u||document.body,f=c.fromElement(h),m=c.fromElement(g),p=E.getCommonAncestor(f,m),v=!!(h&&g.compareDocumentPosition(h)&4),b=c.query(pR);let w=null;if(g&&g!==document.body?w=E.getActiveElement(g):w=E.getActiveElement(document),b&&!b._isRevertingFocus&&(!m||!b.owns(m)&&!(b.element.compareDocumentPosition(m.element)&4&&m.up(gR))))return b.focus();let D=mf("focusout",h,u,f,m,v);for(let x=f,R;x&&x!==p;x=R)if(R=x.owner,!x.isDestroying&&x.onFocusOut&&(x.onFocusOut(D),u&&w!==E.getActiveElement(u)))return;if(p&&u===p.element)!p.isDestroying&&E.getActiveElement(p)===g&&p.focusElement&&p.focusElement!==p.element&&(!p.element.contains(w)||p.focusDescendant)&&p.setTimeout(()=>{var x;return(x=p.focus)==null?void 0:x.call(p)},0);else{D=mf("focusin",g,h,f,m,v);for(let x=m;x&&x!==p;x=x.owner)x.isDestroying||(d=x.onFocusIn)==null||d.call(x,D)}const S=E.getCommonAncestor((h==null?void 0:h.nodeType)===Element.ELEMENT_NODE?h:null,g)||g.parentNode;S&&(D=mf("focusmove",g,h,f,m,v,{bubbles:!0}),S.dispatchEvent(D))},focusout(o){if(!gu&&(!o.relatedTarget||!Mt.Widget.fromElement(o.relatedTarget))){const d=o.relatedTarget&&o.relatedTarget instanceof HTMLElement?o.relatedTarget:null;l.focusin({target:d,relatedTarget:o.target}),Ke=xr=null}},blur:{element:globalThis,handler(o){o.target===globalThis&&(Ke=null,xr=null)}},capture:!0,passive:!0};r&&(ff==null||ff()),ff=this.detachEvents=e.$globalEventsDetacher=t.on(l)}get activeTouches(){return Array.from(hu.values())}get hasActiveTouches(){return hu.size>0}get lastInteractionType(){return fu}get shiftKeyDown(){return!!(Ke!=null&&Ke.shiftKey)}get ctrlKeyDown(){return!!(Ke!=null&&Ke.ctrlKey||Ke!=null&&Ke.metaKey)}get altKeyDown(){return!!(Ke!=null&&Ke.altKey)}get currentOverElement(){return gf}isKeyDown(e){return e?(Ke==null?void 0:Ke.key)===e||Ke[(e==null?void 0:e.toLowerCase())+"Key"]===!0:!!Ke}isMouseDown(e=0){return(xr==null?void 0:xr.button)===e}get currentMouseDown(){return xr}set currentMouseDown(e){xr=e}get currentPointerDown(){return Us}set currentPointerDown(e){Us=e}get currentTouch(){return _t}set currentTouch(e){_t=e}get currentKeyDown(){return Ke}set currentKeyDown(e){Ke=e}},pR=i=>i.isTopModal;Mt.observedElements=new Set;var _t,hf,gu=!1,fu,Ke,xr,Us,gf,ff;function mf(i,e,t,r,n,s,a){const l=new CustomEvent(i,a);return Object.defineProperty(l,"_target",{get(){return e}}),Object.defineProperty(l,"relatedTarget",{get(){return t}}),l.fromWidget=r,l.toWidget=n,l.backwards=s,l}var le=Mt,vR=/^(\w+)=(.*)$/,yR=function(i){const e={},t=i.split("&");for(const r of t){const[n,s,a]=vR.exec(r),l=decodeURIComponent(s),o=decodeURIComponent(a);if(n){let d=e[l];d?(Array.isArray(d)||(d=e[l]=[d]),d.push(o)):e[l]=o}}return e},By=class Vs{static get(e,t){return this.fetch(e,t)}static post(e,t,r={}){return r=Z.assign({},r),!(t instanceof FormData)&&typeof t!="string"&&(t=JSON.stringify(t),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},r))}static fetch(e,t){let r;if(t=Z.merge({},Vs.DEFAULT_FETCH_OPTIONS,t),typeof AbortController!="undefined"&&(r=t.abortController=new AbortController,t.signal=r.signal),t.queryParams){const s=Object.entries(t.queryParams);if(s.length){let a=!1;if(t.headers&&t.addQueryParamsToBody===!0){const l=new Headers(t.headers).get("Content-Type");let o;switch(l){case"application/x-www-form-urlencoded":o=URLSearchParams;break;case"multipart/form-data":o=FormData;break}if(o){const d=t.body||(t.body=new o);d instanceof o&&(s.forEach(([c,u])=>d.set(c,u)),a=!0)}}a||(e+=(e.includes("?")?"&":"?")+s.map(([l,o])=>`${l}=${encodeURIComponent(o)}`).join("&"))}}const n=new Promise((s,a)=>{fetch(e,t).then(l=>{t.parseJson?l.json().then(o=>{l.parsedJson=o,s(l)}).catch(o=>{l.parsedJson=null,l.error=o,a(l)}):s(l)}).catch(l=>{l.stack=n.stack,a(l)})});return n.stack=new Error().stack,n.abort=function(){r==null||r.abort(new DOMException("User aborted request","AbortError")),this.aborted=!0},n}static mockUrl(e,t){const r=this;(r.mockAjaxMap||(r.mockAjaxMap={}))[e]=t,Vs.originalFetch||(Vs.originalFetch=Vs.fetch,Vs.fetch=r.mockAjaxFetch.bind(r))}static async mockAjaxFetch(e,t){const r=e.split("?");let n=this.mockAjaxMap[r[0]],s=null;if(n){typeof n=="function"&&(n=await n(r[0],r[1]&&yR(r[1]),t));try{s=(t==null?void 0:t.parseJson)&&JSON.parse(n.responseText)}catch(a){s=null,n.error=a}return n=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:s,text:()=>new Promise(a=>{a(n.responseText)}),json:()=>new Promise(a=>{a(s)})},n),new Promise(function(a,l){n.synchronous?a(n):setTimeout(function(){a(n)},"delay"in n?n.delay:100)})}else return Vs.originalFetch(e,t)}};y(By,"DEFAULT_FETCH_OPTIONS",{});var kt=By;kt._$name="AjaxHelper";var zy=class Ni{static mergeLocales(...e){const t={};return e.forEach(r=>{Object.keys(r).forEach(n=>{typeof r[n]=="object"?t[n]={...t[n],...r[n]}:t[n]=r[n]})}),t}static trimLocale(e,t){const r=(n,s)=>{e[n]&&(s?e[n][s]&&delete e[n][s]:delete e[n])};Object.keys(t).forEach(n=>{Object.keys(t[n]).length>0?Object.keys(t[n]).forEach(s=>r(n,s)):r(n)})}static normalizeLocale(e,t){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if(typeof e=="string"){if(!t)throw new Error('"config" parameter can not be empty');t.locale?t.name=e||t.name:t.localeName=e}else t=e;let r={};if(t.name||t.locale)r=Object.assign({localeName:t.name},t.locale),t.desc&&(r.localeDesc=t.desc),t.code&&(r.localeCode=t.code),t.path&&(r.localePath=t.path);else{if(!t.localeName)throw new Error(`"config" parameter doesn't have "localeName" property`);r=Object.assign({},t)}for(const n of["name","desc","code","path"])r[n]&&delete r[n];if(!r.localeName)throw new Error("Locale name can not be empty");return r}static get locales(){return Ni.global.bryntum.locales||{}}static set locales(e){Ni.global.bryntum.locales=e}static get localeName(){return Ni.global.bryntum.locale||"En"}static set localeName(e){Ni.global.bryntum.locale=e||Ni.localeName}static get locale(){return Ni.localeName&&this.locales[Ni.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,t){const{locales:r}=Ni.global.bryntum,n=Ni.normalizeLocale(e,t),{localeName:s}=n;return!r[s]||t===!0?r[s]=n:r[s]=this.mergeLocales(r[s]||{},n||{}),r[s]}static get global(){return globalThis}};y(zy,"skipLocaleIntegrityCheck",!1);var lt=zy;lt.global.bryntum=lt.global.bryntum||{},lt.global.bryntum.locales=lt.global.bryntum.locales||{},lt._$name="LocaleHelper";var bR=class extends Fe($){static get defaultConfig(){return{throwOnMissingLocale:re.isTestEnv}}construct(...i){var e;const t=this;if(super.construct(...i),Y.isBrowserEnv){const r=document.querySelector("script[data-default-locale]");r?t.applyLocale(r.dataset.defaultLocale):(e=t.locale)!=null&&e.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return lt.locales}set locales(i){lt.locales=i}set locale(i){this.applyLocale(i)}get locale(){return lt.locale}get localeCode(){var i,e;return(e=(i=this.locale)==null?void 0:i.localeCode)!=null?e:"en-US"}applyLocale(i,e,t=!1){const r=this;let n;if(typeof i=="string")if(typeof e!="object"){if(n=r.locales[i],!n){if(t)return!0;throw new Error(`Locale "${i}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else n=lt.publishLocale(i,e);else n=lt.publishLocale(i);if(r.locale.localeName&&r.locale.localeName===n.localeName&&e!==!0)return r.locale;n.oldLocaleName=r.locale.localeName,n.oldLocaleCode=r.locale.localeCode,lt.localeName=n.localeName;const s=()=>{r.trigger("locale",n)};return n.localePath?new Promise((a,l)=>{r.loadLocale(n.localePath).then(o=>{o.text().then(d=>{new Function(d)(),Y.isBrowserEnv&&(n=r.locales[n.localeName],n&&delete n.localePath),s(),a(n)})}).catch(o=>l(o))}):(s(),n)}loadLocale(i){return kt.get(i)}set throwOnMissingLocale(i){this._throwOnMissingLocale=i}get throwOnMissingLocale(){return this._throwOnMissingLocale}},CR=new bR,Le=CR,wR=Object.getPrototypeOf(Object),Wy=/L{.*?}/g,jy=/L{(.*?)}/g,Uy=/((.*?)\.)?(.+)/g,SR=i=>i.replace(/{(\d+)}/gm,"[[$1]]"),Gy=i=>i.replace(/\[\[(\d+)]]/gm,"{$1}"),Yy=Object.freeze(Object.create(null)),Nt=i=>{var e;return e=class extends(i||$){static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(t){var r,n;return typeof t=="string"?t:t===wR?"Object":t.$$name||t.name||((r=t.prototype)==null?void 0:r.$$name)||((n=t.prototype)==null?void 0:n.name)}static parseLocaleString(t){const r=[];let n;if(t!=null&&t.includes("L{"))for(t=SR(t),jy.lastIndex=0;(n=jy.exec(t))!=null;){Uy.lastIndex=0;const s=Uy.exec(n[1]);r.push({match:Gy(n[0]),localeKey:Gy(s[3]),localeClass:s[2]})}return r.length>0?r:[{match:t,localeKey:t,localeClass:void 0}]}construct(t={},...r){super.construct(t,...r),Le.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(t){var r,n,s;const a=this,l=Z.getPath(a,t),o=((r=a.$meta.configs[t])==null?void 0:r.localeKey)||((s=(n=a.fieldMap)==null?void 0:n[t])==null?void 0:s.defaultValue);let d;if(o)if(d=e.localize(o,a,a.localeClass||a),d&&!(t in(a.initialConfig||Yy))&&!(t in(a.originalData||Yy)))Z.setPath(a.isColumn?a.data:a,t,d);else return l;else typeof l=="string"&&(a.originalLocales=a.originalLocales||{},d=Z.getPath(a.originalLocales,t),d===void 0&&(Z.setPath(a.originalLocales,t,l),d=l),d&&Z.setPath(a,t,d=a.optionalL(d,a)));return d||l}updateLocalization(){var t,r;this.localizable!==!1&&((t=this.localizableProperties)==null||t.forEach(this.localizeProperty,this),(r=this.trigger)==null||r.call(this,"localized"))}static getTranslation(t,r,n){const s=Le.locale;let a=null,l,o;if(s)for(const{match:d,localeKey:c,localeClass:u}of this.parseLocaleString(t)){const h=f=>{var m;const p=(m=s[f])==null?void 0:m[c];return p&&(typeof p=="function"?a=r!=null?p(r):p:typeof p=="object"||t===d?a=p:a=(a||t).replace(d,p),typeof p=="string"&&p.includes("L{")&&(a=this.getTranslation(p,r,n))),p};let g=!1;for(o=n;o&&(l=e.clsName(o))&&!(g=h(l));o=Object.getPrototypeOf(o))if(typeof o=="string")break;!g&&u&&h(u)}return a}static localize(t,r=void 0,...n){(n==null?void 0:n.length)===0&&(n=[this]);let s=null;return n.some(a=>(s=e.getTranslation(t,r,a),s!=null)),s}static L(t,r=void 0,...n){(n==null?void 0:n.length)===0&&(n=[this]);const s=this.localize(t,r,...n);if(s==null&&Le.throwOnMissingLocale&&t.includes("L{"))throw new Error(`Localization is not found for '${t}' in '${n.map(a=>e.clsName(a)).join(", ")}'. ${Le.locale.localeName?`Locale : ${Le.locale.localeName}`:""}`);return s!=null?s:t}L(t,r,n=this.localeClass){const{constructor:s}=this;return n&&e.clsName(n)!==e.clsName(s)?e.L(t,r,n,s):e.L(t,r,s)}static optionalL(t,r=void 0,...n){const s=Le.throwOnMissingLocale;Le.throwOnMissingLocale=s&&Wy.test(t),(n==null?void 0:n.length)===0&&(n=[this]);const a=e.L(t,r,...n);return Le.throwOnMissingLocale=s,a}optionalL(t,r=this,n=!1){const s=Le.throwOnMissingLocale;Le.throwOnMissingLocale=s&&Wy.test(t)&&!n;const a=this.L(t,r);return Le.throwOnMissingLocale=s,a}get localeManager(){return Le}get localeHelper(){return lt}},y(e,"$name","Localizable"),e};function DR(i,e){const t=T.getPropertyDescriptor(i,e);return t&&(t.get||t.set)?t:null}var ie=class extends $.mixin(Fe,Nt){onConfigChange(...i){var e,t;super.onConfigChange(...i),this.isConfiguring||(t=(e=this.client)==null?void 0:e.afterPluginConfigChange)==null||t.call(e,{plugin:this,...i[0]})}updateClient(i){this.owner||(this.owner=i)}updateKeyMap(i){const{client:e}=this;e.keyMap=e.mergeKeyMaps(e.keyMap,i,O.uncapitalize(this.constructor.$name))}static initPlugins(i,...e){for(const t of e)this.initPlugin(i,t)}static initPlugin(i,e,t){const r=i.plugins||(i.plugins={}),n=[i];return t&&n.push(t),r[e.$$name]=new e(...n)}get enabled(){return!this.disabled}getFocusRevertTarget(){var i;return(i=this.client)==null?void 0:i.getFocusRevertTarget()}construct(...i){const e=this;let[t,r]=i,n;i.length===1?T.isObject(t)&&(r=t,t=r.client):(r=T.assign({},r),delete r.client),e.client=t,super.construct(r),e.applyPluginConfig(t),n=e.clientListeners,n&&(n=T.assign({},n),n.thisObj=e,t.ion(n))}applyPluginConfig(i){const e=this,t=e.pluginConfig||e.constructor.pluginConfig;if(t){const{assign:r,chain:n,after:s,before:a,override:l}=t;r&&e.applyAssign(i,r),(n||s)&&e.applyChain(i,n||s),a&&e.applyChain(i,a,!1),l&&e.applyOverride(i,l)}}applyAssign(i,e){e.forEach(t=>this.assign(i,t))}applyChain(i,e,t=!0){if(Array.isArray(e))for(const r of e)this.chain(i,r,r,t);else for(const r in e)this.chain(i,r,e[r],t)}applyOverride(i,e){const t=this;t.overridden||(t.overridden={}),e.forEach(r=>{if(!t[r])throw new Error(`Trying to chain fn ${i.$$name}#${r}, but plugin fn ${t.$$name}#${r} does not exist`);typeof i[r]=="function"&&(t.overridden[r]=i[r].bind(i)),i[r]=t[r].bind(t)})}assign(i,e){const t=this,r=DR(t,e);r?Object.defineProperty(i,e,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(t),set:r.set&&r.set.bind(t)}):i[e]=t[e].bind(t)}chain(i,e,t,r=!0){let n=0;typeof e=="object"&&(e=e.fn),typeof t=="object"&&(n=t.prio||0,t=t.fn);const s=this,a=i.pluginFunctionChain||(i.pluginFunctionChain={}),l=s[t]&&s[t].bind(s),o=s.functionChainRunner;if(!l)throw new Error(`Trying to chain fn ${i.$$name}#${t}, but plugin fn ${s.$$name}#${t} does not exist`);if(!a[e]){let d=i[e];d&&(d=d.bind(i),d.$this=i,d.$prio=0),a[e]=d?[d]:[],i[e]=(...c)=>o(a[e],c)}l.$this=s,l.$prio=n,a[e][r?"push":"unshift"](l),a[e].$sorted=!1}functionChainRunner(i,e){let t,r,n;for(i.$sorted||(i.sort((s,a)=>a.$prio-s.$prio),i.$sorted=!0),r=0;r<i.length&&(t=i[r],!(!t.$this.isDestroyed&&(n=t(...e),n===!1)));r++);return n}doDisable(i){var e,t,r,n;const s=this,{constructor:a}=s,l="featureClass"in a?a.featureClass:`b-${a.$$name.toLowerCase()}`,o=O.uncapitalize(a.$$name);l&&((t=(e=s.client)==null?void 0:e._element)==null||t.classList[i?"remove":"add"](l)),s.isConfiguring||(i?s.trigger("disable"):s.trigger("enable"),(n=(r=s.client).syncSplits)==null||n.call(r,d=>{const c=d.features[o];c&&(c.disabled=i)}))}updateDisabled(i){this.doDisable(i)}throwOverrideIsMissing(i){throw new Error(`Trying to override fn ${i.plugIntoName}#${i.fnName}, but plugin fn ${i.pluginName}#${i.fnName} does not exist`)}get rootElement(){return this.client.rootElement}get state(){var i;return(i=this.constructor.stateProperties)==null?void 0:i.reduce((e,t)=>(e[t]=this[t],e),{})}};y(ie,"$name","InstancePlugin"),y(ie,"configurable",{disabled:!1,client:null,keyMap:null}),y(ie,"properties",{clientListeners:null}),ie._$name="InstancePlugin";var pf=i=>{var e;return e=class extends(i||$){get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(t){t&&(Array.isArray(t)||(t=[t]),ie.initPlugins(this,...t)),this.initPlugins()}initPlugins(){}addPlugins(...t){ie.initPlugins(this,...t)}addPlugin(t,r){return ie.initPlugin(this,t,r)}hasPlugin(t){return this.getPlugin(t)!=null}getPlugin(t){var r;return typeof t=="function"&&(t=t.$$name),(r=this.plugins)==null?void 0:r[t]}get widgetClass(){}},y(e,"$name","Pluggable"),e},ER={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week",None:"None",previous:"Previous",next:"Next",to:"to",at:"At",on:"On",editing:i=>`Editing ${i}`,settings:"Settings",close:"Close",go:"Go",save:"Save",cancel:"Cancel",revert:"Revert"},CheckboxGroup:{wrongNbrOfOptionsSelected:i=>`Select exactly ${i}`,tooFewOptionsSelected:i=>`Select at least ${i}`,tooManyOptionsSelected:i=>`Select no more than ${i}`},CodeEditor:{apply:"Apply",autoApply:"Auto apply",downloadCode:"Download code",editor:"Code editor",viewer:"Code viewer"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:i=>`Add ${i}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:i=>`Value must be less than or equal to ${i.max}`,rangeUnderflow:i=>`Value must be greater than or equal to ${i.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:i=>"Invalid date input, expected format is "+i},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},Hint:{dontShowAgain:"Don't show again"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:i=>`of ${i.lastPage}`,summaryTemplate:i=>`Displaying records ${i.start} - ${i.end} of ${i.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},TabPanel:{containsInvalidFields:"Tab contains invalid fields"},Toolbar:{showOverflowingItems:"Show overflowing items",scrollForMore:"Scroll for more"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater or equals",isLessThanOrEqualTo:"less or equals",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",timeEquals:"time equals",timeDoesNotEqual:"time does not equal",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select property",selectAnOperator:"Select operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectValue:"Select value",selectOneOrMoreValues:"Select value(s)",enterAValue:"Enter value",enterANumber:"Enter number",selectADate:"Select date",selectATime:"Select time"},FieldFilterPickerGroup:{addFilter:"Add filter",applyCond:i=>i?"Skip filter (currently applied)":"Apply filter (currently skipped)"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"emillisecond",plural:"ems",abbrev:"ems"},{single:"second",plural:"seconds",abbrev:"s"},{single:"esecond",plural:"eseconds",abbrev:"es"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"eminute",plural:"eminutes",abbrev:"emin"},{single:"hour",plural:"hours",abbrev:"h"},{single:"ehour",plural:"ehours",abbrev:"eh"},{single:"day",plural:"days",abbrev:"d"},{single:"eday",plural:"edays",abbrev:"ed"},{single:"week",plural:"weeks",abbrev:"w"},{single:"eweek",plural:"eweeks",abbrev:"ew"},{single:"month",plural:"months",abbrev:"mon"},{single:"emonth",plural:"emonths",abbrev:"emon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"equarter",plural:"equarters",abbrev:"eq"},{single:"year",plural:"years",abbrev:"yr"},{single:"eyear",plural:"eyears",abbrev:"eyr"},{single:"decade",plural:"decades",abbrev:"dec"},{single:"edecade",plural:"edecades",abbrev:"edec"}],unitAbbreviations:[["mil"],["emil"],["s","sec"],["es","esec"],["m","min"],["em","emin"],["h","hr"],["eh","ehr"],["d"],["ed"],["w","wk"],["ew","ewk"],["mo","mon","mnt","M"],["emo","emon","emnt"],["q","quar","qrt"],["eq","equar","eqrt"],["y","yr"],["ey","eyr"],["dec"],["edec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:i=>{const e=["11","12","13"].find(r=>i.endsWith(r));let t="th";if(!e){const r=i[i.length-1];t={1:"st",2:"nd",3:"rd"}[r]||"th"}return i+t},decade:i=>{const e=typeof i=="number"?i:i.getFullYear();return`${e-e%10}s`}}},AP=lt.publishLocale(ER),{toString:qy}=Object.prototype,xR=qy.call(new Date),mu=new Date,Ky=1e3*60*60,vf=(i,e)=>isNaN(i)||i==null?e:i,RR=/([ES]){([^}]+)}/g,Xy=i=>{const e=["11","12","13"].find(r=>i.endsWith(r));let t="th";if(!e){const r=i[i.length-1];t={1:"st",2:"nd",3:"rd"}[r]||"th"}return i+t},yi=(i,e,t,r=pt)=>(r[i]=r[i]||{[i]:1},r[e]=r[e]||{[e]:1},r[i][e]=t,r[e][i]=1/t,r),ot=(i,e,t)=>(bi[i]||(bi[i]=new Intl.DateTimeFormat(Wi,e))).format(t),Fo=(i,e,t,r=!1)=>{let n=ot(i,e,t);return/am|pm/i.test(n)&&(n=n.replace(/^0/,""),r&&(n=n.replace(/:00/,""))),n},TR=(i,e)=>Math.floor((i.getTime()-e.getTime()-(i.getTimezoneOffset()-e.getTimezoneOffset())*pt.minute.millisecond)/pt.day.millisecond)+1,Zy=i=>i>=0?i:i+7,MR=/([^\w])(S+)/gm,_R=(i,e)=>e+"SSS",Jy=/[:.\-/\s]/,Qy=/^(?:יום |ال)/,Wi="en-US",ji=Xy,pu={},Io={},bi={},yf={},bf={},vu="AM",yu="PM",Cf=Ky,Gs,Ys,eb=i=>{const e=wf[i];if(!e)throw new Error("Only international formats should be used here");if(Io[i]!==void 0)return Io[i];const t=new Intl.DateTimeFormat(Wi,e),r=t.formatToParts(new Date(2001,1,2,3,4,5,6)).map(n=>{const s=n.type,a=e[s];if(s==="literal")return n.value.replace(/,/g,"");if(s==="day")return a==="numeric"?"D":"DD";if(s==="month")return a==="short"?"MMM":a==="long"?"MMMM":a==="numeric"?"M":"MM";if(s==="year")return a==="numeric"?"YYYY":"YY"}).join("");return Io[i]=r},tb=2020,ib=0,rb=1,wf={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},at={M:i=>i.getMonth()+1,Mo:i=>ji(at.M(i).toString()),MM:i=>(i.getMonth()+1).toString().padStart(2,"0"),MMM:i=>ot("MMM",{month:"short"},i),MMMM:i=>ot("MMMM",{month:"long"},i),DC:i=>C.localize("L{decade}",i),Q:i=>Math.ceil((i.getMonth()+1)/3),Qo:i=>ji(at.Q(i).toString()),D:i=>i.getDate(),Do:i=>ji(at.D(i).toString()),DD:i=>i.getDate().toString().padStart(2,"0"),DDD:i=>Math.ceil((new Date(i.getFullYear(),i.getMonth(),i.getDate(),12,0,0)-new Date(i.getFullYear(),0,0,12,0,0))/pt.day.millisecond),DDDo:i=>ji(at.DDD(i).toString()),DDDD:i=>at.DDD(i).toString().padStart(3,"0"),d:i=>i.getDay(),do:i=>ji(i.getDay().toString()),d1:i=>ot("d1",{weekday:"narrow"},i).substr(0,1),dd:i=>at.ddd(i).substring(0,2),ddd:i=>{var e;return Gs=ot("ddd",{weekday:"short"},i),Ys=(e=Gs.match(Qy))==null?void 0:e[0],Gs.substring(Ys?Ys.length:0)},dddd:i=>{var e;return Gs=ot("dddd",{weekday:"long"},i),Ys=(e=Gs.match(Qy))==null?void 0:e[0],Gs.substring(Ys?Ys.length:0)},u:i=>{const e=bi.u||(bi.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})),t=e.formatToParts(i);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:i=>{const e=bi.uu||(bi.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),t=e.formatToParts(i);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:i=>i.getDay(),E:i=>i.getDay()+1,W:i=>C.getWeekNumber(i)[1],Wo:i=>ji(at.W(i).toString()),WW:i=>at.W(i).toString().padStart(2,"0"),Wp:i=>`${C.localize("L{Week}")} ${at.W(i)}`,WWp:i=>`${C.localize("L{Week}")} ${at.WW(i)}`,Wp0:i=>`${C.localize("L{Week}")[0]}${at.W(i)}`,WWp0:i=>`${C.localize("L{Week}")[0]}${at.WW(i)}`,Y:i=>i.getFullYear(),YY:i=>(i.getFullYear()%100).toString().padStart(2,"0"),YYYY:i=>i.getFullYear(),A:i=>(i.getHours()<12?vu:yu).toLocaleUpperCase(),a:i=>(i.getHours()<12?vu:yu).toLocaleLowerCase(),H:i=>i.getHours(),HH:i=>i.getHours().toString().padStart(2,"0"),h:i=>i.getHours()%12||12,hh:i=>at.h(i).toString().padStart(2,"0"),k:i=>i.getHours()||24,kk:i=>at.k(i).toString().padStart(2,"0"),K:i=>Fo("K",{hour:"numeric"},i),KK:i=>Fo("KK",{hour:"2-digit"},i),m:i=>i.getMinutes(),mm:i=>at.m(i).toString().padStart(2,"0"),s:i=>i.getSeconds(),ss:i=>at.s(i).toString().padStart(2,"0"),S:i=>Math.floor(i.getMilliseconds()/100).toString(),SS:i=>Math.floor(i.getMilliseconds()/10).toString().padStart(2,"0"),SSS:i=>i.getMilliseconds().toString().padStart(3,"0"),z:i=>ot("z",{timeZoneName:"short"},i),zz:i=>ot("zz",{timeZoneName:"long"},i),Z:i=>N.getGMTOffset(i),LT:i=>Fo("LT",{hour:"2-digit",minute:"2-digit"},i),LST:i=>Fo("LST",{hour:"numeric",minute:"2-digit"},i,!0),LTS:i=>Fo("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},i),L:i=>ot("L",{year:"numeric",month:"2-digit",day:"2-digit"},i),l:i=>ot("l",wf.l,i),LL:i=>ot("LL",{year:"numeric",month:"long",day:"numeric"},i),ll:i=>ot("ll",wf.ll,i),LLL:i=>ot("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},i),lll:i=>ot("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},i),LLLL:i=>ot("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},i),llll:i=>ot("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},i)},kR=Object.keys(at).sort((i,e)=>e.length-i.length),FR=`^(?:${kR.join("|")})`,ht=()=>({}),IR=i=>NR.test(i),Sf=i=>IR(i)&&{milliseconds:parseInt(i.padEnd(3,"0").substring(0,3))},nb={YYYY:i=>{const e=parseInt(i);return{year:e>=1e3&&e<=9999?e:NaN}},Y:i=>({year:parseInt(i)}),YY:i=>{const e=parseInt(i);return{year:e+(e>1968?1900:2e3)}},M:i=>({month:parseInt(i)-1}),MM:i=>({month:parseInt(i)-1}),Mo:i=>({month:parseInt(i)-1}),MMM:i=>{const e=(i||"").toLowerCase();for(const[t,r]of Object.entries(C._monthShortNamesIndex))if(e.startsWith(t))return{month:r.value}},MMMM:i=>{const e=(i||"").toLowerCase();for(const[t,r]of Object.entries(C._monthNamesIndex))if(e.startsWith(t))return{month:r.value}},DD:i=>({date:parseInt(i)}),D:i=>({date:parseInt(i)}),Do:i=>({date:parseInt(i)}),DDD:ht,DDDo:ht,DDDD:ht,d:ht,do:ht,d1:ht,dd:ht,ddd:ht,dddd:ht,Q:ht,Qo:ht,W:ht,Wo:ht,WW:ht,e:ht,E:ht,HH:i=>({hours:parseInt(i)}),hh:i=>({hours:parseInt(i)}),mm:i=>({minutes:parseInt(i)}),H:i=>({hours:parseInt(i)}),m:i=>({minutes:parseInt(i)}),ss:i=>({seconds:parseInt(i)}),s:i=>({seconds:parseInt(i)}),S:Sf,SS:Sf,SSS:Sf,A:i=>({amPm:i.toLowerCase()}),a:i=>({amPm:i.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>eb("l")},ll:{type:"dynamic",parser:()=>eb("ll")},Z:i=>{if(!i||!lb.test(i)&&i!=="Z")return null;let e=0;if(i!=="Z"){const t=lb.exec(i);if(t){const r=t[1]==="+"?1:-1,n=parseInt(t[2])||0,s=parseInt(t[3])||0;e=r*(n*60+s)}else e=-1*new Date().getTimezoneOffset()}return{timeZone:e}}},AR=Object.keys(nb).sort((i,e)=>e.length-i.length),sb=new RegExp(`(${AR.join("|")})`),LR=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),pt={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:24*3652,minute:1440*3652,second:86400*3652,millisecond:864e5*3652},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:24*365,minute:1440*365,second:86400*365,millisecond:864e5*365},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:24*91,minute:1440*91,second:86400*91,millisecond:864e5*91},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-24*30,minute:-1440*30,second:-86400*30,millisecond:-864e5*30},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/(3652*24),year:-1/(365*24),quarter:-1/(91*24),month:-1/(30*24),week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/(3652*1440),year:-1/(365*1440),quarter:-1/(91*1440),month:-1/(30*1440),week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/(3652*86400),year:-1/(365*86400),quarter:-1/(91*86400),month:-1/(30*86400),week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/(3652*864e5),year:-1/(365*864e5),quarter:-1/(91*864e5),month:-1/(30*864e5),week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:1/1e3}},ab={ms:"millisecond",milliseconds:"millisecond",ems:"emillisecond",emilliseconds:"emillisecond",s:"second",seconds:"second",es:"esecond",eseconds:"esecond",m:"minute",mi:"minute",min:"minute",minutes:"minute",em:"eminute",emi:"eminute",emin:"eminute",eminutes:"eminute",h:"hour",hours:"hour",eh:"ehour",ehours:"ehour",d:"day",days:"day",ed:"eday",edays:"eday",w:"week",weeks:"week",ew:"eweek",eweeks:"eweek",M:"month",mo:"month",mon:"month",months:"month",EM:"emonth",eM:"emonth",emo:"emonth",emon:"emonth",emonths:"emonth",q:"quarter",quarters:"quarter",eq:"equarter",equarters:"equarter",y:"year",years:"year",ey:"eyear",eyears:"eyear",dec:"decade",decades:"decade",edec:"edecade",edecades:"edecade"},PR=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,OR=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,qs=["millisecond","emillisecond","second","esecond","minute","eminute","hour","ehour","day","eday","week","eweek","month","emonth","quarter","equarter","year","eyear","decade","edecade"],$R=[["ms","mil"],["ems","emil"],["s","sec"],["es","esec"],["m","min"],["em","emin"],["h","hr"],["eh","ehr"],["d"],["ed"],["w","wk"],["ew","ewk"],["mo","mon","mnt","M"],["emo","emon","emnt"],["q","quar","qrt"],["eq","equar","eqrt"],["y","yr"],["ey","eyr"],["dec"],["edec"]],Df=["decade","year","month","week","day","hour","minute","second","millisecond"],HR=["milliseconds","seconds","minutes","hours","date","month","year"],VR=i=>{const e=parseFloat(i);return isNaN(e)?null:e},NR=/^[0-9]+$/,lb=/([+-])(\d\d):*(\d\d)*$/,Ci={millisecond:{magnitude:0,smaller:void 0,greater:"second"},second:{magnitude:2,smaller:"millisecond",greater:"minute"},minute:{magnitude:4,smaller:"second",greater:"hour"},hour:{magnitude:6,smaller:"minute",greater:"day"},day:{magnitude:8,smaller:"hour",greater:"week"},week:{magnitude:10,smaller:"day",greater:"month"},month:{magnitude:12,smaller:"week",greater:"quarter"},quarter:{magnitude:14,smaller:"month",greater:"year"},year:{magnitude:16,smaller:"quarter",greater:"decade"},decade:{magnitude:18,smaller:"year"},emillisecond:{magnitude:1,smaller:void 0,greater:"esecond"},esecond:{magnitude:3,smaller:"emillisecond",greater:"eminute"},eminute:{magnitude:5,smaller:"esecond",greater:"ehour"},ehour:{magnitude:7,smaller:"eminute",greater:"eday"},eday:{magnitude:9,smaller:"ehour",greater:"eweek"},eweek:{magnitude:11,smaller:"eday",greater:"emonth"},emonth:{magnitude:12,smaller:"eweek",greater:"equarter"},equarter:{magnitude:14,smaller:"emonth",greater:"eyear"},eyear:{magnitude:16,smaller:"equarter",greater:"edecade"},edecade:{magnitude:18,smaller:"eyear"}},BR={round(i,e=1){return Math.round(i/e)*e},floor(i,e=1){return Math.floor(i/e)*e},ceil(i,e=1){return Math.ceil(i/e)*e}};yi("edecade","millisecond",3600*864e5),yi("eyear","millisecond",360*864e5),yi("equarter","millisecond",90*864e5),yi("emonth","millisecond",30*864e5),yi("eweek","millisecond",7*864e5),yi("eday","millisecond",864e5),yi("ehour","millisecond",36e5),yi("eminute","millisecond",6e4),yi("esecond","millisecond",1e3),yi("emillisecond","millisecond",1e3);var Ef=class Ct extends Nt(){static set defaultFormat(e){N._defaultFormat=e}static get defaultFormat(){return N._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static get today(){return Ct.clearTime(new Date,!1)}static get tomorrow(){return Ct.add(Ct.today,1,"day")}static get yesterday(){return Ct.add(Ct.today,-1,"day")}static buildParser(e){const t=e.split(sb),r=[];return t.length===1||LR.test(e)?[]:(t.reduce((n,s,a,l)=>{if(a!==0||s!=="")if(sb.test(s)){const o=this.localize("L{parsers}")||{},d=o[s]||nb[s];if(s==="Z"&&a<l.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const c=typeof d=="function"||typeof d=="string"?d:d.parser();if(typeof c=="string"){const u=N.buildParser(c),h=u.pop();delete h.last,r.push(...u),n=h}else n.pattern=s,n.fn=c}else n.splitter=s,r.push(n),n={};else Object.prototype.hasOwnProperty.call(n,"pattern")&&r.push(n);return n},{}),r[r.length-1].last=!0,r)}static makeKey(e){if(e.length===10)return e;e.getTime&&(e=e.getTime());const t=bf[Math.trunc(e/Cf)];if(t)return t;mu.setTime(e);const r=mu.getMonth()+1,n=mu.getDate();return bf[Math.trunc(e/Cf)]=`${mu.getFullYear()}-${r<10?"0"+r:r}-${n<10?"0"+n:n}`}static parseKey(e){const t=(e==null?void 0:e[0])==="-",r=N.parse(t?e.slice(1):e,"YYYY-MM-DD");return t&&r.setFullYear(-r.getFullYear()),r}static parse(e,t=N.defaultParseFormat,r=!1){if(e instanceof Date)return e;if(typeof e!="string"||!e)return null;const n={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(MR,_R);let s=yf[t],a=null;if(s||(s=yf[t]=N.buildParser(t)),e.includes("\u202F")&&(e=e.replace(/\s/g," ")),s.reduce((o,d)=>{var c;if(d.last)Object.assign(n,d.fn(o));else{let u;if(d.splitter==="T"&&o.indexOf("T")===-1)u=o.indexOf(" ");else{const f=o.indexOf("+");let{splitter:m}=d;!r&&Jy.test(m)&&(m=Jy),u=d.splitter!==""?o.search(typeof m=="string"?O.escapeRegExp(m):m):((c=d.pattern)==null?void 0:c.length)||-1,f>-1&&u>f&&(u=-1)}let h,g;if(u===-1||d.pattern==="SSS"&&o.match(/^\d+Z$/)){const f=o.split(/([Z\-+])/);f.length===1?(h=o,g=""):(h=f[0],g=`${f[1]}${f[2]}`)}else h=o.substring(0,u)||o,g=o.substring(u+d.splitter.length);if(d.fn){const f=d.fn(h);f?Object.assign(n,f):g=h+g}return g}},e),n.year&&!n.date&&(n.date=1),n.date>31||n.month>12)return null;const l=N.create(n,r);return l?a=l:!r&&e.length>3&&(a=new Date(e),a.getFullYear()<1900&&(a=null)),a}static create(e,t=!1){const r={...e};let n=isNaN(r.year)||t&&(isNaN(r.month)||isNaN(r.date)),s=!1;if(!n){let l=!0;HR.forEach(o=>{(!(o in r)||isNaN(r[o]))&&(r[o]=0),l=l&&r[o]===null}),n=l}if(n||(r.amPm==="am"?r.hours=r.hours%12:r.amPm==="pm"&&(r.hours=r.hours%12+12),"timeZone"in r&&(s=!0,r.minutes-=r.timeZone),t&&(r.year==null||r.month==null||r.date==null)))return null;const a=[vf(r.year,tb),vf(r.month,ib),vf(r.date,rb),r.hours,r.minutes,r.seconds,r.milliseconds];return s?new Date(Date.UTC(...a)):new Date(...a)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=N.defaultFormat){if(!e||isNaN(e))return null;if(typeof t=="function")return t(e);let r=pu[t],n="";if(!r){r=pu[t]=[];for(let s=0;s<t.length;s++){const a=t.slice(s).match(FR),l=a==null?void 0:a[0];if(l){const o=this.localize("L{formats}")||{},d=o[l]||at[l];r.push(d),s+=l.length-1}else if(t[s]==="{"){const o=t.indexOf("}",s+1);o===-1?(r.push(t.substr(s+1)),s=t.length):(r.push(t.substring(s+1,o)),s=o)}else r.push(t[s])}}return r.forEach(s=>{typeof s=="string"?n+=s:n+=s(e)}),n}static formatRange(e,t){return t.replace(RR,(r,n,s)=>Ct.format(e[n==="S"?0:1],s))}static asMilliseconds(e,t=null){return typeof e=="string"&&(t=e,e=1),N.as("millisecond",e,t)}static asMonths(e){const t=N.as("ms",N.daysInMonth(e),"day"),r=(e.valueOf()-N.startOf(e,"month").valueOf())/t;return e.getYear()*12+e.getMonth()+r}static monthsToDate(e){const t=Math.floor(e),r=e-t,n=new Date(0,t),s=N.as("ms",N.daysInMonth(n),"days");return n.setTime(n.getTime()+r*s),n}static formatDelta(e,t){let r,n,s=", ";typeof t=="boolean"?r=t:t&&(r=t.abbrev,s=t.unitSeparator||s);const a=this.getDelta(e,t),l=[],o=(t==null?void 0:t.separator)||(r?"":" ");for(n in a)l.push(`${a[n]}${o}${n}`);return(t==null?void 0:t.asString)===!1?l:l.join(s)}static getDelta(e,t){let r,n,s,a,l,o,d;typeof t=="boolean"?r=t:t&&(r=t.abbrev,a=N.normalizeUnit(t.precision),o=t.maxUnit,d=!r&&t.ignoreLocale);const c={},u=r?N.getShortNameOfUnit:N.getLocalizedNameOfUnit,h=o?Df.slice(Df.indexOf(o)):Df;for(l of h)if(n=N.as(l,e),s=a===l,n=Math[s?"round":"floor"](n),(n||s&&!c.length)&&(c[d?l:u.call(N,l,n!==1)]=n,e-=N.as("ms",n,l)),s||!e)break;return c}static as(e,t,r="ms"){return typeof t=="string"&&(t=N.parseDuration(t)),typeof t=="object"&&(r=t.unit,t=t.magnitude),e===r||!r||!e||(e=N.normalizeUnit(e),r=N.normalizeUnit(r),e===r)?t:Ci[r].magnitude>Ci[e].magnitude?t*Math.abs(pt[r][e]):t/Math.abs(pt[e][r])}static formatContainsHourInfo(e){const t=/(\\.)/g;return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(t,""))}static is24HourFormat(e){return N.format(N.getTime(13,0,0),e).includes("13")}static add(e,t,r="ms",n=!0){let s;if(typeof e=="string"?s=N.parse(e):n?s=new Date(e.getTime()):s=e,typeof t=="string"){const a=Ct.parseDuration(t);t=a.magnitude,r=a.unit}else t&&typeof t=="object"&&(r=t.unit,t=t.magnitude);if(!r||t===0)return s;switch(r=N.normalizeUnit(r),r){case"millisecond":s.setTime(s.getTime()+t);break;case"second":s.setTime(s.getTime()+t*1e3);break;case"minute":s.setTime(s.getTime()+t*6e4);break;case"hour":s.setTime(s.getTime()+t*36e5);break;case"day":t%1===0?(s.setDate(s.getDate()+t),s.getHours()===23&&e.getHours()===0&&s.setHours(s.getHours()+1)):s.setTime(s.getTime()+t*864e5);break;case"week":s.setDate(s.getDate()+t*7);break;case"month":{let a=s.getDate();a>28&&(a=Math.min(a,N.getLastDateOfMonth(N.add(N.getFirstDateOfMonth(s),t,"month")).getDate())),s.setDate(a),s.setMonth(s.getMonth()+t);break}case"quarter":N.add(s,t*3,"month",!1);break;case"year":N.add(s,t*12,"month",!1);break;case"decade":s.setFullYear(s.getFullYear()+t*10);break}return s}static diff(e,t,r="ms",n=!0){if(r=N.normalizeUnit(r),!e||!t)return 0;let s;switch(r){case"year":s=N.diff(e,t,"month")/12;break;case"quarter":s=N.diff(e,t,"month")/3;break;case"month":s=(t.getFullYear()-e.getFullYear())*12+(t.getMonth()-e.getMonth()),s===0&&n&&(s=N.diff(e,t,"day",n)/N.daysInMonth(e));break;case"week":s=N.diff(e,t,"day")/7;break;case"day":{const a=e.getTimezoneOffset()-t.getTimezoneOffset();s=(t-e+a*60*1e3)/864e5;break}case"hour":s=(t-e)/36e5;break;case"minute":s=(t-e)/6e4;break;case"second":s=(t-e)/1e3;break;case"millisecond":s=t-e;break}return n?s:Math.round(s)}static startOf(e,t="day",r=!0,n=N.weekStartDay){if(!e)return null;switch(t=N.normalizeUnit(t),r&&(e=N.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth((N.get(e,"quarter")-1)*3,1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{let a=e.getDay()-n;return a<0&&(a+=7),e.setDate(e.getDate()-a),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return e?(t&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,t){let r=N.clearTime(e);return t&&r<e&&(r=N.add(r,1,"d")),r}static isMidnight(e){return N.midnight(e).getTime()===e.getTime()}static getTimeOfDay(e,t="ms"){const r=e.getHours()*pt.hour.millisecond+e.getMinutes()*pt.minute.millisecond+e.getSeconds()*pt.second.millisecond+e.getMilliseconds();return t==="ms"?r:N.as(t,r,"ms")}static set(e,t,r){if(!t)return e;if(typeof t=="string")switch(N.normalizeUnit(t)){case"millisecond":(r!==0||e.getMilliseconds()>0)&&e.setMilliseconds(r);break;case"second":(r!==0||e.getSeconds()>0)&&e.setSeconds(r);break;case"minute":(r!==0||e.getMinutes()>0)&&e.setMinutes(r);break;case"hour":e.setHours(r);break;case"day":case"date":e.setDate(r);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(r);break;case"quarter":e.setDate(1),e.setMonth((r-1)*3);break;case"year":e.setFullYear(r);break}else Object.entries(t).sort((n,s)=>{const a=n[0],l=s[0],o=Ci[a==="date"?"day":a],d=Ci[l==="date"?"day":l];return o.magnitude-d.magnitude}).forEach(([n,s])=>{N.set(e,n,s)});return e}static setDateToMidday(e,t=!0){return N.set(N.clearTime(e,t),"hour",12)}static constrain(e,t,r){return t!=null&&(e=N.max(e,t)),r==null?e:N.min(e,r)}static getTime(e,t=0,r=0,n=0){return e instanceof Date&&(n=e.getMilliseconds(),r=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(tb,ib,rb,e,t,r,n)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static combineDateAndTime(e,t){return Ct.copyTimeValues(new Date(e),t)}static get isDSTEnabled(){const e=new Date().getFullYear(),t=new Date(e,0,1),r=new Date(e,6,1);return t.getTimezoneOffset()!==r.getTimezoneOffset()}static isDST(e){const t=e.getFullYear(),r=new Date(t,0,1),n=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(r.getTimezoneOffset(),n.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,r=null){return r===null?e&&t&&e.getTime()===t.getTime():N.startOf(e,r)-N.startOf(t,r)===0}static compare(e,t,r=null){return r&&(e=N.startOf(e,r),t=N.startOf(t,r)),e<t?-1:e>t?1:0}static clamp(e,t,r){if(!isNaN(e))return t!=null&&(e=Math.max(e,t)),r!=null&&(e=Math.min(e,r)),new Date(e)}static isSameDate(e,t){return N.compare(e,t,"d")===0}static isSameTime(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()&&e.getMilliseconds()===t.getMilliseconds()}static isStartOf(e,t){return N.isEqual(e,N.startOf(e,t))}static betweenLesser(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<r.getTime()}static betweenLesserEqual(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<=r.getTime()}static intersectSpans(e,t,r,n){return N.betweenLesser(e,r,n)||N.betweenLesser(r,e,t)}static compareUnits(e,t){const r=Ci[N.normalizeUnit(e)],n=Ci[N.normalizeUnit(t)];return Math.sign(((r==null?void 0:r.magnitude)||0)-((n==null?void 0:n.magnitude)||0))}static timeSpanContains(e,t,r,n){return r-e>=0&&t-n>=0}static get amIndicator(){return vu}static get pmIndicator(){return yu}static get weekStartDay(){return N._weekStartDay==null&&(N._weekStartDay=this.localize("L{weekStartDay}")||0),N._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,t){switch(N.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return at.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const t=e.getFullYear(),r=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",r)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const t=e.getFullYear(),r=e.getMonth(),n=e.getDate(),s=new Date(t,r,n+1)-new Date(t,r,n);return this.as("hour",s)}static getNormalizedUnitDuration(e,t){let r;switch(t){case"month":r=N.asMilliseconds(N.daysInMonth(e),"day");break;case"year":r=N.asMilliseconds(N.daysInYear(e),"day");break;case"day":r=N.asMilliseconds(N.hoursInDay(e),"hour");break;default:r=N.asMilliseconds(t)}return r}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,r=1,n=N.weekStartDay){if(t==="week"){const s=N.clone(e),a=s.getDay();return N.startOf(s,"day",!1),N.add(s,n-a+7*(r-(n<=a?0:1)),"day",!1),s.getDay()!==n&&N.add(s,1,"hour"),s}return N.startOf(N.add(e,r,t),t,!1)}static isValidDate(e){return N.isDate(e)&&!isNaN(e)}static isDate(e){return e&&qy.call(e)===xR}static getStartOfNextDay(e,t=!1,r=!1){let n=N.add(r?e:N.clearTime(e,t),1,"day");if(n.getDate()===e.getDate()){const s=N.add(N.clearTime(e,t),2,"day").getTimezoneOffset(),a=e.getTimezoneOffset();n=N.add(n,a-s,"minute")}return n}static getEndOfPreviousDay(e,t=!1){const r=t?e:N.clearTime(e,!0);return r-e?r:N.add(r,-1,"day")}static getWeekDescription(e,t=e){const r=e.getMonth()===t.getMonth()?Ct.format(e,"MMMM"):`${Ct.format(e,"MMM")} - ${Ct.format(t,"MMM")}`,n=Ct.getWeekNumber(e);return`${n[1]}, ${r} ${n[0]}`}static getWeekNumber(e,t=Ct.weekStartDay){const r=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31),s=Zy(r.getDay()-t),a=Zy(n.getDay()-t),l=TR(e,r);let o;if(s<4?o=Math.floor((l+s-1)/7)+1:o=Math.floor((l+s-1)/7),o){let c=e.getFullYear();return o===53&&a<3&&(c++,o=1),[c,o]}const d=Ct.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,d]}static getDateFromISOWeek(e,t,r=1){const n=new Date(e,0,1+(t-1)*7),s=n.getDay(),a=s===0?7:s,l=r-a;return n.setDate(n.getDate()+l),n}static formatCount(e,t){return t=N.normalizeUnit(t),e!==1&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,r=!1){return e=N.normalizeUnit(e),t=N.normalizeUnit(t),e===t?1:pt[e]&&pt[e][t]&&(r||pt[e][t]>0)?1/N.as(t,1,e):pt[t]&&pt[t][e]&&(r||pt[t][e]>0)?N.as(e,1,t):-1}static getShortNameOfUnit(e){return e=N.parseTimeUnit(e),N.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const r=e.charAt(0)===e.charAt(0).toUpperCase();return e=N.normalizeUnit(e),e=N.parseTimeUnit(e),e=N.unitLookup[e][t?"plural":"single"],r&&(e=O.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return t==="date"||qs.includes(t)?t:ab[e]||ab[t]}static getUnitByName(e){return N.normalizeUnit(e)||N.normalizeUnit(N.parseTimeUnit(e))}static getDurationInUnit(e,t,r,n){return N.diff(e,t,r,n)}static doesUnitsAlign(e,t){return!(e!==t&&t==="week")}static getSmallerUnit(e){var t,r;e=N.normalizeUnit(e);const n=(t=Ci[e])==null?void 0:t.smaller;return qs[(r=Ci[n])==null?void 0:r.magnitude]||null}static getLargerUnit(e){var t,r;e=N.normalizeUnit(e);const n=(t=Ci[e])==null?void 0:t.greater;return qs[(r=Ci[n])==null?void 0:r.magnitude]||null}static round(e,t,r,n){return N.snap("round",e,t,r,n)}static floor(e,t,r,n){return N.snap("floor",e,t,r,n)}static ceil(e,t,r,n){return N.snap("ceil",e,t,r,n)}static snap(e,t,r,n,s=N.weekStartDay){const a=BR[e];if(typeof r=="string"&&(r=N.parseDuration(r)),Z.isObject(r)){const o=r.magnitude||r.increment;switch(r.unit){case"week":{if(!n){const d=t.getDay();n=N.add(N.clearTime(t),d>=s?s-d:-(d-s+7),"day")}return N[e](t,`${o*7} days`,n)}case"month":{t=N.asMonths(t);let d;return n?(n=N.asMonths(n),d=n+a(t-n,o)):d=a(t,o),N.monthsToDate(d)}case"quarter":return N[e](t,`${o*3} months`,n);case"year":return N[e](t,`${o*12} months`,n);case"decade":return N[e](t,`${o*10} years`,n)}r=N.as("ms",o,r.unit)}const l=t.getTimezoneOffset()*1e3*60;if(n){const o=n.getTimezoneOffset()*1e3*60,d=t-n+o-l,c=new Date(n.getTime()+a(d,r)),u=o-c.getTimezoneOffset()*1e3*60;return u&&N.add(c,-u,"ms",!1),new Date(c)}else return new Date(a(t.valueOf()-l,r)+l)}static parseDuration(e,t=!0,r){var n;const s=t?PR:OR,a=s.exec(e);if(e==null||!a)return null;const l=VR((n=a[1])==null?void 0:n.replace(",",".")),o=N.parseTimeUnit(a[2])||r;return o?{magnitude:l,unit:o}:null}static parseTimeUnit(e){const t=e==null?null:N.durationRegEx.exec(e)||N.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let r=0;r<qs.length;r++)if(t[r+1])return qs[r]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=N._dayNames||[],r=N._dayShortNames||[];t.length=0,r.length=0;for(let n=2;n<9;n++)e.setDate(n),t.push(N.format(e,"dddd")),r.push(N.format(e,"ddd"));N._dayNames=t,N._dayShortNames=r}static getDayNames(){return N._dayNames}static getDayName(e){return N._dayNames[e]}static getDayShortNames(){return N._dayShortNames}static getDayShortName(e){return N._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=N._monthNames||[],r=N._monthShortNames||[],n={},s={};t.length=0,r.length=0;for(let a=0;a<12;a++){e.setMonth(a);const l=N.format(e,"MMMM");t.push(l);const o=N.format(e,"MMM");r.push(o),n[l.toLowerCase()]={name:l,value:a},s[o.toLowerCase()]={name:o,value:a}}N._monthNames=t,N._monthShortNames=r,N._monthNamesIndex=n,N._monthShortNamesIndex=s}static getMonthShortNames(){return N._monthShortNames}static getMonthShortName(e){return N._monthShortNames[e]}static getMonthNames(){return N._monthNames}static getMonthName(e){return N._monthNames[e]}static set locale(e){Wi=e,bi={},pu={},Io={}}static get locale(){return Wi}static setupDurationRegEx(e=[],t=[]){const r=this,n={};let s="";for(let a=0;a<t.length;a++){const l=t[a],o=e[a];o.canonicalUnitName=qs[a],n[o.single]=n[o.single.toUpperCase()]=n[o.canonicalUnitName]=n[o.canonicalUnitName.toUpperCase()]=o,s+=`${a?"|":""}(`;for(let d=0;d<l.length;d++)s+=`${l[d]}|`;if(Wi=r.localize("L{locale}")||"en-US",Wi!=="en-US"){const d=$R[a];for(let c=0;c<d.length;c++)s+=`${d[c]}|`}s+=`${o.single}|${o.plural}|${o.canonicalUnitName}|${o.canonicalUnitName}s)`}r.unitLookup=n,r.durationRegEx=new RegExp(`^(?:${s})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],r=e.unitNames=e.localize("L{unitNames}"),n=new Date(2020,6,15,6),s=Math.abs(n.getTimezoneOffset()%60);if(r==="unitNames")return;Wi=e.localize("L{locale}")||"en-US";const a=bi.a||(bi.a=new Intl.DateTimeFormat(Wi,{hour:"numeric",hourCycle:"h12"}));vu=a.formatToParts(n)[2].value,yu=a.formatToParts(new Date(2020,6,15,18))[2].value,Wi==="en-US"?ji=Xy:ji=e.localize("L{ordinalSuffix}")||ji,pu={},Io={},yf={},bi={},bf={},Cf=(!s||s>30?60-s:s)*6e4,N._weekStartDay=null,N.setupDurationRegEx(r,t),N.fillDayNames(),N.fillMonthNames()}};y(Ef,"MS_PER_DAY",Ky*24),y(Ef,"$name","DateHelper");var C=Ef;_e.register(C);var N=C;N.useIntlFormat=ot,Le.ion({locale:"applyLocale",prio:1e3,thisObj:N}),Le.locale&&N.applyLocale();var zR=class CE extends Set{get isDateSet(){return!0}add(e){return e=C.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=C.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(C.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new CE(e)),e.size===this.size&&[...this].every(t=>e.has(t))}get dates(){return[...this].sort().map(e=>C.parseKey(e))}};C.DateSet=zR,C._$name="DateHelper";var{defineProperty:xf}=Reflect,bu;Y.isBrowserEnv?bu=globalThis.performance:bu={now(){return new Date().getTime()}};var Ce=null;if(re.isTestEnv){const i=globalThis.bryntum||(globalThis.bryntum={});Ce=i.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty(e=!1){return Ce.timeouts.size+Ce.animationFrames.size+Ce.idleCallbacks.size+(e?Ce.intervals.size:0)===0},getFiltered({ignoreTimeouts:e=[],maxDelay:t=5e3,includeIntervals:r=!1}){const n=[],s=["timeouts","animationFrames","idleCallbacks"];r&&s.push("intervals");for(const a of s){const l=Ce[a];for(const[,o]of l.entries())!e.includes(o.name)&&(!Number.isInteger(o.delay)||o.delay<t)&&n.push(o)}return n}}}var WR=Promise.resolve(),ob=Object.freeze([]),jR=()=>{},UR=Object.freeze({}),db=globalThis.queueMicrotask,Ks=(i,e,t,r)=>{const n=typeof e=="string",s=(r==null?void 0:r.appendArgs)||ob,a=()=>{t.timerId=null,t.lastCallTime=bu.now();const l=t.args;t.args=null,n?i[e](...l,...s):e.call(i,...l,...s),t.called=!0,++t.calls};return i=(r==null?void 0:r.thisObj)||i,t.lastCallTime=-9e9,t.calls=0,t.suspended=r==null?void 0:r.suspended,t.invoker=a,a.wrapFn=t,a.fn=e,a.this=i,a},Ao=(i,e,t="clearTimeout")=>(e.cancel=()=>{e.isPending&&(i[t](e.timerId),e.args=e.timerId=null)},e.flush=()=>{e.isPending&&(i[t](e.timerId),e.timerId=null,e.invoker())},e.now=(...r)=>{e.cancel(),e.args=r,e.invoker()},e.resume=r=>{const n=e.suspended;e.suspended=r||n<1?0:n-1},e.suspend=()=>{++e.suspended},e.immediate=!1,e.suspended=e.suspended?1:0,e.timerId=null,xf(e,"isPending",{get(){return e.timerId!==null}}),e),fe=i=>{var e;return e=class extends(i||$){static get declarable(){return["delayable"]}doDestroy(){super.doDestroy(),this.clearDelayables()}clearDelayables(){const t=this,[r,n,s,a,l,o]=[t.idleCallbackIds,t.animationFrameIds,t.intervalIds,t.timeoutMap,t.timeoutIds,t.microtasksPending];t.idleCallbackIds=t.animationFrameIds=t.intervalIds=t.timeoutMap=t.timeoutIds=t.microtasksPending=null,l==null||l.forEach((d,c)=>{typeof d=="function"&&d(),clearTimeout(c),Ce==null||Ce.timeouts.delete(c)}),a==null||a.forEach((d,c)=>clearTimeout(c)),s==null||s.forEach(d=>{clearInterval(d),Ce==null||Ce.intervals.delete(d)}),n==null||n.forEach(d=>{cancelAnimationFrame(d),Ce==null||Ce.animationFrames.delete(d)}),r==null||r.forEach(d=>{cancelIdleCallback(d),Ce==null||Ce.idleCallbacks.delete(d)}),o==null||o.forEach(d=>d.cancel())}hasTimeout(t){var r;return!!((r=this.timeoutMap)!=null&&r.has(t))}asap(t,r){const n=this,s=(...l)=>{s.suspended||(s.called=!1,s.args=l,s.immediate?a():s.isPending||(s.timerId=n.queueMicrotask(a)))},a=Ks(n,t,s,r);return Ao(n,s,"cancelMicrotask")}queueMicrotask(t,r,n){let s,a;!n&&r&&!Array.isArray(r)&&(n=r,r=null),n=n||UR,r=r||n.args||ob;const l=this,o=typeof t=="string",d=o?t:t.name,c=l.microtasksPending||(l.microtasksPending=new Map),u=()=>c.delete(s),h=()=>{a===c.get(s)&&(c.delete(s),o?!l.isDestroyed&&l[t](...r):t.apply(l,r))};return l.isDestroying&&!n.runOnDestroy?jR:(s=n.cancelOutstanding?d||t:u,a={key:s,name:d,fn:t,args:r,options:n,cancel:u,wrapFn:h},u.taskDef=a,db?db(h):WR.then(h),c.set(s,a),u)}cancelMicrotask(t){t==null||t()}setTimeout({fn:t,delay:r,name:n,runOnDestroy:s,cancelOutstanding:a,args:l}){(arguments.length>1||typeof arguments[0]=="function")&&([t,r,n,s,a]=arguments),typeof t=="string"?n=t:n||(n=t.name||t),a&&this.clearTimeout(n);const o=this,d=o.timeoutIds||(o.timeoutIds=new Map),c=o.timeoutMap||(o.timeoutMap=new Map),u=setTimeout(()=>{typeof t=="string"&&(t=o[n]),d==null||d.delete(u),c==null||c.delete(n),Ce==null||Ce.timeouts.delete(u),t.apply(o,l)},r);return d.set(u,s?t:!0),Ce==null||Ce.timeouts.set(u,{fn:t,delay:r,name:n}),n&&c.set(n,u),u}clearTimeout(t){var r;let n=t;if(typeof n=="string")if(this.timeoutMap)n=this.timeoutMap.get(t),this.timeoutMap.delete(t);else return;clearTimeout(n),(r=this.timeoutIds)==null||r.delete(n),Ce==null||Ce.timeouts.delete(n)}clearInterval(t){var r;clearInterval(t),(r=this.intervalIds)==null||r.delete(t),Ce==null||Ce.intervals.delete(t)}setInterval(t,r,n){const s=setInterval(t,r);return(this.intervalIds||(this.intervalIds=new Set)).add(s),Ce==null||Ce.intervals.set(s,{fn:t,delay:r,name:n}),s}requestAnimationFrame(t,r=[],n=this){const s=this.animationFrameIds||(this.animationFrameIds=new Set),a=requestAnimationFrame(()=>{Ce==null||Ce.animationFrames.delete(a),s.delete(a)&&t.apply(n,r)});return s.add(a),Ce==null||Ce.animationFrames.set(a,{fn:t,extraArgs:r,thisObj:n}),a}requestIdleCallback(t,r=[],n=this){const s=this.idleCallbackIds||(this.idleCallbackIds=new Set),a=requestIdleCallback(()=>{Ce==null||Ce.idleCallbacks.delete(a),s.delete(a)&&t.apply(n,r)});return s.add(a),Ce==null||Ce.idleCallbacks.set(a,{fn:t,extraArgs:r,thisObj:n}),a}createOnFrame(t,r=[],n=this,s){let a;const l=(...o)=>{a!=null&&s&&(this.cancelAnimationFrame(a),a=null),a==null&&(a=this.requestAnimationFrame(()=>{typeof t=="string"&&(t=n[t]),a=null,o.push(...r),t.apply(n,o)}))};return l.cancel=()=>this.cancelAnimationFrame(a),l}cancelAnimationFrame(t){var r;cancelAnimationFrame(t),(r=this.animationFrameIds)==null||r.delete(t),Ce==null||Ce.animationFrames.delete(t)}cancelIdleCallback(t){var r;cancelIdleCallback(t),(r=this.idleCallbackIds)==null||r.delete(t),Ce==null||Ce.idleCallbacks.delete(t)}async nextAnimationFrame(){return new Promise(t=>this.requestAnimationFrame(t))}buffer(t,r){let n=r;r&&typeof r!="number"?n=r.delay:r=null;const s=(...l)=>{if(s.suspended)return;const{delay:o}=s;s.cancel(),s.called=!1,s.args=l,s.immediate||!o?a():s.timerId=this.setTimeout(a,o)},a=Ks(this,t,s,r);return s.delay=n,Ao(this,s)}raf(t,r){let n=r;r&&typeof r!="boolean"?n=r.cancelOutstanding:r=null;const s=(...l)=>{s.suspended||((s.cancelOutstanding||s.immediate)&&s.cancel(),s.called=!1,s.args=l,s.immediate?a():s.isPending||(s.timerId=this.requestAnimationFrame(a)))},a=Ks(this,t,s,r);return s.cancelOutstanding=n,s.raf=!0,Ao(this,s,"cancelAnimationFrame")}idle(t,r){let n=r;r&&typeof r!="boolean"?n=r.cancelOutstanding:r=null;const s=(...l)=>{s.suspended||((s.cancelOutstanding||s.immediate)&&s.cancel(),s.called=!1,s.args=l,s.immediate?a():s.isPending||(s.timerId=this.requestIdleCallback(a)))},a=Ks(this,t,s,r);return s.cancelOutstanding=n,this.setTimeout(()=>this.idleCallbackIds.delete(s.timerId)&&s.now(),100),Ao(this,s,"cancelIdleCallback")}throttle(t,r){let n=r,s;r&&typeof r!="number"?(n=r.delay,s=r.throttled):r=null;const a=this,l=(...d)=>{if(l.suspended)return;const{delay:c}=l,u=bu.now()-l.lastCallTime;l.args=d,l.immediate||u>=c?(a.clearTimeout(l.timerId),o()):(l.isPending||(l.timerId=a.setTimeout(o,c-u),l.called=!1),s&&(s.wrapFn.args=d,s()))},o=Ks(a,t,l,r);return l.delay=n,s&&(s=Ks(a,s,()=>{},r)),Ao(a,l)}static setupDelayable(t){t.setupDelayableMethods(t.delayable)}static setupDelayableMethods(t,r=null){const n=this,s=t.static,a=r||n.prototype;s&&delete t.static;for(const l in t){let o=t[l];const d=l+"Now",c=typeof o;a[d]||(a[d]=a[l]),c==="number"?o={type:"buffer",delay:o}:c==="string"&&(o={type:o}),xf(a,l,{get(){const u=this,h=(...f)=>u[d](...f),g=u[o.type](h,o);return xf(u,l,{value:g,configurable:!0,writable:!0}),h.methodName=l,g}})}}get widgetClass(){}},y(e,"$name","Delayable"),e},Xs=class{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(i){return null}removeItem(i){}setItem(i,e){}};Xs._$name="StateStorage";var GR=class extends Xs{constructor(i){super(),this.prefix=i.prefix||""}get isLocal(){return!0}get data(){const i=cb(),e=this.keys;for(const t of e)i[t]=this.getItem(t);return i}get keys(){return ub(this.prefix,this.prefix.length)}clear(){const i=ub(this.prefix);for(const e of i)localStorage.removeItem(e)}getItem(i){const e=localStorage.getItem(this.prefix+i);return e===null?e:JSON.parse(e)}removeItem(i){return localStorage.removeItem(this.prefix+i)}setItem(i,e){return localStorage.setItem(this.prefix+i,JSON.stringify(e))}},YR=class extends Xs{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return T.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=cb()}getItem(i){return i in this._data?this._data[i]:null}removeItem(i){delete this._data[i]}setItem(i,e){this._data[i]=e}},cb=()=>Object.create(null),ub=(i,e=0)=>{const t=[],r=localStorage.length;for(let n,s=0;s<r;++s)n=localStorage.key(s),n.startsWith(i)&&t.push(n.slice(e));return t},hb=new Xs,Rf={local:GR,memory:YR},gb=class wE extends $.mixin(fe,Fe){static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){e==null?e=fb:((typeof e=="string"||T.isClass(e)||e instanceof Xs)&&(e={storage:e}),T.isObject(e)&&(e=new wE(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(!e)this.clear();else for(const t in e)this.setValue(t,e[t])}clear(){return this.storage.clear(),this}changeStorage(e){if(e==null)e=hb;else{if(typeof e=="string"){if(!Rf[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(Rf).join('", "')}")`);e=Rf[e]}T.isClass(e)&&(e=new e(this))}return e}saveStateful(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:t}=e,r=t==null?void 0:t.length,n=[],s=[];if(e.pendingSaves=null,r){for(let a,l,o,d=0;d<r;++d)[l,a]=t[d],!l.isDestroying&&l.isSaveStatePending&&(o=l.saveState({...a,immediate:!0}),o&&(n.push(o),s.push(l)));n.length&&e.trigger("save",{stateIds:n,saved:s})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,t){const r=this,{storage:n}=r,s=r.getValue(e);return t!=null?(n.setItem(e,t),r.trigger("set",{key:e,value:t,was:s})):s!==null&&(n.removeItem(e),r.trigger("remove",{key:e,was:s})),r}};y(gb,"$name","StateProvider");var Lo=gb,fb=new Lo({storage:hb});Lo._instance=fb,Lo._$name="StateProvider";var qR=/boolean|number|string/,Po=i=>{var e;return e=class extends(i||$).mixin(Fe){afterConstruct(){super.afterConstruct(),this.stateProvider&&this.loadState()}finalizeInit(){this.stateProvider&&this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(t){this._state=t,t&&this.trigger("beforeStateApply",{state:t})!==!1&&this.applyState(t)}updateStatefulEvents(t){var r;const n=this,s={name:"statefulEvents",thisObj:n};if(n.detachListeners(s.name),t&&(typeof t=="string"?t=O.split(t):Array.isArray(t)||(t=T.getTruthyKeys(t)),t.length)){for(const a of t)s[a]="onStatefulEvent";(r=n.ion)==null||r.call(n,s)}}get statefulId(){const t=this,{responsiveState:r}=t;let n=t.stateId;return n==null&&t.hasGeneratedId===!1&&t.stateful!==!1&&(n=t.id),n&&r&&(n=`${n}[${r}]`),n}get statefulness(){const{stateful:t}=this;return Array.isArray(t)?T.createTruthyKeys(t):t}get stateProvider(){var t;return(t=this._stateProvider)!=null?t:this._stateId&&Lo.instance}applyState(t){t=this.pruneState(t),t&&this.setConfig(t)}getState(){const t=this,{initialConfig:r,statefulness:n,isConstructing:s}=t,{configs:a}=t.$meta,l=s?Object.assign(Object.create(t.$meta.config),r):t;let o=null,d,c;if(n){o={};for(d in n)if(n[d]){if(c=l[d],c!=null&&c.isStateful)c=c.state;else if(!s&&(T.isDate(c)&&(c=C.format(c,"YYYY-MM-DDTHH:mm:ssZ")),a[d].equal(c,r==null?void 0:r[d])||!qR.test(typeof c)))continue;o[d]=c}}return o}loadState(t,r){typeof t=="boolean"&&(r=t,t=null);const n=this,{statefulLoaded:s}=n;if(n.isStatefulActive&&(r||!s)){const a=n.loadStatefulData(t||(t=n.statefulId));!s&&t&&(n.defaultState=n.state,n.statefulLoaded=!0),a&&(n.state=a)}}loadStatefulData(t){var r;return t=this.isStatefulActive?t||this.statefulId:null,t&&((r=this.stateProvider)==null?void 0:r.getValue(t))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(t=!1){this.statefulSuspended=t?0:Math.max(this.statefulSuspended-1,0)}saveState(t){typeof t=="string"?t={id:t}:t=t||{};const r=this,{stateProvider:n}=r,s=t.id||r.isStatefulActive&&r.statefulId;if(s&&n){if(t.immediate){r.isSaveStatePending=!1;const{state:a}=r;r.trigger("beforeStateSave",{state:a})!==!1&&n.setValue(s,a)}else r.isSaveStatePending||(r.isSaveStatePending=!0,n.saveStateful(r,t));return s}}suspendStateful(){++this.statefulSuspended}onConfigChange({name:t,value:r,was:n,config:s}){if(super.onConfigChange({name:t,value:r,was:n,config:s}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:a}=this;(Array.isArray(a)?a.includes(t):a!=null&&a[t])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(t){const{statefulness:r}=this;if(r){const n={};for(const s in t)r[s]&&(n[s]=t[s]);t=n}return t}get widgetClass(){}},y(e,"$name","State"),y(e,"configurable",{stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),y(e,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),e},mb=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),KR={string:1,number:1},Oo=i=>{var e;return e=class extends(i||$){static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(t,r){const{identifiable:n}=t;n.idMap=Object.create(null),Reflect.defineProperty(t,"identifiable",{get(){return n}})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(t){return(this.hasGeneratedId=!t)?this.generateAutoId():t}updateId(t,r){const n=this,s=n.constructor;r&&s.unregisterInstance(n,r),(!n.hasGeneratedId||s.identifiable.registerGeneratedId!==!1)&&s.registerInstance(n,t)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(t="generatedId"){return t+(mb[t]=(mb[t]||0)+1)}static registerInstance(t,r=t.id){const{idMap:n}=this.identifiable;if(r in n&&!this.disableThrow)throw new Error("Id "+r+" already in use");n[r]=t}static unregisterInstance(t,r=t.id){const{idMap:n}=this.identifiable;KR[typeof t]?delete n[t]:n[r]===t&&delete n[r]}static getById(t){const r=this.identifiable.idMap;if(r)return r[t]}static get registeredInstances(){const t=this.identifiable.idMap;return t?Object.values(t):[]}},y(e,"$name","Identifiable"),e},pb=Symbol("STM_PROP"),vb={parentIndex:1,orderedParentIndex:1},yb=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{stm:null}}joinStore(t){this.stm||(this.stm=t.stm)}unjoinStore(t,r=!1){var n;this.stm===t.stm&&(this.stm=null),(n=super.unjoinStore)==null||n.call(this,t,r)}get stm(){return this[pb]}set stm(t){this[pb]=t}beforeChronoFieldSet(t,r){var n;const s=this;return!s.inSetting&&((n=s.stm)!=null&&n.enabled)&&!vb[t]&&!s.constructor.nonPersistableFields[t]&&s.getFieldDefinition(t)?{[t]:{value:r,oldValue:s.graph.activeTransaction.readCurrentOrProposedOrPrevious(s.$[t])}}:null}afterChronoFieldSet(t,r,n){n&&this.afterSet(t,r,!1,!1,n,!0)}shouldRecordFieldChange(t,r,n){const s=this.firstStore;return!(this.constructor.nonPersistableFields[t]||r==null&&n==null||r===n||r instanceof Date&&n instanceof Date&&r.getTime()===n.getTime()||t==="id"||t==="$PhantomId"||t==="parentId"&&s&&s.oldIdMap[r]===s.getById(n))}afterSet(t,r,n,s,a,l){const{stm:o}=this,d=this.constructor.nonPersistableFields;if(o!=null&&o.isBase&&o.shouldRecordAction&&!vb[t]&&!d[t]&&a){let c;const[u,h]=Object.keys(a).reduce((g,f)=>{const{value:m,oldValue:p}=a[f];return this.shouldRecordFieldChange(f,p,m)&&(c=!0,g[0][f]=m,g[1][f]=p),g},[{},{}]);c&&o.onModelUpdate(this,u,h,l)}}beforeInsertChild(t){var r;const n=((r=super.beforeInsertChild)==null?void 0:r.call(this,t))||[],{stm:s}=this;return s!=null&&s.enabled&&n.push(t.reduce((a,l)=>(l.root===this.root&&a.set(l,{parent:l.parent,index:l.parent?l.parentIndex:void 0}),a),new Map)),n}afterInsertChild(t,r,n,s,a){var l;const{stm:o}=this;if(o!=null&&o.shouldRecordAction){const d=n.pop();s&&o.onModelInsertChild(this,t,s,d,a)}(l=super.afterInsertChild)==null||l.call(this,t,r,n,s)}beforeRemoveChild(t,r){const n=super.beforeRemoveChild?super.beforeRemoveChild(t,r):[],{stm:s}=this;return s!=null&&s.shouldRecordAction&&!r&&n.push(t.reduce((a,l)=>(a.set(l,{parentIndex:l.parentIndex,orderedParentIndex:l.orderedParentIndex}),a),new Map)),n}afterRemoveChild(t,r,n){var s;const{stm:a}=this;if(a!=null&&a.shouldRecordAction&&!n){const l=r.pop();t&&t.length&&a.onModelRemoveChild(this,t,l)}(s=super.afterRemoveChild)==null||s.call(this,t,r,n)}},y(e,"$name","ModelStm"),e},XR={includeFilteredOutRecords:!1},Tf=i=>(i=i||!1,typeof i=="boolean"&&(i={includeFilteredOutRecords:i}),i||XR),bb=i=>{var e;return e=class extends(i||$){static set convertEmptyParentToLeaf(t){t===!0?t={onLoad:!0,onRemove:!0}:t===!1&&(t={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=t}constructor(...t){super(...t),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(t,r=this.stores){var n,s,a;const{inProcessChildren:l,constructor:o}=this,d=r==null?void 0:r[0];if(t===!0)return l?!0:[];if(t){let c=B.asArray(t);if(!c.length)return[];const u=c.length,h=[];c=(n=d==null?void 0:d.cloneImmutable(c))!=null?n:c;for(let g=0,f;g<u;g++)f=c[g],f=f.isModel?f:(s=d==null?void 0:d.createRecord(f,!1,!0))!=null?s:new o(f,null,null,!0),f=(a=d==null?void 0:d.processRecord(f))!=null?a:f,h.push(f);if(this.children===!0&&d){const g=d.createSorterFn(d.sorters);h.sort(g)}return h}}processChildren(t=this.stores){const r=this,{meta:n}=r;r.inProcessChildren=!0;const s=r.ingestChildren(r.data[r.constructor.childrenField],t);if(s){const{convertEmptyParentToLeaf:a}=r.constructor;if(a===!0||a.onLoad?s.length:Array.isArray(s)){if(n.isLeaf=!1,r.children===!0)r.children=[];else if(s.length===0){r.children=s;return}r.insertChild(s)}else s===!0?(n.isLeaf=!1,r.children=!0):r.remoteChildCount>0?n.isLeaf=!1:r.isRoot||(n.isLeaf=r.constructor.convertEmptyParentToLeaf.onLoad)}r.inProcessChildren=!1}ancestorsExpanded(t=this.firstStore){const{parent:r}=this;return t!=null&&t.isTree?!r||r.isExpanded(t)&&r.ancestorsExpanded(t):!0}isExpanded(t=this.firstStore){const r=this.instanceMeta(t.id);return Object.prototype.hasOwnProperty.call(r,"collapsed")||(r.collapsed=!this.expanded),!r.collapsed}get expanded(){return this.data.expanded}get childLevel(){let t=this,r=-1;for(;t&&!t.isRoot;)++r,t=t.parent;return r}get isLeaf(){return this.meta.isLeaf!==!1&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get hierarchyModificationDataToWrite(){const{parentIdField:t}=this.constructor,r=[t,"parentIndex","orderedParentIndex"].reduce((n,s)=>{var a;if(s in this.meta.modified){const l=this.constructor.getFieldDefinition(s);s===t?n[(a=l==null?void 0:l.dataSource)!=null?a:t]=this.getFieldPersistentValue(s):l.persist&&(n[l.dataSource]=this.getFieldPersistentValue(s))}return n},{});return Object.keys(r).length>0?r:null}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(t=!1,r=this.firstStore,n=!1){let{children:s}=this;return n&&this.unfilteredChildren&&(s=this.unfilteredChildren),!s||!Array.isArray(s)||t&&!this.isExpanded(r)?0:s.reduce((a,l)=>a+l.getDescendantCount(t,r,n),s.length)}get allChildren(){return this.getAllChildren(!1)}get allUnfilteredChildren(){return this.getAllChildren(!0)}getAllChildren(t=!1){const r=t?this.unfilteredChildren||this.children:this.children;return!r||r===!0?[]:r.reduce((n,s)=>(n.push(s),n.push.apply(n,t?s.allUnfilteredChildren:s.allChildren),n),[])}get firstChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[0]||null}get lastChild(){const{children:t}=this;return(t==null?void 0:t.length)&&t[t.length-1]||null}get previousSiblingsTotalCount(){let t=this.previousSibling,r=this.parentIndex;for(;t;)r+=t.descendantCount,t=t.previousSibling;return r}get previousOrderedSibling(){var t,r;return(r=(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex-1])!=null?r:null}get nextOrderedSibling(){var t,r;return(r=(t=this.parent)==null?void 0:t.orderedChildren[this.orderedParentIndex+1])!=null?r:null}get root(){var t;return((t=this.parent)==null?void 0:t.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(t){this.setParentId(t)}setParentId(t){const r=this,{firstStore:n}=r;if(n){const{parent:s}=r,a=t===null?n.rootNode:n.getById(t);a===s||!s&&!a||(r.isBatchUpdating?r.meta.batchChanges.parentId=t:a?a.appendChild(r):s.removeChild(r))}else r.setData(r.constructor.parentIdField,t)}static set parentIdField(t){this._parentIdField=t,Object.defineProperty(this.prototype,t,{set:function(r){this.parentId=r},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(t){let r;return t.includeFilteredOutRecords?r=this.unfilteredChildren||this.children:t.useOrderedTree?r=this.orderedChildren:r=this.children,r}traverse(t,r,n){n=Tf(n);const s=this,a=s.getChildren(n);r||t.call(s,s);for(let l=0,o=a==null?void 0:a.length;l<o;l++)a[l].traverse(t,!1,n)}traverseBefore(t,r,n){n=Tf(n);const s=this,a=s.getChildren(n);for(let l=0,o=a==null?void 0:a.length;l<o;l++)a[l].traverse(t,!1,n);r||t.call(s,s)}traverseWhile(t,r,n){n=Tf(n);const s=this;let a=r||t.call(s,s)!==!1;if(a){const l=s.getChildren(n);l!=null&&l.length&&(a=l.every(o=>o.traverseWhile(t,!1,n)))}return a}bubble(t,r=!1){let n=this;for(r||t.call(n,n);n.parent;)n=n.parent,t.call(n,n)}bubbleWhile(t,r=!1){let n=this,s=!0;for(r||(s=t.call(n,n));s&&n.parent;)n=n.parent,s=t.call(n,n);return s}contains(t,r=!1,n=void 0){return t&&typeof t=="object"&&(t=t.id),!this.traverseWhile(s=>s.id!=t,r,n)}getTopParent(t){let r;return t?(r=[],this.bubbleWhile(n=>(r.push(n),n.parent&&!n.parent.isRoot))):(r=null,this.bubbleWhile(n=>(r=n,n.parent&&!n.parent.isRoot))),r}appendChild(t,r=!1,n={}){return this.insertChild(t,null,r,n)}insertChild(t,r=null,n=!1,s={}){var a,l,o,d,c,u,h,g;const f=this,m=Array.isArray(t);if(typeof r=="number"&&(r=(l=(a=f.children)==null?void 0:a[r])!=null?l:null),f.isLinked&&!f.meta.isFillingFromMaster)return f.$original.insertChild(t,r==null?void 0:r.$original,n,s);if(t=B.asArray(t),!n&&((o=f.stores)==null?void 0:o.every(w=>w.trigger("beforeAdd",{records:t,parent:f})!==!1))===!1)return null;t=f.ingestChildren(t);const p=(u=(c=r==null?void 0:r.parentIndex)!=null?c:(d=f.children)==null?void 0:d.length)!=null?u:0,v=(h=f.beforeInsertChild)==null?void 0:h.call(f,t),b=f.internalAppendInsert(t,r,n,s);return b.length&&f.convertToParent(n),(g=f.afterInsertChild)==null||g.call(f,p,t,v,b,s.orderedBeforeNode),m||!b?b:b[0]}convertToParent(t=!1){const r=this,n=r.isLeaf;r.meta.isLeaf=!1,r.children||(r.children=[]),n&&!r.root.isLoading&&!t&&r.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(t,r=this.stores){r==null||r.forEach(n=>{n.trigger("update",{record:this,records:[this],changes:t}),n.trigger("change",{action:"update",record:this,records:[this],changes:t})})}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(t,r,n,s){const a=this,{stores:l,root:o,children:d}=a,{firstStore:c}=o,{parentIdField:u}=a.constructor,h=a.id;let g,f,m,p,v,b={};if(!o.isLoading&&c)for(v=[],m=0;m<t.length;m++){const w=t[m];b[w.id]=w.root===o,v[m]=w.parentIndex}if(r&&r.parent!==a&&(r=null),d){const w=r?r.parentIndex:d.length;if(d[f=w]===t[0]||d[f=w-1]===t[0])for(g=!0,m=0;g&&m<t.length;m++)t[m]!==d[f+m]&&(g=!1)}if(g)return t;for(m=0;m<t.length;m++){const w=t[m],D=w.parent;c&&!o.isLoading&&w.traverse(R=>{R.root===o&&(b[R.id]=!0)});const S=!!b[w.id],x=D===a&&S;if((D==null?void 0:D.removeChild(w,S,n,{isInserting:!0,skipIndexUpdate:x,...s}))===!1)p||(t=t.slice(),p=!0),t.splice(m--,1);else{w.parent=a,w.setData("parentId",h);const{meta:R}=w;R.modified[u]===h&&!D&&(R.oldParentId=h),D&&(R.oldParentId=D.id)}}if(t.length){Array.isArray(d)||(a.children=[]),Array.isArray(a.orderedChildren)||(a.orderedChildren=[]);const w=a.addToChildren(r,t,s);l==null||l.forEach(D=>{(!D.isChained||D.isChainedTree)&&(t.forEach(S=>S.joinStore(D)),D.onNodeAddChild(a,t,w,b,n),t.forEach((S,x)=>{if(S.meta.oldParentId!=null&&(!(a.inProcessChildren||a.isLoading)||b[S.id])){const R={[u]:h,[a.getDataSource("parentIndex")]:S.parentIndex},M={},{modified:_,oldParentId:k}=S.meta,F=v[x];if(delete S.meta.oldParentId,a.id!==k&&(M[u]={value:h,oldValue:k}),S.parentIndex!==F&&(M.parentIndex={value:S.parentIndex,oldValue:F}),_[u]===a.id?Reflect.deleteProperty(_,u):u in _||(_[u]=k),b[S.id]){const I=D.getById(k);I.isLeaf&&!n&&I.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[D])}S.afterChange(R,M)}S.traverse(R=>{!R.ignoreBag&&!R.isLinked&&D.updateModifiedBagForRecord(R)})}))})}return t}removeChild(t,r=!1,n=!1,s={}){var a,l,o;const d=this,c=[],u=d.isLeaf,{children:h,stores:g}=d;if(t=B.asArray(t),t=t.filter(m=>m.parent===d),(a=d.firstStore)!=null&&a.isChainedTree)return d.$original.removeChild(t.map(m=>m.$original),r,n,s);if(!n&&g){for(const m of g)if(!m.isChained&&m.trigger("beforeRemove",{parent:d,records:t,isMove:r})===!1)return!1}const f=(l=d.beforeRemoveChild)==null?void 0:l.call(d,t,r);for(const m of t){const{parentIdField:p}=m.constructor,{modified:v}=m.meta,b=m.parent?m.parent.id:null;!(p in v)&&!m.isLinked&&(v[p]=b);const w=d.removeFromChildren(m,s);g==null||g.forEach(D=>{if(!D.isChained){const{isRemoving:S}=D;D.isRemoving=!0,c.push(...D.onNodeRemoveChild(d,[m],w,{isMove:r,silent:n,...s})),D.isRemoving=S}}),r||(m.parent=m.parentIndex=m.unfilteredIndex=m.nextSibling=m.previousSibling=null,m.data[p]=null)}return(d.unfilteredChildren||h).length===0&&d.constructor.convertEmptyParentToLeaf.onRemove&&!d.isRoot&&(d.meta.isLeaf=!0),d.isLeaf!==u&&!n&&!r&&d.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),(o=d.afterRemoveChild)==null||o.call(d,t,f,r),c}clearParentId(){const t=this,{parentIdField:r}=t.constructor;Reflect.deleteProperty(t.data,r),Reflect.deleteProperty(t.originalData,r),t.meta.modified&&Reflect.deleteProperty(t.meta.modified,r)}replaceChildren(t){return this.clearChildren(),this.data[this.constructor.childrenField]=t,this.processChildren(),this.children}clearChildren(t=!1){const r=this,{stores:n}=r,s=r.unfilteredChildren||r.children;r.children=[],r.orderedChildren=[],s&&s!==!0&&n&&n.forEach(l=>{l.isChained||l.onNodeRemoveChild(r,s,0,{unfiltered:!0,silent:t})}),r.unfilteredChildren&&(r.unfilteredChildren=[]);const{convertEmptyParentToLeaf:a}=r.constructor;(a===!0||a.onRemove)&&(r.meta.isLeaf=!0)}clear(){var t;const r=this,{stores:n}=r,s=(t=r.unfilteredChildren||r.children)==null?void 0:t.slice();if(!(!r.isRoot||!s)){for(const a of n)if(!a.isChained&&a.trigger("beforeRemove",{parent:r,records:s,isMove:!1,removingAll:!0})===!1)return!1;r.children.length=r.orderedChildren.length=0,r.unfilteredChildren&&(r.unfilteredChildren.length=0),n.forEach(a=>{s.forEach(l=>{l.stores.includes(a)&&l.unjoinStore(a),l.parent=l.parentIndex=l.nextSibling=l.previousSibling=null}),a.storage.suspendEvents(),a.storage.clear(),a.storage.resumeEvents(),a.added.clear(),a.modified.clear(),a.trigger("removeAll"),a.trigger("change",{action:"removeall"})})}}updateChildrenIndices(t,r,n=!1){var s,a;let l=null;for(let o=0;o<t.length;o++){const d=t[o],c=d[r];r==="parentIndex"||r==="orderedParentIndex"?c===void 0||n?d.setData(r,o):c!==o&&((s=d.stores)==null||s.forEach(u=>{u.suspendSortOnUpdate(),u.suspendFilterOnUpdate()}),d.set(r,o,!0),(a=d.stores)==null||a.forEach(u=>{u.resumeSortOnUpdate(!1),u.resumeFilterOnUpdate(!1)})):d[r]=o,r==="parentIndex"&&(d.previousSibling=l,l&&(l.nextSibling=d),o===t.length-1&&(d.nextSibling=null),l=d)}}addToChildren(t,r,n={}){var s,a;const l=this,o=[[l.children,"parentIndex",t],[l.unfilteredChildren,"unfilteredIndex",t],[l.orderedChildren,"orderedParentIndex",(n==null?void 0:n.orderedBeforeNode)===void 0?(n==null?void 0:n.orderedParentIndex)!==void 0?l.orderedChildren[(s=n.orderedParentIndex.index)!=null?s:n.orderedParentIndex]:t:n==null?void 0:n.orderedBeforeNode]];for(const d of o){const[c,u,h]=d;if(c){let g;h?(g=c.indexOf(h),g===-1&&(g=c.length)):g=c.length,d.push(g),c.splice(g,0,...r),n!=null&&n.skipIndexUpdate||(a=n==null?void 0:n[u])!=null&&a.skip||l.updateChildrenIndices(c,u)}}return o[0][3]}removeFromChildren(t,r){var n;const s=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const a of s){const[l,o]=a;if(l){const d=l.indexOf(t);a.push(d),d>-1&&(l.splice(d,1),r!=null&&r.skipIndexUpdate||(n=r==null?void 0:r[o])!=null&&n.skip||this.updateChildrenIndices(l,o))}}return s[0][2]}sortOrderedChildren(t=!0,r=!1){const n=[];return this.isLeaf||(this.orderedChildren.sort((s,a)=>{var l,o;if(r){const d=(l=s.meta.modified.orderedParentIndex)!=null?l:s.orderedParentIndex,c=(o=a.meta.modified.orderedParentIndex)!=null?o:a.orderedParentIndex,u=d-c;return u!==0&&(n.push(s),n.push(a)),u}else return s.orderedParentIndex-a.orderedParentIndex}),t&&this.orderedChildren.forEach(s=>{n.push(...s.sortOrderedChildren(t,r))}),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(n)}sortVisibleChildren(t=!0,r){const n=this;n.isLeaf||(n.children.sort(r),t&&n.orderedChildren.forEach(s=>s.sortVisibleChildren(t,r)),n.updateChildrenIndices(n.children,"parentIndex",!0))}sortUnfilteredChildren(t=!0,r){const n=this;!n.isLeaf&&n.unfilteredChildren&&(n.unfilteredChildren.sort(r),t&&n.orderedChildren.forEach(s=>s.sortUnfilteredChildren(t,r)),n.updateChildrenIndices(n.unfilteredChildren,"unfilteredIndex",!0))}unjoinStore(t,r=!1){var n;const s=this;s.unfilteredChildren&&(s.children=s.unfilteredChildren.slice(),s.unfilteredChildren=null),(n=super.unjoinStore)==null||n.call(this,t,r)}},y(e,"$name","TreeNode"),e},Cb={id:1,internalId:1,stores:1,unjoinedStores:1,parentIndex:1,parent:1,unfilteredChildren:1,children:1,orderedChildren:1,parentId:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},ZR={get(i,e){switch(e){case"proxyMeta":return this.proxyMeta;case"constructor":return i.constructor;case"setData":return this.setDataOverride;case"set":return this.setOverride;case"instanceMeta":return this.instanceMetaOverride}return Cb[e]?this.proxyMeta.data[e]:Reflect.get(i,e,this.proxyRecord)},set(i,e,t,r){return e==="parentId"?r.setParentId(t):Cb[e]?this.proxyMeta.data[e]=t:i[e]=t,!0},instanceMetaOverride(i){const{proxyMeta:e}=this,t=i.id||i,r=e.map||(e.map=T.clone(e.originalRecord.instanceMeta(t)));return r[t]||(r[t]={})},setDataOverride(i,e){i==="parentIndex"?this.proxyMeta.data.parentIndex=e:i==="parentId"?this.proxyMeta.data.parentId=e:this.proxyMeta.originalRecord.setData(i,e)},setOverride(i,e,...t){i==="parentIndex"?this.proxyMeta.data.parentIndex=e:this.proxyMeta.originalRecord.set(i,e,...t)}},wb=i=>{var e;return e=class extends(i||$){link(){if(this.isLinked)return this.$original.link();const t=this,r={...ZR,proxyMeta:{originalRecord:t,data:{id:`${t.id}_link_${t.constructor._internalIdCounter}`,internalId:t.constructor._internalIdCounter++,stores:[],unjoinedStores:[],...t.children?{unfilteredChildren:[],children:[],orderedChildren:[]}:{}}}},n=new Proxy(t,r);return r.proxyRecord=n,(t.meta.linkedRecords||(t.meta.linkedRecords=[])).push(n),n}get isLinked(){var t;return!!((t=this.proxyMeta)!=null&&t.originalRecord)}get hasLinks(){return!!(!this.proxyMeta&&this.$links.length)}removeLink(t,r=null,n=!1){if(t.hasLinks)for(const s of t.$links.slice())r?B.include(r,s):s.remove(n);else t.isLinked&&B.remove(t.$original.$links,t)}beforeRemove(t){this.removeLink(this,t)}removeChild(t,r,n,s){if(!(s!=null&&s.isInserting)){t=B.asArray(t);for(const a of t)this.removeLink(a,null,n)}return super.removeChild(t,r,n,s)}get $originalId(){return this.$original.id}get $links(){var t;return(t=this.meta.linkedRecords)!=null?t:[]}},y(e,"$name","ModelLink"),y(e,"isModel",!0),e},{defineProperty:Sb}=Reflect,Mf=Symbol("owner"),JR=/[\s,]+/,ii=i=>{var e;return e=class extends(i||$){static get declarable(){return["factoryable","alias","type"]}static register(t,r,n=globalThis.__BRYNTUM_EXAMPLE||(s=>(s=globalThis.DocsBrowser)==null?void 0:s.isDocsBrowser)()){const{factoryable:s}=this.initClass(),{caseless:a,registry:l}=s,o=O.split(t,JR);for(let d,c,u=0;u<o.length;++u){if(c=o[u],d=a?c.toLowerCase():c,!n&&d in l)throw new Error(`Type "${c}" already registered with ${s.class.name} factory`);l[c]=l[d]=r.initClass()}}static isA(t,r){return this.isType(t,r,!0)}static isType(t,r,n){const{factoryable:s}=this,{caseless:a,registry:l}=s,o=l[a?r.toLowerCase():r];return o?n?t instanceof o:t.constructor===o:!1}static setupAlias(t){t.register(t.alias,t)}static setupFactoryable(t,r){const n=r.super.class;let{factoryable:s}=t;s={caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type",...s},s.class=t,s.registry=Object.create(null),s.extends&&!Array.isArray(s.extends)&&(s.extends=[s.extends]),Sb(t,"factoryable",{get(){return s}})}static setupType(t,r){const{type:n}=t;t.register(n,t,r.replaceType),Sb(t.prototype,"type",{get:()=>n,set:s=>{if(s!==n)throw new Error("Can not mutate `type` config to different value")}})}static create(t,r){return this.reconfigure(null,t,r)}static reconfigure(t,r,n){const s=this,{factoryable:a}=s,{typeKey:l}=a;let o=n,d,c,u,h,g,f,m,p,v;if(n&&!T.isClass(n)&&(o=null,m=typeof n,m==="function"?f=n:m==="string"?o=n:T.isObject(n)?(d=n.cleanup,c=n.defaults,h=n.owner,f=n.setup,o=n.type,p=n.transform):h=n),p&&(r=typeof p=="string"?h[p](r):p(r)),v=r,typeof v=="string")r={};else if(r){if(r===!0&&(r={}),!T.isObject(r))return h&&r!==t&&(t==null?void 0:t[Mf])===h&&(typeof d=="string"?h[d](t):d==null||d(t),t.destroy()),r;v=r[l]}if(v=v&&s.resolveType(v),t){if(r&&(!v||t.constructor===v))return l in r&&(r=T.assign({},r),delete r[l]),t.setConfig(r),t;h&&t[Mf]===h&&(typeof d=="string"?h[d](t):d==null||d(t),t.destroy())}if(r){if(c){if(!(u=v)){if(!(u=c[l]||o||a.defaultType))throw new Error(`No default mergeType defined for ${a.class.name} factory`);u=s.resolveType(u)}u&&(r=u.mergeConfigs(c,r))}if(f){if(g=typeof f=="string"?h[f](r,v,c):f(r,v,c),g===null)return g;r=g||r}if(!v){if(!(v=r[l]||o||a.defaultType))throw new Error(`No default type defined for ${a.class.name} factory`);v=s.resolveType(v)}c&&!u&&(r=v.mergeConfigs(c,r)),l in r&&(r=T.assign({},r),delete r[l]),r=new v(r),h&&(r[Mf]=h)}return r||null}static resolveType(t,r){if(typeof t!="string")return t;const{factoryable:n}=this,s=n.extends;let a=n.registry[n.caseless?t.toLowerCase():t],l;for(l=0;!a&&s&&l<s.length;++l)a=s[l].resolveType(t,!0);if(!a&&!r)throw new Error(`Invalid type name "${t}" passed to ${n.class.name} factory`);return a}},y(e,"$name","Factoryable"),e},QR=/^([A-Z]+)(?:F|f)ormula/,eT=/^(.*)$/,Db={this:1,data:1},Eb=i=>{var e;return(e=i.fields)==null?void 0:e.reduce((t,r)=>(r.persist&&i.get(r.name)&&(t[r.name]=String(i.get(r.name))),t),{})},$o=class SE extends $.mixin(ii,Fe){constructor(){super(...arguments),y(this,"fieldMatchRE",/\$([a-zA-Z\-_]+)/g),y(this,"fieldDelimiterRE",/[^a-zA-Z\-$_]/)}changeHeaders(e){return T.clone(e)}updateInputField(e,t){var r;return(r=this.inputListenerRemover)==null||r.call(this),e&&(this.inputListenerRemover=e.ion({thisObj:this,input:"onFieldInput",change:"onFieldChange"})),this.owner=e}onFieldInput(){var e,t,r,n;const s=this,{inputField:a}=s,l=((e=s.store)==null?void 0:e.modelClass)||(s.record||a.record).constructor,o=s.fieldNames||(s.fieldNames=Object.keys(Db).concat(Object.keys(l.fieldMap)));if(a.formulaProvider===s){const d=(t=a.getCurrentToken(s.fieldDelimiterRE))==null?void 0:t.token,c=d!=null&&d.startsWith("$")?d.substring(1):null,u=(n=(r=a.value.matchAll(s.fieldMatchRE))==null?void 0:r.reduce)==null?void 0:n.call(r,(g,[,f])=>(f===c?o.some(m=>m.startsWith(f))||g.push(f):!Db[f]&&!l.fieldMap[f]&&g.push(f),g),[]);u!=null&&u.length?a.setError(`Undefined data field(s) ${u.join(",")}`,!1,!0):a.clearError();const h=s.resolveCallback(s.handleFormulaInput,s,!1);h==null||h.handler.call(h.thisObj,a,this)}}onFieldChange(){var e;const t=this,{inputField:r}=t,{value:n}=r,s=t.formulaRE?(e=n.trim().match(t.formulaRE||t.constructor.formulaRE||eT))==null?void 0:e[1]:n,a=t.resolveCallback(t.handleFormulaChange,t,!1);if(s&&a){const l=t.createFormula(s,t.record||r.record,t.store);a==null||a.handler.call(a.thisObj,t,l,r)}}async calculate(e){return this.callback(this.generateContent,this,[e])}updatePrefix(e){this.formulaRE=new RegExp(`^=${e}\\((.+)\\)$`)}updateUrl(e){this.generateContent=e?this.getRemoteContent:null}async getRemoteContent(e){let t;try{const r=this,{method:n,headers:s}=r,a={...r.body};T.setPath(a,r.paramName,e);const l=await kt.fetch(r.url,T.assign({credentials:void 0,method:n,headers:s,body:JSON.stringify(a)},r.fetchOptions));if(!l.ok)return r.trigger("formulaNetworkError",{response:l,bubbles:!0}),"";t=await l.json()}catch(r){console.error("Error:",r)}return T.getPath(t,this.responseField)}createFormula(e,t,r){const n={formula:e.replaceAll(this.fieldMatchRE,(s,a)=>{var l;switch(a){case"this":return JSON.stringify(Eb(t));case"data":return JSON.stringify(r.allRecords.map(o=>Eb(o)));default:return(l=t.get(a))!=null?l:""}})};return this.trigger("formulaChange",n),n.formula}get store(){var e;return this._store||((e=this.record)==null?void 0:e.firstStore)}static get(e,t){var r;let n=(r=this.map)==null?void 0:r.get(e);return n&&t&&(n=new n(t)),n}static initClass(){var e,t;const r=SE,n=this,s=n===r?"FORMULA":((t=(e=n.$name)==null?void 0:e.match(QR))==null?void 0:t[1])||n.formulaPrefix;if(s){n.formulaPrefix||(n.formulaPrefix=s),n.inputPrefixRE=new RegExp(`^=${s}\\(.*`),n.formulaRE=new RegExp(`^=${s}\\((.+)\\)`),(r.map||(r.map=new Map)).set(s,n);const a=[...r.map.keys()].map(l=>l).join("|");r.inputPrefixRE=new RegExp(`^=(${a})\\(.*`)}return super.initClass()}};y($o,"$name","FormulaProvider"),y($o,"type","formula"),y($o,"configurable",{callOnFunctions:!0,record:null,store:null,inputField:{$config:"nullify",value:null},handleFormulaInput:null,handleFormulaChange:null,url:null,method:"POST",fetchOptions:null,paramName:"prompt",responseField:"content",headers:{Accept:"application/json","Content-Type":"application/json"},generateContent:null,prefix:null}),y($o,"factoryable",{defaultType:"formula"});var Ho=$o;Ho.initClass(),Ho._$name="FormulaProvider";var{getOwnPropertyDescriptor:tT}=Reflect,dt=class extends $.mixin(ii){construct(i){const e=this;i&&(e.name=i.name,Object.assign(e,i)),e.compare&&(e.compareItems=(t,r)=>e.compare(t==null?void 0:t[e.name],r==null?void 0:r[e.name]))}changeFormulaProviders(i){const e=this;return new Proxy({...i},{set(t,r,n){const s=Reflect.set(t,r,n);return e.updateFormulaProviders(t),s}})}updateFormulaProviders(i){this.inputPrefixRE=i?new RegExp(`^=(${Object.keys(i).join("|")})\\(.*`):null}getFormulaProvider(i){const e=this.formulaProviders[i];if(e){if(e.isFormulaProvider)return e;let{instance:t}=e;if(!t){const r={...e,prefix:i};t=e.instance=Ho.get(i,r)||Ho.create(r)}return t}}get label(){return this._label||O.separate(this.name)}set label(i){this._label=i}defineAccessor(i,e){const{name:t,dataSource:r}=this;!e&&t in i&&i.$meta.hierarchy.some(n=>{var s;return((s=tT(n.prototype,t))==null?void 0:s.enumerable)===!1})||(this.formulaProviders&&i.$meta.class.addField(`#${t}`),Reflect.defineProperty(i,t,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(t,r)}:function(){return this.batching&&t in this.meta.batchChanges?this.meta.batchChanges[t]:this.data[r]},set(n){const s=this.$meta.fields.map[t];s&&s.readOnly||this.set(t,n)}}))}isEqual(i,e){return T.isEqual(i,e)}print(i){return i==null?this.nullText:this.printValue(i)}printValue(i){return String(i)}getCurrentConfig(){const i={};for(const e in this.constructor.prototypeProperties)i[e]=this[e];return delete i.isConstructing,i}get calculated(){return!!(this.calculate||this._calculated)}set calculated(i){this._calculated=i}get calculate(){return this._calculate}set calculate(i){typeof i=="function"&&(i={fn:i}),this._calculate=i}};y(dt,"$name","DataField"),y(dt,"type","auto"),y(dt,"factoryable",{defaultType:"auto"}),y(dt,"prototypeProperties",{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1,calculated:!1,calculate:null,useProp:null,bypassEqualityOnSyncDataset:!1,complexMapping:null}),y(dt,"configurable",{formulaProviders:null}),dt._$name="DataField";var Zs=class extends dt{isEqual(i,e){return i===e}getAt(i,e){return i.get(this.name)[e]}};y(Zs,"$name","ArrayDataField"),y(Zs,"type","array"),y(Zs,"dataConstructor",Array),Zs.initClass(),Zs._$name="ArrayDataField";var Cn=class extends dt{static get prototypeProperties(){return{nullValue:!1}}isEqual(i,e){return i==null&&e==null?!0:super.isEqual(i,e)}convert(i){var e;return i==null?this.nullable?i:this.nullValue:((e=i.toLowerCase)==null?void 0:e.call(i))==="false"?!1:!!i}};y(Cn,"$name","BooleanDataField"),y(Cn,"type","boolean"),y(Cn,"dataConstructor",Boolean),y(Cn,"alias","bool"),Cn.initClass(),Cn._$name="BooleanDataField";var Js=class extends dt{static get prototypeProperties(){return{format:null}}convert(i){if(i==null)this.nullable||(i=this.nullValue);else if(i==="now")i=new Date;else if(!(i instanceof Date)){const e=i;i=C.parse(i,this.format||C.defaultParseFormat),(!i||isNaN(i))&&(i=void 0,e!==""&&console.warn(`Date parsing failed for "${this.name}" field, input: ${JSON.stringify(e)}. ${this.format?`Expected format: ${this.format}.`:'You should configure your Model field with a "format" to specify how dates should be parsed. See docs for DateDataField here: https://bryntum.com/products/scheduler/docs/api/Core/data/field/DateDataField, and see https://bryntum.com/products/scheduler/docs/api/Core/helper/DateHelper for the different formats.'}"`))}return i}serialize(i){return i instanceof Date&&(i=C.format(i,this.format||C.defaultFormat)),i}printValue(i){return C.format(i,this.format||C.defaultFormat)}};y(Js,"$name","DateDataField"),y(Js,"type","date"),y(Js,"dataConstructor",Date),Js.initClass(),Js._$name="DateDataField";var wn=class extends dt{static get prototypeProperties(){return{nullValue:""}}convert(i){return i==null?this.nullable?i:this.nullValue:String(i)}};y(wn,"$name","StringDataField"),y(wn,"type","string"),y(wn,"dataConstructor",String),wn.initClass(),wn._$name="StringDataField";var Vo=class extends wn{isEqual(i,e){return C.compareUnits(i,e)===0}};y(Vo,"$name","DurationUnitDataField"),y(Vo,"type","durationunit"),Vo.initClass(),Vo._$name="DurationUnitDataField";var Sn=class extends dt{static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(i){return i==null?this.nullable?i:this.nullValue:Math[this.rounding](Number(i))}};y(Sn,"$name","IntegerDataField"),y(Sn,"type","integer"),y(Sn,"alias","int"),y(Sn,"dataConstructor",Number),Sn.initClass(),Sn._$name="IntegerDataField";var Qs=class extends dt{static get prototypeProperties(){return{complexMapping:!0}}isEqual(i,e){return i&&e&&e instanceof i.constructor&&e.id==i.id}};y(Qs,"$name","ModelDataField"),y(Qs,"type","model"),y(Qs,"configurable",{modelClass:null}),Qs.initClass(),Qs._$name="ModelDataField";var Rr=class extends dt{static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(i,e){return isNaN(Number(i))&&isNaN(Number(e))||super.isEqual(i,e)}convert(i){if(i==null)return this.nullable?i:this.nullValue;if(i=Number(i),isNaN(i))return;let e=this.precision;return e?(e=10**e,i=Math.round(i*e)/e):e===0&&(i=Math.round(i)),i}};y(Rr,"$name","NumberDataField"),y(Rr,"type","number"),y(Rr,"alias","float"),y(Rr,"dataConstructor",Number),Rr.initClass(),Rr._$name="NumberDataField";var ea=class extends dt{static get prototypeProperties(){return{complexMapping:!0}}};y(ea,"$name","ObjectDataField"),y(ea,"type","object"),y(ea,"dataConstructor",Object),ea.initClass(),ea._$name="ObjectDataField";var iT=i=>typeof i=="string"&&i.startsWith("_generated"),No=class extends dt{init(i,e,t){var r;const n=this,s=`${n.name}Store`,a={skipStack:!0,syncDataOnLoad:!0,useRawData:!1};if(n.store&&T.assign(a,n.store),n.modelClass&&(a.modelClass=n.modelClass),(r=e[`init${O.capitalize(s)}`])==null||r.call(e,a),!a.storeClass&&!n.storeClass)throw new Error(`Field '${n.name}' with type 'store' must have a storeClass configured`);const l=e.meta[s]=new(a.storeClass||n.storeClass)(a);n.complexMapping?T.setPath(i,n.dataSource,l):i[n.dataSource]=l,l.verifyNoGeneratedIds=!1,l.usesId=n.usesId||!l.count||!l.every(o=>o.hasGeneratedId),l.$currentValue=n.getValue(l,e),l.ion({change:({action:o})=>{const d=n.getValue(l,e);if(!l.$isSettingStoreFieldData){const c=l.$preserveCurrentDataset;l.$preserveCurrentDataset=n.subStore&&(o==="update"||o==="remove"||o==="add"),n.$isUpdatingRecord=!0,e.set(n.name,d),n.$isUpdatingRecord=!1,l.$preserveCurrentDataset=c}l.$currentValue=d}}),n.$chrono&&t(n,l)}set(i,e,t){var r,n;const s=this,a=`${s.name}Store`,{[a]:l}=t.meta;if(i!=null&&i.isStore&&(i=i.$currentValue),!l)return t.meta.initableValues.set(s,i),!1;l.$isSettingStoreFieldData||(l.$isSettingStoreFieldData=!0,i=(n=(r=t[`process${O.capitalize(a)}Data`])==null?void 0:r.call(t,i,t))!=null?n:i,l.$preserveCurrentDataset||(l.data=i),l.$isSettingStoreFieldData=!1,l.usesId=s.usesId||!l.count||!l.every(o=>o.hasGeneratedId))}serialize(i,e){const t=e.meta[`${this.name}Store`];return this.$isUpdatingRecord?this.getValue(t,e):t.$currentValue}getValue(i,e){const t=`get${O.capitalize(this.name)}StoreValue`;return e[t]?e[t](i):i.allRecords.map(r=>{const n=r.persistableData;return i.usesId||delete n.id,n})}isEqual(i,e){if(i==null&&e==null)return!0;if(i==null&&e!=null||i!=null&&e==null)return!1;if(i.isStore&&e.isStore)return T.isDeeplyEqual(i.$currentValue,e.$currentValue);if(i.isStore&&e.isStore||!i.isStore&&!e.isStore)return T.isEqual(i,e,!0);{const t=i.isStore?i:e,r=t.modelClass,n=r.$meta.fields.defs,s=i.isStore?i.$currentValue:e.$currentValue,a=i.isStore?e:i;if(s.length!==a.length)return!1;for(let l=0;l<n.length;l++){const o=n[l];if(o.persist)for(let d=0;d<s.length;d++){const c=s[d][o.dataSource],u=a[d][o.dataSource];if(!(c!==void 0&&u===void 0&&(o.dataSource===r.idField&&iT(c)||o.defaultValue!==void 0&&T.isEqual(o.defaultValue,c,!0)))&&!T.isEqual(c,u,!0))return!1}}return!0}}getOldValue(i){const e=i.meta[`${this.name}Store`];return e?T.clone(e.$currentValue):null}getAt(i,e){const t=i.meta[`${this.name}Store`];return t==null?void 0:t.getAt(e)}};y(No,"$name","StoreDataField"),y(No,"type","store"),No.initClass(),No._$name="StoreDataField";var xb=/^(.*?)\.(.*)/,_f=/(.*)\[(.*)]\.?(.*)/,{defineProperty:rT}=Reflect,{hasOwn:Bo}=T,Dn=void 0,nT={children:1,data:1,meta:1},sT=["name","title","text","label","description"],aT={boolean:1,number:1,date:1,object:1},Rb={parentId:1,$PhantomId:2,id:3},kf=class Qc extends $.mixin(yb,bb,wb){static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}get id(){var e;return(e=this._id)!=null?e:this.getData("id")}set id(e){this.set("id",e)}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(e==null?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let t=this,r=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[r--]=t.parentIndex+1;return e}construct(e={},t=null,r=null,n=!1,s=!1,a=!1){var l,o;const d=this,{constructor:c,fieldMap:u}=d;if(d.meta={modified:{},...c.metaConfig,...r},c.applyConfigs){const g={};(!d.useRawData||!d.useRawData.enabled)&&(e={...e});const f=d.getDefaultConfiguration();if(c.autoExposeFields)for(const m in f)m in e&&(e[m]!==void 0&&(g[m]=e[m]),delete e[m]);else for(const m in e)m in c.fieldMap||(e[m]===void 0?g[m]=f[m]:g[m]=e[m],delete e[m]);super.construct(g)}if(n||c.exposeProperties(e,a),!Bo(c,"idFieldProcessed")){let g=d.meta.idField;g||c._assignedIdField&&(g=c.idField),g&&g!==u.id.dataSource&&c.addField({name:"id",dataSource:g,internal:!0}),c._idField=u.id.dataSource,c.idFieldProcessed=!0}d._internalId=Qc._internalIdCounter++,d.originalData||(d.originalData=e);const h=c.processData(e,!1,t,d,s);d._id=u.id.complexMapping?T.getPath(h,c._idField):h[c._idField],(l=d.meta.initableValues)!=null&&l.size&&d.assignInitables(),d._id==null&&!(c.allowNullId&&d._id===null)&&d.setData("id",d.generateId(t)),h[c.childrenField]&&d.processChildren((o=B.asArray(t))!=null?o:[]),d.generation=0}set isCreating(e){var t;const r=this;!!r.meta.isCreating!==e&&(r.meta.isCreating=e,(t=r.stores)==null||t.forEach(n=>n.onIsCreatingToggle(r,e)))}get isCreating(){return!!this.meta.isCreating}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,r=0,{length:n}=t;r<n;r++){const s=t[r],{name:a}=s;if(a!=="id"&&!s.isEqual(this.getValue(a),e.getValue(a)))return!1}return!0}return!1}static processData(e,t=!1,r,n,s){const a=this,{map:l,defaults:o,chronoProps:d}=a.$meta.fields,{useRawData:c={enabled:!1}}=r||{},u=s||c.enabled?e:T.clone(e),h=!!n.$entity;n.isConstructing&&(n.data=u);let g,f;if(h&&!t){f={};for(const p of d)f[p.name]=n.createFieldIdentifier(p);Object.defineProperty(n,"$",{value:f,enumerable:!0,configurable:!0})}const m=t||c.disableDefaultValue||s;if(!m||!c.disableTypeConversion&&!s||h)for(g in l){const p=l[g],{name:v,dataSource:b}=p,w=b!==v,D=p.complexMapping,S=D?T.getPath(u,b):u[b],x=S===void 0?D?T.getPath(u,v):u[v]:void 0,R=S!==void 0,M=x!==void 0,_=!R&&M,k=R||M,F=!c.disableTypeConversion&&p.convert;let I=_?x:S;if(!m&&b in o&&!k&&!p.fromData){let A=o[b];Array.isArray(A)?A=A.slice():A instanceof Date?A=new Date(A):A&&typeof A=="object"&&(A=T.clone(A)),D?T.setPath(u,b,A):u[b]=A,I=A}if((_||F)&&(!m||k)&&!s&&!p.calculate){const A=F?p.convert(I,e,n):I;A===void 0&&I===void 0&&!R||(D?T.setPath(u,b,A):u[b]=A,w&&delete u[v],I=A)}if(!t&&p.$chrono){const A=f[v]=n.createFieldIdentifier(p.$chrono);A.DATA=I}}return a.$meta.fields.calculated.forEach(p=>{const{calculate:v}=p;if(!p._cachedDependencies&&!v.dependsOn){p._cachedDependencies=!0;const b=new Set,w=new Proxy(u,{get(S,x){return b.add(x),u[x]}});let D;try{v.fn(w,n),v.dependsOn=Array.from(b),a.setupDependentCalcFields(p),D=b.size===0}catch(S){D=!0}D&&console.warn(`Failed to auto-detect dependent fields for "${p.name}" field. Add "dependentOn" in your calculate config.`)}u[p.name]=n.refreshCalculatedField(p)}),a.$meta.fields.initable.length&&a.initInitables(n,u,(p,v)=>{const b=f[p.name]=n.createFieldIdentifier(p.$chrono);b.DATA=v}),u}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var r,n,s,a,l;const o=Bo(e,"fields")&&e.fields,d=t.super.fields,c=t.fields={defs:(r=d==null?void 0:d.defs.slice())!=null?r:[],calculated:(n=d==null?void 0:d.calculated.slice())!=null?n:[],exposedData:!1,defaults:d?{...d.defaults}:{},exposed:Object.create((s=d==null?void 0:d.exposed)!=null?s:null),ordinals:Object.create((a=d==null?void 0:d.ordinals)!=null?a:null),map:d?{...d.map}:{},sources:d?{...d.sources}:{},chronoProps:[],subModels:[]};if(e!==Qc){let u=t;do u=u.super,u.fields.subModels.push(e);while(u.class!==Qc)}if(Bo(e,"defaults")&&Object.assign(c.defaults,e.defaults),Bo(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),o!=null&&o.length&&o.map(e.addField,e),c.initable=c.defs.filter(u=>u.init),(l=e.$entity)!=null&&l.allFields.size)for(const u of e.$entity.allFields.values())c.map[u.name]||c.chronoProps.push(u);e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,t=!0){const r=this,n=r.$meta.fields,s=t?"exposed":"map";if(e&&r.autoExposeFields&&!n.exposedData){let a,l,o;for(a in e)!n[s][a]&&a!==r.childrenField&&(o=T.typeOf(e[a]),l={name:a,dataSource:a,fromData:!0},aT[o]&&(l.type=o),r.addField(l));n.exposedData=!0}r.exposeRelations()}static addField(e){var t;if(e==null)return;typeof e=="string"&&(e={name:e});const r=this.initClass(),n=r.$meta.fields,{ordinals:s,calculated:a,subModels:l}=n,o=n.exposed,{name:d}=e,c=n.map[d],u=e.dataSource||(e.dataSource=d);let h,g;if(!c||e.type&&e.type!==c.type)e.model=r,h=dt.create(e),e.model=null,h.definedBy=c?c.definedBy:r,h.ordinal=c?c.ordinal:s[d]=n.defs.length,(t=h.calculate)!=null&&t.dependsOn&&r.setupDependentCalcFields(h);else{h=Object.create(c);for(g in e)g!=="type"&&(h[g]=e[g])}h.owner=r,n.defs[h.ordinal]=h,n.map[d]=h,n.sources[u]=h;for(const f of l)f.$meta.fields.map[d]=h;return h.complexMapping!==!1&&u.includes(".")&&(h.complexMapping=!0),h.complexMapping?o[u.split(".")[0]]=!0:o[u]=!0,"defaultValue"in h&&(n.defaults[u]=h.defaultValue),nT[d]||h.defineAccessor(r.prototype),h.calculate&&a.push(h),r._nonPersistableFields=null,r._alwaysWriteFields=null,h}static setupDependentCalcFields(e){const t=this.$meta.fields;e.calculate.dependsOn.forEach(r=>{if(!t.map[r])throw new Error(`No "${r}" field defined in ${this.$name} class`);t.map[r].dependentFields=t.map[r].dependentFields||[],t.map[r].dependentFields.push(e.name)})}static removeField(e){const t=this.initClass(),r=t.$meta.fields,n=r.map[e],{ordinals:s}=r,a=s[e];if(n){r.defs.splice(a,1),delete s[e],delete r.defaults[e],delete r.exposed[e],delete r.map[e],delete r.sources[n.dataSource];for(const l in s)s[l]>a&&--s[l];delete t.prototype[e]}}static exposeRelations(){const e=this;if(!Bo(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const t in e.relations){const r=e.relations[t];r.relationName=t,e.exposedRelations.push(r),Reflect.ownKeys(e.prototype).includes(t)||rT(e.prototype,t,{enumerable:!0,get:function(){return this.getForeign(t)},set:function(n){this.setForeign(t,n,r)}})}}}static initInitables(e,t,r){const n=e.meta.initableValues=new Map;for(const s of this.$meta.fields.initable){const a=T.getPath(t,s.dataSource);a!==void 0&&n.set(s,a),!s.lazy&&s.init(t,e,r)}}assignInitables(){const{initableValues:e}=this.meta;for(const[t,r]of e)t.set(r,this.data,this)!==!1&&e.delete(t)}static get autoExposeFields(){return!0}static fieldSorter(e,t){return(Rb[e]||100)-(Rb[t]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.constructor.getFieldDefinition(e)}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){var t;const r=this.fieldMap[e];if(!r){if(e.includes("[")){const[,n,,s]=e.match(_f),a=n.includes(".")?this.getFieldDefinition(n):this.fieldMap[n];if(a!=null&&a.isStoreDataField)return(t=a.modelClass)==null?void 0:t.getFieldDefinition(s)}else if(e.includes(".")){const[n,s]=e.split(".",2),a=this.fieldMap[n];if(a!=null&&a.isModelDataField&&a.modelClass)return a.modelClass.getFieldDefinition(s)}}return r}static getFieldDataSource(e){var t;return((t=this.getFieldDefinition(e))==null?void 0:t.dataSource)||e}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(t==null?void 0:t.dataSource)||(t==null?void 0:t.name)}static processField(e,t,r){const n=this.fieldMap[e];return n!=null&&n.convert?n.convert(t,this.data,r):t}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach(r=>{var n;r.modelRelations||r.initRelations();const s=[];(n=r.modelRelations)==null||n.forEach(a=>{s.push({related:e.initRelation(a),config:a})}),r.updateRecordRelationCache(e,s)})}initRelation(e){const t=this,r=t.get(e.foreignKey),n=r!==Dn&&typeof e.foreignStore!="string"&&e.foreignStore.getById(r),s=t.meta.relationCache||(t.meta.relationCache={});return s[e.relationName]=n||(r!=null?{id:r,placeHolder:!0}:null),n}removeRelation(e){const{relationName:t,foreignKey:r,nullFieldOnRemove:n}=e;this.meta.relationCache[t]&&(delete this.meta.relationCache[t],n&&this.setData(r,null))}getForeign(e){var t;return(t=this.meta.relationCache)==null?void 0:t[e]}setForeign(e,t,r){const n=Qc.asId(t);return this.set(r.foreignKey,n)}getRelationConfig(e){var t,r;return(r=(t=this.firstStore)==null?void 0:t.modelRelations)==null?void 0:r.find(n=>n.foreignKey===e)}flatGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:this.data[t]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:T.getPath(this.data,t)}get(e){if(!e)return;const t=this,{fieldMap:r}=t,n=r[e];if(!n){if(e.includes("[")){const[,s,a,l]=e.match(_f),o=r[s];if(o!=null&&o.getAt){t._thisIsAUsedExpression(t[s]);const d=o.getAt(t,a);return d&&l?d.isModel?d.getValue(l):d[l]:d}return null}if(e.includes(".")){const[s,a]=e.split(".",2),l=r[s];if(l!=null&&l.isStoreDataField){const o=t[s],d=o.modelClass;return a in d.fieldMap||!(a in o)?o==null?void 0:o.getDistinctValues(a):o[a]}else if(!T.hasPath(t.data,e))return T.getPath(t,e);return t.complexGet(e,e)}}return n!=null&&n.complexMapping?t.complexGet(e,n.dataSource):t.flatGet(e,(n==null?void 0:n.dataSource)||e)}getValue(e){if(e)return e in this&&!e.includes(".")?this[e]:this.get(e)}setValue(e,t){e in this?this[e]=t:this.set(e,t)}setData(e,t){var r,n;const{data:s,fieldMap:a}=this;if(typeof e=="string"){const l=a[e],o=(r=l==null?void 0:l.dataSource)!=null?r:e;l!=null&&l.set?l.set(t,this.data,this):l!=null&&l.complexMapping?T.setPath(s,o,t):s[o]=t,l==="id"?this._id=t:e==="parentId"&&(s[this.constructor.parentIdField]=t)}else{const l=Object.keys(e);for(let o=0;o<l.length;o++){const d=l[o],c=a[d],u=(n=c==null?void 0:c.dataSource)!=null?n:d;c!=null&&c.set?c.set(t,this.data,this):u&&(c!=null&&c.complexMapping?T.setPath(s,u,e[d]):s[u]=e[d],d==="id"?this._id=t:d==="parentId"&&(s[this.constructor.parentIdField]=t))}}}getData(e){var t;const r=this.fieldMap[e],n=(t=r==null?void 0:r.dataSource)!=null?t:e;if(n)return r!=null&&r.complexMapping?T.getPath(this.data,n):this.data[n]}syncId(e){const t=this.id;if(t!==e){this._id=e,this.setData("id",e);const r={id:{value:e,oldValue:t}};this.afterChange(r,r)}}set(e,t,r=!1,n=!1,s=!1,a=!1,l=!0){var o;const d=this;if(d.isBatchUpdating)d.inBatchSet(e,t,r||d.$silenceBatch);else{const c=d.inSet(e,t,r,n,s,a,l);return(o=d.afterSet)==null||o.call(d,e,t,r,n,c),c}}updateDependentFieldValues(e){if(typeof e=="object")Object.keys(e).forEach(t=>this.updateDependentFieldValues(t));else{e.startsWith("#")&&(e=e.substring(0));for(const[t,r]of Object.entries(this.constructor.dependentFields||{}))e in r&&this.set(t,this.get(`#${t}`))}}fieldToKeys(e,t){return typeof e!="string"?T.assign({},e):{[e]:t}}inBatchSet(e,t,r){var n;const s=this,{meta:a,constructor:l,fieldMap:o}=s,d={};let c,u=!1;if(typeof e!="string"?Object.keys(s.fieldToKeys(e,t)).forEach(h=>{c=o[h]||T,t=l.processField(h,e[h],s),c.isEqual(a.batchChanges[h],t)||(d[h]={value:t,oldValue:s.get(h)},a.batchChanges[h]=t,u=!0)}):(c=o[e]||T,c.isEqual(a.batchChanges[e],t)||(d[e]={value:t,oldValue:s.get(e)},a.batchChanges[e]=t,u=!0)),u&&(s.generation++,!r)){const h={action:"update",record:s,records:[s],changes:d};(n=s.stores)==null||n.forEach(g=>g.trigger("batchedUpdate",{...h})),s.forEachLinked((g,f)=>g.trigger("batchedUpdate",{...h,record:f,records:[f]}))}}inSet(e,t,r,n,s=!1,a=!1,l=!0){var o,d,c,u,h,g,f,m,p,v,b,w,D,S,x,R;const M=this,{data:_,meta:k,fieldMap:F,constructor:I}=M,{prototype:A,childrenField:P,relations:H}=I,G={},q=M.fieldToKeys(e,t),W=Object.keys(q).sort(I.fieldSorter),j=(o=M.stores)==null?void 0:o.some(ce=>ce.isSyncingDataOnLoad),se=(d=M.stores)==null?void 0:d.some(ce=>ce.modificationsTracking>0);if(!r&&l&&!M.triggerBeforeUpdate(q))return null;let J=!1,Q,X,ee;if(typeof e=="object"&&Object.keys(e).length===1&&(t=Object.values(e)[0],e=Object.keys(e)[0]),typeof e=="string"&&(Q=M.getFieldDefinition(e))&&Q.formulaProviders){const ce=(c=t==null?void 0:t.match(Q.inputPrefixRE))==null?void 0:c[1];ee=`#${e}`,X=(u=Q.formulaProviders[ce])==null?void 0:u.instance,X||(X=(h=Q.getFormulaProvider)==null?void 0:h.call(Q,ce)),W.push(ee),q[ee]=t}if(X){const{formulaRE:ce}=X,ae=ce?(m=(f=(g=t.trim()).match)==null?void 0:f.call(g,ce))==null?void 0:m[1]:t;if(ae){const Ie=M.constructor,ue=Ie.dependentFields||(Ie.dependentFields={}),Ne=X.createFormula(ae,M,M.firstStore),ye=X.calculate(Ne);(v=(p=ae==null?void 0:ae.matchAll(X.fieldMatchRE))==null?void 0:p.forEach)==null||v.call(p,([,Ee])=>{Ee!==e&&((ue[e]||(ue[e]={}))[Ee]=1)}),q[e]=ye,k.pendingFormulae=(k.pendingFormulae||0)+1;try{(b=ye.then)==null||b.call(ye,Ee=>{k.pendingFormulae=Math.max(0,k.pendingFormulae-1),M.set({[e]:Ee,[ee]:t})})}catch(Ee){k.pendingFormulae=Math.max(0,k.pendingFormulae-1),M.firstStore.trigger("formulaError",{record:M,field:e,error:Ee,formula:t}),M.set(e,"")}}}M.inSetting=!0;for(let ce=0;ce<W.length;ce++){const ae=W[ce];if(ae===P)continue;if(ae.includes("[")){const[,wr,mn,Fv]=ae.match(_f),Eo=M.fieldMap[wr];if(Eo!=null&&Eo.getAt){const tu=(D=Eo.getAt(M,mn))!=null?D:(w=Eo.onSubRecordMissingInSet)==null?void 0:w.call(Eo,M,mn);if(tu==null)throw new Error(`The store field '${wr}' does not contain a record at index ${mn} - can not set the data`);tu.isModel?tu.set(Fv,q[ae]):T.setPath(tu,Fv,q[ae]);continue}}const Ie=ae.includes(".");if(H&&Ie){const[,wr,mn]=ae.match(xb);if(H[wr]){mn.includes(".")?M[wr].set(mn,q[ae]):M[wr][mn]=q[ae];continue}}const ue=F[ae],Ne=ue||T,ye=ue==null?void 0:ue.readOnly,Ee=(S=ue==null?void 0:ue.dataSource)!=null?S:ae,Ye=!s&&!ue&&ae in A||(ue==null?void 0:ue.useProp),xe=Ye?M[Ee]:ue!=null&&ue.complexMapping||Ie?T.getPath(_,Ee):_[Ee],he=I.processField(ae,q[ae],M),st=q[ae]={value:he},Do=T.isPromise(he),fn=M.getRelationConfig(ae);!ye&&(j&&(ue!=null&&ue.bypassEqualityOnSyncDataset)||!Ne.isEqual(xe,he))&&(!a||he!==void 0)&&(M.generation++,st.oldValue=(R=(x=ue==null?void 0:ue.getOldValue)==null?void 0:x.call(ue,M))!=null?R:xe,J=!0,ae in k.modified&&Ne.isEqual(k.modified[ae],he,!1,!0)?(Reflect.deleteProperty(k.modified,ae),M.isReverting&&(M.data[Ee]=he)):!M.ignoreBag&&!se?(!(ae in k.modified)&&!(xe==null&&he==null)&&!Do&&M.storeFieldChange(ae,xe),st.oldValue===Dn&&Reflect.deleteProperty(st,"oldValue")):se&&Reflect.deleteProperty(k.modified,ae),G[ae]=st,M.applyValue(Ye,Ee,he,s,ue),fn&&!n&&(M.initRelation(fn),M.stores.forEach(wr=>wr.cacheRelatedRecord(M,he,fn.relationName,st.oldValue))))}return J&&M.afterChange(q,G,r,n,s),M.updateDependentFieldValues(e),M.inSetting=!1,J?G:null}applyValue(e,t,r,n,s){var a,l;const o=this;if(((s==null?void 0:s.dataSource)||t)===o.constructor.idField&&(o.$isPhantom=!1,o._id=r),((s==null?void 0:s.dataSource)||t)===o.constructor.parentIdField)(a=o.firstStore)!=null&&a.tree&&!((l=o.parent)!=null&&l.isRoot&&(r==null||!o.firstStore.getById(r)))&&(o.firstStore.getById(r)||o.firstStore.rootNode).insertChild(o,null,!1,{orderedParentIndex:{skip:!0}});else if(e)o[(s==null?void 0:s.name)||t]=r;else if(s!=null&&s.set)s.set(r,o.data,o);else{let d=s==null?void 0:s.complexMapping;if(!s&&t.includes(".")){const c=t.split(".")[0];s=o.constructor.fieldMap[c],d=(s==null?void 0:s.complexMapping)||(s==null?void 0:s.type)==="object"}d?T.setPath(o.data,t,r):o.data[t]=r}}afterChange(e,t,r,n,s){const a=this.updateDependentFields(Object.keys(t));if(a&&Object.assign(t,a),this.stores)for(const l of this.stores)l.onModelChange(this,e,t,r,n,s);this.forEachLinked((l,o)=>l.onModelChange(o,e,t,r,n,s))}updateDependentFields(e){const t={};return e.forEach(r=>{var n,s;(s=(n=this.getFieldDefinition(r))==null?void 0:n.dependentFields)==null||s.forEach(a=>{const l=this.fieldMap[a],o=this.refreshCalculatedField(l);t[a]=o})}),Object.keys(t).length>0?this.set(t,void 0,!0):t}refreshCalculatedField(e){var t;const r=this;typeof e=="string"&&(e=r.getFieldDefinition(e));const n=(t=e.calculate)==null?void 0:t.fn.call(e,r);return T.isPromise(n)&&(r.isConstructing?r.data[e.name]=n:r[e.name]=n,n.then(s=>r[e.name]=s)),n}forEachLinked(e){for(const t of this.$links)for(const r of t.stores)e(r,t)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return!!(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!T.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getUnmodified(e){return this.isModified?this.meta.modified[e]:this.get(e)}getFieldPersistentValue(e){const t=typeof e=="string"?this.getFieldDefinition(e):e,r=(t==null?void 0:t.name)||e;let n;return(!t||t.persist)&&(n=this.getValue(r),t!=null&&t.serialize&&(n=t.serialize(n,this))),n}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach(n=>{const s=e.getFieldPersistentValue(n);s!==Dn&&(t[n]=s,r=!0)}),r?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&T.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,r={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach(s=>{let a=t[s],l=a==null?void 0:a.dataSource;if(s.includes(".")){const o=s.match(xb)[1];a=t[o],l=s}if(a!=null&&a.persist){const o=e.getFieldPersistentValue(s);o!==Dn&&(T.setPath(r,l,o),n=!0)}}),n?r:null}get modificationDataToWrite(){const e=this,{modificationData:t,constructor:r}=e,n=t!=null?t:{},s=r.alwaysWriteFields;let a=!!t;return s.forEach(l=>{T.setPath(n,l.dataSource,e.getFieldPersistentValue(l)),a=!0}),a&&!t&&T.setPath(n,r.idField,e.id),a?n:null}get persistableData(){const e=this,t={};return e.fields.forEach(r=>{const n=e.getFieldPersistentValue(r);n!==Dn&&(r!=null&&r.complexMapping?T.setPath(t,r.dataSource,n):t[r.dataSource]=n)}),t}get dataByFieldName(){const{data:e}=this;return this.fields.reduce((t,r)=>(T.hasPath(e,r.dataSource)&&(t[r.name]=e[r.dataSource]),t),{})}get isCommitting(){return!!this.meta.committing}clearChanges(e){var t;this.internalClearChanges(e),(t=this.stores)==null||t.forEach(r=>r.trigger("clearChanges",{record:this}))}internalClearChanges(e=!0,t=!0,r=null,n=!1){var s,a,l;const o=this,{meta:d}=o;if(r){const{modified:u}=d;for(const h in r)delete u[h];for(const h in u)((s=u[h])!=null&&s.isStore&&!u[h].changes||n&&!((a=o.getFieldDefinition(h))!=null&&a.persist))&&delete u[h]}else d.modified=Object.assign({},d.modifiedMaterialized),d.modifiedMaterialized=null;const c=T.isEmpty(d.modified);d.committing=!1,t&&((l=o.stores)==null||l.forEach(u=>{if(c&&u.modified.remove(o),u.added.remove(o),e){const h=u.collectDescendants(o).all;u.added.remove(h),c&&u.modified.remove(h)}}))}storeFieldChange(e,t){var r;const{meta:n}=this;n.modified[e]=t,this.isBeingMaterialized&&(n.modifiedMaterialized=(r=n.modifiedMaterialized)!=null?r:{},n.modifiedMaterialized[e]=t)}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,Dn,e),this.isReverting=!1}setByDataSource(e){var t;const r=this,{fieldDataSourceMap:n}=r.constructor,s=T.pathifyKeys(e,n),a={};for(const l in s){const o=n[l],d=(t=o==null?void 0:o.name)!=null?t:l;a[d]=s[l]}return r.set(a)}applyChangeset(e,t="$PhantomId",r=!0){var n;const s=this,a=s.constructor,{idField:l,fieldDataSourceMap:o}=a,d=T.pathifyKeys(e,o),c=T.pathifyKeys(s.modificationData),u={};!(t in e&&!(l in e))&&t in d&&delete d[t];for(const f in d){const m=o[f],p=(n=m==null?void 0:m.name)!=null?n:f;(r||c[f]===d[f])&&(u[p]=d[f])}const g=s.set(u);return s.internalClearChanges(!1,!0,u),g?Object.entries(g).reduce((f,[m,p])=>(f[m]=p.value,f),{}):{}}get internalId(){return this._internalId}get isPhantom(){return this.id===""||this.id==null||this.hasGeneratedId||!!this.$isPhantom}get isModel(){return!0}get hasGeneratedId(){return typeof this.id=="string"&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${O.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return e!=null&&e.isModel?e.id:T.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return O.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:t}=this,r=this.persistableData;return(t||e)&&(r[this.constructor.childrenField]=(t||e).map(n=>n.toJSON())),r}toString(){const e=this,t=sT.find(n=>n in e.constructor.fieldMap),r=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return O.safeJsonStringify(r)}get isBatchUpdating(){return!!this.batching}hasBatchedChange(e){var t,r;return(r=(t=this.meta)==null?void 0:t.batchChanges)==null?void 0:r[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1,r=!0){const n=this,{parentIdField:s}=n.constructor;if(n.batching&&(n.batching--,n.$silenceBatch&&n.$silenceBatch--,!(n.batching>0)&&!T.isEmpty(n.meta.batchChanges))){let{batchChanges:a}=n.meta;n.meta.batchChanges=null,a[s]&&(a={...a},n.parentId=a[s],delete a[s]),n.set(a,Dn,e,!1,t,void 0,r)}}cancelBatch(){var e;if(this.batching){const t=this,{batchChanges:r}=t.meta,n={};if(t.batching=null,t.meta.batchChanges=null,t.generation++,!t.$silenceBatch){Object.entries(r).forEach(([a,l])=>{n[a]={oldValue:l,value:t[a]}});const s={action:"update",record:t,records:[t],changes:n};(e=t.stores)==null||e.forEach(a=>a.trigger("batchedUpdate",{...s})),t.forEachLinked((a,l)=>a.trigger("batchedUpdate",{...s,record:l,records:[l]}))}t.$silenceBatch&&t.$silenceBatch--}}triggerBeforeUpdate(e){var t;return!((t=this.stores)!=null&&t.some(r=>r.trigger("beforeUpdate",{record:this,changes:e})===!1))}copy(e=null,t){const r=this,n=T.clone(r.data),s=r.constructor.idField,a=T.isObject(t)?t.deep:t;let l;if(e&&typeof e=="object"?(l=e[s],Object.assign(n,e)):l=e,a&&r.children?n.children=r.children.map(d=>d.copy(e===!1?!1:void 0,t)):(delete n.children,delete n.expanded),r.$meta.fields.initable.length>0){const d=r.toJSON();for(const c of r.$meta.fields.initable)n[c.name]=d[c.name]}e!==!1&&(n[s]=l||r.generateId(r.firstStore));const o=new r.constructor(n,null,null,!1,!0);return o.originalInternalId=r.internalId,o.copyOf=r,o}copyData(e,t,r){const n={},s=this.skipCopyFields||{};e.allFields.forEach(({name:a})=>{a!==e.constructor.idField&&!(a in s)&&(n[a]=t?e.get(a):e.getValue(a))}),this.set(n,null,r)}remove(e=!1){const t=this,{parent:r,stores:n}=t;r?r.removeChild(t,!1,e,{unfiltered:!0}):n!=null&&n.length&&!t.isSpecialRow&&n.slice().forEach(a=>a.remove(t,e,!1,!0))}beforeRemove(e,t){return super.beforeRemove(e,t)}get isValid(){return!0}get firstStore(){var e;return(e=this.stores)==null?void 0:e[0]}joinStore(e){var t,r;const n=this;(!n.stores||!n.stores.includes(e))&&(super.joinStore(e),e.register(n),n.stores?n.stores.push(e):n.stores=[e],n.unjoinedStores&&n.unjoinedStores.includes(e)&&n.unjoinedStores.splice(n.unjoinedStores.indexOf(e),1),(t=n.children)!=null&&t.length&&n.children.forEach(s=>s.joinStore(e)),n.constructor.exposedRelations&&n.initRelations(),e.tree&&!n.isRoot&&!((r=e.stm)!=null&&r.isRestoring)&&(n.instanceMeta(e.id).collapsed=!n.expanded))}unjoinStore(e,t=!1){var r,n,s;const a=this,{stores:l}=a;l!=null&&l.includes(e)&&(e.isDestroying||(e.unregister(a),a.unjoinedStores?a.unjoinedStores.push(e):a.unjoinedStores=[e]),(n=(r=a.unfilteredChildren||a.children)==null?void 0:r.forEach)==null||n.call(r,o=>o.unjoinStore(e,t)),l.splice(l.indexOf(e),1),(s=super.unjoinStore)==null||s.call(this,e,t),e.uncacheRelatedRecord(a),a.meta.map&&!e.stm&&delete a.meta.map[e.id])}isPartOfStore(e){var t;return e?e.includes(this):((t=this.stores)==null?void 0:t.length)>0}get isRemoved(){return!this.isPartOfStore()}isEditable(e){const t=this.getFieldDefinition(e);return t!=null&&t.calculated?!1:this.readOnly?e==="readOnly":t?!0:void 0}instanceMeta(e){var t;const{meta:r}=this,n=e.id||e;return((t=r.map)==null?void 0:t[n])||this.setInstanceMeta(n,{})}setInstanceMeta(e,t){const{meta:r}=this,n=e.id||e;return r.map||(r.map={}),r.map[n]=t}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return!!((e=this.meta)!=null&&e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach(t=>{(!t.persist||t.calculated)&&(e._nonPersistableFields[t.name]=1)})),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=e.allFields.filter(t=>t.alwaysWrite)),e._alwaysWriteFields}get domId(){return typeof this.id=="string"?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:t}=this.$meta,r=t[t.length-2],n=t[t.length-3];return`class ${r} extends ${n} { static fields = ${O.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:t,children:r}=this,{defaultValues:n,applyConfigs:s}=this.constructor,a=s?super.getCurrentConfig(e):{};if(a){for(const l of this.fields)if(l.persist){const o=T.getPath(t,l.dataSource);o!=null&&!l.isEqual(o,n[l.name])&&T.setPath(a,l.dataSource,$.processConfigValue(o,e))}if(r)if(Array.isArray(r)){a.children=[];for(const l of r)a.children.push(l.getCurrentConfig(e))}else a.children=r;this.hasGeneratedId&&delete a.id,delete a.parentId,delete a.parentIndex}return a}};y(kf,"$name","Model"),y(kf,"relations",null);var me=kf;me._idField="id",me._internalIdCounter=1,me._assignedIdField=!1,me.exposeProperties(),me._$name="Model";var Ui=class{static preWalk(i,e,t){const r=[i];let n,s;for(;r.length;)n=r.pop(),t(n),s=e(n),s&&r.push.apply(r,s.slice().reverse())}static walkWhile(i,e,t){const r=Array.isArray(i)?[...i]:[i];let n,s;for(;r.length;){if(n=r.pop(),!t(n))return!1;s=e(n),Array.isArray(s)&&r.push(...s)}return!0}static preWalkWithParent(i,e,t){const r=[{node:i,parent:null}];for(;r.length;){const{parent:n,node:s}=r.pop();t(n,s);const a=e(s);Array.isArray(a)&&r.push(...a.slice().reverse().map(l=>({node:l,parent:s})))}}static preWalkUnordered(i,e,t){const r=[i];let n,s;for(;r.length;)n=r.pop(),t(n),s=e(n),s&&r.push.apply(r,s)}static postWalk(i,e,t){const r=new Map,n=[i];let s,a;for(;n.length;)s=n[n.length-1],r.has(s)?(t(s),n.pop()):(a=e(s),a&&n.push(...a.slice().reverse()),r.set(s,s))}static prePostWalk(i,e,t,r){const n=new Map,s=[i];let a,l;for(;s.length;)a=s[s.length-1],n.has(a)?(r(a),s.pop()):(t(a),l=e(a),l&&s.push(...l.slice().reverse()),n.set(a,a))}};Ui._$name="WalkHelper";var Tb=Object.hasOwn||((i,e)=>Object.prototype.hasOwnProperty.call(i,e)),Ff=null;function lT(i,e){return Object.defineProperty(i,"parser",{value:e}),e}var oT=class{constructor(i){this.formatter=i}format(i){return this.formatter.defaultFormat(i)}parse(i,e){return this.formatter.defaultParse(i,e)}resolvedOptions(){return null}},zo=class{static get(i){if(i==null)return this.NULL;if(i instanceof this)return i;const e=typeof i=="string"?i:JSON.stringify(i),t=this.cache;let r=t.get(e);return r||(Ff=e,r=new this(i),t.set(e,r)),r}static get cache(){return Tb(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return Tb(this,"_null")?this._null:this._null=new this(null)}constructor(i){const e=this,{standardOptions:t}=e.constructor;if(e.cacheKey=Ff,Ff=null,e.initialize(),i===null)e.formatter=new oT(e);else{e.configure(i);for(const[r,n]of Object.entries(e.resolvedOptions()))n!=null&&t.includes(r)&&(e[r]=n)}}get parser(){return lT(this,new this.constructor.Parser(this))}defaultFormat(i){return i==null?i:String(i)}defaultParse(i){return i}format(i){return i==null?i:this.formatter.format(i)}parse(i,e){return i==null?i:this.parser.parse(i,e)}parseStrict(i){return this.parse(i,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}};y(zo,"standardOptions",Object.freeze([])),zo._$name="Formatter";var Cu=O.escapeRegExp,Mb=/[\d+-]/g,wu=(i,e)=>new Intl.NumberFormat(i||void 0,e),dT=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,cT="\u2212",uT=class{constructor(i){const e=this,t=i.locale,r=wu(t,{maximumFractionDigits:3}),n=i.is.currency?e._decodeStyle(t,{style:"currency",currency:i.currency,currencyDisplay:i.currencyDisplay}):null,s=i.is.percent?e._decodeStyle(t,{style:"percent"}):null,a=r.format(1.2).replace(Mb,"")[0],l=r.format(1e9).replace(Mb,"")[0]||"";Object.assign(e,{currency:n,decimal:a,formatter:i,grouper:l,percent:s}),e.decimal=a,e.decimalRe=Cu(a,"g"),e.grouper=l,e.stripRe=new RegExp(`(?:\\s+|${Cu(l)})`+(n?`|(?:${Cu(n.text)})`:"")+(s?`|(?:${Cu(s.text)})`:""),"g")}decimalPlaces(i){i=i.replace(this.stripRe,"");const e=i.indexOf(this.decimal)+1;return e&&i.length-e}parse(i,e){return typeof i=="string"&&(i=i.replace(this.stripRe,"").replace(this.decimalRe,".").replace(cT,"-"),i=e?Number(i):parseFloat(i),this.formatter.is.percent&&(i/=100)),i}_decodeStyle(i,e){const t=wu(i,e),r=wu(i,Object.assign(t.resolvedOptions(),{style:"decimal"})),n=t.format(0),s=r.format(0);return{suffix:n.startsWith(s),text:n.replace(s,"").trim()}}},Wo=class bv extends zo{constructor(){super(...arguments),y(this,"decimalSeparator"),y(this,"groupSeparator")}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits+(this.is.percent?2:1),t=Math.min(20,e);return this.as({style:"decimal",maximumFractionDigits:t,minimumFractionDigits:t},"truncator")}configure(e){var t,r;const{decimalSeparator:n,groupSeparator:s}=bv;Object.assign(this,{...n?{decimalSeparator:n}:{},...s?{groupSeparator:s}:{}}),typeof e!="string"?Object.assign(this,e):this.template=e;const a=this,l={},o=a.locale?Le.locales[a.locale]||Object.values(Le.locales).find(h=>h.localeCode===a.locale):Le.locale,d=o==null?void 0:o.NumberFormat,{template:c}=a,{standardOptions:u}=a.constructor;if(d)for(const h in d)a[h]==null&&typeof d[h]!="function"&&(a[h]=d[h]);if(c){const h=dT.exec(c),g=h[2],f=h[4];a.useGrouping=!!h[3],a.style=h[1]?"currency":h[6]?"percent":"decimal",g&&(a.integer=+g),f==="*"?a.fraction=[0,20]:f!=null&&(a.fraction=[h[5].length,f.length])}a._minMax("fraction",!0,!0),a._minMax("integer",!0,!1),a._minMax("significant",!1,!0);for(const h of u)a[h]!=null&&(l[h]=a[h]);if(a.is.from=a.from&&a.from.is,a.is[a.style]=!(a.is.null=!1),a.formatter=wu(a.locale,l),a.decimalSeparator||a.groupSeparator){const{groupSeparator:h,decimalSeparator:g}=a.getLocaleSeparators();a.separatorRegex=new RegExp(`[${h}${g}]`,"g"),a.separatorReplace={[h]:(t=a.groupSeparator)!=null?t:h,[g]:(r=a.decimalSeparator)!=null?r:g}}}as(e,t=null){const r=this.resolvedOptions()||{template:"9.*"},n=this._as;let s=t&&n[t];return s||(typeof e=="string"?r.style=e:Object.assign(r,e),r.from=this,s=new bv(r)),t&&(n[t]=s),s}defaultParse(e,t){return e==null?e:t?Number(e):parseFloat(e)}getLocaleSeparators(){const e=this.formatter.formatToParts(123456789e-2);let t=".",r=",";for(const n of e)n.type==="decimal"&&(t=n.value),n.type==="group"&&(r=n.value);return{decimalSeparator:t,groupSeparator:r}}format(e){const t=this,{separatorRegex:r,separatorReplace:n}=t;if(typeof e=="string"){const s=Number(e);e=isNaN(s)?t.parse(e):s}return e=super.format(e),r&&(e=String(e).replace(r,s=>n[s])),e}round(e){return this.parse(this.format(e))}truncate(e){const t=this,r=t.maximumFractionDigits+(t.is.percent?2:0),{truncator:n}=t;let s=t.parse(e),a;return n&&(s=n.format(s),a=s.indexOf(n.parser.decimal),a>-1&&s.length-a-1>r&&(s=s.slice(0,a+r+1)),s=n.parse(s)),s}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)e[t]===void 0&&(e[t]=this[t]);return e}_minMax(e,t,r){const n=this,s=n[e];if(s!=null){const a=O.capitalize(e),l=`maximum${a}Digits`,o=`minimum${a}Digits`;typeof s=="number"?(t&&(n[o]=s),r&&(n[l]=s)):(n[o]=s[0],n[l]=s[1])}}};y(Wo,"$name","NumberFormat"),y(Wo,"decimalSeparator"),y(Wo,"groupSeparator"),y(Wo,"standardOptions",["currency","currencyDisplay","locale","maximumFractionDigits","minimumFractionDigits","minimumIntegerDigits","maximumSignificantDigits","minimumSignificantDigits","style","useGrouping"]);var wi=Wo;wi.Parser=uT,Object.assign(wi.prototype,{currency:null,currencyDisplay:"symbol",fraction:null,from:null,integer:null,locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,significant:null,style:"decimal",template:null,useGrouping:!0}),zo.number=(i,e)=>wi.get(i).format(e),Le.ion({locale:()=>wi.cache.clear()}),wi._$name="NumberFormat";var we=class bo{constructor(e,t){typeof e=="number"||e===null?(this._magnitude=e,this._unit=t):(typeof e=="string"&&Object.assign(this,C.parseDuration(e)),typeof e=="object"&&(this.magnitude=e.magnitude,this.unit=e.unit))}static from(e){return e==null?null:e.isDuration?e:new bo(e)}negate(){return new bo(-this.magnitude,this.unit)}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=typeof e=="number"&&e}get unit(){return this._unit}set unit(e){this._unit=C.parseTimeUnit(e)}get isValid(){return this._magnitude!=null&&!!C.normalizeUnit(this._unit)}get milliseconds(){return this.isValid?Math.round(C.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return!!e&&this._magnitude!=null&&e._magnitude!=null&&this.milliseconds===e.milliseconds}toString(e,t=10){const r=this,n=e?"getShortNameOfUnit":"getLocalizedNameOfUnit",s=e?"":" ";return r.isValid?`${wi.get("9."+"#".repeat(t)).format(r._magnitude)}${s}${C[n](r._unit,Math.abs(r._magnitude)!==1)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}add(e){return new bo({unit:this.unit,magnitude:C.as(this.unit,this.milliseconds+new bo({magnitude:e.magnitude,unit:e.unit||this.unit}).milliseconds)})}diff(e){return new bo({unit:this.unit,magnitude:C.as(this.unit,this.milliseconds-e.milliseconds)})}};we._$name="Duration";var hT=(i,e)=>i==null?void 0:i[e],gT=/^is(this|next|last)(week|month|year)$/i,fT=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],_b=class Tg extends $.mixin(Oo){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){typeof e=="function"&&(e={filterBy:e}),e.type?e.type==="date"&&e.value!=null?Array.isArray(e.value)?e.value=e.value.map(t=>t instanceof Date?t:new Date(t)):e.value=new Date(e.value):e.type==="duration"&&e.value!=null&&(Array.isArray(e.value)?e.value=e.value.map(t=>t.isDuration?t:new we(t)):e.value=new we(e.value)):C.isDate(e.value)||Array.isArray(e.value)&&e.value.every(C.isDate)?e.type="date":e.value instanceof we&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=Tg.generateId(`b-internal-${this.property}-filter-`):this._id=this.property&&`${this.property}-${this.operator}`||Tg.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var t;const r=this;!r.isConfiguring&&((t=r.owner)!=null&&t.onFilterChanged)&&!r.owner.isConfiguring&&r.owner.onFilterChanged(r,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let r;return e.isModel?r=e.getValue(t.property):t._propertyItems.length>1?r=t._propertyItems.reduce(hT,e):r=e[t.property],t[t.operator](t.convert(r))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&typeof e[0]=="string")?t._filterValue=e.map(r=>t.convert(r)):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&typeof e[0]=="string"?t._filterValue=e.map(r=>r==null?void 0:r.toLowerCase()):!t.caseSensitive&&typeof e=="string"?t._filterValue=e.toLowerCase():t._filterValue=t.convert(e),t.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":typeof e.filterValue=="string"?"*":"="}convert(e){var t;const r=this;return r.operator!=="sameTime"&&r.operator!=="notSameTime"&&!(typeof r.filterValue=="string"&&e instanceof Date)&&((r.operator==="sameDay"||r.operator==="notSameDay")&&(e=C.clearTime(e)),e=(t=e==null?void 0:e.valueOf())!=null?t:e),e=!r.caseSensitive&&typeof e=="string"?e.toLowerCase():e,e}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return this.filterValue.length===0||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return this.filterValue.length===0||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return e!=null&&C.isSameTime(e,this.filterValue)}notSameTime(e){return!this.sameTime(e)}sameDay(e){return e===this.filterValue}notSameDay(e){return e!==this.filterValue}"="(e){return T.isEqual(e,this.filterValue)}"!="(e){return!T.isEqual(e,this.filterValue)}">"(e){return T.isMoreThan(e,this.filterValue)}">="(e){return T.isMoreThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"<"(e){return T.isLessThan(e,this.filterValue)}"<="(e){return T.isLessThan(e,this.filterValue)||T.isEqual(e,this.filterValue)}"*"(e){return T.isPartial(e,this.filterValue)}between(e){const[t,r]=this._filterValue;return(T.isMoreThan(e,t)||T.isEqual(e,t))&&(T.isLessThan(e,r)||T.isEqual(e,r))}notBetween(e){return!this.between(e)}betweenLesser(e){const[t,r]=this._filterValue;return e>=t&&e<r}empty(e){return e==null||String(e).length===0}notEmpty(e){return!this.empty(e)}isToday(e){return this.betweenLesser(e)}isTomorrow(e){return this.betweenLesser(e)}isYesterday(e){return this.betweenLesser(e)}isThisWeek(e){return this.betweenLesser(e)}isNextWeek(e){return this.betweenLesser(e)}isLastWeek(e){return this.betweenLesser(e)}isThisMonth(e){return this.betweenLesser(e)}isNextMonth(e){return this.betweenLesser(e)}isLastMonth(e){return this.betweenLesser(e)}isThisYear(e){return this.betweenLesser(e)}isNextYear(e){return this.betweenLesser(e)}isLastYear(e){return this.betweenLesser(e)}isYearToDate(e){return this.between(e)}isTrue(e){return e===!0}isFalse(e){return e===!1}getState(){const{caseSensitive:e,disabled:t,id:r,internal:n,operator:s,property:a,type:l,value:o,columnOwned:d,filterBy:c}=this,u={caseSensitive:e,disabled:t,id:r,internal:n,operator:s,property:a,type:l,value:o,columnOwned:d,filterBy:c};return T.cleanupProperties(u,!0),u.filterBy===this.defaultFilterBy&&delete u.filterBy,u}setRelativeDateValues(){this._filterValue=Tg.getRelativeDateRange(this._operator).map(e=>e.valueOf())}get isNoOp(){var e;return(this.operator==="includes"||this.operator==="isIncludedIn")&&((e=this.filterValue)==null?void 0:e.length)===0}static getRelativeDateRange(e,t=new Date){let r,n,s,a,l,o,d;switch(e){case"isYearToDate":return[C.floor(t,"1 year"),t];case"isToday":return r=C.floor(t,"1 day"),[r,C.add(r,1,"day")];case"isYesterday":return r=C.floor(t,"1 day"),[C.add(r,-1,"day"),r];case"isTomorrow":return n=C.getStartOfNextDay(t),[n,C.add(n,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(s=e.toLowerCase().match(gT),!s)throw new Error(`Unrecognized relative date expression: ${e}`);return[,o,d]=s,a=`1 ${d}`,l=C.floor(t,a),o==="next"?l=C.add(l,1,d):o==="last"&&(l=C.add(l,-1,d)),[l,C.add(l,1,d)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return be.returnTrue;for(const t of e)t.type==="date"&&fT.includes(t._operator)&&t.setRelativeDateValues();return function(t){let r=!0;for(const n of e)if(n.disabled||(r=n.filter(t)),!r)break;return r}}};y(_b,"$name","CollectionFilter");var Je=_b;Je._$name="CollectionFilter";var If=T.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),Si=class{static generateId(i="generatedId"){return i+(If[i]=(If[i]||0)+1)}static reset(i){If[i]=0}};Si._$name="IdHelper";var jo=class extends ${static get defaultConfig(){return{property:null,caseSensitive:!0,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(i){typeof i=="function"&&(i={sortFn:i}),super.construct(i)}get id(){return this._id||(this._id=this.property||Si.generateId("b-sorter"))}set id(i){this._id=i}set sortFn(i){this._sortFn=i}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(i,e){const t=this,{convert:r,property:n,useLocaleSort:s,caseSensitive:a}=t,l=t.direction.toLowerCase()==="desc"?-1:1;if(i=i[n],e=e[n],r&&(i=r(i),e=r(e)),a||(typeof i=="string"&&(i=i.toLowerCase()),typeof e=="string"&&(e=e.toLowerCase())),s&&i!=null&&e!=null&&typeof i=="string"){if(s===!0)return i.localeCompare(e);if(typeof s=="string")return i.localeCompare(e,s);if(typeof s=="object")return i.localeCompare(e,s.locale,s)}return(i>e?1:i<e?-1:0)*l}static generateSortFunction(i,e){const t=i.isCollection?i.values:i,r=t.length;return(n,s)=>{let a,l,o;for(l=0;l<r;++l)if(o=t[l],a=o.sortFn(n,s,o.direction),a)return a;return e?e(n,s):0}}};jo._$name="CollectionSorter";var mT=()=>0,pT=(i,e)=>e-i,Af=Symbol("filteredIndicesProperty"),ta=Object.freeze([]),vT=Object.freeze({action:"sort",added:ta,removed:ta,replaced:ta}),yT=Object.freeze({action:"filter",added:ta,removed:ta,replaced:ta}),En={string:1,number:1};function kb(i,e,t,r){if(e.unique!==!1)e.set(t,i),r&&e.count++;else{let n=e.get(t);n||(n=new Set,e.set(t,n)),n.add(i)}}function bT(i,e,t){e.unique!==!1?e.delete(t):e.has(t)&&(e.get(t).delete(i),e.get(t).size||e.delete(t))}function Fb(i,e,t,r,n=!1){for(let s=0;s<i.length;s++){const a=i[s];if(a)for(let l=0;l<r;l++){const o=t[l],d=a[o],c=e[o];d!==void 0&&kb(a,c,d,!n&&c.onDuplicate)}}}var Bt=class Cv extends $.mixin(Fe){constructor(){super(...arguments),y(this,"_sortFunction",null),y(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),(e=t._sorters)==null||e.destroy()}clear(){const e=this,t=e._values.filter(r=>r);e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}equals(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:r}=this;return t&&(e=e.map(t),r=r.map(t)),B.delta(e,r).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:t,silent:r=!1,isNewDataset:n=!1}){const s=this;let a,l;s.isFiltered&&!n?(!!t?e&&(a=s._values,s._values=e.slice()):(t=e.slice(),e=null),l=s._filteredValues,s._filteredValues=t.slice()):(a=s._values,s._values=e.slice(),t=null,s.isFiltered&&n&&s.autoFilter?(s._filterFunction=null,s._filteredValues=s._values.filter(s.filterFunction)):s._filteredValues&&(s._filteredValues.length=0)),s._indicesInvalid=!0,s._addedValues=void 0,s.generation++,r||s.trigger("change",{action:"replaceValues",replacedValues:a,replacedFilteredValues:l,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}reduce(e,t=!1,r=[]){return(this.isFiltered&&!t?this._filteredValues:this._values).reduce(e,r)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,t=!0){const r=this,{_values:n}=r,s=[];return r.forEach(a=>{const l=e.get(a.id,!0);if(l){const o=r.indexOf(a,!0),d=n[o];n[o]=l,r.removeFromIndices(d),r.addToIndices(l)}else t&&s.push(a)}),s.length&&r.remove(s),r.isFiltered&&(r._filteredValues=r._values.filter(r.filterFunction)),s}add(...e){e.length===1?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){e.length===1?this.splice(0,...e):this.splice(0,e)}move(e,t){for(e=B.asArray(e);e.length&&e[0]===t;)e.shift();if(!e.length)return;const r=this,{_values:n}=r,s=r.indexOf(e[0],!0);if(e.length===1&&n[s+1]===t)return;r.suspendEvents(),r.remove(e),r.resumeEvents();const a=t?r.indexOf(t,!0):n.length;if(a===-1)throw new Error("Collection move beforeItem parameter must be present in Collection");return n.splice(a,0,...e),r._indicesInvalid=1,r.trigger("change",{action:"move",items:e,from:s,to:a}),a}splice(e=0,t,...r){const n=this,s=n.idProperty,a=n._values,l={},o=[],d=[],c=n.totalCount;let u,h;if((r==null?void 0:r.length)===1&&Array.isArray(r[0])&&(r=r[0]),n.trigger("beforeSplice",{index:e,toRemove:t,toAdd:r})!==!1){if(r)if(c&&r.length){const g=n.indices[s];u=[];for(let f=0;f<r.length;f++){const m=r[f],p=m[s],v=g.get(p),b=v?a.indexOf(v):-1;l[p]=!0,b!==-1?a[b]!==m&&(d.push([a[b],m]),a[b]=m):u.push(m)}}else u=r;if(t){if(typeof t=="number"){t=Math.min(t,a.length-e);for(let g=e;t;--t){const f=a[g][s];l[f]?(e++,g++):(o.push(a[g]),a.splice(g,1),h=!0)}}else{let g=u.length===0,f;t=B.asArray(t);const m=t.reduce((p,v)=>{const b=typeof v=="number",w=b?v:n.indexOf(v,!0);return g&&(f!=null&&w!==f+1||b)&&(g=!1),w>=0&&w<c&&p.push(w),f=w,p},[]).sort(pT);if(g)m.length&&(o.push.apply(o,t),a.splice(m[m.length-1],m.length),h=!0);else for(let p=0;p<m.length;p++){const v=m[p];if(v!==-1){const b=a[v][s];l[b]||(o.unshift(a[v]),a.splice(v,1),h=!0)}}}o.length&&!n._indicesInvalid&&o.forEach(n.removeFromIndices,n)}if(u.length){a.splice(Math.min(e,a.length),0,...u),h=!0,n._indicesInvalid||u.forEach(n.addToIndices,n),n._addedValues||(n._addedValues=new Set);for(const g of u)n._addedValues.add(g)}if(o.length&&n._addedValues)for(const g of o)n._addedValues.delete(g);d.length&&!n._indicesInvalid&&d.forEach(g=>{n.removeFromIndices(g[0]),n.addToIndices(g[1])}),h||d.length?(n.isSorted?n.onSortersChanged():n.isFiltered&&(n.autoFilter?n.onFiltersChanged({action:"splice",oldCount:1}):n._filteredValues.splice(Math.min(e,n._filteredValues.length),0,...u)),n.generation++,n.trigger("change",{action:"splice",removed:o,added:u,replaced:d,oldCount:c})):n.trigger("noChange",{index:e,toRemove:t,toAdd:r})}}changeId(e,t){const r=this,{idProperty:n}=r,s=En[typeof e]?e:e[n],a=r.get(s);if(a){const l=r.get(t);if(l&&a!==l)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);r.removeIndexEntry(e,n,s),r.addIndexEntry(e,n,t),a[n]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,r=!1){return this.findItem(e,t,this.isFiltered&&r)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new Cv({values:B.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof jo?e:new jo(e);return this.sorters.add(t),t}get isSorted(){var e;return!!((e=this._sorters)!=null&&e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",vT)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=jo.generateSortFunction(this.sorters.values):this._sortFunction=mT),this._sortFunction}get filters(){return this._filters||(this._filters=new Cv({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof Je?e:new Je(e);return this.filters.add(t),t}removeFilter(e){const{filters:t}=this;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return!!(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:t,oldCount:r}){const n=this,s=r||e==="clear"&&t.length?n._filteredValues:n._values;n._filterFunction=null,n._filteredValues=n._values.filter(n.filterFunction),n._indicesInvalid=!0;const{toAdd:a,toRemove:l}=B.delta(n._filteredValues,s,!0);n.trigger("change",{...yT,added:a,removed:l})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=Je.generateFiltersFunction(this.filters.values):this._filterFunction=be.returnTrue),this._filterFunction}changeExtraKeys(e){return B.asArray(e).map(r=>typeof r=="string"?{property:r,unique:!0}:r)}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){const t=this;e&&((t._indices||(t._indices={}))[e.property]=new Map,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}findIndex(e,t,r=!1){const n=this.findItem(e,t,r);return n?(this.isFiltered&&!r?this._filteredValues:this._values).indexOf(n):-1}findItem(e,t,r=!1){var n;const s=this,{isFiltered:a}=s,l=a&&!r?s.indices[Af][e]:s.indices[e];if(l){const o=(n=l.get(t))!=null?n:typeof t=="string"&&t.length&&!isNaN(t)&&l.get(Number(t))||null;if(o!=null)return o}else{const o=a&&!r?s._filteredValues:s._values,d=o.length;for(let c=0;c<d;c++){const u=o[c];if(u[e]==t)return u}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some(t=>t.dependentOn)}indexOf(e,t=!1){return this.findIndex(this.idProperty,En[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some(r=>this.includes(r)):!!this.findItem(this.idProperty,En[typeof e]?e:e[this.idProperty],t)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,r=e._indices||(e._indices={}),n=Object.keys(r),s=n.length,a=e._values;let l=!1,o;t&&(o=r[Af]={});for(let d=0;d<s;d++){const c=r[n[d]];if(c.clear(),c.onDuplicate&&(c.count=0,l=!0),t){let u=o[n[d]];u?u.clear():(u=o[n[d]]=new Map,u.unique=c.unique)}}if(Fb(a,r,n,s),l)for(let d=0;d<s;d++){const c=r[n[d]];if(c.onDuplicate&&c.count>c.size){const u=new Set;for(let h=0;h<a.length;h++){const g=a[h],f=g[n[d]];u.has(f)&&c.onDuplicate(g,f,c),u.add(f)}}}t&&Fb(e._filteredValues,o,n,s,!0),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[Af][e]),t}addToIndices(e){Object.keys(this.indices).forEach(t=>{this.addIndexEntry(e,t,e[t])})}removeFromIndices(e){Object.keys(this.indices).forEach(t=>{this.removeIndexEntry(e,t,e[t])})}removeIndexEntry(e,t,r){this.getIndices(t).forEach(n=>bT(e,n,r))}addIndexEntry(e,t,r){this.getIndices(t).forEach(n=>kb(e,n,r))}onItemMutation(e,t){const r=this;!r._indicesInvalid&&Object.keys(r.indices).length>1&&Object.keys(t).forEach(n=>{var s;if(r.indices[n]){const{value:l,oldValue:o}=t[n];r.removeIndexEntry(e,n,o),r.addIndexEntry(e,n,l)}if(r.hasCompositeIndex){const l=Object.values(r.indices).find(o=>{var d;return(d=o.dependentOn)==null?void 0:d[n]});if(l){const o={};for(const c in l.dependentOn)o[c]=((s=t[c])==null?void 0:s.oldValue)||e[c];const d=e.buildIndexKey(o);r.removeIndexEntry(e,l.property,d),r.addIndexEntry(e,l.property,e[l.property])}}})}};Bt._$name="Collection";var Ib=new WeakMap,Uo=i=>{if(i&&typeof i=="object"){let e=Ib.get(i);e===void 0&&(e=Symbol("bscik"),Ib.set(i,e)),i=e}return i},ia=class{constructor(i){const e=this;e.generation=0,e.items=new Set,e.idMap={},e.idProperty="id",i&&(i.idProperty&&(e.idProperty=i.idProperty),i.values&&(e.values=i.values))}get(i){return this.idMap[Uo(i)]}get count(){return this.items.size}add(...i){i.length===1&&Array.isArray(i[0])&&(i=i[0]);const e=this,{items:t,idMap:r,idProperty:n}=e,s=i.length;for(let a=0;a<s;a++){const l=i[a],o=En[typeof l]?l:Uo(l[n]),d=r[o];d==null?(r[o]=l,t.add(l),e.generation++):d!==l&&(r[o]=l,t.delete(d),t.add(l))}}at(i){let e,t;i<0&&(i+=this.count);for(e of this.items)if(!i--){t=e;break}return t}remove(i){i=B.asArray(i);const{items:e,idMap:t,idProperty:r}=this,n=i.length;for(let s=0;s<n;s++){const a=i[s],l=En[typeof a]?a:Uo(a[r]),o=t[l];o!=null&&(e.delete(o),delete t[l],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(i){let e=0,t;for(t of this.items)i(t)&&++e;return e}changeId(i,e){const t=this,{idMap:r,idProperty:n}=t,s=En[typeof i]?i:Uo(i[n]),a=t.get(s);if(a){const l=t.get(e);if(l&&a!==l)throw new Error(`Attempt to set item ${s} to already existing member's id ${e}`);a[n]=e,delete r[s],r[e]=a}}filter(i,e){const{items:t}=this,r=[];let n=0;return t.forEach(s=>{i.call(e,s,n++,t)&&r.push(s)}),r}includes(i){const e=En[typeof i]?i:Uo(i[this.idProperty]);return!!this.idMap[e]}map(i,e){const{items:t}=this,r=new Array(t.size);let n=0;return t.forEach(s=>{r[n]=i.call(e,s,n++,t)}),r}forEach(i,e){return this.items.forEach(i,e)}find(i,e=0){let t,r;e<0&&(e+=this.countOf(i));for(t of this.items)if(i(t)&&!e--){r=t;break}return r}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(i,e){let t=-1,r;for(r of this.items)if((!e||e(r))&&(++t,r===i))return t;return-1}get values(){return[...this.items]}set values(i){i=B.asArray(i),this.clear(),this.add.apply(this,i),this.generation++}get first(){for(const i of this.items)return i;return null}get last(){let i=null;for(const e of this.items)i=e;return i}sort(i){this.values=this.values.sort(i)}some(i,e){return this.values.some(i,e)}};ia._$name="Bag";var Su=class extends ia{add(...i){return i.length===1&&Array.isArray(i[0])&&(i=i[0]),super.add(...i.filter(e=>e.isPersistable))}};Su._$name="StoreBag";var Ab=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(t,r=!1){const n=this,{storage:s}=n;if(t=B.asArray(t).reduce((a,l)=>(l=n.getById(l),l&&a.push(l),a),[]),t.length===0)return t;if(!n.tree&&!r&&n.trigger("beforeRemove",{records:t})===!1)return[];if(n.isRemoving=!0,n.isGrouped){const a=s.count,l=[],o=new Set;for(const d of t){const{groupParent:c}=d.instanceMeta(n);c.meta.collapsed&&l.push(d),B.remove(c.groupChildren,d),B.remove(c.unfilteredGroupChildren,d),c.meta.childCount--,o.add(c)}for(const d of o)d.groupChildren.length>0&&n.onModelChange(d,{},{});l.length&&s.trigger("change",{action:"splice",removed:l,added:[],replaced:[],oldCount:a})}else if(n.tree){const a=[],l=new Set,o=t.length>1,d=t[0],c=o?void 0:s.indexOf(d),u=t.reduce((g,f)=>{const{parent:m}=f;return m&&(g[m.id]||(g[m.id]=[m,[]]),g[m.id][1].push(f)),g},{}),h=Array.from(Object.values(u));if(!r&&n.trigger("beforeRemove",{records:t,isMove:!1,parent:o?void 0:d.parent})===!1)return n.isRemoving=!1,[];n.suspendAutoCommit(),h.sort((g,f)=>f[0].childLevel-g[0].childLevel);for(const[g,f]of h)a.push(...g.removeChild(f,!1,!0,{skipIndexUpdate:!0})),l.add(g);for(const g of l)a.includes(g)||(g.updateChildrenIndices(g.children,"parentIndex"),g.unfilteredChildren&&g.updateChildrenIndices(g.unfilteredChildren,"unfilteredIndex"),g.orderedChildren&&g.updateChildrenIndices(g.orderedChildren,"orderedParentIndex"));return r||(n.trigger("remove",{parent:o?void 0:d.parent,index:c,isChild:!0,allRecords:a,isMove:!1,records:t}),n.trigger("change",{action:"remove",records:t})),n.resumeAutoCommit(),n.isRemoving=!1,t}if(t.length===0)return n.isRemoving=!1,t;for(const a of t)a.beforeRemove(t);return r&&n.suspendEvents(),s.remove(t),r&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,t}clear(t=!1){var r,n;const s=this,{storage:a}=s;if(s.storage.totalCount||(n=(r=s.rootNode)==null?void 0:r.unfilteredChildren)!=null&&n.length){if(!t&&s.trigger("beforeRemove",{records:a.allValues,removingAll:!0})===!1)return null;if(s.rootNode)if(s.isChained&&!s.isChainedTree){const l=s.getAllDataRecords();for(let o=l.length-1,d;o>=0;o--)d=l[o],d&&!d.isDestroyed&&d.unjoinStore(s)}else s.rootNode.clearChildren(t);else if(t){const l=s.registeredRecords;for(let o=l.length-1,d;o>=0;o--)d=l[o],d&&!d.isDestroyed&&d.unjoinStore(s)}t&&(s.removed.clear(),a.suspendEvents()),a.clear(),t&&a.resumeEvents(),s.added.clear(),s.modified.clear()}}removeAll(t=!1){const r=this,n=r.storage;let s;if(r.isRemoving=!0,t){n.suspendEvents();const a=r.registeredRecords;for(let l=a.length-1,o;l>=0;l--)o=a[l],o&&!o.isDestroyed&&!o.isRoot&&o.unjoinStore(r)}return r.tree?s=r.rootNode.clear()!==!1:s=r.clear()!==null,t&&n.resumeEvents(),r.isRemoving=!1,s}add(t,r=!1,n={}){const s=this,{storage:a}=s;if(t=B.asArray(t),!(t!=null&&t.length))return;if(s.tree=s.tree||!!(s.autoTree&&t[0].children),s.tree){const o=new Map,d=s.modelClass.getFieldDataSource("parentIndex"),c=s.modelClass.getFieldDataSource("orderedParentIndex"),{parentIdField:u}=s.modelClass,h=[];let g;return t.forEach(f=>{g=g||(!(d in f)&&c in f?c:d);const m=f[u];o.has(m)||o.set(m,{append:[],insert:[]});const p=o.get(m);!f.isModel&&g in f?p.insert.push(f):p.append.push(f)}),o.forEach(({append:f,insert:m},p)=>{const v=p==null?s.rootNode:s.getById(p);if(!v)throw new Error(`Parent node with id ${p} not found, cannot add children.`);if(f.length&&h.push(...v.appendChild(f,r,n)),m.length)for(const b of m)"orderedParentIndex"in b&&("orderedParentIndex"in n&&T.isObject(n.orderedParentIndex)?n.orderedParentIndex.index=b.orderedParentIndex:n.orderedParentIndex=b.orderedParentIndex),h.push(v.insertChild(b,b[g],r,n))}),s.isFiltered&&s.reapplyFilterOnAdd&&s.filter({silent:!0}),s.reapplySortersOnAdd&&!s.isSyncingDataOnLoad&&s.sort(),h}if(!r&&s.trigger("beforeAdd",{records:t})===!1)return null;if(s.tree=s.tree||!!(s.autoTree&&t[0].children),s.tree)return s.rootNode.appendChild(t);const l=s.processRecords(t);return r&&s.suspendEvents(),s.addingClean=n.clean,a.add(l),s.addingClean=!1,r&&s.resumeEvents(),s.autoCommit&&s.doAutoCommit(),l}cloneImmutable(t){return this.useRawData.enabled&&!t[0].isModel&&!Object.isExtensible(t[0])&&(t=T.clone(t)),t}processRecords(t,r){return this.cloneImmutable(t).map(n=>{const s=this.processRecord(n.isModel?n:this.createRecord(n));return r==null||r.call(this,s),s})}insert(t,r,n=!1){var s;const a=this,l=a.storage,o=l.getAt(t),d=l.values,c=[];if(r=B.asArray(r),a.tree){const m=a.rootNode;return m.insertChild(r,(s=m.children)==null?void 0:s[t],n)}if(!n&&a.trigger("beforeAdd",{records:r})===!1)return null;let u,h,g;if(d[h=t]===r[0]||d[h=t-1]===r[0])for(u=!0,g=0;u&&g<r.length;g++)r[g]!==d[h+g]&&(u=!1);if(u)return null;const f=a.processRecords(r,m=>{const p=l.indexOf(m);m.children&&m.children.length&&a.autoTree&&(a.tree=!0),p>-1&&(p<t&&o&&t--,c.push(p)),m.meta.previousIndex=p});return a.suspendEvents(),a.storage.remove(c),a.resumeEvents(),n&&a.suspendEvents(),l.splice(t,0,...f),n&&a.resumeEvents(),a.autoCommit&&a.doAutoCommit(),f}move(t,r){this.isTree?r.parent.insertChild(t,r):this.storage.move(t,r)}acceptChanges(){const t=this;t.added.forEach(r=>r.internalClearChanges(!0,!1)),t.modified.forEach(r=>r.internalClearChanges(!0,!1)),t.added.clear(),t.modified.clear(),t.removed.clear()}commit(t=!1){const{changes:r}=this;return!t&&this.trigger("beforeCommit",{changes:r})===!1?!1:(this.acceptChanges(),t||this.trigger("commit",{changes:r}),r)}revertChanges(){const t=this,{changes:r}=t;if(r){const n={action:"clearchanges",changes:r};t.add(t.removed.values,!0),t.remove(t.added.values,!0),t.modified.forEach(s=>s.revertChanges(!0)),t.added.clear(),t.modified.clear(),t.removed.clear(),t.trigger("change",n),t.trigger("refresh",n)}}get changes(){const t=this,r=t.modified.values.filter(n=>n.rawModifications);return t.added.count||r.length||t.removed.count?{added:t.added.values.slice(),modified:r,removed:t.removed.values.slice()}:null}get hasChanges(){return!!(this.added.count||this.removed.count||this.modified.values.some(t=>t.rawModifications))}get autoCommit(){return this._autoCommit}set autoCommit(t){this._autoCommit=t,t&&this.hasChanges&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(t=!0){this.suspendCount--,this.autoCommit&&t&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},y(e,"$name","StoreCRUD"),e},Lb=i=>{var e;return e=class extends(i||$){static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(t){const r=this,{changes:n}=t;n&&(n.added&&r.add(n.added),n.removed&&r.remove(n.removed.map(s=>s.id)),n.modified&&n.modified.forEach(s=>{const a=r.getById(s.id);a==null||a.set(s.modifications)}))}applyChangeset(t,r=null,n="$PhantomId",s=!0,a=!1){var l,o,d,c,u,h;const g=this,f=(l=r==null?void 0:r(t,g))!=null?l:t,m=f.$input||f,{added:p,updated:v,modified:b,removed:w}=m,D=(o=v!=null?v:b)!=null?o:[],S=g.modelClass.getFieldDataSource("id"),x=g.modelClass.getFieldDataSource("parentId"),R=a?new Map:null,M=g.tree,_=[],k=[],F=new Set;let I=!1,A=[];if(g.trigger("startApplyChangeset"),g._groupVisibleRecordIds=[],g.isGrouped&&g.forEach(P=>{g._groupVisibleRecordIds.push(P.id)}),(p==null?void 0:p.length)>0){const P=[],H=[];for(const W of p){const j=g.getById(W[n])||g.getById(T.getPath(W,S));j?(P.push(W),M&&F.add(j.parent)):g.removed.get(W[n])||g.removed.get(T.getPath(W,S))||H.push(W)}D.unshift.apply(D,P);const G=g.reapplySortersOnAdd;g.reapplySortersOnAdd=!1;const q=(d=g.add(H,!1,{orderedParentIndex:{skip:!0},clean:s}))!=null?d:[];if(_.push(...q),g.reapplySortersOnAdd=G,M)for(const W of q){const{parent:j}=W;if(j.isRoot){I=!0,A=[j];break}!j.isRoot&&A.every(se=>!se.contains(j))&&A.push(j),"orderedParentIndex"in W.originalData&&F.add(j)}for(const W of q)R==null||R.set(W.id,W.data),W.internalClearChanges();M&&F.forEach(W=>{W.updateChildrenIndices(W.orderedChildren,"orderedParentIndex",!0)})}if((D==null?void 0:D.length)>0)for(const P of D){const H=P[n],G=T.getPath(P,S),q=T.getPath(P,x),W=(c=g.removed.get(H))!=null?c:g.removed.get(G),j=(u=W!=null?W:g.getById(H))!=null?u:g.getById(G);if(j){const se=q!=null?(h=g.getById(q))==null?void 0:h.isLeaf:!1;this.filterTreeHierarchyChanges(F,j,P);const J=j.applyChangeset(P,n);W&&S in J&&H&&g.onRecordIdChange({record:j,oldValue:H,value:G}),se&&g.toggleCollapse(j.parent,!1),M&&j.parent&&!I&&A.every(Q=>!Q.contains(j))&&(j.parent.isRoot?(I=!0,A=[j.parent]):A.push(j.parent)),R==null||R.set(G,J),k.push(j)}}if((w==null?void 0:w.length)>0&&g.applyRemovals(w),g.applyChangesetFilterSortTarget==="changes"){const P=g.filterChangeset(_,k);A.push(...P)}if(g.afterChangesetApplied(A),M&&g.isSorted&&g.reapplySortersOnAdd&&(p!=null&&p.length||D!=null&&D.length)){const P=new Set;A.forEach(H=>{P.has(H)||(P.add(H),H.sortVisibleChildren(!1,g.sorterFn),H.sortUnfilteredChildren(!1,g.sorterFn))}),g.storage.replaceValues({values:g.collectDescendants(g.rootNode).visible,silent:!0}),g.afterPerformSort(!1)}return g._groupVisibleRecordIds=null,g.trigger("endApplyChangeset"),R}afterChangesetApplied(t){const r=new Set;t.forEach(n=>{r.has(n)||n.traverse(s=>{r.has(s)||(r.add(s),s.sortOrderedChildren(!1,!1),s.children&&s.updateChildrenIndices(s.children,"parentIndex",!0),s.unfilteredChildren&&s.updateChildrenIndices(s.unfilteredChildren,"unfilteredIndex",!0))})})}applyRemovals(t){const r=this,{removed:n}=r,s=r.modelClass.idField,a=[];for(const l of t){const o=T.getPath(l,s);if(n.includes(o)){const d=n.get(o);d.internalClearChanges(!1,!0,null),d.$isPhantom=!0,n.remove(o)}else a.push(o)}r.tree&&a.reduce((o,d)=>{var c;return r.getById(d)&&o.add((c=r.getById(d).parentNode)!=null?c:r.rootNode),o},new Set).forEach(o=>o.sortOrderedChildren(!1,!1)),r.remove(a);for(const l of a)n.remove(l)}filterChangeset(t,r){const n=this,{isFiltered:s,tree:a,isGrouped:l,filtersFunction:o}=n,d=n.isSorted?n.createSorterFn(n.sorters):void 0,{allValues:c,addedValues:u,isSorted:h}=n.storage,g=d!=null||h?d!=null?d:n.storage.sortFunction:null,f=new Set;if(!s)return[];let m=!1,p;if(l&&(p=n.groupers,n.clearGroupers(!0)),a){const b=new Set(r.filter(o));for(const D of t.filter(o))b.add(D);b.forEach(D=>D.bubble(S=>b.add(S))),b.delete(n.rootNode);const w=B.groupByIndexed(Array.from(b).filter(D=>{var S,x;return!((x=(S=D.parent)==null?void 0:S.children)!=null&&x.includes(D))}),D=>D.parent);for(const[D,S]of w)D.unfilteredChildren&&(D.children.push(...S),f.add(D),n.traverseFilter(D,!1,S))}else if(g&&!l){const{filteredValues:b}=n.storage,w=u?b.findLastIndex(x=>!u.has(x))+1:b.length,D=b.slice(0,w),S=new Set(r.filter(o));for(const x of b)S.has(x)&&S.delete(x);for(const x of S)D.push(x);D.sort(g),b.splice(0,w,...D),m=!0}else{const b=r.filter(w=>o(w)&&!n.storage.includes(w));b.length>0&&(n.includeInSubset(c,n.storage.filteredValues,b),m=!0)}const v=new Set(t.filter(b=>!o(b)));if(v.size>0){if(a)for(const b of v)B.remove(b.parent.children,b),f.add(b.parent);else B.remove(n.storage.filteredValues,v);m=!0}return p&&(n.group(p[0],null,!1,!0,!0),m=!1,n._idMap=null),a&&f.size>0?n.storage.replaceValues({values:n.collectDescendants(n.rootNode).visible,silent:!0}):m&&(n._idMap=null,n.trigger("refresh")),[...f]}filterTreeHierarchyChanges(t,r,n){this.tree&&t.has(r.parent)&&(delete n.orderedParentIndex,delete n.parentIndex)}includeInSubset(t,r,n){const s=new Set(n);let a=0,l=0,o=s.size===0;for(;l<t.length&&!o;){const d=r[a];let c=t[l];for(;d!==c;)s.has(c)&&(r.splice(a,0,c),a++,s.delete(c),o=s.size===0),c=t[++l];s.has(d)&&s.delete(d),a<r.length&&a++}return r}},y(e,"$name","StoreChanges"),e},Pb=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}updateFilterParamName(t){this.remoteFilter=t!=null}set reapplyFilterOnAdd(t){this.storage.autoFilter=t}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(t){const r=this,n=r.filters;if(n.clear(),r._filtersFunction=null,t){if(t.constructor.name==="Object")for(const s of Object.entries(t))s[0]==="filterBy"&&typeof s[1]=="function"?n.add(new Je({filterBy:s[1]})):n.add(new Je(s[1].constructor.name==="Object"?Object.assign({property:s[0]},s[1]):{property:s[0],value:s[1]}));else Array.isArray(t)?n.add(...t.map(s=>s instanceof Je?s:new Je(s))):t.isCollection?n.add(...t.values):n.add(new Je({filterBy:t}));n.forEach(s=>s.owner=r)}}get filters(){return this._filters||(this._filters=new Bt({extraKeys:["property"]}))}set filtersFunction(t){this._filtersFunction=t}get filtersFunction(){const t=this,{filters:r,isGrouped:n}=t;if(!t._filtersFunction)if(r.count){const s=Je.generateFiltersFunction(r);t._filtersFunction=a=>n&&a.isSpecialRow?a.groupChildren.some(s):a.isCreating?!0:s(a)}else t._filtersFunction=be.returnTrue;return t._filtersFunction}get isFiltered(){return!this._filters&&(!this.isConfiguring||!this.initialConfig.filters)?!1:this.filters.values.some(t=>!t.disabled)}isFilteredOut(t){return this.isFiltered&&!this.filtersFunction(t)}traverseFilter(t,r=!0,n=void 0){const s=this,{filtersFunction:a}=s,l=!t.isRoot&&a(t),o=t.unfilteredChildren||t.children;return!o||!o.length?l:(t.unfilteredChildren||(t.unfilteredChildren=t.children.slice()),t.children=t.unfilteredChildren.filter(d=>r?s.traverseFilter(d,r):a(d)||(n==null?void 0:n.has(d))),s.isSorted&&t.children.sort(s.sorterFn),t.updateChildrenIndices(t.unfilteredChildren,"unfilteredIndex",!0),t.updateChildrenIndices(t.children,"parentIndex",!0),l||!!t.children.length)}traverseClearFilter(t){const r=this;t.unfilteredChildren&&(t.children=t.orderedChildren.slice(),t.unfilteredChildren=null),t.children&&(r.isSorted&&t.children.sort(r.sorterFn),t.children.forEach(n=>r.traverseClearFilter(n)),t.updateChildrenIndices(t.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(t,r=!1){const n=this;if(t=t instanceof Je?t:new Je(t),t.owner=n,n.filters.add(t),!r){if(n.remoteFilter)return n.filter().then(()=>t);n.filter()}return t}filter(t){const r=this;let n=!1,s;if(t){let l=typeof t;if(l==="object"&&("silent"in t||"replace"in t||t.filters)&&(n=t.silent,t.replace&&r.clearFilters(t.silent||t.filters.length!==0),s=t.internal,t=t.filters,l=typeof t),t){const o=r.isFiltered;if(r.isConfiguring=!0,Array.isArray(t))t.forEach(d=>r.addFilter(d,!0),r);else if(l==="function"){const d=new Je(t);d.internal=s,r.addFilter(d,!0)}else l==="string"?r.addFilter({property:t,value:arguments[1]},!0):r.addFilter(t,!0);if(r.isConfiguring=!1,!r.isFiltered&&!o)return null}}r.filtersFunction=null;const a=r.remoteFilter?r.performRemoteFilter(n):r.performFilter(n);return r._idMap=null,a}suspendFilterOnUpdate(){this.filterBatching++}resumeFilterOnUpdate(t){if(this.filterBatching--,this.filterBatching<0)throw new Error("No matching `startFilterBatching` call");this.filterBatching===0&&this.needsFiltering&&(this.needsFiltering=!1,this.performFilter(t))}performFilter(t){const r=this;if(r.filterBatching>0){r.needsFiltering=!0;return}const{storage:n,filters:s,rootNode:a}=r,l=r.count;t||r.trigger("beforeFilter",{filters:s});let o,d;if(r.tree){const c=n.values;r.isFiltered?r.traverseFilter(a):r.traverseClearFilter(a);const u=r.collectDescendants(a).visible;n.replaceValues({values:u,silent:!0});const h=B.delta(u,c,!0);o=h.toAdd,d=h.toRemove}else n.ion({change({removed:c,added:u}){d=c,o=u},once:!0}),r.isFiltered?(r.isGrouped&&r.includeCollapsed(),n.addFilter({id:"primary-filter",filterBy:r.filtersFunction}),r.isGrouped&&r.excludeCollapsed()):n.filters.clear();r.afterPerformFilter(t||r.isRemoteDataLoading?null:{action:"filter",filters:s,oldCount:l,added:o,removed:d,records:r.storage.values})}async performRemoteFilter(t){var r;const n=this,{filters:s,count:a}=n;if(await((r=n.beforePerformFilter)==null?void 0:r.call(n,{filters:s,oldCount:a}))===!1||(n.currentPage=1,await n.performDataRequest(t)===!1))return;const l=t?null:{action:"filter",filters:s,oldCount:a,records:n.storage.values};n.afterPerformFilter(l),n.trigger("refresh",l)}buildRemoteParams(t={},r=!1){var n,s;(n=super.buildRemoteParams)==null||n.call(this,t,r);const a=this,{filters:l}=a;return a.isFiltered&&(t[(s=a.filterParamName)!=null?s:"filters"]=r?a.encodeFilterParams(l):a.getFilterParams(l)),t}afterPerformFilter(t){this.resetRelationCache(),t&&this.triggerFilterEvent(t)}getFilterParams(t){return t.values.filter(r=>!r.disabled).map(({property:r,operator:n,value:s,caseSensitive:a})=>({field:r,operator:n,value:s,caseSensitive:a}))}triggerFilterEvent(t){this.trigger("filter",t),this.remoteFilter||(this.trigger("refresh",t),this.trigger("change",t))}filterBy(t){return this.filter(t)}removeFilter(t,r=!1){var n,s;const a=this,l=t instanceof Je?t:(n=a.filters.get(t))!=null?n:a.filters.getBy("property",t);if(l){if((s=a._filters)==null||s.remove(l),a._filtersFunction=null,!r){if(a.remoteFilter)return a.filter().then(()=>l);a.filter()}return l}}clearFilters(t=!1){if(this.filters.remove(this.filters.values.filter(r=>!r.internal)),!t)return this.filter()}convertFilterToString(t){const r=this.filters.getBy("property",t);return r&&!r.filterBy?String(r):""}doDestroy(){var t;(t=this._filters)==null||t.destroy(),super.doDestroy()}},y(e,"$name","StoreFilter"),y(e,"configurable",{remoteFilter:!1,filterParamName:null}),y(e,"properties",{filterBatching:0,needsFiltering:!1}),e},CT={add:1,replace:1},Ob="!!novalue!!",wT=({_groupValue:i},{_groupValue:e})=>i<e?-1:i>e?1:0,ST=(i,e)=>i[e<0?i.length+e:e],$b=i=>{var e;return e=class extends(i||$){static get properties(){return{collapsedGroups:new Set}}construct(t){super.construct(t),this.ion({change:"onDataChanged",thisObj:this})}get GroupRow(){var t;return this._GroupRowClass||(this._GroupRowClass=(t=class extends this.modelClass{get isCollapsed(){return this.meta.collapsed}},y(t,"isSpecialRow",!0),y(t,"fields",[{name:"_groupValue"}]),t))}updateGroupers(t){this.setGroupers(t)}setGroupers(t,r=null){const n=this,{storage:s}=n;let a;return n._idMap=null,t!=null&&t.length?n._groupers=t.map(l=>n.createGrouper(l)):n.groupers&&(delete n._groupers,n.includeCollapsed(),s.replaceValues({values:n.removeHeadersAndFooters(s._values),filteredValues:s.isFiltered?n.removeHeadersAndFooters(s._filteredValues):null,silent:!0}),a=n.group(null,null,null,!1,r==null?void 0:r.silent)),a}createGrouper(t,r){if(!t||t.isGrouper)return t;typeof t=="string"&&(t={field:t,[typeof r=="boolean"?"ascending":void 0]:r});const{field:n}=t,s=n==null?void 0:n.indexOf("."),a=s>0,l=n==null?void 0:n.split("."),o=a?l[0]:n,d=a?ST(l,-1):n,c=a?n.slice(s+1):n;return{isGrouper:!0,...t,complexMapping:a,rootFieldName:o,leafFieldName:d,fieldPath:c}}get unfilteredGroupRecords(){var t;const r=this;if(r.isGrouped){const{generation:n}=r.storage;((t=r._unfilteredGroupRecords)==null?void 0:t.generation)!==n&&(r._unfilteredGroupRecords=r.storage.allValues.filter(s=>s.isSpecialRow),r._unfilteredGroupRecords.generation=n)}return r._unfilteredGroupRecords||[]}getGroupHeaderForRecord(t,r=!1){if(this.isGrouped)return t?"groupRowFor"in t.meta?t:t.instanceMeta(this).groupParent:this.groupRecords.last}includeCollapsed(){for(const t of this.collapsedGroups)this.expand(this.getById(t),!1)}excludeCollapsed(){for(const t of this.collapsedGroups)this.collapse(this.getById(t))}onDataChange({source:t,action:r,removed:n}){var s;const a=this,{groupers:l}=a;l&&(l.length?(r==="splice"||r==="move")&&t.replaceValues({...a.prepareGroupRecords(),silent:!0}):t.replaceValues({values:a.removeHeadersAndFooters(t._values),filteredValues:t.isFiltered?a.removeHeadersAndFooters(t._filteredValues):null,silent:!0})),(s=super.onDataChange)==null||s.call(this,...arguments)}move(t,r){const n=this;let s;if(n.isGrouped&&!n.tree){let a=r;if(r!=null&&r.isSpecialRow&&(a=n.getPrev(r,!1,!1),!a))return;const l=n.getGroupHeaderForRecord(a),o=n.groupers[0].field,{reapplyFilterOnUpdate:d}=n,c=n.modelClass.getFieldDefinition(o).type==="array";let u=l.meta.groupRowFor;if(n.reapplyFilterOnUpdate=!1,n.beginBatch(),t.forEach(h=>{if(c){const g=h.get(o)||[];if(g.includes(u))return;{const f=h.instanceMeta(this).groupParent,m=l._groupValue;B.remove(g,f),u=g.slice(),m===Ob?u=void 0:Array.isArray(m)&&m.length===0?u=[]:u.push(m),s=!0}}h.setValue(o,u)}),n.endBatch(),c&&!s)return;if(n.reapplyFilterOnUpdate=d,n.isFiltered&&(r!=null&&r.isSpecialRow)){const{unfilteredGroupRecords:h}=n,g=h.indexOf(l);r=h[g+1]}}super.move(t,r),s&&n.group(n.groupers[0])}collapse(t){let r=!1;return t&&(t=B.asArray(t),t.forEach(n=>{n&&!n.meta.collapsed&&(this.excludeGroupRecords(n),n.meta.collapsed=!0,this.collapsedGroups.add(n.id),this.trigger("toggleGroup",{groupRecord:n,collapse:!0}),r=!0)})),r}expand(t,r=!0){let n=!1;return t&&(t=B.asArray(t),t.forEach(s=>{s!=null&&s.meta.collapsed&&(this.includeGroupRecords(s),s.meta.collapsed=!1,r&&this.collapsedGroups.delete(s.id),r&&this.trigger("toggleGroup",{groupRecord:s,collapse:!1}),n=!0)})),n}removeHeadersAndFooters(t){return t.filter(r=>(r!=null&&r.unfilteredGroupChildren&&(r.groupChildren.length=r.unfilteredGroupChildren.length=r.meta.childCount=0),r!=null&&r.isSpecialRow||r!=null&&r.isLinked&&r.instanceMeta(this).groupParent?(this.unregister(r),!1):!0))}prepareGroupRecords(){var t;const r=this,{GroupRow:n,isFiltered:s,reapplyFilterOnUpdate:a,groupRecords:l}=r,o=r.groupers[0],d=o.ascending!==!1?1:-1,{field:c,fn:u=wT,leafFieldName:h}=o,g=typeof c=="function",f=c===r.modelClass.idField,m=new Bt,p=r._groupVisibleRecordIds||[],v=S=>{const x=!s||r.filtersFunction(S);return a?x:x||p.includes(S.id)},b=!!(r.startGroupsCollapsed&&!(l!=null&&l.count));l==null||l.forEach(S=>{S.isCollapsed&&r.includeGroupRecords(S)});const w=r.removeHeadersAndFooters(r.storage._values);if(r.sorters.length&&w.sort(r.sorterFn),s&&(r.filtersFunction=null),w.forEach(S=>{const x=S,R=g?c(S):S.getValue(c),M=B.asArray(R==null?Ob:R),_=Array.isArray(M),k=_&&!M.length,F=k?1:M.length;for(let I=0;I<F;I++){const A=k?[]:M[I],P=`group-header-${typeof A=="number"?A:O.createId(A)}`;let H=m.get(P);if(H||(H=(l==null?void 0:l.get(P))||new n({[r.modelClass.idField]:P,[f?"":h]:A,_groupValue:A},r,{collapsed:b,specialRow:!0,groupRowFor:A,groupField:h,emptyArray:k}),m.add(H),H.meta.childCount=0,H.groupChildren=[],H.unfilteredGroupChildren=[],H.stores=[r]),r.register(H),I>0){const G=x.groupLinks||(x.groupLinks={});S=G[A]||(G[A]=x.link()),S.stores=[r],r.register(S)}S.instanceMeta(r).groupParent=H,v(S)&&(H.groupChildren.push(S),H.meta.childCount++),H.unfilteredGroupChildren.push(S)}}),m._values.sort((S,x)=>u(S,x)*d),r.useGroupFooters)for(let S=0,x=m.count;S<x;S++){const R=m.values[S],M=R.meta.groupRowFor,_=`group-footer-${typeof M=="number"?M:O.createId(M)}`,k=r.getById(_)||new n({[r.modelClass.idField]:_,[f?"":h]:M,_groupValue:M},r,{specialRow:!0,groupFooterFor:M,groupRecord:R});k.stores=[r],r.register(k),k.groupChildren=R.groupChildren,m.splice(++S,0,k),x++,R.groupChildren.push(k),R.unfilteredGroupChildren.push(k),R.meta.childCount++}r._idMap=null;const D={values:m.reduce((S,x)=>(x.isGroupFooter||(S.push(x),x.meta.collapsed||S.push(...x.unfilteredGroupChildren)),S),!1,[])};return s&&(D.filteredValues=D.values.filter(v)),(t=r.groupRecords)==null||t.forEach(S=>{m.includes(S)||S.destroy()}),r.groupRecords=m,D}get isGrouped(){var t;return!!((t=this.groupers)!=null&&t.length)}group(t,r,n=!1,s=!0,a=!1){var l,o;const d=this,{sorters:c=[]}=d,u=d.createGrouper(t,r);let h,g=!1;if(n?d.groupers.push(u):t?(r==null&&!("ascending"in u)&&(u.ascending=u.fn&&((l=d.groupInfo)==null?void 0:l.field)===u.field&&((o=d.groupInfo)==null?void 0:o.fn)===u.fn?!d.groupInfo.ascending:!0),d.groupInfo=h=u,d.groupers=[d.groupInfo],c.some(f=>f.field===t)&&(d.sorters=c.filter(f=>f.field!==t),g=!0)):t===null&&r===null?(s=!0,g=!0):!g&&c.length&&s&&(g=!0),h){const{prototype:f}=d.modelClass;h.complexMapping&&!Object.prototype.hasOwnProperty.call(f,t)&&Object.defineProperty(f,t,{get(){return T.getPath(this,t)}})}if(s!==!1){if(d.remoteSort&&!d.isRemoteDataLoading)return d.sort(null,null,!1,!g).then(()=>d.onAfterGrouping(a,!g));d.sort(null,null,!1,!g)}d.onAfterGrouping(a,!g)}onAfterGrouping(t,r=!0){if(t)return;const n=this,s=n.groupers||[];n.trigger("group",{isGrouped:n.isGrouped,groupers:s,records:n.storage.values}),r&&n.trigger("refresh",{action:"group",isGrouped:n.isGrouped,groupers:s,records:n.storage.values})}addGrouper(t,r=!0){return this.group(t,r,!0)}removeGrouper(t){const r=this,{groupers:n}=r;if(!n)return;const s=n.findIndex(a=>a.field===t);if(s>-1)return n.splice(s,1),n.length?r.group():r.clearGroupers()}clearGroupers(t=!1){return this.setGroupers(null,{silent:t})}isRecordInGroup(t,r){var n;if(!this.isGrouped)return!1;const s=(n=this.groupers[0])==null?void 0:n.field;return t.getValue(s)===r&&!t.isSpecialRow}isInCollapsedGroup(t){const{groupParent:r}=t.instanceMeta(this);return r==null?void 0:r.meta.collapsed}getGroupRecords(t){return this.isGrouped?this.storage.values.filter(r=>this.isRecordInGroup(r,t)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}get groupHeaderRecords(){return this.useGroupFooters?this.groupRecords.values.filter(t=>t.isGroupHeader):this.groupRecords.values}onDataChanged({changes:t,action:r}){this.isGrouped&&(!t&&CT[r]||t&&this.groupers.some(n=>n.rootFieldName in t))&&this.sort()}internalIncludeExcludeGroupRecords(t,r){const n=this,s=n.indexOf(t),a=n.allIndexOf(t),{id:l,storage:o}=n,{_filteredValues:d,_values:c}=o,{meta:u,groupChildren:h,unfilteredGroupChildren:g}=t;a===-1||u.collapsed&&!r||!u.collapsed&&r||(g.forEach(f=>f.instanceMeta(l).hiddenByCollapse=!r),r?(d&&d.splice(s+1,0,...h.filter(f=>!n.isAvailable(f.id))),o._values.splice(a+1,0,...g.filter(f=>!n.isAvailable(f.id)))):(d&&d.splice(s+1,h.length),c.splice(a+1,g.length)),o._indicesInvalid=!0,n._idMap=null)}excludeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!1)}includeGroupRecords(t){this.internalIncludeExcludeGroupRecords(t,!0)}collectGroupRecords(t,r=!0){return(t?this.storage.allValues:this.storage.values).reduce((s,a)=>(a.isSpecialRow&&(r&&!a.isGroupFooter&&s.push(a),a.isGroupHeader&&s.push.apply(s,t?a.unfilteredGroupChildren:a.groupChildren)),s),[])}},y(e,"$name","StoreGroup"),y(e,"configurable",{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}),e},Hb=Promise.resolve(),Vb=i=>{var e;return e=class extends(i||$){get currentPage(){var t;return(t=this._currentPage)!=null?t:1}set currentPage(t){this.totalCount&&(t=Math.min(t,this.lastPage)),this._currentPage=t}updatePageParamName(t){if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this.remotePaging=t!=null}updatePageStartParamName(t){if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this.remotePaging=t!=null}get defaultPageParamName(){var t,r;return(r=(t=this.pageParamName)!=null?t:this.pageStartParamName)!=null?r:"page"}updateRemotePaging(t){if(t&&this.tree)throw new Error("Paging cannot be supported for tree stores")}updatePageSize(t){const r=this;!r.isConfiguring&&t&&(r.currentPage=r.currentPage?Math.min(r.currentPage,Math.floor((r.totalCount+t-1)/t)):1,r.loadPage(r.currentPage))}get isPaged(){return this.remotePaging}set pagedTotal(t){this.remoteTotal=t}get lastPage(){if(this.isPaged)return Math.floor((this.totalCount+this.pageSize-1)/this.pageSize)}async loadPage(t,r={}){var n;if(r=this.getPagingParams({...r,page:t}),await this.trigger("beforeLoadPage",{params:r})===!1)return!1;await this.performDataRequest(!1,r,()=>{this.currentPage=t})!==!1&&((n=this.trigger)==null||n.call(this,"loadPage",r))}async nextPage(t){const r=this;return r.isPaged&&r.currentPage!==r.lastPage?r.loadPage(r.currentPage+1,t):Hb}async previousPage(t){return this.isPaged&&this.currentPage!==1?this.loadPage(this.currentPage-1,t):Hb}buildRemoteParams(t={},r=!1){var n,s;return this.getPagingParams((s=(n=super.buildRemoteParams)==null?void 0:n.call(this,t,r))!=null?s:t)}getPagingParams(t){var r;const n=this;if(n.isPaged){let s=(r=t[n.defaultPageParamName])!=null?r:n.currentPage;this.pageStartParamName&&(s=Math.max(0,s-1)*this.pageSize),t[n.defaultPageParamName]=s,t[n.pageSizeParamName]=n.pageSize}return t}},y(e,"$name","StorePaging"),y(e,"configurable",{pageSize:50,pageSizeParamName:"pageSize",pageParamName:null,pageStartParamName:null,remotePaging:!1}),e},Nb=i=>class extends(i||$){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(r,n){if(n in r)return r[n];if(n==="$store")return r;let s=r.getById(n);return!s&&!isNaN(parseInt(n))&&(s=r.getAt(parseInt(n))),s},set(r,n,s){return n in r||r.isDestroying||n.startsWith("_")?r[n]=s:r.add({[r.modelClass.idField]:n,...s}),!0},deleteProperty(r,n){return r.isDestroying?(delete r[n],!0):!!r.remove(n).length},has(r,n){if(n in r)return!0;if(n.startsWith("{")&&n.endsWith("}")){const s=O.safeJsonParse(n);n=s==null?void 0:s.id}return r.includes(n)}})}},Bb=i=>{var e;return e=class extends(i||$){initRelations(t){const r=this,n=r.modelClass.exposedRelations;t&&r.modelRelations&&r.modelRelations.forEach(s=>{var a;return(a=s.storeDetacher)==null?void 0:a.call(s)}),(!r.modelRelations||r.modelRelations.length===0||t)&&!r.isChained&&(r.modelRelations=[],n==null||n.forEach(s=>{const a={...s},{foreignStore:l,relationName:o,relatedCollectionName:d}=a,c=typeof l=="string"?r[l]:l;if(a.dependentStore=r,r.modelRelations.push(a),c){a.foreignStoreProperty=a.foreignStore,a.foreignStore=c;const u=c.dependentStoreConfigs;if(u.has(r)){const h=u.get(r);if(t){const g=h.find(f=>f.relationName===o);g&&B.remove(h,g)}h.push(a)}else u.set(r,[a]);d&&c.initRelationCollection(a,r),c.count>0&&c.updateDependentStores("dataset",c.records)}}))}initRelationCollection(t,r){const n=this,s=t.relatedCollectionName,a=n.collectionStores||(n.collectionStores={});a[s]={store:r,config:t},n[s+"Store"]||(n[s+"Store"]=r),n.allRecords.length&&n.initModelRelationCollection(s,n.allRecords)}initModelRelationCollection(t,r){const n=this;r.forEach(s=>{s.traverse(a=>{const l=t in a?`$related${O.capitalize(t)}`:t;Object.defineProperty(a,l,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,t)},set:function(o){return n.setCollection(this,t,o)}})})})}resetRelationCache(){this.relationCache={},this.forEach(t=>t.initRelations())}updateRecordRelationCache(t,r){r==null||r.forEach(n=>{const{config:s}=n,a=n.related?n.related.id:t.getValue(s.foreignKey);a!==void 0&&this.cacheRelatedRecord(t,a,s.relationName,a)})}getRelationCollection(t,r){var n;const s=me.asId(r);return((n=this.relationCache[t])==null?void 0:n[s])||[]}getCollection(t,r){var n;const{config:s,store:a}=this.collectionStores[r];return((n=a.relationCache[s.relationName])==null?void 0:n[t.id])||[]}setCollection(t,r,n){const{config:s,store:a}=this.collectionStores[r],l=a.relationCache[s.relationName]||(a.relationCache[s.relationName]={}),o=(l[t.id]||[]).slice(),d=[],c=[];a.suspendEvents(),o.forEach(u=>{n.includes(u)||(u[s.foreignKey]=null,a.remove(u),c.push(u))}),n.forEach(u=>{u.isModel instanceof me?u.stores.includes(a)||(a.add(u),d.push(u)):([u]=a.add(u),d.push(u)),u[s.foreignKey]=t.id}),a.resumeEvents(),c.length&&(a.trigger("remove",{records:c}),a.trigger("change",{action:"remove",records:c})),d.length&&(a.trigger("add",{records:d}),a.trigger("change",{action:"add",records:d}))}cacheRelatedRecord(t,r,n,s=null){const a=this,l=a.relationCache[n]||(a.relationCache[n]={});s!==null&&a.uncacheRelatedRecord(t,n,s),r!=null&&B.include(l[r]||(l[r]=[]),t)}uncacheRelatedRecord(t,r=null,n=null){const s=this;function a(l,o){const d=s.relationCache[l],c=d==null?void 0:d[o];if(c){const u=c.indexOf(t);u>=0&&c.splice(u,1),c.length===0&&delete d[o]}}n!=null?a(r,n):t.meta.relationCache&&Object.entries(t.meta.relationCache).forEach(([l,o])=>a(l,o==null?void 0:o.id))}updateDependentStores(t,r,n){var s;const a=this,l=t==="dataset";a.dependentStoreConfigs.forEach(o=>{o.forEach(d=>{const{dependentStore:c,relatedCollectionName:u,relationName:h,foreignKey:g,propagateRecordChanges:f}=d,m=c.relationCache[h];if(l)u&&a.initModelRelationCollection(u,r),c.forEach(p=>{const v=p.initRelation(d);v&&c.cacheRelatedRecord(p,v.id,h,v.id)}),f&&c.totalCount&&c.trigger("refresh",{action:"relatedstoredataset",records:c.records});else if(t==="removeall"){c.forEach(p=>p.removeRelation(d)),delete c.relationCache[h];return}else t==="replace"&&(r=r.map(p=>p[1]));(t==="add"||t==="replace")&&u&&a.initModelRelationCollection(u,r),l||r.forEach(p=>{const v=m==null?void 0:m[p.id];switch(t){case"remove":v&&v.forEach(b=>b.removeRelation(d));break;case"add":case"replace":c.forEach(b=>{b.getValue(g)==p.id&&(b.initRelation(d),c.cacheRelatedRecord(b,p.id,h))});break}!n&&(v!=null&&v.length)&&f&&v.forEach(b=>b.stores.forEach(w=>a.notifyRelatedStore(w,b,d.relationName,p)))})})}),r!=null&&r.length&&((s=a.modelRelations)==null||s.forEach(o=>{o.propagateRecordChanges&&(l?o.foreignStore.totalCount&&o.foreignStore.trigger("refresh",{action:"relatedstoredataset",records:o.foreignStore.records}):r.forEach(d=>{var c;const u=d[o.relationName];(c=u==null?void 0:u.stores)==null||c.forEach(h=>{a.notifyRelatedStore(h,u,o.relatedCollectionName,d)})}))}))}notifyRelatedStore(t,r,n,{meta:s}){if(this.isChained||t.isChained)return;let{_ignoreRelationUpdate:a}=s,l=!1;a!=null&&a.size||(s._ignoreRelationUpdate=a=new Set,l=!0),a.has(t)||(a.add(this).add(t),r.meta._ignoreRelationUpdate=a,t.onModelChange(r,{[n]:r[n]},{[n]:r[n]},!1,!0),l&&a.clear())}updateDependentRecordIds(t,r){var n;(n=this.dependentStoreConfigs)==null||n.forEach(s=>{s.forEach(a=>{var l;const{dependentStore:o,relationName:d,foreignKey:c}=a,u=o.relationCache[d],h=(l=u==null?void 0:u[t])==null?void 0:l.slice();h==null||h.forEach(g=>{o.cacheRelatedRecord(g,r,d,t),g.meta._ignoreRelatedIdUpdate=!0,g.set(c,r,!1,!0),delete g.meta._ignoreRelatedIdUpdate})})})}},y(e,"$name","StoreRelation"),e},zb=i=>{var e;return e=class extends(i||$){sum(t,r=this.storage.values){return r?r.reduce((n,s)=>{if(s.isSpecialRow)return n;const a=Number(s.getValue(t));return isNaN(a)?n:n+a},0):0}min(t,r=this.storage.values){return r!=null&&r.length?r.reduce((n,s)=>{const a=s.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&(a<n||n==null)&&(n=a),n},r[0].getValue(t)):0}max(t,r=this.storage.values){return r!=null&&r.length?r.reduce((n,s)=>{const a=s.getValue(t);return typeof(a==null?void 0:a.valueOf())==="number"&&(a>n||n==null)&&(n=a),n},r[0].getValue(t)):0}average(t,r=this.storage.values){if(!(r!=null&&r.length))return 0;let n=0;const s=r.reduce((a,l)=>{if(l.isSpecialRow)return a;const o=parseFloat(l.getValue(t));return isNaN(o)?a:(n++,a+o)},0);return n>0?s/n:0}groupSum(t,r){return this.sum(r,this.getGroupRecords(t))}},y(e,"$name","StoreSum"),e},Wb=(i,e)=>String(i).toLowerCase().includes(e),jb={string:Wb,number:(i,e)=>i===Number(e),boolean:Wb,date:(i,e)=>i instanceof Date&&e instanceof Date?i-e===0:String(i.getMonth()+1).includes(e)||String(i.getDate()).includes(e)||String(i.getFullYear()).includes(e),object:(i,e)=>i===e,undefined:(i,e)=>i===e},Ub=i=>{var e;return e=class extends(i||$){search(t,r=null,n,s){const a=this.isTree&&!s?this.rootNode.allChildren:this.getAllDataRecords(s),l=a.length,o=[];if(t==null)return[];typeof t=="string"&&(t=t.toLowerCase()),r||(r=this.modelClass.allFields.map(m=>m.name));let d,c,u,h,g,f;for(d=0;d<l;d++){u=a[d],c=0;for(const m of r){h=u.getValue(m),g=h instanceof Date?"date":typeof h;const p=n==null?void 0:n[c];p&&(h=p(h),g="string"),f=jb[g],h&&(f!=null&&f(h,t))&&o.push({index:d,data:u,field:m,id:u.id}),c++}}return o}findByField(t,r,n=!1,s=!1){const a=this.getAllDataRecords(s),l=a.length,o=new Set,d=[];let c,u,h;for(r!=null&&(r=String(r).toLowerCase()),c=0;c<l;c++)if(u=a[c],h=u.getValue(t),!n||!o.has(h)){const g=h instanceof Date?"date":typeof h,f=jb[g];(r==null&&h===r||r===""&&h===""||r&&f(h,r))&&(d.push({id:u.id,index:c,data:u}),n&&o.add(h))}return d}find(t,r=!1){return this.getAllDataRecords(r).find(t)}findRecord(t,r,n=!1){const s=a=>T.isEqual(a[t],r);return this.isTree?this.query(s,n)[0]:this.getAllDataRecords(n).find(s)}query(t,r=!1){return this.getAllDataRecords(r).filter(t)}some(t,r=!1){return this.getAllDataRecords(r).some(t)}},y(e,"$name","StoreSearch"),e},Gb=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{useLocaleSort:null}}get isSorted(){return!!this.sorters.length||this.isGrouped}changeSorters(t){return t.map(r=>this.normalizeSorterConfig(r,!0))}updateSortParamName(t){this.remoteSort=t!=null}sort(t,r,n=!1,s=!1){const a=this,l=a.allRecords,o=a.sorters?a.sorters.slice():[];let d=null,c;if(t)if(Array.isArray(t))a.sorters=t.map(u=>a.normalizeSorterConfig(u,typeof u=="string"?!0:r));else{const u=a.normalizeSorterConfig(t,r);n?(c=a.getCurrentSorterByField(u.field),c?(d=c.ascending,c.ascending=u.ascending):a.sorters.push(u)):a.sorters=[u]}return!s&&a.trigger("beforeSort",{sorters:a.sorters,records:l,currentSorters:o})===!1?(a.sorters=o,d!==null&&(c.ascending=d),null):a.remoteSort?a.performRemoteSort(s):a.performSort(s)}normalizeSorterConfig(t,r){var n,s,a;const l=this,o={ascending:r};if(typeof t=="object"?(T.assign(o,t),t.fn&&(delete o.fn,o.sortFn=t.fn),o.ascending=(n=t.ascending)!=null?n:r):typeof t=="function"?o.sortFn=t:o.field=t,o.ascending==null){const d=l.getCurrentSorterByField(o.field);o.ascending=d?!d.ascending:!0}if(o.sortFn==null){const d=(a=(s=l.modelClass)==null?void 0:s.$meta.fields.map[o.field])==null?void 0:a.compareItems;d&&(o.sortFn=d)}return o}getCurrentSorterByField(t){return typeof t=="string"&&this.sorters.find(r=>r.field===t)||null}addSorter(t,r=!0){return this.sort(t,r,!0)}removeSorter(t){const r=this.sorters.findIndex(n=>n.field===t||n.sortFn===t);if(r>-1)return this.sorters.splice(r,1),this.sort()}clearSorters(t=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,t)}suspendSortOnUpdate(){"_reapplySortersSuspended"in this||(this._reapplySortersSuspended=0),this._reapplySortersSuspended++}resumeSortOnUpdate(t=!0){const r=this;r._reapplySortersSuspended&&(r._reapplySortersSuspended--,!r._reapplySortersSuspended&&r._shouldReapplySorters&&(t&&r.sort(),r._shouldReapplySorters=!1))}createSorterFn(t){const r=this.useLocaleSort;return(n,s)=>{for(let a=0;a<t.length;a++){const l=t[a],{field:o,ascending:d=!0,useLocaleSort:c=r,caseSensitive:u=!0}=l,h=l.fn||l.sortFn,g=d?1:-1;if(h){const p=h.call(l,n,s);if(p===0)continue;if(p!==null)return p*g}let f=n.isModel?n.getValue(o):n[o],m=s.isModel?s.getValue(o):s[o];if(u||(typeof f=="string"&&(f=f.toLowerCase()),typeof m=="string"&&(m=m.toLowerCase())),f!==m){if(f==null)return-g;if(m==null)return g;if(c&&typeof f=="string"){if(c===!0)return String(f).localeCompare(m)*g;if(typeof c=="string")return String(f).localeCompare(m,c)*g;if(typeof c=="object")return String(f).localeCompare(m,c.locale,c)*g}if(f>m)return g;if(f<m)return-g}}return 0}}get sorterFn(){return this.createSorterFn(this.remoteSort?[{field:"_remoteSortIndex"}]:this.sorters)}performSort(t){const r=this,{rootNode:n,storage:s,sorterFn:a}=r;r.tree?(!r.isChained&&n.traverse(l=>{l.isLoaded&&l.isParent&&(l.children.sort(a),l.updateChildrenIndices(l.children,"parentIndex",!0))}),s.replaceValues({values:r.collectDescendants(n).visible,silent:!0})):r.isGrouped?s.replaceValues({...r.prepareGroupRecords(),silent:!0}):s.replaceValues({values:s.values.sort(a),silent:!0}),r.afterPerformSort(t||r.isRemoteDataLoading)}async performRemoteSort(t){var r;await((r=this.beforePerformSort)==null?void 0:r.call(this))!==!1&&await this.performDataRequest(t)!==!1&&this.afterPerformSort(t)}buildRemoteParams(t={},r=!1){var n;let{sorters:s,groupers:a,sortParamName:l="sorters"}=this;return(n=super.buildRemoteParams)==null||n.call(this,t,r),a&&(s=a.concat(s)),s.length&&(t[l]=r?this.encodeSorterParams(s):this.getSorterParams(s)),t}getSorterParams(t){return t.filter(r=>!r.sortFn).map(({field:r,ascending:n})=>({field:r,ascending:n}))}afterPerformSort(t){if(t)return;const r=this;r._idMap=null;const n={action:"sort",sorters:r.sorters,records:r.allRecords};r.trigger("sort",n),r.trigger("refresh",n)}},y(e,"$name","StoreSort"),y(e,"configurable",{sorters:[],reapplySortersOnAdd:!1,reapplySortersOnUpdate:!1,remoteSort:!1,sortParamName:null}),e},Lf=()=>!0,Yb=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,syncSort:!0,ignoreLinkRecords:!1,chainFilters:null,chainSuspended:0}}static get properties(){return{chainedStores:null,isChainedTree:null}}construct(t){super.construct(t);const r=this,{masterStore:n}=r;n&&(r.methodNamesToRelay.forEach(s=>r[s]=(...a)=>r.relayToMaster(s,a)),r.removeAll=(...s)=>{n.remove(r.getRange(),...s)},n.ion({name:"masterStoreListeners",changePreCommit:r.onMasterDataChangedPreCommit,change:r.onMasterDataChanged,prio:1,thisObj:r}),r.syncSort&&n.ion({sort:()=>r.sort(n.sorters),thisObj:r}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(r),r.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return!!this.masterStore}set chainedFilterFn(t){this._chainedFilterFn=this.thisObj?t.bind(this.thisObj):t}get chainedFilterFn(){return this._chainedFilterFn||Lf}get methodNamesToRelay(){const t=Array.isArray(this.doRelayToMaster),r=Array.isArray(this.dontRelayToMaster);return t&&this.doRelayToMaster.filter(n=>!r||!this.dontRelayToMaster.includes(n))||[]}updateChainedStores(){var t;(t=this.chainedStores)==null||t.forEach(r=>r.fillFromMaster())}fillFromMaster(){const t=this,{masterStore:r,isTree:n}=t,{isFiltered:s}=r;if(!t.isChained)throw new Error("fillFromMaster only allowed on chained store");if(t.isChainSuspended)return;let a,l=null;if(t.chainFilters&&s){const o=r.filters.values.filter(d=>!d.ignoreForChain);o.length&&(l=Je.generateFiltersFunction(o))}if(t.isChainedTree)return t.fillTreeFromMaster(l);if(a=r.allRecords.filter(o=>{if(!o.isSpecialRow&&(!t.ignoreLinkRecords||!o.isLinked)&&t.chainedFilterFn(o)&&(!l||l(o)))return!(t.excludeCollapsedRecords&&!o.ancestorsExpanded(r))}),t.masterStore.sorterFn&&s&&r.isSorted&&!r.remoteSort&&a.sort(r.sorterFn),n)if(t.idRegister={},t.internalIdRegister={},a.forEach(o=>{o.stores.includes(t)?t.register(o):o.joinStore(t)}),t.excludeCollapsedRecords){const o=t.getChildren(t.rootNode);a=t.doIncludeExclude(o,!0)}else a.forEach(o=>o.instanceMeta(t).collapsed=!1);t.isFillingFromMaster=!0,t.data=a,t.isFillingFromMaster=!1}fillTreeFromMaster(t){const r=this,{chainedFilterFn:n}=r,s=r.masterStore.rootNode,a=[],l=r.treeLinkMap||{},o=r.idRegister={},d=r.internalIdRegister={};r.treeLinkMap={},Ui.postWalk({children:s.unfilteredChildren||s.children},c=>!c.isLeaf&&(c.unfilteredChildren||c.children),c=>{var u,h,g;if(c.isLeaf&&(!t||t(c))&&n(c)||!c.isLeaf&&((h=(u=c.meta)==null?void 0:u.tempChildren)!=null&&h.length)){const f=(g=c.parent)==null?void 0:g.meta,m=l[c.id],p=c.isLeaf&&m,v=p||c.link(),b=v.proxyMeta.data;r.treeLinkMap[c.id]=v,p?(b.parent=b.parentIndex=b.unfilteredIndex=b.parentId=b.children=b.orderedChildren=b.unfilteredChildren=null,o[v.id]=c,d[v.internalId]=c):m&&v.removeLink(v),f.tempChildren||(f.tempChildren=[]),f.tempChildren.push(v),c.isParent&&a.unshift(v)}}),r.isFillingFromMaster=!0;for(let c=a.length-1;c>=0;c--){const u=a[c],{meta:h}=u.$original;h.tempChildren&&(u.meta.isFillingFromMaster=!0,u.appendChild(h.tempChildren,!0),u.meta.isFillingFromMaster=!1,h.tempChildren=null)}r.data=s.meta.tempChildren||[],r.isFillingFromMaster=!1,s.meta.tempChildren=null}commitToMaster(){const t=this,r=t.masterStore;if(!t.isChained)throw new Error("commitToMaster only allowed on chained store");return r.beginBatch(),r.remove(t.removed.values),r.add(t.added.values),r.endBatch(),t.commit()}relayToMaster(t,r){return this.masterStore[t](...r)}onMasterDataChangedPreCommit(t){this.onMasterDataChanged(t),this.$masterEventhandled=!0}onMasterDataChanged({action:t,changes:r,isMove:n}){var s;const a=this;if(a.$masterEventhandled){a.$masterEventhandled=!1;return}n&&t==="remove"||(t!=="update"||a.chainedFields==="*"||(s=a.chainedFields)!=null&&s.some(l=>l in r)||"isLeaf"in r||"parentId"in r)&&a.fillFromMaster()}makeChained(t=Lf,r,n){return re.deprecate("core","7.0.0","makeChained() deprecated in favor of chain() and chainTree()"),this.chain(t,r,n)}chain(t=Lf,r,n){if(this.isChained){const s=t;t=a=>s(a)&&this.chainedFilterFn(a)}return new((n==null?void 0:n.storeClass)||this.constructor)({id:`${this.id}-chained-${O.generateUUID()}`,tree:!1,autoTree:!1,...n||{},masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:t,chainedFields:r})}chainTree(t,r,n){if(!this.tree)throw new Error("chainTree only allowed on tree stores");return this.chain(t,r,{tree:!0,isChainedTree:!0,...n})}doDestroy(){var t;this.detachListeners("masterStoreListeners"),(t=this.chainedStores)==null||t.forEach(r=>r.destroy()),super.doDestroy()}suspendChain(){this.chainSuspended++}resumeChain(t=!1){this.chainSuspended&&!--this.chainSuspended&&t&&this.fillFromMaster()}get isChainSuspended(){return this.chainSuspended>0}},y(e,"$name","StoreChained"),e},qb=i=>{var e;return e=class extends(i||$){getState(){const{sorters:t,groupers:r,filters:n}=this,s={};return t!=null&&t.length&&(s.sorters=t.map(a=>{const l=T.cleanupProperties(T.clone(a));return delete l.fn,delete l.sortFn,l})),r!=null&&r.length&&(s.groupers=r.map(a=>{const l=T.cleanupProperties(T.clone(a));return delete l.fn,l}),s.collapsedGroups=[...this.collapsedGroups]),n!=null&&n.values.length&&(s.filters=n.allValues.map(a=>a.getState())),s}applyState(t){var r;const n=this,{sorters:s=[],groupers:a=[],filters:l=[]}=t,{sortParamName:o,filterParamName:d}=n;(n.isSorted||s.length!==0||a.length!==0)&&(n.sorters=s.filter(c=>c.field||c.sortFn&&!o),n.groupers=a.slice(),a.length?n.group():n.sort()),(r=t.collapsedGroups)==null||r.forEach(c=>{const u=n.getById(c);u&&n.collapse(u,!0)}),(n.isFiltered||l.length!==0)&&(n.filters=l.filter(c=>c.property||c.filterBy&&!d),n.filter())}},y(e,"$name","StoreState"),e},DT=i=>String(i).padStart(6,"0"),Du=class Bi{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e!=null?e:"")}get value(){return this._value}static from(e){return e==null||e instanceof Bi?e:new Bi(e)}static pad(e){return e instanceof Bi?e.valueOf():Bi.split(e).map(DT).join(".")}static split(e){let t,r;if(e||e===0)switch(typeof e){case"object":e=String(e);case"string":for(r=e.split("."),t=r.length;t-- >0;)r[t]=parseInt(r[t],10);break;case"number":r=[e];break}return r||[]}static compare(e,t){return e===t?0:!e||!t?e?1:t?-1:0:(e=Bi.pad(e),t=Bi.pad(t),e<t?-1:t<e?1:0)}append(e){const t=this.value;return Bi.from(t?`${t}.${e}`:e)}isEqual(e){return!Bi.compare(this,e)}match(e){let t=!1;if(e){const r=this.value,n=e[0]==="*",s=e.endsWith("*"),a=e.length;n===s?t=r.indexOf(n?e.substr(1,a-2):e)>-1:n?t=r.endsWith(e.substr(1)):t=r.startsWith(e.substr(0,a-1))}return t}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return(e=this._padded)!=null?e:this._padded=Bi.pad(this.value)}};Du._$name="Wbs";var ET=Object.freeze([]),Go=Symbol("StopBranch"),Pf=O.generateUUID(),Kb=i=>{var e;return e=class extends(i||$){get StopBranch(){return Go}get isTree(){var t,r;return(r=this.tree)!=null?r:(t=this.masterStore)==null?void 0:t.tree}get leaves(){const t=[];return this.isTree?this.traverse(r=>{r.isLeaf&&t.push(r)}):this.allRecords.forEach(r=>{r.isLeaf&&t.push(r),r.traverse(n=>{n.isLeaf&&t.push(n)},!0)}),t}async loadChildren(t){}onNodeAddChild(t,r,n,s,a=!1){var l;const o=this,d=t===o.rootNode&&t.isLoading,{storage:c}=o,{previousSibling:u}=r[0];let h;const{visible:g,all:f}=o.collectDescendants(r,void 0,void 0,{inCollapsedBranch:!(t.isExpanded(o)&&t.ancestorsExpanded(o)),applyFilter:o.isFiltered&&o.reapplyFilterOnAdd});if(!d&&f.length)for(const m of f)!o.modified.includes(m)&&!s[m.id]&&(o.removed.includes(m)?o.removed.remove(m):m.isLinked||o.added.add(m));if(d&&o.rootVisible&&(g.unshift(t),f.unshift(t)),g.length?(n===0||!u?h=c.indexOf(t):h=c.indexOf(u)+u.getDescendantCount(!0,o),c.suspendEvents(),o.storage.splice(++h,0,g),c.resumeEvents(),o._idMap=null):o._allRecords=null,o.updateDependentStores("add",r),d&&g.length){if(o.sorters.length&&o.sort(null,null,!1,!0),(l=o.afterLoadData)==null||l.call(o),!a){const m={action:"dataset",data:o._data,records:g};o.trigger("refresh",m),o.trigger("change",m)}}else if(!a){const m={action:"add",parent:t,isChild:!0,isMove:s,records:r,allRecords:f,index:h};if(o.trigger("add",m),o.trigger("change",m),s&&Object.values(s).some(p=>p)){const p={newParent:t,records:r.filter(v=>s[v.id]),oldParents:r.map(v=>o.getById(v.meta.oldParentId))};o.trigger("move",p)}}}onNodeRemoveChild(t,r,n,s={isMove:!1,silent:!1,unfiltered:!1}){const a=this,{storage:l}=a,o=[],d=[],{isMove:c,silent:u,unfiltered:h}=s,g=h&&a.isFiltered;if(a.collectDescendants(r,o,d,{inCollapsedBranch:!(t.isExpanded(a)&&t.ancestorsExpanded(a)),unfiltered:g}),!c){for(const f of r)f.unjoinStore(a);for(const f of d)f.stores.includes(a)&&f.unjoinStore(a),a.added.includes(f)?a.added.remove(f):f.isLinked||a.removed.add(f);a.modified.remove(d)}if(o.length?(n=l.indexOf(o[0]),n>-1&&(l.suspendEvents(),l.splice(n,o.length),l.resumeEvents(),a._idMap=null)):(n=-1,a._allRecords=null),!u&&(a.fireRemoveEventForMoveAction||!c)){const f={action:"remove",parent:t,isChild:!0,isMove:c,records:r,allRecords:d,index:n};a.trigger("remove",f),a.trigger("change",f)}return d}collectDescendants(t,r=[],n=[],s={}){var a;const l=this,{inCollapsedBranch:o=!1,unfiltered:d=!1,applyFilter:c=!1}=s,u=Array.isArray(t)?t:(a=l.getChildren(t,d))!=null?a:[];if(c)return{visible:!o&&u.flatMap(h=>l.collectVisibleNodeDescendantsFiltered(h)),all:u.concat(u.flatMap(h=>h.allChildren))};for(let h=0,g=u.length,f;h<g;h++)f=u[h],o||r.push(f),n.push(f),l.collectDescendants(f,r,n,{inCollapsedBranch:o||!f.isExpanded(l),unfiltered:d});return{visible:r,all:n}}collectVisibleNodeDescendantsFiltered(t){const r=t.unfilteredChildren||t.children;if(!r||r.length===0||!t.isLeaf&&!t.isExpanded(this))return this.filtersFunction(t)?[t]:[];const n=r.flatMap(s=>this.collectVisibleNodeDescendantsFiltered(s));return n.length||this.filtersFunction(t)?[t,...n]:[]}getChildren(t,r=!1){const n=this,s=n.isChained&&!n.isChainedTree,a=(r||s)&&t.unfilteredChildren||t.children;return a!=null&&a.length?s?a.filter(n.chainedFilterFn).sort(n.sorterFn):a:ET}internalToggleTreeSubRecords(t,r){const n=this,{storage:s}=n,a=s.indexOf(t),l=n.doIncludeExclude(n.getChildren(t),r);if(n.isFiltered&&r&&t.unfilteredChildren&&n.updateChildrenHiddenState(t),l.length&&a!==!1){if(s.suspendEvents(),r){s.splice(a+1,0,...l);const o={action:"add",isExpand:!0,parent:t,records:l,index:a+1};n.trigger("add",o),n.trigger("change",o)}else{s.splice(a+1,l.length);const o={action:"remove",isCollapse:!0,parent:t,records:l,index:a+1};n.trigger("remove",o),n.trigger("change",o)}s.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(t){var r;(r=t.unfilteredChildren)==null||r.forEach(n=>{n.instanceMeta(this.id).hidden=!1,n.isLeaf||this.updateChildrenHiddenState(n)})}doIncludeExclude(t,r,n=[]){const s=this,a=(t==null?void 0:t.length)||0;for(let l=0;l<a;l++){const o=t[l];if(!s.isChained||s.chainedFilterFn(o)){const d=o.instanceMeta(s.id);(r||!d.hidden)&&n.push(o),d.hidden=!r,o.isExpanded(s)&&s.doIncludeExclude(s.getChildren(o),r,n)}}return n}async toggleCollapse(t,r){const n=this,s=n.getById(t),a=s.instanceMeta(n);if(r===void 0&&(r=!a.collapsed),!a.isLoadingChildren&&!s.isLeaf&&s.isExpanded(n)===r){if(n.trigger("beforeToggleNode",{record:s,collapse:r}),a.collapsed=r,a.collapsed)return n.onNodeCollapse(s),!0;{n.onNodeExpand(s);let l=!0;if(!s.isLoaded){a.isLoadingChildren=!0;try{await n.loadChildren(s)}catch(o){a.collapsed=!0,l=!1,n.trigger("loadChildrenException",{record:s,exception:o})}finally{a.isLoadingChildren=!1}}return l}}}onNodeCollapse(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!1)}onNodeExpand(t){if(t.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(t,!0)}transformToTree(t){var r;const{parentIdField:n,idField:s,childrenField:a}=this.modelClass,l=((r=this.modelClass.fieldMap[n])==null?void 0:r.dataSource)||"parentId",o=new Map,d=new Set,c=[];for(const h of t){const g=h==null?void 0:h[s];g!=null&&o.set(g,h)}const u=h=>{const g=Object.assign({},h);return g[a]=[],o.set(g[s],g),d.add(h[s]),g};for(let h of t)if(h){const g=h[s];d.has(g)?h=o.get(g):h=u(h);const f=h[l];if(f!=null){let m=o.get(f);m&&(m[a]||(m=u(m)),m[a].push(h))}else h[a]?c.push(h):h[s]!=null?c.push(u(h)):c.push(h)}return o.forEach(h=>{var g,f;(f=(g=h[a]).sort)==null||f.call(g,(m,p)=>m.parentIndex-p.parentIndex)}),c}treeifyData(t,r,n,s=!1,a){const{length:l}=r,o=[],d=[],c={};let u,h;for(u=0;u<l;u++){let f=r[u];f=f.field||f,r[u].call||(r[u]=m=>m[f],r[u].fieldName=f),o[u]=new Map}Ui.preWalkWithParent({isRoot:!0,id:this.rootNode.id,children:t},f=>f.children,(f,m)=>{if(h=[],m.isLeaf){for(u=0;u<l;u++){const p=r[u],v=a?a(p(m),p.fieldName):p(m),b=o[u],w=v===""?Pf:v,D=B.asArray(w)||[Pf],S=[];if(D[0]===Go)break;(h.length>0?h:[null]).forEach(R=>{var M;for(let _=0,{length:k}=D;_<k;_++){const F=D[_],I=`${((M=R==null?void 0:R.path)!=null?M:"")+(F!=null&&F.isModel?F.id:F)}/`,A=O.makeValidDomId(`generated_${I}`,"_"),P=b.get(A)||b.set(A,{id:A,key:D[_]===Pf?"":F,path:I,readOnly:!0,children:[],generatedParent:!0,field:p.fieldName,firstGroupChild:m}).get(A);S.push(P),R&&!R.children.includes(P)&&R.children.push(P)}}),h=S}h.length?h.forEach((p,v)=>p.children.push(v?m.link():m)):d.push(m)}},!0),(n||s)&&o.forEach(f=>f.forEach((m,p,v)=>{n==null||n(m),s&&(m=this.createRecord(m),v.set(p,m))})),c.children=[...o[0].values(),...d];const g=f=>{f.children&&(f.children.sort((m,p)=>{if(m.isLeaf===p.isLeaf)if(m.isLeaf){let v;for(let b=0;!v&&b<l;b++){const w=r[b](m),D=r[b](p);if(w===Go||D===Go)return m.isLeaf<p.isLeaf?-1:m.isLeaf>p.isLeaf?1:0;v=w<D?-1:D<w?1:0}return v}else return typeof m.key=="string"&&typeof p.key=="string"?m.key.localeCompare(p.key,void 0,{numeric:!0}):m.key<p.key?-1:m.key>p.key?1:0;else return m.isLeaf<p.isLeaf?-1:m.isLeaf>p.isLeaf?1:0}),f.children.forEach(g))};return g(c),c}treeify(t,r,n=!1,s){return this.treeifyData(this.rootNode.children,t,r,n=!1,s)}treeifyFlatData(t){var r;const{childrenField:n,parentIdField:s}=this.modelClass,a=((r=this.modelClass.fieldMap[s])==null?void 0:r.dataSource)||"parentId";let l=!1,o=!0;for(const d of t){if(d!=null&&d.isModel||Array.isArray(d==null?void 0:d[n])){o=!1;break}(d==null?void 0:d[a])!=null&&(l=!0)}return o&&l&&(t=this.transformToTree(t)),t}async indent(t){const r=this;if(t=Array.isArray(t)?t:[t],t=t.filter(n=>{let s=!!n.previousSibling;for(;s&&!n.isRoot;)s=!t.includes(n.parent),n=n.parent;return s}),t.length&&r.trigger("beforeIndent",{records:t})!==!1){t.sort((n,s)=>Du.compare(n.wbsCode,s.wbsCode)),r.beginBatch();for(const n of t){const s=n.previousSibling;s.appendChild(n),r.toggleCollapse(s,!1)}r.endBatch(),r.trigger("indent",{records:t}),r.trigger("change",{action:"indent",records:t})}}async outdent(t){const r=this;if(t=Array.isArray(t)?t:[t],t=t.filter(n=>{const{parent:s}=n;let a=s&&!s.isRoot;for(;a&&!n.isRoot;)a=!t.includes(s),n=n.parent;return a}),t.length&&r.trigger("beforeOutdent",{records:t})!==!1){t.sort((n,s)=>Du.compare(n.wbsCode,s.wbsCode)),r.beginBatch();for(const n of t){const{parent:s}=n,a=s.children.slice(s.children.indexOf(n)+1);s.parent.insertChild(n,s.nextSibling),n.appendChild(a),r.toggleCollapse(n,!1)}r.endBatch(),r.trigger("outdent",{records:t}),r.trigger("change",{action:"outdent",records:t})}}},y(e,"$name","StoreTree"),y(e,"StopBranch",Go),y(e,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:!1,keepExpandedOnLoad:!1}),e},Xb=i=>{var e;return e=class extends(i||$){static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null,reorderOnSync:!0}}syncDataset(t){var r,n,s,a,l;const o=this,{storage:d}=o,c=(a=(r=o.shouldSyncDataset)==null?void 0:r.call(o,{data:t,store:o,records:o.records}))!=null?a:(s=(n=o.project)==null?void 0:n.shouldSyncDataset)==null?void 0:s.call(n,{data:t,store:o,records:o.records});if(c===!1)return;o.trigger("startApplyChangeset"),o.isSyncingDataOnLoad=!0;const{toAdd:u,toRemove:h,toMove:g,updated:f,ids:m}=o.tree?o.syncTreeDataset(t,c):o.syncFlatDataset(t,c);let p=(l=o.syncDataOnLoad)==null?void 0:l.threshold,v=!1;if(p&&(typeof p=="string"&&(p=parseInt(p,10)/100*o.count),v=u.length+h.length+g.length+f.length>p),o.tree){if(u.length&&o.add(u,v).forEach(D=>D.clearParentId()),g.length)for(const{parent:w,node:D,index:S}of g)o.getById(w.id).insertChild(D,S);o.remove(h,v)}else v&&o.suspendEvents(),o.remove(h),o.add(u),v&&o.resumeEvents();p&&!v&&f.forEach(({record:w,toSet:D,wasSet:S})=>o.onModelChange(w,D,S)),o.$isSettingStoreFieldData||o.acceptChanges();const b={added:u,removed:h,updated:f,thresholdSurpassed:v};if(o.isFiltered&&!o.remoteFilter&&o.filter({silent:o.isRemoteDataLoading}),o.isGrouped)o.group(null,null,!1,!0,o.isRemoteDataLoading);else if(o.isSorted)o.remoteSort?d.replaceValues({values:d.values.sort(o.createSorterFn(o.sorters)),silent:!0}):o.sort();else if(o.reorderOnSync)if(!o.tree)d.values.some((w,D)=>m[w.id]!==D)&&(d.replaceValues({values:d.values.sort((w,D)=>m[w.id]-m[D.id]),silent:!0}),!v&&o.afterPerformSort());else{let w=!1,D=0;Ui.preWalk(o.rootNode,S=>Array.isArray(S.children)&&!w?S.children:null,S=>{S.id!==m[D++]&&(w=!0)}),w&&(o.sort((S,x)=>m[S.id]-m[x.id],void 0,void 0,!0),o.clearSorters(!0),!v&&o.afterPerformSort())}v&&o.trigger("refresh",{action:"batch",data:t,records:d.values,syncInfo:b}),o.isSyncingDataOnLoad=!1,o.trigger("endApplyChangeset"),o.trigger("loadSync",b)}syncFlatDataset(t,r){if(!t)return{toRemove:this.records};const n=this,{idField:s,allFields:a}=n.modelClass,l=[],o=[],d=[],c={},u={},h=r instanceof Set,{threshold:g,keepMissingValues:f}=n.syncDataOnLoad;let m=0;if(t.forEach((p,v)=>{var b,w;p=p.isModel?p.data:p;const D=p[s],S=n.getById(D);if(!h||r.has(D))if(S){if(n.shouldSyncRecord?n.shouldSyncRecord({record:S,data:p,store:n})!==!1:p!==S.data){if((b=n.beforeSyncRecord)==null||b.call(n,{record:S,data:p}),f===!1)for(const R of a)!(R.dataSource in p)&&R.dataSource in S.data&&(p[R.dataSource]=R.defaultValue);const x=S.set(p,null,!!g);x&&d.push({record:S,wasSet:x,toSet:p}),(w=n.afterSyncRecord)==null||w.call(n,{record:S,data:p})}}else o.push(n.processRecord(n.createRecord(p)));S&&m++,c[D]=1,u[D]=v}),m<n.allRecords.filter(p=>!p.isSpecialRow).length)if(r)for(const p of r)c[p]||l.push(n.getById(p));else n.forEach(p=>{c[p.id]||l.push(p)},n,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0});return{toAdd:o,toRemove:l,toMove:[],updated:d,ids:u}}syncTreeDataset(t){var r;if(!t)return{toRemove:this.records};const n=this,{idField:s,parentIdField:a,childrenField:l,allFields:o}=n.modelClass,{keepMissingValues:d,threshold:c}=(r=n.syncDataOnLoad)!=null?r:{},u=[],h=[],g=[],f=[],m=new Set,p={};let v=0;return n.transformFlatData&&(t=n.treeifyFlatData(t)),Ui.preWalkWithParent({isRoot:!0,id:n.rootNode.id,children:t},b=>b.children,(b,w)=>{if(b){const{id:D,node:S}=n.resolveSyncNode(w);if(S){if(n.shouldSyncRecord?n.shouldSyncRecord({record:S,data:w,store:n})!==!1:w!==S.data){let x;const R=S.children;S.parent.id!==b[s]&&g.push({node:S,parent:b,index:b[l].indexOf(w)});let M;if(S!==w){if(R!==!0&&w[l]===!0&&(S.clearChildren(),S.data[l]=S.children=!0,delete w[l],n.toggleCollapse(S,!0),x=!0),d===!1)for(const _ of o)_.name!=="parentId"&&!(_.dataSource in w)&&_.dataSource in S.data&&(w[_.dataSource]=_.defaultValue);typeof w.expanded=="boolean"&&this.toggleCollapse(S,!w.expanded),M=S.set(w,null,!!c)}M?f.push({record:S,wasSet:M,toSet:w}):x&&S.signalNodeChanged({[l]:{value:!0,oldValue:R}})}m.add(S)}else w[a]=b[s],w.isModel?h.push(w):h.push({...w,...Array.isArray(w[l])?{children:[]}:void 0});p[D]=v++}}),n.totalCount!==m.size&&n.traverse(b=>{m.has(b)||u.push(b)}),{toAdd:h,toRemove:u,toMove:g,updated:f,ids:p}}resolveSyncNode(t){const r=t[this.modelClass.idField],n=this.getById(r);return{id:r,node:n}}},y(e,"$name","StoreSync"),e},Yo=class extends Error{constructor(...i){super(...i),this.name="RevisionException"}};Yo._$name="RevisionException";var Pe=()=>{throw new Error("Abstract method call!")},ne=()=>{throw new Error("Method cannot be called at this state!")},Tr=class extends ${canUndo(i){Pe()}canRedo(i){Pe()}canCheckoutTo(i){Pe()}onUndo(i){Pe()}onRedo(i){Pe()}onCheckoutTo(i){Pe()}onCheckoutToHead(i){Pe()}onStartRevision(i,e){Pe()}onStartTemporaryRevision(i,e,t){Pe()}onStopRevision(i){Pe()}onStartTransaction(i){Pe()}onStopTransaction(i){Pe()}onStopTransactionDelayed(i){Pe()}onRejectTransaction(i){Pe()}onEnable(i){Pe()}onDisable(i){Pe()}onAutoRecordOn(i){Pe()}onAutoRecordOff(i){Pe()}onResetQueue(i){Pe()}onModelUpdate(i){Pe()}onStoreModelAdd(i){Pe()}onStoreModelInsert(i){Pe()}onStoreModelRemove(i){Pe()}onStoreModelRemoveAll(i){Pe()}onModelInsertChild(i){Pe()}onModelRemoveChild(i){Pe()}};Tr._$name="StateBase";var Te=Symbol("STATE_PROP"),zt=Symbol("STORES_PROP"),wt=Symbol("QUEUE_PROP"),ri=Symbol("POS_PROP"),Ue=Symbol("ACTION_QUEUE_PROP"),Be=Symbol("REVISION_NAMES_PROP"),it=Symbol("REVISION_QUEUE_PROP"),St=Symbol("REVISION_INDEX_PROP"),xT=Symbol("CURRENT_REV_ID_PROP"),ke=Symbol("TRANSACTION_PROP"),Wt=Symbol("TRANSACTION_TIMER_PROP"),ni=Symbol("AUTO_RECORD_PROP"),qo=Symbol("IS_APPLYING_STASH"),PP=Object.freeze([Te,zt,wt,ri,Ue,Be,it,St,xT,ke,Wt,ni,qo]),Zb=new Map,RT=(i,e)=>{Zb.set(i,e)},TT=i=>(typeof i=="string"&&(i=Zb.get(i)),i),Ft={registerStmState:RT,resolveStmState:TT},Eu=(i,e)=>{const{undo:t,redo:r,revision:n}=e;let s;return t&&!r?s={[wt]:i[wt].slice(i.position),[ri]:0}:r&&!t?s={[wt]:i[wt].slice(0,i.position)}:s={[wt]:[],[ri]:0},n&&(s=Object.assign(s!=null?s:{},{[Be]:["base"],[St]:0,[it]:[]})),[s,()=>{i.notifyStoresAboutQueueReset(e)}]},MT=class extends Tr{canUndo(){return!1}canRedo(){return!1}canCheckoutTo(){return!1}onUndo(){ne()}onRedo(){ne()}onEnable(i){return i.autoRecord?"autoreadystate":"readystate"}onDisable(){ne()}onAutoRecordOn(){return{[ni]:!0}}onAutoRecordOff(){return{[ni]:!1}}onStartTransaction(){ne()}onStopTransaction(){ne()}onStopTransactionDelayed(){ne()}onRejectTransaction(){ne()}onResetQueue(i,e){return Eu(i,e)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},Jb=new MT,_T=Jb;Ft.registerStmState("disabledstate",Jb);var Gi=class extends ${static get defaultConfig(){return{inversed:!1}}get type(){return this.constructor.name}undo(){Pe()}redo(){Pe()}invert(){const i=new this.constructor({...this.initialConfig,isUserInput:this.isUserInput,inversed:!0}),{undo:e,redo:t}=i;return i.undo=t,i.redo=e,i}},vt={ADD:"AddAction",INSERT:"InsertAction",INSERT_CHILD:"InsertChildAction",REMOVE:"RemoveAction",REMOVE_ALL:"RemoveAllAction",REMOVE_CHILD:"RemoveChildAction",UPDATE:"UpdateAction",EVENT_UPDATE:"EventUpdateAction"};Gi._$name="ActionBase";var Qb=Symbol("MODEL_PROP"),eC=Symbol("NEW_DATA_PROP"),tC=Symbol("OLD_DATA_PROP"),xu=class extends Gi{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return vt.UPDATE}get model(){return this[Qb]}set model(i){this[Qb]=i}get newData(){return this[eC]}set newData(i){this[eC]={...i}}get oldData(){return this[tC]}set oldData(i){this[tC]={...i}}undo(){const{model:i,oldData:e}=this;i.$&&Object.assign(i,e),i.set(e,null,null,null,!!i.$)}redo(){const{model:i,newData:e}=this;i.$&&Object.assign(i,e),i.set(e,null,null,null,!!i.$)}};y(xu,"$name","UpdateAction"),xu._$name="UpdateAction";var iC=Symbol("PARENT_MODEL_PROP"),rC=Symbol("CHILD_MODELS_PROP"),nC=Symbol("INSERT_INDEX_PROP"),sC=Symbol("ORDERED_PROP"),aC=Symbol("CONTEXT_PROP"),Ru=class extends Gi{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,orderedBeforeNode:void 0,context:void 0,stores:void 0}}get type(){return vt.INSERT_CHILD}get parentModel(){return this[iC]}set parentModel(i){this[iC]=i}get childModels(){return this[rC]}set childModels(i){this[rC]=i.slice(0)}get insertIndex(){return this[nC]}set insertIndex(i){this[nC]=i}get orderedBeforeNode(){return this[sC]}set orderedBeforeNode(i){this[sC]=i}get context(){return this[aC]}set context(i){this[aC]=i}get stores(){return this[zt]}set stores(i){this[zt]=i}undo(){const{parentModel:i,context:e,childModels:t}=this,r=new Map,n=new Set;for(const s of t){const a=e.get(s);if(!a)n.add(s);else{let l=r.get(a.parent);l||(l={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},r.set(a.parent,l)),a.parent===i?a.index>s.parentIndex?l.moveRight.push({parent:a.parent,model:s,index:a.index+1}):l.moveLeft.push({parent:a.parent,model:s,index:a.index}):l.moveFromAnotherParent.push({parent:a.parent,model:s,index:a.index})}}n.forEach(s=>s.parent.removeChild(s));for(const s of r.values()){const{moveRight:a,moveLeft:l,moveFromAnotherParent:o}=s;o.forEach(d=>{d.parent.insertChild(d.model,d.index)}),l.sort((d,c)=>d.index-c.index),a.sort((d,c)=>c.index-d.index)}for(const s of r.values()){const{moveRight:a,moveLeft:l}=s;l.forEach(o=>{o.parent.insertChild(o.model,o.index)}),a.forEach(o=>{o.parent.insertChild(o.model,o.index)})}}redo(){var i,e;const{parentModel:t,insertIndex:r,childModels:n,orderedBeforeNode:s}=this,a=(i=t.children)==null?void 0:i[r];t.insertChild(n,a,!1,{orderedBeforeNode:s!=null?s:(e=a==null?void 0:a.previousSibling)==null?void 0:e.nextOrderedSibling})}};y(Ru,"$name","InsertChildAction"),Ru._$name="InsertChildAction";var lC=Symbol("PARENT_MODEL_PROP"),oC=Symbol("CHILD_MODELS_PROP"),dC=Symbol("CONTEXT_PROP"),Tu=class extends Gi{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0,stores:void 0}}get type(){return vt.REMOVE_CHILD}get parentModel(){return this[lC]}set parentModel(i){this[lC]=i}get childModels(){return this[oC]}set childModels(i){this[oC]=i.slice(0)}get context(){return this[dC]}set context(i){this[dC]=i}get stores(){return this[zt]}set stores(i){this[zt]=i}undo(){const{parentModel:i,context:e,childModels:t}=this;t.sort((r,n)=>{const s=e.get(r).parentIndex,a=e.get(n).parentIndex;return s-a}),t.forEach(r=>{const n=e.get(r);i.insertChild(r,n.parentIndex,void 0,{orderedParentIndex:n.orderedParentIndex})})}redo(){this.parentModel.removeChild(this.childModels)}};y(Tu,"$name","RemoveChildAction"),Tu._$name="RemoveChildAction";var cC=Symbol("STORE_PROP"),uC=Symbol("MODEL_LIST_PROP"),Mu=class extends Gi{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return vt.ADD}get store(){return this[cC]}set store(i){this[cC]=i}get modelList(){return this[uC]}set modelList(i){this[uC]=i.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}};y(Mu,"$name","AddAction"),Mu._$name="AddAction";var hC=Symbol("STORE_PROP"),gC=Symbol("MODEL_LIST_PROP"),fC=Symbol("INSERT_INDEX_PROP"),mC=Symbol("CONTEXT_PROP"),_u=class extends Gi{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1,reportUndoneRemoval:!0}}get type(){return vt.INSERT}get store(){return this[hC]}set store(i){this[hC]=i}get modelList(){return this[gC]}set modelList(i){this[gC]=i.slice(0)}get insertIndex(){return this[fC]}set insertIndex(i){this[fC]=i}get context(){return this[mC]}set context(i){this[mC]=i}undo(){const{store:i,modelList:e,context:t,silent:r,reportUndoneRemoval:n}=this;e.sort((s,a)=>{const l=t.get(s),o=t.get(a);return l!==void 0&&o!==void 0?l-o:0}),e.forEach(s=>{const a=t.get(s);s._undoingInsertion=n,a!==void 0?i.insert(a,s,r):i.remove(s,r),s._undoingInsertion=!1})}redo(){const i=this;i.store.insert(i.insertIndex,i.modelList,i.silent)}};y(_u,"$name","InsertAction"),_u._$name="InsertAction";var pC=Symbol("STORE_PROP"),vC=Symbol("MODEL_LIST_PROP"),yC=Symbol("CONTEXT_PROP"),ku=class extends Gi{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return vt.REMOVE}get store(){return this[pC]}set store(i){this[pC]=i}get modelList(){return this[vC]}set modelList(i){this[vC]=i.slice(0)}get context(){return this[yC]}set context(i){this[yC]=i}undo(){const{store:i,context:e,modelList:t,silent:r}=this;t.sort((n,s)=>{const a=e.get(n),l=e.get(s);return a-l}),t.forEach(n=>{const s=e.get(n);i.insert(s,n,r)})}redo(){this.store.remove(this.modelList,this.silent)}};y(ku,"$name","RemoveAction"),ku._$name="RemoveAction";var bC=Symbol("STORE_PROP"),CC=Symbol("ALL_RECORDS_PROP"),Fu=class extends Gi{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return vt.REMOVE_ALL}get store(){return this[bC]}set store(i){this[bC]=i}get allRecords(){return this[CC]}set allRecords(i){this[CC]=i.slice(0)}undo(){const{store:i,allRecords:e,silent:t}=this;i.add(e,t)}redo(){this.store.removeAll(this.silent)}};y(Fu,"$name","RemoveAllAction"),Fu._$name="RemoveAllAction";var kT=(i,e,t,r)=>new xu({model:i,newData:e,oldData:t,isInitialUserAction:r}),FT=(i,e,t,r,n,s)=>new Ru({parentModel:i,childModels:t,insertIndex:e,orderedBeforeNode:n,context:r,stores:s}),IT=(i,e,t,r)=>new Tu({parentModel:i,childModels:e,context:t,stores:r}),AT=(i,e,t)=>new Mu({store:i,modelList:e,silent:t}),LT=(i,e,t,r,n)=>new _u({store:i,insertIndex:e,modelList:t,context:r,silent:n}),PT=(i,e,t,r)=>new ku({store:i,modelList:e,context:t,silent:r}),OT=(i,e,t)=>new Fu({store:i,allRecords:e,silent:t}),$T=i=>i.invert(),Mr={DATA_CORRECTION:"DATA_CORRECTION",TEMPORARY:"TEMPORARY",CONFLICT_RESOLUTION:"CONFLICT_RESOLUTION"},It=class extends ${static get configurable(){return{title:null,committed:!1,inputGeneration:0}}static from(i,e={}){const t=new this({...this.initialConfig,...e,inputGeneration:i.reduce((r,n)=>{var s;return Math.max(r,(s=n.inputGeneration)!=null?s:0)},0),committed:!1});return t[Ue]=i.flatMap(r=>r[Ue].filter(n=>r.inputGeneration>0?e.conflictResolutionFor?n.isUserInput===r.inputGeneration:n.isUserInput:n)),t}static createTransactionWithOriginalInput(i){const e=new this({...this.initialConfig,title:i.title,committed:!1});return e[Ue]=i[Ue].filter(t=>t.isUserInput?t.isUserInput===1:!t.isUserInput),e}construct(...i){this[Ue]=[],super.construct(...i)}get queue(){return this[Ue].slice(0)}get length(){return this[Ue].length}get filterUserInput(){return this.inputGeneration>0}addAction(i){this[Ue].push(i)}undo(){const i=this[Ue];for(let e=i.length-1;e>=0;--e)i[e].undo()}redo(){const i=this[Ue];for(let e=0,t=i.length;e<t;++e)i[e].redo()}mergeUpdateModelActions(){var i,e,t;const r=this[Ue],n=new Map,s=[];for(const a of r)if(a.isUpdateAction&&((i=a.model)!=null&&i.isModel)){const l=(e=a.isUserInput)!=null?e:0;let o=n.get(a.model);o||(o=[],n.set(a.model,o));const d=o[l];if(!d)o[l]=a,s.push(a);else for(const c in a.oldData)a.newData.hasOwnProperty(c)&&(d.oldData.hasOwnProperty(c)||(d.oldData[c]=a.oldData[c]),d.newData[c]=a.newData[c])}else if(s.push(a),a.isRemoveAction&&((t=a.modelList)!=null&&t.length))for(const l of a.modelList)n.delete(l);this[Ue]=s,this.inputGeneration=Math.max(...s.map(a=>{var l;return(l=a.isUserInput)!=null?l:0}),0)}mergeAddUpdateModelActions(){const i=this[Ue],e=new Set,t=[];for(const r of i)r.isAddAction||r.isInsertAction?r.modelList.forEach(n=>e.add(n)):r.isInsertChildAction&&r.childModels.forEach(n=>e.add(n)),(r.isUpdateAction||r.isEventUpdateAction)&&e.has(r.model)||t.push(r);this[Ue]=t,this.inputGeneration=Math.max(...t.map(r=>{var n;return(n=r.isUserInput)!=null?n:0}),0)}invert(){const i=new this.constructor({...this.initialConfig,title:this.title});return i[Ue]=this[Ue].map(e=>$T(e)),i}groupUserInput(){return this[Ue].reduce((i,e)=>{var t;const r=(t=e.isUserInput)!=null?t:"default";return i.has(r)||i.set(r,[]),i.get(r).push(e),i},new Map)}getUserInput(i){const e=new Map,t={},r=this.groupUserInput().get(i!=null?i:this.inputGeneration||"default"),n=(s,a)=>(a in t?s in t[a]||(t[a][s]=[]):t[a]={[s]:[]},t[a][s]);for(const s of r)switch(s.type){case vt.ADD:case vt.INSERT:{s.inversed?n("removed",s.store.id).push(...s.modelList):n("added",s.store.id).push(...s.modelList);break}case vt.REMOVE:case vt.REMOVE_ALL:{s.inversed?n("added",s.store.id).push(...s.modelList||s.allRecords):n("removed",s.store.id).push(...s.modelList||s.allRecords);break}case vt.INSERT_CHILD:{const a=(l,o)=>{var d;o.added.includes(l)?n("added",o.id).push(l):o.removed.includes(l)&&n("removed",o.id).push(l),(d=l.children)==null||d.forEach(c=>a(c,o))};for(const l of s.stores)s.childModels.forEach(o=>a(o,l)),l.modified.forEach(o=>{const d=o.hierarchyModificationDataToWrite;d&&(e.has(o)?e.set(o,{...e.get(o),...d}):e.set(o,d))});break}case vt.REMOVE_CHILD:{let a=function(l,o){l.forEach(d=>{o.push(d),d.children&&a(d.children,o)})};for(const l of s.stores)if(s.inversed){const o=n("added",l.id);a(s.childModels,o)}else{const o=n("removed",l.id);a(s.childModels,o)}break}case vt.UPDATE:case vt.EVENT_UPDATE:{e.has(s.model)?e.set(s.model,{...e.get(s.model),...s.newData}):e.set(s.model,{...s.newData});break}default:break}if(e.size>0&&(t.updated=e),Object.keys(t).length>0)return t}markCurrentTransactionContentUserInput(){const i=this.inputGeneration+1,e=this[Ue];let t=!1;e.forEach(r=>{r.isUserInput===void 0&&!r.isCalculated&&(r.isUserInput=i,t=!0)}),t&&(this.inputGeneration=i)}markCurrentTransactionContentCalculated(){const i=this.inputGeneration;this[Ue].forEach(t=>{t.isCalculated===void 0&&!t.isUserInput&&(t.isCalculated=i)})}normalizeUserInputGeneration(){this[Ue].forEach(i=>i.isUserInput=this.inputGeneration)}};It._$name="Transaction";var Of=class extends Tr{canUndo(i){return 0<i.position&&i.position<=i.length}canRedo(i){return 0<=i.position&&i.position<i.length}canCheckoutTo(i,e){return i.revisionsEnabled?i[Be].includes(e)?!0:(console.warn("Revision is not found"),!1):(console.warn("Revisions are disabled"),!1)}onUndo(i,e){let t=i.position;const r=i[wt],n=Math.max(0,t-e),s=()=>{i.notifyStoresAboutStateRestoringStart();const a=[];for(;t!==n;){const l=r[--t];l.undo(),a.push(l)}return[i.autoRecord?"autoreadystate":"readystate",()=>{i.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:a})}]};return[{[Te]:"restoringstate",[ri]:n},s]}onRedo(i,e){let t=i.position;const r=i[wt],n=Math.min(r.length,t+e),s=()=>{i.notifyStoresAboutStateRestoringStart();const a=[];do{const l=r[t++];l.redo(),a.push(l)}while(t!==n);return[i.autoRecord?"autoreadystate":"readystate",()=>{i.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:a})}]};return[{[Te]:"restoringstate",[ri]:n},s]}onCheckoutTo(i,e){const t=i[Be].indexOf(e),r=Math.min(t,i[St]),n=Math.max(t,i[St]),s=t<i[St];let a=i[it].slice(r,n);return s&&(a=a.filter(o=>!o.conflictResolutionFor||o.type===Mr.TEMPORARY).reverse(),i[it].filter((o,d)=>d>=r&&o.dummy).forEach(o=>{i[it].splice(i[it].indexOf(o),1),i[Be].splice(i[Be].indexOf(o.title),1)})),[{[Te]:"checkoutstate",[St]:t},()=>{i.notifyStoresAboutCheckoutStart();for(const l of a)l[s?"undo":"redo"]()}]}onCheckoutToHead(i){ne()}onEnable(){ne()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[Te]:"autoreadystate",[ni]:!0}}onAutoRecordOff(){ne()}onStartTransaction(i,e){const t=new It({title:e});return[{[Te]:"recordingstate",[ke]:t},()=>{i.notifyStoresAboutStateRecordingStart(t)}]}onStopTransaction(){ne()}onStopTransactionDelayed(){ne()}onRejectTransaction(){ne()}onResetQueue(i,e){return Eu(i,e)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},wC=new Of,Iu=wC;Ft.registerStmState("readystate",wC);var Au=class extends Tr{canUndo(){return!1}canRedo(){return!1}canCheckoutTo(){return!1}onEnable(){}onDisable(i){const e=i[ke];return i.notifyStoresAboutStateRecordingStop(e,{disabled:!0}),{[Te]:"disabledstate",[ke]:null}}onAutoRecordOn(i){return[{[Te]:"autorecordingstate",[ni]:!0},()=>{i.stopTransactionDelayed()}]}onAutoRecordOff(){ne()}onStartTransaction(){ne()}onStopTransaction(i,e){const t=i[ke],r=i[wt];let n=i[ri];return t.length&&(!t.title&&!e&&i.getTransactionTitle?t.title=i.getTransactionTitle(t):e&&(t.title=e),r[n]=t,r.length=++n),[{[Te]:"readystate",[ri]:n,[ke]:null},()=>{i.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onRejectTransaction(i){const e=i[ke];return[{[Te]:"restoringstate",[ke]:null},()=>(e.length&&e.undo(),["readystate",()=>{i.notifyStoresAboutStateRecordingStop(e,{rejected:!0})}])]}onStopTransactionDelayed(){ne()}onResetQueue(i,e){return Eu(i,e)}onModelUpdate(i,e,t,r,n){i[ke].addAction(i.makeModelUpdateAction(e,t,r,n))}onModelInsertChild(i,e,t,r,n,s){const a=i[ke],l=e.stores.filter(o=>i.stores.includes(o));a.addAction(i.makeModelInsertChildAction(e,t,r,n,s,l))}onModelRemoveChild(i,e,t,r){const n=i[ke],s=e.stores.filter(a=>i.stores.includes(a));n.addAction(i.makeModelRemoveChildAction(e,t,r,s))}onStoreModelAdd(i,e,t,r){i[ke].addAction(i.makeStoreModelAddAction(e,t,r))}onStoreModelInsert(i,e,t,r,n,s){const a=i[ke],l=i.makeStoreModelInsertAction(e,t,r,n,s);l.reportUndoneRemoval=!i.revisionsEnabled,a.addAction(l)}onStoreModelRemove(i,e,t,r,n){i[ke].addAction(i.makeStoreModelRemoveAction(e,t,r,n))}onStoreRemoveAll(i,e,t,r){i[ke].addAction(i.makeStoreRemoveAllAction(e,t,r))}},SC=new Au,HT=SC;Ft.registerStmState("recordingstate",SC);var DC=class extends Tr{canUndo(){return!1}canRedo(){return!1}canCheckoutTo(){return!1}onUndo(){ne()}onRedo(){ne()}onEnable(){ne()}onDisable(){ne()}onAutoRecordOn(){return{[ni]:!0}}onAutoRecordOff(){return{[ni]:!1}}onStartTransaction(){ne()}onStopTransaction(){ne()}onStopTransactionDelayed(){ne()}onRejectTransaction(){ne()}onQueueReset(){ne()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};y(DC,"$name","RestoringStateClass");var EC=new DC,xC=EC;Ft.registerStmState("restoringstate",EC);var VT=class extends Of{onAutoRecordOn(){ne()}onAutoRecordOff(){return{[Te]:"readystate",[ni]:!1}}onStartTransaction(i,e){const t=new It({title:e});return[{[Te]:"autorecordingstate",[ke]:t},()=>{i.notifyStoresAboutStateRecordingStart(t),i.stopTransactionDelayed()}]}onModelUpdate(i,e,t,r){i.startTransaction(),i.onModelUpdate(e,t,r)}onModelInsertChild(i,e,t,r,n){i.startTransaction(),i.onModelInsertChild(e,t,r,n)}onModelRemoveChild(i,e,t,r){i.startTransaction(),i.onModelRemoveChild(e,t,r)}onStoreModelAdd(i,e,t,r){i.startTransaction(),i.onStoreModelAdd(e,t,r)}onStoreModelInsert(i,e,t,r,n,s){i.startTransaction(),i.onStoreModelInsert(e,t,r,n,s)}onStoreModelRemove(i,e,t,r,n){i.startTransaction(),i.onStoreModelRemove(e,t,r,n)}onStoreRemoveAll(i,e,t,r){i.startTransaction(),i.onStoreRemoveAll(e,t,r)}},RC=new VT,$f=RC;Ft.registerStmState("autoreadystate",RC);var NT=class extends Au.mixin(fe){onDisable(i){const e=i[ke],t=i[Wt];return t&&this.clearTimeout(t),i.notifyStoresAboutStateRecordingStop(e,{disabled:!0}),{[Te]:"disabledstate",[ke]:null,[Wt]:null}}onAutoRecordOn(i){ne()}onAutoRecordOff(i){const e=i[Wt];return e&&this.clearTimeout(e),{[Te]:"recordingstate",[ni]:!1,[Wt]:null}}onStopTransaction(i,e){const t=i[ke],r=i[Wt],n=i[wt];let s=i[ri];return r&&this.clearTimeout(r),t.length&&(!t.title&&!e&&i.getTransactionTitle?t.title=i.getTransactionTitle(t):e&&(t.title=e),n[s]=t,n.length=++s),[{[Te]:"autoreadystate",[ri]:s,[ke]:null,[Wt]:null},()=>{i.notifyStoresAboutStateRecordingStop(t,{stop:!0})}]}onStopTransactionDelayed(i){let e=i[Wt];return e&&this.clearTimeout(e),e=this.setTimeout(()=>{i.stopTransaction()},i.autoRecordTransactionStopTimeout),{[Te]:Hf,[Wt]:e}}onResetQueue(i,e){return Eu(i,e)}onRejectTransaction(i){const e=i[ke],t=i[Wt];return t&&this.clearTimeout(t),[{[Te]:"restoringstate",[ke]:null,[Wt]:null},()=>(e.length&&e.undo(),["autoreadystate",()=>{i.notifyStoresAboutStateRecordingStop(e,{rejected:!0})}])]}onModelUpdate(i,...e){super.onModelUpdate(i,...e),i.stopTransactionDelayed()}onModelInsertChild(i,...e){super.onModelInsertChild(i,...e),i.stopTransactionDelayed()}onModelRemoveChild(i,...e){super.onModelRemoveChild(i,...e),i.stopTransactionDelayed()}onStoreModelAdd(i,...e){super.onStoreModelAdd(i,...e),i.stopTransactionDelayed()}onStoreModelInsert(i,...e){super.onStoreModelInsert(i,...e),i.stopTransactionDelayed()}onStoreModelRemove(i,...e){super.onStoreModelRemove(i,...e),i.stopTransactionDelayed()}onStoreRemoveAll(i,...e){super.onStoreRemoveAll(i,...e),i.stopTransactionDelayed()}},Hf=new NT,BT=Hf;Ft.registerStmState("autorecordingstate",Hf);var zT=class extends Of{canUndo(i){return!1}canRedo(i){return!1}onUndo(i){ne()}onRedo(i){ne()}onStartRevision(i,e){const t=new It({title:e});return[{[Te]:"revisionrecordingstate",[ke]:t},()=>{i.notifyStoresAboutRevRecordingStart()}]}onStartTemporaryRevision(i,e,t){const r=new It({title:e});return t&&(r[Ue]=t[Ue].slice()),[{[Te]:"temporaryrevisionrecordingstate",[ke]:r},()=>{i.notifyStoresAboutTempRevRecordingStart()}]}onCheckoutToHead(i){return i.notifyStoresAboutCheckoutToHead({revision:i[Be][i[Be].length-1]}),i.autoRecord?"autoreadystate":"readystate"}onStartTransaction(i){ne()}onStopTransaction(i){ne()}onStopTransactionDelayed(i){ne()}onRejectTransaction(i){ne()}onEnable(i){ne()}onDisable(i){ne()}onAutoRecordOn(i){ne()}onAutoRecordOff(i){ne()}onResetQueue(i){ne()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},TC=new zT,Vf=TC;Ft.registerStmState("checkoutstate",TC);var WT=class extends Au{canUndo(i){return!1}canRedo(i){return!1}canCheckoutTo(){return!1}onUndo(i){ne()}onRedo(i){ne()}onCheckoutToHead(i){ne()}onStopRevision(i,e){const t=i[ke],r=i[it],n=i[Be],s=i[St]+1,a=It.createTransactionWithOriginalInput(t);return n.splice(s,0,a.title),r.splice(s-1,0,a),i.commitRevision(a.title),[{[Te]:"checkoutstate",[St]:s,[ke]:null},()=>{i.notifyStoresAboutRevRecordingStop(a)}]}onStartTransaction(i){ne()}onStopTransaction(i){ne()}onStopTransactionDelayed(i){ne()}onRejectTransaction(i){ne()}onEnable(i){ne()}onDisable(i){ne()}onAutoRecordOn(i){ne()}onAutoRecordOff(i){ne()}onResetQueue(i){ne()}},MC=new WT,_C=MC;Ft.registerStmState("revisionrecordingstate",MC);var jT=class extends Au{canUndo(i){return!1}canRedo(i){return!1}canCheckoutTo(){return!1}onUndo(i){ne()}onRedo(i){ne()}onCheckoutToHead(i){ne()}onStopRevision(i,e){const t=i[ke];return[{[Te]:"checkoutstate",[ke]:null},()=>{i.notifyStoresAboutTempRevRecordingStop(t)}]}onStartTransaction(i){ne()}onStopTransaction(i){ne()}onStopTransactionDelayed(i){ne()}onRejectTransaction(i){ne()}onEnable(i){ne()}onDisable(i){ne()}onAutoRecordOn(i){ne()}onAutoRecordOff(i){ne()}onResetQueue(i){ne()}},kC=new jT,FC=kC;Ft.registerStmState("temporaryrevisionrecordingstate",kC);var ze=(i,e,...t)=>{const r=i.state,n=e.call(i[Te],i,...t);if(typeof n=="string")i[Te]=Ft.resolveStmState(n);else if(n instanceof Tr)i[Te]=n;else if(Array.isArray(n)){const[s,a]=n;typeof s=="string"?i[Te]=Ft.resolveStmState(s):s instanceof Tr?i[Te]=s:s&&typeof s=="object"&&(i=Object.assign(i,s),i[Te]=Ft.resolveStmState(i[Te])),typeof a=="function"&&ze(i,a,...t)}else n&&typeof n=="object"&&(i=Object.assign(i,n),i[Te]=Ft.resolveStmState(i[Te]));r!==Iu&&r!==$f&&n!==Iu&&n!==$f&&i.trigger("ready")},Ko=class extends Fe($){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,autoRecordMergeUpdateActions:!0,mergeAddUpdateActions:!1,makeModelUpdateAction:kT,makeModelInsertChildAction:FT,makeModelRemoveChildAction:IT,makeStoreModelAddAction:AT,makeStoreModelInsertAction:LT,makeStoreModelRemoveAction:PT,makeStoreRemoveAllAction:OT,getTransactionTitle:null,revisionsEnabled:!1,asyncUndoRedo:!1,revisionLocalPrefix:"local-",revisionQueueMaxLength:20,revisionQueueCommittedMinLength:1}}construct(...i){Object.assign(this,{[Te]:Iu,[zt]:[],[wt]:[],[ri]:0,[ke]:null,[Wt]:null,[ni]:!1,[qo]:!1,stashedTransactions:{}}),super.construct(...i)}get state(){return this[Te]}get position(){return this[ri]}get length(){return this[wt].length}get stores(){return Array.from(this[zt])}hasStore(i){return this[zt].includes(i)}addStore(i){this.hasStore(i)||(this[zt].push(i),i.stm=this,i.forEach(e=>e.stm=this),i.isTree&&(i.rootNode.stm=this))}removeStore(i){this.hasStore(i)&&(this[zt]=this[zt].filter(e=>e!==i),i.stm=null,i.forEach(e=>e.stm=null))}forEachStore(i){this[zt].forEach(e=>i(e,e.id))}get disabled(){return this.state===_T}set disabled(i){const e=this;e.disabled!==i&&(i?ze(e,e.state.onDisable,e):ze(e,e.state.onEnable,e),e.trigger("stmDisabled",{disabled:i}),e.trigger("disabled",{disabled:i}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===Iu||this.state===$f}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===HT||this.state===BT}get isApplyingStash(){return this[qo]}get shouldRecordAction(){return this.enabled&&(!this.isRestoringState||this.isApplyingStash)&&!this.isCheckingOut}get autoRecord(){return this[ni]}set autoRecord(i){const e=this;e.autoRecord!=i&&(i?ze(e,e.state.onAutoRecordOn,e):ze(e,e.state.onAutoRecordOff,e))}startTransaction(i=null){ze(this,this.state.onStartTransaction,i)}stopTransaction(i=null){const e=this;e.autoRecord&&e.autoRecordMergeUpdateActions&&e.mergeTransactionUpdateActions(),e.mergeAddUpdateActions&&e.mergeTransactionAddUpdateActions(),ze(e,e.state.onStopTransaction,i)}stopTransactionDelayed(){ze(this,this.state.onStopTransactionDelayed)}rejectTransaction(){ze(this,this.state.onRejectTransaction)}get transaction(){return this[ke]}get queue(){return this[wt].map(i=>i.title)}get rawQueue(){return this[wt]}get isRestoringState(){return this.state===xC}get isRestoring(){return this.state===xC||this.isApplyingStash||this.isNavigatingRevisions}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(i=1){this.isReady||await this.waitForReadiness(),ze(this,this.state.onUndo,i)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(i=1){this.isReady||await this.waitForReadiness(),ze(this,this.state.onRedo,i)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(i={undo:!0,redo:!0,revision:!0}){ze(this,this.state.onResetQueue,i)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}resetRevisionQueue(){this.resetQueue({revision:!0})}notifyStoresAboutStateRecordingStart(i){this.forEachStore(e=>{var t;return(t=e.onStmRecordingStart)==null?void 0:t.call(e,this,i)}),this.trigger("recordingStart",{stm:this,transaction:i})}notifyStoresAboutStateRecordingStop(i,e){const t=this;t.forEachStore(r=>{var n;return(n=r.onStmRecordingStop)==null?void 0:n.call(r,t,i,e)}),t.trigger("recordingStop",{stm:t,transaction:i,reason:e}),t.revisionsEnabled&&e.stop&&t.increaseRevision(It.from([i]))}notifyStoresAboutStateRestoringStart(){this.forEachStore(i=>{var e;return(e=i.onStmRestoringStart)==null?void 0:e.call(i,this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:i,transactions:e}){const t=this;if(t.forEachStore(r=>{var n;return(n=r.onStmRestoringStop)==null?void 0:n.call(r,t)}),t.trigger("restoringStop",{stm:t,cause:i,transactions:e}),t.revisionsEnabled)if(t.asyncUndoRedo){const r=()=>{const n=It.from(e);t.increaseRevision(i==="undo"?n.invert():n)};t.trigger("increaseRevisionAsync",{callback:r})}else{const r=It.from(e);t.increaseRevision(i==="undo"?r.invert():r)}}notifyStoresAboutQueueReset(i){this.forEachStore(e=>{var t;return(t=e.onStmQueueReset)==null?void 0:t.call(e,this,i)}),this.trigger("queueReset",{stm:this,options:i})}notifyStoresAboutCheckoutStart(){this.trigger("checkoutStart",{stm:this})}notifyStoresAboutRevRecordingStart(){this.trigger("revisionRecordingStart",{stm:this})}notifyStoresAboutTempRevRecordingStart(){this.trigger("temporaryRevisionRecordingStart",{stm:this})}notifyStoresAboutRevRecordingStop(i){this.trigger("revisionRecordingStop",{stm:this,revision:i.title})}notifyStoresAboutTempRevRecordingStop(i){this.trigger("temporaryRevisionRecordingStop",{stm:this,revision:i.title})}notifyStoresAboutCheckoutToHead({revision:i}){this.trigger("checkoutToHead",{stm:this,revision:i})}onModelUpdate(i,e,t,r){ze(this,this.state.onModelUpdate,i,e,t,r)}onModelInsertChild(i,e,t,r,n){ze(this,this.state.onModelInsertChild,i,e,t,r,n)}onModelRemoveChild(i,e,t){ze(this,this.state.onModelRemoveChild,i,e,t)}onStoreModelAdd(i,e,t){ze(this,this.state.onStoreModelAdd,i,e,t)}onStoreModelInsert(i,e,t,r,n){ze(this,this.state.onStoreModelInsert,i,e,t,r,n)}onStoreModelRemove(i,e,t,r){ze(this,this.state.onStoreModelRemove,i,e,t,r)}onStoreRemoveAll(i,e,t){ze(this,this.state.onStoreRemoveAll,i,e,t)}onUndoKeyPress(i){const e=this;e.enabled&&(i.shiftKey?e.canRedo&&(i.preventDefault(),e.redo()):e.canUndo&&(i.preventDefault(),e.undo()))}stash(){const i=this;if(i.transaction){const e=Si.generateId("_stashedTransactionGeneratedId_");return i.stashedTransactions[e]=i.transaction,i.rejectTransaction(),e}}applyStash(i){const e=this,t=e.stashedTransactions[i];e[qo]=!0,t&&(e.startTransaction(t.title),t.redo(),delete e.stashedTransactions[i]),e[qo]=!1}mergeTransactionUpdateActions(i=this.transaction){i.mergeUpdateModelActions()}mergeTransactionAddUpdateActions(i=this.transaction){i.mergeAddUpdateModelActions()}canCheckoutTo(i){return(this.isReady||this.state===Vf)&&this.state.canCheckoutTo(this,i)}get currentRevision(){if(this.revisionsEnabled)return this[Be][this[St]]}get lastRevision(){if(this.revisionsEnabled)return this[Be][this[Be].length-1]}get currentRevisionTransaction(){if(this.revisionsEnabled)return this[it][this[St]-1]}get lastCommittedRevision(){const i=this[it];let e;for(let t=i.length-1;t>=0;t--)if(i[t].committed){e=i[t];break}return e}get lastCommittedRevisionId(){var i,e;return(e=(i=this.lastCommittedRevision)==null?void 0:i.title)!=null?e:this[Be][0]}get localRevisions(){return this[it].slice(this[it].findIndex(i=>!i.committed))}get isCheckingOut(){return this.state===Vf}get isRecordingRevision(){return this.state===_C}get isRecordingTemporaryRevision(){return this.state===FC}get isNavigatingRevisions(){return this.state===Vf||this.state===_C||this.state===FC}initRevision(i,e=!0){const t=this;t.revisionsEnabled&&(t.autoRecord=e,t[Be]=[i],t[it]=[],t[St]=0)}increaseRevision(i,e){const t=this;let r;if(!(Be in t))throw new Error("Revisions should be initialized first with `project.initRevisions(<client id>)` call");if(!t.revisionsEnabled)return;if(t.isNavigatingRevisions&&!i.type)throw new Yo("Cannot add new revision when in the checkout state");if(!i[Ue].length&&!i.type)return;const n=Si.generateId(t.revisionLocalPrefix);if(i.title=n,t.trigger("beforeRevisionAdd",{localRevisionId:n})===!1)return;const s=i.conflictResolutionFor&&t[it].find(l=>l.type===Mr.TEMPORARY&&l.conflictResolutionFor===i.conflictResolutionFor);if(s?(t[Be].splice(t[Be].indexOf(s.title),1,n),t[it].splice(t[it].indexOf(s),1,i)):(t[Be].push(n),t[it].push(i)),i.conflictResolutionFor||(t[St]=t[Be].length-1),i.type===Mr.TEMPORARY)return;i.filterUserInput&&(i.conflictResolutionFor||i.normalizeUserInputGeneration(),r=i.getUserInput()),!e&&t[it].length>t.revisionQueueMaxLength&&!i.type&&t.cleanUpRevisions();const a={localRevisionId:n,userInput:r};i.conflictResolutionFor&&(a.conflictResolutionFor=i.conflictResolutionFor,a.revisionChanges=e),t.trigger("revisionAdd",a)}createDataCorrectionTransaction(){const i=new It({type:Mr.DATA_CORRECTION});this.increaseRevision(i)}createConflictResolutionRevision(i,e,t){const{transaction:r}=this;if(t=T.clone(t),e){const n=this[it].find(s=>s.conflictResolutionFor===e);n&&(n.conflictResolutionFor=i)}this.increaseRevision(It.from([r],{conflictResolutionFor:i!=null?i:r.title,type:Mr.CONFLICT_RESOLUTION}),t)}createTemporaryConflictResolutionRevision(i,e){const{transaction:t}=this;this.increaseRevision(It.from([t],{conflictResolutionFor:i!=null?i:t.title,type:Mr.TEMPORARY}),e)}checkoutTo(i){if(!this.canCheckoutTo(i))return!1;ze(this,this.state.onCheckoutTo,i)}checkoutToLastCommittedRevision(){this.checkoutTo(this.lastCommittedRevisionId)}checkoutToHead(){this.checkoutTo(this[Be][this[Be].length-1]),ze(this,this.state.onCheckoutToHead)}checkoutToNext(){return this[St]+1<this[Be].length?this.checkoutTo(this[Be][this[St]+1]):!1}startRevision(i){ze(this,this.state.onStartRevision,i)}stopRevision(){ze(this,this.state.onStopRevision)}startTemporaryRevision(i,e){ze(this,this.state.onStartTemporaryRevision,i,e)}stopTemporaryRevision(){ze(this,this.state.onStopRevision)}commitRevision(i,e){const t=this[Be],r=this[it],n=r.find(s=>s.title===i);for(let s=r.indexOf(n)-1;s>=0;s--)if(r[s].committed===!1&&r[s].type!==Mr.TEMPORARY&&!r[s].conflictResolutionFor)throw new Yo(`Cannot commit revision because it is preceded by an uncommitted rev id ${r[s].title}`,r);if(e){if(t.includes(e))throw new Yo(`Proposed revision id (${e}) already exists`);n.title=t[t.indexOf(n.title)]=e,r.forEach(s=>{s.type===Mr.TEMPORARY&&s.conflictResolutionFor===i&&(s.conflictResolutionFor=e)})}n.committed=!0}cleanUpRevisions(i=this.revisionQueueCommittedMinLength){const e=this[Be],t=this[it],r=[];for(let n=0;n<t.length;n++){const s=t[n];if(s.committed)r.push(s);else break}r.splice(Math.max(0,r.length-1-i),Math.min(r.length,i)),t.splice(0,r.length),e.splice(1,r.length)}markCurrentTransactionContentUserInput(){(this.isRecording||this.isRecordingRevision||this.isRecordingTemporaryRevision)&&this.transaction.markCurrentTransactionContentUserInput()}markCurrentTransactionContentCalculated(){(this.isRecording||this.isRecordingRevision||this.isRecordingTemporaryRevision)&&this.transaction.markCurrentTransactionContentCalculated()}};y(Ko,"$name","StateTrackingManager"),Ko._$name="StateTrackingManager";var IC=i=>{var e;return e=class extends(i||$){changeStm(t,r){var n;return(n=r==null?void 0:r.hasStore)!=null&&n.call(r,this)&&r.removeStore(this),t&&(t.isStateTrackingManager||(t=new Ko(t)),t.hasStore(this)||t.addStore(this)),t}add(t,r=!1,n={}){let s;const{stm:a}=this;return!this.tree&&(a!=null&&a.shouldRecordAction)?(s=super.add(t,r,n),s!=null&&s.length&&a.onStoreModelAdd(this,s,r)):s=super.add(t,r,n),s}insert(t,r,n=!1){let s;const{stm:a}=this;if(!this.tree&&(a!=null&&a.shouldRecordAction)){const l=(Array.isArray(r)?r:[r]).reduce((o,d)=>{const c=d instanceof me?this.indexOf(d):void 0;return c!==void 0&&c!==-1&&o.set(d,c),o},new Map);s=super.insert(t,r),s!=null&&s.length&&(t=this.indexOf(s[0]),a.onStoreModelInsert(this,t,s,l,n))}else s=super.insert(t,r,n);return s}remove(t,r=!1,n){let s;const{stm:a}=this;if(!this.tree&&(a!=null&&a.shouldRecordAction)){const o=(Array.isArray(t)?t:[t]).map(d=>this.getById(d)).filter(d=>!!d).reduce((d,c)=>{const u=this.indexOf(c);return u!==void 0&&u!==-1&&d.set(c,u),d},new Map);s=super.remove(t,r,n),s!=null&&s.length&&a.onStoreModelRemove(this,s,o,r)}else s=super.remove(t,r,n);return s}removeAll(t){const{stm:r}=this;let n;if(r!=null&&r.shouldRecordAction){const{tree:s,rootNode:a,allRecords:l}=this,o=l.length,d=s?a.children.slice():l.slice();n=super.removeAll(t),o&&this.count===0&&r.onStoreRemoveAll(this,d,t)}else n=super.removeAll(t);return n}beforeApplyChangeset(){const{stm:t,crudManager:r}=this;let n=!1,s=null;return!(r!=null&&r.applyingChangeset)&&(t!=null&&t.enabled)&&!t.isNavigatingRevisions&&(n=!0,t.isRecording&&(s=t.stash()),this.ignoreRemoteChangesInSTM?t.disable():t.startTransaction()),{shouldResume:n,transactionId:s}}applyChangeset(t,...r){const{shouldResume:n,transactionId:s}=this.beforeApplyChangeset(),a=super.applyChangeset(t,...r);return this.afterApplyChangeset(n,s),a}afterApplyChangeset(t,r){if(t){const{stm:n}=this;this.ignoreRemoteChangesInSTM?n.enable():n.stopTransaction(),n.applyStash(r)}}},y(e,"$name","StoreStm"),y(e,"configurable",{stm:null,ignoreRemoteChangesInSTM:!1}),e},Xo=class{static new(i){return new this(i)}constructor(i){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}),i&&i(this)}catch(i){return this.promise=this.promise.catch(i),this}finally(i){return this.promise=this.promise.finally(i),this}then(...i){return this.promise=this.promise.then(...i),this}};Xo._$name="Promissory";var ra=class extends ie.mixin(fe){static get pluginConfig(){return{override:["updateAutoLoad","performDataRequest"],assign:["load","isLoading","lazyGetAt"],after:["afterLoadData"],before:["setStoreData","destroy"]}}static get properties(){return{loadQueue:{}}}get isLoading(){return this.client._isLoading||Object.values(this.loadQueue).some(i=>T.isPromise(i))}get storage(){return this.client.storage}set totalCount(i){this._totalCount=i}get totalCount(){return this._totalCount}setEstimatedTotalCount(i){this.totalCount=i}afterConstruct(){const i=this,{client:e}=i;e.syncDataOnLoad&&(e.syncDataOnLoad=!1),i.storeListenersDetacher=e.ion({beforeAdd:"internalOnBeforeAdd",beforeRemove:"internalOnBeforeAdd",change:"internalOnChange",commit:"internalOnCommit",endApplyChangeset:"internalOnCommit",appliedCrudChangesToStore:"internalOnCommit",thisObj:i}),e.requestData||(e.requestData=i.requestData),e.autoLoad&&!e.readUrl&&this.requestAnimationFrame(this.doAutoLoad)}updateAutoLoad(i){i&&!this.client.readUrl&&this.doAutoLoad()}internalOnBeforeAdd(){if(this.isLoading)throw new Error("Removing or adding is not allowed when a lazy loaded Store is loading")}internalOnChange(){!this.$loadLock&&(this.client.added.count||this.client.removed.count)&&(this.$loadLock=new Xo)}internalOnCommit(){!this.client.changes&&this.$loadLock&&(this.$loadLock.resolve(),this.$loadLock=null)}performDataRequest(){return this.load()}afterLoadData(){this.totalCount&&(this.storage.values.length=this.totalCount)}setStoreData(i){!(i!=null&&i.length)&&this.client.records.some(Boolean)&&this.clear()}clear(){this.totalCount=null,this.loadQueue={}}async requestData({startIndex:i,count:e}){}lazyGetAt(i){return this.getAt(i)}async getAt(i){var e;const t=this,{loadQueue:r,totalCount:n}=t;if(i<0||n!=null&&i>n)return null;const s=t.getFromStorage(i);if(s)return s;if(await((e=t.$loadLock)==null?void 0:e.promise),!t.isDestroyed)return r[i]?await r[i]:await t.doLazyLoad(t.calculateRange(i)),t.getFromStorage(i)}getFromStorage(i){return this.storage.getAt(i)}calculateRange(i){const{totalCount:e,loadQueue:t,chunkSize:r}=this,n=Math.max(0,i-r),s=(e?Math.min(i+r,e):i+r)-1;let a=i,l=i;for(;a>n&&!t[a-1]&&!this.getFromStorage(a-1);)a-=1;for(;l<s&&!t[l+1]&&!this.getFromStorage(l+1);)l+=1;return{startIndex:a,count:l-a+1}}async doLazyLoad({isReload:i,...e}){this.triggerLazyLoadStart(arguments[0]),i&&this.clear();const t=this,{loadQueue:r,client:n}=t,{startIndex:s,count:a}=e,l=s+a-1,o=n.requestData(n.readUrl?e:n.buildRemoteParams(e));for(let h=s;h<=l;h++)r[h]=o;const d=await o;if(!d)return;const{[t.totalCountProperty]:c,[t.dataProperty]:u}=d;for(let h=s;h<=l;h++)r[h]=null;c!=null?t.totalCount=c:t.totalCount==null&&a>u.length&&t.setEstimatedTotalCount(s+u.length),t.addData(u,s,i),t.totalCount!=null&&(t.storage.values.length=t.totalCount),t.triggerLazyLoadEnd(arguments[0],u)}addData(i,e,t){var r;const{client:n,storage:s}=this;if(!(i!=null&&i.length))return;if((!n.count||t)&&!e){n.data=i;return}for(let o=i.length-1;o>=0;o--){const d=i[o],c=n.idRegister[d.id];c&&(c.setByDataSource(d,!0),c.internalClearChanges(!1,!0,d),i.splice(o,1))}if(!i.length)return;const{values:a}=s,l=i.map(o=>n.processRecord(n.createRecord(o),!0));a.length<e&&(a.length=e),e==null&&(e=a.length),a.splice(e,l.length,...l),n.joinRecordsToStore(l),(r=this.processAddedRecords)==null||r.call(this,l),n.updateDependentStores("add",l);for(const o of l)n.idMap[o.id]={index:e,visibleIndex:e,record:o},e+=1,s.addToIndices(o);n.trigger("change",{action:"lazyload",records:l})}checkDuplicates(i){const{storage:e}=this;for(const t of i){const r=e.indexOf(t.id);r>=0&&e.values.splice(r,1)}}triggerLazyLoadStart(i){const e=this;e.isLoading||(e.isConfiguring?e.delay(()=>e.trigger("lazyLoadStarted",{...i}),0):e.client.trigger("lazyLoadStarted",{...i})),e.client.trigger("beforeLazyLoad",{...i})}triggerLazyLoadEnd(i,e){this.isLoading||this.client.trigger("lazyLoadEnded"),this.client.trigger("afterLazyLoad",{...i,data:e})}load(i){return this._loadedOnce=!0,this.doLazyLoad({isReload:Object.keys(this.loadQueue).length,startIndex:0,count:this.chunkSize})}doAutoLoad(){this._loadedOnce||this.load()}destroy(){var i;(i=this.storeListenersDetacher)==null||i.call(this),this.clear(),super.destroy()}};y(ra,"$name","StoreLazyLoadPlugin"),y(ra,"configurable",{totalCountProperty:"total",dataProperty:"data",chunkSize:100}),ra._$name="StoreLazyLoadPlugin";var AC=i=>{var e,t;return(t=(e=i.children)==null?void 0:e.reduce((r,n)=>{var s;return r+((s=n.remoteChildCount)!=null?s:0)+1},0))!=null?t:0},Nf=i=>AC(i)>=i.remoteChildCount,UT=i=>{var e;return e=class extends i{static get pluginConfig(){var t,r;const n={};for(const a in super.pluginConfig)n[a]=[...super.pluginConfig[a]];n.override=(t=n.override)!=null?t:[],n.override.push("loadChildren","getAt");const s=(r=n.assign)==null?void 0:r.indexOf("lazyGetAt");return s>=0&&n.assign.splice(s,1),n}constructor(){super(...arguments),this.totalCount=0}load(){return this._loadedOnce=!0,this.doLazyLoad({parent:this.client.rootNode,isReload:Object.keys(this.loadQueue).length>0,startIndex:0})}changeRemoteChildCount(t,r,n){var s;if(t!=null&&t.length){const a=t.map(l=>{var o,d,c;return(c=l.parent)!=null?c:this.client.getById((d=l.parentId)!=null?d:(o=l.originalData)==null?void 0:o.parentId)});for(;a.length;){const l=a.shift();l&&(l.isRoot||a.push(l.parent),l.remoteChildCount=(s=l.remoteChildCount?l.remoteChildCount+r:l.children.length)!=null?s:0,n==null||n.add(l))}}}internalOnCommit({changes:t}){super.internalOnCommit();const r=new Set;this.changeRemoteChildCount(t.added,1,r),this.changeRemoteChildCount(t.removed,-1,r),r.forEach(n=>{this.loadQueue[n.id]=Nf(n)})}loadChildren(t){return this.doLazyLoad({parent:t,startIndex:0})}getAt(t){var r;const n=this,{loadQueue:s,client:a}=n,l=a.records[t];if(l){const{parent:o}=l;l.expanded&&l.remoteChildCount>0&&!((r=l.children)!=null&&r.length)&&!s[l.id]&&n.doLazyLoad({parent:l,startIndex:0}),l===o.lastChild&&!s[o.id]&&n.doLazyLoad({startIndex:l.parentIndex+1,parent:o})}return l}async doLazyLoad({parent:t,isReload:r,...n}){var s;r&&this.clear();const a=this,{client:l}=a,{id:o}=t;t.instanceMeta(l).isLoadingChildren=!0,a.triggerLazyLoadStart(arguments[0]);const d=a.loadQueue[o]=l.requestData({...l.readUrl?n:l.buildRemoteParams(n),parentId:t.isRoot?"root":o,count:a.chunkSize}),{[a.totalCountProperty]:c,[a.dataProperty]:u}=await d;a.loadQueue[o]===d&&(t.isRoot&&c>=0&&(t.remoteChildCount=c),a.addData(u,t,r),a.totalCount=l.count,a.loadQueue[o]=Nf(t),a.isLoading||(s=l.trigger)==null||s.call(l,"refresh",{action:"lazyload"}),a.triggerLazyLoadEnd(arguments[0],u),t.instanceMeta(l).isLoadingChildren=!1)}addData(t,r,n){const{client:s,loadQueue:a}=this;if(n&&s.clear(!0),s.modelClass.fieldMap.remoteChildCount||s.modelClass.addField("remoteChildCount"),!t.length){const l=AC(r),o=r.remoteChildCount-l;o!==0&&(r.remoteChildCount=l,this.changeRemoteChildCount([r],o))}Ui.preWalk({children:t},({children:l})=>l!=null&&l.length?l:null,l=>{const{id:o,children:d}=l;o&&l.remoteChildCount>0&&(l.expanded===!1&&!(d!=null&&d.length)?l.children=!0:d!=null&&d.length&&!a[o]&&Nf(l)?a[o]=!0:d||(l.children=[]))}),r.appendChild(t,!0),s.added.clear()}},y(e,"$name","TreeStoreLazyLoadPlugin"),y(e,"configurable",{chunkSize:50}),e},GT={splice:1,clear:1},YT={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},Bf=(i,e)=>(e=e||!1,typeof e=="boolean"&&(e={includeFilteredOutRecords:e,includeCollapsedGroupRecords:!1}),e||YT),Lu=Symbol("useRawDataUnset"),qT={enabled:!0,disableDuplicateIdCheck:!0,disableDefaultValue:!1,disableTypeConversion:!1},KT={enabled:!0,disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},zf=class pr extends $.mixin(fe,Oo,Fe,pf,Po,Pb,Lb,Ab,Bb,zb,Ub,Gb,$b,Yb,qb,Kb,IC,Xb,Vb,Nb){constructor(...e){if(super(...e),y(this,"crudManager"),this.objectify)return this.initProxy()}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map,addingClean:!1}}static get defaultConfig(){return{fields:null,data:null,tree:null,callOnFunctions:!0,storage:null,allowNoId:!0,preventSubClassingModel:null,storeClass:null}}static get identifiable(){return{registerGeneratedId:!1}}updateAutoLoad(e){e&&!this.readUrl&&!this.lazyLoad&&this.requestAnimationFrame(this.performDataRequest)}construct(e={}){const t=this;Object.assign(t,{added:new Su,removed:new Su,modified:new Su,idRegister:{},internalIdRegister:{},oldIdMap:{}}),super.construct(e),t.initRelations()}static from(e,t={},r=null){return e&&!e.isStore&&(typeof e=="string"?e=pr.getStore(e):(Array.isArray(e)?(r&&(e=e.map(n=>n.isModel?n:r(n))),e=T.assign({},t,{data:e})):e=T.assign({},t,e),e=new pr(e))),e}equals(e){return e.isStore&&e.$master===this.$master}doDestroy(){var e,t,r,n;const s=this,a=s.registeredRecords;(t=(e=s.stm)==null?void 0:e.removeStore)==null||t.call(e,s);for(let l=a.length-1,o;l>=0;l--)o=a[l],o!=null&&o.isDestroyed||o.unjoinStore(s);(r=s._storage)==null||r.destroy(),s.isChained?s.masterStore.isDestroying||B.remove(s.masterStore.chainedStores,s):(n=s.rootNode)==null||n.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){if(this.resumeEvents()){const{values:e}=this.storage;this.trigger("refresh",{action:"batch",data:e,records:e})}}set storage(e){const t=this;e!=null&&e.isCollection?t._storage=e:t._storage=new Bt(e),t._storage.autoFilter=t.reapplyFilterOnAdd;for(const r of t._storage)r.joinStore(t);t._storage.ion({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const t=this;if(((e=t._allRecords)==null?void 0:e.generation)!==t.storage.generation){if(t.isTree){const r=t.collectDescendants(t.rootNode,void 0,void 0,{unfiltered:!0}).all;t.rootVisible&&r.unshift(t.rootNode),t._allRecords=r}else t._allRecords=t.isGrouped?t.collectGroupRecords(!0,!0):t.storage.allValues;t._allRecords.generation=t.storage.generation}return t._allRecords}getAllDataRecords(e){const t=this;return t.tree?e?t.allRecords:t.rootNode.allChildren:t.isGrouped?t.collectGroupRecords(e,!1):(e?t.storage.allValues:t.storage.values).filter(r=>r)}onIsCreatingToggle(e,t){const r=this,n=e.isPersistable&&!t;r.added[n?"add":"remove"](e),n&&(r.trigger("addConfirmed",{record:e}),r.autoCommit&&r.doAutoCommit())}joinRecordsToStore(e){const{totalCount:t}=this;for(let r=0;r<e.length;r++){const n=e[r];n.setData("parentIndex",t+r-e.length),n.joinStore(this)}}onDataChange({source:e,action:t,added:r,removed:n,replaced:s,oldCount:a,items:l,from:o,to:d}){const c=this,u=GT[t],h=u&&(r==null?void 0:r.length),g=u&&(n==null?void 0:n.length),{generation:f}=e,m=c.isFiltered&&!c.remoteFilter;let p,v;if(c._idMap=null,h&&c.joinRecordsToStore(r),s==null||s.forEach(([b,w])=>{b.unjoinStore(c,!0),w.joinStore(c)}),super.onDataChange(...arguments),h&&e.generation!==f&&!m&&c.trigger("refresh",arguments[0]),!c.isTree){if(h){for(const b of r)c.removed.includes(b)?c.removed.remove(b):!c.addingClean&&!b.isLinked&&c.added.add(b);p=!c.remoteFilter&&c.isFiltered&&c.reapplyFilterOnAdd,p&&c.filter({silent:!0}),v=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,v&&c.sort(null,null,!1,!0)}if(g){for(const b of n)b.cancelBatch(),b.unjoinStore(c),c.added.includes(b)?(c.added.remove(b),b.isBeingMaterialized&&c.removed.add(b)):!b._undoingInsertion&&!b.isCreating&&!b.isLinked&&c.removed.add(b);c.modified.remove(n),p=m,p&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(h){c.updateDependentStores("add",r);const b=r.reduce((S,x)=>{const{previousIndex:R}=x.meta;return R>-1&&R<S&&(S=R),S},r[0].meta.previousIndex),w=e.indexOf(r[0],!e.autoFilter),D={records:r,index:w};b>-1&&(D.oldIndex=b),c.trigger("add",D),c.trigger("change",Object.assign({action:"add"},D)),p&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:a,records:c.storage.allValues}),v&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}n.length&&(c.updateDependentStores("remove",n),c.trigger("remove",{records:n}),c.trigger("change",{action:"remove",records:n})),s.length&&(c.updateDependentStores("replace",s),c.trigger("replace",{records:s,all:c.records.length===s.length}),c.trigger("change",{action:"replace",replaced:s,all:c.records.length===s.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const b=Math.min(o,d),w=Math.min(c.storage.allValues.length-1,Math.max(o,d));for(let D=c.storage.allValues,S=b;S<=w;S++)D[S].setData("parentIndex",S);c.trigger("move",{records:l,from:o,to:d}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:t,record:l[0],records:l,from:o,to:d});break}}}onDataReplaced(e,t){var r,n;const s=this,{storage:a}=s,l=a.allValues,o=s.sorters.length>0;for(let c=0;c<l.length;c++)(r=l[c])==null||r.joinStore(s);if(!s.remoteFilter&&s.isFiltered&&s.filter({silent:!0}),s.remoteSort?s.isGrouped&&a.replaceValues({...s.prepareGroupRecords(),silent:!0}):(s.isGrouped&&s.group(null,null,!1,!o,!0),o&&s.sort(null,null,!1,!0)),!s.useRawData.disableDuplicateIdCheck){const{idMap:c}=s;if(Object.keys(c).length<a.values.length){const u=[];throw a.values.forEach(h=>c[h.id]?delete c[h.id]:u.push(h)),new Error(`Id collision on ${u.map(h=>h.id)}`)}}const d={action:e,data:t,records:a.values};s.updateDependentStores(e,d.records),(n=s.afterLoadData)==null||n.call(s),s.isRemoteDataLoading||s.trigger("refresh",d),s.trigger("change",d)}onModelChange(e,t,r,n,s){var a;const l=this,o={record:e,records:[e],changes:r,batch:e.batching!=null,fromRelationUpdate:s};if(l.storage.onItemMutation(e,r),"id"in r){const{oldValue:c,value:u}=t.id;l.updateDependentRecordIds(c,u),l.onRecordIdChange({record:e,oldValue:c,value:u})}else e.meta._ignoreRelatedIdUpdate||l.updateDependentStores("update",[e],n);const d=(e.ignoreBag||e.isLinked?!1:l.updateModifiedBagForRecord(e))&&!((a=e.meta)!=null&&a.pendingFormulae);if(l.onUpdateRecord(e,r),!n){if("id"in r){const{oldValue:c,value:u}=t.id;l.trigger("idChange",{store:l,record:e,oldValue:c,value:u})}l.trigger("update",o),l.trigger("change",Object.assign({action:"update"},o))}l.autoCommit&&d&&l.doAutoCommit()}updateModifiedBagForRecord(e){var t;const r=this,{modified:n,added:s}=r;return e.isModified&&!e.isRoot&&r.idRegister[e.id]?(!n.includes(e)&&!s.includes(e)&&(e.isPhantom?s.add(e):n.add(e)),e.isBeingMaterialized&&(r.modifiedMaterialized=(t=r.modifiedMaterialized)!=null?t:new Set,r.modifiedMaterialized.add(e)),!0):(n.remove(e),!1)}get idMap(){const e=this,t=!e._idMap,r=e._idMap||(e._idMap={});if(t){const n=e.storage.values;for(let s,a=0,l=0;a<n.length;a++)s=n[a],s&&(r[s.id]={index:a,visibleIndex:l,record:s}),s!=null&&s.isSpecialRow||l++;if(e.isFiltered)for(let s=0,a=e.storage._values.length;s<a;s++){const l=e.storage._values[s];l&&(l.id in r?r[l.id].unfilteredIndex=s:r[l.id]={index:-1,unfilteredIndex:s,record:l})}}return r}changeModelClass(e){const{fields:t}=this;this.originalModelClass=e;let r=e;if(t!=null&&t.length){class n extends e{static get fields(){return t}}r=n}else if(!this.preventSubClassingModel){class n extends e{}r=n}return r.initClass(),r}get $lazyLoadPluginClass(){return ra}changeLazyLoad(e){const t=this;let r=t.$lazyLoadPluginClass;t.isTree&&!r.isOfTypeName("DateStoreLazyLoadPlugin")&&(t.treeLazyLoadClass||(t.treeLazyLoadClass=class extends UT(r){}),r=t.treeLazyLoadClass);let n=t.getPlugin(r);if(e){const s=T.isObject(e);return n?s&&T.assign(n,e):n=t.addPlugin(r,s?e:null),n}else return n==null||n.destroy(),!1}changeId(e,t){return super.changeId(e!==!0&&e,t)}updateId(e,t){const r=pr.getById(e);r&&pr.unregisterInstance(r),super.updateId(e,t)}generateAutoId(){return pr.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}get autoTree(){return this.tree!==!1&&this._autoTree}buildRootNode(){return{}}static getStore(e,t){if(e instanceof pr)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let r;const n=e.map(s=>(s instanceof me?r=s.constructor:typeof s=="string"&&(s={text:s}),s));if(!r){class s extends me{}r=s}e={autoCreated:!0,data:n,modelClass:r,allowNoId:!0},t||(t=pr)}if(t)return new t(e)}static get stores(){return pr.registeredInstances}get rootNode(){return!this.isChainedTree&&this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const r=this,n=r._rootNode;e!==n&&(n&&(r.clear(!0),r.removed.clear()),e instanceof me?(e.instanceMeta(r).collapsed=!1,r._rootNode=e):r._rootNode=e=new r.modelClass({expanded:!0,[r.modelClass.idField]:`${r.id}-rootNode`,...e},r,{isRoot:!0},!0),r._tree=!0,e.isRoot=!0,e.joinStore(r),((t=e.children)!=null&&t.length||r.rootVisible)&&(e.isLoading=!0,r.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),r.trigger("rootChange",{oldRoot:n,rootNode:e}))}set data(e){this.setStoreData(e)}get data(){return this.getAllDataRecords(!0).map(e=>e.data)}setStoreData(e){const t=this,{idField:r,childrenField:n}=t.modelClass;e&&!Array.isArray(e)&&(e=T.transformNamedObjectToArray(e,r));const s=Ui.walkWhile(e!=null?e:[],a=>a[n],Object.isExtensible);if(e!=null&&e.length&&!s&&(t.transformFlatData||t.useRawData.enabled)&&(t.transformFlatData&&(t.useRawData=t.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1}),e=T.clone(e)),t.getConfig("plugins"),t.processConfiguredListeners(),t.isChained&&!t.isChainedTree||t.autoTree&&(e!=null&&e.some(a=>a[n]))&&(t.tree=!0),e&&(t.remoteSort||t.remoteFilter))for(let a=0;a<e.length;a++)e[a]._remoteSortIndex=a;!t.syncDataOnLoad||!t._data?(t._data=e,t.tree?t.loadTreeData(e):t.loadData(e),t.added.clear(),t.removed.clear(),t.modified.clear()):t.syncDataset(e)}loadTreeData(e){const t=this,r=t.rootNode,n=new Map;if(t.transformFlatData&&(e=t.treeifyFlatData(e)),r.isLoading=!0,t.records.length&&t.keepExpandedOnLoad&&t.traverse(s=>{s.isLeaf||n.set(s.id,s.instanceMeta(t).collapsed)}),e.sort((s,a)=>s.parentIndex-a.parentIndex),t.clear(!0),t.suspendEvents(!0),r.appendChild(e),n.forEach((s,a)=>{const l=t.getById(a);l&&t.toggleCollapse(l,s)}),t.resumeEvents(),t.updateDependentStores("dataset",[r]),r.isLoading=!1,e.length===0){const s={action:"dataset",data:[],records:[]};t.trigger("refresh",s),t.trigger("change",s)}else t.isFiltered&&t.filter()}loadData(e,t="dataset"){var r;const n=this,{storage:s,allowNoId:a}=n,l=n.modelClass.fieldMap.id.dataSource,o=n.find(c=>c.isCreating);o&&s.values.splice(n.records.indexOf(o),1);let d=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){const c=!(e[0]instanceof me),u=e.length,h=new Array(u);c&&n.modelClass.exposeProperties(e[0]);for(let g=0;g<u;g++){let f=e[g];if(c){const m=f[l];if(!a&&m==null)throw new Error(`Id required but not found on row ${g}`);d&&((r=m==null?void 0:m.startsWith)!=null&&r.call(m,"_generated"))&&(console.warn(`Generated id found in data: ${m}. Generated ids are temporary and should be replaced with real ids by the backend`),d=!1),f=n.createRecord(f,!0)}n.isFillingFromMaster||(f=n.processRecord(f,!0),f.setData("parentIndex",g)),h[g]=f}n.clear(!0),s.replaceValues({values:h,isNewDataset:!0,silent:!0}),o&&!s.values.includes(o)&&s.values.push(o),n._data=e,n.onDataReplaced(t,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}getRange(e,t,r=!0){return(r?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1,r=!1){return new this._modelClass(e,this,null,t,!1,r)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:r}){const n=this,s=n._idMap,{idRegister:a,oldIdMap:l}=n;if(n.storage._indicesInvalid=!0,l[t]=e,s&&!s[r]){const o=s[t];delete s[t],s[r]=o}n.added.changeId(t,r),n.removed.changeId(t,r),n.modified.changeId(t,r),delete a[t],a[r]=e,e.index=n.storage.indexOf(e)}onUpdateRecord(e,t){var r,n;const s=this,{internalId:a}=t,{internalIdRegister:l,reapplyFilterOnUpdate:o,reapplySortersOnUpdate:d}=s;a&&(this.storage._indicesInvalid=!0,delete l[a.oldValue],l[a.value]=e),(o===!0||(r=o.fields)!=null&&r.some(c=>c in t))&&s.isFiltered&&(s.filterBatching||s.filter()),(d===!0||(n=d.fields)!=null&&n.some(c=>c in t))&&s.isSorted&&(s._reapplySortersSuspended?s._shouldReapplySorters=!0:s.sort())}get useRawData(){var e;return this._useRawData===Lu?this.readUrl||(e=this.crudManager)!=null&&e.loadUrl?KT:{enabled:!1}:this._useRawData}changeUseRawData(e){return e===Lu?Lu:e===!0?qT:e?Object.assign(e,{enabled:!0}):{enabled:!1}}async performDataRequest(e,t,r){var n,s;const a=this,l=a.buildRemoteParams(t);let o,d;if(!e&&(await a.trigger("beforeRequest",{action:"read",params:l})===!1||await((n=a.trigger)==null?void 0:n.call(a,"requestData",l))===!1))return!1;if(!a.isDestroyed){if(a.requestData){if({data:o,total:d}=await a.requestData(l),a.isDestroyed)return;r==null||r(),a.data=o,d!=null&&(a.remoteTotal=d)}else r==null||r();await((s=a.trigger)==null?void 0:s.call(a,"afterRequest",{response:{data:o,total:d},params:l,action:"read"}))}}getCount(e=!0){var t,r,n;const s=this,{storage:a,groupRecords:l,isFiltered:o,isGrouped:d,isTree:c,rootNode:u}=s;if(typeof e=="boolean")return re.deprecate("core","7.0.0","getCount(true/false) deprecated in favor of getCount(options)"),e?s.count:a.totalCount-((l==null?void 0:l.count)||0);if(e.all)return this.allRecords.length;"visibleData"in e||(e.visibleData=!0);let h=0;const{visibleData:g,headersFooters:f,filteredOut:m,collapsed:p}=e,v=o?(t=l==null?void 0:l.values.reduce((w,D)=>w+(s.includes(D)?1:0),0))!=null?t:0:(r=l==null?void 0:l.count)!=null?r:0,b=a.count-v;if(g&&(h+=b),f&&d&&(o&&m?h+=(n=l.count)!=null?n:0:h+=v),m&&o&&(c?h+=u.getDescendantCount(!1,s,!0)-u.getDescendantCount(!1,s,!1):h+=a.allValues.length-a.values.length),p)if(d){let w=0;for(const D of s.collapsedGroups)w+=l.get(D).groupChildren.length;h+=w}else c&&(h+=u.descendantCount-b);return h}get count(){return this.storage.count}get originalCount(){var e;return re.deprecate("core","7.0.0","originalCount was deprecated in favor of getCount()"),this.storage.totalCount-(((e=this.groupRecords)==null?void 0:e.count)||0)}get allCount(){return re.deprecate("core","7.0.0","allCount was deprecated in favor of totalCount"),this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get totalCount(){return this.isPaged&&"remoteTotal"in this?this.remoteTotal:this.getCount({all:!0})}set totalCount(e){this.isPaged&&(this.remoteTotal=e)}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this;if(!t.useRawData.disableDuplicateIdCheck){const r=t.isTree&&t.idRegister[e.id];if(r&&r!==e)throw new Error(`Id collision on ${e.id}`)}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){const t=this;let r;e!=null&&e.isModel&&(r=e,e=r.id);const n=t.idRegister[e];if(r){if(r!=null&&r.hasLinks&&!n){const{allValues:s}=t.storage;return r.$links.find(a=>s.includes(a))}return r}return n}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?this.idRegister[me.asId(e)]!=null:this.indexOf(e)>-1}indexOf(e,t=!1,r=!1){var n;if(e!=null&&e.isModel&&!((n=e.stores)!=null&&n.includes(this.$store||this))){const l=e.$links.find(o=>this.storage.allValues.includes(o));return l?this.indexOf(l,t):-1}if(this.isTree)return(r?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const s=me.asId(e);if(s==null)return-1;const a=this.idMap[s];return a?a[t?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,t=!1,r=!1){const n=this,s=[],a={};let l;return n.forEach(o=>{if(!o.isSpecialRow&&!o.isRoot){l=o.getValue(e);const d=l instanceof Date?l.getTime():l;a[d]===void 0?(s.push(l),a[d]={value:l,count:1}):a[d].count++}},n,{includeCollapsedGroupRecords:!0,includeFilteredOutRecords:t}),r?Object.values(a):s}getValueCount(e,t){let r=0;return this.forEach(n=>{T.isEqual(n.getValue(e),t)&&r++}),r}set json(e){typeof e=="string"&&(e=O.safeJsonParse(e)),this.data=e}get json(){return O.safeJsonStringify(this)}get formattedJSON(){return O.safeJsonStringify(this,null,4)}toJSON(){const e=this,{persistable:t,dataSource:r}=e.modelClass.getFieldDefinition("expanded");return(e.isTree?e.rootNode.unfilteredChildren||e.rootNode.children||[]:e.allRecords).map(n=>{const s=n.toJSON();return e.tree&&n.isParent&&t&&(s[r]=n.isExpanded(e)),s})}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){var t;const r=[];return this.tree?(t=this.rootNode.children)==null||t.forEach(n=>r.push(n.getCurrentConfig(e))):this.forEach(n=>r.push(n.getCurrentConfig(e))),r}getCurrentConfig(e){var t;const r=super.getCurrentConfig(e),{state:n}=this;return r&&(r.data&&(r.data=this.getInlineData(e)),delete r.project,delete r.stm,delete r.asyncEvents,((t=r.modelClass)==null?void 0:t.$meta.hierarchy[r.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete r.modelClass,this.tree||delete r.tree,n&&Object.assign(r,n)),r}forEach(e,t=this,r){const n=this,s=(a,l)=>{if(a&&!a.isRoot&&!a.isSpecialRow)return e.call(t,a,l)};if(r=Bf(n,r),n.isTree)n.isChained&&(r={...r,sorterFn:n.sorterFn}),n.rootNode.traverseWhile(s,!1,r);else{const a=r.includeFilteredOutRecords?n.storage.allValues:n.storage.values;if(n.isGrouped&&r.includeCollapsedGroupRecords)for(let l=0;l<a.length;l++){const o=a[l],d=r.includeFilteredOutRecords?o.unfilteredGroupChildren:o.groupChildren;if(d&&o.meta.collapsed===!0)for(let c=0;c<d.length;c++){const u=d[c];if(s(u,c)===!1)return}else if(s(o,l)===!1)return}else for(let l=0;l<a.length;l++)if(s(a[l],l)===!1)return}}map(e,t=this){return this.storage.values.map(e,t)}flatMap(e,t=this){return this.storage.values.flatMap(e,t)}every(e,t=this,r){return this.storage[r?"allValues":"values"].every(e,t)}reduce(e,t=[],r=this){return r!==this&&(e=e.bind(r)),this.storage.values.reduce(e,t,r)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,r=t===this.rootNode,n){const s=this;if(n=Bf(s,n),s.isTree){if(typeof t=="boolean"&&(r=t,t=s.rootNode),s.isChained){const a=e;e=l=>{s.chainedFilterFn(l)&&a(l)}}t.traverse(e,r,n)}else s.forEach(a=>a.traverse(e,!1,n),s,n)}traverseWhile(e,t=this.rootNode,r=t===this.rootNode,n){const s=this;if(n=Bf(s,n),s.isTree){if(typeof t=="boolean"&&(r=t,t=s.rootNode),s.isChained){const a=e;e=l=>{s.chainedFilterFn(l)&&a(l)}}t.traverseWhile(e,r,n)}else for(const a of s.storage)if(a.traverse(e,!1,n)===!1)break}getNext(e,t=!1,r=!1){const n=this,s=n.storage.values;let a=n.indexOf(e);if(a>=s.length-1)if(t)a=-1;else return null;const l=s[a+1];return r&&l&&(l.isSpecialRow||typeof r=="function"&&r(l))?n.getNext(s[a+1],t,r):l}getPrev(e,t=!1,r=!1){const n=this,s=n.storage.values;let a=n.indexOf(e);if(a===0)if(t)a=s.length;else return null;const l=s[a-1];return a>0&&r&&l&&(l.isSpecialRow||typeof r=="function"&&r(l))?n.getPrev(s[a-1],t,r):l}getAdjacent(e,t=!0,r=!1,n=!1){return t?this.getNext(e,r,n):this.getPrev(e,r,n)}getNextLeaf(e,t=!1){const r=this,n=r.leaves,s=r.getById(e);let a=n.indexOf(s);if(a>=n.length-1)if(t)a=-1;else return null;return n[a+1]}getPrevLeaf(e,t=!1){const r=this,n=r.leaves,s=r.getById(e);let a=n.indexOf(s);if(a===0)if(t)a=n.length;else return null;return n[a-1]}getAdjacentLeaf(e,t=!0,r=!1){return t?this.getNextLeaf(e,r):this.getPrevLeaf(e,r)}};y(zf,"$name","Store"),y(zf,"configurable",{id:!0,modelClass:me,verifyNoGeneratedIds:!0,lazyLoad:null,autoLoad:null,useRawData:Lu,autoTree:!0});var pe=zf;pe.initClass(),pe._$name="Store";var Zo=class extends ra{static get pluginConfig(){const i={};for(const e in super.pluginConfig)i[e]=[...super.pluginConfig[e]];return i.assign.push("updateResponseTotalProperty","updateResponseDataProperty"),i}updateResponseTotalProperty(i){this.totalCountProperty=i}updateResponseDataProperty(i){this.dataProperty=i}async requestData(i){const{totalCountProperty:e,dataProperty:t}=this.lazyLoad,r=await this.internalLoad(i,"",void 0,!1);return{[e]:r.json[e],[t]:r.data}}async load(i){const{client:e}=this,t=e.params;i&&(e.params={...i,...t}),e.autoLoad&&e.isConstructing&&await new Promise(r=>this.requestAnimationFrame(r)),await super.load(),i&&(e.params=t)}};y(Zo,"$name","AjaxStoreLazyLoadPlugin"),Zo._$name="AjaxStoreLazyLoad";var XT=(i,e)=>(Array.isArray(e[1])?e[1].forEach(t=>i.push(encodeURIComponent(e[0])+"="+encodeURIComponent(t))):i.push(encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])),i),Wf=Promise.resolve(),Jo=i=>String(i).padStart(2,"0"),ZT=i=>`${i.getFullYear()}-${Jo(i.getMonth()+1)}-${Jo(i.getDate())}T${Jo(i.getHours())}:${Jo(i.getMinutes())}:${Jo(i.getSeconds())}.${i.getMilliseconds()}`,Dt=class extends pe{constructor(){super(...arguments),y(this,"modificationsTracking",0)}static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"},paramsInBody:re.checkVersion("core","6.0",">=")}}suspendModificationsTracking(){this.modificationsTracking++}resumeModificationsTracking(){this.modificationsTracking--}afterConstruct(i){super.afterConstruct(i),this.autoLoad&&this.readUrl&&this.load().catch(()=>{})}get $lazyLoadPluginClass(){return Zo}get isLoading(){return super.isLoading||this._isLoading?2:this.loadTriggerPromise?1:!1}get isCommitting(){var i;return!!((i=this.commitPromise)!=null?i:this.autoCommitTimeoutPromise)}updateFilterParamName(i){super.updateFilterParamName(i),this.remoteFilter=this.remoteFilter||this.restfulFilter}updateRestfulFilter(i,e){this.remoteFilter=i||!!this.filterParamName||this.remoteFilter&&!e}buildQueryString(i,...e){const t=i.includes("?"),r=Object.entries(Object.assign({},...e)).reduce(XT,[]).join("&");return r?(t?"&":"?")+r:""}async performRemoteSort(i){var e;const t=this;if(t.readUrl&&!t.isRemoteDataLoading){if(t.isRemoteDataLoading=!0,await((e=t.beforePerformSort)==null?void 0:e.call(t))===!1)return;const r=await t.load();return t.afterPerformSort(i),t.isRemoteDataLoading=!1,r}else super.performSort(i)}async performRemoteFilter(i){var e,t;const r=this;if(r.filterBatching>0){r.needsFiltering=!0;return}if(r.readUrl){(e=r.loadingPromise)==null||e.abort(),r.isRemoteDataLoading=!0;const n=r.count,{filters:s}=r;if(await((t=r.beforePerformFilter)==null?void 0:t.call(r,{filters:s,oldCount:n}))===!1)return;const a=await r.load(),l=i?null:{action:"filter",filters:s,oldCount:n,records:r.storage.values};return r.afterPerformFilter(l),r.trigger("refresh",l),r.isRemoteDataLoading=!1,a}else super.performRemoteFilter(i)}encodeFilterParams(i){const e=this.getFilterParams(i);return JSON.stringify(e,function(t,r){return t===""?r:this[t]instanceof Date?ZT(this[t]):r})}encodeSorterParams(i){return JSON.stringify(this.getSorterParams(i))}buildReadUrl(){const{readUrl:i}=this;return this.restfulFilter&&this.filters.count?(i.endsWith("/")?i:i+"/")+this.filters.first.value:i}internalLoad(i,e,t,r=0){i=T.assign({},this.params,i);const n=this,s={action:"read"+e,params:i,url:n.buildReadUrl()};if(n.buildRemoteParams(i,!0),n.trigger("beforeLoad"+e,s)===!1)throw!1;return n.loadArgs=[s,i,e,t],r===!1?new Promise((a,l)=>n.sendLoadRequest(a,l)):n.loadTriggerPromise||(n.loadTriggerPromise=new Promise((a,l)=>{n.setTimeout({delay:r,fn:"sendLoadRequest",args:[a,l],cancelOutstanding:!0})}))}async sendLoadRequest(i,e){var t,r,n;const s=this,[a,l,o,d]=s.loadArgs;if(s.loadTriggerPromise=null,a.url){s._isLoading=!0,s.trigger(`load${o}Start`,a),s.trigger("beforeRequest",a);const c={parseJson:!0};s.headers&&(c.headers=T.clone(s.headers)),s.useRestfulMethods&&(c.method=s.httpMethods.read,a.body&&(c.body=JSON.stringify(a.body)));try{const u=s.paramsInBody&&(((t=c.method)==null?void 0:t.toUpperCase())==="POST"||((r=c.method)==null?void 0:r.toUpperCase())==="PUT")&&c.body==null,h=a.url+(u?"":s.buildQueryString(a.url,l)),g=s.loadingPromise=kt.get(h,T.assign(c,s.fetchOptions,u?{body:JSON.stringify(l)}:null)),f=await g;if(s.isDestroyed)return;const m=s.transformLoadedData?s.transformLoadedData(f.parsedJson):f.parsedJson,p=Array.isArray(m),v=p||m&&T.getPath(m,s.responseSuccessProperty)!==!1,b=p?null:T.getPath(m,s.responseTotalProperty);if(s.loadingPromise=null,s._isLoading=!1,a.response=f,a.json=m,v){if(b!=null&&(s.remoteTotal=parseInt(b,10)),s.isPaged&&!s.lazyLoad)if(s.remoteTotal>=0)s.currentPage=s.pageStartParamName?l[s.pageStartParamName]/s.pageSize+1:l[s.defaultPageParamName];else throw new Error("A paged store must receive its responseTotalProperty in each data packet");a.data=p?m:T.getPath(m,s.responseDataProperty),s.suspendModificationsTracking(),await(d==null?void 0:d(a)),s.resumeModificationsTracking(),s.isPartOfProjectRaw&&(s.ignoreLoadPropagationChanges&&s.suspendModificationsTracking(),await((n=s.getProject())==null?void 0:n.commitAsync()),s.ignoreLoadPropagationChanges&&s.resumeModificationsTracking()),!s.isDestroyed&&s.trigger("load"+o,a),i(a)}else Object.assign(a,{exception:!0,exceptionType:"server",error:m==null?void 0:m.error}),!s.isDestroyed&&s.trigger("exception",a),e(a);!s.isDestroyed&&s.trigger("afterRequest",a)}catch(u){s._isLoading=!1,a.exception=!0,u instanceof Response?(a.exceptionType=u.ok?"server":"network",a.response=u,a.error=u.error):(a.exceptionType="server",a.error=u),!s.isDestroyed&&s.trigger("exception",a),e(a),!s.isDestroyed&&s.trigger("afterRequest",a)}}}async load(i){const e=this;return e.isPaged?e.loadPage(e.currentPage||1,i):e.internalLoad(i,"",t=>{e.data=t.data})}async loadChildren(i){return this.readUrl?this.internalLoad({[this.parentIdParamName]:i.id},"Children",e=>{e.parentRecord=i,i.children.length&&i.clearChildren(!0),i.data[i.constructor.childrenField]=e.data,i.processChildren(i.stores)},!1):this.immediatePromise}async loadPage(i,e={}){return this.readUrl?(e[this.defaultPageParamName]=i!=null?i:1,this.internalLoad(e,"Page",t=>{this.loadData(t.data,"pageLoad")})):super.loadPage(i)}async commit(){return this.clearTimeout("autoCommit"),this.autoCommitTimeoutPromise=null,this.queueCommit()}queueCommit(){const i=this;let e;return i.commitPromise?e=i.commitPromise.then(()=>i.performCommit()):(i._commitPromiseQueueLength=0,e=i.performCommit()),i._commitPromiseQueueLength+=1,i.commitPromise=e==null?void 0:e.finally(()=>{i._commitPromiseQueueLength-=1,i._commitPromiseQueueLength===0&&(i.commitPromise=null)})}performCommit(){const i=this,{changes:e}=i,t=[];if(!e)return i.modified.count&&(i.modified.forEach(r=>r.internalClearChanges(!0,!1)),i.modified.clear()),Wf;if(i.trigger("beforeCommit",{changes:e})!==!1){[...e.added,...e.modified,...e.removed].forEach(s=>s.meta.committing=!0),i.trigger("commitStart",{changes:e});const r={action:"commit",exception:!1,changes:e};let n=i.commitRemoved(r);return n&&t.push(n),n=i.commitAdded(r),n&&t.push(n),n=i.commitModified(r),n&&t.push(n),t.length?(n=t.length===1?t[0]:Promise.all(t),new Promise((s,a)=>{n.then(()=>{r.exception?(i.trigger("exception",r),a(r)):(i.trigger("commit",{changes:e}),s(r))}).catch(()=>{a(r)})})):(i.modified.forEach(s=>s.internalClearChanges(!0,!1)),i.modified.clear(),i.added.forEach(s=>s.internalClearChanges(!0,!1)),i.added.clear(),i.removed.clear(),i.trigger("commit",{changes:e}),Wf)}else return Wf}doAutoCommit(){const i=this;i.suspendCount<=0&&!i.hasTimeout("autoCommit")&&(i.autoCommitTimeoutPromise=new Promise(e=>{i.setTimeout({name:"autoCommit",fn:()=>{i.autoCommitTimeoutPromise=null,i.commit().then().catch(t=>{const{response:r}=t;if(!(r&&(r.ok&&r.parsedJson||[500,404].includes(r.status))))throw t}),e()},delay:i.autoCommitTimeout})}))}buildCommitUrl(i){return i+this.buildQueryString(i,this.params)}commitAdded(i){const e=this,t=[...e.added];return t.length&&e.createUrl?new Promise(r=>{const n=t.map(o=>o.persistableData),s={action:"create",params:e.params,url:e.buildCommitUrl(e.createUrl)};i.create=s,s.body={data:n},e.trigger("beforeRequest",s);let a=e.transformCreationData?e.transformCreationData(s.body):s.body;if(e.sendAsFormData){const o=new FormData;o.append("data",JSON.stringify(a.data)),a=o}const l={parseJson:!0};e.headers&&(l.headers=T.clone(e.headers)),e.useRestfulMethods&&(l.method=e.httpMethods.create),kt.post(s.url,a,T.assign(l,e.fetchOptions)).then(o=>{if(e.isDestroyed)return;const d=o.parsedJson,c=Array.isArray(d)||d&&d.success!==!1;if(i.response=o,s.json=d,s.response=o,c){const u=e.processReturnedData(d,t,n);e.added.remove(u),e.modified.add(u.filter(h=>h.meta.modified&&!T.isEmpty(h.meta.modified))),e.trigger("commitAdded"),e.trigger("refresh",s),r(i)}else t.forEach(u=>u.meta.committing=!1),i.exception=s.exception=!0,i.exceptionType=s.exceptionType="server",e.trigger("exception",s),r(i);e.trigger("afterRequest",s)}).catch(o=>{t.forEach(d=>d.meta.committing=!1),i.exception=s.exception=!0,o instanceof Response?(i.response=o,s.exceptionType=o.ok?"server":"network",s.response=o,s.error=o.error):(s.exceptionType="server",s.error=o),!e.isDestroyed&&e.trigger("exception",s),r(i),!e.isDestroyed&&e.trigger("afterRequest",s)})}):null}commitModified(i){const e=this,t=[...e.changes.modified],r=t.length&&e.updateUrl?new Promise(n=>{const s={action:"update",params:e.params,url:e.buildCommitUrl(e.updateUrl)},a=t.map(d=>e.writeAllFields?d.persistableData:d.modificationDataToWrite).filter(d=>!T.isEmpty(d));if(a.length===0){e.modified.clear(),t.forEach(d=>d.meta.committing=!1),n();return}i.update=s,s.body={data:a},e.trigger("beforeRequest",s);let l=e.transformModificationData?e.transformModificationData(s.body):s.body;if(e.sendAsFormData){const d=new FormData;d.append("data",JSON.stringify(l.data)),l=d}const o={parseJson:!0};e.headers&&(o.headers=T.clone(e.headers)),e.useRestfulMethods&&(o.method=e.httpMethods.update),kt.post(s.url,l,T.assign(o,e.fetchOptions)).then(d=>{if(e.isDestroyed)return;const c=d.parsedJson,u=Array.isArray(c)||c&&c.success!==!1;i.response=d,s.json=c,s.response=d,u?(e.processReturnedData(c,t,a,!0,!0),e.trigger("commitModified"),e.trigger("refresh",s),n(i)):(t.forEach(h=>h.meta.committing=!1),i.exception=s.exception=!0,s.exceptionType="server",e.trigger("exception",s),n(i)),e.trigger("afterRequest",s)}).catch(d=>{t.forEach(c=>c.meta.committing=!1),i.exception=s.exception=!0,d instanceof Response?(i.response=d,s.exceptionType=d.ok?"server":"network",s.response=d,s.error=d.error):(s.exceptionType="server",s.error=d),!e.isDestroyed&&e.trigger("exception",s),n(i),!e.isDestroyed&&e.trigger("afterRequest",s)})}):null;return!t.length&&e.modified.count&&e.modified.clear(),r}processReturnedData(i,e,t,r=!1){Array.isArray(i)||(i=T.getPath(i,this.responseDataProperty));const{idField:n}=e[0].constructor,s=!i||i.length===e.length,a=[];return e.forEach((l,o)=>{const d=r?i==null?void 0:i.find(c=>c[n]===l.id):i==null?void 0:i[o];if(s||d){const c=l.modificationDataToWrite,u=r?t.find(g=>g.id===l.id):t[o],h={};if(l.meta.committing=!1,d&&(l.syncId(d[n]),Object.assign(l.data,this.modelClass.processData(d,r,this,l))),c){for(const g in u)if(c[g]===u[g]){const f=l.getFieldDefinitionFromDataSource(g);f!=null&&f.persist&&(h[f.name]=1)}}l.internalClearChanges(!0,!0,h,!0),a.push(l)}}),a}commitRemoved(i){const e=this,{removed:t,includeChildrenInRemoveRequest:r}=e;return t.count&&e.deleteUrl?new Promise(n=>{var s,a;let l;if(r)l=t.values;else{l=[];for(const u of t.values){const h=(a=u.parentId)!=null?a:(s=u.meta.modified)==null?void 0:s.parentId;h!=null&&(h===e.rootNode.id||!t.includes(h))&&l.push(u)}}const o={action:"delete",params:e.params,url:e.buildCommitUrl(e.deleteUrl),body:{ids:l.map(u=>u.id)}};i.delete=o,e.trigger("beforeRequest",o);let d=e.transformRemovalData?e.transformRemovalData(o.body):o.body;if(e.sendAsFormData){const u=new FormData;u.append("id",JSON.stringify(d.ids)),d=u}const c={parseJson:!0};e.headers&&(c.headers=T.clone(e.headers)),e.useRestfulMethods&&(c.method=e.httpMethods.delete),kt.post(o.url,d,T.assign(c,e.fetchOptions)).then(u=>{const h=u.parsedJson,g=Array.isArray(h),f=g||h&&h.success!==!1;i.response=u,o.json=h,o.response=u,f?(t.forEach(m=>m.meta.committing=!1),t.clear(),e.trigger("commitRemoved"),e.trigger("refresh",o),n(i)):(t.forEach(m=>m.meta.committing=!1),i.exception=o.exception=!0,o.exceptionType="server",e.trigger("exception",o),n(i)),e.trigger("afterRequest",o)}).catch(u=>{t.forEach(h=>h.meta.committing=!1),i.exception=o.exception=!0,u instanceof Response?(i.response=u,o.exceptionType=u.ok?"server":"network",o.response=u,o.error=u.error):(o.exceptionType="server",o.error=u),!e.isDestroyed&&e.trigger("exception",o),n(i),!e.isDestroyed&&e.trigger("afterRequest",o)})}):null}};y(Dt,"$name","AjaxStore"),y(Dt,"configurable",{responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",params:null,autoCommitTimeout:10,includeChildrenInRemoveRequest:!0,transformLoadedData:null,transformCreationData:null,transformModificationData:null,transformRemovalData:null,ignoreLoadPropagationChanges:!1,restfulFilter:!1}),Dt._$name="AjaxStore";var Pu=class extends me{};y(Pu,"$name","ComboModel"),y(Pu,"fields",[{name:"value"},{name:"text"}]),Pu._$name="ComboModel";var Ou={},Oe=class{static get(i,e=Ou){const t=i._domData||(i._domData={});return e===Ou?t:t[e]}static remove(i,e){const{_domData:t}=i,r=t==null?void 0:t[e];return t==null||delete t[e],r}static set(i,e,t=Ou){return t===Ou?i._domData=t=e:(i._domData||(i._domData={}))[e]=t,t}static assign(i,e){Object.assign(i._domData||(i._domData={}),e)}};Oe._$name="DomDataStore";var xn=class{static insertRule(i,e=document.head){const t=this.getStyleSheet(e),{cssRules:r}=t,n=r.length,s=typeof i=="string";if((s?[i]:i).forEach((a,l)=>t.insertRule(a,l)),r.length>n)return s?r[0]:Array.from(r).slice(0,i.length)}static findRule(i){let e;const t=typeof i=="function";return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),r=>{if(e=Array.prototype.find.call(r.sheet.rules||r.sheet.cssRules,n=>t?i(n):n.selectorText===i),e)return!0}),e}static getStyleSheet(i=document.head){return i.$bryntumStylesheet||(i.$bryntumStylesheet=E.createElement({tag:"style",type:"text/css",parent:i}).sheet),i.$bryntumStylesheet}static getCSSVersion(){return getComputedStyle(document.documentElement).getPropertyValue("--bryntum-version").replace(/[" ]/gm,"")}};y(xn,"$name","CSSHelper"),_e.register(xn),xn._$name="CSSHelper";var JT=i=>{var e;return e=class extends(i||$){initContainerDrag(){const t=this;if(t.mode||(t.mode="container"),t.mode==="container"&&!t.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(t){const r=this;if(!r.ignoreSelector||!t.target.closest(r.ignoreSelector)){const n=E.getAncestor(t.target,r.containers,r.outerElement);if(n){const s=n.getBoundingClientRect();r.context={element:n,position:E.getStyleValue(n,"position"),valid:!0,action:"container",offsetX:t.pageX-s.left,offsetY:t.pageY-s.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(t){const r=this,{context:n,floatRootOwner:s}=r,{element:a}=n,l=a.cloneNode(!0),o=s==null?void 0:s.element.closest(".b-outer");l.classList.add(r.dragProxyCls,r.draggingCls),((s==null?void 0:s.floatRoot)||E.getRootElement(a)).appendChild(l),n.dragProxy=l,n.dragging=a,a.classList.add(r.dropPlaceholderCls),s&&s.element.classList.add("b-dragging-child"),o&&(l.style.zIndex=s.floatRootMaxZIndex+1)}onContainerDragStarted(t){const r=this,{context:n}=r,{element:s,dragProxy:a}=n,l=s.getBoundingClientRect();if(r.autoSizeClonedTarget)a.style.width=l.width+"px",a.style.height=l.height+"px",E.setTranslateXY(n.dragProxy,l.left,l.top);else if(r.useCenteredCursor){const o=a.getBoundingClientRect();Object.assign(n,{offsetX:o.width/2,offsetY:o.height/2}),E.setTranslateXY(a,t.clientX,t.clientY)}}updateContainerDrag(t){var r;const n=this,{context:s}=n,{targetElement:a}=s;if(!s.started||!a)return;let l=E.getAncestor(a,n.containers);const o=(r=s.dragging)==null?void 0:r.contains(E.getActiveElement(s.dragging));l&&E.isDescendant(s.element,l)||(o&&le.suspendFocusEvents(),s.valid&&(l||n.containers.some(d=>d.contains(a)))?(l||(l=n.containers.find(d=>d.contains(a)).lastElementChild),n.moveNextTo(l,t)):n.revertPosition(),o&&le.resumeFocusEvents(),t.preventDefault())}finishContainerDrag(t){const r=this,{context:n}=r,{dragging:s,dragProxy:a,valid:l,draggedTo:o,insertBefore:d,originalPosition:c}=n;s&&(n.valid=!!(l&&(o||r.externalDropTargetSelector&&t.target.closest(r.externalDropTargetSelector))&&(s!==d||c.parent!==o)),n.finalize=(u=n.valid)=>{!u&&r.context&&r.revertPosition(),s.classList.remove(r.dropPlaceholderCls),a.remove(),r.reset()},n.async=!1,r.trigger("drop",{context:n,event:t}),n.async||n.finalize())}abortContainerDrag(t=!1,r=null,n=!1){const s=this,{context:a}=s;a.dragging&&(a.dragging.classList.remove(s.dropPlaceholderCls),a.dragProxy.remove(),s.revertPosition()),n||s.trigger(t?"drop":"abort",{context:a,event:r}),s.reset()}updateContainerProxy(t){var r,n;const s=this,{context:a}=s,l=a.dragProxy;let o=t.pageX-a.offsetX,d=t.pageY-a.offsetY;typeof s.minX=="number"&&(o=Math.max(s.minX,o)),typeof s.maxX=="number"&&(o=Math.min(s.maxX-l.offsetWidth,o)),typeof s.minY=="number"&&(d=Math.max(s.minY,d)),typeof s.maxY=="number"&&(d=Math.min(s.maxY-l.offsetHeight,d)),s.lockX?E.setTranslateY(l,d):s.lockY?E.setTranslateX(l,o):E.setTranslateXY(l,o,d);let c;if(t.type==="touchmove"){const u=t.changedTouches[0];c=E.elementFromPoint(u.clientX,u.clientY)}else c=t.target;a.targetElement=((r=s.resolveTargetElement)==null?void 0:r.call(s,c))||c,(n=a.targetElement.nextElementSibling)!=null&&n.matches(`.${s.dropPlaceholderCls}`)||(a.insertBefore=a.targetElement.nextElementSibling)}moveNextTo(t,r){const{context:n}=this,s=n.dragging,a=t.parentElement;if(t!==s){const l=L.from(t).center.x;if(this.isRTL&&r.pageX>l||!this.isRTL&&r.pageX<l){const o=t.previousElementSibling;a.insertBefore(s,t),n.insertBefore=t,o!==s&&this.trigger("itemMove",{context:n,event:r})}else t.nextElementSibling?t.nextElementSibling!==s?(n.insertBefore=t.nextElementSibling,a.insertBefore(s,t.nextElementSibling),this.trigger("itemMove",{context:n,event:r})):!n.insertBefore&&s.parentElement.lastElementChild!==s&&(n.insertBefore=t.nextElementSibling):(a.appendChild(s),this.trigger("itemMove",{context:n,event:r}),n.insertBefore=null);n.draggedTo=a}}revertPosition(){const{context:t}=this,{dragging:r,originalPosition:n}=t,{parent:s,next:a}=n;n.parent===r.parent&&n.prev===r.previousElementSibling&&n.next===r.nextElementSibling||(a?s.insertBefore(r,a):s.appendChild(r),this.trigger("itemMove",{context:t})),t.draggedTo=null}},y(e,"$name","DragHelperContainer"),e},QT={pageXOffset:0,pageYOffset:0},eM=i=>{var e;return e=class extends fe(i||$){static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const t=this;!t.isElementDraggable&&t.targetSelector&&(t.isElementDraggable=r=>r.closest(t.targetSelector))}grabTranslateDrag(t){const r=this.getTarget(t);return r?(this.context={valid:!0,element:r,position:E.getStyleValue(r,"position"),startPageX:t.pageX,startPageY:t.pageY,startClientX:t.clientX,startClientY:t.clientY},!0):!1}getTarget(t){const{targetSelector:r,target:n}=this;if(r)return t.target.closest(r);const s=n.isWidget?n.element:n;return s.contains(t.target)?s:null}getX(t){return this.positioning==="absolute"?parseFloat(t.style.left,10):this.positioning==="inset"?parseFloat(getComputedStyle(t).insetInlineStart,10):E.getTranslateX(t)}getY(t){return this.positioning==="absolute"?parseFloat(t.style.top,10):this.positioning==="inset"?parseFloat(getComputedStyle(t).top,10):E.getTranslateY(t)}getXY(t){if(this.positioning==="absolute")return[t.offsetLeft,t.offsetTop];if(this.positioning==="inset"){const r=getComputedStyle(t);return[parseFloat(r.insetInlineStart,10),parseFloat(r.top,10)]}return E.getTranslateXY(t)}setXY(t,r,n){this.skipUpdatingElement||(this.positioning==="absolute"?(t.style.left=r+"px",t.style.top=n+"px"):this.positioning==="inset"?(t.style.insetInlineStart=r+"px",t.style.top=n+"px"):E.setTranslateXY(t,r,n))}startTranslateDrag(t){const r=this,{context:n,outerElement:s,proxySelector:a}=r,l=r.dragWithin=r.dragWithin||r.cloneTarget&&document.body;let o=n.dragProxy||n.element;const d=o,c=o.parentElement;if(r.cloneTarget){const g=a?o.querySelector(a):o;let{width:f,height:m,x:p,y:v}=L.from(g,L.outer(l));r.isRTL&&o.style.insetInlineStart&&(p=L.outer(l).right-L.from(o).right),o=r.createProxy(o);let b=p,w=v;if(r.autoSizeClonedTarget&&(o.style.width=`${f}px`,o.style.height=`${m}px`),o.classList.add(r.dragProxyCls,r.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),l.appendChild(o),!r.autoSizeClonedTarget||a){const D=o.getBoundingClientRect(),{x:S,y:x}=l.getBoundingClientRect(),R=t.clientX-S,M=t.clientY-x+(l!==document.body?document.body.getBoundingClientRect().y:0);b=R-D.width/2,w=M-D.height/2,n.startPageX=t.pageX,n.startPageY=t.pageY}r.setXY(o,b,w),d.classList.add("b-drag-original"),r.hideOriginalElement&&d.classList.add("b-hidden")}o.classList.add(r.draggingCls);const u=r.getX(o),h=r.getY(o);Object.assign(n,{element:o,grabbed:d,grabbedParent:c,grabbedNextSibling:o.nextElementSibling,elementStartX:u,elementStartY:h,elementX:r.positioning==="inset"?u:E.getOffsetX(o,l||s),elementY:r.positioning==="inset"?h:E.getOffsetY(o,l||s),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!r.cloneTarget||l===s}),l&&(n.parentElement=o.parentElement,l!==o.parentElement&&l.appendChild(o),r.updateTranslateProxy(t))}onTranslateDragStarted(){const t=this,{context:r}=t;let{relatedElements:n}=r;if(t.unifiedProxy&&r.element.classList.add("b-drag-main","b-drag-unified-proxy"),(n==null?void 0:n.length)>0){r.relatedElStartPos=[],r.relatedElDragFromPos=[];const{proxySelector:s}=t;let[a,l]=[r.elementStartX,r.elementStartY];r.originalRelatedElements=n,n=r.relatedElements=n.map((o,d)=>{const c=s?o.querySelector(s):o,{x:u,y:h,width:g,height:f}=L.from(c,t.dragWithin),m=t.cloneTarget?t.createProxy(o):o;return m.classList.add(t.draggingCls),m.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(m,u,h),t.dragWithin.appendChild(m),m.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(m.style.width=`${g}px`,m.style.height=`${f}px`),t.hideOriginalElement&&o.classList.add("b-hidden"),o.classList.add("b-drag-original")),r.relatedElStartPos[d]=r.relatedElDragFromPos[d]=t.getXY(m),t.unifiedProxy&&(m.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),a+=t.unifiedOffset,l+=t.unifiedOffset,t.setXY(m,a,l),r.relatedElDragFromPos[d]=[a,l],m.style.zIndex=100-d),m}),t.unifiedProxy&&n&&n.length>0&&V.onTransitionEnd({element:n[0],property:"transform",handler(){n.forEach(o=>o.classList.remove("b-drag-unified-animation"))},thisObj:t,once:!0})}}applyConstraints(t,r,n){const s=this,{constrain:a,dragWithin:l}=s,{pageXOffset:o,pageYOffset:d}=l===document.body?globalThis:QT;if(l&&a){const c=new L(r,n,t.offsetWidth,t.offsetHeight),u=L.from(l);s.context.position!=="fixed"&&(u.height=l.scrollHeight,u.width=l.scrollWidth,u.moveTo(0,0)),{x:r,y:n}=c.constrainTo(u)}return typeof s.minX=="number"&&(r=Math.max(s.minX+o,r)),typeof s.maxX=="number"&&(r=Math.min(s.maxX+o,r)),typeof s.minY=="number"&&(n=Math.max(s.minY+d,n)),typeof s.maxY=="number"&&(n=Math.min(s.maxY+d,n)),{constrainedX:r,constrainedY:n}}updateTranslateProxy(t,r){const n=this,{lockX:s,lockY:a,context:l}=n,o=l.dragProxy||l.element,{relatedElements:d,relatedElDragFromPos:c}=l,u=n.isRTL&&n.positioning==="inset"?-1:1;l.scrollManagerElementContainsDragProxy&&r&&(l.scrollX=r.getRelativeLeftScroll(o),l.scrollY=r.getRelativeTopScroll(o)),l.pageX=t.pageX,l.pageY=t.pageY,l.clientX=t.clientX,l.clientY=t.clientY;let h=l.elementStartX+(t.pageX-l.startPageX+l.scrollX)*u,g=l.elementStartY+t.pageY-l.startPageY+l.scrollY;if(n.snapCoordinates){const p=n.snapCoordinates({element:o,newX:h,newY:g});h=p.x,g=p.y}const{constrainedX:f,constrainedY:m}=n.applyConstraints(o,h,g);if((l.started||f!==h||m!==g)&&n.setXY(o,s?void 0:f,a?void 0:m),d){const p=s?0:f-l.elementStartX,v=a?0:m-l.elementStartY;d.forEach((b,w)=>{const[D,S]=c[w];n.setXY(b,D+p,S+v)})}l.newX=f,l.newY=m}async finishTranslateDrag(t){const r=this,n=r.context,{target:s}=t,a=!r.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),l=!r.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),o=n.dragProxy||n.element,{relatedElements:d}=n;if(!r.ignoreSamePositionDrop||a||l)if(n.valid===!1)await r.abortTranslateDrag(!0,t);else{const c=!r.allowDropOutside&&L.from(r.dragWithin||r.outerElement);c&&(typeof r.minX!="number"&&r.minX!==!0&&t.pageX<c.left||typeof r.maxX!="number"&&r.maxX!==!0&&t.pageX>c.right||typeof r.minY!="number"&&r.minY!==!0&&t.pageY<c.top||typeof r.maxY!="number"&&r.maxY!==!0&&t.pageY>c.bottom)?await r.abortTranslateDrag(!0,t):(n.finalize=async(u=n.valid)=>{if(n.finalized){console.warn("DragHelper: Finalizing already finalized drag");return}n.finalized=!0,!u&&r.context&&await r.abortTranslateDrag(!0,null,!0),r.isDestroyed||(r.trigger("dropFinalized",{context:n,event:t,target:s}),r.reset()),!r.cloneTarget&&o.parentElement!==n.grabbedParent&&[o,...d||[]].forEach(h=>h.style.transform="")},n.async=!1,await r.trigger("drop",{context:n,event:t,target:s}),n.async||await n.finalize())}else r.abortTranslateDrag(!1,t)}async abortTranslateDrag(t=!1,r=null,n=!1){var s,a;const l=this,{cloneTarget:o,context:d,proxySelector:c,dragWithin:u,draggingCls:h}=l,{relatedElements:g,relatedElStartPos:f,grabbed:m}=d,p=d.dragProxy||d.element;if(d.valid=!1,(s=l.scrollManager)==null||s.stopMonitoring(),d.aborted){console.warn("DragHelper: Aborting already aborted drag");return}let{elementStartX:v,elementStartY:b}=d;const w=v!==l.getX(p)||b!==l.getY(p);if(p&&d.started){if(!o&&u&&u!==d.grabbedParent&&d.grabbedParent.insertBefore(p,d.grabbedNextSibling),o&&c){const D=m.querySelector(c)||m,{x:S,y:x}=L.from(D);v=S,b=x}if(p.classList.add("b-aborting"),l.setXY(p,v,b),g==null||g.forEach((D,S)=>{D.classList.remove(h),D.classList.add("b-aborting"),l.setXY(D,f[S][0],f[S][1])}),n||l.trigger(t?"drop":"abort",{context:d,event:r}),p.isConnected&&!l.isDestroying&&w){const D=l.positioning==="inset"?"inset":"transform";p.getAnimations().length&&await V.waitForTransitionEnd({element:p,property:E.getPropertyTransitionDuration(p,D)?D:"all",thisObj:l,once:!0,timeout:300,runOnDestroy:!0})}l.isDestroyed||l.trigger("abortFinalized",{context:d,event:r})}(a=l.context)!=null&&a.started&&l.reset()}cleanUp(){const t=this,{context:r,cloneTarget:n,draggingCls:s,dragProxyCls:a}=t,l=r.dragProxy||r.element,{relatedElements:o,originalRelatedElements:d,grabbed:c}=r,u=n&&(t.removeProxyAfterDrop||!r.valid),h=[s,"b-aborting",a,"b-drag-main","b-drag-unified-proxy"];l.classList.remove(...h),u&&l.remove(),o==null||o.forEach(g=>{u?g.remove():g.classList.remove(...h)}),c.classList.remove("b-drag-original","b-hidden"),d==null||d.forEach(g=>g.classList.remove("b-hidden","b-drag-original"))}},y(e,"$name","DragHelperTranslate"),e},Rn={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown",keyup:"onKeyDownUp"},si=class wv extends $.mixin(Fe,JT,eM){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,target:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:200,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,externalDropTargetSelector:null,testConfig:{clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null,resolveTargetElement:null,disabled:!1}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,r={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),V.on(r)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let r=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.mode==="closed"&&(r=e.closest(".b-outer")||r),r}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}onPointerDown(e){const t=this;if(e.button!==0||t.context||t.disabled||t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;if(t.startEvent=e,t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){const n=globalThis;t.blurDetacher=V.on({element:n,blur:t.onWindowBlur,thisObj:t});const s={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:Rn.keydown,keyup:Rn.keyup};if(e.pointerType==="touch"?(t.touchStartTimer=t.setTimeout(()=>t.touchStartTimer=null,t.touchStartDelay,"touchStartDelay"),s.touchmove={handler:Rn.touchmove,passive:!1},s.touchend=s.pointerup=Rn.touchend):(s.pointermove=Rn.move,s.pointerup=Rn.up),t.dragListenersDetacher=V.on(s),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const a=L.from(t.dragWithin,t.outerElement);t.minY=a.top,t.maxY=a.bottom,t.minX=a.left,t.maxX=a.right}}}async internalMove(e){var t,r,n,s;if(e.scrollInitiated)return;const a=this,{context:l}=a,o=V.getDistanceBetween(a.startEvent,e);if(a.touchStartTimer&&o>a.dragThreshold){a.abort(!0);return}if(!a.touchStartTimer&&(l!=null&&l.element)&&(l.started||o>=a.dragThreshold)&&((t=e.target)==null?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!l.started){const c=V.getXY(a.startEvent),u=V.getXY(e),h=Math.abs(c[0]-u[0])>=Math.abs(c[1]-u[1])?"horizontal":"vertical";if(!l.beforeDragStartFired&&a.trigger("beforeDragStart",{context:l,event:e,initialDirection:h})===!1)return a.abort();if(l.beforeDragStartFired=!0,Math.abs(V.getDistanceBetween(a.startEvent,e,{x:a.lockY,y:a.lockX}))<a.dragThreshold)return;a.isContainerDrag?a.startContainerDrag(e):a.startTranslateDrag(e),(n=(r=l.dragProxy)==null?void 0:r.closest)!=null&&n.call(r,".b-float-root")&&(l.dragProxy.style.fontSize=E.getStyleValue(l.element,"fontSize")),l.started=wv.dragging=!0,(s=a.scrollManager)==null||s.startMonitoring(T.merge({scrollables:[{element:a.dragWithin||a.outerElement}],callback:a.onScrollManagerScrollCallback},a.monitoringConfig)),l.outermostEl=E.getOutermostElement(e.target),l.outermostEl.classList.add("b-draghelper-active"),a.dropTargetSelector&&a.dropTargetCls&&E.getRootElement(a.outerElement).querySelectorAll(a.dropTargetSelector).forEach(f=>f.classList.add(a.dropTargetCls));const g=a.trigger("dragStart",{context:l,event:e,initialDirection:h});T.isPromise(g)&&await g,a.onKeyDownUp(e),l.moveUnblocked=!0,a.isContainerDrag?a.onContainerDragStarted(e):a.onTranslateDragStarted(e),a.trigger("afterDragStart",{context:l,event:e,initialDirection:h})}l.moveUnblocked?a._cachedMouseEvent?(a.update(e),a.update(a._cachedMouseEvent),delete a._cachedMouseEvent):a.update(e):a._cachedMouseEvent=e}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:r}=this;(t=this.context)!=null&&t.element&&r&&(r.isScroll=!0,this.update(r,e))}onTouchMove(e){var t;((t=e.changedTouches)==null?void 0:t.length)===1&&(this.context&&!this.touchStartTimer&&e.preventDefault(),this.internalMove(e))}onMouseMove(e){this.internalMove(e)}update(e,t){const r=this,n=document.scrollingElement||document.body,{context:s}=r;let a=r.getMouseMoveEventTarget(e);if(e.type==="touchmove"){const o=e.changedTouches[0];a=E.getRootElement(e.target).getRootNode().elementFromPoint(o.clientX+n.scrollLeft,o.clientY+n.scrollTop)}s.target=a;let l=r.allowDropOutside||!r.dragWithin||r.dragWithin.contains(e.target);l&&r.dropTargetSelector&&(l=l&&!!(a!=null&&a.closest(r.dropTargetSelector))),r.isContainerDrag?r.updateContainerProxy(e,t):r.updateTranslateProxy(e,t),s.valid=l,r.trigger("drag",{context:s,event:e}),r.isContainerDrag&&r.updateContainerDrag(e,t),s.valid=s.valid&&l;for(const o of r.draggedElements)o.classList.toggle(r.invalidCls,!s.valid);e&&(r.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:t}=this;return[t.dragProxy||t.element,...(e=t.relatedElements)!=null?e:[]]}async abort(e=!1){var t,r;const n=this,{context:s}=n;(r=(t=n.scrollManager)==null?void 0:t.stopMonitoring)==null||r.call(t),n.removeListeners(),s!=null&&s.started&&!s.aborted?(s.element.getBoundingClientRect(),s.valid=!1,n.isContainerDrag?n.abortContainerDrag(void 0,void 0,e):n.abortTranslateDrag(void 0,void 0,e),s.aborted=!0):n.reset(!0)}removeListeners(){var e,t;(e=this.dragListenersDetacher)==null||e.call(this),(t=this.blurDetacher)==null||t.call(this)}reset(e){var t;const r=this,{context:n}=r;if(n!=null&&n.started){for(const s of r.draggedElements)s.classList.remove(r.invalidCls);n.outermostEl.classList.remove("b-draghelper-active"),r.isContainerDrag?(n.dragProxy.remove(),(t=r.floatRootOwner)==null||t.element.classList.remove("b-dragging-child")):r.cleanUp(),r.dropTargetSelector&&r.dropTargetCls&&E.getRootElement(r.outerElement).querySelectorAll(r.dropTargetSelector).forEach(s=>s.classList.remove(r.dropTargetCls))}r.removeListeners(),e||r.trigger("reset"),r.context=r.lastMouseMoveEvent=null,wv.dragging=!1}onTouchEnd(e){E.getOutermostElement(e.target).classList.remove("b-no-touch-scroll"),this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){var t;const r=this,{context:n}=r;r.removeListeners(),n&&((t=r.scrollManager)==null||t.stopMonitoring(),n.started?n.moveUnblocked?(e.stopPropagation(),n.finalizing=!0,r.isContainerDrag?r.finishContainerDrag(e):r.finishTranslateDrag(e),V.on({element:document,thisObj:r,click:Rn.docclick,capture:!0,expires:r.clickSwallowDuration,once:!0})):r.ion({drag(){r.onMouseUp(e)},once:!0}):r.reset(!0))}onKeyDown(e){var t;(t=this.context)!=null&&t.started&&e.key==="Escape"&&(e.stopImmediatePropagation(),this.abort()),this.onKeyDownUp(e)}onKeyDownUp(e){var t;(t=this.context)==null||t.element.classList.toggle("b-drag-copy",e[Y.ctrlKey]||e[Y.metaKey])}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return this.mode==="container"}async animateProxyTo(e,t={align:"c-c"}){const{context:r,draggedElements:n}=this,{element:s}=r,a=e.isRectangle?e:L.from(e);n.forEach(l=>{l.classList.add("b-drag-final-transition"),E.alignTo(l,a,t,void 0,void 0,this.positioning==="inset"?"topInset":"translate")}),await V.waitForTransitionEnd({element:s,property:"all",thisObj:this,once:!0}),n.forEach(l=>l.classList.remove("b-drag-final-transition"))}get isDragging(){var e;return!!((e=this.context)!=null&&e.started)}getMouseMoveEventTarget(e){return e.isScroll?E.elementFromPoint(e.clientX,e.clientY):e.target}};si._$name="DragHelper";var LC=Array.prototype.slice,PC=Object.freeze([]),tM=Object.freeze({}),OC=/[&<]/,{getPrototypeOf:$C}=Object,{toString:iM}=Object.prototype,{isEqual:HC,isObject:rM}=T,nM={parent:1,elementData:1,ns:1,syncOptions:1},VC=()=>({ignore:nM,refsFound:new Set}),jf={class:1,className:1,classname:1},sM={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},aM={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1,retainChildren:1},lM=(i,e)=>{const t="className"in e?"className":"class",r=e[t];if(r)if(typeof r=="string"){const n=r.split(" ");n.includes(i)||(n.push(i),e[t]=n.join(" "))}else Array.isArray(r)?r.includes(i)||r.push(i):r.isDomClassList?r.add(i):T.isObject(r)&&(r[i]=1)},oM=(i,e)=>{const t="className"in e?"className":"class",r=e[t];if(r)if(typeof r=="string"){const n=r.split(" ");n.includes(i)&&(n.splice(n.indexOf(i),1),e[t]=n.join(" "))}else Array.isArray(r)?r.includes(i)&&r.splice(r.indexOf(i),1):r.isDomClassList?r.remove(i):T.isObject(r)&&delete r[i]},oe=class je{static checkEquality(e,t,r,n){var s;if(e===t)return!0;if(e==null)return t==null;if(!e||!t)return!1;const a=typeof e;if(a!==typeof t||sM[a])return!1;let o=r.equalityCache||(r.equalityCache=new Map),d=!!n,c,u,h,g,f,m,p;if(o=o.get(e)||o.set(e,new Map).get(e),c=o.get(t),c===void 0){if(c=!0,$C(e)!==$C(t)||e instanceof Node)c=!1;else if(Array.isArray(e)){if(u=e.length,u!==t.length)c=!1;else for(;u-- >0;)if(!je.checkEquality(e[u],t[u],r,d)){c=!1;break}}else{m=e.syncOptions,g=m==null?void 0:m.ignoreRefs,g&&(d=!0,n=g!=="children"),h=r.ignore||tM;for(f in t)if(!h[f]&&!(f in e)&&!(n&&f==="reference")){c=!1;break}if(c){if(iM.call(t)==="[object Date]")c=e.getTime()===t.getTime();else if(E.isReactElement(e)||E.isReactElement(t)||E.isVueConfig(e)||E.isVueConfig(t))c=!1;else for(f in e)if(!h[f]&&!(n&&f==="reference")){if(!(f in t)){c=!1;break}if(p=e[f],!je.checkEquality(p,t[f],r,d)){c=!1;break}}}}!n&&rM(e)&&e.reference&&((s=r.refsFound)==null||s.add(e.reference)),o.set(t,c)}return c}static sync(e){var t;const r=e,{refOwner:n}=e,s=n==null?void 0:n.byRef,a=VC();let l=e.affected,o,d,c,u;if(typeof l=="string"&&(l=[l]),e={...e,checkEqualityOptions:a},n){if(n.byRef={},l)for(d in s)l.includes(d)||(n.byRef[d]=s[d]);e.refsWas=s}if(r.changed=je.performSync(e,e.targetElement),n)for(l||(l=Object.keys(s)),o=0;o<l.length;++o)d=l[o],c=s[d],a.refsFound.has(d)||c.retainElement?n.byRef[d]=c:(u=c.lastDomConfig,(t=c.blur)==null||t.call(c),c.remove(),n.detachRef(d,c,u));return e.targetElement}static performSync(e,t){const{domConfig:r,callback:n}=e,{lastDomConfig:s}=t;if((e.configEquality||je.checkEquality)(r,s,e.checkEqualityOptions,e.ignoreRefs))n==null||n({action:"none",domConfig:r,targetElement:t});else return r?(r.onlyChildren||(je.syncAttributes(r,t,e),je.syncContent(r,t)),r.keepChildren||je.syncChildren(e,t)):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=r!=null&&r.onlyChildren&&s?{...s,children:r.children}:r,!0;return!1}static syncDataset(e,t){const{lastDomConfig:r}=t,n=e===r,s=Object.keys(e.dataset),a=r&&r.dataset&&Object.keys(r.dataset),l=B.delta(s,a);let o,d,c,u;for(d=0;d<l.onlyInA.length;d++)o=l.onlyInA[d],u=e.dataset[o],u!=null&&t.setAttribute(`data-${O.hyphenate(o)}`,u);for(d=0;d<l.inBoth.length;d++)o=l.inBoth[d],u=e.dataset[o],(n||u!=r.dataset[o])&&(c=`data-${O.hyphenate(o)}`,u==null?t.removeAttribute(c):t.setAttribute(c,u));for(d=0;d<l.onlyInB.length;d++)t.removeAttribute(`data-${O.hyphenate(l.onlyInB[d])}`)}static addCls(e,t){const{lastDomConfig:r}=t;e=te.normalize(e,"array"),e.forEach(n=>{t.classList.add(n),lM(n,r)})}static removeCls(e,t){const{lastDomConfig:r}=t;e=te.normalize(e,"array"),e.forEach(n=>{t.classList.remove(n),oM(n,r)})}static syncClassList(e,t,r){let n=e.className||e.class,s=!1,a,l,o,d,c,u;if(r){for(l=te.normalize(t,"array"),n=te.normalize(n,"object"),u=te.normalize(r.className||r.class,"object"),c=[],o=0,d=l.length;o<d;++o)a=l[o],n[a]||!(a in u)?(u[a]=1,c.push(a)):s=!0;for(a in n)u[a]||(c.push(a),s=!0);if(!s)return;n=c.join(" ")}else n=te.normalize(n);t.setAttribute("class",n)}static getSyncAttributes(e){const t={},r=[];return e&&Object.keys(e).forEach(n=>{if(!aM[n]){const s=n.toLowerCase();t[s]=e[n],r.push(s)}}),{attributes:t,names:r}}static syncAttributes(e,t,r){const{lastDomConfig:n}=t,s=e===n,a=je.getSyncAttributes(e),{attributes:l,names:o}=a,{attributes:d,names:c}=s?a:je.getSyncAttributes(n),{onlyInA:u,onlyInB:h,inBoth:g}=s?{onlyInA:PC,onlyInB:PC,inBoth:o}:B.delta(o,c);let f,m,p=!1;for(m=0;m<u.length;m++){f=u[m];const v=l[f];f==="style"&&v!=null?E.applyStyle(t,v,!0):f==="dataset"?je.syncDataset(e,t):jf[f]?(je.syncClassList(e,t),p=!0):v!=null&&t.setAttribute(f,v)}for(m=0;m<g.length;m++){f=g[m];const v=l[f],b=d[f];v==null?t.removeAttribute(f):f==="style"?r.strict?s?je.syncStyles(t,v):HC(v,b,!0)||je.syncStyles(t,v,b):(s||!HC(v,b,!0))&&E.applyStyle(t,v,!0):f==="dataset"?je.syncDataset(e,t):jf[f]?(je.syncClassList(e,t,r.strict&&t.lastDomConfig),p=!0):(s||v!==b)&&t.setAttribute(f,v)}for(m=0;m<h.length;m++)f=h[m],(!jf[f]||!p)&&t.removeAttribute(f)}static syncStyles(e,t,r){let n,s,a;if(!r)n=t;else{if(n={},t=E.parseStyle(t),r=E.parseStyle(r),t)for(s in t)a=t[s],r[s]!==a&&(n[s]=a);for(s in r)s in t||(n[s]="")}E.applyStyle(e,n)}static syncContent(e,t){var r;const{html:n,text:s}=e,a=s!=null?s:n;if(t.didSetTextContent=!1,e.elementData&&(t.elementData=e.elementData),a instanceof DocumentFragment)t.childNodes.length===1&&E.getChildElementCount(t)===0&&a.childNodes.length===1&&E.getChildElementCount(a)===0?E.setInnerText(t,a.firstChild.data):(t.innerHTML="",t.appendChild(a));else if(n!=null&&OC.test(n))t.innerHTML=String(n);else if(a!=null){const{lastDomConfig:l}=t;((r=l==null?void 0:l.children)!=null&&r.length||l!=null&&l.html&&OC.test(t.lastDomConfig.html))&&(t.innerHTML=""),E.setInnerText(t,String(a)),t.didSetTextContent=!0}}static insertTextNode(e,t,r,n,s=null){const a=document.createTextNode(e);t.insertBefore(a,s),n&&(a.$refOwnerId=n.id),r==null||r({action:"newNode",domConfig:e,targetElement:a})}static insertElement(e,t,r,n,s,a,l){var o;const d=l.ns?document.createElementNS(l.ns,e.tag||"svg"):document.createElement(e.tag||"div");e.elementData&&(d.elementData=e.elementData),t.insertBefore(d,r),je.performSync(l,d),a!=null&&(s[a]=d),!("role"in e)&&!e.tabIndex&&!e["aria-hidden"]&&!e.alt&&!E.isFocusable(d,!0)&&!d.htmlFor&&d.setAttribute("role","presentation"),n&&(d.$refOwnerId=n.id,a&&(d.$reference=a,n.attachRef(a,d,e))),(o=l.callback)==null||o.call(l,{action:"newElement",domConfig:e,targetElement:d,syncId:a})}static syncChildren(e,t){var r,n,s,a;let{domConfig:l,syncIdField:o,callback:d,releaseThreshold:c,configEquality:u,ns:h,refOwner:g,refsWas:f,strict:m,checkEqualityOptions:p,ignoreRefs:v}=e,b=null,w,D,S;const x=l.syncOptions||{};if((r=l.html)!=null?r:l.text)return;v=!!((n=x.ignoreRefs)!=null?n:v),v&&(g=f=null),"strict"in x&&(m=x.strict);const R=g?g.byRef:{},M=LC.call(l.children||[]),_=LC.call(t.childNodes),k=f||t.syncIdMap||{},F=t.releasedIdMap||{},I=P=>{for(;_.length&&_[0].parentNode!==t;)_.shift();return(P?_.shift():_[0])||null};o=x.syncIdField||o,m=x.strict||m,d=x.callback||d,u=x.configEquality||u,c="releaseThreshold"in x?x.releaseThreshold:c,o&&(t.syncIdMap=R);const A={checkEqualityOptions:p||VC(),ignoreRefs:v,refOwner:g,refsWas:f,strict:m,syncIdField:o,releaseThreshold:c,callback:d,configEquality:u};for(;M.length;){const P=M.shift();if(S=null,!P)continue;if(E.isReactElement(P)||E.isVueConfig(P)){d({jsx:P,targetElement:t,domConfig:l});continue}if(Array.isArray(P)){this.syncChildren({...e,domConfig:{...e.domConfig,children:P}},t);continue}if(P instanceof Node){D=I(),P!==D&&t.insertBefore(P,D),w=_.indexOf(P),w>-1&&_.splice(w,1);continue}const H=typeof P=="string";if(A.domConfig=P,A.ns=P.ns||h,!H){if(g?S=P.reference:o&&P.dataset&&(S=P.dataset[o]),S!=null&&!P.unmatched){const j=k[S]||F[S];if(j){const{lastDomConfig:se}=j;j.retainElement&&j.retainElement!=="prevent-release"||je.performSync(A,j)&&(d==null||d({action:"reuseOwnElement",domConfig:P,targetElement:j,lastDomConfig:se,syncId:S})),P.retainElement&&(j.retainElement=!0),R[S]=j,B.remove(_,j),delete F[S],j.isReleased=!1,D=I(),(j.parentNode!==t||m&&j.nextSibling!==D)&&t.insertBefore(j,D)}else m?je.insertElement(P,t,I(),g,R,S,A):(M.push(P),P.unmatched=!0);continue}P.unmatched&&delete P.unmatched}let G=null,q=null,W;for(;!q&&(W=I(!0));){if(g){if(W.$refOwnerId!==g.id)continue;if(W.$reference){if(!m)continue;G=W;break}q=W}else W.retainElement||(q=W);q||(b||(b=[])).push(W)}if(G||!q)H?je.insertTextNode(P,t,d,g,G):je.insertElement(P,t,G,g,R,S,A);else if(!H&&q.nodeType===Node.ELEMENT_NODE&&(P.tag||"div").toLowerCase()===q.tagName.toLowerCase()){const{lastDomConfig:j}=q,se=je.performSync(A,q);if(o&&((s=j==null?void 0:j.dataset)==null?void 0:s[o])!=null){const J=j.dataset[o];delete F[J],delete k[J]}S!=null&&(R[S]=q),q.isReleased=!1,se&&(d==null||d({action:"reuseElement",domConfig:P,targetElement:q,lastDomConfig:j,syncId:S}))}else H&&q.nodeType===Node.TEXT_NODE?q.data=P:(H?je.insertTextNode(P,t,d,g,q):je.insertElement(P,t,q,g,R,S,A),(a=q.blur)==null||a.call(q),q.remove())}if(!(t.didSetTextContent&&_.length===1&&_[0].nodeType===Node.TEXT_NODE)&&!l.retainChildren){for(;D=I(!0);)(!g||D.$refOwnerId===g.id&&!D.$reference)&&(b||(b=[])).push(D);b&&je.syncChildrenCleanup(t,b,R,d,g,c,o)}}static syncChildrenCleanup(e,t,r,n,s,a,l){var o;let d=0,c;for(const u of t){const{lastDomConfig:h}=u;if(u.nodeType===Element.TEXT_NODE){u.remove();continue}u.retainElement?l&&h&&(r[u.dataset[l]]=u):!s&&l&&(a==null||d<a)?(u.isReleased||(u.className="b-released",u.isReleased=!0,h!=null&&h.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[h.dataset[l]]=u),n==null||n({action:"releaseElement",domConfig:h,lastDomConfig:h,targetElement:u}),h&&(h.isReleased=!0,h.className&&(h.className="b-released"),h.class&&(h.class="b-released"),h.style&&(h.style=null))),d++):((o=u.blur)==null||o.call(u),u.remove(),s&&(c=u.$reference,c&&s.detachRef(c,u,h)),e.releasedIdMap&&l&&(h!=null&&h.dataset)&&delete e.releasedIdMap[h.dataset[l]],n==null||n({action:"removeElement",domConfig:u.lastDomConfig,lastDomConfig:u.lastDomConfig,targetElement:u}))}}static removeChild(e,t){if(e.contains(t)){const r=e.syncIdMap;if(r){const n=Object.values(r).indexOf(t);n>-1&&delete r[Object.keys(r)[n]]}e.removeChild(t)}}static addChild(e,t,r){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[r]=t}static getChild(e,t){var r;const n=String(t).split(".");for(const s of n)if(e=(r=e==null?void 0:e.syncIdMap)==null?void 0:r[s],!e)return null;return e}};oe._$name="DomSync";var Et=class Mg{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=a=>e.map(l=>{let o=a+O.capitalize(l);return a==="moz"&&(o=o.replace("screen","Screen"),"mozCancelFullScreen"in document&&l==="exitFullscreen"&&(o="mozCancelFullScreen")),o});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const r=["fullscreenchange","fullscreenerror"],n=["MSFullscreenChange","MSFullscreenError"],s=a=>r.map(l=>a+O.capitalize(l));this.events="fullscreenEnabled"in document&&r||"webkitFullscreenEnabled"in document&&s("webkit")||"mozFullscreenEnabled"in document&&s("moz")||"msFullscreenEnabled"in document&&n||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}static get enabled(){return!!(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(e==null?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}static onInternalFullscreenChange(e){const t=globalThis.bryntum,{element:r}=Mg;if(Mg.isFullscreen&&t._floatRoot||!Mg.isFullscreen&&!t._floatRoot)return;let n,s;if(r?r.closest(".b-floatroot")||(n=E.getRootElement(r).floatRoot,n&&(t._floatRoot=n,t._oldParent=n.parentElement,s=r)):(n=t._floatRoot,s=n&&t._oldParent,t._oldParent=t._floatRoot=null),s){const a=Array.from(n.querySelectorAll(".b-widget")).map(l=>z.fromElement(l));a.forEach(l=>{var o;return(o=l.beforeFloatReparent)==null?void 0:o.call(l)}),s.appendChild(n),a.forEach(l=>{var o;return(o=l.afterFloatReparent)==null?void 0:o.call(l)})}le.trigger("fullScreenChange",{event:e})}};Et.init(),Et._$name="Fullscreen";var Uf=null,Gf=[],dM=i=>{var e;return i.nodeType===i.ELEMENT_NODE&&((e=i.ownerDocument.defaultView)==null?void 0:e.getComputedStyle(i).getPropertyValue("position"))==="absolute"},Ge=class DE{static addResizeListener(e,t){const r=this;if((e===document||e===globalThis)&&(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)r.hasWindowResizeListener||(globalThis.addEventListener("resize",r.onWindowResize),r.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)r.resizeObserver||(r.resizeObserver=new ResizeObserver(r.onElementResize)),r.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[n,s,a]=E.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});s.scrollLeft=s.scrollTop=a.scrollLeft=a.scrollTop=1e6,s.addEventListener("scroll",r.onSizeMonitorScroll,!0),a.addEventListener("scroll",r.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver(l=>{const o=[],d=[];for(const u of l)u.type==="childList"&&(o.push.apply(o,u.addedNodes),d.push.apply(d,u.removedNodes));const c=[...o.filter(u=>!d.includes(u)),...d.filter(u=>!o.includes(u))];c.length!==0&&(c.length>0&&c.every(dM)||s.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))})).observe(e,{childList:!0,subtree:!0}),t.monitorElement=n}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){(e===document||e===globalThis)&&(e=document.body);const r=e._bResizemonitor;let n=0;r&&r.handlers&&(B.remove(r.handlers,t),n=r.handlers.length),n||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const r=t.target,n=r._bResizemonitor,s=t.contentRect||r.getBoundingClientRect();if(Er(r)&&(!n.rectangle||s.width!==n.rectangle.width||s.height!==n.rectangle.height)){const a=n.rectangle;n.rectangle=s;for(const l of n.handlers)l(r,a,s)}}}static onSizeMonitorScroll(e){var t;if(e.target.isConnected||(t=document.body)!=null&&t.contains(e.target)){e.stopImmediatePropagation();const r=e.target.parentNode,n=r.parentNode,s=n._bResizemonitor,a=n.getBoundingClientRect();(!s.rectangle||a.width!==s.rectangle.width||a.height!==s.rectangle.height)&&(Gf.push([n,s.rectangle,a]),s.rectangle=a,Uf||(Uf=requestAnimationFrame(DE.fireResizeEvents))),r.firstChild.scrollLeft=r.firstChild.scrollTop=r.childNodes[1].scrollTop=r.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,r=t._bResizemonitor,n=r.rectangle;r.rectangle=document.documentElement.getBoundingClientRect();for(const s of r.handlers)s(t,n,r.rectangle)}static fireResizeEvents(){for(const e of Gf)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);Uf=null,Gf.length=0}static removeGlobalListeners(){globalThis.removeEventListener("resize",this.onWindowResize)}};Ge._$name="ResizeMonitor";var NC={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:Y.supportsOverflowClip?"clip":"hidden"},BC="b-widget-scroller",Yf={block:"nearest"},cM=Promise.resolve(),zC=i=>new Promise(e=>V.on({element:i===document.documentElement?globalThis:i,scroll:e,once:!0})),uM={x:1},na={auto:1,scroll:1},hM={true:1,auto:1},gM={overflowX:"auto",overflowY:"auto"},fM=i=>{var e,t,r,n;let s,a,l,o;return i?typeof i=="number"?s=a=l=o=i:(s=(e=i.top)!=null?e:0,a=(t=i.bottom)!=null?t:0,l=(r=i.start)!=null?r:0,o=(n=i.end)!=null?n:0):s=a=l=o=0,{top:s,bottom:a,start:l,end:o}},qf={start:"top",end:"bottom"},WC={start:"end",end:"start",top:"bottom",bottom:"top"},At=class eu extends fe(Fe($)){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,behavior:null,x:0,y:0,rtlSource:null,propagateSync:null,stickies:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return!!((e=this.rtlSource)!=null&&e.rtl)}syncOverflowState(){const e=this,{hasOverflowX:t,hasOverflowY:r,element:n}=e,s=e.hasOverflowX=n.scrollWidth>n.clientWidth,a=e.hasOverflowY=n.scrollHeight>n.clientHeight;if(t!==s||r!==a){const l=new te(n.classList,{"b-horizontal-overflow":s,"b-vertical-overflow":a});E.syncClassList(n,l),e.isConfiguring||e.trigger("overflowChange",{x:s,y:a})}}hasOverflow(e="y"){const t=this,r=t[`overflow${e.toUpperCase()}`],n=t[`overflow${e==="y"?"x":"y"}`];if(!E.scrollBarWidth||!hM[r]||n==="hidden-scroll"){const s=e==="y"?"Height":"Width";return t[`scroll${s}`]>t[`client${s}`]}return t[`hasOverflow${e.toUpperCase()}`]}hasScrollbar(e="y"){const{element:t}=this;if(t&&E.scrollBarWidth){const r=e==="y",n=r?"Width":"Height",s=t[`client${n}`],a=parseInt(E.getStyleValue(t,`border${r?"Left":"Top"}Width`))+parseInt(E.getStyleValue(t,`border${r?"Right":"Bottom"}Width`)),l=t[`offset${n}`]-a-s;return Math.abs(l-E.scrollBarWidth)<2}}addPartner(e,t=uM){const r=this;typeof t=="string"&&(t={[t]:1}),r.partners||(r.partners={}),r.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=r.x),t.y&&(e.y=r.y),e.isPartneredWith(r)||e.addPartner(r,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){e&&this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var t;return!!((t=this.partners)!=null&&t[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach(e=>e.scroller.removePartner(this))}async scrollIntoView(e,t=Yf){const r=this,{isRectangle:n}=e,s=n?e:L.from(e),{xDelta:a,yDelta:l}=r.getDeltaTo(e,t),o=r.scrollBy(a,l,t);return(t.highlight||t.focus)&&o.then(()=>{var d,c;e=n?s.translate(-a,-l):(c=(d=t.elementAfterScroll)==null?void 0:d.call(t))!=null?c:e,t.highlight&&(isNaN(t.highlight)?(r.widget||r).callback(t.highlight,null,[e]):E.highlight(e,r)),t.focus&&e.focus({preventScroll:!0})}),o}static async scrollIntoView(e,t=Yf,r=!1){const n=L.from(e),s=typeof t=="object"?t.animate:t,a=eu._globalScroller||(eu._globalScroller=new eu),l=[];a.rtlSource={rtl:r};let o=0,d=0,c;t.maxWidth&&(n.width=Math.min(n.width,t.maxWidth),t.maxWidth=null),t.maxHeight&&(n.height=Math.min(n.height,t.maxHeight),t.maxHeight=null);for(let u=e.parentNode;u.nodeType===Node.ELEMENT_NODE;u=u.parentNode){if(u===document.body&&u!==document.scrollingElement)continue;const h=u===document.scrollingElement?gM:u.ownerDocument.defaultView.getComputedStyle(u),g=Oe.get(u,"scroller");if(t.y!==!1&&(g!=null&&g.hasOverflowY||na[h.overflowY]&&u.scrollHeight>u.clientHeight)||t.x!==!1&&(g!=null&&g.hasOverflowX||na[h.overflowX]&&u.scrollWidth>u.clientWidth)){let f=a;g?f=g:(a.element=u,a.positionDirty=!0);const{xDelta:m,yDelta:p}=f.getDeltaTo(n,t);(m||p)&&(l.push({element:u,x:u.scrollLeft,y:u.scrollTop,xDelta:m,yDelta:p}),n.translate(-m,-p),o+=m,d+=p)}}if(l.length){const u=Math.abs(o),h=Math.abs(d);let g=s&&(typeof s=="number"?s:typeof s.duration=="number"?s.duration:300);if(g&&(u>10||h>10))Math.max(u,h)<50&&(g=Math.min(g,500)),c=a.scrollAnimation=be.animate(g,f=>{const m=f===1;for(const{element:p,x:v,y:b,xDelta:w,yDelta:D}of l)a.element=p,w&&(a.x=Math[r?"min":"max"](v+(m?w:Math.round(w*f)),0)),D&&(a.y=Math.max(b+(m?D:Math.round(D*f)),0))},null,s.easing),c.then(()=>{a.scrollAnimation=null});else if(u>=1||h>=1){for(const{element:f,xDelta:m,yDelta:p}of l)f.scrollTop+=p,f.scrollLeft+=m;c=zC(l[l.length-1].element)}}return(t.highlight||t.focus)&&(await c,t.highlight&&(isNaN(t.highlight)?a.callback(t.highlight,null,[e]):E.highlight(e,a)),t.focus&&e.focus({preventScroll:!0})),c}scrollBy(e=0,t=0,r=Yf){const n=this,s=typeof r=="object"?r.animate:r,a=Math.abs(e),l=Math.abs(t);n.scrollAnimation&&(n.scrollAnimation.cancel(),n.scrollAnimation=null),(e||t)&&(n.silent=r.silent);let o=s&&(typeof s=="number"?s:typeof s.duration=="number"?s.duration:300);if(o&&(a>10||l>10)){const{x:d,y:c}=n;let u=d,h=c;return Math.max(a,l)<50&&(o=Math.min(o,500)),n.scrollAnimation=be.animate(o,g=>{var f,m;const p=g===1;if(e){if(Math.abs(n.x-u)>1&&!r.force)return(f=n.scrollAnimation)==null?void 0:f.cancel();n.x=Math.max(d+(p?e:Math.round(e*g)),0)}if(t){if(Math.abs(n.y-h)>1&&!r.force)return(m=n.scrollAnimation)==null?void 0:m.cancel();n.y=Math.max(c+(p?t:Math.round(t*g)),0)}u=n.x,h=n.y},n,s.easing),n.element.classList.add("b-scrolling"),n.scrollAnimation.then(()=>{n.isDestroyed||(n.element.classList.remove("b-scrolling"),n.scrollAnimation=null)}),n.scrollAnimation}else{if(e||t){const d=n.x,c=n.y;if(Math.round(a)>=1&&(n.x+=e),Math.round(l)>=1&&(n.y+=t),n.x!==d||n.y!==c)return zC(n.element)}return cM}}async scrollTo(e,t,r){const{x:n,y:s}=this,a=e==null?0:e-n,l=t==null?0:t-s;return this.scrollingToCenter=r==null?void 0:r.scrollingToCenter,this.scrollBy(a,l,r)}doDestroy(){var e,t;const r=this;r._element&&(r._element.removeEventListener("scroll",r.scrollHandler),(e=r.wheelListenerRemover)==null||e.call(r),r._contentElement&&Ge.removeResizeListener(r.contentElement,r.resizeHandler),Ge.removeResizeListener(r._element,r.resizeHandler)),(t=r.scrollAnimation)==null||t.cancel(),Object.values(r.partners||{}).forEach(({scroller:n})=>n.removePartner(r)),super.doDestroy()}onElMutation(e){const t=this,[r,n]=E.getTranslateXY(t.element);if(t._x!==-r||t.y!==-n){const s=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(s,"target",{get:()=>t.element}),t.onScroll(s)}}onElResize(){const e=this,{widget:t}=e;t!=null&&t.isAnimating?t.findListener("animationend","onElResize",e)===-1&&t.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){var t;const r=this,{element:n}=r;(t=r.widget)!=null&&t.isDestroyed||(r.positionDirty=!0,n.classList.contains("b-scrolling")||n.classList.add("b-scrolling"),e.widget=r.widget,e.scrollingToCenter=r.scrollingToCenter,r.silent||r.trigger("scroll",e),r.syncPartners(),r.controllingPartner=null,r.onScrollEnd(e))}syncPartners(e,t=this.propagateSync){const r=this;r.partners&&Object.values(r.partners).forEach(({axes:n,scroller:s})=>{(s!==r.controllingPartner||e)&&s.sync(r,n)&&t&&s.syncPartners(e,t)})}onScrollEnd(e){const t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.scrollingToCenter=!1,t.controllingPartner=null,t.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const r=this;if(!r.viewport)return{xDelta:0,yDelta:0};const{x:n,y:s,scrollWidth:a,scrollHeight:l,isRTL:o}=r,d=e instanceof L?e:L.from(e),c=t.block||"nearest",u=r.viewport,h=fM(t.edgeOffset);t.maxWidth&&(d.x<u.x?(d.x=d.right-t.maxWidth,h.start=0):(d.width=Math.min(d.width,t.maxWidth),h.end=0)),t.maxHeight&&(d.y<u.y?(d.y=d.bottom-t.maxHeight,h.top=0):(d.height=Math.min(d.height,t.maxHeight),h.bottom=0));const g=c==="start"||c==="end",f=g?{[c]:h[c],[WC[c]]:0}:u.width>=d.width+(h.start+h.end)?h:{start:0,end:0},m=g?{[qf[c]]:h[qf[c]],[WC[qf[c]]]:0}:u.height>=d.height+(h.top+h.bottom)?h:{top:0,bottom:0},p=new L(o?u.right+n-a:u.x-n,u.y-s,a,l),v=d.clone().adjust(-f.start,-m.top,f.end,m.bottom,!0).constrainTo(p),b=v.clone(),w=r.isRTL?-1:1;let D=0,S=0;if(c==="start")b.moveTo(u.x+(r.isRTL?u.width-b.width:0),u.y),D=v.x-b.x,S=v.y-b.y;else if(c==="end")b.moveTo(u.x+(r.isRTL?0:u.width-b.width),u.bottom-b.height),D=v.x-b.x,S=v.y-b.y;else if(c==="center"){const x=u.center;b.moveTo(x.x-b.width/2,x.y-b.height/2),D=D||v.x-b.x,S=S||v.y-b.y}else b.width>u.width?D=b.x-u.x:b.right>u.right?D=b.right-u.right:b.x<u.x&&(D=b.x-u.x),b.height>u.height?S=b.y-u.y:b.bottom>u.bottom?S=b.bottom-u.bottom:b.y<u.y&&(S=b.y-u.y);return D=w*Math.round(D),S=Math.round(S),t.constrainToScrollable!==!1&&(D=Math.max(Math.min(D,Math.max(r.maxX-n,0)),-n),S=Math.max(Math.min(S,Math.max(r.maxY-s,0)),-s)),{xDelta:t.x===!1?0:D,yDelta:t.y===!1?0:S}}get viewport(){const e=this.stickies?B.asArray(this.stickies).flatMap(r=>typeof r=="string"?Array.from(this.element.querySelectorAll(r)):r):null,t=L.client(this.element);return e?t.exclude(e.map(r=>L.from(r))):t}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,t){var r;const n=this;if(n===eu._globalScroller){n._element=e,n.positionDirty=!0;return}const s=n.scrollHandler||(n.scrollHandler=n.onScroll.bind(n)),a=n.resizeHandler||(n.resizeHandler=n.onElResize.bind(n));if(t&&(Oe.remove(t,"scroller"),n.translate?(r=n.mutationObserver)==null||r.disconnect():(t.removeEventListener("scroll",s),t.classList.remove(BC),t.style.overflowX=t.style.overflowY=""),Ge.removeResizeListener(t,a)),e){if(Oe.set(e,"scroller",n),n.translate){if(n.mutationObserver||(n.mutationObserver=new MutationObserver(n.mutationHandler||(n.mutationHandler=n.onElMutation.bind(n)))),n._x=n._y=0,document.contains(e)){const[l,o]=E.getTranslateXY(e);n._x=-l,n._y=-o}n.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",s),e.classList.add(BC);Ge.addResizeListener(e,a),n.widget||(n.rtlSource={get rtl(){return E.getStyleValue(e,"direction")==="rtl"}}),n.isRTL&&e.classList.add("b-rtl"),n.positionDirty&&(n.updateOverflowX(n.overflowX),n.updateOverflowY(n.overflowY)),n.syncOverflowState(),n.isConfiguring&&(n._x&&n.updateX(n._x),n._y&&n.updateY(n._y))}n.positionDirty=!0}get unsynced(){const e=this,[t,r]=e.xy;return e._x!==t||e._y!==r}get xy(){const{element:e}=this;let t,r;return e&&(this.translate?([t,r]=E.getTranslateXY(e),t=-t,r=-r):(t=Math.abs(e.scrollLeft),r=e.scrollTop)),[t,r]}refreshPosition(){const e=this,[t,r]=e.xy;e._x=t,e._y=r,e.positionDirty=!1}fixPositionSync(){const e=this,{element:t,xy:r,_x:n,_y:s}=e;!e.positionDirty&&!(n===r[0]&&s===r[1])&&(e.translate?(E.setTranslateX(t,-n),E.setTranslateY(t,-s)):t.scrollTo({behavior:"instant",left:e.isRTL?-n:n,top:s}))}get x(){return this.positionDirty&&this.refreshPosition(),this._x}get scrollLeft(){return this.x*(this.isRTL?-1:1)}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e=typeof e=="string"?this.element.querySelector(e):e,Ge.addResizeListener(e,this.resizeHandler))}updateX(e){var t;const r=this,{behavior:n,element:s}=r;s&&!((t=r.widget)!=null&&t.isConfiguring)&&(e=Math.round(e),r.trigger("scrollStart",{x:e}),r.translate?E.setTranslateX(s,-e):n?s.scrollTo({behavior:n,left:r.isRTL?-e:e}):s.scrollLeft=r.isRTL?-e:e),r.positionDirty=!0}sync(e,t){const r=this,{x:n,y:s}=t;let a=!1;return n&&r.x!==e.x&&(r.controllingPartner=e,r.x=e.x,a=!0),s&&r.y!==e.y&&(r.controllingPartner=e,r.y=e.y,a=!0),a}get y(){return this.positionDirty&&this.refreshPosition(),this._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const t=this,{behavior:r,element:n,widget:s}=t;n&&!(s!=null&&s.isConfiguring)&&(t.trigger("scrollStart",{y:e}),t.translate?E.setTranslateY(n,-e):r?n.scrollTo({behavior:r,top:e}):n.scrollTop=e),t.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,t){const r=this,{element:n,translate:s}=r,{style:a,classList:l}=n;t==="hidden-scroll"&&l.remove("b-hide-scroll"),e==="hidden-scroll"&&!s&&(na[r.overflowY]?(e="hidden",r.enableWheel()):l.add("b-hide-scroll")),s||(a.overflowX=NC[e]||e),r.isConfiguring||(r.positionDirty=!0,r.syncOverflowState())}updateOverflowY(e,t){const r=this,{element:n,translate:s}=r,{style:a,classList:l}=n;t==="hidden-scroll"&&l.remove("b-hide-scroll"),e==="hidden-scroll"&&!s&&(na[r.overflowX]?(e="hidden",r.enableWheel()):l.add("b-hide-scroll")),s||(a.overflowY=NC[e]||e),r.isConfiguring||(r.positionDirty=!0,r.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=V.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){const t=this,{overflowX:r,overflowY:n}=t,s=e.deltaX,a=e.deltaY,l=Math.abs(s)-Math.abs(a);r==="hidden-scroll"&&na[n]&&l>0?t.x+=s:n==="hidden-scroll"&&na[r]&&l<0&&(t.y+=a)}get scrollWidth(){var e,t;return(t=(e=this.element)==null?void 0:e.scrollWidth)!=null?t:0}set scrollWidth(e){const t=this,{element:r,isRTL:n}=t;let s=t.widthStretcher;s&&e==null?(s.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),s||(s=t.widthStretcher=E.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",role:null,retainElement:!0})),s.style.transform=`translateX(${(e-1)*(n?-1:1)}px)`,r&&!r.contains(s)&&r.insertBefore(s,r.firstElementChild)),r.style.setProperty("--scroll-width",E.setLength(e)),t.propagate!==!1&&t.eachPartner(({scroller:a})=>{a.propagate=!1,a.scrollWidth=e,delete a.propagate}),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){var e,t;return(t=(e=this.element)==null?void 0:e.scrollHeight)!=null?t:0}set scrollHeight(e){const t=this,r=t.stretcher||(t.stretcher=E.createElement({className:"b-scroller-stretcher",role:null}));r.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==r&&t.element.appendChild(r),t.positionDirty=!0,t.syncOverflowState()}get clientWidth(){var e;return((e=this.element)==null?void 0:e.clientWidth)||0}get clientHeight(){var e;return((e=this.element)==null?void 0:e.clientHeight)||0}get id(){return this._id||(this._id=Si.generateId(this.widget?`${this.widget.id}-`:"scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}};At._$name="Scroller";var mM=/\/[^/]+\//,jC={},UC=i=>{var e;return e=class extends(i||$){get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}addKeyBinding(t,r){const n=this.keyMap,s=this.mergeKeyMaps({[t]:n==null?void 0:n[t]},{[t]:r})[t];n?n[t]=s:this.keyMap={[t]:s}}removeKeyBinding(t,r){var n;const s=(n=this.keyMap)==null?void 0:n[t];if(s){let a=0;Array.isArray(s)?(a=s.findIndex(l=>l===r||l.handler===r),a>-1&&s.splice(a,1)):(s===r||s.handler===r)&&delete this.keyMap[t]}}matchKeyMapEntry(t,r=this.keyMap){const{input:n}=this,{altKey:s,ctrlKey:a,metaKey:l,shiftKey:o,target:d}=t;if(t.key.length===1&&!(s||a||l||o)&&!(n&&t.composedPath().includes(n))&&E.isEditable(d,!0))return!0;if(r&&!t.handled&&t.key!==void 0)return T.keys(r).find(c=>{const u=c==="+"?[]:c.toLowerCase().split("+"),h=c.endsWith("+")?"+":u.pop(),g=h==="space"?" ":h,f=u.includes("alt"),m=u.includes("ctrl"),p=u.includes("meta"),v=u.includes("shift"),b=mM.test(g)&&(jC[g]||(jC[g]=new RegExp(g.substring(1,g.length-1))));return(b?b.test(t.key.toLowerCase()):g===t.key.toLowerCase())&&(f?s:!s)&&(m?a:!a)&&(p?l:!l)&&(v?o:!o)})}async performKeyMapAction(t){var r,n,s;const a=this,{keyMap:l}=a;let o=!1,d,c,u,h;if(l&&!t.handled&&t.key!==void 0){const g=a.matchKeyMapEntry(t);if(l[g]){const f=B.asArray(l[g]);t.fromKeyMap=!0,t.widget=this;for(d of f){if(h=!0,T.isObject(d)){if(!d.handler)continue;d.preventDefault===!1&&(h=!1),d=d.handler}if(typeof d=="string"){const{thisObj:m,handler:p}=a.resolveKeyMapAction(d);if(((r=m.isActionAvailable)==null?void 0:r.call(m,{key:g,action:d,event:t,actionName:d.split(".").pop()}))!==!1){let v=p.call(m,t);if(T.isPromise(v)&&(v=await v),v!==!1){o=!0;break}}}else if(d.call(a,t)!==!1){o=!0;break}}o&&(h&&t.preventDefault(),t.handled=!0)}if(!o){if(u=T.getTruthyKeys(l.delegate)){for(c of u)if(c=T.getPath(a,c),o=(n=c==null?void 0:c.performKeyMapAction)==null?void 0:n.call(c,t),T.isPromise(o)&&(o=await o),o)break}o||(s=a.defaultKeyHandler)==null||s.call(a,t)}}return o}resolveKeyMapAction(t){const r=this,{keyMapSubComponents:n}=r;if(t.startsWith("up.")||t.startsWith("this."))return r.resolveCallback(t);if(n&&t.includes(".")){const[s,a]=t.split(".");if(s&&a)return{thisObj:n[s],handler:n[s][a]}}return{thisObj:r,handler:r[t]}}updateKeyMap(t){var r;const n=this,s=T.keys(t);(r=n.keyMapDetacher)==null||r.call(n),n.keyMapDetacher=(s.length||null)&&V.on({element:n.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:n})}keyMapOnKeyDown(t){this.performKeyMapAction(t)}mergeKeyMaps(t,r,n=null){const s={};t&&T.assign(s,t);for(const a in r){if(!r[a])continue;const l=B.asArray(t==null?void 0:t[a]),o=[];if(l!=null&&l.length&&o.push(...l),!(l!=null&&l.some(d=>{const c=d.handler?d.handler:d;return typeof c=="string"&&c.startsWith(n+".")}))){for(const d of B.asArray(r[a]))T.isObject(d)&&d.handler?o.push(T.assignIf({handler:(n?n+".":"")+d.handler},d)):typeof d=="function"?o.push(d):o.push((n?n+".":"")+d);o.sort((d,c)=>{const u=(d.weight||0)-(c.weight||0);return u===0&&(l!=null&&l.length)?l.indexOf(d)-l.indexOf(c):u})}s[a]=o}return s}},y(e,"$name","KeyMap"),y(e,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),e},GC=i=>{var e;return e=class extends(i||$){get widgetClass(){}get isRTL(){return this.rtl}updateRtl(t){const{element:r}=this;r&&(r.classList.toggle("b-rtl",t===!0),r.classList.toggle("b-ltr",t===!1))}startConfigure(t){var r,n;if((r=super.startConfigure)==null||r.call(this,arguments),!t.floating&&t.rtl==null){const s=this,a=t.rootElement||t.forElement||((n=s.parent)==null?void 0:n.contentElement)||(s.floating?s.floatRoot:s.changeElementRef(s.getRenderContext(t)[0]||t.adopt));if(a)t.rtl=a.nodeType===1&&getComputedStyle(a).getPropertyValue("direction")==="rtl";else{const l=t.owner||t.parent;l?t.rtl=l[l.isConfiguring?"peekConfig":"getConfig"]("rtl"):t.rtl=getComputedStyle(document.body).getPropertyValue("direction")==="rtl"}t.rtl&&(s.configDone.rtl=!1)}}render(...t){var r,n,s;(r=super.render)==null||r.call(this,...t),(Y.isChrome&&Y.chromeVersion<87||Y.isFirefox&&Y.firefoxVersion<66||Y.isSafari&&Y.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),(getComputedStyle(this.element).direction==="rtl"||(n=this.owner)!=null&&n.rtl)&&(this.rtl=!0,(s=this.childItems)==null||s.forEach(a=>a.rtl=!0))}},y(e,"$name","RTL"),y(e,"configurable",{rtl:null}),e},YC=Object.freeze({highlight:!1,onlyName:!1}),qC=Object.freeze([]),pM=Object.freeze({sync:!1}),$u=[],vM=["clip","display","opacity"],Kf="highlightExternalChange",Xf=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Hu=Symbol("renderConfigObserver"),yM=/<div|<button|<input|<p|<br|<li/,KC=(i,e,t,r)=>{let n=(t==null?void 0:t.listeners)||(t==null?void 0:t.internalListeners);if(n=(n==null?void 0:n.on)||n,n){const s=V.on(T.assign({element:e,thisObj:i},n));r?(i._refListeners||(i._refListeners=Object.create(null)))[r]=s:t.listeners={on:n,un:s}}},XC=(i,e)=>i&&e&&e[T.keys(i)[0]]?Re.merge(i,e):i,bM=i=>{i.isVisible&&i.triggerPaint()},CM=/^:not\((.+)\)$/,wM=/absolute|fixed/i,SM=i=>i.scale!=null,{hasOwn:Tn}=T,{defineProperty:ZC}=Reflect,JC=i=>parseFloat(i)*(i.endsWith("ms")?1:1e3),QC=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],DM={configurable:!0,value:!1},EM=/(?:L\{([ \w.]+?)\})/,ew=/^([trblc])(\d*)-([trblc])(\d*)$/i,xM=(i,e)=>(ew.test(i)&&(i={align:i}),ew.test(e)&&(e={align:e}),Re.merge(i,e)),RM=/^[\w.]+$/,tw={1:"maxHeight",2:"height",4:"maxWidth",8:"width"},TM=i=>!i.isRipple&&!i.closest(e=>e.isMessageDialog||e.isSharedTooltip),Zf=i=>E.getStyleValue(i,"display")==="contents"?Zf(i.parentNode):i,MM=i=>{if(i!=null&&i.target){const{ownerSVGElement:e}=i.target,t=e==null?void 0:e.getBoundingClientRect();if(e)return{target:i.target.ownerSVGElement,offsetX:i.clientX-t.x,offsetY:i.clientY-t.y};let{offsetX:r,offsetY:n}=i,s=Zf(i.target);if(E.getStyleValue(i.target,"display")==="contents"){const a=s.getBoundingClientRect(s);r-=a.x,n-=a.y}return{target:Zf(i.target),offsetX:r,offsetY:n}}},Vu=class ge extends $.mixin(Nt,Fe,fe,Oo,ii,UC,GC){static mergeCls(e,t){return t&&e?e=new te(t).assign(typeof e=="string"?new te(e):e):e&&!e.isDomClassList&&(e=new te(e)),e}static get configurable(){return{element:!0,callOnFunctions:!0,hideMode:{$config:null,default:"display"},id:null,html:{$config:"lazy",value:null},content:{$config:"lazy",value:null},cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},floating:null,positionable:null,positioned:null,draggable:{$config:["lazy","nullify"],value:null},align:{$config:{merge:xM},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:{$config:["lazy","nullify"],value:null},scrollAction:null,hideAnimation:{$config:{merge:XC},value:null},showAnimation:{$config:{merge:XC},value:null},top:null,right:null,bottom:null,left:null,x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:At,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription","dataset.text"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:{lazy:!0,default:null},value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaLive:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50},maximizeOnMobile:null,twinForwardEvents:{$config:{merge:"classList"},value:null},twinSyncConfigs:{$config:{merge:"classList"},value:["disabled"]}}}static get prototypeProperties(){return{hasGeneratedId:!1,hasPainted:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return ge._recomposeAsync}static set recomposeAsync(e){if(ge._recomposeAsync=e,e!=null){const{all:t}=ge;for(let r=0;r<t.length;++r)t[r].isComposable&&(t[r].recomposeAsync=e)}}updateWeight(){var e,t;this.isPainted&&((t=(e=this.parent)==null?void 0:e.onChildWeightChange)==null||t.call(e,this))}isA(e){return this.isType(e,!0)}isType(e,t){return ge.isType(this,e,t)}static setupRenderConfigs(e,t){const r=t.getInherited("renderConfigs"),{renderConfigs:n}=e;if(n){if(Array.isArray(n))for(const s of n)r[s]=!0;else T.assign(r,n);r[Hu]=null}}static weightSortFn({weight:e},{weight:t}){return typeof e=="string"||typeof t=="string"?String(e).localeCompare(String(t)):(e!=null?e:Number.MAX_SAFE_INTEGER)-(t!=null?t:Number.MAX_SAFE_INTEGER)}construct(e={},...t){const r=this,{domSyncCallback:n}=r,{recomposeAsync:s}=ge;if(s!=null&&r.recomposeAsync==null&&(r.recomposeAsync=s),!globalThis.bryntum.cssVersion){const a=globalThis.bryntum.cssVersion=xn.getCSSVersion(),l=re.getVersion("core");a&&a!==l&&console.warn(`CSS version ${a} doesn't match bundle version ${l}!
Make sure you have imported css from the appropriate product version.`)}r.configureAriaDescription=e.ariaDescription,r._isAnimatingCounter=0,r.alignmentChanges=0,r.byRef=Object.create(null),r.onTargetResize=r.onTargetResize.bind(r),r.onFullscreenChange=r.onFullscreenChange.bind(r),r.domSyncCallback=n.$nullFn?null:n.bind(r),r._isUserAction=!1,super.construct(e,...t),r.finalizeInit()}startConfigure(e){super.startConfigure(e),this.getConfig("element")}finalizeInit(){var e;const t=this,{adopt:r}=t,n=t.insertBefore||t.appendTo||t.insertFirst||r,{classList:s}=t.element;t.getConfig("html","content"),n&&(r&&(s.remove("b-hidden"),t._hidden=!1),t.owner||(e=n.nodeType?n:document.getElementById(n))!=null&&e.isConnected?t.render():(t.onFirstResizeAfterConnect=t.onFirstResizeAfterConnect.bind(t),Ge.addResizeListener(n,t.onFirstResizeAfterConnect))),s.remove("b-initializing")}onFirstResizeAfterConnect(e){Ge.removeResizeListener(e,this.onFirstResizeAfterConnect),!this.isDestroyed&&!this.rendered&&this.render()}doDestroy(){var e,t,r;const n=this,{preExistingElements:s,element:a,adopt:l,_refListeners:o,_rootElement:d,eventRoot:c,ownedWidgets:u,parent:h}=n;if(n.updateOwner(null,n.owner),Et.element===a&&Et.exit(),o&&(Object.values(o,g=>g()),n._refListeners=null),a){const g=!n._tooltip&&d&&((e=ge.Tooltip)==null?void 0:e.getSharedTooltip(d,c,!0));if((g==null?void 0:g.owner)===n&&(g.owner=null,g.hide()),n.onExitFullscreen(),n.clearTimeout("scrollListenerTimeout"),n.clearTimeout("resizeListenerTimeout"),n.removeTransientListeners(),n.floating||n.positioned||n.positionable?n.isPainted&&n.hide(!1):n.revertFocus(),Ge.removeResizeListener(a.parentElement,n.onParentElementResize),Ge.removeResizeListener(a,n.onElementResize),l){for(let f=Array.from(a.childNodes),m=0,{length:p}=f;m<p;m++){const v=f[m];!s.includes(v)&&v!==n.floatRoot&&v.remove()}a.className=n.adoptedElementClassName,a.style.cssText=n.adoptedElementCssText}}(t=n.connectedObserver)==null||t.disconnect(),h!=null&&h.isContainer&&!h.isDestroying&&((r=h._items)!=null&&r.includes(n))&&h.remove(n),super.doDestroy(),u&&Object.values(u).forEach(g=>{var f;return(f=g.destroy)==null?void 0:f.call(g)}),c&&Promise.resolve().then(()=>{Object.values(ge.identifiable.idMap).some(TM)||le.detachFocusListeners(c)}),l||a.remove()}get assignValueDefaults(){return YC}get valueName(){return this.name||this.ref||this.id}getValueName(e){return e=e&&typeof e=="object"?e.onlyName:e,e?this.name:this.valueName}assignFieldValue(e,t,r){const n=this,s=n.defaultBindProperty;s in n&&(n[s]=r)}assignValue(e,t=YC){const r=this,n=r[Kf],s=r.getValueName(t);s&&(!e||s in e)&&(t.highlight===!1&&(r[Kf]=!1),r.assignFieldValue(e,s,e?e[s]:null),r[Kf]=n)}gatherValue(e){const t=this,r=t.defaultBindProperty;t.constructor!==ge&&r in t&&(e[t.name||t.ref||t.id]=t[r])}gatherValues(e){this.eachWidget(t=>t.gatherValue(e),!1)}addToOverflowMenu(e,t,r){const n=this.ensureOverflowTwin(t,r);return e.items.push(n),n}get twinForwardEventPairs(){const e=this._twinForwardEvents;return e?T.entries(e):qC}configureOverflowTwin(e){const t=this,{twinSyncConfigs:r}=t;let n=T.clone(t.initialConfig),s,a;if(delete n.id,delete n.listeners,delete n.internalListeners,delete n.parent,n.hidden=!1,n.type=t.type,n._overflowTwinOrigin=t,n.owner=t.owner,t.twinForwardEventPairs.forEach(([l])=>{delete n[`on${O.capitalize(l)}`]}),r)for(s in r)a=r[s],a&&(delete n[s],n[typeof a=="string"?a:s]=t[s]);return e&&(n=typeof e=="function"?e(n)||n:T.assign(n,e)),n}createOverflowTwin(e){const t=this,r=t.configureOverflowTwin(e),n=ge.create(r),{twinSyncConfigs:s}=t;return s&&t.bindConfigs(n,s,pM),t.twinForwardEventPairs.forEach(([a,l])=>{n.ion({[a]:o=>{t.overflowTwin===o.source&&(o=T.assign({},o),delete o.source,t.trigger(typeof l=="string"?l:o.eventName,o))}})}),n}ensureOverflowTwin(e,t){let{overflowTwin:r}=this;return r||(this.overflowTwin=r=this.createOverflowTwin(e),t==null||t(r)),r}get isComposable(){return!this.compose.$nullFn}adoptElement(e){const t=this,r=typeof e=="string"?document.getElementById(e):e,n=ge.fromElement(r);return n&&n.adopt&&n!==t&&(typeof n.adopt=="string"?document.getElementById(n.adopt):n.adopt)===r&&n.destroy(),t.preExistingElements=Array.from(r.childNodes),t.adoptedElementClassName=r.className,t.adoptedElementCssText=r.style.cssText,r.lastDomConfig=null,r.$refOwnerId=t.id,r.className=r.style.cssText="",r}addRefAccessor(e,t){const{prototype:r}=this.constructor;ZC(r,t,{writable:!0,value:null}),ZC(r,e,{get(){return this.recompose.flush(),this[t]},set(n){this[t]=n}})}attachRef(e,t,r){const n=this,s="_"+e;t.dataset&&(t.dataset.ownerCmp=n.id),n.isComposable&&(s in n||n.addRefAccessor(e,s),KC(n,t,r,e)),n.byRef[e]=t,n[e]=t}detachRef(e,t,r){const n=this,s=n._refListeners;s!=null&&s[e]&&(s[e](),delete s[e]),n[e]=null,delete n.byRef[e]}afterRecompose(){}compose(){const{widgetClassList:e}=this;return{class:{...te.normalize(e,"object")}}}doCompose(){const e=this,{$meta:t}=e,r=t.hierarchy,n=t.renderConfigs||t.getInherited("renderConfigs");let{composers:s}=t,a=null,l,o,d,c;if(e.recompose.suspend(),!s){for(t.composers=s=[],d=r.indexOf(ge);d<r.length;++d)c=r[d].prototype,Tn(c,"compose")&&s.push(c);Tn(n,Hu)||(n[Hu]={get(u){u!=="element"&&(n[u]=!0)}})}for(e.configObserver=n[Hu],d=0;d<s.length;++d)l=s[d].compose.call(e,a),a=a?E.merge(a,l):l;return Tn(e,"compose")&&E.merge(a,e.compose(a)),e.configObserver=null,E.normalizeChildren(a,(u,h)=>{h&&(o="_"+u,o in e||e.addRefAccessor(u,o))})}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const t=this,r=t.isComposable,{adopt:n}=t;return t.id=t.id||(n==null?void 0:n.id)||null,n?e=t.adoptElement(n):r&&(e=t.doCompose()),typeof e=="string"?e=E.createElementFromTemplate(e):T.isObject(e)?(e=E.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume()):E.isReactElement(t.peekConfig("html"))||E.isVueConfig(t.peekConfig("html"))?e=document.createElement("div"):e.nodeType!==1&&(e=E.createElementFromTemplate(t.template(t))),!e.id&&(e.id=t.id),t.elementAttributes&&E.setAttributes(e,t.elementAttributes),e}updateElement(e){const t=this,r=t.isComposable;t.adopt&&(t._hidden=!0,r&&t.recomposeNow()),r&&KC(t,e,e.lastDomConfig);const{className:n}=e,{contentElement:s,contentElementCls:a,isComposable:l}=t,o=s!==e,d=!l&&e.querySelectorAll("[data-reference]"),c=l?[]:t.widgetClassList;let u=(o||!l)&&t.uiClasses;if(n&&c.unshift(n),t._hidden&&c.push("b-hidden",`b-hide-mode-${t.hideMode}`),t._readOnly&&c.push("b-readonly"),c.push("b-initializing"),be.noThrow(e,"remove"),u?(a!=null&&a.value&&(u=u.slice(),u.push(a.value)),u=u.join(" ")):u=a==null?void 0:a.value,u&&(o?s.className+=" "+u:c.push(u)),!t.parent){const{defaultCls:h}=t,{outerCls:g}=ge;c.push(...h?g.filter(f=>!(f in h)||h[f]):g)}if(e.className=c.join(" "),d)for(let h,g=0;g<d.length;++g)h=d[g],t.attachRef(h.getAttribute("data-reference"),h),h.removeAttribute("data-reference");t.scaleToFitWidth||t.getConfig("monitorResize"),t.getConfig("role","ariaLabel","ariaDescription"),t._html&&t.getConfig("htmlMutationObserver"),t.owner&&!t._owner&&t.updateOwner(t.owner),E.isVueConfig(t._html)&&E.handleVueContent(t,t.html),t.trigger("elementCreated",{element:e})}localizeText(e){return e.match(EM)?this.L(e,this):e}updateAriaDescription(e){const t=this,{ariaElement:r}=t,n=`${t.id}-aria-desc-el`;if(e){const s=t._ariaDescEl||(t._ariaDescEl=E.createElement({className:"b-aria-desc-element",id:n,parent:r}));s.innerText=t.localizeText(e),E.addAttributeValue(r,"aria-describedBy",n)}else E.removeAttributeValue(r,"aria-describedBy",n)}updateAriaLabel(e=""){const t=this.labelledElement||this.ariaElement;t&&E.setAttributes(t,{"aria-label":e?this.localizeText(e):null})}updateAriaHasPopup(e){var t,r;e?(t=this.ariaElement)==null||t.setAttribute("aria-haspopup",e):(r=this.ariaElement)==null||r.removeAttribute("aria-haspopup")}updateAriaLive(e){E.setAttributes(this.ariaElement,{"aria-live":e})}updateRole(e){var t,r;e?(t=this.ariaElement)==null||t.setAttribute("role",e):(r=this.ariaElement)==null||r.removeAttribute("role")}get ownersRole(){var e;let{role:t}=this;return t==="presentation"&&(t=(e=this.query(r=>r.role!=="presentation"))==null?void 0:e.role),t}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:T.getPath(this,e)}isCollapsified({collapsed:e,alt:t}){const{collapsify:r}=this,n=r==="hide",s=r===!1,a=r==null;return t?r==="overlay"||a&&e:s||n||a&&!e}async recompose(){return this.recomposeInternal()}async recomposeInternal(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await E.transition(T.assign({element:e.element,action(){oe.sync(t)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else oe.sync(t);t.changed&&(e.afterRecompose(),e.trigger("recompose")),e.resumeRecompose()}resumeRecompose(){this.recompose.resume()}changeElementRef(e){if(typeof e=="string"){const t=e;if(!(e=document.getElementById(t)))throw new Error(`No element found with id '${t}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,t){let r=t||e.appendTo,{insertFirst:n,insertBefore:s}=e;return n&&(r=n,s=r.firstChild),s&&(r=s.parentElement),[r,s||void 0]}render(e,t=!0){var r;const n=this,{element:s}=n,[a,l]=n.getRenderContext(n,e);n.emptyCache(),n.syncElement&&n.currentElement?E.sync(s,n.currentElement):(a==null||a.insertBefore(s,l),n.currentElement=s),(r=s.parentElement)!=null&&r.closest(".b-widget")&&s.classList.remove(...ge.outerCls),super.render(a,t),n.rendered=!0,n.getConfig("role"),t&&(n.getConfig("contentRange"),n.triggerPaint()),n.setupFocusListeners()}template({tag:e,html:t,htmlCls:r,name:n}){const s=this;typeof t=="string"&&RM.test(t)&&s.resolveCallback(t,s,!1)&&(t=s.callback(t,s,[s]));const a=t!=null&&t.call?t.call(s,s):t;return`<${e} class="${a?r:""}" ${n?`data-name="${n}"`:""}>${a||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&((t=this.$meta.renderConfigs)!=null&&t[e])&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,t){return e==="style"?this._style:super.getConfigValue(e,t)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return(e==null?void 0:e.depth)>0&&(t.type=this.type),t}get dataset(){var e;return((e=this.element)==null?void 0:e.dataset)||qC}changeDataset(e){T.assign(this.dataset,e)}updateParent(e){const{_element:t}=this;t&&t.classList[e?"remove":"add"](...ge.outerCls)}get constrainTo(){let e=this._constrainTo;if(e=e===void 0?globalThis:(e==null?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?e.host||e.ownerDocument:e,this.positioned){const{offsetParent:t}=this.element;if(t&&E.getStyleValue(t,"overflow")==="hidden")e=L.from(t).moveTo(0,0);else if(e&&!e.isRectangle){const r=e===document||e===globalThis;e=L.from(e,t),r&&e.translate(globalThis.pageXOffset,globalThis.pageYOffset)}}return e}updateCentered(e){const t=this,{element:r,_anchorElement:n}=t;if(e&&!t.floating&&!t.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(r.classList.add("b-centered"),r.style.transform=r.style.left=r.style.insetInlineStart=r.style.right=r.style.top="",n==null||n.classList.add("b-hide-display"),r.classList.remove("b-anchored")):r.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,t=e._contentRange||(e._contentRange=new Range);return t.collapsed&&(e.initializingHtml&&e.adopt?t.setStart(e.contentElement,0):t.selectNodeContents(e.contentElement)),t}fixRefOwnerId(e,t,r){if(e.$refOwnerId===r){e.$refOwnerId=t;for(let{childNodes:n}=e,s=n.length;s-- >0;)this.fixRefOwnerId(n[s],t,r)}}get placement(){var e;const t=this,{element:r}=t;let n,s,a;if(r!=null&&r.offsetParent&&!wM.test(E.getStyleValue(r,"position"))){const l=r.nextElementSibling,o=r.previousElementSibling,d=!l&&o;s=E.getStyleValue(r.parentElement,"flex-direction"),s?s=s.startsWith("row")?"h":"v":(n=(e=l||o)==null?void 0:e.getBoundingClientRect(),a=n&&r.getBoundingClientRect(),s=n&&Math.abs(n.top-a.top)<Math.abs(n.left-a.left)?"h":"v"),s+=s==="h"?d?"r":"l":d?"b":"t"}return s}updateId(e,t){if(super.updateId(e,t),t){const{byRef:r,element:n}=this;for(const s in r)r[s].dataset&&(r[s].dataset.ownerCmp=e);n.id=e,this.fixRefOwnerId(n,e,t)}}get style(){const{element:e}=this;return(e==null?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&E.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var t,r;const n=this,{lastAlignSpec:s,element:a}=n,{offsetParent:l,style:o,classList:d}=a;if(s&&(s.monitorIntersection&&n.intersectionObserver.unobserve(s.target),isFinite(s.zone)&&a.classList.remove(QC[s.zone])),!e){n.removeTransientListeners(),n.anchor=n.lastAlignSpec=null;return}n.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||e.$$name==="Point")&&(e={target:e}),n.releaseSizeConstraints();const{scrollable:c,constrainTo:u}=n,h=E.measureSize(E.getStyleValue(a,"minHeight"),a),g=E.measureSize(E.getStyleValue(a,"minWidth"),a),f=n.positioned&&E.getStyleValue(a,"position")!=="fixed",m=n.scale||1,p=e.target,v=e.realignEvent||MM(e.domEvent||e.event||(((t=p==null?void 0:p.target)==null?void 0:t.nodeType)===Node.ELEMENT_NODE?p:null)),b=((r=v==null?void 0:v.target)==null?void 0:r.nodeType)===Element.ELEMENT_NODE,w=b?v.target:p!=null&&p.isRectangle?p:(p==null?void 0:p.element)||p,D=(w==null?void 0:w.nodeType)===Element.ELEMENT_NODE;e=e.realignTarget?T.clone(e):T.merge({aligningToEvent:b,aligningToElement:D,constrainTo:u,align:"b-t",axisLock:n.axisLock,anchor:n.anchor},n.align,e),b&&(e.domEvent=v);const S=e.minWidth||g,x=e.minHeight||h;if(n.lastAlignSpec=e,D&&(e.target=e.anchoredTo=w,Er(w instanceof SVGElement?w.closest("svg"):w))){if(e=Object.create(e),e.target=n.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?L.from(w,f?l:null,!f):E.isInView(b?v:w,!1,n)),!e.target){const W=n.hide();return n.isDestroyed||(n.lastAlignSpec.targetOutOfView=!0),W}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1)}if(e.anchor&&(e.anchorSize=n.anchorSize,a.contains(n.anchorPathElement)||a.appendChild(n.anchorElement)),typeof e.offset=="string"){const W=a.querySelector(e.offset),j=L.from(W),se=j.getAlignmentPoint(e.align),J=L.from(a),Q=J.getAlignmentPoint(e.align);e.offset=[Q[0]-se[0],Q[1]-se[1]]}n.isAligning=!0,n.trigger("beforeAlign",e);const R=L.from(a,f?l:null,!0),{width:M,height:_}=R;R.isAlignRectangle=!0,S&&(R.minWidth=S*m),x&&(R.minHeight=x*m),n.isAligning=!1,e.rtl=n.rtl,(e.align.includes("s")||e.align.includes("e"))&&(n.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const k=n.lastAlignSpec.result=R.alignTo(e);let{align:F,anchor:I,x:A,y:P,width:H,height:G,overlap:q}=k;if(n.lastAlignSpec.zone=k.zone,G!=_){const W=G<_;n.alignmentChanges=n.alignmentChanges|(W?1:2),o[n.alignedHeightStyle=tw[n.alignmentChanges&3]]=`${G/m}px`,W&&!n._minHeight&&h&&(o.minHeight=`${Math.min(G,h)/m}px`),c&&(c.overflowY=W)}if(H!=M){const W=H<M;n.alignmentChanges=n.alignmentChanges|(W?4:8),o[n.alignedWidthStyle=tw[n.alignmentChanges&12]]=`${H/m}px`,W&&!n._minWidth&&g&&(o.minWidth=`${Math.min(H,g)/m}px`),c&&(c.overflowX=W)}if(F&&n.alignmentChanges){const W=L.from(a,f?l:null,!0);e.align=F;const j=n.lastAlignSpec.result=W.alignTo(e);I=j.anchor,A=j.x,P=j.y,H=j.width,G=j.height}if(n.centered||n.setXY(A,P),!k.overlap&&isFinite(k.zone)&&d.add(QC[k.zone]),I!=null&&I.edge){let{edge:W}=I;const{anchorElement:j,masked:se}=n,{style:J}=j,{style:Q}=j.firstChild,X=L.from(a),ee=[];W==="top"||W==="bottom"?(ee[0]=I.x,ee[1]=W==="top"?1:X.height-1):(ee[0]=W==="left"?1:X.width-1,ee[1]=I.y),J.display="none",se&&(se.element.style.display="none");let ce=E.childFromPoint(a,...ee);if((ce!=null&&ce.matches(":focus")||ce===le.currentOverElement)&&a.compareDocumentPosition(ce)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(ce=ce.parentNode),ce&&ce!==document){let ae=E.getStyleValue(ce,"background-color");for(;ae.match(Xf)&&E.getStyleValue(ce,"position")!=="absolute"&&(ce=ce.parentNode,ce!==document);)ae=E.getStyleValue(ce,"background-color");ae.match(Xf)?n.anchorPathElement.setAttribute("fill",n.defaultAnchorBackgroundColor):n.anchorPathElement.setAttribute("fill",ae)}J.transform=J.display="",se&&(se.element.style.display=""),(W==="left"||W==="right")&&(W=W==="left"?n.rtl?"end":"start":n.rtl?"start":"end"),j.className=`b-anchor b-anchor-${W}`,I.x&&(I.x/=m),I.y&&(I.y/=m),Q.left=`${I.x||0}px`,Q.translate=`0 ${I.y||0}px`,d.add("b-anchored")}else n._anchorElement&&(n.anchorElement.classList.add("b-hide-display"),d.remove("b-anchored"));if(!D){o.pointerEvents="none";const W=E.elementFromPoint(A,P);n.owns(W)||(n.lastAlignSpec.anchoredTo=W),o.pointerEvents=""}if((n.scrollAction==="realign"&&D||n.scrollAction==="hide")&&!n.documentScrollListener&&(n.clearTimeout("scrollListenerTimeout"),e.monitorTargetMutation&&!n.targetObserver&&(n.targetObserver||(n.targetObserver=new MutationObserver(n.onTargetParentMutation.bind(n)))).observe(E.getRootElement(w),{childList:!0,attributes:!0,subtree:!0}),n.setTimeout(()=>{const W=D?w:n.lastAlignSpec.anchoredTo,j=W?E.getRootElement(W):null;n.documentScrollListener=V.addListener({element:document,scroll:"doHideOrRealign",transitionend:"realignOnTransitionEnd",capture:!0,thisObj:n}),j!=null&&j.mode&&(n.targetRootScrollListener=V.addListener({element:j,scroll:"doHideOrRealign",transitionend:"realignOnTransitionEnd",capture:!0,thisObj:n}))},n.scrollAction==="hide"?n.ignoreScrollDuration:0,"scrollListenerTimeout")),D&&(e.monitorResize&&!n.observedTargetEl&&(Ge.addResizeListener(w,n.onTargetResize),n.observedTargetEl=w),e.monitorIntersection&&!(q||w.contains(a)||w.ownerSVGElement)&&n.intersectionObserver.observe(w)),!Y.isAndroid&&!n.observedConstrainEl){const W=u!=null&&u.isRectangle?globalThis:u;n.clearTimeout("resizeListenerTimeout"),n.setTimeout(()=>{n.observedConstrainEl=W||globalThis,Ge.addResizeListener(n.observedConstrainEl,n.onAlignConstraintChange)},n.ignoreScrollDuration,"resizeListenerTimeout")}}onTargetParentMutation(e){var t;const{element:r,lastAlignSpec:n}=this;n!=null&&n.aligningToElement&&((t=n.target)!=null&&t.isConnected?e.some(({target:s})=>s.contains(n.target)&&!r.contains(s))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionChange.bind(this),{root:Y.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionChange(e){if(!this.isDestroyed){const t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:t,height:r}=e.targetRect,{width:n,height:s}=e.target.getBoundingClientRect();(n!==t||s!==r)&&this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,t,{height:r}){const{style:n}=this.contentElement,{overflowY:s}=n;this.setTimeout(this.realign,50),t&&r>t.height&&(n.overflowY="hidden",this.requestAnimationFrame(()=>n.overflowY=s))}realign(){const e=this,{lastAlignSpec:t}=e;if((e.floating||e.positioned)&&t&&e.isVisible){if(t.aligningToElement){const r=t.target.contains(this.element),n=E.isInView(t.target,!1,e);if(!t.allowTargetOut&&(!Er(t.target)||!n)){e.hide(),e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0);return}t.realignEvent=t.domEvent,t.realignTarget=r||t.aligningToEvent?null:n}E.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(t)}}rectangle(e,t,r){return this.rectangleOf("element",e,t,r)}rectangleOf(e,t,r,n){return typeof t!="string"?(n=r,r=t,t=""):t==="border"&&(t=""),typeof r=="boolean"&&(n=r,r=void 0),e!=="element"&&r===void 0&&(r=this.element),r=r!=null&&r.isWidget?r.element:r,typeof e=="string"&&(e=this[e]),L[t||"from"](e,r,n)}releaseSizeConstraints(){const e=this,{scrollable:t,element:r,alignmentChanges:n}=e,{style:s}=r;e.centered||E.setTopInsetInlineStart(r,0,0),n&12&&(E.setLength(r,e.alignedWidthStyle,e[`_last${O.capitalize(e.alignedWidthStyle)}`]||""),s.minWidth=e._minWidth||"",t&&(t.overflowY=t.config.overflowY)),n&3&&(E.setLength(r,e.alignedHeightStyle,e[`_last${O.capitalize(e.alignedHeightStyle)}`]||""),s.minHeight=e._minHeight||"",t&&(t.overflowX=t.config.overflowX)),e.alignmentChanges=0}toFront(){var e;const{element:t}=this,r=this.floating?this.floatRoot:this.positioned?t==null?void 0:t.parentNode:null,n=document.createDocumentFragment();if(this.containsFocus){for(let s=t.nextSibling,a;s;s=a)a=s.nextSibling,r.contains(s)&&((e=s.matches)!=null&&e.call(s,".b-floating,.b-positioned"))&&!this.owns(s)&&n.appendChild(s);n.childElementCount&&r.insertBefore(n,t)}else t.nextElementSibling&&r.appendChild(t)}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return typeof e=="string"?{align:e}:e}changeScrollable(e,t){return typeof e=="boolean"&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):t==null||t.destroy(),e}get html(){return this.isConfiguring?this.content||this._html:this.contentElement.innerHTML}changeHtml(e){return e&&typeof e=="object"&&!E.isVueConfig(e)&&!E.isReactElement(e)&&!Array.isArray(e)&&(e=[e]),e}updateHtml(e){const t=this;t.noChildElements=typeof e=="string"&&!yM.test(e),t.initializingElement||t.insertContent(e,!(t.initializingHtml&&t.adopt))}changeHtmlMutationObserver(e,t){const r=this,{contentElement:n}=r;if(t==null||t.disconnect(),e){const s=new MutationObserver(()=>{r.updatingHtml?r.updatingHtml=!1:r._html=n.innerHTML});return s.observe(n,e),s}}updateContent(e){this.initializingElement||this.insertContent(e)}insertContent(e,t=!1){const r=this,{element:n,contentElement:s,htmlCls:a,contentRange:l,autoClose:o}=r,d=t&&s===n&&r._anchorElement;if(E.isReactElement(e))return E.handleReactElement(r,e);if(E.isVueConfig(e))return E.handleVueContent(r,e);if(r.updatingHtml=!0,r.getConfig("htmlMutationObserver"),d&&n.removeChild(d),a&&a.values.forEach(c=>n.classList[e?"add":"remove"](c)),r.autoClose=!1,e){let c,u;typeof e=="object"?(u=document.createDocumentFragment(),Array.isArray(e)?oe.sync({domConfig:{children:e,onlyChildren:!0},targetElement:u}):oe.sync({domConfig:{...e,onlyChildren:!0},targetElement:u})):t?(s.innerHTML=e,c=!0):(l.deleteContents(),l.insertNode(l.createContextualFragment(e)),c=!0),c||(t?(s.innerHTML="",s.appendChild(u)):n.isConnected?l.insertNode(u):s.insertBefore(u,s.firstChild))}else t||!n.isConnected?s.innerHTML="":l.deleteContents();r.autoClose=o,d&&n.appendChild(d),r.contentRangeStartOffset=l.startOffset,r.contentRangeEndOffset=l.endOffset,s.classList.toggle("b-no-child-elements",r.noChildElements),r.isComposable&&r.recompose(),(r.floating||r.positioned)&&!r.isAligning&&r.realign()}onThemeChange(){var e;this._anchorSize=null,(e=this.anchorElement)!=null&&e.offsetParent&&this.realign()}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const r=parseFloat(E.getStyleValue(e.element,"border-top-width")),n=E.getStyleValue(e.element,"border-top-color"),s=e.anchorElement,{className:a}=s,l=s.firstElementChild,o=e.anchorPathElement=l.lastElementChild,d=e._hidden;s.className="b-anchor b-anchor-top";let c=E.getStyleValue(e.contentElement,"background-color");c.match(Xf)&&(c=E.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,t=l.getBoundingClientRect();const[u,h]=t=e._anchorSize=[t.width,t.height];s.className=a,l.setAttribute("height",h+r),l.setAttribute("width",u),o.setAttribute("d",`M0,${h}L${u/2},0.5L${u},${h}`),r&&(o.setAttribute("stroke-width",r),o.setAttribute("stroke",n)),t[1]-=r,d&&e.syncHiddenCls(),e.themeChangeListener||(e.themeChangeListener=le.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating||e.positioned,r=`${e.id}-shadow-filter`;e._anchorElement=E.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:r,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:`url(#${r})`}]}]})}return e._anchorElement}updateAnchor(e){var t;(t=this._anchorElement)==null||t.classList.toggle("b-hide-display",!e)}changeDraggable(e,t){var r;const n=this;if((r=t==null?void 0:t.destroy)==null||r.call(t),e){const s=typeof e=="object"?e:{};n.draggableHandleSelector=s.handleSelector,delete s.handleSelector,e=new si(T.merge({name:"widget",target:n,floatRootOwner:n,rtlSource:n,positioning:n.floating?"inset":"",dragWithin:n.floating?void 0:n.element.parentNode,internalListeners:{beforeDragStart:n.onBeforeDragStart,dragStart:n.onWidgetDragStart,thisObj:n}},s))}return e}onBeforeDragStart(){const e=this;if(e.validateDragStartEvent(e.draggable.startEvent)){const{x:t,y:r,element:n}=e;return n.classList.remove("b-centered"),e.alignTo(),e.centered&&E.setTopInsetInlineStart(n,r,t),!0}return!1}validateDragStartEvent(e){var t;const r=this,n=E.elementFromPoint(e.clientX,e.clientY),{draggableHandleSelector:s,draggableBlacklistSelector:a}=r;if(a&&n.closest(a))return!1;if(s){const l=(t=CM.exec(s))==null?void 0:t[1];if(l&&n.closest(l))return!1;if(!n.closest(`${s}`))return!1}return!0}setStyle(e,t){return E.applyStyle(this.element,T.isObject(e)?e:{[e]:t}),this}changeFloating(e){return!!e}changePositioned(e){return!!e}updatePositionable(e){this.element.classList.toggle("b-positionable",!!e),e&&(this.innerItem=!1)}updatePositioned(e){const{element:t}=this;t.classList.toggle("b-positioned",!!e),e&&(this.innerItem=!1),t[e?"setAttribute":"removeAttribute"]("tabindex",e?"-1":void 0)}getXY(){const{element:e}=this;return[E.getPageX(e),E.getPageY(e)]}setXY(e,t){const r=this,{element:n}=r;if(r.floating||r.positioned){if(e!=null?r._x=e:e=r._x,t!=null?r._y=t:t=r._y,E.getStyleValue(n,"position")==="fixed"){const s=n.getBoundingClientRect(),[a,l]=E.getTranslateXY(n),o=e-s.x,d=t-s.y;E.setTranslateXY(n,a+o,l+d)}else r.rtl?E.setTopInsetInlineStart(n,t,n.offsetParent.offsetWidth-n.offsetWidth-e-1):E.setTopInsetInlineStart(n,t,e);r.isConstructing?r.centered=!1:n.classList.remove("b-centered")}}setPos(e,t){const r=this,{positionable:n}=r;[e,t]=E.unitize(e,t!=null?t:""),r.element.style[e]=t,r.top==null&&r.right==null&&r.bottom==null&&r.left==null?(n==="after"||n==="before")&&(r.positionable=null):n||(r.positionable="before")}updateBottom(e){this.setPos("bottom",e)}updateLeft(e){this.setPos("inset-inline-start",e)}updateRight(e){this.setPos("inset-inline-end",e)}updateTop(e){this.setPos("top",e)}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(e._width==null&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){const t=this;if(E.setLength(t.element,"width",e),t._lastWidth=e,t._flex=null,t.element.style.flex="",t.monitorResize)t._oldWidth=t._width,t._width=null;else return e}clearWidthCache(){this._width=null}get maxWidth(){return E.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){this._lastMaxWidth=e,E.setLength(this.element,"maxWidth",e)}get minWidth(){return E.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){E.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),(typeof e=="number"||!isNaN(e))&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove(`b-text-align-${t}`),this.element.classList.add(`b-text-align-${e}`)}get height(){const e=this,t=e.element;return e.monitorResize?(e._height==null&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){E.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return E.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){this._lastMaxHeight=e,E.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return E.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){E.setLength(this.element,"minHeight",e)}updateDisabled(e=!1,t){const r=this,{element:n,focusElement:s,ariaElement:a}=r;r.trigger("beforeUpdateDisabled",{disabled:e}),!(e&&(r.revertFocus(),!r._disabled!=!e))&&(n&&(n.classList[e?"add":"remove"]("b-disabled"),e==="inert"?n.inert=!0:t==="inert"&&(n.inert=!1),s&&(s.disabled=e),a&&a.setAttribute("aria-disabled",!!e)),r.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=Et.request(e.floating?e.floatRoot:e.element);return Et.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),t}exitFullscreen(){return Et.exit()}onFullscreenChange(){Et.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){Et.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}get tooltip(){var e;const t=this;if(t._tooltip)return t._tooltip;{const r=(e=ge.Tooltip)==null?void 0:e.getSharedTooltip(t.rootElement,t.eventRoot);if(r&&r.activeTarget===t._element&&r.isVisible)return r}}changeTooltip(e,t){const r=this,{element:n}=r;let s;if(e){if(!(r.preventTooltipOnTouch&&Y.isTouchDevice)){const a=(t==null?void 0:t.isTooltip)||e.newInstance||e.items||e.bbar||e.tbar;!e.isTooltip&&e.constructor.name!=="Object"&&(e={html:typeof e=="string"?e:r.placeholder,textContent:!0}),a?(e.type="tooltip",e.forElement||(e.forElement=n),!("showOnHover"in e)&&!e.forSelector&&(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),s=e=ge.reconfigure(t,e,r),r.detachListeners("tooltipValueListener"),r.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:r})):(n.dataset.btip=!0,r.tipConfig=e)}}else if(t)if(e==null&&t.isTooltip)t.destroy();else{t.html=null;return}else delete n.dataset.btip;return e&&!r.ariaLabel&&r.tooltipText&&n.setAttribute("aria-label",r.localizeText(r.tooltipText)),s}onTooltipValueChange({value:e,source:t}){this.ariaDescription=typeof e=="string"?e:t.contentElement.innerText}get tooltipText(){const e=this._tooltip;if(e)return e.isTooltip?e.contentElement.innerText:typeof e=="string"?e:e.html;if(this.tipConfig)return this.tipConfig.html}get isVisible(){const e=this;let t;return!!(!e._hidden&&(t=this.element)&&!e.isDestroying&&t.isConnected&&(!e.requireSize||Er(t))&&(!e.parent||e.parent.isVisible))}get isVisibleForValidation(){const e=this,{element:t}=e;let r;return!!(t&&(!e._hidden||e.tab&&!e.tab.hidden)&&!e.isDestroying&&t.isConnected&&(!(r=e.containingWidget)||r.isVisibleForValidation))}whenVisible(e,t=this,r,n=e.toString()){var s;const a=this;a.isVisible&&a.isPainted?((s=a.toCallWhenVisible)==null||s.delete(n),a.callback(e,t,r)):(a.toCallWhenVisible||(a.toCallWhenVisible=new Map)).set(n,{callback:e,thisObj:t,args:r})}focus(){var e;(e=this.focusableElement)==null||e.focus({preventScroll:!0})}get focusability(){return E.getFocusability(this.focusElement)}get focusableElement(){const e=this,t=!e.isDestroying&&e.isVisible&&!e.disabled&&e.focusElement;return(t===document.body||(t==null?void 0:t.offsetParent))&&t}get focusElement(){}get isFocusable(){return!!this.focusableElement}get isTabbable(){return this.focusability.tabbable}set isTabbable(e){const{focusability:t,focusElement:r}=this,[n,s]=t.natural?[!e&&"-1",e]:[e&&"0",!e];r&&!e!=!t.tabbable&&(s&&r.removeAttribute("tabIndex"),n&&r.setAttribute("tabIndex",n))}async show({align:e,animate:t=!0}={}){var r;const n=this,{element:s,floating:a}=n,{style:l}=s,o=t&&n.showAnimation;let d,c,u=!n.isVisible;return u&&(u=n.trigger("beforeShow"),T.isPromise(u)&&(u=await u)),u!==!1&&((r=n.internalBeforeShow)==null?void 0:r.call(n))!==!1?new Promise(h=>{if(n.cancelHideShowAnimation(),n.updateCentered(n._centered),a){const g=n.floatRoot;g.contains(s)||(n.rendered?g.appendChild(n.element):n.render(g,!1)),l.transform.includes("scale")&&(n.scale=null,l.transform=l.transformOrigin="");const f=n.closest(SM);if(f){const{scale:m}=f;n.scale=m,l.transform=`scale(${m})`,l.transformOrigin="0 0"}}if(n._hidden=!1,n.syncHiddenCls(),a&&!df(s))return n.hide(!1),h();if(n.onConfigChange({name:"hidden",value:!1,was:!0,config:n.$meta.configs.hidden}),n.afterShow(e,o?null:h),o){d=Object.keys(o)[0],c=o[d];const g=n.currentAnimation={showing:!0,styleProp:d,resolve:h};n.isAnimating=!0,l.transition="none",l[d]=c.from,E.getStyleValue(s,d),n.currentAnimation.detacher=V.onTransitionEnd({element:s,property:d,duration:JC(c.duration)+20,handler:()=>n.afterHideShowAnimate(g),thisObj:n}),l.transition=`${d} ${c.duration} ease ${c.delay}`,l[d]=c.to}}):Promise.resolve()}async showBy(e,t,r){const n=this,s=Array.isArray(e);if(s||typeof e=="number"){const a=s?e:[e,t];e=Object.assign({target:new ti(a[0]+1,a[1]+1),matchSize:!1,align:"t0-b0"},s?t:r)}if(n.requireSize=!0,n.isVisible)E.addTemporaryClass(n.element,"b-realigning",300,n),n.alignTo(e);else return n.show({align:e})}afterShow(e,t){var r,n;const s=this;s.trigger("show"),s._configuredAnchorState=s.anchor,(n=(r=s.owner)==null?void 0:r.onChildShow)==null||n.call(r,s),s.triggerPaint(),(s.floating||s.positioned)&&(e?s.alignTo(e):s.centered?s.alignTo({target:s.constrainTo,align:"c-c"}):s.forElement&&s.alignTo(s.forElement)),t==null||t()}onChildHide(e){const{ariaElement:t}=this,{ownersRole:r}=e;if(e.floating&&t)if(r==="tooltip"){const{titleElement:n}=e,s=n&&E.getId(n),a=E.getId(e.contentElement);s&&E.removeAttributeValue(t,"aria-describedby",s),E.removeAttributeValue(t,"aria-describedby",a)}else this.ariaHasPopup=null,E.removeAttributeValue(t,"aria-controls",E.getId(e.ariaElement||e.element))}onChildShow(e){const{ariaElement:t}=this,{ownersRole:r}=e;if(e.floating&&t)if(r==="tooltip"){const{titleElement:n}=e,s=n&&E.getId(n),a=E.getId(e.contentElement);s&&E.addAttributeValue(t,"aria-describedby",s),E.addAttributeValue(t,"aria-describedby",a)}else this.ariaHasPopup=r,E.addAttributeValue(t,"aria-controls",E.getId(e.ariaElement||e.element))}triggerPaint(){var e;const t=this,{element:r,toCallWhenVisible:n}=t,s=!t.isPainted;if(t.isVisible){if(s&&(t.getConfig("scrollable",t.floating||t.positioned?"draggable":null),t.scaleToFitWidth&&!t.monitorResize&&(t.onParentElementResize=t.onParentElementResize.bind(t),Ge.addResizeListener(r.parentElement,t.onParentElementResize),t.updateScale()),!t.hideBryntumDomMessage&&(t.isTaskBoardBase||t.isGridBase||t.isCalendar)&&r.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),r.firstChild),t.onConnectedCallback&&globalThis.ResizeObserver&&(t.connectedObserver=new ResizeObserver(()=>{t.isElementConnected&&!r.isConnected?(t.onConnectedCallback(!1),t.isElementConnected=!1):!t.isElementConnected&&r.isConnected&&(t.onConnectedCallback(!0,t.isElementConnected==null),t.isElementConnected=!0)}),t.connectedObserver.observe(r))),t.eachWidget(bM,!1),s&&(t.getConfig("tooltip"),!ge.Ripple&&ge.RippleClass&&(ge.Ripple=new ge.RippleClass({rootElement:t.rootElement})),globalThis.DocsBrowser&&t.floating&&t.closest(a=>{var l;return(l=a.element)==null?void 0:l.closest(".fiddlePanelResult,.b-owned-by-fiddle")})&&r.classList.add("b-owned-by-fiddle")),t.isPainted=!0,s&&t.triggerConfigs("paint"),t.onInternalPaint({firstPaint:s}),t.trigger("paint",{firstPaint:s}),(e=t.afterInternalPaint)==null||e.call(t,{firstPaint:s}),n!=null&&n.size){for(const{callback:a,thisObj:l,args:o}of n.values())t.callback(a,l,o);n.clear()}s&&t.monitorResize&&!t.scaleToFitWidth&&Ge.onElementResize([{target:r}]),t.hasPainted=!0}}onInternalPaint(){}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:r}=e;t&&(e.isAnimating=!1,r.classList.contains("b-hiding")&&(r.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),r.style.transition=r.style[t.styleProp]="",e.currentAnimation=null,e.trigger(`${t.showing?"show":"hide"}AnimationEnd`))}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",DM)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise(t=>{const r=this;if(!r._hidden&&r.trigger("beforeHide",{animate:e})!==!1){const{element:n,lastAlignSpec:s}=r,{style:a}=n,l=e&&r.hideAnimation;if(r.clearTimeout("scrollListenerTimeout"),r.clearTimeout("resizeListenerTimeout"),r._hidden=!0,s&&(s.targetOutOfView=null,s.monitorIntersection&&(r.intersectionObserver.takeRecords(),r.intersectionObserver.unobserve(s.target))),r.onConfigChange({name:"hidden",value:!0,was:!1,config:r.$meta.configs.hidden}),!n){t();return}if(n.matches(":focus-within")&&r.revertFocus(!0),r.isDestroyed){t();return}if(r.cancelHideShowAnimation(),l){const o=Object.keys(l)[0],d=l[o];if(Number(getComputedStyle(r.element)[o])!==d.to){const c=r.currentAnimation={hiding:!0,styleProp:o,resolve:t};n.classList.add("b-hiding"),r.isAnimating=!0,r.currentAnimation.detacher=V.onTransitionEnd({element:n,property:o,duration:JC(d.duration)+20,handler:()=>r.afterHideShowAnimate(c),thisObj:r}),a[o]=d.from,E.getStyleValue(n,o),a.transition=`${o} ${d.duration} ease ${d.delay}`,a[o]=d.to}else r.syncHiddenCls()}else r.syncHiddenCls();r.ownedWidgets&&Object.values(r.ownedWidgets).forEach(o=>{var d;return o.floating&&((d=o.hide)==null?void 0:d.call(o,e))}),r.afterHide(!l&&t,l)}else t(!1)})}realignOnTransitionEnd(e){this.doHideOrRealign(e)}doHideOrRealign({target:e,type:t,isTrusted:r}){const n=this,{lastAlignSpec:s,element:a}=n,l=s==null?void 0:s.anchoredTo,o=s==null?void 0:s.target,d=s==null?void 0:s.position,c=E.getActiveElement(n);if(!r||!Er(a)||e&&(t==="scroll"&&!E.isVisible(e)||a.contains(e)||e.nodeType===Element.ELEMENT_NODE&&n.owns(e)||e.nodeType===Element.DOCUMENT_NODE&&a.contains(c)&&E.isTextualInput(c)&&globalThis.innerHeight<document.body.offsetHeight))return;if(s.aligningToElement){const h=E.isInView(o,!1,n);if(h&&h.equals(s.targetRect))return}const u=n.scrollAction==="hide"&&n.getXY();if(n.scrollRealigning=t==="scroll",n.realign(),n.scrollRealigning=!1,!n.isDestroyed&&df(a)&&n.scrollAction==="hide"){const[h,g]=n.getXY(),f=h!==u[0]||g!==u[1];(s!=null&&s.aligningToEvent||(f||(o==null?void 0:o.$$name)==="Point"||d)&&(!l||!Er(l)||e&&E.isDescendant(e,l)))&&n.hide()}}afterHide(e=null,t=this.hideAnimation){var r,n;const s=this;s._anchor=s._configuredAnchorState,s.removeTransientListeners(),t||s.afterHideAnimation(),s.trigger("hide"),(n=(r=s.owner)==null?void 0:r.onChildHide)==null||n.call(r,s),e&&e()}removeTransientListeners(){var e,t;const r=this,{targetObserver:n}=r;r.clearTimeout("resizeListenerTimeout"),r.clearTimeout("scrollListenerTimeout"),n&&(n.disconnect(),delete r.targetObserver),r.documentScrollListener=(e=r.documentScrollListener)==null?void 0:e.call(r),r.targetRootScrollListener=(t=r.targetRootScrollListener)==null?void 0:t.call(r),r.observedTargetEl&&(Ge.removeResizeListener(r.observedTargetEl,r.onTargetResize),r.observedTargetEl=!1),r.observedConstrainEl&&(Ge.removeResizeListener(r.observedConstrainEl,r.onAlignConstraintChange),r.observedConstrainEl=!1)}afterHideAnimation(){const e=this,{element:t}=e;!e.hasOwnProperty("_hideMode")&&e.floating&&e.floatRoot.contains(t)?t.remove():e.syncHiddenCls(),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let r;return t.isConfiguring?(r=!!e,t.syncHiddenCls(r)):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),r}syncHiddenCls(e=this._hidden){const{element:t,hideMode:r}=this,n={"b-hidden":e};for(const s of vM)n[`b-hide-mode-${s}`]=s===r&&(e||s!=="display");E.assignClasses(t,n)}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}changeOwner(e){if(!this.parent)return e}updateOwner(e,t){const r=this,{id:n}=r;t&&t.ownedWidgets&&delete t.ownedWidgets[n],e&&e!==r.parent&&((e.ownedWidgets||(e.ownedWidgets={}))[n]=r)}get containingWidget(){var e,t;let r=this.parent;if(!r){const n=((e=this.forElement)==null?void 0:e.nodeType)===Element.ELEMENT_NODE?this.forElement:(t=this.element)==null?void 0:t.parentNode;r=(n==null?void 0:n.closest(".b-widget"))&&ge.fromElement(n)}return r}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){var t,r;const n=this,{parent:s}=n,a=s?s.childItems:Array.from((r=(t=n.element.parentElement)==null?void 0:t.querySelectorAll(".b-widget"))!=null?r:[]);return s?a[a.indexOf(n)+e]:ge.fromElement(a[a.indexOf(n.element)+e])}up(e,t,r){var n;const{owner:s}=this;return e?(n=s==null?void 0:s.closest)==null?void 0:n.call(s,e,t,r):s}closest(e,t,r){const n=typeof r,s=n==="number",a=n==="string";for(let l=this,o=1;l;l=l.owner,o++){if(ge.widgetMatches(l,e,t))return l;if(s&&o>=r)return;if(a&&ge.widgetMatches(l,r,t))return;if(l===r)return}}owns(e,t){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=e.getAttribute("owned-by")?ge.getById(e.getAttribute("owned-by")):ge.fromElement(e)}for(;e;){if(e.isHint||e===this||t&&this.ownedWidgets&&Object.values(this.ownedWidgets).some(r=>r.owns(e,!0)))return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(e(t)===!1)return!1;t=t.owner}return!0}changeMaximizeOnMobile(e){const t=this;if(t.floating&&Y.isMobile){const{initialConfig:r}=t;e?(t.centered=t.modal=!1,t.maximized=!0):(t.centered=r.centered,t.modal=r.modal,t.maximized=r.maximized)}}changeMonitorResize(e,t){const r=this.scaleToFitWidth?!1:!!e;if(r!==!!t)return r}updateMonitorResize(e){const t=this;Tn(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),Ge[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=!!e,!!this._readOnly!==e)return e}updateReadOnly(e){var t;(t=this.element)==null||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget(r=>{r.ignoreParentReadOnly||("_originalReadOnly"in r||(r._originalReadOnly=r.config.readOnly||!1),r.readOnly=e||r._originalReadOnly)},!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0,r){const n=r?this.childItemsOrderedByRelevance:this.childItems,s=(n==null?void 0:n.length)||0,a={};for(let l=0;l<s;l++){const o=n[l];if(a.down=t,e(o,a)===!1||a.down&&o.eachWidget&&o.eachWidget(e,t,r)===!1)return!1}return!0}queryAll(e){const t=[];return this.eachWidget(r=>{e(r)&&t.push(r)}),t}query(e,t){let r=null;return this.eachWidget(n=>{if(e(n))return r=n,!1},!0,t),r}getWidgetByRef(e){var t,r;return e instanceof ge?e:((t=this==null?void 0:this.widgetMap)==null?void 0:t[e])||((r=this==null?void 0:this.owner)==null?void 0:r.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:r}=t;t.containsFocus=!0,t.focusInEvent=e,(t.floating||t.positioned)&&t.toFront(),r.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),r.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=V.on({element:r,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}captureFocus(){const e=this,t=E.getActiveElement(e),r=e.contains(t)&&e.captureFocusItem(t);return(n,s)=>{r&&!e.isDestroying&&(E.getActiveElement(e)!==t||s)&&r(n)}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():e.focus({preventScroll:!0}))}}contains(e,t){const{element:r}=this;if(e&&r)return e.isWidget&&(e=e.element),r.contains(e)&&(!t||r!==e)}revertFocus(e){var t;const r=this,n=E.getActiveElement(r);let s=(t=r.focusInEvent)==null?void 0:t.relatedTarget;(e||r.containsFocus&&(s==null?void 0:s.nodeType)===Element.ELEMENT_NODE&&r.element.contains(n))&&((!s||!E.isFocusable(s))&&(s=r.getFocusRevertTarget()),r._isRevertingFocus=!0,s&&E.isFocusable(s)?(s._isRevertingFocus=!0,s.focus({preventScroll:!0}),s._isRevertingFocus=!1):n==null||n.blur(),r._isRevertingFocus=!1)}getFocusRevertTarget(){var e;const t=this,{owner:r,focusInEvent:n}=t,s=n&&n.backwards?1:-1;let a=n&&n.relatedTarget;const l=a&&ge.fromElement(a);if(r&&!r.isDestroyed&&(!a||!E.isFocusable(a)||l&&!l.isFocusable)){if(a=null,r.eachWidget){const o=[];if(r.eachWidget(d=>{(d===t||d.isFocusable)&&o.push(d)},!1),o.length>1){const d=o.indexOf(t);a=o[d+s]||o[d-s]}}!a&&r.isFocusable&&(a=r),a=a?a.focusElement:(e=r.getFocusRevertTarget)==null?void 0:e.call(r)}return a}getStaticWidgetClasses(e,t){const r=new te,n=this.$meta.hierarchy;let s,a,l,o,d;for(a=n.indexOf(e);a<n.length;++a)s=n[a],d=Reflect.getOwnPropertyDescriptor(s.prototype,"widgetClass"),d!=null&&d.get?o=d.get.call(this):(l=Tn(s,"$$name")||Tn(s,"$name")||Tn(s,"_$name")?s.$$name:s.name,(l.length<3||l.includes("$"))&&console.warn(`Class "${l}" extending "${s.$name}" should have "$name" static getter with no less than 3 chars.`),o=`b-${l.toLowerCase()}`),o&&r.add(t?o+t:o);return r}get rootUiClass(){return ge}get staticClassList(){const{$meta:e}=this;let t=e.staticClassList;return t||(e.staticClassList=t=this.getStaticWidgetClasses(ge),Y.isTouchDevice&&t.add("b-touch")),t}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:t,defaultCls:r,uiClasses:n}=e;let{staticClassList:s}=e;(r||t)&&(s=s.clone(),r&&s.assign(r),t&&s.assign(t));const a=s.values;return n&&a.push(...n),e.floating&&a.push("b-floating"),e.collapsify==="hide"&&a.push("b-collapsify-hide"),a}changeCls(e){return te.from(e)}updateCls(e,t){if(!this.isConfiguring&&!this.isComposable){const{element:r}=this;t&&T.getTruthyKeys(t).forEach(n=>r.classList.remove(n)),e.assignTo(r)}}changeContentElementCls(e){return te.from(e)}changeHtmlCls(e){return te.from(e)}changeDefaultCls(e){return te.from(e,!0)}updateHideMode(){this.hasPainted&&this.syncHiddenCls()}changeUi(e){return te.from(e)}updateUi(e){let t=null,r,n;if(e){const s=this.getStaticWidgetClasses(this.rootUiClass);for(n in e)if(e[n])for(r in s)s[r]&&((t||(t=new te))[`${r}-ui-${n}`]=1)}this._uiClasses=t==null?void 0:t.values,this._uiClassList=t}fromCache(e,t=!1,r=this.element){var n;if(!r)return null;const s=this;return(n=s.cache)!=null&&n[e]?s.cache[e]:(s.cache||(s.cache={}),s.cache[e]=t?E.children(r,e):r.querySelector(e))}emptyCache(){this.cache&&(this.cache={})}changeMasked(e,t){var r;if(((r=this.masked)==null?void 0:r.type)!=="trial"){if((e===!0||e==="")&&(e="\xA0"),t&&!t.isDestroyed)typeof e=="string"?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const n=ge.resolveType("mask");e=n.mergeConfigs(this.maskDefaults,e),e.owner=this,e=n.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,r,n,s){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,t){var r;const n=this,{element:s}=n,a=(r=n._width)!=null?r:n._oldWidth,l=n._height,o=s.offsetWidth,d=s.offsetHeight;n.floating&&t&&n.onFloatingWidgetResize(...arguments),!n.suspendResizeMonitor&&(a!==o||l!==d)&&(n.onInternalResize(s,o,d,a,l),n.trigger("resize",{width:o,height:d,oldWidth:a,oldHeight:l}))}onFloatingWidgetResize(e,t,r){const n=this,{lastAlignSpec:s,constrainTo:a}=n;if(n.isVisible&&s&&s.target){const l=!t||r.height!==t.height,o=!t||r.width!==t.width,d=a&&!L.from(a).contains(L.from(n.element,null,!0));(l&&s.zone!==2||o&&s.zone!==1||d)&&n.requestAnimationFrame(()=>n.realign())}}updateScale(){const e=this,t=e.element,r=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const n=L.client(r),s=n.width/e.configuredWidth,a=e.scale=e.allowGrowWidth?Math.min(s,1):s;t.style.transform=`scale(${a})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&s>1&&(e.width=e.configuredWidth*s)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if(e=e||0,typeof e=="number")return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const r=e.split(" "),n=r.length;return n===1?r[1]=r[2]=r[3]=r[0]:n===2?(r[2]=r[0],r[3]=r[1]):n===3&&(r[3]=r[1]),[isFinite(r[0])?`${r[0]}${t}`:r[0],isFinite(r[1])?`${r[1]}${t}`:r[2],isFinite(r[2])?`${r[2]}${t}`:r[3],isFinite(r[3])?`${r[3]}${t}`:r[4]]}get documentRoot(){var e;return((e=this.owner)==null?void 0:e.documentRoot)||this.element.getRootNode()}get eventRoot(){var e,t;return(e=this.element)!=null&&e.isConnected?E.getRootElement(this.element):((t=this.owner)==null?void 0:t.eventRoot)||this._rootElement}get rootElement(){var e,t;const r=this;if(!r._rootElement){let n=((e=r.owner)==null?void 0:e.rootElement)||E.getRootElement(r.forElement||((t=r.element)!=null&&t.isConnected?r.element:r.getRenderContext()[0]||r.element));n||(n=document.body),r._rootElement=n}return r._rootElement}get floatRoot(){var e;const t=this,{rootElement:r}=t;let{floatRoot:n}=r;if(n)r.contains(n)||r.appendChild(n);else{const{outerCls:s}=ge,a=(e=E.getThemeInfo(null,r))==null?void 0:e.name;if(!E.isValidFloatRootParent(r))throw new Error("Attaching float root to wrong root");a&&s.push(`b-theme-${a.toLowerCase()}`),n=r.floatRoot=E.createElement({className:`b-float-root ${s.join(" ")}`,parent:r}),$u.push(n),Y.isAndroid&&(n.style.height="100dvh",V.on({element:globalThis,orientationchange:()=>n.style.height=`${screen.height}px`,thisObj:this})),le.ion({theme:({theme:l,prev:o})=>{n.classList.add(`b-theme-${l.toLowerCase()}`),n.classList.remove(`b-theme-${o.toLowerCase()}`)}})}return n.classList.toggle("b-rtl",!!t.rtl),n}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach(t=>{const r=parseInt(getComputedStyle(t).zIndex||0,10);r>e&&(e=r)}),e}get focusVisible(){return E.getActiveElement(this.element).matches(":focus-visible")}static get focusVisible(){return E.getActiveElement().matches(":focus-visible")}static get floatRoots(){return $u}static removeFloatRoot(e){$u.splice($u.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:t}=Y;return t&&e.push(`b-${t}`),Y.isTouchDevice&&e.push("b-touch-events"),Y.isMobile&&e.push("b-mobile"),E.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),Y.isChrome?e.push("b-chrome"):Y.isSafari?e.push("b-safari"):Y.isFirefox&&e.push("b-firefox"),Y.isPhone&&e.push("b-phone"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this,{_isAnimatingCounter:r}=t;t._isAnimatingCounter=Math.max(0,r+(e?1:-1)),r===0&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):r===1&&!e&&(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationEnd",{checkLog:!1})}async executeAndAwaitAnimations(e,t){const r=e.getAnimations({subtree:!0});await t();const n=e.getAnimations({subtree:!0}),s=B.delta(r,n).onlyInB,a=s.filter(l=>l.effect.getTiming().iterations!==1/0);a.length&&await Promise.allSettled(a.map(l=>l.finished))}static query(e,t=!1){const{idMap:r}=ge.identifiable;for(const n in r)if(ge.widgetMatches(r[n],e,t))return r[n];return null}static queryAll(e,t=!1){const{idMap:r}=ge.identifiable,n=[];for(const s in r)ge.widgetMatches(r[s],e,t)&&n.push(r[s]);return n}static fromElement(e,t,r){const n=typeof t;e&&!e.nodeType&&(e=e.target),(n==="number"||t&&t.nodeType===Element.ELEMENT_NODE)&&(r=t,t=null);let s=e,a=0,l,o,d;for(typeof r!="number"&&(l=r,r=Number.MAX_VALUE),n==="string"&&(t=t.toLowerCase());s&&s.nodeType===Element.ELEMENT_NODE&&a<r&&s!==l;){if(o=s.dataset&&s.dataset.ownerCmp||s.id,o){if(d=ge.getById(o),d)if(t){if(n==="function"){if(t(d))return d}else if(ge.widgetMatches(d,t,!0))return d}else return d;a++}s=Ws(s)}return null}static fromSelector(e){const t=document.querySelector(e);return t?ge.fromElement(t):null}triggerFieldChange(e,t=!0){var r;t?this.trigger("change",e):e.source=this,(r=this.eachAncestor)==null||r.call(this,n=>{var s,a;if((s=n.onFieldChange)==null||s.call(n,e),(a=n.isolateFieldChange)!=null&&a.call(n,this))return!1})}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){le.setupFocusListenersOnce(this.eventRoot,V)}static widgetMatches(e,t,r){return t==="*"?!0:typeof t=="function"?t(e):ge.isType(e,t,r)}static attachTooltip(e,t){return typeof t=="string"&&(t={html:t}),ge.create(Object.assign({forElement:e},t),"tooltip"),e}static append(e,t={}){return(t instanceof HTMLElement||typeof t=="string")&&(t={appendTo:t}),B.asArray(e).map(r=>ge.create(T.assign({},t,r)))}changeDock(e){return e==="start"?"left":e==="end"?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget(t=>{"rtl"in t.initialConfig||(t.rtl=e)}),this.ownedWidgets&&Object.values(this.ownedWidgets).forEach(t=>{"rtl"in t.initialConfig||(t.rtl=e)})}get scrollAction(){let{_scrollAction:e}=this;return!e&&this.anchor&&(e="realign"),e}announceAriaLive(e){var t;(t=this.element)!=null&&t.isConnected&&(this.ariaLiveEl||(this.ariaLiveEl=E.createElement({parent:this.element,class:"b-arialive-el","aria-live":"polite"})),this.ariaLiveEl.textContent=(e==null?void 0:e.text)||e)}};y(Vu,"$name","Widget"),y(Vu,"type","widget"),y(Vu,"convertPinchToMousewheel",!0);var z=Vu,_M=z.prototype;["compose","domSyncCallback"].forEach(i=>_M[i].$nullFn=!0),z.initClass(),E.Widget=z,le.Widget=z,Object.assign(globalThis.bryntum||(globalThis.bryntum={}),{Widget:z,get:(i=globalThis.$0)=>i.nodeType?z.fromElement(i):z.getById(i),query:z.query,queryAll:z.queryAll,fromElement:z.fromElement,fromSelector:z.fromSelector}),z._$name="Widget";var Di=class extends $.mixin(Fe,ii){get contentElement(){var i;return(i=this.owner)==null?void 0:i.contentElement}onChildAdd(i){}onChildRemove(i){}renderChildren(){const i=this,{owner:e,itemCls:t}=i,{contentElement:r,items:n}=e,s=e.itemCls,a=n==null?void 0:n.length;if(a){e.textContent=!1;for(let l,o,d=0;d<a;d++){const c=n[d],{element:u,positionable:h}=c,{classList:g}=u;u.dataset.itemIndex=d,g.contains("b-outer")&&g.remove(...z.outerCls),t&&g.add(t),s&&g.add(s),o=r,h&&(l=e.getPositionableLocation(h),(o=l[0])||(o=l[1].parentElement,c.insertBefore=l[1])),c.render(o,!!e.isPainted)}}i.syncPendingConfigs(),i.syncChildCount()}removeChild(i){const e=this,{element:t}=i,{owner:r,itemCls:n}=e,{contentElement:s}=r,a=r.itemCls;s.contains(t)&&t.remove(),delete t.dataset.itemIndex,n&&t.classList.remove(n),a&&t.classList.remove(a),e.fixChildIndices(),e.syncChildCount()}appendChild(i){const{element:e}=i,{owner:t,itemCls:r}=this,{contentElement:n}=t,s=t.itemCls;e.dataset.itemIndex=t.indexOfChild(i),t.textContent=!1,r&&e.classList.add(r),s&&e.classList.add(s),i.render(n,!!t.isPainted),this.syncChildCount()}insertChild(i,e){const t=this,{element:r}=i,{owner:n,itemCls:s}=t,{contentElement:a}=n,l=E.getChild(a,`[data-item-index="${e}"]`),o=n.itemCls;n.textContent=!1,s&&r.classList.add(s),o&&r.classList.add(o);const d=a.contains(r);a.insertBefore(r,l),d||i.render(null,!!n.isPainted),t.fixChildIndices(),t.syncChildCount()}fixChildIndices(){this.owner.items.forEach((i,e)=>{i.element.dataset.itemIndex=e})}syncChildCount(){var i;const{owner:e}=this,{length:t}=e.items;(i=e.contentElement)==null||i.classList[t===1?"add":"remove"]("b-single-child")}syncConfigLater(i){const e=this.pendingConfigs||(this.pendingConfigs=[]);e.includes(i)||e.push(i)}syncConfigStyle({name:i,style:e,classes:t,map:r}){const n=this,s=`b-box-${i}-`,{contentElement:a}=n,l=n[i];let o=(r==null?void 0:r[l])||l;if(a){if(t){const{classList:d}=a;t.forEach(c=>{c!==o&&d.remove(s+c)}),t.includes(o)&&(d.add(s+o),o="")}a.style[e]=o}else n.syncConfigLater(i)}syncPendingConfigs(){const i=this,{pendingConfigs:e}=i;let t;if(e)for(i.pendingConfigs=null;t=e.pop();)i[i.$meta.configs[t].updater](i[t])}};y(Di,"type","default"),y(Di,"configurable",{owner:null,containerCls:"b-auto-container",itemCls:null}),y(Di,"factoryable",{defaultType:"default"}),Di.initClass(),Di._$name="Layout";var iw=0,kM=i=>i.ripple,Qo=class extends z{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}afterConstruct(){super.afterConstruct(),V.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(i){var e;const t=this;t.show();const r=E.getStyleValue(t.circleElement,"animationName");t.hide(),(e=t.listenerDetacher)==null||e.call(t),r&&r!=="none"&&(t.listenerDetacher=V.on({mousedown:{element:t.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:t.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:t.circleElement,handler:"onAnimationEnd"},thisObj:t}),i.type==="mousedown"&&(t.onMousedown(i),le.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(i){iw=performance.now(),this.handleTriggerEvent(i)}onMousedown(i){performance.now()-iw>200&&this.handleTriggerEvent(i)}handleTriggerEvent(i){const e=z.fromElement(i.target,kM);if(e){const t=e.ripple,r=t.delegate?i.target.closest(t.delegate):e.focusElement||e.element;if(r){const n=T.assign({event:i,target:r,radius:this.radius},t);if(typeof n.clip=="string"&&(n.clip=e[n.clip]||i.target.closest(n.clip),!n.clip))return;this.ripple(n)}}}ripple({event:i,point:e=V.getClientPoint(i),target:t=i.target,clip:r=t,radius:n=this.radius,color:s=this.color}){this.clip=r,r=L.from(r,null,!0);const a=this,l=r.getDelta(e),o=a.rippleElement.style,d=a.circleElement,c=E.getStyleValue(t,"border-radius");a.hide(),o.transform=`translateX(${l[0]}px) translateY(${l[1]}px)`,o.height=o.width=`${n}px`,a.element.style.borderRadius=c,d.setAttribute("r",n),d.setAttribute("fill",s),a.showBy({target:r,align:"c-c",matchSize:!0})}onAnimationEnd(i){i.animationName==="b-ripple-expand"&&this.hide()}};y(Qo,"$name","Ripple"),y(Qo,"type","ripple"),z.RippleClass=Qo,Qo._$name="Ripple";var Jf=i=>i.element.classList.contains("b-visible"),FM=i=>!Jf(i)&&i.isVisible,sa=class ut extends z{static get(e){return Oe.get(e,"masks")||Oe.set(e,"masks",[])}static getActive(e){return ut.get(e).find(Jf)||null}static getPending(e){return ut.get(e).filter(FM).sort(z.weightSortFn)}static mask(e,t=document.body){return ut.new({target:t},e)}static mergeConfigs(...e){return e=e.map(t=>typeof t=="string"?{text:t}:t),super.mergeConfigs(...e)}static sync(e){const t=ut.getActive(e),r=!t&&ut.getPending(e)[0]||null,n=t||r,s=(n==null?void 0:n.mode)||"",a=s.endsWith("blur")?`b-masked-${s}`:"";let l,o,d;r&&(o=r.element.classList,r.showDelay&&!e.classList.contains("b-masked")&&(o.add("b-delayed-show"),r.delayedShow()),o.add("b-visible")),e.classList.toggle("b-masked",!!n);for(l of e.children)o=l.classList,o.contains("b-mask")||(d=Array.from(o).filter(c=>c.startsWith("b-masked-")&&a!==c),d.length&&o.remove(...d),a&&o.add(a))}static unmask(e=document.body){var t;const r=ut.get(e),n=r.length;return n?(t=r[n-1])==null?void 0:t.close():null}static unmaskAll(e=document.body){return ut.get(e).filter(t=>!Jf(t)).forEach(t=>t.destroy()),ut.unmask(e)}destroy(){this.type!=="trial"&&super.destroy()}compose(){const{icon:e,maxProgress:t,mode:r,progress:n,showDelay:s,text:a,html:l,useTransition:o}=this;return{class:{"b-mask":1,"b-delayed-show":s,"b-progress":t,"b-prevent-transitions":!o,[`b-mask-${r}`]:1},children:{maskContent:{class:"b-mask-content",children:{progressElement:t?{class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(n/t*100)))}%`}}:null,maskText:{class:"b-mask-text",html:`${e?`${`<i class="b-mask-icon ${e}"></i>`}`:""}${a||l||""}`}}}},listeners:{mousedown:"onMaskMouseDown",capture:!0}}}onMaskMouseDown(e){e.preventDefault()}generateAutoId(){const{type:e}=this;return`mask${typeof e=="string"?e.trim():""}-${ut.counter++}`}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,t;(t=(e=this.owner)==null?void 0:e.syncMaskCover)==null||t.call(e,this)}set error(e){this.setConfig({...this.errorDefaults,text:e})}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),e==null||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:t}=this;t.delay=e,e||t.flush()}changeTarget(e){return e===void 0?e=document.body:typeof e=="string"&&(e=this.owner[e]),e}updateTarget(e,t){const r=this,{id:n,element:s}=r,a=t&&ut.get(t);t&&(t[n]===r&&delete t[n],B.remove(a,r),ut.sync(t)),e?(e[n]||(e[n]=r),s.parentNode!==e&&e.appendChild(s),B.include(ut.get(e),r),ut.sync(e)):s.remove()}deferredClose(){var e;const t=this,{owner:r}=t;t.close().then(()=>{var n;return(n=r==null?void 0:r.onMaskAutoClose)==null?void 0:n.call(r,t)}),(e=r==null?void 0:r.onMaskAutoClosing)==null||e.call(r,t)}delayedShow(){this.element.classList.remove("b-delayed-show")}updateHidden(e,t){var r;(r=super.updateHidden)==null||r.call(this,e,t),e&&this.element.classList.remove("b-visible"),ut.sync(this.target)}afterShow(...e){var t;(t=super.afterShow)==null||t.call(this,...e),ut.sync(this.target)}afterHide(...e){var t;(t=super.afterHide)==null||t.call(this,...e),this.element.classList.remove("b-visible"),ut.sync(this.target)}async close(){await this.hide(),this.destroy()}};y(sa,"$name","Mask"),y(sa,"type","mask"),y(sa,"configurable",{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,target:{$config:"nullify",value:void 0},text:null,type:null,showDelay:null,useTransition:!1}),y(sa,"delayable",{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}}),y(sa,"counter",0);var Mn=sa;Mn.initClass(),Mn._$name="Mask";var IM=Object.freeze({}),{isArray:aa}=Array,AM=i=>i.weight,rw=i=>i&&!i.hidden,LM=i=>i.isFocusable,PM=["display","flex-direction"],OM={default:1,box:1},$M=Symbol("options"),gt=class extends z{static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},tabBarItems:null,defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:{$config:"lazy",value:null},overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateUserChangesOnly:!0,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(i){const e=i.items||i.lazyItems;(this.hasItems=!!(e&&(aa(e)?e:Object.keys(e)).length))||(this.initialItems=!1),super.startConfigure(i)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getPositionableItems(i,e){var t;const r=((t=this._items)==null?void 0:t.filter(n=>i?n.positionable===i:n.positionable))||[];return e?Object.fromEntries(r.map((n,s)=>[`$${n.positionable}${s}`,n.element])):r}getPositionableLocation(i){return[this.contentElement]}getAt(i){return this.ensureItems().at(i)}remove(...i){let e=!0;i.length===1&&(aa(i[0])?i=i[0]:e=!1);const t=this,{_items:r}=t,n=[];for(let s=0;s<i.length;s++){const a=i[s];r.includes(a)&&(r.remove(a),t.layout.removeChild(a),n.push(a),t.onChildRemove(a))}return e?n:n[0]}removeAll(){return this.remove(this.items)}add(...i){const e=this,t=e.ensureItems(),r=[];let n=!0,s,a,l;for(i.length===1&&(aa(i[0])?i=i[0]:n=!1),a=0;a<i.length;a++)s=i[a],s.isWidget?s.parent=e:s=e.createWidget(s),(s==null?void 0:s.weight)!=null?(l=B.findInsertionIndex(s,t.values,z.weightSortFn),r.push(e.insert(s,l))):s&&(t.includes(s)||(t.add(s),e.onChildAdd(s),e.layout.appendChild(s),r.push(s)));return n?r:r[0]}ensureItems(){const i=this;return i.getConfig("items"),i.getConfig("lazyItems"),i._items||(i.items=[]),i._items}insert(i,e){var t;const r=this,n=r.ensureItems();i instanceof z?i.parent=r:i=r.createWidget(i),n.includes(e)&&(e=r.indexOfChild(e)-1),e=Math.min(e,n.count);const s=n.values;if(s.includes(i)){const a=s.indexOf(i);s.splice(a,1),s.splice(e,0,i),n.values=s,r.syncChildCount(),(t=r.onChildMove)==null||t.call(r,i),r.layout.insertChild(i,e<a?e:e+1)}else s.splice(e,0,i),n.values=s,r.onChildAdd(i),r.layout.insertChild(i,e);return i}indexOfChild(i){return this.items.indexOf(i)}changeLazyItems(i){this.items=i,this.layout.renderChildren()}onChildWeightChange(i){var e;if(this.items.length>1){const{lastItem:t}=this;this._items.sort(z.weightSortFn);const{items:r}=this;this.contentElement.insertBefore(i.element,((e=r[r.indexOf(i)+1])==null?void 0:e.element)||t.element.nextSibling)}}changeItems(i,e){const t=this,r=[],n=new ia;return aa(i)?t.processItemsArray(i,r):i&&t.processItemsObject(i,t.namedItems,r),r.some(AM)&&r.sort(z.weightSortFn),n.add(r),e&&e.forEach(s=>{t.remove(s),!n.includes(s)&&s._createdBy===t&&s.destroy()}),n}afterConstruct(){const{rtl:i}=this,{classList:e}=this.contentElement;e.toggle("b-rtl",i===!0),e.toggle("b-ltr",i===!1)}updateRtl(i){super.updateRtl(i);const{contentElement:e}=this;e&&(e.classList.toggle("b-rtl",i===!0),e.classList.toggle("b-ltr",i===!1))}updateItems(i,e){let t=0;i.forEach(r=>{this.onChildAdd(r),e&&!e.temporary&&this.layout.insertChild(r,t),++t}),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const i=this;if(i.getConfig("lazyItems"),!i._items){if(i.initializingItems)return[];i._items=new ia,i._items.temporary=!0}return i._items.values}processItemsArray(i,e){const t=i.length;let r,n;for(r=0;r<t;r++)n=i[r],n instanceof z?(n.parent=this,n.element.classList.remove(...z.outerCls)):n=this.createWidget(n),n&&((n.ref||n.id)&&this.addDescendant(n),e.push(n))}processItemsObject(i,e,t=[]){let r,n;for(n in i)r=i[n],r&&(e&&n in e&&(r=typeof r=="object"?T.merge(T.clone(e[n]),r):e[n]),r&&(r instanceof z?r.parent=this:(r instanceof Object&&(r.ref=n),r=this.createWidget(r)),r&&(r.ref=n,this.addDescendant(r),t.push(r))));return t}onChildAdd(i){const e=this;if(i.innerItem&&e.readOnly&&!i.ignoreParentReadOnly&&(i.readOnly=!0),e.onChildAddLayout(i),i.ref||i.id)for(let t=e;t;t=t.parent)t.addDescendant(i);e.syncChildCount(!0),!e.onConfigChange.$nullFn&&e.onConfigChange({name:"items",config:e.$meta.configs.items})}onChildAddLayout(i){i.innerItem&&this.layout.onChildAdd(i)}onChildHide(i){var e;super.onChildHide(i),(e=this._items)!=null&&e.includes(i)&&this.syncChildCount(!0)}onChildShow(i){var e;super.onChildShow(i),(e=this._items)!=null&&e.includes(i)&&this.syncChildCount(!0)}syncChildCount(i){if(!this.isConfiguring&&!this.isDestroying){const e=this,{items:t,hasItems:r}=e,n=t.filter(rw),{length:s}=n;if(e.visibleChildCount=s,e.hideWhenEmpty&&i){const a=!s;!!e._hidden!==a&&(e.hidden=a)}t.forEach(a=>a.element.classList.remove("b-last-visible-child","b-first-visible-child")),s&&(n[0].element.classList.add("b-first-visible-child"),n[s-1].element.classList.add("b-last-visible-child")),e.hasItems=!!e.childItems.length,e.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),e.isComposable?r!==e.hasItems&&e.recompose():e.updateTextContent(e._textContent)}}syncFlexDirection(){const i=this,{contentElement:e,flexColCls:t,flexRowCls:r}=i,n=new te(e.className),s=E.getStyleValue(e,PM);n[r]=n[t]=0,s.display==="flex"&&(n[s["flex-direction"]==="row"?r:t]=1),E.syncClassList(e,n)}addDescendant(i){const e=i.ref||i.id,t=this._widgetMap||(this._widgetMap={});t[e]||(t[e]=i)}cleanupWidgetMap(i){const e=this,t=new Map,r=i.ref||i.id;r&&t.set(r,i),i.eachWidget(n=>{const s=n.ref||n.id;s&&t.set(s,n)});for(let n=e;n;n=n.parent)for(const[s,a]of t)n.widgetMap[s]===a&&delete n.widgetMap[s]}onChildRemove(i){const e=this;e.cleanupWidgetMap(i),e.layout.onChildRemove(i),e.syncChildCount(!0),!e.onConfigChange.$nullFn&&e.onConfigChange({name:"items",config:e.$meta.configs.items})}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(i){return this._record=i==null?IM:null,i}updateRecord(i){var e;const t=this;(e=t.recordUpdateDetacher)==null||e.call(t),t.trigger("beforeSetRecord",{record:i}),t.clearError(),t._hasChanges=!1,t.setValues(i,{onlyName:t.strictRecordMapping,highlight:!!t.$highlight}),t.autoUpdateFields&&(i!=null&&i.firstStore)&&(t.recordUpdateDetacher=i.firstStore.ion({update:t.onRecordUpdated,thisObj:t}))}setRecord(i,e){this.$highlight=e,this.record=i,this.$highlight=!1}onRecordUpdated({record:i}){i===this.record&&this.setValues(this.record,!0,!0)}shouldUpdateRecordOnAction(i,e){return i&&(e.userAction||!this.autoUpdateUserChangesOnly)}onFieldChange(i){const e=this,{source:t}=i,{hasChanges:r,isSettingValues:n,initialValues:s}=e;if(!n){if(!e.isConfiguring&&e.autoUpdateRecord&&e.shouldUpdateRecordOnAction(e.record,i)){const{strictRecordMapping:a,record:l}=e,{name:o,ref:d,isValid:c=!0,defaultBindProperty:u}=t,h=t[u||"value"],g=a?o:o||d;l&&g&&c&&(l.isModel?l.setValue(g,h):l[g]=h)}if(s){const a=t.getValueName(s[$M]);a&&((e.changeSet||(e.changeSet={}))[a]=!T.isEqual(t.value,s[a]),e._hasChanges=!!(e.changeSet&&Object.values(e.changeSet).some(l=>l)))}e.hasChanges!==r&&e.trigger("dirtyStateChange",{dirty:e.hasChanges})}}get hasChanges(){return!!this._hasChanges}getValues(i){const e={};return this.eachWidget((t,r)=>{t.isolateFields?r.down=!1:"name"in t&&(!i||i(t))&&(e[t.name]=t.value)},!0),e}get values(){const i={};return this.gatherValue(i),i}set values(i){this.assignValue(i)}get isSettingValues(){return!!this.assigningValues}get assigningValues(){var i;return this._assigningValues||((i=this.parent)==null?void 0:i.assigningValues)}set assigningValues(i){this._assigningValues=i}assignValue(i,e){super.assignValue(i,e),this.isolateFields||this.setValues(i,e)}gatherValue(i){super.gatherValue(i),this.isolateFields||this.gatherValues(i)}setValues(i,e=this.assignValueDefaults){const t=this;t.assigningValues=e,t.initialValues={optionsProp:e},t.eachWidget(r=>{const n=r.getValueName(e);n&&(!i||n in i)&&(t.initialValues[n]=(i==null?void 0:i[n])||null),r.assignValue(i,e)},!1),t.assigningValues=!1}get hasNoChildren(){const i=this,{items:e,lazyItems:t}=i.initialConfig,r=e&&(aa(e)?e:T.values(e)),n=t&&(aa(t)?t:T.values(t)),s=i.isConfiguring?n||r:i.items;return!(s!=null&&s.filter(rw).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(i){const e=this;if(!e.isComposable){const t=!!(i&&e.hasNoChildren),{classList:r}=e.contentElement;t!==r.contains("b-text-content")&&(r[t?"add":"remove"]("b-text-content"),e.rendered&&e.realign())}}updateLayoutStyle(i){E.applyStyle(this.contentElement,i)}updateElement(i){if(super.updateElement(...arguments),i){const{classList:e}=this.contentElement,{containerCls:t}=this.layout;e.add("b-content-element"),t&&e.add(t)}}onInternalPaint(){var i;(i=super.onInternalPaint)==null||i.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(i,e){if(e&&(e.takeRecords(),e.disconnect()),i){const t=this,{element:r,contentElement:n}=t;i=new MutationObserver(s=>t.onContentElMutation(s)),i.observe(n,{attributes:!0}),n!==r&&i.observe(r,{attributes:!0}),t.syncFlexDirection()}return i}onContentElMutation(i){OM[this.layout.type]&&!this.textContent&&this.isVisible&&i.some(e=>this.contentElement.contains(e.target))&&this.syncFlexDirection()}changeLayout(i,e){return Di.reconfigure(e,i,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}get childItemsOrderedByRelevance(){return this.items}getWidgetById(i){return this.widgetMap[i]}processWidgetConfig(i){}setupWidgetConfig(i,e){const t=this;typeof i=="string"?i={html:i}:i.nodeType===Element.ELEMENT_NODE&&(i={element:i,id:i.id}),(typeof e=="string"||!e&&(e=i.type))&&(e==="checkbox"&&Y.isMobile&&z.resolveType("slidetoggle",!0)&&(e=i.type="slidetoggle"),e=z.resolveType(e,!0)),i=(e||z).mergeConfigs(t.defaults,i,{parent:t});for(let r=i.parent;r;r=r.parent)if(r.processWidgetConfig(i)===!1)return null;return t.trigger("beforeWidgetCreate",{widgetConfig:i})===!1?null:i}createWidget(i){const e=z.create(this.setupWidgetConfig(i),this.defaultType);return e&&(e._createdBy=this),e}updateDefaults(i,e){if(!this.isConfiguring&&i){const t=Object.entries(i);this.eachWidget(r=>{t.forEach(([n,s])=>{(!e||r[n]===e[n])&&(r[n]=s)})},!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const{defaultFocus:i}=this;if(typeof i=="string")return this.element.querySelector(i);let e=i&&this.query(i);return(!i||!e)&&(e=this.query(LM,!0)),e?e.focusElement:super.focusElement}doDestroy(){var i;(i=this._items)==null||i.forEach(e=>{var t;return(t=e.destroy)==null?void 0:t.call(e)}),this.layout.destroy(),super.doDestroy()}get isValid(){let i=!0;return this.eachWidget(e=>{"isValid"in e&&e.isVisibleForValidation&&!e.isValid&&(i=!1)},!0),i}clearError(){this.eachWidget(i=>{var e;return(e=i.clearError)==null?void 0:e.call(i)})}};y(gt,"$name","Container"),y(gt,"type","container"),gt.initClass(),gt._$name="Container";var{assign:ed}=T,nw=()=>performance.now(),HM={start:!1},VM=/^[.\d]+([^\d].*)?$/,sw=i=>{const e=i.$bryntum||(i.$bryntum={});return e.transitions||(e.transitions=Object.create(null))},aw=(i,e)=>{var t;return typeof i=="string"&&(e=(t=VM.exec(i))==null?void 0:t[1],i=parseFloat(i)),i&&i*(e==="s"||!e&&i<10?1e3:1)},Qf=i=>{const e=T.values(sw(i)).filter(t=>t.completed==null).map(t=>t.toString());i.style.transition=e.join(", ")},lw=i=>class extends i{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...t){super(...t),this.id=++NM}start(){this.startTime=nw()}get delay(){var t,r,n;return aw((n=(r=this._delay)!=null?r:(t=this.owner)==null?void 0:t.delay)!=null?n:0,this.unit)}set delay(t){this._delay=t}get duration(){var t;const{owner:r,unit:n}=this;return aw((t=this._duration)!=null?t:r?r.duration:yt.defaultDuration,n)}set duration(t){this._duration=t}get elapsed(){return nw()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var t,r;return(r=this._retain)!=null?r:(t=this.owner)==null?void 0:t.retain}set retain(t){this._retain=t}get timing(){var t,r;return(r=this._timing)!=null?r:(t=this.owner)==null?void 0:t.timing}set timing(t){this._timing=t}get unit(){var t,r;return(r=this._unit)!=null?r:(t=this.owner)==null?void 0:t.unit}set unit(t){this._unit=t}},NM=0,ow=class EE extends $.mixin(lw){static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:t,transitions:r}=e;let{property:n}=e;[n,e.to]=E.unitize(n,e.to),e.from=E.unitize(n,e.from)[1],e.promissory=new Xo,e.property=n;const s=r[n];r[n]=e;let{from:a}=e;s&&(e.from=s.to,a=null,s.destroy()),a===null&&(a=e.getCurrentStyleValue(),s||(e.from=a)),t.style[n]=a,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return(e=this.promissory)==null?void 0:e.promise}get transitions(){return sw(this.element)}clearStyle(){this.setStyle("")}finish(e){const t=this,{transitions:r,promissory:n,property:s}=t;n&&(t.completed=e,t.promissory=null,n.resolve(e),r[s]===t?(delete r[s],e||(Qf(t.element),t.clearStyle())):t.completed=!1)}getCurrentStyleValue(){return E.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:t,element:r,from:n,property:s,_retain:a,_timing:l}=this;return new EE({element:r,property:s,retain:a,timing:l,duration:Math.round(Math.min(e,t)),reverting:this,to:n,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:t,duration:r,element:n,property:s}=e;V.onTransitionEnd({element:n,property:s,duration:t+r+20,thisObj:e.owner,handler:()=>{var a;return(a=e.finish)==null?void 0:a.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:t,property:r,timing:n}=this;return`${r} ${t}ms ${n||"ease-in-out"}${e?` ${e}ms`:""}`}};y(ow,"$name","AnimatorTransition");var em=ow;em.initClass();var dw=class fi extends $.mixin(lw){static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,t){if(T.isObject(e)){T.entries(e).forEach(r=>fi.register(...r));return}fi.fx[e]=t,fi[e]=r=>(E.isElement(r)?r={element:r,[e]:{}}:(r={element:r.element,[e]:r},delete r[e].element),fi.run(r))}static run(e){return new fi(e).start()}constructor(e){var t;super(null);const r=this,n=[],s={};let a,l,o,d;if(Array.isArray(e))r.items=e;else for(o in e)(fi.specialPropsRe.test(o)?r:s)[o]=e[o];T.keys(s).forEach(c=>{d=s[c],d!=null&&d!==!1&&d===d&&((l=fi.fx[c])?(d=ed(r.defaults,l(d,r,c)),d.owner=r,a=new fi(d)):(d=ed(r.defaults,typeof d=="object"?d:{to:d}),d.owner=r,d.property=c,a=new em(d)),n.push(a))}),(t=r.items)==null||t.forEach(c=>{T.isInstantiated(c)?c.owner=r:(c=ed(r.defaults,c),c.owner=r,c=new fi(c)),n.push(c)}),r.items=n,r.promise=(n.length===1?n[0].promise:Promise.all(n.map(c=>c.promise))).then(c=>{var u;return(u=r.finish)==null||u.call(r,c),r.completed||!1})}doDestroy(){this.items.forEach(e=>e.destroy()),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:t,owner:r}=this;return e!=null?e:t?!1:r?r.retain:!0}set retain(e){super.retain=e}done(){return this.promise}finish(e){var t,r;const n=this,{items:s}=n;for(Qf(n.element),n.completed=typeof e=="boolean"?e:!e.some(a=>!a),(t=n.prefinalize)==null||t.call(n,n.completed,n);s.length;)s.pop().destroy();(r=n.finalize)==null||r.call(n,n.completed,n)}revert(e){var t;const r=this,{reverting:n}=r,s=!e||((t=e.start)!=null?t:!0);let a=r.defaults;return n&&(n.finalize&&(a.finalize=n.finalize),n.prefinalize&&(a.prefinalize=n.prefinalize),a.retain=n._retain),a=ed(a,e,{items:r.items.map(l=>l.revert(HM)),reverting:r}),a=new fi(a),s&&a.start(),a}start(){const{element:e,items:t}=this;return super.start(),t.length&&(Qf(e),t.forEach(r=>r.start())),this}};y(dw,"$name","Animator");var yt=dw;yt.initClass().Transition=em,yt.specialPropsRe=new RegExp(`^(?:${Object.keys(yt.prototypeProperties).concat(Object.keys(yt.superclass.prototypeProperties)).map(i=>i[0]==="_"?i.substr(1):i).join("|")})$`),yt.defaultDuration=200,yt.fx={},yt.register({puff(i){return i===!0?i={}:typeof i!="object"?i={transform:`scale(${i})`}:i.scale&&(i=T.clone(i),i.transform=`scale(${i.scale})`,delete i.scale),ed({opacity:0,transform:"scale(8)"},i)}}),yt._$name="Animator";var Nu=class extends $.mixin(fe){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var i;(i=this.mousedownRemover)==null||i.call(this),this.cancel(),super.doDestroy()}cancel(){var i,e,t;const r=this;(i=r.activeElement)==null||i.classList.remove(r.pressedCls),r.activeElement=null,(e=r.acceleration)==null||e.cancel(),r.activeListenerRemover=(t=r.activeListenerRemover)==null?void 0:t.call(r),r.clearTimeout(r.autoRepeatTimer),r.clearTimeout(r.repeatTimer)}updateElement(i){var e;(e=this.mousedownRemover)==null||e.call(this),this.mousedownRemover=V.on({element:i,mousedown:"onMouseDown",thisObj:this})}onMouseDown(i){const e=this,t=e.delegate?i.target.closest(e.delegate):e.element;e.cancel(),t&&(e.activeElement=t,e.triggerEvent=i,t.classList.add(e.pressedCls),e.activeListenerRemover=V.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:t,handler:"onTargetMouseMove"},mouseleave:{element:t,handler:"onTargetMouseLeave"},mouseenter:{element:t,handler:"onTargetMouseEnter"},thisObj:e}),e.autoRepeatTimer=e.setTimeout("startAutoRepeat",e.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(i){const e=this;i.buttons?(e.activeElement.classList.add(e.pressedCls),e.triggerEvent=i,e.fireClick()):e.cancel()}onTargetMouseMove(i){this.triggerEvent=i}startAutoRepeat(){const i=this;i.interval=i.startInterval=1e3/i.startRate,i.accelerationDelta=i.startInterval-1e3/i.endRate,i.fireClick(),i.acceleration=be.animate(i.accelerateDuration,i.nextTick,i,"easeOutQuad")}nextTick(i){this.interval=this.startInterval-this.accelerationDelta*i}fireClick(){const i=this,e=new MouseEvent("click",i.triggerEvent);i.triggerEvent.target.dispatchEvent(e),i.repeatTimer=i.setTimeout(i.fireClick,i.interval)}};Nu._$name="ClickRepeater";var BM=/^(?:undefined|null|LEFT|RIGHT)$/,zM={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},cw=i=>{const e=i==null?void 0:i.toUpperCase();return[e,e==="LEFT"||e==="RIGHT"]},Bu=i=>{var e;return e=class extends(i||$){static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:t}=this;return{class:{[`b-rotate-${(t||"").toLowerCase()}`]:t,"b-rotate-vertical":t}}}syncRotationToDock(t){if(BM.test(String(this.rotate))){const[r,n]=cw(t);this.rotate=n?this.invertRotate?zM[r]:r:null}}get widgetClass(){return null}},y(e,"$name","Rotatable"),e},_n=class extends z.mixin(Bu){compose(){const{align:i,href:e}=this;return{tag:e!=null?"a":"button",class:{[`b-align-${i||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var i,e;if((i=this.parent)!=null&&i.isPanel&&((e=this.element)!=null&&e.parentNode.matches(".b-panel-header")))return this.parent}changeAlign(i){return i}onInternalClick(i){const e=this,{handler:t,panel:r}=e,n={domEvent:i,tool:e};e.disabled||(e.trigger("click",n),e.isDestroyed||(e.trigger("action",n),!e.isDestroyed&&(r==null?void 0:r.trigger("toolClick",n))!==!1&&t&&e.callback(t,r,[i,r,e])))}onInternalKeyDown(i){(i.key.trim()||i.code)==="Enter"&&i.stopPropagation()}updateDisabled(i,e){var t;super.updateDisabled(i,e),i&&((t=this.repeat)==null||t.cancel())}changeRepeat(i,e){return e==null||e.destroy(),i&&Nu.new({element:this.element},i)}changeTooltip(i,e){const t=this,r=(i==null?void 0:i.html)||i;return!t.ariaLabel&&!t.text&&typeof r=="string"&&(t.ariaLabel=t.optionalL(r,t)),super.changeTooltip(i,e)}};y(_n,"$name","Tool"),y(_n,"type","tool"),y(_n,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null,role:""}),_n.initClass(),_n._$name="Tool";var WM=/right/i,jM=i=>(i.collapsed||i.collapsing)&&i.owner.expandedHeaderDock==="top"&&i.owner.collapsible.direction.match(WM)?"start":"end",td=class extends _n{static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:i,direction:e}=this;return{"aria-label":this.L(`L{PanelCollapser.${i?"Expand":"Collapse"}}`),class:{[`b-icon-collapse-${e}`]:1,"b-collapsed":i}}}changeAutoAlign(i){return i===!0?jM:i}syncAutoAlign(){const{autoAlign:i}=this;i&&(this.align=i(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}};y(td,"$name","CollapseTool"),y(td,"type","collapsetool"),td.initClass(),td._$name="CollapseTool";var uw=/^(?:UP|DOWN|LEFT|RIGHT)$/,UM=/^(left|top)$/i,GM={},hw=/^b-dock-(top|left|right|bottom)$/,tm="b-panel-collapse-revealer",YM=/^(?:left|right)$/i,zu="b-collapse-unflex",{round:_r}=Math,gw=["up","down","left","right"].reduce((i,e)=>(i[e.toUpperCase()]=i[e]=e,i),{}),im={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},qM={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},KM={h:"w",w:"h"},fw={up:"top",right:"right",down:"bottom",left:"left"},Wu={top:!1,right:!0,bottom:!1,left:!0},XM={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},mw={top:i=>`translate(0, -${_r(i.height||0)}px)`,bottom:i=>`translate(0, ${_r(i.height||0)}px)`,right:i=>`translate(${_r(i.width||0)}px, 0)`,left:i=>`translate(-${_r(i.width||0)}px, 0)`},ZM=0,Yi=class extends $.mixin(ii){static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(i){var e;(e=this.collapsible)==null||e.onCollapseClick(i)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return this.collapsingExpanding==="collapsing"}get collapsingExpanding(){var i;const e=(i=this.currentOperation)==null?void 0:i.collapsing;return e==null?null:e?"collapsing":"expanding"}get currentDock(){var i,e,t,r;return(r=(t=(e=(i=this.panel)==null?void 0:i.header)==null?void 0:e.dock)==null?void 0:t.toLowerCase())!=null?r:"top"}get expanding(){return this.collapsingExpanding==="expanding"}get collapseTool(){var i,e;return(e=(i=this.panel)==null?void 0:i.tools)==null?void 0:e.collapse}get collapseDim(){return YM.test(this.collapseDir)?"width":"height"}getCollapseDir(i){var e;let{direction:t,panel:r}=this;if(!t||uw.test(t)){const n=r==null?void 0:r.placement;n?t=qM[n]:t=XM[((e=r==null?void 0:r.header)==null?void 0:e.dock)||"top"]}return i?gw[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:i}=this,e=i.hasHeader&&i.expandedHeaderDock;let t=fw[this.collapseDir],r=!1;return e&&((r=Wu[t]!==Wu[e])||(t=e)),[t,r]}get toolsConfig(){const{direction:i,tool:e}=this;return e&&{collapse:T.assign({direction:i.toLowerCase()},e)}}beforeCollapse(i){const{panel:e}=this,{element:t}=e;t.matches(":focus-within")&&e.revertFocus(!0)}changeTool(i){const e=this,{panel:t}=e;if(e.isConfiguring||e.isDestroying||!t||t.isDestroying)return i;t.tools={collapse:i}}collapse(i){var e,t;const r=this,{panel:n}=r,s={id:++ZM,completed:!1,panel:n};let{currentOperation:a}=r;return i=i!=null?i:!0,T.isObject(i)&&(s.collapsed=!0,T.assign(s,i),i=s.collapsed,delete s.collapsed),s.collapsing=i,s.previous=a!=null?a:null,i!==r.collapsed?a?a.collapsing!==i&&(s.animation=a.animation.revert({finalize(){var l;(l=r.collapseFinalize)==null||l.call(r,s,!0)}}),s.collapsing=i,a=s):(s.animation=T.clone(("animation"in s?s:r).animation),r.beforeCollapse(s)!==!1&&(s.animation&&(s.animation.finalize=l=>{var o;return(o=r.collapseFinalize)==null?void 0:o.call(r,s,l)}),n.changingCollapse=!0,r[i?"collapseBegin":"expandBegin"](s),s.animation?a=s:(s.completed=!0,r[i?"collapseEnd":"expandEnd"](s)),n.changingCollapse=!1,s.animation||r.onComplete(i?"collapse":"expand"))):a&&a.collapsing!==i&&(r[i?"expandRevert":"collapseRevert"](s),s.animation=a.animation.revert({finalize(){var l;(l=r.collapseFinalize)==null||l.call(r,s,!1)}}),a=s),r.currentOperation=a,(t=(e=a==null?void 0:a.animation)==null?void 0:e.done())!=null?t:Promise.resolve(i===r.collapsed)}collapseFinalize(i,e){const t=this,{currentOperation:r,panel:n}=t,s=n.collapsed?"expand":"collapse";r===i&&(t.currentOperation=null,i.completed=e,n.changingCollapse=!0,t[s+"End"](i),n.changingCollapse=!1,e&&t.onComplete(s))}applyHeaderDock(i,e=!0){const t=this,{currentDock:r,panel:n}=t,{header:s}=n,a=i?t.collapseDock:n.expandedHeaderDock;a!==r&&n.hasHeader&&(n.header=s?typeof s=="string"?{title:s}:T.clone(n.header):{},n.header.dock=a,e&&n.recompose.flush())}composeHeader(i){const{panel:e}=this,{class:t}=i,r=e.expandedHeaderDock||Object.keys(t).filter(n=>t[n]&&hw.test(n)).map(n=>hw.exec(n)[1][0]);return t[tm]=1,t[`b-collapsible-${r[0]}${this.collapseDir[0]}`]=1,i}composeTitle(i){return i.class[tm]=1,i}collapseBegin(i){var e;const t=this,{animation:r}=i,{collapseDim:n,collapseTool:s,panel:a}=t,{element:l,placement:o}=a,[d,c]=t.collapseInfo,u=s==null?void 0:s.element.classList,h=!o||o[0]==="h"&&n==="width"||o[0]==="v"&&n==="height";t.configuredWidth=a._lastWidth,t.configuredHeight=a._lastHeight,t.transverseCollapse=c,t.applyHeaderDock(!0);const g=a.rectangle(),f=t.lockInnerSize().moveTo(0,0),m=f.clone(),p=im[d],v=(e=a.headerElement)==null?void 0:e.getBoundingClientRect(),b=_r((v==null?void 0:v[n])||0);l.classList.toggle(zu,h),r?(m[p[0]]=m[p[1]],l.classList.add("b-collapsing"),u==null||u.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),u&&(u.remove("b-collapsed"),a.rectangle(),u.remove("b-collapsing"),u.add("b-collapsed")),r.element=l,r.retain=!0,r[n]={from:_r(g[n]),to:b},r.items=[{element:t.innerElement,retain:!1,clip:{from:`rect(${f})`,to:`rect(${m})`}}],c&&r.items.push({element:a.headerElement,duration:r.duration,retain:!1,transform:{from:mw[d](v),to:"translate(0, 0)"}}),i.animation=yt.run(r)):(l.style[n]=`${b}px`,s&&(u.add("b-collapsing","b-collapsed"),s.rectangle(),u.remove("b-collapsing")))}collapseEnd(i){const e=this,{collapseTool:t}=e;e.panel.isDestroyed||(e.panel.element.classList.remove("b-collapsing"),t&&(t.collapsing=!1),i.completed?e.collapsed=!0:(e.applyHeaderDock(!1),e.restoreConfiguredSize(),e.lockInnerSize(!1)))}collapseRevert(i){var e;(e=this.collapseTool)==null||e.element.classList.remove("b-collapsed")}expandBegin(i){const e=this,{animation:t}=i,{collapseDim:r,collapseTool:n,panel:s}=e,[a,l]=e.collapseInfo,{element:o}=s,d=o.classList,c=d.contains(zu),u=s.rectangle();d.remove("b-collapsed","b-collapsing"),s.element.style[r]="",e.restoreConfiguredSize(),e.lockInnerSize(!1);const h=s.rectangle(),g=e.lockInnerSize().moveTo(0,0),f=g.clone(),m=im[e.collapseDock];n==null||n.element.classList.remove("b-collapsed"),t&&(f[m[0]]=f[m[1]],d.add("b-collapsed","b-expanding"),c&&d.add(zu),t.element=o,t[r]={from:_r(u[r]),to:_r(h[r])},t.items=[{element:e.innerElement,retain:!1,clip:{from:`rect(${f})`,to:`rect(${g})`}}],l&&t.items.push({element:s.headerElement,duration:t.duration,retain:!1,transform:{from:"translate(0, 0)",to:mw[a](u)}}),i.animation=yt.run(t))}expandEnd(i){const e=this;e.panel.element.classList.remove("b-expanding"),i.completed&&(e.collapsed=!1,e.applyHeaderDock(!1),e.restoreConfiguredSize(),e.lockInnerSize(!1))}expandRevert(i){var e;(e=this.collapseTool)==null||e.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:i}=this;const e=i===!0;return(e||i==null)&&(i=this.collapseDim[0],(e||E.getStyleValue(this.panel.element,"position")==="absolute")&&(i+=KM[i])),i||""}lockInnerSize(i=!0){const e=this,{innerElement:t,panel:r}=e,n=i?e.supportAxis:"",s=r.element,a=r.headerElement,l=i&&a&&L.from(a,s),o=i&&L.from(e.innerSizeElement,s),d=t.style;return a&&(a.style.minWidth=n.includes("w")?`${l.width}px`:"",a.style.minHeight=n.includes("h")?`${l.height}px`:""),d.width=i?`${o.width}px`:"",d.height=i?`${o.height}px`:"",t.classList[i?"add":"remove"]("b-panel-collapse-size-locker"),o}onCollapseClick(i){let e=this.collapsing?!1:this.expanding?!0:!this.collapsed;i.altKey&&(e={animation:null,collapsed:e}),this.collapse(e)}onComplete(i){var e,t;(t=(e=this.panel)==null?void 0:e.trigger)==null||t.call(e,i)}onPanelHeaderClick({event:i}){i.button===0&&this.panel.collapsed&&i.target.classList.contains(tm)&&this.onRevealerClick()}onPanelConfigChange({name:i,value:e}){const t=this,{panel:r}=t;i==="collapsed"?r.isPainted&&(t.collapsed=e):i==="header"&&!r.changingCollapse&&t.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(i){const{configuredHeight:e,configuredWidth:t,panel:r}=this;i=i!=null?i:"wh",r.element.classList.remove(zu),t!=null&&i.includes("w")&&(r.width=t),e!=null&&i.includes("h")&&(r.height=e)}splitHeaderItems({as:i,dock:e}=GM){var t;return(t=this.panel)==null?void 0:t.splitHeaderItems({as:i,dock:e,alt:!0})}syncDirection(){const i=this,{direction:e}=i;(!e||uw.test(e))&&(i.direction=i.getCollapseDir())}changeCollapsed(i){return!!i}updateCollapsed(i){const{collapseTool:e,panel:t}=this;t&&(t.collapsed=i,t.element.classList[i?"add":"remove"]("b-collapsed")),e&&(e.collapsed=i)}updateDirection(i){const{collapseTool:e,panel:t}=this;e&&(e.direction=gw[i]),t!=null&&t.rendered&&t.recompose()}updatePanel(i){var e;const t=this;t.syncDirection(),(e=t.panelChangeDetacher)==null||e.call(t),t.panelChangeDetacher=i&&be.after(i,"onConfigChange","onPanelConfigChange",t,{return:!1})}wrapCollapser(i,e){var t;const r=this,[n,s]=r.collapseInfo;if(!s)return[i,e];const{collapseDir:a,panel:l}=r,{expandedHeaderDock:o,header:d,uiClassList:c}=l,u=(t=l.tools)==null?void 0:t.recollapse,[h,g]=r.splitHeaderItems({as:"element",dock:n}),f=l.hasHeader?l.title||(d==null?void 0:d.title)||"\xA0":null,m=f&&{tag:"header",class:new te({...c,[`b-dock-${o}`]:1,"b-panel-header":1,"b-panel-collapser-header":1},d==null?void 0:d.cls),style:d==null?void 0:d.style,children:[...h,{reference:"collapserTitleElement",html:f,class:{...c,[`b-align-${(d==null?void 0:d.titleAlign)||"start"}`]:1,"b-header-title":1}},...g]};return u&&(u.direction=a),["collapseWrapElement",{class:{...c,[`b-panel-collapser-header-${o}`]:1,[`b-panel-collapser-${a}`]:1,[`b-${Wu[o]?"h":"v"}box`]:1,"b-panel-collapser":1,"b-box-center":1},children:UM.test(o)?{collapserHeaderElement:m,[i]:e}:{[i]:e,collapserHeaderElement:m}}]}};y(Yi,"$name","PanelCollapser"),y(Yi,"type","inline"),Yi.maps={clipByDock:im,dockByDirection:fw,dockIsHorz:Wu},Yi.initClass(),Yi._$name="PanelCollapser";var id=Symbol("pendingCreate"),kr=class extends ${static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:typeof Proxy!="undefined",setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const i=this;let e=null;return i.proxyable&&(e=new Proxy(i.instances,{get(t,r){return i.get(r)},set(t,r,n){return i.set(r,n),!0},deleteProperty(t,r){return i.set(r,null),!0}})),Reflect.defineProperty(i,"proxy",{configurable:!0,value:e}),e}get target(){return this.proxy||this.object}define(i,e){const t=this,{transform:r}=t,n=r?r(e,i):e,s=T.isInstantiated(n);t.instances[i]=id,s||t.setDefaults(i,n),t.defineProp(i,!0),s&&t.set(i,n)}defineProp(i,e){const t=this,{object:r}=t;t.proxy||Reflect.defineProperty(e?Object.getPrototypeOf(r):r,i,{configurable:!e,enumerable:!0,get(){return t.get(i)},set(n){return t.set(i,n)}})}flush(){var i;const e=this;try{e.updating=!0;for(const t in e.defaults)e.get(t);e.afterConfigureOwner=(i=e.afterConfigureOwner)==null?void 0:i.call(e)}finally{e.updating=!1}}get(i){const{defaults:e,instances:t}=this;return t[i]===id&&this.set(i,id),t[i]||e[i]&&null}set(i,e){var t;const r=this,{cleanup:n,configName:s,defaults:a,factory:l,instances:o,owner:d,setup:c,transform:u,updating:h}=r,g=d&&s&&!h,f=o[i]===id?null:o[i],m=l.reconfigure(f,e===id?{}:e||null,{cleanup:n&&(p=>n(p,i)),defaults:a[i]||r.setDefaults(i,{}),owner:r.owner,setup:c&&((p,v,b)=>c(p,i,v,b)),transform:u&&(p=>u(p,i))});if(m!==f){const p=g&&{...o};o[i]=m,m?(r.defineProp(i),(t=r.created)==null||t.call(r,m,i)):(delete r.object[i],delete o[i]),g&&d.onConfigChange({name:s,config:d.$meta.configs[s],value:r.target,was:p})}}setDefaults(i,e){const{defaults:t,factory:r,inferType:n,instances:s,owner:a,ownerName:l}=this,{typeKey:o}=r.factoryable;return e=e===!0?{}:T.assign({},e),(n==="name"||n===!0&&!e[o])&&(e[o]=i),l&&(e[l]=a),e.beforeConfigure=d=>{s[i]=d},t[i]=e}update(i){const e=this,{owner:t}=e;let r,n;try{if(e.updating=!0,i)for(r in i)n=i[r],e.defaults[r]?e.set(r,n):n&&e.define(r,n);else for(r in e.instances)e.set(r,null)}finally{e.updating=!1}t&&(t.isConfiguring?e.afterConfigureOwner||(e.afterConfigureOwner=be.before(t,"afterConfigure","flush",e)):e.flush())}};kr.initClass(),kr._$name="DynamicObject";var JM=[],rm={},QM={align:1,weight:1},nm=i=>{var e;return e=class extends(i||z){static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(t,r){return(t.weight||0)-(r.weight||0)}byWeightReverseSortFn(t,r){return(r.weight||0)-(t.weight||0)}gatherTools({align:t,alt:r,refs:n}=rm){var s,a,l;const{collapsed:o,tools:d}=this,c={collapsed:o,alt:r};let u=[],h,g,f,m,p;for(g in d)p=d[g],h=(l=(a=(s=p==null?void 0:p.align)==null?void 0:s.align)!=null?a:p==null?void 0:p.align)!=null?l:"end",h===t&&p.isCollapsified(c)&&u.push(p);if(u.sort(this[t==="end"?"byWeightReverseSortFn":"byWeightSortFn"]),n){const v=n==="widget",b={};for(f=0;f<u.length;++f)m=u[f],b[m.ref]=v?m:m.element;u=b}return u}getEndTools({alt:t,refs:r}=rm){return this.gatherTools({align:"end",alt:t,refs:r})}getStartTools({alt:t,refs:r}=rm){return this.gatherTools({align:"start",alt:t,refs:r})}get childItems(){return[...this.getStartTools(),...this._items||JM,...this.getEndTools()]}changeTools(t,r){const n=this,s=n.$tools||(n.$tools=new kr({configName:"tools",factory:z,inferType:!1,owner:n,created(a){var l,o;a.innerItem=!1,(o=a.syncRotationToDock)==null||o.call(a,(l=n.header)==null?void 0:l.dock),be.after(a,"onConfigChange",(d,{name:c})=>{QM[c]&&n.onConfigChange({name:"tools",value:s.target})}),n.onChildAdd(a)},setup(a,l){return a=T.merge({},n.toolDefaults["*"],n.toolDefaults[l],a),a.parent=n,a.ref=l,a}}));if(s.update(t),!r)return s.target}get widgetClass(){}},y(e,"$name","Toolable"),e},pw=["b-hbox","b-vbox"],e_={name:"align",style:"alignItems"},t_={name:"contentAlign",style:"alignContent"},i_={name:"direction",style:"flexDirection"},r_={name:"justify",style:"justifyContent",classes:["stretch"]},n_={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}},Fr=class extends Di{get vertical(){return this.horizontal===!1}set vertical(i){return this.horizontal=!i}updateAlign(){this.syncConfigStyle(e_)}updateContentAlign(){this.syncConfigStyle(t_)}updateDirection(){this.syncConfigStyle(i_)}updateHorizontal(){var i;const e=this,t=(i=e.contentElement)==null?void 0:i.classList,r=Number(e.vertical);t?(t.remove(pw[1-r]),t.add(pw[r])):e.syncConfigLater("horizontal"),e.syncDirection()}updateJustify(){this.syncConfigStyle(r_)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(n_)}syncDirection(){const i=this,{reverse:e}=i;i.direction=e?`${i.vertical?"column":"row"}${e?"-reverse":""}`:null}changeGap(i){return typeof i=="number"&&(i=`${i}px`),i}updateGap(i){this.syncConfigStyle({name:"gap",style:"gap"})}};y(Fr,"$name","Box"),y(Fr,"type","box"),y(Fr,"alias","hbox"),y(Fr,"configurable",{containerCls:"b-box-container",itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null,gap:null}),Fr.initClass(),Fr._$name="Box";var la=class extends Fr{};y(la,"$name","VBox"),y(la,"type","vbox"),y(la,"configurable",{horizontal:!1}),la.initClass(),la._$name="VBox";var sm=i=>{var e;return e=class extends(i||$){static get configurable(){return{badge:null}}compose(){const{badge:t}=this;return{dataset:{badge:t},class:{"b-badge":t!=null&&t!==""}}}},y(e,"$name","Badge"),e},vw=/(?:^|\s)b-icon-/,yw=/(?:^|\s)b-fa-/,s_=["items","type","widgets","html","listeners"],bw=Symbol("defaultListener"),Lt=class extends z.mixin(sm,Bu){static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,pressedCls:null,iconAlign:"start",behaviorType:"button",text:{value:null,$config:null,default:""},color:null,toggleable:void 0,pressed:!1,toggleGroup:null,supportsPressedClick:!1,supportsUnpressing:!1,ripple:{radius:75},twinForwardEvents:{item:"action"},twinSyncConfigs:null,localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,tabIndex:null,defaultBindProperty:null,split:null,keyMap:{ArrowDown:"onArrowDown"},role:""}}construct(...i){super.construct(...i),this.ion({hide:"onInternalHide"})}get twinSyncConfigs(){const i={onAction:"onItem",onClick:"onItem"};return this.toggleable&&!this.hasConfig("menu")&&(i.pressed="checked"),i}updateElement(i,e){var t,r,n;const s=this,{constructor:a}=s,l=super.updateElement(i,e),o=s.peekConfig("menu"),d=o?o.isWidget?o.role:((r=(t=a.resolveType(o.type))==null?void 0:t.configurable)==null?void 0:r.role)||((n=a.configurable.menuDefaults)==null?void 0:n.type)||"menu":!1;return s.ariaHasPopup=d,l}compose(){const{color:i,href:e,icon:t,iconAlign:r,pressed:n,pressedIcon:s,target:a,text:l,toggleable:o,toggleGroup:d,menuIcon:c,behaviorType:u,tabIndex:h,pressedCls:g,split:f}=this,m=this.hasConfig("menu"),p=n&&s?s:t,v=typeof l=="object";return{tag:e?"a":"button",href:e,target:a,tabIndex:h,type:u,class:{[`b-icon-align-${r}`]:t,[i]:!!i,"b-pressed":n&&o,"b-text":!!l,"b-has-menu":m,"b-splitbutton":f,...n&&g?Object.fromEntries(g.split(" ").map(b=>[b,1])):{}},[o&&!m?"aria-pressed":""]:n,dataset:{group:d},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:t!=null&&t.includes("/")?{"aria-hidden":!0,src:t,tag:"img",class:{"b-button-icon":1,"b-button-image":1}}:(t||s)&&{"aria-hidden":!0,tag:"i",class:{...te.normalize(p,"object"),"b-button-icon":1,"b-icon":vw.test(p),"b-fa":yw.test(p)}},label:l&&this.ariaLabel!==l&&{tag:"label",for:this.id,[v?"children":"text"]:v?B.asArray(l):l,class:{"b-button-custom-content":v}},menuIconElement:m&&c&&{tag:"i",class:{"b-icon":vw.test(c),"b-fa":yw.test(c),"b-button-menu-icon":1,[c]:1}}}}}onInternalHide(){var i;(i=this._menu)==null||i.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(i){var e;super.onFocusOut(i),(e=this.menu)==null||e.hide()}get focusElement(){return this.element}changeText(i){return i==null?"":i}changeToggleable(i){return i===void 0&&(i=!!(this.toggleGroup||this.config.menu)),i}changeMenu(i,e){const t=this,{element:r}=t;return i?(i.isWidget?(i.forElement=r,i.owner=t,i.constrainTo=t.rootElement):(typeof i=="object"&&!s_.some(n=>n in i)&&(i={lazyItems:i}),i=z.reconfigure(e,i?T.merge({owner:t,constrainTo:t.rootElement,forElement:r},t.menuDefaults,i):null,t)),i.align.constrainPadding=10,t.detachListeners(bw),i.ion({name:bw,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):e==null||e.destroy(),i}onMenuBeforeShow({source:i}){return this.trigger("beforeShowMenu",{menu:i})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(i){this.toggleable=!!i}updatePressed(i){const e=this;!e.toggleable||e.isConfiguring||(i&&E.forEachSelector(e.rootElement,`button[data-group=${e.toggleGroup}]`,t=>{t!==e.element&&(z.getById(t.id).pressed=!1)}),e.toggleMenu(e.split?!1:i),e.trigger("toggle",{pressed:i,userAction:!!e.triggeredByEvent}))}configureOverflowTwin(i){const e=this,t=super.configureOverflowTwin(i),{menu:r}=e;return t.type=z.resolveType("menuitem"),r?t.menu=e.constructor.mergeConfigs(t.menu,{type:"menu",items:r.items.map(n=>n.ensureOverflowTwin())}):e.toggleable&&(t.checked=e.pressed),t.text||(t.text=e.text||e.tooltipText),t}onInternalMousedown(i){var e;(Y.isSafari||(e=this._menu)!=null&&e.containsFocus&&this.pressed)&&i.preventDefault()}changeTooltip(i,e){const t=this,r=(i==null?void 0:i.html)||i;return!t.ariaLabel&&!t.text&&typeof r=="string"&&(t.ariaLabel=t.optionalL(r,t)),super.changeTooltip(i,e)}onArrowDown(){if(this.menu)this.toggleMenu(!0);else return!1}onInternalClick(i){var e;const t=this,r={event:i};if(!t.disabled){if(t.split&&i.target.closest(".b-button-menu-icon")){t.toggleMenu(!((e=t._menu)!=null&&e.isVisible));return}if(t.triggeredByEvent=i,t.toggleable){const n=t.toggleGroup&&t.pressed&&!t.supportsUnpressing;if(n&&!t.supportsPressedClick||(n||t.toggle(!t.pressed),t.isDestroyed))return}t.trigger("click",r),t.isDestroyed||t.trigger("action",r),t.href||(i.preventDefault(),i.stopPropagation()),t.triggeredByEvent=null}}toggle(i=!this.pressed){this.trigger("beforeToggle",{pressed:i,userAction:!!this.triggeredByEvent})!==!1&&(this.pressed=i)}toggleMenu(i){var e,t,r;if(i){const{menu:n}=this;n&&(n.owner=this,n.forElement=this.element,n.initialConfig.minWidth||(n.minWidth=this.width),n.align.minHeight=(e=n._minHeight)!=null?e:100,n.align.minWidth=(t=n._minWidth)!=null?t:100,n.show())}else(r=this._menu)==null||r.hide()}};y(Lt,"$name","Button"),y(Lt,"type","button"),Lt.initClass(),Lt._$name="Button";var Cw={refs:"element"},a_=i=>i.element.style.margin="",l_=i=>i.isToolbar,ww=i=>i[0]+(i[1].minifiable?0:9e9),Sw={hidden:!1,width:""},o_={...Sw,flex:""},d_={flex:1,hidden:1,maxWidth:1,minWidth:1,width:1,disabled:1},c_=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],u_={delay:0,startRate:40,endRate:200,accelerateDuration:500},h_={menu:1,pressed:1},oa=class xE extends gt.mixin(nm){static getEvictionList(e){const t=e.filter(r=>r.overflowable!=="none");return t.forEach((r,n)=>t[n]=[n,r]),t.sort((r,n)=>ww(n)-ww(r)),t}updateEnableReordering(e){var t;const r=this;e?r.dragHelper=new si({name:"itemReorder",mode:"container",lockY:!0,dragThreshold:10,targetSelector:".b-widget",floatRootOwner:r,rtlSource:r,outerElement:r.contentElement,containers:[r.contentElement],internalListeners:{beforeDragStart:r.onBeforeDragStart,dragstart:r.onDragStart,itemMove:r.onItemMove,drop:r.onDrop,thisObj:r}}):(t=r.dragHelper)==null||t.destroy()}compose(){const e=this,{axisProps:t,dock:r}=e,n=e.getEndTools(Cw),s=e.getStartTools(Cw);return{class:{[`b-dock-${r}`]:1,[`b-${r}-toolbar`]:1,[`b-${t.box}`]:1},children:{...s,toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}},...n}}}get axisProps(){return c_[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return(e=this.tools)==null?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return typeof e=="string"?e:e==null?void 0:e.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),(t=e.syncRotationToDock)==null||t.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){be.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget(t=>this.processAddedLeafItem(t))}onInternalPaint({firstPaint:e}){var t;(t=super.onInternalPaint)==null||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){var t;const r=this,{layout:n}=r,{vertical:s}=n;if(n.vertical=cw(e)[1],!r.initialItems){s!==n.vertical&&r.updateOverflow(r.overflow);for(const a of r.childItems)(t=a.syncRotationToDock)==null||t.call(a,e)}}updateOverflow(e,t){var r,n;const s=this,{axisProps:a,contentElement:l,overflowType:o}=s,{flexDir:d}=a,c=(r=s.overflowMenuButton)==null?void 0:r._menu,u={};if(c&&(e?c==null||c.removeAll():c.eachWidget(h=>{h._overflowTwinOrigin.overflowTwin=null})),t==="menu"?u.overflowMenuButton=null:t==="scroll"&&(u.overflowScrollStart=u.overflowScrollEnd=null),o==="menu")(n=s.scrollable)==null||n.destroy(),l.style.overflow=l.style.overflowX=l.style.overflowY="",u.overflowMenuButton={cls:{[`b-${d}-menu`]:1}};else if(o==="scroll"){const h=typeof e=="object"&&(e==null?void 0:e.repeat)||u_;s.scrollable={[a.overflow]:"hidden-scroll",element:l,internalListeners:{scroll:"onContentScroll",thisObj:s}},u.overflowScrollStart={repeat:h,invertRotate:!0,cls:{[`b-${d}-start-scroller`]:1}},u.overflowScrollEnd={repeat:h,invertRotate:!0,cls:{[`b-${d}-end-scroller`]:1}}}s.tools=u,o?(l.classList.add("b-overflow"),s.monitorResize=!0,s.syncOverflowVisibility()):(l.classList.remove("b-overflow"),s.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:r,isVisible:n}=e,{clientSizeProp:s,edgeProp:a,sizeProp:l}=e.axisProps,{overflowMenuButton:o,overflowScrollStart:d,overflowScrollEnd:c}=e.tools,u=e.rtl&&e.layout.horizontal,h=t==="menu",g=()=>Math.ceil(r[s]+(!d||d.hidden?0:d.rectangle("outer")[l])+(!c||c.hidden?0:c.rectangle("outer")[l])),f=()=>{if(k.length===0)return 0;const F=k[k.length-1].rectangle(r);return Math.floor(u?r[s]-F.left:F[a])};let m,p,v,b,w,D,S,x,R,M,_,k;if(!(!n||!t||e.items.length===0)){if(e.inSyncOverflowVisibility=!0,o==null||o.hide(),e.eachWidget((F,I)=>{S=F.minifiable,M=F.overflowable,M=S?M||S:M,F.floating?I.down=!1:(I.down=!M,F.innerItem&&(F._toolbarOverflow&&(F.hidden=F._toolbarOverflow=!1),F._toolbarMinified&&(F.minified=F._toolbarMinified=!1),F.isVisible&&(S&&(x||(x=[])).push(F),M&&(k||(k=[])).push(F))))}),k&&(m=g(),p=f()),k&&p>m)if(h){for(;p>m&&(w=x==null?void 0:x.pop());)D=p,w._toolbarMinified=!0,w.minified=!0,p=f(),D-=p,(R||(R=[])).push([w,D]);if(p>m){o.show(),m=g(),b=xE.getEvictionList(k);for(v of b)p>m&&(w=v[1],w._toolbarOverflowWidth=w.width,w._toolbarOverflow=!0,w.hidden=!0,k.splice(k.indexOf(w),1),(_||(_=[])).push(v),p=f());if(_){for(_.sort((F,I)=>F[0]-I[0]).forEach((F,I)=>_[I]=F[1]);R!=null&&R.length;)[w,D]=R.pop(),p+D<=m&&!w._toolbarOverflow&&(p+=D,w.minified=w._toolbarMinified=!1);e.syncOverflowMenuButton(_)}else o.hide()}}else c.show(),d.show(),e.syncScrollerState();else h||(c==null||c.hide(),d==null||d.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var t;const r=this,{axisProps:n,overflowMenuButton:s}=r,a={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:n.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};for(const l of e)r.overflowItemFilter(l)&&l.addToOverflowMenu(a,r.horizontal?o_:Sw,a_);if(a.items.forEach(l=>{let o=l._overflowTwinOrigin,d=o.parent.indexOfChild(o);o.parent!==r&&(d=r.indexOfChild(o.parent)+d/1e5),l.weight=d}),(t=s._menu)!=null&&t.isMenu){const l=s.menu,{toAdd:o,toRemove:d}=B.delta(a.items,l.items,!0);l.remove(d),l.add(o)}else s.menu=a}syncScrollerState(){const e=this,{axisProps:t,scrollable:r}=e,{overflowScrollStart:n,overflowScrollEnd:s}=e.tools,a=r[t.pos],l=r[t.max];n.disabled=!a,s.disabled=Math.abs(Math.ceil(a))>=Math.abs(l)}overflowItemFilter(e){const{filter:t}=this.overflow;return!!(t?t.call(this,e):E.getChildElementCount(e.element))}onLeafItemConfigChange(e,{name:t,value:r}){const n=this,s=n.up(l_),a=s.hasConfig("overflow"),{overflowTwin:l}=n;!a||s!=null&&s.inSyncOverflowVisibility||t==="hidden"&&r===n._toolbarOverflow||!d_[t]&&(n._width!=null&&!n.monitorResize||n._flex&&!String(n._flex).endsWith("auto"))||(l&&!h_[t]&&(l[t]=r),s!=null&&s.isPainted&&n.ref!=="overflowMenuButton"&&((n.isTextField||n.isSlider||n.isCheckbox)&&t==="value"&&(n.containsFocus||l!=null&&l.containsFocus)||s.syncOverflowVisibility()))}createWidget(e){e==="->"?e={type:"widget",cls:"b-toolbar-fill"}:e==="|"?e={type:"widget",cls:"b-toolbar-separator"}:typeof e=="string"&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}onBeforeDragStart({context:e,event:t}){const r=e.item=this.items[e.element.dataset.itemIndex];return e.oldIndex=Number.parseInt(r.element.dataset.itemIndex,10),this.trigger("beforeItemDragStart",{item:r,domEvent:t})}onDragStart({context:e,event:t}){const{item:r}=e;e.dragProxy.style.backgroundColor=globalThis.getComputedStyle(this.element).backgroundColor,this.trigger("itemDragStart",{item:r,domEvent:t})}onItemMove({context:e,event:t}){const{item:r}=e,n=Array.from(r.element.parentElement.children).indexOf(r.element);this.insert(r,n),this.trigger("itemDragMove",{item:r,domEvent:t})}onDrop({context:e,event:t}){const r=this,{item:n,valid:s}=e;r.trigger("itemDrop",{item:n,domEvent:t,valid:s})}doDestroy(){var e;(e=this.dragHelper)==null||e.destroy(),super.doDestroy()}};y(oa,"$name","Toolbar"),y(oa,"type","toolbar"),y(oa,"delayable",{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}),y(oa,"configurable",{role:"toolbar",defaultType:"button",dock:"top",layout:{type:"box"},enableReordering:null,overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,ariaLabel:"L{Toolbar.showOverflowingItems}",defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,ariaLabel:"L{Toolbar.scrollForMore}",defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,ariaLabel:"L{Toolbar.scrollForMore}",defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}),y(oa,"prototypeProperties",{flexRowCls:"b-hbox",flexColCls:"b-vbox"});var kn=oa;kn.initClass(),kn._$name="Toolbar";var g_=i=>!i.classList.contains("b-focus-trap")&&!i.classList.contains("b-hidden")&&E.getFocusability(i).focusable?E.NodeFilter.FILTER_ACCEPT:E.NodeFilter.FILTER_SKIP,Dw=[],f_={},am=[Dw,Dw],Ew=(i,e,t)=>{const{vertical:r}=i;return delete i.vertical,{...i,class:{...e,[`b-${r?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!t}}},lm=(i,e,t=!1)=>{const r={vertical:t,children:i?[i]:[]};return e&&(r.tag=e),r},ju=(i,e)=>{i!=null&&i.classList?i==null||i.classList.add(e):i!=null&&i.class&&(typeof i.class=="string"&&(i.class={[i.class]:1}),i.class[e]=1)},m_={dock:1,hidden:1,weight:1},Ei={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},xw={header:1,"pre-header":1},p_={top:"up",right:"right",bottom:"down",left:"left"},om=class _g extends gt.mixin(Po,nm){static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:null,drawer:{$config:"lazy",value:null}}}get bodyWrapRootElement(){return this[this._bodyWrapRootName]}changeFooter(e){return e&&(e.dock==="start"?e.dock="left":e.dock==="end"&&(e.dock="right")),e}compose(){var e,t;const r=this,{collapsible:n,focusable:s,revealed:a,tools:l,role:o,floating:d}=r,c=r.composeHeader(),u=r.getPositionableItems("after",!0),h=r.getPositionableItems("before",!0),g=(c==null?void 0:c.class["b-dock-left"])||(c==null?void 0:c.class["b-dock-right"]),f=(t=(e=c==null?void 0:c.children)==null?void 0:e[0])==null?void 0:t.id;let m=r.composeBody(),p="bodyWrapElement";n&&([p,m]=n.wrapCollapser(p,m)),r._bodyWrapRootName=p;const v={role:o&&r._ariaElement==="element"?o:d?"dialog":"region",tabIndex:(d||r.peekConfig("positioned"))&&s!==!1?-1:s?0:null,class:{[`b-panel-collapsible-${n==null?void 0:n.type}`]:n,[`b-panel-collapse-${n==null?void 0:n.collapseDir}`]:n,[`b-${g?"h":"v"}box`]:1,"b-panel-collapsible":n,"b-panel-has-header":c,"b-panel-has-tools":l?1:0,"b-panel-overlay-revealed":a},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-top-focus-trap":1}},...h,headerElement:c,[p]:m,...u,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}};return f&&(v["aria-labelledby"]=f),v}updateElement(){this.getConfig("drawer"),super.updateElement(...arguments)}updateDrawer(e){var t;let{side:r="end",inline:n}=e;const s=this,{element:a,rtl:l}=s,o=s.getRenderContext()[0]||(n?document.body:null),d=s.parent||o&&!n?"positioned":"floating";r=r==="start"?l?"right":"left":r==="end"?l?"left":"right":r,s.updateConfiguration({forElement:null,closable:!1,align:null,autoShow:!1,monitorResize:!1,centered:!1,anchor:!1,hidden:!1,draggable:!1,appendTo:o||((t=s.owner)==null?void 0:t.floatRoot)||s.floatRoot,hideMode:"collapse",trapFocus:!0,[d]:!n,collapsed:typeof e=="object"&&"collapsed"in e?e.collapsed:!0,collapsible:{...e,type:n?"inline":"overlay",direction:p_[r||"end"]}}),a.classList.add("b-drawer-panel"),a.classList.remove("b-popup"),a.style.setProperty("--b-drawer-size",E.setLength(e==null?void 0:e.size)),s.ion({thisObj:s,reveal:()=>s.trigger("show"),unreveal:()=>s.trigger("hide")})}get isVisible(){return this.drawer?!this.collapsible.collapsed||this.revealed:super.isVisible}hide(){const e=this;if(e.drawer){if(e.trigger("beforeHide")!==!1){const t=e.collapsible.type==="inline"?e.collapse():e.collapsible.toggleReveal(!1);return e.trigger("hide"),t}}else return super.hide(...arguments)}show(){const e=this;if(e.drawer){if(e.trigger("beforeShow")!==!1){const t=e.collapsible.type==="inline"?e.expand():e.collapsible.toggleReveal(!0);return e.afterShow(),e.focus(),t}}else return super.show(...arguments)}showBy(){return this.drawer?this.show():super.showBy(...arguments)}composeBody(){var e,t;const r=this,{bodyCls:n,bodyConfig:s,bodyWrapTag:a,footer:l,uiClassList:o}=r,d=T.values(r.strips,(w,D)=>!Ei[D==null?void 0:D.dock]).sort(r.byWeightSortFn),c={top:null,right:null,bottom:null,left:null};let u,h,g,f,m,p,v;for(l&&(g=l.dock||"bottom",d.unshift({dock:g,element:{tag:"footer",reference:"footerElement",html:typeof l=="string"?l:l.html,class:{...o,[`b-dock-${g}`]:1,[`${l.cls||""}`]:1}}})),n&&(s[m="className"]||(m="class"),s[m]=new te(s[m]).assign(n)),f=d.length;f-- >0;)u=d[f],[p,h]=Ei[u.dock],v?v.vertical!==p&&(v=lm(Ew(v,o),"",p)):v=lm(s,a,p),v.children[h?"unshift":"push"](u.element),c[u.dock]=u;ju(c.top,"b-innermost"),ju(c.right,"b-innermost"),ju(c.bottom,"b-innermost"),ju(c.left,"b-innermost");const b=Ew(v||lm(s,a),o,!0);return b.class[`${(e=r.layout)==null?void 0:e.containerCls}-panel`]=!!((t=r.layout)!=null&&t.containerCls),b.class["b-panel-body-wrap"]=1,b.class[`b-${r.$$name.toLowerCase()}-body-wrap`]=1,b}get hasHeader(){if(this.header===!1)return!1;const{header:e,title:t,tools:r,parent:n}=this,s=this.maximizable||Object.values(r||{}).some(a=>!a.hidden);return e||!(n!=null&&n.suppressChildHeaders)&&(t||s)}get rootUiClass(){return _g}changeHeader(e){return typeof e=="string"?{title:e}:e}composeHeader(e){var t;const r=this;if(!r.hasHeader&&!e)return;const n=r.header||{},s=n.dock||"top",[a,l]=r.splitHeaderItems({as:"element",dock:s}),o=r.$meta.hierarchy,d=r.composeTitle(n),c=new te({[`b-dock-${s}`]:1,...r.uiClassList},n.cls);let u,h;for(u=o.indexOf(_g);u<o.length;++u)h=o[u].$$name,h!=="Grid"&&(c[`b-${h.toLowerCase()}-header`]=1);const g={...n,tag:"header",class:c,children:[...a,d,...l]};return((t=r.collapsible)==null?void 0:t.composeHeader(g))||g}composeTitle(e){var t;const r=this.title||e.title,n={reference:"titleElement",id:`${this.id}-panel-title`,"aria-live":"polite",class:{[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1,...this.uiClassList}};if(r)if(T.isObject(r))T.merge(n,r);else{const{iconCls:s}=e;s?n.children=[{tag:"i",class:"b-panel-title-icon "+s},r]:n.html=r}return((t=this.collapsible)==null?void 0:t.composeTitle(n))||n}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const t=this,{headerElement:r}=t;(e=t._headerClickDetacher)==null||e.call(t),t._headerClickDetacher=r&&V.on({element:r,click:n=>{var s;return(s=t.trigger)==null?void 0:s.call(t,"panelHeaderClick",{event:n})}})}onPanelHeaderClick(e){var t;(t=this.collapsible)==null||t.onPanelHeaderClick(e)}onInternalPaint(){var e;super.onInternalPaint(...arguments),(e=this.collapsible)==null||e.onPanelPaint(this)}splitHeaderItems({as:e,dock:t,alt:r}=f_){var n,s,a,l;const o=this,d=e==="element",{collapsed:c}=o,u=o.getEndTools({alt:r}),h=o.getStartTools({alt:r}),g=T.values(o.strips,(b,w)=>!xw[w==null?void 0:w.dock]&&w.isCollapsified({collapsed:c,alt:r}));let f=am,m,p,v;if(g.length+u.length+h.length){for(f=[p=[...h,...g.filter(b=>b.dock==="pre-header").sort(o.byWeightSortFn)],m=[...g.filter(b=>b.dock==="header").sort(o.byWeightReverseSortFn),...u]],v=0;v<p.length;++v)t&&((s=(n=p[v]).syncRotationToDock)==null||s.call(n,t)),d&&(p[v]=p[v].element);for(v=0;v<m.length;++v)t&&((l=(a=m[v]).syncRotationToDock)==null||l.call(a,t)),d&&(m[v]=m[v].element)}return f}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:t}=e,r=T.merge({reference:"bodyElement",className:{...e.getStaticWidgetClasses(_g,"-content"),"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren}},e._bodyConfig);return t&&(r.tag=t),r}changeBodyCls(e){return te.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const t=this,r=T.values(t.strips,(o,d)=>!Ei[d==null?void 0:d.dock]).sort(t.byWeightSortFn),[n,s]=t.splitHeaderItems(),[a,l]=((e=t.collapsible)==null?void 0:e.splitHeaderItems())||am;return[...n,...a,...s,...l,...r.filter(o=>Ei[o.dock][1]),...t.items,...r.filter(o=>!Ei[o.dock][1]).reverse()]}get childItemsOrderedByRelevance(){var e;const t=this,r=T.values(t.strips,(o,d)=>!Ei[d==null?void 0:d.dock]).sort(t.byWeightSortFn),[n,s]=t.splitHeaderItems(),[a,l]=((e=t.collapsible)==null?void 0:e.splitHeaderItems())||am;return[...t.items,...r.filter(o=>!Ei[o.dock][1]).reverse(),...n,...a,...s,...l,...r.filter(o=>Ei[o.dock][1])]}changeStrips(e,t){const r=this,n=r.$strips||(r.$strips=new kr({configName:"strips",factory:z,inferType:!1,owner:r,created(s){var a;const{dock:l}=s;if(!xw[l]&&!Ei[l])throw new Error(`Invalid dock value "${l}"; must be: top, left, right, bottom, header, or pre-header`);be.after(s,"onConfigChange",(o,{name:d})=>{m_[d]&&r.onConfigChange({name:"strips",value:n.target})}),s.innerItem=!1,r.onChildAdd(s),s.parent=r,(a=s.layout)==null||a.renderChildren(),s.hasItems&&(r.hasItems=!0)},setup(s,a){return s=T.merge(T.clone(r.stripDefaults["*"]),r.stripDefaults[a],s),s.parent=r,s.ref=a,s},transform(s){return Array.isArray(s)&&(s={items:s}),s||null}}));if(n.update(e),!t)return n.target}get collapsing(){var e;return(e=this.collapsible)==null?void 0:e.collapsing}get collapsingExpanding(){var e;return(e=this.collapsible)==null?void 0:e.collapsingExpanding}get expanding(){var e;return(e=this.collapsible)==null?void 0:e.expanding}changeCollapsed(e){const t=this,{collapsible:r}=t;if(t.recompose.flush(),e=!!e,!r||t.changingCollapse||!t.isPainted)return e;r==null||r.collapse({animation:null,collapsed:e})}changeCollapsible(e,t){const r=this;return r.getConfig("tools"),e&&(e===!0?e={}:typeof e=="string"&&(e={[Ei[e]?"direction":"type"]:e})),Yi.reconfigure(t,e,{owner:r,defaults:{panel:r},cleanup(){r.collapsed&&!e&&(t.collapse({animation:null,collapsed:!1}),r._collapsed=1)}})}updateCollapsible(e){const t=this,r=e==null?void 0:e.toolsConfig;t.tools={collapse:(r==null?void 0:r.collapse)||null,recollapse:(r==null?void 0:r.recollapse)||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),t.collapsed===1&&(t.collapsed=!0)}_collapse(e,t){var r;return t!==!0&&t!==void 0&&(t===!1?e.collapsed=!e.collapsed:typeof t=="number"?e.animation={duration:t}:t===null?e.animation=t:t===!0||("animation"in t?T.merge(e,t):e.animation=t)),(r=this.collapsible)==null?void 0:r.collapse(e)}collapse(e){return this.collapsePanel(e)}expand(e){return this.expandPanel(e)}collapsePanel(e){return this._collapse({collapsed:!0},e)}expandPanel(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e,t){return typeof e=="boolean"?e?this.collapse(t):this.expand(t):this.collapsed?this.expand(t):this.collapse(t)}get expandedHeaderDock(){var e,t,r;return(r=(t=this._expandedHeaderDock)!=null?t:(e=this.initialConfig.header)==null?void 0:e.dock)!=null?r:"top"}set expandedHeaderDock(e){this._expandedHeaderDock=e==null?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=e==null?void 0:e.dock)}updateTrapFocus(e){var t;const r=this,{element:n}=r,{classList:s}=n,a=e==="before",l=e==="after";s.toggle("b-focus-trapped",e&&!a&&!l),s.toggle("b-focus-trapped-before",a),s.toggle("b-focus-trapped-after",l),r.focusTrapListener=(t=r.focusTrapListener)==null?void 0:t.call(r),r[e?"addKeyBinding":"removeKeyBinding"]("shift+Tab","trapTabOut"),e&&(r.focusTrapListener=V.on({element:n,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:r}),r.treeWalker||(r.treeWalker=r.setupTreeWalker(n,E.NodeFilter.SHOW_ELEMENT,g_)))}setupTreeWalker(e,t,r){return document.createTreeWalker(e,t,r)}trapTabOut(e){if(e.target===this.element)e.preventDefault(),this.bottomFocusTrap.focus();else return!1}onFocusTrapped(e){const t=this,{target:r}=e,n=t.treeWalker,s=r===t.bottomFocusTrap,a=r===t.topFocusTrap;t.trigger("focusTrap",{target:r,bottom:s,top:a})!==!1&&(a||s)&&(s||e.relatedTarget===t.element&&e.shiftKey?(n.currentNode=t.topFocusTrap,n.nextNode()):(n.currentNode=t.bottomFocusTrap,n.previousNode()),t.requestAnimationFrame(()=>n.currentNode.focus()))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}getPositionableLocation(e){let t,r;return e==="before"?r=this.headerElement||this.bodyWrapRootElement:e==="after"?r=this.bottomFocusTrap:t=this.contentElement,[t,r]}get widgetClassList(){var e;const t=this,r=super.widgetClassList;return t.hasHeader&&r.push("b-panel-has-header",`b-header-dock-${((e=t.header)==null?void 0:e.dock)||"top"}`),t.tbar&&r.push("b-panel-has-top-toolbar"),t.bbar&&r.push("b-panel-has-bottom-toolbar"),r}};y(om,"$name","Panel"),y(om,"type","panel");var Xe=om;Xe.initClass(),Xe._$name="Panel";var v_={topStart:"top-start",topEnd:"top-end",bottomEnd:"bottom-end",bottomStart:"bottom-start",top:"top",end:"end",bottom:"bottom",start:"start"},Uu=class extends $.mixin(Fe){construct(i){if(super.construct(i),!this.element)throw new Error("ElementResizeHelper: `element` is required.")}updateElement(i){var e;globalThis.getComputedStyle(i).position==="static"&&console.warn("ElementResizeHelper: `element` must be positioned (absolute or relative) for resizing to work."),(e=this.pointerDownListeners)==null||e.call(this),this.pointerDownListeners=V.on({element:i,pointerdown:"onResizePointerDown",delegate:".b-resize-grip",thisObj:this})}updateHandles(i){const{element:e}=this;E.removeEachSelector(e,".b-resize-grip");for(const t in i)if(i[t]!==!1){const r=document.createElement("div");r.className=`b-resize-grip b-resize-grip-${v_[t]}`,e.appendChild(r)}}onResizePointerDown(i){var e;const t=this,{element:r}=t;if(t.handleType=i.target.className.replace("b-resize-grip b-resize-grip-","").trim(),i.button!==0||t.trigger("beforeResizeStart",{element:r,handle:t.handleType})===!1)return;i.preventDefault();const n=globalThis.getComputedStyle(r),s=r.getBoundingClientRect(),a=parseFloat(n.top)||0,l=parseFloat(n.insetInlineStart)||0;t.initialX=i.clientX,t.initialY=i.clientY,t.initialTop=a,t.initialStart=l,t.initialWidth=s.width,t.initialHeight=s.height,t.trigger("resizeStart",{element:r,handle:t.handleType}),(e=t.removeMoveListeners)==null||e.call(t),t.removeMoveListeners=V.on({element:document.body,pointermove:"onResizePointerMove",thisObj:t}),t.removeDocUpListeners=V.on({element:document,pointerup:"onResizePointerUp",capture:!0,thisObj:t,once:!0})}onResizePointerMove(i){const e=this,{element:t,handleType:r,rtl:n,minHeight:s,minWidth:a,initialStart:l,initialTop:o,initialWidth:d,initialHeight:c,initialX:u,initialY:h,maxWidth:g,maxHeight:f}=e,m=i.clientX-u,p=i.clientY-h,v=d-(a||1),b=n?-1:1,{shiftKey:w}=i;let D=l,S=o,x=d,R=c;if(r.includes("start")?(D=l+Math.min(m,v)*b,x=d-m*b):r.includes("end")&&(x=d+m*b),r.includes("top")?(S=o+Math.min(p,c-(s||1)),R=c-p):r.includes("bottom")&&(R=c+p),w){const M=d/c;Math.abs(m)>Math.abs(p)?R=x/M:x=R*M}a!==null&&(x=Math.max(x,a)),g!==null&&(x=Math.min(x,g||document.body.offsetWidth)),s!==null&&(R=Math.max(R,s)),f!==null&&(R=Math.min(R,f||document.body.offsetWidth)),(!n||!r.includes("start")||x>a)&&(t.style.insetInlineStart=Math.max(D,0)+"px"),t.style.top=S+"px",t.style.width=x+"px",t.style.height=R+"px"}onResizePointerUp(i){var e,t;(e=this.removeDocUpListeners)==null||e.call(this),(t=this.removeMoveListeners)==null||t.call(this),this.removeMoveListeners=null,this.removeDocUpListeners=null}get isResizing(){return!!this.removeMoveListeners}doDestroy(){this.onResizePointerUp(),this.pointerDownListeners(),E.removeEachSelector(this.element,".b-resize-grip"),super.doDestroy()}};y(Uu,"configurable",{element:null,minWidth:50,maxWidth:null,minHeight:50,maxHeight:null,rtl:null,handles:{topStart:!0,top:!0,topEnd:!0,end:!0,bottomEnd:!0,bottom:!0,bottomStart:!0,start:!0}}),Uu._$name="ElementResizeHelper";var Rw=i=>{var e;return e=class extends(i||$){updateResizable(t){var r;const n=this;if(t){const s=typeof t=="object"?t:{};n.resizeHelper=new Uu(T.assign({element:n.element,internalListeners:{resizeStart:n.onResizeStart,thisObj:n}},s))}else(r=n.resizeHelper)==null||r.destroy()}onResizeStart(){this.alignTo(null)}doDestroy(){var t;(t=this.resizeHelper)==null||t.destroy(),super.doDestroy()}updateRtl(t){super.updateRtl(t),this.resizeHelper&&(this.resizeHelper.rtl=t)}},y(e,"$name","Resizable"),y(e,"configurable",{resizable:null}),e},Gu=class Ns extends Xe.mixin(Rw){finalizeInit(){const e=this,{forElement:t}=e;e.anchoredTo=t,e.initialAnchor=e.anchor,t&&e.showOnClick!==!1&&(e.initialConfig.autoShow||(e.autoShow=!1),V.on({element:t,[e.showOnClick===2?"contextmenu":"click"]:"onElementUserAction",thisObj:e,capture:!0})),super.finalizeInit(),e.autoShow&&(!t||E.isVisible(t))&&(e.autoShow===!0?e.show():e.setTimeout(()=>e.show(),e.autoShow))}onInternalPaint({firstPaint:e}){var t;(t=super.onInternalPaint)==null||t.call(this,...arguments);const r=this;e&&r.headerElement&&V.on({element:r.headerElement,dblclick:r.onHeaderDblClick,thisObj:r})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":!!(t&&e)}}}close(){if(!this._hidden){const e=this.trigger("beforeClose");if(T.isPromise(e))return e.then(t=>{t!==!1&&this.doClose()}),e;if(e===!1)return e}this.doClose()}doClose(){var e,t;const r=this,{closeAction:n}=r;if(!r._hidden||n==="destroy"){r.modal&&n==="destroy"&&r.revertFocus(),r.unmask();const s=r.items.length&&((e=r.items.find(a=>a.errorTip))==null?void 0:e.errorTip);return s&&((t=s.pointerOverOutDetacher)==null||t.call(s),s.hide()),r[n]()}}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){e=!!e,this.element.classList.toggle("b-maximized",!!e),this.draggable&&(this.draggable.disabled=e)}onInternalKeyDown(e){const t=this;e.key==="Escape"&&t.closeOnEscape&&(e.stopImmediatePropagation(),t.floating||t.positioned?t.close(!0):t.collapsible&&(t.revealed?t.collapsible.toggleReveal():t.collapse()))}onDocumentMouseDown({event:e}){const t=this,{owner:r}=t,{target:n}=e;if(t.isVisible){if(e.type!=="touchend"&&(r!=null&&r.isButton)&&r._menu===t&&r.element.contains(n))return e.preventDefault(),!1;if(t.modal&&n===Ns.modalMask)e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus();else if(!t.owns(n,!0)&&t.autoClose&&e.type==="mousedown")if(t.containsFocus){const s=E.getActiveElement(t.element);V.on({element:document,once:!0,expires:100,[e.type]:a=>{a.defaultPrevented&&E.getActiveElement(t.element)===s&&t.close()}})}else t.close()}}get isTopModal(){return!this._isRevertingFocus&&E.isVisible(Ns.modalMask)&&this.element.previousElementSibling===Ns.modalMask}onFocusIn(e){const t=E.getActiveElement(this);super.onFocusIn(e),E.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){!(globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1)&&!this.modal&&this.autoClose&&this.close(),super.onFocusOut(e)}afterShow(){const e=this;(e.autoClose||e.modal)&&e.addDocumentMouseDownListener(),super.afterShow(...arguments),e.toFront()}toFront(){this.floating&&(super.toFront(),this.syncModalMask()),this.focusOnToFront&&!this.containsFocus&&this.focus()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=le.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){const t=this;e?(t.element.setAttribute("aria-modal",!0),t.floating=!0,typeof t._x!="number"&&typeof t._y!="number"&&!t.hasConfig("centered")&&(t.centered=!0,t.anchor=!1)):t.element.removeAttribute("aria-modal")}syncModalMask(){const e=this,{modal:t,element:r}=e;if(t&&e.isVisible)e.modalMask.classList.remove("b-hide-display"),e.modalMask.classList.toggle("b-modal-transparent",!!t.transparent),r.classList.add("b-modal"),e.modalMask.setAttribute("owned-by",e.id);else if(e.isPainted){r.classList.remove("b-modal");const n=e.floatRoot.querySelectorAll(".b-modal"),s=n.length?Ns.fromElement(n[n.length-1],"popup"):null;s?s.syncModalMask():Ns.modalMask.classList.add("b-hide-display")}}afterHide(){var e;const t=this;super.afterHide(...arguments),(e=t.mouseDownRemover)==null||e.call(t),t.mouseDownRemover=null,t.syncModalMask()}onElementUserAction(e){const{showOnClick:t}=this;(typeof t!="number"||t===e.button)&&(e.button===2&&e.preventDefault(),this.show())}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=Ns;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=E.createElement({className:"b-modal-mask b-hide-display"}),V.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}};y(Gu,"$name","Popup"),y(Gu,"type","popup"),y(Gu,"configurable",{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,draggable:!0,draggableBlacklistSelector:"button,.b-field-inner,.b-gridbase,.b-calendarmixin,.b-resize-grip",hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog",closeOnEscape:!0});var ft=Gu;ft.initClass(),ft._$name="Popup";var y_=/^b-icon-/,b_=/^b-fa-/,ai=class extends z{static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},menuDefaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,floating:!0,autoShow:!1,cls:{"b-sub-menu":1}},icon:null,text:null,closeParent:null,href:null,radio:null,target:null,localizableProperties:["text"],role:"menuitem",openMenuDelay:120}}updateElement(i,e){const t=this,r=super.updateElement(i,e);return typeof t.checked=="boolean"?t.role="menuitemcheckbox":t.href&&(t.role=null),t.ariaHasPopup=t.hasMenu?"menu":!1,r}compose(){var i;const e=this,{checked:t,href:r,hasMenu:n,radio:s,separator:a,target:l,text:o}=e,d=typeof t=="boolean",c=e.icon||(d?"b-fw-icon":""),u=`b-icon-${s?"radio-":""}`,h=typeof o=="object";return{tag:r?"a":"div",tabIndex:-1,href:r,target:l,class:{"b-has-submenu":n,"b-checked":t,"b-separator":a||((i=e.cls)==null?void 0:i["b-separator"])},dataset:{group:e.toggleGroup},[d?"aria-checked":""]:t,[n?"aria-expanded":""]:!1,children:{iconElement:c&&{"aria-hidden":!0,tag:"i",class:{"b-fa":b_.test(c),"b-icon":y_.test(c),"b-menuitem-icon":1,[`${u}checked`]:t===!0,[`${u}unchecked`]:t===!1,...te.normalize(c,"object")}},textElement:{tag:"span",[h?void 0:"text"]:h?void 0:o,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?B.asArray(o):null},subMenuIcon:n&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(i){const e=this,t=this.parent,r={menu:t,item:e,element:e.element,bubbles:!0,domEvent:i};if(typeof e.checked=="boolean"){const n=!e.checked;(!e.toggleGroup||n)&&(e.checked=!e.checked)}else e.href&&i.key&&e.element.click();e.trigger("beforeItem",r),e.trigger("item",r),e.closeParent&&t&&(t.rootMenu.close(),i&&!e.href&&i.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:i}=this;return i&&this.isVisible&&(i===document.body||i.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:i}=this;return i?[i]:[]}get radio(){var i;return!!((i=this._radio)!=null?i:this.toggleGroup)}onFocusIn(i){const{menu:e}=this;super.onFocusIn(i),!this.disabled&&e&&(e.clearTimeout(e.closeTimer),this.delay("openMenu",e.closeTimer?0:this.openMenuDelay),e.closeTimer=null)}onFocusOut(i){var e;const t=this;t.clearTimeout("openMenu"),super.onFocusOut(i);const r=t._menu;r&&!((e=t.owner)!=null&&e.ignoreFocusOut)&&(E.usingKeyboard?t.closeMenu():(r.clearTimeout(r.closeTimer),r.closeTimer=r.setTimeout(()=>t.closeMenu(),r.closeMenuDelay),r.once("hide",()=>r.clearTimeout(r.closeTimer))))}openMenu(i){const{menu:e,parent:t}=this;!this.disabled&&e&&(e.focusOnToFront=i,t.isMenu?t.openSubMenu(this.element,this):e.show())}onChildShow(i){super.onChildShow(i),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu.isWidget&&this.menu.close(),this.menu.closeTimer=null}onChildHide(i){super.onChildHide(i),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(i){return i&&typeof this.checked!="boolean"&&(this.checked=!1),i}changeChecked(i,e){if(this.isConfiguring||typeof e=="boolean")return!!i}updateChecked(i){const e=this;e.isConfiguring||(e.toggleGroup&&e.uncheckToggleGroupMembers(),e.element.setAttribute("aria-checked",i),e.trigger("toggle",{menu:e.owner,item:e,element:e.element,bubbles:!0,checked:i}))}getToggleGroupMembers(){const i=this,{checked:e,toggleGroup:t,element:r}=i,n=[];return e&&t&&E.forEachSelector(i.rootElement,`[data-group=${t}]`,s=>{if(s!==r){const a=z.fromElement(s);a&&n.push(a)}}),n}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(i=>i.checked=!1)}get closeParent(){return(typeof this.checked=="boolean"?this._closeParent:this._closeParent!==!1)&&!this.hasMenu}changeMenu(i,e){const t=this,{constrainTo:r,scrollAction:n,focusOnHover:s}=t.owner;return i&&typeof i=="object"&&(!("type"in i)||i.type==="menu")&&!("items"in i)&&!("widgets"in i)&&!("html"in i)&&(i={lazyItems:i}),li.reconfigure(e,i?li.mergeConfigs(t.menuDefaults,{owner:t,forElement:t.element,ariaLabel:t.text,[e?"positioned":"_"]:!1,focusOnHover:s,constrainTo:r,scrollAction:n},i):null,t)}};y(ai,"$name","MenuItem"),y(ai,"type","menuitem"),ai.initClass(),ai._$name="MenuItem";var C_={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1},li=class extends ft{construct(i){Array.isArray(i)&&(i={lazyItems:i}),super.construct(i),V.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(){const{items:i,element:e}=this;i.some(n=>n.hasConfig("menu"))&&e.classList.add("b-menu-with-submenu"),i.some(n=>n.icon)&&e.classList.add("b-menu-with-icon"),super.afterShow(...arguments)}createWidget(i){return typeof i=="string"&&(i={text:i}),super.createWidget(i)}get focusElement(){var i;const e=this,t=(i=e.parentMenu)==null?void 0:i.element.contains(E.getActiveElement(e.parentMenu)),r=e.items[0];return t||E.usingKeyboard||!(r instanceof ai)?super.focusElement:e.element}onDocumentMouseDown({event:i}){if(!this.parentMenu||!this.parentMenu.owns(i.target))return super.onDocumentMouseDown(...arguments)}hide(i){var e,t;const r=this,n=super.hide(i);return r.isVisible||((t=(e=r.currentSubMenu)==null?void 0:e.hide)==null||t.call(e,i),r.parentMenu&&(r.parentMenu.currentSubMenu=null)),n}show(){const i=super.show(...arguments),{parentMenu:e}=this;return this.isVisible&&e&&(e.currentSubMenu=this),i}onMouseClick(i){const e=i.target.closest(".b-menuitem");e&&this.triggerElement(e,i)}onMouseOver(i){var e;if(this.focusOnHover!==!1){const t=(e=i.relatedTarget)==null?void 0:e.closest(".b-widget"),r=i.target.closest(".b-widget"),n=z.fromElement(r);!E.isTouchEvent&&r&&r!==t&&n.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}}handleMouseOver(i){i.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer);const{parentMenu:i}=this;i&&(i.ignoreFocusOut=!0,i.setTimeout(()=>i.ignoreFocusOut=!1,500),i.clearTimeout(i.hideSubMenuTimer))}onMouseLeave(i){const e=this,{relatedTarget:t}=i,r=t&&e.owns(t);let n=t instanceof HTMLElement&&z.fromElement(t),s=!r;if(n){for(;n.ownerCmp;)n=n.ownerCmp;s&=!E.getAncestor(n.element,[i.target])}!r&&s&&(e.currentSubMenu&&(e.hideSubMenuTimer=e.setTimeout(()=>{var a;return(a=e.currentSubMenu)==null?void 0:a.hide()},e.closeMenuDelay)),e.element.contains(E.getActiveElement(e))&&E.getActiveElement(e).matches(".b-menuitem")&&e.focusElement.focus())}onInternalKeyDown(i){const e=z.fromElement(i),t=e&&e!==this&&!(e instanceof ai);if(i.key==="Escape"){(t?this:this.rootMenu).close();return}if(super.onInternalKeyDown(i),t)return;C_[i.key]&&i.preventDefault();const r=this.element,n=E.getActiveElement(r);this.navigateFrom(n!==r&&r.contains(n)?n:null,i.key,i)}navigateFrom(i,e,t){var r,n;const s=this,{treeWalker:a}=s,l=i&&s.getItem(i),o=s.rtl?"ArrowLeft":"ArrowRight",d=s.rtl?"ArrowRight":"ArrowLeft";let c;switch(e){case"ArrowUp":a.currentNode=i||(i=s.bottomFocusTrap),a.previousNode(),c=a.currentNode,(r=l==null?void 0:l.menu)==null||r.hide(!1);break;case"ArrowDown":a.currentNode=i||(i=s.topFocusTrap),a.nextNode(),c=a.currentNode,(n=l==null?void 0:l.menu)==null||n.hide(!1);break;case" ":i&&!i.classList.contains("b-disabled")&&(l!=null&&l.menu?s.openSubMenu(i,l):s.triggerElement(i,t));break;case o:if(i&&(l!=null&&l.menu)&&!i.classList.contains("b-disabled")){const u=s.openSubMenu(i,l);u==null||u.focus()}else a.currentNode=i||(i=s.topFocusTrap),a.nextNode(),c=a.currentNode;break;case d:s.isSubMenu?s.hide():i||(a.currentNode=i||(i=s.topFocusTrap),a.nextNode(),c=a.currentNode);break;case"Enter":i&&!i.classList.contains("b-disabled")&&s.triggerElement(i,t);break}c&&(c===s.element?s.navigateFrom(s.bottomFocusTrap,"ArrowUp",t):c===i?s.navigateFrom(s.topFocusTrap,"ArrowDown",t):c.focus())}getItem(i){if(i!=null)return typeof i=="number"?this.items[i]:i.nodeType===Element.ELEMENT_NODE?z.fromElement(i,"menuitem",this.contentElement):this.items.find(e=>e.id==i)}triggerElement(i,e){const t=this.getItem(i);t&&!t.disabled&&t.doAction(e)}get isSubMenu(){var i;return this===((i=this.owner)==null?void 0:i.menu)}openSubMenu(i,e){var t;const r=this,n=e.menu;if(n){if(!n.isVisible){const s={item:e,element:i};if(r.trigger("beforeSubMenu",s)===!1||((t=e.onBeforeSubMenu)==null?void 0:t.call(e,s))===!1)return;n.show(),n.isVisible&&!n.isMenu&&(r.currentSubMenu=n)}return n}}set selectedElement(i){const e=this,t=e._selectedElement;if(t){const r=e.getItem(t),n=r==null?void 0:r.menu;n==null||n.hide(),t.classList.remove("b-active")}if(e._selectedElement=i,i){const r=E.isFocusable(i);i.classList.add("b-active"),e.scrollable.scrollIntoView(i,{animate:!r,focus:r})}}get selectedElement(){return this._selectedElement}selectFirst(){const i=this.treeWalker;i.currentNode=this.topFocusTrap,i.nextNode(),this.requestAnimationFrame(()=>i.currentNode.focus())}get parentMenu(){var i;const e=this.owner;return e&&(e.isMenu?e:(i=e.up)==null?void 0:i.call(e,"menu"))}get rootMenu(){let i=this;for(;i.parentMenu instanceof this.constructor;)i=i.parentMenu;return i}};y(li,"$name","Menu"),y(li,"type","menu"),y(li,"configurable",{layout:"vbox",focusable:!0,draggable:!1,showAnimation:null,hideAnimation:{opacity:{from:1,to:0,duration:".15s",delay:"0s"}},align:{align:"t-b"},scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",closeMenuDelay:200,testConfig:{hideAnimation:null,closeMenuDelay:1}}),li.initClass(),li._$name="Menu";var Yu,Ir=class extends ie{static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",constrainTo:globalThis,scrollAction:null}},items:{},triggerEvent:null,clickTriggerSelector:null,preventNativeMenu:null,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...i){var e;if(super.construct(...i),!((e=this.type)!=null&&e.length))throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(i){this.onElementEvent(i)}onElementClick(i){this.onElementEvent(i)}onElementDblClick(i){this.onElementEvent(i)}onElementEvent(i){if(!i.handled&&this.triggerEvent===i.type){if(i.ctrlKey===!0&&!Y.isMac){i.preventDefault();return}const e=i;if(Yu){const{target:t}=Yu;i=V.fixEvent(new MouseEvent(i.type,i)),Object.defineProperties(i,{target:{value:t},offsetX:{value:e.offsetX},offsetY:{value:e.offsetY}}),i.preventDefault=function(){e.preventDefault(),e.handled=!0}}this.internalShowContextMenu(i)}else i.type==="click"&&this.clickTriggerSelector&&i.target.matches(this.clickTriggerSelector)&&this.internalShowContextMenu(i,{align:"l-r",target:i.target})}showContextMenuByKey(i){if(!E.isEditable(i.target)){const{target:e}=i;if(e)return Yu=i,E.triggerMouseEvent(e,this.triggerEvent),i.handled=!0,i.preventDefault(),i.stopImmediatePropagation(),Yu=null,!0}return!1}internalShowContextMenu(i,e){const t=this;let r;t.disabled||!i.handled&&!i.defaultPrevented&&(r=t.getDataFromEvent(i))&&t.shouldShowMenu(r)&&(i.type==="contextmenu"&&Y.isSafari&&!i.ctrlKey&&i.metaKey&&V.on({element:i.target,capture:!0,once:!0,thisObj:this,click(n){n.preventDefault(),n.stopImmediatePropagation()}}),r.domEvent=i,t.showContextMenu(r,e))}getDataFromEvent(i){return{feature:this,event:i,targetElement:this.getTargetElementFromEvent(i)}}getTargetElementFromEvent(i){return i.target}async showContextMenu(i,e){var t,r,n;const s=this,a=E.isDOMEvent(i),l=a?s.getDataFromEvent(i):i,o=a?i:l.domEvent,d=(t=E.isInView(l.targetElement))==null?void 0:t.center;if((r=s._menu)==null||r.hide(),s.disabled||!d)return;s.menuContext=l;const{type:c,client:u,processItems:h}=s;if(Z.assign(l,{point:o!=null&&o.clientX?[o.clientX+1,o.clientY+1]:[d.x,d.y],menu:s,items:{},selection:u.selectedRecords}),s.callChainablePopulateMenuMethod(l),Z.merge(l.items,s.baseItems),s.preventNativeMenu&&s.preventDefaultEvent(l),(!h||await s.callback(h,u,[l])!==!1)&&s.hasActiveMenuItems(l)&&(s.populateItemsWithData(l),s.beforeContextMenuShow(l)!==!1)){const{menu:g}=s,{featureItems:f}=g,{items:m}=l;s.preventDefaultEvent(l);let p=u.trigger(`${c}MenuBeforeShow`,l);if(T.isPromise(p)&&(o.handled=!0,p=await p),!Object.values(m).some(v=>v))return;p!==!1&&(f&&(g.remove(f),B.asArray(f).forEach(v=>v.destroy())),g.featureItems=g.add(...Array.isArray(m)?m:g.processItemsObject(m)),g.showBy(e||{target:l.domEvent,align:"s0-e100"}),(n=s.touchMoveDetacher)==null||n.call(s),s.touchMoveDetacher=V.on({element:u.element,touchmove:()=>g.hide(),thisObj:g,once:!0}),o&&(o.preventDefault(),o.handled=!0))}}get baseItems(){if(!this._baseItems){const i=this,{namedItems:e}=i,t=i._baseItems=Z.assign({},i.items);for(const r in t){const n=t[r];n&&(e&&r in e?t[r]=typeof n=="object"?Z.merge(Z.clone(e[r]),n):e[r]:n===!0&&delete t[r])}}return this._baseItems}hideContextMenu(i){var e;(e=this.menu)==null||e.hide(i)}callChainablePopulateMenuMethod(i){var e,t;(t=(e=this.client)[`populate${O.capitalize(this.type)}Menu`])==null||t.call(e,i)}hasActiveMenuItems(i){return Object.values(i.items).some(e=>e&&!e.hidden)}shouldShowMenu(){return!0}beforeContextMenuShow(i){}populateItemsWithData(i){}preventDefaultEvent(i){var e;(e=i.event)==null||e.preventDefault()}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}changeMenu(i,e){const t=this,{client:r,type:n}=t;if(i)return li.reconfigure(e,i?li.mergeConfigs({owner:r,rootElement:r.rootElement,onItem(s){r.trigger(`${n}MenuItem`,s)},onToggle(s){r.trigger(`${n}MenuToggleItem`,s)},onDestroy(){t.menu=null},onBeforeItem(s){Object.assign(s,t.menuContext)},onShow({source:s}){t.menuContext.menu=s,r.trigger(`${n}MenuShow`,t.menuContext)}},i):null,t);e!=null&&e.isWidget&&e.destroy()}};y(Ir,"$name","ContextMenuBase"),Ir._$name="ContextMenuBase";var qi={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},Fn=class extends Fe($){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,constrainToParent:!0,rtlSource:null}}construct(i){const e=this;super.construct(i),!e.handleSelector&&!Y.isHoverableDevice&&(e.handleSize=e.touchHandleSize),e.handleVisibilityThreshold=e.handleVisibilityThreshold||2*e.handleSize,e.initListeners(),e.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(i){i&&(this.skipTranslate=!0)}getX(i){return this.positioning==="inset"?parseFloat(getComputedStyle(i).insetInlineStart,10):E.getTranslateX(i)}getY(i){return this.positioning==="inset"?parseFloat(getComputedStyle(i).insetBlockStart,10):E.getTranslateY(i)}setX(i,e){this.positioning==="inset"?i.style.insetInlineStart=e+"px":E.setTranslateX(i,e)}setY(i,e){this.positioning==="inset"?i.style.insetBlockStart=e+"px":E.setTranslateY(i,e)}initResize(){const i=this;if(!i.isElementResizable&&i.targetSelector&&(i.isElementResizable=e=>e.closest(i.targetSelector)),i.grab){const{edge:e,element:t,event:r}=i.grab;i.startEvent=r;const n=i.getX(t)||t.offsetLeft,s=i.getY(t)||t.offsetTop;i.context={element:t,edge:e,valid:!0,async:!1,elementStartX:n,elementStartY:s,newX:n,newY:s,elementWidth:t.offsetWidth,elementHeight:t.offsetHeight,startX:r.clientX+i.scrollLeft,startY:r.clientY+i.scrollTop,finalize:()=>{var a;return(a=i.reset)==null?void 0:a.call(i)}},t.classList.add(i.resizingCls),i.internalStartResize(i.isTouch)}}initListeners(){const i=this,e={element:i.outerElement,mousedown:qi.down,touchstart:qi.touchstart,thisObj:i};!i.handleSelector&&Y.isHoverableDevice&&(e.mousemove={handler:qi.move,delegate:i.targetSelector},e.mouseleave={handler:"onMouseLeaveTarget",delegate:i.targetSelector,capture:!0}),V.on(e)}get isRTL(){var i;return!!((i=this.rtlSource)!=null&&i.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(i){var e;const t={element:document,keydown:qi.keydown,thisObj:this};i?(t.touchmove=qi.touchmove,t.touchend=t.pointerup=qi.touchend):(t.mousemove=qi.move,t.mouseup=qi.up),this.removeDragListeners=V.on(t),(e=this.onResizeHandlePointerDown)==null||e.call(this,this.startEvent)}removeDragListeners(){}reset(){var i;(i=this.removeDragListeners)==null||i.call(this),this.context=null,this.trigger("reset")}canResize(i,e){return!this.isElementResizable||this.isElementResizable(i,e)}onPointerDown(i,e){const t=this;t.startEvent=e,t.canResize(e.target,e)&&t.grabResizeHandle(i,e)&&(e.stopImmediatePropagation(),e.type==="touchstart"&&e.preventDefault(),t.internalStartResize(i))}onTouchStart(i){i.touches.length>1||this.onPointerDown(!0,i)}onMouseDown(i){i.button===0&&this.onPointerDown(!1,i)}internalMove(i,e){var t;const r=this,{context:n,direction:s}=r;n!=null&&n.element&&(n.started||V.getDistanceBetween(r.startEvent,e)>=r.dragThreshold)?(n.started||((t=r.scrollManager)==null||t.startMonitoring(T.merge({scrollables:[{element:r.dragWithin||r.outerElement,direction:s}],callback:a=>{var l;return((l=r.context)==null?void 0:l.element)&&r.lastMouseMoveEvent&&r.update(r.lastMouseMoveEvent,a)}},r.monitoringConfig)),r.trigger("resizeStart",{context:n,event:e}),n.started=!0),r.update(e)):!i&&!r.handleSelector&&r.checkResizeHandles(e)}onTouchMove(i){this.internalMove(!0,i)}onMouseMove(i){this.internalMove(!1,i)}onPointerUp(i,e){var t,r,n;const s=this,a=s.context;(t=s.removeDragListeners)==null||t.call(s),a?((r=s.scrollManager)==null||r.stopMonitoring(),a.started&&V.on({element:E.getRootElement(e.target),thisObj:s,click:qi.docclick,expires:s.clickSwallowDuration,capture:!0,once:!0}),s.finishResize(e)):(n=s.reset)==null||n.call(s)}onTouchEnd(i){this.onPointerUp(!0,i)}onMouseUp(i){this.onPointerUp(!1,i)}onDocumentClick(i){i.stopPropagation()}onKeyDown(i){i.key==="Escape"&&this.abort()}update(i){const e=this,{context:t,constrainToParent:r}=e,{element:n}=t;if(r){const s=L.from(e.outerElement);t.currentX=Math.max(Math.min(i.clientX,s.right),s.x)+e.scrollLeft,t.currentY=Math.max(Math.min(i.clientY,s.bottom),s.y)+e.scrollTop}else t.currentX=i.clientX+e.scrollLeft,t.currentY=i.clientY+e.scrollTop;n.classList.add(e.resizingCls),e.updateResize(i)&&(e.trigger("resizing",{context:t,event:i}),n.classList.toggle(e.invalidCls,t.valid===!1)),e.lastMouseMoveEvent=i}abort(i=!1){var e,t;const r=this;(t=(e=r.scrollManager)==null?void 0:e.stopMonitoring)==null||t.call(e),r.context?r.abortResize(null,i):r.isDestroyed||r.reset()}grabResizeHandle(i,e){var t;const r=this;if(r.allowResize&&!r.allowResize(e.target,e))return!1;const n=r.handleSelector,s=e.type==="touchstart"?e.changedTouches[0]:e,a=s.clientX,l=s.clientY;let o=r.targetSelector?e.target.closest(r.targetSelector):e.target;if(o){let d;if(n)if(e.target.matches(n))r.direction==="horizontal"?e.pageX<E.getPageX(o)+o.offsetWidth/2?d=r.isRTL?"right":"left":d=r.isRTL?"left":"right":e.pageY<E.getPageY(o)+o.offsetHeight/2?d="top":d="bottom";else return!1;else if(r.direction==="horizontal"?r.overLeftHandle(e,o)?d=r.isRTL?"right":"left":r.overRightHandle(e,o)&&(d=r.isRTL?"left":"right"):r.overTopHandle(e,o)?d="top":r.overBottomHandle(e,o)&&(d="bottom"),!d)return r.context=null,!1;e.type==="touchstart"&&e.preventDefault();const c=(t=r.internalBeforeStart)==null?void 0:t.call(r,{element:o,edge:d});if(c&&(o=c.element,d=c.edge),r.trigger("beforeResizeStart",{element:o,event:e})!==!1){const u=r.getX(o)||o.offsetLeft,h=r.getY(o)||o.offsetTop;return r.context={element:o,edge:d,isTouch:i,valid:!0,async:!1,direction:r.direction,elementStartX:u,elementStartY:h,newX:u,newY:h,elementWidth:o.offsetWidth,elementHeight:o.offsetHeight,startX:a+r.scrollLeft,startY:l+r.scrollTop,finalize:()=>{var g;return(g=r.reset)==null?void 0:g.call(r)}},o.classList.add(r.resizingCls),!0}}return!1}checkResizeHandles(i){const e=this,t=e.targetSelector?i.target.closest(e.targetSelector):i.target;let r=!1;return t&&(!e.allowResize||e.allowResize(i.target,i))?(e.currentElement=e.handleContainerSelector?i.target.closest(e.handleContainerSelector):i.target,e.currentElement&&(e.direction==="horizontal"?r=e.overLeftHandle(i,t)||e.overRightHandle(i,t):r=e.overTopHandle(i,t)||e.overBottomHandle(i,t),r?e.highlightHandle():e.unHighlightHandle())):e.currentElement&&e.unHighlightHandle(),r}onMouseLeaveTarget(i){const e=this;e.currentElement=e.handleContainerSelector?i.target.closest(e.handleContainerSelector):i.target,e.currentElement&&e.unHighlightHandle()}updateResize(i){const e=this,{context:t,allowEdgeSwitch:r,skipTranslate:n,skipUpdatingElement:s}=e;let a;r&&(e.direction==="horizontal"?t.edge=t.currentX>t.startX?"right":"left":t.edge=t.currentY>t.startY?"bottom":"top");const{element:l,elementStartX:o,elementStartY:d,elementWidth:c,elementHeight:u,edge:h}=t,{style:g}=l,f=(t.currentX-t.startX)*(e.positioning==="inset"&&e.isRTL?-1:1),m=t.currentY-t.startY,p=E.getExtremalSizePX(l,"minWidth")||e.minWidth,v=E.getExtremalSizePX(l,"maxWidth")||e.maxWidth,b=E.getExtremalSizePX(l,"minHeight")||e.minHeight,w=E.getExtremalSizePX(l,"maxHeight")||e.maxHeight,D=h==="right"&&(!e.isRTL||e.positioning==="inset")||h==="bottom"?1:-1,S=c+f*D,x=u+m*D;let R=Math.max(p,S),M=Math.max(b,x);if(v>0&&(R=Math.min(R,v)),w>0&&(M=Math.min(M,w)),e.direction==="horizontal"&&c!==R){if(s||(g.flex="",g.width=Math.abs(R)+"px"),t.newWidth=R,h==="left"||R<0){const _=Math.max(Math.min(o+c-e.minWidth,o+f),0);n||e.setX(l,Math.round(_)),t.newX=_}else h==="right"&&r&&!n&&e.setX(l,o);a=!0}else e.direction==="vertical"&&u!==x&&(s||(g.flex="",g.height=Math.abs(M)+"px"),t.newHeight=M,h==="top"||M<0?(t.newY=Math.max(Math.min(d+u-e.minHeight,d+m),0),n||e.setY(l,t.newY)):h==="bottom"&&r&&!n&&e.setY(l,d),a=!0);return a}finishResize(i){var e;const t=this,r=t.context,n={context:r,event:i};if(r.element.classList.remove(t.resizingCls),r.started){let s=!1;t.direction==="horizontal"?s=r.newWidth&&r.newWidth!==r.elementWidth:s=r.newHeight&&r.newHeight!==r.elementHeight,t.trigger(s?"resize":"cancel",n),r.async||r.finalize()}else(e=t.reset)==null||e.call(t)}abortResize(i=null,e=!1){const t=this,r=t.context;r.element.classList.remove(t.resizingCls),t.direction==="horizontal"?((r.edge==="left"||r.allowEdgeSwitch&&!r.skipTranslate)&&t.setX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(t.setY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!e&&t.trigger("cancel",{context:r,event:i}),t.isDestroyed||t.reset()}highlightHandle(){const i=this,e=i.targetSelector?i.currentElement.closest(i.targetSelector):i.currentElement;i.currentElement.classList.add("b-resize-handle"),e.classList.add("b-over-resize-handle")}unHighlightHandle(){const i=this,e=i.targetSelector?i.currentElement.closest(i.targetSelector):i.currentElement;e&&e.classList.remove("b-over-resize-handle"),i.currentElement.classList.remove("b-resize-handle"),i.currentElement=null}overAnyHandle(i,e){return this.overStartHandle(i,e)||this.overEndHandle(i,e)}overStartHandle(i,e){return this.direction==="horizontal"?this.overLeftHandle(i,e):this.overTopHandle(i,e)}overEndHandle(i,e){return this.direction==="horizontal"?this.overRightHandle(i,e):this.overBottomHandle(i,e)}getDynamicHandleSize(i,e){const t=i?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*t>e-this.reservedSpace?Math.max(Math.floor((e-this.reservedSpace)/t),0):r}overLeftHandle(i,e){const t=this,{offsetWidth:r}=e;if(t.leftHandle&&t.canResize(e,i)&&(r>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=L.from(e);return n.width=t.getDynamicHandleSize(t.rightHandle,r),n.width>0&&n.contains(V.getPagePoint(i))}return!1}overRightHandle(i,e){const t=this,{offsetWidth:r}=e;if(t.rightHandle&&t.canResize(e,i)&&(r>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=L.from(e);return n.x=n.right-t.getDynamicHandleSize(t.leftHandle,r),n.width>0&&n.contains(V.getPagePoint(i))}return!1}overTopHandle(i,e){const t=this,{offsetHeight:r}=e;if(t.topHandle&&t.canResize(e,i)&&(r>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=L.from(e);return n.height=t.getDynamicHandleSize(t.bottomHandle,r),n.height>0&&n.contains(V.getPagePoint(i))}return!1}overBottomHandle(i,e){const t=this,{offsetHeight:r}=e;if(t.bottomHandle&&t.canResize(e,i)&&(r>=t.handleVisibilityThreshold||t.dynamicHandleSize)){const n=L.from(e);return n.y=n.bottom-t.getDynamicHandleSize(t.bottomHandle,r),n.height>0&&n.contains(V.getPagePoint(i))}return!1}};y(Fn,"configurable",{skipUpdatingElement:null}),Fn._$name="ResizeHelper";var Tw=/>[ \t\r\n]+</g,w_=/\s\s+/g,Pt=class RE{static tpl(e,...t){let r=0,n=t.map((s,a)=>{let l=e[a];return Array.isArray(s)?l+=s.reduce((o,d)=>o+=(typeof d=="string"?d.trim():d)+`
`,""):(s===void 0&&(s=""),l+=typeof s=="string"?s.trim():s),r++,l}).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(Tw,"><").replace(w_," ").trim()}static docsTpl(e,...t){let r=0,n=t.map((s,a)=>{let l=e[a];return Array.isArray(s)?l+=s.reduce((o,d)=>o+=(typeof d=="string"?d.trim():d)+`
`,""):(s===void 0&&(s=""),l+=typeof s=="string"?s.trim():s),r++,l}).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(Tw,"><").trim()}static repeat(e){return function(...t){return RE.tpl(...t).repeat(e)}}static loop(e){}};Pt._$name="TemplateHelper";var S_=class extends Array{constructor(i,e){super(),this.timeZone=i,this.year=e}},D_=class{constructor(i,e){this.asString=i,this.timeZone=e,this.asArray=x_(i)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}},Mw=(i,e)=>{const t=i.toLocaleString("sv-SE",{timeZone:e});return new D_(t,e)},E_=(i,e)=>{const{asTicksUtc:t,asString:r}=Mw(new Date(i),e);return{offset:(i-t)/6e4,tzTicksUtc:t,tzString:r}},x_=i=>{const e=i.split(/[\s-:]/).map(t=>t*1);return e[1]-=1,e},R_=-6e4,T_=36e5,_w=-864e5,rd=2592e6,kw=(i,e)=>{const t=Fw.get(i,e);if(t)return t;const r=new S_(i,e),n=new Date(Date.UTC(e,0,1)).getTime();let s=n,a=rd,l=0,o=[],d=null,c,u,h,g;for(;!g;)({offset:h,tzTicksUtc:c,tzString:u}=E_(s,i)),d==null?(d=h,r.push({offset:h})):a>0&&h!==d?a=a===rd?_w:R_:a<0&&h===d&&(a===_w?a=T_:(r.length===1?(r.push(o),d=o.offset):(r[0].startTicks=o.startTicks,r[0].startDateString=o.startDateString,g=!0),a=rd)),o={offset:h,startDateString:u,startTicks:c},a===rd&&(s=n,s+=l*rd,l+=1),s+=a,l>11&&(g=!0);return Fw.set(r),r},Fw={_cache:{},get(i,e){var t;return(t=this._cache[i])==null?void 0:t[e]},set(i){const{timeZone:e}=i,{_cache:t}=this;t[e]||(t[e]={}),t[e][i.year]=i}},$e=class{static toTimeZone(i,e){if(typeof e=="number")return this.toUtcOffset(i,e);const t=Mw(i,e);return t.asArray[3]!==t.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),t.asLocalDate}static fromTimeZone(i,e){if(typeof e=="number")return this.fromUtcOffset(i,e);const t=this.dateAsArray(i),r=kw(e,i.getUTCFullYear());let n=r[0].offset;if(r.length===2){const s=Date.UTC(...t);s>=r[1].startTicks&&s<r[0].startTicks&&(n=r[1].offset)}return t[4]+=n,new Date(Date.UTC(...t))}static toUtcOffset(i,e){const t=i.getTimezoneOffset()+e;return new Date(i.getTime()+t*60*1e3)}static fromUtcOffset(i,e){const t=-i.getTimezoneOffset()-e;return new Date(i.getTime()+t*60*1e3)}static dateAsArray(i){return[i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()]}};y($e,"$name","TimeZoneHelper"),$e.findOffsetDates=kw,_e.register($e),$e._$name="TimeZoneHelper";var qu=class Co extends z{static get configurable(){return{testConfig:{destroyTimeout:1,timeout:400},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,sideMargin:20,side:"bottom",role:"alert"}}changeSide(e){return e=="top"||e=="bottom"?e+="-end":(e==="start"||e=="end")&&(e="bottom-"+e),e}compose(){const{appendTo:e,color:t,html:r,showProgress:n,style:s,timeout:a,side:l}=this;return{parent:e||this.floatRoot,class:{...te.normalize(t,"object"),[`b-side-${l}`]:1,"b-toast-hide":1},"aria-atomic":!1,html:r,style:{...E.parseStyle(s),"--side":l.split("-")[0]},children:{progressElement:n&&{style:`animation-duration:${a}ms;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}getNextInset(e){const{sideMargin:t,element:r}=this;return parseInt(r.style[e],10)+r.offsetHeight+t}async show(){var e,t,r;await super.show(...arguments);const n=this,{element:s,side:a}=n,l=Co.toasts[a],o=a.split("-")[0],d=n.timeout*((e=E.getActiveElement())!=null&&e.matches(":focus-visible")?3:1);l.includes(n)||(s.style[o]=((r=(t=l[0])==null?void 0:t.getNextInset(o))!=null?r:n.sideMargin)+"px",l.unshift(n),s.getBoundingClientRect(),s.classList.remove("b-toast-hide"),d>0&&(n.hideTimeout=n.setTimeout("hide",d)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const e=Co.toasts[this.side];e.includes(this)&&e.splice(e.indexOf(this),1),E.removeAttributeValue(document.body,"aria-describedby",this.id)}static hideAll(){Object.keys(Co.toasts).forEach(e=>Co.toasts[e].slice().reverse().forEach(t=>t.hide()))}static show(e){var t;const r=Co.new({autoDestroy:!0,rootElement:document.body,autoShow:!1},typeof e=="string"?{html:e}:e);return(t=E.getActiveElement())!=null&&t.matches(":focus-visible")&&Object.values(this.toasts).flat().length?Qe.waitFor(()=>!Object.values(this.toasts).flat().length).then(()=>setTimeout(()=>r.show(),250)):r.show(),r}};y(qu,"$name","Toast"),y(qu,"type","toast"),y(qu,"toasts",{"top-start":[],"top-end":[],"bottom-start":[],"bottom-end":[]});var xi=qu;xi.initClass(),xi._$name="Toast";var Iw=class{static getById(i){return re.deprecate("core","7.0.0","Use Widget.getById instead"),z.getById(i)}static fromElement(i,e,t){return re.deprecate("core","7.0.0","Use Widget.fromElement instead"),z.fromElement(i,e,t)}static createWidget(i={}){return re.deprecate("core","7.0.0","Use Widget.create instead"),i.isWidget?i:z.create(i)}static append(i,e){if(re.deprecate("core","7.0.0","Use a Container instead"),i=Array.isArray(i)&&i||[i],(e instanceof HTMLElement||typeof e=="string")&&(e={appendTo:e}),e.insertFirst){const t=typeof e.insertFirst=="string"?document.getElementById(e.insertFirst):e.insertFirst;t.firstChild?e.insertBefore=t.firstChild:e.appendTo=t}return i.map(t=>z.create(T.assign({},e||{},t)))}static openPopup(i,e){return re.deprecate("core","7.0.0","Use Popup directly instead"),z.create(T.assign({forElement:i},typeof e=="string"?{html:e}:e),"popup")}static showContextMenu(i,e){re.deprecate("core","7.0.0","Use Menu directly instead");const t=this;return t.currentContextMenu&&t.currentContextMenu.destroy(),i instanceof HTMLElement?e.forElement=i:(e.forElement=document.body,Array.isArray(i)&&(i=new ti(...i)),i instanceof ti&&(e.align={position:i})),e.internalListeners={destroy:t.currentContextMenu=null},t.currentContextMenu=z.create(e,"menu")}static attachTooltip(i,e){return re.deprecate("core","7.0.0","Use Tooltip directly instead"),z.attachTooltip(i,e)}static hasTooltipAttached(i){return re.deprecate("core","7.0.0","Will be removed"),z.resolveType("tooltip").hasTooltipAttached(i)}static destroyTooltipAttached(i){return re.deprecate("core","7.0.0","Will be removed"),z.resolveType("tooltip").destroyTooltipAttached(i)}static mask(i,e="Loading"){if(re.deprecate("core","7.0.0","Use Mask directly instead"),i)return i instanceof HTMLElement&&(i={target:i,text:e}),Mn.mask(i,i.target)}static unmask(i,e=!0){re.deprecate("core","7.0.0","Use Mask directly instead"),i.mask&&(e?i.mask.close():i.mask.hide())}static toast(i){return re.deprecate("core","7.0.0","Use Toast directly instead"),xi.show(i)}};Iw._$name="WidgetHelper";var Aw=class{static convertFromObject(i,e={}){Z.assignIf(e,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:t,elementName:r,includeHeader:n,rootElementForArray:s}=e;let{xmlns:a}=e;a=a?` xmlns="${a}"`:"";const l=n?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':"",o=d=>{const c=[];for(const u in d){const h=d[u];if(Array.isArray(h)){s&&c.push(`<${u}>`);for(const g of h)r.length?c.push(`<${r}>`):c.push(`<${u}>`),c.push(o(g)),r.length?c.push(`</${r}>`):c.push(`</${u}>`);s&&c.push(`</${u}>`)}else Z.isObject(h)?c.push(`<${u}>${o(h)}</${u}>`):h==null?c.push(`<${u}/>`):c.push(`<${u}>${O.encodeHtml(h)}</${u}>`)}return c.join("")};return`${l}<${t}${a}>${o(i)}</${t}>`}};Aw._$name="XMLHelper";var da=class{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(i){const{randomCache:e}=this;let t;return e[i]?t=e[i]:(t=this.random100.filter(r=>r<i),e[i]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(i){return i[this.nextRandom(i.length)]}randomArray(i,e){const t=[],r=this.nextRandom(e+1),n={};for(let s=0,a=this.nextRandom(i.length);s<r;s++){for(;n[a];)a=this.nextRandom(i.length);n[a]=!0,t.push(i[a])}return t}};da._$name="RandomGenerator";var M_=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"],nd=class kg{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static get cities(){return["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Montreal"]}static get namesWithAvatars(){return["Adam","Amit","Angelo","Arcady","Arnold","Barbara","Celia","Chang","Dan","Daniel","Dave","David","Don","Doug","Emilia","George","Gloria","Henrik","Hitomi","James","Jane","Jenny","John","Jong","Karen","Kate","Lee","Linda","Lisa","Lola","Macy","Madison","Malik","Mark","Mary","Maxim","Melissa","Mike","Rob","Steve","Team","Theo"]}static get firstNames(){return["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"]}static get surNames(){return["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"]}static get teams(){return["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"]}static get foods(){return["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"]}static get colors(){return["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}static get skills(){return["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"]}static get tasks(){return["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]}static generateName(){const{namesWithAvatars:e,surNames:t}=this,r=e[Math.round(Math.random()*(e.length-1))],n=t[Math.round(Math.random()*(t.length-1))];return`${r} ${n}`}static*generate(e,t=!1,r=1){var n;let s,a;typeof e=="object"&&(t=e.randomHeight,r=(n=e.initialId)!=null?n:1,s=e.addSkills,a=e.rowCallback,e=e.count);const l=this,{rnd:o,rndTime:d,rndRating:c,rndText:u,firstNames:h,surNames:g,teams:f,foods:m,colors:p,cities:v,skills:b}=l;for(let w=0;w<e;w++){const D=o.fromArray(h),S=o.fromArray(g),x=`${D} ${String.fromCharCode(65+w%25)} ${S}`,R=o.nextRandom(60)+1,M=new Date(2019,0,R),_=new Date(2019,0,R+o.nextRandom(30)+2),k={id:r>-1?w+r:void 0,title:"Row "+w,name:x,firstName:D,surName:S,city:o.fromArray(v),team:o.fromArray(v)+" "+o.fromArray(f),age:10+o.nextRandom(80),food:o.fromArray(m),color:o.fromArray(p),score:o.nextRandom(100)*10,rank:o.nextRandom(100)+1,start:M,finish:_,time:C.getTime(d.nextRandom(24),d.nextRandom(12)*5),percent:o.nextRandom(100),done:o.nextRandom(100)<50,rating:c.nextRandom(5),active:R>30,relatedTo:Math.min(e-1,w+r+o.nextRandom(10)),notes:M_[u.nextRandom(7)+1]};s&&(k.skills=o.randomArray(b,typeof s=="number"?s:7));const F=a==null?void 0:a(k);F&&Object.assign(k,F),t&&(k.rowHeight=o.nextRandom(t===!0?20:t)*5+20),yield k}}static generateData(e,t=!1,r=1,n=!0){let s=e;typeof e!="object"&&(s={count:e,randomHeight:t,initialId:r,reset:n}),s.reset!==!1&&this.reset(),kg.overrideRowCount&&(s.count=kg.overrideRowCount);const a=[],l=this.generate(s);for(let o=0;o<s.count;o++)a.push(l.next().value);return a}static generateEvents({viewStartDate:e,viewEndDate:t,nbrResources:r=50,nbrEvents:n=5,dependencies:s,tickUnit:a="days",minDuration:l=2,maxDuration:o=10,gap:d=1,eventCallback:c}){const u=this.generateData(r),h=[];let g,f;s=[];for(let m=0;m<=r;m++)for(let p=0;p<=n;p++){const v=Math.round(Math.random()*(o-1-l))+l,b=h.length+1;g=p===0?C.add(e,Math.round(Math.random()*3)*d,a):C.add(f,d,a),f=C.add(g,v,a),h.push({id:b,name:this.tasks[(m+p)%(this.tasks.length-1)],startDate:g,duration:v,endDate:f,resourceId:m}),c==null||c(h[h.length-1]),s&&m>0&&s.push({id:s.length+1,from:b-1,to:b})}return{resources:u,events:h,dependencies:s}}static generateOneEventPerTickAndResource({startDate:e,endDate:t,nbrResources:r=50,tickUnit:n="days"}){const s=this.generateData(r),a=[],l=C.getDurationInUnit(e,t,n);for(let o=0;o<=r;o++)for(let d=0;d<l;d++)a.push({id:a.length+1,resourceId:o,name:this.tasks[(o+d)%(this.tasks.length-1)],startDate:C.add(e,d,n),duration:1,durationUnit:n});return{resources:s,events:a}}static generateRow(){return kg.generateData(1,!1,-1,!1)[0]}};y(nd,"rnd",new da),y(nd,"rndTime",new da),y(nd,"rndRating",new da),y(nd,"rndText",new da);var Lw=nd;Lw._$name="DataGenerator";var __=["action","target","to","deltaX","deltaY","x","y","text"],Pw=class extends Fe(fe()){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(i){super.construct(i);const e=this;e.widget&&(e.outerElement=e.widget.element,e.widget.playingDemo=!0),V.playingDemo=!0,Object.assign(e,{prevTarget:null,currentStep:0,mouse:E.createElement({parent:e.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),e.intervalId=e.setInterval(e.nextStep.bind(e),1e3),e.outerElement.classList.add("b-playing-demo"),e.outerElement.addEventListener("click",t=>{t.isTrusted&&e.abort()})}doDestroy(){this.abort()}abort(i=!1){const e=this;e.mouse.style.top="-100px",e.clearInterval(e.intervalId),e.timeoutId&&e.clearTimeout(e.timeoutId),e.innerIntervalId&&e.clearInterval(e.innerIntervalId),e.outerElement.classList.remove("b-playing-demo"),e.widget&&(e.widget.playingDemo=!1),V.playingDemo=!1,e.trigger(i?"done":"abort")}triggerEvent(i,e,t){if(!i)return null;let r;if(e.startsWith("mouse")){const n=this.mouse.getBoundingClientRect();r=new MouseEvent(e,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:n.left,clientY:n.top},t||{}))}else r=document.createEvent("Event"),r.initEvent(e,!0,!1);return i.dispatchEvent(r),r}handleMouseMove(i,e){const t=this,r=t.mouse;r.classList.add("quick"),t.mouseDown&&r.classList.add("drag");const n=L.from(r,t.outerElement),s=n.x,a=n.y;let l=0,o=0;if(i.to)if(typeof i.to=="string"){const c=t.outerElement.querySelector(i.to);if(c){const u=L.from(c,t.outerElement),h=u.x+u.width/2,g=u.y+u.height/2;l=(h-s)/10,o=(g-a)/10}}else i.to.x?l=(i.to.x-s)/10:(l=i.to[0]/10,o=i.to[1]/10);else i.deltaX?l=i.deltaX/10:i.x&&(l=(i.x-s)/10);i.deltaY&&(o=i.deltaY/10);let d=0;t.innerIntervalId=t.setInterval(()=>{if(t.shouldPause)return;d++===9&&(clearInterval(t.innerIntervalId),i.then&&i.then());const c=s+l*d,u=a+o*d;r.style.left=c+"px",r.style.top=u+"px";const h=r.getBoundingClientRect(),g=h.left,f=h.top,m=E.elementFromPoint(g,f);m!==t.prevTarget&&(t.prevTarget&&(t.mouseOutElements.push(t.prevTarget),E.isDescendant(t.mouseOutElements[0],m)||(t.mouseOutElements.forEach(p=>t.triggerEvent(p,"mouseout")),t.mouseOutElements.length=0)),t.prevTarget=m,t.triggerEvent(m,"mouseover")),t.triggerEvent(m,i.action,{clientX:g,clientY:f})},50)}getTarget(i){const e=this,t=i.target;return t?typeof t=="function"?t(i):document.querySelector(t):e.prevTarget||e.outerElement}normalizeStep(i){if(i.action)return typeof i.action=="function"?i.action(i):i;if(typeof i=="function")return i(),i;for(const e in i)Object.hasOwnProperty.call(i,e)&&!__.includes(e)&&(i.action=e.toLowerCase(),i.to=i[e]);return!i.target&&(typeof i.to=="string"||typeof i.to=="function")&&(i.target=i.to),i}get isScrolling(){const i=this,e=i.outerElement.getBoundingClientRect(),t=i.lastTop&&e.top!==i.lastTop;return i.lastTop=e.top,t}get isInView(){const i=this.outerElement.getBoundingClientRect();return i.top<globalThis.innerHeight&&i.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const i=this;if(i.shouldPause)return;if(i.currentStep===i.steps.length)if(i.repeat)i.currentStep=0;else return i.abort(!0);i.currentStep===0&&i.trigger("initialize");const e=i.mouse,t=i.normalizeStep(i.steps[i.currentStep++]),r=i.getTarget(t),n=t.action;if(r&&n)if(e.className="simulated-mouse",n==="mousemove")i.handleMouseMove(t,r);else{if(r!==i.prevTarget){const s=L.from(r,i.outerElement);e.style.left=s.x+s.width/2+"px",e.style.top=s.y+s.height/2+"px"}n==="mousedown"&&(i.mouseDown=!0),n==="mouseup"&&(i.mouseDown=!1),i.timeoutId=i.setTimeout(()=>{if(i.prevTarget=r,e.classList.add(n),n==="type"){const s=z.fromElement(r),a=t.text.split("|");s.value=a[a.length===1||s.value!=a[0]?0:1]}else i.triggerEvent(r,n)},n==="type"?100:550)}}};Pw._$name="DemoBot";var{defineProperty:k_}=Object,F_=Symbol("fencible"),I_=[],Ow=i=>Array.from(new Set(i)),dm=i=>i?Ow(O.split(i)):I_,In=i=>{var e;return e=class extends(i||$){static setupFenced(t,r){const{fenced:n}=t,s=r.getInherited("fenced");let a,l,o,d,c;for(d in n)c=n[d],c===!0&&(c=d),T.isObject(c)||(c={all:c}),a=dm(c.all),l=dm(c.any),o=c.lock?dm(c.lock):Ow(a.concat(l)),l=l.length?l:null,s[d]={any:l,all:a,lock:o}}construct(...t){const r=this,n=Object.getPrototypeOf(r),s=r.$meta.getInherited("fenced"),a=r[F_]={},l=o=>!a[o];return T.forEach(s,({any:o,all:d,lock:c},u)=>{k_(r,u,{configurable:!0,value(...h){if(d.every(l)&&(!o||o.some(l))){let g;try{for(g of c)a[g]=(a[g]||0)+1;return n[u].apply(r,h)}finally{for(g of c)--a[g]}}}})}),super.construct(...t)}get widgetClass(){}},y(e,"$name","Fencible"),y(e,"declarable",["fenced"]),e},{floor:$w,max:cm,min:Hw}=Math,Ku=(i,e,t)=>Hw(cm(i,e),t),Ri=class extends $.mixin(In){get direction(){const{name:i}=this,{events:e,scrollStarted:t}=this.owner;let r=0,n,s,a;for(n=e.length;n-- >0&&(a=e[n][i],!(s!=null&&(r=s-a,r)));)s=a;return!r&&s!=null&&(r=s-t[i]),r}get drift(){return this._drift||0}get driftRange(){const{range:i}=this;return[i[0],cm(i[0],i[1]-this.scrollSize)]}get items(){var i;return(i=this.owner)==null?void 0:i.items}get safeZone(){const{drift:i,scrollSize:e}=this,t=$w(this.owner.safetyMargin*e);return[i+t,i+e-t]}get scroller(){var i,e;return(e=(i=this.owner)==null?void 0:i.client)==null?void 0:e.scrollable}get scrollLimit(){var i;return(i=this.owner)==null?void 0:i.scrollLimit}get vast(){const{range:i}=this;return i?i[1]-i[0]>this.scrollSize:!1}changePos(i){const{range:e}=this;return Ku(i||0,e[0],e[1])}updatePos(i){this.sync({pos:i})}updateDrift(i){const e=this,{pos:t,range:r}=e,n=t-i;if(e.scrollPos===n){const s=new CustomEvent("scroll",{detail:"driftChange"});e.owner.scroller.element.dispatchEvent(s)}else r[0]<=t&&t<r[1]&&(e.scrollPos=n)}changeRange(i,e){const[t,r]=Array.isArray(i)?i:[0,i],n=[t||0,r==null?1/0:r];if(!e||n[0]!==e[0]||n[1]!==e[1])return n}updateRange(i){this.scrollSize=i[1]-i[0],this.sync({range:i})}changeScrollSize(i){return Hw(i,this.scrollLimit)}snap(){const i=this,{direction:e,items:t,owner:r,pos:n,range:s}=i;let a,l,o,d,c;for(a of t)if([l,o]=i.getItemSpan(a),l<=n&&n<o){l<n?(c=r.snapThreshold,c<1&&(c=c*(o-l)),c=cm(1,c),e<0?d=o-n>c?l:o:d=n-l>c?o:l,d=Ku(d,s[0],s[1]),i.pos=d,r.watchForEnd()):r.scrolling=!1;break}}sync(i){const e=Object.assign(this,i),{_drift:t,range:r,vast:n}=e;if(r&&r[0]!==r[1]){let{pos:s}=e,a;const l=s<r[0]||s>=r[1];if((s==null||l)&&(s=r[1]<0?r[0]:Ku(0,r[0],r[1])),!n)a=r[0];else{const{driftRange:o,safeZone:d,scrollSize:c}=e;t==null||s<d[0]||s>d[1]?a=Ku($w(s-c/2),o[0],o[1]):a=t}e.scroller.positionDirty=!0,e.overflow="hidden-scroll",e.drift=a,a!==t?l?(e.positionDirty=!1,e._pos=null,e.pos=s):e.positionDirty=!0:(i==null?void 0:i.pos)!=null?(e.scrollPos=s-a,e.positionDirty=!0):(e.positionDirty&&(e.positionDirty=!1,e._pos=null),e.pos=e.scrollPos+a),(i!=null&&i.range||a!==t)&&e.owner.syncItems()}else e.overflow="hidden"}toLogical(i){return i+this.drift}toPhysical(i){const e=i-this.drift;return e>=0&&e<this.scrollLimit?e:NaN}};y(Ri,"configurable",{owner:null,drift:null,overflow:null,pos:{value:null,default:0,$config:"lazy"},range:{value:null,$config:"lazy"},scrollSize:null}),y(Ri,"fenced",{sync:!0});var A_=class extends Ri{get name(){return"x"}get other(){var i;return(i=this.owner)==null?void 0:i.y}get scrollPos(){return this.scroller.x}set scrollPos(i){this.scroller.x=i}get scrollSize(){return this.scroller.scrollWidth}set scrollSize(i){super.scrollSize=i}getItemSpan(i){const e=i.$vxy,{x:t}=e;return[t,t+e.width]}updateScrollSize(i){this.scroller.scrollWidth=i}updateOverflow(i){this.scroller.overflowX=i}},L_=class extends Ri{get name(){return"y"}get other(){var i;return(i=this.owner)==null?void 0:i.x}get scrollPos(){return this.scroller.y}set scrollPos(i){this.scroller.y=i}get scrollSize(){return this.scroller.scrollHeight}set scrollSize(i){super.scrollSize=i}getItemSpan(i){const e=i.$vxy,{y:t}=e;return[t,t+e.height]}updateScrollSize(i){this.scroller.scrollHeight=i}updateOverflow(i){this.scroller.overflowY=i}};Ri.X=A_,Ri.Y=L_,Ri._$name="Axis";var Vw="b-infinity-scroller",P_=Object.freeze({width:0,height:0}),um=(i,e)=>{const t="v"+e;t in i||Object.defineProperty(i,t,{configurable:!0,get(){var r;return(r=this.$vxy)==null?void 0:r[e]},set(r){this.$vxy&&(this.$vxy[e]=r)}})},hm=class extends ${get height(){return this.getDim("height")}get width(){return this.getDim("width")}get x(){return this._x}set x(i){this.moveTo(i)}get xy(){return[this._x,this._y]}set xy(i){this.moveTo(...i)}get y(){return this._y}set y(i){this.moveTo(null,i)}getDim(i){const e=this,{widget:t}=e,r="_"+i;return t?t.monitorResize?t[i]:e[r]||(e[r]=t[i]):0}moveTo(i,e){i!=null&&(this._x=i),e!=null&&(this._y=e),this.sync()}sync(){const i=this,{owner:e,widget:t}=i,{element:r}=t,n=e.x.toPhysical(i.x),s=e.y.toPhysical(i.y),a=isNaN(n+s);i.hidden=a,a?i.size=P_:r.style.transform=`translate(${n}px, ${s}px)`}updateHidden(i){var e,t;(t=(e=this.widget)==null?void 0:e.element)==null||t.classList.toggle("b-scroll-hidden",i)}updateWidget(i,e){e==null||e.element.classList.remove("b-infinity-scroller-item"),i&&(i.element.classList.add("b-infinity-scroller-item"),um(i,"x"),um(i,"y"),um(i,"xy"))}};y(hm,"configurable",{hidden:null,owner:null,widget:null}),y(hm,"prototypeProperties",{_height:0,_width:0,_x:0,_y:0});var Xu=class extends $.mixin(Fe){get element(){var i;return(i=this.scroller)==null?void 0:i.element}get events(){return this._events||(this._events=[])}get items(){var i;return(((i=this.client)==null?void 0:i.items)||[]).filter(e=>e.$vxy)}get lastEvent(){var i;return(i=this._events)==null?void 0:i[this._events.length-1]}get pos(){return[this.x.pos,this.y.pos]}changeScrollLimit(i){return i||E.scrollLimit}updateAnimate(i,e){var t;const r=(t=this.element)==null?void 0:t.classList;e&&(r==null||r.remove(`b-infinity-scroller-${e}`)),i&&(r==null||r.add(`b-infinity-scroller-${i}`))}updateClient(i){this.scroller=(i==null?void 0:i.scrollable)||null}updateScroller(i,e){var t;this.detachListeners("scroller"),(t=e==null?void 0:e.element)==null||t.classList.remove(Vw),i&&(i.element.classList.add(Vw),i.ion({thisObj:this,name:"scroller",scroll:"onInternalScroll"}))}changeX(i){return Ri.X.new(i,{owner:this})}changeY(i){return Ri.Y.new(i,{owner:this})}onInternalScroll(i){const e=this,{lastPos:t,scrolling:r}=e;r||(e.scrolling="maybe"),e.sync();const n=[e.x.pos,e.y.pos];t&&t[0]===n[0]&&t[1]===n[1]?e.scrolling=r:(e.lastPos=n,e.pushEvent(i),r||(e.scrolling=!0),e.triggerScroll("scroll",i))}onInternalScrollEnd(){const i=this,{scrolling:e}=i;e&&(e==="snap"?i.updateScrolling(e):i.scrolling=i.snap?"snap":!1)}pushEvent(i){const e=this,{events:t}=e,r={event:i,x:e.x.pos,y:e.y.pos},n=t[t.length-1];if(i.type===(n==null?void 0:n.event.type)&&n.x===r.x&&n.y===r.y)n.event=i;else for(n||(e.scrollStarted=r),t.push(r);t.length>3;)t.shift()}scrollTo(i){var e,t;const r=this,{scrollingTo:n}=r,s=r.x.pos,a=r.y.pos,l=(e=i==null?void 0:i.x)!=null?e:s+(i==null?void 0:i.dx)||0,o=(t=i==null?void 0:i.y)!=null?t:a+(i==null?void 0:i.dy)||0,d=l-s,c=o-a,u=d||c,h=(i==null?void 0:i.animate)!==!1&&(i==null?void 0:i.animate)!==null;if(n){if(n.scroll.x===l&&n.scroll.y===o&&n.scroll.animate===h)return n.promise;n.finish()}const g=r.scrollingTo=Xo.new();return g.scroll={x:l,y:o,animate:h},u&&r.unanimated(!h,()=>{d&&(r.x.pos=l),c&&(r.y.pos=o)}),u&&h?(g.cancel=r.ion({once:!0,scrollEnd(){g.resolve(r.x.pos===l&&r.y.pos===o)}}),g.finish=()=>{g.cancel&&(g.cancel(),g.cancel=null,g.resolve(!1),r.scrollStarted=null)}):g.resolve(!0),g.finally(()=>{r.scrollingTo===g&&(r.scrollingTo=null)}),g.promise}suppressAnim(i){const e=this,t=e._suppressAnim||0,r=e._suppressAnim=Math.max(0,t+(i?1:-1));e.scroller.behavior=r?"instant":null}sync(){this.unanimated(()=>{this.x.sync(),this.y.sync()})}syncItems(){for(const i of this.items)i.$vxy.sync()}triggerScroll(i,e,t=this.x.pos,r=this.y.pos){this.trigger(i,{widget:this.client,relatedEvent:e,x:t,y:r})}updateScrolling(i,e){const t=this,r=e==="maybe",{lastEvent:n}=t;i?r?(t.watchForEnd(),t.scrollEnded=null,t.triggerScroll("scrollStart",n.event,n.x,n.y),t.element.classList.add("b-scrolling")):i==="snap"&&t[t.snap].snap():e&&((n==null?void 0:n.event.detail)==="driftChange"||!r)&&(t.scrollEnded=n,t.events.length=0,t.triggerScroll("scrollEnd",n.event,n.x,n.y),t.element.classList.remove("b-scrolling"))}unanimated(i,e){if(typeof i=="function"&&(e=i,i=!0),!i)e();else{this.suppressAnim(!0);try{e()}finally{this.suppressAnim(!1)}}}virtualize(i){typeof i=="string"&&(i=this.client.widgetMap[i]);let e=i.$vxy;return(!e||e.owner!==this)&&(e==null||e.destroy(),i.$vxy=e=new hm({owner:this,widget:i})),e}watchForEnd(){const i=this,{client:e,scrollIdle:t,scrollStarted:r}=i;let n=0,s,a;(function l(){if(!i.isDestroyed&&!e.isDestroyed&&r===i.scrollStarted){if(a=i.pos,!s||s[0]!==a[0]||s[1]!==a[1])s=a,n=0;else if(++n>=t&&!le.hasActiveTouches){i.onInternalScrollEnd();return}e.requestAnimationFrame(l)}})()}};y(Xu,"configurable",{animate:"smooth",client:null,safetyMargin:.01,scroller:null,scrollIdle:8,scrolling:null,scrollLimit:{value:0,$config:"lazy"},snap:null,snapThreshold:.1,x:{},y:{}}),Xu._$name="InfinityScroller";var Nw=i=>{var e;return e=class extends i{get infinityScrollerDefaults(){return{animate:this.animate}}compose(){return{}}changeInfinityScroller(t,r){return r?r.setConfig(t):r=Xu.new({client:this},this.infinityScrollerDefaults,t),r}onChildAdd(t){var r;return t.innerItem&&((r=this._infinityScroller)==null||r.virtualize(t)),super.onChildAdd(t)}onInfiniteScroll(){this.syncSoon()}onInfiniteScrollEnd(){this.syncSoon.now()}onInfiniteScrollStart(){}onInternalResize(t,r,n,s,a){super.onInternalResize(t,r,n,s,a),this.hasPainted&&this.syncSoon()}onInternalPaint(t){var r;(r=super.onInternalPaint)==null||r.call(this,t),t.firstPaint&&(this.syncSoon.now(),this.infinityScroller.ion({thisObj:this,scroll:"onInfiniteScroll",scrollStart:"onInfiniteScrollStart",scrollEnd:"onInfiniteScrollEnd"}))}get scrollingTo(){return this.infinityScroller.scrollingTo}scrollTo(t){return this.infinityScroller.scrollTo(t)}sync(){this.infinityScroller.sync()}syncSoon(){const t=this;t.isPainted&&(t.recompose.flush(),t.infinityScroller.animate=t.animate,t.sync())}unanimated(t,r){return this.infinityScroller.unanimated(t,r)}updateAnimation(){this._infinityScroller&&this.syncSoon()}get widgetClass(){}},y(e,"configurable",{animate:"smooth",infinityScroller:{value:{},$config:"lazy"},monitorResize:!0,scrollable:{}}),y(e,"delayable",{syncSoon:"raf"}),e},Ki=class extends $.mixin(Fe,ii){static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,activateOnMouseover:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",columnCount:null,testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:i}=this;if(this.target.contains(i))return i;this._activeItem=null}updateOwnerCmp(i){this.itemSelector||(this.itemSelector=`.${i.itemCls}:not([data-noselect])`),i.itemsFocusable||E.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(i){const{owner:e}=this;this._navigationEvent=e.navigationEvent=i,i&&Promise.resolve(1).then(()=>this.navigationEvent=null)}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(i){const e=(i.key||"").trim()||i.code;return`${i.ctrlKey?"CTRL+":""}${i.shiftKey?"SHIFT+":""}${i.altKey?"ALT+":""}${e}`}onKeyDown(i){var e;const t=this,{ownerCmp:r,itemSelector:n,activeItem:s,itemsTabbable:a}=t,{target:l}=i,o=t.firstItem,d=(i.key||"").trim()||i.code,c=t.constructor.getComposedKeyName(i),u=l.matches(n)||l===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(i=t.callback(t.processEvent,t.thisObj||r,[i])),i&&!t.disabled&&o&&t.target.offsetParent&&u){if(!a){if(t.inlineFlow==null){const h=t.itemContainer=o.parentNode,g=E.getStyleValue(h,"display"),f=E.getStyleValue(o,"position"),m=E.getStyleValue(o,"display"),p=E.getStyleValue(o,"float");t.columnCount||(t.columnCount=E.getStyleValue(h,"grid-template-columns").split(" ").length),t.inlineFlow=f==="absolute"||m==="inline"||m==="inline-block"||p==="left"||p==="right"||g==="flex"&&E.getStyleValue(h,"flex-direction")==="row"||g==="grid"&&t.columnCount>1,t.columnCount>1&&(t.prevRowKey="ArrowUp",t.nextRowKey="ArrowDown")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=i,s&&!t.disabled)switch(d){case t.prevKey:if(i.ctrlKey&&!t.allowCtrlKey||i.shiftKey&&!t.allowShiftKey)return;i.preventDefault(),i.handled=!0,t.navigatePrevious(i);break;case t.nextKey:if(i.ctrlKey&&!t.allowCtrlKey||i.shiftKey&&!t.allowShiftKey)return;i.preventDefault(),i.handled=!0,t.navigateNext(i);break;case t.prevRowKey:{if(i.ctrlKey&&!t.allowCtrlKey||i.shiftKey&&!t.allowShiftKey)return;i.preventDefault();const h=Array.from(t.itemContainer.querySelectorAll(t.itemSelector));t.activeItem=h[Math.max(h.indexOf(s)-t.columnCount,0)],i.handled=!0}break;case t.nextRowKey:{if(i.ctrlKey&&!t.allowCtrlKey||i.shiftKey&&!t.allowShiftKey)return;i.preventDefault();const h=Array.from(t.itemContainer.querySelectorAll(t.itemSelector));t.activeItem=h[Math.min(h.indexOf(s)+t.columnCount,h.length-1)],i.handled=!0}break;default:{const h=(e=t.keys)==null?void 0:e[c];if(h&&!t.disabled){if(t.callback(h,t.thisObj||r,[i,t,s])===!1)return}else r.onInternalKeyDown&&r.onInternalKeyDown(i);if(E.getActiveElement(l)!==l&&i.preventDefault(),a)return}}else{if(a)return;(d===t.nextKey||d===t.prevKey)&&(t.activeItem=t.getDefaultNavigationItem(i))}t.activeItem!==s&&t.triggerNavigate(i)}}getDefaultNavigationItem(i){const{target:e,itemSelector:t,prevKey:r,nextKey:n}=this;if(e.compareDocumentPosition(i.target)&4&&i.key===r)return e.querySelector(`${t}:last-of-type`);if(e.compareDocumentPosition(i.target)&2&&i.key===n)return e.querySelector(`${t}`)}navigatePrevious(i){const e=this,t=e.previous;i.preventDefault(),t&&e.ownerCmp.scrollable.scrollIntoView(t,{animate:e.scrollDuration}).then(()=>{e.activeItem=t,e.triggerNavigate(i)})}navigateNext(i){const e=this,t=e.next;i.preventDefault(),t&&e.ownerCmp.scrollable.scrollIntoView(t,{animate:e.scrollDuration}).then(()=>{e.activeItem=t,e.triggerNavigate(i)})}get owner(){return this.ownerCmp}get firstItem(){return this.target.querySelector(this.itemSelector)}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(i=1,e=this.activeItem){const t=this.treeWalker;if(t.currentNode=e,t[i<0?"previousNode":"nextNode"](),t.currentNode!==this.activeItem)return t.currentNode}onTargetFocusIn(i){var e;const t=this,{target:r,relatedTarget:n}=i,{owner:s,itemsTabbable:a,skipScrollIntoView:l,previousActiveItem:o}=t;r.matches(".b-focus-trap")||(r.matches(t.itemSelector)?(t.skipScrollIntoView=!0,t.activeItem=r,t.skipScrollIntoView=l,t.activeItem&&a&&t.triggerNavigate(i)):r===t.target&&((n?r.compareDocumentPosition(n):0)&Node.DOCUMENT_POSITION_CONTAINED_BY?(e=s.previousSibling)==null||e.focus():(t.skipScrollIntoView=!0,t.activeItem=o&&t.target.contains(o)?o:0,t.skipScrollIntoView=l)))}onTargetFocusOut(i){const e=this,{relatedTarget:t}=i;t!=null&&t.matches(".b-focus-trap")||(!t||!e.target.contains(t)||!t.matches(e.itemSelector))&&e.activeItem&&(e.activeItem=null,e.itemsTabbable&&e.triggerNavigate(i))}onTargetMouseDown(i){const e=this,t=i.target.closest(e.itemSelector);e.navigationEvent=i,e.itemsTabbable?t===e.activeItem&&e.triggerNavigate(i):e.ownerCmp.itemsFocusable===!1?e.onFocusGesture(i):t&&(i.preventDefault(),t.focus({preventScroll:!0}))}onTargetMouseover({target:i}){this.activeItem=i}onTargetClick(i){var e;const t=this,{skipScrollIntoView:r}=t;if(t.skipNextClick||(e=t.navigationEvent)!=null&&e.ignoreNavigation){t.skipNextClick=!1;return}t.disabled||(t.skipScrollIntoView=t.activateOnMouseover,t.processEvent&&(i=t.callback(t.processEvent,t.thisObj||t.ownerCmp,[i])),i&&(t.activeItem=i.target.closest(t.itemSelector),t.triggerNavigate(i)),t.skipScrollIntoView=r)}onFocusGesture(i){(i.target===this.ownerCmp.contentElement||i.target.closest(this.itemSelector)&&this.ownerCmp.itemsFocusable===!1)&&i.preventDefault()}acceptNode(i){return i.offsetParent&&i.matches&&i.matches(this.itemSelector)?E.NodeFilter.FILTER_ACCEPT:E.NodeFilter.FILTER_SKIP}changeActiveItem(i){return i!=null&&(this.ownerCmp.getItem?i=this.ownerCmp.getItem(i):typeof i=="number"&&(i=this.target.querySelector(this.itemSelector+`:nth-child(${i+1})`))),i!=null&&i.matches(this.itemSelector)?i:null}updateActiveItem(i,e){var t;const r=this,{ownerCmp:n}=r,s=e&&r.target.contains(e),a=i&&E.isFocusable(i)&&i!==E.getActiveElement(i),l=i===e&&s;if(l||(s&&(r.previousActiveItem=e),e&&(e.classList.remove(r.focusCls),e.removeAttribute("id"))),i!=null){if(r.skipScrollIntoView?a&&i.focus({preventScroll:!0}):(t=n.scrollable)==null||t.scrollIntoView(i,{block:"nearest",focus:a,silent:r.scrollSilently}),l)return;i.classList.contains(r.focusCls)||i.classList.add(r.focusCls),i.id=`${r.owner.id}-active-descendant`,r._activeItem=i}else r._activeItem=null,e===E.getActiveElement(e)&&n.revertFocus()}updateTarget(i,e){const t=this,r={element:i,thisObj:t,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:t.itemSelector}};!t.itemsTabbable&&!t.itemsFocusable&&(r.click="onTargetClick"),t.activateOnMouseover&&(r.mouseover={handler:"onTargetMouseover",delegate:t.itemSelector,delay:30}),Object.prototype.hasOwnProperty.call(t,"acceptNode")||(t.acceptNode=t.acceptNode.bind(t)),V.on(r),t.treeWalker=t.setupTreeWalker(i,E.NodeFilter.SHOW_ELEMENT,t.acceptNode),t.keyEventTarget||(t.keyEventTarget=i),(t.targetMutationMonitor=new MutationObserver(t.onTargetChildListChange.bind(t))).observe(i,{childList:!0,subtree:!0})}setupTreeWalker(i,e,t){return document.createTreeWalker(i,e,t)}onTargetChildListChange(){var i;const e=this,{activeItem:t,datasetIdProperty:r}=e;t&&(e.target.contains(t)?t.classList.contains(e.focusCls)||t.classList.add(e.focusCls):e.activeItem=e.target.querySelector(`${e.itemSelector}.${e.focusCls}[data-${O.hyphenate(r)}="${t.dataset[r]}"]`)||((i=e.target.querySelector(`${e.itemSelector}.${e.focusCls}`))==null?void 0:i[t.dataset.index])||null)}updateKeyEventTarget(i){var e;(e=this.keyListenerRemover)==null||e.call(this),this.keyListenerRemover=V.on({element:i,keydown:"onKeyDown",thisObj:this})}triggerNavigate(i,e=this.activeItem){var t;const r={event:i,item:e,oldItem:this.previousActiveItem};this.trigger("navigate",r),(t=this.ownerCmp)==null||t.trigger("navigate",r)}};y(Ki,"$name","Navigator"),y(Ki,"type","navigator"),Ki._$name="Navigator";var O_=class extends $.mixin(Fe){constructor(){super(...arguments),y(this,"hasNativeAccess",!0),y(this,"_content",null)}async writeText(i,e){const t=this,{_content:r}=t;if(e&&t.hasNativeAccess)try{await navigator.clipboard.writeText(i)}catch(n){t.hasNativeAccess=!1}r!==i&&(t._content=i,t.triggerContentChange(r,!1,!0))}writeData(i,e){this._dataContent=i,this._contentSource=e}async readText(i){const e=this,{_content:t}=e;if(i&&e.hasNativeAccess)try{const r=await navigator.clipboard.readText();return t!==r&&(e._content=r,e._dataContent=e._contentSource=null,e.triggerContentChange(t,!0)),r}catch(r){e.hasNativeAccess=!1}return t}readData(i){if(!(i&&!B.asArray(i).includes(this._contentSource)))return this._dataContent}triggerPaste(i){this.trigger("paste",{source:i,text:this._content})}triggerContentChange(i,e=!1,t=!1){this.trigger("contentChange",{fromRead:e,fromWrite:t,oldText:i,newText:this._content})}async clear(i){await this.writeText("",i),this.writeData(null)}},Bw=i=>{var e;return e=class extends(i||$){construct(...t){super.construct(...t),globalThis.bryntum.clipboard||(globalThis.bryntum.clipboard=new O_),globalThis.bryntum.clipboard.ion({paste:"onClipboardPaste",contentChange:"onClipboardContentChange",thisObj:this})}get clipboard(){return globalThis.bryntum.clipboard}onClipboardPaste({text:t,source:r}){var n;const s=this,{clipboardText:a,isCut:l}=s,o=s.compareClipboardText(a,t);o&&l?((n=s.handleCutData)==null||n.call(s,{text:t,source:r}),s.isCut=!1,s.cutData=null):o||s.clearClipboard(!1)}onClipboardContentChange({newText:t}){this.compareClipboardText(this.clipboardText,t)||this.clearClipboard(!1)}set cutData(t){var r,n;const s=this;(r=s._cutData)==null||r.forEach(a=>s.setIsCut(a,!1)),s._cutData=B.asArray(t),(n=s._cutData)==null||n.forEach(a=>s.setIsCut(a,!0))}get cutData(){return this._cutData}async writeToClipboard(t,r,n={}){if(await this.beforeCopy({data:t,isCut:r,...n})===!1)return;const s=this,a=typeof t=="string",l=a?t:s.stringConverter?s.stringConverter(t):O.safeJsonStringify(t),o=a?l:s.cloneData?s.cloneData({data:t,stringData:l,isPaste:!1}):T.clone(t);return s.clipboardText=l,s.clipboard.writeData(o,s.$$name),await s.clipboard.writeText(l,s.useNativeClipboard),s.clipboardData=o,s.originalData=t,s.isCut=r,s.cutData=r&&!a?t:null,{data:r?t:o,clonedData:o,originalData:t,stringData:l}}async readFromClipboard(t={},r=!1){var n;const s=this,{clipboard:a}=s,l=await a.readText(s.useNativeClipboard),o=s.compareClipboardText(s.clipboardText,l),d=o?s.originalData:[];let c=a.readData(s.allowedDataSources);o||s.clearClipboard(!1);const{isCut:u}=s;if((u||!c||c===l)&&(c=s.transformClipboardText(l)),c&&!u&&typeof c!="string"&&s.cloneData&&(c=s.cloneData({data:c,isPaste:!0})),!(c==null||Array.isArray(c)&&c.length===0||await((n=s.beforePaste)==null?void 0:n.call(s,{data:c,text:l,originalData:d,...t,isCut:u,isOwn:o}))===!1))return r||a.triggerPaste(s),{data:c,text:l,isOwn:o,isCut:u,originalData:d}}async clearClipboard(t=!0){const r=this;r.clipboardData=r.originalData=r.clipboardText=r.cutData=null,r.isCut=!1,t&&await r.clipboard.clear(r.useNativeClipboard)}compareClipboardText(t,r){const n=/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/g;return(t==null?void 0:t.replace(n,`
`))===(r==null?void 0:r.replace(n,`
`))}transformClipboardText(t){const r=this;return r.compareClipboardText(r.clipboardText,t)?r.isCut?r.originalData:r.clipboardData:r.stringParser&&t?r.stringParser(t):t}hasClipboardData(){const{clipboard:t}=this,{_content:r}=t;if(!(this.useNativeClipboard&&t.hasNativeAccess))return!!(r&&this.transformClipboardText(r))}},y(e,"$name","Clipboardable"),y(e,"configurable",{useNativeClipboard:!1,allowedDataSources:null}),e},zw=i=>{var e;return e=class extends(i||$){construct(...t){super.construct(...t),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const t=this;let r=t.finalizing;return!r&&!t.isFinalized&&(t.isFinalizing=!0,t.finalizing=r=t._awaitFinalizer()),r}async _awaitFinalizer(){const t=this;try{await t.finalizer}finally{t.finalizing=null,t.isFinalized=!0,t.doFinalize()}}},y(e,"$name","Finalizable"),e},gm=Symbol("dragAbort"),Zu=Symbol("dragInit"),Ww=Symbol("dragDrag"),fm=Symbol("dragDrop"),$_={x:"horizontal",y:"vertical"},ca=class extends $.mixin(zw,fe,Oo){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300,event:null}}static get identifiable(){return{}}construct(...i){super.construct(...i);const e=this,{event:t}=e;Object.assign(e,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:t.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:Zu,startEvent:t,touchStartTimer:null,_valid:!0}),"touches"in t&&e.touchStartDelay&&(e.touchStartTimer=e.setTimeout(()=>e.touchStartTimer=null,e.touchStartDelay,"touchStartDelay"));const r=globalThis;V.on({element:r,blur:"onWindowBlur",thisObj:e,autoDetach:!0})}doDestroy(){const i=this,{source:e,target:t}=i;i.cleanup(),(t==null?void 0:t.dropping)===i&&(t.dropping=null),(e==null?void 0:e.dragging)===i&&(e.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&!this.completed&&this.abort()}get aborted(){return this.state===gm}get completed(){return this.isDestroying||this.aborted||this.endEvent!==null}get pending(){return this.state===Zu}get started(){return this.state!==Zu&&!this.aborted}get valid(){return this.started&&this.targetElement!=null&&this._valid}set valid(i){this._valid=i}async get(i){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(i))return Promise.all(i.map(t=>this.get(t)));let e=this.data.get(i);return typeof e=="function"&&(e=await e(),this.data.set(i,e)),e}has(i){return this.data.has(i)}peek(i){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(i))return i.map(t=>this.peek(t));let e=this.data.get(i);return typeof e=="function"&&(e=!0),e}set(i,e){this.data.set(i,e)}changeTarget(i,e){if(i!==e){const t=this;t._target=i,t.previousTarget=e,e&&(e.dropping=null),i&&(i.dropping=t,i.dropping!==t&&(i=null,t.valid=!1)),t._target=e}return i}updateTarget(i,e){const t=this;e&&t.source.dragLeaveTarget(t,e),i&&(t.valid=!0,i.dragMove(t),t.source.dragEnterTarget(t))}updateTargetElement(i){let e,t,r,n,s;for(s=i;s;s=s.parentElement)if(t=Oe.get(s,"droppables"),t){for(n=0;n<t.length;++n)if(e=t[n],e.dropRootElement.contains(i)&&(r=e.droppableSelector,(!r||i.closest(`#${E.getId(e.dropRootElement)} ${r}`))&&(this.target=e,this.target===e)))return}}abort(){const i=this,{element:e,source:t}=i;e==null||e.getBoundingClientRect(),i.state!==fm&&(i.state=gm,i.cleanup()),t==null||t.endDrag(i)}begin(){const i=this,{source:e}=i,t=e.beforeDrag(i);return t!==!1&&(e.dragging=i),t}cleanup(){let i;for(;i=this.cleaners.pop();)i()}end(i){const e=this,{lastMoveEvent:t,target:r}=e,{dragSwallowClickTime:n}=e.source;if(e.event=e.domEvent=e.endEvent=i,e.syncFlags(),e.started){if(((t==null?void 0:t.clientX)!==i.clientX||(t==null?void 0:t.clientY)!==i.clientY||(t==null?void 0:t.target)!==i.target)&&e.track(),n){const s=globalThis;V.on({element:s,capture:!0,expires:n,once:!0,click(a){a.stopPropagation()}})}e.state=fm,r!==e.source&&(r==null||r.dragDrop(e))}}fakeKey(i,e){const t=this,{lastMoveEvent:r}=t;if(r&&t.element){let n;r.isKey=!0,i.key==="Alt"?t.altKey!==e&&(t.altKey=e,n=!0):i.key==="Control"&&t.ctrlKey!==e&&(t.ctrlKey=e,n=!0),n&&(t.event=t.domEvent=r,t.track())}}keyDown(i){this.completed||(i.key==="Escape"?this.abort():this.isDragToggleKey(i.key)&&this.fakeKey(i,!0))}keyUp(i){!this.completed&&this.isDragToggleKey(i.key)&&this.fakeKey(i,!1)}getDistance(i){return V.getDistanceBetween(this.startEvent,i)}isDragToggleKey(i){return i==="Control"||i==="Alt"}move(i){const e=this,{target:t}=i,r=e.getDistance(i),n=r>=e.threshold;if(e.syncFlags(),e.touchStartTimer){n&&e.abort();return}if(t&&t.nodeType===Node.ELEMENT_NODE&&t.isConnected){if(n&&!e.started&&(e.event=e.domEvent=i,e.start()===!1)){e.abort();return}i.touches&&(e.startEvent.preventDefault(),i.preventDefault(),i.stopPropagation()),e.started&&!e.completed&&(e.lastMoveEvent=e.event=e.domEvent=i,i.type==="touchmove"&&(i.preventDefault(),i.stopImmediatePropagation()),e.track())}}start(){const i=this,{scrollManager:e,monitoringConfig:t,source:r}=i,{draggingBodyCls:n,dragLock:s}=r,a=r.dragRootElement;if(i.state=Ww,e){const o=e.startMonitoring(Z.merge({scrollables:[{element:a}],direction:$_[s]||s||"both",callback(d){const{lastMoveEvent:c}=i;c&&i.element&&(c.isScroll=!0,i.event=i.domEvent=c,i.scrollerAction=d,i.track(),i.scrollerAction=null)}},t));i.cleaners.push(o)}const l=r.dragRootElement.closest(".b-outer")||document.body;if(l.classList.add(n),i.cleaners.push(()=>l.classList.remove(n)),r.startDrag(i)===!1)return i.cleanup(),!1}syncFlags(){const i=this,{event:e}=i;i.altKey=e.altKey,i.ctrlKey=e.ctrlKey||e.metaKey,i.metaKey=e.metaKey,i.shiftKey=e.shiftKey}track(){const i=this,{event:e,source:t,target:r}=i;let n=e.target,s;e.type==="touchmove"&&(s=e.changedTouches[0],n=E.elementFromPoint(s.clientX,s.clientY)),i.targetElement=n,r===i.target&&(r==null||r.dragMove(i)),t.trackDrag(i)}};y(ca,"$name","DragContext"),ca.prototype.STATE=ca.STATE=Object.freeze({ABORTED:gm,INIT:Zu,DRAGGING:Ww,DROPPED:fm}),ca._$name="DragContext";var jw=class TE extends $.mixin(ii){static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:TE}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}};y(jw,"type","default");var sd=jw;sd.initClass(),sd._$name="DragProxy";var ad=i=>{var e;return e=class extends(i||$){beforeDrag(t){const{dragRootElement:r,dragSelector:n,ignoreSelector:s}=this,a=n&&t.element.closest(n);return!n||!!(a&&a===r||r.contains(a)&&(!s||!t.element.matches(s)))}dragStart(t){}dragOver(t){}dragEnterTarget(t){}dragLeaveTarget(t,r){}async dragDrop(t){}dragEnd(t){}get activeDrag(){const{dragging:t}=this;return t!=null&&t.started&&!t.completed?t:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:t,dragRootElement:r}=this;return t?r==null?void 0:r.closest(t):r}beginDrag(t){const{draggingCls:r,draggingClassElement:n}=this;r&&n&&(n.classList.add(r),t.cleaners.push(()=>n.classList.remove(r)))}async endDrag(t){const r=this,{dragEventer:n,dragProxy:s}=r;t.valid&&await r.dragDrop(t),!r.isDestroyed&&(t.pending?t.destroy():(r.dragEnd(t),s==null||s.dragEnd(t),n==null||n.trigger(t.valid?"drop":"dragCancel",{drag:t,event:t.event}),r.finalizeDrag(t)))}async finalizeDrag(t){var r;await((r=t.finalize)==null?void 0:r.call(t))}moveDrag(t){if(this.dragOver(t)!==!1){const{dragEventer:r,dragProxy:n}=this;n==null||n.dragMove(t),r==null||r.trigger("drag",{drag:t,event:t.event})}}setupDragContext(t){const r=this,{dragItemSelector:n,id:s}=r,{target:a}=t;return{event:t,id:s?`${s}-drag-${r._nextDragId=(r._nextDragId||0)+1}`:null,itemElement:n?a.closest(n):a,touchStartDelay:r.dragTouchStartDelay,source:r,threshold:r.dragThreshold}}startDrag(t){const{draggingStartedCls:r,draggingClassElement:n,draggingItemCls:s,dragEventer:a,dragProxy:l}=this,{itemElement:o}=t;if((a==null?void 0:a.trigger("beforeDragStart",{drag:t,event:t.event}))===!1)return!1;r&&n&&(n.classList.add(r),t.cleaners.push(()=>n.classList.remove(r))),s&&o&&(o.classList.add(s),t.cleaners.push(()=>o.classList.remove(s))),l==null||l.dragStart(t);const d=this.dragStart(t);return d!==!1&&(a==null||a.trigger("dragStart",{drag:t,event:t.event})),d}trackDrag(t){var r;const{dropTargetSelector:n}=this;t.valid=!(n&&!((r=t.targetElement)!=null&&r.closest(n))),this.moveDrag(t)}configureListeners(t){const r=this,n=T.assign({thisObj:r},r.dragDocumentListeners);return"touches"in t.startEvent?(delete n.mousemove,delete n.mouseup):(delete n.contextmenu,delete n.touchmove,delete n.touchend,delete n.pointerup),n.element=E.getRootElement(r.dragRootElement),n}updateDragging(t,r){const n=this;if(t){const s=n.configureListeners(t);t.cleaners.push(V.on(s)),n.beginDrag(t)}else r&&r.destroy()}changeDragProxy(t,r){return sd.reconfigure(r,t,{owner:this,defaults:{owner:this}})}updateDragRootElement(t,r){var n;const s=this,{draggableCls:a,dragItemSelector:l,onDragItemMouseMove:o}=s;if(r==null||r.classList.remove(a),(n=s._dragRootDetacher)==null||n.call(s),t){const d={thisObj:s,element:t,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:c=>{var u,h;return c.pointerId&&((h=(u=c.target).releasePointerCapture)==null?void 0:h.call(u,c.pointerId))}};o&&(d.mousemove={delegate:l,handler:"onDragItemMouseMove"}),(s.dragItemOverCls||o||s.onDragItemMouseEnter||s.onDragItemMouseLeave)&&Object.assign(d,{mouseover:{delegate:l,handler:"onDragItemMouseOver"},mouseout:{delegate:l,handler:"onDragItemMouseOut"}}),t.classList.add(a),s._dragRootDetacher=V.on(d)}}onDragItemMouseOver(t){this.overItem=t}onDragItemMouseOut(t){this.dragging||(this.overItem=t)}changeOverItem(t){var r;return this.enterLeaveEvent=t,t.type==="mouseout"?((r=t.relatedTarget)==null?void 0:r.closest(this.dragItemSelector))||null:t.target.closest(this.dragItemSelector)}updateOverItem(t,r){var n,s;const a=this,{dragItemOverCls:l}=a;r&&(l&&r.classList.remove(l),(n=a.onDragItemMouseLeave)==null||n.call(a,a.enterLeaveEvent,r)),t&&(l&&t.classList.add(l),(s=a.onDragItemMouseEnter)==null||s.call(a,a.enterLeaveEvent,t))}onDragContextMenu(t){t.preventDefault()}onDragKeyDown(t){this.dragging.keyDown(t)}onDragKeyUp(t){this.dragging.keyUp(t)}onDragMouseDown(t){t.button===0&&this.onDragPointerDown(t)}onDragPointerDown(t){let{dragging:r}=this;r?r.isFinalizing||r.abort():(r=this.setupDragContext(t),r&&(r=new ca(r),r.begin()===!1&&r.destroy()))}changeDragging(t,r){return r==null||r.destroy(),t}onDragPointerMove(t){const{changedTouches:r}=t,{dragging:n}=this;n&&!n.completed&&(!r||r.length===1)&&(n==null||n.move(t))}onDragPointerUp(t){const{dragging:r}=this;r&&!r.completed&&(r.end(t),this.endDrag(r))}onDragTouchStart(t){t.touches.length===1&&this.onDragPointerDown(t)}},y(e,"$name","Draggable"),y(e,"configurable",{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}),y(e,"properties",{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}),e},Ju=i=>{var e;return e=class extends(i||$){static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(t){var r;return(r=this.dropEventer)==null?void 0:r.trigger("dragEnter",{drag:t,event:t.event})}dragMove(t){var r;return(r=this.dropEventer)==null?void 0:r.trigger("dragMove",{drag:t,event:t.event})}dragDrop(t){var r;return(r=this.dropEventer)==null?void 0:r.trigger("drop",{drag:t,event:t.event})}dragLeave(t){var r;return(r=this.dropEventer)==null?void 0:r.trigger("dragLeave",{drag:t,event:t.event})}changeDropping(t,r){if(t!==r){const n=this;r&&(r.aborted||!r.completed)&&n.dragLeave(r),t&&(n._dropping=t,n.dragEnter(t)===!1&&(t=null),n._dropping=r)}return t}updateDropRootElement(t,r){const n=this,{droppableCls:s}=n;let a,l,o;r&&(a=Oe.get(r,"droppables"),o=!0,Array.isArray(a)&&(l=a.indexOf(n))>-1&&(a.length<2?Oe.remove(r,"droppables"):(a.splice(l,1),a.forEach(d=>{s===d.droppableCls&&(o=!1)}))),o&&r.classList.remove(s)),t&&(a=Oe.get(t,"droppables"),a?a.push(n):Oe.set(t,"droppables",[n]),t.classList.add(s))}},y(e,"$name","Droppable"),e},mm=i=>{var e;return e=class extends(i||$){static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(t){const r={ownerName:"client",...t.featureable};r.factory.initClass(),Reflect.defineProperty(t,"featureable",{get(){return r}})}doDestroy(){var t;const r=this.features;super.doDestroy();for(const n in r){const s=r[n];(t=s.destroy)==null||t.call(s)}}hasFeature(t){var r;return!!((r=this.features)!=null&&r[t])}changeFeatures(t,r){if(this.isDestroying)return;const n=this,{featureable:s}=n.constructor,a=n.$features||(n.$features=new kr({configName:"features",factory:s.factory,owner:n,ownerName:s.ownerName}));if(a.update(t),!r)return a.target}get widgetClass(){}getCurrentConfig(t){const r=super.getCurrentConfig(t),{features:n}=r;if(n)for(const s in n)Object.keys(n[s]).length===0&&(n[s]=!0);return r}},y(e,"$name","Featureable"),e},We={e:"b-hover-edge",t:"b-hover-top",r:"b-hover-right",b:"b-hover-bottom",l:"b-hover-left"},H_={[We.e]:1,[We.t]:1,[We.r]:1,[We.b]:1,[We.l]:1},V_={t:[We.e,We.t],r:[We.e,We.r],b:[We.e,We.b],l:[We.e,We.l],tr:[We.e,We.t,We.r],bl:[We.e,We.b,We.l],tl:[We.e,We.t,We.l],br:[We.e,We.b,We.r]},Uw=i=>{var e;return e=class extends i.mixin(fe){static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(t){}hoverIgnore(t){var r;return(r=this.hoverIgnoreElement)==null?void 0:r.contains(t)}hoverLeave(t){}hoverMove(t){}onHoverMouseMove(t){const r=this,{hoverEdges:n,hoverEdgeSize:s,hoverTarget:a}=r;if(a){if(n){const{top:l,left:o,width:d,height:c,right:u,bottom:h}=a.getBoundingClientRect(),{clientX:g,clientY:f}=t,m=o+d/2,p=l+c/2,v=f<(s?l+s:p),b=g>=(s?u-s:m),w=f>=(s?h-s:p),D=g<(s?o+s:m),S=v||w?v?"t":"b":"",x=b||D?b?"r":"l":"";r.hoverZone=(n.includes(S)?S:"")+(n.includes(x)?x:"")}r.hoverEvent=t,r.hoverTrack&&r.hoverMove(t)}}onHoverMouseOver(t){this.hoverEvent=t,this.hoverElement=t.target}onHoverMouseOut(t){this.hoverEvent=t,this.hoverElement=t.relatedTarget}updateHoverDelay(t){this.setHoverTarget.delay=t}changeHoverEdges(t){return t===!0?"trbl":(t||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(t){if(!this.hoverIgnore(t))return t}updateHoverElement(t){const{hoverSelector:r}=this;r&&(t=t==null?void 0:t.closest(r)),this.setHoverTarget(t)}updateHoverRootElement(t,r){const{hoverRootCls:n}=this;n&&(r==null||r.classList.remove(n),t==null||t.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(t,r){return r&&(this.hoverZone=null),t}updateHoverTarget(t,r){const n=this,{hoverCls:s,hoverAnimationCls:a,hoverRootActiveCls:l,hoverRootElement:o}=n;l&&(o==null||o.classList[t?"add":"remove"](l)),r&&(s&&r.classList.remove(s),a&&r.classList.remove(a),n.hoverLeave(r)),t&&(s&&t.classList.add(s),n.hoverEnter(r),n.hoverTrack&&n.hoverMove(n.hoverEvent),a&&(t.getBoundingClientRect(),t.classList.add(a)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(t){const{hoverAnimationCls:r,hoverTarget:n}=this;if(n){const{className:s}=n,a=te.change(s,t?V_[t]:null,H_);s!==a&&(n.className=a,t&&r&&(n.classList.remove(r),n.getBoundingClientRect(),n.classList.add(r)))}}setHoverTarget(t){this.hoverTarget=t}syncHoverListeners(){var t;const r=this,n=r.hoverRootElement,s={element:n,thisObj:r,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(r.hoverTrack||r.hoverEdges)&&(s.mousemove="onHoverMouseMove"),(t=r._hoverRootDetacher)==null||t.call(r),r._hoverRootDetacher=n&&V.on(s)}},y(e,"$name","Hoverable"),e},pm=i=>{var e;return e=class extends i{static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const t=this,{loadMask:r}=t;return r&&(t.masked=Mn.mergeConfigs(t.loadMaskDefaults,r)),t.masked}applyMaskError(t){const{loadMaskError:r,masked:n}=this;return r===!1?n.hide():n&&(T.assign(n.errorDefaults,r),n.error=t),n}get widgetClass(){}},y(e,"$name","LoadMaskable"),e},N_={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1},Gw=class{static apply(i){if(!i.target)throw new Error("Override must specify what it overrides, using static getter target");if(!i.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(i))return!1;const e=Object.getOwnPropertyNames(i),t=Object.getOwnPropertyNames(i.prototype);return e.splice(e.indexOf("target"),1),this.internalOverrideAll(i.target.class,e,i),this.internalOverrideAll(i.target.class.prototype,t,i.prototype),!0}static internalOverrideAll(i,e,t){Reflect.ownKeys(t).forEach(r=>{if(e.includes(r)&&!N_[r]){const n=Object.getOwnPropertyDescriptor(t,r);let s=i,a=null;for(;!a&&s;)a=Object.getOwnPropertyDescriptor(s,r),a||(s=Object.getPrototypeOf(s));a&&this.internalOverride(s,r,n,a)}})}static internalOverride(i,e,t,r){const n=i._overridden=i._overridden||{};n[e]=i[e],r.get?Object.defineProperty(i,e,{enumerable:!1,configurable:!0,get:t.get}):i[e]=t.value}static shouldApplyOverride(i){const e=i.target;if(!e.maxVersion&&!e.minVersion)return!0;if(!e.product)throw new Error("Override must specify product when using versioning");return!(e.maxVersion&&re[e.product].isNewerThan(e.maxVersion)||e.minVersion&&re[e.product].isOlderThan(e.minVersion))}};Gw._$name="Override";var Qu=60*1e3,An=60*Qu,Xi=24*An,B_=/(\d+)?:?(\d*)/,Me=class vr{static format(e){const t=Math.floor(e/An),r=Math.floor(e/Qu)%60;return`${t}:${r<10?"0":""}${r}`}static parse(e){const t=typeof e;if(t==="string"){const r=B_.exec(e);e=Number(r[1]||0)*An+Number(r[2]||0)*Qu}else t!=="number"?e=C.getTimeOfDay(e):e<=24&&(e*=An);return Math.min(Math.max(Math.floor(e),0),Xi)}constructor(e){let t=0,r,n;e!=null&&e.isDayView?(t=e.dayStartShift,r=e.dayStartTime,n=e.dayEndTime):typeof e=="number"?t=r=n=e:e&&(t=e.startShift,r=e.timeStart,n=e.timeEnd),this.startShift=t=vr.parse(t||0),this.timeEnd=(n==null?(t+Xi)%Xi:vr.parse(n))||Xi,this.timeStart=r==null?t:vr.parse(r)}get startHour(){return Math.floor(this.timeStart/An)}get endHour(){return Math.floor(this.timeEnd/An)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?Xi-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),C.makeKey(e)}dayOfDate(e){return this.shiftDate(C.clearTime(e))}dayOfWeek(e){return e=this.shiftDate(e,-1),e.getDay()}delta(e,t="ms"){const{timeStart:r}=this,n=vr.parse(e),s=(this.startShift&&n<r?n+Xi:n)-r;return t==="ms"?s:C.as(t,s,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:r}=this,n=t<r?r-t:Xi-t+r;return e==="ms"?n:C.as(e,n,"ms")}equals(e){return this.startShift===(e==null?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const r=this,{timeStart:n,timeEnd:s}=r,[a,l]=r._dateRangeArgs(e,t),[o,d]=r.timeRange(a,l);return n<s?o<d?o<s&&n<d:o<s||n<d:!(o<d)||o<s||n<d}isIntraDay(e,t){const r=this,[n,s]=r._dateRangeArgs(e,t),a=r.startOfDay(n),l=Xi-C.diff(a,s,"ms");return l<0?!1:l>0||a<n}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:t,timeStart:r,timeEnd:n}=this,s=vr.parse(e);return r<n?s<r?s<t?1:-1:s<n?0:s<t?-1:1:s<n||s>=r?0:s<t?1:-1}parseKey(e){return this.dayOfDate(C.parseKey(e))}shiftDate(e,t=1){const{startShift:r}=this,n=typeof e;return e=n==="number"?new Date(e):n==="string"?C.parse(e):new Date(e.getTime()),t&&r&&e.setMilliseconds(t>0?r:-r),e}sortEvents(e,t){const r=this.startOfDay(e);return t==null?void 0:t.sort((n,s)=>{n=n.eventRecord||n,s=s.eventRecord||s;let{startDate:a}=n,{startDate:l}=s;return a?l?(a=a<r?r:a,l=l<r?r:l,a-l||s.endDate-l-(n.endDate-a)):1:-1})}startOfDay(e){return e=this.shiftDate(e,-1),e=C.clearTime(e),e=this.shiftDate(e),e}timeRange(e,t){const[r,n]=this._dateRangeArgs(e,t);return[C.getTimeOfDay(r),C.getTimeOfDay(n)]}toString(){const{startShift:e,timeEnd:t,timeStart:r}=this,n=e?`@${vr.format(e)}`:"",s=vr.format(r);return r===t?e?n:s:`${s}-${vr.format(t)}${n}`}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}};Me.MIDNIGHT=new Me({startShift:0,timeStart:0,timeEnd:24}),Me.MILLIS_PER_MINUTE=Qu,Me.MILLIS_PER_HOUR=An,Me.MILLIS_PER_DAY=Xi,Me._$name="DayTime";var eh=class ME extends ${static getVisitor(e,t){const{elementVisitorMap:r}=this,n=r.get(e)||r.set(e,new Map).get(e),s=typeof t=="string"?t:t.toString();return n.get(s)||n.set(s,new ME({element:e,selector:t})).get(s)}updateSelector(e){this.treeWalker=document.createTreeWalker(this.element,NodeFilter.SHOW_ELEMENT,typeof e=="string"?t=>{var r;return(r=t.matches)!=null&&r.call(t,e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}:e)}first(){return this.treeWalker.currentNode=this.element,this.treeWalker.firstChild()}previous(e){return e&&(this.treeWalker.currentNode=e),this.treeWalker.previousNode()}next(e){return e&&(this.treeWalker.currentNode=e),this.treeWalker.nextNode()}last(){return this.treeWalker.currentNode=this.element,this.treeWalker.lastChild()}};y(eh,"$name","ElementVisitor"),y(eh,"configurable",{element:null,selector:null}),y(eh,"elementVisitorMap",new WeakMap);var Ti=eh;Ti._$name="ElementVisitor";var Mi=class extends ft{afterShow(){super.afterShow(...arguments),this.addDocumentMouseDownListener()}realign(){super.realign(...arguments),this.syncTargetHighlighting()}get isTopModal(){return!1}owns(){return this.masked?!0:super.owns(...arguments)}onDocumentMouseDown({event:i}){i.isTrusted&&(this.owns(i.target)?super.onDocumentMouseDown(...arguments):this.hintFlow.stop())}changeTarget(i){if(i&&(typeof i=="string"&&(this._target=this._forElement=null),i=this.hintFlow.normalizeTarget(i),T.isPromise(i))){i.then(e=>!this.isDestroyed&&(this.target=e)),this.setTimeout("hide",this.maxWait);return}return i}updateButtons(i){this.bbar={items:i}}updateHighlightTarget(i,e){const t=i==null?void 0:i.inflate;t?(this.initialInflate=this.align.inflate,this.align.inflate=t):this.align.inflate=this.initialInflate}updateTarget(i){i instanceof Element&&(this.forElement=i)}changeHighlighter(i,e){if(i)return z.reconfigure(e,z.mergeConfigs({owner:this},i),this);e==null||e.destroy()}async updateForElement(i){const e=this,{autoNext:t,owner:r,index:n}=e;if(e.syncTargetHighlighting(),e.clearTimeout("hide"),e.hidden=!1,e.showBy({target:e.forElement}),!e.element.matches(":focus-within")&&e.focus(),t)switch(typeof t){case"number":e.setTimeout(()=>r.navigate(1),t);break;case"string":if(await Qe.sleep(500),e.index===n){const s=await(e.autoNextPromise=r.normalizeTarget(t,!1));e.autoNextPromise=null,s&&r.navigate(1,!1)}break;case"function":await Qe.waitFor(t,1e4),r.navigate(1,!1)}}syncTargetHighlighting(){if(!this.isVisible)return;const i=this,{highlightTarget:e,highlighter:t,forElement:r}=i,{classList:n}=i.element,s={"--b-hint-highlight-color":""},a=t==null?void 0:t.element,l=a==null?void 0:a.classList,o=e==null?void 0:e.inflate;if(l==null||l.remove("b-hint-highlighter-ping","b-hint-highlighter-center"),n[i.scrollRealigning?"add":"remove"]("b-scroll-realigning"),r){const{style:d}=i.floatRoot,c=r.ownerDocument.defaultView.getComputedStyle(r),u=E.isInView(r,!1,this),h=e!=null&&e.center?u.center.inflate(10):u;if(o&&h.inflate.apply(h,Array.isArray(o)?o:[o]),e&&!(e!=null&&e.center))for(const g of["top","bottom"])for(const f of["left","right"]){const m=c.getPropertyValue(`border-${g}-${f}-radius`);s[`border-${g}-${f}-radius`]=parseInt(m)?m:""}typeof(e==null?void 0:e.center)=="string"&&(s["--b-hint-highlight-color"]=e.center),d.setProperty("--b-highlight-top",`${h.top}px`),d.setProperty("--b-highlight-left",`${h.x}px`),d.setProperty("--b-highlight-width",`${h.width}px`),d.setProperty("--b-highlight-height",`${h.height}px`)}e&&(l[i.scrollRealigning?"add":"remove"]("b-realigning"),E.applyStyle(a,s),t.show(),e.ping&&V.onTransitionEnd({element:a,property:"inset-inline-start",once:!0,thisObj:i,timeout:500,handler:()=>{l.add("b-hint-highlighter-ping")}}),e.center&&l.add("b-hint-highlighter-center")),i.requestAnimationFrame(()=>{n.remove("b-scroll-realigning"),l.remove("b-realigning")})}next(){this.index<this.owner.hints.length-1&&this.owner.navigate(1)}previous(){this.index&&this.owner.navigate(-1)}stop(){this.owner.stop()}};y(Mi,"$name","Hint"),y(Mi,"type","hint"),y(Mi,"configurable",{ui:"plain",defaultFocus:i=>!i.hidden&&(i.ref==="next"||i.ref==="stop"),align:{align:"t-b",allowTargetOut:!0},anchor:!0,autoShow:!1,autoClose:!1,centered:!1,allowOver:!0,closable:!0,minWidth:"max-content",closeAction:"stop",previousAction:null,nextAction:null,keyMap:{P:"previous",N:"next",S:"stop"},buttons:null,maxWait:1e4,highlightTarget:null,highlighter:{$config:["lazy","nullify"],value:{floating:!0,cls:"b-hint-highlighter"}},autoNext:null,target:null}),Mi.initClass(),Mi._$name="Hint";var Yw=(i,e)=>({previous:{weight:100,text:"L{Object.previous}",cls:"b-raised b-previous",hidden:!i,onClick:"up.onHintButtonClick"},next:{weight:100,text:"L{Object.next}",cls:"b-raised b-blue b-next",hidden:i===e-1,onClick:"up.onHintButtonClick"},stop:{weight:300,text:"L{Object.close}",cls:"b-raised b-red b-stop",hidden:i!==e-1,onClick:"up.onHintButtonClick"}}),qw=/\[(?:([\w+]+)\+)?(\w+)\]|./g,vm=class extends $.mixin(Nt,Fe,fe){constructor(){super(...arguments),y(this,"waitInterval",100),y(this,"maxWait",1e4),y(this,"keyStrokeIntervalRandomness",100)}onHintButtonClick({source:i}){const e=this;switch(i.ref){case"next":e.navigate(1);break;case"previous":e.navigate(-1);break;case"stop":e.stop();break;case"completed":e.trigger("completed"),e.stop();break}}async fakeType(i){var e;let{target:t,text:r,initialDelay:n=0,focus:s}=i;typeof i=="string"&&(t=document.activeElement,r=i),s!==!1&&this.activeHint.revertFocus(),t?(t=await this.normalizeTarget(t),s!==!1&&t.focus()):t=E.getActiveElement(this.activeHint.element),i.clear&&(t.value=""),await Qe.sleep(n);for(let a=qw.exec(r);a;a=qw.exec(r)){if(a[2]){const l=(((e=a[1])==null?void 0:e.split("+"))||[]).reduce((d,c)=>(d[`${c.toLowerCase()}Key`]=!0,d),{}),o={key:a[2],bubbles:!0,...l};t.dispatchEvent(new KeyboardEvent("keydown",o)),t.dispatchEvent(new KeyboardEvent("keyup",o))}else t.value+=a[0],t.dispatchEvent(new Event("input",{data:a[0]}));await Qe.sleep(Math.random()*this.keyStrokeIntervalRandomness+30)}t.dispatchEvent(new Event("change"))}normalizeTarget(i,e=this.maxWait){return E.waitForSelector(i,e,this.waitInterval)}navigate(i,e=!0){this.navigationOngoing||(this.navigationOngoing=new Promise(async t=>{const r=this,{activeHint:n}=r,s=r.activeIndex+i,a=le.ion({mouseup:({event:o})=>r.squashDocumentEvents(o)}),l=V.on({element:document,mousedown:"squashDocumentEvents",keydown:"squashDocumentEvents",thisObj:r,capture:!0});try{if(n.masked=!0,r.allowInteraction=!1,e){const o=r.processActions(r.activeHint[i===1?"nextAction":"previousAction"]);if(await Qe.animationFrame(),r.normalizeTarget(n.target,-1).nodeType!==1){const d=r.normalizeTarget(r.hints[s].target,-1);(d==null?void 0:d.nodeType)===1?n.target=d:E.applyStyle(n.floatRoot,{"--b-highlight-width":"0px","--b-highlight-height":"0px"})}await o}r.activeIndex=s,await r.activeIndexUpdated,r.navigationOngoing=null,n.masked=!1}finally{a==null||a(),l==null||l(),r.navigationOngoing&&(r.navigationOngoing=null,n.element.classList.remove("b-no-title"),n.hide(!1),Mi.reconfigure(n,{hidden:!1,masked:!1,centered:!0,title:"Navigation timed out",content:"Navigation could not be completed.",nextAction:null,bbar:{items:Yw(0,1)}})),t()}}))}squashDocumentEvents(i){i.isTrusted&&(this.activeHint.element.contains(i.target)||!this.allowInteraction)&&(i.preventDefault(),i.stopImmediatePropagation())}async processActions(i){var e;const t=this;if(i)if(Array.isArray(i))for(const r of i)await t.processActions(r);else for(const[r,n]of Object.entries(i))switch(r){case"type":await t.fakeType(n);break;case"dblclick":case"click":case"contextmenu":{const s=typeof n=="string",a=await t.normalizeTarget(s?n:n.target),l=!s&&n.focus;if(l){const o=E.getActiveElement(a);!E.triggerMouseEvent(a,"mousedown").defaultPrevented&&E.getActiveElement(a)===o&&((e=E.closest(a,E.isFocusable))==null||e.focus())}E.triggerMouseEvent(a,r),l&&E.triggerMouseEvent(a,"mouseup")}break;case"fn":await t.activeHint.callback(n,t.activeHint);break;case"drag":await t.drag(n);break;case"waitFor":isNaN(n)?await t.normalizeTarget(n):await Qe.sleep(n);break;case"allowInteraction":t.allowInteraction=n;break}}async drag({target:i=this.activeHint.target,by:[e,t],duration:r=500}){const n=await this.normalizeTarget(i),{ownerDocument:s}=n,{activeHint:a}=this,{modalMask:l}=a,{x:o,y:d}=L.from(n).center.roundPx(1),c=E.createElement({parent:s.body,className:"b-mouse-pointer b-icon b-fa-mouse-pointer",style:{left:`${o}px`,top:`${d}px`}}),u={clientX:o,clientY:d,bubbles:!0},{style:h}=a.floatRoot;l&&(l.style.pointerEvents="none",h.setProperty("--b-highlight-width","0px"),h.setProperty("--b-highlight-height","0px"));let g,f;n.dispatchEvent(new PointerEvent("pointerover",u)),n.dispatchEvent(new MouseEvent("mouseover",u)),n.dispatchEvent(new PointerEvent("pointerdown",u)),n.dispatchEvent(new MouseEvent("mousedown",u)),await Qe.animationFrame(),await be.animate(r,async m=>{u.clientX=o+e*m,u.clientY=d+t*m,l.style.pointerEvents="none",g=s.elementFromPoint(u.clientX,u.clientY),c.style.cssText=`left:${u.clientX}px;top:${u.clientY}px`,g.dispatchEvent(new PointerEvent("pointermove",u)),g.dispatchEvent(new MouseEvent("mousemove",u)),g!==f&&(g.dispatchEvent(new PointerEvent("pointerenter",u)),g.dispatchEvent(new MouseEvent("mouseenter",u)),g.dispatchEvent(new PointerEvent("pointerover",u)),g.dispatchEvent(new MouseEvent("mouseover",u)),f=g),l.style.pointerEvents=""}),h.setProperty("--b-highlight-top",`${u.clientY}px`),h.setProperty("--b-highlight-left",`${u.clientX}px`),g.dispatchEvent(new PointerEvent("pointerup",u)),g.dispatchEvent(new MouseEvent("mouseup",u)),c.remove()}async updateActiveIndex(i,e){var t,r;const n=this,{hints:s,activeHint:a}=n,l=s.length,o=s[i];if((t=a==null?void 0:a.autoNextPromise)==null||t.resolve(),o){const d=await n.normalizeTarget(o.target);if(d===!1){n.activeIndex=++i;return}a?(typeof o.target=="string"&&(a._target=a._forElement=null),a.bbar.element.matches(":focus-within")&&a.element.focus()):n.returnFocusTo=E.getActiveElement();const c={steps:{type:"widget",content:`${i+1}/${l}`,weight:-1e3},completed:{text:n.L("L{Hint.dontShowAgain}"),cls:"b-transparent",weight:10,onClick:"up.onHintButtonClick"},...T.merge(Yw(i,l),Array.isArray(o.buttons)?T.transformArrayToNamedObject(o.buttons):o.buttons)},u=n.activeHint=Mi.reconfigure(a,Mi.mergeConfigs(n.defaults,{index:i,hintFlow:n,owner:n,maxWait:n.maxWait,rootElement:document.body},o,{target:d,buttons:c}));n.owner=Mi.fromElement(d),u.element.classList.toggle("b-no-title",!o.title),await Promise.all([u.highlighter.element.isConnected&&E.waitForSelector(u.highlighter.element,-1e3),E.waitForSelector(u.element,-1e3)]),u.isVisible&&((r=u.bbar.widgetMap[i===l-1?"stop":i&&i<e?"previous":"next"])==null||r.focus())}else n.stop()}async stop(){var i;const e=this;e.activeIndex===e.hints.length-1&&await e.processActions(e.activeHint.nextAction),e.activeHint.owner=null,bryntum.queryAll("hint").forEach(t=>t.hintFlow===e&&t.destroy()),e.activeHint=null,(i=e.returnFocusTo)==null||i.focus()}};y(vm,"configurable",{activeIndex:0,hints:null,defaults:{type:"hint",align:{allowTargetOut:!0},closable:!0,draggable:!1,buttons:{},autoNext:null,nextAction:null,previousAction:null,minWidth:null,trapFocus:!0,title:new String("")}}),vm._$name="HintFlow";var Kw=class _E extends Fe($){static get configurable(){return{date:{$config:{equal:"date"},value:C.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e=typeof e=="string"?C.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const r=this,{dayColumnIndex:n,weekCount:s}=r,a=C.getFirstDateOfMonth(e),l=C.getLastDateOfMonth(a),o=n[a.getDay()],d=n[l.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),u=!t||e.getMonth()!==t.getMonth(),h=r.eventListeners&&(t?e.getDate()!==t.getDate()|(r.getWeekId(e)!==r.getWeekId(t))<<1|u<<2|c<<3:15);if(r._year=e.getFullYear(),r._month=e.getMonth(),r.startDayOfMonth=1-o,r.endDayOfMonth=l.getDate()+(6-d),r.sixWeeks&&(r.endDayOfMonth+=(6-r.weekCount)*7),(!r.weekBase||c)&&r.calculateWeekBase(),(u||c)&&r.generation++,h){const g={newDate:e,oldDate:t,changes:{d:!0,w:!!(h&2),m:!!(h&12),y:!!(h&8),r:r.weekCount!==s}};r.trigger("dateChange",g),h&2&&r.trigger("weekChange",g),h&12&&r.trigger("monthChange",g),h&8&&r.trigger("yearChange",g)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,r=new Date(e.year,0,1),n=new Date(e.year,11,31),s=e.month?e.getOtherMonth(r):e;e.dayColumnIndex[r.getDay()]>3?e.weekBase=s.startDate:e.weekBase=new Date(e.year,0,s.startDayOfMonth-7);const a=Math.floor(C.diff(e.weekBase,n,"day")/7);e.has53weeks=a===53&&t[n.getDay()]>2}getWeekStart(e){if(typeof e=="number")return C.add(this.weekBase,Math.max(e,1)*7,"day");const t=this,[r,n]=e;return r===t.year?t.getWeekStart(n):t.getOtherMonth(new Date(r,0,1)).getWeekStart(n)}getOtherMonth(e){const t=this,r=t===Xw?new _E(null):Xw;return r.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),r.date=e,r.updateDate(r.date,r.date),r}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:C.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||C.nonWorkingDays}changeNonWorkingDays(e){return T.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,e.endDayOfMonth)}get firstDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month,1)}get lastDate(){const e=this;if(e.year!=null&&e.month!=null&&e.startDayOfMonth!=null)return new Date(e.year,e.month+1,0)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:r}=t;for(let n=t.startDayOfMonth,s=0;s<r;s++){const a=[],l=t.getWeekNumber(new Date(t.year,t.month,n));for(let o=0;o<7;o++,n++)a.push(new Date(t.year,t.month,n));e(l,a,s,s===r-1)}}getWeekNumber(e){const t=this;if(e=C.clearTime(e),e.getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let r=Math.floor(C.diff(t.weekBase,e,"day")/7),n=e.getFullYear();if(r)r===53&&!t.has53weeks?(r=1,n++):r>53&&(r=r%52);else return t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0));return[n,r]}getWeekId(e){const t=this.getWeekNumber(e);return t[0]*100+t[1]}getCellData(e,t,r=Me.MIDNIGHT){const n=this,s=e.getDay(),a=n.visibleDayColumnIndex[s],l=n.nonWorkingDays[s],o=n.hideNonWorkingDays&&l;return(e<n.startDate||e>n.endDate)&&(n.month=e.getMonth()),{day:s,dayTime:r,visibleColumnIndex:a,isNonWorking:l,week:n.getOtherMonth(e).getWeekNumber(e),key:C.format(e,"YYYY-MM-DD"),columnIndex:n.dayColumnIndex[s],date:new Date(e),dayEnd:r.duration("s"),tomorrow:r.dayOfDate(C.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+e.getFullYear()*12-(t.month+t.year*12)),visible:!o&&e>=t.startDate&&e<C.add(t.endDate,1,"day"),isRowStart:a===0,isRowEnd:a===n.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:r,hideNonWorkingDays:n}=e,s=e.dayColumnIndex=[],a=e.canonicalDayNumbers=[],l=e.visibleDayColumnIndex=[];let o=0;for(let d=0;d<7;d++){const c=(t+d)%7;a[d]=c,s[c]=d,(!n||!r[c])&&(l[c]=o++)}e.visibleColumnCount=o,e.weekLength=n?7-T.keys(r).length:7}};y(Kw,"$name","Month");var _i=Kw,Xw=new _i(null);_i._$name="Month";var z_=0,Zw=new WeakMap,W_=(...i)=>i.map(e=>{let t;return e&&typeof e=="object"||typeof e=="function"?(t=Zw.get(e),t===void 0&&(t=++z_,Zw.set(e,t))):t=String(e),t}).join("-"),Ar=i=>{const e=new Map;return(...t)=>{const r=W_(t);let n=e.get(r);return n===void 0&&(n=i(...t),e.set(r,n)),n}},ld=i=>{const e=new Map,t=c=>c[0],r=c=>c[1],n=(c,u)=>t(c).push(u),s=(c,u)=>r(c).push(u),a=(c,u)=>r(c).some(h=>T.isEqual(h,u)),l=()=>[[],[]],o=c=>!r(c).length&&!t(c).length,d=c=>{let u=e.get(c);return u===void 0&&(u=l(),e.set(c,u)),u};return(c,u)=>{const h=d(c);o(h)?(n(h,u),i(c,g=>{a(h,g)||(s(h,g),t(h).forEach(f=>f(g)))})):(n(h,u),r(h).forEach(g=>u(g)))}},Jw=Symbol("success"),j_=Symbol("failure"),th=(i,e)=>[Jw,i,e],ym=i=>[j_,i],bm=i=>i.length&&i[0]===Jw,od=i=>typeof i=="function"&&!i.length?i():i,ih=Ar(i=>ld((e,t)=>t(th(i,e)))),U_=Ar(i=>ld((e,t)=>{const r=Math.min(i.length,e.length),n=e.substr(0,r),s=e.substr(r);t(n===i?th(n,s):ym(s))})),rh=(i,e)=>(t,r)=>od(i)(t,n=>{if(bm(n)){const[,s,a]=n;e(s)(a,r)}else r(n)}),G_=Ar((...i)=>{const e=Ar((t,r)=>ld(rh(t,n=>rh(r,s=>ih([].concat(n,s))))));return i.reduce(e,ih([]))}),Y_=Ar((...i)=>ld((e,t)=>i.forEach(r=>od(r)(e,t)))),q_=Ar(i=>(e,t)=>{const r=new RegExp(`^${i}`),n=r.exec(e);if(n){const s=n[0],a=e.substr(s.length);t(th(s,a))}else t(ym(e))}),K_=Ar((i,e)=>rh(i,(...t)=>ih(e(...[].concat.apply([],t))))),Qw=(i,e)=>{const t=[];return i(e,r=>{if(bm(r)){const[,,n]=r;n===""&&t.push(r)}}),t},X_=i=>(e,t)=>t?od(i)(e,t):Qw(od(i),e),Z_={memo:Ar,memoCps:ld,success:th,failure:ym,isSuccess:bm,resolveParser:od,succeed:ih,string:U_,bind:rh,seq:G_,alt:Y_,regexp:q_,red:K_,runParser:Qw,defineParser:X_},dd=class extends $.mixin(fe,Fe){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(i,e){return e==null||e.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return Object.keys(this.activeScroll).length!==0}get rtl(){var i;return(i=this.owner)==null?void 0:i.rtl}startMonitoring(i={}){const e=this,{element:t,direction:r}=e,{scrollables:n=[],direction:s=r,callback:a}=i,l=[];return n.length||n.push({element:t}),n.forEach(o=>{const d=o.element;typeof d=="string"?E.forEachSelector(t,d,c=>{e.createMonitor(c,o.direction||s,o.callback||a),l.push(c)}):(e.createMonitor(d,o.direction||s,o.callback||a),l.push(d))}),function(){var d;(d=e.stopMonitoring)==null||d.call(e,l)}}createMonitor(i,e,t){const{monitoring:r}=this;r.has(i)||r.set(i,new J_({scrollManager:this,element:i,direction:e,callback:t}))}stopMonitoring(i){const e=this,{monitoring:t}=e;if(i=B.asArray(i),t){if(!i){t.forEach(r=>e.stopMonitoring(r.element));return}i.forEach(r=>{const n=t.get(r);r.classList.remove("b-scrolling"),n&&(n.destroy(),t.delete(r))})}}requestScroll(i,e){const{activeScroll:t}=this;return i in t&&t[i]!==e?!1:(t[i]=e,!0)}releaseScroll(i){const{activeScroll:e={}}=this;Object.keys(e).forEach(t=>{e[t]===i&&delete e[t]})}getRelativeScroll(i,e="left"){let t=0;return this.monitoring.forEach((r,n)=>{E.isDescendant(n,i)&&(t+=e==="left"?r.scrollRelativeLeft:r.scrollRelativeTop)}),t}},J_=class extends ${construct(i){const e=this,{element:t}=i,r=t.scrollLeft,n=t.scrollTop;Object.assign(i,{startScrollLeft:r,startScrollTop:n}),super.construct(i),V.on({element:t,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:e}),V.on({element:t,pointerleave:"onPointerLeave",thisObj:e})}doDestroy(){this.stopScroll(!0),super.doDestroy()}startScroll(){const i=this;i.pendingScrollFinalize&&(i.scrollManager.releaseScroll(i),i.pendingScrollFinalize=!1),i.scrolling=!0,i.performScroll()}stopScroll(i=null){const e=this,t=()=>{e.pendingScrollFinalize=!1,e.isDestroyed||(e.scrollManager.releaseScroll(e),e.scrolling=!1)};e.scrollRequested&&(e.scrollManager.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),e.scrollManager.clearTimeout(e.scrollTimeout),e.scrollTimeout=null,!i&&(e.ongoingScrollTop||e.ongoingScrollLeft)?(e.pendingScrollFinalize=!0,Promise.all([e.ongoingScrollTop,e.ongoingScrollLeft].filter(Boolean)).then(()=>e.pendingScrollFinalize&&t())):(e.ongoingScrollTop=e.ongoingScrollLeft=null,t())}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(i){const e=this,{scrollManager:t}=e,r=e.element.getBoundingClientRect(),n=t.zoneWidth,s=t.scrollSpeed;if(e.scrollDeltaX=e.scrollDeltaY=0,e.direction!=="vertical"){const{scrollLeft:a,scrollWidth:l,clientWidth:o}=e.element;t.rtl?i.clientX<r.left+n&&l+a-o>=1?e.scrollDeltaX=-Math.round((n+(r.left-i.clientX))/s)-1:i.clientX>r.right-n&&a<0&&(e.scrollDeltaX=Math.round((n-(r.right-i.clientX))/s)+1):i.clientX>r.right-n&&l-a-o>=1?e.scrollDeltaX=Math.round((n-(r.right-i.clientX))/s)+1:i.clientX<r.left+n&&a>0&&(e.scrollDeltaX=-Math.round((n+(r.left-i.clientX))/s)-1)}if(e.direction!=="horizontal"){const{scrollTop:a,scrollHeight:l,clientHeight:o}=e.element;i.clientY>r.bottom-n&&l-a-o>=1?e.scrollDeltaY=Math.round((n-(r.bottom-i.clientY))/s)+1:i.clientY<r.top+n&&a>0&&(e.scrollDeltaY=-Math.round((n+(r.top-i.clientY))/s)-1)}e.scrollDeltaX!==0&&!t.requestScroll("horizontal",e)&&(e.scrollDeltaX=0),e.scrollDeltaY!==0&&!t.requestScroll("vertical",e)&&(e.scrollDeltaY=0),e.scrollDeltaX===0&&e.scrollDeltaY===0?e.scrolling&&e.stopScroll():e.scrollTimeout||(e.scrollTimeout=t.setTimeout(()=>e.startScroll(),t.startScrollDelay))}performScroll(){const i=this,{element:e,scrollManager:t}=i;if(i.scrolling&&!i.scrollRequested){if(i.scrollDeltaX!==0){const r=e.scrollLeft,n=Math.min(r+i.scrollDeltaX,e.scrollWidth-e.clientWidth);e.scrollLeft=n,e.scrollLeft!==r?i.ongoingScrollLeft=new Promise(s=>e.addEventListener("scroll",a=>{var l;(l=t.trigger)==null||l.call(t,"scroll",{event:a,deltaY:i.scrollDeltaY,deltaX:i.scrollDeltaX}),s()},{once:!0})):(i.ongoingScrollLeft=null,i.scrollDeltaX=0)}if(i.scrollDeltaY!==0){const r=e.scrollTop,n=Math.min(r+i.scrollDeltaY,e.scrollHeight-e.clientHeight);e.scrollTop=n,e.scrollTop!==r?i.ongoingScrollTop=new Promise(s=>e.addEventListener("scroll",a=>{var l;(l=t.trigger)==null||l.call(t,"scroll",{event:a,deltaY:i.scrollDeltaY,deltaX:i.scrollDeltaX}),s()},{once:!0})):(i.ongoingScrollTop=null,i.scrollDeltaY=0)}i.scrollDeltaX!==0||i.scrollDeltaY!==0?(i.scrollRequested=!0,i.frameId=i.scrollManager.requestAnimationFrame(()=>{i.scrollRequested=!1,i.performScroll(i)})):i.stopScroll()}}onElementScroll(){var i,e;(e=(i=this.config)==null?void 0:i.callback)==null||e.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(i){return this.scrollManager.getRelativeScroll(i,"left")}getRelativeTopScroll(i){return this.scrollManager.getRelativeScroll(i,"top")}};dd._$name="ScrollManager";var Q_={left:!0,right:!0,top:!0,bottom:!0,transform:!0},ek={true:1,false:1},tk=Promise.resolve(),Cm=class yr extends ft{static get configurable(){return{autoHide:!0,mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:null,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,draggable:!1,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:{$config:{equal:(e,t)=>e==null&&t==null||e===t},value:null},testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null},role:"tooltip",describedElement:null}}afterConfigure(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=e.showOnHover!==!1,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=V.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;(e=this.pointerOverOutDetacher)==null||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){var e;return((e=this.triggeredByEvent)==null?void 0:e.pointerType)==="focus"?!1:super.focusOnToFront&&E.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){var t;const r=this,{triggeredByEvent:n}=r;n&&E.isTouchEvent&&e.pageX===n.pageX&&e.pageY===n.pageY&&(t=r.activeTarget)!=null&&t.contains(e.target)&&performance.now()-n.timeStamp<500||(r.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,{target:r,relatedTarget:n}=e,{forElement:s,forSelector:a,activeTarget:l}=t;let o;if(!(t.disabled||t.owner&&!t.owner.showTooltipWhenDisabled&&t.owner.disabled)&&!(t.allowOver&&t.element.contains(r))){if(a){const d=e.target.closest("[data-btip]");if(d&&!d.matches(a)){l&&t.handleForElementOut();return}if(o=t.filterTarget(e),!this.hasTimeout("hide")&&(l!=null&&l.contains(r))&&l.contains(n)&&o===l||o&&(n==null?void 0:n.closest(a))===o&&!n.dataset.btip)return}else if(!s.contains(n))o=s;else return;o?t.handleForElementOver(e,o):l&&t.handleForElementOut()}}filterTarget({target:e}){return e.closest(this.forSelector)}realignOnTransitionEnd(e){var t;const r=this,{currentOverElement:n}=yr;if(Q_[e.propertyName]){if(r.allowOver&&r.element.contains(n))return;(t=r.activeTarget)!=null&&t.contains(n)&&!r.trackMouse&&r.realign()}}async handleForElementOver(e,t){const r=this,{activeTarget:n,hideOnDelegateChange:s,anchorToTarget:a}=r,l=t!==n,o=l&&s;if(r.trigger("pointerOver",{event:e,target:t})===!1)r.internalOnPointerOut(e);else{if(r.triggeredByEvent=e,r.hasTimeout("hide")&&(r.abortDelayedHide(),!l))return;if(!s&&r.element.classList.contains("b-hiding")&&r.cancelHideShowAnimation(),!r._hidden&&o&&r.hide(!1),r.activeTarget&&r.hasTimeout("show")&&r.clearTimeout("show"),r.activeTarget=t,r.activeTarget!==t){r.internalOnPointerOut(e);return}if(r.isVisible){r.lastAlignSpec=null;const d=r.updateContent();if(Z.isPromise(d)&&!r.loadingMsg&&await d,r.trigger("beforeShow")===!1)return r.hide();r.alignTo({[a?"target":"position"]:a?t:"mouse",overlap:!(a&&r.anchor)}),r.trigger("show"),r.afterShowByTarget()}else r.activeTarget=t,r.delayShow(t)}}async delayShow(e){var t;const r=this;if((t=r.currentAnimation)!=null&&t.showing&&r.cancelHideShowAnimation(),!r.isVisible&&!r.hasTimeout("show"))if(!r.hoverDelay||r.forSelector&&Date.now()-r.lastHidden<r.quickShowInterval){const n=r.updateContent();Z.isPromise(n)&&!r.loadingMsg&&await n,r.showByTarget(e)}else r.addDocumentMouseDownListener(),!r.listeningForMouseMove&&!r.anchorToTarget&&(r.mouseMoveRemover=V.on({element:r.rootElement,mousemove:"onMouseMove",thisObj:r})),r.setTimeout(async()=>{if(r.activeTarget===e&&e.isConnected){const n=r.updateContent();Z.isPromise(n)&&!r.loadingMsg&&await n,r.showByTarget(e)}},!r.triggeredByEvent||r.triggeredByEvent.type==="pointerover"?r.hoverDelay:0,"show");else r.isVisible&&r.showByTarget(e)}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){var t;const r=this,{element:n}=r;n.classList.toggle("b-allow-over",!!e),e?r.allowOverlisteners=V.on({element:n,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:r}):(t=r.allowOverlisteners)==null||t.call(r)}updateContent(){const e=this;if(e.getHtml){const t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}get hasContent(){return!!(E.isVueConfig(this._html)||E.isReactElement(this._html)||this._html!==""&&typeof this.html=="string"&&this.html.length||this.items.length)}internalBeforeShow(){const e=this;return e.isSharedTooltip&&si.dragging?!1:(e.updateContentOnMouseMove||e.hasContent)&&!e.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`
                <div class="b-tooltip-loading">
                    <i class="b-icon b-icon-spinner"></i>
                    ${O.encodeHtml(e)}
                </div>
            `)}showByTarget(e){var t;const r=this,{anchorToTarget:n}=r;r.mouseMoveRemover=(t=r.mouseMoveRemover)==null?void 0:t.call(r),r.showBy({[n?"target":"position"]:n?e:"mouse",overlap:!(n&&r.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:t,activeTarget:r}=e,n=E.getActiveElement(e.activeTarget);e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.element.parentNode&&e.toFront(),!e.mouseMoveRemover&&(e.trackMouse||e.updateContentOnMouseMove)&&(e.mouseMoveRemover=V.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.describedElement=r!=null&&r.contains(n)?n:null,e.inAfterShow=!0,e.allowOver=e.allowOver||e.configuredAllowOver!=!1&&e.childItems.some(s=>s.isVisible&&!s.disabled&&s.focusElement),e.inAfterShow=!1}changeActiveTarget(e,t){const r=this;if(e){if(!r.isConfiguring&&r.trigger("overTarget",{newTarget:e,lastTarget:t})===!1)return}else r.trigger("targetOut",{lastTarget:t});return e}updateDescribedElement(e,t){const{titleElement:r}=this,n=r&&E.getId(r),s=E.getId(this.contentElement);e&&e.getAttribute("aria-label")!==this.html&&(n&&E.addAttributeValue(e,"aria-describedby",n),E.addAttributeValue(e,"aria-describedby",s)),t&&(n&&E.removeAttributeValue(t,"aria-describedby",n),E.removeAttributeValue(t,"aria-describedby",s))}internalOnPointerOut(e){var t;const r=this,n=e.type==="pointerover"?e.target:e.relatedTarget;r.allowOver&&(r.element.contains(n)||r.owns(n,!0))||r.element.contains(n)&&((t=r.activeTarget)!=null&&t.contains(n))||r.activeTarget&&!r.activeTarget.contains(n)&&r.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;if(e.trigger("pointerOut")===!1)return e.activeTarget=null,!0;e.abortDelayedShow(),e.isVisible&&t!==!1&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}show(e){const t=this;!e&&t.forElement&&t.anchorToTarget&&!t.forSelector?t.showByTarget(t.forElement):super.show(...arguments),t.isVisible?t.afterShowByTarget():t.activeTarget=null}get hoverDelay(){var e;return((e=this.triggeredByEvent)==null?void 0:e.pointerType)==="focus"?0:this._hoverDelay}get hideDelay(){var e;return((e=this.triggeredByEvent)==null?void 0:e.pointerType)==="focus"?0:this.autoHide?this._hideDelay:!1}hide(){var e,t;const r=this;if(r.abortDelayedShow(),r._hidden)return tk;{r.abortDelayedHide();const n=super.hide(...arguments);return r.lastHidden=Date.now(),r.activeTarget=null,(e=r.mouseMoveRemover)==null||e.call(r),r.mouseMoveRemover=null,(t=r.transitionEndDetacher)==null||t.call(r),r.transitionEndDetacher=null,r.describedElement=null,n}}abortDelayedShow(){var e,t,r;const n=this;n.hasTimeout("show")&&((e=n.mouseDownRemover)==null||e.call(n),n.mouseDownRemover=null,n.clearTimeout("show"),(t=n.mouseMoveRemover)==null||t.call(n),n.mouseMoveRemover=null,(r=n.transitionEndDetacher)==null||r.call(n),n.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,t=e.lastAlignSpec;!e.isConfiguring&&!e.isVisible&&(t!=null&&t.targetOutOfView)&&(t.allowTargetOut||E.isInView(t.target,!1,e))&&(e.show(),t.targetOutOfView=!1),super.realign()}alignTo(e){const t=this,r=(t.mouseOffsetX||1)*(t.rtl?-1:1),n=t.mouseOffsetY||1,s=Math.max(Math.min(r,5),0),a=Math.max(Math.min(n,5),0);if(!t.isVisible)return;let l;!t.anchorToTarget&&e.position==="mouse"&&(l=new ti(t.triggeredByEvent.pageX-globalThis.scrollX,t.triggeredByEvent.pageY-globalThis.scrollY),e.position=new ti(l.x+(r||1)-(r<0?t.width:0),l.y+(n||1)-(n<0?t.height:0))),e&&!(t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target))&&e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e),l&&t.lastAlignSpec.result.inflate(a,s).contains(l)&&(t.lastAlignSpec.position="mouse",t.mouseOffsetY=-n,t.mouseOffsetX=-r,t.realign(),t.mouseOffsetY=n,t.mouseOffsetX=r)}set html(e){super.html=e,this.isVisible&&this.realign()}get html(){return super.html}changeHtml(e){const t=this;if(Z.isPromise(e)){t.showAsyncMessage(),e.target=t.activeTarget,e.then(r=>{e.target===t.activeTarget&&(t.html=r)});return}return typeof e!="object"&&(e=e!=null?t.optionalL(String(e)):""),e}updateHtml(e,t){const r=this;let n=e==="";(!n||E.isVueConfig(e))&&(super.updateHtml(e,t),r.hasContent?Z.isPromise(e)||r.trigger("innerHtmlUpdate",{value:e}):n=!0),n&&r.hide()}onMouseMove(e){const t=this,{forElement:r,activeTarget:n}=t,s=t.hasTimeout("hide"),a=e.target;if(t.triggeredByEvent=e,!t._hidden){let l;const o=n==null?void 0:n.contains(a),d=!o&&t.forSelector&&n&&!s&&a.nodeType===Node.ELEMENT_NODE&&!a.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(a)),c=r!=null&&r.document?r.document.documentElement:r,u=c&&(c.contains?c.contains(a):c.compareDocumentPosition(a)&16);if(d&&(l=t.handleForElementOut()),l||!s||u){if(t.dismissDelay&&!s&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:n,activeTarget:n,event:e}]),!t.html)){t.hide();return}t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}onElementUserAction(e){const{showOnClick:t}=this;(typeof t!="number"||t===e.button)&&(e.button===2&&e.preventDefault(),this.internalOnPointerOver(e))}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t,r){var n,s,a;let l=(s=(n=t.bryntum)==null?void 0:n.tooltip)==null?void 0:s.get(yr);if(!l&&!r){(a=t.bryntum)!=null&&a.tooltip||T.setPath(t,"bryntum.tooltip",new Map);const o=t.bryntum.tooltip;o.set(yr,!0),l=new yr({forElement:t,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isSharedTooltip:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({target:d}){if(l.isOverflowDetail)return;for(const h in l.resetCfg)h==="listeners"?l.un(l.resetCfg[h].set):h!=="html"&&(l[h]=l.resetCfg[h].was);l.resetCfg={};const c=z.getById(d.id),u=(c==null?void 0:c.tipConfig)||l.gatherDataConfigs(d);if(c&&c.element!==d||!c&&d.matches(".b-widget")||c!=null&&c.disabled&&!c.showTooltipWhenDisabled)return!1;l._owner=c,l.element.classList.toggle("b-target-disabled",!!(c!=null&&c.disabled));for(const h in u)l.resetCfg[h]={set:u[h],was:l[h]},h==="listeners"?l.ion(u[h]):l[h]=u[h]},hide({source:d}){d.owner=null}},gatherDataConfigs(d){const{dataset:c}=d,u={};for(const h in c)if(h.startsWith("btip"))if(h.length>4){const g=O.uncapitalize(h.substr(4));if(g in l.getDefaultConfiguration()){const f=c[h];u[g]=ek[f]?f==="true":isNaN(f)?f:parseInt(f,10)}}else u.html=c[h];return d.hasAttribute("aria-label")&&!u.html?u.html=O.encodeHtml(l.optionalL(d.getAttribute("aria-label"))):d.hasAttribute("aria-labelledby")&&(u.html=O.encodeHtml(l.optionalL(document.getElementById(d.getAttribute("aria-labelledby").textContent)))),u},filterTarget({target:d}){l.isOverflowDetail=!1;const c=d.closest(l.forSelector);if(c)return c;if(yr.showOverflow&&d.closest(".b-widget"))for(;(d==null?void 0:d.nodeType)===Element.ELEMENT_NODE;){if(E.getStyleValue(d,"text-overflow")==="ellipsis"&&d.clientWidth<d.scrollWidth)return l.html=O.encodeHtml(d.textContent),l.isOverflowDetail=!0,d;d=d.parentNode}}}),V.on({element:t,mouseenter:d=>yr.currentOverElement=d.target,keydown:d=>yr.currentOverElement=d.target,capture:!0,thisObj:l}),o.set(yr,l)}return l}static encodeConfig(e){const t={};if(typeof e=="string")t.btip=e;else for(const r in e)t[`btip${r==="html"?"":O.capitalize(r)}`]=e[r];return t}};y(Cm,"$name","Tooltip"),y(Cm,"type","tooltip");var ve=Cm;ve.initClass(),Object.defineProperty(z,"tooltip",{get(){return ve.getSharedTooltip(document.body,document.body)}}),z.Tooltip=ve,ve._$name="Tooltip";var nh=class extends sd{static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var i;(i=this.tooltip)==null||i.hide()}dragMove(i){const{offset:e,tooltip:t}=this,{event:r}=i;t&&(t.isVisible||t.show(),t.alignTo({align:this.align,target:new L(r.clientX-e,r.clientY-e,e*2,e*2)}))}changeTooltip(i,e){return z.reconfigure(e,i,this)}};y(nh,"type","tip"),nh.initClass(),nh._$name="DragTipProxy";var wm=i=>{var e;return e=class extends(i||$){get hasLabel(){return!!this.label}compose(){const{hasLabel:t,labelPosition:r}=this;return{class:{[`b-label-${r}`]:t,"b-has-label":t}}}changeLabel(t){return t||""}setupLabel(t){return T.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${t.align||"start"}`},t)}updateLabelWidth(t){this.labelElement&&(this.labelElement.style.flex=`0 0 ${E.setLength(t)}`,this.inputWrap&&(this.inputWrap.style.flexBasis=t==null?"":"auto"))}get widgetClass(){}},y(e,"$name","Labelable"),y(e,"configurable",{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}),e},cd=(i=$)=>{var e;return e=class extends i.mixin(Nt){get widgetClass(){}doDestroy(){const t=this,r=t._rootElement&&t.constructor.getSharedErrorTooltip(t._rootElement,{doNotCreate:!0,cachePath:t.errorTooltipCachePath});super.doDestroy(),(r==null?void 0:r.field)===t&&r.hide()}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement,{cachePath:this.errorTooltipCachePath,tooltipConfig:this.errorTooltipConfig})}static get errorTip(){return this.getSharedErrorTooltip(document.body)}static getSharedErrorTooltip(t,r={}){var n;const{doNotCreate:s,cachePath:a="errorTooltip",tooltipConfig:l}=r;let o=(n=t.bryntum)==null?void 0:n[a];return!o&&!s&&(t.bryntum=t.bryntum||{},o=ve.new({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},axisLock:"flexible",scrollAction:"realign",trapFocus:!1,rootElement:t,onBeforeShow(){const d=this,c=z.fromElement(d.activeTarget);if(c){const u=c.getErrors();if(u)return d.html=u.join("<br>"),d.field=c,!0}return!1}},l),t.bryntum[a]=o),o}setError(t,r,n){const s=this,a=Object.keys(s.errors||{}).length;(s.errors||(s.errors={}))[t]=s.optionalL(t);const l=Object.keys(s.errors).length;if(l!==a&&s.trigger("validityChange",{valid:l===0,bubbles:!0}),r||s.syncInvalid(),n){const o=()=>{s.clearError(t),d()},d=s.ion({keydown:o,focusOut:o})}}clearError(t,r){const n=this;n.errors&&Object.keys(n.errors).length>0&&(t?delete n.errors[t]:n.errors={},n.trigger("validityChange",{valid:Object.keys(n.errors).length===0,bubbles:!0})),r||n.syncInvalid()}getErrors(){var t,r;const n=this;if(!n.isValid){const s=n.validity,a=T.keys(s).find(c=>c!=="valid"&&c!=="customError"&&s[c]),l=n.errors&&Object.values(n.errors),o=(r=(t=n.formatter)==null?void 0:t.is.percent)!=null?r:!1;let d;if(l!=null&&l.length?d=l:s.customError?d=[n.input.validationMessage]:a?d=[n.L(a,{min:o?`${n.min*100}%`:n.min,max:o?`${n.max*100}%`:n.max})]:d=[n.L(n.invalidValueError)],(d==null?void 0:d.length)>0)return d}}syncInvalid(){const t=this,{isPainted:r}=t;if(t.updatingInvalid=!0,r){const{isValid:n,element:s,inputWrap:a}=t;if(s.classList[n?"remove":"add"]("b-invalid"),n){const l=t.constructor.getSharedErrorTooltip(t.rootElement,{doNotCreate:!0,cachePath:this.errorTooltipCachePath});l!=null&&l.isVisible&&l.field===t&&l.hide()}else if(a){const l=t.errorTip;l&&(t.containsFocus||t.isVisible&&E.isDescendant(a,ve.currentOverElement))&&(l.activeTarget===a&&l.isVisible?l.onBeforeShow():(l.activeTarget=a,l.showBy(a)))}}t.updatingInvalid=!1}},y(e,"$name","Validatable"),e},ud=class extends gt{static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){var i;return(i=this.owner.inline)!=null?i:this.ensureItems().count===1}changeCollapsed(i){if(this.togglingCollapse)return this.togglingCollapse=!1,i;this.toggleCollapse(!!i)}updateCollapsed(i){var e;this.collapser=(e=this.collapser)==null?void 0:e.destroy(),this.setCollapsedCls(i)}updateCollapser(i,e){e&&e.completed==null&&(!e.reverting||!i)&&e.destroy(),this.setOwnerCls("b-collapsing",i)}get collapsing(){const{collapser:i}=this;return i!=null&&i.collapsed}get collapsingExpanding(){return this.collapser!=null}get expanding(){const{collapser:i}=this;return i!=null&&!i.collapsed}collapse(i){this.toggleCollapse(!0,i)}expand(i){this.toggleCollapse(!1,i)}setCollapsedCls(i){this.setOwnerCls("b-collapsed",i)}setOwnerCls(i,e){var t,r;(r=(t=this.owner)==null?void 0:t.element)==null||r.classList[e?"add":"remove"](i)}syncChildConfigs(){const i=this,{owner:e,syncableConfigs:t}=i;if(t){let r,n;for(r in t)n=t[r](e),i.eachWidget(s=>{s[r]=n},!1)}e.afterSyncChildConfigs(i)}syncContainer(){const{inline:i,layout:e}=this;this.autoLayout&&(e.horizontal=i,e.justify=i?"center":"stretch")}toggleCollapse(i,e){const t=this,{animation:r,collapser:n,inline:s}=t,{containerWrapElement:a}=t.owner,l=o=>{o&&(t.element.style.height="",t.togglingCollapse=!0,t.collapsed=i,t.collapser=null)};if(i==null&&(i=!t.collapsed),e!==!1&&e!==null&&(!a||!t.isVisible?e=null:(e===!0?e={}:typeof e=="number"&&(e={duration:e}),e=r||e?T.merge({},r,e):null)),!e)t.togglingCollapse=!0,t.collapsed=i;else if(n&&i!==n.collapsed)t.collapser=n.revert({finalize:l}),t.collapser.collapsed=i;else if(!n&&i!==t.collapsed){!i&&t.setCollapsedCls(!1);const{element:o}=t,{height:d}=o.getBoundingClientRect(),c=s?1:d;!i&&t.setCollapsedCls(!0),o.style.height=`${d}px`,t.collapser=yt.run(T.merge({finalize:l,element:a,[s?"opacity":"height"]:{from:i?c:0,to:i?0:c}},e)),t.collapser.collapsed=i}}};y(ud,"$name","FieldContainer"),y(ud,"type","fieldcontainer"),ud.initClass(),ud._$name="FieldContainer";var ik=(i,e)=>(i.weight||0)-(e.weight||0),rk=(i,e)=>(e.weight||0)-(i.weight||0),Sm=[],nk={align:!0,weight:!0},sh=class Sv extends z.mixin(sm,wm,cd){static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t,r;const n=this,{triggers:s}=n;if((e=n.inputListenerRemover)==null||e.call(n),(t=n.keyListenerRemover)==null||t.call(n),(r=n.container)==null||r.destroy(),super.doDestroy(),s)for(const a of Object.values(s))a.destroy()}get childItems(){const{container:e,triggers:t}=this,r=t?Object.values(t):[];return e?[...r,...e.childItems]:r}get invalidValueError(){return"L{invalidValue}"}construct(e={}){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay)),!t.ariaLabel&&t.placeholder&&t.updateAriaLabel(t.placeholder)}changeKeyMap(e){var t;const r=this;let n={};e&&(r._fieldKeyMap?T.assign(n,r._fieldKeyMap):(r._fieldKeyMap=e,T.assign(n,e)));for(const s in r.triggers)(t=r.triggers[s])!=null&&t.keyMap&&(n=r.mergeKeyMaps(n,r.triggers[s].keyMap,s));return n}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const t=this;t.valueOnFocus=T.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e),t.focusing=!0,t.syncInvalid(),t.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return Sv}compose(){this.getConfig("clearable");const e=this,{container:t,innerElements:r,label:n,labels:s,labelCls:a,readOnly:l,stepTriggers:o,triggers:d,required:c,showRequiredIndicator:u}=e,h=T.values(d,(v,b)=>!b),g=h.filter(v=>v.align==="start").sort(ik),f=h.filter(v=>v.align!=="start").sort(rk),m=e.setupLabel.bind(e),p=[...g.map(v=>v.element),...r,...f.map(v=>v.element)];return{class:{"b-has-step-triggers":o,"b-has-start-trigger":g.length,"b-no-input":!r.length,"b-readonly":l,"b-field-container":!!t,"b-field-container-inline":t==null?void 0:t.inline,"b-required":!!(c&&u)},children:[...(s||Sm).filter(v=>v&&v.align!=="end").map(m),(n||null)&&m({reference:"labelElement",class:`b-label b-align-start ${a||""}`,html:n}),p.length?{class:"b-field-inner",reference:"inputWrap",children:p}:null,...(s||Sm).filter(v=>(v==null?void 0:v.align)==="end").map(m),...t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:Sm]}}updateElement(e,t){var r;const n=this,s=n.initialConfig.value,{input:a}=n;super.updateElement(e,t),s!=null&&(n.value=s),n.syncEmpty(),n.updateInputReadOnly(n.inputReadOnly),n.syncInvalid();const l=a||n.focusElement;(r=n.keyListenerRemover)==null||r.call(n),n.keyListenerRemover=l&&V.on({element:l,thisObj:n,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:r,inputCls:n,inputType:s,name:a,inputTag:l}=this,o=T.merge({reference:"input",tag:l,type:s,name:a||r,id:`${r}-input`,retainElement:"prevent-release",dataset:this.isPasswordField?null:{opIgnore:!0}},t);n&&(o.class=n);for(let d,c,u=e.length;u-- >0;)d=e[u],c=this[d],c!=null&&(o[O.hyphenateAttributeName(d)]=c);return o}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){var e;const t=this.input;let r;try{r=[t.selectionStart,t.selectionEnd,t.selectionDirection]}catch(n){r=((e=t.value)==null?void 0:e.length)||0,r=[r,r]}return r}set textSelection(e){typeof e=="number"?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,r]=this.textSelection,n=this.input.value;return`${n.substr(0,t)}${e}${n.substr(r||t)}`}select(e,t){const r=this.focusElement;if(r.value.length){if(arguments.length===0){this.selectAll();return}if(!this.supportsTextSelection)return;r.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}get caretAtEnd(){return this.textSelection[1]===this.input.value.length}get caretAtStart(){return!this.textSelection[1]}get selectedAll(){const{textSelection:e}=this;return!e[0]&&e[1]===this.input.value.length}syncEmpty(){var e;const{isEmptyInput:t,isEmpty:r,element:n}=this,s=(e=this.triggers)==null?void 0:e.clear,a=t&&r;n&&(s&&s[a?"hide":"show"](),n.classList.toggle("b-empty",a))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:r,hintHtml:n}=e,s=t==null?void 0:t.parentElement;if(t){let a=n||r;const l=e.hintElement||a&&(e.hintElement=E.createElement({parent:s,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));l&&(typeof a=="function"&&(a=a({source:e,value:e.value})),l.firstChild[n?"innerHTML":"textContent"]=a||""),e.element.classList[a?"remove":"add"]("b-field-no-hint")}}updateInputTag(e){e&&e!==this.getDefaultConfiguration().inputTag&&(this.dontCache=!0)}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||this.editable===!1}updateInputReadOnly(e){const t=this,{input:r,inputListenerRemover:n}=t;r&&(r.readOnly=e?"readOnly":null,e?t.inputListenerRemover=n==null?void 0:n():n||(t.inputListenerRemover=V.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return!!e}updateReadOnly(e){this.syncInputReadOnly()}updateRequired(e){this.syncRequired()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&T.assign({cls:"b-icon-remove",weight:1e3,handler:t.clear},e)||null}}changeTriggers(e,t){const r=this,n=r.$triggers||(r.$triggers=new kr({configName:"triggers",factory:Sv.Trigger,inferType:!1,owner:r,created(s){be.after(s,"onConfigChange",(a,{name:l})=>{nk[l]&&r.onConfigChange({name:"triggers",value:n.target})})},setup(s,a){s.reference=s.ref=a,s.parent=r}}));if(e&&!r.stepTriggers&&(e.back||e.forward)&&(e=T.assign({},e),delete e.back,delete e.forward),n.update(e),r.element&&(r.keyMap=r.keyMap),!t)return n.target}updateInputWidth(e){this.input.style.width=E.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled&&!e.skipValidation){if(e.syncRequired(),e.checkValidity&&e.callback(e.checkValidity,e,[e]),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isClear(){return this.isEmpty&&this.isEmptyInput}get isEmpty(){const{value:e}=this;return e==null||e===""||e===this.nullValue}get isEmptyInput(){return!this.input||this.input.value==null||this.input.value===""}get validity(){const e=this.input;return e==null?void 0:e.validity}async setValue(e){this.value=e}changeValue(e,t){return e==null&&(e=this.nullValue),this.hasChanged(t,e)?e:(e===""&&this.syncRequired(),t)}updateValue(e,t){const r=this;r.isConfiguring||(r.syncRequired(),r.inputting||r.triggerChange()),r.inputting||(r._lastValue=e),r.syncInputFieldValue()}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:r,parent:n,inputValueAttr:s,inputValue:a}=t;if(r&&!t.inputting&&r[s]!==a&&(r[s]=a,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(r.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),n){const{assigningValues:l}=n;(l===!0||(l==null?void 0:l.highlight)===!1)&&(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return this.value==null?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&E.isTextualInput(e)}updatePlaceholder(e){this.ariaLabel||this.updateAriaLabel(e),this.input&&(e==null?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=!!this._isUserAction){const r=this,{value:n,_lastValue:s,isValid:a}=r;r.syncHint(),r.triggerFieldChange({value:n,oldValue:s,event:e,userAction:t,valid:a}),r.defaultAction==="change"&&r.trigger("action",{value:n,oldValue:s,event:e,userAction:t,valid:a})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var t;const r=this;r.validateOnInput||r.errorTip.hide(),r.inputting=!0,r.fetchInputValue(),r.inputting=!1,r.trigger("input",{value:r.value,event:e}),(t=r.changeOnKeyStroke)==null||t.call(r,e)}get needsInputSync(){var e;return this.input[this.inputValueAttr]!==String((e=this.inputValue)!=null?e:"")}internalOnKeyEvent(e){const t=this,{value:r}=t;let n=!1;if(t._isUserAction=!0,e.type==="keydown"&&e.key==="Escape"&&!(t.readOnly||t.disabled)){const s=t.isValid,a="initialValue"in t?t.initialValue:t.valueOnFocus,l=t.hasChanged(a,r),{needsInputSync:o}=t;t.revertOnEscape&&(!s||l||o)?(l&&(t.value=a),o&&t.syncInputFieldValue(!0),t.clearError(),n=(l||o)&&t.isValid||s!==t.validOnFocus):!t.isEmpty&&t.clearable&&t.revertOnEscape&&(t.clear(),e.stopPropagation())}t.isDestroyed||(n&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e})),t._isUserAction=!1}clear(e){const t=this;t.isClear||(t.value=t.nullValue,t.clearError(),t.syncInvalid(),t.input&&E.isTextualInput(t.input)&&(t.input.value=""),t.trigger("clear",{event:e}),e==null||e.stopImmediatePropagation())}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;!t.isConfiguring&&(!t.focusing||t.focusVisible)&&t.required&&t.isEmpty&&!((e=t.parent)!=null&&e.isSettingValues)?t.setError("L{fieldRequired}",t.updatingInvalid):t.clearError("L{fieldRequired}",t.updatingInvalid)}get containerCollapsed(){var e;return(e=this.container)==null?void 0:e.collapsed}set containerCollapsed(e){const{container:t}=this;t&&(t.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,t){e&&(Array.isArray(e)||!("type"in e||"items"in e))&&(e={items:e});const r=this,n=e&&T.merge({owner:r,layout:"box"},r.containerDefaults),s=z.reconfigure(t,e,{owner:r,defaults:n});if(s&&(s.autoLayout=(n==null?void 0:n.layout)==="box",s===t)){s.syncContainer();return}return s}onConfigChange(e){var t,r;super.onConfigChange(e),(r=(t=this.container)==null?void 0:t.syncConfigTriggers)!=null&&r[e.name]&&this.container.syncChildConfigs()}assignValue(e,t){const r=this,{container:n,containValues:s}=r,a=r.getValueName(t),l=e&&a in e;r.assigningValue=!0,n&&s!==!1?e&&s==="nested"?l&&(e=T.clone(e[a]),super.assignValue({[a]:e&&!("value"in e)||e.value},t),e&&delete e.value,n.assignValue(e,t)):(super.assignValue(e,t),n.assignValue(e,t)):super.assignValue(e,t),r.assigningValue=!1}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,t){const r=this,{container:n,containValues:s,valueName:a}=r,l=typeof s;t=t!=null?t:a in e,n&&s!==!1&&(s==="nested"?t&&(e[a]={value:e[a],...n.values}):(s===!0||s==null&&t||l==="string"&&r[s]||l==="function"&&s(r))&&n.gatherValues(e))}updateContainer(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}};y(sh,"$name","Field"),y(sh,"type","field"),y(sh,"configurable",{role:null,defaultBindProperty:"value",skipValidation:null,placeholder:null,value:"",name:null,labels:null,required:null,showRequiredIndicator:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",stepTriggers:null,triggers:null,highlightExternalChange:!1,localizableProperties:["label","title","placeholder","labelWidth","hint"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","ariaLabel","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:i=>i.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{},twinSyncConfigs:["value"],inputTag:{$config:null,value:"input",default:"input"}});var rt=sh,hd;rt.Trigger=(hd=class extends z{static get factoryable(){return{defaultType:rt.Trigger,extends:null}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(i){return i}onClick(i){const e=this,{field:t}=e;t.disabled||t.readOnly||(i.key&&i.preventDefault(),t.trigger("trigger",{trigger:e})!==!1&&e.handler&&(t._isUserAction=!0,t.callback(e.handler,t,[i,e]),t._isUserAction=!1))}onMousedown(i){const e=this.field;!("key"in i)&&E.isTouchEvent&&e.editable&&(e.editable=!1,e.setTimeout(()=>e.editable=!0,500)),i.preventDefault(),E.getActiveElement(e.input)!==e.input&&e.focus()}},y(hd,"$name","FieldTrigger"),y(hd,"type","trigger"),y(hd,"configurable",{align:null,weight:null,role:null}),hd);var gd;rt.SpinTrigger=(gd=class extends rt.Trigger{compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(i){var e;(e=this.clickRepeater)==null||e.destroy(),this.clickRepeater=i?Nu.new({element:this.element},i):null}onClick(i){const e=this,{field:t}=e;t._isUserAction=!0,t.disabled||t.readOnly||(i.target===e.upButton?t.doSpinUp(i.shiftKey):i.target===e.downButton&&t.doSpinDown(i.shiftKey)),t._isUserAction=!1}get isFocusable(){return!this.disabled&&super.isFocusable}},y(gd,"$name","SpinTrigger"),y(gd,"type","spintrigger"),y(gd,"configurable",{repeat:{$config:["nullify"],value:!0}}),gd),rt.Trigger.initClass(),rt.SpinTrigger.initClass(),z.register(rt.Trigger,"trigger"),z.register(rt.SpinTrigger,"spintrigger"),rt._$name="Field";var ua=class extends Di{};y(ua,"$name","Fit"),y(ua,"type","fit"),y(ua,"configurable",{containerCls:"b-fit-container",itemCls:"b-fit-item"}),ua.initClass(),ua._$name="Fit";var Lr=document.createRange(),jt=class extends z{construct(i,...e){var t;const r=this;Array.isArray(i)&&(i={items:i}),super.construct(i,...e);const{element:n}=r,{classList:s}=n;r.multiSelect&&s.add("b-multiselect"),(t=r.store)!=null&&t.count?r.refresh():s.add("b-empty"),V.on({element:n,click:"onClick",thisObj:r})}doDestroy(){var i;this.detachListeners("store"),(i=this.navigator)==null||i.destroy(),super.doDestroy()}changeScrollable(i){return i=super.changeScrollable(i),i&&this.title&&(i.stickies=".b-list-title"),i}onFocusIn(i){var e;this.restoreActiveItem((e=i._target)==null?void 0:e.closest(this.itemSelector)),super.onFocusIn(i)}get isVirtualized(){return typeof this.virtualize=="number"?this.store.count>this.virtualize:!!this.virtualize}outOfViewTpl(i,e){return`<li class="b-list-item b-out-of-view" data-index="${e}" aria-posinset="${e+1}" aria-setsize="${this.store.count}" data-id="${O.encodeHtml(i.id)}"></li>`}onItemIntersection(i,e){if(e){const t=this,r=parseInt(i.dataset.index),n=t.store.getAt(r);n&&E.sync(t.callback(t.itemWrapperTpl,t,[n,r,t]),i),t.itemIntersectionObserver.unobserve(i)}}contentTpl(){const i=this,e=Math.ceil(i.height/i.listItemHeight),t=i.store.records.map((r,n)=>!i.isVirtualized||n<e?i.callback(i.itemWrapperTpl,i,[r,n,i]):i.outOfViewTpl(r,n));if(i.multiSelect&&i.selectAllItem!==!1&&t.unshift(i.selectAllItemTpl()),i.title){const r=`${i.id}-title`;t.unshift(`<li id="${r}" class="b-list-item b-list-title" data-noselect>${O.encodeHtml(i.title)}</li>`),i.element.setAttribute("aria-labelledby",r)}else i.element.removeAttribute("aria-labelledby");return i.emptyText&&i.store.count===0&&t.push(`<li class="b-list-item b-empty-text">${i.L(i.emptyText)}</li>`),Pt.tpl`${t}`}itemWrapperTpl(i,e,t){const{selected:r,getItemStyle:n,store:s,tooltipTemplate:a}=t,l=(a==null?void 0:a(i))||"",o=[...s.excludeCollapsedRecords?[`--tree-level:${i.childLevel||0}`]:[],...n?[t.callback(n,t,[i])]:[]].join(";"),d=o.length?`style="${o}"`:"",c=t.callback(t.isSelectable,t,[i]);return s.isGrouped&&!i.isGroupHeader&&i.instanceMeta(s).groupParent.meta.collapsed||!i.ancestorsExpanded(s)?"":Pt.tpl`<li ${d} aria-posinset="${e+1}" aria-setsize="${this.store.count}" class="${t.getItemClasses(i,e)}" role="option" ${l?`data-btip="${O.encodeHtml(l)}"`:""} aria-selected="${r.includes(i)}" data-index="${e}" ${c?"":"data-noselect"} data-id="${O.encodeHtml(i.id)}" ${t.itemsFocusable?'tabindex="-1"':""}>${t.itemContentTpl(i,e)}</li>`}itemContentTpl(i,e){const t=this;if(i.isGroupHeader||i.isParent&&t.store.excludeCollapsedRecords!==!1){let r=t.groupHeaderTpl(i,i.isParent?t.callback(t.itemTpl,t,[i]):O.capitalize(i.meta.groupRowFor));if(t.collapsibleGroups||i.isParent){const n=i.isParent?i.instanceMeta(t.store).collapsed:i.meta.collapsed,s=n?"right":"down";r+=`<button aria-label="${t.L("L{PanelCollapser."+(n?"Expand":"Collapse")+"}")}" class="b-button b-tool b-icon b-icon-collapse-${s} b-list-expander-icon" data-noselect></button>`}return r}return`${t.itemIconTpl(i,e)}${t.callback(t.itemTpl,t,[i])}`}itemIconTpl(i,e){return this.multiSelect&&this.callback(this.isSelectable,this,[i])?`<i aria-hidden="true" role="presentation" class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const i=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${i}" data-select-all data-id="select-all" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemIconTpl({})}<div>${this.L("L{selectAll}")}</div></li>`}getItemClasses(i){var e,t;const r=this,{getItemCls:n,store:s}=r,a=(e=r._navigator)==null?void 0:e.activeItem,l=(a==null?void 0:a.dataset.id)==i.id,o="groupRowFor"in i.meta?"b-list-item-group-header":s.excludeCollapsedRecords&&i.isParent?"b-list-item-tree-parent":"",d=r.selected.includes(i)||((t=i.groupChildren)==null?void 0:t.every(u=>r.selected.includes(u))),c=n?this.callback(n,this,[i]):"";return`${r.itemCls} ${i.cls||""} ${c} ${d?r.selectedCls:""} ${l?r.navigator.focusCls:""} ${o}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:i,action:e,records:t,record:r,changes:n,isCollapse:s}){const a=this,{selected:l}=a;switch(e){case"dataset":{l.match(i.storage,!a._externallyOwnedSelection);break}case"remove":s||l.remove(t);break;case"clear":a.deselectAll();break;case"update":{const{id:o}=n;o&&E.setAttributes(a.contentElement.querySelector(O.encodeAttributeSelector("data-id",o.oldValue)),{"data-id":o.value}),a.refreshItem(r);return}}a.refresh()}onStoreRefresh(){this._selected?this.refresh():this.getConfig("selected")}refresh(){var i,e;const t=this;if(t.isVisible&&t.store){const r=(i=t.navigator)==null?void 0:i.activeItem;t.itemIntersectionObserver&&(t.itemIntersectionObserver.disconnect(),t.itemIntersectionObserver=null),t.paintListener=null;const n=E.createElementFromTemplate(t.contentTpl(),{fragment:!0});if(t.clearItems().insertNode(n),t.element.classList.toggle("b-virtualized",t.isVirtualized),t.isVirtualized){t.itemIntersectionObserver=new IntersectionObserver(s=>{for(const a of s)t.onItemIntersection(a.target,a.isIntersecting,a)});for(const s of t.element.querySelectorAll(t.itemSelector))t.itemIntersectionObserver.observe(s);t.listItemHeight=(e=t.element.children[0])==null?void 0:e.clientHeight}r&&t.restoreActiveItem(r),t.refreshCount=(t.refreshCount||0)+1,t.element.classList.toggle("b-empty",t.store.count===0),t.updateSelectAllState()}else t.paintListener||(t.paintListener=t.once("paint","refresh"))}clearItems(){const i=this,{contentElement:e}=i,t=e.querySelector(i.itemSelector),r=e.lastChild;if(t){const n=e.querySelectorAll(`${i.itemSelector}:not(.b-mask)`);Lr.setStartBefore(t),Lr.setEndAfter(n[n.length-1]),Lr.deleteContents()}else r?(Lr.setStartAfter(r),Lr.setEndAfter(r)):(Lr.setStart(e,0),Lr.setEnd(e,0));return Lr}refreshItem(...i){for(const e of i){const t=this,r=t.getItem(e);if(r){const n=t.store.indexOf(e),s=E.createElementFromTemplate(t.callback(t.itemWrapperTpl,t,[e,n,t]));E.sync(s,r)}}}getItem(i){if(i!=null)return typeof i=="number"?this.contentElement.querySelector(`[data-index="${i<0?this.store.count+i:i}"]`):(i.nodeType===Element.ELEMENT_NODE&&(i=i.dataset.id),(i==null?void 0:i.id)!=null&&(i=i.id),this.contentElement.querySelector(O.encodeAttributeSelector("data-id",i)))}getRecordFromElement(i){return i.target&&(i=i.target),i=i.closest(this.itemSelector),this.store.getAt(parseInt(i.dataset.index))}updateItems(i){this.store.data=B.asArray(i!=null?i:[]).map(e=>typeof e=="string"?{[this.displayField]:e}:e)}updateDisabled(i,e){super.updateDisabled(i,e),this.navigator&&(this.navigator.disabled=i)}updateLocalization(){super.updateLocalization(),this.refresh()}updateTitle(){this.refresh()}changeSelected(i,e){const t=this,r={change:"onInternalSelectionChange",thisObj:t};if(i){if(i.isCollection)t._externallyOwnedSelection=!0,i.ion(r);else if(t._externallyOwnedSelection=!1,i=B.asArray(i).reduce((n,s)=>(s=s.isModel?s:t.store.getById(s),s&&t.callback(t.isSelectable,t,[s])&&n.push(s),n),[]),e)e.splice(0,e.count,i),i=e,t.refresh();else{const n=i;i=t._selected=new Bt({internalListeners:r}),i.add(n)}i!==e&&(e==null||e.un(r))}else e==null||e.destroy();return i}updateSelected(i){i&&this.refresh()}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}updateMultiSelect(i,e){const{_selected:t}=this;!i&&e&&(t==null?void 0:t.count)>1&&(t.suspendEvents(),this.deselect(t.allValues.slice(1)),t.resumeEvents()),this.isConfiguring||this.refresh()}get store(){return this.getConfig("items"),this._store}changeStore(i){const e=this;if(i instanceof pe||(Array.isArray(i)&&(i={data:i}),i=new pe(i)),e.detachListeners("store"),i){const t={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:e};i.readUrl&&(t.beforeLoad="onBeforeStoreLoad",t.afterRequest="onAfterStoreRequest"),i.isGrouped&&(e.element.classList.add("b-grouped"),t.groupchange="onStoreRefresh"),i.ion(t),i.tree&&i.traverse(r=>{r.isParent&&!r.expanded&&i.onNodeExpand(r)})}return i}updateStore(i){i!=null&&i.records.length&&this.getConfig("selected"),this.refresh()}changeNavigator(i,e){const t=this,{element:r}=t;return r&&(i=Ki.reconfigure(e,i?Ki.mergeConfigs({ownerCmp:t,disabled:t.disabled,target:r,keyEventTarget:r,activateOnMouseover:t.activateOnMouseover},i):null,t),(i==null?void 0:i.keyEventTarget)===r&&!t.itemsTabbable&&(r.tabIndex=0)),i}get minAlignHeight(){const i=this.element.lastElementChild,e=this.minHeight;if(e!=null)return i?Math.min(i.offsetTop+i.offsetHeight,e):0}alignTo(...i){super.minHeight=this.minAlignHeight,super.alignTo(...i)}hide(...i){return this.navigator&&(this.navigator.activeItem=null),super.hide(...i)}show(){const i=this,{refreshCount:e,navigator:t}=i,{previousActiveItem:r}=t;super.minHeight=i._minHeight;const n=super.show(...arguments);return i.refreshCount===e&&i.containsFocus&&i.restoreActiveItem(r,!0),n}restoreActiveItem(i=this.navigator.previousActiveItem,e="nearest"){const t=this,{navigator:r,lastAlignSpec:n}=t;if(i!=null){if(typeof e!="string"){const s=n?n.zone:1;e=s&1?"nearest":s?"start":"end"}i=t.getItem(i),i&&!t.disabled&&(t.scrollable.scrollIntoView(i,{block:e}),r.activeItem=i)}}onClick(i){const e=i.target.closest(this.itemSelector);e?this.onItemClick(e,i):this.clearSelectionOnEmptySpaceClick&&this.deselectAll()}onSpaceKey(i){const e=i.target.nodeName.toUpperCase();(e!=="INPUT"&&e!=="TEXTAREA"||i.target.readOnly)&&this.onEnterKey(i)}onEnterKey(i){const e=this.navigator.activeItem;e&&!this.disabled&&(i.target=e,this.onItemClick(e,i),i.stopImmediatePropagation(),i.preventDefault())}onInternalKeyDown(i){const e=this;switch(i.key){case"ArrowLeft":e.collapseItem();break;case"ArrowRight":e.expandItem();break;case" ":e.onSpaceKey(i);break;case"Enter":e.onEnterKey(i);break}}collapseItem(){const{activeItem:i}=this.navigator;i&&this.toggleCollapse(this.getRecordFromElement(i),!0)}expandItem(){const{activeItem:i}=this.navigator;i&&this.toggleCollapse(this.getRecordFromElement(i),!1)}onItemClick(i,e){const t=this,{allowGroupSelect:r}=t,n=parseInt(i.dataset.index),s=t.store.getAt(n),a=s==null?void 0:s.isSpecialRow,l=i.contains(e.target.closest("[data-noselect]"));if(!(t.disabled||t.trigger("beforeItem",{item:i,record:s,index:n,event:e,userAction:!0})===!1)){if(t._isUserAction=!0,i.contains(e.target.closest("[data-select-all]")))t.onSelectAllClick(i,e);else if(e.target.matches(".b-list-expander-icon")){t.toggleCollapse(s);return}else if(s&&!l&&(!a||r)){const{selected:o}=t,{groupParent:d}=s.instanceMeta(t.store);if(t.multiSelect){let c=o.includes(s),u=s;t.toggleAllIfCtrlPressed&&e.ctrlKey?u=t.store.records:r&&a&&(c=!s.groupChildren.some(h=>!o.includes(h)),i.classList.toggle("b-selected",!c),u=s.groupChildren),o[c?"remove":"add"](u),!a&&d&&r&&t.getItem(d).classList.toggle("b-selected",d.groupChildren.every(g=>o.includes(g)))}else o.splice(0,o.count,s)}t.isDestroyed||(t.lastClicked=s,t.trigger("item",{item:i,record:s,index:n,event:e,userAction:!0}),t._isUserAction=!1)}}onInternalSelectionChange({action:i,removed:e,added:t,replaced:r}){const n=this,{selectedCls:s,unselectedCls:a}=n;let l,o;if(i==="clear")for(o of n.element.querySelectorAll(`.${s}`))o.classList.remove(s),o.setAttribute("aria-selected",!1),a&&o.classList.remove(a);else if(i!=="replaceValues"){for(l of e)o=n.getItem(l),o&&(o.classList.remove(s),o.setAttribute("aria-selected",!1));for(l of t)o=n.getItem(l),o&&(o.classList.add(s),o.setAttribute("aria-selected",!0))}n.selectAllItem&&n.updateSelectAllState(),n.trigger("selectionChange",{selected:n.selected.values})}onSelectAllClick(i){i.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var i;(i=this.element.querySelector(".b-select-all-item"))==null||i.classList.toggle(this.selectedCls,this.allSelected)}updateAllowGroupSelect(){this.refresh()}get allSelected(){const{selected:i,store:e}=this;return i.count&&(e.isFiltered?e.records.every(t=>i.includes(t)):e.count===i.count)}selectAll(i){const e=this;(e.multiSelect||!i)&&(e.selected.add(e.store.records),i&&!e.navigator.activeItem&&(e.navigator.activeItem=e.getItem(-1)))}deselectAll(){this.selected.clear()}select(i,e=!1){const{store:t,selected:r}=this,{modelClass:n}=t;i=B.asArray(i).reduce((s,a)=>(a=t.getById(n.asId(a)),a&&s.push(a),s),[]),e&&r.count?r.splice(0,r.count,i):r.add(i)}deselect(i){const{modelClass:e}=this.store;i=B.asArray(i).reduce((t,r)=>(r=this.selected.get(e.asId(r)),r&&t.push(r),t),[]),this.selected.remove(i)}toggleCollapse(i,e){const{store:t}=this;i.isGroupHeader?(e=e===void 0?!i.meta.collapsed:e,t[e?"collapse":"expand"](i),this.refresh(),this.trigger("toggleGroup",{groupRecord:i,collapse:e})):i.isParent&&(e=e===void 0?!i.instanceMeta(t).collapsed:e,i.instanceMeta(t).collapsed=e,this.refresh(),this.trigger("toggleNode",{record:i,collapse:e}))}updateCollapsibleGroups(i,e){if(e&&!i){const{store:t}=this;t.groupRecords.forEach(r=>t.expand(r))}this.refresh()}};y(jt,"$name","List"),y(jt,"type","list"),y(jt,"configurable",{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:{value:{},$config:"lazy"},navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,collapsibleGroups:!1,selectAllItem:!1,itemTpl(i){let e=O.encodeHtml(i.getValue(this.displayField));return(e==null||e==="")&&(e="&nbsp;"),e},tooltipTemplate:null,getItemStyle:null,getItemCls:null,groupHeaderTpl(i,e){let t=O.encodeHtml(e);return(t==null||t==="")&&(t="&nbsp;"),`${(this.allowGroupSelect||i.isParent)&&this.isSelectable(i)?this.itemIconTpl(i):""}${t}`},allowGroupSelect:!0,clearSelectionOnEmptySpaceClick:!1,selected:{$config:["nullify","lazy"],value:[]},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"},title:null,virtualize:null,listItemHeight:10,isSelectable:()=>!0,emptyText:null}),jt.initClass(),jt.prototype.navigatorClass=Ki,jt._$name="List";var sk=()=>!0,ak=(i,e)=>i.text.localeCompare(e.text),eS=i=>{var e;return e=class extends i{onFocusIn(){var t;super.onFocusIn(...arguments),this.formulaProvider&&((t=this.fieldsList)==null||t.show())}onFocusOut(){var t;(t=this.fieldsList)==null||t.hide(),super.onFocusOut(...arguments)}internalOnKeyEvent(t){const r=this,{key:n}=t,{fieldsList:s}=r;if(t.type==="keydown")if(t.key!=="Enter"&&(r.lastKey=t.key),n==="Escape"&&(s!=null&&s.isVisible)){t.stopImmediatePropagation(),s.hide();return}else r.formulaPrefix&&n==="ArrowDown"&&(t.preventDefault(),s!=null&&s.isVisible||r.showFieldsList());super.internalOnKeyEvent(...arguments)}internalOnInput(){super.internalOnInput(...arguments),this.checkForFormula()}updateValue(){super.updateValue(...arguments),this.checkForFormula()}checkForFormula(){var t,r;this.formulaPrefix=(t=this.dataField)!=null&&t.inputPrefixRE?(r=this.value.match(this.dataField.inputPrefixRE))==null?void 0:r[1]:null}updateFormulaPrefix(t,r){var n,s,a;const l=this;l.formulaProvider=t&&((s=(n=l.dataField)==null?void 0:n.getFormulaProvider)==null?void 0:s.call(n,t)),r&&l.input.classList.toggle(`b-${r.toLowerCase()}-input`,!1),l.formulaProvider?(l.input.classList.toggle(`b-${t.toLowerCase()}-input`,!0),l.formulaProvider.setConfig({inputField:l,store:l.formulaStore}),l.whenVisible("showFieldsList")):(a=l.fieldsList)==null||a.hide()}get formula(){const{formulaProvider:t,value:r}=this;if(t){const{formulaRE:n}=t;return n?r.match(n):r}return""}showFieldsList(){var t,r;const n=this,{input:s}=n,a=(t=n.name)==null?void 0:t.replace(/^#/,""),l=n.up("gridbase",!0);let o=n.fieldsList;if(o)o.owner=n,o.widgetMap.fields.navigator.keyEventTarget=s;else{n.fieldFilter=a&&new Je(({id:c})=>c!==a);const{fieldNames:d}=n;o=n.fieldsList=new Xe({title:"Fields",cls:"b-formula-fieldlist",floating:!0,forElement:n.inputWrap,scrollAction:"realign",owner:n,autoShow:!1,align:{matchSize:"min",align:"t0-b0",axisLock:!0,minHeight:Math.min(3,d.length)*40},layoutStyle:{padding:0},layout:"fit",items:{fields:{type:"list",items:d,itemsFocusable:!1,scrollable:{overflowY:!0},navigator:{keyEventTarget:s,activateOnMouseover:!0},getItemCls(c){if(c.id==="this"||c.id==="data")return"b-special-field"},onItem({event:c,record:u}){c.type==="click"&&(n.lastKey=null),!c.key||c.key==="Enter"&&(n.lastKey==="ArrowDown"||n.lastKey==="ArrowUp")?n.selectField(u.id):c.stopImmediatePropagation=()=>delete c.stopImmediatePropagation}}}}),(r=n.owner)!=null&&r.cellEditorContext?(l.ion({cellMousedown:"onCellMousedown",cellClick:"onCellClick",thisObj:n,prio:99999}),n.record=n.owner.cellEditorContext.record):n.record||(n.record=n.formulaProvider.record)}o.show(),o.activeItem=null}onCellMousedown({event:t}){this.fieldsList.isVisible&&(t.preventDefault(),t.stopImmediatePropagation())}onCellClick({event:t,column:{field:r}}){if(this.fieldsList.isVisible)return t.stopImmediatePropagation(),this.selectField(r),!1}selectField(t){var r,n,s;const a=this,{input:l}=a,o=l.value.trim(),{selectionStart:d}=l,c=d>=o.length,u=o.endsWith(")")?o.length:o.length+2,h=((r=a.formulaProvider.prefix)==null?void 0:r.length)||0;if(d>h+1&&d<u){const g=`${c||(n=o[d-1])!=null&&n.match(/\s|\(/)?"":" "}$${t}${c||(s=o[d])!=null&&s.match(/\s|\)$/)?"":" "}`;l.setRangeText(g,d,d),l.selectionStart=d+g.length,a.inputting=!0,a.fetchInputValue(),a.inputting=!1}}get fieldNames(){var t;const r=this;if(!r._fields){const n=((t=r.formulaStore)==null?void 0:t.modelClass)||r.record.constructor,{fieldMap:s}=n,{fieldFilter:a}=r;(r._fields=n.fields.map(o=>{const d=typeof o=="string"?o:o.name;return{id:d,text:s[d].label}}).filter(a?Je.generateFiltersFunction([a]):sk).sort(ak)).push({text:"Record",id:"this"},{text:"Store",id:"data"})}return r._fields}},y(e,"$name","FormulaField"),y(e,"configurable",{dataField:null,formulaPrefix:null}),e},oi=class extends rt.mixin(eS){construct(i){(i==null?void 0:i.inputType)==="hidden"&&(i.hidden=!0),super.construct(...arguments)}getCurrentToken(i=/\s/){const{value:e,selectionStart:t}=this.input;let r=t,n=t+1;if(!e.length||t==null)return null;for(;r>0&&!e[r-1].match(i);)r--;for(;n<e.length&&!e[n].match(i);)n++;return{token:e.substring(r,n),cursor:t,start:r,end:n}}};y(oi,"$name","TextField"),y(oi,"type","textfield"),y(oi,"alias","text"),y(oi,"configurable",{nullValue:""}),oi.initClass(),oi._$name="TextField";var Dm=class kE extends oi{static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;(e=this.globalTapListener)==null||e.call(this),super.doDestroy()}changeEditable(e){return Y.isMobile&&this.initialConfig.editable!==!0&&(e=!1),e}updateEditable(e){var t,r;const n=this,{element:s,ariaElement:a,nonEditableClickTarget:l}=n,{expand:o}=n.triggers,d=globalThis.matchMedia("(max-width: 410px)").matches;super.updateEditable(...arguments),s.classList.toggle("b-not-editable",!e),(t=n.globalTapListener)==null||t.call(n),(r=n.nonEditableClickTargetListener)==null||r.call(n),e===!1?(Y.isMobile&&d&&(o==null||o.hide()),a==null||a.removeAttribute("aria-autocomplete"),l&&(n.nonEditableClickTargetListener=V.on({element:l,click:c=>{const u=l.getRootNode().elementFromPoint(c.clientX,c.clientY);c.originalTarget===l&&u===l&&n.onTriggerClick(c)},thisObj:n}))):(o==null||o.show(),a==null||a.setAttribute("aria-autocomplete","list"),n.globalTapListener=le.ion({globaltap:"showKeyboard",thisObj:n}))}get nonEditableClickTarget(){return this.input}get pickerAlignElement(){const{_pickerAlignElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:T.getPath(this,e)}changePicker(e,t){const r=this;return kE.reconfigure(t,e?Z.merge({id:r.id+"-picker",owner:r,forElement:r.pickerAlignElement,align:{matchSize:e.width==null,anchor:r.overlayAnchor,target:r.pickerAlignElement}},e):null,r)}updatePicker(e){const t=this;t.detachListeners("pickerField.picker"),e&&(e.ion({name:"pickerField.picker",thisObj:t,show:"onPickerShow",hide:"onPickerHide"}),E.setAttributes(t.ariaElement,{role:t.role,"aria-haspopup":e.ownersRole,"aria-controls":e.id,"aria-expanded":e.isVisible}))}updateRole(e){(!this.isConfiguring||e==="textbox")&&this.ariaElement.setAttribute("role",e)}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.hidePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){var t,r;const n=this;let s=!0;if(e.type==="keydown"&&!n.disabled&&!e.shiftKey&&!e.ctrlKey)if(n.pickerVisible){const{picker:a}=n;e.key==="Escape"?(e.preventDefault(),e.stopImmediatePropagation(),n.hidePicker(),s=!1):a.onInternalKeyDown?a.onInternalKeyDown(e):e.key==="ArrowDown"&&a.focusable&&a.focus()}else e.key==="ArrowDown"&&n.picker&&!((r=(t=n.triggers)==null?void 0:t.expand)!=null&&r.keyMap)&&n.onTriggerKeyDown(e);s&&super.internalOnKeyEvent(e)}onFocusIn(e){var t;const r=this,n=(t=le.currentPointerDown)==null?void 0:t.target;super.onFocusIn(e),r.autoExpand&&!(n!=null&&n.matches(".b-fieldtrigger"))&&(r.minChars=0,r.onTriggerClick(e))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}onTriggerKeyDown(e){this.trigger("triggerKey",{event:e})!==!1&&(e.stopImmediatePropagation(),e.preventDefault(),this.onTriggerClick(e))}showKeyboard({event:e}){const t=this.input;E.isTouchEvent&&E.getActiveElement(t)===t&&e.target===t&&(le.suspendFocusEvents(),t.blur(),t.focus(),le.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){var t;const r=this,{picker:n}=r;n&&(n.show(),(t=r.ariaElement)==null||t.setAttribute("aria-expanded",!0),n.isVisible&&e&&r.focusPicker())}onPickerShow(){const e=this;e.pickerActiveDescendant&&e.ariaElement.setAttribute("aria-activedescendant",e.pickerActiveDescendant),e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=le.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=V.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,t;const r=this,{ariaElement:n}=r;r.pickerActiveDescendant=n==null?void 0:n.getAttribute("aria-activedescendant"),n==null||n.removeAttribute("aria-activedescendant"),n==null||n.setAttribute("aria-expanded",!1),r.pickerVisible=!1,r.element.classList.remove("b-open"),r.trigger("togglePicker",{show:!1}),(e=r.pickerTapOutRemover)==null||e.call(r),(t=r.pickerKeyDownRemover)==null||t.call(r)}onPickerTapOut({event:e}){!this.containsFocus&&!this.owns(e.target)&&this.hidePicker()}onPickerKeyDown(e){if(e.key==="Tab"&&!this.picker.trapFocus){const t=E.getActiveElement(this.input),r=new KeyboardEvent("keydown",e);this.input.dispatchEvent(r),r.defaultPrevented&&e.preventDefault(),E.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;E.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout(()=>e.readOnly=!1,500)),super.focus()}};y(Dm,"$name","PickerField"),y(Dm,"type","pickerfield");var Ln=Dm;Ln._$name="PickerField";var Zi=class extends jt{itemContentTpl(i,e){const t=this;return Pt.tpl`${t.iconTpl?this.iconTpl(i):""}
            ${t.itemTpl(i,e)}
            ${t.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(i){const e=this,{selected:t}=e,{generation:r}=t;e.closable&&t.count&&(i.key==="Delete"||i.key==="Backspace")?(e.closeHandler?e.callback(e.closeHandler,e.owner,[t.values,{isKeyEvent:!0}]):e.store.remove(t.values),t.generation!==r&&i.stopImmediatePropagation()):super.onInternalKeyDown(i)}updateClosable(i){this.element.classList[i?"add":"remove"]("b-chips-closable"),this.isConfiguring||this.refresh()}onClick(i){const e=this,t=i.target.closest(`.${e.itemCls}`);if(e.closable&&i.target.classList.contains("b-close-icon")){const r=e.store.getAt(parseInt(t.dataset.index));e.closeHandler?e.callback(e.closeHandler,e.owner,[[r]]):e.store.remove(r)}else super.onClick(i)}};y(Zi,"$name","ChipView"),y(Zi,"type","chipview"),y(Zi,"configurable",{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}),Zi.initClass(),Zi._$name="ChipView";var Em="L{fieldRequired}",ha="L{validateFilter}",lk="L{Field.tooShort}",ok="L{recordNotCommitted}",dk=/[\w\s]/,Ze=class extends Ln{static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",clearWhenInputEmpty:null,pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:i=>i.map(e=>e.value),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:"L{Combo.noResults}",value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,clearTextOnSelection:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0,nonEditableFilterTimeout:200},localizeDisplayFields:!1,buildItems:null,sortItemsOnLocaleChange:!1,nonEditableFilterTimeout:2e3}}static get queryLast(){return"last"}construct(i){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(i){this.usingRecordAsValue=i.valueField===null,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const i=this;T.hasOwn(i,"_value")||(i._value=i.nullValue,i._lastValue=i._lastValue||i._value)}get childItems(){const{_chipView:i}=this,e=super.childItems;return i&&e.push(i),e}get innerElements(){var i;const e=(i=this._chipView)==null?void 0:i.element,{input:t,inputElement:r}=this;return e&&oe.sync({targetElement:t,domConfig:r}),[e||r]}updateInlinePicker(i){i&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(i){return i&&!(i instanceof pe)&&(i=new pe(pe.mergeConfigs({storage:this.valueCollection},i))),i}updateChipStore(i,e){e==null||e.destroy()}changeChipView(i,e){const t=this;if(t.element.classList[i?"add":"remove"]("b-uses-chipview"),i){const{input:r}=t;return t.chipStore||(t.chipStore={}),ah.reconfigure(e,i,{defaults:{parent:t,insertBefore:r,store:t.chipStore,closable:!t.readOnly,label:t.label,ariaLabel:t.ariaLabel,navigator:{type:"combochipnavigator",disabled:t.readOnly,keyEventTarget:r}}})}e==null||e.destroy()}updateChipView(i){var e;const t=this;t._chipViewEventDetacher=(e=t._chipViewEventDetacher)==null?void 0:e.call(t),t.chipStore=i==null?void 0:i.store,i&&(i.element.appendChild(t.input),t._chipViewEventDetacher=V.on({element:i.element,mousedown:"onChipViewMousedown",thisObj:t}))}updateMultiSelect(i,e){const t=this,{input:r,element:n}=t,s=!t.isConfiguring;let{value:a}=t;if(n.classList[i?"add":"remove"]("b-multiselect"),i){const{chipView:l}=t,{parentNode:o}=r,d=l==null?void 0:l.element;d&&d!==o&&(o.insertBefore(d,r),d.appendChild(r),t.chipView.refresh(),n.classList.add("b-uses-chipview")),r.value="",s&&(a=B.asArray(a))}else{const l=t._chipView,{parentNode:o}=r,d=l==null?void 0:l.element;d===o&&(d.parentNode.insertBefore(r,d),d.remove(),n.classList.remove("b-uses-chipview")),s&&typeof a!="string"&&(a=a!=null&&a.length?a[0]:null)}s&&(t.value=a),t.isConfiguring||t.updateEditable(t.editable,null)}onChipViewMousedown(i){i.preventDefault(),this.containsFocus||this.focus()}onChipClose(i,e={}){(e.isKeyEvent&&this.input.value===""||!e.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(i),this._isUserAction=!1)}updateFilterParamName(i){this.hideTrigger!==!1&&(this.hideTrigger=!!i)}updateHideTrigger(i){this.element.classList[i?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(i){this.filterOnInput.delay=i}updateReadOnly(i){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!i)}updateDisabled(i,e){super.updateDisabled(i,e),this._chipView&&(this._chipView.closable=!i)}updateFilterOperator(i){this.primaryFilter&&(this.primaryFilter.operator=i)}get minChars(){var i;return(i=this._minChars)!=null?i:this.remoteFilter?4:1}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(i){i&&(this.items=i.call(this))}changeItems(i){const e=this;if(i==null){if(e.store&&!e.store.isItemStore)return;i=[]}if(e.buildItems&&!(i!=null&&i.length)&&(i=e.buildItems()),i instanceof pe){e.store=i;return}const t=!("valueField"in e.initialConfig),r=e.displayField;let n,s=e.valueField,a;Array.isArray(i)?a=i.map(o=>{let d=o;return o instanceof me?(n=o.constructor,t&&!s&&(e.valueField=s=n.idField)):typeof o=="string"||typeof o=="number"?(t&&!s&&(e.valueField=s=e.displayField),d={[s]:o,[r]:o}):(t&&!s&&(e.valueField=s="value"),Array.isArray(o)&&(d={[s]:o[0],[r]:o[1]})),o.selected&&(e.value=d),d}):(t&&!s&&(e.valueField=s="value"),a=[],Object.entries(i).forEach(([o,d])=>{a.push({[s]:o,[r]:d})}));const l=s===r?{name:"value",dataSource:r}:s;if(!n){class o extends me{static get idField(){return e.valueField}static set idField(c){super.idField=c}static get fields(){const c=[l,r];return e.localizeDisplayFields&&c.push("localeClass"),c}}n=o}e.store?e.store.setConfig({modelClass:n,data:a}):e.store=new pe({isItemStore:!0,data:a,idField:s,verifyNoGeneratedIds:!1,modelClass:n,useRawData:!1})}get value(){const i=this,{valueCollection:e,valueField:t}=i;if(t==null)return i.multiSelect?e.values.slice():e.first;let r;return i.multiSelect?r=e.count?e.map(n=>n[t]):i._unmatchedValue||[]:r=e.count?e.first[t]:i._unmatchedValue||i.nullValue,r}set value(i){super.value=i}get needsInputSync(){return this.usesChipView?!1:!this.editable}changeValue(i,e){var t,r;const n=this,{multiSelect:s}=n;if(n._unmatchedValue=null,i===e){n.syncInputFieldValue(!0);return}if(!s&&Array.isArray(i)&&i.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");n.triggerConfig("items"),n.inputting||(t=n._chipView)==null||t.selected.clear(),n.store||(n.items=[]);const{valueField:a,displayField:l,nullValue:o,store:d,valueCollection:c,_picker:u}=n,{storage:h}=d,g=(r=n.hidePickerOnSelect)!=null?r:!s,f=n._isUserAction||(u==null?void 0:u._isUserAction)||g&&n.pickerVisible||!1;if(i==o||i==null)if(c.count)c.clear();else{const m=n._value;n._value=null,n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||n.triggerFieldChange({value:i,oldValue:m,userAction:f,valid:n.isValid})}else{let m;if(!n.remoteFilter&&d.isAjaxStore&&!d.count){d.ion({load:()=>n.value=i,once:!0,thisObj:n}),n._unmatchedValue=i;return}const p=Array.isArray(i),v=p?i.slice():[i];if(n.remoteFilter){if(T.isObject(i)||i.isModel)d.getById(i.id)?n.valueCollection.splice(0,n.valueCollection.count,d.getById(i.id)):(d.data=[i],n.valueCollection.splice(0,n.valueCollection.count,d.first));else{const D=n.isConfiguring;n.primaryFilter.setConfig({value:i,disabled:!1}),d.performRemoteFilter(!0).then(()=>{if(n.isDestroyed)return;const{isConfiguring:S}=n;n.isConfiguring=D,c.splice(0,c.count,d.allRecords),n.isConfiguring=S})}return}else d.isFiltered?(d.isChained&&d.fillFromMaster(),n.primaryFilter.disabled=!0,d.filter()):d.isChained&&d.fillFromMaster();for(let D=0,S=v.length;D<S;D++){let x=v[D];if(x instanceof me)h.includes(x,!0)||d.add(x);else{const R=T.isObject(x);R&&a&&(x=x[d.modelClass.fieldMap[a].dataSource]),m=h.getBy(l,x)||h.getBy(a,x)||c.getBy(l,x)||c.getBy(a,x),m instanceof Set&&(m=[...m][0]),m?(R&&m.set(v[D]),v[D]=m):(v.splice(D,1),S--,D--)}}const b=!v.length,w=c.generation;c.splice(0,c.count,v),b&&(n._value=p&&i.length===0?null:i,n._unmatchedValue=n._value),(b||c.generation===w)&&n.syncInputFieldValue(),n.syncEmpty(),b&&!n.isConfiguring&&n.triggerFieldChange({value:i,oldValue:e,userAction:f,valid:n.isValid})}n.remoteFilter||(n._lastValue=n._value)}hasChanged(i,e){return this.multiSelect?!T.isEqual(i,e):super.hasChanged(...arguments)}onComboStoreChange({action:i}){i!=="filter"&&this.syncInputFieldValue(!0)}syncInputFieldValue(i){var e;this.usesChipView?(e=this.chipView)==null||e.refresh():super.syncInputFieldValue(i)}get usesChipView(){return!!(this.multiSelect&&this._chipView)}get isEmpty(){return this.valueCollection.count===0&&!this._unmatchedValue}get inputValue(){const i=this;let e=i.selected?i.selected[i.displayField]:i.value;return i.displayValueRenderer&&(e=i.callback(i.displayValueRenderer,i,[i.selected,i])),e==null?"":e}get nonEditableClickTarget(){var i;return this.multiSelect&&((i=this.chipView)==null?void 0:i.element)||super.nonEditableClickTarget}changeValueCollection(i,e){if(e==null||e.destroy(),i)return i.isCollection||(i=new Bt({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),i}changePrimaryFilter(i){return i.isCollectionFilter?i.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):(typeof i=="function"&&(i={filterBy:i}),i=new Je({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...i})),i}changeStore(i){const e=this,t=[],{valueCollection:r,keyStrokeFilterDelay:n,filterParamName:s}=e;if(Array.isArray(i)){e.items=i;return}let a;if(i){if(i.isStore){const l=i.filters.get("primary");e.remoteFilter&&(i.filterParamName=s),a=i.remoteFilter,l?e.primaryFilter=l:t.push(e.primaryFilter)}else typeof i=="string"?i=pe.getStore(i):(i=new(i.readUrl?Dt:pe)(i),e.destroyStore=!0),a=e.remoteFilter||i.restfulFilter,a&&s&&(i.filterParamName=s,e.encodeFilterParams&&(i.encodeFilterParams=e.encodeFilterParams)),t.push(e.primaryFilter);if(!e.valueField&&!e.usingRecordAsValue&&(e.valueField=i.modelClass.idField),e.filterSelected){const l=o=>!e.containsFocus||!r.includes(o);a?(i.storage.autoFilter=!0,i.storage.addFilter({id:`${e.id}-selected-filter`,filterBy:l})):(t.push(l),i.reapplyFilterOnAdd=!0)}r.addIndex({property:e.displayField,unique:!1}),r.addIndex({property:e.valueField,unique:!0}),t.forEach(l=>i.addFilter(l,!0)),a?e.keyStrokeFilterDelay=Math.max(300,n||0):e.keyStrokeFilterDelay=n!=null?n:10}return e.valueField===e.displayField&&!e.peekConfig("multiSelect")&&(e.nullValue=""),i}updateStore(i,e){const t=this,{_picker:r}=t;let n;t.destroyStore&&e&&e.destroy(),r&&(r.store=i),i.storage.addIndex({property:t.displayField,unique:!1}),i.storage.addIndex({property:t.valueField,unique:!0}),n={filter:"onStoreFilter"},t.displayValueRenderer&&((n||(n={})).change="onComboStoreChange"),t.detachListeners("store"),i!=null&&i.storage&&t.valueCollection.match(i.storage),t.syncInputFieldValue(),n&&(n.name="store",n.thisObj=t,i.ion(n))}get remoteFilter(){var i;return!!(this.filterParamName||(i=this._store)!=null&&i.restfulFilter)}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:i}=this;return this.multiSelect?this.valueCollection.values.slice().sort((e,t)=>i.indexOf(e)-i.indexOf(t))[0]:this.valueCollection.first}onEditComplete(){const i=this,e=i.valueCollection.count;super.onEditComplete(),e&&(i.clearError(ha),i.syncInputFieldValue()),i.required&&!e&&i.setError(Em)}onTriggerClick(i){var e;const t=this,r="key"in i;if(!(t.remoteFilter&&t.filterOnEnter)){if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled)switch((e=t.triggerAction)==null?void 0:e.toLowerCase()){case"all":t.doFilter(null,r);break;case"last":t.doFilter(t.lastQuery,r);break;default:t.doFilter(t.input.value,r)}}}internalOnInput(i){const e=this;e.clearWhenInputEmpty&&e.input.value===""&&e.clear(),e.syncEmpty(),e.syncInputWidth(),e.filterOnInput(i),e.trigger("input",{value:e.input.value,event:i})}filterOnInput(i){const e=this,{value:t}=i.type==="input"?i.target:e.input,r=t.length;e.inputting=!0,e.inlinePicker||r>=e.minChars&&(!e.filterOnEnter||i.key==="Enter")?e.doFilter(t):(e.validateFilter&&!e.remoteFilter&&e[r?"setError":"clearError"](ha),e.hidePicker()),e.inputting=!1}syncInputWidth(){const i=this;if(i.usesChipView){const e=i.input,t=i._inputPadding||(i._inputPadding=E.getEdgeSize(e,"padding","lr")),r=e.value||"",n=E.measureText(r+"W",e,!1,i.element)+t.width;e.style.flex=`1 1 ${Math.ceil(n)}px`}}doFilter(i,e){var t;const r=this,{store:n,picker:s}=r,a=i==null||i==="";r.lastQuery=i,r.primaryFilter.setConfig({value:i,disabled:a}),r.remoteFilter&&n.clear(!0);const l=()=>{const{navigator:o,isVisible:d}=s;n.count?!a&&o&&(o.activeItem=0):!r.remoteFilter&&!a&&(o&&(o.activeItem=null),r.editable&&r.validateFilter&&r.setError(ha)),d&&s.realign()};(t=r.filterPromise=n.filter())==null||t.then(()=>{r.filterPromise=null,l()}),r.inlinePicker||(s!=null&&s.isVisible?s.lastAlignSpec.zone===0&&s.realign():r.showPicker(e)),r.filterPromise||l()}onStoreFilter({source:i}){const e=this,t=e._picker,r=t==null?void 0:t.element.dataset,{count:n}=i;e.remoteFilter&&(n?t&&(t.navigator.activeItem=0):e.validateFilter&&e.setError(ha),e.filterSelected&&e.valueCollection.count&&(i.storage.onFiltersChanged({action:"splice",oldCount:1}),t&&t.refresh())),r&&(e.createOnUnmatched&&!n&&e.primaryFilter.value!=null?r.addNewValue=e.L("L{addNewValue}")(e.primaryFilter.value):r==null||delete r.addNewValue)}onValueCollectionChange({source:i}){var e,t,r,n;const s=this,{multiSelect:a,_picker:l,nullValue:o}=s,d=(e=s.hidePickerOnSelect)!=null?e:!a,c=a?i.values.slice():i.first,u=i.values.slice(),h=s._isUserAction||(l==null?void 0:l._isUserAction)||d&&s.pickerVisible||!1,g=s._value;if(d&&s.hidePicker(),a&&s.clearTextOnSelection&&(s.input.value=""),!i.count&&s.required?s.setError(Em):(s.clearError(Em),s.clearError(ha)),s.validateFilter&&c&&s.clearError(ha),s.filterSelected){const m=l==null?void 0:l.navigator,p=Number((r=(t=m==null?void 0:m.activeItem)==null?void 0:t.dataset)==null?void 0:r.index);s.remoteFilter?(s.store.storage.onFiltersChanged({action:"splice",oldCount:1}),s._picker&&s._picker.refresh()):s.store.filter(),isNaN(p)||(m.activeItem=Math.min(l.store.count,p))}s._value=o,s._lastValue=o;const f=s.cacheCurrentValue(s.value);s.syncInputFieldValue(),s.syncEmpty(),s.isConfiguring||(f!==g&&!s.onConfigChange.$nullFn&&s.onConfigChange({name:"value",value:f,was:g,config:s.$meta.configs.value}),s.triggerFieldChange({value:f,oldValue:g,userAction:h,valid:s.isValid}),(n=s.trigger)==null||n.call(s,"select",{record:c,records:u,userAction:h}),s.defaultAction==="select"&&s.trigger("action",{value:f,record:c,records:u,userAction:h}))}cacheCurrentValue(i){return this._value=i}onValueCollectionNoChange({toAdd:i}){!this.inlinePicker&&!this.multiSelect&&i.length&&this.pickerVisible&&(this.picker.hide(),this.syncInputFieldValue())}showPicker(){var i;const e=this,{picker:t}=e;e.readOnly||e.inlinePicker||(t.multiSelect=e.multiSelect,super.showPicker(...arguments),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem&&(e.multiSelect?t.restoreActiveItem(((i=t.navigator)==null?void 0:i.previousActiveItem)||e.selected||0,!0):t.restoreActiveItem(e.selected||0,!0)),e.input.focus())}changePicker(i,e){if(i){const t=this,r=t.pickerWidth||(i==null?void 0:i.width),n=jt.mergeConfigs({owner:t,store:t.store,selected:t.valueCollection,multiSelect:t.multiSelect,cls:t.listCls,displayField:t.displayField,forElement:t.pickerAlignElement,emptyText:t.emptyText,align:{matchSize:r==null?"min":!1,anchor:t.overlayAnchor,target:t.pickerAlignElement,minHeight:t.inlinePicker?null:Math.min(3,t.store.count)*40},[t.listItemTpl?"itemTpl":void 0]:t.listItemTpl,width:r,navigator:{keyEventTarget:t.input,activateOnMouseover:!t.inlinePicker}},i);t.inlinePicker&&Object.assign(n,{floating:!1,align:null,maxHeight:null,appendTo:t.element}),i=jt.reconfigure(e,i?n:null,t),i.element.classList.add("b-combo-picker"),i.ion({navigate:"onPickerNavigate",thisObj:t}),V.on({element:i.element,pointerdown:s=>t.onPickerNavigate({event:s}),thisObj:t})}else e==null||e.destroy();return i}onPickerNavigate({event:i}){i.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const i=this;super.onPickerHide(),i.multiSelect&&i.clearTextOnPickerHide&&!i.errors&&(i.input.value="")}async internalOnKeyEvent(i){var e;const t=this,r=t.input[t.inputValueAttr],n=r.length,{key:s,type:a}=i,{primaryFilter:l,store:o,multiSelect:d,minChars:c,_picker:u,_chipView:h}=t;let g;if(a==="keydown"&&(u!=null&&u.isVisible)&&u.navigator){const{activeItem:f}=u.navigator;if(f&&d&&s===t.multiValueSeparator){t.input.value="",u.onItemClick(f,i),l.setConfig({value:"",disabled:!0}),o.filter(),u.hide(),i.preventDefault();return}if(!f&&t.createOnUnmatched&&(d&&s===t.multiValueSeparator||s==="Enter")){i.preventDefault(),await t.addNewRecord(r);return}}t.editable?h&&!h.selected.count&&a==="keydown"&&s==="Backspace"&&!n&&(h.navigator.activeItem=t.valueCollection.count-1,i.stopImmediatePropagation()):a==="keydown"&&s==="Backspace"&&((e=t.nonEditableFilterValue)!=null&&e.length)?(t.nonEditableFilterValue=t.nonEditableFilterValue.substring(0,t.nonEditableFilterValue.length-1),t.doFilter(t.nonEditableFilterValue),t.lastFilterKeypressTime=i.timeStamp):a==="keypress"&&s.length===1&&s.match(dk)&&((!t.lastFilterKeypressTime||i.timeStamp-t.lastFilterKeypressTime>t.nonEditableFilterTimeout)&&(t.nonEditableFilterValue=""),t.nonEditableFilterValue=(t.nonEditableFilterValue||"")+s,t.doFilter(t.nonEditableFilterValue),t.lastFilterKeypressTime=i.timeStamp),t.pickerVisible&&s==="Enter"&&t.primaryFilter.value===t.input.value&&(g=!0),super.internalOnKeyEvent(...arguments),i.type==="keydown"&&s==="Enter"&&!g&&t.remoteFilter&&(n>=c?(i.stopPropagation(),t.filterOnInput.now(i)):n>0&&(i.stopPropagation(),t.setError(lk+` (${c})`,!1,!0)))}async addNewRecord(i){var e,t;const r=this,{store:n,_picker:s,valueCollection:a,multiSelect:l,primaryFilter:o}=r,d=n.remoteFilter&&n.autoCommit;r.filterPromise&&await r.filterPromise,d||(o.setConfig({value:"",disabled:!0}),n.filter()),r._isUserAction=!0;const[c]=n.add(r.callback(r.createOnUnmatched,r,[i,r]));if(n.isCommitting){let u;try{await n.autoCommitTimeoutPromise,await n.commitPromise}catch(h){u=(t=(e=h.response)==null?void 0:e.parsedJson)==null?void 0:t.error}c.isPhantom&&(r.clearError(),r.setError(u||ok,!1,!0),n.remove(c),n.removed.remove(c))}d&&(o.setConfig({value:"",disabled:!0}),n.filter()),r.input.value="",n.includes(c)&&a.splice(l?a.count:0,l?0:a.count,c),s==null||s.hide(),r._isUserAction=!1}changeCreateOnUnmatched(i){return i===!0&&(i=this.defaultRecordCreator),i}defaultRecordCreator(i){return this.store.createRecord({[this.displayField]:i})}updateLocalizeDisplayFields(i){i?this.localizableProperties.push("store"):B.remove(this.localizableProperties,"store")}localizeProperty(i){return i==="store"?this.localizeStore():super.localizeProperty(i)}localizeStore(){var i;const e=this,{displayField:t}=e;let{localizedDisplayFieldsMap:r}=e;r||(e.localizedDisplayFieldsMap=r=new Map),!e.store&&e.buildItems&&(e.items=e.buildItems());for(const n of e.items)if(n.id){let s=r.get(n.id);!s&&((i=n[t])!=null&&i.startsWith("L{"))&&(s=n[t],r.set(n.id,s)),s&&(n[t]=(n.localeClass||e).L(s))}e.sortItemsOnLocaleChange&&e.store.sort(),e.syncInputFieldValue()}createOverflowTwin(i){return super.createOverflowTwin({store:this.store,...i})}};y(Ze,"$name","Combo"),y(Ze,"type","combo"),y(Ze,"alias","combobox,dropdown"),y(Ze,"delayable",{filterOnInput:0});var ah=class extends Zi{static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(i){return O.encodeHtml(i.getValue(this.owner.displayField))},scrollable:{overflowY:"auto"}}}};y(ah,"$name","ComboChipView"),y(ah,"type","combochipview");var xm=class extends Ki{static get configurable(){return{allowShiftKey:!0}}onTargetClick(i){const e=this,t=i.target.closest(e.itemSelector);t&&!i.target.classList.contains("b-close-icon")&&(!i.shiftKey&&!t.contains(i.target.closest("[data-noselect]"))&&e.ownerCmp.selected.clear(),e.inClickHandler=!0,e.activeItem=t,e.inClickHandler=!1)}onKeyDown(i){i.key!=="Enter"&&!i.target.selectionStart&&!i.target.selectionEnd&&super.onKeyDown(i)}updateActiveItem(i,e){const t=this.ownerCmp;super.updateActiveItem(i,e),i&&!this.inClickHandler&&t.selected.add(t.getRecordFromElement(i))}navigatePrevious(i){const e=this.ownerCmp;e.navigator.activeItem&&!i.shiftKey&&e.selected.clear(),this.previous?super.navigatePrevious(i):this.activeItem=null}navigateNext(i){const e=this.ownerCmp;e.navigator.activeItem&&!i.shiftKey&&e.selected.clear(),this.next?super.navigateNext(i):this.activeItem=null}};y(xm,"$name","ComboChipNavigator"),y(xm,"type","combochipnavigator"),Ze.initClass(),ah.initClass(),xm.initClass(),Ze._$name="Combo";var fd=class extends Ze{static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(i,e){const t=this;return super.changeStore(new pe({data:[{id:t.positiveValue,text:t.positiveText||t.L("L{Object.Yes}")},{id:t.negativeValue,text:t.negativeText||t.L("L{Object.No}")}]}),e)}};y(fd,"$name","BooleanCombo"),y(fd,"type","booleancombo"),fd.initClass(),fd._$name="BooleanCombo";var ck=({$toggleOrder:i},{$toggleOrder:e})=>(e||0)-(i||0),tS={click:"resetValueCache",beforeToggle:"onItemBeforeToggle",toggle:"onItemToggle"},lh=class FE extends gt.mixin(Bu,cd){afterConstruct(){super.afterConstruct(),this.ion({change:"internalOnChange"})}get inputWrap(){return this.element}get isValid(){let e=super.isValid;const t=this,{toggleable:r}=t;return t.clearError("L{Field.fieldRequired}",!0),e&&!t.disabled&&(t.required&&!t.value||r&&t.pressed.length<r[0])&&(e=!1,t.setError("L{Field.fieldRequired}",!0)),t.checkValidity&&t.callback(t.checkValidity,t,[t])===!1&&(e=!1),e&&t.errors&&Object.keys(t.errors).length&&(e=!1),e}get pressed(){return this.items.filter(e=>e.pressed).sort(ck)}internalOnChange(){this.syncInvalid()}onChildAdd(e){super.onChildAdd(e),e.ion({thisObj:this,...tS,prio:1e4})}onChildRemove(e){e.un({thisObj:this,...tS}),super.onChildRemove(e)}onItemBeforeToggle({pressed:e}){const{toggleable:t}=this;return e||!t||this.pressed.length>t[0]}onItemToggle(e){const t=this,r=(t.toggleCount||0)+1,{toggleable:n}=t;t.resetValueCache(),!t.isSettingValue&&(!t.toggleGroup||e.pressed)&&(n&&(e.source.$toggleOrder=r,t.toggleCount=r,t.isSettingValue=!0,t.pressed.slice(n[1]).forEach(s=>s.pressed=!1),t.isSettingValue=!1),t.triggerFieldChange({value:t.value,userAction:!0,event:e}))}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),!e.toggleGroup&&t.toggleGroup&&(e.toggleGroup=t.toggleGroup),t.toggleable&&(e.toggleable=!0)),t.columns&&(e.width=`${100/t.columns}%`),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}changeToggleable(e){return e===!0?e=[0,1/0]:typeof e=="number"&&(e=[1,e]),e||null}updateToggleable(e){e&&!this.isConstructing&&this.pressed.slice(e[1]).forEach(t=>t.pressed=!1)}changeToggleGroup(e,t){return e===!0?t||FE.generateId("toggleGroup"):e}updateRotate(e){this.eachWidget(t=>{t.rotate!==!1&&(t.rotate=e)})}get valueAsArray(){const e=[];return this.items.forEach(t=>{t.pressed&&t.value!==void 0&&e.push(t.value)}),e}get value(){const e=this;return e._value||(e._value=e.valueAsArray.join(e.valueSeparator)),e._value}set value(e){const t=this,r=t.value;e==null?e=[]:typeof e=="string"?e=e.split(t.valueSeparator):Array.isArray(e)||(e=[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach(n=>{n.value!==void 0&&(n.pressed=e.includes(n.value))}),t.isSettingValue=!1,!t.isConfiguring&&r!==t.value&&t.triggerFieldChange({value:t.value,userAction:!!t._isUserAction})}get validity(){return{}}onDisabled(e){this.syncInvalid(),this.items.forEach(t=>t.disabled=e||!t.ignoreParentReadOnly&&this.readOnly)}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}addToOverflowMenu(e,t,r){const{toggleable:n,toggleGroup:s}=this;(s||(n==null?void 0:n[0])===1&&n[1]===1)&&(t={...t,radio:!0}),this.items.forEach(a=>a.addToOverflowMenu(e,t,r))}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}updateUseGap(e){e||this.element.classList.add("b-no-gap")}};y(lh,"$name","ButtonGroup"),y(lh,"type","buttongroup"),y(lh,"configurable",{defaultType:"button",cls:null,items:null,color:null,useGap:!1,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value",errorTooltipCachePath:"buttonGroupErrorTooltip",errorTooltipConfig:{forSelector:".b-buttongroup.b-invalid"},overflowable:!0,toggleable:null});var Pn=lh;Pn.initClass(),Pn._$name="ButtonGroup";var Rm={0:1,6:1},ki=class extends Xe{static get configurable(){return{layout:"vbox",textContent:!1,date:{$config:"date"},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,disableNonWorkingDays:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(i){super.construct(i),this.refreshCount||this.refresh()}onInternalPaint({firstPaint:i}){var e;(e=super.onInternalPaint)==null||e.call(this,...arguments),i&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var i;(i=this.tip)==null||i.destroy(),super.doDestroy()}updateMinRowHeight(i){this.element.style.setProperty("--min-row-height",E.setLength(i)),this.scrollable={overflowY:i?"auto":!1}}updateMinColumnWidth(i){this.element.style.setProperty("--min-column-width",E.setLength(i)),this.scrollable={overflowX:i?"auto":!1},this.overflowElement.classList[i?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(i){const e=(i.nodeType===Element.ELEMENT_NODE?i:i.target).closest(`#${this.id} [data-date]`);if(e)return C.parseKey(e.dataset.date)}changeTip(i,e){const t=this;return ve.reconfigure(e,i,{owner:t,defaults:{type:"tooltip",owner:t,id:`${t.id}-cell-tip`,forElement:t.bodyElement,forSelector:`.${t.dayCellCls}`}})}updateTip(i){this.detachListeners("tip"),i==null||i.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(i,e){const t=this;super.updateElement(i,e),t.updateHideNonWorkingDays(t.hideNonWorkingDays),t.weekdayCells=Array.from(i.querySelectorAll(".b-calendar-day-header")),t.weekElements=Array.from(i.querySelectorAll(".b-calendar-week")),t.weekDayElements=Array.from(i.querySelectorAll(".b-calendar-days")),t.cellElements=[];for(let r=0,{length:n}=t.weekDayElements;r<n;r++)t.cellElements.push(t.weekDayElements[r].previousSibling,...t.weekDayElements[r].children)}changeDate(i){if(i=typeof i=="string"?C.parse(i):new Date(i),isNaN(i))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return C.clearTime(i)}updateDate(i){this.month.date=i,this.element.dataset.month=C.format(i,"YYYY-MM")}updateDayNameFormat(){const i=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let e=4;e<11;e++)i.setDate(e),this.shortDayNames.push(C.format(i,this.dayNameFormat))}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:C.weekStartDay}updateWeekStartDay(i){const e=this;if(e._month){e.month.weekStartDay=i,e.dayNames=[];for(let t=0;t<7;t++)e.dayNames[t]=e.shortDayNames[e.canonicalDayNumbers[t]];e.refreshCount&&e.refresh()}}updateHideNonWorkingDays(i){var e;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,!!i),(e=this.scrollable)==null||e.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=i),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(i){var e;this.element.classList.toggle(this.hideOtherMonthCellsCls,!!i),(e=this.scrollable)==null||e.syncOverflowState()}updateDisableOtherMonthCells(i){var e;this.element.classList.toggle(this.disableOtherMonthCellsCls,!!i),(e=this.scrollable)==null||e.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=C.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=C.weekends)}changeNonWorkingDays(i){return T.assign({},i)}updateNonWorkingDays(i){var e;this._month&&(this.month.nonWorkingDays=i,this.refresh(),(e=this.scrollable)==null||e.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return C.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:i}=this.month;if(i)return C.add(i,1,"day")}changeMonth(i,e){const t=this;if(!(i instanceof _i)){if(typeof i=="number"){if(e){e.month=i;return}const r=t.date||C.clearTime(new Date);r.setMonth(i),i={date:r}}i=_i.new({weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks},i)}return i.ion({dateChange:"onMonthDateChange",thisObj:t}),i}onMonthDateChange({source:i,newDate:e,oldDate:t,changes:r}){const n=this;if(n.year=i.year,!n.isConfiguring){if(!n.getCell(e)||r.m||r.y){const{isVisible:s}=n;n.refresh(),n.animateTimeShift&&s&&E.slideIn(n.contentElement,e>t?1:-1)}n.trigger("dateChange",{changes:r,value:e,oldValue:t})}}updateYear(i){this.month.year=i}updateShowWeekNumber(i){this.updateShowWeekColumn(i)}updateShowWeekColumn(i){const e=this;e.element.classList[i?"add":"remove"]("b-show-week-column"),e.floating&&(e.isAligning||e.realign())}updateSixWeeks(i){this.month&&(this.month.sixWeeks=i,this.refresh())}refresh(){this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.doRefresh()}doRefresh(){var i;this.getConfig("element");const e=this,t=e.timeZone!=null?e.timeZone:(i=e.project)==null?void 0:i.timeZone,r=t!=null?$e.toTimeZone(new Date,t):new Date,{weekElements:n,weekDayElements:s,date:a,month:l,dayCellCls:o,dayHeaderCls:d,disabledCls:c,otherMonthCls:u,weekendCls:h,todayCls:g,nonWorkingDayCls:f,nonWorkingDays:m,canonicalDayNumbers:p,sixWeeks:v}=e;if(r.setHours(0,0,0,0),!a){e.date=r;return}e.element.style.setProperty("--visible-week-count",l.weekCount),e.trigger("beforeRefresh"),e.getConfig("dayNameFormat");for(let S=0;S<7;S++){const x=e.weekdayCells[S],R=e.canonicalDayNumbers[S],M={[d]:1,[h]:Rm[R],[f]:m[R]};if(e.headerRenderer){x.innerHTML="";const _=e.callback(e.headerRenderer,e,[x,S,R]);_&&(typeof _=="string"?E.setInnerText(x,_):E.createElement({..._,parent:x}))}else E.setInnerText(x,e.shortDayNames[R]);E.syncClassList(x,M),x.dataset.columnIndex=S,x.dataset.cellDay=R}let b=0,w=0,D=6;for(let S=6;S>=0;S--)if(!m[p[S]]){D=S;break}n[4].classList.toggle("b-hide-display",l.weekCount<5&&!v),n[5].classList.toggle("b-hide-display",l.weekCount<6&&!v),l.eachWeek((S,x)=>{const R=s[b],M=[R.previousSibling,...R.children],_=M[0];if(n[b].dataset.week=`${S[0]},${S[1]}`,n[b].setAttribute("aria-label",`${e.L("L{Week}")} ${S[1]}, ${S[0]}`),_.innerHTML===""&&(_.innerText=S[1]),e.weekRenderer){const k=e.callback(e.weekRenderer,e,[_,S]);k&&(typeof k=="string"?E.setInnerText(_,k):(_.innerHTML="",E.createElement({...k,parent:_})))}else _.innerText=S[1];for(let k=0;k<7;k++){const F=x[k],I=F.getDay(),A=C.makeKey(F),P=m[I],H=M[k+1],G={[o]:1,[c]:e.isDisabledDate(F),[u]:F.getMonth()!==l.month,[h]:Rm[I],[g]:F.getTime()===r.getTime(),[f]:P,"b-last-working-day":k===D,"b-first-visible-cell":!(F-(e.firstVisibleDate||-1)),"b-last-visible-cell":!(F-(e.lastVisibleDate||-1)),[`b-day-of-week-${I}`]:1};E.syncClassList(H,G),H.role="gridcell",H.dataset.date=A,H.dataset.cellIndex=w,H.dataset.columnIndex=k,H.lastDomConfig&&(delete H.lastDomConfig.class,delete H.lastDomConfig.className),e.cellRenderer?e.callback(e.cellRenderer,e,[{cell:H,date:F,day:I,rowIndex:b,cellIndex:w,columnIndex:k,key:A,week:S,row:n[b],source:e,visibleColumnIndex:e.visibleDayColumnIndex[I]}]):H.innerHTML=F.getDate(),w++}b++}),e.visibleWeekCount=b,e.floating&&(e.isAligning||e.realign()),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}isDisabledDate(i){const e=this,t=i.getDay(),{disabledDates:r}=e;if(e.disableWeekends&&Rm[t]||e.disableNonWorkingDays&&e.nonWorkingDays[t])return!0;if(r)return Array.isArray(r)?(i=C.clearTime(i,!0),r.some(n=>(n=typeof n=="string"?C.parse(n):n,!(C.clearTime(n,!0)-i)))):e.callback(r,e,[i])}get bodyConfig(){const i=super.bodyConfig,e=[];i.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays","aria-hidden":!0,reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...B.fill(7,{class:this.dayHeaderCls}),E.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:e,role:"grid"}];for(let t=0;t<6;t++){const r={role:"row",className:"b-calendar-row b-calendar-week",dataset:{rowIndex:t},children:[{className:"b-week-number-cell",role:"rowheader"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};e.push(r)}return i}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:i,month:e}=this.month;return new Date(i,e,1)}for(const i=this,e=i.month.startDate;;e.setDate(e.getDate()+1))if(!i.hideNonWorkingDays||!i.nonWorkingDays[e.getDay()])return e}get lastVisibleDate(){const i=C.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return i;for(const e=this,t=i;;t.setDate(t.getDate()-1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}getCell(i,e){typeof i!="string"&&(i=C.makeKey(i));const t=this.weeksElement.querySelector(`[data-date="${i}"]`);if(t&&(!e||!t.classList.contains(this.otherMonthCls)))return t}onTipOverCell({source:i,target:e}){i.date=C.parseKey(e.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}};y(ki,"$name","CalendarPanel"),y(ki,"type","calendarpanel"),ki.initClass(),ki._$name="CalendarPanel";var{abs:uk,ceil:iS,floor:hk,max:rS,min:Tm}=Math,nS="b-carousel-item",gk=[0,0],Ut=Symbol("carouselIndex"),Mm=Symbol("carouselSyncGen"),oh="b-carousel-reserve",fk=`${oh}-before`,mk=`${oh}-after`,pk=(i,e)=>i[Ut]-e[Ut],vk="b-carousel-first",yk="b-carousel-last",_m="b-carousel-visible",sS=["x","y"],aS=["y","x"],md={h:{minSize:"minWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",size:"width",vxy:["vx","vy"],xy:sS},v:{minSize:"minHeight",offsetSize:"offsetHeight",size:"height",vxy:["vy","vx"],xy:aS}};md.h.other=md.v,md.v.other=md.h;var Ji=class extends Xe.mixin(In,Nw){compose(){const{carouselClasses:i}=this;return{class:{...i}}}afterFloatReparent(){this.syncSoon()}get allSlots(){return this.ensureItems().values.filter(i=>i.innerItem).sort(pk)}get bodyConfig(){const{carouselClasses:i,emptyHtml:e,emptyText:t}=this,r=super.bodyConfig;return T.merge(r,{className:{"b-vbox":1,...i},children:{innerCt:{class:{"b-carousel-inner-ct":1,"b-box-center":1}},emptyElement:{class:{"b-carousel-empty-text":1,"b-box-center":1},html:e||O.xss`${t}`}}})}get carouselClasses(){const{empty:i,vertical:e}=this;return{"b-carousel-empty":i,"b-carousel-vertical":e}}get contentElement(){return this.innerCt}get currentIndex(){return this.indexFromPos(this.scrollPos)}set currentIndex(i){this.goto(i)}get focusedSlot(){const{innerCt:i}=this;let e=null,t,r;for(t=E.getActiveElement();t;t=r)if(r=t.parentElement,r===i){e=z.fromElement(t);break}return e}get infinityScrollerDefaults(){const i=this,[e,t]=i.vertical?aS:sS;return T.merge(super.infinityScrollerDefaults,{snap:i.snap&&e,[e]:{overflow:"hidden-scroll",range:i.scrollRange,pos:0},[t]:{overflow:"hidden"}})}get propNames(){return md[this.vertical?"v":"h"]}get scrollAxis(){return this.infinityScroller[this.vertical?"y":"x"]}get scrolling(){return this.infinityScroller.scrolling}get scrollPos(){return this.scrollAxis.pos}set scrollPos(i){this.scrollAxis.pos=i}get scrollRange(){const{range:i,slotSize:e}=this;return e?[i[0]*e,i[1]*e]:[0,1/0]}get shrinkWrap(){const i=this._shrinkWrap;return i==="auto"?E.getStyleValue(this.element,"position")==="absolute":i}get lastVisibleIndex(){var i;return(i=this.lastVisibleSlot)==null?void 0:i[Ut]}get visibleSlots(){return this.allSlots.filter(i=>i.element.classList.contains(_m))}updateAtMax(i){this.element.classList.toggle("b-carousel-at-max",i)}updateAtMin(i){this.element.classList.toggle("b-carousel-at-min",i)}changeConfigureSlot(i){if(typeof i=="string"){const e=`_${i}Fn`;return this[e]||(this[e]=(...t)=>this[i](...t))}return i}triggerSlotVisibility(){const{firstVisibleSlot:i,lastVisibleSlot:e}=this;this.trigger("slotVisibility",{firstVisibleSlot:i,lastVisibleSlot:e})}updateFirstVisibleSlot(i){this.triggerSlotVisibility()}updateLastVisibleSlot(){this.triggerSlotVisibility()}changeRange(i){var e,t;if(i=i?[(e=i[0])!=null?e:-1/0,(t=i[1])!=null?t:1/0]:[0,0],i[0]!==i[1]){let r;if(i[1]<i[0]&&(r="denormalized"),r)throw new Error(`Invalid carousel range [${i[0]}, ${i[1]}): ${r}`)}return i}updateRange(i){this.empty=!(i[0]<i[1]),this.syncSoon()}updateShrinkWrap(){this.isPainted&&this.syncSoon()}updateVertical(){this.isPainted&&this.syncSoon()}convertIndexPos(i,e){const t=this,{allSlots:r,propNames:n}=t,[s,a]=t.range,l=Math.floor((s+a)/2),o=r.length,d=r[o-1],c=n.vxy[0],u=s<=0&&0<a;if(!e&&!(s<=i&&i<a))return null;let h=t.slotSize||100,g,f,m,p,v,b,w,D;if(o){h=0;for(D of r){if(m=D[Ut],g=D[c],h=h||D.$vxy[n.size],D===r[0]&&(p=m,w=g,i<(e?g:m)))break;if(e){if(i===g)return m;if(i<g)return m-1}else if(i===m)return g;if(D===d){if(f=g+D.$vxy[n.size],e&&i<f)return m;v=m+1,b=f}}h=h||t.slotSize||100}else{if(e&&0<=i&&i<h)return u?0:l;w=0,b=h,p=u?0:l,v=p+1}return e?i<w?rS(p-iS((w-i)/h),s):Tm(v+hk((i-b)/h),a):i<p?w-(p-i)*h:b+(i-v)*h}ensurePlan(i){return i}ensureVisible(i){const e=this;if(e.lastScrollPos==null)e._afterSync=()=>e.ensureVisible({...i,animate:!1});else if(e.scrolling&&e.hasPainted)e._afterScroll=()=>e.ensureVisible(i);else{const{index:t,animate:r}=e.ensurePlan(i),{currentIndex:n,lastVisibleIndex:s}=e;let a;return t<n?a=t-n:s<t&&(a=t-s),a&&e.go(a,r)}}getSlotIndex(i){return i==null?void 0:i[Ut]}indexFromPos(i){return this.convertIndexPos(i,!0)}posFromIndex(i){return this.convertIndexPos(i,!1)}slotFromIndex(i){for(const e of this.allSlots)if(e[Ut]===i)return e;return null}backward(i){return this.go(-1,i)}forward(i){return this.go(1,i)}go(i,e){return this.goto(this.currentIndex+i,e)}goto(i,e){const t=this;if(t.lastScrollPos==null)t._afterSync=()=>{const{scrollPos:r}=t;t.goto(i,!1),!t.hasPainted&&r!==t.scrollPos&&t.sync()};else if(t.scrolling&&t.hasPainted)t._afterScroll=()=>t.goto(i,e);else{const{range:r,slots:n}=t,s=r[1]-(typeof n=="number"?n-1:0),a=Tm(s-1,rS(r[0],i)),l=uk(t.currentIndex-a),o=t.posFromIndex(a);return l>=t.allSlots.length&&(e=!1),t.scrollTo({animate:e,[t.scrollAxis.name]:o})}}onChildAdd(i){return i.innerItem&&i.element.classList.add(nS),super.onChildAdd(i)}onChildRemove(i){return i.innerItem&&i.element.classList.remove(nS),super.onChildRemove(i)}onInfiniteScrollEnd(i){super.onInfiniteScrollEnd(i);const{_afterScroll:e}=this;this._afterScroll=null,e==null||e()}onSlotFocusTrap({source:i,top:e}){const t=this,r=e?-1:1,n=i[Ut],s=t.slotFromIndex(n+r);return s.element.classList.contains(oh)?t.scrollOnTab&&t.go(r).then(a=>{var l;a&&((l=s.element)==null||l.focus())}):s.element.focus(),!1}resync(){this.sync()}sync(){var i;if(this.syncCount=(this.syncCount||0)+1,!this.empty){const e=this,{allSlots:t,disableReserveSlots:r,innerCt:n,scrollAxis:s,propNames:a,reserveSlots:l,scrolling:o,slots:d}=e,[c,u]=e.range,h=s.pos,g=z.resolveType(((i=e.defaults)==null?void 0:i.type)||e.defaultType),f=e.indexFromPos(h),m=e.posFromIndex(f),p=h-m,v=[l,l],b=e.syncGen=(e.syncGen||0)+1;o&&h>(e.lastScrollPos||0)&&p&&(--v[0],++v[1]),e.lastScrollPos=h,n.style.setProperty("--carousel-item-offset",`${Math.abs(p)}px`),e.shrinkWrapped||(n.style[a.minSize]="");let w=n[a.offsetSize],D=!1,S=!1,x=null,R=null,M,_,k,F;e.unanimated(()=>{const{_afterSync:I}=e,A=d&&d!=="auto"?e.syncFixed(f,a,t,g,v,d,c,u):e.syncDynamic(f,a,t,g,v,d,w,c,u),P=[],H=t.filter(G=>G[Mm]!==b);H.length&&(H.forEach(G=>e.detachListeners(`${G.id}-listeners`)),e.remove(H)),n.style[a.other.minSize]=`${A[a.other.size]}px`,w=n[a.offsetSize];for(F of t)if(!H.includes(F)){const G=s.getItemSpan(F),q=h+w,W=G[1]<=h,j=q<=G[0],se=!W&&!j,J=se&&G[0]<=h,Q=se&&G[1]>=q;se&&(F[Ut]===c&&(S=!0),F[Ut]===u-1&&(D=!0)),J&&(x=F),Q&&(R=F),P.push([F,F.element.classList,{[oh]:W||j,[fk]:W,[vk]:J,[_m]:se,[yk]:Q,[mk]:j}])}for([F,M,k]of P){r&&(F.disabled=k[_m]?!1:r);for(_ in k)M.toggle(_,k[_])}e.atMax=D,e.atMin=S,e.firstVisibleSlot=x,e.lastVisibleSlot=R,s.other.range=gk,e.syncDomOrder(H.length?e.allSlots:t),!o&&e.scrollable.fixPositionSync(),s.sync({range:e.scrollRange}),s.pos!==h?e.resync():I&&(e._afterSync=null,I())})}}syncDomOrder(i){const e=E.getActiveElement();let t,r,n;for(n=i.length;n-- >1;)r=i[n].element,t||r.classList.add("b-last-visible-child"),t=i[n-1].element,t.classList.remove("b-last-visible-child"),r.classList.remove("b-first-visible-child"),t.nextSibling!==r&&t.parentElement.insertBefore(t,r);t==null||t.classList.add("b-first-visible-child"),this.element.contains(e)&&e!==E.getActiveElement()&&e.focus()}syncDynamic(i,e,t,r,n,s,a,l,o){const d=this,{offsetSize:c}=e,u=s==="auto",h=u?"":null;let[g,f]=n,m=1,p=0,v,b,w;for(w=i;l<=w&&w<o;w+=m){if(b=d.syncSlot(t,r,w,h),v=v||b,p<a){if(p+=b.element[c],u)return d.syncFixed(i,e,t,r,n,iS(a/p));if(m>0){if(w+1<o&&(p<a||f))continue;g+=f,f=0}}if(--f<1){if(m<0||!g)break;m=-1,w=i,f=g}}return v}syncFixed(i,e,t,r,n,s,a,l){const o=this,{shrinkWrap:d,shrinkWrapped:c}=o,u=`${100/s}%`,h=i+s;let g=i-n[0],f=h+n[1],m=0,p,v,b,w,D;for(;f>l;)--g,--f;for(;g<a;)++g,++f;for(D=g;D<f;++D)v=o.syncSlot(t,r,D,d&&!c?"":u),D===i&&(p=v),d?(b||(b=[])).push(v):v[e.size]=u;if(d){for(w=Tm(h,f-n[1]),D=w-s;D<w;++D)m+=b[D-g][e.size];for(v of b)v[e.size]=u;m&&(o.innerCt.style[e.minSize]=`${m}px`,o.shrinkWrapped=!0)}return p}syncSlot(i,e,t,r){const n=this,{propNames:s,syncGen:a}=n,l=r!==null;let o=null,d,c,u,h,g;for(h of i)if(h[Mm]!==a){if(c=h[Ut],c===t){u=h,l&&(u[s.size]=r);break}(!o||c>o[Ut])&&(o=h)}return u||(d=n.configureSlot(t,n,o),o?(u=o,l&&(u[s.size]=r),delete d.type,u.setConfig(d)):(g=d.type?z.resolveType(d.type):e,d=g.mergeConfigs(n.defaults,d),l&&(d[s.size]=r),u=n.add(d),i.push(u),u.ion({thisObj:n,name:`${u.id}-listeners`,focusTrap:"onSlotFocusTrap"})),u[Ut]=t,n.slotSize||(n.slotSize=u[s.size]),u[s.vxy[0]]=t*n.slotSize),u[Mm]=a,u}};y(Ji,"$name","Carousel"),y(Ji,"type","carousel"),y(Ji,"configurable",{atMax:null,atMin:null,configureSlot:(i,e,t)=>({}),disableReserveSlots:null,empty:null,emptyHtml:null,emptyText:"No items to display",firstVisibleSlot:null,lastVisibleSlot:null,range:[null,null],reserveSlots:1,scrollOnTab:null,shrinkWrap:"auto",slots:null,snap:!0,vertical:null}),y(Ji,"delayable",{triggerSlotVisibility:"raf"}),y(Ji,"fenced",{resync:!0}),Ji.initClass(),Ji._$name="Carousel";var bk=i=>!i.value,Qi=class extends rt{static get configurable(){return{inputType:"checkbox",autoCollapse:null,toggleGroupRootElement:null,containerDefaults:{syncableConfigs:{disabled:i=>i.disabled||!i.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:!1,toggleGroup:null,localizableProperties:["label","text"],twinSyncConfigs:{value:"checked"}}}construct(i){"checked"in i&&(i=T.assign({},i),i.value=i.checked,delete i.checked),super.construct(i),this.syncHasText()}updateClearable(){}updateEditable(){}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||"","aria-hidden":!this.text}]}get inputElement(){const i=super.inputElement;return this.toggleGroup&&(i.dataset={group:this.toggleGroup}),i.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},i}get checked(){return this.value}set checked(i){this.value=i}syncHasText(){var i;this.element.classList[this.text?"add":"remove"]("b-text"),(i=this.textLabel)==null||i.setAttribute("aria-hidden",!this.text)}updateText(i){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=i)}afterSyncChildConfigs(i){super.afterSyncChildConfigs(i);let{autoCollapse:e}=this;e&&(e=e===!0?bk:e,i.collapsed=e(this))}assignFieldValue(i,e,t){this.value=t===this.checkedValue||(t===this.uncheckedValue?!1:null)}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(i){var e;const t=this,r=t.value?t.checkedValue:t.uncheckedValue,n=r!==void 0,{valueName:s}=t;n&&(i[s]=r),t.gatherValues(i,n),r===!0&&((e=i[s])==null?void 0:e.value)===r&&delete i[s].value}changeValue(i){return i==="false"?!1:!!i}updateValue(i){var e;const t=this,r=t.input.checked!==i;t.input.checked=i,(e=t.container)==null||e.syncChildConfigs(),r&&!t.inputting&&!t.isConfiguring&&(t.uncheckToggleGroupMembers(),t.triggerChange(!1,null))}get inputValueAttr(){return"checked"}updateColor(i,e){const t=this.element.classList;e&&t.remove(e),i&&t.add(i)}getToggleGroupRootElement(){const i=this.toggleGroupRootElement;let e;return i&&typeof i=="string"&&this.element&&(e=this.element.closest(i)),e||this.rootElement}getToggleGroupMembers(){const i=this,{toggleGroup:e,input:t,type:r}=i,n=[];return e&&E.forEachSelector(i.getToggleGroupRootElement(),`input[type=${r}][data-group=${e}]`,s=>{if(s!==t){const a=z.fromElement(s);a&&n.push(a)}}),n}uncheckToggleGroupMembers(i){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach(e=>{e._propagatingUserActionFrom=this,e.checked=!1,e._propagatingUserActionFrom=null})}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(i){return this.readOnly?(i.preventDefault(),!1):this.trigger("click",{event:i})}internalOnChange(i){const e=this;if(e.readOnly&&e.value!==e.input.checked){e.input.checked=e.value;return}e.value=e.input.checked,e.inputting||(e.inputting=!0,e.triggerChange(!0,i),e.inputting=!1)}updateInputReadOnly(i){}triggerChange(i,e){const t=this,{checked:r}=t.input,n={checked:r,value:r,oldValue:!r,userAction:i,valid:!0,event:e};if(t._propagatingUserActionFrom&&(n.propagatingUserActionFrom=t._propagatingUserActionFrom),!r&&i&&t.toggleGroup&&t.getToggleGroupMembers().filter(a=>a.isVisible&&!a.disabled).length||t.trigger("beforeChange",n)===!1)t.input.checked=t._value=!r;else return t.triggerFieldChange(n,!1),i&&t.uncheckToggleGroupMembers(i),t.trigger("action",n),t.trigger("change",n),!0}configureOverflowTwin(i){const e=this,t=super.configureOverflowTwin(i);return t.type=z.resolveType("menuitem"),t.text||(t.text=e.label||e.text||e.tooltipText),t}};y(Qi,"$name","Checkbox"),y(Qi,"type","checkbox"),y(Qi,"alias","check"),Qi.initClass(),Qi._$name="Checkbox";var On=class extends Xe.mixin(wm){static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const i=super.bodyConfig,{className:e}=i,{inlineInternal:t,hasLabel:r,title:n}=this;return delete i.html,e["b-inline"]=t,e["b-fieldset-has-label"]=r,n&&(i.children={legendElement:{tag:"legend",text:n,class:{"b-fieldset-legend":1}}}),i}compose(){const{inlineInternal:i,label:e,labelCls:t,labelWidth:r}=this;return{class:{"b-field":e,"b-vbox":!i},children:{"labelElement > headerElement":(e||null)&&{tag:"label",html:e,class:{"b-label":1,"b-align-start":1,[t]:t},style:{width:E.unitize("width",r)[1]}}}}}syncInlineInternal(){var i;this.inlineInternal=(i=this.inline)!=null?i:this.label!=null&&this.labelPosition==="before"}updateDisabled(i,e){super.updateDisabled(i,e),this.eachWidget(t=>{t.disabled=i},!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(i){this.layout.horizontal=i}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}};y(On,"$name","FieldSet"),y(On,"type","fieldset"),y(On,"configurable",{bodyTag:"fieldset",focusable:!1,localizableProperties:["label"],inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}),On.initClass(),On._$name="FieldSet";var ga=class extends Qi{static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(i){super.internalOnClick(i)!==!1&&this.checked&&this.clearable&&(this.checked=!1)}updateName(i){this.toggleGroup=i}updateClearable(){}};y(ga,"$name","Radio"),y(ga,"type","radio"),y(ga,"alias","radiobutton"),ga.initClass(),ga._$name="Radio";var $n=class extends On{triggerPaint(){const i=this,e=!i.isPainted,t=i.__value;super.triggerPaint(...arguments),Y.isFirefox&&i.isVisible&&e&&t!==void 0&&t!==i.value&&(i.value=void 0,i.value=t)}get existingOptions(){const{name:i}=this;return this.ensureItems().filter(e=>e.name===i)}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter(i=>i.input.checked)[0]||null}get value(){const{selected:i}=this;return i?i.checkedValue:null}set value(i){this.existingOptions.forEach(e=>{e.isConfiguring=this.isConfiguring,e.checked=e.checkedValue===i,e.isConfiguring=!1}),Y.isFirefox&&!this.isConnected&&(this.__value=i)}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(i,e){if(!(i&&e&&T.isDeeplyEqual(e,i)))return i}convertOption(i,e,t){const r=this,{name:n}=r,s={name:n,type:r.defaultType,value:r.peekConfig("value"),ref:`${r.refPrefix}${i}`,disabled:r.disabled,checkedValue:i};return typeof e=="string"?s.text=e:T.assign(s,e),t?z.reconfigure(t,s):s}isOurRadio(i){return(i.isRadio||i.isCheckbox)&&i.name===this.name}isolateFieldChange(i){return this.isOurRadio(i)}onChildAdd(i){super.onChildAdd(i),this.isOurRadio(i)&&i.ion({name:i.id,beforeChange:"onItemBeforeChange",change:"onItemChange",click:"onItemClick",thisObj:this})}onChildRemove(i){this.isOurRadio(i)&&this.detachListeners(i.id),super.onChildRemove(i)}onItemClick(i){const{source:e}=i;e.checked&&this.clearable&&e.clearable==null&&(e.checked=!1)}onItemBeforeChange(i){if(i.checked){const e=this,{lastValue:t}=e;if(!e.reverting&&e.trigger("beforeChange",e.wrapRadioEvent(i))===!1&&t!=null&&t!==e.value)return e.reverting=!0,i.source.uncheckToggleGroupMembers(),e.value=t,e.lastValue=t,e.reverting=!1,!1}}onItemChange(i){const e=this;i.checked&&!e.reverting&&(e.triggerFieldChange(e.wrapRadioEvent(i)),e.lastValue=e.value)}wrapRadioEvent(i){return{from:i,item:i.source,userAction:i.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const i=this,{options:e,refPrefix:t}=i,r=i.existingOptions.reduce((o,d)=>(o[d.ref.substring(t.length)]=d,o),{});let n=0,s,a;if(e)for(s in e)a=i.convertOption(s,e[s],r[s]),delete r[s],i.insert(a,n++);const l=Object.values(r);l!=null&&l.length&&(i.remove(l),l.forEach(o=>o.destroy()))}};y($n,"$name","RadioGroup"),y($n,"type","radiogroup"),y($n,"configurable",{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}),$n.initClass(),$n._$name="RadioGroup";var fa=class extends $n.mixin(cd){onItemBeforeChange(i){const e=this,{lastValue:t}=e;if(!e.reverting&&e.trigger("beforeChange",e.wrapRadioEvent(i))===!1&&t!=null&&t!==e.value)return e.reverting=!0,i.source.uncheckToggleGroupMembers(),e.value=t,e.lastValue=t,e.reverting=!1,!1}onItemChange(i){const e=this;e.reverting||(e.triggerFieldChange(e.wrapRadioEvent(i)),e.lastValue=e.value),e.syncInvalid()}get selected(){return this.existingOptions.filter(i=>i.input.checked)||null}get value(){const{selected:i}=this;return i.map(e=>e.checkedValue)}set value(i){i=i||[],typeof i=="string"&&(i=i.split(this.separator)),this.existingOptions.forEach(e=>{e.isConfiguring=this.isConfiguring,e.checked=i.includes(e.checkedValue),e.isConfiguring=!1}),Y.isFirefox&&!this.isConnected&&(this.__value=i)}internalOnChange(){this.syncInvalid()}get inputWrap(){return this.element}get isValid(){let i=!0;const e=this,{selected:t,requiredSelectedOptions:r,minSelectedOptions:n,maxSelectedOptions:s}=e;if(e.clearError(void 0,!0),!e.disabled){const a=isNaN(e.minSelectedOptions)||t.length>=n,l=isNaN(e.maxSelectedOptions)||t.length<=s;r&&t.length!==r?(i=!1,e.setError(e.L("L{wrongNbrOfOptionsSelected}",r),!0)):a?l||(i=!1,e.setError(e.L("L{tooManyOptionsSelected}",s),!0)):(i=!1,e.setError(e.L("L{tooFewOptionsSelected}",n),!0))}return i&&e.errors&&Object.keys(e.errors).length&&(i=!1),i}updateMinSelectedOptions(){this.isConfiguring||this.syncInvalid()}updateMaxSelectedOptions(){this.isConfiguring||this.syncInvalid()}updateRequiredSelectedOptions(){this.isConfiguring||this.syncInvalid()}};y(fa,"$name","CheckboxGroup"),y(fa,"type","checkboxgroup"),y(fa,"configurable",{defaultType:"checkbox",defaults:{color:"b-blue"},separator:",",requiredSelectedOptions:null,minSelectedOptions:null,maxSelectedOptions:null,errorTooltipCachePath:"checkboxGroupErrorTooltip",errorTooltipConfig:{forSelector:".b-checkboxgroup.b-invalid .b-checkbox-label",align:"t-b"}}),fa.initClass(),fa._$name="CheckboxGroup";var pd,er=class extends Xe{construct(i={}){const e=this;e.editorReady=new Promise((t,r)=>{e.resolveEditorReady=t,e.rejectEditorReady=r}),super.construct(...arguments),e.editorReady.then(()=>{le.ion({theme:({theme:t})=>e.editor.updateOptions({theme:t.toLowerCase().includes("dark")?"vs-dark":"vs-light"}),thisObj:e}),e.element.style.setProperty("--vscode-menu-background",getComputedStyle(e.element.querySelector(".monaco-editor")).getPropertyValue("--vscode-menu-background"))})}get monacoInstance(){return globalThis.monaco}focus(){this.editor.focus()}static set monacoLoadPromise(i){pd=i}static get monacoLoadPromise(){return pd}async updateCodePath(i,e){var t;const r=this;e&&((t=r.loaderScript)==null||t.remove()),pd||(pd=new Promise(n=>{const s=()=>{const o=globalThis.require;o.config({paths:{vs:`${i}/min/vs`}}),o(["vs/editor/editor.main"],function(){r.isDestroyed||n(globalThis.monaco)}),l.removeEventListener("error",a),l.removeEventListener("load",s)},a=()=>{const o=`Code editor path to Monaco editor ${i} is incorrect`;l.removeEventListener("error",a),l.removeEventListener("load",s),xi.show(o),r.rejectEditorReady(o)},l=r.loaderScript=E.createElement({tag:"script",parent:document.head,src:`${i}/min/vs/loader.js`});l.addEventListener("error",a),l.addEventListener("load",s)})),globalThis.monaco=await pd,r.getConfig("editor"),r.getConfig("text")}updateReadOnly(i){const{readOnly:e}=this.widgetMap;e&&(e.hidden=!i),this.editor.updateOptions({readOnly:i})}updateStatus(i){const{status:e}=this.widgetMap;e&&(e.html=i)}changeEditor(i,e){var t,r;const n=this;return(t=e==null?void 0:e.dispose)==null||t.call(e),i&&(i=n.monacoInstance.editor.create(n.contentElement,Re.merge({theme:n.theme||(r=E.themeInfo)!=null&&r.name.toLowerCase().includes("dark")?"vs-dark":"vs-light",padding:{top:14}},i)),n.monacoInstance.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0}),i.onDidChangeCursorPosition(n.onCursorMove.bind(n)),i.onDidChangeConfiguration(n.onEditorConfigChange.bind(n)),i.onDidDispose(n.onEditorDestroy.bind(n)),n.resolveEditorReady(i)),i}get text(){var i;return((i=this.codeModel)==null?void 0:i.getValue())||this._text}changeText(i){var e;return this._text=(e=this.codeModel)==null?void 0:e.getValue(),i}updateText(i){var e,t;const{codeModel:r}=this;i!=null?r?r.setValue(i):this.loadText(i):(t=(e=this.codeModel)==null?void 0:e.dispose)==null||t.call(e)}async loadText(i=this.text,e=this.language){var t;const r=this;r._text=i,r._language=e,(t=r.codeModel)==null||t.dispose(),await r.editorReady;const n=r.codeModel=r.monacoInstance.editor.createModel(i,e);return r.editor.setModel(n),r.trigger("load",{model:n,text:i}),n}onEditorDestroy(){var i,e;(e=(i=this.codeModel)==null?void 0:i.dispose)==null||e.call(i),this.codeModel=null}onEditorConfigChange(){const i=this;i.editor&&(i.readOnly=i.editor.getOptions().get(i.monacoInstance.editor.EditorOptions.readOnly.id))}onCursorMove({position:i}){var e;(e=this.widgetMap.cursorPos)==null||e.setPosition(i)}};y(er,"$name","CodeEditor"),y(er,"type","codeeditor"),y(er,"configurable",{textContent:!1,scrollable:null,codePath:null,editor:{$config:["lazy","nullify"],value:{automaticLayout:!0,scrollBeyondLastLine:!1}},header:{cls:"demo-header"},bbar:{overflow:null,items:{readOnly:{hidden:!0,type:"widget",cls:"b-icon b-icon-locked"},status:{type:"widget",html:"\xA0"},cursorPos:{type:"widget",html:"\xA0",setPosition({lineNumber:i,column:e}){this.element.innerHTML=`Ln ${i}, Col ${e}`}}}},readOnly:null,text:{$config:["lazy","nullify"],value:null},language:null,theme:null,status:null}),er.initClass(),er._$name="CodeEditor";var Hn=class extends jt{configure(i){super.configure(i),this.setItems(),this.ion({item:"onColorSelect"})}setItems(){const i=this,{colors:e,colorClasses:t}=i;let r=e||t;i.addNoColorItem&&(i.store.modelClass.allowNullId=!0,r=[...r,null]),i.items=r.map(n=>!n||typeof n=="string"?{color:n,text:(t?O.capitalize(n):n)||i.L("L{noColor}")}:n)}afterConfigure(){var i;super.afterConfigure(...arguments),(this.addNoColorItem||this.value)&&this.select((i=this.value)!=null?i:null)}updateColors(){this.isConfiguring||this.setItems()}updateAddNoColorItem(){this.isConfiguring||this.setItems()}onColorSelect({record:i}){var e;this.refresh();const t={color:i.color,record:i,bubbles:!0};(e=this.colorSelected)==null||e.call(this,t),this.trigger("colorSelected",t)}select(i){(!i||typeof i=="string")&&(i=this.store.findRecord("color",i!=null?i:null)),i&&super.select(i)}updateColumns(i){this.style=`grid-template-columns:repeat(${i}, 1fr);`}getColorClassName(i){var e,t;return(e=this.colorClasses)!=null&&e.includes(i)||(t=this.colorClasses)!=null&&t.find(r=>r&&r.color===i)?this.colorClassPrefix+i:i?"":"b-no-color"}};y(Hn,"$name","ColorPicker"),y(Hn,"type","colorpicker"),y(Hn,"configurable",{itemsFocusable:!1,navigator:{focusCls:"b-color-active"},itemWrapperTpl(i,e){const{selected:t}=this,{color:r,text:n}=i,s=this.getColorClassName(r);return Pt.tpl`
                    <li
                        class="${this.getItemClasses(i,e)} ${s}"
                        role="option"
                        aria-selected="${t.includes(i)}"
                        data-index="${e}"
                        data-id="${O.encodeHtml(r)}"
                        data-btip="${n}"
                        ${this.itemsFocusable?'tabindex="-1"':""}
                        style="${s?"":"background-color: "+r}"
                    ></li>`},colorClasses:null,colorClassPrefix:null,colors:["#45171D","#F03861","#FF847C","#FECEA8","#A5F2E7","#AA83F3","#8983F3","#A10054","#073059","#2866AB","#5FBDC5","#D8D95C","#FFDEDE","#F7F3CE","#C5ECBE","#3E3E3E","#405559","#68868C","#EDEDED","#D3D6DB","#3A4750","#303841","#BE3144"],addNoColorItem:!0,columns:6,colorSelected:null,store:{useRawData:!1}}),Hn.initClass(),Hn._$name="ColorPicker";var Vn=class extends Ze{configure(i){var e;const t=(e=i.picker)!=null?e:{};i.colors&&(t.colors=i.colors),"addNoColorItem"in i&&(t.addNoColorItem=i.addNoColorItem),i.picker=t,super.configure(i)}updatePicker(i,e){super.updatePicker(i,e),i&&(this.items=i.store.records)}updateColors(i){this.isConfiguring||(this.picker.colors=i)}updateAddNoColorItem(i){this.isConfiguring||(this.picker.addNoColorItem=i)}set value(i){this.store||(this.items=[],this.store=this.picker.store),i||(i=this.store.findRecord("color",null)),super.value=i}showPicker(){this.picker.refresh(),super.showPicker(...arguments)}get value(){return super.value}syncInputFieldValue(...i){var e;const t=this,{value:r}=t;let n=(e=t.picker)==null?void 0:e.getColorClassName(r);n||(t.colorBox.style.color=r),n="b-colorbox "+n,t.colorBox.className=n,t.showBoxForNoColor||t.element.classList.toggle("b-colorless",!r),super.syncInputFieldValue(...i)}get innerElements(){return[{reference:"colorBox",className:"b-colorbox"},...super.innerElements]}};y(Vn,"$name","ColorField"),y(Vn,"type","colorfield"),y(Vn,"configurable",{displayField:"text",valueField:"color",editable:!1,picker:{type:"colorpicker",align:{align:"t100-b100",matchSize:!1}},showBoxForNoColor:!0,colors:null,addNoColorItem:!0}),Vn.initClass(),Vn._$name="ColorField";var Ck=["ok","cancel","yes","no"].reduce((i,e,t,r)=>(i[e]=Object.freeze({...Object.fromEntries(r.map(n=>[n,!1])),name:e,approve:"ok,yes".includes(e),[e]:!0}),i),Object.create(null)),lS=["b-raised","b-blue"],oS=["b-gray"],dh=Y.isWindows,wk=/(?:\s+,?|,)\s*/,Sk=/^(icon|menu|text)$/,Nn=class extends kn{get buttons(){return this.items.filter(i=>i.isButton)}get cancelButton(){return this.widgetMap.cancel||null}get noButton(){return this.widgetMap.no||null}get okButton(){return this.widgetMap.ok||null}get yesButton(){return this.widgetMap.yes||null}changeItems(i,e){return typeof i=="string"&&(i=Object.fromEntries(i.split(wk).map(t=>[t,!0]))),super.changeItems(i,e)}clickButton(i,e){const t=this,{widgetMap:r,defaultButton:n}=t;let s=e?r.cancel||r.no:r[n],a,l;if(!s){for([l,a]of Object.entries(r))if(l!==n){s=a;break}}s==null||s.onInternalClick(i)}doCancel(i){this.clickButton(i,!0)}doDefault(i){this.clickButton(i)}onButtonClick(i){this.trigger("choice",{...i,choice:Ck[i.source.ref],source:this,userAction:!0})}onChildAdd(i){super.onChildAdd(i),be.before(i,"onConfigChange","onChildConfigChange",this),this.syncButtons()}onChildConfigChange({name:i}){Sk.test(i)&&this.syncButtons()}onChildRemove(i){super.onChildRemove(i),this.syncButtons()}onInternalPaint(i){super.onInternalPaint(i),i.firstPaint&&this.syncButtons.resume(),this.syncButtons.now()}syncButtons(){const i=this,e=i.isDestroying?[]:i.buttons,{defaultButton:t}=i;let r,n;i.syncWidthButtons!==!1&&e.forEach(s=>{(n=s.text)&&(r=Math.max(r||0,n.length+!!s.icon+!!s.menu))}),e.forEach(s=>{const{classList:a}=s.element,l=s.ref===t;a.add(...l?lS:oS),a.remove(...l?oS:lS),a.toggle("b-default-button",l),s.minWidth=r&&s.text?`${r}em`:null})}updateAutoWidthButtons(){this.syncButtons()}updateDefaultButton(){this.syncButtons()}};y(Nn,"$name","ConfirmationBar"),y(Nn,"type","confirmationbar"),y(Nn,"configurable",{defaultButton:"ok",defaultType:"button",items:"ok,cancel",keyMap:{Enter:"doDefault",NumpadEnter:"doDefault",Escape:"doCancel"},namedItems:{yes:{cls:"b-yes-button",text:"L{Object.Yes}",onClick:"up.onButtonClick",weight:dh?100:130},no:{cls:"b-no-button",text:"L{Object.No}",onClick:"up.onButtonClick",weight:dh?110:120},ok:{cls:"b-ok-button",text:"L{Object.Ok}",onClick:"up.onButtonClick",weight:dh?120:110},cancel:{cls:"b-cancel-button",text:"L{Object.Cancel}",onClick:"up.onButtonClick",weight:dh?130:100}},syncWidthButtons:null}),y(Nn,"delayable",{syncButtons:{type:"raf",suspended:!0}}),Nn.initClass(),Nn._$name="ConfirmationBar";var Pr=class extends Xe{construct(i){super.construct({month:new Date().getMonth(),...i}),V.on({element:this.contentElement,click:"onMonthClick",delegate:".b-monthpicker-month",thisObj:this})}get focusElement(){return this.getMonthButton(this.month)}getMonthButton(i){return this.contentElement.querySelector(`.b-monthpicker-month[data-month="${i}"]`)}onMonthClick({target:i}){const e=parseInt(i.getAttribute("data-month"));this.month===e?this.trigger("select",{oldValue:e,value:e}):this.month=e}handleTitleClick(i){this.trigger("titleClick",i)}changeMonth(i){if(!isNaN(i))return T.isDate(i)?i.getMonth():i>=0&&i<=11?i:void 0}updateMonth(i,e){this.isConfiguring||this.trigger("select",{oldValue:e,value:i})}composeBody(){this.getConfig("month");const i=super.composeBody(),e=i.children[this.tbar?1:0].children=[];this.widgetMap.title.text=C.getMonthName(this.month);for(let t=0;t<=11;t++)e.push({tag:"button",dataset:{month:t},class:{"b-monthpicker-month":1,"b-selected":t===this.month},text:C.getMonthShortName(t)});return i}async updateLocalization(){this.isConfiguring||await this.recompose(),super.updateLocalization()}};y(Pr,"$name","MonthPicker"),y(Pr,"type","monthpicker"),y(Pr,"configurable",{textContent:!1,tbar:{overflow:null,items:{title:{type:"button",cls:"b-monthpicker-title",onAction:"up.handleTitleClick"}}},itemCls:"b-month-container",month:null}),Pr.initClass(),Pr._$name="MonthPicker";var Or=class extends Xe{construct(i){super.construct({year:new Date().getFullYear(),...i}),V.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(i){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${i}"]`)}get value(){return this.year}set value(i){this.year=i}onYearClick({target:i}){const e=Math.min(Math.max(parseInt(i.innerText),this.minYear||1),this.maxYear||9999);this.year===e?this.trigger("select",{oldValue:e,value:e}):this.year=e}handleTitleClick(i){this.trigger("titleClick",i)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(i){if(!isNaN(i))return T.isDate(i)?i.getFullYear():i}changeYear(i){if(i=this.ingestYear(i))return Math.min(Math.max(i,this.minYear||1),this.maxYear||9999)}updateYear(i,e){const t=this;!t.startYear||i>t.endYear?t.startYear=i:i<t.startYear&&(t.startYear=i-(t.yearButtonCount-1)),t.isConfiguring||t.trigger("select",{oldValue:e,value:i})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(i){if(i=this.ingestYear(i))return i=this.minYear?Math.max(i,this.minYear):i,this.maxYear?Math.min(i,this.maxYear-(this.yearButtonCount-1)):i}async updateStartYear(i,e){this.isVisible&&E.slideIn(this.contentElement,Math.sign(i-e))}composeBody(){this.getConfig("year");const{startYear:i}=this,e=super.composeBody(),t=e.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${i}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let r=0,n=i;r<this.yearButtonCount;r++,n++)t.push({tag:"button",dataset:{year:n},class:{"b-yearpicker-year":1,"b-selected":n===this.year},text:`000${n}`.slice(-4)});return e}};y(Or,"$name","YearPicker"),y(Or,"type","yearpicker"),y(Or,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),Or.initClass(),Or._$name="YearPicker";var ma=class extends oi{static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):O.encodeHtml(this.value)}}};y(ma,"$name","DisplayField"),y(ma,"type","displayfield"),y(ma,"alias","display"),ma.initClass(),ma._$name="DisplayField";var dS=(i,e)=>i.valueOf()-e.valueOf(),{DateSet:ch}=C,Dk=Object.freeze([]),Ek=i=>i.every((e,t)=>!t||!(C.add(i[t-1],1,"d")-e)),Fi=class extends ki{static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{$config:"date",value:"today"},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first b-datepicker-nav-button",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}",weight:100},prevMonth:{cls:"b-icon b-icon-previous b-datepicker-nav-button",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}",weight:200},fields:{type:"container",cls:"b-datepicker-title",items:{monthButton:{type:"button",cls:"b-datepicker-monthbutton",internalListeners:{click:"up.onMonthPickerRequested"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}},weight:300},nextMonth:{cls:"b-icon b-icon-next b-datepicker-nav-button",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}",weight:400},nextYear:{cls:"b-icon b-icon-last b-datepicker-nav-button",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}",weight:500}}},monthPicker:{value:{type:"MonthPicker",trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onMonthPickerTitleClick",select:"up.onMonthPicked",Escape:"up.onMonthPickerTitleClick"}},$config:"lazy"},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{$config:"date",value:null},maxDate:{$config:"date",value:null},focusDisabledDates:null,multiSelect:null,selection:{$config:{equal:(i,e)=>i&&i.equals(e)},value:null},editMonth:{$config:"lazy",value:null},includeYear:{$config:"lazy",value:null},dayNameFormat:"dd",trapFocus:!0,ariaElement:"weeksElement",focusDescendant:!0,alwaysRefreshOnMonthChange:null,highlightSelectedWeek:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(i){const e=this;super.construct(i);const{widgetMap:t}=e;e.externalCellRenderer=e.cellRenderer,e.cellRenderer=e.internalCellRenderer,e.element.removeAttribute("tabindex"),e.ariaElement.setAttribute("aria-activedescendant",`${e.id}-active-day`),t.fields&&!e.ariaLabel&&e.element.setAttribute("aria-labelledby",t.fields.id),V.on({element:e.weeksElement,click:{handler:"onCellClick",delegate:`.${e.dayCellCls}:not(.${e.disabledCls}):not(.${e.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${e.dayCellCls}`},thisObj:e}),e.getConfig("editMonth"),e.getConfig("includeYear"),e.refresh.flush()}get labelledElement(){return this.element}afterHide(){var i,e;(i=this._monthPicker)==null||i.hide(),(e=this._yearPicker)==null||e.hide(),super.afterHide(...arguments)}doDestroy(){var i,e;(i=this.yearButton)==null||i.destroy(),(e=this.monthButton)==null||e.destroy(),super.doDestroy()}get activeDayCell(){return this.weeksElement.querySelector(`#${this.id}-active-day`)}get focusElement(){return!this.disabled&&this.activeDayCell||this.element}onMonthDateChange(i){const e=super.onMonthDateChange(i);return this.ariaElement.setAttribute("aria-label",C.format(this.date,"MMMM YYYY")),this.refresh.flush(),e}updateEditMonth(i){const{monthButton:e,yearButton:t}=this.widgetMap,r=i===!1;e&&(e.readOnly=r),t&&(t.disabled=r)}updateIncludeYear(i){const{yearButton:e}=this.widgetMap;e&&(e.hidden=i===!1)}updateReadOnly(i){i?this.element.setAttribute("inert",!0):this.element.removeAttribute("inert")}doRefresh(...i){const e=this,{date:t,widgetMap:r}=e,n=e.activeDayCell,s=C.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=t;e.getConfig("tbar"),super.doRefresh(...i),r.monthButton&&(r.monthButton.text=e.constructor._monthNames[t.getMonth()]),r.yearButton&&(r.yearButton.text=t.getFullYear());const a=C.parseKey(n==null?void 0:n.dataset.date);s-a&&e.syncActiveDate(s,a)}internalCellRenderer({cell:i,date:e}){const t=this,{externalCellRenderer:r}=t,n=t.isSelectedDate(e),s=t.getCellClassList(...arguments);if(n&&t.multiSelect){const a=!t.isSelectedDate(C.add(e,-1,"d")),l=!t.isSelectedDate(C.add(e,1,"d"));s["b-range-start"]=a,s["b-range-end"]=l,s["b-in-range"]=!a&&!l}E.updateClassList(i,s),i.innerHTML=`<div class="b-datepicker-cell-inner">${e.getDate()}</div>`,i.setAttribute("role","gridcell"),i.setAttribute("aria-label",C.format(e,"dddd MMMM Do, YYYY")),E.toggleAttribute(i,"aria-selected",n),t.isActiveDate(e)?i.id=`${t.id}-active-day`:i.removeAttribute("id"),r&&(arguments[0].cell=i.firstChild,t.callback(r,this,arguments))}getCellClassList({date:i}){const e=this,{activeCls:t,selectedCls:r}=e;return{[t]:t&&e.isActiveDate(i),[r]:e.isSelectedDate(i),[e.outOfRangeCls]:e.minDate&&i<e.minDate||e.maxDate&&i>e.maxDate}}onCellMousedown(i){const e=i.target.closest("[data-date]");this.focusable?(e.focus(),E.getActiveElement(e)===e&&i.preventDefault()):i.preventDefault(),this.activeDate=C.parseKey(e.dataset.date)}onCellClick(i){const e=i.target.closest("[data-date]");this.onUIDateSelect(C.parseKey(e.dataset.date),i)}onUIDateSelect(i,e){const t=this,{lastClickedDate:r,multiSelect:n}=t;t.isDisabledDate(i)||t.trigger("beforeDateSelect",{date:i,event:e})!==!1&&(t.lastClickedDate=i,t.activatingEvent=e,n?t.handleMultiSelect(r,i,e):(t.date=t.selection=i,t.floating&&t.hide()),t.activatingEvent=null)}handleMultiSelect(i,e,t){const r=this,{multiSelect:n}=r,s=r._selection||(r._selection=new ch),a=s.dates,l=n==="range"||n==="simple",o=n==="simple"||E.isTouchEvent,{size:d,generation:c}=s,u=d&&{[C.makeKey(C.add(a[0],-1,"d"))]:1,[C.makeKey(a[0])]:1,[C.makeKey(a[a.length-1])]:1,[C.makeKey(C.add(a[a.length-1],1,"d"))]:1},h=s.has(e),g=h?"delete":"add",f=l&&(u==null?void 0:u[C.makeKey(e)]);if(o&&d>1)s.clear(),s.add(e);else if(t.ctrlKey)(n===!0||!d||f)&&(s[g](e),l&&!s.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(e<a[1]?1:-1)));else if((o||t.shiftKey)&&d){const[p,v]=[new Date(l?r.rangeStartDate||(r.rangeStartDate=a[0]):i),e].sort(dS);l&&s.clear();for(const b=p;b<=v;b.setDate(b.getDate()+1))s.add(b)}else s.has(e)&&s.size===1||(s.clear(),s.add(e));const m=s.size;m===1?r.rangeStartDate=e:m||(r.rangeStartDate=null),s.generation!==c&&r.updateSelection(s)}updateHighlightSelectedWeek(i){this.element.classList.toggle("b-highlight-selected-week",!!i)}updateMultiSelect(i){this.element.classList.toggle("b-multiselect",!!i),i||(this.selection=[...this.selection][0])}get selection(){const{_selection:i}=this,e=i?i.dates:Dk;return this.multiSelect==="range"&&e.length?[e[0],e[e.length-1]]:e}getRange(i){if(this.multiSelect){const{selection:e}=this,t=e[0],r=e[e.length-1];if(e.length>1&&C.add(r,1,"d").getDate()===t.getDate())return{unit:"month",magnitude:C.diff(t,C.add(r,1,"d"),"month"),wholeMonth:t.getDate()===1&&r.getDate()===C.getLastDateOfMonth(r).getDate()&&Ek(e),startDate:t,endDate:r};if(t.getDay()==C.weekStartDay&&r.getDay()===(C.weekStartDay+6)%7)return{unit:"week",magnitude:C.diff(t,C.add(r,1,"d"),"week"),startDate:t,endDate:r};if(i){const n=Math.max(Math.ceil(C.diff(t,C.add(r,1,"d"),"w")),1),s=(t.getDay()-C.weekStartDay+7)%7,a=C.add(t,-s,"d"),l=C.add(a,n*7-1,"d");return{unit:"week",magnitude:n,startDate:a,endDate:l}}return{unit:"day",magnitude:C.diff(t,r,"d")+1,startDate:t,endDate:r}}}get snappedRange(){}changeSelection(i,e){const t=this;let r,n;if(!i)r=new ch;else if(i.isDateSet){if(e===i||e!=null&&e.equals(i))return e;n=T.first(i),r=i}else if(i.forEach||(i=[i]),i.forEach((s,a)=>i[a]=t.changeDate(s)),n=i[0],i.sort(dS),t.multiSelect==="range"&&i.length===2){r=new ch;for(const s=new Date(i[0]);s<=i[1];s.setDate(s.getDate()+1))r.add(s)}else n=i[0],r=new ch(i);return n&&(t.rangeStartDate=C.clearTime(n)),r}updateSelection(i,e){const t=this,{multiSelect:r}=t,{dates:n}=i,s=r==="range"?[n[0],n[n.length-1]]:n;if(!t.isConfiguring){!r&&n.length&&!t.peekConfig("date")&&n[0].getMonth()===t.month.month&&(t.date=n[0]),t.refresh.now();const a={selection:s,userAction:!!t.activatingEvent};if(e){const{dates:l}=e;a.oldSelection=r==="range"?[l[0],l[l.length-1]]:l}t.trigger("selectionChange",a)}}isSelected(i){return this.selection.some(e=>C.isSameDate(e,i))}onInternalKeyDown(i){const e=this,t=i.key.trim()||i.code,r=e.activeDate;let n=new Date(r);if(t==="Escape"){if(e.monthPicker.isVisible)return e.monthPicker.hide();if(e.yearPicker.isVisible)return e.yearPicker.hide();if(e.floating)return e.hide()}if(r&&e.weeksElement.contains(i.target)){do switch(t){case"ArrowLeft":i.preventDefault(),i.ctrlKey?n=e.gotoPrevMonth():n.setDate(n.getDate()-1);break;case"ArrowUp":i.preventDefault(),n.setDate(n.getDate()-7);break;case"ArrowRight":i.preventDefault(),i.ctrlKey?n=e.gotoNextMonth():n.setDate(n.getDate()+1);break;case"ArrowDown":i.preventDefault(),n.setDate(n.getDate()+7);break;case"Enter":return e.onUIDateSelect(r,i)}while(e.isDisabledDate(n)&&!e.focusDisabledDates);if(e.minDate&&n<e.minDate||e.maxDate&&n>e.maxDate)return;e.activeDate=n}}changeMinDate(i){return i&&ki.prototype.changeDate.apply(this,arguments)}updateMinDate(i){this._yearPicker&&(this._yearPicker.minYear=i==null?void 0:i.getFullYear()),this.refresh()}changeMaxDate(i){return i&&ki.prototype.changeDate.apply(this,arguments)}updateMaxDate(i){this._yearPicker&&(this._yearPicker.maxYear=i==null?void 0:i.getFullYear()),this.refresh()}changeDate(i){return C.clamp(super.changeDate(i),this.minDate,this.maxDate)}updateDate(i,e){const t=this,{month:r}=t;if(t.isConfiguring&&!t.initializingActiveDate&&("selection"in t.initialConfig||(t.selection=i),"activeDate"in t.initialConfig||(t.activeDate=i)),!r.date||i.getMonth()===r.month||!t.getCell(i)||t.alwaysRefreshOnMonthChange||t.isNavigating)super.updateDate(i);else{const n=r.getOtherMonth(i),s=t.eventListeners&&(e?i.getDate()!==e.getDate()|(n.getWeekId(i)!==r.getWeekId(e))<<1|(i.getMonth()!==(e==null?void 0:e.getMonth()))<<2|(i.getFullYear()!==(e==null?void 0:e.getFullYear()))<<3:15);t.trigger("dateChange",{changes:{d:!0,w:!!(s&2),m:!!(s&12),y:!!(s&8),r:n.weekCount!==r.weekCount},value:i,oldValue:e})}}changeActiveDate(i,e){const t=this;if(i==="today"&&(i=new Date),t.trigger("beforeActiveDateChange",{activeDate:i,oldActiveDate:e})!==!1){if(i=i?t.changeDate(i):t.date||(t.date=C.clearTime(new Date)),isNaN(i))throw new Error("DatePicker activeDate must be passed a Date, or a YYYY-MM-DD date string");return C.clamp(i,t.minDate,t.maxDate)}}updateActiveDate(i,e){const t=this,{isConfiguring:r}=t;(r||!t.getCell(i))&&(t.initializingActiveDate=r,t.date=i,t.initializingActiveDate=!1),!r&&!t.refresh.isPending&&t.syncActiveDate(i,e)}syncActiveDate(i,e){const t=this,{activeCls:r}=t,n=t.getCell(i),s=e&&t.getCell(e),a=E.getActiveElement(t.element);n&&(t.focusable&&n.setAttribute("tabIndex","0"),r&&n.classList.add(r),n.id=`${t.id}-active-day`,t.weeksElement.contains(a)&&n.focus()),s&&s!==n&&(t.focusable&&s.removeAttribute("tabIndex"),r&&s.classList.remove(r),s.removeAttribute("id"))}set value(i){const e=this,{selection:t,duration:r}=e;if(e.isNavigating=!0,i){if(i=e.changeDate(i,e.value),e.multiSelect==="range"&&(t==null?void 0:t.length)===2){C.betweenLesserEqual(i,...t)||(i<t[0]?e.selection=[i,C.add(i,r-1,"d")]:e.selection=[C.add(i,-(r-1),"d"),i]),e.date=e.activeDate=i;return}i!==void 0&&(e.selection=i,e.date=e.activeDate=i)}else e.date=e.activeDate=new Date,e.selection=null;e.isNavigating=!1}get value(){const{selection:i}=this,e=(i==null?void 0:i.length)||null;return e&&i[e-1]}get duration(){return this.multiSelect==="range"?C.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(i,e){const t=this,{activeDate:r}=t,n=r&&t.getCell(r);let s;return e==="month"&&n&&(r==null?void 0:r.getMonth())===t.month.month+i?s=r:s=C.add(n?r:t.date,i,e),t.gotoDate(s,i,n)}gotoDate(i,e,t=this.activeDate&&this.getCell(this.activeDate)){const r=this,n=new Date(i);n.setDate(1);const s=C.add(C.add(n,1,"month"),-1,"day");if(r.minDate&&e<0&&s<r.minDate||r.maxDate&&e>0&&n>r.maxDate)return;r.isNavigating=!0;const a=r.date=i;return r.widgetMap.monthButton.text=r.constructor._monthNames[i.getMonth()],t&&(r.activeDate=i),r.isNavigating=!1,a}isActiveDate(i){return!(i-this.activeDate)}isSelectedDate(i){var e;return(e=this._selection)==null?void 0:e.has(i)}onFocusIn(i){var e;super.onFocusIn(i),i.toWidget===this&&i._target===this.element&&!this.disabled&&((e=this.focusElement)==null||e.focus())}onMonthPickerRequested(){const{monthPicker:i}=this;i.isVisible?i.hide():(i.month=this.activeDate.getMonth(),i.show(),i.focus())}onYearPickerRequested(){const{yearPicker:i}=this;i.isVisible?i.hide():(i.year=i.startYear=this.activeDate.getFullYear(),i.show(),i.focus())}onMonthPickerTitleClick(){this.monthPicker.hide()}onYearPickerTitleClick(){this.yearPicker.hide()}onMonthPicked({value:i,source:e}){var t;const r=this;r.gotoDate(C.add(r.activeDate,i-r.activeDate.getMonth(),"month")),r.widgetMap.monthButton.text=r.constructor._monthNames[r.activeDate.getMonth()],(t=r.focusElement)==null||t.focus({preventScroll:!0}),e.hide()}onYearPicked({value:i,source:e}){var t;const r=new Date(this.activeDate);r.setFullYear(i),this.activeDate=r,(t=this.focusElement)==null||t.focus({preventScroll:!0}),e.hide()}changeMonthPicker(i,e){return Pr.reconfigure(e,i?Pr.mergeConfigs({owner:this,appendTo:this.element},i):null,this)}changeYearPicker(i,e){var t,r;return Or.reconfigure(e,i?Or.mergeConfigs({owner:this,appendTo:this.element,minYear:(t=this.minDate)==null?void 0:t.getFullYear(),maxYear:(r=this.maxDate)==null?void 0:r.getFullYear()},i):null,this)}get childItems(){const{_yearPicker:i,_monthPicker:e}=this,t=super.childItems;return i&&t.push(i),e&&t.push(e),t}updateLocalization(){var i;const e=this,{monthButton:t}=e.widgetMap,r=e.constructor._monthNames=C.getMonthNames();t&&!e.isConfiguring&&(t.text=r[(i=e.monthPicker.month)!=null?i:e.date.getMonth()]),super.updateLocalization()}changeMultiSelect(i){return i==="range"&&Y.isTouchDevice&&(i="simple"),i}};y(Fi,"$name","DatePicker"),y(Fi,"type","datepicker"),y(Fi,"_monthNames",C.getMonthNames()),Fi.initClass(),Fi._$name="DatePicker";var xk=new Date,Ii=class extends Ln{changePicker(i,e){var t;if(i!=null&&i.isDatePicker)return i;const r=this,n=Fi.mergeConfigs({owner:r,forElement:r.pickerAlignElement,minDate:r.min,maxDate:r.max,weekStartDay:r._weekStartDay,align:{anchor:r.overlayAnchor,target:r.pickerAlignElement},internalListeners:{selectionChange:"onPickerSelectionChange",thisObj:r}},i);r.calendarContainerCls&&(n.cls=r.calendarContainerCls),r.value?n[r.isValid?"value":"activeDate"]=r.value:n.activeDate||(n.activeDate=new Date);const s=Fi.reconfigure(e,i?n:null,r);return(t=s==null?void 0:s.refresh)==null||t.flush(),s}onPickerSelectionChange({selection:i,source:e}){if(e.isVisible){const t=this,r=i.length?t.value?C.copyTimeValues(new Date(i[0]),t.value):new Date(i[0]):null;t._isUserAction=t._isPickerInput=!0,t.value=r,t._isPickerInput=t._isUserAction=!1,e.hide()}}getStepDate(i){const{step:e}=this;return C.add(this.value,(i||1)*e.magnitude,e.unit)}stepDate(i,e=!0){const t=this;if(!t.readOnly&&t.value){const r=t.getStepDate(i);t.checkMinMax(r)||(e?(t._isUserAction=!0,t.value=r,t.autoSelect&&t.select(),t._isUserAction=!1):t.value=r)}}onBackClick(){this.stepDate(-1)}onForwardClick(){this.stepDate(1)}showPicker(i){if(this.readOnly)return;const e=this,{_picker:t}=e;if(t){const r={minDate:e.min,maxDate:e.max};e.value?r[e.isValid?"value":"activeDate"]=e.value:t.activeDate||(r.activeDate=new Date),t.setConfig(r)}super.showPicker(i)}focusPicker(){var i;(i=this.picker)==null||i.focus()}checkMinMax(i){const{min:e,max:t}=this;return e&&i<e?-1:t&&i>t?1:0}get isValid(){const i=this;i.clearError("L{Field.minimumValueViolation}",!0),i.clearError("L{Field.maximumValueViolation}",!0);let{value:e}=i;if(e){let{min:t,max:r,validateDateOnly:n}=i;if(n&&(e=C.clearTime(e,!1),t&&(t=C.clearTime(t,!1)),r&&(r=C.clearTime(r,!1))),t&&e<t)return i.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&e>r)return i.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(i,e=!0){const t=this;return i!=null&&(C.isDate(i)||(typeof i=="string"?i=C.parse(i,t.format,t.strictParsing)||C.parse(i,t.fallbackFormat,t.strictParsing):i=new Date(i)),C.isValidDate(i))?e&&(!t.min||i-t.min>-C.MS_PER_DAY)&&(!t.max||i<=t.max)?t.transformTimeValue(i):i:null}isTimeValue(i){return i&&i!==!0&&i!=="entered"}transformTimeValue(i){const e=this,{keepTime:t}=e;if(i=C.clone(i),!t)C.clearTime(i,!1);else if(e.isTimeValue(t)){const r=C.parse(t,e.timeFormat);C.copyTimeValues(i,r)}else t===!0&&(e._isPickerInput||e.inputting)&&C.isValidDate(e.value)&&C.copyTimeValues(i,e.value);return i}changeMin(i){return this.transformDateValue(i,!1)}updateMin(i){const{input:e,_picker:t}=this;e&&(i==null?e.removeAttribute("min"):e.min=i),t&&(t.minDate=i),this.syncInvalid()}changeMax(i){return this.transformDateValue(i,!1)}updateMax(i){const{input:e,_picker:t}=this;e&&(i==null?e.removeAttribute("max"):e.max=i),t&&(t.maxDate=i),this.syncInvalid()}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:C.weekStartDay}updateWeekStartDay(i){this._picker&&(this._picker.weekStartDay=i)}changeValue(i,e){const t=this,r=t.transformDateValue(i),n=t.L("L{invalidDate}")(C.format(xk,t.format));if(i&&!r){(!t.inputting||t.validateOnInput)&&t.setError(n);return}if(t.clearError(n),t.hasChanged(e,r))return super.changeValue(r,e);t.inputting||t.syncInputFieldValue()}updateValue(i,e){const t=this._picker;t&&(t.value=i,this.inputting||(t.activeDate=i)),super.updateValue(i,e)}changeStep(i,e){const t=typeof i;if(!i)return null;if(t==="number"?i={magnitude:Math.abs(i),unit:e?e.unit:"day"}:t==="string"&&(i=C.parseDuration(i)),i&&i.unit&&i.magnitude)return i.magnitude<0&&(i={magnitude:-i.magnitude,unit:i.unit}),i}updateStep(i){this.element.classList[i?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(i,e){return i!=null&&i.getTime&&(e!=null&&e.getTime)&&(!this.keepTime||this.isTimeValue(this.keepTime))?!C.isEqual(C.clearTime(i),C.clearTime(e)):super.hasChanged(i&&i.getTime(),e&&e.getTime())}get inputValue(){const i=this.value;return i?C.format(i,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(i){var e;if(super.internalOnKeyEvent(i),i.type==="keydown"){const t=this;let r;switch(i.virtualKey){case"Enter":t.isValid&&((e=t.picker)==null||e.hide());break;case"ArrowLeft":(t.caretAtStart||t.selectedAll)&&(r=-1);break;case"ArrowRight":(t.caretAtEnd||t.selectedAll)&&(r=1);break;case"NumpadAdd":r=1;break;case"NumpadSubtract":r=-1;break}r&&t.step&&(t.stepDate(r),t.selectAll(),i.preventDefault())}}};y(Ii,"$name","DateField"),y(Ii,"type","datefield"),y(Ii,"alias","date"),y(Ii,"configurable",{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger b-step-trigger-back",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger b-step-trigger-forward",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:{$config:null,default:!0},weekStartDay:null,picker:{type:"datepicker",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null,role:"combobox"}),Ii.initClass(),Ii._$name="DateField";var Rk=Array.from(Array(24)).map((i,e)=>({id:e,text:String(e+100).slice(1)})),Tk=Array.from(Array(60)).map((i,e)=>({id:e,text:String(e+100).slice(1)})),Bn=class extends Xe{alignTo(){const{widgetMap:i}=this,{minute:e,second:t}=this.owner.input;return this.getConfig("is24Hour"),this.minimizeHeight&&(i.hour.maxHeight=i.second.maxHeight=i.minute.height),i.minute[e?"show":"hide"](),i.second[t?"show":"hide"](),super.alignTo(...arguments)}updateIs24Hour(i){this.widgetMap.hour.store.filter(e=>i?!0:e.id<12)}updateStep(i){i=C.as("m",i.magnitude,i.unit);const e=[];for(let t=0;t<60;t+=i)e.push({id:t,text:String(100+t).slice(1)});this.widgetMap.minute.store.data=e}onSelectionChange({source:i,selected:[e]}){const t=this;t._isUserAction=i._isUserAction,i.navigator.activeItem=e,t.updatingValue||t.owner.input.setSubFieldValue(i.ref,e.id),t._isUserAction=!1}triggerTimeChange(i){this.trigger("timeChange",{time:i})}updateInitialValue(i){this.value=i}changeValue(i){return i&&(i=typeof i=="string"?C.parse(i,this.format):i),i!=null?i:C.getTime(0)}updateValue(i){const e=this,{hour:t,minute:r,second:n}=e.widgetMap,s=i.getHours(),a=e.is24Hour?s:s%12,l=i.getMinutes(),o=i.getSeconds();e.updatingValue=!0,t.navigator.activeItem=new Number(a),t.select(a,!0),r.navigator.activeItem=new Number(l),r.select(l,!0),n.navigator.activeItem=new Number(o),n.select(o,!0),e.updatingValue=!1,r.store.filter(),n.store.filter(),e.isVisible&&e.triggerTimeChange(i)}changeMin(i){return typeof i=="string"?C.parse(i,this.format):i}updateMin(i){const{hour:e,minute:t,second:r}=this.widgetMap,{owner:n,is24Hour:s}=this;if(i){const a=i.getHours(),l=i.getMinutes(),o=i.getSeconds();e.store.filter({id:"min-filter",filterBy:({id:d})=>(!s&&n.value.getHours()>=12&&(d+=12),d>=a)}),t.store.filter({id:"min-filter",filterBy:({id:d})=>n.value.getHours()===a?d>=l:!0}),r.store.filter({id:"min-filter",filterBy:({id:d})=>n.value.getMinutes()===l?d>=o:!0})}else e.store.removeFilter("min-filter"),t.store.removeFilter("min-filter"),r.store.removeFilter("min-filter")}changeMax(i){return typeof i=="string"?C.parse(i,this.format):i}updateMax(i){const{hour:e,minute:t,second:r}=this.widgetMap;if(i){const n=i.getHours(),s=i.getMinutes(),a=i.getSeconds();e.store.filter({id:"max-filter",filterBy:({id:l})=>l<=n}),t.store.filter({id:"max-filter",filterBy:({id:l})=>l<=s}),r.store.filter({id:"max-filter",filterBy:({id:l})=>l<=a})}else e.store.removeFilter("max-filter"),t.store.removeFilter("max-filter"),r.store.removeFilter("max-filter")}};y(Bn,"$name","TimePicker"),y(Bn,"type","timepicker"),y(Bn,"configurable",{floating:!0,layout:"hbox",defaults:{type:"list",displayField:"id",itemTpl(i){const e=i.id,t=this.ref!=="hour"||this.owner.is24Hour||e?e:12;return String(t+100).slice(1)},itemCls:"b-timepicker-item",itemsFocusable:!1,scrollable:{overflowY:"hidden-scroll"},onSelectionChange:"up.onSelectionChange",navigator:{activateOnMouseover:!0}},items:{hour:{items:Rk},minute:{items:[]},second:{hidden:!0,items:Tk}},step:{magnitude:5,unit:"m"},autoShow:!1,trapFocus:!0,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,is24Hour:{$config:"lazy",value:null},initialValue:null}),Bn.initClass(),Bn._$name="TimePicker";var Mk=/\d+/,_k=/\d+(\D)\d+/,km=["hour","minute","second"],pa=[3600,60,1],kk=["getHours","getMinutes","getSeconds"],Fk=`
        :host {
            display:flex
        }
        * {
            font-size:inherit;
            font-family:inherit;
            color:inherit;
            background-color:inherit
        }
        input,button {
            padding:0;
            margin:0;
            border:0 none;
            outline:0 none;
            background-color:var(--timefield-input-background-color);
            text-align:center
        }
        input {
            width:2ch;
        }
        #am-pm {
            margin-inline:5px
        }
        #am-pm:focus-visible {
            outline:none;
            background-color:var(--timefield-button-background-color)
        }`,Fm=class extends HTMLElement{constructor(){var i;super();const e=this,t=e._root=e.attachShadow({mode:"open",delegatesFocus:!0});e.internals_=(i=e.attachInternals)==null?void 0:i.call(e),e.byRef=Object.create(null),t.addEventListener("keydown",e.onKeyDown.bind(e)),t.addEventListener("focusin",e.onFocusIn.bind(e)),t.addEventListener("click",e.onClick.bind(e)),t.addEventListener("input",e.onInput.bind(e)),t.addEventListener("focusout",e.onFocusOut.bind(e))}connectedCallback(){var i;const e=this;e.silentChangeValue=!0,e.owner=(i=e.elementData)==null?void 0:i.owner,e.createStructure(e.owner.format),e.updateValue(e._value),e.silentChangeValue=!1}ingestDate(i){let e=new Date(i);return isNaN(e)&&(e=C.parse(i,this.owner.format)),e}get is24Hour(){return this.owner.is24Hour}attributeChangedCallback(i,e,t){var r;const n=this;switch(i){case"min":n.updateMin(t);break;case"max":n.updateMax(t);break;case"label":n._label=t,(r=n.inputs)==null||r.forEach(s=>s.setAttribute("aria-label",t));break;case"disabled":n.disabled=t;break;case"tabindex":n.tabIndex=Number(t);break}}updateMin(i){const e=i==null?null:C.getTime(this.ingestDate(i));this.minValue=e,this.minHour=(e==null?void 0:e.getHours())||0}updateMax(i){const e=i==null?null:C.getTime(this.ingestDate(i));this.maxValue=e,this.maxHour=(e==null?void 0:e.getHours())||(this.is24Hour?23:11)}onFocusIn(i){var e;const t=this,{target:r}=i,n=t.getAriaLabel();r.tagName==="INPUT"&&(r.value=`00${r.value}`.slice(-2),(e=r.setSelectionRange)==null||e.call(r,0,2)),t.setAttribute("aria-label",n),t._root.activeElement.setAttribute("aria-label",n),t._root.contains(i.relatedTarget)||le.isMouseDown()||t.focusField(0),i.stopImmediatePropagation()}onClick(i){const{target:e}=i,{owner:t}=this;e===this.ampmButton&&(t.readOnly||(e.innerText=e.innerText===C.amIndicator?C.pmIndicator:C.amIndicator,this.onValueMutated(),i.stopPropagation()))}onFocusOut({target:i}){this.onValueMutated(),!this.isCleared&&i!==this.ampmButton&&(i.value=`0${parseInt(i.value)}`.slice(-2))}onKeyDown(i){var e,t,r,n;const s=this,{subfieldIndex:a}=s,{editable:l,readOnly:o}=s.owner,{amIndicator:d,pmIndicator:c}=C,{target:u,key:h}=i;if(!(i.ctrlKey||i.cmdKey||i.metaKey||i.shiftKey&&h!=="Tab"&&h.length!==1))switch(h){case"Tab":s.inputs[i.shiftKey?0:s.inputs.length-1].focus();break;case" ":(u===s.ampmButton||o)&&i.stopImmediatePropagation();break;case"ArrowLeft":i.preventDefault(),i.stopPropagation(),a>0&&!i.altKe&&s.focusField(a-1);break;case":":if(u===s.ampmButton){i.preventDefault();break}case"ArrowRight":i.preventDefault(),i.stopPropagation(),a<s.inputs.length-1&&s.focusField(a+1);break;case"ArrowUp":i.preventDefault(),i.stopPropagation(),o||s[s.owner.pickerVisible?"decrementSubfield":"incrementSubfield"](u);break;case"ArrowDown":i.preventDefault(),i.stopPropagation(),o||s[s.owner.pickerVisible?"incrementSubfield":"decrementSubfield"](u);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":(!l||o)&&i.preventDefault();break;case"Backspace":case"Delete":(!l||o)&&i.preventDefault();break;case"Escape":break;case((e=d==null?void 0:d[0])==null?void 0:e.toLocaleLowerCase()):case((t=d==null?void 0:d[0])==null?void 0:t.toLocaleUpperCase()):if(!o&&!s.is24Hour){i.preventDefault(),s.ampmButton.innerText=d,s.onValueMutated();break}case((r=c==null?void 0:c[0])==null?void 0:r.toLocaleLowerCase()):case((n=c==null?void 0:c[0])==null?void 0:n.toLocaleUpperCase()):if(i.preventDefault(),!o&&!s.is24Hour){i.preventDefault(),s.ampmButton.innerText=c,s.onValueMutated();break}default:i.preventDefault()}}onInput({target:i}){const e=this,{value:t}=i;if(t.length===1||t.length===2&&i.selectionStart===1&&i.selectionEnd===1){i.setSelectionRange(1,2);return}if(!t)i.value="00",i.setSelectionRange(0,2);else if(i.selectionEnd===2){const{subfieldIndex:r}=this;r<e.inputs.length-1&&e.focusField(r+1)}i===e.hour&&t==="00"&&!e.is24Hour&&(e.ampmButton.innerText=C.amIndicator),e.activeElement=i,e.onValueMutated(),e.activeElement=null}decrementSubfield(i){var e;const{subfieldIndex:t,step:r,isPM:n}=this;if(i===this.ampmButton)i.innerText=n?C.amIndicator:C.pmIndicator;else{const s=this.getSubFieldValue(t),a=r<pa[t-1]&&r>pa[t+1]?r/pa[t]:1,l=Math.floor(s/a)*a-a;t===0&&!this.is24Hour&&s===12&&(this.ampmButton.innerText=C.amIndicator),i.value=l}this.onValueMutated(),(e=i.setSelectionRange)==null||e.call(i,0,2)}incrementSubfield(i){var e;const{subfieldIndex:t,step:r,is24Hour:n,isPM:s}=this;if(i===this.ampmButton)i.innerText=s?C.amIndicator:C.pmIndicator;else{const a=this.inputs[t],l=this.getSubFieldValue(t),o=r<pa[t-1]&&r>pa[t+1]?r/pa[t]:1,d=Math.floor(l/o)*o+o;if(t===0&&!this.is24Hour&&l===11&&(this.ampmButton.innerText=C.pmIndicator),t===0&&(s&&!n?l+12:l)===(this.maxHour||23))return;a.value=d}this.onValueMutated(),(e=i.setSelectionRange)==null||e.call(i,0,2)}createStructure(i=this.owner.format){var e;const t=this,{_root:r,tabIndex:n,is24Hour:s,silentChangeValue:a}=t,{amIndicator:l}=C,o=new Date(1970,0,1,1,2,3),d=C.format(o,i).trim(),c=t.delimiter=(e=d.match(_k))==null?void 0:e[1],u=[...d.matchAll(new RegExp(`\\d+${c?`|\\${c}`:""}|${l}|[^\\${c}\\d]+`,"g"))].map(m=>m[0]),h=[];t.names=[],t.labelElId=`${t.owner.id}-label-element`,t.silentChangeValue=!0,n!=null&&t.setAttribute("tabIndex",n);let g=0,f;for(let m=0,p=0,{length:v}=u;m<v;m++){const b=u[m],w=m?59:s?23:11;b.trim()===l?(f=!0,t.names.push(`${C.amIndicator}/${C.pmIndicator}`),h.push({tag:"button","aria-label":t.getAriaLabel(g),reference:"ampmButton",id:"am-pm",type:"button",text:l,dataset:{subfieldIndex:g++}})):b.match(Mk)?(t.names.push(C.getLocalizedNameOfUnit(km[p])),h.push({tag:"input","aria-label":t.getAriaLabel(g),id:km[p],reference:km[p++],size:2,maxlength:2,minlength:2,dataset:{subfieldIndex:g++,max:w}})):b===c?h.push({tag:"span",text:c,reference:"delimiter"}):h.push({reference:"junk",tag:"span",text:b.replaceAll(" ","\xA0")})}h[h.length-1].reference==="delimiter"&&h.length--,!s&&!f&&(t.names.push(`${C.amIndicator}/${C.pmIndicator}`),h.push({tag:"button",reference:"ampmButton",id:"am-pm",type:"button",text:l,dataset:{subfieldIndex:g++}})),t.silentChangeValue=a,h.push({tag:"style",text:Fk}),oe.sync({targetElement:r,refOwner:t,domConfig:{onlyChildren:!0,children:h}}),t.inputs=[...r.querySelectorAll("input")],t.minute||(t.owner.step="1 h"),s?t.ampmButton=null:t.inputs.push(t.ampmButton)}attachRef(i,e){this.byRef[i]=this[i]=e}detachRef(i){this[i]=null,delete this.byRef[i]}getAriaLabel(i=this.subfieldIndex){const{owner:e}=this;return`${e.ariaLabel||e.label||""} ${this.innerText}${i!=null?` - ${this.names[i]}`:""}.`}getSubFieldValue(i){const{date:e}=this;return e?e[kk[i]]():0}setSubFieldValue(i,e,t){i=typeof i=="number"?this.inputs[i]:typeof i=="string"?this[i]:i,i&&(e<10&&(i!==this.activeElement||i.value.length===2)&&(e=`0${e}`),i.value!=e&&(i.value=e,t||this.onValueMutated()))}set value(i){const{_value:e}=this;i=this._value=i?this.ingestDate(i):null,this.isConnected&&i-e&&this.updateValue(i,e)}updateValue(i,e=null){var t;if(Number(i)!=Number(e)){const r=this,{ampmButton:n}=r,s=r.getAriaLabel();if(i){const{hour:a,minute:l,second:o}=r,d=i.getHours();r.is24Hour?r.setSubFieldValue(a,d,!0):(n.innerText=d>11?C.pmIndicator:C.amIndicator,r.setSubFieldValue(a,d>12?d%12:d,!0)),l&&r.setSubFieldValue(l,i.getMinutes(),!0),o&&r.setSubFieldValue(o,i.getSeconds(),!0)}else r._value=C.clearTime(e),r.inputs.forEach(a=>a.value=""),n&&(n.innerText=C.amIndicator);r.setAttribute("value",C.format(i,r.owner.format)),(t=r._root.activeElement)==null||t.setAttribute("aria-label",s),r.setAttribute("aria-label",s),!r.silentChangeValue&&!r.owner.sycingInputFieldValue&&r.dispatchEvent(new InputEvent("change"))}}onValueMutated(){const{date:i,minValue:e,maxValue:t}=this,r=i?new Date(i):null;i&&(e&&C.getTime(r)<C.getTime(e)?(r.setHours(e.getHours(),e.getMinutes(),e.getSeconds()),this._value=null):t&&C.getTime(r)>C.getTime(t)&&(r.setHours(t.getHours(),t.getMinutes(),t.getSeconds()),this._value=null)),this.value=r}set disabled(i){i=!!i,this._disabled!==i&&(this._disabled=i,i?this.setAttribute("disabled",!0):this.removeAttribute("disabled"))}set tabIndex(i){this._tabIndex=i}get tabIndex(){return this._tabIndex}get subfieldIndex(){const{activeElement:i}=this.shadowRoot;return i&&parseInt(i.dataset.subfieldIndex)}get isPM(){var i;return this.is24Hour?parseInt(this.hour.value||0)>11:((i=this.ampmButton.firstChild)==null?void 0:i.data)===C.pmIndicator}get value(){return this.date}get innerText(){return C.format(this.silentChangeValue?this._value:this.date,this.owner.format)||""}get date(){var i,e,t,r;const n=this,{_value:s}=n;if(!n.isConnected)return s||null;if(n.isCleared)return null;const a=new Date(n._value),l=parseInt(((i=n.hour)==null?void 0:i.value)||0),o=parseInt(((e=n.minute)==null?void 0:e.value)||0),d=parseInt(((t=n.second)==null?void 0:t.value)||0);let c=l;if(!n.is24Hour){const u=((r=n.ampmButton.firstChild)==null?void 0:r.data)===C.pmIndicator;l===12&&!n.isPM?c=0:l<12&&u&&(c+=12)}return a.setHours(c,o,d),a}get rawDate(){var i,e,t;const r=new Date(this._value);return r.setHours(parseInt(((i=this.hour)==null?void 0:i.value)||0),parseInt(((e=this.minute)==null?void 0:e.value)||0),parseInt(((t=this.second)==null?void 0:t.value)||0)),r}get isCleared(){var i;return!((i=this.inputs)!=null&&i.map(e=>e.value.trim()).join(""))}focusField(i){var e;const t=this.inputs[i];t&&(t.focus(),(e=t.setSelectionRange)==null||e.call(t,0,2))}};y(Fm,"formAssociated",!0),y(Fm,"observedAttributes",["min","max","disabled","tabindex"]),typeof customElements!="undefined"&&!customElements.get("bry-time")&&customElements.define("bry-time",Fm);var Ot=class extends Ln{get inputElement(){const i=super.inputElement;return i.tag="bry-time",i.label=this.label,i.elementData={owner:this},i}changePicker(i,e){const t=this,r=t.pickerWidth||(i==null?void 0:i.width);return Bn.reconfigure(e,i,{owner:t,defaults:{step:t.step,value:t.value,forElement:t.pickerAlignElement,owner:t,is24Hour:t.is24Hour,align:{matchSize:r==null,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},width:r,onTimeChange({source:n,time:s}){t._isUserAction=!0,n._isUserAction&&n.hide(),t.value=s,t.min&&!t.is24Hour&&t._picker.widgetMap.hour.store.filter(),t._isUserAction=!1}}})}selectAll(){}syncInputFieldValue(){const i=this;i.sycingInputFieldValue=!0,super.syncInputFieldValue(...arguments),i.sycingInputFieldValue=!1,i.syncInvalid(),i.pickerVisible&&(i.picker.value=i.value)}get inputValue(){return this._value}get needsInputSync(){var i;return String(this.input[this.inputValueAttr])!==String((i=this.inputValue)!=null?i:"")}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly}onBackClick(){const i=this,{min:e}=i;if(!i.readOnly&&i.value){const t=C.add(i.value,-1*i.step.magnitude,i.step.unit);(!e||e.getTime()<=t)&&(i.value=t)}}onForwardClick(){const i=this,{max:e}=i;if(!i.readOnly&&i.value){const t=C.add(i.value,i.step.magnitude,i.step.unit);(!e||e.getTime()>=t)&&(i.value=t)}}get isValid(){const i=this;i.clearError("L{minimumValueViolation}",!0),i.clearError("L{maximumValueViolation}",!0);let e=i.input.date;if(e){if(e=C.getTime(e),i._min&&C.getTime(i._min)>e)return i.setError("L{minimumValueViolation}",!0),!1;if(i._max&&C.getTime(i._max)<e)return i.setError("L{maximumValueViolation}",!0),!1}return super.isValid}internalOnChange(i){const e=this;e.inputting=!0,e._value=e.input.date,e.pickerVisible&&(e.picker.value=e.input.date),super.internalOnChange(...arguments),e.inputting=!1}internalOnKeyEvent(i){if(this.pickerVisible&&(i.key==="Escape"&&(this.value=this.pickerValueOnShow),i.key==="Enter")){this.hidePicker(),i.preventDefault();return}super.internalOnKeyEvent(i)}hasChanged(i,e){return i!=null&&i.getTime&&(e!=null&&e.getTime)?this.keepDate?i-e!==0:!C.isSameTime(i,e):super.hasChanged(i,e)}showPicker(){const i=this,{picker:e,value:t}=i;i.readOnly||(e.value=null,e.format=i.format,e.max=i.max,e.min=i.min,super.showPicker(),e.value=i.pickerValueOnShow=t,t||(i.value=e.value))}transformTimeValue(i){i!=null&&(typeof i=="string"?(i=C.parse(i,this.format),this.keepDate&&i&&this.value&&(i=C.copyTimeValues(new Date(this.value),i))):i=new Date(i),C.isValidDate(i)?this.keepDate||(i=C.getTime(i)):i=null);const e={value:i};return this.trigger("transformTimeValue",e),i=e.value,i}changeMin(i){return this.transformTimeValue(i)}updateMin(i){const{input:e}=this;e&&(i==null?e.removeAttribute("min"):e.setAttribute("min",i)),this.syncInvalid()}changeMax(i){return this.transformTimeValue(i)}updateMax(i){const{input:e}=this;e&&(i==null?e.removeAttribute("max"):e.setAttribute("max",i)),this.syncInvalid()}changeValue(i,e){const t=this,r=t.transformTimeValue(i);if(i&&!r||t.isRequired&&i===""){t.setError("L{invalidTime}");return}if(t.clearError("L{invalidTime}"),t.hasChanged(e,r))return super.changeValue(r,e);t.inputting||t.syncInputFieldValue(!0)}updateValue(i,e){const{expand:t}=this.triggers;this.syncInputFieldValue(!0),t&&i&&(t.element.firstElementChild.style.animationDelay=-((i.getHours()*60+i.getMinutes())/10)+"s"),super.updateValue(i,e)}changeStep(i,e){const t=typeof i;if(!i)return{magnitude:5,unit:"minute"};if(t==="number"?i={magnitude:Math.abs(i),unit:e?e.unit:"hour"}:t==="string"&&(i=C.parseDuration(i)),i!=null&&i.unit&&(i!=null&&i.magnitude))return i.magnitude<0&&(i={magnitude:-i.magnitude,unit:i.unit}),i}updateStep(i){const{_picker:e}=this;this.input.step=i&&C.as("s",i.magnitude,i.unit),e&&C.as("m",i)<30&&(e.step=i),this.syncInvalid()}get is24Hour(){return C.is24HourFormat(this.format)}updateFormat(i,e){const t=this;if(!t.isConfiguring){t._format=e;const{input:r}=t,{value:n}=r;t._format=i,t.sycingInputFieldValue=!0,r.createStructure(i),r.updateValue(n,NaN),t.syncInputFieldValue(!0),t.sycingInputFieldValue=!1}}updateLocalization(){super.updateLocalization(),this.input.isConnected&&this.input.createStructure(),this.syncInputFieldValue(!0)}};y(Ot,"$name","TimeField"),y(Ot,"type","timefield"),y(Ot,"alias","time"),y(Ot,"configurable",{inputElementTag:"bry-time",picker:{type:"timepicker",scrollAction:"realign",align:{align:"t0-b0",minHeight:200,axisLock:!0,matchSize:"min"}},role:"textbox",format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",key:" ",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:{$config:null,default:!0},value:{$config:{equal:"date"},value:null},keepDate:!0}),y(Ot,"delayable",{syncInvalid:{type:"buffer",delay:300}}),Ot.initClass(),Ot._$name="TimeField";var Im=i=>{var e;return e=class extends i.mixin(In){get dateFieldDefaults(){return T.merge({format:this.format},this._dateFieldDefaults)}configureDateField(t,r,n){const s=this,{dateStepTriggers:a}=s;return Ii.reconfigure(r,t,{owner:s,defaults:T.assign({stepTriggers:a===!0||a==="both"||a===n},s.dateFieldDefaults)})}changeFieldEndDate(t,r){return this.configureDateField(t,r,"end")}updateFieldEndDate(t){var r;t&&((r=this.dateFieldContainer)==null||r.add(t))}changeFieldStartDate(t,r){return this.configureDateField(t,r,"start")}updateFieldStartDate(t){var r;t&&((r=this.dateFieldContainer)==null||r.add(t))}updateFormat(t){this.isConstructing||(this.fieldEndDate.format=t,this.fieldStartDate.format=t)}updatePickingStartDate(t){this.element.classList.toggle("b-picking-start-date",!!t)}updateValue(t,r){var n;(n=super.updateValue)==null||n.call(this,t,r),this.syncValue("value",t)}stepDown(t){this.adjustByKey(t,this.stepSmall)}stepUp(t){this.adjustByKey(t,"-"+this.stepSmall)}stepDownLarge(t){this.adjustByKey(t,this.stepLarge)}stepUpLarge(t){this.adjustByKey(t,"-"+this.stepLarge)}adjustByKey(t,r){var n,s;const a=this,{_isUserAction:l}=a,{target:o}=t,d=[a.fieldStartDate,a.fieldEndDate],c=(o===d[0].input&&1||o===d[1].input&&2||0)-1,u=d[c],h=[d[0].value,d[1].value],g=h[0]==null||h[1]==null;h[c]=C.add((n=h[c])!=null?n:a.defaultDate(c,h),r),h[1-c]=(s=h[1-c])!=null?s:h[c],h[1]<h[0]&&(h[1-c]=h[c]),a.checkValid(h)&&(a._isUserAction=!0,g?a.value=h:(d[0].value=h[0],d[1].value=h[1]),a._isUserAction=l),u.selectAll(),t.preventDefault()}checkMinMax(t=this.value){const{maxDate:r,minDate:n,validateDateOnly:s}=this;let a=0,l,o;if(t&&(n||r)){o=Array.isArray(t)?t:[t];for(l of o)if(l=s?C.clearTime(l):l,a=n&&l<n?-1:r&&l>r?1:0,a)break}return a}checkValid(t=this.value){return!this.checkMinMax(t)}defaultDate(t,r){const{minDate:n,maxDate:s}=this,a=C.clearTime(new Date);return a<n||a>s?n:a}hasChanged(t,r){return!T.isEqual(t,r)}onDateFieldChange({source:t,userAction:r}){const n=this,{fieldEndDate:s,fieldStartDate:a,_isUserAction:l}=n;n._isUserAction=r||l,n.syncValue(t.ref,[a.value,s.value]),n._isUserAction=l}onStartDateFocusIn(){this.pickingStartDate=!0}onStartDateFocusOut(t){this.pickingStartDate=!1}syncValue(t,r=this.value){const n=this;t!=="fieldEndDate"&&(n.fieldEndDate.value=r&&r[1]),t!=="fieldStartDate"&&(n.fieldStartDate.value=r&&r[0]),t!=="value"&&(n.value=r),!n.isConstructing&&n.hasChanged(n._lastValue,r)&&n.checkValid(r)&&n.triggerChange(),n._lastValue=r}get widgetClass(){}},y(e,"configurable",{altFormats:["YYYY-MM-DD"],dateFieldDefaults:{type:"datefield",autoSelect:!0,picker:null,step:"1d",internalListeners:{change:"up.onDateFieldChange"},triggers:{expand:null,back:{align:"end",weight:101}}},fieldEndDate:{ref:"fieldEndDate",cls:"b-end-date",weight:40},fieldStartDate:{ref:"fieldStartDate",cls:"b-start-date",weight:30,internalListeners:{focusIn:"up.onStartDateFocusIn",focusOut:"up.onStartDateFocusOut"}},dateStepTriggers:null,format:"ddd, MMM D",keyMap:{ArrowDown:"stepDown",ArrowUp:"stepUp","Ctrl+ArrowDown":"stepDownLarge","Ctrl+ArrowUp":"stepUpLarge"},pickingStartDate:null,stepLarge:"1 month",stepSmall:"7 days",validateDateOnly:!0,value:{$config:{type:"date[]",formats:["format","altFormats"]}}}),y(e,"fenced",{syncValue:!0}),y(e,"prototypeProperties",{_lastValue:null}),e},{isArray:cS}=Array,uS=i=>i.getFullYear()*12+i.getMonth(),Ik=/material/i,$r=class extends Ji.mixin(In){get datePickers(){return this.items.filter(i=>i.isDatePicker)}compose(){var i;const{navButtons:e}=this,t=e===!0?Ik.test(((i=E.getThemeInfo())==null?void 0:i.name)||"")?"floating":"inline":e;return{class:{"b-multidatepicker-nav-buttons":e,[`b-multidatepicker-nav-${t}`]:e}}}onInternalPaint(i){if(i.firstPaint){const e=this,{date:t}=e;t&&e.unanimated(()=>{e.scrollPos=e.posFromIndex(e.indexFromDate(t))})}super.onInternalPaint(i)}applyDate(i,e,t){const r=this,n=e==null?void 0:e.containsFocus,{_isUserAction:s}=r;let{selection:a}=r,l=n?t:e;!a||n&&i>=a[1]?(l=t,a=[i,i]):n?a=[i,a[1]||i]:i<a[0]?(l=t,a=[i,a[1]||i]):a=[a[0]||i,i],l==null||l.focus(),r._isUserAction=!0,r.selection=a,r._isUserAction=s}changeIncludeYear(i){return typeof i=="number"&&(i=[i]),cS(i)?e=>i.includes(e.getMonth()+1):i}configureDatePicker(i,e,t){const{includeYear:r}=e,n=C.add(e.baseDate,i,"month");let s={date:n,activeDate:null,includeYear:r(n),multiSelect:e.multiSelect,selection:e.selection,weekStartDay:e.weekStartDay};return t||(s=Fi.mergeConfigs(e.datePickerDefaults,s,{cellRenderer:e.cellRenderer,headerRenderer:e.headerRenderer,weekRenderer:e.weekRenderer})),s}ensurePlan(i){return C.isDate(i)&&(i={date:i}),i.date&&(i={...i,index:this.indexFromDate(i.date)},delete i.date),i}getCell(i){return typeof i!="string"&&(i=C.makeKey(i)),this.element.querySelector(`[data-date="${i}"]:not(.b-other-month)`)}indexFromDate(i){return i&&uS(i)-uS(this.baseDate)}onDatePickerSelectionChange({selection:i,userAction:e}){if(e){const t=this,{_isUserAction:r}=t;t._isUserAction=!0,t.syncSelection("picker",i),t._isUserAction=r}}onNextMonthClick(){this.forward()}onPrevMonthClick(){this.backward()}onYearPickedMulti({source:i,value:e}){const t=this,r=i.up("datepicker"),{focusableElement:n}=r;n==null||n.focus({preventScroll:!0}),i.hide(),e-=r.activeDate.getFullYear(),t.go(e*12)}updateAtMax(i,e){const{nextButton:t,prevButton:r}=this.widgetMap;super.updateAtMax(i,e),t&&(t.containsFocus&&(r==null||r.focus()),t.isTabbable=!i,t.hidden=i)}updateAtMin(i,e){const{nextButton:t,prevButton:r}=this.widgetMap;super.updateAtMin(i,e),r&&(r.containsFocus&&(t==null||t.focus()),r.isTabbable=!i,r.hidden=i)}changeDate(i){return i&&C.clamp(i,this.minDate,this.maxDate)}updateDate(i){i!=null&&(this.currentIndex=this.indexFromDate(i))}updateMaxDate(){this.syncDateRange()}updateMinDate(){this.syncDateRange()}syncDateRange(){this.range=[this.minDate,this.maxDate]}updateNavButtons(i){this.detachListeners("navButtons"),i===!0&&le.ion({theme:()=>this.recompose(),name:"navButtons",thisObj:this})}changeRange(i,e){if(cS(i)){let[t,r]=i,n;C.isDate(t)&&(t=this.indexFromDate(t),n=!0),C.isDate(r)&&(r=this.indexFromDate(r),n=!0),n&&(i=[t,r])}return super.changeRange(i,e)}changeSelection(i,e){return i&&T.isEqual(i,e)&&(i=e),i}updateSelection(i){const e=this;e.syncSelection("selection",i),e.isConfiguring?i&&(e.date=i[0]):e.trigger("selectionChange",{selection:i,userAction:e._isUserAction})}syncSelection(i,e=this.selection){const{datePickers:t}=this;i!=="selection"&&(this.selection=e),i!=="picker"&&t.forEach(r=>r.selection=e)}};y($r,"$name","MultiDatePicker"),y($r,"type","multidatepicker"),y($r,"configurable",{configureSlot:"configureDatePicker",disableReserveSlots:"inert",slots:2,baseDate:{$config:"day",value:"today"},cellRenderer:null,headerRenderer:null,weekRenderer:null,weekStartDay:null,date:{$config:"day",value:"today"},minDate:{$config:"day"},maxDate:{$config:"day"},datePickerDefaults:{type:"datepicker",activeDate:null,animateTimeShift:!1,dayNameFormat:"d1",multiSelect:"range",trapFocus:!1,internalListeners:{selectionChange:"up.onDatePickerSelectionChange"},tbar:{items:{prevMonth:{onAction:"up.onPrevMonthClick"},nextMonth:{onAction:"up.onNextMonthClick"},fields:{items:{monthField:{disabled:!0},yearButton:{disabled:!0}}}}},yearPicker:{internalListeners:{select:"up.onYearPickedMulti"}}},includeYear:i=>!i.getMonth(),items:{prevButton:{type:"button",positionable:"before",cls:"b-multidatepicker-nav-button b-multidatepicker-prev-button b-icon b-icon-previous",onAction:"up.onPrevMonthClick",hideMode:"opacity"},nextButton:{type:"button",positionable:"after",cls:"b-multidatepicker-nav-button b-multidatepicker-next-button b-icon b-icon-next",onAction:"up.onNextMonthClick",hideMode:"opacity"}},multiSelect:null,navButtons:!0,selection:{$config:"day[]"}}),y($r,"fenced",{syncSelection:!0}),$r.initClass(),$r._$name="MultiDatePicker";var va=class extends $r.mixin(Im){get dateFieldContainer(){return this.tbar}changeConfirmable(i){return this.bbar=i,this.bbar}updateConfirmable(i){this.detachListeners("confirmable"),i==null||i.ion({name:"confirmable",thisObj:this,choice:"doConfirm"})}get isValid(){return this.checkValid()}configureDatePicker(i,e,t){const r=super.configureDatePicker(i,e,t);return r.selection=this.selection,r}onDatePickerBeforeDateSelect({date:i}){return this.applyDate(i,this.fieldStartDate,this.fieldEndDate),!1}doConfirm({choice:i,event:e,userAction:t}){this.trigger("confirm",{choice:i,event:e,userAction:t})}internalOnKeyDown(i){const{confirmable:e}=this;let t=e==null?void 0:e.hotKeys[i.virtualKey];t?(t==="default"&&(t=e.defaultButton),t&&this.doConfirm({event:i,choice:{[t]:!0,name:t}})):super.internalOnKeyDown(i)}syncSelection(i,e=this.selection){super.syncSelection(i,e),i!=="value"&&this.syncValue("selection",e)}syncValue(i,e=this.value){const t=this,r=(e==null?void 0:e[1])<(e==null?void 0:e[0]);let n;i==="fieldEndDate"?(n=2,r&&(e=[e[1],e[1]])):i==="fieldStartDate"&&(n=1,r&&(e=[e[0],e[0]])),n&&e&&!t.isConstructing&&t.ensureVisible(e[n-1]),i!=="selection"&&t.syncSelection("value",e),super.syncValue(i,e)}triggerChange(i,e=!!this._isUserAction){const{value:t,_lastValue:r,isValid:n}=this;this.triggerFieldChange({value:t,oldValue:r,event:i,userAction:e,valid:n})}};y(va,"$name","DateRangePicker"),y(va,"type","daterangepicker"),y(va,"configurable",{confirmable:null,datePickerDefaults:{focusable:!1,internalListeners:{beforeDateSelect:"up.onDatePickerBeforeDateSelect"}},keyMap:{delegate:"confirmable"},multiSelect:"range",selection:["today","today"],stripDefaults:{bbar:{type:"confirmationbar"}},tbar:{items:{spacer:{type:"widget",flex:1,weight:0}}}}),va.initClass(),va._$name="DateRangePicker";var Ak=new Date,zn=class extends Ln.mixin(Im){get dateFieldContainer(){return this.container}get innerElements(){return[]}get maxDate(){return this.max}get minDate(){return this.min}compose(){const{pickTime:i}=this;return{class:{"b-pick-time":!!i}}}updateClearable(i){const{fieldEndDate:e}=this;e.clearable=i,i&&(e.triggers.clear.handler=()=>this.clear())}updateConfirmable(){this.isConstructing||(this.picker=this._pickerConfig)}changeEndTimeField(i,e){return Ot.reconfigure(e,i,{owner:this,defaults:Ot.mergeConfigs(this.timeFieldDefaults,this.fieldEndTimeDefaults)})}updateEndTimeField(i){i&&this.container.add(i)}changeStartTimeField(i,e){return Ot.reconfigure(e,i,{owner:this,defaults:Ot.mergeConfigs(this.timeFieldDefaults,this.fieldStartTimeDefaults)})}updateStartTimeField(i){i&&this.container.add(i)}updateKeepTime(i){i=!this.pickTime&&i,this.fieldEndDate.keepTime=i,this.fieldStartDate.keepTime=i}updateMax(i){const{fieldEndDate:e,fieldStartDate:t,_picker:r}=this;e.max=i,t.max=i,r&&(r.maxDate=i),this.syncInvalid()}updateMin(i){const{fieldEndDate:e,fieldStartDate:t,_picker:r}=this;e.min=i,t.min=i,r&&(r.minDate=i),this.syncInvalid()}changePicker(i,e){const t=this,{confirmable:r,pickerAlignElement:n}=t,s=r?t.confirmableDefaults:t.nonConfirmableDefaults,a=z.resolveType(s.type),l=a.mergeConfigs({owner:t,forElement:n,minDate:t.min,maxDate:t.max,selection:t.value,weekStartDay:t._weekStartDay,align:{anchor:t.overlayAnchor,target:n}},s,r&&{confirmable:r});return t._pickerConfig=i,T.isObject(i)&&(i=T.merge({type:l.type},i)),a.reconfigure(e,i,{owner:t,defaults:l})}updatePicker(i,e){super.updatePicker(i,e),this.detachListeners("dateRangeField.picker"),i==null||i.ion({name:"dateRangeField.picker",thisObj:this,selectionChange:"onPickerSelectionChange",confirm:"onPickerConfirm",focusIn:"onPickerFocusIn"})}updatePickerCls(i,e){var t,r;const n=(r=(t=this.picker)==null?void 0:t.element)==null?void 0:r.classList;e&&(n==null||n.remove(e)),i&&(n==null||n.add(i))}updatePickTime(i){let e=null,t=null;i===!0?e=t={}:i&&(i.fieldStartTime||i.fieldEndTime?(t=i.fieldStartTime,e=i.fieldEndTime):t=e=i),this.fieldEndTime=e,this.fieldStartTime=t}changeValue(i){const e=this,t=e.L("L{DateField.invalidDate}")(C.format(Ak,e.format));if(i&&!(C.isDate(i[0])&&C.isDate(i[1]))){e.setError(t);return}return e.clearError(t),i}get weekStartDay(){return typeof this._weekStartDay=="number"?this._weekStartDay:C.weekStartDay}updateWeekStartDay(i){this._picker&&(this._picker.weekStartDay=i)}maybeHidePicker(){if(!this.picker.isVisible||this.confirmable)return!1;this.hidePicker()}onDatePickerBeforeDateSelect({date:i}){return this.picker.applyDate(i,this.fieldStartDate,this.fieldEndDate),!1}onDateFieldChange({source:i}){const e=this,{ref:t}=i,r=t==="fieldStartDate"?0:1,{pickTime:n}=e;let s,a,l,o,d;e.isConstructing||(s=i.value,a=1-r,o=e.value,s&&(n?(l=r?e.fieldStartTime:e.fieldEndTime,s=C.combineDateAndTime(s,l.value)):s=C.clearTime(s),d=[s,s],o&&(d[a]=o[a],d[1]<d[0]&&(d[a]=C.combineDateAndTime(s,d[a]),d[1]<d[0]&&(d[a]=s))),e.syncValue(t,d)))}onKeyArrowUp(i){const e=this,{picker:t}=e;if(t.isVisible)return e.confirmable?!1:e.stepUp(i);e.showPicker()}onKeyClear(){this.clearable&&this.clear()}onKeyEnter(){this.maybeHidePicker()}onKeyEscape(){this.maybeHidePicker()}onExpandPicker(){this.confirmable?this.showPicker():this.togglePicker()}onPickerSelectionChange({selection:i,userAction:e}){if(!this.confirmable){const t=this,{_isUserAction:r}=t;t._isUserAction=e||r,t.syncValue("picker",i),t._isUserAction=r}}onPickerConfirm({choice:i,source:e,userAction:t}){const r=this,{_isUserAction:n}=r,s=e.containsFocus&&(e.pickingStartDate?r.fieldStartDate:r.fieldEndDate);i.ok&&(r._isUserAction=t||n,r.syncValue("picker",e.value),r._isUserAction=n),r.hidePicker(),s==null||s.focus()}onPickerFocusIn({relatedTarget:i}){const{fieldEndDate:e,fieldStartDate:t}=this.container.widgetMap,r=i===t?t:e;!this.confirmable&&r.focus()}onTriggerKeyDown(i){return this.picker.isVisible&&!this.confirmable?this.stepDown(i):super.onTriggerKeyDown(i)}focusPicker(){const{picker:i}=this,{fieldEndDate:e,fieldStartDate:t}=this.container.widgetMap,{tbar:r}=i,{fieldEndDate:n,fieldStartDate:s}=(r==null?void 0:r.widgetMap)||{},a=r?e.containsFocus&&n||s:e.containsFocus&&e||t;a.focus(),a!==i&&(i.ensureVisible({animate:!1,date:a.value}),a.selectAll())}showPicker(i){const e=this,{_picker:t}=e;e.readOnly||(t&&t.setConfig({range:[e.min,e.max],selection:e.value}),i=i||!!e.confirmable,super.showPicker(i))}get isValid(){const i=this,e=i.checkMinMax();return i.clearError("L{Field.minimumValueViolation}",!0),i.clearError("L{Field.maximumValueViolation}",!0),e?(i.setError(e<0?"L{Field.minimumValueViolation}":"L{Field.maximumValueViolation}",!0),!1):super.isValid}setupLabel(i){return super.setupLabel(T.assign({for:this.fieldStartDate.input.id},i))}syncInputFieldValue(){}syncValue(i,e=this.value){const t=this,{_picker:r}=t,n=(e==null?void 0:e[1])<(e==null?void 0:e[0]);if(r!=null&&r.isVisible&&!t.confirmable){let s;i==="fieldEndDate"?(s=2,n&&(e=[e[1],e[1]])):i==="fieldStartDate"&&(s=1,n&&(e=[e[0],e[0]])),s&&e&&!t.isConstructing&&r.ensureVisible(e[s-1])}i!=="picker"&&r&&(r.selection=e),super.syncValue(i,e)}};y(zn,"$name","DateRangeField"),y(zn,"type","daterangefield"),y(zn,"alias","daterange"),y(zn,"configurable",{inline:!0,confirmable:null,container:{},confirmableDefaults:{type:"daterangepicker",navButtons:"floating",trapFocus:!0,align:{align:"t100-t100",offset:'[data-ref="fieldEndDate"]',overlap:!0},fieldStartDate:{triggers:{expand:{align:"start",disabled:!0}}}},fieldEndDate:{internalListeners:{triggerKey:"up.onTriggerKey"},triggers:{expand:null}},fieldEndTime:null,fieldEndTimeDefaults:{ref:"fieldEndTime",cls:"b-end-time",weight:20},fieldStartDate:{internalListeners:{triggerKey:"up.onTriggerKey"},triggers:{expand:{handler:"up.onExpandPicker",align:"start"}}},fieldStartTime:null,fieldStartTimeDefaults:{ref:"fieldStartTime",cls:"b-start-time",weight:10},keepTime:null,keyMap:{ArrowDown:"onTriggerKeyDown",ArrowUp:"onKeyArrowUp",Enter:"onKeyEnter",Escape:"onKeyEscape","Shift+Backspace":"onKeyClear"},max:{$config:{type:"date",formats:["format","altFormats"],strict:!0}},min:{$config:{type:"date",formats:["format","altFormats"],strict:!0}},nonConfirmableDefaults:{type:"multidatepicker",align:{align:"t100-r100"},datePickerDefaults:{focusable:!1,internalListeners:{beforeDateSelect:"up.onDatePickerBeforeDateSelect"}}},picker:{cls:"b-daterangefield-picker",floating:!0,hideMode:"clip",multiSelect:"range",scrollAction:"realign",align:{axisLock:!0}},pickerAlignElement:"container.element",pickerCls:null,pickTime:null,stepSmall:"7 days",timeFormat:"HH:mm:ss:SSS",triggers:{expand:null},weekStartDay:null,timeFieldDefaults:{type:"timefield",autoSelect:!0,picker:{align:{align:"b0-t0"}},triggers:{expand:null}}}),zn.initClass(),zn._$name="DateRangeField";var hS=new Date(2e3,0,1),Wn=class extends rt{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get childItems(){return[this.dateField,this.timeField]}get fieldDefaults(){const{revertOnEscape:i,tabIndex:e}=this;return e==null?{revertOnEscape:i}:{revertOnEscape:i,tabIndex:e}}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(i){this.timeField.revertOnEscape=i,this.dateField.revertOnEscape=i}changeTimeField(i,e){return Ot.reconfigure(e,i,{owner:this,defaults:this.fieldDefaults})}updateTimeField(i){const e=this;V.on({element:i.element,keydown:"onTimeFieldKeyDown",thisObj:e}),be.after(i,"syncInvalid",()=>{e.timeField&&!e.updatingInvalid&&e.syncInvalid()}),i.ion({thisObj:e,change({userAction:t,value:r}){if(t&&!e.$settingValue){const n=e.dateField.value;e._isUserAction=!0,e.value=n?C.copyTimeValues(new Date(n),r||hS):null,e._isUserAction=!1}}}),e.readOnly&&(i.readOnly=!0)}changeDateField(i,e){return Ii.reconfigure(e,i,{owner:this,defaults:this.fieldDefaults})}updateDateField(i){const e=this;V.on({element:i.element,keydown:"onDateFieldKeyDown",thisObj:e}),be.after(i,"syncInvalid",()=>{e.dateField&&!e.updatingInvalid&&e.syncInvalid()}),i.ion({thisObj:e,change({userAction:t,value:r}){t&&!e.$isInternalChange&&(e._isUserAction=!0,e.timeField.value=r,e.value=r,e._isUserAction=!1)},keydown({event:t}){var r;t.key==="Tab"&&!t.shiftKey&&((r=e.timeField)!=null&&r.isVisible)&&t.stopPropagation()}}),e.readOnly&&(i.readOnly=!0)}updateWeekStartDay(i){this.dateField&&(this.dateField.weekStartDay=i)}changeWeekStartDay(i){var e,t;return typeof i=="number"?i:(t=(e=this.dateField)==null?void 0:e.weekStartDay)!=null?t:C.weekStartDay}syncInputFieldValue(i=this.isConfiguring){super.syncInputFieldValue(!0);const e=this,{dateField:t,timeField:r}=e,n=t.highlightExternalChange,s=r.highlightExternalChange;!i&&!e.highlightExternalChange&&(i=!0),e.$isInternalChange=!0,t.highlightExternalChange=!1,t.highlightExternalChange=n,i&&(r.highlightExternalChange=t.highlightExternalChange=!1),r.value=t.value=e.inputValue,t.highlightExternalChange=n,r.highlightExternalChange=s,e.$isInternalChange=!1,e.syncInvalid()}onTimeFieldKeyDown(i){const e=this;if(!e.readOnly&&(i.key==="Enter"||i.key==="Tab")){const t=e.dateField.value;e._isUserAction=!0,e.value=t?C.copyTimeValues(new Date(t),e.timeField.value||hS):null,e._isUserAction=!1}}onDateFieldKeyDown(i){const e=this;i.key==="Tab"&&!i.shiftKey?(i.stopPropagation(),i.preventDefault(),e.timeField.focus()):!e.readOnly&&i.key==="Enter"&&(e.value=e.dateField.value)}updateRequired(i){super.updateRequired(i),this.timeField.required=this.dateField.required=i}updateReadOnly(i,e){super.updateReadOnly(i,e),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=i)}onDisabled(i){this.timeField.disabled=this.dateField.disabled=i}focus(){this.dateField.focus()}hasChanged(i,e){var t,r;return i!=null&&i.getTime&&(e!=null&&e.getTime)?!C.isEqual(i,e):super.hasChanged((t=i==null?void 0:i.getTime)==null?void 0:t.call(i),(r=e==null?void 0:e.getTime)==null?void 0:r.call(e))}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(i,e){[this.dateField,this.timeField].forEach(t=>t.setError(i,e))}getErrors(){const i=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return i.length?i:null}clearError(i,e){[this.dateField,this.timeField].forEach(t=>t.clearError(i,e))}updateInvalid(){this.updatingInvalid=!0,this.dateField.updateInvalid(),this.timeField.updateInvalid(),this.updatingInvalid=!1}};y(Wn,"$name","DateTimeField"),y(Wn,"type","datetimefield"),y(Wn,"alias","datetime"),y(Wn,"configurable",{timeField:{type:"timefield"},dateField:{type:"datefield",keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),Wn.initClass(),Wn._$name="DateTimeField";var{dockIsHorz:Lk}=Yi.maps,Pk={top:0,down:0,left:1,bottom:2,up:2,right:3},Am={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}},ya=class extends Yi.mixin(fe){static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var i;(i=this.collapsible)==null||i.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(i){const{doAutoClose:e}=this;(e.suspended=i==null||i<0)||(e.delay=i,e.immediate=!i)}changeRecollapseTool(i){const e=this,{panel:t}=e;if(e.isConfiguring||e.isDestroying||!t||t.isDestroying)return i;t.tools={recollapse:i}}beforeCollapse(i){if(super.beforeCollapse(i)===!1)return!1;this.panel.revealed&&(i.animation=null)}applyHeaderDock(i,e=!0){var t;(t=this.panel)==null||t.recompose(),super.applyHeaderDock(i,e)}collapseBegin(i){const e=this,{collapseDir:t,innerElement:r}=e,{animation:n}=i,{collapseTool:s,panel:a}=e;e.configuredWidth=a._lastWidth,e.configuredHeight=a._lastHeight,e.applyHeaderDock(!0),e.lockInnerSize(),s==null||s.element.classList.add("b-collapsed"),n&&(a.element.classList.add("b-collapsing"),n.element=r,n.transform=Am[t],i.animation=yt.run(n))}onComplete(i){var e,t;super.onComplete(i);const r=this,{panel:n}=r,{element:s}=n;r.autoCloseLeaveDetacher=(e=r.autoCloseLeaveDetacher)==null?void 0:e.call(r),r.autoCloseClickDetacher=(t=r.autoCloseClickDetacher)==null?void 0:t.call(r),r.doAutoClose.cancel(),i==="reveal"&&r.autoClose&&(n.containsFocus&&(r.autoCloseLeaveDetacher=V.on({element:s,mouseenter:a=>{r.doAutoClose.cancel()},mouseleave:a=>{r.doAutoClose()}})),r.autoCloseClickDetacher=V.on({element:document.body,thisObj:n,mousedown:a=>{var l;!n.owns(a)&&!((l=r.revealer)!=null&&l.contains(a.target))&&r.autoCloseDelay!=null&&r.doAutoClose.now()}})),!r.hasPainted&&i==="collapse"&&r.innerElement.offsetHeight}expandBegin(i){const e=this,{animation:t}=i,{collapseDir:r,collapseTool:n,innerElement:s,panel:a}=e,{element:l}=a;l.classList.remove("b-collapsed","b-collapsing"),e.restoreConfiguredSize(),e.lockInnerSize(!1),e.lockInnerSize(),n==null||n.element.classList.remove("b-collapsed"),t&&(l.classList.add("b-collapsed","b-expanding"),t.element=s,t.transform={from:Am[r].to,to:Am[r].from},i.animation=yt.run(t))}expandEnd(i){super.expandEnd(i);const{panel:e}=this;i.completed&&(e.revealed=!1),e.element.classList.remove("b-expanding")}expandRevert(i){super.expandRevert(i),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const i=this,{direction:e}=i,t=super.toolsConfig,r=i.recollapseTool;return r?{...t,recollapse:r&&T.assign({direction:e.toLowerCase()},r)}:t}lockInnerSize(i=!0){const e=this,{panel:t}=e,r=i&&t.rectangle(),n=i?[0,0,0,0]:"",s=super.lockInnerSize(i);return i&&(n[Pk[e.collapseDir]]=`-${r[e.collapseDim]+10}px`),t.element.style.clipPath=i?`inset(${n.join(" ")})`:"",s}onOverlayTransitionDone(i){const e=this,{panel:t}=e;i.srcElement===t.overlayElement&&e.revealing&&(e.revealing=!1,e.onComplete(t.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}toggleReveal(i){const{panel:e}=this,{element:t}=e;e.collapsed&&(this.revealer=E.getActiveElement(t),i==null&&(i=!e.revealed),e.revealed!==i&&e.trigger("beforeToggleReveal",{reveal:i})!==!1&&(!i&&t.matches(":focus-within")&&e.revertFocus(!0),this.revealing=!0,e.revealed=i,t.getBoundingClientRect()))}updateRevealing(i){const e=this,t=/left|right/i,{panel:r}=e,n=t.test(e.collapseDir)?"height":"width";r&&(e.innerElement.style[n]="0px",e.innerElement.style[`min-${n}`]="100%",r.element.classList[i?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(i,e){var t;const r=this,{collapseDir:n,panel:s}=r,{expandedHeaderDock:a,header:l,uiClassList:o}=s,d=(t=s.tools)==null?void 0:t.recollapse,[c,u]=r.splitHeaderItems({as:"element",dock:r.collapseDock}),h=Lk[a],g=s.hasHeader?s.title||(l==null?void 0:l.title)||"\xA0":null;return d&&(d.direction=n),["overlayElement",{class:{...o,[`b-panel-overlay-header-${a}`]:1,[`b-panel-overlay-${n}`]:1,[`b-${h?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1},listeners:{transitionend:f=>r.onOverlayTransitionDone(f),transitioncancel:f=>r.onOverlayTransitionDone(f)},children:{overlayHeaderElement:g&&{tag:"header",class:new te({...o,[`b-dock-${a}`]:1,"b-panel-header":1,"b-panel-overlay-header":1},l==null?void 0:l.cls),children:[...c,{reference:"overlayTitleElement",html:g,class:{...o,[`b-align-${(l==null?void 0:l.titleAlign)||"start"}`]:1,"b-header-title":1}},...u]},[i]:e}}]}};y(ya,"$name","PanelCollapserOverlay"),y(ya,"type","overlay"),ya.initClass(),ya._$name="PanelCollapserOverlay";var Lm={lineNumber:0,column:0},gS={lineNumber:Number.MAX_SAFE_INTEGER,column:Number.MAX_SAFE_INTEGER},Ok=Y.isBryntumOnline(["online"]),{pathname:Pm}=globalThis.location,uh=Pm.endsWith("umd.html"),fS=document.querySelector("script[type=module]"),hh=Pm.endsWith("module.html")||(fS==null?void 0:fS.src.includes("app.module.js"))||Pm.endsWith("index.html")&&Ok,vd=class Dv extends er{construct(e={}){super.construct(...arguments);const t=this,{rtl:r}=t;r&&(t.collapsible.direction="left"),new Fn({targetSelector:".b-codeeditor",rightHandle:!!r,leftHandle:!r,skipTranslate:!0,minWidth:190})}static get isModule(){return hh}get isVanilla(){return this.mode==="vanilla"}get isFramework(){return this.mode==="framework"}updateMode(){this.title='<span class="title-container"><span class="title">'+(this.isVanilla?"L{CodeEditor.editor}":"L{CodeEditor.viewer}")+"</span></span>"}onCloseClick(){this.collapse()}async onFilesComboChange({value:e}){await this.loadCode(e)}async collapseBoilerplate(e){const{monacoInstance:t,editor:r}=this,{Selection:n}=t,s=[],a=e.findMatches("^import .*$",!0,!0);let l,o=!0;["baselines","children","segments","intervals","events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges","rows"].forEach(u=>{const h=`${u}\\s*(?:=|:)\\s*\\[`;for(l=e.findForwards(h,Lm,!0);l&&o;l=e.findForwards(h,o.range.getEndPosition(),!0))if(o=e.findForwards("\\](?:;|,)?\\s*$",l.range.getEndPosition(),!0),o){for(;o&&s.some(g=>g.containsRange(o.range));)o=e.findForwards("\\](?:;|,)?\\s*$",o.range.getEndPosition(),!0);o&&s.push(new n(l.range.startLineNumber,1,o.range.endLineNumber+1,1))}});let d,c=Lm;for(;d=e.findForwards("^\\s*//\\s*hide",c,!0);){const u=e.findForwards("^\\s*//\\s*end(?:-|(?:\\s*))?hide",{lineNumber:d.range.endLineNumber,column:0},!0);u&&s.push(new n(d.range.startLineNumber,1,u.range.endLineNumber+1,1)),c=(u==null?void 0:u.range.getEndPosition())||gS}for(c=Lm;d=e.findForwards("^\\s*//\\s*region",c,!0);){const u=e.findForwards("^\\s*//\\s*end(?:-|(?:\\s*))?region",{lineNumber:d.range.endLineNumber,column:0},!0);u&&s.push(new n(d.range.startLineNumber,1,u.range.endLineNumber+1,1)),c=(u==null?void 0:u.range.getEndPosition())||gS}a.length&&s.push(new n(1,1,a[a.length-1].range.startLineNumber+1,1));for(const u of s)r.setSelections([...r.getSelections(),u]),await r.getAction("editor.createFoldingRangeFromSelection").run()}set status(e){this.widgetMap.status.html=e}get isReadOnly(){return this.isFramework||this.fileExt==="html"||this.fileExt==="js"&&(this.hasImports||uh)}toggleReadOnly(){const e=this,{contentElement:t,isReadOnly:r}=e;t.classList.toggle("readonly",r),r?e.status="Read only"+(Y.isCSP?" (Restricted by Content Security Policy)":!Y.isChrome&&!Y.isFirefox?" (try it on Chrome or Firefox)":""):e.status="Idle",e.editor.updateOptions({readOnly:r})}async loadCode(e){e=`${this.appFolder}${e}`;const t=this,{isVanilla:r}=t;let n=t.codeCache[e],s=null;if(t.filename=e,!n)try{const o=await kt.get(location.href.replace(/[^/]*$/,"")+e);n=t.codeCache[e]=await o.text()}catch(o){n="",s=o}t.loadedCode=n,t.fileExt=e.split(".").pop();let a="plaintext";switch(t.fileExt){case"js":case"mjs":case"jsx":a="javascript";break;case"ts":case"mts":case"tsx":case"vue":a="typescript";break;case"css":a="css";break;case"scss":a="scss";break;case"htm":case"html":a="html";break;case"json":a="json";break}t.language=a;const l=t.model=await t.loadText(n,a);l.findForwards=function(o,d){const c=l.findNextMatch(...arguments);if(c&&!c.range.getStartPosition().isBefore(d))return c},r&&t.fileExt==="js"&&await t.collapseBoilerplate(l),t.status=`${s?s.message:"Idle"}`,t.toggleReadOnly()}sortFileNamesWithHierarchy(e){const t=s=>{const a={};return s.forEach(l=>{const o=l.split("/");let d=a;o.forEach((c,u)=>{d[c]||(d[c]=u===o.length-1?null:{}),d=d[c]})}),a},r=s=>{const a={};return Object.keys(s).sort((o,d)=>{const c=s[o]!==null,u=s[d]!==null;return c&&!u?-1:!c&&u?1:o.localeCompare(d)}).forEach(o=>{a[o]=s[o]!==null?r(s[o]):s[o]}),a},n=(s,a="")=>{let l=[];return Object.keys(s).forEach(o=>{const d=`${a}${a!==""?"/":""}${o}`;s[o]===null?l.push(d):l=l.concat(n(s[o],d))}),l};return n(r(t(e)))}async initialLoadCode(){var e,t,r;const n=this,{widgetMap:s,preferredSources:a}=n,{filesCombo:l}=s,o=l.store,d=`${n.appFolder}app.config.json`,c=(await kt.get(d,{parseJson:!0})).parsedJson,u=[],h=Y.isBryntumOnline("online");if(n.isVanilla){const f=(t=(e=c.index)==null?void 0:e.bundles)==null?void 0:t.includes("es6");u.push(hh&&!h&&!f?"index.module.html":uh?"index.umd.html":"index.html",(hh||h)&&!f?"app.module.js":uh?"app.umd.js":"app.js"),!hh&&!uh&&((r=c.merge)!=null&&r.length)&&(n.hasImports=!0,u.push(...c.merge)),document.head.querySelector('[href*="app.css"]')&&u.push("resources/app.css")}else c.source.length?u.push(...c.source):console.warn(`No source files loaded from ${d}`);l.items=n.sortFileNamesWithHierarchy(u).map(f=>({text:f,value:f}));const g=(a||[]).map(f=>o.find(m=>f.test(m.value))).find(Boolean)||o.first;l.value=g.value,await n.loadCode(g.value),l.onChange="up.onFilesComboChange",n.toggleReadOnly(),l.readOnly=o.count===1}static get monacoCodePath(){const e=/(.*?\/)examples/.exec(document.location.href);return e?`${e[1]}examples/_shared/browser/lib/monaco-editor`:void 0}static async toggleCodeEditor(e,t,r){return!e&&(e=new Dv({mode:"framework",appendTo:document.body,codePath:Dv.monacoCodePath,appFolder:"../",...r}),z.disableThrow=!0,t.icon="b-icon-spinner",await e.initialLoadCode(),t.icon="b-icon-code"),e.collapsed?(await e.expandPanel(),e.focus()):await e.collapsePanel(),e}};y(vd,"$name","DemoCodeEditor"),y(vd,"type","democodeeditor"),y(vd,"configurable",{mode:"vanilla",appFolder:"",collapsible:{type:ya.type,direction:"right",autoClose:!1},collapsed:!0,preferredSources:null,monitorResize:!1,editor:{lineNumbers:"off",foldingImportsByDefault:!0,minimap:{enabled:!1},ariaLabel:"Live code editor"},tbar:{overflow:null,items:{filesCombo:{type:Ze.type,flex:"1 1 100%",monitorResize:!1,editable:!1,fields:[{name:"text"}],listItemTpl:({text:i})=>{const e=i.split(".").pop();let t="b-fa-file";switch(e){case"js":case"mjs":case"jsx":case"ts":case"mts":case"tsx":case"vue":t="b-fa-file-lines";break;case"css":case"scss":t="b-fa-palette";break;case"htm":case"html":case"json":t="b-fa-file-code";break}const r=i.lastIndexOf("/")+1,n=i.substring(0,r),s=i.substring(r);return`<span class="b-editor-file-type b-fw-icon ${t}" ></span> <span class="b-editor-folder">${n}</span>${s}`},picker:{maxHeight:"calc(100vh * 3 / 4)"}}}},codeCache:{}}),y(vd,"loadMonacoEditor",async i=>{if(!er.monacoLoadPromise){const e=E.createElement({tag:"script",parent:document.head,src:`${i}monaco-editor/min/vs/loader.js`});await new Promise(t=>e.addEventListener("load",t)),await(er.monacoLoadPromise=new Promise(t=>{const r=globalThis.require;r.config({paths:{vs:`${i}monaco-editor/min/vs`}}),r(["vs/editor/editor.main"],function(){t(globalThis.monaco)})}))}});var gh=vd;gh.initClass(),gh._$name="DemoCodeEditor";var mS,pS,vS,yd=class extends gt{construct(...e){super.construct(...e),this.setupToolbar()}static get titleLink(){const e=/(.*?\/)(examples.*?\/frameworks\/.*?)\/(build|out|dist)/.exec(document.location.href);return e?`${e[1]}examples/#example-${e[2].replace(/\//gm,"-").replace("examples-frameworks","frameworks")}`:"#"}async toggleCodeEditor(){this.codeEditor=await gh.toggleCodeEditor(this.codeEditor,this.widgetMap.tools.widgetMap.codeButton,{appFolder:this.appFolder,preferredSources:[/App\.[jt]sx?/,/\w+Config\.[jt]sx?/,/index\.[jt]sx?/]})}async setupToolbar(){var e,t;const{location:r}=document,n=r.search.includes("test");if(r.href.match(/examples\/frameworks/)||n){const a=((e=r.href.match(/\/(\w+)(-trial)?\/[-\w]*examples\//))==null?void 0:e[1].toLowerCase())||"grid",{widgetMap:l}=this.widgetMap.tools,{downloadButton:o,trialButton:d}=l;Object.values(l).forEach(u=>u.hidden=!1),d.href=`https://bryntum.com/download/?product=${a}`;const c=(t=await kt.get(`${this.appFolder}/app.config.json`,{parseJson:!0}).catch(()=>{}))==null?void 0:t.parsedJson;c!=null&&c.zip||n?o.href=`${this.appFolder}${c.zip}`:o.hidden=!0,xn.insertRule("body { flex-direction : row !important }"),xn.insertRule("#container { flex: 1 !important; overflow : hidden !important }")}}};y(yd,"$name","DemoHeader"),y(yd,"type","demoheader"),y(yd,"configurable",{insertFirst:"container",appFolder:"../",cls:"demo-header",items:[{type:"container",id:"title-container",items:[{type:"container",tag:"a",id:"title",elementAttributes:{href:yd.titleLink},items:[{html:((mS=document.title)!=null?mS:"Demo").split("-").pop().trim(),tag:"h1",tooltip:(vS=(pS=document.querySelector('meta[name="description"]'))==null?void 0:pS.content)!=null?vS:""}]}]},{type:kn.type,id:"tools",style:{border:"none",height:"2.8em"},defaults:{style:{margin:0},cls:"b-raised b-blue"},items:["->",{ref:"trialButton",type:"button",text:"Download Trial",cls:"b-green b-raised",href:"#",hidden:!0},{ref:"codeButton",type:"button",tooltip:"Click to show the code viewer",icon:"b-icon-code",onClick:"up.toggleCodeEditor",hidden:!0},{ref:"downloadButton",type:"button",tooltip:"Download this demo zip archive",icon:"b-icon-download",href:"#",hidden:!0},{ref:"fullscreenButton",type:"button",tooltip:"Full screen",icon:"b-icon-fullscreen",onClick(){Et.enabled&&(Et.isFullscreen?Et.exit():Et.request(document.body))}}]}]});var yS=yd;yS._$name="DemoHeader";var ba=class extends oi{static get defaultConfig(){return{value:null,defaultUnit:"day",useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null,step:1,unit:null,magnitude:null}}changeMin(i){return typeof i=="string"?new we(i):i}changeMax(i){return typeof i=="string"?new we(i):i}changeAllowedUnits(i){return typeof i=="string"&&(i=i.split(",")),i.length>0&&!i.includes(this.defaultUnit)&&(this.defaultUnit=i[0]),i}updateAllowedUnits(i){this.allowedUnitsRe=new RegExp(`^(${i.join("|")})$`,"i")}get inputValue(){return this.value==null?"":this.calcValue(!0).toString(this.useAbbreviation,this.decimalPrecision)}updateUnit(){this.clearError("L{invalidUnit}"),super.value=this.calcValue()}updateMagnitude(){this.clearError("L{invalidUnit}"),super.value=this.calcValue()}get unitWithDefault(){return this.unit||this.defaultUnit}roundMagnitude(i){return i&&this.decimalPrecision!=null?T.round(i,this.decimalPrecision):i}get allowDecimals(){return this.decimalPrecision!==0}get isValid(){const i=this,e=i.input.value,t=C.parseDuration(e,i.allowDecimals,e.match(/[\p{Letter}\p{Mark}]+/gui)?void 0:i.unitWithDefault),r=!e||t&&t.magnitude==null;return i.skipValidation||super.isValid&&(r&&!i.required||!r&&(i.allowNegative||(t==null?void 0:t.magnitude)>=0))}internalOnChange(i){const e=this,t=e.value,r=e._lastValue;e.hasChanged(r,t)&&(e._lastValue=t,e.triggerFieldChange({value:t,event:i,userAction:!0,valid:e.isValid}))}onFocusOut(i){var e,t,r;return this.syncInputFieldValue(!0),(r=(t=(e=this.triggers)==null?void 0:e.spin)==null?void 0:t.clickRepeater)==null||r.cancel(),super.onFocusOut(i)}set value(i){const e=this;let t,r;if(e.getConfig("allowedUnits"),e.clearError("L{invalidUnit}"),typeof i=="number"||typeof i=="string"&&i.length>0&&!isNaN(i))t=Number(i),r=e.unitWithDefault;else if(typeof i=="string")if(/^\s*$/.test(i))t=null;else{const n=C.parseDuration(i,e.allowDecimals,e.unitWithDefault);n&&(!e.allowedUnitsRe||e.allowedUnitsRe.test(n.unit)?(r=n.unit,t=n.magnitude):e.setError("L{invalidUnit}"))}else i&&"unit"in i&&"magnitude"in i?(r=i.unit,t=i.magnitude):(r=null,t=null);(e.magnitude!==t||e.unit!=r)&&(e._magnitude=t,r&&(e.unit=r),super.value=e.calcValue())}okMax(i){return typeof i=="number"&&(i=new we({unit:this.unitWithDefault,magnitude:i})),this.max==null||i<=this.max}okMin(i){return typeof i=="number"&&(i=new we({unit:this.unitWithDefault,magnitude:i})),this.min==null||i>=this.min}get validity(){const i=this.value,e={};return i!=null&&(e.rangeUnderflow=!this.okMin(i),e.rangeOverflow=!this.okMax(i)),e.valid=!e.rangeUnderflow&&!e.rangeOverflow,e}get value(){return super.value}calcValue(i=!1){const e=this,{magnitude:t}=e;return(!e.unit||t==null)&&e.clearable?null:new we(i?e.roundMagnitude(t):t,e.unitWithDefault)}hasChanged(i,e){return e&&!i||!e&&i||e&&i&&!(i.unit===e.unit&&i.isEqual(e))}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(i){const e=this,{_isUserAction:t}=e;e._isUserAction=!0,i.key==="ArrowUp"?e.doSpinUp():i.key==="ArrowDown"&&e.doSpinDown(),e._isUserAction=t}doSpinUp(){const i=this;let{value:e}=i;if(i.readOnly)return;T.isEmpty(e)&&(e=new we({magnitude:0,unit:this.defaultUnit}));let t=e.add(this._step);i.okMin(t)||(t=i.min),i.okMax(t)&&(i.value=t)}doSpinDown(){const i=this;let{value:e}=i;if(i.readOnly)return;T.isEmpty(e)&&(e=new we({magnitude:0,unit:this.defaultUnit}));let t=e.add({magnitude:-this._step.magnitude,unit:this._step.unit});i.okMax(t)||(t=i.max),i.okMin(t)&&(i.allowNegative||(i.magnitude||0)>0)&&(i.value=t)}changeStep(i,e){const t=typeof i;return i?(t==="number"?i={magnitude:Math.abs(i),unit:void 0}:t==="string"&&(i=C.parseDuration(i)),i&&i.unit&&i.magnitude&&i.magnitude<0&&(i={magnitude:-i.magnitude,unit:i.unit}),i):null}updateStep(i){this.element.classList.toggle("b-no-steppers",!!i),this.syncInvalid()}};y(ba,"$name","DurationField"),y(ba,"type","durationfield"),y(ba,"alias","duration"),ba.initClass(),ba._$name="DurationField";var Gt=class extends gt{afterConfigure(){const i=this;super.afterConfigure(),i.onTargetSizeChange=i.onTargetSizeChange.bind(i),V.on({element:i.element,keydown:"onEditorKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:i}),i.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide"}),Le.ion({locale:"onLocaleChange",thisObj:i})}onLocaleChange(){const{inputField:i}=this;i&&!i.isDestroyed&&(i.syncInputFieldValue?i.syncInputFieldValue(!0):i instanceof rt)}render(i){const e=this.element.parentNode,[t]=this.getRenderContext(this,i);t.classList.add("b-editing"),super.render(...arguments),e!=null&&e.classList&&t!==e&&e.classList.remove("b-editing")}async startEdit(i){var e,t,r;const n=this;if(i=T.assignIf(i,{align:n.align,hideTarget:n.hideTarget,matchSize:n.matchSize,matchFont:n.matchFont,fitTargetContent:n.fitTargetContent,focus:!0}),n.isVisible&&await n.completeEdit(),n.trigger("beforeStart",i)!==!1){const{target:s,hideTarget:a,matchSize:l,matchFont:o,fitTargetContent:d,record:c,field:u=n.inputField.name,focus:h}=i,{inputField:g,appendToTargetParent:f}=n,{input:m}=g,p=E.getStyleValue(s,"font-size"),v=E.getStyleValue(s,"font-family");let{value:b,align:w}=i;if(c&&u&&(n.record=c,n.dataField=u,g.assignFieldValue!==z.prototype.assignFieldValue?b=g.value:b===void 0&&(b=c.getValue(u))),f&&s.nodeType===Node.ELEMENT_NODE&&s.parentElement.appendChild(n.element),l&&(s instanceof HTMLElement&&n.updateSize(s,l),s instanceof HTMLElement&&Ge.addResizeListener(s,n.onTargetSizeChange)),m&&(o?(m.style.fontSize=p,m.style.fontFamily=v):m.style.fontSize=m.style.fontFamily=""),n.assigningValues=!0,(e=g.clearError)==null||e.call(g),"setValue"in g?await g.setValue(b):g.value=b,n.assigningValues=!1,typeof w=="string"&&(w={align:w}),await n.showBy({target:s,allowTargetOut:!0,...w}),d){const S=m.scrollWidth-m.clientWidth;S>0&&(n.width+=S+E.scrollBarWidth)}h&&((t=g.focus)==null||t.call(g)),s.nodeType===Element.ELEMENT_NODE&&a&&s.classList.add("b-hide-visibility"),n.editing=!0;const D=g.value;return n.trigger("start",{value:D}),Array.isArray(D)&&g.editingRecords&&((r=D[0])!=null&&r.isModel)?n.oldValue=D.map(S=>S.copy(S.id)):(n.oldValue=D,Array.isArray(n.oldValue)&&(n.oldValue=n.oldValue.slice())),g.initialValue=n.oldValue,!0}return!1}async refreshEdit(){if(this.isVisible){const{record:i,dataField:e,inputField:t,owner:r}=this;if(i&&((r!=null&&r.readOnly||i.readOnly)&&this.cancelEdit(),e)){const n=i.getValue(e);T.isEqual(t.value,n)||await t.setValue(n)}}}finishEdit(){const{target:i,aligningToElement:e}=this.lastAlignSpec;e&&(i.classList.remove("b-editing"),i.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("afterEdit",{record:this.record})}onEditorKeyDown(i){var e;const t=this;switch(i.key){case t.completeKey:{i.preventDefault(),i.stopImmediatePropagation(),t.completeEdit(null,i);break}case t.cancelKey:t.cancelEdit(i),i.stopImmediatePropagation();break}(e=t.trigger)==null||e.call(t,"keyDown",{event:i})}stopMouseEvents(i){this.allowMouseEvents||i.stopPropagation()}onFocusOut(i){super.onFocusOut(i);const e=this;if(!e.isFinishing&&e.editing)switch(e.blurAction){case"cancel":e.cancelEdit(i);break;case"complete":e.completeEdit(null,i)}}async completeEdit(i,e){var t,r,n,s;const a=this,{inputField:l,oldValue:o,record:d}=a,c=l.invalidAction||(l.allowInvalid===!1?"block":a.invalidAction),{value:u}=l;if(a.isVisible){if(!l.isValid&&c!=="allow"){if(e!=null&&e.key&&e.preventDefault(),c==="block")return(t=l.focus)==null||t.call(l),!1;if(c==="revert")return a.cancelEdit(e)!==!1}else{if(T.isEqual(u,o))return a.cancelEdit(e)!==!1;{e!=null&&e.key&&e.stopPropagation();const h={inputField:l,record:d,value:u,oldValue:o};if(await a.trigger("beforeComplete",h)===!1)(r=l.focus)==null||r.call(l);else if(i||(i=h.finalize||((n=h.editorContext)==null?void 0:n.finalize)),i){let g=await i(h);if(g===!0)a.onEditComplete();else{if(l.setError){const f=g||l.invalidValueError,m=()=>{p(),l.clearError(f)},p=l.ion({change:m,input:m});l.setError(f)}c==="block"?(s=l.focus)==null||s.call(l):c==="revert"&&(await l.setValue(o),g=!0),g=!1}return g}else return a.onEditComplete(),!0}}return!1}}cancelEdit(i){var e;const t=this,{inputField:r,oldValue:n}=t,{value:s}=r;if(t.editing&&!t.isFinishing&&t.trigger("beforeCancel",{value:s,oldValue:n,event:i})!==!1)(e=r.clearError)==null||e.call(r),t.isFinishing=!0,t.hide(),(i==null?void 0:i.key)==="Escape"&&i.stopImmediatePropagation(),t.trigger("cancel",{value:s,oldValue:n,event:i}),t.finishEdit(),t.isFinishing=!1;else return i==null||i.preventDefault(),!1}onEditComplete(){const i=this,{record:e,dataField:t,inputField:r,oldValue:n}=i;let{value:s}=r;if(!i.isFinishing){if(i.isFinishing=!0,i.hide(),e&&(!i.instantUpdate||r._outstandingUpdate)){const a=`set${O.capitalize(t)}`;e.isFieldModified(t)&&e.getUnmodified(t)==null&&(s==null||s==="")&&(s=e.meta.modified[t]),e[a]?e[a](s):e.setValue(t,s)}i.trigger("complete",{value:s,oldValue:n}),i.finishEdit(),i.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(i){this._owner=i}get owner(){return this._owner||z.fromElement(this.element.parentNode)}changeInputField(i,e){const t=this;return e&&e.destroy(),typeof i=="string"&&(i={type:i}),i instanceof z||(i.type||(i.type="textfield"),i=z.create(i),t.createdInputField=!0),t.completeOnChange&&i.ion({change:"onInputFieldChange",thisObj:t}),i.parent=t,i}updateInputField(i){this.removeAll(),this.add(i)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(i,e,t){e&&t&&this.updateSize(i)}updateSize(i,e=this.lastMatchSize){const t=this,r=L.inner(i);t.width=e.width===!1?"auto":r.width-t.align.offset[0],t.height=e.height===!1?"auto":r.height,t.lastMatchSize=e}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){var i;this.positioned&&this.element.remove(),Ge.removeResizeListener((i=this.lastAlignSpec)==null?void 0:i.target,this.onTargetSizeChange)}};y(Gt,"$name","Editor"),y(Gt,"type","editor"),y(Gt,"configurable",{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,appendToTargetParent:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0,instantUpdate:!1,floating:!1}),Gt.initClass(),Gt._$name="Editor";var Ca=class{static getLocalizedFormatter(i){return(i==null?void 0:i.style)==="currency"&&!i.currency&&(i.currency=Le.locale.NumberFormat.currency),typeof i=="string"?wi.get({locale:Le.localeCode,template:i}):(i==null?void 0:i.locale)!=null?wi.get(i):wi.get(Object.assign({},i,{locale:Le.localeCode}))}};y(Ca,"$name","NumberHelper"),Ca._$name="NumberHelper";var $k=i=>i.ctrlKey&&i.preventDefault(),wa=class extends rt{static get configurable(){return{wrapAround:null,min:null,max:null,step:1,largeStep:0,value:null,format:"",triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(i){super.construct(i);const e=this;e.input.addEventListener("dblclick",()=>{e.select()}),typeof e.changeOnSpin=="number"&&(e.bufferedSpinChange=e.buffer(e.triggerChange,e.changeOnSpin))}acceptValue(i,e){let t=!isNaN(i);if(t&&!this.hasTextSelection){t=!1;const r=this.input.value,n=parseFloat(r);r!==e&&(t=!this.acceptValue(n,r))}return t}okMax(i){return isNaN(this.max)||i<=this.max}okMin(i){return isNaN(this.min)||i>=this.min}internalOnKeyEvent(i){if(i.type==="keydown"){const e=this,t=i.key;let r;if(t==="ArrowUp")e.doSpinUp(i.shiftKey),r=!0;else if(t==="ArrowDown")e.doSpinDown(i.shiftKey),r=!0;else if(!i.altKey&&!i.ctrlKey&&t&&t.length===1){const n=e.getAfterValue(t),s=e.formatter.parseStrict(n);r=!(s===e.value||n==="-"&&(isNaN(e.min)||e.min<0))&&!e.acceptValue(s,n)}t==="Enter"&&e._changedBySilentSpin&&(e.triggerChange(i,!0),e._changedBySilentSpin=!1),r&&i.preventDefault()}super.internalOnKeyEvent(i)}doSpinUp(i=!1){const e=this,t=e.formatter.is.percent?100:1,r=(i?e.largeStep:e.step)/t;if(e.readOnly)return;let n=(e.value||0)+r;e.okMin(n)||(n=e.min),e.okMax(n)?e.applySpinChange(n):e.wrapAround&&(n=e.min,e.applySpinChange(n))}doSpinDown(i=!1){const e=this,t=e.formatter.is.percent?100:1,r=(i?e.largeStep:e.step)/t;if(e.readOnly)return;let n=(e.value||0)-r;e.okMax(n)||(n=e.max),e.okMin(n)?e.applySpinChange(n):e.wrapAround&&(n=e.max-e.max%r,e.applySpinChange(n))}applySpinChange(i){const e=this;e._isUserAction=!0,e.changeOnSpin!==!0&&(e._changedBySilentSpin=!0,e.silenceChange=!0,e.bufferedSpinChange&&e.bufferedSpinChange(null,!0)),e.value=i,e._isUserAction=!1,e.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(i){var e,t,r;super.onFocusOut(...arguments);const n=this,{input:s}=n,a=s.value,l=n.formatter.truncate(a),o=isNaN(l)?a:n.formatValue(l);(r=(t=(e=n.triggers)==null?void 0:e.spin)==null?void 0:t.clickRepeater)==null||r.cancel(),n.lastTouchmove=null,a!==o&&(s.value=o),n._changedBySilentSpin&&(n.triggerChange(i,!0),n._changedBySilentSpin=!1)}internalOnInput(i){var e;const t=this,{formatter:r,input:n}=t,{parser:s,maximumFractionDigits:a}=r,l=n.value;if((e=i.data)!=null&&e.length&&!(isFinite(s.parse(l))||l==="-")){const o=t._lastValue||t.valueOnFocus;t.queueMicrotask(()=>{t._value=NaN,t.value=o})}else{const o=s.decimalPlaces(l);if(r.truncator&&o>a){let d=l,c;const u=r.truncate(l);if(!isNaN(u)&&(d=t.formatValue(u),c=s.decimalPlaces(d),c<a&&(d+="0".repeat(a-c),c=a),c<o)){const h=l.length-t.caretPos;n.value=d,t.caretPos=d.length-h+1}}super.internalOnInput(i)}}formatValue(i){return this.formatter.format(i)}get formatter(){var i;return(i=this._formatter)!=null?i:this._formatter=Ca.getLocalizedFormatter(this.format)}updateStep(i){var e;const t=this;t.element.classList.toggle("b-hide-spinner",!i),t._step=i,i&&Y.isMobile?t.touchMoveListener||(t.touchMoveListener=V.on({element:t.input,touchmove:"onInputSwipe",thisObj:t,throttled:{buffer:150,alt:$k}})):(e=t.touchMoveListener)==null||e.call(t)}onInputSwipe(i){const{lastTouchmove:e}=this;if(e){const t=i.screenX-e.screenX,r=e.screenY-i.screenY,n=Math.abs(t)>Math.abs(r)?t:r;this[`doSpin${n>0?"Up":"Down"}`]()}i.preventDefault(),this.lastTouchmove=i}changeLargeStep(i){return i||this.step*10}get validity(){const i=this.value,e={};return i!=null&&(e.rangeUnderflow=!this.okMin(i),e.rangeOverflow=!this.okMax(i)),e.valid=!e.rangeUnderflow&&!e.rangeOverflow,e}changeValue(i,e){const t=this;if(i||i===0){let r;typeof i!="number"&&(i=typeof i=="string"?t.formatter.parse(i):Number(i),r=isNaN(i),r&&(i="")),!r&&t.format&&(i=t.formatter.round(i))}else i=void 0;return super.changeValue(i,e)}get inputValue(){return this.value!=null?this.formatValue(this.value):""}updateLocalization(){super.updateLocalization(),this._formatter=void 0,this.syncInputFieldValue()}};y(wa,"$name","NumberField"),y(wa,"type","numberfield"),y(wa,"alias","number"),wa.initClass(),wa._$name="NumberField";var Om={number:!0,boolean:!0,string:!0,date:!0,duration:!0,time:!0,auto:!0},Hk={number:!0,boolean:!0,string:!0},$m=i=>{var e;return((e=i==null?void 0:i.column)==null?void 0:e.type)==="duration"},Vk=i=>Om[i==null?void 0:i.type]||$m(i),bS="",$t="b-fieldfilterpicker",Nk={between:!0,notBetween:!0,isIncludedIn:!0,isNotIncludedIn:!0},Bk={textfield:!0,datefield:!0,numberfield:!0,durationfield:!0,combo:!0,timefield:!0},de={empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}",isArrayValued:!0},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}",isArrayValued:!0}},zk=i=>{const{value:e}=i;return i.isTimeField&&e?C.getTime(e):e},jn=class br extends gt{static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",relation:"L{selectValue}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}",time:"L{selectATime}",auto:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(`${br.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${br.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:r,caseSensitive:n}}=e;t.ion({select:"onPropertySelect",thisObj:e}),r.ion({select:"onOperatorSelect",thisObj:e}),n.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&r.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,r.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:r}=this.widgetMap;return[e,t,...this.valueFields,r]}updateDisabled(e,t){super.updateDisabled(e,t),this.allChildInputs.forEach(r=>r.disabled=e)}updateReadOnly(e){const{propertyPicker:t,operatorPicker:r}=this.widgetMap;this.allChildInputs.forEach(n=>n.readOnly=e),t.readOnly=t.readOnly||e,r.readOnly=r.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=e!=null?e:br.defaultOperators;return Object.keys(t).reduce((r,n)=>({...r,[n]:t[n].map(s=>({...s,text:this.L(s.text)}))}),{})}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes((e=this._filter)==null?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new te(`${$t}-property`,(e=this.propertyFieldConfig)==null?void 0:e.cls,{[`${$t}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new te(`${$t}-operator`,(e=this.operatorFieldConfig)==null?void 0:e.cls,{[`${$t}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){var e,t,r,n;const s=this,{valueFieldCls:a,fieldType:l,_filter:{operator:o},onValueChange:d,filterValues:c,isMultiSelectValueField:u,operatorArgCount:h,getValueFieldConfig:g,fieldIsRelation:f,triggerChangeOnInput:m}=s,p=T.merge({},br.defaultValueFieldPlaceholders,s.valueFieldPlaceholders);if(!l||!o||h===0)return[];let v={type:"textfield",internalListeners:{change:d,input:m?d:null,thisObj:s},bubbleEvents:{keydown:!0},cls:a,dataset:{type:l},placeholder:s.L(p[u?"list":f?"relation":l]),highlightExternalChange:!1};return u||f?v={...v,type:"combo",multiSelect:u,createOnUnmatched:!0,items:s.getUniqueDataValues(c),value:c!=null?c:[]}:o==="sameTime"||o==="notSameTime"?v.type="timefield":["number","date","boolean","duration","time"].includes(l)&&(v.type=`${l}field`),l==="date"&&v.type!=="timefield"?v.format=(t=(e=s.selectedField)==null?void 0:e.format)!=null?t:s.dateFormat:l==="number"&&((r=s.selectedField)!=null&&r.format)&&(v.format=(n=s.selectedField)==null?void 0:n.format),g&&(v=s.callback(g,s,[s.filter,v])),u?[v]:B.populate(h,b=>[{type:"widget",tag:"div",cls:`${$t}-value-separator`,content:s.L("L{FieldFilterPicker.and}")},{...v,value:c[b]}]).flat().slice(1)}getUniqueDataValues(e=[]){var t,r;const n=this,{fieldType:s}=n,a=(t=n.selectedField)==null?void 0:t.format;if(!n.store||!((r=n._filter)!=null&&r.property))return[];const{relatedDisplayField:l}=n.selectedField;let o,d;if(n.fieldIsRelation){const{foreignStore:c}=n.currentPropertyRelationConfig;l?(o=c.allRecords.reduce((u,h)=>(h.id!=null&&u.push({text:h.getValue(l),value:h.id}),u),[]),d=o.sort((u,h)=>n.sortStrings(u.text,h.text))):o=c.allRecords.map(u=>u.id)}else o=n.store.allRecords.map(c=>c.getValue(n._filter.property));if(!d){o.push(...e);const c=B.unique(o.reduce((u,h)=>(h!=null&&String(h).trim()!==""&&(s==="date"?u.push(h.valueOf()):s==="duration"?u.push(h.toString()):u.push(h)),u),[]));if(s==="string"?d=c.sort(n.sortStrings):s==="duration"?d=c.map(u=>new we(u)).filter(u=>u.isValid).sort(n.sortDurations):d=c.sort(n.sortNumerics),s==="date")d=d.map(u=>{const h=new Date(u);return{text:C.format(h,a!=null?a:n.dateFormat),value:u}});else if(s==="number"&&a){const u=Ca.getLocalizedFormatter(a);d=d.map(h=>({text:u.format(h),value:h}))}else s==="duration"&&(d=d.map(u=>u.toString()))}return d}sortStrings(e,t){return(e!=null?e:bS).localeCompare(t!=null?t:bS)}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return(e=this.selectedField)==null?void 0:e.type}get selectedField(){var e,t;return(t=this.fields)==null?void 0:t[(e=this._filter)==null?void 0:e.property]}get propertyOptions(){var e;return Object.entries((e=this.fields)!=null?e:{}).filter(([,t])=>Om[t.type]||$m(t)).map(([t,{title:r}])=>({value:t,text:r!=null?r:t})).sort((t,r)=>t.text.localeCompare(r.text))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return!!this.currentPropertyRelationConfig}get currentPropertyRelationConfig(){var e,t;return(t=(e=this.store)==null?void 0:e.modelRelations)==null?void 0:t.find(({foreignKey:r})=>{var n;return r===((n=this._filter)==null?void 0:n.property)})}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=br.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;(t=this._store)==null||t.un(this),e==null||e.ion({refresh:"onStoreRefresh",thisObj:this}),this.inferFieldTypes()}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFields:t}=e.widgetMap,{valueFields:r,fieldType:n,operatorArgCount:s,_filter:{property:a,operator:l}}=e,o=Nk[l],d=l==="sameTime"||l==="notSameTime"?"time":n;t.element.className=new te({[`${$t}-values`]:!0,[`${$t}-values-multiple`]:o,[`${$t}-values-${d}`]:n!==void 0,"b-hidden":a==null||l==null||s===0});const c=e.getValueFieldConfigs();if(c.length!==r.length||c.some(({type:u},h)=>r[h].type!==u))t.removeAll(),t.add(c);else{let u=0;for(const h of c)delete h.type,T.assign(r[u++],h)}delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const r=this,{fieldType:n,operatorArgCount:s,isMultiSelectValueField:a}=r,l=(e=r._filter)==null?void 0:e.operator,{caseSensitive:o}=r.widgetMap;o.hidden=n!=="string"||!l||a||s===0,o.checked=((t=r._filter)==null?void 0:t.caseSensitive)!==!1}onPropertySelect(e){var t;const r=this,{_filter:n}=r;n.property=((t=e.record)==null?void 0:t.data.value)||null,r.fieldType!==r._fieldType&&(n.operator=null,n.value=null),r._fieldType=n.type=r.fieldType,r.refreshOperatorPicker(),r.refreshValueFields(),r.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const r=this,n=r.isMultiSelectValueField,s=this.operatorArgCount;r._filter.operator=((t=e.record)==null?void 0:t.data.value)||null,r.operatorArgCount!==s&&(r._filter.value=null),r.isMultiSelectValueField&&!n&&(r._filter.value=[]),r.refreshValueFields(),r.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const e=this,{isMultiSelectValueField:t,fieldType:r,_filter:n}=e,s=this.valueFields.map(zk);t&&r==="date"?n.value=s[0].map(a=>new Date(a)):t&&r==="duration"?n.value=s[0].map(a=>new we(a)):(r==="date"&&n.operator==="between"&&C.isValidDate(s[1])&&s[1].setHours(23,59,59,999),n.value=s.length===1?s[0]:s),e.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:r},operatorOptions:n}=this;e.items=n,e.value=t,e.hidden=r===null}populateUIFromFilter(e=!1){const t=this,{filterValues:r,widgetMap:{propertyPicker:n,operatorPicker:s},_filter:{property:a,operator:l,disabled:o},propertyOptions:d,operatorOptions:c,isMultiSelectValueField:u}=t;n.items=d,s.items=c,s.hidden=a===null;let h=e;n.value!==a&&(n.value=a,t.refreshOperatorPicker(),h=!0),t.fieldType==="date"&&(l==="="?t._filter.operator="sameDay":l==="!="&&(t._filter.operator="notSameDay")),s.value!==l&&(l===null||!s.items.find(({value:g})=>g===l)?s.clear():s.value=l,h=!0),!l&&s.items.length===1&&(s.value=t._filter.operator=s.items[0].value),h&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach((g,f)=>{u&&(g.value.length>0||r.length>0)?t.fieldType==="date"?g.value=r.map(m=>m==null?void 0:m.valueOf()):t.fieldType==="duration"?g.value=r.map(m=>m==null?void 0:m.toString()):g.value=r:f>=r.length?g.clear():g.value=r[f]}),t.allChildInputs.forEach(g=>g.disabled=t.disabled||o)}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFields.queryAll(e=>e.owner===this.widgetMap.valueFields&&Bk[e.type]))}get filterValues(){var e;return((e=this._filter)==null?void 0:e.value)==null?[]:B.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,r=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(r)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:r}=this;return e&&t?r[e][t]:1}get isValid(){const e=this,{filter:t,fieldType:r,filterValues:n,isMultiSelectValueField:s,operatorArgCount:a}=e,{operator:l}=t,o=a>0&&(t==null?void 0:t.value)==null;return!!(r&&l&&!o&&(s&&n.length>0||n.length===a)&&n.every(d=>d!=null&&(r!=="duration"||d.isValid)))}get focusElement(){var e,t,r,n;return(n=(r=(t=(e=this.valueFields.find(s=>s.isEmptyInput))!=null?e:this.operatorPicker)!=null?t:this.propertyPicker)==null?void 0:r.input)!=null?n:super.focusElement}inferFieldTypes(){var e;if(((e=this.store)==null?void 0:e.totalCount)>0&&this.fields)for(const[t,r]of Object.entries(this.fields))r.type==="auto"&&(r.type=br.inferFieldType(this.store,t))}static inferFieldType(e,t){var r;const n=(r=e.find(s=>s.getValue(t)!=null,!0))==null?void 0:r.getValue(t);if(n!==void 0){const s=typeof n;if(s==="object"&&n instanceof Date)return"date";if(Hk[s])return s}return"auto"}static localizeOperator(e,t){const{defaultOperators:r}=br,n=Object.keys(r).sort((s,a)=>s===t?-1:a===t?1:0);for(const s of n)for(const a of r[s])if(a.value===e)return br.L(a.text);return e}};y(jn,"$name","FieldFilterPicker"),y(jn,"type","fieldfilterpicker"),y(jn,"defaultOperators",{string:[de.empty,de.notEmpty,de["="],de["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},de.isIncludedIn,de.isNotIncludedIn],number:[de.empty,de.notEmpty,de["="],de["!="],de[">"],de["<"],de[">="],de["<="],de.between,de.notBetween,de.isIncludedIn,de.isNotIncludedIn],date:[de.empty,de.notEmpty,{value:"sameDay",text:"L{equals}"},{value:"notSameDay",text:"L{doesNotEqual}"},{value:"sameTime",text:"L{timeEquals}"},{value:"notSameTime",text:"L{timeDoesNotEqual}"},{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},de.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},de.isIncludedIn,de.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[de.empty,de.notEmpty,de["="],de["!="],de[">"],de["<"],de[">="],de["<="],de.between,de.notBetween,de.isIncludedIn,de.isNotIncludedIn],time:[de.empty,de.notEmpty,de["="],de["!="],de[">"],de["<"],de[">="],de["<="],de.between,de.notBetween,de.isIncludedIn,de.isNotIncludedIn],relation:[de.empty,de.notEmpty,de["="],de["!="],de.isIncludedIn,de.isNotIncludedIn],auto:[{value:"*",text:"L{contains}"}]}),y(jn,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,triggerChangeOnInput:!0,items:{inputs:{type:"container",layout:"hbox",cls:`${$t}-inputs`,items:{propertyPicker:{type:"combo",items:{},cls:`${$t}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}",highlightExternalChange:!1},operatorPicker:{type:"combo",items:{},cls:`${$t}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}",highlightExternalChange:!1},valueFields:{type:"container",cls:`${$t}-values`,items:{}}}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`${$t}-case-sensitive`}},operators:jn.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),y(jn,"buildOperatorArgCountLookup",i=>B.keyBy(Object.entries(i),([e])=>e,([,e])=>B.keyBy(e,({value:t})=>t,({argCount:t})=>t===void 0?1:t)));var Ai=jn;Ai.initClass(),Ai._$name="FieldFilterPicker";var Sa=class extends z{compose(){const{text:i,html:e}=this;return{tag:"label",text:i,html:e}}};y(Sa,"$name","Label"),y(Sa,"type","label"),y(Sa,"configurable",{text:null,localizableProperties:["text"]}),Sa.initClass(),Sa._$name="Label";var Hr=class wo extends gt{afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}updateFields(e){this.widgetMap.pickers.childItems.forEach(t=>t.fields=e)}updateFilters(e,t){const r=this;t&&t.filter(n=>!e.find(s=>s.id===n.id)).forEach(n=>{var s;return(s=r.store)==null?void 0:s.removeFilter(n.id)}),e.forEach(n=>n.id=n.id||r.nextFilterId),r.widgetMap.pickers.items=(e==null?void 0:e.map(n=>r.getPickerRowConfig(n)))||[]}changeFilters(e){const{canManageFilter:t,limitToProperty:r}=this;let n=e;return t&&(n=n.filter(s=>this.callback(t,this,[s]))),r&&(n=n.filter(s=>s.property==null||s.property===r)),n}updateStore(e){const t=this;if(t.detachListeners("store"),e){let r=!1;t.widgetMap.pickers.childItems.forEach(({widgetMap:{filterPicker:{filter:n,isValid:s}}})=>{s&&!e.filters.includes(n)&&(e.removeFilter(n.id,!0),e.addFilter(n,!0),r=!0)}),r&&e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})}t.widgetMap.pickers.childItems.forEach(r=>r.store=e)}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e!=null?e:wo.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach(t=>{var r;const n=e.canManage(t),{property:s,operator:a,id:l}=t;n&&s&&a&&!((r=e.filters)!=null&&r.find(o=>o.id===l))&&e.appendFilter(t)})}canManage(e){const t=this;return(!t.allowedFieldNames||t.allowedFieldNames.includes(e.property))&&(!t.canManageFilter||t.callback(t.canManageFilter,t,[e])===!0)}getFilterPickerConfig(e){const t=this,{fields:r,store:n,disabled:s,readOnly:a,valueFieldCls:l,operators:o,limitToProperty:d,dateFormat:c,getFieldFilterPickerConfig:u,triggerChangeOnInput:h,allowedFieldNames:g}=t;return{type:t.constructor.childPickerType,fields:r!=null?r:t.getFieldsFromStore(n),filter:e,store:n,disabled:s,readOnly:a,propertyLocked:!!d,valueFieldCls:l,operators:o,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,triggerChangeOnInput:h,allowedFieldNames:g,...u?t.callback(u,t,[e]):void 0}}getFieldsFromStore(e){var t,r;return Object.fromEntries((r=(t=e.modelClass)==null?void 0:t.fields.map(({name:n,type:s})=>[n,{type:s}]))!=null?r:[])}getPickerRowConfig(e){const t=this,{disabled:r,readOnly:n,canDeleteFilter:s}=t,a=!(s&&t.callback(s,t,[e])===!1),l=!e.disabled;return{type:"container",layout:"box",cls:{[`b-${wo.type}-row`]:!0,[`b-${wo.type}-row-removable`]:a},dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:r,readOnly:n,checked:l,ariaLabel:t.L("L{FieldFilterPickerGroup.applyCond}",l),internalListeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${wo.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:r,readOnly:n,hidden:!a,cls:`b-transparent b-${wo.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll(t=>e.includes(t.type))}updateDisabled(e,t){super.updateDisabled(e,t),this.allInputs.forEach(r=>r.disabled=e)}updateReadOnly(e){this.allInputs.forEach(t=>t.readOnly=e)}onFilterActiveChange({source:e,checked:t}){const r=this,n=r.getFilterIndex(e),s=r.filters[n],a=r.getFilterPicker(n);e.input.setAttribute("aria-label",r.L("L{FieldFilterPickerGroup.applyCond}",t)),s.disabled=!t,a.onFilterChange(),r.store&&a.isValid&&(r.store.addFilter(s,!0),r.updateStoreFilter()),r.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:r}){const n=this,{store:s}=n,a=n.getFilterIndex(e);s&&(s.removeFilter(t.id,!0),r&&(s.addFilter(t,!0),n.updateStoreFilter())),Object.assign(n.filters[a],t),n.triggerChange()}getFilterIndex(e){return parseInt(e.parent.element.dataset.itemIndex)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,r=t.getFilterIndex(e),n=t.filters[r],s=t.getPickerRow(r),a=t.query(l=>l.isFocusable&&l.type!=="container"&&!s.contains(l));a&&a.focus(),t.removeFilterAt(r),t.store&&(t.store.removeFilter(n.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:n}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:r=null}={}){var n;const s=this,{filters:a}=s,l={property:s.limitToProperty||e,operator:t,value:r,disabled:!1,id:s.nextFilterId,caseSensitive:!1};s.trigger("beforeAddFilter",{filter:l})&&(s.appendFilter(l),s.getFilterPicker(a.length-1).isValid&&((n=s.store)==null||n.addFilter(l,!0),s.store&&s.updateStoreFilter()),s.trigger("add",{filter:l}),s.triggerChange())}appendFilter(e){const t=this;(!t.limitToProperty||e.property===t.limitToProperty)&&(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:r}=e,n=r.values.reduce((s,a)=>({...s,[a.id]:a}),{});for(let s=t.filters.length-1;s>=0;s--){const a=t.filters[s],l=n[a.id],o=t.getPickerRow(s);if(o){const{filterPicker:d,activeCheckbox:c}=o.widgetMap;if(!l&&d.isValid)t.removeFilterAt(s);else if(l!==void 0){const{operator:u,value:h,property:g,disabled:f,caseSensitive:m}=l;a!==l&&Object.assign(a,{operator:u,value:h,property:g,disabled:f,caseSensitive:m}),d.filter=a,d.onFilterChange(),c.checked=!f}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:r}=this;t.remove(t.childItems[e]),r.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,(e=this.store)==null||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,t=e.filter((r,n)=>this.getPickerRow(n).widgetMap.filterPicker.isValid);this.trigger("change",{filters:e,validFilters:t})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:r,store:n}=t;r.forEach((s,a)=>{if(e===s.disabled){const{filterPicker:l,activeCheckbox:o}=t.getPickerRow(a).widgetMap;s.disabled=!e,l.onFilterChange(),o.checked=e,e&&n&&l.isValid&&n.addFilter(s,!0)}}),t.updateStoreFilter()}get focusElement(){var e,t;return(t=(e=this.getPickerRow(this._filters.length-1))==null?void 0:e.widgetMap.filterPicker.focusElement)!=null?t:super.focusElement}};y(Hr,"$name","FieldFilterPickerGroup"),y(Hr,"type","fieldfilterpickergroup"),y(Hr,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),y(Hr,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,triggerChangeOnInput:!0,allowedFieldNames:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:Hr.addFilterButtonDefaultText,cls:`b-${Hr.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),y(Hr,"childPickerType","fieldfilterpicker");var fh=Hr;fh.initClass(),fh._$name="FieldFilterPickerGroup";var bd=class extends rt{static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(i){this.triggerFieldChange({event:i,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}};y(bd,"$name","FileField"),y(bd,"type","filefield"),bd.initClass(),bd._$name="FileField";var Da=class extends gt{construct(i={}){const e=this;i.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},i.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},i.fileFieldConfig)].concat(i.items||[]),super.construct(i),e.button.ion({click:e.onButtonClick,thisObj:e}),e.fileField.ion({change:e.onFileFieldChange,thisObj:e}),e._thisIsAUsedExpression(e.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const i=this;return i._fileTip||(i._fileTip=new ve({cls:"b-file-tip",forElement:i.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const e=this,t=i.files;return t&&t.length?(e.html=`${Array.from(t).map(r=>O.encodeHtml(r.name)).join("<br>")}`,!0):!1}}}))}clear(){const i=this;i.fileField.clear(),i.updateBadge(),i.trigger("clear")}onButtonClick({event:i}){this.fileField.pickFile(),i.preventDefault()}onFileFieldChange({valid:i}){const e=this;e.updateBadge(),e.triggerFieldChange({files:e.files,valid:i})}updateShowBadge(){this.isConfiguring||this.updateBadge()}updateBadge(){this.button.badge=this.showBadge&&this.files.length||""}};y(Da,"$name","FilePicker"),y(Da,"type","filepicker"),y(Da,"configurable",{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null,showBadge:!0}),Da.initClass(),Da._$name="FilePicker";var Cd=class extends oi{static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,ignoreParentReadOnly:!0,keyStrokeChangeDelay:100,internalListeners:{change:"onInternalChange"}}}updateValue(i,e){super.updateValue(i,e),i&&this.isConfiguring&&this.onInternalChange({value:i})}onInternalChange({value:i}){const{store:e,field:t,filterFunction:r}=this;if(e){const n=`${t||this.id}-Filter`;if(i.length===0)e.removeFilter(n);else{let s;r?s=a=>r(a,i):(i=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=a=>{var l;return(l=a.getValue(t))==null?void 0:l.match(new RegExp(i,"i"))}),e.filter({id:n,filterBy:s})}}}};y(Cd,"$name","FilterField"),y(Cd,"type","filterfield"),Cd.initClass(),Cd._$name="FilterField";var CS=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];Y.isWindows&&CS.reverse();var Hm=class IE extends ft{static get configurable(){return{ui:"plain",centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"\xA0",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:CS}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return z.reconfigure(t,e),t.value=e==null?void 0:e.value,this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:r="",cancelButton:n,okButton:s,align:a,modal:l,rootElement:o=document.body}){const d=this;return d.rootElement=o,d.getConfig("lazyItems"),d.title=d.optionalL(r),d.widgetMap.message.html=d.optionalL(t),d.showClass=`b-messagedialog-${e}`,d.modal=typeof l=="boolean"?l:!0,d.centered=!a,s&&(s=typeof s=="string"?{text:s}:s),n&&(n=typeof n=="string"?{text:n}:n),s=Object.assign({},d.widgetMap.okButton.initialConfig,s),n=Object.assign({},d.widgetMap.cancelButton.initialConfig,n),s.text=d.optionalL(s.text),n.text=d.optionalL(n.text),z.reconfigure(d.widgetMap.okButton,s),z.reconfigure(d.widgetMap.cancelButton,n),d.show({align:a}),d.promise=new Promise(c=>{d.resolve=c})}show(){const e=E.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:IE.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:r}=this.element;t&&r.remove(t),e&&r.add(e)}doResolve(e){const t=this,{resolve:r}=t;if(r){const n=t.showClass==="b-messagedialog-prompt";if(n&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,r(n?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){e.key==="Escape"?(e.stopImmediatePropagation(),this.onCancelClick()):e.key==="Enter"&&!e.target.closest(".b-button")&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(Vm.okButton)}onCancelClick(){this.doResolve(Vm.cancelButton)}};y(Hm,"$name","MessageDialog"),y(Hm,"type","messagedialog");var wS=Hm;wS.initClass();var Vm=new Proxy({},{get(i,e){const t=i.instance||(i.instance=new wS({rootElement:document.body})),r=t[e];return typeof r=="function"?r.bind(t):r}}),Ea=Vm,xa=class extends kn{static get defaultConfig(){return{defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(i){super.parent=i,this.store||(this.store=i.store)}get parent(){return super.parent}changeStore(i){var e;return typeof i=="string"?(e=this.parent)==null?void 0:e[i]:i}updateStore(i){const e=this;e.detachListeners("store"),i&&(i.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:e}),i.isLoading&&e.onStoreBeforeRequest())}onStoreBeforeRequest(){this.eachWidget(i=>i.disable())}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const i=this,{pageCount:e,dataSummary:t}=i.widgetMap;let r=0,n=0,s=0,a=0,l=0;if(i.store){const{store:o}=i,{pageSize:d,currentPage:c}=o;r=o.count,n=o.lastPage,l=o.totalCount,s=Math.max(0,(c-1)*d+1),a=Math.min(l,s+d-1)}e.html=i.L("L{pageCountTemplate}")({lastPage:n}),t&&(t.html=r?i.L("L{summaryTemplate}")({start:s,end:a,allCount:l}):i.L("L{noRecords}"))}onStoreChange(){const i=this,{widgetMap:e,store:t}=i,{count:r,lastPage:n,currentPage:s}=t,{pageNumber:a,pageCount:l,firstPageButton:o,previousPageButton:d,nextPageButton:c,lastPageButton:u,dataSummary:h}=e;i.eachWidget(g=>g.enable()),a.value=s,a.max=n,h&&(h.disabled=!r),a.disabled=l.disabled=!r,o.disabled=d.disabled=s<=1||!r,c.disabled=u.disabled=s>=n||!r,i.updateSummary()}onPageNumberChange({value:i}){this.store.currentPage!==i&&this.store.loadPage(i)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}};y(xa,"$name","PagingToolbar"),y(xa,"type","pagingtoolbar"),y(xa,"configurable",{store:null}),xa.initClass(),xa._$name="PagingToolbar";var Ra=class extends rt{construct(i={}){i.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}};y(Ra,"$name","PasswordField"),y(Ra,"type","passwordfield"),y(Ra,"alias","password"),Ra.initClass(),Ra._$name="PasswordField";var Wk={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1},wd=class extends z{static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0,autoClose:!1}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value",twinSyncConfigs:["max","min","step","value"],label:null,labelWidth:null}}compose(){const{id:i,min:e,max:t,showValue:r,step:n,text:s,value:a,unit:l="",disabled:o,readOnly:d,label:c}=this,u=`${i}-input`,h=!!(s||r),g=n<1?a.toFixed(2):a;return{class:{"b-has-field-label":c,"b-has-label":h,"b-label-before":h,"b-text":h,"b-disabled":o},children:{inputLabel:c?{tag:"label",for:u,text:c,style:{width:this.labelWidth}}:null,input:{tag:"input",type:"range",id:u,reference:"input",[o?"disabled":""]:o,[d?"readOnly":""]:d,min:e,max:t,step:n,value:a,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},valueLabel:h?{tag:"label",class:"b-slider-value",for:u,text:r?s?`${s} (${g}${l})`:g+l:s}:null}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(i){!this.readOnly&&Wk[i.key]&&i.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const i=this;if(i.readOnly){i.input.value=i.value;return}i.value=i.step<1?parseFloat(i.input.value):parseInt(i.input.value,10),i.trigger("input",{value:i.value}),i.triggerChangeOnInput&&i.triggerChange(i)}onInternalMouseOver(){var i;const e=this,t=e.rtl?100-e.percentProgress:e.percentProgress;(i=e.tooltip)==null||i.showBy({target:L.from(e.input).inflate(e.thumbSize/2,-e.thumbSize/2),align:`b-t${Math.round(t)}`})}onInternalMouseOut(){var i;(i=this.tooltip)==null||i.hide()}triggerChange(i){this.triggerFieldChange({value:this.value,valid:!0,userAction:i})}updateMax(i){const e=this;e.input&&e._value>i&&(e.value=i,e.trigger("input",{value:e.value}))}updateMin(i){const e=this;e.input&&e._value<i&&(e.value=i,e.trigger("input",{value:e.value}))}changeTooltip(i,e){var t;i&&(i.owner=this);const{value:r}=this,n=this.step<1?r.toFixed(2):r;return this.showTooltip?ve.reconfigure(e,i,{owner:this,defaults:{forElement:this.input,html:`${n}${(t=this.unit)!=null?t:""}`}}):null}changeValue(i){const e=this,{min:t,step:r}=e;return i=Math.min(Math.max(i,t),e.max),i>t?t+T.roundTo(i-t,r):T.roundTo(i,r)}updateValue(i){var e;const t=this,{input:r,_tooltip:n}=t,s=t.step<1?i.toFixed(2):i;r&&r.value!==String(i)&&(r.value=i,t.triggerChange(!1)),t.updateUI(),n&&(n.html=`${s}${(e=t.unit)!=null?e:""}`)}updateUI(){var i,e;const t=this;(i=t._tooltip)!=null&&i.isVisible&&((e=t._tooltip)==null||e.alignTo({target:L.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(t.percentProgress)}`}))}};y(wd,"$name","Slider"),y(wd,"type","slider"),wd.initClass(),wd._$name="Slider";var Sd=class extends Qi{static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(i){i.checked&&(i.cls=te.from(i.cls)||{},i.cls[this.constructor.properties.toggledCls]=1),super.construct(i)}get innerElements(){const i=super.innerElements;return i.splice(1,0,this.toggleElement),this.text?i[i.length-1].class="b-slidetoggle-label":i.pop(),i}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}};y(Sd,"$name","SlideToggle"),y(Sd,"type","slidetoggle"),Sd.initClass(),Sd._$name="SlideToggle";var SS=["b-horizontal","b-vertical"],Vr=i=>E.getStyleValue(i.parentElement,"display")==="flex"&&(parseInt(E.getStyleValue(i,"flex-basis"),10)||parseInt(E.getStyleValue(i,"flex-grow"),10)),jk={horizontal:!1,vertical:!0},tr=class extends z{static get configurable(){return{orientation:"auto",showButtons:!1,vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var i;(i=this.mouseDetacher)==null||i.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},children:this.showButtons?[Y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-splitter-inner",children:[{className:"b-splitter-buttons",reference:"splitterButtons",children:[{className:"b-splitter-button-collapse",reference:"collapseButton",children:[Y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"i",className:"b-icon b-icon-collapse-left b-splitter-collapse-arrow b-splitter-button-icon"}]},{className:"b-splitter-button-expand",reference:"expandButton",children:[Y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"i",className:"b-icon b-icon-collapse-right b-splitter-expand-arrow b-splitter-button-icon"}]}]}]}]:null,listeners:{pointerdown:"onMouseDown",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousewheel:"onScroll",dblclick:"onDoubleClick",...!Y.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}getSibling(i=!0){let{element:e}=this,t;for(;!t&&(e=e[`${i?"next":"previous"}ElementSibling`]);)(!e.isConnected||E.isVisible(e))&&(t=e);return t}get nextWidget(){let{element:i}=this,e;for(;!e&&(i=i.nextElementSibling);)e=z.fromElement(i,this.element.parentElement);return e}get previousWidget(){let{element:i}=this,e;for(;!e&&(i=i.previousElementSibling);)e=z.fromElement(i,this.element.parentElement);return e}get nextSplitter(){let{element:i}=this,e;for(;!e&&(i=i==null?void 0:i.nextElementSibling);){const t=z.fromElement(i,this.element.parentElement);(t==null?void 0:t.type)==="splitter"&&(e=t)}return e}get previousSplitter(){let{element:i}=this,e;for(;!e&&(i=i==null?void 0:i.previousElementSibling);){const t=z.fromElement(i,this.element.parentElement);(t==null?void 0:t.type)==="splitter"&&(e=t)}return e}updateContainerElement(i){var e;const t=this;t.stateDetector=(e=t.stateDetector)==null?void 0:e.disconnect(),i&&(t.stateDetector=new MutationObserver(()=>t.syncState()),t.stateDetector.observe(i,{attributes:!0,childList:!0}))}updateNextNeighbor(i){this.watchNeighbor(i,"next")}updatePreviousNeighbor(i){this.watchNeighbor(i,"previous")}watchNeighbor(i,e){this.detachListeners(e),i==null||i.ion({name:e,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(i){var e;const t=(e=this.element)==null?void 0:e.classList;t==null||t.add(SS[i?1:0]),t==null||t.remove(SS[i?0:1])}syncState(i){var e,t,r,n,s,a,l;const o=this,{element:d,nextWidget:c,previousWidget:u,nextSplitter:h,previousSplitter:g}=o;let f=(e=jk[o.orientation])!=null?e:null;if(o.nextNeighbor=c,o.previousNeighbor=u,o.disabled=!o.showButtons&&(c&&(c.collapsible&&c.collapsed||c.hidden)||u&&(u.collapsible&&u.collapsed||u.hidden)),((t=h==null?void 0:h.collapseState)==null?void 0:t.status)==="collapsed"||((r=g==null?void 0:g.collapseState)==null?void 0:r.status)==="expanded"||((n=o.collapseState)==null?void 0:n.status)==="collapsed"||((s=o.collapseState)==null?void 0:s.status)==="expanded"?o.element.classList.add("b-drag-disabled"):o.element.classList.remove("b-drag-disabled"),(i==null?void 0:i.type)==="expand"&&o.showButtons?(((i==null?void 0:i.source)===u&&((a=o.collapseState)==null?void 0:a.status)==="collapsed"||(i==null?void 0:i.source)===c&&((l=o.collapseState)==null?void 0:l.status)==="expanded")&&(o.collapseState=null,d.classList.remove("b-drag-disabled","b-show-buttons")),o.setSplitterButtonPosition(),o.setButtonVisibility()):(i==null?void 0:i.type)==="collapse"&&o.showButtons&&(i.source===u&&!o.collapseState?o.collapseState={status:"collapsed"}:i.source===c&&!o.collapseState&&(o.collapseState={status:"expanded"}),d.classList.add("b-drag-disabled","b-show-buttons"),o.setSplitterButtonPosition(),o.setButtonVisibility()),f!==null&&c&&u)o.containerElement=null;else if(o.containerElement=d.parentElement,o.rendered&&d.offsetParent){const m=E.getStyleValue(d.parentElement,"flex-direction");if(m)f=!m.startsWith("column");else{const p=d.previousElementSibling,v=d.nextElementSibling;if(!p||!v)return;const b=p.getBoundingClientRect(),w=v.getBoundingClientRect(),D=b.top<w.top?b:w,S=D===w?b:w;f=D.top===S.top}}o.vertical=f}setButtonVisibility(){var i,e,t,r,n,s;const{showButtons:a,collapseState:l,collapseButton:o,expandButton:d,nextWidget:c,previousWidget:u,nextSplitter:h,previousSplitter:g}=this;a==="start"||a==="end"?(l==null?void 0:l.status)==="collapsed"||(l==null?void 0:l.status)==="expanded"?(o.classList.toggle("b-disabled",l.status==="collapsed"),d.classList.toggle("b-disabled",l.status==="expanded")):(o.classList.toggle("b-disabled",a!=="start"&&!(u!=null&&u.collapsible)||((i=g==null?void 0:g.collapseState)==null?void 0:i.status)==="expanded"),d.classList.toggle("b-disabled",a!=="end"&&!(c!=null&&c.collapsible)||((e=h==null?void 0:h.collapseState)==null?void 0:e.status)==="collapsed")):(o.classList.toggle("b-disabled",!a||(l==null?void 0:l.status)==="collapsed"||((t=g==null?void 0:g.collapseState)==null?void 0:t.status)==="expanded"),d.classList.toggle("b-disabled",!a||(l==null?void 0:l.status)==="expanded"||((r=h==null?void 0:h.collapseState)==null?void 0:r.status)==="collapsed")),(l==null?void 0:l.status)!=="expanded"&&((n=g==null?void 0:g.collapseState)==null?void 0:n.status)==="collapsed"?g.setButtonVisibility():(l==null?void 0:l.status)!=="collapsed"&&((s=h==null?void 0:h.collapseState)==null?void 0:s.status)==="expanded"&&h.setButtonVisibility()}setSplitterButtonPosition(i=0){const{vertical:e,splitterButtons:t,element:{parentElement:r}}=this;if(e){const n=r.clientHeight,s=r.scrollTop+i,a=Math.min(Math.max(0,s),r.scrollHeight-n)+n/2;t.style.top=`${a}px`}else{const n=r.clientWidth,s=r.scrollLeft+i,a=Math.min(Math.max(0,s),r.scrollWidth-n)+n/2;t.style.left=`${a}px`}}restoreOriginalState(){const{nextNeighbor:i,previousNeighbor:e,collapseState:t,vertical:r}=this,n=e?e.element:this.getSibling(!1),s=i?i.element:this.getSibling();t&&(r?(t.prevHasFlex?n.style.flexGrow=t.prevFlexGrow:n.style.width=`${t.prevWidth}px`,t.nextHasFlex?s.style.flexGrow=t.nextFlexGrow:s.style.width=`${t.nextWidth}px`):(t.prevHasFlex?n.style.flexGrow=t.prevFlexGrow:n.style.height=`${t.prevHeight}px`,t.nextHasFlex?s.style.flexGrow=t.nextFlexGrow:s.style.height=`${t.nextHeight}px`))}lockFlexedSiblings(){var i;const e=[];for(const t of this.element.parentElement.children)Vr(t)&&t!==this.element&&((i=z.fromElement(t,this.element.parentElement))==null?void 0:i.type)!=="splitter"&&e.push({child:t,width:t.offsetWidth,height:t.offsetHeight});for(const t of e)t.child.style.flexGrow=this.vertical?t.width:t.height,t.child.style.flexBasis=0}onDoubleClick({ctrlKey:i}){(i?this.element.parentElement.querySelectorAll(":scope > :not(.b-splitter)"):[this.getSibling(!1),this.getSibling()]).forEach(t=>t&&(t.style.flex="1 1 0px"))}onMouseDown(i){var e,t,r,n,s,a;const l=this,{target:o}=i;o.closest(".b-splitter-button-collapse")?l.onCollapseClick(i):o.closest(".b-splitter-button-expand")?l.onExpandClick(i):((e=l.collapseState)==null?void 0:e.status)!=="collapsed"&&((t=l.collapseState)==null?void 0:t.status)!=="expanded"&&((n=(r=l.nextSplitter)==null?void 0:r.collapseState)==null?void 0:n.status)!=="collapsed"&&((a=(s=l.previousSplitter)==null?void 0:s.collapseState)==null?void 0:a.status)!=="expanded"&&l.startMove(i)}startMove(i){var e,t;i.preventDefault(),i.touches&&(i=i.touches[0]);const r=this,{element:n,nextNeighbor:s,previousNeighbor:a}=r,l=a?a.element:r.getSibling(!1),o=s?s.element:r.getSibling(),d=Vr(l),c=Vr(o),u=[];(e=r.mouseDetacher)==null||e.call(r),r.showButtons&&(r.collapseState=null,r.setButtonVisibility());for(const g of n.parentElement.children)Vr(g)&&g!==n&&((t=z.fromElement(g,n.parentElement))==null?void 0:t.type)!=="splitter"&&u.push({element:g,width:g.offsetWidth,height:g.offsetHeight});r.context={startX:i.pageX,startY:i.pageY,prevWidth:l.offsetWidth,prevHeight:l.offsetHeight,nextWidth:o.offsetWidth,nextHeight:o.offsetHeight,prevHasFlex:d,nextHasFlex:c,flexed:u,prev:l,next:o};const h={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:r};Y.supportsPointerEvents||(h.mousemove=h.touchmove="onMouseMove",h.mouseup=h.touchend="onMouseUp"),n.classList.add("b-moving"),r.mouseDetacher=V.on(h),r.trigger("splitterMouseDown",{event:i})}onMouseEnter(i){const e=this;e.syncState(),e.trigger("splitterMouseEnter",{event:i}),e.showButtons&&(e.setSplitterButtonPosition(),e.setButtonVisibility()),e.element.classList.add("b-hover")}onMouseLeave(i){this.trigger("splitterMouseLeave",{event:i}),this.element.classList.remove("b-hover")}onMouseMove(i){const{context:e,nextWidget:t,previousWidget:r,vertical:n,rtl:s}=this,a=e.prev.style,l=e.next.style,o=(i.pageX-e.startX)*(s?-1:1),d=i.pageY-e.startY;if(i.preventDefault(),Object.assign(e,{deltaX:o,deltaY:d}),e.started||(e.started=!0,this.trigger("dragStart",{context:e,event:i}),e.flexed.forEach(c=>{c.element.style.flexGrow=n?c.width:c.height,c.element.style.flexBasis="0"})),n){const c=e.prevWidth+o,u=e.nextWidth-o;e.prevHasFlex?a.flexGrow=c:r?r.width=c:a.width=`${c}px`,e.nextHasFlex?l.flexGrow=u:t?t.width=u:l.width=`${u}px`}else{const c=e.prevHeight+d,u=e.nextHeight-d;e.prevHasFlex?a.flexGrow=c:r?r.height=c:a.height=`${c}px`,e.nextHasFlex?l.flexGrow=u:t?t.height=u:l.height=`${u}px`}this.trigger("drag",{context:e,event:i})}onMouseUp(i){var e;const t=this;(e=t.mouseDetacher)==null||e.call(t),t.mouseDetacher=null,t.element.classList.remove("b-moving"),t.context.started&&t.trigger("drop",{context:t.context,event:i}),t.context=null}onScroll(i){const{deltaY:e,shiftKey:t}=i,{vertical:r}=this;(t&&!r||!t&&r)&&this.setSplitterButtonPosition(e)}onCollapseClick(i){var e,t,r,n,s;const a=this,{nextNeighbor:l,nextWidget:o,previousNeighbor:d,previousWidget:c,collapseState:u,showButtons:h,vertical:g}=a,f=d?d.element:a.getSibling(!1),m=l?l.element:a.getSibling(),p=Vr(f),v=Vr(m);if(h==="end"&&!(c!=null&&c.collapsible)&&(u==null?void 0:u.status)!=="expanded"||(u==null?void 0:u.status)==="collapsed")return;i.stopPropagation();let b={status:"collapsed"};if(a.element.classList.toggle("b-show-buttons",!u),c&&!(u!=null&&u.status)&&g&&c.minWidth>0?(b={...b,prevMinWidth:c.minWidth},c.minWidth=0):c&&!(u!=null&&u.status)&&!g&&c.minHeight>0&&(b={...b,prevMinHeight:c.minHeight},c.minHeight=0),o&&(u==null?void 0:u.status)==="expanded"&&(u!=null&&u.nextMinWidth||u!=null&&u.nextMinHeight)&&(g?o.minWidth=u.nextMinWidth:o.minHeight=u.nextMinHeight),!u&&(c!=null&&c.collapsible)&&!(c!=null&&c.collapsed))c.collapsible.isPanelCollapser?c.collapsible.collapse():c.collapse();else if((u==null?void 0:u.status)==="expanded"&&(o!=null&&o.collapsible)&&(o!=null&&o.collapsed||(e=o==null?void 0:o.collapsible)!=null&&e.collapsed))o.collapsible.isPanelCollapser?o.collapsible.collapse(!1):o.expand();else if((u==null?void 0:u.status)==="expanded")a.restoreOriginalState();else if(a.lockFlexedSiblings(),b={...b,prevWidth:f.offsetWidth,prevHeight:f.offsetHeight,prevHasFlex:p,prevFlexGrow:p?f.style.flexGrow:null,nextWidth:m.offsetWidth,nextHeight:m.offsetHeight,nextHasFlex:v,nextFlexGrow:v?m.style.flexGrow:null},a.vertical){const w=f.offsetWidth+m.offsetWidth;p?f.style.flexGrow=1:f.style.width="0px",((r=(t=a.nextSplitter)==null?void 0:t.collapseState)==null?void 0:r.status)!=="collapsed"?v?m.style.flexGrow=w:m.style.width=`${w}px`:v?m.style.flexGrow=1:m.style.width="0px"}else{const w=f.offsetHeight+m.offsetHeight;p?f.style.flexGrow=1:f.style.height="0px",((s=(n=a.nextSplitter)==null?void 0:n.collapseState)==null?void 0:s.status)!=="collapsed"?v?m.style.flexGrow=w:m.style.height=`${w}px`:v?m.style.flexGrow=1:m.style.height="0px"}a.collapseState=u?null:b,a.element.classList.toggle("b-drag-disabled",!u),a.setButtonVisibility()}onExpandClick(i){var e,t,r,n,s;const a=this,{nextNeighbor:l,nextWidget:o,previousNeighbor:d,previousWidget:c,collapseState:u,showButtons:h,vertical:g}=a,f=d?d.element:a.getSibling(!1),m=l?l.element:a.getSibling(),p=Vr(f),v=Vr(m);if(h==="start"&&!(o!=null&&o.collapsible)&&(u==null?void 0:u.status)!=="collapsed"||(u==null?void 0:u.status)==="expanded")return;i.stopPropagation();let b={status:"expanded"};if(a.element.classList.toggle("b-show-buttons",!u),!(u!=null&&u.status)&&g&&o.minWidth>0?(b={...b,nextMinWidth:o.minWidth},o.minWidth=0):!(u!=null&&u.status)&&!g&&o.minHeight>0&&(b={...b,nextMinHeight:o.minHeight},o.minHeight=0),c&&(u==null?void 0:u.status)==="collapsed"&&(u!=null&&u.prevMinWidth||u!=null&&u.prevMinHeight)&&(g?c.minWidth=u.prevMinWidth:c.minHeight=u.prevMinHeight),!u&&(o!=null&&o.collapsible)&&!(o!=null&&o.collapsed))o.collapsible.isPanelCollapser?o.collapsible.collapse():o.collapse();else if((u==null?void 0:u.status)==="collapsed"&&(c!=null&&c.collapsible)&&(c!=null&&c.collapsed||(e=c==null?void 0:c.collapsible)!=null&&e.collapsed))c.collapsible.isPanelCollapser?c.collapsible.collapse(!1):c.expand();else if((u==null?void 0:u.status)==="collapsed")a.restoreOriginalState();else if(a.lockFlexedSiblings(),b={...b,prevWidth:f.offsetWidth,prevHeight:f.offsetHeight,prevHasFlex:p,prevFlexGrow:p?f.style.flexGrow:null,nextWidth:m.offsetWidth,nextHeight:m.offsetHeight,nextHasFlex:v,nextFlexGrow:v?m.style.flexGrow:null},a.vertical){const w=f.offsetWidth+m.offsetWidth;((r=(t=a.previousSplitter)==null?void 0:t.collapseState)==null?void 0:r.status)!=="expanded"?p?f.style.flexGrow=w:f.style.width=`${w}px`:p?f.style.flexGrow=1:f.style.width="0px",v?m.style.flexGrow=1:m.style.width="0px"}else{const w=f.offsetHeight+m.offsetHeight;((s=(n=a.previousSplitter)==null?void 0:n.collapseState)==null?void 0:s.status)!=="expanded"?p?f.style.flexGrow=w:f.style.height=`${w}px`:p?f.style.flexGrow=1:f.style.height="0px",v?m.style.flexGrow=1:m.style.height="0px"}a.collapseState=u?null:b,a.element.classList.toggle("b-drag-disabled",!u),a.setButtonVisibility()}render(){super.render(...arguments),this.syncState.now(),this.vertical===null&&this.syncState()}};y(tr,"$name","Splitter"),y(tr,"type","splitter"),tr.initClass(),tr._$name="Splitter";var Ta=class extends Lt{static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",closable:null,role:"tab"}}compose(i){const{active:e,cls:t,index:r,isFirst:n,isLast:s,closable:a}=this,l=this.owner.visibleChildCount;return a&&(i.children.closeIcon={tag:"i",class:"b-tab-close b-icon b-icon-close"}),{tabindex:0,"aria-selected":e,"aria-setsize":l,"aria-posinset":r+1,class:{"b-tabpanel-tab":1,"b-active":e,"b-tab-first":n,"b-tab-last":s,...t},dataset:{index:r}}}updateIndex(i){this.isFirst=!i}updateItem(i,e){var t,r;const n=this;(e==null?void 0:e.tab)===n&&(e.tab=null),i&&(i.tab=n,n[n.titleProperty]=i[n.titleSource],n.itemCls=i.cls,n.ariaElement.setAttribute("aria-controls",i.id),i.role="tabpanel"),(t=n.itemChangeDetacher)==null||t.call(n),n.itemChangeDetacher=i&&be.after(i,"onConfigChange","onItemConfigChange",n,{return:!1}),(r=n.itemHideDetacher)==null||r.call(n),n.itemHideDetacher=i==null?void 0:i.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:n,prio:1e3}),n.syncMinMax()}updateItemCls(i,e){const{element:t}=this,r=t&&te.from(t==null?void 0:t.classList,!0);t&&(r.remove(e).add(i),t.className=r.value)}updateRotate(i,e){!i!=!e&&this.syncMinMax()}syncMinMax(){const i=this,{rotate:e,tabPanel:t}=i;let{_minWidth:r,_minHeight:n,_maxWidth:s,_maxHeight:a}=i;if(t){const{tabMinWidth:l,tabMaxWidth:o}=t;l!=null&&(e?(r===l&&(r=null),n=l):(n===l&&(n=null),r=l)),o!=null&&(e?(s===o&&(s=null),a=o):(a===o&&(a=null),s=o)),i.minWidth=r,i.minHeight=n,i.maxWidth=s,i.maxHeight=a}}onItemBeforeChangeHidden({source:i,hidden:e}){if(!i.$isDeactivating&&!i.$isActivating){const{tabPanel:t}=this;this.hidden=e,e&&i===t.activeItem&&t.activateAvailableTab(i)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:i,disabled:e}){const{tabPanel:t}=this;this.disabled=e,i===t.activeItem&&t.activateAvailableTab(i)}onItemConfigChange({name:i,value:e}){i===this.titleSource&&(this[this.titleProperty]=e)}get closable(){return this._closable&&!(this.isFirst&&this.isLast)}};y(Ta,"$name","Tab"),y(Ta,"type","tab"),Ta.initClass(),Ta._$name="Tab";var mh=i=>i.isTab,Ma=class extends kn{get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(mh)}get tabs(){return B.from(this._items,mh)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(i){return this._items.indexOf(i,mh)}onChildAdd(i){super.onChildAdd(i),i.index==null&&this.syncTabs()}onChildRemove(i){super.onChildRemove(i),this.syncTabs()}onFocusIn({_target:i}){const{activeIndex:e}=this.owner;i!=null&&i.matches(".b-tab:focus-visible")&&!isNaN(e)&&this.tabs[e].focus()}syncTabs(){const{tabs:i}=this;for(let e=0,t=i.length;e<t;++e)i[e].index=e,i[e].isFirst=!e,i[e].isLast=e===t-1}tabAt(i){return this._items.find(mh,i)||null}onChildMove(){this.syncTabs()}onDrop({context:i}){const{item:e,valid:t,oldIndex:r}=i,{owner:n}=this;if(super.onDrop(...arguments),t&&n){const{owner:s}=this,a=e.active,l=Array.from(e.element.parentElement.children).indexOf(e.element);s.insert(s.items[r],l),a&&(s.layout.setActiveItem(l,r,{animation:!1,silent:!0}),s.activeTab=e.item)}}};y(Ma,"$name","TabBar"),y(Ma,"type","tabbar"),y(Ma,"configurable",{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}),Ma.initClass(),Ma._$name="TabBar";var ph=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],Nm={preventScroll:!0},_a=class extends Di{onChildAdd(i){super.onChildAdd(i);const e=this,{activeItem:t,owner:r}=e,n=r.activeIndex!=null?r.activeIndex:e.activeIndex||0,s=r.items.indexOf(i),a=t!=null?i===t:s===n;i.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",show:{fn:"onChildShow",prio:99999},thisObj:e}),a?(e._activeIndex=s,e._activeItem=i,i.show()):(i.$isDeactivating=!0,i.hide(),i.$isDeactivating=!1)}onChildRemove(i){super.onChildRemove(i);const e=this;e._activeItem===i&&e.activateSiblingOf(i),e._activeIndex=e.owner.items.indexOf(e._activeItem),i.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",show:"onChildShow",thisObj:e})}onBeforeChildShow({source:i}){if(!this.owner.isConfiguring&&!i.$isActivating)return this.activeItem=i,!1}onChildShow({source:i}){this._activeItem=i}onBeforeChildHide({source:i}){if(!this.owner.isConfiguring&&!i.$isDeactivating)return this.activateSiblingOf(i),!1}activateSiblingOf(i){const{owner:e}=this,t=e.items.slice(),r=t.indexOf(i);t.splice(r,1),this.activeIndex=Math.min(r,t.length-1)}setActiveItem(i,e=this.activeIndex,t){var r;const n=this,{owner:s}=n,{items:a}=s,l=i instanceof z,o=a[e],d=s.items[i=l?a.indexOf(i):parseInt(i,10)],c=(t==null?void 0:t.animation)!==!1,u=!(t!=null&&t.silent),h={prevActiveIndex:e,prevActiveItem:o,containedFocus:o==null?void 0:o.element.matches(":focus-within"),ownerContainedFocus:s.element.matches(":focus-within")};if(d&&!d.$isActivating&&d!==o){const g=o&&o.element,f=d&&d.element;if(n.animateDetacher){const p=n.animateDetacher.event;if(p.activeItem===d)return p.promise;n.animateDetacher(),p.prevActiveItem.element.classList.remove(...ph),p.activeItem.element.classList.remove(...ph),n.animateDetacher=null}if(h.activeIndex=i,h.activeItem=d,u&&s.trigger("beforeActiveItemChange",h)===!1)return null;const m=n._activeIndex!==h.activeIndex;m&&(n._activeIndex=h.activeIndex),u&&((r=s.onBeginActiveItemChange)==null||r.call(s,h)),m&&(n._activeIndex=h.prevActiveIndex),c&&g&&s.isVisible&&n.animateCardChange?h.promise=n.cardChangeAnimation=new Promise((p,v)=>{const b=o.monitorResize;o.monitorResize=!1,n.contentElement.style.overflowX="hidden",o._hidden=!0,d.$isActivating=!0,d.show(),s.element.matches(":focus-within")&&d.focus(Nm),d.$isActivating=!1,g.classList.add(i>e?"b-slide-out-left":"b-slide-out-right"),f.classList.add(i<e?"b-slide-in-left":"b-slide-in-right"),s.isAnimating=!0,n.animateDetacher=V.onTransitionEnd({mode:"animation",element:f,thisObj:o,handler(){if(s.isAnimating=n.cardChangeAnimation=!1,!n.animateDetacher){n.setActiveItem(i,e,t);return}n.animateDetacher=null,f.classList.remove(...ph),g&&(g.classList.remove(...ph),o.$isDeactivating=!0,o._hidden=!1,o.hide(),o.monitorResize=b,o.$isDeactivating=!1),n.contentElement.style.overflowX="",n.onActiveItemChange(h,p,!u)}}),n.animateDetacher.reject=v,n.animateDetacher.event=h}):(d.$isActivating=!0,d.show(),s.element.matches(":focus-within")&&d.focus(Nm),d.$isActivating=!1,o&&(o.$isDeactivating=!0,o.hide(),o.$isDeactivating=!1),n.onActiveItemChange(h,null,!u))}return h}onActiveItemChange(i,e,t){const r=this,{owner:n}=r,{activeItem:s}=i;r._activeItem=s,r._activeIndex=i.activeIndex,!t&&n.trigger("activeItemChange",i),i.ownerContainedFocus&&!s.element.matches(":focus-within")&&s.focus(Nm),e==null||e(i)}renderChildren(){const{owner:i}=this;i.contentElement.classList.toggle(this.hideChildHeaderCls,i.suppressChildHeaders),super.renderChildren()}changeActiveIndex(i){const{owner:e}=this;return e.isConfiguring&&!e._items?i:Math.min(i,e.items.length-1)}updateActiveIndex(i,e){this.owner.isConfiguring||this.setActiveItem(i,e)}updateActiveItem(i){this.owner.isConfiguring||this.setActiveItem(i,this.activeIndex)}get isChangingCard(){return!!this.animateDetacher}insertChild(i){const e=this;if(e.owner.items.includes(i)){const r=e.activeItem,n=i===r;n&&(e._activeItem=null);const s=super.insertChild(...arguments);return n||(e._activeIndex=e.owner.items.indexOf(r)),s}return super.insertChild(...arguments)}};y(_a,"$name","Card"),y(_a,"type","card"),y(_a,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),_a.initClass(),_a._$name="Card";var Uk=i=>i.maximized,Un=class extends Xe{get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var i;const{activeTab:e,items:t,tabBar:r}=this;return t.indexOf((i=r.tabs[e])==null?void 0:i.item)}get bodyConfig(){return T.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var i;const e=this.items[this.activeTab||0];return(e==null?void 0:e.focusElement)||((i=e==null?void 0:e.tab)==null?void 0:i.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const i=this,{activeTab:e,layout:t}=i,{activeIndex:r}=t,{tabs:n}=i.tabBar,s=e>=0&&e<n.length&&i.items.indexOf(n[e].item);if(n.length>0&&(s===!1||s<0))throw new Error(`Invalid activeTab ${e} (${n.length} tabs)`);s!==r&&t.setActiveItem(s,r,{animation:!1,silent:!0}),t.animateCardChange=i.animateTabChange}onChildAdd(i){const e=this;if(super.onChildAdd(i),!e.initialItems){const{tabBar:t}=e,r=e.makeTabConfig(i),n=r&&(t==null?void 0:t.firstTab),s=n&&t._items,a=n&&B.from(e._items,o=>o.tab||o===i),l=n?a.indexOf(i)+s.indexOf(n):0;r&&t&&(n&&i.weight==null&&l<s.count-1?t.insert(r,l):t.add(r))}}onChildRemove(i){const e=this,{tab:t}=i,{items:r}=e;t&&(e.tabBar.remove(t),t.destroy()),i===e.activeItem&&(e._activeTab=null,r.length&&(e.activeTab=r[Math.min(e.activeIndex,r.length-1)])),super.onChildRemove(i),i.tabBarItems&&e.tabBar.remove(i.tabBarItems)}isDisabledOrHiddenTab(i){const{tabs:e}=this.tabBar,t=e==null?void 0:e[i];return t&&(t.disabled||t.hidden)}findAvailableTab(i,e=1){const{tabs:t}=this.tabBar,r=t.length,n=Math.max(0,t.indexOf(i.tab));n&&(e=-e);let s;for(let a=1;a<=r&&(s=(n+(e<0?r:0)+a*e)%r,!!this.isDisabledOrHiddenTab(s));++a);return s}activateAvailableTab(i,e=1){this.activeTab=this.findAvailableTab(i,e)}changeActiveTab(i,e){const t=this,{tabBar:r,layout:n}=t,{tabCount:s}=r;if(i.isWidget||T.isObject(i)?(t.items.indexOf(i)===-1&&(i=t.add(i)),i=r.indexOfTab(i.tab)):i=parseInt(i,10),!t.initialItems&&s>0&&(i<-1||i>=s))throw new Error(`Invalid activeTab ${i} (${s} tabs)`);if(t.isDisabledOrHiddenTab(i)&&(i=t.findAvailableTab(i)),n.animateCardChange&&n.cardChangeAnimation)n.cardChangeAnimation.then(a=>{(a==null?void 0:a.activeIndex)!==i&&(t._activeTab=i,t.updateActiveTab(i,e))});else return i}async updateActiveTab(i,e){var t;const r=this;if(!r.initialItems){const{activeTabItemIndex:s,layout:a}=r;if(s>-1){const l=r.items[s];a.activeItem!==l&&(a.animateCardChange&&await r.tabSelectionPromise,r.tabSelectionPromise=(t=a.setActiveItem(l))==null?void 0:t.promise)}r.tabBar.remove(r.tabBar.items.filter(l=>!l.isTab&&l.trueOwner))}const n=r.items[i];n!=null&&n.tabBarItems&&(n.tabBarItems=r.tabBar.add(n.tabBarItems),n.tabBarItems.forEach(s=>s.trueOwner=n))}changeTabBar(i){return this.getConfig("strips"),this.strips={tabBar:i},this.strips.tabBar}makeTabConfig(i){const{tab:e}=i,t={item:i,type:"tab",active:!i.hidden,tabPanel:this,disabled:!!i.disabled,hidden:i.initialConfig.hidden,weight:i.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return e===!1?null:T.isObject(e)?Ta.mergeConfigs(t,e):t}updateAnimateTabChange(i){this.isConfiguring||(this.layout.animateCardChange=i)}updateItems(i,e){const t=this,{activeTab:r,initialItems:n}=t;let s=0,a;super.updateItems(i,e),n&&(a=Array.from(i,l=>t.makeTabConfig(l)).filter(l=>{if(l)return l.index=s++,!0}),s&&(a[r].active=!0,t.tabBar.add(a),t.activeTab=r))}updateTabMinWidth(i){var e;(e=this.tabBar)==null||e.items.forEach(t=>{t.isTab&&(t.minWidth=i)})}updateTabMaxWidth(i){var e;(e=this.tabBar)==null||e.items.forEach(t=>{t.isTab&&(t.maxWidth=i)})}updateAutoHeight(i){this.detachListeners("themeAutoHeight"),i&&le.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this})}applyAutoHeight(){const i=this,{layout:e,activeTab:t,element:r}=i,{animateCardChange:n}=e;if(e.animateCardChange=!1,i.flex="0 0 0%",!i.up(Uk)){const s=i.height=Math.max(...i.items.map(a=>(i.activeTab=a,r.clientHeight)))+1;i.flex=`1 1 ${s}px`}i.activeTab=t,e.animateCardChange=n}internalOnThemeChange(){this.isVisible&&this.applyAutoHeight()}onBeginActiveItemChange(i){const e=this.tabBar.tabs,{activeItem:t,prevActiveItem:r}=i;this.activeTab=e.indexOf(t==null?void 0:t.tab),r!=null&&r.tab&&(r.tab.active=!1),t!=null&&t.tab&&(t.tab.active=!0,t.tab.show())}onBeforeActiveItemChange(i){return this.trigger("beforeTabChange",i)}onActiveItemChange(i){this.trigger("tabChange",i)}onTabClick(i){const{item:e}=i.source;e.tab.closable&&i.event.target.classList.contains("b-tab-close")?this.remove(e):this.activeTab=e}onInternalPaint(){super.onInternalPaint(...arguments),this.autoHeight&&this.applyAutoHeight()}onValidityChange({source:i,valid:e}){const t=i.closest(n=>n.element.classList.contains("b-tabpanel-item")),{tab:r}=t;r.element.classList.toggle("b-invalid",!e),r.ariaLabel=e?"":this.L("L{TabPanel.containsInvalidFields}")}};y(Un,"$name","TabPanel"),y(Un,"type","tabpanel"),y(Un,"alias","tabs"),y(Un,"configurable",{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}),Un.initClass(),Un._$name="TabPanel";var ka=class extends rt{static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(i){this.input.style.resize=i}};y(ka,"$name","TextAreaField"),y(ka,"type","textareafield"),y(ka,"alias","textarea"),ka.initClass(),ka._$name="TextAreaField";var vh=class AE extends Ln{get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get nonEditableClickTarget(){return this.displayElement}get focusElement(){var e;return(e=this._picker)!=null&&e.isVisible?this.input:this.displayElement}get needsInputSync(){var e;return this.displayElement[this.inputValueAttr]!==String((e=this.inputValue)!=null?e:"")}showPicker(){this.picker.width=this.pickerWidth||this.pickerAlignElement.offsetWidth,super.showPicker(!0)}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,r=t.input;switch(e.key.trim()||e.code){case"Escape":t.picker.hide();return;case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide());break}t.input=t.displayElement;const n=super.onPickerKeyDown(e);return t.input=r,n}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return e==null?"":e}changePicker(e,t){var r;const n=this,s=n.pickerWidth||(e==null?void 0:e.width);if(e=AE.reconfigure(t,e?Z.merge({owner:n,forElement:n.pickerAlignElement,align:{matchSize:s==null,anchor:n.overlayAnchor,target:n.pickerAlignElement},id:n.id+"-input",style:{resize:n.resize},html:(r=n.value)!=null?r:""},e):null,n),e){const a=n.input=e.element;n.inputListenerRemover=V.on({element:a,thisObj:n,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}};y(vh,"$name","TextAreaPickerField"),y(vh,"type","textareapickerfield"),y(vh,"configurable",{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null,editable:!1});var Bm=vh;Bm.initClass(),Bm._$name="TextAreaPickerField";var Fa=class extends gt{static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}},overflowable:!0}}afterConstruct(){this.updateUndoRedoControls()}updateStm(i){this.detachListeners("undoredo"),i==null||i.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(i){const{undoBtn:e,redoBtn:t}=i;return this.color&&(e&&(e.color=this.color),t&&(t.color=this.color)),this.text&&(e&&(e.text="L{UndoRedo.Undo}"),t&&(t.text="L{UndoRedo.Redo}")),super.changeItems(i)}updateProject(i){this.stm=i.stm}fillUndoRedoCombo(){const{transactionsCombo:i}=this.widgetMap;i&&(i.items=[[0,"Original data"],...this.stm.queue.map((e,t)=>[t+1,e||`Transaction ${t+1}`])])}updateUndoRedoControls(){const{stm:i,showZeroActionBadge:e}=this,{undoBtn:t,redoBtn:r,transactionsCombo:n}=this.widgetMap;t.badge=i.position||(e?"0":""),r.badge=i.length-i.position||(e?"0":""),t.disabled=!i.canUndo,r.disabled=!i.canRedo,this.fillUndoRedoCombo(),n&&(n.disabled=n.store.count<=1)}transactionsDisplayValueRenderer(i,e){var t;const r=((t=this.stm)==null?void 0:t.position)||0;return`${r} undo actions / ${e.store.count-r-1} redo actions`}onUndo(){const{stm:i,project:e}=this;i.canUndo&&(i.revisionsEnabled?e.queue(()=>(i.undo(),e.commitAsync())):i.undo())}onRedo(){const{stm:i,project:e}=this;i.canRedo&&(i.revisionsEnabled?e.queue(()=>(i.redo(),e.commitAsync())):i.redo())}onTransactionSelected(i){const{stm:e}=this,t=e.position-i.value;t>0?e.canUndo&&e.undo(t):t<0&&e.canRedo&&e.redo(-t)}};y(Fa,"$name","UndoRedoBase"),y(Fa,"type","undoredobase"),Fa.initClass(),Fa._$name="UndoRedoBase";var Nr="http://www.w3.org/2000/svg",Gk={bar:1,outline:2,text:3},Yk=(i,e)=>parseInt(i.order,10)-parseInt(e.order,10),DS=(i,e)=>parseInt(i.dataset.order,10)-parseInt(e.dataset.order,10),qk=i=>i.field,Kk=()=>!1,Xk=/\s+/,Gn=class extends z{static get configurable(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:Nr,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Nr,tag:"g",reference:"scaledSvgGroup"},{ns:Nr,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:!1,singleTextForAllBars:!0,monitorResize:!0,getRectClass:void 0,getBarClass(i,e,t,r){return""},getOutlineClass(i,e){return""},getOutlineDOMConfig(i,e,t){return e},getBarTip(i,e,t,r){},getBarText(i,e,t){return""},getBarDOMConfig:null,getBarTextDOMConfig(i,e,t,r){return i},getBarTextTip(i,e,t,r){}}}construct(i){const e=this;super.construct(i),e.scheduleRefresh=e.createOnFrame(e.refresh,[],e,!0),e.refresh()}set tip(i){var e;const t=this;(e=t.tip)==null||e.destroy(),i?t._tip=ve.new({owner:t,forElement:t.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},i):t._tip=null}onElementResize(){super.onElementResize(...arguments);const i=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${i.width} ${i.height})`)}onBeforeTipShow({source:i}){const e=parseInt(i.activeTarget.dataset.index);i.html=i.contentTemplate({histogram:this,index:e})}updateSeries(i){const e=this,t=e._series={};let r=0,n=0;for(const s in i)if(i[s]!==!1){const a=t[s]=Z.merge({},i[s]);a.field||(a.field=s),a.type||(a.type="bar"),"order"in a||(a.order=Gk[a.type]*10+r),"index"in a||(a.index=r),a.type==="bar"&&(a.index=n++),a.id=s,r++}!e.topValue&&e._data&&(e.topValue=e.getDataTopValue(e._data)),e.refreshSuspended||e.scheduleRefresh()}getDataTopValue(i,e){const t=Object.values(e||this.series).map(qk);let r=0,n;for(let s=0,{length:a}=i;s<a;s++){n=i[s];for(let l=0,{length:o}=t;l<o;l++)r=Math.max(r,n[t[l]])}return r}updateGetRectClass(i){re.deprecate("core","7.0.0","getRectClass is deprecated in favor of getBarClass"),this.getBarClass=i}updateData(i){const e=this;e._data=i,!e.topValue&&e._data&&e._series&&(e.topValue=e.getDataTopValue(i)),e.refreshSuspended||e.scheduleRefresh()}updateTopValue(i){const e=this;e._topValue=i,!i&&e._data&&(e._topValue=e.getDataTopValue(e._data)),e.refreshSuspended||e.scheduleRefresh()}scheduleRefresh(){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(){this.refreshSuspended&&this.refreshSuspended--}refresh(i){const e=this,{series:t,_tip:r,topValue:n,singleTextForAllBars:s}=e,a=(i==null?void 0:i.args)||[],l=[],o=[];if(!t)return;const d=Object.values(t).sort(Yk);if(s){for(const c of d){const u=e[`draw${O.capitalize(c.type)}`](c,...a);u&&(Array.isArray(u)?l.push.apply(l,u):l.push(u))}o.push(...e.drawText(null,...a))}else{for(const c of d){const u=e[`draw${O.capitalize(c.type)}`](c,...a);u&&(Array.isArray(u)?l.push.apply(l,u):l.push(u)),c.type==="bar"&&o.push(...e.drawText(c,...a))}o.sort(DS)}l.sort(DS),oe.sync({domConfig:{width:"100%",height:"100%",preserveAspectRatio:"none",dataset:{topValue:n},children:[{ns:Nr,tag:"g",reference:"scaledSvgGroup",children:l},{ns:Nr,tag:"g",reference:"unscaledSvgGroup",children:o}]},configEquality:Kk,targetElement:e.svgElement}),r&&r.isVisible&&e.onBeforeTipShow({source:r})}drawBar(i,...e){const t=this,{topValue:r,data:n,omitZeroHeightBars:s,barStyle:a}=t,{field:l,order:o,stretch:d}=i,{length:c}=n,u=1/c,h=[],g=O.createId(i.id),f=i.index,m=d?1:void 0;let p;for(let v=0,b=0,{length:w}=n;v<w;v++,b+=p){const D=n[v];let S=D.rectConfig={ns:Nr,tag:"rect",dataset:{}};const x=D[l],R=x?m||D.height||(x>r?r:x)/r:0,M=1-R,_=t.callback("getBarTip",t,[i,S,D,v,...e]);p=D.width||u,a?S.style=a:delete S.style,Object.assign(S.dataset,{index:v,order:o,series:g});const k={[`b-series-${g}`]:1,[`b-series-index-${f}`]:1},F=t.callback("getBarClass",t,[i,S,D,v,...e]);F&&F.split(Xk).forEach(I=>k[I]=1),Object.assign(S,{x:b,y:M,width:p,height:R,class:k}),_?S.dataset.btip=_:delete S.dataset.btip,t.getBarDOMConfig&&(S=t.getBarDOMConfig(i,S,D,v,...e)),S&&(S.height||!s)&&h.push(S)}return h}changeGetBarDOMConfig(i){return i?this.bindCallback(i):null}drawOutline(i,...e){const t=this,{topValue:r,data:n}=t,{field:s,order:a,id:l}=i,o=1/n.length,d=["M 0,1"],c={ns:Nr,tag:"path",dataset:{order:a,id:l}};let u,h="M",g="L";for(let f=0,m=0,{length:p}=n;f<p;f++){const v=1-n[f][s]/r;u=n[f].width||o,d.push(`${h} ${m},${v} ${g} ${m+=u},${v}`),h=g=""}return c.class=`b-series-${i.id} b-series-index-${i.index} `+t.callback("getOutlineClass",t,[i,n,...e]),c.d=d.join(" "),t.callback("getOutlineDOMConfig",t,[i,c,n,...e])||[]}drawText(i,...e){const t=this,{data:r}=t,n=1/r.length,s="100%",a=[];for(let l=0,o,d=0,{length:c}=r;l<c;l++,d+=o){o=r[l].width||n;const u=t.callback("getBarText",t,[r[l],l,i,...e]);if(u){const h=t.callback("getBarTextDOMConfig",t,[{ns:Nr,tag:"text",className:"b-bar-legend",html:u,left:d,width:o,x:`${(d+o/2)*100}%`,y:r[l].y!==void 0?r[l].y:s,dataset:{index:l,series:i}},r[l],l,i,...e]);if(h){const g=t.callback("getBarTextTip",t,[h,r[l],l,i,...e]);g?h.dataset.btip=g:delete h.dataset.btip,a.push(h)}}}return a}};y(Gn,"type","histogram"),y(Gn,"$name","Histogram"),y(Gn,"properties",{refreshSuspended:0}),Gn.initClass(),Gn._$name="Histogram";var Dd="http://www.w3.org/2000/svg",Ia=class extends z{static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:Dd,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Dd,tag:"g",reference:"scaledSvgGroup",children:[{ns:Dd,tag:"path",reference:"pathElement"}]},{ns:Dd,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(i){super.construct(i),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(i){return i||(i=this.horizontal?"bottom":"right"),i}updateAlign(i,e){this.element.classList.remove(`b-align-${e}`),this.element.classList.add(`b-align-${i}`)}updateHorizontal(i,e){this.element.classList.remove(`b-scale-${e?"horizontal":"vertical"}`),this.element.classList.add(`b-scale-${i?"horizontal":"vertical"}`)}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){var i;if(!this.scalePoints)return;const e=this,{horizontal:t,width:r,height:n,align:s,scalePoints:a,scaleMaxPadding:l}=e,o=(i=a[a.length-1])==null?void 0:i.value,d=[],c=[],u=1/(o+l*o);e.scaledSvgGroup.setAttribute("transform",`scale(${t?r:1} ${t?1:n})`);for(const h of a){const g=!!h.text,f=u*h.value;if(g){const m={ns:Dd,tag:"text",className:"b-scale-tick-label",html:h.text,dataset:{tick:h.value}};t?(m.x=`${f*100}%`,m.y=s==="top"?"1.6em":n-12):(m.x=s==="left"?"12":`${r-12}`,m.y=`${(1-f)*100}%`),c.push(m)}t?s==="top"?d.push(`M${f},0 L${f},${g?10:5}`):d.push(`M${f},${n} L${f},${n-(g?10:5)}`):s==="left"?d.push(`M0,${1-f} L${g?10:5},${1-f}`):d.push(`M${r},${1-f} L${r-(g?10:5)},${1-f}`)}e.pathElement.setAttribute("d",d.join("")),oe.syncChildren({domConfig:{children:c}},e.unscaledSvgGroup)}};y(Ia,"$name","Scale"),y(Ia,"type","scale"),Ia.initClass(),Ia._$name="Scale";var ES=i=>{var e;return e=class extends(i||$){compose(){const{minified:t}=this;return{class:{"b-minified":t}}}get widgetClass(){}},y(e,"$name","Minifiable"),y(e,"configurable",{minifiable:!0,minified:null}),e},Zk=[],Jk=i=>i[0]!=="*",xS=(i,e)=>{const t=i[e]||null;return delete i[e],t},Qk=i=>i.responsiveRoot,RS={number:i=>({width:e})=>e<=i&&i},TS=i=>(delete i.once,{configs:i,callback:xS(i,"callback"),when:xS(i,"when")}),MS=(i,e,...t)=>{const r=t.flatMap(a=>(a==null?void 0:a.once)||Zk),n=e.mergeConfigs(...t),s=TS(n);s.once=r.length?TS(e.mergeConfigs(...r)):null;for(const a in n)a in i&&delete n[a];return s},eF=(i,e)=>{let t,r=Proxy.revocable(i,{get(a,l){return t&&(t[l]=!0),i[l]}}),n=be.after(i,"onConfigChange",(a,{name:l})=>{t!=null&&t[l]&&e()}),s=i.ion({resize:()=>{e()}});return i.monitorResize=!0,{widget:i,get object(){return r==null?void 0:r.proxy},destroy(){r&&(r.revoke(),n(),s(),r=n=s=null)},reset(){t=Object.create(null)}}},Aa=i=>{var e;return e=class extends(i||$).mixin(fe,In){get isResponsivePending(){return this.responsiveUpdateCount===0&&this.hasConfig("responsive")}get isResponsiveUpdating(){var t;return this._responsiveUpdating||((t=this.responsiveWidget)==null?void 0:t._responsiveUpdating)}updateResponsive(t){var r;const n=this,s=n.constructor,{initialConfig:a,responsiveDefaults:l}=n,o=Array.from(new Set(T.keys(t).concat(T.keys(l)))).filter(Jk);let d=null,c,u,h,g;if(t){d={"*":MS(a,s,l["*"],t["*"])};for(u of o)h=t[u],h!==null&&h!==!1&&(c=c||h&&"when"in h,d[u]=MS(a,s,l["*"],l[u],t["*"],h),g=d[u].when,d[u].when=((r=RS[typeof g])==null?void 0:r.call(RS,g))||g)}n.$responsiveStates=d,n.$responsiveWhen=c,n.syncResponsiveWidget()}updateResponsiveState(t,r){var n,s,a,l;const o=this,{$responsiveStates:d}=o,c=++o.responsiveStateChanges===1,u=(n=o.element)==null?void 0:n.classList,h=d["*"],g=d[t]||h,f=c&&(g.once||h.once),m=c&&o.isStateful,p=o.responsiveWidget;let v=g.configs,b=f==null?void 0:f.configs,w;b&&(v=v?o.constructor.mergeConfigs(v,b):b),r&&(u==null||u.remove(`b-responsive-${r.toLowerCase()}`)),t&&(u==null||u.add(`b-responsive-${t.toLowerCase()}`)),m&&(b=o.loadStatefulData(),b&&(v=v?o.constructor.mergeConfigs(v,b):b),o.suspendStateful()),o._responsiveUpdating=!0;try{(s=o.trigger)==null||s.call(o,"beforeResponsiveStateChange",{state:t,oldState:r,target:p}),v&&o.setConfig(v);for(w of[g.callback,f==null?void 0:f.callback])(a=typeof w=="string"?o[w]:w)==null||a.call(o,{source:o,state:t,oldState:r,target:p,initial:c});(l=o.trigger)==null||l.call(o,"responsiveStateChange",{state:t,oldState:r,target:p})}finally{o._responsiveUpdating=!1,m&&o.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(t){var r;const n=this,s=t&&n.responsiveUpdate;(r=n.$responsiveWrapper)==null||r.destroy(),n.$responsiveWrapper=t&&eF(t,s),s==null||s.now()}responsiveUpdate(){const t=this,{$responsiveStates:r,$responsiveWrapper:n}=t,s=n==null?void 0:n.widget;if(r&&n){let a=null,l=0,o=r,d,c;s&&s!==t&&!t.$responsiveWhen&&(s.getConfig("responsive"),o=s.$responsiveStates||o),n.reset();for(c in r)c!=="*"&&(d=o[c].when(n.object,Y),d!=null&&d!==!1&&(!a||d<l)&&(a=c,l=d));++t.responsiveUpdateCount,t.responsiveState=a}}syncResponsiveWidget(){var t;const r=this;let n=null,s;if(!r.isDestroying&&r.responsive){if(s=r.responsiveTarget,!(n=s))n=!r.responsiveRoot&&((t=r.up)==null?void 0:t.call(r,Qk))||r;else if(typeof s=="string"&&(n=s==="@"?r:s[0]==="@"?r[s.substring(1)]:r.up(s),!n))throw new Error(`No match for responsiveTarget="${s}"`);if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return r.responsiveWidget=n,n}},y(e,"$name","Responsive"),y(e,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}}}),y(e,"delayable",{responsiveUpdate:"raf"}),y(e,"fenced",{syncResponsiveWidget:!0}),y(e,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),e},tF=i=>{var e;return e=class extends(i||$){changeCssVarPrefix(t){return T.assertString(t,"prefix"),t&&!t.endsWith("-")&&(t=t+"-"),t||""}changeCss(t){T.assertObject(t,"css");const r=this;if(!globalThis.Proxy)throw new Error("Proxy not supported");const n=new Proxy({},{get(s,a){var l;return(l=getComputedStyle(r.element||document.documentElement).getPropertyValue(`--${r.cssVarPrefix}${O.hyphenate(a)}`))==null?void 0:l.trim()},set(s,a,l){return(r.element||document.documentElement).style.setProperty(`--${r.cssVarPrefix}${O.hyphenate(a)}`,l),!0}});return t&&(r._element?T.assign(n,t):r.$initialCSS=t),n}updateElement(t,...r){super.updateElement(t,...r),this.$initialCSS&&T.assign(this.css,this.$initialCSS)}get widgetClass(){}},y(e,"$name","Styleable"),y(e,"configurable",{cssVarPrefix:"",css:{}}),e},_S=class Ev extends ${static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;(e=this.tooltip)==null||e.destroy(),super.doDestroy()}updateElement(e){V.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return ve.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set)}getResourceAvatar(e){if(Array.isArray(e))return e.map(h=>this.getResourceAvatar(h));const{initials:t,color:r,iconCls:n,imageUrl:s,defaultImageUrl:a,dataset:l={},resourceRecord:o,alt:d=O.encodeHtml(o==null?void 0:o.name)}=e,c=this.getImageConfig(t,r,s,a,l,d)||this.getIconConfig(n,l,d)||this.getResourceInitialsConfig(t,r,l,d),{size:u}=this;return Object.assign(c.style,{...u?{height:u,width:u}:void 0}),c}getImageConfig(e,t,r,n,s,a){if(r=Ev.failedUrls.has(r)?n:r||n,r)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:a,"aria-label":a,elementData:{defaultImageUrl:n,imageUrl:r,initials:e,color:t,dataset:s},src:r,dataset:s}}getIconConfig(e,t,r){if(e)return e&&{tag:"i",style:{},"aria-label":r,class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,r,n){const s=E.isNamedColor(t)&&t,a=!s&&t,{size:l}=this;return{tag:"div","aria-label":n,class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${s}`]:s},style:{backgroundColor:a||null,...l?{height:l,width:l}:void 0},text:e,dataset:r}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar")||!e.isConnected)return;const{defaultImageUrl:t,initials:r,color:n,imageUrl:s,dataset:a}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const{parentElement:l}=e,o=Array.from(l.childNodes).indexOf(e),d=this.getResourceInitialsConfig(r,n,a,e.alt),c=E.createElement(d);e.$refOwnerId&&(c.$refOwnerId=e.$refOwnerId),c.elementData=e.elementData,c.lastDomConfig=d,l.lastDomConfig&&(l.lastDomConfig.children[o]=d),l.replaceChild(c,e)}Ev.failedUrls.add(s)}};y(_S,"$name","AvatarRendering");var La=_S;La._$name="AvatarRendering",window&&!window.bryntum&&(window.bryntum={});var di=class ei{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=z.fromElement(e,"gridbase"),r=t&&e.closest(t.focusableSelector);if(r){const{dataset:n}=r.parentNode;this.init({grid:t,rowIndex:t.store.includes(n.id)?t.store.indexOf(n.id):n.index||-1,columnId:r.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var t,r;const n=this,s=n.grid=e.grid,{store:a,columns:l}=s,{visibleColumns:o}=l;if(e.target&&(n.actionTargets=[n._target=e.target]),e.record)n._id=e.record.id;else if("id"in e)n._id=e.id,e.id==null&&(n._rowIndex=-1);else{const d=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;n._rowIndex=Math.max(Math.min(Number(d),a.count-1),s.hideHeaders?0:-1),n._id=(t=a.records[n._rowIndex])==null?void 0:t.id}if("_rowIndex"in n||(n._rowIndex=a.indexOf(n.id)),n.isSpecialRow=(r=n.record)==null?void 0:r.isSpecialRow,"columnId"in e)n._column=l.getById(e.columnId);else if("field"in e)n._column=l.get(e.field);else{const d=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(d)?n._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(n._columnIndex=Math.min(Number(d),o.length-1),n._column=o[n._columnIndex])}"_columnIndex"in n||(n._columnIndex=o.indexOf(n._column))}get isLocation(){return!0}equals(e,t=!1){const r=this;return(e==null?void 0:e.isLocation)&&e.grid===r.grid&&(t?r.id===e.id&&r._column===e._column:e.record===r.record&&e.column===r.column&&e.target===r.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return t===-1?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){var e;if((e=this._record)!=null&&e.isModel)return this._record;if(this._rowIndex>-1){const{store:t}=this.grid;return t.includes(this._id)?t.getById(this._id):t.records[this._rowIndex]}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return e!=null&&e.includes(this._column)?this._column:e==null?void 0:e[this.columnIndex]}get columnId(){var e;return(e=this.column)==null?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,((e=this.grid.columns.visibleColumns)==null?void 0:e.length)-1)}move(e){const t=this,{record:r,column:n,grid:s}=t,{store:a}=s,l=s.columns.visibleColumns,o=new ei;let d=a.includes(r)?a.indexOf(r):t.rowIndex,c=l.includes(n)?l.indexOf(n):t.columnIndex;const u=s.hideHeaders?0:-1,h=a.count-1,g=l.length-1,f=d===u,m=d===h,p=c===0,v=c===g;switch(e){case ei.PREV_CELL:p?f||(c=g,d--):c--;break;case ei.NEXT_CELL:v?m||(c=0,d++):c++;break;case ei.UP:f||d--;break;case ei.DOWN:m||(d===-1?d=s.rowManager.firstFullyVisibleRow.dataIndex:d++);break;case ei.FIRST_COLUMN:c=0;break;case ei.LAST_COLUMN:c=g;break;case ei.FIRST_CELL:d=u,c=0;break;case ei.LAST_CELL:d=h,c=g;break;case ei.PREV_PAGE:d=Math.max(u,d-Math.floor(s.scrollable.clientHeight/s.rowHeight));break;case ei.NEXT_PAGE:d=Math.min(h,d+Math.floor(s.scrollable.clientHeight/s.rowHeight));break}return o.init({grid:s,rowIndex:d,columnIndex:c}),o}get cell(){var e,t;const r=this,{grid:n,id:s,_cell:a}=r;if(a)return a;if(s==null)return(e=n.columns.getById(r.columnId))==null?void 0:e.element;{const{row:l}=r;if(l)return l.getCell(r.columnId)||l.getCell((t=n.columns.getAt(r.columnIndex))==null?void 0:t.id)}}get $cellIndex(){return{rowIndex:this.rowIndex,columnIndex:this.columnIndex}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:r}=this.grid;if(e)return t||(r.currentNode=this.grid.focusableFinderCell=e,r.nextNode()||e)}get containsFocus(){const{cell:e}=this,t=e&&E.getActiveElement(e);return t&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY}get isActionable(){const{_target:e}=this;return!!(this.containsFocus||e&&e!==this.cell)}get isColumnHeader(){return this.cell&&this.rowIndex===-1}get isCell(){return this.cell&&this.record}};y(di,"UP",1),y(di,"NEXT_CELL",2),y(di,"DOWN",3),y(di,"PREV_CELL",4),y(di,"FIRST_COLUMN",5),y(di,"LAST_COLUMN",6),y(di,"FIRST_CELL",7),y(di,"LAST_CELL",8),y(di,"PREV_PAGE",9),y(di,"NEXT_PAGE",10);var Se=di;Se._$name="GridLocation";var kS=i=>typeof i=="number"||(i==null?void 0:i.endsWith("px")),iF=/=>\s*['"]/,Ed=class zi extends me.mixin(Fe,Nt){get type(){return this.constructor.type}static setupFields(e,t){me.setupFields(e,t);const r=t.fields,n=r.map;r.defs.forEach((s,a)=>{if(s.defaultValue&&r.defaults[s.name]!==s.defaultValue&&typeof s.defaultValue=="string"&&s.defaultValue.match(/^L\{/)){const l={...s,defaultValue:r.defaults[s.name],definedBy:this,model:this,owner:this};r.defs[a]=l,n[s.name]=l}})}construct(e,t,r,...n){const s=this,a=r==null?void 0:r.isRoot;a||(s.masterStore=t,t&&(s._grid=Array.isArray(t)?t[0].grid:t.grid),s.localizableProperties=Re.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(s.localeClass=e.localeClass)),super.construct(e,t,r,...n);const{grid:l}=s;if(!a){if(s.isLeaf&&!("field"in s.data)&&(s.setData("field","_"+(s.type||"")+ ++zi.emptyCount),s.noFieldSpecified=!0),!s.width&&!s.flex&&!s.children&&s.setData({width:zi.defaultWidth,flex:null},null,!0),s.headerWidgets&&s.initHeaderWidgets(s.headerWidgets),s.isParent&&(s.meta.visibleChildren=new Set,s.collapsible&&l.once("paint",()=>s.collapsible=!0)),s.renderer){const o=s.renderer.toString();s.rendererReturningContent=o.includes("return ")||!!o.match(iF)}s.formula&&(!s.field||!l.store.modelClass.getFieldDefinition(s.field))&&console.warn(`No Model field found for this Column\xB4s field: "${s.field}".`)}}shouldSync(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var e;return((e=this.children)==null?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.grid.trigger("columnCollapseToggle",{column:this,collapsed:e})}onCellFocus(e){const t=this;t.location=e,e.rowIndex!==-1&&t.updateCellAriaLabel(t.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){E.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,r;!((t=this.location)!=null&&t.isSpecialRow)&&((r=this.location)!=null&&r.cell)&&(e!=null&&e.length||(e=this.location.column.text),E.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,t,r;(r=(t=(e=this.data)==null?void 0:e.editor)==null?void 0:t.destroy)==null||r.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const r of e){const n=z.create({owner:this,...r});n.element.classList.add("b-grid-headerwidget"),t[n.ref||n.id]=n}}destroyHeaderWidgets(){var e;for(const t of Object.values(this.headerWidgetMap||{}))(e=t.destroy)==null||e.call(t)}static generateAutoCls(){const e=[];for(let r=this;r!==zi;r=r.superclass)r.type&&r.type!==r.superclass.type&&e.push(`b-${r.type.toLowerCase()}-cell`);const t=e.join(" ");return(zi.autoClsMap||(zi.autoClsMap=new Map)).set(this,t),t}getCellClass(e){var t;const{record:r,column:n}=e,{cellCls:s,internalCellCls:a,grid:l,constructor:o,align:d,field:c}=n,u=r.fieldMap[c],h=((t=zi.autoClsMap)==null?void 0:t.get(o))||o.generateAutoCls(),g=e.cell.classList.contains("b-editing"),f={[l.cellCls]:l.cellCls,[h]:h,[s]:s,[a]:a,"b-cell-dirty":l.showDirty&&c&&!(u!=null&&u.calculated)&&r.isFieldModified(c)&&(n.compositeField||(u==null?void 0:u.persist)!==!1),[`b-grid-cell-align-${d}`]:d,"b-selected":l.selectionMode.cell&&l.isCellSelected(e),"b-focused":l.isFocused(e),"b-auto-height":n.autoHeight,"b-editing":g};return r.isSpecialRow&&f["b-checkbox-selection"]&&(f["b-checkbox-selection"]=!1),f}get locked(){return this.data.region==="locked"}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){const{sortable:e}=this.data;return!e||(this.noFieldSpecified||!this.field)&&!e.sortFn?!1:e}set sortable(e){this.set("sortable",e)}get groupable(){return!!(!(this.noFieldSpecified||!this.field)&&this.data.groupable)}set groupable(e){this.set("groupable",e)}get filterable(){return this.isLeaf&&this.data.filterable}get editor(){const e=this,{grid:t,field:r}=e;let{editor:n}=e.data;if(n&&!n.isWidget){const s=t.processCellEditor({editor:n,field:e.field});s?n=s.editor:(typeof n=="string"&&(n={type:n}),n=z.create(T.merge(e.defaultEditor,{owner:t,dataField:t.store.modelClass.getFieldDefinition(r),label:O.encodeHtml(e.text)},n)),n.formulaStore=t.store,B.remove(n.localizableProperties,"label")),!n.dontCache&&(e.data.editor=n)}return n}set editor(e){this.data.editor=e}afterChange(){var e;if(super.afterChange(...arguments),(e=this.data.editor)!=null&&e.isWidget){const{editor:t}=this,r=O.encodeHtml(this.text);t.label!==r&&(t.label=r)}}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||((e=this.parent)==null?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||((e=this.grid)==null?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const e=this.region;let t=this.previousSibling;for(;t&&(t.hidden||t.region!==e);)t=t.previousSibling;return t}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||!!(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return E.getChild(this.element,".b-grid-header-text")}get textElement(){return E.down(this.element,".b-grid-header-text-content")}get contentElement(){return E.down(this.element,".b-grid-header-children")}get isSorted(){var e;return this.grid.store.sorters.some(t=>t.field===this.field)||((e=this.grid.store.groupers)==null?void 0:e.some(t=>t.field===this.field))}get isFocusable(){var e;return this.isLeaf&&!((e=this.grid)!=null&&e.hideHeaders)}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?O.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const r=this,{parent:n}=r;r.hidden||(r.hidden=!0,n&&!n.isRoot&&!n.isTogglingAll&&!n.children.some(a=>a.hidden!==!0)&&!n.hidden&&(e=!0,n.hide()),r.isParent?r.children.forEach(s=>s.hide(!0,!0)):n.isRoot||n.meta.visibleChildren[t?"add":"delete"](r),e||r.stores.forEach(s=>s.trigger("columnHide",{column:r})))}show(e=!1){var t;const r=this,{parent:n}=r;r.hidden&&(r.hidden=!1,n!=null&&n.hidden&&n.show(),r.isParent&&((t=r.meta.visibleChildren)==null||t.forEach(s=>s.show(!0))),e||r.stores.forEach(s=>s.trigger("columnShow",{column:r})))}toggle(e){if(this.hidden&&e===void 0||e===!0)return this.show();if(!this.hidden&&e===void 0||e===!1)return this.hide()}toggleChildren(e=this.children,t=void 0){var r,n;const s=this;(r=s.grid.columns)==null||r.beginBatch(),s.isTogglingAll=!0,e.forEach(a=>a.toggle(t)),s.isTogglingAll=!1,(n=s.grid.columns)==null||n.endBatch()}onCollapseChange(e=void 0){var t,r;const n=this;if(n.collapseMode==="toggleAll")n.toggleChildren();else{const{firstChild:s}=n;s.flex!=null&&n.collapsed?(s.oldFlex=s.flex,s.width=s.element.offsetWidth):!n.collapsed&&s.oldFlex&&(s.flex=s.oldFlex,s.oldFlex=null),(t=n.grid.columns)==null||t.beginBatch(),n.isTogglingAll=!0,n.children.slice(1).forEach(a=>a.toggle(e)),n.isTogglingAll=!1,(r=n.grid.columns)==null||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:r=[]}=t;if(e)r.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:`b-icon-collapse-${t.grid.rtl?"right":"left"}`,pressedIcon:`b-icon-collapse-${t.grid.rtl?"left":"right"}`,cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:n})=>t.collapsed=n});else{const n=r.findIndex(s=>s.ref==="collapseExpand");n>-1&&r.splice(n,1)}t.headerWidgets=r,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){var e,t,r;const{grid:n}=this,s=[(t=(e=this.field)==null?void 0:e.replace(/\./g,"-"))!=null?t:"col"];return n?(s.unshift((r=n.stateId)!=null?r:n.id),n.generatedIdIndex||(n.generatedIdIndex=0),s.push(n.generatedIdIndex+=1)):(zi.generatedIdIndex||(zi.generatedIdIndex=0),s.push(zi.generatedIdIndex+=1)),this.meta.generatedId=s.join("-")}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return E.measureSize(e,(t=this.subGrid)==null?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return kS(e)&&kS(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),r=e.measureSize(e.minWidth);let n=0;return e.children&&(n=e.children.reduce((s,a)=>s+a.calculateMinWidth(),0)),Math.max(t,r,n)}resizeToFitContent(e,t,r=!1){var n,s;const a=this,{grid:l,element:o,fitMode:d}=a,{rowManager:c}=l,{records:u}=l.$store,h=u.length;if(h<=0||a.fitMode==="none"||!a.fitMode||E.isVueConfig(a.data))return;const[g]=c.rows,{rowElement:f,cellElement:m}=l.beginGridMeasuring(),p=new Se({grid:l,column:a,id:null});let v=0,b,w,D,S,x,R,M={length:0,record:null};if(m._domData={columnId:a.id,row:g,rowElement:f},p._cell=m,p.updatingSingleRow=!0,p.isMeasuring=!0,m.innerHTML="",l.resizeToFitIncludesHeader&&!l.hideHeaders){if(!l.$headerPadding){const k=globalThis.getComputedStyle(o);l.$headerPadding=parseInt(k.paddingLeft)}const _=o.querySelector(".b-grid-header-text-content");_.style.cssText="flex: none; width: auto",v=_.offsetWidth+(l.cellEllipsis?1:0)+l.$headerPadding*2+2,_.style.cssText=""}for(h>1e3?(b=Math.max(Math.min(c.topIndex+Math.round(c.rowCount/2)-500,h-1e3),0),w=b+1e3):(b=0,w=h),D=b;D<w;D++){if(S=u[D],x=a.getRawValue(S),d==="value")R=String(x).length;else if(p._record=S,p._id=S.id,p._rowIndex=D,g.renderCell(p),d==="textContent")R=m.textContent.length;else{const _=m.offsetWidth+(l.cellEllipsis?1:0);_>v&&(v=_)}R>M.length&&(M={record:S,length:R,rowIndex:D})}if((n=l.features.summary)!=null&&n.enabled){const _=(s=l.getFooterElement(a))==null?void 0:s.querySelector(".b-grid-summary-value");if(_){const k=_.scrollWidth+l.$headerPadding*2+2;k>v&&(v=k)}}return M.length>0&&(d==="value"||d==="textContent")&&(p._record=M.record,p._id=M.record.id,p._rowIndex=M.rowIndex,g.renderCell(p),v=Math.max(v,m.offsetWidth)),Array.isArray(e)&&([e,t]=e),v=Math.max(v,e||0),v=Math.min(v,t||1e6),r||l.endGridMeasuring(),a.width=a.maxWidth?v=Math.min(v,a.maxWidth):v,v}getState(){const e=this,{parentId:t}=e,r={id:e.id,type:e.type,hidden:e.hidden,region:e.region,locked:e.locked,text:e.text};return e.noFieldSpecified||(r.field=e.field),t!=null&&(r.parentId=t),e.children||(r[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(r.collapsed=e.collapsed),r}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),"text"in e&&(t.text=e.text),t.endBatch(),"hidden"in e&&t.toggle(e.hidden!==!0),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,r=e&&(t==null?void 0:t.focusedCell);(r==null?void 0:r.columnId)===this.id&&(t.owns(E.getActiveElement(t))?t.navigateRight():t._focusedCell=new Se({grid:t,rowIndex:r.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e,t){return e.getValue(t?this.editorField:this.field)}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}refreshCells(){this.grid.refreshColumn(this)}refreshHeader(){this.grid.refreshHeader(this)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){return!this.readOnly&&this.editor&&e.isEditable(this.editorField)!==!1}insertChild(e,t=null,r=!1){return e=Array.isArray(e)?e:[e],e.forEach(n=>{const{parent:s}=n;s!=null&&s.collapsed&&n===s.firstChild&&s.children.length>1&&s.children.filter(a=>!a.hidden).length===1&&(n.nextSibling.hidden=!1)}),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue({range:e,record:t,cell:r,value:n,enforceType:s}){var a;let l=!this.readOnly&&t.isEditable(this.field)!==!1;if(l&&s){const o=t.getFieldDefinition(this.field),d=(a=o==null?void 0:o.constructor)==null?void 0:a.dataConstructor;l=n==null||!o||(o==null?void 0:o.type)==="auto"||d&&(n instanceof d||typeof n===d.name.toLowerCase())}return l}calculateFillValue({value:e,record:t,fromCell:r,range:n,horizontal:s}){const a=t.getFieldDefinition(this.field);return s&&n.length===1&&(!a||(a==null?void 0:a.type)==="auto"||(a==null?void 0:a.type)==="string")&&(e=n[0].cell.innerText.trim()),e}getCurrentConfig(e){var t;const r=super.getCurrentConfig(e);return(t=this.sortable)!=null&&t.originalSortFn&&(r.sortable=this.sortable.originalSortFn),r.headerRenderer===this.internalHeaderRenderer&&delete r.headerRenderer,delete r.ariaLabel,delete r.cellAriaLabel,delete r.disableRendererWarning,r}get visible(){return this.isVisible}set visible(e){this.hidden=!e}get readOnly(){var e;const{field:t,grid:r}=this,n=!!this.get("readOnly");return t&&r&&((e=r.store.modelClass.getFieldDefinition(t))==null?void 0:e.calculated)||n}set readOnly(e){this.set("readOnly",e)}get renderer(){var e;return((e=this.data)==null?void 0:e.renderer)||this.defaultRenderer}set renderer(e){this.set("renderer",e)}get hasSummary(){return this.sum||this.summaries}get editorField(){const{field:e}=this,t=e&&this.grid.store.modelClass.getFieldDefinition(e);return t!=null&&t.formulaProviders?`#${e}`:e}};y(Ed,"$name","Column"),y(Ed,"type","column"),y(Ed,"fields",["type","text","field","renderer","afterRenderCell","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{},convert(i,e,t){return T.isObject(i)?T.merge({},t.constructor.defaultValues.editor,i):i}},"cellEditor","finalizeCellEdit",{name:"managedCellEditing",defaultValue:!0},{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(i,e,t){if(!i)return!1;if(i===!0)return!0;const r={};return typeof i=="function"?(r.originalSortFn=i,r.sortFn=i.bind(t)):typeof i=="object"&&(Object.assign(r,i),r.fn&&(r.sortFn=r.fn,delete r.fn)),r}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(i,e,t){if(!i)return!1;if(i===!0)return!0;const r={columnOwned:!0};return typeof i=="function"?r.filterFn=i:typeof i=="object"&&T.merge(r,t.constructor.defaultValues.filterable,i),r}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!0},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{Column.cellLabel}"},"vue","formula"]),y(Ed,"autoExposeFields",!1);var He=Ed;He.emptyCount=0,He.defaultWidth=100,He.exposeProperties(),He._$name="Column";var rF={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},nF=[{field:"region"}],FS=class So extends Nt(pe){construct(e){const t=this,{grid:r}=e;r&&(r._columnStore=t,t.id=`${r.id}-columns`,r.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse(t=>e.push(t)),super.doDestroy(),this.isChained||e.forEach(t=>t.destroy())}chain(e,t,r){return super.chain(e,t,{...r,tree:null})}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile((r,n)=>e.call(t,r,n),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach(r=>e+=this.calculateFixedWidth(r)):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some(e=>e.flex)}calculateFixedWidth(e){return e.flex?e.measureSize(He.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter(t=>t.isVisible&&(!t.subGrid||!t.subGrid.collapsed)).sort(e.sorterFn)),e._visibleColumns}onStoreChange({action:e,changes:t}){e==="update"&&!("hidden"in t)||this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,(e=this.masterStore)==null||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),(e.action!=="update"||"hidden"in e.changes||"region"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,r=!1){const n=this.visibleColumns,s=e instanceof He?e:this.getById(e);let a=n.indexOf(s)+(t?1:-1);if(!n[a])if(r)a=t?0:n.length-1;else return null;return n[a]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}lookupStateColumns(e){const t=this.getById(e.id),{field:r,type:n}=e;return!t&&(r||n)?this.query(s=>(!r||s.field===r)&&(!n||s.type===n)):[t]}lookupStateColumn(e){return this.lookupStateColumns(e)[0]}createRecord(e){var t,r;const{grid:n={}}=this,{store:s}=n,a=(r=(t=s==null?void 0:s.modelClass)==null?void 0:t.fieldMap)==null?void 0:r[e.field];let l=this.modelClass;if(a!=null&&a.column&&(e=Z.merge({},a.column,e)),e.type&&(l=So.getColumnClass(e.type),!l))throw new Error(`Column type '${e.type}' not registered. Please make sure you have imported the column class.`);e.locked&&(e.region="locked",delete e.locked);const o=new l(e,this);if(o.data.region||(o.data.region=n.defaultRegion||"normal"),this.autoAddField&&!o.noFieldSpecified&&s&&!a){let d=o.field;o.constructor.fieldType&&(d={name:o.field,type:o.constructor.fieldType}),s.modelClass.addField(d)}return o}indexOf(e){if(e==null)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex(r=>r.field===e)}removeAll(e=!1){const t=this;return t.some(n=>n.isTimeAxisColumn)?t.remove(t.query(n=>!n.isTimeAxisColumn),e):super.removeAll(e)}get usesAutoHeight(){return this.some(e=>e.autoHeight)}get usesFlexAutoHeight(){return this.some(e=>e.autoHeight&&e.flex!=null)}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find(t=>t.field===e.field)}:e.type?{id:e.type,node:this.allRecords.find(t=>t.type===e.type)}:{id:null,node:null}}static registerColumnType(e,t=!1){e.simpleRenderer=t,(So.columnTypes||(So.columnTypes={}))[e.type]=e}static getColumnClass(e){return So.columnTypes&&So.columnTypes[e]}generateColumnForField(e,t){var r;typeof e=="string"&&this.grid&&(e=(r=this.grid.store)==null?void 0:r.modelClass.fieldMap[e]);let n=e.column||rF[e.type]||{};return typeof n=="string"&&(n={type:n}),n=Object.assign({text:e.text||O.separate(e.name),field:e.name},t,n),e.precision!=null&&(n.format.maximumFractionDigits=e.precision),e.columnType&&(n.type=e.columnType),this.createRecord(n)}};y(FS,"configurable",{modelClass:He,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:nF,reapplySortersOnAdd:!0,useRawData:!1});var Ve=FS,sF=(i,e)=>({update:({store:t,record:r,changes:n})=>{let s=!0;return("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&(s=i.call(e,{store:t,record:r,changes:n})),s}});Ve.registerColumnType(He,!0),Ve._$name="ColumnStore";var Br=class extends He{get groupHeaderReserved(){return!0}construct(i,e){const t=this;i.renderer&&(re.deprecate("grid","7.0.0","Using deprecated `renderer` with ActionColumn, use `afterRenderCell` callback instead."),i.afterRenderCell=i.renderer,delete i.renderer),super.construct(i,e),!i.width&&!i.flex&&t.grid.ion({paint:"updateAutoWidth",thisObj:t}),t.disableIfGridReadOnly&&t.grid.element.classList.add("b-actioncolumn-readonly")}defaultRenderer({grid:i,column:e,record:t,isExport:r,callExternalRenderer:n=!0}){var s;const a=t&&"groupRowFor"in t.meta,{subGrid:l}=e,o={className:{"b-action-ct":1},children:(s=e.actions)==null?void 0:s.map((d,c)=>{var u,h;if("visible"in d&&(typeof d.visible=="function"&&d.visible({record:t})===!1||d.visible===!1)||a&&!d.showForGroup||!a&&d.showForGroup)return"";const{tooltip:g,renderer:f}=d;let m=typeof g=="function"||(u=g==null?void 0:g.startsWith)!=null&&u.call(g,"up.")?l.callback(g,l,[{record:t}]):g||"";typeof m=="string"&&(m=this.optionalL(m,this));let p;if(f){const b=(h=l.callback(f,l,[{index:c,record:t,column:e,isExport:r,tooltip:m,action:d}]))!=null?h:"";typeof b=="string"?p={tag:"span",class:"b-action-item b-tool",dataset:{...ve.encodeConfig(m),index:c},html:b}:(p=b,(p.dataset||(p.dataset={})).index=c,(p.className||(p.className={}))["b-action-item"]=1,p.className[d.cls]=d.cls)}else p={tag:"button",dataset:{...ve.encodeConfig(m),index:c},className:{"b-tool":1,"b-action-item":1,[d.cls]:d.cls}};const v=d.ariaLabel||p.dataset.btip;return v&&(p["aria-label"]=O.encodeHtml(v)),p})};return r?o.children.flatMap(d=>d.html||[]).join(","):o}onCellClick({grid:i,column:e,record:t,target:r}){var n;let s;if(e!==this||!(s=r.closest(".b-action-item[data-index]")))return;const a=s.dataset.index,l=(n=e.actions)==null?void 0:n[a],o=l==null?void 0:l.onClick;o&&this.callback(o,e,[{record:t,action:l,target:r,grid:i,column:e}])}updateAutoWidth(){const i=this,e=[],{actions:t}=i;if(!i.element)return;const r=i.actions=[];t==null||t.forEach(s=>{const a={...s};delete a.visible,a.showForGroup?(delete a.showForGroup,e.push(a)):r.push(a)}),e.length>r.length&&(i._actions=e);const n=E.createElement(i.defaultRenderer({column:i,record:new i.grid.store.modelClass,callExternalRenderer:!1})).outerHTML;i.width=E.measureText(n,i.element,!0,i.element.parentElement),i.actions=t}};y(Br,"type","action"),y(Br,"$name","ActionColumn"),y(Br,"fields",[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}]),y(Br,"defaults",{minWidth:30,filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,readOnly:!0,ariaLabel:"L{ActionColumn.rowActions}"}),Ve.registerColumnType(Br),Br.exposeProperties(),Br._$name="ActionColumn";var Yt=class extends He{get defaultEditor(){const{format:i,name:e,max:t,min:r,step:n,largeStep:s,align:a}=this;return T.cleanupProperties({type:"numberfield",format:i,name:e,max:t,min:r,step:n,largeStep:s,textAlign:a})}get formatter(){const i=this,{format:e}=i;let t=i._formatter;return(!t||i._lastFormat!==e)&&(i._formatter=t=Ca.getLocalizedFormatter(i._lastFormat=e)),t}formatValue(i,e=!0){return i!=null&&(i=this.formatter.format(i),this.unit&&e&&(i=`${i}${this.unit}`)),i!=null?i:""}defaultRenderer({value:i}){return this.formatValue(i)}updateLocalization(){super.updateLocalization(),this._formatter=null}};y(Yt,"type","number"),y(Yt,"fieldType","number"),y(Yt,"fields",[{name:"format",defaultValue:""},"min","max","step","largeStep","unit","renderer"]),y(Yt,"defaults",{filterType:"number",align:"end",exportedType:"number"}),Ve.registerColumnType(Yt,!0),Yt.exposeProperties(),Yt._$name="NumberColumn";var Pa=class extends Yt{static get defaults(){return{function:"sum",includeParentInChangeSet:null,enableAggregation:!0,includeFilteredOutRecords:null}}construct(i,e){const t=this;t.configuredAlign="align"in i,t.configuredEditor="editor"in i,super.construct(...arguments);const{grid:r}=e;t.function==="sum"&&(t.function="sumChildren"),r&&(t.store=r.store)}set store(i){const e=this,t={update:"onRecordUpdate",thisObj:e,prio:1e3},r=e._store;if(i!==r){r&&r.un(t),e._store=i;const{modelClass:n}=i,s=n.fieldMap[e.field];s&&s.type==="number"&&(e.configuredAlign||(e.align="end"),e.configuredEditor||(e.editor="number")),i.ion(t)}}canEdit(i){return i.isLeaf}get store(){return this._store}sumChildren(...i){let e=0;for(let t=0,{length:r}=i;t<r;t++)e+=parseFloat(i[t]||0,10);return e}avg(...i){let e=0;const{length:t}=i;for(let r=0;r<t;r++)e+=parseFloat(i[r]||0,10);return e/t}onRecordUpdate({record:i,changes:e}){const t=this,{rowManager:r}=t.grid;t.field in e&&i.isLeaf&&i.bubble(n=>{const s=r.getRowFor(n);if(s){const a=s.getCell(t.field);a&&s.renderCell(a)}},!0)}getRawValue(i){let e;const t=this,{field:r,grid:n,enableAggregation:s}=t,a=n.store.isFiltered&&t.includeFilteredOutRecords?i.unfilteredChildren:i.children;if(a!=null&&a.length){const l=t.function,o=typeof l=="string"&&typeof Math[l]=="function",{handler:d,thisObj:c}=o?{handler:Math[l],thisObj:Math}:t.resolveCallback(l);e=s?d.apply(c,a.map(u=>t.getRawValue(u))):void 0,t.includeParentInChangeSet&&!n.isTreeGrouped?i.set(r,e,!0):i.setData(r,e)}else e=i.getValue(r);return e}canFillValue({record:i}){return i.isLeaf&&super.canFillValue(...arguments)}};y(Pa,"type","aggregate"),y(Pa,"fields",["function","includeParentInChangeSet","enableAggregation","includeFilteredOutRecords"]),Ve.registerColumnType(Pa,!0),Pa.exposeProperties(),Pa._$name="AggregateColumn";var aF=({source:i,value:e,userAction:t})=>{t&&i.cellInfo.record.setValue(i.name,e)},ir=class extends He{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1,ariaLabel:"L{WidgetColumn.rowWidgets}"}}construct(i){i.disableRendererWarning||(i.renderer&&(i.afterRenderCell=i.renderer,delete i.renderer,re.deprecate("grid","7.0.0","Using deprecated `renderer` with WidgetColumn, use `afterRenderCell` callback instead.")),this.renderer&&this.renderer!==this.defaultRenderer&&(i.afterRenderCell=this.renderer,this.renderer=this.defaultRenderer,re.deprecate("grid","7.0.0","Using deprecated `renderer` with WidgetColumn, use `afterRenderCell` callback instead."))),super.construct(...arguments);const e=this,{grid:t}=e;t&&(t.widgetColumnCache?e.widgetColumnCache=t.widgetColumnCache:(e.widgetColumnCache=t.widgetColumnCache=new Map,t.ion({removeRows:"onRemoveGridRows",thisObj:this})))}onRemoveGridRows({rows:i}){i.forEach(({columnWidgets:e})=>{e&&(this.freeWidgets([...e.values()].flat()),e.clear())})}freeWidgets(i){i==null||i.forEach(e=>{var t;const{widgetColumnCache:r}=this,{column:n}=e.cellInfo,s=`${n.id}-${e.widgetColumnIndex}`;(t=n.onAfterWidgetDerendered)==null||t.call(n,e),e.cellInfo=e.__boundRecordId=e.owner=null,e.element.remove(),(r.get(s)||r.set(s,[]).get(s)).push(e)}),i.length=0}freeColumnWidgets(){const{id:i}=this;this.grid.rowManager.forEach(e=>{var t;const r=(t=e.columnWidgets)==null?void 0:t.get(i);r!=null&&r.length&&this.freeWidgets(r)})}hide(){this.freeColumnWidgets(),super.hide(...arguments)}getWidget(i,e){var t;const r=this,{grid:n,widgetColumnCache:s}=r,a=`${e.column.id}-${i.widgetColumnIndex}`,l=s.get(a)||s.set(a,[]).get(a);let o,{length:d}=l;return d?(o=l[--d],delete o.onBeforeDestroy,l.length=d,i.owner=n,z.reconfigure(o,i)):(r.onBeforeWidgetCreate(i,e),i.recomposeAsync=!1,i.owner=n,o=z.create(i),r.onAfterWidgetCreate(o,e),o.name&&o.ion({change:aF})),(t=r.onBeforeWidgetRender)==null||t.call(r,o),o}doDestroy(){this.grid.isDestroying?([...this.widgetColumnCache.values()].flat().forEach(i=>i.destroy()),this.widgetColumnCache.clear()):this.freeColumnWidgets(),super.doDestroy()}updateReadOnly(i){this.readOnly||this.grid.rowManager.forEach(e=>{var t,r;(r=(t=e.columnWidgets)==null?void 0:t.get(this.id))==null||r.forEach(n=>{n.cellInfo.record.readOnly||(n.readOnly=i)})})}defaultRenderer(i){const e=this,{grid:t}=e,{cellElement:r,column:n,record:s,row:a,isExport:l}=i,{widgets:o}=n;if(!l&&o){const d=a.columnWidgets||(a.columnWidgets=new Map),c=d.get(e.id);[...r.childNodes].forEach(u=>{var h;(h=u.classList)!=null&&h.contains("b-widget")||u.remove()}),i.widgets=n.widgets.map((u,h)=>{var g,f;u.widgetColumnIndex=h;const m=(c==null?void 0:c[h])||e.getWidget(u,i);if(m.cellInfo=i,m.element.isConnected||(m.rendered?r.appendChild(m.element):m.render(r)),e.meta.isSelectionColumn||(m.readOnly=t.readOnly||s.readOnly||e.readOnly),((g=e.onBeforeWidgetSetValue)==null?void 0:g.call(e,m,i))!==!1){const p=u.valueProperty||"value"in m&&"value"||m.defaultBindProperty;if(p&&(!n.noFieldSpecified&&n.widgets.length===1||m.name)){const v=m.name?s.getValue(m.name):i.value;typeof v=="object"&&m.__boundRecordId!==s.id&&(m[`_${p}`]=NaN),m.suspendEvents(),m[p]=v,m.resumeEvents(),m.__boundRecordId=s.id}}return(f=e.onAfterWidgetSetValue)==null||f.call(e,m,i),m}),d.set(e.id,i.widgets)}if(!o)return""}onBeforeWidgetCreate(i,e){}onAfterWidgetCreate(i,e){}resizeToFitContent(){}};y(ir,"$name","WidgetColumn"),y(ir,"type","widget"),y(ir,"fields",["widgets","disableRendererWarning"]),Ve.registerColumnType(ir),ir.exposeProperties(),ir._$name="WidgetColumn";var Yn=class extends ir{construct(i,e){var t;i.localizableProperties=Re.mergeMethods.distinct(i.localizableProperties,["checkAriaLabel"]),super.construct(...arguments);const r=this;if(r.widgets[0].cls=r.checkCls,Object.assign(r,{externalHeaderRenderer:r.headerRenderer,externalOnBeforeWidgetSetValue:r.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:r.onAfterWidgetSetValue}),r.setData({onBeforeWidgetSetValue:r.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:r.internalOnAfterWidgetSetValue,headerRenderer:r.internalHeaderRenderer}),!r.meta.isSelectionColumn){const n=(t=r.grid)==null?void 0:t.store.modelClass;r.field?n&&typeof r[r.field]!="boolean"&&!n.fieldMap[r.field]&&!r.constructor.suppressNoModelFieldWarning&&!i.suppressNoModelFieldWarning&&(console.warn(r.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),n.addField({name:r.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}get groupHeaderReserved(){return this.grid.selectionMode.showCheckAllInGroupRows}doDestroy(){var i;(i=this.headerCheckbox)==null||i.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:i,column:e}){let t;return i.classList.add("b-check-header"),e.showCheckAll?(i.classList.add("b-check-header-with-checkbox"),e.headerCheckbox?i.appendChild(e.headerCheckbox.element):e.headerCheckbox=new Qi({appendTo:i,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:e}})):t=e.headerText,t=e.externalHeaderRenderer?e.externalHeaderRenderer.call(this,...arguments):t,e.showCheckAll?void 0:t}updateCheckAllState(i){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=i,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:i}){const e=this;if(e.field){const{store:t}=e.grid;t.beginBatch(),t.forEach(r=>e.updateRecord(r,e.field,i)),t.endBatch()}e.trigger("toggleAll",{checked:i})}defaultRenderer(i){var e;const{value:t,isExport:r,record:n}=i,{grid:s}=this,a=super.defaultRenderer(i),l=(e=i.widgets)==null?void 0:e[0];return r?a!=null?a:t==null?"":t:(l.readOnly=this.readOnly||(s.readOnly||n.readOnly)&&!this.meta.isSelectionColumn,t?l.input.setAttribute("checked",!0):l.input.removeAttribute("checked"),l.input.setAttribute("aria-label",this.checkAriaLabel),a)}onBeforeWidgetRender(i,e){i.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}onAfterWidgetDerendered(i,e){i.un({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(i,{cellElement:e}){var t;e.widget=i,i.record=i.cellInfo.record,(t=this.externalOnBeforeWidgetSetValue)==null||t.call(this,...arguments)}internalOnAfterWidgetSetValue(i){var e;(e=this.externalOnAfterWidgetSetValue)==null||e.call(this,...arguments)}onBeforeCheckboxChange({source:i,checked:e,userAction:t}){const r=this,{grid:n}=r,{record:s}=i.cellInfo;return t&&r.field&&(!n.features.cellEdit||n.features.cellEdit.disabled)||r.meta.isSelectionColumn&&!n.isSelectable(s)&&(!n.selectionMode.showCheckAllInGroupRows||!s.isGroupHeader)&&e?!1:r.trigger("beforeToggle",{record:s,checked:e})}onCheckboxChange({source:i,checked:e}){const t=this,{record:r}=i.cellInfo,{field:n}=t;n&&(t.updateRecord(r,n,e),e?t.updateCheckAllState(t.grid.store.every(s=>s[n],null,!0)):t.updateCheckAllState(!1)),t.trigger("toggle",{record:r,checked:e,checkbox:i})}updateRecord(i,e,t){i.setValue(e,t)}onCellKeyDown({event:i,cellElement:e,record:t}){if(i.key===" "){const{target:r}=i,n=e.widget;r.matches(".b-grid-cell")&&!(t!=null&&t.readOnly||n.disabled||n.readOnly)&&(n==null||n.toggle(),i.preventDefault(),i.handled=!0)}}getCurrentConfig(i){const e=super.getCurrentConfig(i);return delete e.onBeforeWidgetSetValue,delete e.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(e.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(e.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),e}};y(Yn,"$name","CheckColumn"),y(Yn,"type","check"),y(Yn,"fields",["checkCls",{name:"checkAriaLabel",defaultValue:"L{Checkbox.toggleName}"},"showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),y(Yn,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,minWidth:30,widgets:[{type:"checkbox",valueProperty:"checked"}]}),Ve.registerColumnType(Yn,!0),Yn._$name="CheckColumn";var zr=class extends He{constructor(){super(...arguments),y(this,"preventCellEditViaMouse",!0)}construct(){super.construct(...arguments);const i=this,{editor:e,colors:t}=i;t!=null&&t.length&&(e.colors=t),e.addNoColorItem=i.addNoColorItem,e.ion({colorSelected:"onColorSelected",thisObj:i})}applyValue(i,e,t){if(!this.isConstructing){const{editor:r}=this;e==="colors"?r.colors=t:e==="addNoColorItem"&&(r.addNoColorItem=t)}super.applyValue(...arguments)}get picker(){return this.editor.picker}defaultRenderer({value:i}){let e="b-empty",t=i;if(i){const r=this.picker.getColorClassName(i);r?(e=r,t=null):e=""}return{className:"b-color-cell-inner "+e,style:{backgroundColor:t},"data-btip":i}}onCellClick({grid:i,record:e,target:t}){var r;if(t.classList.contains("b-color-cell-inner")&&!this.readOnly&&!i.readOnly&&!e.isSpecialRow&&!e.readOnly&&!((r=i.features.cellEdit)!=null&&r.finishEditingPromise)){const{picker:n}=this,s=e.get(this.field);this._editingRecord=e,n.deselectAll(),n.select(s),n.refresh(),n.showBy(t)}}onColorSelected({color:i}){var e;!((e=this.grid.features.cellEdit)!=null&&e.isEditing)&&this._editingRecord&&this._editingRecord.set(this.field,i)}};y(zr,"$name","ColorColumn"),y(zr,"type","color"),y(zr,"fields",["colors",{name:"addNoColorItem",defaultValue:!0}]),y(zr,"defaults",{align:"center",editor:"colorfield"}),Ve.registerColumnType(zr),zr._$name="ColorColumn";var Wr=class extends He{static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}construct(i={},e){if(super.construct(i,e),this.grid){const{field:t}=this,{store:r}=this.grid,{modelClass:n}=r,s=t&&n.getFieldDefinition(t);if(s&&!s.isDateDataField){console.warn(`DateColumn expects the \`type\` of the model field \`${t}\` to be of type \`date\``);const a=n.addField({...s.getCurrentConfig(),type:"date",["format"in i?"format":void 0]:this.format});r.forEach(l=>l.data[s.dataSource]=a.convert(l[t]))}}}defaultRenderer({value:i}){return i?this.formatValue(i):""}groupRenderer({cellElement:i,groupRowFor:e}){i.innerHTML=this.formatValue(e)}formatValue(i){return typeof i=="string"&&(i=C.parse(i,this.format||void 0)),C.format(i,this.format||void 0)}set format(i){const{editor:e}=this.data;this.set("format",i),e&&(e.format=i)}get format(){return this.get("format")}get defaultEditor(){const i=this,{min:e,max:t,step:r,format:n}=i;return{name:i.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:i.grid.weekStartDay,format:n,max:t,min:e,step:r}}};y(Wr,"$name","DateColumn"),y(Wr,"type","date"),y(Wr,"fieldType","date"),y(Wr,"fields",["format","pickerFormat","step","min","max","renderer"]),Ve.registerColumnType(Wr,!0),Wr.exposeProperties(),Wr._$name="DateColumn";var qn=class extends Yt{constructor(){super(...arguments),y(this,"circleHeightPercentage",.75)}construct(){super.construct(...arguments),this.showCircle&&(re.deprecate("core","7.0.0","PercentColumn `showCircle` is deprecated, in favor of `mode`"),this.mode="circle")}defaultRenderer({value:i,record:e,isExport:t}){var r,n;i=i||0;const s=this,a=s.formatValue(i,e)||i,l=`${s.text?`${s.text} : `:""}${a}`;if(t)return a;if(s.mode==="number")return a+"%";const{min:o,max:d}=s;if(s.mode==="circle"){const c=Math.round(s.circleHeightPercentage*s.grid.rowHeight)+"px";return{tabIndex:0,role:"progressbar","aria-valuemin":o,"aria-valuemax":d,"aria-valuenow":i,"aria-label":((r=s.formatAriaLabel)==null?void 0:r.call(s,l,e))||l,className:{"b-percentdone-circle":1,"b-empty":i===0,"b-full":i===100,"b-over":i>100},style:{height:c,width:c,"--grid-percent-circle-angle":`${i/100}turn`},dataset:{value:a}}}return{className:"b-percent-bar-outer",role:"progressbar","aria-valuemin":o,"aria-valuemax":d,"aria-valuenow":i,"aria-label":((n=s.formatAriaLabel)==null?void 0:n.call(s,l,e))||l,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":i===0,"b-low":i<s.lowThreshold,"b-full":i===100,"b-over":i>100},style:{width:i+"%"},children:[s.showValue?{tag:"span",text:a+"%"}:void 0]}]}}resizeToFitContent(){if(this.mode==="number")return super.resizeToFitContent(...arguments)}get align(){const i=this.get("align"),{mode:e}=this;return i||(e==="number"?"end":e==="circle"?"center":"start")}set align(i){this.set("align",i)}get htmlEncode(){return this.mode==="number"}get internalCellCls(){return this.mode==="bar"?"b-percent-bar-cell":""}};y(qn,"type","percent"),y(qn,"fields",["showValue","lowThreshold","showCircle","mode"]),y(qn,"defaults",{min:0,max:100,step:1,align:null,showCircle:!1,mode:"bar",showValue:!1,lowThreshold:0,htmlEncode:!1,searchable:!1,summaryRenderer:({sum:i})=>`${i}%`,fitMode:!1}),qn.sum="average",Ve.registerColumnType(qn,!0),qn._$name="PercentColumn";var jr=class extends Yt{constructor(){super(...arguments),y(this,"preventCellEditViaMouse",!0)}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,exportedType:"string",filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",align:"start",fitMode:"value"}}defaultRenderer({value:i,isExport:e}){return e?"\u2605".repeat(i):{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:B.populate(this.max,t=>{const r=t<i;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":r,"b-empty":!r,[r?this.filledIcon:this.emptyIcon]:!0}}})}}onCellClick({grid:i,column:e,record:t,target:r,event:n}){if(r.classList.contains("b-rating-icon")&&!i.readOnly&&e.editable){let s=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(n.metaKey||n.shiftKey)&&(s=s-1),t.getValue(e.field)===1&&s===0&&(s=-1),t.set(e.field,s+1)}}};y(jr,"$name","RatingColumn"),y(jr,"type","rating"),y(jr,"fieldType","number"),y(jr,"fields",["emptyIcon","filledIcon","editable"]),Ve.registerColumnType(jr,!0),jr.exposeProperties(),jr._$name="RatingColumn";var xd=class extends He{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,mergeable:!1,minWidth:50,width:50,align:"right",text:"#",ariaLabel:"L{RowNumberColumn.rowNumber}",editor:!1,readOnly:!0}}construct(i){super.construct(...arguments);const e=this,{grid:t}=e;e.internalCellCls="b-row-number-cell",e.externalHeaderRenderer=e.headerRenderer,e.setData("headerRenderer",e.internalHeaderRenderer),t&&(t.ion({bindStore:"bindStore",thisObj:e}),e.bindStore({store:t.store,initial:!0}),t.store.count&&!t.rendered&&t.ion({paint:"resizeToFitContent",thisObj:e,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:i,initial:e}){const t=this;t.detachListeners("grid"),i.ion({name:"grid",[`change${t.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:t}),!e&&!t.resizeToFitContent()&&t.measureOnRender()}onStoreChange({action:i,isMove:e}){if(i==="dataset"||i==="add"||i==="remove"||i==="removeall"){if(i==="remove"&&e)return;const t=this.resizeToFitContent();i==="dataset"&&!t&&this.grid.store.count&&this.measureOnRender()}}measureOnRender(){this.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:this})}defaultRenderer({record:i,grid:e}){var t,r,n;let s=i.isSpecialRow?"":e.store.indexOf(i,!0)+1;return(t=e.splitFrom)!=null&&t.isLockedRows&&(s+=(n=(r=e.splitFrom.features.lockRows)==null?void 0:r.numberOfLockedRows)!=null?n:0),s}resizeToFitContent(){var i;const e=this,t=(i=e.grid.features.lockRows)==null?void 0:i.subViews,r=(t==null?void 0:t[1])===e.grid?t[0]:e.grid,{element:n}=r,{store:s}=r,{count:a}=s;if(a&&!e.hidden){const l=n.querySelector(`.b-grid-cell[data-column-id="${e.id}"]`);if(l){const o=l.isConnected?parseInt(E.getStyleValue(l,"padding-left")):e._cachedCellPadding||0,d=E.measureText(a,l);return e.width=Math.max(e.minWidth,d+2*o),e._cachedCellPadding=o,!0}}return!1}set flex(i){}internalHeaderRenderer({headerElement:i,column:e}){var t;return i.classList.add("b-rownumber-header"),((t=e.externalHeaderRenderer)==null?void 0:t.call(this,...arguments))||e.headerText}};y(xd,"$name","RowNumberColumn"),y(xd,"type","rownumber"),Ve.registerColumnType(xd,!0),xd._$name="RowNumberColumn";var Oa=class extends He{static get defaults(){return{htmlEncode:!1}}constructor(i,e){super(...arguments);const t=this;if(!t.template)throw new Error("TemplateColumn needs a template");if(typeof t.template!="function")throw new Error("TemplateColumn.template must be a function")}defaultRenderer(i){if(!i.record.isSpecialRow)return this.template({value:i.value,record:i.record,field:this.field})}};y(Oa,"type","template"),y(Oa,"fields",["template"]),Ve.registerColumnType(Oa,!0),Oa.exposeProperties(),Oa._$name="TemplateColumn";var Ur=class extends He{static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:i}){return i?this.formatValue(i):""}groupRenderer({cellElement:i,groupRowFor:e}){i.innerHTML=this.formatValue(e)}formatValue(i){return typeof i=="string"&&(i=C.parse(i,this.format)),C.format(i,this.format)}set format(i){const{editor:e}=this;this.set("format",i),e&&(e.format=i)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"timefield",format:this.format}}};y(Ur,"$name","TimeColumn"),y(Ur,"type","time"),y(Ur,"fieldType","date"),y(Ur,"fields",["format"]),Ve.registerColumnType(Ur,!0),Ur.exposeProperties(),Ur._$name="TimeColumn";var $a=class extends He{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}construct(i,e,...t){super.construct(i,e,...t);const r=this;r.shouldHtmlEncode=r.htmlEncode,r.setData("htmlEncode",!1);const{renderer:n}=r;n&&!(r.grid.splitFrom||r.grid.initialConfig.splitFrom)&&(r.originalRenderer=n),r.setData("renderer",r.treeRenderer.bind(r))}treeRenderer(i){var e,t,r,n,s,a,l;const o=this,{grid:d,cellElement:c,row:u,record:h,isExport:g}=i,{features:f}=d;if(!f.tree)throw new Error("TreeColumn requires the Tree feature to be enabled");const m=h.instanceMeta(d.store),p=!h.isLeaf&&m.collapsed,v={className:"b-tree-cell-value"},b=[v],w={className:{"b-tree-cell-inner":1},tag:h.href?"a":"div",href:h.href,target:h.target,children:b},D=f.tree.treeLines,S=d.isTreeGrouped&&!h.isLeaf&&f.treeGroup.parentRenderer;let x,R,{value:M}=i,_=o;if(o.originalRenderer||S){let I;S?(h.field&&(_=d.columns.get(h.field),_?M=_.isWidgetColumn?M:(t=(e=_===o?_.originalRenderer:_.renderer)==null?void 0:e.call(_,{...i,column:_,value:h.name,isTreeGroup:!0}))!=null?t:h.name:M=h.name),I=f.treeGroup.parentRenderer({...i,field:h.field,value:M,column:_,record:h.firstGroupChild,grid:d})):I=o.originalRenderer(i);const A=(r=d.hasFrameworkRenderer)==null?void 0:r.call(d,{cellContent:I,renderingColumn:_});x=typeof I=="object"&&!A,M=A?"":I===!1?c.innerHTML:I,i.rendererHtml=I}if(x||(M=String(M!=null?M:"")),g)return M;if(h.isLeaf)c.classList.add("b-tree-leaf-cell"),R=i.iconCls||h.iconCls||o.leafIconCls;else{const I=h.isExpanded(d.store),A=I?o.collapseIconCls:o.expandIconCls,P=p?o.expandedFolderIconCls:o.collapsedFolderIconCls;c.classList.add("b-tree-parent-cell"),c.setAttribute("aria-expanded",I),u.toggleCls("b-loading-children",!!m.isLoadingChildren),b.unshift({tag:"i",className:{"b-tree-expander":1,[A]:1,"b-empty-parent":!m.isLoadingChildren&&h.children!==!0&&!((n=h.children)!=null&&n.length)}}),h.meta.hasIcon=R=i.iconCls||h.iconCls||P}if(R&&b.splice(b.length-1,0,{tag:"i","aria-hidden":"true",className:{"b-tree-icon":1,[R]:1}}),u.isRow&&!h.isLeaf)if(u.setAttribute("aria-expanded",!p),p)u.removeAttribute("aria-owns");else for(const I in d.subGrids){const A=u.elements[I];E.setAttributes(A,{"aria-owns":(s=h.children)!=null&&s.length?(a=h.children)==null?void 0:a.map(P=>`${d.id}-${I}-${P.id}`).join(" "):null})}Array.isArray(M)?v.children=M:x?Object.assign(v,M):_!=null&&_.shouldHtmlEncode||!M.includes("<")?(w.className["b-text-value"]=1,v.text=M):v.html=M;let k=0;h.isLeaf?k+=(l=h.parent)!=null&&l.meta.hasIcon?2.2:R?.5:.4:k+=R?-.15:0;const F=[];if(D)for(let I=0;I<h.childLevel;I++)F.push({tag:"span",style:`margin: 0 ${o.indentSize/2-.2-.125}em 0 ${o.indentSize/2+.2}em`,className:`b-tree-line b-tree-line-${I}`});else k+=h.childLevel*o.indentSize;return w.style=`padding-inline-start:${k}em`,D?[...F,w]:w}getCurrentConfig(i){const e=super.getCurrentConfig(i);return e.renderer=this.originalRenderer,e}isTreeExpanderIcon(i){return i.matches("."+this.expandIconCls.trim().replace(/\s/g,".")+",."+this.collapseIconCls.trim().replace(/\s/g,"."))}};y($a,"$name","TreeColumn"),y($a,"type","tree"),Ve.registerColumnType($a,!0),$a.exposeProperties(),$a._$name="TreeColumn";var Kn=class extends me{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0},{name:"fixed",type:"boolean",internal:!0}]}};Kn.exposeProperties(),Kn._$name="GridRowModel";var lF={cut:1,copy:1,paste:1},Ha=class extends ie.mixin(Bw){get clipboardRecords(){return this.clipboardData||[]}isActionAvailable({event:i,actionName:e}){var t,r;return lF[e]?!this.disabled&&globalThis.getSelection().toString().length===0&&(e==="copy"||!this.copyOnly)&&!((t=this.client.features.cellEdit)!=null&&t.isEditing)&&!((r=this.client.focusedCell)!=null&&r.isSpecialRow)&&!E.isEditable(i.target,!0):!1}cellsToString(i){var e;const t=this;let r=0,n=0,s="";i.sort((a,l)=>a.rowIndex===l.rowIndex?a.columnIndex-l.columnIndex:a.rowIndex-l.rowIndex);for(const a of i){const{record:l,_column:o,rowIndex:d,columnIndex:c}=a;d>r?(s.length>0&&(s+=`
`.repeat(d-r)),r=d,n=c):c>n&&(s.length>0&&(s+="	".repeat(c-n)),n=c);let u=(e=o==null?void 0:o.toClipboardString)==null?void 0:e.call(o,a);u===void 0&&(u=l.getValue(o.field),u instanceof Date?u=C.format(u,t.dateFormat):u=u==null?void 0:u.toString()),t.toCopyString&&(u=t.toCopyString({currentValue:u,column:o,record:l})),u=u==null?void 0:u.replaceAll(/[\n\t]/g," "),s+=u||t.emptyValueChar}return s}setFromStringData(i,e=!1,t=this.client.store,r){var n;const s=this,{client:a}=s,{columns:l,selectedCells:o,_shiftSelectRange:d}=a,c=new Set,u=s.stringAs2dArray(i),h=[],g=[];if(!e&&(d==null?void 0:d.length)===o.length){const f=s.cellSelectorsAs2dArray(d);if((f==null?void 0:f.length)%u.length===0&&f.columnCount%u.columnCount===0)for(let m=0;m<f.length;m+=u.length)for(let p=0;p<f.columnCount;p+=u.columnCount)h.push(f[m][p])}else!e&&o.length>1&&u.length===1&&u[0].length===1&&h.push(...o);h.length||h.push(o==null?void 0:o[0]);for(const f of h)for(let m=0;m<u.length;m++){const p=u[m],v=e?t.createRecord():t.getAt(f.rowIndex+m);if(v&&!v.readOnly){for(let b=0;b<p.length;b++){const w=r?null:l.visibleColumns[e?b:f.columnIndex+b],D=(w==null?void 0:w.field)||(r==null?void 0:r[b]);let S=p[b];if(D&&S&&!(w!=null&&w.readOnly)){if(S===s.emptyValueChar&&(S=null),w!=null&&w.fromClipboardString&&(S=w.fromClipboardString({string:S,record:v})),s.toPasteValue&&(S=s.toPasteValue({currentValue:S,record:v,column:w,field:D})),typeof S=="string"&&((n=v.getFieldDefinition(D))!=null&&n.isDateDataField)){const x=C.parse(S,s.dateFormat);isNaN(x.getTime())||(S=x)}v.set(D,S,!1,!1,!1,!0),w&&g.push(a.normalizeCellContext({column:w,record:v}))}}c.add(v)}}return{modifiedRecords:[...c],targetCells:g}}cellSelectorsAs2dArray(i){const e=[];let t=null,r;for(const n of i)n.id!==t&&(t=n.id,r=[],e.push(r)),r.push(n);return e.columnCount=e[0].length,e.some(n=>n.length!==e.columnCount)?!1:e}stringAs2dArray(i){const e=[],t=i.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/).filter(r=>r.length);for(const r of t){const n=r.split("	");if(e.columnCount&&n.length!==e.columnCount)return!1;e.columnCount=n.length,e.push(n)}return e}};y(Ha,"configurable",{copyOnly:null,keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!1,toCopyString:null,toPasteValue:null,emptyValueChar:" ",dateFormat:"lll",generateNewName(i,e,t=this.client.store){const{nameField:r}=this;let n=i.getValue(r),s=2;(e==null?void 0:e.meta.generatedName)===n&&(n=e.meta.originalName);let a=n;if(a!=null&&a!=="")for(;t.findRecord(r,a);)a=`${n} - ${s}`,s+=1;return i.meta.generatedName=a,i.meta.originalName=n,a}}),Ha._$name="CopyPasteBase";var Rd=new Map,Va=new Map,yh="Grid",bh={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},oF=/\$\d+$/,K=class{static registerFeature(i,e=!1,t=null,r=null){r=O.uncapitalize(r||Object.prototype.hasOwnProperty.call(i,"$name")&&i.$$name||i.name),r=r.replace(oF,""),Array.isArray(t)||(t=[t||yh]),t.forEach(n=>{const s=bh[n]||n,a=Rd.get(s)||new Map,l=Va.get(s)||new Map;a.set(r,i),l.set(i,e),Rd.set(s,a),Va.set(s,l)})}static getTypeNameFeatures(i=yh){const e=bh[i]||i,t=Rd.get(e),r={};return t&&t.forEach((n,s)=>r[s]=n),r}static getTypeNameDefaultFeatures(i=yh){const e=bh[i]||i,t=Rd.get(e),r=Va.get(e),n={};return t&&r&&t.forEach((s,a)=>{r.get(s)&&(n[a]=s)}),n}static getInstanceFeatures(i){return i.$meta.names.reduce((e,t)=>Object.assign(e,this.getTypeNameFeatures(t)),{})}static getInstanceDefaultFeatures(i){return i.$meta.names.reduce((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce((r,[n,s])=>(this.isDefaultFeatureForTypeName(s,t)?r[n]=s:delete r[n],r),e),{})}static isDefaultFeatureForTypeName(i,e=yh){const t=bh[e]||e,r=Va.get(t);return r&&r.get(i)||!1}static isDefaultFeatureForInstance(i,e){const t=e.$meta.names.slice().reverse();let r=null;for(let n=0,s=t.length;n<s&&r===null;++n){const a=Va.get(t[n]);a&&a.has(i)&&(r=a.get(i))}return r||!1}static reset(){Rd.clear(),Va.clear()}},Td=class extends Ha{constructor(){super(...arguments),y(this,"entityName","cell")}static get pluginConfig(){return{chain:["populateCellMenu","afterSelectionModeChange"]}}afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const i=this;i.client.selectionMode.cell?i._disabledBySelectionMode&&(i.disabled=!1,delete i._disabledBySelectionMode):i.disabled=!0}set copyOnly(i){this._copyOnly=i}get copyOnly(){var i;return this._copyOnly==null?!((i=this.client.features.cellEdit)!=null&&i.enabled):!!this._copyOnly}get canCopy(){var i;const{client:e}=this;return!!(!this.disabled&&e.selectedCells.length&&(!e._selectedRows.length||(i=e.features.rowCopyPaste)!=null&&i.disabled||e.focusedCell&&e.isCellSelected(e.focusedCell)))}get canCutPaste(){var i;return this.canCopy&&!this.copyOnly&&!((i=this.client.features.cellEdit)!=null&&i.isEditing)&&!this.client.readOnly}isActionAvailable({actionName:i}){return super.isActionAvailable(...arguments)&&this.canCopy&&(i==="copy"||this.canCutPaste)}async cut(){await this.copy(!0)}async copy(i=!1){typeof i!="boolean"&&(i=!1);const e=this,{selectedCells:t}=e.client,r=i?t.filter(n=>{var s;return!((s=n.record)!=null&&s.readOnly)}):t;if(r){if(i?!e.canCutPaste:!e.canCopy)return;const n=e.cellsToString(r);if(await e.writeToClipboard(n,i,{cells:r})===void 0)return;if(i===!0)for(const s of r){const{column:a,record:l}=s;if(!a.readOnly){let o=null;a.fromClipboardString&&(o=a.fromClipboardString({string:o,record:l})),s.record.set(s.column.field,o)}}e.client.trigger("copy",{cells:r,copiedDataString:n,isCut:i,entityName:e.entityName})}}async beforeCopy({data:i,isCut:e,cells:t}){return await this.client.trigger("beforeCopy",{cells:t,data:i,isCut:e,entityName:this.entityName})}async paste(){var i;const e=this,{client:t,entityName:r}=e,n=t.selectedCells[0];if(!e.canCutPaste||!n)return;const s=(i=await e.readFromClipboard({},!0))==null?void 0:i.data;if(!s)return;const{modifiedRecords:a,targetCells:l}=e.setFromStringData(s);t.selectedCells.length===1&&l.length>1&&t.selectCellRange(l[0],l[l.length-1]),t.trigger("paste",{clipboardData:s,targetCell:n,modifiedRecords:[...a],entityName:r})}async beforePaste({data:i,text:e}){return await this.client.trigger("beforePaste",{clipboardData:i,targetCell:this.client.selectedCell,entityName:this.entityName,text:e})}populateCellMenu({record:i,items:e}){const t=this;t.canCopy&&(e.cutCell={text:t.cutText,localeClass:t,icon:"b-icon b-icon-cut",weight:115,disabled:i.readOnly||!t.canCutPaste,onItem:()=>t.cut()},e.pasteCell={text:t.pasteText,localeClass:t,icon:"b-icon b-icon-paste",weight:120,disabled:i.readOnly||!t.canCutPaste||t.hasClipboardData()===!1,onItem:()=>t.paste()},e.copyCell={text:t.copyText,localeClass:t,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:()=>t.copy()})}};y(Td,"$name","CellCopyPaste"),y(Td,"configurable",{useNativeClipboard:!re.isTestEnv,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}",allowedDataSources:"none"}),Td._$name="CellCopyPaste",K.registerFeature(Td);var Na=class extends fe(ie){static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(i,e){super.construct(i,e);const t=this,r={cellClick:"onCellClick",readOnly:"syncEditingReadOnly",thisObj:t};t.grid=i,t.triggerEvent!=="cellclick"&&(r[t.triggerEvent]="onTriggerEditEvent"),i.ion(r),t.bindStore(i.store)}doDestroy(){this.grid.columns.allRecords.forEach(i=>{var e;(e=i._cellEditor)==null||e.destroy()}),super.doDestroy()}doDisable(i){i&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(i)}set disabled(i){super.disabled=i}get disabled(){const{grid:i}=this;return!!(super.disabled||i.disabled||i.readOnly)}get isEditing(){return!!this.editorContext}get activeRecord(){var i;return((i=this.editorContext)==null?void 0:i.record)||null}async onCellClickWhileEditing({event:i,cellSelector:e}){const t=this;if(!i.target.closest(".b-editor")){if(E.isTouchEvent||i.target.matches(t.ignoreCSSSelector)){await t.finishEditing();return}t.finishEditingPromise||t.editorContext&&!t.editorContext.editor.owns(i.target)&&(t.getEditingContext(e)?t.isRowEdit?t.continueEditingOnCellClick?await t.startEditing(e):t.cancelEditing():await t.finishEditing()?t.continueEditingOnCellClick&&await t.startEditing(e):(t.grid.focusCell(t.editorContext),t.editor.focus()):await t.finishEditing())}}async onCellClick({cellSelector:i,target:e,event:t,column:r}){const n=this,{focusedCell:s}=n.client;if(e.closest(".b-tree-expander"))return!1;E.isTouchEvent&&n._lastCellClicked===(s==null?void 0:s.cell)&&t.timeStamp-n.touchEditDelay>n._lastCellClickedTime?await n.startEditing(i):this.triggerEvent==="cellclick"&&await n.onTriggerEditEvent(...arguments),n._lastCellClicked=s==null?void 0:s.cell,n._lastCellClickedTime=t.timeStamp}onElementPointerUp(i){i.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,i)}async onTriggerEditEvent({cellSelector:i,target:e,event:t,column:r}){var n;const{editorContext:s,client:a}=this;r.preventCellEditViaMouse||e.closest(".b-tree-expander")||E.isTouchEvent&&t.type==="dblclick"||t&&((n=a.features.cellMenu)==null?void 0:n.triggerEvent)===t.type||s&&(s.equals(this.grid.normalizeCellContext(i))||!await this.finishEditing())||await this.startEditing(i)}onStoreUpdate({changes:i,record:e}){const{editorContext:t}=this;t!=null&&t.editor.isVisible&&e===t.record&&(i.readOnly||!t.editor.dataField||t.editor.dataField in i)&&t.editor.refreshEdit()}onStoreRemove({changes:i,records:e}){const{editorContext:t}=this;t!=null&&t.editor.isVisible&&e.includes(t.editor.record)&&this.cancelEditing()}};y(Na,"name","GridEditBase"),y(Na,"configurable",{continueEditingOnCellClick:!0,autoEdit:null,triggerEvent:"celldblclick",ignoreCSSSelector:"button,.b-icon,.b-fa,svg,input,.b-widget"}),Na._$name="GridEditBase";var IS={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},dF={...IS,startEditing:1,finishAllSelected:1},cF={cancel:"cancelEditing",complete:"finishEditing"},Ch=class extends Na{static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",scrollAction:null,addNewAtEnd:null,addToCurrentParent:!1,editNextOnEnterPress:!0,editorClass:Gt,touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:{handler:"finishAndEditNextCell",weight:100},"Shift+Tab":{handler:"finishAndEditPrevCell",weight:100}},validateTapOut:null,tabToFocusables:null}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(i,e){super.construct(i,e);const t=this,r={renderRows:"onGridRefreshed",thisObj:t};t.autoEdit&&!("editNextOnEnterPress"in e)&&(t.editNextOnEnterPress=!1),i.ion(r),i.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:t})}bindStore(i){this.detachListeners("store"),i.ion({name:"store",update:"onStoreUpdate",remove:"onStoreRemove",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(i){let e=!0;return this.editorContext&&(Ea.owner=this.editorContext.editor.inputField,i.rootElement=this.grid.rootElement,e=await Ea.confirm(i),Ea.owner=null),e===Ea.yesButton}getEditorForCell({id:i,cell:e,column:t,columnId:r,editor:n}){const s=this,{grid:a,editorClass:l}=s;let o=t.cellEditor,d=0;t.editTargetSelector&&(d=e.querySelector(t.editTargetSelector).offsetLeft),n.autoSelect=s.autoSelect,o!=null&&o.isEditor||(o=t.data.cellEditor=l.create(l.mergeConfigs({type:l.type,cls:"b-cell-editor",inputField:n,blurAction:"none",invalidAction:t.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[d,0]},internalListeners:s.getEditorListeners(t.managedCellEditing),onInternalKeyDown:s.onEditorKeydown.bind(s),allowMouseEvents:n.allowMouseEvents,instantUpdate:t.instantUpdate},o!=null&&o.floating?{align:{align:"t0-b0",allowTargetOut:!1,minHeight:100},matchSize:!1,scrollAction:"realign"}:{constrainTo:null},o))),o.minHeight=a.rowHeight,o.inputField!==n&&(o.remove(o.items[0]),o.add(n));const c=o.inputField,u=t.instantUpdate&&!n.cellEditValueSetter;return o.instantUpdate=u,o.align.offset[0]=d,u&&(T.wrapProperty(n,"value",null,h=>{const{editorContext:g}=s;if(g){const{record:f}=g,{editorField:m}=g.column;g.editor.isValid&&!T.isEqual(f.getValue(m),h,!0)&&(!(c!=null&&c.isDateField)||c!=null&&c._isPickerInput?(f.setValue(m,h),c._outstandingUpdate=!1):c._outstandingUpdate=!0)}}),n.cellEditValueSetter=!0),Object.assign(o.element.dataset,{rowId:i,columnId:r,field:t.editorField}),o.inputField.revertOnEscape=t.revertOnEscape,s.editor=o}getEditorListeners(i){return{focusOut:i?"onEditorFocusOut":null,focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",afterEdit:"onEditorAfterEdit",thisObj:this}}syncEditingReadOnly({readOnly:i}){this.isEditing&&i&&this.cancelEditing()}onEditorStart({source:i}){var e,t;const r=this,n=r.editorContext=i.cellEditorContext;if(n){const{grid:s}=r;r.triggerEvent!=="cellclick"&&(r.detachListeners("cellClickWhileEditing"),s.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:r})),(e=r.removeEditingListeners)==null||e.call(r),(t=r.removeScrollListener)==null||t.call(r),n.column.managedCellEditing&&(r.removeEditingListeners=le.addListener({globaltap:"onTapOut",thisObj:r})),r.scrollAction&&(r.removeScrollListener=V.on({element:document,scroll:"onScroll",thisObj:r,capture:!0})),s.trigger("startCellEdit",{grid:s,editorContext:n})}}onScroll(){E.isInView(this.editor.element)||this[cF[this.scrollAction]]()}onEditorBeforeComplete(i){const{grid:e}=this,t=i.source,r=t.cellEditorContext;return i.grid=e,i.editorContext=r,r.oldValue=r.value,r.value=r.editor.inputField.value,e.trigger("beforeFinishCellEdit",i)}onEditorComplete({source:i}){var e;const{grid:t}=this,r=i.cellEditorContext;if(r){if(r.value=i.inputField.value,i.dataField.includes(".")){const n=i.dataField.split(".")[0];(e=i.record.constructor.relations)!=null&&e[n]&&t.rowManager.refresh()}t.trigger("finishCellEdit",{grid:t,editorContext:r})}}onEditorBeforeCancel(){const{editorContext:i}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:i})}onEditorCancel({event:i}){const{editorContext:e,muteEvents:t,grid:r}=this;t||r.trigger("cancelCellEdit",{grid:r,editorContext:e,event:i})}onBeforeEditorHide({source:i}){var e,t;const r=this,{row:n,cell:s}=i.cellEditorContext;s==null||s.classList.remove("b-editing"),n==null||n.removeCls("b-editing"),r.detachListeners("cellClickWhileEditing"),(e=r.removeEditingListeners)==null||e.call(r),(t=r.removeScrollListener)==null||t.call(r)}onEditorAfterEdit({source:i}){var e,t;const{editorContext:r}=this;i.cellEditorContext=this.editorContext=null,(t=(e=r==null?void 0:r.column)==null?void 0:e.onCellEditComplete)==null||t.call(e,r)}getAdjacentEditableCell(i,e){const{grid:t}=this,{store:r,columns:n}=t,{visibleColumns:s}=n;let a=i.id,{record:l}=i,o=n.getAdjacentVisibleLeafColumn(i.columnId,e);for(;a;)if(o){if(this.tabToFocusables){const d=t.normalizeCellContext({record:l,column:o});if(d.target!==d.cell&&!this.getEditingContext(d))return d}return o.canEdit(l)?{id:a,columnId:o.id}:this.getAdjacentEditableCell(t.normalizeCellContext({id:a,columnId:o.id}),e)}else l=r.getAdjacent(i.id,e,!1,!0),a=l==null?void 0:l.id,l&&(o=e?s[0]:s[s.length-1]);return null}async doAddNewAtEnd(){const i=typeof this.addNewAtEnd=="object"?T.clone(this.addNewAtEnd):{},{grid:{store:e},addToCurrentParent:t}=this;let r;return e.tree&&t?r=e.last.parent.appendChild(i):r=e.add(i)[0],await this.client.scrollRowIntoView(r,{animate:!1,block:"nearest"}),r}getEditingContext(i){i=this.grid.normalizeCellContext(i);const{column:e,record:t}=i,{editor:r}=e;if(e!=null&&e.isVisible&&r&&t&&!t.isSpecialRow&&e.canEdit(t)){const n=t&&e.getRawValue(t,!0);return Object.assign(i,{value:n===void 0?null:n,editor:r}),i}else return!1}startEditingFromKeyMap(){const{focusedCell:i}=this.grid,e=i==null?void 0:i.column;return!this.disabled&&(e==null?void 0:e.get("editor"))!==!1?this.startEditing(i):!1}async startEditing(i={}){var e,t,r,n,s;const a=this;if(!a.disabled){const{grid:l}=a;if(i!=null&&i.fromKeyMap&&(i=l.focusedCell),T.isEmpty(i)&&(i.id=l.firstVisibleRow.id),l.store.isTree&&l.features.tree){const g=i.id?l.store.getById(i.id):(e=i.record)!=null?e:l.store.getAt(i.row);if(g)await l.expandTo(g);else return!1}const o=a.getEditingContext(i);if(!o)return!1;if(a.editorContext){if(o.id===a.editorContext.id&&o.columnId===a.editorContext.columnId)return;if(a.cancelEditing()===!1)return!1}if((t=l.focusedCell)!=null&&t.equals(o)||l.focusCell(o),l.trigger("beforeCellEditStart",{grid:l,editorContext:o})===!1)return!1;const d=o.editor=a.getEditorForCell(o),{row:c,cell:u,record:h}=o;return d.inputField.highlightExternalChange=!1,d.cellEditorContext=o,d.render(u),u.classList.add("b-editing"),c.addCls("b-editing"),await d.startEdit({target:u,field:d.inputField.name||o.column.editorField,value:o.value,record:h})||(u.classList.remove("b-editing"),c.removeCls("b-editing")),(n=(r=o.column).onCellEditStart)==null||n.call(r,o),(s=a.onCellEditStart)==null||s.call(a),!0}return!1}cancelEditing(i=!1,e){var t;const r=this,{editor:n}=r;if(!r.isEditing)return;i.fromKeyMap&&(e=i,i=!1),r.muteEvents=i;const s=n.cancelEdit(e);return r.muteEvents=!1,s===!1?n.inputField.focus():(r.finishEditingPromise=!1,(t=r.afterCellEdit)==null||t.call(r)),s}async finishEditing(i){var e;const t=this,{editorContext:r,grid:n}=t;let s=!1;if(t.finishEditingPromise)return t.finishEditingPromise;if(r){const{column:a}=r;if((i==null?void 0:i.key)==="Enter"&&!r.editor.isEditor)return!1;if(t.finishEditingPromise=r.editor.completeEdit(a.bindCallback(a.finalizeCellEdit),i),s=await t.finishEditingPromise,n.isDestroyed)return;n.isSchedulerBase&&await n.waitForAnimations(),t.finishEditingPromise=null,s&&await((e=t.afterCellEdit)==null?void 0:e.call(t))}return s}onStoreBeforeSort(){var i;const e=(i=this.editorContext)==null?void 0:i.editor;if(this.isEditing&&!(e!=null&&e.isFinishing)&&!e.isValid)return this.cancelEditing()}onGridRefreshed(){const i=this,{grid:e,editorContext:t}=i;if(t&&e.isVisible&&e.focusedCell){const{editor:r,cell:n}=t;n&&E.isInView(n)&&!r.isFinishing?(t._cell=n,le.suspendFocusEvents(),r.render(n),r.showBy(n),r.focus(),le.resumeFocusEvents()):i.finishEditingPromise||i.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:i,event:e}){const t=this;if(dF[i]){if(!t.disabled&&!e.target.closest(".b-grid-header")){if(t.isEditing){if(i==="finishAllSelected")return t.multiEdit&&t.gridSelection.length>1;if(IS[i])return!0}else if(i==="startEditing")return!!(t.grid.focusedCell&&!E.isEditable(e.target))}return!1}}async finishAllSelected(){const i=this,{dataField:e,record:t}=i.editor;if(await i.finishEditing()&&!i.isDestroyed){const r=t.getValue(e);for(const n of i.gridSelection)n.isModel?n!==t&&n.setValue(e,r):n.record.set(n.column.editorField,r)}}async finishAndEditNextRow(i,e=!1){var t;const r=this,{grid:n}=r,{record:s,column:a}=r.editorContext;let l;const o=await r.finishEditing(i);if(o){if(r.isDestroyed)return;if(!r.isEditing){if(e){if(l=n.internalNextPrevRow(!1,!0,!1),!l&&n.splitFrom){const d=n.splitFrom;await d.startEditing({id:d.store.last.id,columnId:a.id})}}else{if(s===n.store.last)if((t=n.features.lockRows)!=null&&t.enabled){const d=n.features.lockRows.subViews[0];d.store.count>0&&await d.startEditing({id:d.store.first.id,columnId:a.id})}else r.addNewAtEnd&&await r.doAddNewAtEnd();r.isDestroyed||(l=n.internalNextPrevRow(!0,!0))}l&&r.editNextOnEnterPress&&await r.startEditing(l)}}return o}finishAndEditPrevRow(i){return this.finishAndEditNextRow(i,!0)}async finishAndEditNextCell(i,e=!1){var t,r,n,s;const a=this,{grid:l}=a,{focusedCell:o}=l;if(o&&!a.finishEditingPromise){const{columnIndex:d,record:c,actionTargets:u}=o;if(a.tabToFocusables&&a.editorContext&&!a.editorContext.editor.inputField&&E.getActiveElement(o.cell)!==(e?u[0]:u.at(-1)))return!1;let h=a.getAdjacentEditableCell(o,!e);if(!h&&!e&&await a.finishEditing(i)===!0)if((t=l.features.lockRows)!=null&&t.enabled){const[m]=l.subViews;if(m.store.count>0){const p=m.store.first,v={record:p,id:p.id,columnId:m.columns.visibleColumns[0].id};m.features.cellEdit.getEditingContext(v)?await m.startEditing(v):await m.startEditing(a.getAdjacentEditableCell(v))}}else a.addNewAtEnd&&await a.doAddNewAtEnd();let g=!0;if(a.isEditing&&(g=await a.finishEditing(i)),a.isDestroyed)return;if(h=a.getAdjacentEditableCell(new Se({grid:l,record:c,columnIndex:d}),!e),!h&&e&&((r=l.splitFrom)!=null&&r.features.lockRows)&&c===l.store.first){const f=l.splitFrom,m=f.store.last,p=f.columns.visibleColumns[f.columns.visibleColumns.length-1],v={record:m,id:m.id,columnId:p.id};f.features.cellEdit.getEditingContext(v)?await f.startEditing(v):await f.startEditing(a.getAdjacentEditableCell(v,!1))}if(h){if(g){if(h.target!==h.cell&&a.tabToFocusables){const f=l.findFocusables(h.cell);h.editor=a.editor=a.getFakeEditor(h.target),f[e?f.length-1:0].focus(),a.editorContext=h}else if(l.focusCell(h,{animate:a.focusCellAnimationDuration}),!await a.startEditing(h))return a.finishAndEditNextCell(i,e)}}else l.isNested&&l.owner&&!((s=(n=l.owner).catchFocus)!=null&&s.call(n,{source:l,navigationDirection:e?"up":"down",editing:!0}))&&l.onTab(i)}}getFakeEditor(i){const e=this,t=()=>(e.editorContext=e.editor=null,!0);return{element:i,completeEdit:t,cancelEdit:t,isFinishing:!0}}finishAndEditPrevCell(i){return this.finishAndEditNextCell(i,!0)}async onElementKeyDown(i){const e=this,{grid:t}=e,{focusedCell:r}=t;if(i.handled||!e.autoEdit||e.isEditing||!r||r.isActionable&&E.isEditable(i.target)||i.ctrlKey)return;const{key:n}=i,s=i.key==="Delete"||i.key==="Backspace",{gridSelection:a}=s?e:{},l=e.multiEdit&&(a==null?void 0:a.length)>1;if((n.length<=1||s&&!l)&&await e.startEditing(r)){const{inputField:o}=e.editor,{input:d}=o;d&&(o.internalOnKeyEvent(i),i.defaultPrevented||(d.value=s?"":n,o.internalOnInput(i))),i.preventDefault()}else if(l&&t.trigger("beforeCellRangeDelete",{grid:t,gridSelection:a})!==!1)for(const o of a)o.isModel?t.columns.visibleColumns.forEach(d=>{d.canEdit(o)&&o.set(d.editorField,null)}):o.column.canEdit(o.record)&&o.record.set(o.column.editorField,null)}onEditorKeydown(i){if(i.key&&i.key.length!==1&&this.grid.matchKeyMapEntry(i)&&!this.grid.matchKeyMapEntry(i,this.keyMap))return!i.key.startsWith("Arrow")&&i.key!=="Backspace"&&i.key!=="End"&&i.preventDefault(),i.handled=!0,i.stopPropagation(),!1}async onEditorFocusOut(i){const e=this,{grid:t,editor:r,editorContext:n}=e,s=new Se(i.relatedTarget),a=s.grid===t&&e.getEditingContext(s);n&&!r.isFinishing&&r.owns(i._target)&&(e.blurAction==="cancel"||!t.store.includes(n.record)?e.cancelEditing(void 0,i):!e.finishEditingPromise&&(e.triggerEvent==="cellclick"||e.triggerEvent!=="cellclick"&&!a)&&await e.finishEditing(i))}onEditorFocusIn(i){const e=i.toWidget;e===this.editor.inputField&&this.autoSelect&&e.selectAll&&!e.readOnly&&!e.disabled&&e.selectAll()}async onTapOut({event:i}){const e=this,{target:t}=i;if(!t._shadowRoot&&!e.editor.owns(t)&&(!e.grid.bodyContainer.contains(t)||i.button)){const r=e.resolveCallback(e.validateTapOut,e,!1),n=(r==null?void 0:r.handler.call(r.thisObj,i,e.editorContext))||e.blurAction;e.editingStoppedByTapOutside=!0,n==="cancel"?e.cancelEditing(void 0,i):await e.finishEditing(i),delete e.editingStoppedByTapOutside}}async onElementClick(i){i.target.matches(".b-grid-body-container, .b-grid-subgrid")&&this.editorContext&&await this.finishEditing(i)}};y(Ch,"$name","CellEdit"),Ch._$name="CellEdit",K.registerFeature(Ch,!0);var Ba=class extends Ir{static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateCellMenu"),i}showContextMenu(i){const e=this,{cellSelector:t,event:r}=i;e.client.focusCell(t,{doSelect:!e.client.selectedRecordCollection.includes(t.id),event:r}),super.showContextMenu(i)}shouldShowMenu({column:i}){return i&&i.enableCellContextMenu!==!1}getDataFromEvent(i){const e=this.client.getCellDataFromEvent(i);if(e)return T.assign(super.getDataFromEvent(i),e)}beforeContextMenuShow({record:i,items:e,column:t}){if(t.cellMenuItems===!1)return!1;(!i||i.isSpecialRow)&&(e.removeRow=!1)}populateCellMenu({items:i,column:e,record:t}){const{client:r}=this;e!=null&&e.cellMenuItems&&T.merge(i,e.cellMenuItems),r.readOnly||(i.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:t.readOnly,onItem:()=>{var n,s;const a=(s=(n=r.features.treeGroup)==null?void 0:n.originalStore)!=null?s:r.store;r.isCellSelected({record:t,column:e},!0)?a.remove(r.selectedRecords.filter(l=>!l.readOnly).map(l=>l.$original)):a.remove(t)}})}get showMenu(){return!0}showMenuFor(i,{targetElement:e}={}){i=this.client.normalizeCellContext(i),E.triggerMouseEvent(e||this.client.getCell(i),this.triggerEvent)}};y(Ba,"$name","CellMenu"),Ba.featureClass="",Ba._$name="CellMenu",K.registerFeature(Ba,!0,["Grid","Scheduler"]),K.registerFeature(Ba,!1,["Gantt"]);var Md=class extends ie{construct(i,e){super.construct(i,this.processConfig(e))}initTip(){const i=this;i.tip=ve.new({forElement:i.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:i.getTooltipContent.bind(i),internalListeners:{pointerOver:"onPointerOver",thisObj:i},listeners:i.configuredListeners},i.initialConfig),i.client.ion({startCellEdit:i.tip.hide,thisObj:i.tip}),i.relayEvents(i.tip,["beforeShow","show"])}onPointerOver({target:i}){const e=this.client.getColumnFromElement(i);return e.tooltipRenderer!==!1&&!!(e.tooltipRenderer||this.tooltipRenderer)}processConfig(i){return typeof i=="function"?{tooltipRenderer:i}:i}setConfig(i){super.setConfig(this.processConfig(i))}doDestroy(){var i;(i=this.tip)==null||i.destroy(),super.doDestroy()}doDisable(i){var e;i?this.tip=(e=this.tip)==null?void 0:e.destroy():this.initTip(),super.doDisable(i)}getTooltipContent({tip:i,activeTarget:e,event:t}){const r=this,n=r.client.getRecordFromElement(e),s=r.client.getColumnFromElement(e),a={cellElement:e,record:n,column:s,event:t,tip:i,cellTooltip:r};let l;return!r.forSelector&&n===r.lastRecord&&n.generation===r.lastRecordGeneration&&s===r.lastColumn?r.tip._html:(r.lastRecord=n,r.lastRecordGeneration=n.generation,r.lastColumn=s,s.tooltipRenderer?l=s.tooltipRenderer(a):r.tooltipRenderer&&s.tooltipRenderer!==!1&&(l=r.tooltipRenderer(a)),Z.isPromise(l)&&(r.lastRecord=r.lastRecordGeneration=r.lastColumn=null),l||i.hide(),l)}};y(Md,"$name","CellTooltip"),y(Md,"configurable",{tooltipRenderer:null}),Md._$name="CellTooltip",K.registerFeature(Md);var AS="store",za=class extends fe(ie){static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(i){super.construct(i);const{store:e}=this;e&&this.bindStore(e)}doDestroy(){this.unbindStore(),super.doDestroy()}get store(){return this.client.$store}bindStore(i){this.lastSync=null,i.ion({name:AS,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(AS)}get columnAutoWidthPending(){return this.lastSync===null||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:i}){if(i!=="move"&&this.client.isPainted){const e=this,{cellEdit:t}=e.client.features;++e.storeGeneration,i==="filter"||t!=null&&t.isEditing&&!t.editingStoppedByTapOutside?e.syncAutoWidthColumns():e.client.refreshSuspended?e.client.rowManager.once("renderDone",()=>e.syncAutoWidthColumns()):e.setTimeout({fn:"syncAutoWidthColumns",delay:e.delay,cancelOutstanding:!0})}}onInternalResize(i,e,t,r){r===0&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){var i,e;const{client:t}=this;this.disabled||t.store.count===0||t.rowManager.rows.length===0||t.splitFrom&&!((e=(i=t.splitFrom.features)==null?void 0:i.lockRows)!=null&&e.enabled)||this.doSyncAutoWidthColumns()}doSyncAutoWidthColumns(){const i=this,{client:e,storeGeneration:t}=i;if(!(e.splitFrom&&!e.usesLockRows||!e.isPainted)){if(i.lastSync!==t){i.lastSync=t;let r,n;for(const s of e.columns.visibleColumns)r=s.autoWidth,r&&(r===!0&&(r=i.default),e.resizingColumns=n=!0,s.resizeToFitContent(r));n&&(e.resizingColumns=!1,e.afterColumnsResized())}i.hasTimeout("syncAutoWidthColumns")&&i.clearTimeout("syncAutoWidthColumns")}}};y(za,"$name","ColumnAutoWidth"),y(za,"configurable",{default:null,delay:0}),za.prototype.storeGeneration=0,za._$name="ColumnAutoWidth",K.registerFeature(za,!0);var _d=class extends fe(ie){static get pluginConfig(){return{after:["render"]}}construct(i,e){i.features.columnReorder&&i.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=i,super.construct(i,e)}doDestroy(){const i=this;i.grid.features.columnReorder&&!i.grid.features.columnReorder.isDestroyed&&i.detachFromColumnReorder(),i.element&&i.element.remove(),i.element=null,super.doDestroy()}doDisable(i){this.initialized&&(i?this.detachFromColumnReorder():this.init()),super.doDisable(i)}init(){const i=this,e=i.grid;e.features.columnReorder&&(i.reorderDetacher=e.features.columnReorder.ion({gridheaderdragstart({context:t}){const r=e.columns.getById(t.element.dataset.columnId);i.showToolbar(r)},gridheaderdrag:({context:t})=>i.onDrag(t),gridheaderabort:()=>{i.hideToolbar()},gridHeaderDrop:i.onDrop,thisObj:i}),i.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const i=this;i.grid.features.columnReorder.un("beforedestroy",i.onColumnReorderBeforeDestroy,i),i.reorderDetacher&&i.reorderDetacher(),i.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(i){const e=this,t=e.grid.getColumnDragToolbarItems(i,[]),r=[];e.clearTimeout(e.buttonHideTimer),t.forEach(n=>{n.text=n.localeClass.L(n.text);let s=r.find(a=>a.text===n.group);s||(s={text:n.localeClass.L(n.group),buttons:[]},r.push(s)),s.buttons.push(n)}),e.element=E.append(e.grid.element,e.template(r)),e.groups=r,e.buttons=t,e.column=i}async hideToolbar(){const i=this,e=i.element;e&&(e.classList.add("b-remove"),await V.waitForTransitionEnd({element:e,mode:"animation",thisObj:i.client}),e.remove(),i.element=null)}onDrag(i){var e;const t=this;if(i.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),(e=i.targetElement)!=null&&e.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");const r=i.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),t.hoveringButton=r)}else t.element.classList.remove("b-hover")}onDrop({context:i}){const e=this,{targetElement:t}=i;if(t&&t.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=e.buttons.find(n=>n.ref===t.dataset.ref);r&&(t.classList.add("b-activate"),e.buttonHideTimer=e.setTimeout(()=>{e.hideToolbar(),r.onDrop({column:e.column})},100))}else e.hideToolbar()}template(i){return Pt.tpl`
            <div class="b-columndragtoolbar">
            <div class="b-title"></div>
            ${i.map(e=>Pt.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map(t=>Pt.tpl`
                        <div class="b-target-button" data-ref="${t.ref}" data-disabled="${t.disabled}">
                            <i class="${t.icon}"></i>
                            ${t.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `)}
            </div>`}};y(_d,"$name","ColumnDragToolbar"),_d.featureClass="b-hascolumndragtoolbar",_d._$name="ColumnDragToolbar",K.registerFeature(_d,Y.isTouchDevice);var kd=class extends ie{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(i){const e=this,{createColumnsFromModel:t}=e;let r;if(e.groupByRegion)r=e.grid.regions.map(n=>{const s=e.grid.getSubGrid(n).columns.topColumns;return{text:O.capitalize(n),menu:e.buildColumnMenu(s),disabled:s.length===0,region:n}}),t&&r.push({text:e.L("L{newColumns}"),menu:e.createAutoColumnItems()});else if(e.groupByTag){const n={};i.topColumns.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.hideable!==!1&&s.tags.forEach(a=>{n[a]||(n[a]=1)})}),r=Object.keys(n).sort().map(s=>({text:O.capitalize(s),menu:e.buildColumnMenu(e.getColumnsForTag(s)),tag:s,onBeforeSubMenu:({item:a,itemEl:l})=>{e.refreshTagMenu(a,l)}})),t&&r.push({text:e.L("L{newColumns}"),menu:e.createAutoColumnItems()})}else r=e.buildColumnMenu(i.topColumns),t&&r.items.push(...T.transformNamedObjectToArray(e.createAutoColumnItems()));return r}createAutoColumnItems(){const i=this,{grid:e}=i,{columns:t,store:r}=e,{modelClass:n}=r,{allFields:s}=n,a={};for(let l=0,{length:o}=s;l<o;l++){const d=s[l],c=d.name;t.get(c)||d.internal||(a[c]={text:d.text||O.separate(d.name),checked:!1,onToggle:u=>{const h=t.get(c);h?h[u.checked?"show":"hide"]():(e._suspendRenderContentsOnColumnsChanged=!0,t.add(t.generateColumnForField(d,{region:i.forColumn.region}),!0),e._suspendRenderContentsOnColumnsChanged=!1,e.renderContents()),u.bubbles=!1}})}return a}getColumnsForTag(i){return this.grid.columns.records.filter(e=>e.tags&&Array.isArray(e.tags)&&e.tags.includes(i)&&e.hideable!==!1)}refreshTagMenu(i,e){this.getColumnsForTag(i.tag).forEach(r=>{const n=i.items.find(s=>s.column===r);n&&(n.checked=r.hidden!==!0)})}buildColumnMenu(i){let e=i.length>0&&i[0].region;const{grid:t}=this,r=i.reduce((n,s)=>{if(s.hideable!==!1){const a=t.columns.visibleColumns.filter(d=>d.region===s.region),l=s.hidden!==!0,o={grid:t,column:s,text:s.htmlEncodeHeaderText?s.text:E.stripTags(s.text),checked:l,disabled:l&&a.length===1,cls:s.region!==e?"b-separator":"",ariaLabel:this.L(l?"L{ColumnPicker.hideName}":"L{ColumnPicker.showName}",s)};e=s.region,s.children&&!s.isCollapsible&&(o.menu=this.buildColumnMenu(s.children)),n.push(o)}return n},[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:i,items:e}){const t=this,{columns:r}=t.grid;t.forColumn=i,i.showColumnPicker!==!1&&r.some(n=>n.hideable)&&(e.columnPicker={text:"L{columnsMenu}",localeClass:t,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:t.getColumnPickerItems(r),onToggle:t.onColumnToggle,disabled:t.disabled}),i.hideable!==!1&&!i.parent.isCollapsible&&(e.hideColumn={text:"L{hideColumn}",localeClass:t,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!i.allowDrag||t.disabled,onItem:()=>i.hide()})}onColumnToggle({menu:i,item:e,checked:t}){var r,n;if(!!e.column.hidden!=!t){e.column[t?"show":"hide"](),e.ariaLabel=this.L(`L{HeaderMenu.${t?"hide":"show"}Name}`,e.column);const{grid:s,column:a}=e,{columns:l,features:o}=s,d=i.items,c=l.visibleColumns.filter(g=>g.region===e.column.region&&g.showColumnPicker!==!1),u=((r=o.headerMenu)==null?void 0:r.enabled)&&o.headerMenu.menu.widgetMap.hideColumn;if(c.length===1){const g=d.find(f=>f.column===c[0]);g&&(g.disabled=!0),u&&a.region===e.column.region&&(u.disabled=!0)}else c.forEach(g=>{const f=d.find(m=>m.column===g);f&&(f.disabled=!1)}),u&&a.region===e.column.region&&(u.disabled=!1);(n=e.menu)==null||n.eachWidget(g=>{g.checked=t});const h=i.owner;h&&h.column===a.parent&&(h.checked=d.some(g=>g.checked===!0))}}getColumnDragToolbarItems(i,e){const t=this.grid.columns.visibleColumns.filter(r=>r.region===i.region);return i.hideable!==!1&&t.length>1&&e.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:r})=>r.hide()}),e}};y(kd,"$name","ColumnPicker"),y(kd,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),kd._$name="ColumnPicker",K.registerFeature(kd,!0);var Fd=class extends ie{doDestroy(){var i;(i=this.editor)==null||i.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:i,column:e}){i.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:e.readOnly,onItem:()=>this.startEdit(e)}}startEdit(i){var e;if(i instanceof Event&&(i=(e=this.client.getHeaderDataFromEvent(i))==null?void 0:e.column),!i||i.readOnly||this.disabled)return!1;const{textWrapper:t}=i;let{editor:r}=this;r||(this.editor=r=new Gt({owner:this.client,align:{align:"t0-t0"}})),r.render(t),r.startEdit({target:t,record:i,field:"text"})}};y(Fd,"$name","ColumnRename"),y(Fd,"configurable",{keyMap:{F2:"startEdit"}}),Fd._$name="ColumnRename",K.registerFeature(Fd,!1);var Wa=class extends fe(ie){constructor(){super(...arguments),y(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}static get pluginConfig(){return{after:["onInternalPaint","renderContents"]}}init(){const i=this,{grid:e}=i,t=e.element,r=E.children(t,".b-grid-headers");r.push(...E.children(t,".b-grid-header-children")),i.dragHelper?i.dragHelper.containers=r:e.whenVisible(()=>i.createDragHelper())}createDragHelper(){const i=this,{grid:e}=i,t=e.element,r=E.children(t,".b-grid-headers");return r.push(...E.children(t,".b-grid-header-children")),i.dragHelper=new si({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:e,rtlSource:e,outerElement:e.headerContainer,externalDropTargetSelector:".b-groupbar, .b-columndragtoolbar",monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:dd.new({direction:"horizontal",element:e.headerContainer}),containers:r,isElementDraggable(n){if(!!n.closest(i.ignoreSelectors.join(","))||i.disabled)return!1;const a=n.closest(this.targetSelector),l=a&&e.columns.getById(a.dataset.columnId),o=(l==null?void 0:l.childLevel)===0&&e.subGrids[l.region].columns.count===1;return!!l&&l.draggable!==!1&&!o},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",resolveTargetElement(n){const s=n.closest("[data-column-id]");return s?e.columns.getById(s.dataset.columnId).element:n},internalListeners:{beforeDragStart:i.onBeforeDragStart,dragstart:i.onDragStart,drag:i.onDrag,drop:i.onDrop,abort:i.onAbort,thisObj:i}}),i.relayEvents(i.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"),i.dragHelper}doDestroy(){var i,e;(i=this.dragHelper)==null||i.scrollManager.destroy(),(e=this.dragHelper)==null||e.destroy(),super.doDestroy()}get grid(){return this.client}onBeforeDragStart({source:i,context:e,event:t}){const r=this,{element:n}=e,s=e.column=r.client.columns.getById(n.dataset.columnId);return i.autoSizeClonedTarget=!r.stretchedDragProxy&&!r.usingGroupBarWidget,i.dropTargetSelector=r.stretchedDragProxy?null:".b-grid-headers, .b-groupbar, .b-columndragtoolbar",s.allowDrag&&r.client.trigger("beforeColumnDragStart",{column:s,event:t})}onDragStart({context:i,event:e}){const t=this,{grid:r,usingGroupBarWidget:n,dragHelper:s}=t,{column:a,dragProxy:l,element:o}=i,d=r.element.querySelector(".b-grid-header-container").getBoundingClientRect();l.style.width=a.element.offsetWidth+"px",s.useCenteredCursor=!t.stretchedDragProxy,!r.features.columnDragToolbar&&!n?(s.minY=d.top,t.stretchedDragProxy?(l.classList.add("b-column-reorder-stretched"),E.setTranslateXY(l,o.left,o.top),s.maxY=r.element.getBoundingClientRect().bottom):s.maxY=d.bottom,l.style.height=r.bodyElement.offsetHeight+"px"):l.style.height=d.height+"px",r.element.classList.add("b-dragging-header"),n&&l.classList.add("b-grid-reordering-columns-with-groupbar"),r.features.filterBar&&r.features.filterBar.compactMode&&l.classList.add("b-filter-bar-compact"),r.trigger("columnDragStart",{column:a,event:e})}onDrag({context:i,event:e}){const t=this,r=t.client,{column:n,insertBefore:s}=i,a=r.columns.getById(s==null?void 0:s.dataset.columnId),l=z.fromElement(e.target,"gridheader");l!=null&&l.subGrid.sealedColumns&&(i.valid=!1),r.trigger("columnDrag",{column:n,insertBefore:a,event:e,context:i})}onDrop({context:i,event:e}){var t;if(!i.valid)return this.onInvalidDrop({context:i,event:e});const r=this,{grid:n}=r,{column:s}=i,a=i.dragging,l=i.target.closest(".b-grid-header"),o=(t=i.draggedTo)==null?void 0:t.dataset.region,d=o||l;let c,u,h,g,f;if(n.element.classList.remove("b-dragging-header"),d){const m=l?n.columns.getById(l.dataset.columnId):n.subGrids[o].columns.last,p=i.insertBefore;if(g=o||m.region,f=s.parent,h=p?n.columns.getById(p.dataset.columnId):n.subGrids[g].columns.last.nextSibling,h)u=h.parent;else{const v=l==null?void 0:l.parentElement.closest(".b-grid-header");v?u=n.columns.getById(v.dataset.columnId):u=n.columns.rootNode}c=g===s.region&&f===u&&(m===s.previousSibling||h===s.nextSibling),a.remove()}c=c||n.trigger("beforeColumnDropFinalize",{column:s,newParent:u,insertBefore:h,event:e,region:g})===!1,!c&&d&&(c=!u.insertChild(s,h)),i.valid=!c,!c&&d&&(s.parent.isRoot&&s.region!==g&&(s.region=g),f.children.length===0&&f.parent.removeChild(f)),n.trigger("columnDrop",{column:s,newParent:u,insertBefore:h,valid:i.valid,event:e,region:g})}onAbort({context:i,event:e}){this.onInvalidDrop({context:i,event:e})}onInvalidDrop({context:i,event:e}){const{grid:t}=this,{column:r}=i;t.trigger("columnDrop",{column:r,valid:!1,event:e}),t.element.classList.remove("b-dragging-header")}renderContents(){this.init()}onInternalPaint(){this.init()}get isReordering(){var i;return!!((i=this.dragHelper)!=null&&i.isDragging)}};y(Wa,"$name","ColumnReorder"),y(Wa,"configurable",{stretchedDragProxy:null}),Wa.featureClass="b-column-reorder",Wa._$name="ColumnReorder",K.registerFeature(Wa,!0);var Id=class extends ie{construct(i,e){const t=this;super.construct(i,e),t.resizer=new Fn({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:i.element,rtlSource:i,constrainToParent:!1,internalListeners:{beforeresizestart:t.onBeforeResizeStart,resizestart:t.onResizeStart,resizing:t.onResizing,resize:t.onResize,cancel:t.onCancel,thisObj:t}})}doDestroy(){var i;(i=this.resizer)==null||i.destroy(),super.doDestroy()}changeLiveResize(i){return i==="auto"?!Y.isMobileSafari:i}onBeforeResizeStart({event:i,element:e}){const{client:t}=this;return!this.disabled&&t.trigger("beforeColumnResize",{column:t.columns.getById(e.dataset.columnId),domEvent:i})}onResizeStart({context:i}){const{client:e,resizer:t}=this,r=i.column=e.columns.getById(i.element.dataset.columnId),{allRecords:n}=r.subGrid.columns;t.minWidth=r.minWidth,i.subGridBoundary=r.element.getBoundingClientRect()[e.rtl?"left":"right"],e.element.classList.add("b-column-resizing"),n.slice(0,n.indexOf(r)).forEach(s=>{s.flex&&s.element&&s!==r.parent&&s.set({width:s.element.offsetWidth,flex:""})}),e.trigger("columnResizeStart",{column:r,domEvent:i.event})}onResizing({context:i}){if(i.valid&&this.liveResize){const{column:e}=i,{subGrid:t}=e,{scrollable:r,columns:n}=t,{rtl:s}=this.client;this.client.resizingColumns=!0,e.width=i.newWidth,t.refreshFakeScroll(),e===n.last&&(s?i.currentX<i.subGridBoundary:i.currentX>i.subGridBoundary)&&(r.x=r.maxX)}}onResize({context:i}){const{client:e}=this,{column:t,event:r}=i;e.element.classList.remove("b-column-resizing"),i.valid&&(this.liveResize?(e.resizingColumns=!1,e.afterColumnsResized(t)):t.width=i.newWidth,e.trigger("columnResize",{column:t,domEvent:r}))}onCancel({context:i}){const{client:e}=this;e.element.classList.remove("b-column-resizing"),i.column.width=i.elementWidth,e.resizingColumns=!1}};y(Id,"$name","ColumnResize"),y(Id,"configurable",{liveResize:"auto"}),Id._$name="ColumnResize",K.registerFeature(Id,!0);var Ad=class extends ie.mixin(fe){constructor(){super(...arguments),y(this,"delayable",{handleSelection:"raf"})}static get pluginConfig(){return{before:["onStoreRemove"],chain:["afterSelectionChange","onContentChange","fixElementHeights","syncFlexedSubCols","beforeSubGridInternalResize"],override:["getCellDataFromEvent"]}}afterConstruct(){super.afterConstruct();const{client:i}=this;i.selectionMode.cell||(this.disabled=!0),i.ion({startCellEdit:"onStartCellEdit",finishCellEdit:"onFinishCellEdit",cancelCellEdit:"onFinishCellEdit",rowExpand:"onContentChange",rowCollapse:"onContentChange",thisObj:this}),this._fillListeners={}}async onContentChange(){this.removeElements(),await this.client.waitForAnimations(),this.handleSelection(!0)}fixElementHeights(){this.handleSelection()}syncFlexedSubCols(){this.handleSelection()}beforeSubGridInternalResize(){this.removeElements()}onStoreRemove(i){i.isCollapse&&this.handleSelection(!0)}onStartCellEdit(){this.removeElements(!1)}onFinishCellEdit(){this.handleSelection()}getCellDataFromEvent(i,e){return e&&(e=!i.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(i,e)}get currentRangeForEvents(){if(this.currentRange){let{from:i,to:e,negative:t}=this.currentRange;return t&&([i,e]=[e,i]),{from:i,to:e}}}findPatternsIn2dRange(i,e,t){const r={};for(const n of i){const s=e?n.id:n.columnId;let a=n.record.getValue(n.column.editorField);a&&typeof a=="string"&&!isNaN(a)&&(a=parseFloat(a)),r[s]||(r[s]=[]),r[s].push(a)}for(const n in r)r[n].pattern=this.findPatternsIn1dRange(r[n],t);return r}findPatternsIn1dRange(i,e){const t=i[e?0:i.length-1],r={next:()=>t,lastValue:t};if(i.every(n=>typeof n=="number")||i.every(n=>n instanceof Date)){const n=i.map((s,a)=>s-i[a-1]);n.shift(),new Set(n).size===1&&(r.increaseBy=n[0]*(e?-1:1),r.next=()=>(r.lastValue instanceof Date?r.lastValue=new Date(r.lastValue.getTime()+r.increaseBy):r.lastValue+=r.increaseBy,r.lastValue))}else i.length>1&&(r.stringPattern=[...i],r.next=()=>(r.currentIndex===void 0?r.currentIndex=0:(r.currentIndex+=1,r.currentIndex>=r.stringPattern.length&&(r.currentIndex=0)),r.stringPattern[r.currentIndex]));return r}afterSelectionChange(){const i=this;if(i.client.readOnly||i.disabled){i.removeElements();return}le.isMouseDown()?(i.client.delayUntilMouseUp(()=>i.handleSelection(!0)),i.removeElements()):i.handleSelection(!0)}handleSelection(i=!1){if(this.enabled&&!this._isExtending){i&&(this._cachedSelectedRange=null);const e=this.rangeSelection;e?this.drawFillHandleAndBorder(e[0],e[e.length-1]):this.removeElements()}}onMouseDown(i){const{client:e}=this;this.enabled&&!e.readOnly&&e.trigger("beforeFillHandleDragStart",{cell:e.focusedCell,domEvent:i})!==!1&&(this._fillListeners.mouseDownOver=V.on({element:this.rootElement,keydown:"onKeyDown",mouseenter:{handler:"onMouseOver",delegate:".b-grid-cell",element:e.selectionDragMouseEventListenerElement},capture:!0,thisObj:this}),this._fillListeners.mouseUp=V.on({element:document,capture:!0,mouseup:"onMouseUp",thisObj:this}),i.preventDefault(),i.stopImmediatePropagation(),i.handled=!0,e.trigger("fillHandleDragStart",{cell:e.focusedCell,domEvent:i}))}async onMouseUp(i){const e=await this.client.trigger("fillHandleBeforeDragFinalize",{...this.currentRangeForEvents,domEvent:i})!==!1;this.finalize(e,i)}finalize(i,e=!0){var t,r;const n=this,{client:s,currentRange:a,currentRangeForEvents:l,_isCropping:o}=n,d=n.rangeSelection,c=d&&a&&s.internalSelectRange(a.from,a.to),u=(c==null?void 0:c.selectedCells)||[],h=o?n.croppingCells:u.filter(g=>!d.some(f=>f.equals(g,!0)));if(n._isCropping=null,n._isExtending&&(s.disableScrollingCloseToEdges(s.items),n._isExtending=null),!(h!=null&&h.length)||!i){n.currentRange=null,n.handleSelection(),s.trigger("fillHandleDragAbort",{cell:s.focusedCell});return}if(s.suspendRefresh(),o)h.forEach(g=>g.record.set(g.column.field,null,!1,!1,!1,!0));else{const[g]=h,f=d.some(b=>b.record===g.record),m=f?g.columnIndex<d[0].columnIndex:g.rowIndex<d[0].rowIndex,p=n.findPatternsIn2dRange(d,f,m),v=new Map;m&&h.reverse();for(const b of h){const{column:w,record:D}=b;let S=(t=n.calculateFillValue)==null?void 0:t.call(n,{range:d,column:w,record:D,cell:b});if(S===void 0&&(S=p[f?b.id:b.columnId].pattern.next()),w.canFillValue({range:d,record:D,cell:b,value:S,enforceType:f})){let x=v.get(D);x||(x={},v.set(D,x)),x[w.field]=((r=w.calculateFillValue)==null?void 0:r.call(w,{value:S,record:D,range:d,horizontal:f}))||S}}for(const[b,w]of v)b.set(w,null,null,null,null,!0)}s.resumeRefresh(!0),s.performSelection(c),n.currentRange=null,n.handleSelection(),s.trigger("fillHandleDragEnd",{...l,domEvent:e})}onMouseOver(i){var e;const t=this,{client:r,rangeSelection:n}=t,s=n[0],a=n[n.length-1],l=r.getCellDataFromEvent(i,!0);let o=l&&r.normalizeCellContext(l.cellSelector);if(((e=o==null?void 0:o._column)==null?void 0:e.region)===s._column.region){const d=n.some(g=>g.equals(o,!0));let c;t._isExtending||r.enableScrollingCloseToEdges(r.items),t._isCropping=d&&t.allowCropping&&(o.rowIndex<a.rowIndex||o.columnIndex<a.columnIndex),d||(o.rowIndex>=s.rowIndex&&o.rowIndex<=a.rowIndex?(c=s.columnIndex>o.columnIndex,o=new Se({grid:r,record:c?s.record:a.record,column:o.column})):(c=s.rowIndex>o.rowIndex,o=new Se({grid:r,record:o.record,column:c?s.column:a.column})));const u=c?o:s,h=c||d&&!t._isCropping?a:o;t.currentRange={from:u,to:h,negative:c},t._isExtending=!0,t.drawFillHandleAndBorder(u,h,!0),r.trigger("fillHandleDrag",{...t.currentRangeForEvents,domEvent:i})}}drawFillHandleAndBorder(i,e,t=!1){var r,n;const s=this,{client:a,_fillListeners:l}=s,o=a.subGrids[i.column.region].element,d=L.from(i.cell||i.column.element,o),c=L.from(e.cell||e.column.element,o),u=(r=a.getRecordCoords(i.record,!0))==null?void 0:r.y,h=c.bottom;let{borderElement:g,handleElement:f}=s;if(s.removeElements(t),g||(s.borderElement=g=E.createElement({className:"b-fill-selection-border"}),s.handleElement=f=E.createElement({className:"b-fill-handle"})),a.rtl){const m=L.from(a.subGrids[i.column.region].element),p=m.width-d.right,v=c.left>d.left?c.right-d.left:d.right-c.left;E.setRect(g,{x:p,y:u,width:v,height:h-u}),E.setTopInsetInlineStart(f,h,p+v),f.classList.toggle("b-fill-handle-left-edge",c.left<=0)}else E.setRect(g,{y:u,x:d.x,width:c.right-d.x,height:h-u}),E.setTopInsetInlineStart(f,h,c.right),f.classList.toggle("b-fill-handle-right-edge",c.right>=o.scrollWidth-1);if(o.appendChild(g),o.appendChild(f),s.toggleCroppingCls(!1),s.croppingCells=null,s._isCropping&&((n=s.rangeSelection)!=null&&n.length)){const m=a.getRange(i,e);s.croppingCells=s.rangeSelection.filter(p=>!m.some(v=>v.equals(p,!0))),s.toggleCroppingCls()}l.handleClick||(l.handleClick=V.on({element:a.element,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:s})),s.hasFillElements=!0}toggleCroppingCls(i=!0){var e;(e=this.croppingCells)==null||e.forEach(t=>{var r;return(r=this.client.getCell(t))==null?void 0:r.classList.toggle("b-indicate-crop",i)})}removeElements(i=!1){var e,t;const r=this;(e=r.handleElement)==null||e.remove(),(t=r.borderElement)==null||t.remove(),i||r.removeListeners(),r.hasFillElements=!1}removeListeners(){const i=this;for(const e in i._fillListeners)i._fillListeners[e]();i._fillListeners={}}get rangeSelection(){return this._cachedSelectedRange||(this._cachedSelectedRange=this.currentSelectedRange),this._cachedSelectedRange}get currentSelectedRange(){const{client:i}=this,{store:e}=i;let{selectedCells:t}=i;if(!i._selectedRows.length&&t.length&&t.every(({record:r})=>e.indexOf(r)>=0))if(t.length>1){t=t.sort((u,h)=>u.rowIndex-h.rowIndex||u.columnIndex-h.columnIndex);const[r]=t,[n]=t.slice(-1),s=r.rowIndex,a=r.columnIndex,l=r.region,o=n.rowIndex,d=n.columnIndex,c=(d-a+1)*(o-s+1);if(t.length===c&&t.every(u=>u.region===l&&u.rowIndex>=s&&u.rowIndex<=o&&u.columnIndex>=a&&u.columnIndex<=d))return t}else return t}onKeyDown(i){i.key==="Escape"&&this.abort()}abort(){this.finalize(!1),this.reset()}reset(){this._isExtending=this._isCropping=this.currentRange=this.croppingCells=null}doDisable(i){this.removeElements(),this.reset(),super.doDisable(i)}};y(Ad,"$name","FillHandle"),y(Ad,"configurable",{calculateFillValue:null,allowCropping:!1}),Ad._$name="FillHandle",K.registerFeature(Ad);var wh=class LE extends Ai{afterConstruct(){var e;const t=this;if(!t.grid)throw new Error(`${t.constructor.$name} requires 'grid' to be configured.`);t.fields=(e=t.fields)!=null?e:{},super.afterConstruct()}updateGrid(e){var t;if(!((t=e.store)!=null&&t.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getColumnFields(e,t,r){var n;return Object.fromEntries((n=e==null?void 0:e.bottomColumns.reduce((s,{field:a,text:l,filterType:o,filterable:d,format:c})=>{var u;if(!r||r.includes(a)){const h=a&&t.getFieldDefinition(a),g=Vk(h)?h.type:void 0;(g||o||d)&&s.push([a,{title:l||a,type:(u=o!=null?o:$m(h)?"duration":g)!=null?u:"auto",format:c}])}return s},[]))!=null?n:[])}changeFields(e){var t;const r=T.merge({},LE.getColumnFields(this.grid.columns,(t=this.grid.store)==null?void 0:t.modelClass),e);return this.allowedFieldNames?Object.fromEntries(this.allowedFieldNames.map(n=>[n,r[n]])):r}};y(wh,"$name","GridFieldFilterPicker"),y(wh,"type","gridfieldfilterpicker"),y(wh,"configurable",{grid:null,allowedFieldNames:null});var zm=wh;zm.initClass(),zm._$name="GridFieldFilterPicker";var Xn=class extends fh{validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(i){const{grid:e,allowedFieldNames:t,fields:r}=this;return{...super.getFilterPickerConfig(i),fields:r,grid:e,allowedFieldNames:t}}get store(){return this.grid.$store}set store(i){}};y(Xn,"$name","GridFieldFilterPickerGroup"),y(Xn,"type","gridfieldfilterpickergroup"),y(Xn,"configurable",{grid:null}),y(Xn,"childPickerType","gridfieldfilterpicker"),Xn.initClass(),Xn._$name="GridFieldFilterPickerGroup";var Sh=Symbol("valueCount"),ja=class extends Ze{changePicker(i,e){const t=i&&T.merge({items:{list:{store:this.store,itemTpl:this.listItemTpl}}},i,{selectedRecordCollection:this.valueCollection,cls:new te("b-checklistfiltercombo-picker",i.cls)});return super.changePicker(t,e)}updateReadOnly(i){super.updateReadOnly(...arguments),this._picker&&(this.picker.readOnly=i)}updateStore(i){const e=this;e.detachListeners("storeChange"),i&&i.ion({name:"storeChange",change:e.updateListSelection,thisObj:e}),e.picker&&(e.picker.widgetMap.list.store=i),e.updateListSelection()}onListSelectionChange(){this.showApplyButton||this.applyListSelection(),this.picker.widgetMap.list.refresh(),this.syncInputFieldValue()}applyListSelection(){const{selected:i}=this.picker.widgetMap.list;this.value=i.map(e=>e[this.valueField])}onSearchInput({value:i}){this.searchText=i}onSearchClear(){this.searchText=null}updateSearchText(i){const e=this;(i==null?void 0:i.trim().length)>0?e.store.filter({id:e.searchFilterId,property:e.displayField,operator:e.filterOperator,value:i,caseSensitive:!1}):e.store.removeFilter(e.searchFilterId),e.picker.widgetMap.searchField.value=i}changeChipView(){return null}onSelectAllClick(){this.searchText=null,this.picker.widgetMap.list.selectAll()}onRemoveAllClick(){this.clear(),this.picker.widgetMap.list.deselectAll()}renderListItem(i){var e;const t=(e=this.listItemPillTpl)==null?void 0:e.call(this,i);return`<div class="b-checklistfiltercombo-item-text">${i.getValue(this.displayField)}</div>${t?`<div class="b-checklistfiltercombo-item-pill">${t}</div>`:""}`}syncInputFieldValue(i=!0){const e=this;if(e.picker){const{values:t}=e.picker.widgetMap.list.selected;e.input.value=t.length>0?e.L("L{filtersSet}",t.length,t):"",i||e.highlightChanged()}}updateListSelection(){var i,e,t;(t=this.picker)==null||t.widgetMap.list.select((e=(i=this.value)==null?void 0:i.map(r=>this.store.find(n=>n[this.valueField]===r,!0)))!=null?e:[],!0)}set value(i){super.value=i,this.updateListSelection()}get value(){return super.value}updateShowApplyButton(i){this.picker.widgetMap.selectAllButton.hidden=i,this.picker.widgetMap.applyButton.hidden=!i}onApplyClick(){this.applyListSelection()}showPicker(){super.showPicker(...arguments),this.picker.widgetMap.searchField.focus()}};y(ja,"$name","ChecklistFilterCombo"),y(ja,"type","checklistfiltercombo"),y(ja,"configurable",{multiSelect:!0,listItemTpl:"up.renderListItem",listItemPillTpl:null,showApplyButton:!1,picker:{type:"panel",flex:1,tbar:{items:{searchField:{type:"textfield",placeholder:"L{ChecklistFilterCombo.search}",clearable:!0,weight:100,internalListeners:{input:"up.onSearchInput",clear:"up.onSearchClear"}}}},items:{list:{type:"list",multiSelect:!0,emptyText:"L{ChecklistFilterCombo.noItems}",weight:100,internalListeners:{selectionChange:"up.onListSelectionChange"}}},bbar:{items:{applyButton:{type:"button",text:"L{ChecklistFilterCombo.apply}",cls:"b-transparent",textAlign:"left",weight:100,visible:!1,internalListeners:{click:"up.onApplyClick"}},selectAllButton:{type:"button",text:"L{ChecklistFilterCombo.selectAll}",cls:"b-transparent",textAlign:"left",weight:200,internalListeners:{click:"up.onSelectAllClick"}},removeAllButton:{type:"button",text:"L{ChecklistFilterCombo.removeAll}",cls:"b-transparent",textAlign:"left",weight:300,internalListeners:{click:"up.onRemoveAllClick"}}}}},chipView:null,store:{data:[]},editable:!1,placeholder:"L{placeholder}",searchText:null,searchFilterId:"search",value:[]}),ja.initClass(),ja._$name="ChecklistFilterCombo";var Wm={date:"date",int:"number",integer:"number",number:"number",text:"string",string:"string",duration:"duration",time:"time",auto:"auto"},uF={...Om,relation:!0},hF={filterDateIsToday:!0,filterDateIsThisWeek:!0,filterDateIsThisMonth:!0,filterDateIsThisYear:!0},Dh=class extends ie{static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},legacyMode:!1,pickerConfig:null,closeEmptyPopup:!1,value:null,property:null,operator:null,defaultOperators:{date:"sameDay",number:"=",string:"includes",duration:"=",relation:null,auto:"*"},allowedOperators:null,defaultEnabled:!0}}construct(i,e){const t=this;if(t.closeFilterEditor=t.closeFilterEditor.bind(t),t.inferredTypes={},super.construct(i,e),t.bindStore(t.store),e&&typeof e=="object"){const r=T.clone(e);delete r.prioritizeColumns,delete r.legacyMode,delete r.pickerConfig,delete r.dateFormat,delete r.closeEmptyPopup,delete r.defaultOperators,delete r.defaultEnabled,delete r.allowedOperators,T.isEmpty(r)||t.store.filter(r,null,i.isConfiguring)}}doDestroy(){var i,e;(i=this.filterTip)==null||i.destroy(),(e=this.filterEditorPopup)==null||e.destroy(),super.doDestroy()}get store(){return this.client.$store}updateAllowedOperators(i){const e=i==null?void 0:i.indexOf("*");e>=0&&(i[e]="includes")}bindStore(){this.detachListeners("store"),this.store.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this}),this.client.isPainted&&this.refreshHeaders(!1)}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(i){const e=this,{client:t,store:r}=e,n=t.headerContainer;n&&(E.children(n,".b-filter-icon.b-latest").forEach(s=>s.classList.remove("b-latest")),e.filterTip||(e.filterTip=new ve({forElement:n,forSelector:".b-filter-icon",getHtml({activeTarget:s}){return s.dataset.filterText}})),r.isFiltered||e.filterTip.hide(),t.columns.visibleColumns.forEach(s=>{if(e.canFilterColumn(s)){const a=r.filters.allValues.filter(({property:d,disabled:c,internal:u,isNoOp:h})=>d===s.field&&!c&&!u&&!h),l=a.length>0,o=s.element;if(o){const d=s.textWrapper;let c=d==null?void 0:d.querySelector(".b-filter-icon"),u;if(l){const h="&#x2022 ";u=`${e.L("L{filter}")}: `+(a.length>1?"<br/><br/>":"")+a.map(g=>{var f,m,p,v;let b=(f=g.value)!=null?f:"";const w=Array.isArray(b),D=(m=r==null?void 0:r.modelRelations)==null?void 0:m.find(({foreignKey:x})=>x===g.property);if(g.displayValue)b=g.displayValue;else{if(!e.legacyMode&&D){const{relatedDisplayField:x}=(v=(p=e.pickerConfig)==null?void 0:p.fields)==null?void 0:v[g.property];if(x){const R=M=>{var _;return(_=D.foreignStore.getById(M))==null?void 0:_[x]};w?b=b.map(R).sort((M,_)=>(M!=null?M:"").localeCompare(_!=null?_:"")):b=R(b)}}else s.formatValue&&b&&(b=w?b.map(x=>s.formatValue(x)):s.formatValue(b));w&&(b=`[ ${b.join(", ")} ]`)}const S=Ai.localizeOperator(g.operator,e.getFilterType(s));return(a.length>1?h:"")+(typeof g=="string"?g:`${S} ${b}`)}).join("<br/><br/>")}else u=e.L("L{applyFilter}");c?c.dataset.filterText=u:c=E.createElement({parent:d,tag:"i",className:"b-icon b-filter-icon",dataset:{filterText:u}}),s.field===r.latestFilterField&&c.classList.add("b-latest"),o.classList.add("b-filterable"),o.classList.toggle("b-filter",l)}s.meta.isFiltered=l}}),i&&t.refreshRows())}applyFilter(i,e){const{store:t}=this;i.$filter=t.addFilter(this.injectColumnFilterConfig(i,e),!0),t.filter()}injectColumnFilterConfig(i,e){const{filterFn:t}=i.filterable;return T.assign(e,{...i.filterable,...e,property:i.field,[t?"filterBy":"_"]:function(r){return t({value:this.value,record:r,operator:this.operator,property:this.property,column:i})}})}removeFilter(i,e){var t;if(!this.legacyMode&&!((t=i.filterable)!=null&&t.filterField))for(const r of this.getCurrentMultiFilters(i))(!e||r.operator===e)&&this.store.removeFilter(r);else this.store.removeFilter(this.store.filters.getBy("property",i.field))}disableFilter(i){for(const e of this.getCurrentMultiFilters(i))e.disabled=!0,this.store.filter(e);this.store.filter()}getCurrentMultiFilters(i){return this.store.filters.values.filter(e=>e.property===i.field)}getPopupDateItems(i,e,t,r,n,s,a,l){const o=this,d=s;function c(){o.removeFilter(i)}function u({event:g}){g.key==="Enter"&&s()}function h({source:g,value:f}){f==null?c():(o.clearSiblingsFields(g),o.applyFilter(i,{operator:g.operator,value:f,displayValue:g._value,type:"date"}))}return[T.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="sameDay"?t.value:r,operator:"sameDay",onKeydown:u,onChange:h,onClose:d,onClear:c},l),T.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onKeydown:u,onChange:h,onClose:d,onClear:c},l),T.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onKeydown:u,onChange:h,onClose:d,onClear:c},l)]}getPopupNumberItems(i,e,t,r,n,s,a,l){const o=this,d=s;function c(){o.removeFilter(i)}function u({event:g}){g.key==="Enter"&&s()}function h({source:g,value:f}){f==null?c():(o.clearSiblingsFields(g),o.applyFilter(i,{operator:g.operator,value:f}))}return[T.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="="?t.value:r,operator:"=",onKeydown:u,onChange:h,onEsc:d,onClear:c},l),T.assign({type:"number",placeholder:"L{lessThan}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:d,onClear:c},l),T.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onKeydown:u,onChange:h,onEsc:d,onClear:c},l)]}clearSiblingsFields(i){var e;(e=this.filterEditorPopup)==null||e.items.forEach(t=>{t!==i&&(t==null||t.clear())})}getPopupDurationItems(i,e,t,r,n,s,a,l){const o=this,d=s,c=()=>o.removeFilter(i);function u({source:h,value:g}){g==null?c():(o.clearSiblingsFields(h),o.applyFilter(i,{operator:h.operator,value:g}))}return[T.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(t==null?void 0:t.operator)==="="?t.value:r,operator:"=",onChange:u,onEsc:d,onClear:c},l),T.assign({type:"duration",placeholder:"L{lessThan}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(t==null?void 0:t.operator)==="<"?t.value:null,operator:"<",onChange:u,onEsc:d,onClear:c},l),T.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:o,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(t==null?void 0:t.operator)===">"?t.value:null,operator:">",onChange:u,onEsc:d,onClear:c},l)]}getPopupStringItems(i,e,t,r,n,s,a,l){var o;const d=this;return[T.assign({type:"text",cls:"b-last-row",placeholder:"L{filter}",localeClass:d,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?(o=t.value)!=null?o:t:r,operator:"*",onChange({source:c,value:u}){u===""?a():(d.applyFilter(i,{operator:c.operator,value:u,displayValue:c.displayField&&c.records?c.records.map(h=>h[c.displayField]).join(", "):void 0}),c.multiSelect||s())},onClose:s,onClear:a},l)]}getPopupItems(i,e,t,r,n,s,a,l){const o=this;if(o.useLegacyModeForColumn(i)||l)switch(e){case"date":return o.getPopupDateItems(...arguments);case"number":return o.getPopupNumberItems(...arguments);case"duration":return o.getPopupDurationItems(...arguments);default:return o.getPopupStringItems(...arguments)}return[o.getFieldFilterPickerGroup(i)]}getAllowedOperators(i){var e;let{allowedOperators:t}=this;return(e=i==null?void 0:i.filterable)!=null&&e.allowedOperators&&(t=t!=null?t:[],t.push(...i.filterable.allowedOperators)),t}getFieldFilterPickerGroup(i){var e;const t=this,r=t.getFilterType(i),n=t.getAllowedOperators(i),s={fields:{[i.field]:{type:r,title:(e=i.text)!=null?e:i.field}},...t.pickerConfig,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:i.field,grid:t.client,propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",internalListeners:{beforeAddFilter:({filter:a})=>{t.injectColumnFilterConfig(i,a)},remove:t.onPopupFilterRemove,keydown:t.onPopupKeydown,thisObj:t},triggerChangeOnInput:!1};return n&&(s.operators={[r]:Ai.defaultOperators[r].filter(({value:a})=>n.includes(a))}),s}onPopupFilterRemove(){this.closeEmptyPopup&&this.filterEditorPopup.widgetMap.pickerGroup.filters.length===0&&this.delay(this.closeFilterEditor,0)}onPopupKeydown({event:i}){i.key==="Enter"&&this.delay(this.closeFilterEditor,0)}showFilterEditor(i,e,t,r=!1){var n,s;i=this.client.columns.getById(i);const a=this,{store:l}=a,o=i.element,d=l.filters.getBy("property",i.field),c=a.getFilterType(i),u=a.useLegacyModeForColumn(i),{filterable:h}=i;if(!a.canFilterColumn(i))return;a.closeFilterEditor();const g=a.getPopupItems(i,c,d!=null&&d.internal?null:d,e,l,a.closeFilterEditor,()=>{a.removeFilter(i),a.closeFilterEditor()},h.filterField);if(g.forEach(m=>m.placeholder=m.placeholder?this.L(m.placeholder):m.placeholder),a.filterEditorPopup=new ft({forElement:o,owner:a.client,cls:new te("b-filter-popup",{"b-filter-popup-legacymode":u}),scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:g,dataset:{column:i.field,fieldType:c}}),!u){if(r||!(l!=null&&l.filters.find(m=>m.property===i.field))){const m=a.getAllowedOperators(i),p=(n=a.filterEditorPopup.widgetMap.pickerGroup.operators)!=null?n:Ai.configurable.operators,v=p[c];let b=a.defaultOperators[c];v.find(({value:w})=>w===b)||(b=(s=v[0])==null?void 0:s.value),m&&!m.includes(b)&&(b=m[0]),a.filterEditorPopup.widgetMap.pickerGroup.addFilter({type:c,property:i.field,operator:t!=null?t:b,value:e})}a.filterEditorPopup.items[0].focus()}const[f]=a.filterEditorPopup.items;if(h.filterField&&f.isCombo&&h.getFilterableValues){const m=B.countUnique(l.allRecords.flatMap(h.getFilterableValues));f.store.data=m.map(({value:p,count:v})=>({id:p,[i.field]:p,[Sh]:v})),f.showPicker()}}closeFilterEditor(){var i;(i=this.filterEditorPopup)==null||i.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(i){var e,t,r,n;const s=this,{store:a}=s,l=i.field,o=l&&a.modelClass.getFieldDefinition(l),d=(t=(e=i.filterType)!=null?e:Wm[i.type])!=null?t:Wm[o==null?void 0:o.type];return((r=a==null?void 0:a.modelRelations)==null?void 0:r.find(({foreignKey:u})=>u===l))?"relation":d==="auto"&&a&&!s.useLegacyModeForColumn(i)?(a.totalCount>0&&(s.inferredTypes[l]=Ai.inferFieldType(a,l)),(n=s.inferredTypes[l])!=null?n:"auto"):d?Wm[d]:"auto"}populateCellMenuWithDateItems({column:i,record:e,items:t}){const r=i.field;if(this.getFilterType(i)==="date"){const s=this,a=e.getValue(r),l=o=>{s.applyFilter(i,{operator:o,value:a,displayValue:i.formatValue?i.formatValue(a):a,type:"date"})};t.filterDateEquals={text:"L{on}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>l("=")},t.filterDateBefore={text:"L{before}",localeClass:s,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:s.disabled,onItem:()=>l("<")},t.filterDateAfter={text:"L{after}",localeClass:s,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:s.disabled,onItem:()=>l(">")}}}populateCellMenuWithNumberItems({column:i,record:e,items:t}){const r=i.field;if(this.getFilterType(i)==="number"){const s=this,a=e.getValue(r),l=o=>{s.applyFilter(i,{operator:o,value:a})};t.filterNumberEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>l("=")},t.filterNumberLess={text:"L{lessThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:s.disabled,onItem:()=>l("<")},t.filterNumberMore={text:"L{moreThan}",localeClass:s,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:s.disabled,onItem:()=>l(">")}}}populateCellMenuWithDurationItems({column:i,record:e,items:t}){if(this.getFilterType(i)==="duration"){const n=this,s=i.getFilterableValue(e),a=l=>{n.applyFilter(i,{operator:l,value:s})};t.filterDurationEquals={text:"L{equals}",localeClass:n,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:n.disabled,onItem:()=>a("=")},t.filterDurationLess={text:"L{lessThan}",localeClass:n,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:n.disabled,onItem:()=>a("<")},t.filterDurationMore={text:"L{moreThan}",localeClass:n,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:n.disabled,onItem:()=>a(">")}}}populateCellMenuWithStringItems({column:i,record:e,items:t}){var r,n;const s=this.getFilterType(i);if(!/(date|number|duration)/.test(s)){const a=this,l=i.getFilterableValue(e),o=(n=(r=i.filterable.filterField)==null?void 0:r.operator)!=null?n:"*";t.filterStringEquals={text:"L{equals}",localeClass:a,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:a.disabled,onItem:()=>a.applyFilter(i,{value:l,operator:o})}}}getMenuItems(i,e){const t=this,r={},n=t.getFilterType(i);if(i.filterable===!1)return{};if(uF[n]){const s=e?i.getFilterableValue(e):void 0,a=t.getCurrentMultiFilters(i).filter(u=>!u.disabled).map(({operator:u})=>u),l=e?1:void 0,o=t.getAllowedOperators(i),d=Ai.defaultOperators[n].filter(({value:u,argCount:h,isArrayValued:g})=>!(h>l||g)&&(!o||o.includes(u)));let c=300;for(const{value:u,text:h,argCount:g}of d){const f=`filter${O.capitalize(n)}${O.capitalize(u)}`;r[f]={text:O.capitalize(Ai.L(h)),weight:c+=10,icon:a.includes(u)?"b-icon b-icon-check":null,disabled:t.disabled,cls:hF[f]?"b-separator":null,onItem:()=>t.onOperatorMenuItem(i,s,u,g)}}}return i.meta.isFiltered&&Object.assign(r,t.getMenuItemsForFilteredColumn(i,e!==void 0)),{filterMenu:{text:"L{filter}",localeClass:t,menu:r,icon:"b-fw-icon b-icon-filter",weight:e?400:100}}}onOperatorMenuItem(i,e,t,r=1){const n=this,s=n.getFilterType(i);n.getCurrentMultiFilters(i).find(l=>!l.disabled&&l.operator===t)?n.removeFilter(i,t):r==0||e!==void 0?n.applyFilter(i,{property:i.field,operator:t,type:s,value:r===1?e:null,caseSensitive:!1,disabled:e==null&&r>0}):n.showFilterEditor(i,null,t,!0)}getMenuItemsForFilteredColumn(i,e){const t=this,r=!t.disabled&&(t.legacyMode||t.columnHasRemovableFilters(i));return{filterEdit:t.legacyMode?void 0:{text:"L{editFilter}",localeClass:t,icon:"b-fw-icon b-icon-edit",cls:"b-separator",weight:500,disabled:!r,onItem:()=>t.showFilterEditor(i)},filterRemove:{text:"L{removeFilter}",localeClass:t,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:510,disabled:!r,onItem:()=>t.removeFilter(i)},filterDisable:{text:"L{disableFilter}",localeClass:t,icon:"b-fw-icon b-icon-filter-disable",weight:520,disabled:t.disabled||!t.columnHasEnabledFilters(i),onItem:()=>t.disableFilter(i)}}}populateCellMenu({column:i,record:e,items:t,...r}){const n=this;n.canFilterColumn(i)&&!e.isSpecialRow&&(n.useLegacyModeForColumn(i)?(n.populateCellMenuWithDateItems({column:i,record:e,items:t,...r}),n.populateCellMenuWithNumberItems({column:i,record:e,items:t,...r}),n.populateCellMenuWithDurationItems({column:i,record:e,items:t,...r}),n.populateCellMenuWithStringItems({column:i,record:e,items:t,...r}),i.meta.isFiltered&&Object.assign(t,n.getMenuItemsForFilteredColumn(i,!0))):Object.assign(t,n.getMenuItems(i,e)))}columnHasRemovableFilters(i){const e=this;return!!e.getCurrentMultiFilters(i).find(t=>!e.canDeleteFilter||e.callback(e.canDeleteFilter,e,[t])!==!1)}columnHasEnabledFilters(i){return!!this.getCurrentMultiFilters(i).find(e=>!e.disabled)}populateHeaderMenu({column:i,items:e}){const t=this;t.useLegacyModeForColumn(i)?i.meta.isFiltered?(e.filterEdit={text:"L{editFilter}",localeClass:t,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:t.disabled,onItem:()=>t.showFilterEditor(i)},e.filterRemove={text:"L{removeFilter}",localeClass:t,weight:110,icon:"b-fw-icon b-icon-remove",disabled:t.disabled||!t.legacyMode&&!t.columnHasRemovableFilters(i),onItem:()=>t.removeFilter(i)},e.filterDisable={text:"L{disableFilter}",localeClass:t,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:t.disabled||!t.columnHasEnabledFilters(i),onItem:()=>t.disableFilter(i)}):t.canFilterColumn(i)&&(e.filter={text:"L{filter}",localeClass:t,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:t.disabled,onItem:()=>t.showFilterEditor(i)}):Object.assign(e,t.getMenuItems(i))}useLegacyModeForColumn(i){var e;return this.legacyMode||((e=i.filterable)==null?void 0:e.filterField)!=null}canFilterColumn(i){var e,t;return i.filterable!==!1&&(((e=i.filterable)==null?void 0:e.filter)===!0||((t=i.filterable)==null?void 0:t.filter)!==!1&&this.defaultEnabled!==!1)}onStoreBeforeFilter({filters:i}){const{columns:e}=this.client,t=B.groupBy(i,"property");for(const[r,n]of Object.entries(t)){const s=e.find(a=>this.canFilterColumn(a)&&a.field===r);s&&(s.$filters=n.map((a,l)=>{var o,d;if((a.columnOwned||this.prioritizeColumns)&&!a.internal&&((o=s==null?void 0:s.filterable)!=null&&o.filterFn)){const c=new Je({id:(d=a.id)!=null?d:`${r}-${l}-${Date.now()}`,columnOwned:!0,property:r,operator:a.operator,value:a.value,displayValue:a.displayValue,disabled:a.disabled,filterBy(u){return s.filterable.filterFn.call(this,{value:this.value,record:u,operator:this.operator,property:this.property,column:s})}});return i.splice(i.indexOf(a),1,c),c}return a}))}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:i}){if(this.filterEditorPopup&&this.closeFilterEditor(),i.classList.contains("b-filter-icon")){const e=i.closest(".b-grid-header");return this.showFilterEditor(e.dataset.columnId),!1}}showFilterEditorByKey({target:i}){const e=i.matches(".b-grid-header")&&i;return e&&this.showFilterEditor(e.dataset.columnId),!!e}isActionAvailable({event:i,actionName:e}){if(e==="showFilterEditorByKey"){const t=i.target.closest(".b-grid-header"),r=t&&this.client.columns.find(n=>n.id===t.dataset.columnId);return!!(r!=null&&r.filterable)}}};y(Dh,"$name","Filter"),Dh._$name="Filter",K.registerFeature(Dh);var gF={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null},Ld=class extends ie{static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,hidden:!1,filter:null,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}},defaultEnabled:!0}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(i,e){const t=this;t.onColumnFilterFieldChange=t.onColumnFilterFieldChange.bind(t),super.construct(i,Array.isArray(e)?{filter:e}:e),t.bindStore(t.store),t.filter&&t.store.filter(t.filter),t.gridDetacher=i.ion({beforeElementClick:"onBeforeElementClick",thisObj:t})}get store(){return this.client.$store}bindStore(i){this.detachListeners("store"),i.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var i;this.destroyFilterBar(),(i=this.gridDetacher)==null||i.call(this),super.doDestroy()}doDisable(i){const{columns:e}=this.client;e==null||e.forEach(t=>{const r=this.getColumnFilterField(t);r&&(r.disabled=i)}),super.doDisable(i)}updateHidden(i){this.isConfiguring||(i?this.hideFilterBar():this.showFilterBar())}updateCompactMode(i){this.client.headerContainer.classList[i?"add":"remove"]("b-filter-bar-compact");for(const e in this._columnFilters){const t=this._columnFilters[e];t.placeholder=i?t.placeholder||t.column.headerText:null}}destroyFilterBar(){var i;(i=this.client.columns)==null||i.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var i;const e=this;e.clearStoreFiltersOnHide&&e.suspendStoreTracking(),(i=e.client.columns)==null||i.forEach(t=>e.hideColumnFilterField(t,!0)),e.store.filter(),e.clearStoreFiltersOnHide&&e.resumeStoreTracking(),e._hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(this.clearStoreFiltersOnHide),this.resumeStoreTracking(),this._hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(i){this.client.hideHeaders||(this.client.columns.visibleColumns.forEach(e=>this.renderColumnFilterField(e,i)),this.rendered=!0)}renderColumnFilterField(i,e){var t,r,n;const s=this,{client:a,store:l}=s,o=s.getColumnFilterable(i);if(o&&i.isVisible){const{field:d}=i,c=i.element,u=l.filters.get(i.id)||l.filters.getBy("property",d);let h=s.getColumnFilterField(i);if(h)e&&s.onColumnFilterFieldChange({source:h,value:h.value}),h.render(c),h.show();else{const g=`${i.filterType||"text"}field`,{filterField:f}=o,m=f==null?void 0:f.cls;m&&delete o.filterField.cls;const p=(t=f==null?void 0:f.ariaLabel)!=null?t:i.text?s.L(`L{Filter.filter} ${i.text}`):null;h=z.append(T.assign({type:g,cls:{[s.filterFieldCls]:1,[m]:m},dataset:{column:d},column:i,owner:a,clearable:!0,revertOnEscape:!0,name:d,value:u&&!u._filterBy&&!u.internal?s.buildFilterValue(u):void 0,inputCls:s.filterFieldInputCls,keyStrokeChangeDelay:s.keyStrokeFilterDelay,disabled:s.disabled,placeholder:s.compactMode?i.headerText:null,format:i.format,ariaLabel:p,internalListeners:{change:s.onColumnFilterFieldChange,clear:s.onColumnFilterFieldChange}},f),c)[0],s.compactMode&&(h.placeholder=(f==null?void 0:f.placeholder)||i.headerText),f!=null&&f.hasOwnProperty("min")||Object.defineProperty(h,"min",{get:()=>{var b;return(b=i.editor)==null?void 0:b.min},set:()=>null}),f!=null&&f.hasOwnProperty("max")||Object.defineProperty(h,"max",{get:()=>{var b;return(b=i.editor)==null?void 0:b.max},set:()=>null}),f!=null&&f.hasOwnProperty("strictParsing")||Object.defineProperty(h,"strictParsing",{get:()=>{var b;return(b=i.editor)==null?void 0:b.strictParsing},set:()=>null}),h.element.retainElement=!0,s.setColumnFilterField(i,h);const v=(f==null?void 0:f.store)&&(f.store.readUrl||f.store.data||f.store.isChained)||(f==null?void 0:f.items);if(h.isCombo&&!v&&h.store.count===0){const b=h.value,w=()=>{if(!(h.store.readUrl||h.store.isChained)){let D;o.getFilterableValues?D=B.countUnique(l.flatMap(o.getFilterableValues)).map(({value:x,count:R})=>({id:x,[d]:x,[Sh]:R})):D=l.getDistinctValues(d,!0,!0).map(({value:S,count:x})=>l.createRecord({id:S,[d]:S,[Sh]:x})),h.store.data=D}};h.value=null,h.store.isSorted||h.store.sort({field:d,ascending:!0}),h.picker.ion({beforeShow:w}),w(),h.value=b,h.displayField=(r=f.displayField)!=null?r:d,h.valueField=(n=f.valueField)!=null?n:d}!s.filter&&h.value&&l.autoLoad!==!1&&s.onColumnFilterFieldChange({source:h,value:h.value,silent:!0})}c.classList.add(s.filterableColumnCls)}}updateColumnFilterFields(){const i=this,{store:e}=i,{columns:t}=i.client;let r,n;i._updatingFields=!0;for(const s of t.visibleColumns)r=i.getColumnFilterField(s),r&&!s.$isApplyingFilter&&(n=e.filters.get(s.id)||e.filters.getBy("property",s.field),n&&!n.internal?n._filterBy?r.value=n.value:r.value=i.buildFilterValue(n):r.isCombo&&r.multiSelect?r.value=[]:r.value="");i._updatingFields=!1}getColumnFilterable(i){if(!i.isRoot&&this.canFilterColumn(i)&&i.field&&i.isLeaf)return typeof i.filterable=="function"&&(i.filterable={filterFn:i.filterable}),i.filterable}destroyColumnFilterField(i){const e=this.getColumnFilterField(i);e&&(this.hideColumnFilterField(i,!0),e.destroy(),this.setColumnFilterField(i,void 0))}hideColumnFilterField(i,e){const t=this,{store:r}=t,n=i.element,s=t.getColumnFilterField(i);if(s){t.isDestroying||s.hide();const{$filter:a}=i;!r.isDestroyed&&t.clearStoreFiltersOnHide&&a&&r.removeFilter(a,e),n==null||n.classList.remove(t.filterableColumnCls)}}getColumnFilterField(i){var e;return(e=this._columnFilters)==null?void 0:e[i.id]}setColumnFilterField(i,e){this._columnFilters=this._columnFilters||{},this._columnFilters[i.data.id]=e}parseFilterValue(i,e,t){var r;if(Array.isArray(e)||e instanceof we||typeof e=="number")return{value:e};if(T.isDate(e))return{operator:t.isDateField?"sameDay":t.isTimeField?"sameTime":"=",value:e};const n=String(e).match(this.filterParseRegExp),s=typeof e=="number"?"=":"*";return{operator:n[1]||((r=i.filterable)==null?void 0:r.operator)||s,value:n[2]}}buildFilterValue({operator:i,value:e}){return typeof e=="number"||e instanceof Date||Array.isArray(e)||e instanceof we?e:(i in gF?"":i)+e}onStoreBeforeFilter({filters:i}){var e;const{columns:t}=this.client;for(let r=0;r<i.count;r++){const n=i.getAt(r),s=(n.columnOwned||this.prioritizeColumns)&&t.find(a=>this.canFilterColumn(a)&&a.field===n.property);(e=s==null?void 0:s.filterable)!=null&&e.filterFn&&(s.$filter||(s.$filter=new Je({columnOwned:!0,property:n.property,id:s.id,filterBy(a){return s.filterable.filterFn({value:this.value,record:a,property:this.property,column:s})}})),s.$filter.value=n.value,i.splice(r,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:i,changes:e,column:t,columns:r}){var n,s,a;const l=this;for(const o of l.client.columns.visibleColumns)if(l.canFilterColumn(o)&&(((n=o.filterable)==null?void 0:n.filter)===!0||(s=l.client.features.filter)!=null&&s.defaultEnabled&&((a=o.filterable)==null?void 0:a.filter)!==!1))throw new Error(`Columns do not currently support both \`filter\` and \`filterBar\` features enabled on the same column. Please check column with id ${o.id}.`);!l.hidden&&(e!=null&&e.hidden)&&(e.hidden.value?l.destroyColumnFilterField(t):l.renderColumnFilterField(t)),i==="remove"&&r.forEach(o=>l.destroyColumnFilterField(o))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const i of Object.values(this._columnFilters))i==null||i.element.remove()}disableGridNavigation(i){return i.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:i}){if(i.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:i,value:e,silent:t}){var r,n,s,a,l;const o=this,{column:d}=i,{filterFn:c}=d.filterable,{store:u}=o,h=d.$filter||u.filters.find(f=>(f.id===d.id||f.property===d.field)&&!f.internal);if(o._updatingFields)return;const g=e==null||e===""||Array.isArray(e)&&e.length===0;if(u.removeFilter(h,!0),d.$filter=null,d.$isApplyingFilter=!0,g){if(!h){d.$isApplyingFilter=!1;return}}else d.$filter=u.addFilter({property:i.name,...o.parseFilterValue(d,e,i),[typeof((r=d.filterable)==null?void 0:r.caseSensitive)=="boolean"?"caseSensitive":void 0]:(n=d.filterable)==null?void 0:n.caseSensitive,[c?"filterBy":"_"]:function(f){return c({value:this.value,record:f,operator:this.operator,property:this.property,column:d})}},!0);u.filter({silent:t}),d.$isApplyingFilter=!1,(s=i.picker)!=null&&s.isVisible&&((l=(a=i.picker)==null?void 0:a.realign)==null||l.call(a))}populateHeaderMenu({items:i}){i.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}canFilterColumn(i){var e,t;return i.filterable!==!1&&(((e=i.filterable)==null?void 0:e.filterBar)===!0||((t=i.filterable)==null?void 0:t.filterBar)!==!1&&this.defaultEnabled!==!1)}};y(Ld,"$name","FilterBar"),Ld.featureClass="b-filter-bar",Ld._$name="FilterBar",K.registerFeature(Ld);var Pd=class extends ie{static get configurable(){return{field:null,expandIconCls:"b-icon-group-expand",collapseIconCls:"b-icon-group-collapse",ascending:!0,headerHeight:null,showCount:!0,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(i,e){var t;const r=this;i.features.tree||(r._thisIsAUsedExpression(i.features.groupSummary),e=r.processConfig(e),r.grid=i,super.construct(i,e),i.ion({lockRows:"onLockRows",beforeUnlockRows:"onUnlockRows",thisObj:r}),(!((t=i.features.lockRows)!=null&&t.enabled)||i.splitFrom)&&r.init(i))}init(i){this.grid=i,this.bindStore(i.store),this.detachListeners("rowManager"),i.rowManager.ion({name:"rowManager",beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:this}),i.isConfiguring||i.renderRows()}processConfig(i){return typeof i=="string"?{field:i}:i}setConfig(i){i===null?this.store.clearGroupers():super.setConfig(this.processConfig(i))}bindStore(i){const e=this,{client:t}=e;t.isSchedulerBase&&t.isVertical&&i&&(i=t.resourceStore),e.detachListeners("store"),!t.isLockedRows&&(i.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",toggleGroup:"onStoreToggleGroup",thisObj:e}),(e.field||i.isGrouped)&&!t.isConfiguring?i.group({field:e.field,ascending:e.ascending,fn:e.groupSortFn}):e.onStoreGroup({groupers:i.groupers}))}updateRenderer(i){this.groupRenderer=i}updateField(i){var e,t;const r=this;(e=r.client.features.lockRows)!=null&&e.enabled&&!r.client.splitFrom||(!r.isConfiguring||!((t=r.store.groupers)!=null&&t.some(n=>n.field===i)))&&r.store.group({field:i,ascending:r.ascending,fn:r.groupSortFn})}updateGroupSortFn(i){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:i})}updateAscending(i){const e=this;e.isConfiguring||e.store.group({field:e.field,ascending:i,fn:e.groupSortFn})}doDisable(i){const{store:e}=this;if(i&&e.isGrouped){const{sorters:t}=e;t.unshift(...e.groupers),this.currentGroupers=e.groupers,e.clearGroupers(),e.sort(t)}else!i&&this.currentGroupers&&(e.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(i)}get store(){const{grid:i}=this;return i.isSchedulerBase&&i.isVertical?i.resourceStore:i.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}refreshGrid(i){const{store:e,rowManager:t}=this.grid;t.rowCount>e.count||!t.getRowFor(i)?t.renderFromRow():t.renderFromRecord(i)}toggleCollapse(i,e){this.internalToggleCollapse(i,e)}internalToggleCollapse(i,e,t=!1,r,n=!1){const s=this,{store:a,grid:l}=s;let o=Number.MAX_VALUE;const d=B.asArray(i).map(c=>{if(c=a.getById(c),c.isGroupHeader||(c=a.getGroupHeaderForRecord(c)),o=Math.min(o,a.indexOf(c),0),!!c.isGroupHeader)return c});e=e===void 0?!d[0].meta.collapsed:e,l.trigger("beforeToggleGroup",{groupRecord:d[0],groupRecords:d,collapse:e,domEvent:r})!==!1&&(s.isToggling=!0,e?a.collapse(d):a.expand(d),s.isToggling=!1,t||s.refreshGrid(a.getAt(o)),l.trigger("toggleGroup",{groupRecord:d[0],groupRecords:d,collapse:e,allRecords:n}),l.afterToggleGroup())}collapseAll(){const i=this,{store:e,grid:t}=i;e.isGrouped&&!i.disabled&&(i.internalToggleCollapse(e.groupHeaderRecords,!0,!0,void 0,!0),t.trigger("collapseAllGroups"),t.refreshRows(null,!0))}expandAll(){const i=this,{store:e,grid:t}=i;e.isGrouped&&!i.disabled&&(i.internalToggleCollapse(e.groupHeaderRecords,!1,!0,void 0,!0),t.trigger("expandAllGroups"),t.refreshRows())}onLockRows({clone:i}){this.grid=i}onUnlockRows({source:i}){const{client:e}=this;e.isDestroying||this.init(e)}onBeforeRenderRow({row:i}){const e=i.grid.store.getById(i.id);i.forceInnerHTML=i.forceInnerHTML||(e==null?void 0:e.isGroupHeader)}renderCell(i){var e;const t=this,{cellElement:r,row:n,column:s,grid:a}=i,{meta:l}=i.record,o={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in l){if(s.groupHeaderReserved)return;s.clearCell(r),o["b-grid-group-collapsed"]=l.collapsed,o["b-group-row"]=1,a.buildGroupHeader?a.buildGroupHeader(i):t.buildGroupHeader(i),s===t.groupHeaderColumn&&(E.createElement({parent:r,tag:"i",className:{"b-group-state-icon":1,"b-fw-icon":1,[t.expandIconCls]:l.collapsed,[t.collapseIconCls]:!l.collapsed},nextSibling:r.firstChild}),r.classList.add("b-group-title"),r.$groupHeader=r._hasHtml=!0)}else r.$groupHeader&&((e=r.querySelector(".b-group-state-icon"))==null||e.remove(),r.classList.remove("b-group-title"),r.$groupHeader=!1);n.assignCls(o)}buildGroupHeader(i){var e;const t=this,{record:r,cellElement:n,column:s,persist:a,isExporting:l=!1}=i,{grid:o}=t,d=r.meta,c=d.emptyArray?o.L("L{Object.None}"):d.groupRowFor,{groupSummary:u}=o.features,h=d.childCount-(u&&u.target!=="header"?1:0);let g=null,f=!0;if(a||s){const m=o.columns.get(d.groupField),p=i.isFirstColumn=s===t.findGroupHeaderColumn(l);m!=null&&m.groupRenderer?p&&(g=m.groupRenderer({...i,groupRowFor:c,groupRecords:r.groupChildren,groupColumn:m,count:h}),f=!1):t.groupRenderer&&(g=t.groupRenderer({...i,groupRowFor:c,groupRecords:r.groupChildren,groupColumn:m,count:h,isFirstColumn:p})),!((e=i.size)!=null&&e.height)&&t.headerHeight&&(i.size.height=t.headerHeight),p&&g==null&&f&&E.getChildElementCount(n)===0&&(g=O.encodeHtml(`${c==="__novalue__"?"":c}`+(t.showCount?` (${h})`:"")))}else t.groupRenderer&&(g=t.groupRenderer(i));return typeof g=="string"?n.innerHTML=g:typeof g=="object"&&oe.sync({targetElement:n,domConfig:{onlyChildren:!0,children:B.asArray(g)}}),E.getChildElementCount(n)>0&&(n._hasHtml=!0),n.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find(i=>!i.groupHeaderReserved)}findGroupHeaderColumn(i=!1){return this.grid.columns.visibleColumns.find(e=>!e.groupHeaderReserved&&(i?e.exportable!==!1:!0))}renderHeader(i=this.grid.headerContainer){var e;const{store:t,grid:r}=this;if(i&&t.isGrouped)for(const n of t.groupers){const s=r.columns.get(n.field),a=s&&r.getHeaderElement(s.id);if(a==null||a.classList.add("b-group",n.ascending?"b-asc":"b-desc"),a&&(!((e=r.features.sort)!=null&&e.enabled)||s.sortable===!1)){const l=s.textWrapper;l!=null&&l.querySelector(".b-sort-icon")||E.createElement({parent:l,className:"b-icon b-sort-icon"})}}}populateHeaderMenu({column:i,items:e}){const t=this;i.groupable!==!1&&(e.groupAsc={text:"L{groupAscending}",localeClass:t,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:t.disabled,onItem:()=>t.store.group(i.field,!0)},e.groupDesc={text:"L{groupDescending}",localeClass:t,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:t.disabled,onItem:()=>t.store.group(i.field,!1)}),t.store.isGrouped&&(e.groupRemove={text:"L{stopGrouping}",localeClass:t,icon:"b-fw-icon b-icon-clear",cls:i.groupable?"":"b-separator",weight:420,disabled:t.disabled,onItem:()=>t.store.clearGroupers()})}getColumnDragToolbarItems(i,e){var t;const r=this,{store:n,disabled:s}=r;e.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:l})=>n.group(l.field,!0)}),e.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:l})=>n.group(l.field,!1)});const a=((t=n.groupers)==null?void 0:t.some(l=>l.field===i.field))&&!s;return e.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!a,weight:110,onDrop:({column:l})=>n.removeGrouper(l.field)}),e}onStoreGroup({groupers:i}){const{grid:e}=this,{element:t}=e,r=t&&E.children(t,".b-grid-header.b-group");if(t){for(const n of r)n.classList.remove("b-group","b-asc","b-desc");i&&this.renderHeader()}}onStoreChange({action:i,records:e}){const{client:t}=this,{rowManager:r,store:n}=t;if(n.isGrouped&&i==="move"){const{field:s}=n.groupers[0],a=Math.min(...e.reduce((l,o)=>{if(l.push(n.indexOf(o.instanceMeta(n).groupParent)),s in o.meta.modified){const d=n.groupRecords.find(c=>c.meta.groupRowFor===o.meta.modified[s]);d&&l.push(n.indexOf(d))}return l},[]));r.renderFromRow(r.getRow(a))}}onStoreToggleGroup({groupRecord:i}){this.isToggling||this.refreshGrid(i)}onElementTouchStart(i){const e=this,{target:t}=i,r=t.closest(".b-grid-header"),n=r&&e.grid.getColumnFromElement(r);i.touches.length>1&&n&&n.groupable!==!1&&!e.disabled&&e.store.group(n.field)}onElementClick(i){var e;const t=this,{store:r}=t,{target:n}=i,s=n.closest(".b-group-row"),a=n.closest(".b-grid-header"),l=a==null?void 0:a.dataset.column;if(!(n.classList.contains("b-resizer")||t.disabled||n.classList.contains("b-action-item")||n.closest(".b-checkbox")||i.handled)){if(a&&l){const o=(e=r.groupers)==null?void 0:e.find(d=>d.field===l);if(o&&!i.shiftKey)return o.ascending=!o.ascending,r.group(),!1;i.shiftKey&&t.grid.columns.get(l).groupable!==!1&&(i.altKey?r.removeGrouper(l):r.group(l))}if(s&&(t.toggleOnRowClick||i.target.classList.contains("b-group-state-icon")))return t.internalToggleCollapse(Oe.get(s).id,void 0,void 0,i),!1}}toggleGroup(){var i;const{grid:e}=this,{focusedCell:t}=e;return!this.disabled&&!t.isActionable&&((i=t.record)!=null&&i.isGroupHeader)?(this.internalToggleCollapse(t.id),!0):!1}updateHeaderHeight(){this.isConfiguring||this.client.refreshRows()}updateShowCount(){this.isConfiguring||this.client.refreshRows()}};y(Pd,"$name","Group"),Pd._$name="Group",K.registerFeature(Pd,!0,["Grid","Scheduler"]),K.registerFeature(Pd,!1,["TreeGrid"]);var jm=i=>{var e;return e=class extends(i||$){generateHtml(t,r,n){const{store:s}=this.client,a=t.summaries||(t.sum?[{sum:t.sum,renderer:t.summaryRenderer}]:[]);let l=`<div class="b-summary-wrap ${n}">`;return a.forEach(o=>{var d,c;let u=o.sum,h=null;switch(u===!0&&(u="sum"),u){case"sum":case"add":h=s.sum(t.field,r);break;case"max":h=s.max(t.field,r);break;case"min":h=s.min(t.field,r);break;case"average":case"avg":h=s.average(t.field,r);break;case"count":h=r.length;break;case"countNotEmpty":h=r.reduce((g,f)=>{const m=f.getValue(t.field);return g+(m!=null?1:0)},0);break}if(typeof u=="function"&&(h=r.reduce(u,"seed"in o?o.seed:0)),h!==null){const g="b-grid-summary-value",f=o.label?`<div class="b-grid-summary-label">${o.label}</div>`:"";let m=o.renderer?o.renderer({config:o,sum:h}):(c=(d=t.formatValue)==null?void 0:d.call(t,h,r[0]))!=null?c:h,p;m==null&&(m=""),String(m).includes("<div>")?p=m:p=f?`${f}<div class="${g}">${m}</div>`:`<div class="${g} b-nolabel">${m}</div>`,l+=p}}),`${l}</div>`}},y(e,"$name","SummaryFormatter"),e},Ua=class extends jm(ie){static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(i,e){if(super.construct(i,e),!i.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(i.store),i.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(i){this.detachListeners("store"),i.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.client.store}doDisable(i){this.updateTarget(this.target),super.doDisable(i)}changeTarget(i){return T.assertString(i,"target"),i}updateTarget(i){this.store.useGroupFooters=!this.disabled&&i==="footer",this.isConfiguring||this.store.group()}changeCollapseToHeader(i){return T.assertBoolean(i,"collapseToHeader"),i}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:i,record:e}){i.isGroupFooter&&!("groupFooterFor"in e.meta)?(i.isGroupFooter=!1,i.forceInnerHTML=!0):i.isGroupHeader&&!e.meta.collapsed&&i.eachElement(this.removeSummaryElements)}removeSummaryElements(i){}renderCell({column:i,cellElement:e,row:t,record:r,size:n,isFirstColumn:s}){const a=this,{meta:l}=r,{rowHeight:o}=a.client,d="groupRowFor"in l,c="groupFooterFor"in l,u=a.target==="header",h={"b-group-footer":0,"b-header-summary":0},g=d&&(u||a.collapseToHeader&&l.collapsed)&&!s||c&&!u;if((d||c)&&(n.height=d&&n.height||o),a.store.isGrouped&&g&&!a.disabled){i.clearCell(e);const f=d?r:l.groupRecord;t.isGroupFooter=c,t.isGroupHeader=d,c?h["b-group-footer"]=1:h["b-header-summary"]=1;const m=a.updateSummaryHtml(e,i,f),p=typeof m=="number"?m:m.count;p>1&&(n.height+=l.collapsed&&!u?0:p*o*.1),m.height&&(n.height+=m.height)}t.assignCls(h)}updateSummaryHtml(i,e,t){const r=t.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();const n=this.generateHtml(e,r,"b-grid-group-summary",t,t.meta.groupField,t.meta.groupRowFor);return i.children.length?E.sync(n,i.firstElementChild):i.innerHTML=n,e.summaries?e.summaries.length:e.sum?1:0}onStoreUpdate({source:i,changes:e}){if(!this.disabled&&i.isGrouped){if(e&&i.groupers.find(r=>r.field in e))return;Object.keys(e).some(r=>{const n=this.client.columns.get(r);return!!n&&(!!n.sum||!!n.summaries)})&&(this.client.forceFullRefresh=!0)}}refresh(){this.client.columns.visibleColumns.forEach(i=>{i.hasSummary&&this.client.refreshColumn(i)})}hasSummary(i){return i.sum||i.summaries}updateSummaries(){this.isConfiguring||this.refresh()}};y(Ua,"$name","GroupSummary"),Ua.featureClass="b-group-summary",Ua._$name="GroupSummary",K.registerFeature(Ua);var Od=Object.freeze({animate:!1,block:"start"}),LS=Object.freeze({animate:!1,block:"end"}),Um=7,PS={split:1,unsplit:1},Zn,Gr=class extends ie{constructor(){super(...arguments),Lv(this,Zn,!1),y(this,"restorers",[])}static get pluginConfig(){return{chain:["populateCellMenu","afterConfigChange","afterAddListener","afterRemoveListener",{fn:"onInternalPaint",prio:-1e3}],assign:["split","unsplit","subViews","syncSplits"]}}doDestroy(){this.unsplit(!0),super.doDestroy()}doDisable(i){const e=this;e.isConfiguring||(i?(e._disabledSplitOptions=e._splitOptions,e.unsplit()):e._disabledSplitOptions&&(e.split(e._disabledSplitOptions),e._disabledSplitOptions=null))}onInternalPaint(){}get isSplit(){var i;return!!((i=this.widgets)!=null&&i.length)}getClientConfig(i,e,t,r={}){const{client:n}=this,{subGrids:s,regions:a}=n,l=n.columns.records.slice(),o=T.assign({},n.subGridConfigs);if(n.eachSubGrid(u=>{const h=o[u.region];u.flex?h.flex=u.flex:h.width=u.element.style.width}),t.atColumn&&a.length>1&&e>0){const u=a.indexOf(t.atColumn.region);for(let h=0;h<u;h++){const g=s[a[h]];B.remove(l,...g.columns.records),delete o[a[h]]}}const d=T.merge({},n.initialConfig,{appendTo:i,insertFirst:null,insertBefore:null,splitFrom:n,owner:n.owner,tbar:n.initialConfig.tbar&&e===1?{height:n.tbar.height,items:[" "]}:null,store:n.store,selectedRecordCollection:n.selectedRecordCollection,subGridConfigs:o,columns:this.cloneColumns(l),minHeight:0,minWidth:0},r);for(const u of T.keys(this.relayProperties))d[u]=n[u];const c={};for(const u in n.listeners)if(!PS[u]){const h=n.listeners[u].filter(g=>!g.$internal);h.length&&(c[u]=h)}return d.listeners=c,(t.direction==="horizontal"||t.direction==="both"&&e!==1)&&("hideHeaders"in d||(d.hideHeaders=!0),d.features.headerMenu=!1),delete d.data,delete d.adopt,d}cloneColumns(i){return i.flatMap(e=>{if(e.meta.isSelectionColumn||e.field==="expanderActionColumn")return[];const t={...e.data};return e.children&&(t.children=e.children.map(r=>({...r.data}))),delete t.headerRenderer,delete t.parentId,delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,t})}cloneClient(i,e,t,r){const n=this.getClientConfig(i,e,t,r),s=new this.client.constructor(n);return s.element.classList.add("b-split-clone"),s}processOptions(i){var e;const{client:t}=this,{atRecord:r,atColumn:n,direction:s}=i;if(!s)r&&n?i.direction="both":n?i.direction="vertical":i.direction="horizontal";else{if(s!=="vertical"&&!r&&t.store.count){const a=t._bodyRectangle.height/2+t.scrollable.y,l=(e=t.rowManager.getRowAt(a,!0))!=null?e:t.rowManager.rows[Math.ceil(t.rowManager.rows.length/2)];i.atRecord=t.store.getById(l.id)}if(s!=="horizontal"&&!n){const a=L.from(t.element);let l=a.center.x-a.x,o=t.subGrids[t.regions[0]],d=0,c=null;for(;l>o.width;)l-=o.width,o=t.subGrids[t.regions[++d]];l+=o.scrollable.x;const{visibleColumns:u}=o.columns;let h=0,g=0;for(;h<l&&g<u.length;)c=u[g++],h+=c.element.offsetWidth;i.atColumn=c}}return i}createSplitContainer({direction:i}){const{client:e}=this,{element:t}=e;return this.splitContainer=E.createElement({parent:t.parentElement,nextSibling:t.nextSibling,className:{"b-split-container":1,[`b-split-${i}`]:1,"b-rtl":e.rtl},style:{width:t.style.width,flex:t.style.flex,height:t.style.height},children:[i!=="both"&&t,i==="both"&&{className:"b-split-top",children:[t]},i==="both"&&{className:"b-split-bottom"}]})}syncHeaderHeights(){let i=0;for(const e of this.subViews)e.eachSubGrid(t=>{t.header.height>i&&(i=t.header.height)});for(const e of this.subViews)e.eachSubGrid(t=>{t.header.height=i})}toggleOriginalSubGrids(i){const e=this,{client:t}=e,{regions:r}=t;if(i.atColumn&&r.length>1){const n=r.indexOf(i.atColumn.region),s=[t];i.direction==="both"&&s.push(e.subViews[2]);for(const a of s)if(n+1<r.length){const l=a===t,o=a.subGrids[r[n]];o.hideSplitter(),l&&e.restorers.push(()=>o.showSplitter()),o.flex||(t.inForEachOther=!0,o.flex=1,t.inForEachOther=!1,l&&e.restorers.push(()=>{o.flex=null,o.width=o._initialWidth}));for(let d=n+1;d<r.length;d++){const c=a.subGrids[r[d]];c.hide(),l&&e.restorers.push(()=>{c.show()})}r.length===2&&(a._initialWidth=a.element.style.width,a._initialFlex=a.flex,a.width=o._initialWidth,l&&e.restorers.push(()=>{a._initialFlex!==null?a.flex=a._initialFlex:a._initialWidth!==null&&(a.width=a._initialWidth)}))}}}async split(i={}){const e=this,{client:t}=e;if(t.splitFrom)return;e.isSplit&&await e.unsplit(!0);const{rtl:r}=t,{atRecord:n,atColumn:s,direction:a}=e.processOptions(i);let{splitX:l,remainingWidth:o}=i,d=null,c=null;if(n){await t.scrollRowIntoView(n);const v=t.getRowFor(n);if(!v)throw new Error(`Could not find row for record ${n.id}`);d=L.from(v.cells[0],t.element).bottom,c=L.from(t.element).height-d}if(s&&!l&&(l=L.from(s.element,t.element).getEnd(r),o=L.from(t.element).width-l-E.scrollBarWidth,r)){const v=l;l=o+E.scrollBarWidth,o=v-E.scrollBarWidth}const u=[],h=e.createSplitContainer(i),{visibleColumns:g}=t.columns,f=s?g[g.indexOf(s)+1]:null,m=n?t.store.getNext(n):null;if(t.eachSubGrid(v=>v._initialWidth=v.width),t.columns.commit(),a!=="both"){const v={flex:`0 0 ${(d!=null?c:o)-Um}px`,height:null},[,b]=e.widgets=[new tr({appendTo:h}),e.cloneClient(h,a==="vertical"?1:0,i,v)];l!=null&&(t.renderRows(),i.atDate||(u.push(t.scrollColumnIntoView(s,LS)),f&&u.push(b.scrollColumnIntoView(f,Od)))),d!=null&&u.push(b.scrollRowIntoView(m,Od)),t.element.classList.add("b-split-start"),b.element.classList.add("b-split-end"),t.scrollable.addPartner(b.scrollable,{x:a==="horizontal",y:a!=="horizontal"})}else{const v={flex:`0 0 ${o-Um}px`};h.lastElementChild.style.flex=`0 0 ${c-Um}px`,e.widgets=[new tr({insertBefore:h.lastElementChild}),e.topSplitter=new tr({appendTo:h.firstElementChild}),e.cloneClient(h.firstElementChild,1,i,v),e.cloneClient(h.lastElementChild,0,i),e.bottomSplitter=new tr({appendTo:h.lastElementChild}),e.cloneClient(h.lastElementChild,2,i,v)];const b=t,w=e.widgets[2],D=e.widgets[3],S=e.widgets[5];b.element.classList.add("b-split-top-start"),w.element.classList.add("b-split-top-end"),D.element.classList.add("b-split-bottom-start"),S.element.classList.add("b-split-bottom-end"),l!=null&&(b.renderRows(),D.renderRows(),s&&!i.atDate&&(u.push(t.scrollColumnIntoView(s,LS)),f&&u.push(w.scrollColumnIntoView(f,Od)))),d!=null&&u.push(D.scrollRowIntoView(m,Od),S.scrollRowIntoView(m,Od)),b.scrollable.addPartner(w.scrollable,"y"),b.scrollable.addPartner(D.scrollable,"x"),w.scrollable.addPartner(S.scrollable,"x"),D.scrollable.addPartner(S.scrollable,"y"),e.topSplitter.ion({splitterMouseDown:"onSplitterMouseDown",splitterMouseEnter:"onSplitterMouseEnter",splitterMouseLeave:"onSplitterMouseLeave",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:e}),e.bottomSplitter.ion({splitterMouseDown:"onSplitterMouseDown",splitterMouseEnter:"onSplitterMouseEnter",splitterMouseLeave:"onSplitterMouseLeave",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:e})}e.subViews=[t,...e.widgets.filter(v=>v.isGridBase)],e.toggleOriginalSubGrids(i),e.syncHeaderHeights(),e._splitOptions=i,await Promise.all(u);const p=L.from(t.element);return t.onInternalResize(t.element,p.width,p.height),t.eachSubGrid(v=>{const b=L.from(v.element);v.onInternalResize(v.element,b.width,b.height)}),t.splitDirection=a,t.scrollable.x+=.5,t.scrollable.y+=.5,e.startSyncingColumns(),t.trigger("split",{subViews:e.subViews,options:i}),e.subViews}async unsplit(i=!1){var e;const t=this,{client:r,splitContainer:n}=t,{element:s}=r;if(t.isSplit&&(t.stopSyncingColumns(),delete r.splitDirection,(e=t.widgets)==null||e.forEach(a=>a.destroy()),t.widgets=null,r.eachSubGrid(a=>a.scrollable.x),r.scrollable.y,n.parentElement.appendChild(s),n.remove(),t.splitContainer=null,s.style.flexBasis=s.style.flexGrow="",s.classList.remove("b-split-top-start","b-split-start"),t.subViews.length=0,!t.isDestroying)){r.renderRows(),t.unsplitCleanup();for(const a of t.restorers)a();if(t.restorers.length=0,await Qe.animationFrame(),await Qe.animationFrame(),t.isDestroyed)return;!i&&r.trigger("unsplit"),t._splitOptions=null}}unsplitCleanup(){}populateCellMenu({record:i,column:e,items:t}){const r=this,{isSplit:n}=r,{splitFrom:s}=r.client;r.disabled||(t.splitGrid={text:"L{split}",localeClass:r,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:n||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:r,weight:100,onItem(){r.split({atRecord:i})}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:r,weight:200,onItem(){r.split({atColumn:e})}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:r,weight:300,onItem(){r.split({atColumn:e,atRecord:i})}}}},t.unsplitGrid={text:"L{unsplit}",localeClass:r,icon:"b-icon b-icon-clear",hidden:!(n||s),weight:400,separator:!0,onItem(){(s||r).unsplit()}})}startSyncingColumns(){this.detachListeners("columns");for(const i of this.subViews)i.columns.ion({name:"columns",change:"onColumnsChange",thisObj:this})}stopSyncingColumns(){this.detachListeners("columns")}onColumnsChange({source:i,isMove:e,action:t,parent:r,records:n,changes:s}){var a,l;const o=this;if(!Av(o,Zn)){Bs(o,Zn,!0);for(const d of o.subViews){const{columns:c}=d;if(i!==c){if(t==="update"&&s.region&&Object.keys(s).length===1&&!o.isLockRows){if(c.getById(n[0].id))c.remove(n[0].id);else{const[u]=n,h=(a=c.getById(o.$before.parent.id))!=null?a:c.rootNode,g=o.$before.id!==null&&c.getById(o.$before.id);h.insertChild(u.data,g)}o.$before=null}else if(!(e!=null&&e[n[0].id])&&e!==!0)if(t==="add"){const u=n.filter(h=>d.getSubGridFromColumn(h));c.add(o.cloneColumns(u))}else c.applyChangesFromStore(i);else if(t==="add"){const u=n[0],h=u.nextSibling,g=c.getById(u.id);if(!g){o.$before={id:h==null?void 0:h.id,parent:r},Bs(o,Zn,!1);continue}if(u.meta.isSelectionColumn){Bs(o,Zn,!1);continue}const f=(l=c.getById(r.id))!=null?l:c.rootNode,m=h&&c.getById(h.id);f.insertChild(g,m)}c.commit()}}i.commit(),Bs(o,Zn,!1)}}getOtherSplitter(i){return i===this.topSplitter?this.bottomSplitter:this.topSplitter}onSplitterMouseDown({source:i,event:e}){e.handled||(e.handled=!0,this.getOtherSplitter(i).onMouseDown(e))}onSplitterMouseEnter({source:i,event:e}){this.getOtherSplitter(i).element.classList.add("b-hover")}onSplitterMouseLeave({source:i,event:e}){this.getOtherSplitter(i).element.classList.remove("b-hover")}onSplitterDrag({source:i,event:e}){e.handled||(e.handled=!0,this.getOtherSplitter(i).onMouseMove(e))}onSplitterDrop({source:i,event:e}){e.handled||(e.handled=!0,this.getOtherSplitter(i).onMouseUp(e))}afterConfigChange({name:i,value:e}){this.isSplit&&this.relayProperties[i]&&this.syncSplits(t=>{t[i]=e})}afterAddListener(i,e){this.isSplit&&!e.$internal&&!PS[i]&&this.syncSplits(t=>t.on(i,e))}afterRemoveListener(i,e){e.$internal||this.syncSplits(t=>t.un(i,e))}forEachOther(i){var e;const t=this.client.splitFrom||this.client,r=O.uncapitalize(this.constructor.$name);if((e=t.features[r])!=null&&e.enabled&&!t.inForEachOther){t.inForEachOther=!0;for(const n of t.subViews)n!==this.client&&i(n);t.inForEachOther=!1}}syncSplits(i){this.forEachOther(i)}};Zn=new WeakMap,y(Gr,"$name","Split"),y(Gr,"featureClass",""),y(Gr,"configurable",{subViews:[],relayProperties:{value:{readOnly:1,rowHeight:1},$config:{merge:"merge"}}}),Gr._$name="Split",K.registerFeature(Gr,!1);var Ga=class extends Gr{static get pluginConfig(){const i={};for(const e in super.pluginConfig)i[e]=[...super.pluginConfig[e]];return i.chain.push("selectAll","deselectAll","afterRenderRow","afterPluginConfigChange"),i.override||(i.override=[]),i.override.push("isAllRecordsSelected"),i}construct(){super.construct(...arguments),this.enabled&&(this.refreshSuspended=!0,this.client.suspendRefresh())}onInternalPaint({firstPaint:i}){i&&(this.refreshSuspended&&this.client.resumeRefresh(),this.lockRows())}async lockRows(i={fieldName:this.fieldName,filterFn:this.filterFn}){var e;const t=this,{client:r}=t;if(r.splitFrom||t.disabled||t.$isLocking)return;t.$isLocking=!0,t.isSplit&&await t.unsplit(!0),i=t.processOptions(i);const{store:n,scrollable:s}=r,{fieldName:a}=i,l=`${r.id}-sticky-record-filter`,o=T.copyProperties({},r,["flex","minHeight","maxHeight","autoHeight","hideHorizontalScrollbar"]),d=t.createSplitContainer(i);let{filterFn:c}=i;o.maxHeight===0&&(o.maxHeight=null),o.height=r._lastHeight||null,t.restorers.push(()=>{r.setConfig(o),n.removeFilter(l),r.element.classList.remove("b-locked-rows"),r.store=r.store.$master,r.isLockedRows=r.originalStore=null,r.isLockedRowsView=null}),a&&!n.modelClass.fieldMap[a]&&n.modelClass.addField({name:a,type:"boolean"}),r.setConfig({height:null,flex:"0 0 auto",minHeight:0,maxHeight:i.maxHeight||"50%",autoHeight:!0,hideHorizontalScrollbar:!0,hideFooters:!0,footer:!1,bbar:null}),r.element.classList.add("b-locked-rows");const u=a?[a]:"*";c=c||(f=>f[a]);const[h]=t.widgets=[t.cloneClient(d,0,i,T.merge({flex:"1 1 0%",hideHeaders:!0,header:!1,usesLockRows:!0},t.bottomGridConfig))];h.element.classList.add("b-locked-rows-clone"),t.subViews=[h,r],r.originalStore=n,r.isLockedRows=!0,r.isLockedRowsView=h.isLockedRowsView=!0,r.store=n.chain(f=>c(f),u,{chainFilters:!0}),h.store=n.chain(f=>!c(f),u,{chainFilters:!0}),E.scrollBarWidth&&s.hasOverflowY&&(s.overflowY="scroll"),!r.scrollable.isPartneredWith(h.scrollable)&&r.scrollable.addPartner(h.scrollable,{x:!0}),h.columns.leaves.forEach(f=>{f.isRowNumberColumn&&h.refreshColumn(f)}),t._splitOptions=i;const g=L.from(r.element);return r.onInternalResize(r.element,g.width,g.height),r.eachSubGrid(f=>{const m=L.from(f.element);f.onInternalResize(f.element,m.width,m.height)}),(e=r.features.columnAutoWidth)!=null&&e.enabled&&r.features.columnAutoWidth.syncAutoWidthColumns(),r.scrollable.x+=.5,r.scrollable.y+=.5,t.startSyncingColumns(),t.$isLocking=!1,r.trigger("lockRows",{clone:h}),t.subViews}processOptions(i){const{fieldName:e}=i;if(i.direction="horizontal",!i.filterFn&&!e)throw new Error("LockRows needs `fieldName` or `filterFn`");return typeof i.filterFn=="string"&&(i.filterFn=this.resolveCallback(i.filterFn)),i}get numberOfLockedRows(){return this.isSplit?this.subViews[1].store.count:0}afterPluginConfigChange({plugin:i,applied:e,origPassedValue:t,name:r}){var n;const s=this;if(s.enabled&&((n=s.subViews)!=null&&n[0])&&i!==s&&e){const a=O.uncapitalize(i.$$name),l=s.subViews[0].features[a];l!=null&&l.enabled&&(typeof t in{string:1,boolean:1,number:1}||t instanceof Date)&&(l[r]=t)}}isAllRecordsSelected(){const i=this.isSplit&&this.subViews[0];return this.overridden.isAllRecordsSelected()&&(!i||i.isAllRecordsSelected())}selectAll(i){this.isSplit&&this.subViews[0].selectAll(i)}deselectAll(i,e){this.isSplit&&this.subViews[0].deselectAll(i,e)}afterRenderRow({row:i,recordIndex:e}){this.isSplit&&i.toggleCls("b-last",e===this.client.store.count-1)}populateCellMenu({record:i,items:e}){var t,r;const n=this,s=((t=n.client.splitFrom)==null?void 0:t.features.lockRows)||n,a=(r=s._splitOptions)==null?void 0:r.fieldName;!n.disabled&&a&&!s.filterFn&&!n.client.readOnly&&!i.isSpecialRow&&(e.toggleLocked={text:i[a]?"L{unlockRow}":"L{lockRow}",localeClass:n,icon:`b-icon ${i[a]?"b-icon-unlock-row":"b-icon-lock-row"}`,weight:500,separator:!0,closeParent:!0,onItem:()=>{i[a]=!i[a]}})}async unsplit(i=!1){const e=this,t=e.subViews[0];e.client.trigger("beforeUnlockRows",{clone:t}),await super.unsplit(i),!e.isDestroyed&&e.client.trigger("unlockRows",{clone:t})}doDisable(i){this.isConfiguring||(i?this.unsplit():this.lockRows())}};y(Ga,"$name","LockRows"),y(Ga,"configurable",{fieldName:"fixed",filterFn:null,bottomGridConfig:null}),Ga._$name="LockRows",K.registerFeature(Ga,!1);var Ya=class extends Ir{static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateHeaderMenu"),i}shouldShowMenu(i){const{column:e}=i;return e&&e.enableHeaderContextMenu!==!1&&e!==this.client.timeAxisColumn}getDataFromEvent(i){return T.assign(super.getDataFromEvent(i),this.client.getHeaderDataFromEvent(i))}populateHeaderMenu({items:i,column:e}){const t=this;if(e){if(e.headerMenuItems&&T.merge(i,e.headerMenuItems),e.isCollapsible){const{collapsed:r}=e,n=r?t.client.rtl?"left":"right":t.client.rtl?"right":"left";i.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${n}`,text:t.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>e.collapsed=!r}}if(t.moveColumns){const r=t.getColumnToMoveBefore(e),n=t.getColumnToMoveAfter(e);r&&(i.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:t.L("L{moveBefore}",O.encodeHtml(r.text)),onItem:()=>{var s;const{parent:a}=e;r.parent.insertChild(e,r)&&(e.region=r.region,(s=a.children)!=null&&s.length||a.remove())}}),n&&(i.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:t.L("L{moveAfter}",O.encodeHtml(n.text)),onItem:()=>{var s;const{parent:a}=e;n.parent.insertChild(e,n.nextSibling)&&(e.region=n.region,(s=a.children)!=null&&s.length||a.remove())}})}}return i}getColumnToMoveBefore(i){const{previousSibling:e,parent:t}=i;if(e)return e.children&&!i.children?e.children[e.children.length-1]:e;if(!t.isRoot)return t}getColumnToMoveAfter(i){const{nextSibling:e,parent:t}=i;if(e)return e;if(!t.isRoot)return t}};y(Ya,"$name","HeaderMenu"),Ya.featureClass="",Ya._$name="HeaderMenu",K.registerFeature(Ya,!0);var fF={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"},$d=class extends ie{constructor(){super(...arguments),y(this,"mergedRanges",[]),y(this,"mergedMap",{})}static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize","refresh"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const i=this,{client:e}=i;e.eachSubGrid(t=>i.setupSubGrid(t)),e.rowManager.ion({renderDone:"onRenderDone",offsetRows:"onOffsetRowsUpdated",thisObj:i}),i.bindStore(e.store)}setupSubGrid(i){i.$mergedCellsElement=E.createElement({parent:i.element,className:{"b-grid-merged-cells-container":1}}),i.ion({beforeInternalResize:"refreshBounds",thisObj:this})}doDisable(i){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(i)}updatePassthrough(i){this.client.element.classList.toggle("b-mergecells-passthrough",i)}updateSortedOnly(i){this.isConfiguring||this.reset(!0,i)}updateShouldMerge(i){this.isConfiguring||this.reset(!0,i)}bindStore(i){this.detachListeners("store"),i.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}refresh(){this.reset(!1)}beforeRenderCell(i){const e=this,{column:t,record:r,cellElement:n}=i,s=e.client.subGrids[t.region];if(!e.disabled&&t.mergeCells&&(t.isSorted||!e.sortedOnly)&&!r.isSpecialRow&&!s.collapsed){const a=e.getMergeRange(r,t);a!=null&&a.use&&(n.classList.add("b-merged-cell"),n.innerHTML="",i.cellElement=a.cellElement)}}afterRenderRow({row:i,oldId:e,oldHeight:t}){e===i.id&&t!==i.height&&(this.heightChanged=!0)}afterColumnsChange({action:i,changes:e,column:t}){if(!this.disabled){if(i==="update"&&e.mergeCells&&!t.mergeCells){for(const r of this.mergedRanges.slice())r.column===t&&this.removeRange(r);this.syncDom();return}this.refreshBounds()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:i}=this,e=i.selectedRecords.map(r=>i.store.indexOf(r));let t=!1;for(const r of this.mergedRanges){let n=!0;for(let s=r.fromIndex;s<=r.toIndex&&n;s++)n=e.includes(s);r.isSelected!==n&&(r.isSelected=n,t=!0)}t&&this.syncDom()}}getRecordFromElement(i){var e;return(e=i.elementData)!=null&&e.range?this.client.store.getAt(i.elementData.range.fromIndex):this.overridden.getRecordFromElement(i)}getColumnFromElement(i){var e;return(e=i.elementData)!=null&&e.range?i.elementData.range.column:this.overridden.getColumnFromElement(i)}populateHeaderMenu({column:i,items:e}){i.mergeable!==!1&&(e.mergeCells={text:"L{MergeCells.mergeCells}",icon:`b-fw-icon ${i.mergeCells?"b-icon-checked":"b-icon-unchecked"}`,tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>i.mergeCells=!i.mergeCells})}async handleEvent(i){var e;if(!this.passthrough){const t=i.target.closest(".b-grid-merged-cells");if(t){const{client:r}=this,{range:n}=t.elementData,{cellEdit:s}=r.features,{column:a}=n,l=O.capitalize((e=fF[i.type])!=null?e:i.type),o={grid:r,records:[],column:a,cellElement:t.firstElementChild,target:i.target,event:i};for(let d=n.fromIndex;d<=n.toIndex;d++)o.records.push(r.store.getAt(d));if(r.trigger(`mergedCell${l}`,o),(s==null?void 0:s.triggerEvent.toLowerCase())===`cell${l}`.toLowerCase()){const d=r.rowManager.getRowAt(i.clientY);await s.startEditing({id:d.id,columnId:a.id})}else i.type==="click"&&this.onRangeClick({range:n})}}}onRangeClick({range:i}){const e=[];for(let t=i.fromIndex;t<=i.toIndex;t++)e.push(this.client.store.getAt(t));this.client.selectedRecords=e}onStoreChange({action:i,removed:e,added:t}){!this.disabled&&this.reset()}onStoreRefresh({source:i,action:e}){e!=="filter"&&e!=="dataset"&&!this.disabled&&this.reset(!!i.isResourceStore)}createRangeElement(i){var e,t,r;const n=this.client.getSubGridFromColumn(i.column).$mergedCellsElement,s=`${i.fromIndex}-@-${i.column.id}`;let a=(r=(e=n.syncIdMap)==null?void 0:e[s])!=null?r:(t=n.releasedIdMap)==null?void 0:t[s];return n.releasedIdMap&&delete n.releasedIdMap[s],a||(a=E.createElement(this.createRangeDomConfig(i))),oe.addChild(n,a,s),i.element=a,i.cellElement=a.firstElementChild,a}createRangeDomConfig(i){var e;const{column:t,fromIndex:r,toIndex:n,top:s,left:a,right:l,width:o,height:d}=i,{type:c}=t,u=this.client.store.getAt(r),h={className:{"b-grid-merged-cells":1,"b-selected":i.isSelected},elementData:{range:i},style:{top:s,left:a,right:l,height:d,width:o},dataset:{syncId:`${r}-@-${t.id}`,fromIndex:r,toIndex:n,column:t.field,columnId:t.id},children:[{className:new te(this.client.cellCls).assign({[`b-${c==null?void 0:c.toLowerCase()}-cell`]:c,[t.cellCls]:t.cellCls,[t.internalCellCls]:t.internalCellCls}).assign(t.autoCls),keepChildren:!0,elementData:{range:i},dataset:{column:t.field,columnId:t.id},style:{height:this.client.rowManager.rowHeight}}]};return(e=t.mergedRenderer)==null||e.call(t,{domConfig:h,value:t.getRawValue(u),record:u,column:t,fromIndex:r,toIndex:n}),h}buildMergedCellsConfig(i,e,t){var r,n;const s=this,{client:a}=s,{rowManager:l}=a;i=i!=null?i:(r=l.topRow)==null?void 0:r.dataIndex,e=e!=null?e:(n=l.bottomRow)==null?void 0:n.dataIndex;const o=a.regions.reduce((d,c)=>(d[c]={className:{"b-grid-merged-cells-container":1},children:[]},d),{});for(const d of s.mergedRanges)d.use&&d.fromIndex<=e&&d.toIndex>=i&&(s.updateRange(d,s.heightChanged,t),o[d.column.region].children.push(s.createRangeDomConfig(d)));return o}syncDom(i=!1){const e=this,{client:t}=e,{rowManager:r}=t;if(!i&&!r.topRow||e.disabled&&!e.isDisabling)return;const n=this.buildMergedCellsConfig();t.eachSubGrid(s=>{oe.sync({targetElement:s.$mergedCellsElement,syncIdField:"syncId",domConfig:n[s.region]})}),e.heightChanged=!1}onRenderDone(){this.syncDom()}onOffsetRowsUpdated(){this.reset(!0)}removeRange(i){B.remove(this.mergedRanges,i);for(let e=i.fromIndex;e<=i.toIndex;e++)delete this.mergedMap[`${e}-@-${i.column.id}`]}reset(i=!0,e=!1){const t=this,r=t.client.columns.visibleColumns.filter(s=>s.mergeCells&&(s.isSorted||!t.sortedOnly||e),!0),n=t.mergedRanges.length;if(t.mergedRanges=[],t.mergedMap={},i&&!t.client.refreshSuspended){for(const s of t.client.rowManager.rows)for(const a of r)s.renderCell(s.getCell(a.id));t.syncDom(n&&!t.client.rowManager.rowCount)}}refreshBounds(){var i;const{mergedRanges:e}=this,t=this.client.rowManager.topRow,r=new Map,n=this.client.rtl;for(const s of e.slice()){const{column:a}=s,l=t.getCell(a.id);if(l){let{rowWidth:o,bounds:d}=(i=r.get(a))!=null?i:{};d||(o=l.parentElement.offsetWidth,d=L.from(l,l.parentElement),r.set(a,{rowWidth:o,bounds:d})),n?s.right=o-d.right:s.left=d.left,s.width=d.width}else this.removeRange(s)}this.syncDom()}updateRange(i,e,t=null){const{store:r,rowManager:n}=this.client,{topRendered:s,bottomRendered:a}=i,{rowOffsetHeight:l}=n;let{fromIndex:o,toIndex:d}=i,c,u;if(e=t?t.length>0:e,!(!e&&s&&a)){if(!s||e){if(t){const g=t.findIndex(f=>f.dataIndex>=o);c=t[g],o=c.dataIndex}else do c=n.getRowById(r.getAt(o));while(!c&&o++<d);i.topRendered=o===i.fromIndex;const h=o-i.fromIndex;i.top=c.top-h*(t?c.offsetHeight:l)}if(!a||e){if(t){const g=t.findIndex(f=>f.dataIndex===d);u=t[g===-1?t.length-1:g],o=u.dataIndex}else do u=n.getRowById(r.getAt(d));while(!u&&d-- >o);i.bottomRendered=d===i.toIndex;const h=i.toIndex-d;i.bottom=u.bottom+h*(t?u.offsetHeight:l)}i.height=i.bottom-i.top}}getMergeRange(i,e){if(i.isSpecialRow)return;const t=this,{mergedMap:r}=t,{store:n}=t.client,s=t.client.rowManager.topRow,a=e.id,l=n.indexOf(i),o=`${l}-@-${a}`,d=this.client.rtl,c=e.getRawValue(i);let u=r[o];if(!u){u=r[o]={column:e},t.mergedRanges.push(u);let h,g,f=l-1;do h=n.getAt(f),g=h&&e.getRawValue(h),r[`${f}-@-${a}`]&&(h=null),f--;while(h&&!h.isSpecialRow&&g===c);let m,p,v=l+1;do m=n.getAt(v),p=m&&e.getRawValue(m),r[`${v}-@-${a}`]&&(m=null),v++;while(m&&!m.isSpecialRow&&p===c);if(u.fromIndex=f+2,u.toIndex=v-2,t.shouldMerge&&u.toIndex-u.fromIndex>0)for(let b=u.fromIndex+1;b<=u.toIndex;b++){const w=n.getAt(b),D=n.getAt(b-1);if(t.shouldMerge({column:e,record:w,previousRecord:D,value:c})===!1){u.toIndex=b-1;break}}if(u.toIndex-u.fromIndex>0){for(let S=u.fromIndex;S<=u.toIndex;S++)r[`${S}-@-${a}`]=u;const b=s.getCell(a),w=b.parentElement.offsetWidth,D=L.from(b,b.parentElement);d?u.right=w-D.right:u.left=D.left,u.width=D.width,u.use=!0}}return u!=null&&u.use&&!u.element&&t.createRangeElement(u),u}};y($d,"$name","MergeCells"),y($d,"configurable",{passthrough:!0,sortedOnly:!0,shouldMerge:null}),$d._$name="MergeCells",K.registerFeature($d);var mF={goToNextHit:1,goToPrevHit:1,showFilterEditor:1,clearSearch:1},Hd=class extends ie{static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(i,e){super.construct(i,e),Object.assign(this,{grid:i,treeWalker:i.setupTreeWalker(i.element,E.NodeFilter.SHOW_TEXT,()=>E.NodeFilter.FILTER_ACCEPT)})}isActionAvailable({actionName:i}){if(mF[i]){const{focusedCell:e}=this.grid;return!this.disabled&&(e==null?void 0:e.record)&&!e.isActionable&&this.find.length>0}}doDisable(i){i&&this.clear(),super.doDisable(i)}get store(){return this.grid.store}showQuickFind(){const i=this,{grid:e}=i,t=e.getHeaderElement(i.columnId);if(t){if(!i.headerField){const[r,n,s]=E.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});i.mode==="header"?t.appendChild(r):(r.className+=" b-quick-hit-mode-grid",e.element.appendChild(r)),i.headerField={header:r,field:n,badge:s,colHeader:t}}i.headerField.field.innerHTML=i.find,i.headerField.badge.innerHTML=i.found.length,t.classList.add("b-quick-find-header")}(t||e.hideHeaders)&&!i.renderListenerInitialized&&(e.rowManager.ion({rendercell:i.renderCell,thisObj:i}),i.renderListenerInitialized=!0)}hideQuickFind(){var i;const e=this,{grid:t,headerField:r}=e;for(const n of e.prevFound||e.found){const s=t.getRowById(n.id);if(s){s.forceInnerHTML=!0;const a=s.getCell(e.columnId);a._content=null,s.renderCell(a),s.forceInnerHTML=!1}}r&&((i=r.header.parentNode)==null||i.removeChild(r.header),r.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(i,e=this.columnId,t=!1){var r;const n=this,{grid:s}=n,a=s.columns.getById(e)||s.columns.get(e),l=n.store.findByField(a.field,i,a.mergeCells&&a.isSorted);let o=1;Object.assign(n,{foundMap:{},prevFound:n.found,found:l,find:i,columnId:a.id,findRe:new RegExp(`(\\s+)?(${O.escapeRegExp(String(i))})(\\s+)?`,"ig")}),i?n.showQuickFind():n.hideQuickFind();for(const d of E.children(s.element,`.${n.hitCls}`))d.classList.remove(n.hitCls,n.hitCellCls),d._originalContent&&(d.innerHTML=d._originalContent,d._originalContent=null);if(l){l.length>0&&!t&&n.gotoClosestHit(s.focusedCell,l);for(const d of l){n.foundMap[d.id]=o++;const c=s.getRowById(d.data.id);if(c==null||c.renderCell(c.getCell(a.id)),o>1e3)break}(r=s.syncSplits)==null||r.call(s,d=>d.features.quickFind.search(i,e,!0)),s.trigger("quickFind",{find:i,found:l})}}clear(){var i;(this.find||(i=this.found)!=null&&i.length)&&this.search("")}get foundCount(){var i,e;return(e=(i=this.found)==null?void 0:i.length)!=null?e:0}gotoHit(i){const e=this.found[i];return e&&this.grid.focusCell({columnId:this.columnId,id:e.id},{doSelect:!0}),!!e}gotoClosestHit(i,e){const t=i?this.grid.store.indexOf(i.id):0,r=e.slice().sort((n,s)=>Math.abs(n.index-t)-Math.abs(s.index-t));this.gotoHit(e.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var i,e,t,r;const n=this;if(!((i=n.found)!=null&&i.length))return;const{grid:s}=n,a=(r=(e=s._focusedCell)==null?void 0:e.id)!=null?r:(t=s.lastFocusedCell)==null?void 0:t.id,l=s.store.indexOf(a)||0,o=n.found.find(d=>d.index>l);o?s.focusCell({columnId:n.columnId,id:o.id},{doSelect:!0}):n.gotoFirstHit()}gotoPrevHit(){var i,e,t,r;const n=this;if(!((i=n.found)!=null&&i.length))return;const{grid:s,found:a}=n,l=(r=(e=s._focusedCell)==null?void 0:e.id)!=null?r:(t=s.lastFocusedCell)==null?void 0:t.id,o=s.store.indexOf(l)||0;let d;if(a.length){for(let c=a.length-1;c--;c>=0)if(a[c].index<o){d=a[c];break}d?s.focusCell({columnId:n.columnId,id:d.id},{doSelect:!0}):n.gotoLastHit()}}renderCell({cellElement:i,column:e,record:t}){var r;const n=this,{classList:s}=i,{treeWalker:a,findRe:l,hitTextCls:o}=n,d=n.columnId===e.id&&((r=n.foundMap)==null?void 0:r[t.id]);if(d){s.add(n.hitCls),i.isQuickHit=!0,i._originalContent=i.innerHTML;const c=a.currentNode=E.down(i,".b-grid-cell-value,.b-tree-cell-value")||i;for(let u=a.nextNode();u&&c.contains(u);){const h=u,g=u.nodeValue,f=["<span>"];u=a.nextNode();let m=l.lastIndex;for(let p=l.exec(g);p;p=l.exec(g)){const v=g.substring(m,p.index),b=p[1]?"\xA0":"",w=p[2],D=p[3]?"\xA0":"";f.push(`${O.encodeHtml(v)}${b}<span class="${o}">${w}</span>${D}`),m=l.lastIndex}f.push(O.encodeHtml(g.substring(m)),"</span>"),h.parentNode.insertBefore(E.createElementFromTemplate(f.join(""),{fragment:!0}),h),h.remove()}E.createElement({parent:i,className:n.hitCellBadgeCls,text:d})}}onBackspace(i){const e=this;return e.find?(e.find=e.find.substr(0,e.find.length-1),e.search(e.find),!0):!1}clearSearch(){return this.find?(this.find="",this.search(this.find),!0):!1}showFilterEditor(){const i=this,{filter:e}=i.client.features;e&&i.columnId&&i.foundCount&&(i.clear(),e.showFilterEditor(i.client.columns.getById(i.columnId),i.find))}onElementKeyPress(i){var e;const t=this,{grid:r}=t,{focusedCell:n}=r;if(!i.handled&&!t.disabled&&(n!=null&&n.record)&&!n.isActionable&&((e=i.key)==null?void 0:e.length)===1){const s=r.columns.getById(r._focusedCell.columnId);s&&s.searchable!==!1&&(t.columnId=r._focusedCell.columnId,t.find+=i.key,t.search(t.find))}}onCellNavigate(i,e,t){const r=this;r.find&&(!t||t.columnId!==r.columnId)&&r.clear()}};y(Hd,"$name","QuickFind"),y(Hd,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}}),Hd._$name="QuickFind",K.registerFeature(Hd);var qa=class extends ie{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}updateShowSplitterButtons(i){this.client.element.classList.toggle("b-hide-splitter-buttons",!i)}onElementDblClick(i){const e=this,{client:t}=e,r=i.target.closest(".b-grid-splitter-collapsed");if(r&&!e.expanding){e.expanding=!0;let n=r.dataset.region,s=t.getSubGrid(n);s.collapsed||(n=t.getLastRegions()[1],s=t.getSubGrid(n)),s.expand().then(()=>e.expanding=!1)}}startMove(i,e){const t=this,{clientX:r}=e,{client:n}=t,s=i.dataset.region,a=n.element,l=n.regions[n.regions.indexOf(s)+1],o=n.getSubGrid(l),d=n.getSubGrid(s);if(i.classList.contains("b-grid-splitter-collapsed"))return;let c=d,u=1;c.flex!=null&&o.flex==null&&(c=o,u=-1),n.rtl&&(u*=-1);const h=Object.values(n.subGrids).reduce((g,f)=>f.width+g,0);n.trigger("splitterDragStart",{subGrid:c,domEvent:e}),t.dragContext={element:i,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:d,originalWidth:c.element.offsetWidth,originalX:r,minWidth:c.minWidth||0,maxWidth:Math.min(h,c.maxWidth||h),flip:u},a.classList.add("b-moving-splitter"),d.toggleSplitterCls("b-moving"),t.pointerDetacher=V.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:t})}endMove(i){const e=this,{dragContext:t,client:r}=e;if(t){const{subGrid:n}=t;i.preventDefault(),e.pointerDetacher(),r.element.classList.remove("b-moving-splitter"),t.splitterSubGrid.toggleSplitterCls("b-moving",!1),e.dragContext=null,r.trigger("splitterDragEnd",{subGrid:n,domEvent:i})}}onCollapseClick(i,e,t){const r=this,{client:n}=r,s=e.dataset.region,a=n.getLastRegions();if(n.trigger("splitterCollapseClick",{subGrid:i,domEvent:t})!==!1){if(a[0]===s){const l=n.getSubGrid(a[1]);if(l.collapsed){l.expand(r.animateCollapseExpand);return}}i.collapse(r.animateCollapseExpand)}}onExpandClick(i,e,t){const r=this,{client:n}=r,s=e.dataset.region,a=n.getLastRegions();if(n.trigger("splitterExpandClick",{subGrid:i,domEvent:t})!==!1){if(a[0]===s&&!i.collapsed){n.getSubGrid(a[1]).collapse(r.animateCollapseExpand);return}i.expand(r.animateCollapseExpand)}}updateMove(i){const{dragContext:e}=this;if(e){const t=i-e.originalX,r=Math.max(Math.min(e.maxWidth,e.originalWidth+t*e.flip),0);e.subGrid.width=Math.max(r,e.minWidth)}}onElementPointerDown(i){var e;const t=this,{target:r}=i,n=i.button===0&&r.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),s=n&&t.client.getSubGrid(n.dataset.region);let a;n&&(r.closest(".b-grid-splitter-button-collapse")?t.onCollapseClick(s,n,i):r.closest(".b-grid-splitter-button-expand")?t.onExpandClick(s,n,i):t.enableDragging&&(t.startMove(n,i),a=n)),(i.pointerType==="touch"||(e=t.touchedSplitter)!=null&&e.classList.contains("b-touching"))&&t.toggleTouchSplitter(a)}onPointerMove(i){this.dragContext&&(this.updateMove(i.clientX),i.preventDefault())}onElementTouchMove(i){this.dragContext&&i.preventDefault()}onPointerUp(i){this.enableDragging&&this.endMove(i)}onSubGridCollapse({subGrid:i}){const e=this.client.resolveSplitter(i);this.client.getLastRegions()[1]===i.region&&e.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:i}){this.client.resolveSplitter(i).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(i){const e=this,{touchedSplitter:t}=e;i&&t&&i.dataset.region!==t.dataset.region&&e.toggleTouchSplitter();const r=e.client.getSubGrid(i?i.dataset.region:t==null?void 0:t.dataset.region);r&&(r.toggleSplitterCls("b-touching",!!i),i?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),e.touchedSplitter=i}render(){const{regions:i,subGrids:e}=this.client;if(i.length===2){const t=e[i[0]];t.maxWidth&&t.width>=t.maxWidth&&t.splitterElement.classList.add("b-left-only")}else i.length>2&&(e[i[0]].splitterElement.classList.add("b-left-only"),e[i[1]].splitterElement.classList.add("b-right-only"))}updateEnableDragging(i){this.client.element.classList.toggle("b-grid-splitter-no-drag",!i)}};y(qa,"$name","RegionResize"),y(qa,"configurable",{showSplitterButtons:!0,animateCollapseExpand:!0,enableDragging:!0}),qa.featureClass="b-split",qa._$name="RegionResize",K.registerFeature(qa);var OS=i=>i instanceof KeyboardEvent||(i==null?void 0:i.type)==="keydown"&&(i==null?void 0:i.target),Li=class extends Ha{constructor(){super(...arguments),y(this,"entityName","row")}static get pluginConfig(){return{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}}construct(i,e){super.construct(i,e),i.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=i}onBeforeRenderRow({row:i,record:e}){var t;i.cls["b-cut-row"]=this.isCut&&((t=this.cutData)==null?void 0:t.includes(e))}isActionAvailable({actionName:i,event:e}){var t;if(!super.isActionAvailable(...arguments))return!1;const{grid:r}=this,{target:n}=e;return(i==="cut"||i==="paste")&&r.isLockedRows?!1:(i==="paste"||((t=r.selectedRecords)==null?void 0:t.length)>0)&&(!n||!!n.closest(".b-grid-body-container"))}async copy(i){await this.copyRows(!1,i)}async cut(i){await this.copyRows(!0,i)}paste(i){return OS(i)&&(i=this.client.getRecordFromElement(i.target)),this.pasteRows(i!=null&&i.isModel?i:null)}async copyRows(i=!1,e){var t,r;const n=this,{client:s,entityName:a}=n,{selectionMode:l}=s;n.cutOnly&&(i=!0);let o=n.selectedRecords.filter(c=>!c.readOnly||!i);if(e){let c=e;OS(e)&&(c=(r=(t=s.resolveRowRecord)==null?void 0:t.call(s,e.target))!=null?r:s.getRecordFromElement(e.target)),l.multiSelect&&l.cell&&!s.features.cellCopyPaste||s.isSelected(c)||(o=[c])}const d=await n.writeToClipboard(o,i);d!==void 0&&(s.trigger("copy",{records:d.data,originalRecords:o,isCut:i,entityName:a}),n.monitorCellCopyPaste())}setIsCut(i,e){var t;(t=this.grid.rowManager.getRowById(i))==null||t.toggleCls("b-cut-row",e),i.meta.isCut=e}handleCutData({source:i}){var e;i!==this&&((e=this.cutData)!=null&&e.length)&&this.grid.store.remove(this.cutData)}monitorCellCopyPaste(){const i=this,{cellCopyPaste:e}=i.client.features;e&&!i._cellCopyPasteListener&&(i._cellCopyPasteListener=i.client.ion({beforePaste({entityName:t,text:r,targetCell:n}){if(t===e.entityName&&i.compareClipboardText(i.clipboardText,r))return i.paste(n.record),!1},thisObj:i}))}stringConverter(i){const{rowManager:e}=this.grid,{columnTypesToIgnore:t}=this,r=i.flatMap(n=>{var s;return(s=e.getRowById(n))==null?void 0:s.cells.map(a=>new Se(a))});return this.cellsToString(r.filter(n=>{var s;return n&&!t.includes((s=n.column)==null?void 0:s.type)}))}cloneData({data:i,isPaste:e}){return i!=null&&i.length&&!this.cutOnly&&(this.sortByIndex(i),i=this.extractParents([...i],{},e)),i}async beforeCopy({data:i,isCut:e}){return await this.client.trigger("beforeCopy",{records:i,isCut:e,entityName:this.entityName})}async pasteRows(i){var e,t,r;const n=this,{client:s,entityName:a}=n,l=i||s.selectedRecord,{tree:o}=s.store;if(s.readOnly||s.isTreeGrouped)return[];const d=await n.readFromClipboard({referenceRecord:l},!0),c=d==null?void 0:d.isCut;let u=d==null?void 0:d.data;if(!d||!Array.isArray(u)||!(u!=null&&u.length)||o&&c&&u.some(h=>h.contains(l,!0)))return[];if(c&&o&&(u=n.extractParents(u,{})),await n.insertCopiedRecords(u,l),!s.isDestroying)return c?await n.clearClipboard():s.selectedRecords=u,s.trigger("paste",{records:u,originalRecords:d.originalData,referenceRecord:l,isCut:c,entityName:a}),n.clipboard.triggerPaste(n),(r=(t=(e=s.getRowFor(u[u.length-1]))==null?void 0:e.cells)==null?void 0:t[0])==null||r.focus(),u}async beforePaste({referenceRecord:i,data:e,originalData:t,text:r,isCut:n}){const s=e!==r?e:[];return await this.client.trigger("beforePaste",{records:s,referenceRecord:i,isCut:n,entityName:this.entityName,data:e,originalRecords:t})}stringParser(i){return this.setFromStringData(i,!0).modifiedRecords}insertCopiedRecords(i,e){const t=this.client.store.$master,r=e?t.indexOf(e)+1:t.count;return t.isTree?((e==null?void 0:e.parent)||t.rootNode).insertChild(i,e==null?void 0:e.nextSibling,!1,{orderedBeforeNode:e==null?void 0:e.nextOrderedSibling}):t.insert(r,i)}get selectedRecords(){const i=[...this.client.selectedRecords];return this.client.selectedCells.forEach(e=>{i.includes(e.record)||i.push(e.record)}),i}getMenuItemText(i,e=!1){const t=this;let r=t[i+"RecordText"];return e&&(r+=` (${t.selectedRecords.length>1?t.rowSpecifierTextPlural:t.rowSpecifierText})`),r}populateCellMenu({record:i,items:e,cellSelector:t}){var r;const n=this,{client:s,rowOptionsOnCellContextMenu:a}=n,l=((r=s.features.cellCopyPaste)==null?void 0:r.enabled)===!0,o=l&&s.isCellSelected(t);!s.isTreeGrouped&&(i==null?void 0:i.isSpecialRow)===!1&&(l?s.selectedRows.length:s.selectedRecords.length)&&(!o||n.rowOptionsOnCellContextMenu)&&(n.copyOnly||(e.cut={text:n.getMenuItemText("cut",o&&a),localeClass:n,icon:"b-icon b-icon-cut",weight:135,disabled:i.readOnly||s.isLockedRows||s.readOnly,onItem:()=>n.cut(i)},e.paste={text:n.getMenuItemText("paste",o&&a),localeClass:n,icon:"b-icon b-icon-paste",weight:140,onItem:()=>n.paste(i),disabled:s.readOnly||n.hasClipboardData()===!1||s.isLockedRows}),n.cutOnly||(e.copy={text:n.getMenuItemText("copy",o&&a),localeClass:n,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>n.copy(i)}))}sortByIndex(i){const{store:e}=this.client;return i.sort((t,r)=>{const n=t.indexPath,s=r.indexPath;if(!i.includes(t.parent)&&!i.includes(r.parent))return e.indexOf(t)-e.indexOf(r);if(n.length===s.length){for(let a=0;a<n.length;a++){if(n[a]<s[a])return-1;if(n[a]>s[a])return 1}return 0}else return n.length-s.length})}extractParents(i,e,t=!0){const r=this,{store:n}=r.client;n.tree&&i.forEach(a=>{a.traverse(l=>{const o=l.getTopParent(!0);!i.includes(l)&&(!r.isCut||!i.some(d=>o.includes(d)))&&i.push(l)})});const s=i.reduce((a,l)=>{let o;const d=l.parentId||l.meta.modified;return r.isCut?(o=l,o.meta.isCut=!1):(o=l.copy(),t&&(o[r.nameField]=r.generateNewName(o,l)),o.data.expanded=l.isExpanded(r.client.store)),e[l.id]=o,l.parent===n.rootNode?a.push(o):d in e?e[d].appendChild(o,!0):a.push(o),a},[]);return s.forEach(a=>{a.sortOrderedChildren(!0,!0)}),s}};y(Li,"$name","RowCopyPaste"),y(Li,"type","rowCopyPaste"),y(Li,"configurable",{nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1,cutOnly:null,allowedDataSources:["RowCopyPaste"],columnTypesToIgnore:["rownumber","sequenceNumber"]}),Li.featureClass="b-row-copypaste",Li._$name="RowCopyPaste",K.registerFeature(Li,!0,"Grid"),K.registerFeature(Li,!1,"Gantt"),K.registerFeature(Li,!1,"SchedulerPro"),K.registerFeature(Li,!1,"ResourceHistogram");var Vd=class extends Na{bindStore(i){this.detachListeners("store"),i.ion({name:"store",update:"onStoreUpdate",remove:"onStoreRemove",thisObj:this})}changeTitleField(i){typeof i=="string"&&(this.titleRenderer=e=>this.L("L{Object.editing}",O.encodeHtml(e[i])))}getEditingContext(i){if(i=i.target?new Se(i.target):this.grid.normalizeCellContext(i),!i.record.isSpecialRow)return i}async startEditing(i={id:this.grid.firstVisibleRow.id},e){var t,r,n;if(this.isEditing){if(this.cancelEditing(!0)===!1)return!1;(r=(t=this.editorContext)==null?void 0:t.row)==null||r.removeCls("b-editing")}if(i=this.editorContext=this.getEditingContext(i),i){const s=this,{grid:a}=s,l=s.editor||(s.editor=s._editorConfig)&&s.editor,{cancel:o}=l.bbar.widgetMap;if(i.editor=l,l.title=s.callback(s.titleRenderer,s,[i.record]),l.record=i.record,l.rowEditorContext=i,l.readOnly=a.readOnly||l.record.readOnly,o&&(o.text=s.L(l.readOnly?"L{close}":"L{cancel}")),a.trigger("beforeStartRowEdit",{grid:a,editorContext:i})===!1)return!1;s.revertButton&&(l.bbar.widgetMap.revert.hidden=!s.editorContext.record.isModified),await l.collapsible.toggleReveal(!0);const d=l.widgetMap[(n=i.column)==null?void 0:n.field],c=d&&(e||s.focusContextualField)?d:l;e&&!l.readOnly&&(d==null||d.clear()),c.focus(),i.row.addCls("b-editing"),a.trigger("startRowEdit",{grid:a,editorContext:i})}}onEditorStart(){this.triggerEvent!=="cellclick"&&(this.detachListeners("cellClickWhileEditing"),this.grid.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:this}))}syncEditingReadOnly({readOnly:i}){if(this.isEditing){const{editor:e}=this,{record:t}=this.editorContext,{cancel:r}=e.bbar.widgetMap;e.readOnly=i||t.readOnly,r&&(r.text=this.L(e.readOnly?"L{close}":"L{cancel}"))}}onEditorHide(){var i,e;(e=(i=this.editorContext)==null?void 0:i.row)==null||e.removeCls("b-editing"),this.detachListeners("cellClickWhileEditing"),this.editorContext=this.editor.record=null}async finishEditing(){var i;const e=this,{grid:t,editor:r,editorContext:n}=this;if(r.isValid){let s=t.trigger("beforeFinishRowEdit",n);return T.isPromise(s)&&(e.finishEditingPromise=s,s=await s,e.finishEditingPromise=null),s===!1?(r.focus(),!1):(r.collapsible.toggleReveal(!1),e.updateRecordFromFields(),t.trigger("finishRowEdit",n),!0)}else return(i=r.items.find(s=>!s.isValid))==null||i.focus(),!1}cancelEditing(i=!1){const e=this,{editor:t}=e;if(e.grid.trigger("beforeCancelRowEdit",e.editorContext)===!1)return t.focus(),!1;i!==!0&&(e.instantUpdate&&(e.isCanceling=!0,t.setValues(t.initialValues),e.updateRecordFromFields(),e.isCanceling=!1),t.collapsible.toggleReveal(!1))}async onElementClick(i){i.target.matches(".b-grid-body-container, .b-grid-subgrid")&&this.editorContext&&await this.finishEditing(i)}async onElementKeyDown(i){const e=this,{grid:t}=e,{focusedCell:r}=t;i.handled||!e.autoEdit||e.isEditing||!r||r.isActionable&&E.isEditable(i.target)||i.ctrlKey||i.key.length<=1&&e.startEditing(r,!0)}updateSide(){this.editor=null}changeEditor(i,e){if(i){const t=this,{grid:r,labelWidth:n}=t,s=Xe.mergeConfigs({owner:r,cls:{"b-editor-instant-update":t.instantUpdate},drawer:{side:t.side,size:t.editorSize},autoUpdateRecord:t.instantUpdate,items:t.collectEditorFields(),style:{[n?"--b-label-width":""]:E.setLength(n)},refreshEdit:t.refreshEdit.bind(t)},i);t._editorConfig||(t._editorConfig=i),t.local&&(s.appendTo=r.element),t.revertButton&&(s.bbar.items.revert={text:"L{revert}",onClick:t.revertChanges.bind(t)}),i=Xe.reconfigure(e,i?s:null,t),i==null||i.ion({thisObj:t,show:"onEditorStart",hide:"onEditorHide"})}else e==null||e.removeAll(),e==null||e.destroy();return i}revertChanges(){const i=this,{editor:e,record:t}=i.editorContext;i.isCanceling=!0,t.revertChanges(),e.title=i.callback(i.titleRenderer,i,[t]),e.setValues(t,{onlyName:e.strictRecordMapping,highlight:!!e.$highlight}),i.isCanceling}refreshEdit(){const{editor:i}=this;i.isVisible&&(this.syncEditingReadOnly({readOnly:this.grid.readOnly}),!this.instantUpdate&&!this.isCanceling&&i.setValues(this.editorContext.record,{onlyName:i.strictRecordMapping,highlight:!!i.$highlight}))}updateRecordFromFields(){const{editor:i}=this,{record:e}=i;i.items.forEach(t=>{const r=t.getValueName({onlyName:i.strictRecordMapping});r&&r in e&&e.setValue(r,t.value)},!0)}updateInstantUpdate(i){const{_editor:e}=this;e&&(e.autoUpdateRecord=i,e.element.classList.toggle("b-editor-instant-update",!!i))}collectEditorFields(){let i=0;return this.grid.columns.reduce((e,t)=>{const{editor:r}=t,{modelClass:n}=this.grid.store;return r!=null&&r.isField&&(r.readOnly=t.readOnly,i=r.weight||(r.weight=i+100),r.label||(r.label=t.text||n.getFieldDefinition(t.field).label),r.revertOnEscape=t.revertOnEscape,e[t.field]=r),e},{})}};y(Vd,"$name","RowEdit"),y(Vd,"configurable",{editor:{$config:"lazy",value:{type:"panel",cls:{"b-row-editor":1},drawer:{type:"overlay",autoClose:!1,tool:null},keyMap:{Escape:"up.cancelEditing",Enter(i){if(i.target.matches("button"))return!1;this.callback("up.finishEditing")}},bbar:{items:{save:{text:"L{save}",cls:{"b-raised":1},color:"b-blue",onClick:"up.finishEditing"},cancel:{text:"L{cancel}",onClick:"up.cancelEditing"}}},focus(){(this.isValid?this.focusableElement:this.items.find(e=>!e.isValid).focusableElement).focus({preventScroll:!0})}}},focusContextualField:!0,instantUpdate:null,editorSize:null,labelWidth:null,local:null,revertButton:null,side:{$config:"lazy",value:"end"},keyMap:{Enter:"startEditing",F2:"startEditing"},titleField:"name",titleRenderer:null}),Vd._$name="RowEdit",K.registerFeature(Vd);var pF={onTab:1,onShiftTab:1},vF={remove:1,filter:1,dataset:1,replace:1},Ka=class extends ie.mixin(fe){static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",shadowRootContainerClass:"b-rowexpander-shadowroot-container",recordStateMap:new Map,collapsingStateMap:new Map}}static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore","navigateUp"],override:["onGridBodyFocusIn","navigateDown","catchFocus","keyMapOnKeyDown"],assign:["expandRow","collapseRow"]}}afterConstruct(){const i=this,{client:e}=i;if(!i.renderer&&!i.widget){i.disabled=!0,console.warn("RowExpander requires either a widget config or implementing the renderer function.");return}e.isGanttBase&&e.fixedRowHeight!==!1&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to `false`."),i.widget&&le.ion({theme:i.onThemeChange,thisObj:i}),i.bindStore(e.store),i.triggerEvent&&e.ion({[i.triggerEvent]:"onTriggerEvent",thisObj:i}),i.addColumn()}bindStore(i){const e=this;e.recordStateMap.clear(),e.collapsingStateMap.clear(),e.detachListeners("clientStoreChange"),i.ion({name:"clientStoreChange",change:e.onStoreChange,thisObj:e})}doDisable(i){const{client:e}=this;i&&(this.recordStateMap.clear(),this.collapsingStateMap.clear()),e.isConfiguring||e.rowManager.renderFromRow(),super.doDisable(i)}changeLoadingIndicatorText(i){return i&&this.L(i)}onGridBodyFocusIn(i){var e,t;const r=this;(r.hasWidget?!i.target.matches(`.${r.expanderBodyClass}, .${r.shadowRootContainerClass}`):!((t=(e=r.client.lastMousedownEvent)==null?void 0:e.target)!=null&&t.closest("."+r.expanderBodyClass)))&&r.overridden.onGridBodyFocusIn(i)}keyMapOnKeyDown({target:i}){var e;(!this.hasWidget||!((e=i.classList)!=null&&e.contains(this.shadowRootContainerClass)))&&this.overridden.keyMapOnKeyDown(...arguments)}get isAnimating(){return this.client.isAnimating}set isAnimating(i){const{client:e}=this,t=e.isAnimating;e.isAnimating=i,e.isAnimating!==t&&e.element.classList.toggle("b-rowexpander-animating")}changeWidget(i){return i&&this.isWidgetConfig(i)?{[this.client.regions[0]]:i}:i}afterColumnsChange(){this.addColumn()}changeColumn(i){const e=this,{client:t}=e;if(i==null)return i;let r=e.columnPosition==="first"?"left":"right";return t.isRTL&&(r=e.columnPosition==="first"?"right":"left"),T.assign({type:"action",draggable:!1,resizable:!1,showColumnPicker:!1,ariaLabel:e.L("L{RowExpander.columnDescription}"),actions:[{cls:`b-icon b-icon-collapse-${r}`,tooltip:({record:n})=>e.L(e.recordStateMap.has(n)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:n})=>e.toggleExpand(n)}],width:40,hideable:!1,align:"center",region:t.regions[0],field:"expanderActionColumn"},i)}addColumn(){const i=this,{column:e}=i,{columns:t}=i.client;!i._isAddingExpanderColumn&&e&&(!i._expander||!t.includes(i._expander))&&(i._isAddingExpanderColumn=!0,i.columnPosition==="last"?([i._expander]=t.add(e),i.client.fillLastColumn=!1):[i._expander]=t.insert(0,e),i._isAddingExpanderColumn=!1)}onTriggerEvent({target:i}){this.disabled||i!=null&&i.closest(".b-action-cell")||!i.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(i))}toggleExpand(i){i&&(this.recordStateMap.has(i)?this.collapse(i):this.expand(i))}onExpanderBodyResize(i){var e;for(const t of i){const r=this.client.store.getById((e=t.target.dataset)==null?void 0:e.id),n=r&&this.recordStateMap.get(r);if(n&&!n.ignoreResize&&!n.isAnimating){const s=n.expanderBodyHeight;n.expanderBodyHeight=null,this.processRowHeight(r,0)!==s&&this.renderRowsWithAnimation(r)}}}get shouldSpanRegions(){return this.spanRegions&&this.client.regions.length>1}onStoreChange({action:i,source:e,records:t,changes:r}){var n,s;const a=this,{recordStateMap:l,collapsingStateMap:o}=a,d=r&&Object.keys(r);if(!((d==null?void 0:d.length)===1&&((n=e.modelClass.fieldMap[d[0]])==null?void 0:n.type)==="store")&&!a.disabled){if(i==="removeAll")l.clear(),o.clear();else if(vF[i])for(const[c,u]of l)e.includes(c)||(a.destroyWidgets(u),l.delete(c),o.delete(c));else if(a.refreshOnRecordChange&&(t!=null&&t.length)&&i==="update"){const c=(s=le.currentPointerDown)==null?void 0:s.target,u=[];let h=!1;t.forEach(g=>{const f=l.get(g);f!=null&&f.isCreated&&(f.isCreated=!1,!h&&c&&a.client.regions.some(m=>{var p,v,b,w,D;return((v=(p=f.expandedBodyElements)==null?void 0:p[m])==null?void 0:v.contains(c))||((D=(w=(b=f.widgets)==null?void 0:b[m])==null?void 0:w.element)==null?void 0:D.contains(c))})&&(h=!0),u.push(g))}),u!=null&&u.length&&(h?a.client.delayUntilMouseUp(()=>{u.forEach(g=>a.bufferedRenderer(g))}):a.client.rowManager.renderFromRecord(u[0]))}}}processRowHeight(i,e){var t,r;const n=this,{shouldSpanRegions:s}=n;let a=n.recordStateMap.get(i),l=!1;if(a&&!a.expanderBodyHeight)for(const o of n.client.regions){const d=(t=a.expandedBodyElements[o])==null?void 0:t.offsetHeight;d>a.expanderBodyHeight&&(a.expanderBodyHeight=d,l=!0)}else!a&&(a=n.collapsingStateMap.get(i))&&a.expanderBodyHeight&&(a.expanderBodyHeight=0,l=!0);return l&&n.enableAnimations&&s&&n.animateSpannedExpander(a),((r=a==null?void 0:a.expanderBodyHeight)!=null?r:0)+e}animateSpannedExpander(i){const e=this,t=i.expandedBodyElements[e.client.regions[0]],r=e.client.rowManager.getRowById(i.record).element;i.isAnimating=e.isAnimating=!0,i.ignoreResize=!0,t.style.height=r.offsetHeight-i.cellHeight+"px",t.offsetHeight,t.style.height=i.expanderBodyHeight+"px",e.waitForTransition(t,()=>{t.style.height="",i.expanderBodyHeight||t.remove(),i.isAnimating=e.isAnimating=!1})}beforeRenderRow({row:i,record:e}){const t=this,{regions:r}=t.client,{expandedRowClass:n,collapsingStateMap:s,shouldSpanRegions:a}=t,l=t.recordStateMap.get(e);if(i.cls.toggle("b-rowexpander-disabled",t.disabled),i.cls[n]){let o=s.get(e);if(o){const d=()=>{o=s.get(e),o&&(s.delete(e),t.removeExpander(i),t.destroyWidgets(o))};t.enableAnimations&&t.isAnimating?t.waitForTransition(i,d):d()}else l||t.removeExpander(i)}else s.delete(e);!t.disabled&&l&&(l.isCreated||(l.ignoreResize=!0,t.renderExpander(e,i,l)),i.cls.add(n),r.forEach((o,d)=>{const c=i.getElement(o);if(l.isCreated&&(!a||d===0)){const u=l.expandedBodyElements[o],h=a?t.client.verticalScroller:c;u.parentElement!==h&&(a||E.removeEachSelector(c,"."+t.expanderBodyClass),h.appendChild(u),t.observeResize(u)),a&&(u.style.top=i.top+l.cellHeight+"px",i._spannedExpandedBodyElement=u),l.ignoreResize=!1,l.renderPromiseResolver&&!l.isRenderingAsync&&(t.delay(l.renderPromiseResolver),l.renderPromiseResolver=null)}t.lockCellHeight(c,l.cellHeight,!1)}),t._shouldScrollIntoView&&t.autoScroll&&(t._shouldScrollIntoView=!1,E.isInView(l.expandedBodyElements[r[0]],!0)||t.client.rowManager.ion({once:!0,thisObj:t,renderDone:()=>t.scrollRowIntoView(i,e)})))}scrollRowIntoView(i,e){this.isAnimating?this.waitForTransition(i,()=>this.client.scrollRowIntoView(e)):this.client.scrollRowIntoView(e)}waitForTransition(i,e){var t;const r=E.isElement(i)?i:i.element;V.onTransitionEnd({element:r,property:"height",handler:e,thisObj:this,duration:(t=E.getPropertyTransitionDuration(r,"height"))!=null?t:1})}removeExpander(i){var e,t;const r=this;i.cls.remove(r.expandedRowClass);for(const n of r.client.regions){const s=i.getElement(n);for(const a of s.querySelectorAll("."+r.expanderBodyClass))r.unobserveResize(a),a.remove();s.classList.remove(r.expandedRowClass),r.lockCellHeight(s,null,!1),r.shouldSpanRegions&&((t=(e=i._spannedExpandedBodyElement)==null?void 0:e.remove)==null||t.call(e),i._spannedExpandedBodyElement=null)}}destroyWidgets(i){var e,t,r;for(const n of this.client.regions)(r=(t=(e=i.widgets)==null?void 0:e[n])==null?void 0:t.destroy)==null||r.call(t)}isWidgetConfig(i){return i.type&&!i.tag}renderExpander(i,e,t){var r,n;const s=this,{client:a,widget:l,shouldSpanRegions:o}=s,d=(r=e.cells[0])==null?void 0:r.offsetHeight,{expandedBodyElements:c={}}=t,u=[],h=(f,m,p)=>{if(f!=null)if(typeof f=="string"){const v=[...m.childNodes].map(b=>m.removeChild(b));m.innerHTML=f,v.reverse().forEach(b=>m.insertBefore(b,m.firstChild))}else s.isWidgetConfig(f)?g(f,m,p):(f=E.createElement(f),m.appendChild(f))},g=(f,m,p)=>{if(!m.attachShadow){console.warn("Rendering a Widget in the RowExpander requires access to the Shadow DOM. If your app lives in a sandboxed environment with restrictions on Shadow DOM manipulation, this is not supported. If you use SalesForce LWC, consider enabling Lightning Web Security.");return}const v=E.createElement({parent:m,className:s.shadowRootContainerClass,style:"flex : 1"}),b=v._shadowRoot=v.attachShadow({mode:"closed"});u.push(E.cloneStylesIntoShadowRoot(b).then(()=>{var w,D;const S=(w=E.getThemeInfo())==null?void 0:w.name;if(a.isDestroyed)return;const x=(D=f.dataField)!=null?D:s.dataField;if(x){const R=i.getValue(x);if(R!=null&&R.isStore)f.store=R;else if(a.store[`${x}Store`]){const M=a.store[`${x}Store`];f.store=M.chain(_=>i.getValue(x).includes(_))}else f.store={data:R,internalListeners:{change:()=>!e.isDestroyed&&e.render(),thisObj:s}}}if(S){const{cls:R}=f,M=`b-theme-${S.toLowerCase()}`;f.cls=R?R+" "+M:M}t.widgets||(t.widgets={}),t.widgets[p]=m.widget=z.create(T.assign({appendTo:b,owner:a,flex:1,minHeight:"5em",isNested:!0,expandedRecord:i},f))}).catch(w=>{throw new Error("Could not load stylesheet "+w)}))};if(!t.isRenderingAsync){e.addCls(s.expandedRowClass),Object.assign(t,{cellHeight:d,expandedBodyElements:c,expanderBodyHeight:0,loadingIndicators:[]});for(const[f,m]of a.regions.entries()){if(o&&f>0)break;const p=e.getElement(m);let v=c[m],b;v?(s.unobserveResize(v),v.innerHTML=""):v=E.createElement({parent:o?a.verticalScroller:p,tabIndex:-1,className:s.expanderBodyClass,style:{top:o?e.top+d:d+"px"},dataset:{id:i.id}}),s.observeResize(v),l!=null&&l[m]?g(l[m],v,m):b=(n=s.renderer)==null?void 0:n.call(s,{record:i,expanderElement:v,rowElement:p,region:m,grid:a}),Z.isPromise(b)?u.push(b.then(w=>h(w,v,m))):h(b,v,m),c[m]=v}u.length&&(t.isRenderingAsync=!0,s.showLoadingIndicators(t),Promise.all(u).then(()=>{Promise.all(u).then(()=>{var f,m;if(!a.isDestroyed){(f=t.loadingIndicators)==null||f.forEach(p=>p.remove()),t.loadingIndicators.length=0,t.ignoreResize=!1,t.isRenderingAsync=!1;for(const[,p]of s.recordStateMap)if(p.isRenderingAsync)return;(m=s.renderRowsWithAnimation)==null||m.call(s,i,!0)}})})),t.isCreated=!0}}showLoadingIndicators(i){for(const e in i.expandedBodyElements)i.loadingIndicators.push(E.createElement({parent:i.expandedBodyElements[e],className:"b-rowexpander-loading",style:{height:this.loadingIndicatorHeight+"px"},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]}))}renderRowsWithAnimation(i){const e=this;if(e.enableAnimations){const t=e.client.rowManager.getRowById(i);t&&(e.isAnimating=!0,e.collapsingStateMap.has(i)&&t.addCls("b-row-is-collapsing"),e.waitForTransition(t,()=>{var r;e.isAnimating=!1,t.isDestroyed||(r=t.removeCls)==null||r.call(t,"b-row-is-collapsing")}))}return e.bufferedRenderer(i)}bufferedRenderer(i){var e;return((e=this._bufferedRecords)!=null?e:this._bufferedRecords=[]).push(i),this._rafPromise||(this._rafPromise=new Promise(t=>{requestAnimationFrame(()=>{var r;(r=this.internalRender)==null||r.call(this,t),this._rafPromise=null})})),this._rafPromise}internalRender(i){const e=this,{_bufferedRecords:t}=e,{store:r}=e.client;e.recordStateMap.forEach((s,a)=>{s.renderPromiseResolver&&s.isCreated&&!t.includes(a)&&t.push(a)});const[n]=t.sort((s,a)=>r.indexOf(s)-r.indexOf(a));e.client.rowManager.renderFromRecord(n),t.length=0,e.delay(i)}lockCellHeight(i,e,t){for(let r=0;r<i.children.length;r++){const n=i.children[r];n.classList.contains(this.expanderBodyClass)||(n.style.height=t?"":e+"px")}}async expandRow(...i){return this.expand(...i)}async collapseRow(...i){return this.collapse(...i)}async expand(i,e=!1){const t=this,{client:r}=t;if(t.disabled||t.recordStateMap.has(i)||await t.trigger("beforeExpand",{record:i})===!1||await r.trigger("beforeRowExpand",{record:i})===!1)return;let n;return new Promise(s=>{var a;n={isCreated:!1,renderPromiseResolver:s,record:i},t.recordStateMap.set(i,n),t.collapsingStateMap.delete(i),t._shouldScrollIntoView=!0,t.renderRowsWithAnimation(i),e||(a=r.syncSplits)==null||a.call(r,l=>l.features.rowExpander.expand(i,!0))}).then(()=>{var s,a,l,o;(a=t.trigger)==null||a.call(t,"expand",{record:i,expandedElements:n.expandedBodyElements,widget:(s=n.widgets)==null?void 0:s[t.client.regions[0]],widgets:n.widgets}),(o=r.trigger)==null||o.call(r,"rowExpand",{record:i,expandedElements:n.expandedBodyElements,widget:(l=n.widgets)==null?void 0:l[t.client.regions[0]],widgets:n.widgets})})}async collapse(i,e=!1){var t;const r=this,{client:n}=r,s=r.recordStateMap.get(i);if(!(r.disabled||await r.trigger("beforeCollapse",{record:i})===!1||await n.trigger("beforeRowCollapse",{record:i})===!1)){if(s!=null&&s.expandedBodyElements)for(const a in s.expandedBodyElements)r.unobserveResize(s.expandedBodyElements[a]);r.recordStateMap.delete(i),r.collapsingStateMap.set(i,s),await r.renderRowsWithAnimation(i),r.trigger("collapse",{record:i}),n.trigger("rowCollapse",{record:i}),e||(t=n.syncSplits)==null||t.call(n,a=>a.features.rowExpander.collapse(i,!0))}}async refreshRow(i){const e=this.recordStateMap.get(i);if(e!=null&&e.isCreated)return e.isCreated=!1,this.bufferedRenderer(i)}get hasWidget(){return!!this.widget||[...this.recordStateMap.values()].some(i=>i.widgets)}navigateDown(){if(!this.onKeyboardIn())return this.overridden.navigateDown(...arguments)}navigateUp(){this.onKeyboardIn(!0)}catchFocus({navigationDirection:i,source:e,editing:t}){var r;const{client:n}=this,{focusedCell:s,regions:a}=n;for(let[l,o]of this.recordStateMap.entries())for(const d in o.expandedBodyElements)if(o.expandedBodyElements[d].widget===e){if(t){const h=a[a.indexOf(d)+(i==="down"?1:-1)];if(h)return this.startEditInWidget((r=o.widgets)==null?void 0:r[h],i==="down")}i==="down"&&(l=n.store.getNext(l,void 0,!0));let c;!t&&s&&!s._isDefaultFocus?c=s.column:c=this.getNavigateableColumn(n,!0,t&&i==="up"),n._focusedCell=null;const u=n.normalizeCellContext({record:l,column:c});return n.focusCell(u),t&&n.startEditing(u),!0}}onKeyboardIn(i){var e,t,r;const{focusedCell:n}=this.client,s=n&&this.recordStateMap.get(n.record),a=(r=(t=s==null?void 0:s.expandedBodyElements)==null?void 0:t[(e=n==null?void 0:n.column)==null?void 0:e.region])==null?void 0:r.widget;if(a!=null&&a.isGrid){let l;return a.focusedCell&&!a.focusedCell._isDefaultFocus?l=a.focusedCell.column:l=this.getNavigateableColumn(a),a._focusedCell=null,a.focusCell(a.normalizeCellContext({record:a[`${i?"last":"first"}VisibleRow`],column:l})),!0}return!1}getNavigateableColumn(i,e=!0,t=!1){var r;const n=t?[...i.columns.visibleColumns].reverse():i.columns.visibleColumns;return(r=n.find(s=>{var a;return s!==i.checkboxSelectionColumn&&s!==((a=i.features.rowExpander)==null?void 0:a._expander)&&(!e||s.editor)}))!=null?r:n[0]}isActionAvailable({actionName:i}){var e;if(pF[i])return!this.isDisabled&&((e=this.client.features.cellEdit)==null?void 0:e.isEditing)}onTab(i){var e;const{client:t}=this,{cellEdit:r}=t.features;if(r!=null&&r.enabled){const{columns:n,regions:s}=t,{activeRecord:a}=r,l=i!==!0,o=r.getAdjacentEditableCell(t.focusedCell,l),d=l?a:o?t.store.getById(o.id):null,c=d&&((e=this.recordStateMap.get(d))==null?void 0:e.widgets);if(c&&(a==null?void 0:a.id)!==(o==null?void 0:o.id)){let u=(o?n.getById(o.columnId):n.visibleColumns[0]).region;for(;u;){const h=c[u];if(this.startEditInWidget(h,l))return!0;u=s[s.indexOf(u)+(l?1:-1)]}}}return!1}startEditInWidget(i,e=!0){var t,r;const{cellEdit:n}=this.client.features;if(n!=null&&n.enabled&&((r=(t=i==null?void 0:i.features)==null?void 0:t.cellEdit)!=null&&r.enabled))return n.finishEditing().then(()=>{const s=i[`${e?"first":"last"}VisibleRow`],a=this.getNavigateableColumn(i,!0,!e);i.startEditing(i.normalizeCellContext({record:s,column:a}))}),!0}onShiftTab(){return this.onTab(!0)}observeResize(i){const e=this;e.resizeObserver||(e.resizeObserver=new ResizeObserver(t=>e.onExpanderBodyResize(t))),e.resizeObserver.observe(i)}unobserveResize(i){var e;(e=this.resizeObserver)==null||e.unobserve(i)}doDestroy(){var i;(i=this.resizeObserver)==null||i.disconnect(),delete this.resizeObserver;for(const[,e]of this.recordStateMap)this.destroyWidgets(e);super.doDestroy()}onThemeChange({prev:i,theme:e}){for(const[,t]of this.recordStateMap)Object.values(t.expandedBodyElements).forEach(r=>{var n,s,a,l;const o=r.querySelector("."+this.shadowRootContainerClass);o!=null&&o._shadowRoot&&(E.cloneStylesIntoShadowRoot(o==null?void 0:o._shadowRoot,!0),(s=(n=r.widget)==null?void 0:n.element)==null||s.classList.remove(`b-theme-${i}`),(l=(a=r.widget)==null?void 0:a.element)==null||l.classList.add(`b-theme-${e}`))})}getExpandedRecord(i){var e;for(const[t,{widgets:r,expandedBodyElements:n}]of this.recordStateMap.entries())if(r&&i.isWidget){for(const s in r)if(r[s]===i)return t;if((e=i.expandedRecord)!=null&&e.isModel)return i.expandedRecord}else for(const s in n){const a=n[s];if(a===i||a.contains(i))return t}return null}getExpandedWidgets(i){var e;return(e=this.recordStateMap.get(i))==null?void 0:e.widgets}};y(Ka,"$name","RowExpander"),y(Ka,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0,widget:null,dataField:null,keyMap:{Tab:{handler:"onTab",weight:50},"Shift+Tab":{handler:"onShiftTab",weight:50}},autoScroll:!1,spanRegions:!1,callOnFunctions:!0}),y(Ka,"deprecatedEvents",{beforeExpand:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `beforeExpand` was replaced by the `beforeRowExpand` event on the Grid itself"},expand:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `expand` was replaced by the `rowExpand` event on the Grid itself"},beforeCollapse:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `beforeCollapse` was replaced by the `beforeRowCollapse` event on the Grid itself"},collapse:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `collapse` was replaced by the `rowCollapse` event on the Grid itself"}}),Ka._$name="RowExpander",K.registerFeature(Ka);var Jn=class extends fe(ie){construct(i,e){this.grid=i,i.isGanttBase&&!("dropOnLeaf"in e)&&(e.dropOnLeaf=!0),super.construct(...arguments)}doDestroy(){var i;(i=this.dragHelper)==null||i.destroy(),super.doDestroy()}init(){const i=this,{grid:e,allowCrossGridDrag:t}=i;i.dragHelper=si.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!t,allowDropOutside:!0,outerElement:i.targetSubGridElement,touchStartDelay:i.touchStartDelay,isElementDraggable:i.isElementDraggable.bind(i),dragWithin:t?e.floatRoot:e.bodyContainer,scrollManager:e.scrollManager,positioning:"inset",monitoringConfig:{scrollables:[{element:e.scrollable.element,direction:"vertical"}]},setXY(r,n,s){const{context:a}=this;if(!a.started){const o=L.from(a.element,this.dragWithin),d=a.startPageY-globalThis.pageYOffset-a.element.getBoundingClientRect().top;this._elementHeight=o.height,s=o.top+d+this.proxyTopOffset,this._startScrollY=e.scrollable.y}const l=t?s:Math.min(e.scrollable.element.scrollHeight-this._elementHeight-1,s+e.scrollable.y-this._startScrollY);E.setTopInsetInlineStart(r,l,n)},ignoreSamePositionDrop:!1,createProxy(r){const n=document.createElement("div"),s=document.createElement("i");if(n.classList.add("b-row-reorder-proxy"),s.className="b-row-proxy-copy "+i.copyIconCls,n.appendChild(s),e.selectedRecords.slice().sort((a,l)=>e.store.indexOf(a)-e.store.indexOf(l)).forEach(a=>{var l,o;const d=(o=(l=e.rowManager.getRowFor(a))==null?void 0:l.elements[e.regions[0]])==null?void 0:o.cloneNode(!0);d&&(d.style.transform=d.style.insetInlineStart=d.style.top="",d.style.width=r.offsetWidth+"px",d.removeAttribute("id"),n.appendChild(d))}),e.selectedRecords.length>1){const a=document.createElement("div");a.classList.add("b-badge","b-row-drag-count-indicator"),a.dataset.badge=e.selectedRecords.length,n.appendChild(a)}return E.removeClsGlobally(n,"b-selected","b-hover","b-focused"),n},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onAbort",reset:"onReset",prio:1e4,thisObj:i}},i.dragHelperConfig),e.relayEvents(i.dragHelper,["beforeDragStart","dragStart","drag"],"gridRow",!0),i.dropIndicator=E.createElement({className:"b-row-drop-indicator"}),i.dropOverTargetCls=["b-row-reordering-target","b-hover"]}static get pluginConfig(){return{chain:["beforeRenderCell","onInternalPaint"]}}get targetSubGridElement(){const i=this.grid.regions[0];return this.grid.subGrids[i].element}beforeRenderCell({cellElement:i,column:e,record:t,cellCls:r}){const{grid:n}=this;r["b-row-reorder-grip"]=this.showGrip&&this.enabled&&!t.isSpecialRow&&e===n.columns.visibleColumns[0]}isElementDraggable(i,e){var t;if(!((t=this.client.features.rowResize)==null?void 0:t.isEventOverResizeHandle(e))&&!i.closest(".b-grid-cell .b-widget"))if(this.gripOnly){const n=i.closest(".b-grid-cell:first-child");if(n){const s=getComputedStyle(n,":before"),a=this.grid.rtl?n.getBoundingClientRect().width-e.borderOffsetX:e.borderOffsetX,l=a<=parseFloat(s.width);return l&&(this.client.preventDragSelect=!0),l}}else return!0}onBeforeDragStart({event:i,source:e,context:t}){const r=this,{grid:n}=r,s=r.targetSubGridElement,a=t.startRecord=n.getRecordFromElement(t.element);if(i.target.classList.contains("b-rowexpander-shadowroot-container")||r.disabled||n.readOnly||n.isTreeGrouped&&a.isParent||!s.contains(t.element)||a.readOnly||a.isSpecialRow)return!1;t.originalRowTop=n.rowManager.getRowFor(a).top,n.selectionMode.checkboxOnly||(e.startEvent.pointerType==="touch"?n.isSelected(a)||n.selectRow({record:a,addToSelection:!1}):!n.isSelected(a)&&!i.shiftKey&&!i.ctrlKey&&n.selectRow({record:a}));const l=n.selectedRecords.filter(o=>!o.readOnly);return t.records=[a],l.includes(a)&&(t.records.push(...l.filter(o=>o!==a)),t.records.sort((o,d)=>n.store.indexOf(o)-n.store.indexOf(d))),!0}onDragStart({context:i}){var e,t;const r=this,{grid:n}=r,{cellEdit:s,cellMenu:a,headerMenu:l}=n.features;r.targetGrid=n,s&&(r.cellEditDisabledState=s.disabled,s.disabled=!0),(e=a==null?void 0:a.hideContextMenu)==null||e.call(a,!1),(t=l==null?void 0:l.hideContextMenu)==null||t.call(l,!1);const o=i.element.querySelector(".b-focused");o==null||o.classList.remove("b-focused"),i.element.firstElementChild.classList.remove("b-selected","b-hover")}resolveGrid(i,e){let{target:t}=i;if(/^touch/.test(i.type)){const r=L.from(e.element,null,!0).center;t=E.elementFromPoint(r.x,r.y)}return this.client.constructor.fromElement(t,r=>r.isGridBase)}onDrag({context:i,event:e}){var t;const r=this,{clientY:n}=e;let s=r.grid;if(r.allowCrossGridDrag&&(s=r.resolveGrid(e,i),r.targetGrid=s,!s)){i.valid=!1;return}const{store:a,rowManager:l}=s;let o=!0,d=l.getRowAt(n),c,u,h,g,f;if(d){const m=d.top+s.scrollable.element.getBoundingClientRect().top-s.scrollable.y,p=d.height/4,v=m+p,b=m+d.height/2,w=m+p*3;u=d.dataIndex,c=a.storage.getAt(u),a.isTree?g=(c.isParent||r.dropOnLeaf)&&n>v&&n<w:a.isGrouped&&(g=c.isGroupHeader&&c.meta.collapsed),h=!g&&e.clientY>=b}else e.pageY<s._bodyRectangle.y?(u=0,c=a.first,h=!1):(u=a.count-1,c=a.last,h=!0),d=l.getRow(u);if(c===r.overRecord&&r.after===h&&r.over===g){i.valid=!0;return}r.overRecord!==c&&((t=l.getRowById(r.overRecord))==null||t.removeCls(r.dropOverTargetCls)),r.overRecord=c,r.after=h,r.over=g,(r.targetGrid.readOnly||c===i.startRecord||!h&&!g&&u===0&&a.isGrouped||h&&c&&c.isGroupHeader&&c.meta.collapsed&&a.indexOf(c)===a.count-1)&&(o=!1),a.isTree?c?(f=h?c.nextSibling:c,i.records.some(m=>m.contains(c))&&(o=!1),i.parent=o&&g?c:c.parent,r.clearTimeout(r.hoverTimer),c&&c.isParent&&!c.isExpanded(a)&&(r.hoverTimer=r.setTimeout(()=>s.expand(c),r.hoverExpandTimeout))):i.parent=s.store.rootNode:f=h?a.storage.getAt(u+1):c,d?(E.setTranslateY(r.dropIndicator,Math.max(d.top+(h?d.element.getBoundingClientRect().height:0),1)),d==null||d.toggleCls(r.dropOverTargetCls,o&&g)):s.store.count===0&&E.setTranslateY(r.dropIndicator,0),!g&&u===a.indexOf(i.startRecord)+(h?-1:1)&&i.parent&&i.startRecord.parent===i.parent&&(o=!1),r.dropIndicator.style.visibility=g?"hidden":"visible",r.dropIndicator.classList.toggle("b-drag-invalid",!o),i.insertBefore=f,i.valid=r.reorderValid=o}async onDrop(i){const e=this,{grid:t,targetGrid:r}=e,{context:n}=i,{ctrlKeyDown:s}=le;n.valid=n.valid&&e.reorderValid,i.source=t,n.valid&&(n.async=!0,r.store.isTree&&(n.oldPositionContext=n.records.map(a=>{var l;return{record:a,parentId:(l=a.parent)==null?void 0:l.id,parentIndex:a.parentIndex}})),await t.trigger("gridRowBeforeDropFinalize",i)===!1&&(n.valid=!1),e.animateDrop&&await e.dragHelper.animateProxyTo(e.dropIndicator,{align:"l0-l0"}),await e.finalizeReorder(n,s)),e.clearTimeout(e.hoverTimer),t.trigger("gridRowDrop",i),e.overRecord=e.after=e.over=e.targetGrid=null}onAbort(i){i.source=this.client,this.client.trigger("gridRowDragAbort",i),this.targetGrid=null}async finalizeReorder(i,e){var t,r,n;const s=this,{client:a,allowCrossGridDrag:l}=s,o=i.targetGrid||a,{store:d,focusedCell:c}=o,{parent:u}=i,h=d===a.store,g=c==null?void 0:c.record,f=((t=g==null?void 0:g.proxyMeta)==null?void 0:t.originalRecord)||g;let{records:m,insertBefore:p}=i;if(!l&&i.valid&&(i.valid=!m.some(v=>!d.includes(v))),i.valid){const v=s.preserveSorters&&d.isSorted&&d.sorterFn;let b;if(e&&(m=m.map(D=>D.copy())),v&&m.sort(v),!h&&s.allowCrossGridDrag.transferData)await s.allowCrossGridDrag.transferData({sourceGrid:a,targetGrid:o,records:m,insertBefore:p,parent:u}),o.focusCell({grid:o,record:m[0]});else if(d.isTree)m=m.filter(D=>!D.parent||D.bubbleWhile(S=>!m.includes(S),!0)),o.isTreeGrouped?u!==g.parent?u.bubble(D=>{m.forEach(S=>{S[D.field]=D.key})}):i.valid=!1:b=await u.tryInsertChild(m,s.over?(r=u.children)==null?void 0:r[0]:p),o.rowManager.forEach(D=>D.removeCls(s.dropOverTargetCls)),!u.isExpanded(d)&&((n=u.children)!=null&&n.length)&&o.expand(u),i.valid=b!==!1;else if(d.isGrouped&&s.over)e?d.insert(d.indexOf(p),m):d.move(m,d.getNext(p));else{if(m.length>1)for(;p&&m.includes(p);)p=d.getNext(p,!1,!0);h?e?d.insert(d.indexOf(p),m):d.move(m,p):(e||a.store.remove(m),d.insert(p?d.indexOf(p):d.count,m))}(c==null?void 0:c._rowIndex)>=0&&o===a&&(o._focusedCell=null,o.focusCell({grid:a,record:f,columnId:c.columnId}));let w=!0;if(i.valid&&v){const D=m[0],S=m[m.length-1],x=D.previousSibling,R=S.nextSibling;(!x||v(x,D)<=0)&&(!R||v(S,R)<=0)&&(w=!1)}i.valid&&w&&d.clearSorters()}i.finalize(i.valid),o.element.classList.remove("b-row-reordering")}onReset(){const i=this,{targetGrid:e,grid:t}=i,r=t.features.cellEdit;t.element.classList.remove("b-row-reordering"),r&&(r.disabled=i.cellEditDisabledState),E.removeClsGlobally(t.element,...i.dropOverTargetCls),t.scrollManager.stopMonitoring(),e&&t!==e&&(e.element.classList.remove("b-row-reordering"),e.scrollManager.stopMonitoring(),E.removeClsGlobally(e.element,...i.dropOverTargetCls))}onInternalPaint({firstPaint:i}){!this._initialized&&this.grid.regions.length>0&&(this._initialized=!0,this.init())}updateShowGrip(i){this.enabled&&this.grid.columns.visibleColumns[0].refreshCells()}updateDisabled(i,e){super.updateDisabled(i,e),this.dragHelper&&(this.dragHelper.disabled=i),this.showGrip&&this.grid.columns.visibleColumns[0].refreshCells()}updateTargetGrid(i,e){e&&(e.element.classList.remove("b-row-reordering"),e.scrollManager.stopMonitoring()),this.dragHelper.isDragging&&(this.dragHelper.context.targetGrid=i),i?(i.element.classList.add("b-row-reordering"),i.bodyContainer.appendChild(this.dropIndicator),i.scrollManager.startMonitoring({scrollables:[{element:i.scrollable.element,direction:"vertical"}]})):this.dropIndicator.remove()}get isDragging(){return this.dragHelper.isDragging}};y(Jn,"$name","RowReorder"),y(Jn,"configurable",{showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:null,copyIconCls:"b-icon b-icon-add",allowCrossGridDrag:!1,dragHelperConfig:null,preserveSorters:null,animateDrop:!0,targetGrid:null}),Jn.featureClass="",Jn._$name="RowReorder",K.registerFeature(Jn,!1);var Xa=class extends ie{construct(i,e){const t=this;super.construct(...arguments),t.resizer=new Fn({name:"rowResize",targetSelector:".b-grid-row:not(.b-group-header)",handleContainerSelector:".b-grid-row",outerElement:i.element,direction:"vertical",dragThreshold:1,handleSize:Math.min(5,i.rowHeight*.1),internalListeners:{beforeresizestart:t.onBeforeResizeStart,resizestart:t.onResizeStart,resizing:t.onResizing,resize:t.onResize,cancel:t.onCancel,thisObj:t},allowResize(r,n){var s;return(s=i.hoveredCell)==null?void 0:s.matches(t.cellSelector)},overTopHandle(r,n){if(this.canResize(n,r)&&n.dataset.index!=="0"){const s=L.from(n);return s.height=this.handleSize,s.height>0&&Math.abs(s.top-V.getPagePoint(r).top)<this.handleSize}return!1},internalBeforeStart(r){const{edge:n,element:s}=r;if(n==="top")return{edge:"bottom",element:s.previousElementSibling}},onResizeHandlePointerDown(r){i.selectionDisabled=!0,i.features.rowReorder&&(t._oldReorderDisabled=i.features.rowReorder.dragHelper.disabled,i.features.rowReorder.dragHelper.disabled=!0),i.setTimeout(()=>{i.selectionDisabled=!1},10)}})}doDestroy(){var i;(i=this.resizer)==null||i.destroy(),super.doDestroy()}onBeforeResizeStart(){return!this.disabled}onResizeStart({source:i,context:e}){const{client:t}=this,r=this.applyToAllRows||t.fixedRowHeight;e.record=t.store.getById(e.element.dataset.id),e.oldHeight=e.record.rowHeight,t.store.suspendAutoCommit(),Object.assign(i,{minHeight:this.minHeight,maxHeight:this.maxHeight,skipUpdatingElement:!r}),t.element.classList.add("b-row-resizing")}onResizing({context:i}){!this.applyToAllRows&&!this.client.fixedRowHeight&&i.valid&&(i.record.rowHeight=i.newHeight)}onResize({context:i}){const{client:e}=this;this.applyToAllRows||e.fixedRowHeight?e.rowHeight=i.newHeight:e.selectionMode.multiSelect&&e.selectedRecords.includes(i.record)&&e.selectedRecords.forEach(t=>t.rowHeight=i.newHeight),this.cleanup()}onCancel({context:i}){!this.applyToAllRows&&!this.client.fixedRowHeight&&(i.record.rowHeight=i.oldHeight),this.cleanup()}cleanup(){const{client:i}=this;i.element.classList.remove("b-row-resizing"),i.store.resumeAutoCommit(),typeof this._oldReorderDisabled=="boolean"&&(i.features.rowReorder.dragHelper.disabled=this._oldReorderDisabled)}isEventOverResizeHandle(i){return this.enabled&&this.resizer.checkResizeHandles(i)}};y(Xa,"$name","RowResize"),y(Xa,"configurable",{applyToAllRows:null,cellSelector:".b-grid-cell",minHeight:20,maxHeight:0}),Xa._$name="RowResize",K.registerFeature(Xa,!1);var yF={goToNextHit:1,goToPrevHit:1},Za=class extends fe(ie){static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(i,e){super.construct(i,e),Object.assign(this,{grid:i,text:"",hitEls:[],treeWalker:i.setupTreeWalker(i.element,E.NodeFilter.SHOW_TEXT,()=>E.NodeFilter.FILTER_ACCEPT)}),i.ion({expandNode:"onTreeNodeExpand",thisObj:this})}isActionAvailable({actionName:i}){if(yF[i])return!!this.text}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0,void 0,void 0,!1])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(i){i&&this.clear(),super.doDisable(i)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(i,e=!0,t=!1,r,n=!1,s=this.client.store.isTree){var a;const l=this;if(!i)return l.clear();if(!t&&i===l.text||l.disabled)return;const{grid:o,store:d}=l,c=o.columns.visibleColumns.filter(f=>f.searchable!==!1),u=[];r=r||c.map(f=>{var m;return u.push((m=f.formatValue)==null?void 0:m.bind(f)),f.field});const h=d.search(i,r,u);s&&h.length&&await o.expandTo(h.map(f=>f.id));for(const f of c)if(f.mergeCells&&f.isSorted){let m=null,p=null;for(const v of h)if(v.field===f.field){const b=v.data[v.field];b===m&&(v.belongsTo=p),m=b,p=`${v.field}-${v.id}`}}let g=1;if(Object.assign(l,{foundMap:{},prevFound:l.found,found:h,text:i,findRe:new RegExp(`(\\s+)?(${O.escapeRegExp(String(i))})(\\s+)?`,"ig")}),l.clearHits(),!!h){for(const f of h)if(l.foundMap[`${f.field}-${f.id}`]=f.belongsTo?l.foundMap[f.belongsTo]:g++,g>l.limit)break;return l.listenersInitialized||(o.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:l}),d.ion({name:"storeRefresh",[`refresh${o.asyncEventSuffix}`]:"onStoreRefresh",thisObj:l}),l.listenersInitialized=!0),o.refreshRows(),o.trigger("search",{grid:o,find:i,found:h}),e&&!l.isHitFocused&&!n&&l.gotoNextHit(!0),(a=o.syncSplits)==null||a.call(o,f=>f.features.search.search(i,e,t,r,!0)),h}}clearHits(){if(!this.isDestroying)for(const i of E.children(this.grid.element,"."+this.hitCls)){i.classList.remove(this.hitCls,this.hitCellCls);const e=Oe.get(i).row;e&&(e.forceInnerHTML=!0,e.renderCell(i),e.forceInnerHTML=!1)}}clear(i=!1){var e;const t=this,{grid:r}=t;t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(t.detachListeners("renderCell"),t.detachListeners("storeRefresh"),t.listenersInitialized=!1),i||(r.trigger("clearSearch",{grid:r}),(e=r.syncSplits)==null||e.call(r,n=>n.features.search.clear()))}get foundCount(){var i,e;return(e=(i=this.found)==null?void 0:i.length)!=null?e:0}get isHitFocused(){var i;const e=this,{grid:t}=e,{focusedCell:r}=t;if((i=r==null?void 0:r.cell)!=null&&i.contains(E.getActiveElement(t.element))){const{rowIndex:n,column:s}=r;return n!==-1&&e.found.some(a=>a.index===n&&s&&a.field===s.field)}}gotoNextHit(i=!1){var e;const t=this;if(!((e=t.found)!=null&&e.length))return;const{grid:r,store:n}=t,s=r.focusedCell||r.lastFocusedCell,a=s&&i!==!0?n.indexOf(s.record,void 0,!0):-1,l=t.found.findIndex(o=>o.index>a);l!==-1&&t.gotoHit(l)}gotoPrevHit(){var i;const e=this,{store:t}=e;if(!((i=e.found)!=null&&i.length))return;const{grid:r,found:n}=e,s=r.focusedCell||r.lastFocusedCell,a=s?t.indexOf(s.record,void 0,!0):0;for(let l=n.length-1;l--;l>=0)if(n[l].index<a){e.gotoHit(l);break}}gotoHit(i){const{grid:e}=this,t=this.found[i];return t&&e.focusCell({field:t.field,id:t.id}),!!t}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:i,column:e,record:t,value:r}){var n,s;const a=this,{treeWalker:l,findRe:o,hitTextCls:d,showHitIndex:c}=a,u=(n=a.foundMap)==null?void 0:n[e.field+"-"+t.id];if(u){i.classList.add(a.hitCls),c&&((s=i.querySelector(`.${a.hitCellBadgeCls}`))==null||s.remove());const h=E.down(i,".b-grid-cell-value,.b-tree-cell-value")||i;if(String(r).toLowerCase()===String(a.text).toLowerCase())h.innerHTML=`<span class="${a.hitTextCls}">${h.innerHTML}</span>${c?`<div class="${a.hitCellBadgeCls}">${u}</div>`:""}`;else{l.currentNode=h;for(let g=l.nextNode();g&&h.contains(g);){const f=g,m=g.nodeValue,p=["<span>"];g=l.nextNode();let v=o.lastIndex;for(let b=o.exec(m);b;b=o.exec(m)){const w=m.substring(v,b.index),D=b[1]?"\xA0":"",S=b[2],x=b[3]?"\xA0":"";p.push(`${O.encodeHtml(w)}${D}<span class="${d}">${O.encodeHtml(S)}</span>${x}`),v=o.lastIndex}p.push(O.encodeHtml(m.substring(v)),"<span>"),f.parentNode.insertBefore(E.createElementFromTemplate(p.join(""),{fragment:!0}),f),f.remove()}c&&E.createElement({parent:i,className:a.hitCellBadgeCls,text:u})}a.hitEls.push(i)}}populateCellMenu({column:i,record:e,items:t,cellElement:r}){const n=this;i.searchable&&(t.search={text:"L{searchForValue}",localeClass:n,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:n.disabled,onItem:()=>{let s=globalThis.getSelection().toString();s||(s=r.innerText),n.search(s)}})}onStoreRefresh(){this.search(this.text,!1,!0)}};y(Za,"$name","Search"),y(Za,"configurable",{limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}),Za.featureClass="b-search",Za._$name="Search",K.registerFeature(Za);var bF=Object.freeze([]),Ja=class extends ie{static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon","b-widget"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(i,e){e=this.processConfig(e),super.construct(i,e),this.bindStore(this.store)}processConfig(i){return typeof i=="string"||Array.isArray(i)?{field:i,ascending:null}:i}setConfig(i){super.setConfig(this.processConfig(i))}bindStore(i){this.detachListeners("store"),i.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this}),this.client.isPainted&&this.syncHeaderSortState()}set field(i){var e;const t=this.client.columns.get(i);t&&typeof t.sortable=="object"&&(t.sortable.field=t.sortable.property||i,i=t.sortable),(e=this.store.sorters)!=null&&e.some(r=>r.field===i)||this.store.sort(i,this.ascending)}get store(){return this.client[this.client.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onInternalPaint","bindStore"]}}syncHeaderSortState(){var i,e;const t=this,{client:r}=t;if(!r.hideHeaders&&r.isPainted){const n=(i=t.store.sorters)!=null?i:bF,s=n.length,a=new te;let l;for(const o of r.columns.visibleColumns){if(!o.sortable)continue;const d=o.element,c=o.textWrapper,u=c==null?void 0:c.dataset;let h="none";u!=null&&u.sortIndex&&delete u.sortIndex,a.value=d.classList,o.sortable===!1?(a.remove(t.sortableCls),(e=c==null?void 0:c.querySelector(".b-sort-icon"))==null||e.remove()):(c!=null&&c.querySelector(".b-sort-icon")||E.createElement({tag:"i",parent:c,className:"b-icon b-sort-icon"}),a.add(t.sortableCls),l=n.find(g=>g.field===o.field||g.sortFn&&g.sortFn===o.sortable.sortFn),l?(s>1&&u&&(u.sortIndex=n.indexOf(l)+1),a.add(t.sortedCls),l.ascending?(a.add(t.sortedAscCls),a.remove(t.sortedDescCls),h="ascending"):(a.add(t.sortedDescCls),a.remove(t.sortedAscCls),h="descending")):(a.remove(t.sortedCls),a["b-group"]||(a.remove(t.sortedAscCls),a.remove(t.sortedDescCls)))),E.syncClassList(d,a),E.setAttributes(d,{"aria-sort":h})}}}updateShowIconOnColumnHover(i){this.client.element.classList.toggle("b-sort-hover-icon",!!i)}populateHeaderMenu({column:i,items:e}){var t;const r=this,{store:n}=r,s={...i.sortable,field:i.field,columnOwned:!0},a=(t=n.groupers)==null?void 0:t.find(l=>l.field===i.field);if(i.sortable!==!1&&(e.sortAsc={text:"L{sortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:a||r.disabled,onItem:()=>n.sort(s,!0)},e.sortDesc={text:"L{sortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:a||r.disabled,onItem:()=>n.sort(s,!1)},r.multiSort&&r.client.columns.records.some(l=>l.sortable))){const l=n.sorters.find(o=>o.field===i.field||i.sortable.sortFn&&i.sortable.sortFn===o.sortFn);e.multiSort={text:"L{multiSort}",localeClass:r,icon:"b-fw-icon b-icon-sort",weight:320,disabled:a||r.disabled,menu:{addSortAsc:{text:l?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",disabled:l&&(l==null?void 0:l.ascending),weight:330,onItem:()=>n.addSorter(s,!0)},addSortDesc:{text:l?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",disabled:l&&!l.ascending,weight:340,onItem:()=>n.addSorter(s,!1)},removeSorter:{text:"L{removeSorter}",localeClass:r,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!l,onItem:()=>{n.removeSorter(s.field)}}}}}}getColumnDragToolbarItems(i,e){const t=this,{store:r,disabled:n}=t;if(i.sortable!==!1){const s=r.sorters.find(a=>a.field===i.field);e.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:t,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:n,onDrop:({column:a})=>r.sort(a.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:t,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:n,onDrop:({column:a})=>r.sort(a.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:n||s&&s.ascending,weight:105,onDrop:({column:a})=>r.addSorter(a.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:n||s&&!s.ascending,weight:105,onDrop:({column:a})=>r.addSorter(a.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:t,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:n||!s,onDrop:({column:a})=>r.removeSorter(a.field)})}return e}onStoreBeforeSort({sorters:i}){var e;const{columns:t}=this.client;for(let r=0;r<i.length;r++){const n=i[r],s=(n.columnOwned||this.prioritizeColumns)&&t.get(n.field);(e=s==null?void 0:s.sortable)!=null&&e.sortFn&&(i[r]={...n,...s.sortable,columnOwned:!0})}}onElementClick(i){const e=this,{store:t}=e,{target:r}=i,n=r.closest(".b-grid-header.b-sortable"),s=n==null?void 0:n.dataset.column;if(!(e.ignoreRe.test(r.className)||r.closest(".b-grid-headerwidget")||e.disabled||i.handled)&&n&&s&&(e.toggleOnHeaderClick||r.closest(".b-sort-icon"))){const a=e.client.columns.getById(n.dataset.columnId);if(t.isGrouped&&t.groupers.find(o=>o.field===s)&&!i.shiftKey)return;if(a.sortable&&!i.shiftKey)if(i.ctrlKey&&i.altKey)t.removeSorter(a.field);else{const o={columnOwned:!0,field:a.field};typeof a.sortable=="object"&&T.assign(o,a.sortable),t.sort(o,null,i.ctrlKey&&e.multiSort)}}}renderHeader(){this.syncHeaderSortState()}onInternalPaint(){this.syncHeaderSortState()}};y(Ja,"$name","Sort"),y(Ja,"configurable",{multiSort:!0,prioritizeColumns:!1,showIconOnColumnHover:!0,toggleOnHeaderClick:!0}),Ja.featureClass="b-sort",Ja._$name="Sort",K.registerFeature(Ja,!0);var Eh=class extends ie{static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(i,e){super.construct(i,e),i.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,E.createElement({reference:"element",parent:i.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const i=this,{client:e,element:t,contentElement:r}=i,n=L.client(e.bodyContainer).roundPx(),s=e.rowManager.getRowAt(n.y),a=s!==i.currentTopRow;if(s){a&&(i.currentTopRow&&(i.currentTopRow.removeCls(i.currentTopRowCls),i.currentTopRow.removeCls("b-not-enough-height")),i.currentTopRow=s,s.addCls(i.currentTopRowCls),r.innerHTML="",r.appendChild(i.updateStickyContent()));const l=i.currentTopRow.bottom-i.client.scrollable.y<=i.stickyContentHeight;i.element.classList[l?"add":"remove"]("b-hide-visibility"),i.currentTopRow[l?"addCls":"removeCls"]("b-not-enough-height"),n.y+=i.stickyContentTop,E.alignTo(t,i.stickyEls[0],{align:"t0-t0",constrainTo:n},!0)}i.lastProcessedTopRow=s}updateStickyContent(){const i=this,{currentTopRow:e,removeClasses:t}=i,r={"b-grid-sticky-row":1},n={},s=i.stickyContent||(i.stickyContent=document.createDocumentFragment()),a=i.stickyEls||(i.stickyEls=[]);for(a.forEach(l=>{l.classList.remove("b-sticky-content-el")}),a.length=0,e.eachElement(l=>{a.push(...l.querySelectorAll(i.contentSelector))});s.firstChild;)s.remove(s.firstChild);return i.stickyContentHeight=0,i.stickyContentTop=0,a.map(l=>{l.closest(".b-grid-cell").classList.forEach(c=>n[c]=1),l.closest(".b-grid-row").classList.forEach(c=>r[c]=1),Object.assign(n,t),Object.assign(r,t);const o=l.offsetTop;i.stickyContentTop=Math.max(i.stickyContentTop,o),l.style.alignSelf="flex-end",i.stickyContentHeight=Math.max(i.stickyContentHeight,i.currentTopRow.height-l.offsetTop+o),l.style.alignSelf="";const d=l.cloneNode(!0);return l.classList.add("b-sticky-content-el"),s.appendChild(d),d}),n["b-focused"]=!1,E.syncClassList(i.contentElement,n),E.syncClassList(i.element,r),s}};y(Eh,"$name","StickyCells"),Eh._$name="StickyCells",K.registerFeature(Eh,!1);var xh=class extends ie{static get pluginConfig(){return{chain:["beforeRenderRow"]}}doDisable(i){this.isConfiguring||this.client.refreshRows(),super.doDisable(i)}beforeRenderRow({row:i,record:e}){var t,r;const{enabled:n}=this,{isGroupHeader:s}=e,a=this.client.store.isGrouped&&e.instanceMeta(this.client.store).groupParent,l=((r=(t=a==null?void 0:a.groupChildren)==null?void 0:t.indexOf(e))!=null?r:i.dataIndex)%2===0;i.assignCls({"b-even":n&&!s&&l,"b-odd":n&&!s&&!l})}};y(xh,"$name","Stripe"),xh._$name="Stripe",K.registerFeature(xh);var Qa=class extends jm(ie){static get configurable(){return{selectedOnly:null,refreshOnlyAffectedSummaries:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}construct(i,e){this.grid=i,super.construct(i,e),this.bindStore(i.store),i.hideFooters=this.hideFooters}bindStore(i){this.detachListeners("store"),i.ion({name:"store",change:"onStoreChange",thisObj:this}),this.isConfiguring||this.refreshSummaries()}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(i){super.doDisable(i);const{client:e}=this;i?e.element.classList.add("b-summary-disabled"):(this.refreshSummaries(),e.element.classList.remove("b-summary-disabled"),e.eachSubGrid(t=>t.scrollable.syncPartners()))}renderRows(){this.refreshSummaries()}refreshSummaries(i){const e=this,{grid:t,store:r}=e,n=i?null:E.children(t.element,".b-grid-footer"),s=e.selectedOnly&&t.selectedRecords.length>0,a=(r.isFiltered?r.storage.values:r.allRecords).filter(o=>!o.isSpecialRow&&(!s||t.isSelected(o)));(i?i.map(o=>t.columns.get(o)):t.columns.visibleColumns).forEach((o,d)=>{var c;(c=o.summaries)==null||c.forEach(g=>{"seed"in g&&("initialSeed"in g||(g.initialSeed=g.seed),["number","string","date"].includes(typeof g.initialSeed)?g.seed=g.initialSeed:g.seed=Object.assign({},g.initialSeed))});const u=i?t.element.querySelector(`.b-grid-footer[data-column-id=${o.id}]`):n[d];if(!(u!=null&&u.dataset.column))return;const h=e.generateHtml(o,a,"b-grid-footer-summary");(o.summaries?o.summaries.length:o.sum)&&(u.children.length?E.sync(h,u.firstElementChild):u.innerHTML=h)})}onStoreChange({action:i,changes:e}){let t=!0;this.disabled||(i==="update"&&(t=Object.keys(e).some(r=>{const n=this.grid.columns.get(r);return!!n&&(!!n.sum||!!n.summaries)})),t&&this.refreshSummaries(i==="update"&&this.refreshOnlyAffectedSummaries?Object.keys(e):void 0))}updateSelectedOnly(i){const e=this;e.detachListeners("selectionChange"),i&&e.grid.ion({name:"selectionChange",selectionChange:e.refresh,thisObj:e}),e.refresh()}refresh(){this.refreshSummaries()}};y(Qa,"$name","Summary"),Qa.featureClass="b-summary",Qa._$name="Summary",K.registerFeature(Qa);var CF=Promise.resolve(),Qn=class extends ie.mixin(fe){static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementClick","bindStore","beforeRenderRow"]}}construct(i,e){var t;super.construct(i,e),!this.treeColumn&&((t=i.initialConfig.columns)==null?void 0:t.length)>0&&console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),i.store&&this.bindStore(i.store)}doDisable(i){if(i)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const i=this,{columns:e}=i.client;return(!i._treeColumn||!e.includes(i._treeColumn))&&(i._treeColumn=e.find(t=>t.isTreeColumn)),i._treeColumn}bindStore(i){this.detachListeners("store"),i.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",beforeLazyLoad:"onBeforeLoadChildren",afterLazyLoad:"onLoadChildren",thisObj:this})}async toggleCollapse(i,e){if(i==null)throw new Error("Tree#toggleCollapse must be passed a record");const t=this,{store:r,client:n}=t,{rowManager:s}=n,a=r.getById(i),l=a.instanceMeta(r);let o=s.getRowFor(a);if(a.generation++,await r.toggleCollapse(a,e)){if(t.isDestroyed)return;o=s.getRowFor(a),o&&a.ancestorsExpanded()&&o.render(null,null,!1),t.isTogglingNode||(n.element.classList.add("b-toggling-node"),t.isTogglingNode=!0,t.requestAnimationFrame(()=>{n.element.classList.remove("b-toggling-node"),t.isTogglingNode=!1})),n.trigger(l.collapsed?"collapseNode":"expandNode",{record:a}),n.trigger("toggleNode",{record:a,collapse:l.collapsed})}}async collapse(i){return this.toggleCollapse(i,!0)}async expand(i){return this.toggleCollapse(i,!1)}onBeforeToggleNode({record:i,collapse:e}){this.client.trigger("beforeToggleNode",{record:i,collapse:e})}onBeforeLoadChildren({source:i,params:e,parent:t=i.getById(e[i.modelClass.idField])}){var r;(r=this.client.rowManager.getRowFor(t))==null||r.addCls("b-loading-children")}onLoadChildren({source:i,params:e,parent:t=i.getById(e[i.modelClass.idField])}){var r;(r=this.client.rowManager.getRowFor(t))==null||r.removeCls("b-loading-children")}onLoadChildrenException({record:i}){const e=this.client.rowManager.getRowFor(i);e==null||e.removeCls("b-loading-children")}async expandOrCollapseAll(i=!0,e=this.store.rootNode){const{client:t,store:r}=this,{animateTreeNodeToggle:n}=t,s=[],a=[];return t.trigger("beforeToggleAllNodes",{collapse:i}),t.animateTreeNodeToggle=!1,r.suspendEvents(),r.traverse(l=>{const o=l.instanceMeta(r);l.isLeaf||(i&&!o.collapsed?(this.toggleCollapse(l,!0),a.push(...l.children)):!i&&o.collapsed&&(Array.isArray(l.children)&&a.push(...l.children),s.push(this.toggleCollapse(l,!1))))},e,e===r.rootNode),r.resumeEvents(),(i?CF:Promise.all(s)).then(()=>{a.length&&(i?r.trigger("remove",{records:a,isCollapse:!0,isCollapseAll:!0}):r.trigger("add",{records:a,isExpand:!0,isExpandAll:!0})),t.refreshRows(null,i),t.trigger("toggleAllNodes",{collapse:i}),t.animateTreeNodeToggle=n})}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(i,e=!0){var t,r,n,s;const a=this,{store:l,client:o}=a,{animateTreeNodeToggle:d}=o;if(Array.isArray(i)){if(i.length>0){o.suspendRefresh();for(let u=i.length-1;u>=0;u--){const h=l.getById(i[u]);u===0&&((t=o.resumeRefresh)==null||t.call(o,!1),o.rowManager.refresh()),await((r=a.expandTo)==null?void 0:r.call(a,h,u===0))}}return}const c=l.getById(i);if(c.instanceMeta(a.store).hiddenByCollapse!==!1){if(o.animateTreeNodeToggle=!1,!c.ancestorsExpanded()){const u=[];for(let h=c.parent;h&&!h.isRoot;h=h.parent)h.isExpanded(l)||u.unshift(h);o.suspendRefresh();for(const h of u)a.isDestroyed||await a.toggleCollapse(h,!1);(n=o.resumeRefresh)==null||n.call(o,!1),(s=o.refreshRows)==null||s.call(o)}o.animateTreeNodeToggle=d,!a.isDestroyed&&e&&await o.scrollRowIntoView(c)}}async expandToLevel(i,e=!1){const{store:t,client:r}=this,{animateTreeNodeToggle:n}=r,s=a=>{a.children.forEach(l=>{l.isLeaf||(l.instanceMeta(t).collapsed&&this.toggleCollapse(l,!1),l.childLevel<i&&s(l))})};t.suspendEvents(),r.suspendRefresh(),e&&await this.collapseAll(),r.isDestroyed||(r.animateTreeNodeToggle=!1,s(t.rootNode),t.resumeEvents(),r.resumeRefresh(!0),r.animateTreeNodeToggle=n)}onElementClick(i){const e=this,t=i.target,r=e.client.getCellDataFromEvent(i),n=t.closest(".b-tree-expander");n&&i.preventDefault(),(n||e.expandOnCellClick&&(r!=null&&r.record.isParent))&&e.toggleCollapse(r.record)}toggleCollapseByKey(){var i;const{focusedCell:e}=this.client;return(e==null?void 0:e.rowIndex)>-1&&!((i=this.client.features.cellEdit)!=null&&i.isEditing)&&e.record.isParent&&document.activeElement.closest(".b-grid-cell")?(this.toggleCollapse(e.id),!0):!1}beforeRenderRow({record:i,cls:e}){if(i.isLeaf)e["b-tree-parent-row"]=0,e["b-tree-collapsed"]=0,e["b-tree-expanded"]=0,e["b-loading-children"]=0;else{const{store:t}=this.client,r=!i.isExpanded(t);e["b-tree-parent-row"]=1,e["b-tree-collapsed"]=r,e["b-tree-expanded"]=!r,e["b-loading-children"]=i.instanceMeta(t).isLoadingChildren}}expandIfSingleColumn(){return this.client.columns.count===1?this.expandByKey():!1}expandByKey(){const i=this,{client:e}=i,{focusedCell:t}=e,r=t==null?void 0:t.record;return r&&(t!=null&&t.column.tree)&&r.isParent&&r.instanceMeta(e.store).collapsed?(i.expand(r),!0):!1}collapseIfSingleColumn(){return this.client.columns.count===1?this.collapseByKey():!1}collapseByKey(){const i=this,{client:e}=i,{focusedCell:t}=e,r=t==null?void 0:t.record;if(t!=null&&t.column.tree&&r){if(r.isParent&&!r.instanceMeta(e.store).collapsed)return i.collapse(r),!0;if(r.parent&&!r.parent.isRoot)return e.deselectAll(),e.focusCell({record:r.parent,column:t.column}),!0}return!1}updateTreeLines(){this.isConfiguring||this.client.refreshRows()}};y(Qn,"$name","Tree"),y(Qn,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"},treeLines:!1}),Qn.featureClass="b-tree",Qn._$name="Tree",K.registerFeature(Qn,!1,"Grid"),K.registerFeature(Qn,!0,"TreeGrid");var el=class extends jm(ie){static get pluginConfig(){return{chain:["populateHeaderMenu"],assign:["group","clearGroups","refreshGroups"]}}construct(i,e){if(this.treeColumn=i.columns.find(t=>t.isTreeColumn),super.construct(i,e),this._levels=this._levels||[],!i.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled");i.rowManager.ion({renderCell:"renderCell",prio:1e3,thisObj:this})}applyPluginConfig(){return this.scheduleRefreshGroups=be.createBuffered(this.refreshGroups,this.refreshGroupsTimeout,this),super.applyPluginConfig(...arguments)}processParentData(i){const e=this;e.parentCls&&(i.cls=e.parentCls)}processTransformedData(i){}async waitForLoad(){var i;const e=this;if(e.originalStore.isLoading&&(await e.originalStore.await("load",!1),e.isDestroyed))return;const{crudManager:t}=this.client;if(t){if((t.isLoadingOrSyncing||t._autoLoadPromise)&&await t.await("requestDone"),e.isDestroyed)return;await((i=e.client.project)==null?void 0:i.commitAsync())}}async waitForReadiness(){await this.waitForLoad(),this.scheduleRefreshGroups.isPending&&await this.client.await("treeGroupChange",!1)}updateOriginalStore(i){const e=this;e.store=e.initialConfig.store,e.detachListeners("originalStore"),i==null||i.ion({name:"originalStore",refresh:e.onOriginalStoreRefresh,add:e.onOriginalStoreChanged,update:e.onOriginalStoreUpdate,remove:e.onOriginalStoreChanged,removeAll:e.onOriginalStoreChanged,thisObj:e})}changeStore(i){var e;const{originalStore:t}=this;return t&&(i=new t.constructor({reapplyFilterOnAdd:!0,reapplyFilterOnUpdate:!0,tree:!0,modelClass:t.modelClass,load:(e=t.load)==null?void 0:e.bind(t),commit:t.commit.bind(t),remove:(r,n)=>{r=B.asArray(r);const s=[],a=[];if(i.isApplyingLevels)a.push(...r);else for(const l of r)l.isLinked?s.push(l.$original):a.push(l);a.length&&t.remove.call(i,a,n),s.length&&t.remove(s,n)},removeAll:t.removeAll.bind(t)},i)),i}async applyLevels(i){const e=this,{client:t,treeColumn:r,expandParents:n}=e;let{store:s}=t,a=null,l;const{modelClass:o}=s;if(r!=null&&r.field&&o.getFieldDefinition(r.field)&&(l=o.getFieldDataSource(r.field)),i=i||[],!(i.length===0&&e.isConfiguring)&&(e._levels=i,e.isApplying++,e.originalStore||(e.originalStore=s,t.suspendRefresh(),t.store=s=e.store,t.resumeRefresh(!1)),await e.waitForLoad(),!e.isDestroyed)){if(t.suspendRefresh(),i.length>0){const d=new Map;for(const u of s.getAllDataRecords(!1))u.isLeaf&&u.isLinked&&d.set(u.$original,u);const c=e.originalStore.getAllDataRecords(!1).flatMap(u=>u.isLeaf?d.has(u)?d.get(u):u.link():[]);for(const u of c){const h=u.instanceMeta(s.id);h.collapsed=!1,h.hidden=!1}a=s.treeifyData(c,i,u=>{l&&T.setPath(u,l,u.key);const h=s.getById(u.id);n&&!(h&&s.syncDataOnLoad)&&(u.expanded=!0),e.processParentData(u)},!1,(u,h)=>{const g=h&&t.columns.get(h);return g!=null&&g.formatValue?u=g.formatValue(u):g!=null&&g.isCheckColumn&&(u=!!u),u}),e.processTransformedData(a),await e.trigger("beforeDataLoad",{store:s,data:a.children}),s.isApplyingLevels=!0,s.data=a.children,s.isApplyingLevels=!1}else t.store=e.originalStore,e.detachListeners("originalStore"),e.originalStore=null;e.isApplying--,t.element.classList.toggle("b-grid-treegrouped",i.length>0),t.resumeRefresh(!1),e.refresh(),t.trigger("treeGroupChange",{levels:i})}}refresh(){this.client.isPainted&&this.client.renderRows(!1)}doDisable(i){i&&this.clearGroups(),super.doDisable(i)}onOriginalStoreUpdate({records:i,changes:e}){this.levels.some(t=>(t.fieldName||t)in e)?this.scheduleRefreshGroups():Object.keys(e).forEach(t=>{const r=this.client.columns.get(t);r!=null&&r.isVisible&&r.hasSummary&&r.refreshCells()})}onOriginalStoreChanged(){this.scheduleRefreshGroups()}onOriginalStoreRefresh({action:i}){(i==="dataset"||i==="filter")&&this.scheduleRefreshGroups()}updateLevels(i,e){const t=this,{client:r}=t;t.hideGroupedColumns&&(e==null||e.forEach(n=>{n=n.fieldName||n,i.some(s=>(s.fieldName||s)===n)||r.columns.get(n).show()}),i==null||i.forEach(n=>{n=n.fieldName||n,(!e||!e.some(s=>s.fieldName===n))&&(r._suspendRenderContentsOnColumnsChanged=!0,r.columns.get(n).hide(),r._suspendRenderContentsOnColumnsChanged=!1)})),(i||!t.isConfiguring)&&(t.updatePromise=t.applyLevels(i),r.renderContents())}get groupFields(){return this.levels.map(i=>i.fieldName||i)}async group(i){T.assertArray(i,"group()"),await this.applyLevels(i)}async clearGroups(){this.isGrouped&&(this.levels=[],await this.updatePromise)}refreshGroups(){var i;return(i=this.applyLevels)==null?void 0:i.call(this,this._levels)}get isGrouped(){return!this.disabled&&this._levels.length>0}populateHeaderMenu({column:i,items:e}){const t=this,r=i.groupable!==!1&&!i.isTreeColumn;let n=!1;r&&!t.isGroupedByField(i.field)&&(e.groupAsc={text:"L{group}",localeClass:t,icon:"b-fw-icon b-icon-group-asc",separator:!0,weight:400,disabled:t.disabled,onItem:()=>t.addGrouper(i)},n=!0),t.isGrouped&&(t.isGroupedByField(i.field)&&(e.groupRemove={text:"L{stopGroupingThisColumn}",localeClass:t,icon:"b-fw-icon b-icon-clear",separator:!n,weight:420,disabled:t.disabled,onItem:()=>t.removeGrouper(i)},n=!0),e.groupRemoveAll={text:"L{stopGrouping}",localeClass:t,icon:"b-fw-icon b-icon-clear",separator:!n,weight:420,disabled:t.disabled,onItem:()=>t.clearGroups()})}addGrouper(i){this.levels=this.levels.concat(i.field)}isGroupedByField(i){return this.levels.find(e=>e.fieldName===i)}removeGrouper(i){this.levels.splice(this.levels.findIndex(e=>e.fieldName===i.field),1),this.levels=this.levels.slice()}renderCell({column:i,cellElement:e,row:t,record:r,size:n,isFirstColumn:s}){if(this.isGrouped&&!this.disabled&&r.generatedParent&&i.hasSummary){const a=this.generateHtml(i,r.allChildren,"b-grid-treegroup-summary");e.children.length?E.sync(a,e.firstElementChild):e.innerHTML=a}}};y(el,"$name","TreeGroup"),y(el,"configurable",{levels:[],parentCls:"b-generated-parent",parentRenderer:null,hideGroupedColumns:null,refreshGroupsTimeout:100,expandParents:!0,store:{},originalStore:null}),y(el,"properties",{isApplying:0}),el._$name="TreeGroup",K.registerFeature(el);var rr={all:"all",visible:"visible"},Pi={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69,portraitWidth:8.3,portraitHeight:11.7,landscapeWidth:11.7,landscapeHeight:8.26},A3:{width:11.69,height:16.49,portraitWidth:11.7,portraitHeight:16.49,landscapeWidth:16.54,landscapeHeight:11.68},A2:{width:16.54,height:23.39,portraitWidth:16.54,portraitHeight:23.39,landscapeWidth:23.39,landscapeHeight:16.51},A1:{width:23.39,height:33.11,portraitWidth:23.39,portraitHeight:33.08,landscapeWidth:33.11,landscapeHeight:23.39},Legal:{width:8.5,height:14,portraitWidth:8.5,portraitHeight:14,landscapeWidth:14,landscapeHeight:8.15},Letter:{width:8.5,height:11,portraitWidth:8.5,portraitHeight:10.95,landscapeWidth:11,landscapeHeight:8.3}};function $S(){return Y.isFirefox?{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.26}:Y.isSafari?{portraitWidth:0,portraitHeight:.1,landscapeWidth:0,landscapeHeight:.5}:{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.25}}var Yr={portrait:"portrait",landscape:"landscape"},Rh={pdf:"pdf",png:"png"},wF={pdf:"application/pdf",png:"image/png"},SF=["a5","a4","a3","b5","b4","jis-b5","jis-b4","letter","legal","ledger"],HS=i=>SF.includes(i.toLowerCase()),Nd=class extends Ze{static get defaultConfig(){return{editable:!1}}buildItems(){const i=this;return[{id:rr.all,text:i.L("L{all}")},{id:rr.visible,text:i.L("L{visible}")}]}};y(Nd,"$name","ExportRowsCombo"),y(Nd,"type","exportrowscombo"),Nd.initClass(),Nd._$name="ExportRowsCombo";var Bd=class extends Ze{static get defaultConfig(){return{editable:!1}}buildItems(){const i=this;return[{id:Yr.portrait,text:i.L("L{portrait}")},{id:Yr.landscape,text:i.L("L{landscape}")}]}};y(Bd,"$name","ExportOrientationCombo"),y(Bd,"type","exportorientationcombo"),Bd.initClass(),Bd._$name="ExportOrientationCombo";function VS(i,e=t=>t){return Object.keys(i).map(t=>({id:t,text:e(t)}))}var es=class extends ft{static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,useBrowserPrint:!1,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",name:"columns",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",name:"rowsRange",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",name:"exporterType",editable:!1,value:"singlepage",displayField:"text",buildItems(){const i=this.parent;return i.exporters.map(e=>({id:e.type,text:i.optionalL(e.title,this)}))},onChange({value:i}){this.owner.widgetMap.alignRowsField.hidden=i.match(/singlepage/)||i.match(/^vertical/),this.owner.widgetMap.repeatHeaderField.hidden=!i.match(/multipagevertical/)},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",name:"alignRows",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",name:"repeatHeader",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",name:"fileFormat",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:i,oldValue:e}){const t=this.parent;if(t.hidePNGMultipageOption){const r=t.widgetMap.exporterTypeField,n=r.store.find(s=>s.id==="singlepage");i===Rh.png&&n?(this._previousDisabled=r.disabled,r.disabled=!0,this._previousValue=r.value,r.value="singlepage"):e===Rh.png&&this._previousValue&&(r.disabled=this._previousDisabled,r.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",name:"paperFormat",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",name:"orientation",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}},internalListeners:{beforeShow:"onInternalBeforeShow"}}}construct(i={}){const e=this,{client:t}=i;if(!t)throw new Error("`client` config is required");e.columnsStore=t.columns.chain(r=>r.isLeaf&&r.exportable,null,{excludeCollapsedRecords:!1}),e.applyInitialValues(i),super.construct(i),Le.ion({locale:"onLocaleChange",prio:-1,thisObj:e})}updateUseBrowserPrint(i){const e=this;e.whenVisible(()=>{const{exportButton:t,fileFormatField:r}=e.widgetMap,n=t.initialConfig.text,s=!("title"in e.initialConfig);(!n||n==="L{ExportDialog.export}"&&i)&&(t.text=i?e.L("L{ExportDialog.print}"):e.L("L{ExportDialog.export}")),s&&(e.title=i?e.L("L{printSettings}"):e.L("L{exportSettings}")),r.hidden=i||!!r.initialConfig.hidden})}applyInitialValues(i){const e=this,t=i.items=i.items||{};i.width=i.width||e.L("L{width}"),i.defaults=i.defaults||{},i.defaults.labelWidth=i.defaults.labelWidth||e.L("L{ExportDialog.labelWidth}"),t.columnsField=t.columnsField||{},t.fileFormatField=t.fileFormatField||{},t.paperFormatField=t.paperFormatField||{},t.fileFormatField.items=VS(Rh,r=>r.toUpperCase()),t.paperFormatField.items=VS(Pi),t.columnsField.store=e.columnsStore}onInternalBeforeShow(){const{columnsField:i,alignRowsField:e,exporterTypeField:t,repeatHeaderField:r}=this.widgetMap;this.autoSelectVisibleColumns&&(i.value=this.columnsStore.query(s=>!s.hidden));const n=t.value;e.hidden=n.match(/singlepage/)||n.match(/^vertical/),r.hidden=!n.match("multipagevertical")}onLocaleChange(){const i=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget(e=>{e instanceof rt&&(e.labelWidth=i)})}onExportClick(){const i=this.values;this.trigger("export",{values:i})}onCancelClick(){this.trigger("cancel"),this.hide()}};y(es,"$name","ExportDialog"),y(es,"type","exportdialog"),es.initClass(),es._$name="ExportDialog";var zd=class extends fe(Fe(Nt($))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:i=>i}}static inchToPx(i){return i*96}pageTpl(i){const{title:e,header:t,footer:r,styles:n,htmlClasses:s,bodyClasses:a=[],paperHeight:l,paperWidth:o,html:d,currentPage:c}=i;let{htmlStyle:u="",bodyStyle:h=""}=i;return a.push(`b-${this.constructor.type}`),E.scrollBarWidth?a.push("b-visible-scrollbar"):a.push("b-overlay-scrollbar"),Y.isChrome?a.push("b-chrome"):Y.isSafari?a.push("b-safari"):Y.isFirefox&&a.push("b-firefox"),h=`${h}; width: ${o}in; height: ${l}in;`,Pt.tpl`
            <!DOCTYPE html>
            <html class="${s} b-print-root" style="${u}">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${e}</title>
                    ${n.join("")}
                </head>
                <body class="b-export b-print ${a.join(" ")}" style="${h}">
                <div class="b-page-wrap">
                    <div class="b-export-content b-page-${c}">
                        ${t&&`<div class="b-export-header" style="width: 100%">${t}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${r&&`<div class="b-export-footer" style="width: 100%">${r}</div>`}
                    </div>
                </div>
                </body>
            </html>`}get stylesheets(){const i=this;if(i._stylesheets)return i._stylesheets;const e=i.translateURLsToAbsolute,t=globalThis.origin,r=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),n=[];return r.forEach(s=>{if(s=s.cloneNode(!0),e&&s.href){let l;e===!0?l=s.href:this.keepPathName?l=s.href.replace(t,e):l=new URL(s.getAttribute("href"),e),s.setAttribute("href",l)}let a=s.outerHTML;if(e&&/style/i.test(s.tagName)){const l=i.getStyleTagURLConverter(e);a=a.replace(/url\(['"]?(.+?)['"]?\)/g,l)}n.push(a)}),i._stylesheets=i.filterStyles(n)}set stylesheets(i){this._stylesheets=i&&this.filterStyles(i)}getStyleTagURLConverter(i){return function(e,t){let r;try{let n;/^#/.test(t)?r=e:(i===!0?n=globalThis.location.href:this.keepPathName?n=globalThis.location.href.replace(globalThis.location.origin,i):n=i,r=`url('${new URL(t,n).href}')`)}catch(n){r=e}return r}.bind(this)}saveState({client:i}){const{disableGridColumnIdWarning:e}=i;i.disableGridColumnIdWarning=!0,this.state=i.state,i.disableGridColumnIdWarning=e}async restoreState({client:i}){const e=[],t=new Set;t.add(i.scrollable.ion({scroll(){e.push(i.scrollable.await("scrollEnd"))}})),i.eachSubGrid(({header:r,scrollable:n})=>{t.add(n.ion({scroll(){e.push(n.await("scrollEnd"))}})),t.add(r.scrollable.ion({scroll(){e.push(r.scrollable.await("scrollEnd"))}}))}),i.state=this.state,await Promise.all(e),t.forEach(r=>r())}beforeExport(){this.element=document.createElement("div")}cloneElement(i,e=this.element,t=!0){t&&(e.innerHTML=""),e.appendChild(i.cloneNode(!0));const r=e.querySelector(".b-gridbase > .b-mask");r==null||r.remove()}createPlaceholder(i,e=!0,t={}){return e&&(i.innerHTML=""),E.createElement(Object.assign({parent:i,id:Si.generateId("export")},t))}prepareElement({client:i}){const{tbar:e,bbar:t}=i;e&&this.element.querySelector(`#${e.id}`).remove(),t&&this.element.querySelector(`#${t.id}`).remove()}measureElement(i="",e=""){i instanceof HTMLElement&&(i=i.outerHTML);const t=E.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},className:e,html:`<div style="height: 1px"></div>${i}<div style="height: 1px"></div>`}),r=t.offsetHeight-2;return t.remove(),r}prepareHTML(i){i instanceof HTMLElement&&(i=i.outerHTML);const e=E.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:i}),t=e.querySelectorAll("img");for(let n=0,s=t.length;n<s;n++)t[n].setAttribute("src",t[n].src);const r=e.innerHTML;return e.remove(),r}getVirtualScrollerHeight(i){let e=0;return i.eachSubGrid(t=>{t.overflowingHorizontally&&(e=E.scrollBarWidth)}),e===0?e:e+1}getPaperWidth(i,e){if("portraitWidth"in i){const t=e?"portraitWidth":"landscapeWidth";return i[t]-(this.exportMeta.isPrinting?$S()[t]:0)}else return e?i.width:i.height}getPaperHeight(i,e){if("portraitHeight"in i){const t=e?"portraitHeight":"landscapeHeight";return i[t]-(this.exportMeta.isPrinting?$S()[t]:0)}else return e?i.height:i.width}inchToPx(i){return i*96}getScaleValue(i,e){return Math.floor(i*1e4/e)/1e4}async export(i){const e=this;let t;e.beforeExport(),e.saveState(i),await e.prepareComponent(i);try{t=await e.getPages(i)}finally{await e.restoreComponent(i),e.stylesheets=null,await Qe.animationFrame(),await e.restoreState(i)}return t}async getPages(i){const e=this.pagesExtractor(i),t=[];let r;for(;(r=await e.next())&&!r.done;)t.push(r.value);return t}prepareExportElement(){const i=this,{element:e,exportMeta:t}=i;return Object.values(t.subGrids).forEach(({width:r,id:n,headerId:s,footerId:a})=>{[n,s,a].forEach(l=>{if(l){const o=e.querySelector(`[id="${l}"]`);o&&(o.style.width=`${r}px`,o.style.flex="")}})}),e.innerHTML}async prepareComponent(i){const e=this,{client:t,columns:r,keepRegionSizes:n,useRenderedColumnWidth:s}=i,{rowManager:a}=t,l=e.exportMeta={totalWidth:0,totalHeight:0,subGrids:{},isPrinting:i.useBrowserPrint,title:i.title||t.description},o=Pi[i.paperFormat],d=i.orientation===Yr.portrait,c=e.getPaperWidth(o,d),u=e.getPaperHeight(o,d),h=e.inchToPx(c),g=e.inchToPx(u);Object.assign(l,{paperWidth:c,paperHeight:u,realPaperWidth:e.getPaperWidth(o,d),realPaperHeight:e.getPaperHeight(o,d),pageWidth:h,pageHeight:g}),t.columns.forEach(m=>{r.includes(m.id)?m.show():m.hide()}),await Qe.animationFrame();const{element:f}=e;e.cloneElement(t.element),e.prepareElement(i),t.eachSubGrid(m=>{var p,v,b;const w=e.createPlaceholder(f.querySelector(`[id="${m.id}"]`),!1);let D;if(n!=null&&n[m.region])D=m.element.offsetWidth;else{const{visibleColumns:x}=m.columns;x.length===1&&!x[0].isTimeAxisColumn&&e.state.columns.filter(R=>R.region===m.region&&!R.hidden&&R.id!==x[0].id).length===0?D=m.element.offsetWidth:D=m.columns.visibleColumns.reduce((R,M)=>(!s&&typeof M.width=="number"?R+=M.width:R+=(t.hideHeaders?a.rows[0].getCell(M.id):M.element).offsetWidth,R),0)}l.totalWidth+=D;const S=((p=m.splitterElement)==null?void 0:p.offsetWidth)||0;l.totalWidth+=S,l.subGrids[m.region]={id:m.id,headerId:((v=m.header)==null?void 0:v.id)||null,footerId:((b=m.footer)==null?void 0:b.id)||null,rows:[],splitterWidth:S,placeHolder:w,width:D}})}async restoreComponent(i){}collectRow(i){const e=this.exportMeta.subGrids,t=/data-owner-cmp=".+?"/,r=i.grid.features.rowExpander;Object.entries(i.elements).forEach(([n,s])=>{s.classList.remove("b-export-row");let{outerHTML:a}=s;if(r){const l=s.querySelector(`.${r.shadowRootContainerClass}`);if(l){const o=[];l._shadowRoot.childNodes.forEach(d=>{d.tagName!=="LINK"&&d.tagName!=="STYLE"&&o.push(d.outerHTML)}),a=a.replace(l.outerHTML,l.outerHTML.replace(/></,`>${o.join("")}<`))}}e[n].rows.push(a.replace(t,"")),s.classList.add("b-export-row")})}};zd.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},zd._$name="ExporterBase";var tl=class extends zd{cloneElement(i,e=this.element,t=!0){super.cloneElement(i,e,t),E.removeEachSelector(e,".b-grid-row,.b-grid-merged-cells-container")}getVisibleRowsCount(i){const e=i.rowManager,t=e.rows.indexOf(e.firstVisibleRow),r=e.rows.indexOf(e.lastVisibleRow);let n;return t!==-1?r===-1?n=i.store.count-t:n=r-t+1:n=i.store.count,n}async prepareComponent(i){const{client:e}=i,{rowManager:t}=e;await super.prepareComponent(i);const r=this.exportMeta.fakeRow=t.rowClass.new({cls:{[e.rowCls]:1,"b-export-row":1},rowManager:t,grid:e,index:-10,dataIndex:-10,isFakeRow:!0});this.exportMeta.rowsMap=new Map,e.eachSubGrid(n=>{n.onAddRow({rows:[r]}),r.element.dataset.ownerCmp=e.id})}async restoreComponent(i){await super.restoreComponent(i),this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}renderMergedCells(i,e,t,r){const n=this,{client:s}=i,{subGrids:a}=n.exportMeta,l=s.features.mergeCells.buildMergedCellsConfig(e,t,r);for(const o in a){const d=a[o],c=document.createElement("div");oe.sync({targetElement:c,domConfig:{children:l[o].children}}),c.childNodes.length&&(c.childNodes.forEach(u=>{const{syncId:h}=u.dataset,g=s.features.mergeCells.mergedRanges.find(f=>{var m;return((m=f.cellElement)==null?void 0:m.parentNode.dataset.syncId)===h});g&&(u.innerHTML=g.cellElement.outerHTML)}),d.mergedCellsHtml=[c.innerHTML])}}};tl._$name="Exporter";var qr=class extends tl{static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:i,rowsRange:e}){const{exportMeta:t}=this;++t.currentPage,++t.verticalPosition,t.lastRowIndex>=t.finishRowIndex?(t.verticalPages=t.verticalPosition,t.totalPages=t.verticalPages*t.horizontalPages):t.verticalPages=Math.max(t.verticalPages,t.verticalPosition+1),t.verticalPosition>=t.verticalPages&&t.horizontalPosition<t.horizontalPages-1&&Object.assign(t,{verticalPosition:0,horizontalPosition:t.horizontalPosition+1,lastTop:0,lastRowIndex:e===rr.visible?i.rowManager.firstVisibleRow.dataIndex:0,lastRowExported:!1})}async prepareComponent(i){await super.prepareComponent(i);const e=this,{exportMeta:t}=e,{client:r,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:l}=i,o=Pi[i.paperFormat],d=i.orientation===Yr.portrait,c=e.getPaperWidth(o,d),u=e.getPaperHeight(o,d),h=e.inchToPx(c),g=e.inchToPx(u),f=l===rr.visible,m=Math.ceil(t.totalWidth/h);let p=g;n&&(p-=e.measureElement(n({totalWidth:t.totalWidth,totalPages:-1,currentPage:-1}),"b-export-header")),s&&(p-=e.measureElement(s({totalWidth:t.totalWidth,totalPages:-1,currentPage:-1}),"b-export-footer"));let v,b,w=r.store.count;if(f?(w=e.getVisibleRowsCount(r),v=t.totalHeight+r.headerHeight+r.footerHeight+r.bodyHeight,t.finishRowIndex=r.rowManager.lastVisibleRow.dataIndex):(v=t.totalHeight+r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,t.finishRowIndex=r.store.count-1),a&&!f){const D=r.rowManager.rowOffsetHeight,S=Math.floor((p-r.headerHeight)/D),x=Math.floor(p/D),R=w-S;b=1+Math.ceil(R/x)}else b=Math.ceil(v/p);Object.assign(t,{paperWidth:c,paperHeight:u,pageWidth:h,pageHeight:g,horizontalPages:m,verticalPages:b,totalHeight:v,contentHeight:p,totalRows:w,totalPages:m*b,currentPage:0,verticalPosition:0,horizontalPosition:0,lastTop:0,lastRowIndex:f?r.rowManager.firstVisibleRow.dataIndex:0,lastRowExported:!1})}async renderRows(i){const e=this,{exportMeta:t}=e,{client:r,alignRows:n,repeatHeader:s}=i,{verticalPosition:a,contentHeight:l,lastRowIndex:o,fakeRow:d,rowsMap:c}=t,u=[],h=s?0:r.headerHeight,{store:g}=r,f=r.hasActiveFeature("mergeCells");let m=o+(!n||a===0?0:1),p=0,v=l,b;for(a===0&&(v-=h);v>0;){const w=g.getAt(m);if(d.render(m,w,!0,!1,!0),n&&v<d.offsetHeight)break;{b=p,p=d.translate(p),t.lastRowIndex=d.dataIndex,v-=d.offsetHeight,e.collectRow(d),m++;const D={top:d.top,bottom:d.bottom,offsetHeight:d.offsetHeight,dataIndex:d.dataIndex};if(u.push(D),c.set(w.id,D),d.dataIndex===t.finishRowIndex&&v>=0){t.lastRowExported=!0;break}}}f&&e.renderMergedCells(i,o,m,u),t.lastTop=n?p:b,t.exactGridHeight=d.bottom+r.footerContainer.offsetHeight+(a===0||s?h:0),await e.onRowsCollected(u,i)}async buildPage(i){const e=this,{exportMeta:t}=e,{client:r,headerTpl:n,footerTpl:s}=i,{totalWidth:a,totalPages:l,currentPage:o,subGrids:d}=t;Object.values(d).forEach(g=>g.rows=[]),i.rowsRange===rr.all&&(t.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-e.getVirtualScrollerHeight(r));let c,u;return n&&(c=e.prepareHTML(n({totalWidth:a,totalPages:l,currentPage:o}))),s&&(u=e.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:o}))),await e.renderRows(i),{html:e.buildPageHtml(i),header:c,footer:u}}async onRowsCollected(){}buildPageHtml(){const i=this,{subGrids:e}=i.exportMeta;let t=i.prepareExportElement();return Object.values(e).forEach(({placeHolder:r,rows:n,mergedCellsHtml:s})=>{const a=r.outerHTML;let l=n.join("");s!=null&&s.length&&(l+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),t=t.replace(a,l)}),t}};y(qr,"$name","MultiPageExporter"),y(qr,"type","multipage"),qr.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:s,totalPages:a,paperWidth:l,paperHeight:o,realPaperWidth:d,realPaperHeight:c,title:u}=r;let h;for(;!r.lastRowExported;){h=r.currentPage,t.trigger("exportStep",{text:t.L(qr.exportingPageText,{currentPage:h,totalPages:a}),progress:Math.round((h+1)/a*90)});const{html:g,header:f,footer:m}=await t.buildPage(e),p=[...n,`
                <style>
                    .b-page-wrap {
                        width: ${l}in;
                        height: ${o}in;
                    }
                    .b-page-${h} #${e.client.id} {
                        height: ${r.exactGridHeight}px !important;
                        width: ${s}px !important;
                    }
                    .b-page-${h} .b-export-body .b-export-viewport {
                        transform: translate(${-l*r.horizontalPosition}in, 0);
                    }
                    ${r.verticalPosition===0?"":`.b-page-${h} .b-grid-header-container {
                        display: none;
                    }`}
                </style>
            `];await t.stateNextPage(e),yield{html:t.pageTpl({html:g,title:u,header:f,footer:m,styles:p,paperWidth:l,paperHeight:o,realPaperWidth:d,realPaperHeight:c,currentPage:h})}}},qr._$name="MultiPageExporter";var Kr=class extends tl{static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage(){const{exportMeta:i}=this,{totalRows:e,processedRows:t,totalPages:r}=i;++i.currentPage,++i.verticalPosition,i.currentPage===r&&t.size!==e&&(++i.totalPages,++i.verticalPages)}calculateScale(){const i=this,{exportMeta:e}=i,{pageWidth:t,totalWidth:r}=e,n=i.getScaleValue(t,r);return i.exportMeta.scale=n,n}estimateTotalPages(i){const e=this,{exportMeta:t}=e,{client:r,headerTpl:n,footerTpl:s,alignRows:a,rowsRange:l,repeatHeader:o}=i,{pageWidth:d,pageHeight:c,totalWidth:u}=t,h=e.calculateScale(d,u);let g=r.store.count,f=g?0-e.getVirtualScrollerHeight(r)+r.height-r.bodyElement.offsetHeight+r.scrollable.scrollHeight:0,m=c/h,p=f,v;if(n&&(m-=e.measureElement(n({totalWidth:u,totalPages:-1,currentPage:-1}),"b-export-header")),s&&(m-=e.measureElement(s({totalWidth:u,totalPages:-1,currentPage:-1}),"b-export-footer")),o&&(m-=r.headerHeight+r.footerHeight,f-=r.headerHeight+r.footerHeight),l===rr.visible){const b=r.rowManager,w=b.firstVisibleRow,D=b.lastVisibleRow;g=e.getVisibleRowsCount(r),p=D.bottom-w.top,f=r.headerHeight+r.footerHeight+p,t.lastRowIndex=w.dataIndex,t.finishRowIndex=D.dataIndex}else t.finishRowIndex=r.store.count-1;if(a&&!o&&l!==rr.visible){const b=r.rowManager.rowOffsetHeight,w=Math.floor((m-r.headerHeight)/b),D=Math.floor(m/b),S=g-w;v=1+Math.ceil(S/D)}else v=Math.ceil(p/m);Object.assign(t,{scale:h,contentHeight:m,totalRows:g,totalHeight:f,verticalPages:v,initialScroll:0,horizontalPages:1,totalPages:v,lastRowExported:!1})}async prepareComponent(i){await super.prepareComponent(i);const e=this,{exportMeta:t}=e,r=Pi[i.paperFormat],n=i.orientation===Yr.portrait,s=e.getPaperWidth(r,n),a=e.getPaperHeight(r,n),l=e.inchToPx(s),o=e.inchToPx(a),d=1;Object.assign(t,{paperWidth:s,paperHeight:a,realPaperWidth:e.getPaperWidth(r,n),realPaperHeight:e.getPaperHeight(r,n),pageWidth:l,pageHeight:o,horizontalPages:d,currentPage:0,verticalPosition:0,horizontalPosition:0,lastTop:0,lastRowIndex:-1,processedRows:new Set}),e.estimateTotalPages(i)}async renderRows(i){const e=this,{exportMeta:t}=e,{client:r,alignRows:n,repeatHeader:s}=i,{verticalPosition:a,contentHeight:l,lastRowIndex:o,fakeRow:d,rowsMap:c,nextPageTop:u=0}=t,h=[],g=s||a>0?0:r.headerHeight,{store:f}=r,m=r.hasActiveFeature("mergeCells");let p=Math.max(0,o)+(u>0||!n||a===0?0:1),v=l+u,b=-u,w=!1,D;for(t.nextPageTop=0,a===0&&(w=!0,v-=g);v>0;){const S=f.getAt(p);d.render(p,S,!0,!1,!0);const{offsetHeight:x}=d;if(n&&x<l&&v<x)break;{b=d.translate(b),v-=x,D=d.bottom,D>l&&x>l&&(t.nextPageTop=l-d.top-(w?g:0),v=l-D),t.lastRowIndex=d.dataIndex,e.collectRow(d);const R={top:d.top,bottom:D,dataIndex:d.dataIndex,offsetHeight:x};if(h.push(R),c.set(S.id,R),v>0&&t.processedRows.add(p),p++,d.dataIndex===t.finishRowIndex){if(v>=0){t.lastRowExported=!0;break}t.verticalPages=t.verticalPosition,t.totalPages=t.verticalPages&t.horizontalPages,e.calculateScale()}}}m&&e.renderMergedCells(i,o,p,h),t.exactGridHeight=D+r.footerContainer.offsetHeight+(a===0||s?r.headerHeight:0),await e.onRowsCollected(h,i)}async buildPage(i){const e=this,{exportMeta:t}=e,{headerTpl:r,footerTpl:n}=i,{totalWidth:s,totalPages:a,currentPage:l,subGrids:o}=t;Object.values(o).forEach(h=>h.rows=[]);let d,c;return r&&(d=e.prepareHTML(r({totalWidth:s,totalPages:a,currentPage:l}))),n&&(c=e.prepareHTML(n({totalWidth:s,totalPages:a,currentPage:l}))),await e.renderRows(i),{html:e.buildPageHtml(i),header:d,footer:c}}async onRowsCollected(){}buildPageHtml(){const i=this,{subGrids:e}=i.exportMeta;let t=i.prepareExportElement();return Object.values(e).forEach(({placeHolder:r,rows:n,mergedCellsHtml:s})=>{const a=r.outerHTML;let l=n.join("");s!=null&&s.length&&(l+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),t=t.replace(a,l)}),t}};y(Kr,"$name","MultiPageVerticalExporter"),y(Kr,"type","multipagevertical"),Kr.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:s,paperWidth:a,paperHeight:l,realPaperWidth:o,realPaperHeight:d,title:c}=r,u=e.lockPaperSize&&HS(e.paperFormat)?`@page { size: ${e.paperFormat} ${e.orientation} }`:"";let{totalPages:h}=r,g,f;for(;!r.lastRowExported;){g=r.currentPage,t.trigger("exportStep",{text:t.L(Kr.exportingPageText,{currentPage:g,totalPages:h}),progress:Math.round((g+1)/h*90)});const{html:m,header:p,footer:v}=await t.buildPage(e),{scale:b}=t.exportMeta;f=`
            ${u}
            .b-page-wrap {
                width: ${o}in;
                height: ${d}in;
            }
            .b-print .b-export-content {
                scale: ${b};
                transform-origin: top left;
                height: calc(100% / ${b});
                width: calc(100% / ${b});
            }
        `,e.repeatHeader?f=`
                ${f}
                .b-page-${g} #${e.client.id} {
                    height: ${r.exactGridHeight}px !important;
                    width: ${s}px !important;
                }
                .b-export-body {
                    height: 100%;
                    display: flex;
                }
                .b-export-viewport {
                    height: 100%;
                }
            `:f=`
                ${f}
                .b-page-${g} #${e.client.id} {
                    height: ${r.exactGridHeight}px !important;
                    width: ${s}px !important;
                }
                ${g===0?"":`.b-page-${g} .b-grid-header-container {
                    display: none;
                }`}
                .b-export-body {
                    overflow: hidden;
                }
            `;const w=[...n,`<style>${f}</style>`];await t.stateNextPage(),{totalPages:h}=r,yield{html:t.pageTpl({html:m,title:c,header:p,footer:v,styles:w,paperWidth:a,paperHeight:l,realPaperWidth:o,realPaperHeight:d,currentPage:g})}}},Kr._$name="MultiPageVerticalExporter";var ts=class extends tl{static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(i){await super.prepareComponent(i),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}async renderRows(i){const e=this,{client:t,rowsRange:r}=i,{rowManager:n,store:s}=t,a=t.hasActiveFeature("mergeCells"),l=r===rr.visible;let{totalHeight:o}=e.exportMeta;if(s.count){const{fakeRow:d,rowsMap:c}=e.exportMeta,{firstVisibleRow:u}=n,h=l?u.dataIndex:0,g=l?n.lastVisibleRow.dataIndex:s.count-1,f=[];let m=0;if(d.cells.length){for(let p=h;p<=g;p++){const v=s.getAt(p);d.render(p,v,!0,!1,!0),m=d.translate(m),e.collectRow(d);const b={top:d.top,bottom:d.bottom,offsetHeight:d.offsetHeight,dataIndex:d.dataIndex};f.push(b),c.set(v.id,b)}await e.onRowsCollected(f,i)}o+=m,a&&e.renderMergedCells(i,h,g,f)}return e.exportMeta.exactGridHeight=o,o}buildPageHtml(i){const e=this,{subGrids:t}=e.exportMeta;let r=e.prepareExportElement();return Object.values(t).forEach(({placeHolder:n,rows:s,mergedCellsHtml:a})=>{const l=n.outerHTML;let o=s.join("");a!=null&&a.length&&(o+=`<div class="b-grid-merged-cells-container">${a.join("")}</div>`),r=r.replace(l,o)}),r}};y(ts,"$name","SinglePageExporter"),y(ts,"type","singlepage"),ts.prototype.pagesExtractor=async function*(e){const t=this,{client:r}=e,{totalWidth:n}=t.exportMeta,s=t.stylesheets,a=e.orientation===Yr.portrait,l=Pi[e.paperFormat],o=t.getPaperWidth(l,a),d=t.getPaperHeight(l,a),c=t.getPaperWidth(l,a),u=t.getPaperHeight(l,a),h=e.lockPaperSize&&HS(e.paperFormat)?`@page { size: ${e.paperFormat} ${e.orientation} }`:"";let g,f,m;g=await t.renderRows(e)+r.headerHeight+r.footerHeight;const p=t.buildPageHtml(e),v=g;if(e.headerTpl){f=t.prepareHTML(e.headerTpl({totalWidth:n}));const S=t.measureElement(f,"b-export-header");g+=S}if(e.footerTpl){m=t.prepareHTML(e.footerTpl({totalWidth:n}));const S=t.measureElement(m,"b-export-footer");g+=S}const b=Math.min(1,t.getScaleValue(t.inchToPx(o),n)),w=Math.min(1,t.getScaleValue(t.inchToPx(d),g)),D=Math.min(b,w);s.push(`<style>
            ${h}
            #${r.id} {
                height: ${v}px !important;
                width: ${n}px !important;
            }
            .b-page-wrap {
                width: ${c}in;
                height: ${u}in;
            }
            .b-print .b-export-content {
                height: 100%;
            }
            ${t.centerContentHorizontally?".b-export-viewport > .b-widget { transform: translateX(-50%); left: 50%; }":""}
            .b-print .b-export-viewport {
                scale: ${D};
                transform-origin: top left;
                height: calc(100% / ${D});
                width: calc(100% / ${D});
            }
        </style>`),yield{html:t.pageTpl({html:p,header:f,footer:m,styles:s,paperWidth:o,paperHeight:d,realPaperHeight:u,realPaperWidth:c,currentPage:0})}},ts._$name="SinglePageExporter";var is=class extends ie{doDestroy(){var i;(i=this.exportDialog)==null||i.destroy(),this.exportersMap.forEach(e=>e.destroy()),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(i){this._currentExportPromise=i}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(i={}){const e=this,{exportersMap:t}=e,{type:r}=i;let n;if(t.has(r))n=t.get(r),Object.assign(n,i);else{const s=this.exporters.find(a=>a.type===r);if(!s)throw new Error(`Exporter type ${r} is not found. Make sure you've configured it`);i=T.clone(i),delete i.type,n=new s(i),n.relayAll(e),t.set(r,n)}return n}buildExportConfig(i={}){const e=this,{client:t,exportServer:r,clientURL:n,fileFormat:s,fileName:a,paperFormat:l,rowsRange:o,alignRows:d,repeatHeader:c,keepRegionSizes:u,orientation:h,translateURLsToAbsolute:g,keepPathName:f,sendAsBinary:m,headerTpl:p,footerTpl:v,filterStyles:b,useRenderedColumnWidth:w,useBrowserPrint:D,lockPaperSize:S}=e;i.columns||(i.columns=t.columns.visibleColumns.filter(R=>R.exportable).map(R=>R.id));const x=T.assign({client:t,exportServer:r,clientURL:n,fileFormat:s,paperFormat:l,rowsRange:o,alignRows:d,repeatHeader:c,keepRegionSizes:u,orientation:h,translateURLsToAbsolute:g,keepPathName:f,sendAsBinary:m,headerTpl:p,footerTpl:v,useRenderedColumnWidth:w,useBrowserPrint:D,lockPaperSize:S,exporterType:e.exporterType,fileName:a||t.$$name},i);return x.columns=i.columns.slice(),x.exporterType==="multipagevertical"||x.exporterType==="verticalmultipagevertical"||(x.repeatHeader=!1),!("alignRows"in i)&&i.repeatHeader&&(x.alignRows=!0),x.exporterConfig=T.assign({type:x.exporterType,translateURLsToAbsolute:x.translateURLsToAbsolute,keepPathName:x.keepPathName,filterStyles:b},x.exporterConfig||{}),delete x.exporterType,delete x.translateURLsToAbsolute,delete x.keepPathName,x}async export(i={}){var e,t;const r=this,{client:n,pagesPerRequest:s}=r;i=r.buildExportConfig(i);let a;if(n.trigger("beforePdfExport",{config:i})!==!1){n.isExporting=!0,n.mask(r.exportMask);try{const l=r.getExporter(i.exporterConfig);if(s===0){const o=await l.export(i);if(r.isDestroying)return;if((e=r.exportDialog)==null||e.close(),n.unmask(),r.trigger("exportStep",{progress:90,text:r.exportProgressMask,contentGenerated:!0}),i.useBrowserPrint)await r.doPrint(o,i),a={};else{const d=r.receiveExportContent(o,i);r.toast=r.showLoadingToast(d);const c=await d;a={response:c},await r.processExportContent(c,i)}}}catch(l){throw l instanceof Response?a={response:l}:a={error:l},l}finally{r.toast&&!r.toast.isDestroying&&r.toast.hide(),r.isDestroying||((t=r.exportDialog)==null||t.close(),n.unmask(),r.showErrorToast&&(a.error?a.error.name!=="AbortError"&&xi.show({html:r.L("L{Export failed}"),rootElement:r.rootElement}):a.response&&!a.response.ok&&xi.show({html:r.L("L{Server error}"),rootElement:r.rootElement})),n.trigger("pdfExport",a),n.isExporting=!1)}}return a}receiveExportContent(i,e){return kt.fetch(e.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:i,orientation:e.orientation,format:e.paperFormat,fileFormat:e.fileFormat,fileName:e.fileName,clientURL:e.clientURL,sendAsBinary:e.sendAsBinary})},this.fetchOptions))}async processExportContent(i,e){const t=this;if(i.ok&&t.openAfterExport){i=i.clone();const r=i.headers.get("content-type");if(r.match(/application\/octet-stream/)){const n=wF[e.fileFormat],s=await t.responseBlobToObjectURL(i,n);t.getDownloadLink(e.fileName,s).click()}else if(r.match(/application\/json/)){const n=await i.json();n.success?t.getDownloadLink(e.fileName,n.url).click():xi.show({html:n.msg,rootElement:this.rootElement})}}}doPrint(i){}async responseBlobToObjectURL(i,e){const t=await i.blob();return URL.createObjectURL(t.slice(0,t.size,e))}getDownloadLink(i,e){const t=document.createElement("a");return t.download=i,t.href=e,this.openInNewTab&&(t.target="_blank"),t}get defaultExportDialogConfig(){const i=this;return{client:i.client,exporters:i.exporters,useBrowserPrint:i.useBrowserPrint,items:{rowsRangeField:{value:i.rowsRange},exporterTypeField:{value:i.exporterType},orientationField:{value:i.orientation},paperFormatField:{value:i.paperFormat},repeatHeaderField:{value:i.repeatHeader},fileFormatField:{value:i.fileFormat},alignRowsField:{checked:i.alignRows}}}}changeExportDialog(i,e){const t=this;if(e==null||e.destroy(),i){const r=t.dialogClass.mergeConfigs({rootElement:t.rootElement,client:t.client,modal:{transparent:!0},items:{rowsRangeField:{value:t.rowsRange},exporterTypeField:{value:t.exporterType},orientationField:{value:t.orientation},paperFormatField:{value:t.paperFormat},repeatHeaderField:{value:t.repeatHeader},fileFormatField:{value:t.fileFormat},alignRowsField:{checked:t.alignRows}}},t.defaultExportDialogConfig,i);i=t.dialogClass.new(r),i.ion({export:t.onExportButtonClick,thisObj:t})}return i}async showExportDialog(){return this.exportDialog.show()}get isExporting(){return!!this.client.isExporting}onExportButtonClick({values:i}){const e=this,t=e.exportDialog.mask({progress:0,maxProgress:100,text:e.exportMask}),r=e.ion({exportstep({progress:n,text:s,contentGenerated:a}){a?(e.exportDialog.unmask(),r()):(t.progress=n,s!=null&&(t.text=s))}});e.currentExportPromise=e.export(i),e.currentExportPromise.catch(()=>{}).finally(()=>{var n;r(),(n=e.exportDialog)==null||n.unmask(),e.currentExportPromise=null})}showLoadingToast(i){const e=xi.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`
    <span class="b-mask-icon b-icon b-icon-spinner"></span>
    <span>${this.exportProgressMask}</span>
    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return V.on({element:e.element,click(){var t;(t=i.abort)==null||t.call(i)}}),e}};y(is,"$name","PdfExport"),y(is,"configurable",{dialogClass:es,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[ts,qr,Kr],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:i=>i,useRenderedColumnWidth:!1,useBrowserPrint:!1,lockPaperSize:!1,testConfig:{openAfterExport:!1}}),is._$name="PdfExport",K.registerFeature(is,!1,"Grid");var Gm=i=>{var e;return e=class extends i{static get configurable(){return{useBrowserPrint:!0,exporterType:"multipagevertical",test:!1}}static get pluginConfig(){return{assign:["print","showPrintDialog"]}}showPrintDialog(){return this.showExportDialog()}print(t){return this.export(t)}async onPrintIFrameLoad(t){}async showBrowserPrintDialog(t,r){if(await this.onPrintIFrameLoad(t),await this.client.trigger("beforeShowPrintDialog",{iframe:t})!==!1){if(!this.test){const{contentWindow:n}=t;n.onafterprint=()=>{t.remove(),r()},n.print()}}else t.remove(),r()}addStylesToDocument(t,r,n){r.head.querySelectorAll('link[rel="stylesheet"],link[as="style"]').forEach(s=>{const a=t.adoptNode(s);t.head.appendChild(a)})}addInlineStylesToDocument(t,r){r.head.querySelectorAll("style").forEach(n=>{const s=t.adoptNode(n);t.head.appendChild(s)})}doPrint(t){const r=this;return new Promise((n,s)=>{const a=document.createElement("iframe");a.className="b-print-wrapper",a.style.visibility="hidden",a.style.height="0",a.onload=()=>{var l;const o=a.contentWindow,d=o.document,{body:c}=d,u=new DOMParser;let h,g;t.forEach(({html:m},p)=>{const v=u.parseFromString(m,"text/html"),b=d.adoptNode(v.body.firstChild);p===0&&(r.addStylesToDocument(d,v,m),h=parseFloat(v.body.style.height),g=parseFloat(v.body.style.width)),r.addInlineStylesToDocument(d,v),c.appendChild(b)});const{html:f}=t[0];c.className=((l=f.match(/<body class="(.+?)"/))==null?void 0:l[1])||"",c.parentElement.classList.add("b-print-root"),c.style.height=`${h*t.length}in`,c.style.width=`${g}in`,Promise.all(Array.from(d.head.querySelectorAll('link[rel="stylesheet"]')).map(m=>new Promise((p,v)=>{m.onload=p,m.onerror=v}))).then(()=>d.fonts.ready).then(()=>r.showBrowserPrintDialog(a,n)).catch(m=>{console.warn(`Failed to load stylesheets ${m.message?`: ${m.message}`:""}`),s(r.L("L{PdfExport.Export failed}"))})},r.client.element.parentElement.appendChild(a)})}},y(e,"$name","PrintMixin"),e},Th=class extends Gm(is){};y(Th,"$name","Print"),Th._$name="Print",K.registerFeature(Th,!1,"Grid");var Mh=class extends ${static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"\xA0\xA0\xA0\xA0"}}export(i={}){const e=this;return i=T.assign({},e.config,i),e.normalizeColumns(i),e.generateExportData(i)}generateExportData(i){const e=this,t=e.generateColumns(i);return{rows:e.generateRows(i),columns:t}}normalizeColumns(i){var e,t;const r=i.columns||(i.exportAllColumns?(e=this.target.columns)==null?void 0:e.records:(t=this.target.columns)==null?void 0:t.visibleColumns).filter(n=>n.exportable!==!1);i.columns=r.map(n=>typeof n=="string"?this.target.columns.find(s=>s.field===n)||{field:n}:n)}generateColumns(i){return i.columns.map(e=>this.processColumn(e,i))}generateRows(i){var e;const{columns:t,rows:r}=i;if(t.length===0||(r==null?void 0:r.length)===0)return[];const n=this,{target:s}=n,a=(r||s.store).map(l=>n.processRecord(l,t,i)).filter(l=>l==null?void 0:l.length);if((e=s.features.summary)!=null&&e.enabled){const l=document.createElement("div"),o=t.map(d=>(l.innerHTML=s.features.summary.generateHtml(d,r||s.store.records),l.innerText));a.push(o)}return a}getColumnType(i,e=this.target.store){let t=i.exportedType||"object";if(i.exportedType===void 0&&i.field){const r=e.modelClass.getFieldDefinition(i.field);r&&r.type!=="auto"&&(t=r.type)}return t}processColumn(i,e){const t=this,{target:r}=t,{defaultColumnWidth:n}=e;let{field:s,text:a,width:l,minWidth:o}=i;if(r.store&&!(s in r.store.modelClass.fieldMap)&&(s=""),!a||!l){const d=r.columns.find(c=>c.field===s);a||(a=d&&(d.text||d.headerRenderer&&d.textElement.innerText)||s),l==null&&(l=d&&d.width||n)}return l=Math.max(l||n,o||n),{field:s,value:a,width:l,type:t.getColumnType(i)}}processRecord(i,e,t){const{target:r}=this,{showGroupHeader:n,indent:s,indentationSymbol:a}=t;let l;if(!i)l=e.map(()=>"");else if(i.isSpecialRow){if(n&&"groupRowFor"in i.meta&&(l=e.map(o=>r.features.group.buildGroupHeader({cellElement:E.createElement(),grid:r,isExporting:!0,record:i,column:o,isExport:!0}))),i.meta.groupFooterFor&&!r.isTimelineBase){const o=document.createElement("div"),d=i.groupChildren.slice();d.pop(),l=e.map(c=>(o.innerHTML=r.features.groupSummary.generateHtml(c,d,i,r.features.group.field,i._groupValue),o.innerText))}}else l=e.map(o=>{var d;let c=i.getValue(o.field);const u=o.renderer;return u&&!(c&&o.isDateColumn&&t.exportDateAsInstance)&&(c=(d=u.call(o,{value:c,record:i,column:o,grid:r,isExport:!0}))!=null?d:c),s&&o.tree&&(c=`${a.repeat(i.childLevel)}${c}`),c});return l}};Mh._$name="TableExporter";var Ym=class{static write(i){throw new Error("XlsProviderBase#write must be implemented in a subclass")}};Ym._$name="XlsProviderBase";var DF={string:String,number:Number,date:Date,boolean:Boolean,bool:Boolean},qm=class extends Ym{static write({filename:i,columns:e,rows:t}){t.forEach(r=>{r.forEach(n=>{n.type=DF[n.type]||String,n.type===String&&typeof n.value!="string"&&(n.value=`${n.value}`)})}),e.map(r=>{delete r.type,delete r.field,r.fontWeight="bold",r.align="center"}),globalThis.writeXlsxFile([e,...t],{dateFormat:"yyyy-mm-dd",fileName:i,columns:e.map(r=>({width:Math.round((r.width||100)/10)}))})}};qm._$name="WriteExcelFileProvider";var il=class extends ie{processValue(i){return i==null||Number.isNaN(i)||typeof i=="function"||typeof i=="object"&&String(i)==="[object Object]"?"":i}generateExportData(i){const e=this,{rows:t,columns:r}=e.exporter.export(i.exporterConfig);return{rows:t.map(n=>n.map((s,a)=>{var l;let o=((l=r[a])==null?void 0:l.type)||"string";return(o==="object"||o==="auto")&&(o="string"),s instanceof Date?i.dateFormat?(s=C.format(s,i.dateFormat),o="string"):(s=$e.fromTimeZone(s,0),o="date"):o==="number"&&typeof s=="string"&&(s=parseFloat(s.replace(/^\D*/,""))),e.convertEmptyValueToEmptyString?s=e.processValue(s):o==="string"&&typeof s!="string"&&(s=`${s}`),{value:s,type:o}})),columns:r}}async export(i={}){var e;const t=this,{client:r}=t,n=((e=t.xlsProvider)==null?void 0:e.write)||t.zipcelx||globalThis.zipcelx;if(!n)throw new Error('ExcelExporter: "xlsProvider" or "zipcelx" library is required');if(t.disabled)return;i=T.assign({},t.config,i),i.filename||(i.filename=r.$$name);const{filename:s}=i,{rows:a,columns:l}=t.generateExportData(i);if(i.csv){const o=i.csv.columnDelimiter||",",d=i.csv.lineDelimiter||`
`;if(r.trigger("beforeCSVExport",{config:i,rows:a,columns:l,lineDelimiter:d,columnDelimiter:o})!==!1){const c=l.map(f=>this.processCsvValue(f.value)).join(o)+d,u=a.map(f=>f.map(m=>this.processCsvValue(m.value)).join(`${o}`)).join(d),h=new Uint8Array([239,187,191]),g=new Blob([h,c+u],{type:t.csvMimeType});Y.downloadBlob(g,s)}return Promise.resolve()}if(r.trigger("beforeExcelExport",{config:i,rows:a,columns:l})!==!1){const o={filename:s,columns:l,rows:a};return re.checkVersion("core","7.0","<")&&(o.sheet={},o.sheet.data=[...a.map(d=>d.map((c,u)=>{var h;return{...c,type:((h=l[u])==null?void 0:h.type)==="number"&&typeof value!="string"?"number":"string"}}))],o.sheet.cols=l.map(d=>({...d,type:"string"})),o.sheet.data.unshift(o.sheet.cols)),n(o)}return Promise.resolve()}processCsvValue(i=""){return`"${String(i).replace(/"/g,'""')}"`}construct(i,e){super.construct(i,e),this.zipcelx||typeof zipcelx!="undefined"&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const i=this;return i._exporter||(i._exporter=i.exporterClass.new({target:i.client},i.exporterConfig))}};y(il,"$name","ExcelExporter"),y(il,"configurable",{filename:null,dateFormat:re.checkVersion("core","7.0",">=")?null:"YYYY-MM-DD",exporterClass:Mh,exporterConfig:null,xlsProvider:re.checkVersion("core","7.0",">=")?qm:null,csvMimeType:"text/csv",zipcelx:null,convertEmptyValueToEmptyString:!0,exportAllColumns:!1}),il._$name="ExcelExporter",K.registerFeature(il,!1,"Grid");var _h=class extends ie{construct(i,e){const t=this;super.construct(i,e),V.on({element:i.element,thisObj:t,drop:t.onFileDrop,dragover:t.onFileDragOver,dragenter:t.onFileDragEnter,dragleave:t.onFileDragLeave})}onFileLoad(i){this.client.trigger("fileDrop",{file:this.file,domEvent:i})}onFileDragEnter(){this.client.element.classList.add("b-dragging-file")}onFileDragOver(i){i.preventDefault()}onFileDragLeave(i){const{element:e}=this.client;i.relatedTarget&&!e.contains(i.relatedTarget)&&this.client.element.classList.remove("b-dragging-file")}onFileDrop(i){i.preventDefault();const e=i.dataTransfer.items[0].getAsFile();this.client.trigger("fileDrop",{file:e,domEvent:i}),this.onFileDragLeave(i)}};y(_h,"$name","FileDrop"),_h._$name="FileDrop",K.registerFeature(_h,!1,"Grid");var Km=document.createRange(),rl=class extends ${construct(i){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new Se({grid:i.grid,id:null,columnIndex:0})}),super.construct(i),this.grid.positionMode==="position"&&(this.translateElements=this.positionElements)}doDestroy(){const i=this;i.rowManager.isDestroying||(i.removeElements(),i.rowManager.idMap[i.id]===i&&delete i.rowManager.idMap[i.id]),super.doDestroy()}get index(){return this._index}set index(i){this._index=i}get dataIndex(){return this._dataIndex}set dataIndex(i){this._dataIndex!==i&&(this._dataIndex=i,this.eachElement(e=>{e.dataset.index=i,e.ariaRowIndex=this.grid.hideHeaders?i+1:i+2}))}get id(){return this._id}set id(i){const e=this,t={id:i},r=e.rowManager.idMap;(e._id!==i||r[i]!==e)&&(r[e._id]===e&&delete r[e._id],r[i]=e,e._id=i,e.eachElement(n=>{Oe.assign(n,t),n.dataset.id=i}),e.eachCell(n=>Oe.assign(n,t)))}addElement(i,e){const t=this,{dataIndex:r}=t;let n=e.firstElementChild;for(t._elements[i]=e,t._elementsArray.push(e),t._regions.push(i),Oe.assign(e,{index:t.index}),t._cells[i]=[];n;){const{column:s,columnId:a}=n.dataset;t._cells[i].push(n),t._allCells.push(n),Oe.set(n,{column:s,columnId:a,rowElement:n.parentNode,row:t}),n=n.nextElementSibling}e.dataset.index=r,e.ariaRowIndex=t.grid.hideHeaders?r+1:r+2,t.lastTop=null,t.top!==null&&t.translateElements(!0)}getElement(i){return this._elements[i]}getRectangle(i){return L.from(this.getElement(i))}eachElement(i){this._elementsArray.forEach(i)}eachCell(i){this._allCells.forEach(i)}get elements(){return this._elements}get element(){const i=Object.keys(this._elements)[0];return this._elements[i]}get cells(){return this._allCells}getCells(i){return this._cells[i]}getCell(i,e=!1){return this._allCells.find(t=>{const r=Oe.get(t);return r.columnId==i||!e&&r.column==i})}removeElements(i=!1){const e=this;e.rowManager.trigger("removeRow",{row:e}),i||e.eachElement(t=>t.remove()),e._elements={},e._cells={},e._elementsArray.length=e._regions.length=e._allCells.length=e.lastHeight=e.height=0,e.lastTop=-1}get height(){return this._height}set height(i){this.cls["b-rowexpander-row-expanded"]||this.setProperty("--b-grid-row-height",i===this.grid.rowHeight?"":E.setLength(i)),this._height=i}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(i){const e=this;i||e.rowManager.storeKnownHeight(e.id,e.height),e.lastHeight!==e.height&&(this.eachElement(t=>t.style.height=`${e.offsetHeight}px`),e.lastHeight=e.height)}addCls(i){this.updateCls(this.cls.add(i))}removeCls(i){this.updateCls(this.cls.remove(i))}toggleCls(i,e){this.updateCls(this.cls[e?"add":"remove"](i))}assignCls(i){this.updateCls(this.cls.assign(i))}changeCls(i){return new te(i)}updateCls(i){this.eachElement(e=>E.syncClassList(e,i))}setAttribute(i,e){this.eachElement(t=>t.setAttribute(i,e))}removeAttribute(i){this.eachElement(e=>e.removeAttribute(i))}setProperty(i,e){this.eachElement(t=>t.style.setProperty(i,e))}get isFirst(){return this.dataIndex===0}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(i,e){this._top!==i&&(this._top=i,this.translateElements(e))}setBottom(i,e){this.setTop(i-this.offsetHeight,e)}translate(i,e=!1){return this.setTop(i,e),i+this.offsetHeight}translateElements(i){const e=this,{top:t,_elementsArray:r}=e;if(e.lastTop!==t){for(let n=0,{length:s}=r;n<s;n++)r[n].style.transform=`translate(0,${t}px)`;!i&&e.rowManager.trigger("translateRow",{row:e}),e.lastTop=t}}positionElements(i){const e=this,{top:t,_elementsArray:r}=e;if(e.lastTop!==t){for(let n=0,{length:s}=r;n<s;n++)r[n].style.top=`${t}px`;!i&&e.rowManager.trigger("translateRow",{row:e}),e.lastTop=t}}offset(i){let e=this._top+i;return e<0&&(i-=e,e=0),this.setTop(e),i}renderPlaceholder(i,e,t,r,n){const s=this,{rowManager:a}=s,{rowHeight:l}=a;s.addCls("b-row-placeholder"),s.height!==l&&(s.height=l,s.updateElementsHeight(!0),a.bufferedTranslateFromRow(s)),s.dataIndex=i,e.then(o=>{o&&s.dataIndex===i&&s.grid.store.indexOf(o)===i&&s.render(i,o,t,r,n,!0)})}render(i,e,t=!0,r=!1,n=!1,s=!1){var a,l,o,d;const c=this,{cellContext:u,cls:h,elements:g,grid:f,rowManager:m,height:p,_id:v}=c,b=Oe.get(c._elementsArray[0]),w=m._rowHeight,{store:D}=f,S=f.features.tree&&D.isTree;let x=0,R;if(!e&&e!==!1){if(i!=null&&(e=(a=D.lazyLoad)==null?void 0:a.getAt(i),e&&!e.isModel))return c.renderPlaceholder(i,e,t,r,n);e||(e=D.getById(b.id),i=D.indexOf(e))}if(!e)return;c.removeCls("b-row-placeholder");const M=e==null?void 0:e.cls,_=M?M.isDomClassList?M:new te(M):null;h.assign({"b-grid-row-updating":t&&f.transitionDuration&&!n,"b-selected":f.isSelected(e==null?void 0:e.id),"b-readonly":e.readOnly,"b-linked":e.isLinked,"b-original":e.hasLinks}),c.lastRecordCls&&h.remove(c.lastRecordCls),_?(h.add(_),c.lastRecordCls=Object.assign({},_)):c.lastRecordCls=null,m.trigger("beforeRenderRow",{row:c,record:e,recordIndex:i,oldId:v}),f.beforeRenderRow({row:c,record:e,recordIndex:i,oldId:v,cls:h}),c.updateCls(h),t&&f.transitionDuration&&!n&&f.setTimeout(()=>{c.isDestroyed||(h.remove("b-grid-row-updating"),c.updateCls(h))},f.transitionDuration+50),c.id=e.id,c.dataIndex=i;const k=!f.fixedRowHeight&&f.getRowHeight(e)||w;let F=c.maxRequestedHeight=null;if(S)for(const A in g){const P=g[A];P.id=`${f.id}-${A}-${c.id}`,E.setAttributes(P,{"aria-level":e.childLevel+1,"aria-setsize":e.parent.children.length,"aria-posinset":e.parentIndex+1}),e.isExpanded(D)?E.setAttributes(P,{"aria-expanded":!0,"aria-owns":(l=e.children)!=null&&l.length?(o=e.children)==null?void 0:o.map(H=>`${f.id}-${A}-${H.id}`).join(" "):null}):(e.isLeaf?P.removeAttribute("aria-expanded"):P.setAttribute("aria-expanded",!1),P.removeAttribute("aria-owns"))}for(u._record=e,u._id=e.id,u._rowIndex=i,x=0;x<f.columns.visibleColumns.length;x++){const A=f.columns.visibleColumns[x];u._columnId=A.id,u._column=A,u._columnIndex=x,u._cell=c.getCell(A.id,!0),u.height=k,u.maxRequestedHeight=F,u.updatingSingleRow=t,R=c.renderCell(u),m.fixedRowHeight||R.height!=null&&(F=Math.max(F,R.height),R.transient||(c.maxRequestedHeight=F))}const I=F!=null?F:k;c.height=(d=f.processRowHeight(e,I))!=null?d:I,c.updateElementsHeight(n),s&&p!==c.height&&m.bufferedTranslateFromRow(c,r),t&&!n&&(p!==c.height&&m.translateFromRow(c,r),m.trigger("updateRow",{row:c,record:e,recordIndex:i,oldId:v}),m.trigger("renderDone")),f.afterRenderRow({row:c,record:e,recordIndex:i,oldId:v,oldHeight:p,isExport:n}),m.trigger("renderRow",{row:c,record:e,recordIndex:i,oldId:v,isExport:n}),p&&c.height!==p&&m.trigger("rowRowHeight",{row:c,record:e,height:c.height,oldHeight:p}),c.forceInnerHTML=!1}renderCell(i){var e;i.isLocation||(i=new Se(i));let{cell:t,record:r}=i;const{grid:n,column:s,height:a,maxRequestedHeight:l,updatingSingleRow:o=!0,isMeasuring:d=!1}=i,c=(e=n.features)==null?void 0:e.cellEdit,u=Oe.get(t),h=u.rowElement,g=Oe.get(h);if(!r&&(r=i._record=n.store.getById(g.id),!r))return;let f=s.getRawValue(r);const m=r.fieldMap[s.field],p={configuredHeight:a,height:null,maxRequestedHeight:l},v=s.getCellClass(i),b={cellElement:t,cellCls:v,dataField:m,rowElement:h,value:f,record:r,column:s,size:p,grid:n,row:u.row,updatingSingleRow:o,isMeasuring:d,isExport:!1},w=s.renderer;s.readOnly||r.readOnly||n.readOnly?t.setAttribute("aria-readonly",!0):t.removeAttribute("aria-readonly"),n.beforeRenderCell(b),b.cellElement!==t&&(t=b.cellElement),E.syncClassList(t,v);let D=!0;Z.isPromise(f)||(w?(f=s.callback(w,s,[b]),f===void 0&&(r.generatedParent&&s.rendererReturningContent?f="":s.alwaysClearCell===!1&&(D=!1))):m&&(f=m.print(f)));const S={cellContent:f,size:p,grid:n,isMeasuring:d,cellContext:i,cellElementData:u,rendererData:b,shouldSetContent:D,cellEdit:c,record:r,column:s,cellElement:t};return Z.isPromise(f)?(t.classList.add("b-loading-cell"),f.then(x=>{this.isDestroyed||(t.classList.remove("b-loading-cell"),n.getRecordFromElement(t)===r&&this.updateCellContent({...S,cellContent:x}))}),p):this.updateCellContent(S)}updateCellContent({cellContent:i,size:e,grid:t,isMeasuring:r,cellContext:n,cellElementData:s,rendererData:a,shouldSetContent:l,cellEdit:o,record:d,column:c,cellElement:u}){var h,g,f;const m=(h=t.hasFrameworkRenderer)==null?void 0:h.call(t,{cellContent:i,column:c});m&&d.isSpecialRow&&(i="");const p=m&&!c.data.tree&&!d.isSpecialRow;if(l&&!p){let v=u;((g=o==null?void 0:o.editorContext)==null?void 0:g.column)===c&&!o.editor.isFinishing&&(o!=null&&o.editorContext.equals(n)?v=this.moveContentFromCell(u,o.editor.element):v.classList.remove("b-editing"));const b=i!=null&&typeof i=="object",w=typeof i=="string",D=b||i==null?"":String(i);if(this.forceInnerHTML&&(v.innerHTML="",delete v._content,u.lastDomConfig=null),!b&&c.htmlEncode&&!c.disableHtmlEncode?(u._hasHtml?(v.innerText=D,u._hasHtml=!1):E.setInnerText(v,D),delete v._content):c.autoSyncHtml&&(!w||E.getChildElementCount(v))?w?E.sync(D,v.firstElementChild):b&&(oe.sync({domConfig:i,targetElement:v}),delete v._content):b?(oe.sync({targetElement:v,domConfig:{onlyChildren:!0,children:B.asArray(i)}}),delete v._content):v._content!==D&&(v.innerHTML=v._content=D),v!==u){const{firstChild:S}=u;for(const x of[...v.childNodes])u.insertBefore(x,S);u.classList.add("b-editing","b-focused")}}return d.isSpecialRow||(f=t.processCellContent)==null||f.call(t,{cellElementData:s,rendererData:a,rendererHtml:a.rendererHtml||i}),c.autoHeight&&e.height==null&&(u.classList.add("b-measuring-auto-height"),e.height=Math.max(u.offsetHeight,t.rowHeight),u.classList.remove("b-measuring-auto-height")),r||this.rowManager.trigger("renderCell",a),c.afterRenderCell&&c.callback(c.afterRenderCell,c,[a]),e}moveContentFromCell(i,e){e.parentNode||i.appendChild(e),Km.setStart(i,0),Km.setEndBefore(e);const t=document.createElement("div");return t.appendChild(Km.extractContents()),t.classList.add("b-editing"),t}};y(rl,"$name","Row"),y(rl,"configurable",{cls:{$config:{equal:(i,e)=>(i==null?void 0:i.isDomClassList)&&(e==null?void 0:e.isDomClassList)&&i.isEqual(e)}}}),rl.initClass(),rl._$name="Row";var rs=class extends z{static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"},role:null}}get columns(){return this._columns||this.subGrid.columns}set columns(i){this._columns=i}fixCellWidths(){const i=this,{hasFlex:e}=i.columns;let t;i.columns.traverse(r=>{const n=i.getBarCellElement(r.id),s=E.setLength(r.width),a=E.setLength(r.minWidth),l=E.setLength(r.maxWidth);if(n){if(t=s,n.style.maxWidth=l,r.isParent&&r.width==null&&r.flex==null){const o=r.children.reduce((d,c)=>d+=!c.hidden&&c.flex||0,0);n.style.flex=o>0?`${o} 0 auto`:"",n.style.minWidth=null,o>0&&r.traverse(d=>d.data.minWidth=null)}else if(parseInt(r.minWidth)>=0&&(n.style.minWidth=a),n.style.flex=n.style.flexBasis=n.style.width="",r.flex)!isNaN(parseInt(r.flex))&&r.children?n.style.flex=`${r.flex} 0 auto`:n.style.flex=r.flex;else if(parseInt(r.width)>=0){const o=r.parent;i.isHeader&&!o.isRoot&&!o.width?n.style.width=s:n.style.flexBasis=t}r.height>=0&&(n.style.height=E.setLength(r.height))}}),i.scrollable.element.classList.toggle("b-has-flex",e)}getLrPadding(i){if(!this.cellLrPadding){const e=i.ownerDocument.defaultView.getComputedStyle(i);this.cellLrPadding=parseInt(e.getPropertyValue("padding-left"))+parseInt(e.getPropertyValue("padding-right"))+parseInt(e.getPropertyValue("border-left-width"))+parseInt(e.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(i){return this.element.querySelector(`[data-column-id="${i}"]`)}};y(rs,"$name","Bar"),y(rs,"type","gridbar"),rs.initClass(),rs._$name="Bar";var nl=class extends rs{get subGrid(){return this._subGrid}set subGrid(i){this._subGrid=this.owner=i}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onInternalPaint({firstPaint:i}){i&&this.refreshContent()}template(){const i=this.subGrid.region;return Pt.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${i}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${i}" data-region="${i}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(i){return this.getBarCellElement(i)}contentTemplate(){return this.columns.visibleColumns.map(e=>Pt.tpl`
                <div
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    role="gridcell">
                    ${e.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}};y(nl,"$name","Footer"),y(nl,"type","gridfooter"),nl.initClass(),nl._$name="Footer";var EF=i=>{const e=i.parentElement,t=i.cloneNode(!0);return t.classList.add("b-removing"),e.insertBefore(t,i),t},nr,ns,Wd=class extends ie.mixin(fe){static get pluginConfig(){return{chain:["destroy"],assign:["topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{rowClass:rl,prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(i){i.grid._rowManager=this,super.construct(i.grid,i)}doDestroy(){this.removeAllRows(),super.doDestroy()}initWithHeight(i,e=!1){const t=this;return t.autoHeight&&(i=t.store.count*t.preciseRowOffsetHeight),t.viewHeight=i,t.calculateRowCount(e),i}reinitialize(i=!1){const e=this;e.calculateRowCount(!1,!0,!0),e.topIndex+e.rowCount-1>e.storeCount&&(i=!0),i&&(e.topIndex=e.lastScrollTop=0),e.scrollTargetRecordId=null;const{topRow:t}=e;t&&(t.dataIndex=e.topIndex,t.setTop(e.calculateTop(e.topIndex),!0)),e.estimateTotalHeight(),e.renderFromRow(t)}matchRowCount(i=!1){var e;const t=this,{rows:r,grid:n,rowClass:s}=t,a=r.length,l=a-t.rowCount;if(l)if(l<0){const o=[];for(let d=a,c=a?r[a-1].dataIndex+1:0;d<t.rowCount;d++,c++)o.push(s.new({cls:n.rowCls,rowManager:t,grid:n,index:d,dataIndex:c}));r.push.apply(r,o),t.trigger("addRows",{rows:o}),i||t.renderFromRow(r[Math.max(0,a-1)])}else{const o=(e=E.getActiveElement(n))==null?void 0:e.closest(".b-grid-cell"),d=r.splice(a-l,l);a!==l&&d.some(c=>c.cells.includes(o))&&r[r.length-1].cells[n.focusedCell.columnIndex].focus(),t.trigger("removeRows",{rows:d}),d.forEach(c=>c.destroy()),!i&&r.length&&t.fillBelow(t.lastScrollTop)}}calculateRowCount(i=!1,e=!0,t=!1){var r,n;const s=this,{storeCount:a}=s,l=Math.ceil(s.viewHeight/s.minRowOffsetHeight),o=l+s.prependRowBuffer+s.appendRowBuffer;if(!((r=s.grid.columns)!=null&&r.count)||isNaN(l))return s.rowCount=0,0;if(o<s.rowCount&&!e)return s.rowCount;if(s.visibleRowCount=l,s.rowCount=Math.min(a,o),!i){if(s.rows&&s.rowCount!==s.rows.length){if(s.matchRowCount(t),((n=s.bottomRow)==null?void 0:n.dataIndex)>=a&&s.topRow.dataIndex!==0){const d=s.bottomRow.dataIndex-a+1;for(const c of s.rows)c.dataIndex-=d;s.topIndex-=d}}else s.rowCount||s.trigger("changeTotalHeight",{totalHeight:s.totalHeight});s.grid.toggleEmptyText()}return s.rowCount}insert(i,e){var t,r,n,s,a;nr==null||nr();const l=this,{rows:o,rowCount:d,rowClass:c,grid:u}=l,{element:h}=u,{rowCls:g}=u,f=((t=o[i-1])==null?void 0:t.dataIndex)+1||0,m=[],p=C.as("ms",E.getStyleValue(u.element,"--row-splice-duration")),v=l.lastVisibleRow.index+1-i;let b;if(e<0){e=Math.abs(e);const w=f>=u.store.count?e:Math.min(e,v),D=o.slice(i,i+w),S=w?D[D.length-1].bottom-D[0].top:0,x=[],R=[],M=[];for(let _=0,{length:k}=D;_<k;_++){const F=D[_]._elementsArray.map(EF);R.push(c.new({rowManager:l,_elementsArray:F,grid:u})),x.push(...F)}for(let _=i;_<d;_++)M.push(o[_]),o[_].addCls("b-repositioning"),o[_].setTop(o[_].top+S);b=o.length>u.store.count,(r=x[0])==null||r.getBoundingClientRect(),h.classList.add("b-splicing-rows");for(let _=0,{length:k}=D;_<k;_++)R[_].setTop(((n=o[i-1])==null?void 0:n.bottom)||0,!0);nr=()=>{ns&&!l.isDestroyed&&(ns=ns(),nr=null,h.classList.remove("b-splicing-rows"),x.forEach(_=>_.remove()),M.forEach(_=>{var k;return(k=_.removeCls)==null?void 0:k.call(_,"b-repositioning")}))}}else if(e>0){const w=[];e=l.grid.hasVerticalOverflow?Math.min(e,l.lastVisibleRow.index+1-i):Math.min(e,Math.ceil((l.grid.scrollable.clientHeight-(((s=o[i-1])==null?void 0:s.bottom)||0))/l.rowHeight));let D=i,S=f;for(let x=0;x<e;x++,D++,S++)m.push(c.new({cls:`${g} b-adding`,rowManager:l,_top:((a=o[i-1])==null?void 0:a.bottom)||0,grid:u,index:D,dataIndex:S}));for(let x=i;x<l.rowCount;x++,D++,S++)w.push(o[x]),o[x].addCls("b-repositioning"),o[x].index=D,o[x].dataIndex=S;b=m.length,nr=()=>{ns&&!l.isDestroyed&&(ns=ns(),nr=null,h.classList.remove("b-splicing-rows"),m.forEach(x=>!x.isDestroyed&&x.removeCls("b-adding")),w.forEach(x=>{var R;return(R=x.removeCls)==null?void 0:R.call(x,"b-repositioning")}))},o.splice(i,0,...m),e>0&&(l.rowCount+=e,l.trigger("addRows",{rows:m})),h.classList.add("b-splicing-rows")}return ns=V.on({element:u.element,animationcancel:nr,transitioncancel:nr,once:!0,expires:{delay:p,alt:nr}}),l.renderFromRow(o[i],!0),b&&l.calculateRowCount(!1,!0,!0),l.estimateTotalHeight(),m}removeAllRows(){const i=this,{topRow:e}=i,t=e?i.refreshDetails={topRowIndex:e.dataIndex,topRowTop:e.top}:i.refreshDetails,r=i.rows.slice();return i.trigger("removeRows",{rows:r}),i.rows.forEach(n=>n.destroy()),i.rows.length=0,i.idMap={},t}setPosition(i){const{topRow:e}=this,{topRowIndex:t,topRowTop:r}=i;e&&(e.setTop(r),e.dataIndex=t)}get store(){return this.client.store}get storeCount(){let{count:i,lazyLoad:e}=this.store;return i&&e&&e.totalCount==null&&(i+=e.chunkSize),i}get rows(){return this._rows}getRow(i){if(this.rowCount)return this.rows[i-this.topIndex]}getRowById(i){return i&&i.isModel&&(i=i.id),this.idMap[i]}getRowFromElement(i){return i=i.closest(".b-grid-row"),i&&this.getRow(i.dataset.index)}getRowAt(i,e=!1){return e||(i-=L.from(this.grid.bodyContainer,null,!0).roundPx(1).top,i+=this.grid.scrollable.y),i=E.roundPx(i),this.rows.find(t=>i>=t.top&&i<t.bottom)}getRowFor(i){return i instanceof HTMLElement?this.getRowFromElement(i):this.getRowById(i)}getNextRow(i){const e=typeof i=="number"?i:i.index;return this.getRow((e+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const i=Math.min(this.rowCount,this.storeCount);return this.rows[i-1]}get firstVisibleRow(){const i=Math.ceil(this.grid.scrollable.y);return this.rows.find(e=>e.bottom>i)}get firstFullyVisibleRow(){const i=Math.ceil(this.grid.scrollable.y);return this.rows.find(e=>e.top>=i)||this.rows.find(e=>e.top<i&&e.bottom>i)}get lastVisibleRow(){const{grid:i}=this;return B.findLast(this.rows,e=>e.top<i.scrollable.y+i.bodyHeight)}get lastFullyVisibleRow(){const{grid:i}=this;return B.findLast(this.rows,e=>e.bottom<i.scrollable.y+i.bodyHeight)}offsetRows(i){if(i!==0){const{rows:e}=this,{length:t}=e;for(let r=0;r<t;r++)e[r].offset(i)}this.trigger("offsetRows",{offset:i})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(i){const e=this,{grid:t,fixedRowHeight:r}=e,n=e.rowHeight;if(n!==i){if(T.assertNumber(i,"rowHeight",!0),i<10&&(i=10),e.trigger("beforeRowHeight",{height:i}),e.minRowHeight=e._rowHeight=i,r&&(e.averageRowHeight=i),e.rows.length){const s=t.scrollable.y,a=e.getRowAt(s,!0),l=a?a.top-s:0;let o,d;r?(o=i,d=n):(d=o=e.averageRowHeight,e.clearKnownHeights(),o*=i/n),e.calculateRowCount(!1,!0,!0),e.topRow.setTop(e.topRow.dataIndex*(o+t._rowBorderHeight),!0),e.refresh(),s*(o/d)!==s&&t.scrollRowIntoView(a.id,{...t.defaultScrollOptions,block:"start",edgeOffset:l})}e.trigger("rowHeight",{height:i,oldHeight:n})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.storeCount}storeKnownHeight(i,e){const t=this,{heightMap:r}=t;t.fixedRowHeight||(r.has(i)&&(t.totalKnownHeight-=r.get(i)),r.set(i,e),t.totalKnownHeight+=e,e<t.minRowHeight&&(t.minRowHeight=e),t.averageRowHeight=t.totalKnownHeight/r.size)}getOffsetHeight(i){const e=this;return(i&&e.heightMap.get(i.id)||i&&e.grid.getRowHeight(i)||e.averageRowHeight||e.rowHeight)+e.grid._rowBorderHeight}invalidateKnownHeight(i){const e=this;if(!e.fixedRowHeight){const{heightMap:t}=e;i=B.asArray(i),i.forEach(r=>{r&&t.has(r.id)&&(e.totalKnownHeight-=t.get(r.id),t.delete(r.id))}),e.averageRowHeight=e.totalKnownHeight/t.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(i){if(this.fixedRowHeight)return i*this.rowOffsetHeight;const{storage:e}=this.store;let t=0;for(let r=0;r<i;r++){const n=e.getAt(r);t+=this.getOffsetHeight(n)}return Math.floor(t)}getRecordCoords(i,e=!1,t=!1){const r=this,n=r.getRowById(i);let s=r.client._bodyRectangle;if(e||(s=r.client.refreshBodyRectangle()),n)return new L(s.x,Math.round(e?n.top:n.top+s.y-r.client.scrollable.y),Math.max(s.width,0),n.offsetHeight);const a=r.store.indexOf(i);return a!==-1?r.getRecordCoordsByIndex(a,e,t):null}getRecordCoordsByIndex(i,e=!1,t=!1){var r;const n=this,{topRow:s,bottomRow:a}=n,l=n.client._bodyRectangle,{id:o}=n.store.getAt(i),d=n.preciseRowOffsetHeight,c=s.dataIndex,u=a.dataIndex,h=Math.floor((r=n.heightMap.get(o))!=null?r:d);let g;if(n.allHeightsKnown&&!t){const m=n.calculateTop(i);g=e?m:m+l.y-n.client.scrollable.y}else{const m=i>u?{index:i-u-1,y:a.bottom,from:"bottomRow"}:i>c/2?{index:i-c,y:s.top,from:"topRow"}:{index:i,y:0,from:"top"},p=Math.floor(m.y+m.index*d);g=e?m.from==="topRow"?p+d-h:p:p+l.y-n.client.scrollable.y}const f=new L(l.x,g,l.width,h);return f.virtual=!0,f.block=f.bottom<l.y?"start":f.y>l.bottom?"end":"nearest",f}get totalHeight(){return this._totalHeight}forEach(i){this.rows.forEach(i)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(i,e){const t=new Se({grid:this.grid,record:i,columnId:e});return!!(t.cell&&t.row.renderCell(t))}returnToTop(){const i=this;i.topIndex=0,i.lastScrollTop=0,i.topRow&&(i.topRow.dataIndex=0,i.topRow.setTop(0,!0)),i.refresh(),i.grid.scrollable.y=0}renderFromRecord(i){const e=this.getRowById(i.id);e&&this.renderFromRow(e)}renderFromRow(i=null,e){const t=this,{rows:r,store:n,topIndex:s,topRow:a,storeCount:l}=t;let o=i?r.indexOf(i):0;if(t.calculateRowCount(!1,l<r.length&&!e,!0)===0||o>=r.length){t.estimateTotalHeight(!0);return}t.topIndex<s?(t.topRow.setTop(t.calculateTop(t.topIndex),!0),o=0,i=t.topRow):i&&r.indexOf(i)<0&&(i=r[o]||a);let d=i?i.dataIndex:r[0].dataIndex;const c=l-d-1,u=Math.min(r.length-1,o+c);let h=r.length-u-1,g=o>0?r[o-1].bottom:r[o].top,f;const m=[];for(let p=o;p<=u;p++)f=r[p],f.dataIndex=d,e?m[p]=g:f.setTop(g,!0),f.render(d,n.getAt(d++),!1),g+=f.offsetHeight;if(e){r[o].element.getBoundingClientRect();for(let p=o;p<=u;p++)r[p].setTop(m[p],!0)}for(;h-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight+t.lastScrollTop&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(i){let e,t=!1;i=Array.from(i),i.sort((r,n)=>r.dataIndex-n.dataIndex);for(const r of i)e=r.height,r.render(null,null,!1),t|=r.height!==e;t&&this.translateFromRow(i[0]),this.trigger("renderDone")}bufferedTranslateFromRow(){this.translateFromRow(this.topRow)}translateFromRow(i,e=!1){const t=this;let r=i.bottom,n,s;for(s=i.dataIndex+1,n=t.getRow(s);n;n=t.getRow(++s))r=n.translate(r);e||t.estimateTotalHeight(!0)}refresh(i=!1){const e=this,{topRow:t}=e;!t&&!i||e.grid.refreshSuspended||(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(i,e){const t=this,{store:r,heightMap:n,storeCount:s}=t;if(t.allHeightsKnown&&!t.fixedRowHeight){const a=i-t.prependBufferHeight,l=t.grid._rowBorderHeight;let o=0,d=0;for(;o<a;){const u=r.records[d];o+=n.get(u.id)+l,d++}const c=Math.max(Math.min(d,s-t.rowCount),0);t.lastScrollTop=i,t.topRow.dataIndex=t.topIndex=c,t.topRow.setTop(t.calculateTop(c),!1),t.refresh()}else{const a=t.preciseRowOffsetHeight,l=e==null?Math.floor(i/a)-t.prependRowBuffer:e-Math.floor(t.rowCount/2),o=Math.max(Math.min(l,s-t.rowCount),0),d=t.client.scrollable.y,c=Math.min(t.client._bodyRectangle.height+d+t.appendBufferHeight,t.totalHeight);if(t.lastScrollTop=i,t.topRow.dataIndex=t.topIndex=o,t.topRow.setTop(Math.floor(o*a),!1),t.refresh(),t.bottomRow.bottom<c)for(t.calculateRowCount(!1,!1,!1);t.bottomRow.bottom<c&&t._rows[t.prependRowBuffer].top<d&&t.bottomRow.dataIndex<s-1;)t.displayRecordAtBottom();t.estimateTotalHeight()}if(e!=null){const{scrollable:a}=t.grid,l=t.getRow(e),o=l&&L.from(l._elementsArray[0]).center.y,d=a.viewport.center.y;l&&(a.y=i=Math.floor(a.y+(o-d)))}return i}warpIfNeeded(i){const e=this,t={newScrollTop:i,deltaTop:i-e.lastScrollTop};if(Math.abs(t.deltaTop)>e.rowCount*e.rowOffsetHeight*3){let r;e.scrollTargetRecordId&&(r=e.store.indexOf(e.scrollTargetRecordId)),e.grid.onFocusedRowDerender(),t.newScrollTop=e.jumpToPosition(i,r),t.deltaTop=0}return t}updateRenderedRows(i,e,t=!1){const r=this;if(r.rowCount===0)return 0;let n=r.totalHeight;if(e||Math.abs(i-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>i||r.bottomRow.bottom<i+r.viewHeight){const s=r.warpIfNeeded(i);r.scrollTargetRecordId=null,r.lastScrollTop=s.newScrollTop,s.deltaTop>0?r.fillBelow(s.newScrollTop):s.deltaTop<0&&r.fillAbove(s.newScrollTop),!r.fixedRowHeight&&!t&&r.correctError(s,i),n=r.estimateTotalHeight()}return n}correctError(i,e){const t=this;let r=0;(t.allHeightsKnown||i.deltaTop<0&&e<t.viewHeight*2||i.deltaTop>0&&e>t.totalHeight-t.viewHeight*2-3)&&(r=t.topRow.top-t.calculateTop(t.topRow.dataIndex)),r&&(t.offsetRows(-r),t.grid.scrollable.y=t.lastScrollTop=t.grid.scrollable.y-r)}fillAbove(i){const e=this,{rows:t}=e,r=Math.min(e.prependRowBuffer,t.length-1);for(;t[r].top>i&&e.topIndex>0;)e.displayRecordAtTop();e.trigger("renderDone")}fillBelow(i){const e=this,{rows:t,storeCount:r}=e,{length:n}=t,s=Math.min(n-Math.min(e.appendRowBuffer,n-1),n-1),a=i+e.viewHeight;for(;t[s].top<a&&e.bottomRow.dataIndex<r-1;)e.displayRecordAtBottom();e.trigger("renderDone")}estimateTotalHeight(i=!1){const e=this;if(e.grid.renderingRows)return;const{bottomRow:t,storeCount:r}=e,n=r-e.heightMap.size;let s;if(e.fixedRowHeight)s=r*e.rowOffsetHeight;else{if(s=e.totalKnownHeight+e.heightMap.size*e.grid._rowBorderHeight+n*e.preciseRowOffsetHeight,t&&n){const a=t.bottom;(a>s||e.topIndex+e.rowCount>=r&&s>a&&a>0)&&(s=a,t.dataIndex<r-1&&(s+=(r-1-t.dataIndex)*e.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==e.totalHeight&&e.trigger("changeTotalHeight",{totalHeight:s,immediate:i})!==!1&&(e._totalHeight=s),s}displayRecordAtTop(){var i;const e=this,{grid:t}=e,r=e.topIndex-1,n=e.store.getAt(r),s=e.bottomRow,a=s.top;return e.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((i=t.focusedCell)==null?void 0:i.rowIndex)&&t.onFocusedRowDerender(),s._top=e.topRow.top-e.getOffsetHeight(n),s.estimatedTop=!e.fixedRowHeight,s.render(r,n,!1),s._top=a,s.setBottom(e.topRow.top),s.estimatedTop=!1,e.topIndex--,e._rows.unshift(e._rows.pop()),e.fixIndices(),s.offsetHeight}displayRecordAtBottom(){var i;const e=this,{grid:t}=e,r=e.topIndex+e.rowCount,n=e.store.getAt(r),s=e.topRow;return e.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex===((i=t.focusedCell)==null?void 0:i.rowIndex)&&t.onFocusedRowDerender(),s.dataIndex=r,s.setTop(e.bottomRow.bottom),s.render(r,n,!1),e.topIndex++,e._rows.push(e._rows.shift()),e.fixIndices(),s.offsetHeight}fixIndices(){for(let i=0,{rows:e}=this,{length:t}=e;i<t;i++)e[i].index=i}};y(Wd,"delayable",{bufferedTranslateFromRow:"raf"}),Wd.featureClass="",Wd._$name="RowManager";var xF={x:1},NS=i=>i.isSubGrid,Xm=class extends At{addScroller(i){(this.xScrollers||(this.xScrollers=[])).push(i)}addPartner(i,e=xF,t=!0){if(typeof e=="string"&&(e={[e]:1}),e.x){i.owner.initScroll();const r=this.widget.items.filter(NS),n=i.widget.items.filter(NS);for(let s=0,{length:a}=r;s<a;s++)r[s].scrollable.addPartner(n[s].scrollable,"x")}t&&E.scrollBarWidth&&i.isGridScroller&&(i.ion({overflowChange:"onPartnerOverflowChange",thisObj:this}),this.onPartnerOverflowChange({source:i,y:i.hasOverflowY})),super.addPartner(i,{...e,x:!1})}onPartnerOverflowChange({source:i,y:e}){const t=this,r=t.hasOverflowY,n=e;r&&!n&&(i.overflowY="scroll"),!r&&n?t.overflowY="scroll":!r&&!n&&(t.overflowY=i.overflowY=!0),t.owner.refreshVirtualScrollbars()}removePartner(i){E.scrollBarWidth&&i.isGridScroller&&i.un({overflowChange:"onPartnerOverflowChange",thisObj:this}),this.xScrollers.forEach((e,t)=>{e.isDestroyed||e.removePartner(i.xScrollers[t])}),super.removePartner(i)}updateOverflowX(i){var e;const t=i===!1;(e=this.xScrollers)==null||e.forEach(r=>r.overflowX=t?"hidden":"hidden-scroll"),this.widget.virtualScrollers.classList.toggle("b-hide-display",t)}scrollIntoView(i,e){if(i.nodeType===Element.ELEMENT_NODE&&this.element.contains(i)){for(const t of this.xScrollers)if(t.element.contains(i))return t.scrollIntoView(i,e)}else return super.scrollIntoView(i,e)}hasOverflow(i="y"){return i==="y"?this.scrollHeight>this.clientHeight:!1}set x(i){this.xScrollers&&(this.xScrollers[0].x=i)}get x(){return this.xScrollers?this.xScrollers[0].x:0}};y(Xm,"$name","GridScroller"),Xm._$name="GridScroller";var ss=class extends rs{get subGrid(){return this._subGrid}set subGrid(i){this._subGrid=this.owner=i}get region(){var i;return(i=this.subGrid)==null?void 0:i.region}changeElement(i,e){const{region:t}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${t}`]:t},role:null,children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${t}`]:t},dataset:{region:t,reference:"headersElement",maxDepth:this.maxDepth}}]},e)}get overflowElement(){return this.headersElement}getColumnConfig(i){var e,t;const{id:r,align:n,resizable:s,isLeaf:a,isParent:l,isLastInSubGrid:o,cls:d,childLevel:c,field:u,tooltip:h,children:g,isFocusable:f,grid:m}=i,p=m==null?void 0:m.focusedCell,v=(p==null?void 0:p.rowIndex)===-1&&(p==null?void 0:p.column)===i,b={};if(i.isVisible)return i.flex?b.flex=i.flex:i.width&&(b.width=E.setLength(i.width)),{style:b,className:{"b-grid-header":1,"b-grid-header-parent":l,[`b-level-${c}`]:1,[`b-depth-${(e=i.meta.depth)!=null?e:0}`]:1,[`b-grid-header-align-${n}`]:n,"b-grid-header-resizable":s&&a,[d]:d,"b-collapsible":i.collapsible,"b-last-parent":l&&o,"b-last-leaf":a&&o,"b-header-widgets":(t=i.headerWidgets)==null?void 0:t.length},role:f?"columnheader":null,"aria-sort":"none","aria-label":i.ariaLabel,[f?"tabIndex":""]:v?0:-1,dataset:{...ve.encodeConfig(h),columnId:r,[u?"column":""]:u},children:[{className:"b-grid-header-text",role:null,children:[{[m&&f?"id":""]:`${m==null?void 0:m.id}-column-${i.id}`,className:{"b-grid-header-text-content":1,"b-has-text":!!i.text}}]},g?{className:"b-grid-header-children",children:g.map(w=>this.getColumnConfig(w)),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let i=0;return this.columns.visibleColumns.forEach(e=>{i+=e.calculateMinWidth()}),i}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const i=this;i.columns.traverse(e=>i.refreshColumn(e)),i.fixHeaderWidths()}refreshColumn(i){const e=this,t=e.getBarCellElement(i.id);if(t){let r=i.headerText;if(i.headerRenderer&&(r=i.headerRenderer.call(i.thisObj||e,{column:i,headerElement:t}),E.isReactElement(r)))return E.handleReactHeaderElement(i,t,r);i.headerWidgetMap&&Object.values(i.headerWidgetMap).forEach(s=>{s.render(i.textWrapper)}),i.icon&&(r=`<i class="${O.encodeHtml(i.icon)}"></i>`+(r||""));const n=t.querySelector(".b-grid-header-text-content");n&&(n.innerHTML=r||"")}}get columns(){const i=this,e=super.columns;return i.columnsDetacher||(i.columnsDetacher=e.ion({change(){i.initDepths()},thisObj:i}),i.initDepths()),e}set columns(i){super.columns=i}initDepths(i=this.columns.topColumns,e=null){const t=this;let r=0;e!=null&&e.meta&&e.meta.depth++;for(const n of i){const{meta:s}=n;s.depth=0,n.children&&(t.initDepths(n.children.filter(t.columns.chainedFilterFn),n),s.depth&&e&&(e.meta.depth+=s.depth)),s.depth>r&&(r=s.depth)}return e||(t.maxDepth=r),r}getHeader(i){return this.getBarCellElement(i)}get contentElement(){return this.element.firstElementChild}refreshContent(){const i=this;oe.sync({domConfig:{children:i.columns.topColumns.map(e=>i.getColumnConfig(e)),onlyChildren:!0},targetElement:i.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),i.refreshHeaders()}onInternalPaint({firstPaint:i}){i&&this.refreshContent()}};y(ss,"$name","Header"),y(ss,"type","gridheader"),ss.initClass(),ss._$name="Header";var Zm={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},BS=["pageX","pageY","clientX","clientY","screenX","screenY"],RF={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1,Backspace:1,Delete:1};function jd(i,e=!0){i==null||i.classList.toggle("b-hover",e)}function kh(i,e,t=!0){e&&i&&jd(e.getCell(i),t)}var zS=i=>{var e;return e=class extends(i||$){static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,hoverCls:"b-hover",keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const t=Object.keys(Zm),r=t.length,n={element:this.bodyElement,thisObj:this};for(let s=0;s<r;s++){const a=t[s];n[a]={handler:"handleEvent"},a.startsWith("touch")&&(n[a].passive=!1)}V.on(n),V.on({mouseenter:"onGridBodyMouseEnterOrLeave",mouseleave:"onGridBodyMouseEnterOrLeave",focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(t,r=!1){var n,s;const a=this,{target:l}=t,o=l.classList.contains("b-grid-row");let d=l.closest(".b-grid-cell");if(!d&&r&&!o&&!l.classList.contains("b-grid-subgrid")){const{columns:c}=a,{top:u,left:h,right:g,bottom:f}=a.bodyContainer.getBoundingClientRect();let m,{x:p,y:v}=t;p>=h&&p<=g?v=m=Math.ceil(a[`${v<u?"first":"last"}FullyVisibleRow`].element.getBoundingClientRect().y):v>=u&&v<=f&&(p=m=Math.ceil(c.visibleColumns[p<h?0:c.visibleColumns.length-1].element.getBoundingClientRect().x)),m!==void 0&&(d=(n=E.childFromPoint(l,t.offsetX,t.offsetY))==null?void 0:n.closest(".b-grid-cell"))}else o&&(d=(s=E.childFromPoint(l,t.offsetX,t.offsetY-l.offsetHeight/2))==null?void 0:s.closest(".b-grid-cell"));if(d)return a.getCellDataFromElement(d)}getCellDataFromElement(t){const r=this;if(t=t.closest(".b-grid-cell")){const n=Oe.get(t),{id:s,columnId:a}=n,l=r.store.getById(s),o=r.columns.getById(a);return l?{cellElement:t,cellData:n,columnId:a,id:s,record:l,column:o,cellSelector:{id:s,columnId:a}}:null}}getHeaderDataFromEvent(t){const r=t.target.closest(".b-grid-header");if(r){const n=T.assign({},r.dataset),{columnId:s}=n,a=this.columns.getById(s);return a?{headerElement:r,headerData:n,columnId:s,column:a}:null}}handleEvent(t){!this.disabled&&Zm[t.type]&&t.pointerType!=="focus"&&this[Zm[t.type]](t)}onElementTouchStart(t){const r=this;E.isTouchEvent=!0,t.touches.length===1&&(r.longPressTimeout=r.setTimeout(()=>{r.onElementLongPress(t),t.preventDefault(),r.longPressPerformed=!0},r.longPressTime))}onElementTouchMove(t){const r=this,{lastTouchTarget:n}=r,s=t.changedTouches[0],{pageX:a,pageY:l}=s,o=t.target.getRootNode().elementFromPoint(a,l);if(r.longPressTimeout&&(r.clearTimeout(r.longPressTimeout),r.longPressTimeout=null),o!==n&&n){const d=new MouseEvent("mouseout",T.copyProperties({relatedTarget:o,pointerType:"touch",bubbles:!0},s,BS));d.preventDefault=()=>t.preventDefault(),o==null||o.dispatchEvent(d);const c=new MouseEvent("mouseover",T.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},s,BS));c.preventDefault=()=>t.preventDefault(),n==null||n.dispatchEvent(c)}r.lastTouchTarget=o}onElementTouchEnd(t){const r=this;r.longPressPerformed&&(t.cancelable&&t.preventDefault(),r.longPressPerformed=!1),r.longPressTimeout&&(r.clearTimeout(r.longPressTimeout),r.longPressTimeout=null)}onElementLongPress(t){}triggerCellMouseEvent(t,r,n=this.getCellDataFromEvent(r),s="cell"){var a;const l=this;if(n){const o=l.columns.getById(n.columnId),d={grid:l,record:n.record,column:o,cellSelector:n.cellSelector,cellElement:n.cellElement,target:r.target,event:r};l.trigger(s+O.capitalize(t),d),s==="cell"&&t==="click"&&((a=o.onCellClick)==null||a.call(o,d))}}onElementMouseDown(t){const r=this,n=r.getCellDataFromEvent(t);r.skipFocusSelection=!0,r.isScrollbarOrRowBorderOrSplitterClick(t)?t.preventDefault():(r.triggerCellMouseEvent("mousedown",t,n),n&&!t.defaultPrevented&&r.onFocusGesture(t))}isScrollbarOrRowBorderOrSplitterClick({target:t,x:r,y:n}){if(t.closest(".b-grid-splitter")||t.matches(".b-grid-row, .b-virtual-width"))return!0;if(t.matches(".b-vertical-overflow")){const s=t.getBoundingClientRect();return r>s.right-E.scrollBarWidth}else if(t.matches(".b-horizontal-overflow")){const s=t.getBoundingClientRect();return n>s.bottom-E.scrollBarWidth-1}}onElementMouseMove(t){this.mouseMoveEvent=t}onElementMouseUp(t){}onElementPointerDown(t){}onElementPointerUp(t){}onHandleElementClick(t){this.trigger("beforeElementClick",{event:t})!==!1&&this.onElementClick(t)}onElementClick(t){var r;const n=this,s=n.getCellDataFromEvent(t);if(s)return n.triggerCellMouseEvent("click",t,s);{const a=(r=t.target)==null?void 0:r.closest(".b-grid-header"),l=a&&n.columns.getById(a.dataset.columnId);if(l)return n.trigger("headerClick",{domEvent:t,column:l})}}onFocusGesture(t){var r,n,s,a;const l=this,{navigationEvent:o}=l,{target:d}=t,c=t.button===2,u=!c&&((s=(n=(r=l.features.tree)==null?void 0:r.treeColumn)==null?void 0:n.isTreeExpanderIcon)==null?void 0:s.call(n,d)),h=!document.hasFocus()&&Y.isMac&&c;if(u||h)t.preventDefault();else{l.navigationEvent=t;const g=new Se(d);if(c||(a=l.focusedCell)!=null&&a.equals(g)){const f={scroll:!1};globalThis.TouchEvent&&t instanceof MouseEvent&&o instanceof TouchEvent&&d===o.target&&(f.doSelect=!1),l.focusCell(g,f)}}}onElementDblClick(t){const{target:r}=t;if(this.triggerCellMouseEvent("dblClick",t),r.classList.contains("b-grid-header-resize-handle")){const n=r.closest(".b-grid-header"),s=this.columns.getById(n.dataset.columnId);s.resizeToFitContent()&&this.trigger("columnResize",{column:s,domEvent:t})}}shouldHover(t){return(si.dragging||typeof t.buttons!="number"||t.buttons===0)&&t.pointerType!=="touch"}onElementMouseOver(t){var r;if(!this.scrolling){const n=this,{hoveredCell:s}=n,a=this.shouldHover(t);let l=t.target.closest(".b-grid-cell");n._lastMouseOverOutEvent=t,!l&&t.target.classList.contains("b-grid-row")&&(l=(r=E.childFromPoint(t.target,t.offsetX,t.offsetY-2))==null?void 0:r.closest(".b-grid-cell")),l&&(a&&(n.hoveredCell=l),s!==n.hoveredCell&&n.triggerCellMouseEvent("mouseOver",t)),n.trigger("mouseOver",{event:t})}}onElementMouseOut(t){var r;const n=this,{target:s,relatedTarget:a}=t,l=(typeof t.buttons!="number"||t.buttons===0)&&t.pointerType!=="touch";n._lastMouseOverOutEvent=t,l&&a&&s.matches(".b-grid-cell")&&!s.contains(a)?a.matches(".b-grid-row")||(n.hoveredCell=a.closest(".b-grid-cell")):!(a!=null&&a.matches(".b-grid-row,.b-grid-cell"))&&!((r=n.hoveredCell)!=null&&r.contains(a))&&(n.hoveredCell=null),n.scrolling||((a==null?void 0:a.closest(".b-grid-cell"))!==(s==null?void 0:s.closest(".b-grid-cell"))&&s!=null&&s.closest(".b-grid-cell")&&n.triggerCellMouseEvent("mouseOut",t),n.trigger("mouseOut",{event:t}))}updateHoveredCell(t,r){var n,s,a;const l=this,{selectionMode:o}=l,d=o.rowNumber&&((n=l.columns.find(g=>g.type=="rownumber"))==null?void 0:n.id),c=o.checkbox&&((s=l.checkboxSelectionColumn)==null?void 0:s.id);let u,h;if(r){jd(r,!1);const g=Oe.get(r);u=g.row,u&&!u.isDestroyed&&(kh(d,u,!1),kh(c,u,!1)),g!=null&&g.columnId&&jd((a=l.columns.getById(g.columnId))==null?void 0:a.element,!1)}if(l._hoveredRow&&!l._hoveredRow.isDestroyed&&l.toggleRowHover(l._hoveredRow,!1),l._hoveredRow=null,t&&!l.scrolling){const g=Oe.get(t);if(h=g.row,h)if(o.cell&&g.columnId!==d&&g.columnId!==c){const f=l.columns.getById(g.columnId);jd(t),kh(c,h),kh(d,h),f!=null&&f.element&&f.headerHoverable!==!1&&jd(f.element)}else l._hoveredRow=h,l.toggleRowHover(h,!0);else l.hoveredCell=null}if(h!==u){const{_lastMouseOverOutEvent:g}=l;if(u&&!u.isDestroyed&&l.trigger("rowMouseLeave",{event:g,record:u.cellContext.record,cellElement:r}),h){const f=l.getCellDataFromEvent(g);l.triggerCellMouseEvent("mouseEnter",g,f,"row")}}}toggleRowHover(t,r){this.hoverCls&&t.toggleCls(this.hoverCls,r)}keyMapOnKeyDown(t){var r;const n=this,{target:s}=t.browserEvent;if(n.element.contains(s)){const a=t.key.startsWith("Arrow"),l=t.key==="Escape"||t.key==="F2"||t.key==="Tab"||t.key==="Enter";if(n.onElementKeyDown(t),(RF[t.key]&&E.isEditable(s,!0)||(r=n.focusedCell)!=null&&r.containsFocus&&!l&&!a&&!n.matchKeyMapEntry(t))&&!s.getAttribute("readOnly")&&n.matchKeyMapEntry(t))return!a&&!t.key==="Backspace"&&t.preventDefault(),t.handled=!0,t.stopPropagation(),!1;super.keyMapOnKeyDown(t)}}onElementKeyDown(t){var r,n;if(t.handled||!this.element.contains(t.target))return;const s=this,a=s.focusedCell;if(a!=null&&a.isCell&&!a.isActionable){const l=t.target.closest(".b-grid-cell")?s.getCellDataFromEvent(t):s.getCellDataFromElement(a.cell);(n=l==null?void 0:(r=l.column).onCellKeyDown)==null||n.call(r,{...l,event:t})}}undoRedoKeyPress(t){var r;const{stm:n}=this.store;return n&&this.enableUndoRedoKeys&&!((r=this.features.cellEdit)!=null&&r.isEditing)?(n.onUndoKeyPress(t),!0):!1}clickCellByKey(t){const r=this,n=r.focusedCell,s=n==null?void 0:n.cell,a=r.columns.getById(s.dataset.columnId);return n!=null&&n.isCell&&!n.isActionable&&a.onCellClick?(a.onCellClick({grid:r,column:a,record:r.store.getById(n.id),cellElement:s,target:t.target,event:t}),!0):!1}onElementKeyPress(t){}onElementKeyUp(t){}onElementContextMenu(t){const r=this,n=r.getCellDataFromEvent(t);n&&(r.triggerCellMouseEvent("contextMenu",t,n),E.isTouchEvent&&r.onFocusGesture(t))}onGridBodyMouseEnterOrLeave(t){const r=t.target.classList.contains("b-grid-cell")&&this.getCellDataFromEvent(t);r&&this.triggerCellMouseEvent(t.type,t,r)}onInternalResize(t,r,n,s,a){const l=this;l._devicePixelRatio&&l._devicePixelRatio!==globalThis.devicePixelRatio&&E.resetScrollBarWidth(),l._devicePixelRatio=globalThis.devicePixelRatio,l._bodyRectangle=L.client(l.bodyContainer),super.onInternalResize(...arguments),n!==a&&(l._bodyHeight=l.bodyContainer.offsetHeight,l.isPainted&&l.rowManager.initWithHeight(l._bodyHeight)),l.refreshVirtualScrollbars(),r!==s&&l.setTimeout(()=>{l.isDestroyed||l.updateResponsive(r,s)},0)}get widgetClass(){}},y(e,"$name","GridElementEvents"),e},TF={string:1,object:1,function:1},WS=i=>{var e;return e=class extends(i||$){set features(t){const r=this,n=K.getInstanceDefaultFeatures(this);t=r._features=T.merge({},this.constructor.configurable.features,T.isObject(t)?t:{}),n&&Object.keys(n).forEach(a=>{a in t||(t[a]=!0)});const s=K.getInstanceFeatures(this);for(const a of Object.keys(t)){const l=t[a];if(l){const o=!globalThis.__bryntum_code_editor_changed;if(O.uncapitalize(a)!==a){const c=`Invalid feature name '${a}', must start with a lowercase letter`;if(o)throw new Error(c);console.error(c),r._errorDuringConfiguration=c}const d=s[a];if(!d){const c=`Feature '${a}' not available, make sure you have imported it`;if(o)throw new Error(c);console.error(c),r._errorDuringConfiguration=c;return}Reflect.defineProperty(t,a,r.createFeatureInitializer(t,a,d,l))}}}get features(){return this._features}createFeatureInitializer(t,r,n,s){const a=[this],l=n.prototype.construct;return s===!0&&(s={}),TF[typeof s]&&(a[1]=s),{configurable:!0,get(){return delete t[r],n.prototype.construct=function(...o){t[r]=this,l.apply(this,o),n.prototype.construct=l},new n(...a)}}}hasFeature(t){const{features:r}=this;if(r){const n=Object.getOwnPropertyDescriptor(this.features,t);if(n)return!!(n.value||n.get)}return!1}hasActiveFeature(t){var r,n;return!!((n=(r=this.features)==null?void 0:r[t])!=null&&n.enabled)}getConfigValue(t,r){var n,s;if(t==="features"){const a={};for(const l in this.features){const o=(s=(n=this.features[l])==null?void 0:n.getCurrentConfig)==null?void 0:s.call(n,r);o?T.isEmpty(o)?K.isDefaultFeatureForInstance(this.features[l].constructor,this)||(a[l]=!0):a[l]=o:a[l]=!1}return a}return super.getConfigValue(t,r)}get widgetClass(){}},y(e,"$name","GridFeatures"),e},MF=Object.freeze({}),_F='button, input, textarea, a, [contenteditable="true"], select, option',kF=function(i){return this.focusableFinderCell.contains(i)?E.isFocusable(i)&&!i.disabled?E.NodeFilter.FILTER_ACCEPT:E.NodeFilter.FILTER_SKIP:E.NodeFilter.FILTER_REJECT},FF=i=>{var e;return e=class extends(i||$){onStoreRecordIdChange(t){var r;(r=super.onStoreRecordIdChange)==null||r.call(this,t);const{focusedCell:n}=this,{oldValue:s,value:a}=t;n&&n.id===s&&(n._id=a)}onFocusedRowDerender(){const t=this,{focusedCell:r}=t;if((r==null?void 0:r.id)!=null&&r.cell){const n=E.isDescendant(r.cell,E.getActiveElement(t));if(t.hideHeaders)n&&t.revertFocus();else{const s=t.normalizeCellContext({rowIndex:-1,columnIndex:n?r.columnIndex:0});n?t.focusCell(s):s.cell.tabIndex=0}r.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(Se.FIRST_CELL)}navigateFirstColumn(){this.focusCell(Se.FIRST_COLUMN)}navigateLastCell(){this.focusCell(Se.LAST_CELL)}navigateLastColumn(){this.focusCell(Se.LAST_COLUMN)}navigatePrevPage(){this.focusCell(Se.PREV_PAGE)}navigateNextPage(){this.focusCell(Se.NEXT_PAGE)}activateCell(t){var r,n;const{focusedCell:s}=this;if(s.isColumnHeader){if(t.target.classList.contains("b-grid-header")){const{column:a}=this.focusedCell;(r=a.onKeyDown)==null||r.call(a,t),this.getHeaderElement(a.id).click()}}else!s.isActionable&&((n=s.actionTargets)!=null&&n.length)&&(t.preventDefault(),s.actionTargets[0].focus());return!1}toggleCellActivate(t){var r;const{focusedCell:n}=this;(r=n==null?void 0:n.actionTargets)!=null&&r.length&&(n.isActionable?this.deactivateCell(t):n.actionTargets[0].focus())}deactivateCell(t){var r,n;const s=this,{focusedCell:a}=s;!t.target.closest(".b-dragging")&&(a!=null&&a.isActionable)?(t.stopImmediatePropagation(),s._focusedCell=null,s.focusCell({rowIndex:a.rowIndex,column:a.column},{disableActionable:!0})):s.isNested&&s.owner&&!((n=(r=s.owner).catchFocus)!=null&&n.call(r,{source:s}))&&s.revertFocus(!0)}onTab(t){const{target:r}=t,{focusedCell:n,bodyElement:s}=this,{isActionable:a,actionTargets:l=[]}=n;if(a&&E.isEditable(r)&&!r.readOnly&&r===l[l.length-1])t.preventDefault(),this.navigateRight(t);else if(!a||r===l[l.length-1])return s.style.display="none",this.requestAnimationFrame(()=>s.style.display=""),!1}onShiftTab(t){const r=this,{target:n}=t,{focusedCell:s,bodyElement:a}=r,{cell:l,isActionable:o,actionTargets:d}=s,c=o&&E.isEditable(n)&&!n.readOnly,u=s.columnIndex===0&&s.rowIndex===(r.hideHeaders?0:-1);if(!u&&c&&n===d[0])t.preventDefault(),r.navigateLeft(t);else if(!o||n===d[0]){const h=!u&&!r.hideHeaders&&r.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return h?(h.cell.tabIndex=-1,l.tabIndex=0,r._focusedCell=s):(a.style.display="none",r.requestAnimationFrame(()=>a.style.display="")),!1}}onSpace(t){return this.focusedCell.isActionable||t.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var t;return(t=this._focusedCell)==null?void 0:t.isActionable}set focusedCell(t){this.focusCell(t)}get focusedRecord(){var t;return(t=this._focusedCell)==null?void 0:t.record}get cellCSSSelector(){const t=this._focusedCell;return t?`[data-index=${t.rowIndex}] [data-column-id=${t.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(t){var r;return!!((r=this._focusedCell)!=null&&r.equals(this.normalizeCellContext(t)))}get focusElement(){var t;if(!this.isDestroying){let r;this.store.count&&this._focusedCell?r=this._focusedCell.target:this.hideHeaders||(r=this.normalizeCellContext({rowIndex:-1,columnIndex:((t=this._focusedCell)==null?void 0:t.columnIndex)||0}).target);const n=super.focusElement;return n&&(!r||r.compareDocumentPosition(n)===Node.DOCUMENT_POSITION_PRECEDING)?n:r}}afterInternalPaint({firstPaint:t}){var r,n;const s=this;(r=super.afterInternalPaint)==null||r.call(this,...arguments);const a=this.normalizeCellContext({rowIndex:s.hideHeaders?0:-1,column:s.hideHeaders?0:s.columns.find(l=>!l.hidden&&l.isFocusable)});if((n=a.cell)!=null&&n.getAttribute("tabIndex")){a._isDefaultFocus=!0,s._focusedCell=a;const{target:l}=a;l===a.cell&&(a.cell.tabIndex=0)}}onGridBodyFocusIn(t){var r,n,s,a;const l=this,{bodyElement:o}=l,d=l.focusedCell,c=(d==null?void 0:d.initialTarget)||(d==null?void 0:d.target),{relatedTarget:u}=t,h=t.browserEvent.target,g=h.closest(l.focusableSelector),f=h.closest(".b-grid-row");if(g&&(!le.currentMouseDown||le.isMouseDown(0)||le.isMouseDown(2))){const m=new Se(h),{cell:p}=m,v=d==null?void 0:d.cell,b=m.actionTargets=l.findFocusables(g),w=(!l._fromFocusCell||l.selectOnFocus)&&(h===p||!g.contains(h.closest(_F))||l._selectActionCell)&&!(h!=null&&h._isRevertingFocus);if(f&&m.rowIndex===-1){p.focus({preventScroll:!0});return}if(h.matches(l.focusableSelector)){if(l.disableActionable)m._target=p;else if(b.length){const D=(r=le.currentMouseDown)==null?void 0:r.target;b.some(S=>S.contains(D))||((n=l.onCellNavigate)==null||n.call(l,l,d,m,w),l.trigger("navigate",{lastFocusedCell:d,focusedCell:m,event:t})),l._selectActionCell=D===h,b[0].focus(),delete l._selectActionCell;return}}else{if(d!=null&&d.target&&u&&(!le.isMouseDown()||!o.contains((s=le.currentMouseDown)==null?void 0:s.target))&&!o.contains(u)&&!m.equals(d)){c.focus();return}m._target=h}if(v&&(v.classList.remove("b-focused"),v.tabIndex=-1),p&&(p.classList.add("b-focused"),m.column.onCellFocus(m),p===h&&(p.tabIndex=0),p.contains(t.relatedTarget)&&c===h))return;l._focusedCell=m,(a=l.onCellNavigate)==null||a.call(l,l,d,m,w),l.trigger("navigate",{lastFocusedCell:d,focusedCell:m,event:t})}else h.closest(".b-rowexpander-body")||c==null||c.focus({preventScroll:!0})}findFocusables(t){const{focusableFinder:r}=this,n=[];r.currentNode=this.focusableFinderCell=t;for(let s=r.nextNode();s;s=r.nextNode())n.push(s);return n}get focusableFinder(){const t=this;return t._focusableFinder||(t._focusableFinder=t.setupTreeWalker(t.bodyElement,E.NodeFilter.SHOW_ELEMENT,{acceptNode:kF.bind(t)})),t._focusableFinder}restoreActiveItem(t=this._focusedCell){if(this.rowManager.count)return isNaN(t)?t.isModel||(t=this.store.getById(t)):t=this.store.getAt(t),this.focusCell(t)}focusCell(t,r=MF){var n,s,a,l;const o=this,{_focusedCell:d}=o,{scroll:c,disableActionable:u}=r,h=t===Se.DOWN,g=t===Se.UP,f=t===Se.PREV_CELL||t===Se.NEXT_CELL,{cellEdit:m}=o.features;if((t==null?void 0:t.rowIndex)===-1&&o.hideHeaders){o.revertFocus();return}if(typeof t=="number"&&!(d!=null&&d.isLocation))return;t=typeof t=="number"&&(d!=null&&d.isLocation)?d.move(t):o.normalizeCellContext(t);const p="doSelect"in r?r.doSelect:!t.isActionable||t.initialTarget===t.cell;if(t.equals(d))return o.isNested&&(h||g)?(s=(n=o.owner)==null?void 0:n.catchFocus)!=null&&s.call(n,{source:o,navigationDirection:h?"down":"up"})||o.revertFocus(!0):(a=o.onCellNavigate)==null||a.call(o,o,d,t,p),d;if(m!=null&&m.isEditing&&!t.equals(m.editorContext)&&m.getEditingContext(t))return m.startEditing(t),t;const v=o.getSubGridFromColumn(t.columnId),{cell:b}=t,w=b||o.getCell({rowIndex:o.rowManager.topIndex,columnId:t.columnId}),D=L.from(v.element),S=L.from(o.bodyElement),x=L.from(w).moveTo(null,D.y);if(c!==!1)if(t.rowIndex===-1)f&&o.scrollColumnIntoView(t.column);else{r=Object.assign({},r,c);const{cellIsVisibleWidthThreshold:R,cellIsVisibleHeightThreshold:M}=o,_=R*D.width,k=M*S.height,F=D.intersect(x),I=Math.min(S.bottom,x.bottom)-Math.max(S.y,x.y);(x.width>D.width||x.height>S.height)&&(x.width>D.width&&F.width>=_&&(r.x=!1),x.height>S.height&&I>=k&&(r.y=!1)),r.column=t.columnId,o.scrollRowIntoView(t.id,r)}return(o._hoveredRow||o.hoveredCell)&&(o.hoveredCell=null),o.disableActionable=u,o.selectOnFocus=p,o._fromFocusCell=!0,(l=t[u?"cell":"target"])==null||l.focus({preventScroll:!0}),o.disableActionable=o.selectOnFocus=!1,delete o._fromFocusCell,t}blurCell(t){const r=this,n=r.getCell(t);n&&n.classList.remove("b-focused")}clearFocus(t){const r=this;r._focusedCell&&(r.lastFocusedCell=t?null:r._focusedCell,r.blurCell(r._focusedCell),r._focusedCell=null)}catchFocus(){}internalNextPrevCell(t=!0){const r=this,n=r._focusedCell;return n?r.focusCell({id:n.id,columnId:r.columns.getAdjacentVisibleLeafColumn(n.column,t,!0).id}):null}navigateRight(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(this.rtl?Se.PREV_CELL:Se.NEXT_CELL):this.internalNextPrevCell(!this.rtl)}navigateLeft(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(this.rtl?Se.NEXT_CELL:Se.PREV_CELL):this.internalNextPrevCell(!!this.rtl)}internalNextPrevRow(t,r=!0,n=!0){const s=this,a=s._focusedCell;if(!a)return!1;const l=s.store[`get${t?"Next":"Prev"}`](a.id,!1,r);return l?s.focusCell({id:l.id,columnId:a.columnId,scroll:{x:!1}}):(!t&&n&&!a.isColumnHeader&&(this.clearFocus(),this.getHeaderElement(a.columnId).focus()),!1)}navigateDown(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(Se.DOWN):this.internalNextPrevRow(!0,!1)}navigateUp(){var t;return(t=arguments[0])!=null&&t.fromKeyMap?this.focusCell(Se.UP):this.internalNextPrevRow(!1,!1)}get widgetClass(){}},y(e,"$name","GridNavigation"),y(e,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0[tabIndex]",isNested:!1,keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateCell",F2:"toggleCellActivate",Escape:{handler:"deactivateCell",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1,weight:200},Tab:{handler:"onTab",preventDefault:!1,weight:200}," ":{handler:"onSpace",preventDefault:!1}},cellIsVisibleWidthThreshold:.6,cellIsVisibleHeightThreshold:.6}),e},jS=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(t){const r=this,n=Object.keys(T.assign({},r.responsiveLevels));let s=null,a=99995,l=null;return n.forEach(o=>{let d=r.responsiveLevels[o];if(["number","string"].includes(typeof d)||(d=d.levelWidth),d==="*")l=o;else if(t<d){const c=d-t;c<a&&(a=c,s=o)}}),s||l}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(t,r){const n=this,s=n.getClosestBiggerLevel(r),a=n.getClosestBiggerLevel(t);if(r===0||s!==a){const l=n.responsiveLevels[a];["number","string"].includes(typeof l)||n.applyState(l),n.columns.forEach(o=>{const d=o.responsiveLevels;d&&(d[a]?o.applyState(d[a]):d["*"]&&o.applyState(d["*"]))}),n.element.classList.remove("b-responsive-"+s),n.element.classList.add("b-responsive-"+a),n.trigger("responsive",{level:a,width:t,oldLevel:s,oldWidth:r})}}get widgetClass(){}},y(e,"$name","GridResponsive"),e},IF={string:1,number:1},AF={dataset:1,batch:1},US=i=>{var e;return e=class extends(i||$){construct(t){this._selectedCells=[],this._selectedRows=[],super.construct(t),t!=null&&t.selectedRecords&&(this.selectedRecords=t.selectedRecords)}getDefaultGridSelection(t){if(t.$name==="GridSelection")return t.configurable.selectionMode;if(t.superclass)return this.getDefaultGridSelection(t.superclass)}changeSelectionMode(t){const r=this;return r.selectionMode?(T.assign(r.selectionMode,t),r.selectionMode):(r.$defaultGridSelection=r.getDefaultGridSelection(r.constructor),new Proxy(t,{set(n,s,a){const l=T.assign({},n);return n[s]=a,r.updateSelectionMode(n,l),!0}}))}updateSelectionMode(t,r=this.$defaultGridSelection){var n;const s=this,{columns:a,checkboxSelectionColumn:l}=s,o={},{rowReorder:d}=s.features;for(const c in t)t[c]!=r[c]&&(o[c]=t[c]);if(o.column&&(t.cell=!0,t.multiSelect=!0),o.cell&&(t.checkboxOnly=!1),o.cell===!1&&(t.column=!1),o.alwaysMultiSelect&&(t.multiSelect=!0,t.deselectOnClick=!0),o.checkboxOnly&&(t.checkbox||(t.checkbox=!0),t.cell=!1),o.checkbox===!1&&(o.checkboxOnly=!1,o.showCheckAll=!1),o.showCheckAll&&(t.checkbox=t.checkbox||!0,t.multiSelect=!0),(o.includeChildren||o.includeParents||o.showCheckAllInGroupRows)&&(t.multiSelect=!0,s.features.group&&(t.includeParents=t.showCheckAllInGroupRows)),t.checkbox&&((n=s.features.group)!=null&&n.enabled)&&typeof o.showCheckAllInGroupRows=="boolean"&&s.renderRows(),o.multiSelect===!1&&(t.column=t.showCheckAll=t.dragSelect=t.includeChildren=t.includeParents=t.alwaysMultiSelect=t.showCheckAllInGroupRows=!1),o.deselectOnClick===!1&&(t.alwaysMultiSelect=!1),o.dragSelect&&(d!=null&&d.enabled&&d.gripOnly!==!0&&(d.showGrip=d.gripOnly=!0),t.multiSelect=!0,s._selectionListenersDetachers={}),o.dragSelect===!1&&s._selectionListenersDetachers&&s.removeDragListeners(),!s.isConfiguring&&r&&(o.cell!==void 0||o.deselectFilteredOutRecords!==void 0||o.multiSelect!==void 0)&&s.deselectAll(),o.rowNumber){if(!a.findRecord("type","rownumber")){const c=s.isGanttBase?{type:"sequence",text:""}:{type:"rownumber"};a.insert(0,{...c,...typeof t.rowNumber=="object"?t.rowNumber:{}}),s._selectionAddedRowNumberColumn=!0}}else o.rowNumber===!1&&s._selectionAddedRowNumberColumn&&(a.remove(a.findRecord("type","rownumber")),delete s._selectionAddedRowNumberColumn);(t.checkbox!==(r==null?void 0:r.checkbox)||t.checkbox&&t.showCheckAll!==(r==null?void 0:r.showCheckAll))&&(s.isConfiguring?s.shouldInitCheckboxSelection=!0:(r&&s.deselectAll(),s.initCheckboxSelection())),r&&t.checkbox&&r.checkbox&&t.checkboxIndex!==r.checkboxIndex&&l&&l.parent.insertChild(l,a.getAt(s.checkboxSelectionColumnInsertIndex)),s.trigger("selectionModeChange",T.clone(t)),s.afterSelectionModeChange(t)}afterConfigure(){const t=this;t.shouldInitCheckboxSelection&&(t.shouldInitCheckboxSelection=!1,t.initCheckboxSelection()),t.scrollManager.ion({scroll:({event:r,deltaY:n})=>{n!==0&&t.onSelectionDrag(r)}}),super.afterConfigure()}initCheckboxSelection(){var t,r,n;const s=this,{selectionMode:a,columns:l,checkboxSelectionColumn:o}=s,{checkbox:d}=a;if(o&&(s.checkboxSelectionColumn=null,l.remove(o),o.destroy()),d){const c=Ve.getColumnClass("check"),u=d===!0?null:d;if(!c)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const h=s.checkboxSelectionColumn=new c(T.assign({id:`${s.id}-selection-column`,width:(t=s.features.rowReorder)!=null&&t.showGrip?"5em":"4em",field:null,sortable:!1,filterable:!1,groupable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:(n=(r=s.items)==null?void 0:r[0])==null?void 0:n.region,showCheckAll:a.showCheckAll,draggable:!1,resizable:!1,ariaLabel:s.L("L{Checkbox.toggleSelection}"),widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},u),l,{isSelectionColumn:!0});h.meta.depth=0,h._grid=s;const g=h.renderer;h.setData("renderer",f=>{f.value=s.isSelected(f.record),g.call(h,f)}),h.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:s}),l.insert(s.checkboxSelectionColumnInsertIndex,h),l.acceptChanges()}}get checkboxSelectionColumnInsertIndex(){const{columns:t}=this;let{checkboxIndex:r}=this.selectionMode;return r?typeof r=="string"&&(r=t.indexOf(t.getById(r))):r=t.indexOf(t.findRecord("type","rownumber"))+1,r}beforeColumnsChange(){this.columns.count===0&&this.deselectAll(!1,!0)}afterColumnsChange({type:t,action:r,changes:n,columns:s,column:a}){var l;const{_selectedCells:o}=this;if(o!=null&&o.length&&(!s&&a&&(s=[a]),t==="move"||n!=null&&n.hidden||n!=null&&n.region||r==="add"||r==="remove")){let d=o.map(c=>({id:c.id,columnId:c._column.id}));(r==="remove"||(l=n==null?void 0:n.hidden)!=null&&l.value)&&(s!=null&&s.length)&&(d=d.filter(c=>!s.some(u=>c.columnId===u.id))),this.deselectAll(!1,!0),this.selectCells({cells:d,scrollIntoView:!1})}}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(t){return t!=null&&t.isCollection?(t.owner||(t.owner=this),t):Bt.new(t,{owner:this})}updateSelectedRecordCollection(t){t.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:t=[],removed:r}){this.selectedRecordCollection._fromSelection!==this&&(t=t.filter(n=>this.isSelectable(n)),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:t,deselectedRecords:r}))}changeSelectedRecordCollectionSilent(t){this.selectedRecordCollection._fromSelection=this;const r=t(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,r}bindStore(t){var r;this.detachListeners("selectionStoreFilter"),t.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),(r=super.bindStore)==null||r.call(this,t)}unbindStore(t){this.detachListeners("selectionStoreFilter"),super.unbindStore(t)}onStoreFilter({source:t}){const r=this,n=r.selectedRows.filter(a=>!(t.indexOf(a,!1,!0)>-1)),s=r.prepareSelection(r.selectionMode.deselectFilteredOutRecords?n:[]);if(r.isCellSelectionMode){const{deselectedCells:a}=r.prepareSelection(r._selectedCells.filter(l=>!t.records.includes(l.record)));a!=null&&a.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(a))}(s.deselectedCells.length||s.deselectedRecords.length)&&(r.performSelection(s,!1),r.updateCheckboxHeader())}onStoreRecordIdChange({record:t,oldValue:r}){var n;(n=super.onStoreRecordIdChange)==null||n.call(this,...arguments),this.selectedRecordCollection.get(r)===t&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove({action:t,records:r,isCollapse:n}){var s;if((s=super.onStoreRemove)==null||s.call(this,...arguments),!n&&t!=="filter"){const a=this,l=r.filter(d=>a.isSelected(d)),o=a.prepareSelection(l);if(a.isCellSelectionMode){const{deselectedCells:d}=a.prepareSelection(a.getSelectedCellsForRecords(r));d!=null&&d.length&&(o.deselectedCells=(o.deselectedCells||[]).concat(d))}(l.length||o.deselectedCells.length)&&a.performSelection(o)}}onStoreDataChange({action:t,source:r}){var n;const s=this,{selectionMode:a}=s;let l;if((n=super.onStoreDataChange)==null||n.call(this,...arguments),t==="pageLoad")a.preserveSelectionOnPageChange||(l=s.prepareSelection(null,null,!0)),s.updateCheckboxHeader();else if(AF[t]){const o=[];if(a.preserveSelectionOnDatasetChange===!1)l=s.prepareSelection(null,null,!0);else{o.push(...s.changeSelectedRecordCollectionSilent(d=>d.match(r.storage)));for(const d of s._selectedCells)r.getById(d.id)||o.push(d);l=s.prepareSelection(o)}}l&&(l.deselectAll||l.deselectedCells.length||l.deselectedRecords.length||l.selectedCells.length||l.selectedRecords.length)&&(s.performSelection(l,!1),s.updateCheckboxHeader())}onStoreRemoveAll(){var t;(t=super.onStoreRemoveAll)==null||t.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:t,record:r,checkbox:n}){const s=this,{multiSelect:a}=s.selectionMode,l=!a&&t,o=!l&&!t?[r]:null,d=t?[r]:null;s._isCheckboxSelecting=!0,r.isGroupHeader&&s.selectionMode.showCheckAllInGroupRows&&(t?d:o).splice(0,1,...r.groupChildren),t&&!le.shiftKeyDown&&(s._lastSelectionChecked=r),t&&a&&s._lastSelectionChecked&&le.shiftKeyDown?s.performSelection(s.internalSelectRange(s._lastSelectionChecked,r,!0)):s.performSelection(s.prepareSelection(o,d,l,!0))===!1&&(n.checked=!n.checked),s._isCheckboxSelecting=!1}updateCheckboxHeader(){var t;const r=this,{selectionMode:n,checkboxSelectionColumn:s,store:a}=r;if(n.checkbox&&s){if(!r.hideHeaders&&!r._isCheckAllSelecting&&n.showCheckAll&&s.headerCheckbox){const l=r.isAllRecordsSelected();s.headerCheckbox.checked!==l&&(s.suspendEvents(),s.headerCheckbox.checked=l,s.resumeEvents())}if(n.showCheckAllInGroupRows&&((t=a.groupRecords)!=null&&t.count)){const l=[...new Set(r.selectedRecords.map(o=>o.instanceMeta(a).groupParent))].filter(o=>{var d;return(d=o==null?void 0:o.groupChildren)==null?void 0:d.every(c=>r.isSelected(c))});s.suspendEvents();for(const o of a.groupRecords){const d=r.getCell({record:o,column:s});d&&(d.widget.checked=l.includes(o))}s.resumeEvents()}}}isAllRecordsSelected(){return this.store.count&&!this.store.some(t=>this.isSelectable(t)&&!this.isSelected(t))}onCheckAllChange({checked:t}){const r=this;r._isCheckboxSelecting=r._isCheckAllSelecting=!0,r[t?"selectAll":"deselectAll"](r.store.isPaged&&r.selectionMode.preserveSelectionOnPageChange),r._isCheckboxSelecting=r._isCheckAllSelecting=!1}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(t){var r;const n=this,s=t.type==="scroll",{_selectionStartCell:a,lastPointerMoveEvent:l}=n;if(s&&!n._isSelectionDragging||(le.isMouseDown()||n.onSelectionEnd(),!a))return;const{items:o,_lastSelectionDragRegion:d}=n;let c,u,h;if(s&&l){const g=document.elementFromPoint(l.clientX,l.clientY),f=g==null?void 0:g.closest(".b-grid-cell");f&&(u=n._lastSelectionDragRegion,h=n.normalizeCellContext({columnId:f.dataset.columnId,record:n.store.getById(f.parentElement.dataset.id)}))}else c=n.getCellDataFromEvent(t,!0),u=c==null?void 0:c.column.region,h=(c==null?void 0:c.cellSelector)&&n.normalizeCellContext(c.cellSelector),c&&(n.lastPointerMoveEvent=t);if(h&&!h.equals(n._lastSelectionDragCell,!0)){if(n._isSelectionDragging||n.enableScrollingCloseToEdges(o),n._clearSelectionOnSelectionDrag&&!a.equals(h,!0)&&(n.deselectAll(),delete n._clearSelectionOnSelectionDrag),d&&u!==d){const f=n.subGrids[d],m=n.subGrids[u],p=f.scrollable,v=m.scrollable,b=o.indexOf(f)-o.indexOf(m)<0;if(v.x=b?0:v.maxX,b?p.x<p.maxX-1:p.x>1)return;const w=(r=n.scrollManager._activeScroll)==null?void 0:r.horizontal;w&&w.element!==v.element&&w.stopScroll(!0)}n._lastSelectionDragRegion=u,n._lastSelectionDragCell=h,n._isSelectionDragging=!0;const g=n._lastSelectionDragChange=n.internalSelectRange(a,h,n.isRowNumberSelecting(h)||n.isRowNumberSelecting(a));g.deselectedCells=g.deselectedCells.filter(f=>!n.isCellSelected(f)),g.deselectedRecords=g.deselectedRecords.filter(f=>!n.isSelected(f)),n.hoveredCell=null,n.refreshGridSelectionUI(g),n.trigger("dragSelecting",g)}}onSelectionEnd(){const t=this,r=t._lastSelectionDragChange;t._isSelectionDragging&&!t._selectionStartCell.equals(t._lastSelectionDragCell,!0)&&r&&t.performSelection(r,!1),t.disableScrollingCloseToEdges(t.items),t._isSelectionDragging=!1,t._lastSelectionDragChange=t._lastSelectionDragCell=t._lastSelectionDragRegion=null,t.removeDragListeners()}removeDragListeners(){var t;const{_selectionListenersDetachers:r}=this;r&&((t=r.selectiondrag)==null||t.call(r),delete this._selectionListenersDetachers.selectiondrag)}onHandleElementClick(t){const r=this;r.selectionMode.rowNumber&&t.target.closest(".b-rownumber-header")?(t.handled=!0,r.store.count&&r.store.some(n=>!r.isSelected(n))?r.selectAll():r.deselectAll()):r.selectionMode.column&&t.target.matches(".b-grid-header-text-content,.b-grid-header-text")&&(t.handled=!0,r.selectColumn(t,t.ctrlKey)),super.onHandleElementClick(t)}selectColumn(t,r=!1){const n=this,{store:s}=n,{columnId:a}=n.getHeaderDataFromEvent(t);if(s.count===0)return;n._shiftSelectRange=null,t.shiftKey||(n._shiftSelectColumn=a);const l=t.shiftKey&&n._shiftSelectColumn||a,o=n.internalSelectRange(n.normalizeCellContext({id:s.first.id,columnId:l}),n.normalizeCellContext({id:s.last.id,columnId:a}));r&&!o.selectedCells.some(d=>!n.isCellSelected(d))&&(o.deselectedCells=o.selectedCells,o.selectedCells=[]),r||(o.deselectedCells=n._selectedCells),n.cleanSelectionChange(o),n.performSelection(o)}isSelected(t){return this.selectionMode.showCheckAllInGroupRows&&(t!=null&&t.isGroupHeader)?t.groupChildren.every(r=>this.isSelected(r)):(t!=null&&t.id&&(t=t.id),IF[typeof t]?this.selectedRows.some(r=>r.id===t):!1)}isCellSelected(t,r){return t=this.normalizeCellContext(t),this.isCellSelectionMode&&this._selectedCells.some(n=>t.equals(n,!0))||r&&this.isSelected(t)}isSelectable(t){return this.normalizeCellContext({id:t.id||t}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(t){this.selectRow({record:t})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(t){this.selectRows(t)}get selectedRows(){return[...this._selectedRows]}set selectedRows(t){this.selectRows(t)}spliceSelectedRecords(t,r,n){const s=this;if(typeof r=="number"){const a=[...s.selectedRecords];a.splice(t,r,...B.asArray(n)),s.performSelection(s.prepareSelection(null,a,!0,!0))}else s.performSelection(s.prepareSelection(r,n,!1,!0))}selectRow(t){(typeof t=="number"||typeof t=="string"||t.isModel||!("record"in t))&&(t={records:[t]}),T.assignIf(t,{scrollIntoView:!0}),this.selectRows(t)}selectRows(t){(!t||Array.isArray(t)||t.isModel||typeof t=="number"||!("records"in t)&&!("record"in t))&&(t={records:B.asArray(t)||[]});const r=this,{store:n}=r,s=[],{records:a=t.record?[t.record]:[],column:l=r.columns.visibleColumns[0],scrollIntoView:o,addToSelection:d=arguments[1]}=t;for(let c of a)c=n.getById(c),c&&s.push(c);if(d||(r._shiftSelectRange=null),r.performSelection(r.prepareSelection(null,s,!d,!0)),s.length&&o)return r.scrollRowIntoView(s[0].id,{...o,column:l})}selectAll(t=!1){const{store:r}=this,n=(r.isGrouped?r.getAllDataRecords():r.records).filter(s=>!s.isSpecialRow);this.performSelection(this.prepareSelection(null,n,!1,!0),!0,t)}deselectAll(t=!1,r=!1){const{store:n}=this,s=t?(n.isGrouped?n.getAllDataRecords():n.records).filter(a=>!a.isSpecialRow):null;this.performSelection(this.prepareSelection(s,null,!t),!0,r)}deselectRow(t){this.deselectRows(t)}deselectRows(t){const{store:r}=this,n=B.asArray(t).map(s=>r.getById(s)).filter(s=>s);this.performSelection(this.prepareSelection(n))}selectRange(t,r,n=!1){const s=this,{store:a}=s,l=s.internalSelectRange(a.getById(t),a.getById(r),!0);s._shiftSelectRange=null,s.performSelection(l)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(t){this.selectCells([t])}get selectedCells(){return[...this._selectedCells]}set selectedCells(t){this.selectCells(t)}get selectedCellCSSSelector(){const t=this.selectedCell,r=t&&this.getRowById(t.id);return!t||!r?"":`[data-index=${r.dataIndex}] [data-column-id=${t.columnId}]`}selectCell(t){var r;return("id"in t||"row"in t||"record"in t||"rowIndex"in t)&&(t={cell:t},t=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},t)),(r=this.selectCells(t))==null?void 0:r[0]}selectCells(t){Array.isArray(t)&&(t={cells:t});const r=this,{cells:n=t.cell?[t.cell]:[],scrollIntoView:s=!0,addToSelection:a=!1,silent:l=!1}=t,o=r.prepareSelection(null,n,!a);return a||(r._shiftSelectRange=null),r.performSelection(o,!0,l),s&&r.scrollRowIntoView(n[0].id,{...s,column:n[0].columnId}),r.isCellSelectionMode?o.selectedCells:o.selectedRecords}deselectCell(t){var r;return(r=this.deselectCells([t]))==null?void 0:r[0]}deselectCells(t){const r=this.prepareSelection(t);return this.performSelection(r),this.isCellSelectionMode?r.deselectedCells:r.deselectedRecords}toggleSelection(t){const r=this,{_focusedCell:n,selectionMode:s}=r,a=r.isRowNumberSelecting(n),l=r.isCellSelected(n,!0);if(s.selectOnKeyboardNavigation===!0||n.isActionable)return!1;r.performSelection(r.prepareSelection(l?n:null,l?null:n,!s.multiSelect,a)),t.preventDefault()}selectCellRange(t,r){this.performSelection(this.internalSelectRange(t,r))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(t){var r,n;const{deselectedRecords:s,deselectedCells:a,selectedCells:l,deselectedCellRecords:o}=t,d=(r=t.selectedRecords)==null?void 0:r.map(u=>u.id),c=(n=t.selectedCellRecords)==null?void 0:n.map(u=>u.id);return s!=null&&s.length&&(d!=null&&d.length)&&(t.deselectedRecords=s.filter(u=>!d.includes(u.id))),a!=null&&a.length&&(l!=null&&l.length)&&(t.deselectedCells=a.filter(u=>!l.some(h=>u.equals(h,!0)))),o.length&&(c.length||d!=null&&d.length)&&(t.deselectedCellRecords=o.filter(u=>!c.includes(u.id)&&!d.includes(u.id))),t}getSelectedCellsForRecords(t){return this._selectedCells.filter(r=>r.id&&t.some(n=>n.id===r.id))}delayUntilMouseUp(t){const r=V.on({element:this.selectionDragMouseEventListenerElement,blur:n=>t(n,r),mouseup:n=>t(n,r),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return this.selectionMode.cell===!0}isRowNumberSelecting(...t){return this.selectionMode.rowNumber&&!t.some(({column:{type:r}})=>r!=="rownumber"&&r!=="sequence")}selectionShouldIncludeChildren(t){var r;const{includeChildren:n,multiSelect:s}=this.selectionMode;return(n==="always"||n===!0&&this._isCheckboxSelecting)&&s&&!t.isLeaf&&((r=t.allChildren)==null?void 0:r.length)}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(t){this._isKeyboardRangeSelecting=!0,this["navigate"+t](),this._isKeyboardRangeSelecting=!1}onCellNavigate(t,r,n,s){var a,l;const{selectionMode:o,_selectionListenersDetachers:d}=t,{multiSelect:c,alwaysMultiSelect:u,deselectOnClick:h,dragSelect:g}=o,{ctrlKeyDown:f,shiftKeyDown:m}=le,p=le.isMouseDown(),v=le.isMouseDown(2),b=le.currentMouseDown||le.currentKeyDown;if(n=t.normalizeCellContext(n),t.selectionDisabled||!s||n.rowIndex===-1||(a=n.record)!=null&&a.isGroupHeader||b!=null&&b.fromKeyMap&&!o.selectOnKeyboardNavigation||t.columns.getById(n.columnId)===t.checkboxSelectionColumn||o.checkboxOnly||(b==null?void 0:b.handled)===!0&&!t._fromFocusCell)return;m||(t._isAddingToSelection=(f||u)&&c,t._selectionStartCell=n),c&&g&&p&&!d.selectiondrag&&!t.preventDragSelect&&(d.selectiondrag=V.on({name:"selectiondrag",element:t.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:t})),t.preventDragSelect=!1;const w=t._selectionStartCell,D=t._isAddingToSelection;if((m&&p||t._isKeyboardRangeSelecting)&&w&&c)t.performSelection(t.internalSelectRange(w,n,t.isRowNumberSelecting(w,n)));else{let S=!1,x=!0,R;if(t.isCellSelected(n,!0)){if(v)return;if(D||h)R=[n],x=!1;else if(t.selectedRecords.length+(t.isCellSelectionMode?t._selectedCells.length:0)<=1)return;S=h||c}!R&&!D&&(R=null,g&&S&&d.selectiondrag&&(t._clearSelectionOnSelectionDrag=!0));const M=(_,k)=>{var F;if(k==null||k(),!si.dragging){if(((F=_==null?void 0:_.target)==null?void 0:F.nodeType)===Node.ELEMENT_NODE){const I=new Se(_.target);if(I!=null&&I.grid&&!I.equals(n,!0))return}m||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(R,x&&[n],R===null,x&&t.isRowNumberSelecting(n)))}};if((l=t.features.rowReorder)!=null&&l.isDragging)return;S?t.delayUntilMouseUp(M):M()}}prepareSelection(t,r,n=!1,s=!1){const a=this,{_isSelectionDragging:l,store:o}=a,{includeParents:d,selectRecordOnCell:c}=a.selectionMode,u=[],h=n?a._selectedCells:[],g=[],f=n?a._selectedRows:[],m=B.keyBy(f,"id",()=>1),p=n?a.selectedRecords.filter(b=>!m[b.id]):[];let v=[];if(!n&&t)for(const b of B.asArray(t)){const w=a.normalizeCellContext(b),D=(w==null?void 0:w.record)||(b.isModel?b:o.getById(w.id));if(!w.isSpecialRow&&(h.push(w),D&&!m[D.id]&&(l||a.isSelected(D)?(f.push(D),m[D.id]=1):c&&a.selectedRecordCollection.get(D.id)&&!p.some(S=>S.id===D.id)&&p.push(D),a.selectionShouldIncludeChildren(D))))for(const S of D.allChildren)!m[S.id]&&(l||a.isSelected(S))&&(f.push(S),m[S.id]=1)}if(r){const b={};for(const w of B.asArray(r)){const D=a.normalizeCellContext(w),S=(D==null?void 0:D.record)||(w.isModel?w:o.getById(D.id));if(!D.isSpecialRow&&(a.isCellSelectionMode&&!s&&u.push(D),(a.isRowSelectionMode||s)&&!b[S.id]&&(g.push(S),b[S.id]=1,a.selectionShouldIncludeChildren(S))))for(const x of S.allChildren)b[x.id]||(g.push(x),b[x.id]=1)}c&&u.length&&(v=B.unique(u.map(w=>w.record)).filter(w=>!b[w.id]))}if(d&&(f.length||g.length)){const b=[...f,...g];B.unique(b.filter(D=>D.parent&&!D.allChildren.some(S=>b.includes(S))).map(D=>D.parent)).forEach(D=>a.toggleParentSelection(D,g,f))}return a.cleanSelectionChange({selectedCells:u,selectedRecords:g,deselectedCells:h,deselectedRecords:f,deselectAll:n,action:g!=null&&g.length||u!=null&&u.length?"select":"deselect",selectedCellRecords:v,deselectedCellRecords:p})}toggleParentSelection(t,r,n){if(!t||t.isRoot)return;const s=this.isSelected(t),a=r.includes(t),l=n.includes(t),o=d=>this.isSelected(d)&&!n.includes(d)||r.includes(d);this.selectionMode.includeParents==="some"?t.allChildren.some(o)?(!s||l)&&!a&&r.push(t):s&&!l&&n.push(t):s?!l&&!a&&t.allChildren.some(d=>n.includes(d))&&n.push(t):a||t.allChildren.every(o)&&r.push(t),t.parent&&this.toggleParentSelection(t.parent,r,n)}internalSelectRange(t,r,n=!1){const s=this,a=s.isRowSelectionMode||n,l=s.prepareSelection(s._shiftSelectRange,s.getRange(t,r,a),!1,n);return s._shiftSelectRange=l[`selected${a?"Records":"Cells"}`],l}getRange(t,r,n=!1){const s=this,{store:a}=s,l=s.normalizeCellContext(t),o=s.normalizeCellContext(r),d=Math.min(l.rowIndex,o.rowIndex),c=Math.max(l.rowIndex,o.rowIndex),u=[],h=Math.min(l.columnIndex,o.columnIndex),g=Math.max(l.columnIndex,o.columnIndex);if(d===-1||c===-1)throw new Error("Record not found in selectRange");if(n){const f=a.getRange(d,c+1,!1);o.rowIndex<l.rowIndex&&f.reverse(),u.push(...f)}else for(let f=d;f<=c;f++)for(let m=h;m<=g;m++)u.push({rowIndex:f,columnIndex:m});return u.map(f=>s.normalizeCellContext(f))}performSelection(t,r=!0,n=!1){const s=this,{selectedRecords:a=[],selectedCells:l=[],selectedCellRecords:o=[],deselectedRecords:d=[],deselectedCells:c=[],deselectedCellRecords:u=[],action:h}=t,g=[...a,...o],f=[...d,...u],m=s.isRowSelectionMode;if(s.trigger("beforeSelectionChange",{mode:m?"row":"cell",action:h,selected:g,deselected:f,selection:s.selectedRecords,selectedCells:l,deselectedCells:c,cellSelection:s.selectedCells})===!1)return s.removeDragListeners(),!1;if(s._selectedCells===c)s._selectedCells=[];else{const p=[];for(const v of s._selectedCells)!c.some(b=>v.equals(b,!0))&&!l.some(b=>v.equals(b,!0))&&p.push(v);s._selectedCells=p}if(t.deselectedRecords=[...d],d===s._selectedRows)s._selectedRows.length=0,s.changeSelectedRecordCollectionSilent(p=>p.clear());else{const p=[],v=[],b=B.keyBy(f,"id",()=>1);for(const w of s.selectedRecords)b[w.id]||(s.isSelected(w)?p.push(w):v.push(w));s._selectedRows=p,s.changeSelectedRecordCollectionSilent(w=>w.values=[...p,...v])}if(l.length)for(const p of l)s._selectedCells.some(v=>v.equals(p,!0))||s._selectedCells.push(p);a.length&&(s._selectedRows.push(...a.filter(p=>!s._selectedRows.some(v=>v.id===p.id))),s.changeSelectedRecordCollectionSilent(p=>p.add(...a))),o.length&&s.changeSelectedRecordCollectionSilent(p=>p.add(...o)),r&&s.refreshGridSelectionUI(t),s.afterSelectionChange(t),n||s.triggerSelectionChangeEvent(t)}refreshGridSelectionUI({selectedRecords:t,selectedCells:r,deselectedRecords:n,deselectedCells:s}){const a=this,{checkboxSelectionColumn:l}=a;l==null||l.suspendEvents(),a.updateGridSelectionRecords(t,!0),a.updateGridSelectionRecords(n,!1),a.updateCheckboxHeader(),l==null||l.resumeEvents(),a.isCellSelectionMode&&(a.updateGridSelectionCells(r,!0),a.selectionMode.column&&a.updateGridSelectionColumns(r)),a.updateGridSelectionCells(s,!1)}updateGridSelectionRecords(t,r){const{checkboxSelectionColumn:n}=this;if(t!=null&&t.length)for(let s=0;s<t.length;s++){const a=this.getRowFor(t[s]);a&&(a.toggleCls("b-selected",r),a.setAttribute("aria-selected",r),n&&!n.hidden&&!t[s].isSpecialRow&&(a.getCell(n.id).widget.checked=r))}}updateGridSelectionCells(t,r){if(t!=null&&t.length)for(let n=0;n<t.length;n++){const s=this.getCell(t[n]);s&&(s.setAttribute("aria-selected",r),s.classList.toggle("b-selected",r))}}updateGridSelectionColumns(t){var r;const{count:n}=this.store;for(const s of this.columns.visibleColumns)(r=s.element)==null||r.classList.toggle("b-selected",(t==null?void 0:t.filter(a=>a.columnId===s.id).length)===n)}triggerSelectionChangeEvent(t){const{selectedRecords:r=[],selectedCells:n=[],selectedCellRecords:s=[],deselectedRecords:a=[],deselectedCells:l=[],deselectedCellRecords:o=[]}=t,d=[...r,...s],c=[...a,...o],u=this.isRowSelectionMode;this.trigger("selectionChange",{mode:u?"row":"cell",action:t.action,selected:d,deselected:c,selection:this.selectedRecords,selectedCells:n,deselectedCells:l,cellSelection:this.selectedCells})}doDestroy(){var t;((t=this.selectedRecordCollection)==null?void 0:t.owner)===this&&this.selectedRecordCollection.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const r in this._selectionListenersDetachers)this._selectionListenersDetachers[r]();super.doDestroy()}get widgetClass(){}},y(e,"$name","GridSelection"),y(e,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{},selectionDisabled:!1}),e},LF=i=>i.columns.suspendEvents(),PF=i=>i.columns.resumeEvents(),OF=i=>{i.columns.clearCaches(),i.columns.fillFromMaster()},Jm=(i,e)=>i.stateSortIndex-e.stateSortIndex,GS=i=>{var e;return e=class extends(i||$){updateStore(t,r){var n;(n=super.updateStore)==null||n.call(this,t,r),this.detachListeners("stateStoreListeners"),t==null||t.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(t,r){var n;(n=super.updateColumns)==null||n.call(this,t,r),this.detachListeners("stateColumnListeners"),t.ion({name:"stateColumnListeners",change:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateRowManager(t,r){var n;(n=super.updateRowManager)==null||n.call(this,t,r),this.detachListeners("stateRowManagerListeners"),t.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",toggleGroup:({allRecords:t})=>!t&&this.triggerUpdate(),thisObj:this})}getState(){var t;const r=this,n=r.element.style.cssText,s={rowHeight:r.rowHeight};if(n&&(s.style=n),r.selectedCell){const{id:l,columnId:o}=r.selectedCell;s.selectedCell={id:l,columnId:o}}!r.disableGridColumnIdWarning&&r.columns.find(l=>l.meta.generatedId===l.id)&&console.warn("Column(s) without id detected. When saving and restoring state, columns without a configured id can be restored incorrectly."),s.selectedRecords=r.selectedRecords.map(l=>l.id),s.columns=r.columns.allRecords.map(l=>l.getState()),s.store=r.store.state,s.scroll=r.storeScroll();const a=(t=r.features.treeGroup)==null?void 0:t.levels;(a==null?void 0:a.length)>0&&!a.some(l=>!l.fieldName)&&(s.treeGroupLevels=r.features.treeGroup.levels.map(l=>l.fieldName)),s.subGrids={},r.eachSubGrid(l=>{var o;const d=s.subGrids[l.region]=s.subGrids[l.region]||{};l.isPainted?l.flex==null&&(d.width=l.width):l.config.width!=null?d.width=l.config.width:d.flex=l.config.flex,d.collapsed=(o=l.collapsed)!=null?o:!1,d.collapsed&&(d._beforeCollapseState=l._beforeCollapseState)});for(const[l,o]of Object.entries(this.features)){const d=o.state;d&&(s.features=s.features||{},s.features[l]=d)}return s}applyState(t){var r,n;const s=this,{columns:a}=s;if(t=Object.assign({},t),s.suspendRefresh(),"columns"in t){let o=!1,d=!1;a.suspendEvents(),s.eachSubGrid(LF);const c=new Set,u=new Map;t.columns.forEach((h,g)=>{var f,m;const p=(m=a.lookupStateColumns(h).filter(v=>!c.has(v))[0])!=null?m:((f=s.stateSettings)==null?void 0:f.restoreUnconfiguredColumns)&&a.add({id:h.id,type:h.type,field:h.field})[0];if(p){c.add(p),u.set(h,p);const v=p.generation;"region"in h&&!(h.region in s.subGrids)&&(delete h.region,delete h.locked),p.applyState(h),o=o||p.generation!==v,p.stateSortIndex=g,p.allIndex!==g&&(d=o=!0)}}),t.columns.forEach(h=>{if("parentId"in h){const g=t.columns.find(p=>p.id===h.parentId),f=u.get(g),m=u.get(h);f&&m&&m.parent!==f&&f.insertChild(m)}}),o&&s.eachSubGrid(OF),d&&(s.eachSubGrid(h=>{h.columns.records.sort(Jm),h.columns.allRecords.sort(Jm)}),a.sort({fn:Jm,ascending:!0})),s.isPainted&&o&&s.renderContents(),a.resumeEvents(),s.eachSubGrid(PF),delete t.columns}"subGrids"in t&&(s.eachSubGrid(o=>{if(o.region in t.subGrids){const d=t.subGrids[o.region];"width"in d?o.width=d.width:"flex"in d&&(o.flex=d.flex),"collapsed"in d&&(o.collapsed=d.collapsed,o._beforeCollapseState=d._beforeCollapseState)}o.clearWidthCache()}),delete t.subGrids),"store"in t&&(s.store.state=t.store,delete t.store);const l=t.scroll;if(delete t.scroll,"features"in t){for(const o in t.features)(n=(r=this.features[o])==null?void 0:r.setConfig)==null||n.call(r,t.features[o]);delete t.features}T.assign(s,t),"treeGroupLevels"in t&&s.features.treeGroup&&(s.features.treeGroup.levels=t.treeGroupLevels),s.resumeRefresh(!0),s.whenVisible(()=>s.applyScrollState(l))}applyScrollState(t){const r=this;r.eachSubGrid(n=>n.refreshFakeScroll()),t&&(r.restoreScroll(t),t.scrollTop&&r.element.querySelectorAll(".b-resize-monitored").forEach(n=>{const s=z.fromElement(n);s&&s.onElementResize(n)}))}get widgetClass(){}},y(e,"$name","GridState"),y(e,"configurable",{statefulEvents:["subGridCollapse","subGridExpand","horizontalScrollEnd","verticalScrollEnd","stateChange","selectionChange","collapseAllGroups","expandAllGroups","treeGroupChange"],stateSettings:{restoreUnconfiguredColumns:!0}}),e},$F=Promise.resolve(),HF={block:"nearest"},Qm=class extends At{updateYScroller(i){i==null||i.addScroller(this)}scrollIntoView(i,e=HF){const t=this,{xDelta:r,yDelta:n}=t.getDeltaTo(i,e);let s=r||n?t.scrollBy(r,n,e):$F;if(e.highlight||e.focus){const a=s;s=s.then(()=>{var l,o;a.cancelled||(i=i instanceof L?i:(o=(l=e.elementAfterScroll)==null?void 0:l.call(e))!=null?o:i,e.highlight&&(i instanceof L?i.translate(-r,-n).highlight():E.highlight(i)),e.focus&&i.focus({preventScroll:!0}))}),s.cancel=()=>{var l;return(l=a.cancel)==null?void 0:l.call(a)}}return s}scrollBy(i,e,t){const r=e&&this.yScroller.scrollBy(0,e,t),n=i&&super.scrollBy(i,0,t),s=Promise.all([n,r]);return s.cancel=()=>{var a,l;(a=n==null?void 0:n.cancel)==null||a.call(n),(l=r==null?void 0:r.cancel)==null||l.call(r),s.cancelled=!0},n!=null&&n.cancel&&(r!=null&&r.cancel)&&(t.force=!0),s}scrollTo(i,e,t){const r=e!=null&&this.yScroller.scrollTo(null,e,t),n=i!=null&&super.scrollTo(i,null,t);t&&t.animate||this.syncPartners();const s=Promise.all([n,r]);return s.cancel=()=>{var a,l;(a=n==null?void 0:n.cancel)==null||a.call(n),(l=r==null?void 0:r.cancel)==null||l.call(r),s.cancelled=!0},n!=null&&n.cancel&&(r!=null&&r.cancel)&&(t.force=!0),s}get viewport(){const i=L.from(this.element);return(this.yScroller?i.intersect(L.from(this.yScroller.element)):i)||new L(i.x,i.y,i.width,0)}set y(i){this.yScroller&&(this.yScroller.y=i)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}suspendEvents(){var i;super.suspendEvents(),(i=this.yScroller)==null||i.suspendEvents()}resumeEvents(){var i;super.resumeEvents(),(i=this.yScroller)==null||i.resumeEvents()}};y(Qm,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),Qm._$name="SubGridScroller";var YS=(i,e)=>i+e.getBoundingClientRect().width,qt=class extends z{construct(i){super.construct(i),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),re.isTestEnv&&(this.hideOverlayScroller.delay=50)}doDestroy(){var i;const e=this;e.header.destroy(),e.footer.destroy(),(i=e.fakeScroller)==null||i.destroy(),e.virtualScrollerElement.remove(),e.splitterElements.forEach(t=>t.remove()),super.doDestroy()}get barConfig(){const i=this,{width:e,flex:t}=i.element.style,r={subGrid:i,parent:i,maxWidth:i.maxWidth||void 0,minWidth:i.minWidth||void 0};return t?r.flex=t:e&&(r.width=e),r}changeHeader(i){return new this.headerClass(T.assign({id:this.id+"-header"},this.barConfig,i))}changeFooter(i){return new this.footerClass(T.assign({id:this.id+"-footer"},this.barConfig,i))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(i,e=!0,t=!0){this.splitterElements.forEach(r=>r==null?void 0:r.classList[e?"add":"remove"](i)),t&&this.scrollable.eachPartner(({scroller:r})=>{var n,s;r.owner!==this&&((s=(n=r.owner).toggleSplitterCls)==null||s.call(n,i==="b-hover"?"b-partner-splitter-hover":"b-hover",e,!1))})}hideSplitter(){this.splitterElements.forEach(i=>i.classList.add("b-hide-display")),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach(i=>i.classList.remove("b-hide-display")),this.$showingSplitter=!0}changeElement(i,e){const{region:t}=this;return super.changeElement({tabIndex:-1,"aria-label":`${t} subgrid`,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${t}`]:t,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:t}},e)}get rowElementConfig(){const{grid:i}=this;return{role:"row",className:i.rowCls,children:this.columns.visibleColumns.map((e,t)=>({role:"gridcell","aria-colindex":t+1,tabIndex:i.cellTabIndex,className:"b-grid-cell",dataset:{column:e.field||"",columnId:e.id}}))}}changeVirtualScrollerElement(){const i=E.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=i.virtualScrollerWidth,i.virtualScrollerElement}changeSplitterElement(){const i=E.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[Y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[Y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[Y.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=i.splitterButtons,i.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[Y.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return E.createElement(this.splitterConfig)}changeScrollerSplitter(){return E.createElement(this.splitterConfig)}changeFooterSplitter(){return E.createElement(this.splitterConfig)}render(...i){const e=this;super.render(...i),e.grid&&(e.updateHasFlex(),e.element.parentNode.insertBefore(e.splitterElement,e.element.nextElementSibling),e.splitterElements.forEach(t=>V.on({element:t,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:e})),e._collapsed&&e.collapse())}toggleHeaders(i){const e=this;if(i)e.headerSplitter.remove(),e.header.element.remove(),e.scrollable.removePartner(e.header.scrollable,"x");else{const{grid:t}=e;if(!e.isConfiguring){const r=t.items.indexOf(e)*2;E.insertAt(t.headerContainer,e.headerSplitter,r),E.insertAt(t.headerContainer,e.header.element,r),e.refreshHeader()}e.scrollable.addPartner(e.header.scrollable,"x")}}refreshHeader(){this.header.refreshContent()}refreshColumnHeader(i){this.header.refreshColumn(i)}refreshFooter(){var i;(i=this.footer)==null||i.refreshContent()}get childItems(){return[this.header,this.footer]}fixCellWidths(i){const{visibleColumns:e}=this.columns;let t=i.firstElementChild,r=0;for(;t;){const n=e[r],{element:s}=n;n.minWidth&&(t.style.minWidth=E.setLength(n.minWidth)),n.maxWidth&&(t.style.maxWidth=E.setLength(n.maxWidth)),n.flex?n.childLevel&&s?(t.style.flex=`0 0 ${s.getBoundingClientRect().width}px`,t.style.width=""):(t.style.flex=n.flex,t.style.width=""):n.width?t.style.width=E.setLength(n.width):t.style.flex=t.style.width=t.style.minWidth="",t=t.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}get headerScrollWidth(){return[...this.header.contentElement.children].reduce(YS,0)||this.columns.totalFixedWidth}fixWidths(){const i=this,{element:e,header:t,footer:r}=i;if(!i.collapsed){if(i.flex)t.flex=i.flex,r&&(r.flex=i.flex),e.style.flex=i.flex;else{if(i.hasCalculatedWidth&&!i.columns.some(s=>!s.hidden&&s.flex)&&i.totalFixedWidth!==i.width){i.width=i.totalFixedWidth,i.hasCalculatedWidth=!0;return}i.clearWidthCache();let n=i.width;if(!n&&i.hasCalculatedWidth){n=0;for(const s of i.columns)!s.flex&&!s.hidden&&(n+=s.width)}e.style.width=`${n}px`,t.width=n,r&&(r.width=n)}i.handleHorizontalScroll(!1)}}fixRowWidthsInSafariEdge(){if(Y.isSafari){const i=this,{region:e,header:t}=i,r=t.calculateMinWidthForSafari();i.rowManager.forEach(n=>{const s=n.getElement(e);s&&(s.style.width=`${r}px`)}),t.headersElement.style.width=`${r}px`}}set width(i){var e,t;const r=this;r.hasCalculatedWidth=!1,super.width=i,r.header.width=i,r.footer.width=i,r.isPainted&&r.onElementResize(),!r.isExpanding&&!r.isCollapsing&&!r.isConfiguring&&((t=(e=r.grid).syncSplits)==null||t.call(e,n=>n.subGrids[r.region]&&(n.subGrids[r.region].width=i)))}get width(){return super.width}set flex(i){var e,t;const r=this;r.hasCalculatedWidth=!1,r.header.flex=i,r.footer.flex=i,super.flex=i,r.isPainted&&r.onElementResize(),!r.isExpanding&&!r.isCollapsing&&!r.isConfiguring&&((t=(e=r.grid).syncSplits)==null||t.call(e,n=>n.subGrids[r.region]&&(n.subGrids[r.region].flex=i)))}get flex(){return super.flex}onInternalResize(i,e,t,r,n){var s;const a=this,{grid:l}=a;super.onInternalResize(...arguments),l!=null&&l.isPainted&&(a.syncSplitterButtonPosition(),e!==r&&(a.trigger("beforeInternalResize",a),(s=l.beforeSubGridInternalResize)==null||s.call(l,a),l.trigger("horizontalScroll",{grid:l,subGrid:a,scrollLeft:a.scrollable.scrollLeft,scrollX:a.scrollable.x}),l.trigger("horizontalScrollEnd",{subGrid:a,scrollLeft:a.scrollable.scrollLeft}),a.fakeScroller&&a.refreshFakeScroll(),l.syncFlexedSubCols(),a.fixRowWidthsInSafariEdge()),t!==n&&l.onHeightChange(),a.trigger("afterInternalResize",a))}syncParallelSplitters(i){const e=this,{grid:t}=e;if(e.splitterElement&&e.$showingSplitter)e.toggleSplitterCls("b-grid-splitter-collapsed",i);else{const r=t.getSubGrid(t.getPreviousRegion(e.region));r&&r.splitterElement&&r.syncParallelSplitters(i)}}onSplitterMouseEnter(){const i=this,{nextSibling:e}=i;!i.collapsed&&(!e||!e.collapsed)&&i.toggleSplitterCls("b-hover"),i.startSplitterButtonSyncing()}onSplitterMouseLeave(){const i=this,{nextSibling:e}=i;i.toggleSplitterCls("b-hover",!1),!i.collapsed&&(!e||!e.collapsed)&&i.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const i=this;i.splitterElement&&(i.syncSplitterButtonPosition(),i.splitterSyncScrollListener||(i.splitterSyncScrollListener=i.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:i})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:i}=this;this.splitterButtons.style.top=`${i.scrollable.y+(i.bodyHeight-(this.headerSplitter?i.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:i}=this;return new L(i.x,i.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(i){this.splitterElements.forEach(e=>E.toggleClasses(e,["b-disabled"],!i))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach(i=>{i.resizeToFitContent(null,null,!0)}),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&(this.grid.hideHeaders?this.scrollable.hasOverflow("x"):this.header.scrollable.hasOverflow("x"))}get overflowingVertically(){return!1}refreshFakeScroll(){const i=this,{element:e,virtualScrollerElement:t,virtualScrollerWidth:r,header:n,footer:s,scrollable:a}=i,l=[...n.contentElement.children].reduce(YS,0);a.scrollWidth=l,e.style.setProperty("--total-column-width",`${i.headerScrollWidth}px`),t.style.width=e.style.width,t.style.flex=e.style.flex,t.style.minWidth=e.style.minWidth,t.style.maxWidth=e.style.maxWidth,n.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),i.collapsed||(i.overflowingHorizontally?(r.style.width=`${a.scrollWidth||0}px`,i.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const i=this,{scrollable:e,virtualScrollerElement:t,grid:r}=i;i.fakeScroller=new At({element:t,overflowX:!0,widget:i}),e.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:i}),r.hideHorizontalScrollbar||(e.addPartner(i.fakeScroller,"x"),i.refreshFakeScroll()),r.hideHeaders||e.addPartner(i.header.scrollable,"x"),r.hideFooters||e.addPartner(i.footer.scrollable,"x")}onSubGridScrollEnd(i){const e=this,{grid:t}=e;e.scrollingToCenter=i==null?void 0:i.scrollingToCenter,e.scrolling=!1,e.handleHorizontalScroll(!1),E.scrollBarWidth||(t.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller()),t.trigger("horizontalScrollEnd",{subGrid:e})}onSubGridScroll(i){const e=this;e.scrollingToCenter=i==null?void 0:i.scrollingToCenter,e.handleHorizontalScroll()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(i){this._scrolling=i}get scrolling(){return this._scrolling}handleHorizontalScroll(i=!0){const e=this,{grid:t}=e;!e.scrolling&&i&&(e.scrolling=!0,E.scrollBarWidth||(t.virtualScrollers.classList.add("b-scrolling"),e.showOverlayScroller())),t.trigger("horizontalScroll",{subGrid:e,grid:t,scrollLeft:e.scrollable.scrollLeft,scrollX:e.scrollable.x,scrollingToCenter:e==null?void 0:e.scrollingToCenter})}scrollColumnIntoView(i,e){const{columns:t,header:r}=this,n=r.scrollable;if(i=i instanceof He?i:t.get(i)||t.getById(i)||t.getAt(i),i){const s=r.getHeader(i.id);if(s)return n.scrollIntoView(L.from(s,null,!0),e)}}onAddRow({source:i=this.grid.rowManager,rows:e}){var t;const r=this,{region:n}=r,s=r.rowElementConfig,a=document.createDocumentFragment(),l=(t=i.rows[e[e.length-1].index+1])==null?void 0:t.elements[n];e.forEach(o=>{const d=E.createElement(s);E.syncClassList(d,o.cls),a.appendChild(d),o.addElement(n,d),r.fixCellWidths(d)}),r.fixRowWidthsInSafariEdge(),r.element.insertBefore(a,l||r.insertRowsBefore)}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const i=this.element.querySelectorAll(".b-grid-row"),e=document.createRange();i.length&&(e.setStartBefore(i[0]),e.setEndAfter(i[i.length-1]),e.deleteContents())}addNewRowElement(){const i=E.append(this.element,this.rowElementConfig);return this.fixCellWidths(i),i}get store(){return this.grid.store}get rowManager(){var i;return(i=this.grid)==null?void 0:i.rowManager}changeCollapsed(i){return!!i}updateCollapsed(i,e){this.isConfiguring||(this._fromPropertyUpdate=!0,i?this.collapse():this.expand(),this._fromPropertyUpdate=!1)}async collapse(i,e=!1){const t=this,{grid:r}=t,{partners:n}=r;if(i=i&&Object.keys(r.subGrids).length<=2,!(r.rendered&&t._collapsed===!0&&!t._fromPropertyUpdate)){if(r.partners&&!e){r.isSyncingFromPartner=!0,n.forEach(s=>s.isSyncingFromPartner=!0),await Promise.all([t.collapse(i,!0),...n.map(s=>{var a;return(a=s.subGrids[t.region])==null?void 0:a.collapse(i,!0)})]),n.forEach(s=>s.isSyncingFromPartner=!1),r.isSyncingFromPartner=!1;return}if(i){if(r.element.classList.add("b-subgrid-width-transition"),await r.runWithTransition(()=>t._collapseInternal(!0),!0),t.isDestroyed)return;r.element.classList.remove("b-subgrid-width-transition")}else t._collapseInternal(!1);r.trigger("subGridCollapse",{subGrid:t}),r.afterToggleSubGrid({subGrid:t,collapsed:!0}),t.isCollapsing=!1,r.trigger("afterInternalResize")}}async _collapseInternal(i=!1){var e,t;const r=this,{grid:n,element:s}=r,a=n.getSubGrid(n.getNextRegion(r.region)),l=r.splitterElement?r:r.previousSibling;let{_beforeCollapseState:o}=r,d=0;if(r.isCollapsing=!0,n.eachSubGrid(u=>{u!==r&&!u._collapsed&&++d}),(e=n.syncSplits)==null||e.call(n,u=>{var h;return(h=u.subGrids[r.region])==null?void 0:h.collapse(i)}),d===0){if(!a)return;await a.expand()}let c=!1;o||(o=r._beforeCollapseState={},r.width&&(c=!0),o.width=r.width,o.elementWidth=s.style.width,s.style.flex!==""&&(o.flex=s.style.flex,r.header.element.style.flex=s.style.flex=""),a.element.style.flex===""&&(o.nextRegionWidth=a.width,a.width="",a.flex=`1 1 ${o.nextRegionWidth}px`),s.classList.add("b-grid-subgrid-collapsed"),r.virtualScrollerElement.classList.add("b-collapsed"),r.header.element.classList.add("b-collapsed"),r.footer.element.classList.add("b-collapsed"),r._collapsed=!0,r.width="",c||r.syncParallelSplitters(!0)),r.isDestroyed||c&&(n.refreshVirtualScrollbars(),r.syncParallelSplitters(!0),(t=l.startSplitterButtonSyncing)==null||t.call(l))}async expand(i,e=!1){const t=this,{grid:r}=t,{partners:n}=r;if(i=i&&Object.keys(r.subGrids).length<=2,!(r.rendered&&t._collapsed!==!0&&!t._fromPropertyUpdate)){if(n&&!e){r.isSyncingFromPartner=!0,n.forEach(s=>s.isSyncingFromPartner=!0),await Promise.all([t.expand(i,!0),...n.map(s=>{var a;return(a=s.subGrids[t.region])==null?void 0:a.expand(i,!0)})]),n.forEach(s=>s.isSyncingFromPartner=!1),r.isSyncingFromPartner=!1;return}if(i){if(r.element.classList.add("b-subgrid-width-transition"),await r.runWithTransition(()=>t._expandInternal(!0),!0),t.isDestroyed)return;r.element.classList.remove("b-subgrid-width-transition")}else t._expandInternal(!1);t.columns.clearCaches(),r.trigger("subGridExpand",{subGrid:t}),r.afterToggleSubGrid({subGrid:t,collapsed:!1}),t.isExpanding=!1,r.trigger("afterInternalResize")}}async _expandInternal(i=!1){var e;const t=this,{grid:r,_beforeCollapseState:n}=t,s=r.getSubGrid(r.getNextRegion(t.region)),a=t.splitterElement?t:t.previousSibling;if(t.isExpanding=!0,(e=r.syncSplits)==null||e.call(r,l=>{var o;return(o=l.subGrids[t.region])==null?void 0:o.expand(i)}),n!=null){let l=!1;t.width!==n.elementWidth&&(l=!0),n.nextRegionWidth&&(s.width=n.nextRegionWidth,s.flex=null),t.element.classList.remove("b-grid-subgrid-collapsed"),t._collapsed=!1,t.virtualScrollerElement.classList.remove("b-collapsed"),t.header.element.classList.remove("b-collapsed"),t.footer.element.classList.remove("b-collapsed"),n.flex?(t.width=n.width,t.header.flex=t.flex=n.flex,t.footer.flex=n.flex,t._width=null):t.width=n.elementWidth,l&&(a.stopSplitterButtonSyncing(),t.syncParallelSplitters(!1)),delete t._beforeCollapseState}}hide(){var i,e;return(i=this.header)==null||i.hide(),(e=this.footer)==null||e.hide(),this.hideSplitter(),super.hide()}show(){var i,e;const t=this;return(i=t.header)==null||i.show(),(e=t.footer)==null||e.show(),t.region!==t.grid.regions[t.grid.regions.length-1]&&t.showSplitter(),super.show()}};y(qt,"$name","SubGrid"),y(qt,"type","subgrid"),y(qt,"defaultConfig",{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,defaultBindProperty:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:Qm,hasCalculatedWidth:null,sealedColumns:null}),y(qt,"configurable",{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,collapsed:!1,resizable:null,role:"rowgroup"}),y(qt,"delayable",{hideOverlayScroller:1e3}),qt.initClass(),qt._$name="SubGrid";var qS=i=>{var e;return e=class extends(i||$){static get properties(){return{subGrids:{}}}changeSubGridConfigs(t){var r;const n=this,s=new Set;for(const a of n.columns){const{region:l}=a;l&&(t[l]||(t[l]={}),s.add(l))}t.normal&&T.isEmpty(t.normal)&&(t.normal={flex:1}),(r=t.normal)!=null&&r.width&&delete t.normal.flex;for(const a of s)n.createSubGrid(a,t[a]);return n.items=n.subGrids,t}createSubGrid(t,r=null){const n=this,s=n.columns.chain(d=>d.region===t,["region"]),a=qt.mergeConfigs({type:"subgrid",id:`${n.id}-${t}Subgrid`,parent:n,grid:n,region:t,headerClass:n.headerClass,footerClass:n.footerClass,columns:s,weight:t,scrollable:{yScroller:n.scrollable}},r||n.subGridConfigs[t]);let l=!1;!a.flex&&!a.width&&a.flex!==0&&a.width!==0&&(a.width=s.totalFixedWidth,l=!0);const o=n.subGrids[t]=qt.create(a);return o.element.style.setProperty("--total-column-width",s.totalFixedWidth),o.hasCalculatedWidth=l,t===n.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(t){if(t.isSubGrid){const r=this,{items:n,headerContainer:s,virtualScrollers:a,footerContainer:l}=r,o=n.indexOf(t)*2;(!r.hideHeaders||r.columns.some(d=>d.flex))&&(E.insertAt(s,t.headerSplitter,o),E.insertAt(s,t.header.element,o)),E.insertAt(a,t.scrollerSplitter,o),E.insertAt(a,t.virtualScrollerElement,o),E.insertAt(l,t.footerSplitter,o),E.insertAt(l,t.footer.element,o),n.forEach((d,c)=>{c<n.length-1&&d.showSplitter()}),o===0&&r.emptyTextEl&&t.element.appendChild(r.emptyTextEl)}return super.onChildAdd(t)}onChildRemove(t){if(super.onChildRemove(t),t.isSubGrid){const{items:r}=this;delete this.subGrids[t.region],B.remove(this.regions,t.region),t.destroy(),r.length&&r[r.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid(t=>t.destroy()),super.doDestroy()}eachSubGrid(t,r=null){this.items.forEach((n,s)=>{n.isSubGrid&&t.call(r||n,n,s++)})}callEachSubGrid(t,...r){let n=null;return this.items.forEach((s,a)=>{if(s.isSubGrid&&s[t]){const l=s[t](...r);a===0&&(n=l)}}),n}get regions(){return this.items.map(t=>t.region)}getLastRegions(){const t=this.regions.slice(-2);return t.length===2?t:[t[0],t[0]]}getNextRegion(t){const r=this.regions;return r[r.indexOf(t)+1]||r[r.length-2]}getPreviousRegion(t){return this.regions[this.regions.indexOf(t)-1]}getSubGrid(t){return this.subGrids[t]}getSubGridFromColumn(t){return t=t instanceof He?t:this.columns.getById(t)||this.columns.get(t),this.getSubGrid(t.region)}resolveSplitter(t){const r=this.getLastRegions();let n=t instanceof qt?t.region:t;return r[1]===n&&(n=r[0]),this.subGrids[n].splitterElement}get widgetClass(){}},y(e,"$name","GridSubGrids"),e},VF=new String,NF={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,ChecklistFilterCombo:{search:"Search",selectAll:"Select All",removeAll:"Remove All",filtersSet:i=>i===1?"1 filter set":`${i} filters set`,noItems:"No results found",placeholder:"Filter...",apply:"Apply"},ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns",showName:i=>`Show column${i.text?` ${i.text}`:""}`,hideName:i=>`Hide column${i.text?` ${i.text}`:""}`},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:i=>`Move before "${i}"`,moveAfter:i=>`Move after "${i}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Split:{split:"Split",unsplit:"Unsplit",horizontally:"Horizontally",vertically:"Vertically",both:"Both"},LockRows:{lockRow:"Lock row",unlockRow:"Unlock row"},ActionColumn:{rowActions:"Row actions"},Column:{columnLabel:i=>`${i.text?`${i.text} column. `:""}SPACE for context menu${i.sortable?", ENTER to sort":""}`,cellLabel:VF},WidgetColumn:{rowWidgets:"Row widgets"},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset",toggleName:i=>`Toggle ${i.text||"value"}`},RatingColumn:{cellLabel:i=>{var e;return`${i.text?i.text:""} ${(e=i.location)!=null&&e.record?`rating : ${i.location.record.get(i.field)||0}`:""}`}},RowNumberColumn:{rowNumber:"Row number"},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:i=>`Move column to ${i}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",printSettings:"Print settings",print:"Print",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:i,totalPages:e})=>`Exporting page ${i}/${e}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:i,totalPages:e})=>`Exporting page ${i}/${e}`},RowExpander:{loading:"Loading",expand:"Expand row details",collapse:"Collapse row details",columnDescription:"Toggle row details"},TreeGroup:{group:"Group by",stopGrouping:"Stop grouping",stopGroupingThisColumn:"Ungroup column"}},VP=lt.publishLocale(NF),KS=new Promise(i=>i()),Fh="GridBase:store",BF={block:"nearest",inline:"nearest"},zF={dataset:1,pageLoad:1,filter:1},WF={hidden:1,mergeCells:1,region:1},jF=Object.freeze([]),XS=(i,e)=>i-e,Xr=class extends Xe.mixin(pf,Po,zS,WS,FF,jS,US,GS,qS,pm){constructor(){super(...arguments),y(this,"_animationSuspendedCounter",0)}static get delayable(){return{bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,disableAutoHeightWarning:null,disableNoIDWarning:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideHeaders:null,hideFooters:!0,cellEllipsis:!0,hideHorizontalScrollbar:null,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"$store",rowHeight:null,preserveScroll:!1,animateTreeNodeToggle:!re.isTestEnv,columnLines:!0,rowLines:!0,fixedRowHeight:null,formulaProviders:null}}static get defaultConfig(){return{defaultRowHeight:45,fullRowRefresh:!0,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},resizeToFitIncludesHeader:!0,animateRemovingRows:!0,animateFilterRemovals:null,disableGridRowModelWarning:null,disableGridColumnIdWarning:null,headerClass:ss,footerClass:nl,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:Xm,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(i){const e=this,{initScroll:t}=e;e.initScroll=()=>!e.scrollInitialized&&t.call(e),re.isTestEnv&&(e.bufferedAfterColumnsResized.delay=50,e.bufferedElementResize.delay=50),super.finishConfigure(i),Le.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:e}),Le.ion({locale:"onLocaleChange",prio:-1,thisObj:e}),le.ion({theme:"onThemeChange",thisObj:e}),e.ion({subGridExpand:"internalOnSubGridExpand",prio:-1,thisObj:e}),e.bufferedFixElementHeights=e.buffer("fixElementHeights",e.fixElementHeightsBuffer,e),e.setGridClassList(e.element.classList),e.verticalScroller.classList.remove("b-content-element","b-auto-container"),e.bodyWrapElement.classList.remove("b-auto-container-panel"),CSS.supports("selector(:has(*))")&&e.element.classList.add("b-supports-has")}internalOnSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(i,e){return e==null||e.destroy(),i?dd.new({element:this.element,owner:this},i):null}doDestroy(){var i,e;const t=this;t.detachListeners(Fh),(i=t.scrollManager)==null||i.destroy();for(const r of Object.values(t.features))(e=r.destroy)==null||e.call(r);t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(i){Object.values(this.features).forEach(t=>{if(t.disabled||t===!1)return;let r;Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?r=t.constructor.featureClass:r=`b-${t instanceof $?t.$$name:t.constructor.name}`,r&&i.add(r.toLowerCase())})}compose(){const{autoHeight:i,enableSticky:e,enableTextSelection:t,fillLastColumn:r,positionMode:n,showDirty:s}=this;return{class:{[`b-grid-${n}`]:1,"b-enable-sticky":e,"b-grid-notextselection":!t,"b-autoheight":i,"b-fill-last-column":r,"b-show-dirty":s,"b-show-dirty-during-edit":s==null?void 0:s.duringEdit}}}async recomposeInternal(){var i;let e;const{isConstructing:t}=this;if(t||(e=this.storeScroll()),await super.recomposeInternal(),!t){const r=[...Object.keys(e.scrollLeft).map(n=>e.scrollLeft[n]),e.scrollTop];if(Math.max(...r)){const n=this.storeScroll();Math.max([...Object.keys(n.scrollLeft).map(s=>n.scrollLeft[s]),n.scrollTop])||(i=this.restoreScroll)==null||i.call(this,e)}}}get cellCls(){const{_cellCls:i}=this;return i.value||i}get bodyConfig(){const{autoHeight:i,hideFooters:e,hideHeaders:t}=this;return{reference:"bodyElement",className:{"b-autoheight":i,"b-grid-panel-body":1},[this.hasHeader?"aria-labelledby":""]:`${this.id}-panel-title`,children:{headerContainer:{"aria-hidden":t,role:t?null:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":t}},bodyContainer:{className:"b-grid-body-container",role:"presentation",children:{verticalScroller:{role:"presentation",className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",role:null},footerContainer:{"aria-hidden":e,role:e?null:"row",className:{"b-grid-footer-container":1,"b-hidden":e}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateCellEllipsis(i){this.element.classList.toggle("b-use-ellipsis",i)}updateHideHeaders(i){var e;i=!!i,(e=this.headerContainer)==null||e.classList.toggle("b-hidden",i),this.eachSubGrid(t=>t.toggleHeaders(i))}updateHideFooters(i){var e;i=!!i,(e=this.footerContainer)==null||e.classList.toggle("b-hidden",i),this.eachSubGrid(t=>{t.scrollable[i?"removePartner":"addPartner"](t.footer.scrollable,"x")})}updateHideHorizontalScrollbar(i){i=!!i,this.eachSubGrid(e=>{e.virtualScrollerElement.classList.toggle("b-hide-display",i),this.isConfiguring||(e.scrollable[i?"removePartner":"addPartner"](e.fakeScroller,"x"),i||e.refreshFakeScroll())})}changeColumns(i,e){const t=this;if(!i&&e)return t.isDestroying?e.owner===t&&e.destroy():e.removeAll(),e;if(i.isStore)return(e==null?void 0:e.owner)===t&&e.destroy(),i.grid=t,i;if(Array.isArray(i)){if(e){const r=e.allRecords.slice();e.data=i;for(const n of r)e.includes(n)||n.destroy();return e}i={data:i}}if(e)throw new Error("Replacing ColumnStore is not supported");return Ve.new({grid:t,owner:t},i)}updateColumns(i,e){var t,r;const n=this,{formulaProviders:s}=n;if((t=super.updateColumns)==null||t.call(this,i,e),i.ion({refresh:n.onColumnsChanged,sort:n.onColumnsChanged,change:n.onColumnsChanged,move:n.onColumnsChanged,thisObj:n}),i.ion(sF(n.onColumnsResized,n)),Y.isTouchDevice&&(n.touch=!0,i.forEach(a=>{const{touchConfig:l}=a;l&&a.applyState(l)})),(r=n.bodyElement)==null||r.setAttribute("aria-colcount",i.visibleColumns.length),s){const{modelClass:a}=n.store;i.forEach(l=>{l.data.formula&&l.field&&a.fieldMap[l.field]&&(a.fieldMap[l.field].formulaProviders=s)})}}onColumnsChanged({type:i,action:e,changes:t,record:r,records:n,isMove:s}){var a;const l=this,{columns:o,checkboxSelectionColumn:d}=l,c=t&&Object.keys(t),u=(c==null?void 0:c.length)===1;if(s=s===!0?!0:s&&Object.values(s).some(g=>g),l.beforeColumnsChange({type:i,action:e,changes:t,column:r,columns:n}),s||i==="refresh"&&e!=="batch"&&e!=="sort"||e==="update"&&u&&"parentIndex"in t||e==="sort"&&o.isSyncingDataOnLoad)return;const h=e==="add"&&n.some(g=>g.region&&!l.subGrids[g.region]);if(!(l.isConfiguring||!h&&(!l.isPainted||s&&e==="remove"))){if(e==="add")for(const g of n){const{region:f}=g;l.subGrids[f]||l.add(l.createSubGrid(f,(a=l.subGridConfigs)==null?void 0:a[f]))}else if(e==="update"){const g=c[0];if(("width"in t||"minWidth"in t||"maxWidth"in t||"flex"in t)&&!("region"in t)){const{region:f}=r;o.visibleColumns.forEach(m=>{m.region===f&&m.repaintOnResize&&l.refreshColumn(m)}),l.afterColumnsChange({type:i,action:e,changes:t,column:r});return}if("text"in t&&u){r.subGrid.refreshHeader();return}if("hidden"in t){const f=l.getSubGridFromColumn(r.id);f.header.fixHeaderWidths(),f.footer.fixFooterWidths(),f.updateHasFlex()}else if(u&&!(g in WF)&&!r.hidden&&!r.subGrid.collapsed){r.subGrid.refreshHeader(),l.refreshColumn(r);return}}else e==="remove"&&n.forEach(g=>{var f;return(f=g.freeColumnWidgets)==null?void 0:f.call(g)});if(e==="dataset"||e==="batch"||e==="update"&&"region"in t){const g=o.getDistinctValues("region",!0),{toRemove:f,toAdd:m}=B.delta(g,l.regions,!0);l.remove(f.map(p=>l.getSubGrid(p))),l.add(m.map(p=>l.createSubGrid(p,l.subGridConfigs[p])))}if(d&&!o.includes(d)){const g=o.indexOf(o.findRecord("type","rownumber"))+1;o.insert(g,d,!0)}l._suspendRenderContentsOnColumnsChanged||l.renderContents(),l.syncFlexedSubCols(),l.bodyElement.setAttribute("aria-colcount",o.visibleColumns.length),l.afterColumnsChange({type:i,action:e,changes:t,column:r,columns:n})}}onColumnsResized({changes:i,record:e}){var t;const r=this;if(r.isConfiguring)return;const n=E.setLength(e.width),s=E.setLength(e.minWidth),a=E.setLength(e.maxWidth),l=r.getSubGridFromColumn(e.id);if(l.header.fixHeaderWidths(),l.footer.fixFooterWidths(),l.updateHasFlex(),!(e.flex&&e.childLevel)){(!r.cellEls||e!==r.lastColumnResized)&&(r.cellEls=E.children(r.element,`.b-grid-cell[data-column-id="${e.id}"]`),r.lastColumnResized=e);for(const o of r.cellEls)"width"in i&&(o.style.width=n),"minWidth"in i&&(o.style.minWidth=s),"maxWidth"in i&&(o.style.maxWidth=a),"flex"in i&&(o.style.flex=(t=e.flex)!=null?t:null)}r.resizingColumns||r.afterColumnsResized(e),r.syncFlexedSubCols()}afterColumnsResized(i){const e=this;e.eachSubGrid(t=>{!t.collapsed&&(!i||i.region===t.region)&&(t.fixWidths(),t.fixRowWidthsInSafariEdge())}),e.lastColumnResized=e.cellEls=null,e.bufferedAfterColumnsResized(i),e.onHeightChange()}syncFlexedSubCols(){const i=this.columns.query(e=>e.flex&&e.childLevel&&e.element);if(i)for(const e of i){const t=e.element.getBoundingClientRect().width,r=E.children(this.element,`.b-grid-cell[data-column-id="${e.id}"]`);for(const n of r)n.style.flex=`0 0 ${t}px`}}bufferedAfterColumnsResized(i){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid(e=>{!e.collapsed&&(!i||i.region===e.region)&&e.refreshFakeScroll()})}bufferedElementResize(){this.refreshRows()}onInternalResize(i,e,t,r,n){E.scrollBarWidth&&e<r&&this.eachSubGrid(s=>{s.flex&&s.onElementResize(s.element)}),super.onInternalResize(...arguments),this.isPainted&&e!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(i,e){const t=this;if(t._isRowMeasured||t.measureRowHeight(),e==null||e.destroy(),i){const r=Wd.new({grid:t,rowHeight:t.rowHeight,rowScrollMode:t.rowScrollMode||"move",autoHeight:t.autoHeight,fixedRowHeight:t.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:t}},i);return t.relayEvents(r,["beforeRenderRow","renderRow","removeRows"]),t._rowManager=null,r}}updateRowHeight(i){!this.isConfiguring&&this.rowManager&&(this.rowManager.rowHeight=i),this.element.style.setProperty("--b-grid-row-height",E.setLength(i))}updateFixedRowHeight(i){var e,t;i&&((t=(e=this.columns||this.peekConfig("columns"))==null?void 0:e.some)!=null&&t.call(e,r=>r.autoHeight))&&console.warn("One or more columns have `autoHeight` set, which is incompatible with `fixedRowHeight`.")}getRowHeight(i){return i.rowHeight}processRowHeight(i,e){}getAsyncEventSuffixForStore(i){return this.asyncEventSuffix}bindStore(i){const e=this.getAsyncEventSuffixForStore(i),{masterStore:t}=i;i.ion({name:Fh,[`refresh${e}`]:"onStoreDataChange",[`add${e}`]:"onStoreAdd",[`remove${e}`]:"onStoreRemove",[`replace${e}`]:"onStoreReplace",[`removeAll${e}`]:"onStoreRemoveAll",[`move${e}`]:i.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",clearChanges:"onStoreRecordClearChanges",startApplyChangeset:"internalOnStoreStartApplyChangeset",endApplyChangeset:"internalOnStoreEndApplyChangeset",lazyLoadStarted:"onStoreBeforeRequest",lazyLoadEnded:"onStoreAfterRequest",thisObj:this}),t==null||t.ion({name:Fh,beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",lazyLoadEnded:"onStoreAfterRequest",thisObj:this}),super.bindStore(i)}unbindStore(i){this.detachListeners(Fh),this.destroyStore&&i.destroy()}get $store(){return this.originalStore||this.store}changeStore(i){var e;return i==null?null:(typeof i=="string"&&(i=pe.getStore(i)),i.isStore||(i=T.assign({data:this.data,tree:!!((e=this.initialConfig.features)!=null&&e.tree)},i),i.data||delete i.data,i.modelClass||(i.modelClass=Kn),i=new(i.readUrl?Dt:pe)(i)),i)}updateStore(i,e){var t,r;const n=this;(t=super.updateStore)==null||t.call(this,i,e),e&&n.unbindStore(e),i&&(e&&n.deselectAll(),n.onStoreLoadOverride(),n.bindStore(i)),n.trigger("bindStore",{store:i,oldStore:e}),!n.isDestroying&&n.isPainted&&!n.refreshSuspended&&((r=n._rowManager)==null||r.reinitialize())}onStoreUpdateRecord({source:i,record:e,changes:t}){const r=this;if(!r.refreshSuspended)if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let n;if(e.isFieldModified("id")&&(n=r.getRowFor(e.meta.modified.id)),n=n||r.getRowFor(e),!n)return;if(r.fullRowRefresh||e.isSpecialRow){const s=i.indexOf(e);s!==-1&&n.render(s,e)}else r.columns.visibleColumns.forEach(s=>{const a=s.field;if(!(s.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(s.data,"renderer"))||t[a]){const o=n.getCell(a);o&&n.renderCell(o)}})}}refreshFromRowOnStoreAdd(i,e){const t=this,{rowManager:r}=t;r.renderFromRow(i),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),t.store.count===1&&t.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(i){super.onMaskAutoClose(i),this.toggleEmptyText()}onStoreAdd({source:i,records:e,index:t,oldIndex:r,isChild:n,oldParent:s,parent:a,isMove:l,isExpand:o,isExpandAll:d}){const c=this,{rowManager:u}=c;if(!c.isPainted||d||c.refreshSuspended)return;if(o&&c.animateTreeNodeToggle)return u.insert(u.getRowFor(a).index+1,e.length);const h=l&&e.some(D=>{if(l[D.id]){const S=i.getById(D.meta.modified.parentId);return(S==null?void 0:S.isExpanded(i))&&(S==null?void 0:S.ancestorsExpanded(i))}});if(n&&!e[0].ancestorsExpanded(i)&&!h){if(!a.isLeaf){const D=u.getRowById(a);D&&u.renderRows([D])}return}u.calculateRowCount(!1,!0,!0),i.isFiltered&&(t=i.indexOf(e[0]));const{topIndex:g,rows:f,rowCount:m}=u,p=u.topIndex+u.rowCount-1,v=t,b=t+e.length-1,w=p>=i.count-e.length-1;s||r>-1||n&&l&&Object.values(l).some(D=>D)?u.refresh():v>=g&&v<g+m?c.refreshFromRowOnStoreAdd(f[v-g],...arguments):b>=g&&b<g+m?u.refresh():(w&&t>p?u.fillBelow(c._scrollTop||0):t<g&&u.refresh(),u.estimateTotalHeight(!0))}onStoreException({action:i,type:e,response:t,exceptionType:r,error:n}){var s;const a=this;let l;switch(e){case"server":l=t.message||a.L("L{unspecifiedFailure}");break;case"exception":l=r==="network"?a.L("L{networkFailure}"):(n==null?void 0:n.message)||((s=t==null?void 0:t.parsedJson)==null?void 0:s.message)||a.L("L{parseFailure}");break}a.applyMaskError(`<div class="b-grid-load-failure">
                <div class="b-grid-load-fail">${a.L(i==="read"?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>
                ${t!=null&&t.url?`<div class="b-grid-load-fail">${t.url}</div>`:""}
                <div class="b-grid-load-fail">${a.L("L{serverResponse}")}</div>
                <div class="b-grid-load-fail">${l}</div>
            </div>`)}onStoreDataChange({action:i,changes:e,source:t,removed:r,added:n}){var s;(s=super.onStoreDataChange)==null||s.call(this,...arguments);const a=this,{rowManager:l}=a,{rowCount:o}=l,d=(r==null?void 0:r.length)||0;if(a.refreshSuspended||!l)return;if(i==="filter"&&d&&!(n!=null&&n.length)&&o&&d<o&&r.every(u=>l.getRowById(u.id))){const u=r.map(g=>l.getRowFor(g).index).sort(XS),{length:h}=u;if(h&&u[h-1]===u[0]+h-1){const{animateRemovingRows:g}=a;a.animateRemovingRows=!a.features.cellEdit.isEditing&&a.animateFilterRemovals;const f=a.onStoreRemove({action:i,source:t,records:r});return a.animateRemovingRows=g,f}}if(i==="dataset"&&(l.clearKnownHeights(),t.isTree&&t.isFiltered))return;const c=t.isGrouped&&e&&t.groupers.some(u=>u.rootFieldName in e);a.isPainted&&!c&&a.renderRows(!!(!(i in zF)||a.preserveScrollOnDatasetChange||t.isChained&&t.isFillingFromMaster)),a.toggleEmptyText()}onStoreRecordIdChange(){var i;(i=super.onStoreRecordIdChange)==null||i.call(this,...arguments)}onStoreBeforeRequest(i){!this.isLockedRows&&(!this.store.count||!this.store.lazyLoad||i!=null&&i.isReload)&&this.applyLoadMask()}onStoreAfterRequest(i){this.loadMask&&!i.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:i}){var e,t;const{store:r}=this;return((t=(e=this.features)==null?void 0:e.group)==null?void 0:t.enabled)&&r.isGrouped||r.tree&&!i&&r.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:i,records:e,isCollapse:t,isChild:r,isMove:n,isCollapseAll:s}){var a;if(!this.isPainted||n||s)return;(a=super.onStoreRemove)==null||a.call(this,...arguments);const l=this,{rowManager:o}=l;if(o.invalidateKnownHeight(e),!l.refreshSuspended)if(l.animateRemovingRows&&!t&&!r){const d=e.reduce((c,u)=>{const h=o.getRowById(u.id);return h&&c.push(h),c},[]);if(d.length){const c=d[0];l.isAnimating=!0,V.onTransitionEnd({element:c._elementsArray[0],property:"left",duration:l.transitionDuration+50,thisObj:l,handler:()=>{l.isAnimating=!1,d.forEach(u=>!u.isDestroyed&&u.removeCls("b-removing")),o.refresh(),l.trigger("rowRemove"),l.afterRemove(arguments[0])}}),d.forEach(u=>u.addCls("b-removing"))}}else if(t&&l.animateTreeNodeToggle){const d=e.flatMap(u=>{const h=o.getRowFor(u);return h?h.index:jF}).sort(XS),{length:c}=d;if(c&&d[c-1]===d[0]+c-1)return o.insert(d[0],-d.length)}else if(l.needsFullRefreshOnStoreRemove(...arguments))o.refresh(),l.afterRemove(arguments[0]);else{const{rows:d}=o,c=e.reduce((u,h)=>{const g=o.getRowById(h.id);return g&&(u=Math.min(u,d.indexOf(g))),u},d.length);d[c]?!l.refreshSuspended&&o.renderFromRow(d[c]):o.trigger("changeTotalHeight",{totalHeight:o.totalHeight}),l.trigger("rowRemove",{isCollapse:t}),l.afterRemove(arguments[0])}}onFlatStoreMove({from:i,to:e}){const{rowManager:t,store:r}=this,{topIndex:n,rowCount:s}=t,[a,l]=[i,e].sort((c,u)=>c-u),o=r.indexOf(r.getAt(a,!0)),d=r.indexOf(r.getAt(l,!0));o>=n&&o<n+s?t.renderFromRow(t.rows[o-n]):d>=n&&d<n+s&&t.refresh()}onStoreReplace({records:i,all:e}){const{rowManager:t}=this;if(e)t.clearKnownHeights(),t.refresh();else{const r=i.reduce((n,[,s])=>{const a=this.getRowFor(s);return a&&n.push(a),n},[]);t.invalidateKnownHeight(i),t.renderRows(r)}}relayStoreDataChange(i){var e;if((e=this.ariaElement)==null||e.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...i,store:i.source,source:this})}onStoreRemoveAll(){var i;(i=super.onStoreRemoveAll)==null||i.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:i}){if(this.showDirty&&i.modified.length){const e=[];i.modified.forEach(t=>{const r=this.rowManager.getRowFor(t);r&&e.push(r)}),this.rowManager.renderRows(e)}}onStoreRecordClearChanges({record:i}){const e=this.rowManager.getRowFor(i);e&&this.rowManager.renderRows([e])}internalOnStoreStartApplyChangeset(){this.suspendRefresh(),this.constructor.bindStoreChangeset&&this.captureScrollTargetRow()}internalOnStoreEndApplyChangeset(){this.resumeRefresh(!0),this.constructor.bindStoreChangeset&&this.restoreScrollTargetRow()}captureScrollTargetRow(){const i=this;if(i.preserveScroll){const{firstFullyVisibleRow:e,lastVisibleRow:t}=i.rowManager;if(e){i.lastVisibleRowIds=[e.id];for(let r=e.dataIndex+1;r<=t.dataIndex;r++)i.lastVisibleRowIds.push(i.rowManager.getRow(r).id);i.lastTopRowOffset=i.scrollable.getDeltaTo(e.element,{block:"start",x:!1,constrainToScrollable:!1})}}}restoreScrollTargetRow(){const i=this;let e=!1;if(i.preserveScroll){if(i.lastVisibleRowIds){i.rowManager.refresh(),i.scrollable.scrollHeight>=i.lastOverscrollHeight&&i.scrollable.y===i.lastOverscrollY?i.rowManager.fillBelow(i.scrollable.y):(i.lastOverscrollHeight=null,i.lastOverscrollY=null);const t=i.lastVisibleRowIds.find(r=>i.store.getById(r));if(t!=null&&t!==i.rowManager.firstFullyVisibleRow.id){if(i.preserveScroll.overscroll){const r=i.scrollable.getDeltaTo(i.getRecordCoords(t),{block:"start",x:!1,constrainToScrollable:!1,edgeOffset:i.lastTopRowOffset.yDelta}).yDelta;r>i.scrollable.maxY-i.scrollable.y&&(i.scrollable.scrollHeight+=r,e=!0)}i.scrollRowIntoView(t,{block:"start",edgeOffset:i.lastTopRowOffset.yDelta,x:!1})}}i.lastVisibleRowIds=void 0,i.lastTopRowOffset=void 0,e&&(i.lastOverscrollHeight=i.scrollable.scrollHeight,i.lastOverscrollY=i.scrollable.y)}}get data(){return this._store?this._store.records:this._data}set data(i){this._store?this._store.data=i:this._data=i}populateHeaderMenu({column:i,items:e}){const t=this,{subGrids:r,regions:n}=t,{parent:s}=i;let a=!0;Object.entries(r).forEach(([l,o])=>{if(!o.sealedColumns&&i.draggable&&l!==i.region&&(!s&&r[i.region].columns.count>1||s&&s.children.length>1)){const d=o.element.compareDocumentPosition(r[i.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=t.rtl?!d:d,u=n.length>2?t.L("L{moveColumnTo}",t.optionalL(l)):t.L(c?"L{moveColumnRight}":"L{moveColumnLeft}");e[`${l}Region`]={targetSubGrid:l,text:u,icon:"b-fw-icon b-icon-column-move-"+(c?"right":"left"),separator:a,disabled:!i.allowDrag,onItem:({item:h})=>{const g=t.columns.indexOf(r[h.targetSubGrid].columns.last);i.traverse(f=>f.region=l),t.columns.insert(g+1,i),t.scrollColumnIntoView(i)}},a=!1}})}populateCellMenu({record:i,items:e}){}getColumnDragToolbarItems(i,e){return e}normalizeCellContext(i){const e=this,{columns:t}=e;return i.isLocation?i:i.isModel?new Se({grid:e,id:i.id,columnId:t.visibleColumns[0].id}):new Se(T.assign({grid:e},i))}getCell(i){const{store:e,columns:t}=this,{visibleColumns:r}=this.columns,n=isNaN(i.row)?isNaN(i.rowIndex)?e.indexOf(i.record||i.id):i.rowIndex:i.row,s=isNaN(i.column)?isNaN(i.columnIndex)?r.indexOf(i.column||t.getById(i.columnId)||t.get(i.field)||r[0]):i.columnIndex:i.column;return n>-1&&n<e.count&&s>-1&&s<r.length&&this.normalizeCellContext(i).cell||null}getHeaderElement(i){return i.isModel&&(i=i.id),this.fromCache(`.b-grid-header[data-column-id="${i}"]`)}getFooterElement(i){return i.isModel&&(i=i.id),this.fromCache(`.b-grid-footer[data-column-id="${i}"]`)}getHeaderElementByField(i){const e=this.columns.get(i);return e?this.getHeaderElement(e):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const i=this;return i.isPainted&&!i._headerHeight&&(i._headerHeight=i.headerContainer.offsetHeight),i._headerHeight}get footerHeight(){const i=this;return i.isPainted&&!i._footerHeight&&(i._footerHeight=i.footerContainer.offsetHeight),i._footerHeight}get isTreeGrouped(){var i;return!!((i=this.features.treeGroup)!=null&&i.isGrouped)}getRecordFromElement(i){const e=i.closest(".b-grid-row");return e?this.$store.getById(e.dataset.id):null}getColumnFromElement(i){const e=i.closest(".b-grid-cell, .b-grid-header");if(!e)return null;if(e.matches(".b-grid-header"))return this.columns.getById(e.dataset.columnId);const t=Oe.get(e);return this.columns.getById(t.columnId)}updateAutoHeight(i){T.assertBoolean(i,"autoHeight")}updateColumnLines(i){T.assertBoolean(i,"columnLines"),E.toggleClasses(this.element,"b-no-column-lines",!i)}updateRowLines(i){E.toggleClasses(this.element,"b-no-row-lines",!i)}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const i=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let e=0,{length:t}=i;e<t;e++)i[e].setAttribute("aria-colindex",e+1)}onRowManagerChangeTotalHeight({totalHeight:i,immediate:e}){return this.refreshTotalHeight(i,e)}refreshTotalHeight(i=this.rowManager.totalHeight,e=!1){const t=this;if(t.renderingRows||!t.isVisible)return!1;const r=t.scrollable,n=Math.abs(t.virtualScrollHeight-i),s=t._bodyRectangle.height,a=i-s;if(n){const l=a-t._scrollTop<s*2||t._verticalScrollHeight&&t._verticalScrollHeight-s<t._scrollTop;r.scrollHeight=t.virtualScrollHeight=i,t.isPainted&&(t.scrolling&&!l||n<100)&&!e?t.bufferedFixElementHeights():(t.virtualScrollHeightDirty&&t.virtualScrollHeightDirty(),t.bufferedFixElementHeights.cancel(),t.fixElementHeights())}}fixElementHeights(){const i=this,e=i.virtualScrollHeight,t=`${e}px`;i._verticalScrollHeight=e,i.verticalScroller.style.height=t,i.virtualScrollHeightDirty=!1,i.autoHeight&&(i._height=null,i.bodyContainer.style.height=t,i._bodyHeight=e,i.refreshBodyRectangle()),i.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=L.client(this.bodyContainer)}set scrolling(i){this._scrolling=i}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(i){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...B.asArray(i||[]).map(e=>({element:(typeof e=="string"?this.subGrids[e]:e).scrollable.element}))],direction:"horizontal"})}disableScrollingCloseToEdges(i){this.scrollManager.stopMonitoring([this.scrollable.element,...B.asArray(i||[]).map(e=>(typeof e=="string"?this.subGrids[e]:e).element)])}onRowManagerRequestScrollChange({bottom:i}){this.scrollable.y=i-this.bodyHeight}initScroll(){const i=this,{scrollable:e}=i;i.scrollInitialized||(i.scrollInitialized=!0,e.contentElement=i.contentElement,e.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:i}),i.callEachSubGrid("initScroll"),Y.isMobileSafari&&(e.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:i}){const e=this,{y:t}=i;t!==e._scrollTop&&(e._scrollTop=t,e.scrolling||(e.scrolling=!0,e.eachSubGrid(r=>r.suspendResizeMonitor=!0)),e.rowManager.updateRenderedRows(t),e.afterScroll({scrollTop:t}),e.trigger("scroll",{scrollTop:t}))}onGridVerticalScrollEnd(i){this.scrolling=!1,this.eachSubGrid(e=>e.suspendResizeMonitor=!1),this.trigger("verticalScrollEnd",i)}async scrollRowIntoView(i,e=BF){var t;const r=this,n=e.block||"nearest",{rowManager:s}=r,a=r.store.getById(i);if(a){r.isLockedRows&&r.syncSplits(u=>u.scrollRowIntoView(...arguments));let l;if(r.store.indexOf(a)===-1)return KS;r.rowManager.topRow||await r.await("renderRows");let o=r.scrollable,d=r.getRecordCoords(a);const c=L.from(o.element);if(d.virtual){const u=d.block,h=n!=="nearest"?e:{block:u};if(l=o.scrollIntoView(d,{block:"center"}),s.scrollTargetRecordId=a,s.updateRenderedRows(o.y,!0),d=r.getRecordCoords(a),s.lastScrollTop=o.y,d.virtual)return KS;e.animate?(o.suspendEvents(),n==="end"||n==="nearest"&&u==="end"?o.y-=c.bottom-d.bottom:(n==="start"||n==="nearest"&&u==="start")&&(o.y+=d.y-c.y),s.updateRenderedRows(o.y,!1,!0),u==="end"?o.y-=s.appendRowBuffer*s.rowHeight-1:o.y+=s.prependRowBuffer*s.rowHeight-1,o.resumeEvents(),await o.scrollIntoView(r.getRecordCoords(a),Object.assign({},e,h))):(e.recursive||await l,await((t=r.scrollRowIntoView)==null?void 0:t.call(r,a,Object.assign({recursive:!0},e,h))))}else{let{column:u}=e;if(u){if(u.isModel||(u=r.columns.getById(u)||r.columns.get(u)),u){o=r.getSubGridFromColumn(u).scrollable;const h=L.from(s.getRowFor(a).getCell(u.id));d.x=h.x,d.width=h.width}}else e=T.assign({},e,{x:!1});await o.scrollIntoView(d,e)}}}scrollColumnIntoView(i,e){i=i instanceof He?i:this.columns.get(i)||this.columns.getById(i)||this.columns.getAt(i);const t=this.getSubGridFromColumn(i);return t.columns.visibleColumns.length>1?t.scrollColumnIntoView(i,e):Promise.resolve()}scrollCellIntoView(i,e){const t=this.normalizeCellContext(i);return this.scrollRowIntoView(t.id,{column:t.columnId,...typeof e=="boolean"?{animate:e}:e})}scrollToBottom(i){return this.scrollRowIntoView(this.isLockedRows?this.originalStore.last:this.store.last,i)}scrollToTop(i){return this.scrollable.scrollBy(0,-this.scrollable.y,i)}storeScroll(){const i=this.storedScrollState={scrollTop:this.scrollable.y,scrollLeft:{}};return this.eachSubGrid(e=>{i.scrollLeft[e.region]=e.scrollable.x}),i}restoreScroll(i=this.storedScrollState){const e=this;e.eachSubGrid(t=>{var r;const n=i.scrollLeft[t.region];n!=null&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),(r=t.fakeScroller)==null||r.updateX(n))}),e.restoreVerticalScroll(i)}restoreVerticalScroll(i=this.storedScrollState){const{rowManager:e}=this;e.rowCount?this.scrollable.updateY(i.scrollTop):e.ion({changeTotalHeight:()=>this.restoreVerticalScroll(i),once:!0})}beginGridMeasuring(){const i=this;if(i.element.classList.add("b-grid-measuring"),i.$measureCellElements||(i.$measureCellElements=E.createElement({className:"b-grid-subgrid "+(!i._isRowMeasured&&i.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:Y.isFirefox?"layout paint":"layout style paint"}}]}]})),i.getConfig("element"),i.verticalScroller.appendChild(i.$measureCellElements.subGridElement),!i.rendered){const e=i.appendTo||i.insertBefore||document.body,t=E.getRootElement(typeof e=="string"?document.getElementById(e):e)||document.body;(!i.adopt||!t.contains(i.element))&&(t.appendChild(i.element),i.$removeAfterMeasuring=!0)}return i.$measureCellElements}endGridMeasuring(){const i=this;i.element.classList.remove("b-grid-measuring"),i.$removeAfterMeasuring&&(i.element.remove(),i.$removeAfterMeasuring=!1),i.$measureCellElements.subGridElement.remove()}measureRowHeight(){const i=this,{rowElement:e}=i.beginGridMeasuring(),t=parseFloat(E.getStyleValue(document.body,"zoom"))||1,r=E.getStyleValue(e,["height","border-top-width","border-bottom-width"]),n=parseInt(r.height),{devicePixelRatio:s}=E,a=t*(Y.isFirefox?s/Math.max(Math.trunc(s),1):1),l=r["border-top-width"]?Math.round(a*parseFloat(r["border-top-width"])):0,o=r["border-bottom-width"]?Math.round(a*parseFloat(r["border-bottom-width"])):0;(i.rowHeight==null||i.rowHeight===i._rowHeightFromStyle)&&(i.rowHeight=!isNaN(n)&&n?n:i.defaultRowHeight,i._rowHeightFromStyle=i.rowHeight),i._rowBorderHeight=l+o,i._isRowMeasured=!0,i.endGridMeasuring()}onThemeChange({theme:i}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:i})}refreshRow(i){this.refreshRows([i])}refreshRows(i=null,e=!1){if(this.refreshSuspended)return;const{element:t,rowManager:r}=this;if(!i)t.classList.add("b-notransition"),e?r.returnToTop():r.refresh(!0),t.classList.remove("b-notransition");else{const n=i.flatMap(s=>{var a;return(a=r.getRowById(s))!=null?a:[]});r.renderRows(n)}}refreshColumn(i,e=!0){i.isVisible&&this.runWithTransition(()=>{i.isLeaf?this.rowManager.forEach(t=>t.renderCell(t.getCell(i.id))):i.children.forEach(t=>this.refreshColumn(t))},e)}refreshVirtualScrollbars(){const i=this,{headerContainer:e,footerContainer:t,virtualScrollers:r,scrollable:n,hasVerticalOverflow:s}=i,{classList:a}=r,l=!a.contains("b-hide-display"),o=Object.values(i.subGrids).some(c=>c.overflowingHorizontally),d=o!==l;if(d&&r.classList.toggle("b-hide-display",!o),E.scrollBarWidth){const c=s||n.overflowY==="scroll";e.classList.toggle("b-show-yscroll-padding",c),t.classList.toggle("b-show-yscroll-padding",c),r.classList.toggle("b-show-yscroll-padding",c),(d||!i.$virtualScrollbarsRefreshed)&&(i.callEachSubGrid("refreshFakeScroll"),i.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const i=this.rowManager;return Math.max(i.totalHeight,i.bottomRow?i.bottomRow.bottom:0)}onContentChange(){const i=this,e=i.rowManager;i.isVisible?(e.estimateTotalHeight(i.autoHeight),i.paintListener=null,i.refreshTotalHeight(i.contentHeight),i.callEachSubGrid("refreshFakeScroll"),i.onHeightChange()):i.paintListener||(i.paintListener=i.ion({paint:"onContentChange",once:!0,thisObj:i}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const i=this;i.refreshBodyRectangle(),i._bodyHeight=i.autoHeight?i.contentHeight:i.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(i=!0){this.refreshSuspended&&!--this.refreshSuspended&&(i&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:i}))}renderRows(i=!0){const e=this,t=i&&e.storeScroll();e.refreshSuspended||(e.trigger("beforeRenderRows"),e.renderingRows=!0,e.element.classList.add("b-grid-refreshing"),i||(e.scrollable.y=e._scrollTop=0),e.rowManager.reinitialize(!i),e.trigger("renderRows"),e.renderingRows=!1,e.onContentChange(),i&&e.restoreScroll(t),e.autoHeight&&e.store.count>200&&!e.autoHeightWarning&&!e.disableAutoHeightWarning&&(console.warn("Warning: 'autoHeight' is enabled for a large number of rows (200+). While 'autoHeight' provides flexibility, it should be used cautiously as it disables virtualization, leading to significant performance degradation with large datasets. Consider alternatives to maintain optimal performance."),e.autoHeightWarning=!0),e.element.classList.remove("b-grid-refreshing"))}renderContents(){const i=this,{element:e,headerContainer:t,footerContainer:r,rowManager:n}=i;if(i.emptyCache(),i.isPainted){i._headerHeight=null,i.callEachSubGrid("refreshHeader"),i.callEachSubGrid("refreshFooter"),i.renderHeader(t,e),i.renderFooter(r,e),i.fixSizes();const s=n.removeAllRows();n.calculateRowCount(!1,!0,!0),n.setPosition(s),i.renderRows()}}refreshHeaders(){this.callEachSubGrid("refreshHeader")}refreshHeader(i){i.subGrid.refreshHeader()}onPaintOverride(){}onStoreLoadOverride(){}onInternalPaint({firstPaint:i}){var e;const t=this;if(t.ariaElement.setAttribute("aria-rowcount",t.store.count+1),(e=super.onInternalPaint)==null||e.call(this,...arguments),t.onPaintOverride()||!i)return;const{rowManager:r,store:n,element:s,headerContainer:a,bodyContainer:l,footerContainer:o}=t,d=E.scrollBarPadElement;let c,u=0;t.role=n!=null&&n.isTree?"treegrid":"grid",t.columns.ion({change:()=>c=!0,once:!0}),t.updateResponsive(t.width,0),c&&(t.callEachSubGrid("refreshHeader",a),t.callEachSubGrid("refreshFooter",o)),t.renderHeader(a,s),t.renderFooter(o,s),E.append(a,d),E.append(o,d),E.append(t.virtualScrollers,d),t.refreshBodyRectangle();const h=t.bodyContainer.offsetHeight;if(t.autoHeight?(t._bodyHeight=r.initWithHeight(s.offsetHeight-a.offsetHeight-o.offsetHeight,!0),l.style.height=t.bodyHeight+"px"):(t._bodyHeight=h,r.initWithHeight(t._bodyHeight,!0)),t.eachSubGrid(g=>{g.header.maxDepth>u&&(u=g.header.maxDepth)}),a.dataset.maxDepth=u,t.fixSizes(),(n.count||!n.isLoading)&&t.renderRows(),t.columns.usesAutoHeight){const{fonts:g}=document;(g==null?void 0:g.status)!=="loaded"&&g.ready.then(()=>!t.isDestroyed&&t.refreshRows())}t.initScroll(),t.initInternalEvents()}render(){var i;const e=this;e.requireSize=!!e.owner,super.render(...arguments),e.setupFocusListeners(),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),!e.splitFrom&&!((i=e.features.split)!=null&&i.owner)&&!("minHeight"in e.initialConfig)&&!("height"in e.initialConfig)&&parseInt(globalThis.getComputedStyle(e.element).minHeight)===e.height&&console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(i,e){}renderFooter(i,e){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(i){}afterColumnsChange(){super.afterColumnsChange(...arguments)}afterRemove(i){}afterToggleGroup(){}afterToggleSubGrid(){}onConfigChange(i){super.onConfigChange(i),this.isConfiguring||this.afterConfigChange(i)}afterPluginConfigChange(){}afterConfigChange(i){}afterAddListener(i,e){}afterRemoveListener(i,e){}syncMaskCover(i=this.masked){if(i){const e=i.cover==="body"&&this.rectangleOf("bodyContainer"),t=e&&E.scrollBarWidth&&this.rectangleOf("virtualScrollers"),{style:r}=i.element;r.marginTop=e?`${e.y}px`:"",r.height=e?`${e.height+((t==null?void 0:t.height)||0)}px`:""}}changeMasked(i,e){if(i){const t=this;typeof i=="string"&&(i={text:i}),t.isLockedRows||t.splitFrom?(i.cover=null,i.target=t.element.parentElement):(i.cover="body",i.target=t.element)}return super.changeMasked(i,e)}maskBody(i){let e;return this.bodyContainer&&(this.masked=Mn.mergeConfigs(this.loadMaskDefaults,i),e=this.masked),e}unmaskBody(){this.masked=null}updateEmptyText(i){var e,t;(e=this.emptyTextEl)==null||e.remove();const r=typeof i=="object";r&&(i=B.asArray(i)),this.emptyTextEl=E.createElement({parent:(t=this.firstItem)==null?void 0:t.element,className:"b-empty-text",[r?"children":i!=null&&i.includes("<")?"html":"text"]:i})}toggleEmptyText(){const i=this,e=i.isLockedRowsView?i.store.$master:i.store,t=!(e.count>0||e.isLoading||e.isCommitting);i.element.classList.toggle("b-grid-empty",t),i.announceAriaLive(t?i.emptyText:"")}updateReadOnly(i,e){var t;if(super.updateReadOnly(i,e),!this.isConfiguring)for(const r of this.columns.bottomColumns)(t=r.updateReadOnly)==null||t.call(r,i)}getCurrentConfig(i){const e=super.getCurrentConfig(i),{store:t}=this,r=t.getInlineData(i),n=t.getCurrentConfig(i)||e.store;return r.length&&(e.data=r),n&&t.originalModelClass===Kn&&delete n.modelClass,T.isEmpty(n)||(e.store=n),e.store&&delete e.store.data,e}suspendAnimations(){this._animationSuspendedCounter++}resumeAnimations(){this._animationSuspendedCounter--}async runWithTransition(i,e){const t=this;if(!e||!t.isVisible||t._animationSuspendedCounter!==0||t.enableEventAnimations===!1)return i();t.isAnimating=!0,await t.executeAndAwaitAnimations(t.element,i),t.isAnimating=!1,!t.isDestroyed&&!t.isAnimating&&t.trigger("transitionEnd")}async waitForReadiness(){var i,e;await((e=(i=this.features.treeGroup)==null?void 0:i.waitForReadiness)==null?void 0:e.call(i))}};y(Xr,"$name","GridBase"),y(Xr,"type","gridbase"),y(Xr,"bindStoreChangeset",!0),Xr.initClass(),re.setVersion("grid","6.2.2"),Xr._$name="GridBase";var as=class extends Xr{};y(as,"$name","Grid"),y(as,"type","grid"),as.initClass(),as._$name="Grid";var Ud=class extends as{static get configurable(){return{store:{tree:!0}}}updateStore(i,e){if(i&&!(i.tree||i.isTree))throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(i,e)}};y(Ud,"$name","TreeGrid"),y(Ud,"type","treegrid"),Ud.initClass(),Ud._$name="TreeGrid";var sl=class extends Zi{construct(){super.construct(...arguments);const i=this.grid=this.up("gridbase",!0);if(!i)throw new Error("GroupBar must be used inside a Grid component");i.ion({paint:this.onGridPaint,once:!0,thisObj:this})}onGridPaint(){const i=this,{grid:e}=i,{treeGroup:t,group:r,columnReorder:n,tree:s}=e.features;if(!t&&!r)throw new Error("GroupBar widget requires the TreeGroup or Group feature to be present");n.usingGroupBarWidget=!0,i.store=new pe({fields:["cls","ascending"],internalListeners:{add:i.onStoreChanged,remove:i.onStoreChanged,thisObj:i}}),e.ion({[s?"treeGroupChange":void 0]:i.onTreeGroupChanged,beforeColumnDropFinalize:i.onBeforeColumnDropFinalize,columnDrag:i.onColumnDrag,columnDragStart:i.onColumnDragStart,columnDrop:i.onColumnDrop,thisObj:i}),s?i.onTreeGroupChanged({levels:t.levels}):(e.store.ion({group:i.onGroupChanged,thisObj:i}),i.onGroupChanged())}onStoreChanged({records:i}){var e;const t=this,{grid:r}=t;!r.isConstructing&&((e=i==null?void 0:i[0])==null?void 0:e.cls)!=="b-drop-target"&&(t.ignoreGroupChange=!0,r.features.treeGroup?r.features.treeGroup.levels=t.store.map(({field:n})=>n):t.store.count>0?r.store.group(t.store.records[0].field):r.store.clearGroupers(),t.ignoreGroupChange=!1)}onGroupChanged(){const{groupers:i}=this.grid.store;this.store.data=i?i.map(e=>this.grid.columns.get(e.field)):[]}onTreeGroupChanged({levels:i}){if(!this.ignoreGroupChange){if(i.some(e=>e instanceof Function&&!e.fieldName))throw new Error("GroupBar only supports column grouping");this.store.data=(i||[]).map(e=>(e=e.fieldName||e,this.grid.columns.get(e)))}}onColumnDragStart({column:i}){this.store.add({id:"placeholder",cls:"b-drop-target",text:this.grid.features.treeGroup?void 0:i.text})}onColumnDrag({context:i,column:e,event:t}){t.target.closest(".b-groupbar")&&(i.valid=e.groupable)}onBeforeColumnDropFinalize({column:i,event:e}){const t=this.grid.features.tree;e.target.closest(".b-groupbar")&&i.groupable&&(!t||!i.isTreeColumn)&&(this.store.getById("placeholder").remove(),t||this.store.removeAll(!0),this.store.add(i))}onColumnDrop(){var i;(i=this.store.getById("placeholder"))==null||i.remove()}};y(sl,"type","groupbar"),y(sl,"$name","GroupBar"),y(sl,"configurable",{selectedCls:"not-used",ariaLabel:"L{TreeGroup.group}",itemTpl(i){return O.encodeHtml(O.capitalize(i.getValue(this.displayField)))}}),sl.initClass(),sl._$name="GroupBar";var al=class extends Ze{changePicker(i,e){return!this.isDestroying&&!i.columns&&(console.warn("No `columns` provided for the TreeCombo `picker` config"),i.columns=[{type:"tree"}]),super.changePicker(i&&{...i,selectedRecordCollection:this.valueCollection},e)}updateMultiSelect(i){super.updateMultiSelect(...arguments),this.picker.selectionMode.multiSelect=i}updateReadOnly(i){super.updateReadOnly(...arguments),this._picker&&(this.picker.readOnly=i)}};y(al,"$name","TreeCombo"),y(al,"type","treecombo"),y(al,"configurable",{multiSelect:!0,picker:{type:"treegrid",minWidth:"35em",disableGridRowModelWarning:!0,selectionMode:{row:!0,checkbox:!0}},chipView:{itemTpl(i){return O.xss`${i.name}`},scrollable:{overflowX:"hidden-scroll"}}}),al.initClass(),al._$name="TreeCombo";var Zr=class extends Yt{constructor(){super(...arguments),y(this,"compositeField",!0)}construct(){super.construct(...arguments);const i=this.sortable;this.sortable=(...e)=>i.call(this,...e)}get defaultEditor(){const{max:i,min:e,step:t,largeStep:r,decimalPrecision:n=this.grid.durationDisplayPrecision}=this;return T.cleanupProperties({type:"duration",name:this.field,max:i,min:e,step:t,decimalPrecision:n,largeStep:r})}get durationUnitField(){return`${this.field}Unit`}get formatter(){const i=this,{format:e,_formatter:t,decimalPrecision:r}=i;return(!t||i._lastFormat!==e)&&(i._formatter=Ca.getLocalizedFormatter(r?{maximumFractionDigits:r}:i._lastFormat=e)),i._formatter}roundValue(i){var e,t;const r=Math.pow(10,(t=(e=this.decimalPrecision)!=null?e:this.grid.durationDisplayPrecision)!=null?t:1);return Math.round(i*r)/r}formatValue(i,e){i instanceof we&&(e=i.unit,i=i.magnitude),i=this.roundValue(i);const t=this.abbreviatedUnit?"getShortNameOfUnit":"getLocalizedNameOfUnit";return super.formatValue(i)+(this.abbreviatedUnit?"":" ")+C[t](e,i!==1)}defaultRenderer({value:i,record:e,isExport:t,dataField:r}){const n=typeof i,s=n==="number"?i:i==null?void 0:i.magnitude,a=n==="number"?e.getValue(this.durationUnitField):i==null?void 0:i.unit;return typeof s!="number"?t?"":null:(!this.fieldWarningShown&&r instanceof Rr&&this.type!=="totalslack"&&(console.warn(`Warning: Setting 'duration' as the 'field' value for the '${this.type}' column is not allowed since the field needs both a duration magnitude and unit, as supplied by for example the 'fullDuration' field. Additionally, a custom implemented field for the duration column should return a duration object to work correctly.`),this.fieldWarningShown=!0),this.formatValue(s,a))}toClipboardString({record:i}){var e;return(e=i.getValue(this.field))==null?void 0:e.toString()}fromClipboardString({string:i,record:e}){const t=C.parseDuration(i,!0,this.durationUnit);return t&&"magnitude"in t?t:e.fullDuration}calculateFillValue({value:i,record:e}){return this.fromClipboardString({string:i,record:e})}};y(Zr,"$name","DurationColumn"),y(Zr,"type","duration"),y(Zr,"isGanttColumn",!0),y(Zr,"fields",[{name:"decimalPrecision"},"abbreviatedUnit"]),y(Zr,"defaults",{abbreviatedUnit:null,min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(i,e){const t=i.getValue(this.field),r=e.getValue(this.field);return t-r}}),Ve.registerColumnType(Zr),Zr._$name="DurationColumn";var ep={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},ZS=i=>{var e;return e=class extends i{get timeZone(){return this.getData("timeZone")}set timeZone(t){this.setData("timeZone",t)}setLocalDate(t,r){const n=this;n.timeZone!=null&&(r=$e.toTimeZone(r,n.timeZone)),n.set(t,r,!0),n["_"+t]=r}getLocalDate(t){return this.timeZone!=null&&this[t]&&!isNaN(this[t])?$e.fromTimeZone(this[t],this.timeZone):this[t]}applyChangeset(t){if(this.timeZone!=null){delete t.timeZone;for(const r in ep)t[r]&&(this.setLocalDate(r,new Date(t[r])),t[r]=this["_"+r])}return super.applyChangeset(...arguments)}getFieldPersistentValue(t){var r,n;if(this.timeZone!=null){const s=(n=(r=t==null?void 0:t.field)!=null?r:t==null?void 0:t.name)!=null?n:t;if(ep[s]){const a=this.getLocalDate(s);return t.serialize?t.serialize(a):a}}return super.getFieldPersistentValue(t)}convertToTimeZone(t,r){var n;const s=this,a={...s.meta.modified},l={...ep},o=s.timeZone,{isProEventModel:d}=s.constructor;s.isTask&&!s.manuallyScheduled&&(delete l.startDate,delete l.endDate),r==null||r.forEach(c=>{delete l[c]});for(const c in l)s[c]!=null?(d&&(s["_"+c]=null),l[c]=s[c],o!=null&&(l[c]=s.getLocalDate(c),a[c]&&(a[c]=$e.fromTimeZone(a[c],o)))):delete l[c];s.timeZone=t;for(const c in l)s.setLocalDate(c,l[c]),l[c]=1,t!=null&&a[c]&&(a[c]=$e.toTimeZone(a[c],t));s.internalClearChanges(!0,!0,l),T.isEmpty(a)||(s.meta.modified=a,(n=s.stores)==null||n.forEach(c=>c.modified.add(s)))}},y(e,"$name","TimeZonedDatesMixin"),y(e,"fields",[{name:"timeZone",persist:!1}]),e},xt=class extends me.mixin(ZS){construct(i,...e){const t=this;if(i!=null&&i.fullDuration){const{magnitude:r,unit:n}=i.fullDuration;i.duration=r,i.unit=n,delete i.fullDuration}super.construct(i,...e),t.normalize(),t.startDateMS&&t.endDateMS&&t.startDateMS>t.endDateMS&&console.error(`startDate > endDate for ${t.constructor.$name} record with id: ${t.id}`)}internalCalculateStartDate(i,e,t){return C.add(i,-e,t)}internalCalculateEndDate(i,e,t){return C.add(i,e,t)}internalCalculateDuration(i,e,t){return C.as(t,C.diff(i,e,"h"),"h")}internalNormalize(i,e,t,r){const n=this,s=t!=null;i&&e&&!s?n.setData("duration",n.internalCalculateDuration(i,e,r)):i&&!e&&s?n.setData("endDate",n.internalCalculateEndDate(i,t,r)):!i&&e&&s&&n.setData("startDate",n.internalCalculateStartDate(e,t,r))}normalize(){this.internalNormalize(this.startDate,this.endDate,this.duration,this.durationUnit||this.constructor.defaultValues.durationUnit)}get eventStore(){var i;const e=this;return e.isOccurrence?e.recurringTimeSpan.eventStore:(e._eventStore||(e._eventStore=(i=e.stores)==null?void 0:i.find(t=>t.isEventStore)),e._eventStore)}updateInternalCls(i){this._cls?this._cls.value=i:this._cls=new te(i)}set internalCls(i){this.updateInternalCls(i),this.set("cls",this._cls.value)}get internalCls(){const{cls:i}=this;return i!=null&&i.isDomClassList?i:(this.updateInternalCls(i),this.setData("cls",this._cls.value),this._cls)}get cls(){return this._cls||(this._cls=new te(super.get("cls"))),this._cls}set cls(i){this.internalCls=i}get startDate(){return this.get("startDate")}set startDate(i){this.setStartDate(i)}get endDate(){return this.get("endDate")}set endDate(i){this.setEndDate(i)}get endingDate(){const i=this,{endDate:e,startDate:t}=i;return e||C.add(t,i.duration,i.durationUnit)}get duration(){return this.get("duration")}set duration(i){this.setDuration(i,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(i,e=this.durationUnit){i=parseFloat(i),this.set({duration:i,durationUnit:e,...this.updateDatesFromDuration(i,e)})}updateDatesFromDuration(i,e,t=this.startDate,r=this.endDate){const n={};return t?n.endDate=this.internalCalculateEndDate(t,i,e):r&&(n.startDate=this.internalCalculateStartDate(r,i,e)),n}getDurationInUnit(i,e){const t=this;return t.startDate&&t.endDate?C.getDurationInUnit(t.startDate,t.endDate,i,e):C.as(i,t.duration,t.durationUnit)}get fullDuration(){return new we({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(i){if(i==null){this.set({duration:i});return}typeof i=="string"&&(i=C.parseDuration(i,!0,this.durationUnit)),this.setDuration(i.magnitude,i.unit)}setStartDate(i,e=!0){const t=this,r={startDate:i};if(i){let n;if(e)n=t.duration!=null;else if(t.endDate){if(r.duration=t.internalCalculateDuration(i,t.endDate,t.durationUnit),r.duration<0)throw new Error("Negative duration")}else n=t.duration!=null;n&&(r.endDate=t.internalCalculateEndDate(i,t.duration,t.durationUnit))}else r.duration=null;t.set(r)}setEndDate(i,e=!1){const t=this,r={endDate:i};if(i){let n;if(e===!0)n=t.duration!=null;else if(t.startDate){if(r.duration=t.internalCalculateDuration(t.startDate,i,t.durationUnit),r.duration<0)throw new Error("Negative duration")}else n=this.duration!=null;n&&(r.startDate=t.internalCalculateStartDate(i,t.duration,t.durationUnit))}t.set(r)}setStartEndDate(i,e,t){if(i>e)throw new Error("Start date must be less or equal to end date");this.set({startDate:i,endDate:e},null,t)}get dates(){const i=[],e=C.startOf(this.startDate,"day"),t=this.endDate;for(let r=e;r<t;r=C.add(r,1,"day"))i.push(r);return i}get startDateMS(){var i;return(i=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)==null?void 0:i.getTime()}get endDateMS(){var i;return(i=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)==null?void 0:i.getTime()}get durationMS(){return this.rawDurationMS}get rawDurationMS(){const{endDateMS:i,startDateMS:e}=this;return i&&e?i-e:C.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(i){if(typeof i!="string"){let{startDate:e,endDate:t,duration:r,durationUnit:n=this.durationUnit}=i;typeof e=="string"&&(e=this.getFieldDefinition("startDate").convert(e)),typeof t=="string"&&(t=this.getFieldDefinition("endDate").convert(t)),"duration"in i?(e&&!t&&(t=this.internalCalculateEndDate(e,r,n)),!e&&t&&(e=this.internalCalculateStartDate(t,r,n))):e&&t&&(r=this.internalCalculateDuration(e,t,n));const s=Object.isFrozen(i)?T.clone(i):i;return e&&(s.startDate=e),t&&(s.endDate=t),r!=null&&(s.duration=r),s}}fieldToKeys(i,e){var t,r;const n=this,s=super.fieldToKeys(i,e);if(s.fullDuration){const{magnitude:a,unit:l}=s.fullDuration;s.duration=a,s.durationUnit=l}return!n.isEventModel&&!n.isTaskModel&&("duration"in s||s.durationUnit)&&!(s.startDate&&s.endDate)&&Object.assign(s,n.updateDatesFromDuration((t=s.duration)!=null?t:n.duration,(r=s.durationUnit)!=null?r:n.durationUnit,s.startDate,s.endDate)),s}inSet(i,e,t,r,n,s,a){var l;const o=this;n||(i=o.inSetNormalize(i)||i);const d=super.inSet(i,e,t,r,n,s,a);if(!((l=o.project)!=null&&l.isWritingData)&&i.startDate&&i.endDate){let c;i.startDate instanceof Date&&i.endDate instanceof Date?c=i.startDate>i.endDate:o.fieldMap.startDate.convert(i.startDate)>o.fieldMap.endDate.convert(i.endDate)&&(c=!0),c&&console.error(`startDate > endDate for ${o.constructor.$name} record with id: ${o.id}`)}return d}applyValue(i,e,t,r,n){e==="cls"&&this.updateInternalCls(t),super.applyValue(i,e,t,r,n)}forEachDate(i,e){return this.dates.forEach(i.bind(e))}get isScheduled(){const{startDateMS:i,endDateMS:e}=this;return e-i>=0}get isValid(){const{startDate:i,endDate:e}=this;return!i||!e||e-i>=0}shift(i,e=this.durationUnit){return this.setStartDate(C.add(this.startDate,i,e,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(i){this._wbsCode=i}fullCopy(){return this.copy.apply(this,arguments)}intersects(i){return this.intersectsRange(i.startDate,i.endDate)}intersectsRange(i,e){const t=this.startDate,r=this.endDate;return t&&r&&C.intersectSpans(t,r,i,e)}split(i=.5){const e=this,t=e.copy(),{fullDuration:r,eventStore:n,assignmentStore:s}=e,a=new we(r),l=new we(r);let o,d;return typeof i=="string"?(o=new we(i),o.unit===a.unit?l.magnitude-=o.magnitude:(l.magnitude=C.as(o.unit,a)-o.magnitude,l.unit=o.unit,d=!0)):(o=new we(i>1?i:e.duration*i,e.durationUnit),l.magnitude-=o.magnitude),t.startDate=C.add(e.startDate,o.magnitude,o.unit),d?(t.fullDuration=l,e.fullDuration=o):(t.duration=l.magnitude,e.duration=o.magnitude),n&&(n.add(t),s&&!n.usesSingleAssignment&&s.add(e.assignments.map(c=>{const u=Object.assign({},c.data,{eventId:t.id,event:null,resource:null});return delete u.id,u}))),t}toICSString(i={}){if(!this.isScheduled)return"";const{startDate:e,endDate:t}=this,r=i.DTSTAMP||C.format(new Date,"uu");delete i.DTSTAMP;let n={};this.allDay?n={"DTSTART;VALUE=DATE":C.format(e,"u"),"DTEND;VALUE=DATE":C.format(t,"u")}:n={DTSTART:C.format(e,"uu"),DTEND:C.format(t,"uu")};const s=re.scheduler&&re.getVersion("scheduler")||re.calendar&&re.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${s} //EN`,END:"VCALENDAR"},l={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:r,...n,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...i,END:"VEVENT"},o=Object.keys(a).map(c=>`${c}:${a[c]}`),d=Object.keys(l).map(c=>`${c}:${l[c]}`);return o.splice(o.length-1,0,...d),o.join(`
`)}exportToICS(i){if(this.isScheduled){const e=new Blob([this.toICSString(i)],{type:"text/calendar"});Y.downloadBlob(e,(this.name||"Event")+".ics")}}isFieldModified(i){return i==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(i)}};y(xt,"$name","TimeSpan"),y(xt,"fields",[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]),xt._$name="TimeSpan";var ls=class extends me{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight"},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(i){const e=this,{headers:t}=e,r=[];let n=Object.getPrototypeOf(e.data).id;if(!n){for(let{length:s}=t,a=s-1;a>=0;a--){const{unit:l,increment:o}=t[a],d=o>1;r.push(`${d?o:""}${a?l:O.capitalize(l)}${d?"s":""}`)}n=r.join("And")}return i.count&&i.includes(n)&&(n+=`-${e.tickWidth}by${e.tickHeight||e.tickWidth}`,i.includes(n)&&(n+=`-${e.bottomHeader.increment}`,i.includes(n)&&(n=Si.generateId(`${n}-`)))),n}normalizeUnits(){const i=this,{timeResolution:e,headers:t,shiftUnit:r}=i;if(t)for(let n=0,{length:s}=t;n<s;n++){const a=t[n];a.unit=C.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=C.normalizeUnit(a.splitUnit)),"increment"in a||(t[n]=Object.assign({increment:1},a))}e&&(e.unit=C.normalizeUnit(e.unit)),r&&(i.shiftUnit=C.normalizeUnit(r))}static normalizeHeaderConfig(i){const{headerConfig:e,columnLinesFor:t,mainHeaderLevel:r}=i,n=i.headers=[];if(e.top&&(t==="top"&&(i.columnLinesFor=0),r==="top"&&(i.mainHeaderLevel=0),n[0]=e.top),e.middle)t==="middle"&&(i.columnLinesFor=n.length),r==="middle"&&(i.mainHeaderLevel=n.length),n.push(e.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");e.bottom&&(i.mainHeaderLevel=n.length-1,t==null?i.columnLinesFor=n.length-1:t==="bottom"&&(i.columnLinesFor=n.length),r==null&&(i.mainHeaderLevel=n.length-1),r==="bottom"&&(i.mainHeaderLevel=n.length),n.push(e.bottom))}set(){}inSet(){}set options(i){this.data.options=i}get options(){return this.data.options}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const i={},{headers:e}=this,{length:t}=e;switch(t){case 1:i.middle=e[0];break;case 2:this.mainHeaderLevel===0?(i.middle=e[0],i.bottom=e[1]):(i.top=e[0],i.middle=e[1]);break;case 3:i.top=e[0],i.middle=e[1],i.bottom=e[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return i}set mainHeaderLevel(i){this.data.mainHeaderLevel=i}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:i}=this;return Math.round(C.asMilliseconds(i.increment||1,i.unit)/this.tickWidth)}get isValid(){const i=this;let e=!0;for(const t of i.headers)e=e&&!!C.normalizeUnit(t.unit);return i.timeResolution&&(e=e&&C.normalizeUnit(i.timeResolution.unit)),i.shiftUnit&&(e=e&&C.normalizeUnit(i.shiftUnit)),e}};y(ls,"$name","ViewPreset"),ls._$name="ViewPreset";var UF={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,Object:{newEvent:"New event",information:"Information",showDetails:"Show details"},ResourceInfoColumn:{eventCountText:i=>i+" event"+(i!==1?"s":"")},ResourceCollapseColumn:{toggleResourceLayout:"Toggle resource layout column. SPACE for context menu."},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",startTime:"Start time",End:"End",endTime:"End time",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete","Unassign event":"Unassign",color:"Color",eventAriaLabel:(i,e)=>`${i.name}, starts at ${e} ${i.duration>0?`for ${i.fullDuration.toString(!1)}`:""}`},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},TimeAxisColumn:{ariaLabel:(i,e)=>`Time axis showing ${i} to ${e}`},EventCopyPaste:{copyEvent:"Copy",cutEvent:"Cut",pasteEvent:"Paste"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-only-this-message":"Do you want to delete this occurrence of this event?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-only-this-message":"Do you want to change this occurrence of this event?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:i})=>`Weekly on ${i}`,"Monthly on {1}":({days:i})=>`Monthly on ${i}`,"Yearly on {1} of {2}":({days:i,months:e})=>`Yearly on ${i} of ${e}`,"Every {0} days":({interval:i})=>`Every ${i} days`,"Every {0} weeks on {1}":({interval:i,days:e})=>`Every ${i} weeks on ${e}`,"Every {0} months on {1}":({interval:i,days:e})=>`Every ${i} months on ${e}`,"Every {0} years on {1} of {2}":({interval:i,days:e,months:t})=>`Every ${i} years on ${e} of ${t}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:i,days:e})=>`${i} ${e}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each",on:"On",the:"The","On the":"On the","End repeat":"End repeat","time(s)":"time(s)",Days:"Days",Months:"Months"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":i=>`Summary for ${i}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}},NP=lt.publishLocale(UF),Gd=class extends Nt(pe){static get defaultConfig(){return{useRawData:!0,modelClass:ls,zoomOrder:1}}set storage(i){super.storage=i,this.storage.addSorter((e,t)=>{const r=e.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||C.compareUnits(r.unit,n.unit)||r.increment-n.increment)*this.zoomOrder})}get storage(){return super.storage}changeModelClass(i){return i}getById(i){return super.getById(i)||!this.isPresetManager&&globalThis.bryntum.PresetManager.getById(i)}createRecord(i,...e){let t;if(i.isViewPreset)return i;if(typeof i=="string")t=this.getById(i);else if(typeof i=="number")t=this.getAt(i);else return i.base&&(i=this.copyBaseValues(i)),super.createRecord(i,...e);if(!t)throw new Error(`ViewPreset ${i} does not exist`);return t}updateLocalization(){super.updateLocalization();const i=this;let e=i.allRecords;i.isPresetManager&&(e=new Set(e.concat(Object.values(i.basePresets)))),e.forEach(t=>{let r=i.optionalL(`L{PresetManager.${t.id}}`,null,!0);typeof r=="string"&&t.baseId&&(r=i.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),r&&typeof r=="object"&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),t.mainHeaderLevel===0&&r.topDateFormat&&(r.middleDateFormat=r.middleDateFormat||r.topDateFormat),t.setData("displayDateFormat",r.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach(n=>{const s=t.headerConfig[n],a=r[n+"DateFormat"];if(s){!s.originalDateFormat&&s.dateFormat&&(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null);const l=a||s.originalDateFormat;l&&(s.dateFormat=l)}}),r.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",r.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))})}getCurrentConfig(i){return super.getCurrentConfig(i).data}copyBaseValues(i){let e=this.getById(i.base);if(!e)throw new Error(`ViewPreset base '${i.base}' does not exist.`);return e=T.clone(e.data),delete e.id,i.name&&delete e.name,T.merge(e,i)}add(i){return i=Array.isArray(i)?i:[i],i.forEach(e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))}),super.add(...arguments)}};y(Gd,"$name","PresetStore"),Gd._$name="PresetStore";var JS=class extends Gd{static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(i){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${C.format(i,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${C.format(i,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(i){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${C.format(i,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${C.format(i,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(i){if(C.weekStartDay===1){const[e,t]=C.getWeekNumber(i),r=C.getDateFromISOWeek(e,t,4),n=C.format(r,"MMM");return`${C.getShortNameOfUnit("week")}.${String(t).padStart(2,"0")} ${n} ${e}`}else return C.getShortNameOfUnit("week")+"."+C.format(i,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,mainHeaderLevel:0,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(i,e,t){return C.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(i.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(i,e)=>i.getFullYear()+" - "+e.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(i){const e=this._basePresets={};this.getConfig("modelClass");for(const t in i)i[t].id=t,e[t]=this.createRecord(i[t])}get basePresets(){return this._basePresets}set defaultPresets(i){for(let e=0,{length:t}=i;e<t;e++){const r=i[e],n=typeof r=="string",s=n?r:r.base;let a;if(n)a=this.basePresets[s];else{const l=Object.assign(Object.create({id:s}),T.clone(this.basePresets[s].data)),{timeResolution:o}=l,d=l.headers[l.headers.length-1];l.id=void 0,"width"in r&&(l.tickWidth=r.width),"height"in r&&(l.tickHeight=r.height),"increment"in r&&(d.increment=r.increment),"resolution"in r&&(o.increment=r.resolution),"resolutionUnit"in r&&(o.unit=C.getUnitByName(r.resolutionUnit)),a=this.createRecord(l),a.baseId=s}this.add(a)}}getById(i){return super.getById(i)||this.basePresets[i]}registerPreset(i,e){const t=this.createRecord(Object.assign({id:i},e)),r=this.find(n=>n.equals(t));if(r)return r;if(t.isValid)this.add(t);else throw new Error("Invalid preset, please check your configuration");return t}getPreset(i){return typeof i=="number"&&(i=this.getAt(i)),typeof i=="string"?i=this.getById(i):i instanceof ls||(i=this.createRecord(i)),i}normalizePreset(i){const e=this;if(!(i instanceof ls)){if(typeof i=="string"){if(i=e.getPreset(i),!i)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof i=="object"){if(i.base){const t=this.getById(i.base);if(!t)throw new Error(`ViewPreset base '${i.base}' does not exist`);i=T.merge(T.clone(t.data),i)}i.id?i=e.createRecord(i):(i=e.createRecord(T.assign({},i)),i.id=i.generateId(i))}}return i}deletePreset(i){typeof i=="string"?i=this.getById(i):typeof i=="number"&&(i=this.getAt(i)),i&&(this.remove(i),delete this.basePresets[i.id])}};y(JS,"$name","PresetManager");var ll=new JS;globalThis.bryntum.PresetManager=ll;var GF=class extends xt{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}},tp=class extends pe{static get defaultConfig(){return{modelClass:GF,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0},maxAllowedTickCount:1e4}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(i){const e=this;if(super.construct(i),e.originalContinuous=e.continuous,e.ion({change:({action:t})=>{t!=="filter"&&e.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>e.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:t=>e.trigger("reconfigure",t)}),e.startDate)e.internalOnReconfigure(),e.trigger("reconfigure");else if(e.viewPreset){const t=e.getAdjustedDates(new Date);e.startDate=t.startDate,e.endDate=t.endDate}}get isTimeAxis(){return!0}reconfigure(i,e=!1,t=!1){const r=this,{owner:n}=r,s={};let a=r.getAdjustedDates(i.startDate,i.endDate),l=!1;if(n!=null&&n.isBeforeMinDate(a.startDate)&&(i.startDate=n==null?void 0:n.minDate,l=!0),n!=null&&n.isAfterMaxDate(a.endDate)&&(i.endDate=n==null?void 0:n.maxDate,l=!0),l&&(a=r.getAdjustedDates(i.startDate,i.endDate)),r.trigger("beforeReconfigure",{startDate:a.startDate,endDate:a.endDate,config:i})!==!1){r.trigger("beginReconfigure"),r._configuredStartDate=i.startDate,r._configuredEndDate=i.endDate;for(const d in i)s[d]=r[d];const o=i.viewPreset&&i.viewPreset!==r.viewPreset;if(o&&(t=r.isFiltered,r.filters.forEach(d=>d.disabled=!1)),Object.assign(r,i),r.internalOnReconfigure(t,o)===!1)return!1;r.trigger("endReconfigure",{suppressRefresh:e,config:i,oldConfig:s})}}internalOnReconfigure(i=!1,e){const t=this;t.isConfigured=!0;const r=t.getAdjustedDates(t.startDate,t.endDate,!0),n=t.getAdjustedDates(t.startDate,t.endDate),s=n.startDate,a=n.endDate;if(s>=a)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${a}.`);const{unit:l,increment:o=1}=t,d=t.generateTicks(s,a,l,o)||t.constructor.prototype.generateTicks.call(t,s,a,l,o);t.suspendEvents(),t.maintainFilter=i,t.data=d,t.maintainFilter=!1;const{count:c}=t;if(c===0){if(i)return e&&t.disableFilters(),t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.endDate=t.last.endDate,t.resumeEvents(),t.isContinuous?(t.adjustedStart=r.startDate,t.adjustedEnd=C.getNext(c>1?d[c-1].startDate:r.startDate,l,o,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=t.endDate),t.updateVisibleTickBoundaries(),t.updateTickCache(!0)}updateVisibleTickBoundaries(){const i=this,{count:e,unit:t,startDate:r,endDate:n,weekStartDay:s,increment:a=1}=i,l=C.getNormalizedUnitDuration(r,t)*a,o=C.getNormalizedUnitDuration(n,t)*a;do i.visibleTickStart=(r-i.adjustedStart)/l,i.autoAdjust&&(i.visibleTickStart=Math.floor(i.visibleTickStart)),i.visibleTickStart>=1&&(i.adjustedStart=C.getNext(i.adjustedStart,t,a,s));while(i.visibleTickStart>=1);do i.visibleTickEnd=e-(i.adjustedEnd-n)/o,e-i.visibleTickEnd>=1&&(i.adjustedEnd=C.getNext(i.adjustedEnd,t,-1,s));while(e-i.visibleTickEnd>=1);i.fullTicks=!i.visibleTickStart&&i.visibleTickEnd===e}get viewPreset(){return this._viewPreset}set viewPreset(i){const e=this;if(i=ll.getPreset(i),!i.isViewPreset)throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");e._viewPreset=i,Object.assign(e,{unit:i.bottomHeader.unit,increment:i.bottomHeader.increment||1,resolutionUnit:i.timeResolution.unit,resolutionIncrement:i.timeResolution.increment,mainUnit:i.mainHeader.unit,shiftUnit:i.shiftUnit||i.mainHeader.unit,shiftIncrement:i.shiftIncrement||1,defaultSpan:i.defaultSpan||1,presetName:i.id,headers:i.headers})}get weekStartDay(){var i;return(i=this._weekStartDay)!=null?i:C.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(i){this.resolutionUnit=i.unit,this.resolutionIncrement=i.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(i,e,t=!1){e&&i-e===0&&(e=null);const r=this,{startDate:n,endDate:s}=r.getAdjustedDates(i,e);if(r.startDate-n!==0||r.endDate-s!==0)return r.reconfigure({startDate:n,endDate:s},!1,t)}shift(i,e=this.shiftUnit){const t=this;let{startDate:r,endDate:n}=t;t.isFiltered&&(r=t.allRecords[0].startDate,n=t.allRecords[t.totalCount-1].endDate);let s=0;do r=C.add(r,i,e),n=C.add(n,i,e);while(s++<t.maxTraverseTries&&t.setTimeSpan(r,n,{preventThrow:!0})===!1)}shiftNext(i=this.shiftIncrement){this.shift(i)}shiftPrevious(i=this.shiftIncrement){this.shift(-i)}filterBy(i,e=this){this.filters.clear(),super.filterBy((r,n)=>i.call(e,r.data,n))}filter(){var i;const e=this;e.viewportCenterDate=(i=e.owner)==null?void 0:i.viewportCenterDate;const t=super.filter(...arguments);return!e.maintainFilter&&e.count===0&&(e.resumeEvents(),e.trigger("invalidFilter"),e.disableFilters()),t}disableFilters(){this.filters.forEach(i=>i.disabled=!0),this.filter()}triggerFilterEvent(i){const e=this,{owner:t}=e;i.filters.count?e.continuous=!1:e.continuous=e.originalContinuous,e.updateTickCache(),t!=null&&t.infiniteScroll&&!e.continuous&&t.timeAxisViewModel.ion({update:()=>{t.shiftToDate(e.viewportCenterDate,{visibleDate:e.viewportCenterDate,block:"center"})},once:!0}),super.triggerFilterEvent(i)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(i,e,t=!1){var r,n;const s=this,{owner:a}=s;e&&i-e===0&&(e=null),i=i||s.startDate,e=e||C.add(i,s.defaultSpan,s.mainUnit);const l=s.floorDate(i,!1,s.autoAdjust?s.mainUnit:s.unit,1),o=s.ceilDate(e,!1,s.autoAdjust?s.mainUnit:s.unit,1),d=o-l,c=(r=a==null?void 0:a.getMinDateOrDate(l))!=null?r:l;let u=(n=a==null?void 0:a.getMaxDateOrDate(o))!=null?n:o;return u<=c&&(u=a==null?void 0:a.getMaxDateOrDate(C.add(c,d))),s.autoAdjust||t?{startDate:c,endDate:u}:{startDate:i,endDate:e}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(i){this._start=C.parse(i)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(i){i&&(this._end=C.parse(i))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(i,e,t,r){e=e!==!1;const n=this,s=e?C.clone(n.startDate):null,a=r||n.resolutionIncrement,l=t||(e?n.resolutionUnit:n.mainUnit),o=(c,u)=>Math.floor(c/u)*u;if(e)return C.floor(i,{unit:l,magnitude:a},s);const d=C.clone(i);if(l==="week"){const c=d.getDay()||7,u=n.weekStartDay||7;C.add(C.startOf(d,"day",!1),c>=u?u-c:-(7-u+c),"day",!1),d.getDay()!==u&&d.getHours()===23&&C.add(d,1,"hour",!1)}else{C.startOf(d,l,!1);const c=["day","year"].includes(l)?1:0,u=l==="day"?"date":l,h=o(C.get(d,u)-c,a)+c;C.set(d,u,h)}return d}roundDate(i,e,t=this.resolutionUnit,r=this.resolutionIncrement||1){const n=this,s=C.clone(i);switch(e=C.clone(e||n.startDate),t){case"week":{C.startOf(s,"day",!1);let a=s.getDay()-n.weekStartDay,l;return a<0&&(a=7+a),Math.round(a/7)===1?l=7-a:l=-a,C.add(s,l,"day",!1)}case"month":{const a=C.diff(e,s,"month")+C.as("month",s.getDay()/C.daysInMonth(s)),l=Math.round(a/r)*r;return C.add(e,l,"month",!1)}case"quarter":return C.startOf(s,"month",!1),C.add(s,3-s.getMonth()%3,"month",!1);default:{const a=C.as(t,C.diff(e,s)),l=t==="year"?0:C.as(t,e.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),o=Math.round((a+l)/r)*r;return C.add(e,o-l,t,!1)}}}ceilDate(i,e,t,r){const n=this;e=e!==!1,r=r||(e?n.resolutionIncrement:1);const s=t||(e?n.resolutionUnit:n.mainUnit),a=C.clone(i);let l=!1;switch(s){case"minute":l=!C.isStartOf(a,"minute");break;case"hour":l=!C.isStartOf(a,"hour");break;case"day":case"date":l=!C.isStartOf(a,"day");break;case"week":C.startOf(a,"day",!1),l=a.getDay()!==n.weekStartDay||!C.isEqual(a,i);break;case"month":C.startOf(a,"day",!1),l=a.getDate()!==1||!C.isEqual(a,i);break;case"quarter":C.startOf(a,"day",!1),l=a.getMonth()%3!==0||a.getDate()!==1||!C.isEqual(a,i);break;case"year":C.startOf(a,"day",!1),l=a.getMonth()!==0||a.getDate()!==1||!C.isEqual(a,i);break}return l?C.getNext(a,s,r,n.weekStartDay):a}get include(){return this._include}set include(i){const e=this;e._include=i,e.continuous=!i,e.isConfiguring||(e.startDate=e._configuredStartDate,e.endDate=e._configuredEndDate,e.internalOnReconfigure(),e.trigger("includeChange"))}processExclusion(i,e,t){const{include:r}=this;return r?Object.entries(r).some(([n,s])=>{if(!s)return!1;const{from:a,to:l}=s;if(C.compareUnits("day",t)>=0&&C.getLargerUnit(n)===t&&(a&&C.set(i,n,a),l)){let o=t;t==="day"&&(o="date"),C.set(e,{[o]:C.get(e,o)-1,[n]:l})}if(C.compareUnits(n,t)>=0){const o=n==="day"?i.getDay():C.get(i,n);if(a&&o<a||l&&o>=l)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([i,e])=>{if(e){const{from:t,to:r}=e;e.lengthFactor=C.getUnitToBaseUnitRatio(i,C.getLargerUnit(i))/(r-t),e.lengthFactorExcl=C.getUnitToBaseUnitRatio(i,C.getLargerUnit(i))/(r-t-1),e.center=t+t/(e.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(i,e,t=this.unit,r=this.increment){const n=this,s=[],a=!!n.include;n.validateTickCount();let l,o,d,c=0,{startDate:u,endDate:h}=n.getAdjustedDates(i,e),g=!1;for(n.tickCache={},a&&n.initExclusion();u<h;){if(l=C.getNext(u,t,r,n.weekStartDay),!n.autoAdjust&&l>h&&!g&&(l=new Date(h.getTime())),t==="hour"&&r>1&&s.length>0&&c===0){const f=s[s.length-1];c=(f.startDate.getHours()+r)%24-f.endDate.getHours(),c!==0&&(l=C.add(l,c,"hour"))}if(d=!1,a){if(o=new Date(l.getTime()),d=n.processExclusion(u,l,t),g){if(!n.autoAdjust&&l>h){u=o;continue}}else if(l<u){g=!0;continue}}else o=l;d||(s.push({id:s.length+1,startDate:u,endDate:l}),n.tickCache[u.getTime()]=s.length-1),u=o}return s}get visibleTickTimeSpan(){const i=this;return i.isContinuous?i.visibleTickEnd-i.visibleTickStart:i.count}getTickFromDate(i){var e,t;const r=this,n=r.records,s=(t=(e=i.getTime)==null?void 0:e.call(i))!=null?t:i;let a=0,l=n.length-1,o,d,c,u;if(!n.length||s<n[0].startDateMS||s>n[l].endDateMS)return-1;if(r.isContinuous){for(;a<l;)o=a+l+1>>1,s>n[o].endDateMS?a=o+1:s<n[o].startDateMS?l=o-1:a=o;return d=n[a],c=d.startDateMS,s>c&&(u=d.endDateMS,a+=(s-c)/(u-c)),Math.min(Math.max(a,r.visibleTickStart),r.visibleTickEnd)}else for(let h=0;h<=l;h++)if(u=n[h].endDateMS,s<=u)return c=n[h].startDateMS,d=h+(s>c?(s-c)/(u-c):0),d}getSnappedTickFromDate(i){const e=Math.floor(this.getTickFromDate(i));return this.getAt(e)}getDateFromTick(i,e){const t=this;if(i===t.visibleTickEnd)return t.endDate;const r=Math.floor(i),n=i-r,s=t.getAt(r);if(!s)return null;const a=r===0&&t.isContinuous?t.adjustedStart:s.startDate,l=r===t.count-1&&t.isContinuous?t.adjustedEnd:s.endDate;let o=C.add(a,n*(l-a),"millisecond");return e&&(o=t[e+"Date"](o)),o}get maxAllowedEndDate(){const i=this.maxAllowedTickCount*C.asMilliseconds(this.increment,this.unit);return C.add(C.parse(this.startDate),i)}validateTickCount(){this.endDate>this.maxAllowedEndDate&&console.error("Configured date range will result in a too long time axis. If you required in long timeline, please use InfiniteScroll feature.")}get ticks(){return this.records}updateTickCache(i=!1){const e=this;e.count?(e._start=e.first.startDate,e._end=e.last.endDate,e._startMS=e.startDate.getTime(),e._endMS=e.endDate.getTime()):e._start=e._end=e._startMs=e._endMS=null,i||(e.tickCache={},e.forEach((t,r)=>e.tickCache[t.startDate.getTime()]=r))}dateInAxis(i,e=!1){const t=this,r=t.startDate,n=t.endDate;if(t.isContinuous)return e?C.betweenLesserEqual(i,r,n):C.betweenLesser(i,r,n);{const s=t.count;let a,l,o;for(let d=0;d<s;d++)if(o=t.getAt(d),a=o.startDate,l=o.endDate,e&&i<=l||!e&&i<l)return i>=a}return!1}timeSpanInAxis(i,e){const t=this;return!e||e.getTime()===i.getTime()?this.dateInAxis(i,!0):t.isContinuous?C.intersectSpans(i,e,t.startDate,t.endDate):i<t.startDate&&e>t.endDate||t.getTickFromDate(i)!==t.getTickFromDate(e)}isTimeSpanInAxis(i){var e;const t=this,{startMS:r,endMS:n}=t,{startDateMS:s}=i,a=(e=i.endDateMS)!=null?e:i.meta.endDateCached;if(!s||!a)return!1;if(a===s)return t.dateInAxis(i.startDate,!0);if(t.isContinuous)return a>r&&s<n;const l=t.getTickFromDate(s),o=t.getTickFromDate(a);return l===t.count&&C.isEqual(i.startDate,t.last.endDate)||o===0&&C.isEqual(i.endDate,t.first.startDate)?!1:s<r&&a>n||l!==o}forEachAuxInterval(i,e=1,t,r=this){const n=this.endDate;let s=this.startDate,a=0,l;if(s>n)throw new Error("Invalid time axis configuration");for(;s<n;)l=C.min(C.getNext(s,i,e,this.weekStartDay),n),t.call(r,s,l,a,l>=n),s=l,a++}};tp._$name="TimeAxis";var ip=class extends Fe(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(i){const e=this;e.unitToPixelsCache={},super.construct(i);const t=e.timeAxis.viewPreset||e.viewPreset;if(t)if(t instanceof ls)e.consumeViewPreset(t);else{const r=ll.getPreset(t);r&&e.consumeViewPreset(r)}e.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:e}),e.configured=!0}doDestroy(){var i,e;(e=(i=this.timeAxis).un)==null||e.call(i,"reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}get columnConfig(){return this._columnConfig}set columnConfig(i){this._columnConfig=i}get headers(){return this._headers}set headers(i){if(i&&i.length&&i[i.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=i}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(i){i!==this._forceFit&&(this._forceFit=i,this.update())}reconfigure(i){this.headers=null,this.setConfig(i),this.trigger("reconfigure")}onTimeAxisReconfigure({source:i,suppressRefresh:e}){this.viewPreset!==i.viewPreset&&this.consumeViewPreset(i.viewPreset),!e&&i.count>0&&this.update()}update(i,e=!1,t=!1){var r;const n=this,{timeAxis:s,headers:a}=n,l=i!==0;if(n.isConfiguring||l&&n._availableSpace===i){t&&n.trigger("update");return}if(n._availableSpace=Math.max(i||n.availableSpace||0,0),typeof n.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");n.columnConfig=[];const o=n._tickSize=n.calculateTickSize(n.originalTickSize);if(typeof o!="number"||o<0)throw new Error("Invalid timeAxis tick size");n.unitToPixelsCache={},n._totalSize=null;const d=C.weekStartDay;typeof((r=n.owner)==null?void 0:r.weekStartDay)=="number"&&(C._weekStartDay=s.weekStartDay);for(let c=0,{length:u}=a;c<u;c++){const h=a[c];if(h.cellGenerator){const g=h.cellGenerator.call(n,s.startDate,s.endDate);n.columnConfig[c]=n.createHeaderRow(c,h,g)}else n.columnConfig[c]=n.createHeaderRow(c,h)}n.owner&&(C._weekStartDay=d),e||n.trigger("update")}getDistanceBetweenDates(i,e){return this.getPositionFromDate(e)-this.getPositionFromDate(i)}getDistanceForDuration(i){return this.getSingleUnitInPixels("millisecond")*i}getPositionFromDate(i,e={}){const t=this.getScaledTick(i,e);return t===-1?-1:this.tickSize*(t-this.timeAxis.visibleTickStart)}getScaledTick(i,{respectExclusion:e,snapToNextIncluded:t,isEnd:r,min:n,max:s}){const{timeAxis:a}=this,{include:l,unit:o}=a;let d=a.getTickFromDate(i);if(d!==-1&&e&&l){let c=!1;if(l.hour&&C.compareUnits(o,"hour")>0&&o!=="day"){const{from:u,to:h,lengthFactor:g,center:f}=l.hour,m=i.getHours(),p=Math.min(Math.max(m,u),h);if(!t&&p!==m)return-1;const v=p+i.getMinutes()/60,b=f-v,w=f-b*g;i=C.add(i,w-m,"h"),c=!0}if(l.day&&C.compareUnits(o,"day")>0){const{from:u,to:h,lengthFactor:g,center:f}=l.day;let m=i.getDay();r&&i.getHours()===0&&i.getMinutes()===0&&i.getSeconds()===0&&i.getMilliseconds()===0&&--m<0&&(m=6);let p=0;if(m<u||m>=h)if(t){if(r?p=(h-m-8)%7:p=(u-m+7)%7,i=C.add(i,p,"d"),i=C.startOf(i,"d",!1,a.weekStartDay),s&&i.getTime()>=s||n&&i.getTime()<=n)return-1}else return-1;const{weekStartDay:v}=a,b=i.getDay()===0?0:f,w=i.getDay()+i.getHours()/24,D=b-w,S=b-D*g;i=C.add(i,S-w+v,"d"),c=!0}c&&(i=C.constrain(i,a.startDate,a.endDate),d=a.getTickFromDate(i))}return d}getDateFromPosition(i,e,t=!1){const r=this,{timeAxis:n}=r,s=r.getScaledPosition(i)/r.tickSize+n.visibleTickStart;if(s<0||s>n.count){if(t){let a;return s<0?a=C.add(n.startDate,s,n.unit):a=C.add(n.endDate,s-n.count,n.unit),e&&(a=n[e+"Date"](a)),a}return null}return n.getDateFromTick(s,e)}getScaledPosition(i){const{include:e,unit:t,weekStartDay:r}=this.timeAxis;if(e){const n=this.getSingleUnitInPixels("day");if(e.day&&C.compareUnits(t,"day")>0){const{from:s,lengthFactor:a}=e.day,l=i%(n*7),o=i-l;i=l/a+(s-r)*n+o}if(e.hour&&C.compareUnits(t,"hour")>0&&t!=="day"){const{from:s,lengthFactorExcl:a}=e.hour,l=this.getSingleUnitInPixels("hour"),o=i%n,d=i-o;i=o/a+s*l+d}}return i}getSingleUnitInPixels(i){const e=this;return e.unitToPixelsCache[i]||(e.unitToPixelsCache[i]=C.getUnitToBaseUnitRatio(e.timeAxis.unit,i,!0)*e.tickSize/e.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:i}=this.timeAxis;return(i.increment||1)*this.getSingleUnitInPixels(i.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(i){this.setTickSize(i,!1)}setTickSize(i,e){this._tickSize=this.originalTickSize=i,this.update(void 0,e)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(i){const e=this,{forceFit:t,timeAxis:r,suppressFit:n}=e,s=r.unit;let a=0,l=1;if(e.snap){const o=r.resolution;l=C.getUnitToBaseUnitRatio(s,o.unit)*o.increment}if(n)a=i;else{const o=e.availableSpace/r.visibleTickTimeSpan;a=t||i<o?o:i,l>0&&(!t||l<1)&&(a=Math.max(1,l*a)/l)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(i){const e=this,t=e._availableSpace;if(e._availableSpace=Math.max(0,i),e._availableSpace>0){const r=e.calculateTickSize(e.originalTickSize);r>0&&(r!==e.tickSize||t===0)&&e.update()}}getDates(i=this.columnLinesFor,e=!1,t=!1){const r=this,n=[],s=e?r.lowestHeader:i,a=r.majorHeaderLevel,l=r.headers&&r.headers[i].unit,o=a!=null&&r.headers&&r.headers[a].unit,d=a!=null&&C.doesUnitsAlign(o,l);if(!!(r.headers&&r.headers[s].cellGenerator)){const u=r.columnConfig[s];for(let h=1,g=u.length;h<g;h++)n.push({date:u[h].startDate})}else r.forEachInterval(s,(u,h)=>{n.push({date:t?h:u,isMajor:a!==i&&d&&r.isMajorTick(t?h:u)})});return n}get forceFit(){return this._forceFit}fitToAvailableSpace(i){const e=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(e,i)}get snap(){return this._snap}set snap(i){i!==this._snap&&(this._snap=i,this.configured&&this.update())}createHeaderRow(i,e,t){const r=this,n=[],{align:s,headerCellCls:a=""}=e,l=C.clearTime(new Date),{timeAxis:o}=r,d=r.headers.length-1,c=(h,g,f,m,p)=>{let v=C.format(h,e.dateFormat);const b=f>0&&!m,w={align:s,start:h,end:g,value:p?p.header:v,headerCellCls:a,width:d===i&&r.owner&&(o.fullTicks||b)?r.owner.tickSize:r.getDistanceBetweenDates(h,g),index:f};w.width!==0&&(w.coord=u-1,u+=w.width,r.headersDatesCache[i][h.getTime()]=1,e.renderer&&(v=e.renderer.call(e.thisObj||r,h,g,w,f,r.owner),w.value=v==null?"":v),e.unit==="day"&&(!e.increment||e.increment===1)&&(w.headerCellCls+=" b-sch-dayheadercell-"+h.getDay(),C.clearTime(h,!0)-l===0&&(w.headerCellCls+=" b-sch-dayheadercell-today")),n.push(w))};let u=0;return r.headersDatesCache[i]={},t?t.forEach((h,g)=>c(h.start,h.end,g,g===t.length-1,h)):r.forEachInterval(i,c),n}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:i}=this;return i?Math.max(i.length-2,0):null}isMajorTick(i){const e=this.majorHeaderLevel;return e!=null&&this.headersDatesCache[e]&&this.headersDatesCache[e][i.getTime()]||!1}forEachInterval(i,e,t=this){const{headers:r,timeAxis:n}=this;if(r)if(i===r.length-1)n.forEach((s,a)=>e.call(t,s.startDate,s.endDate,a,a===n.count-1));else{const s=r[i];n.forEachAuxInterval(s.unit,s.increment,e,t)}}forEachMainInterval(i,e){this.forEachInterval(this.mainHeaderLevel,i,e)}consumeViewPreset(i){const e=this;e.headers=null,e.getConfig("tickSize"),e.viewPreset=i,Object.assign(e,{headers:i.headers,columnLinesFor:i.columnLinesFor,mainHeaderLevel:i.mainHeaderLevel,_tickSize:e.isHorizontal?i.tickWidth:i.tickHeight}),e.originalTickSize=e.tickSize}};ip._$name="TimeAxisViewModel";var QS=new Date,eD=i=>{var e;return e=class extends(i||$){getRtlX(t){return this.rtl&&this.isHorizontal&&(t=this.timeAxisViewModel.totalSize-t),t}getDateFromCoordinate(t,r,n=!0,s=!1,a=!1){return n||(t=this.currentOrientation.translateToScheduleCoordinate(t)),a||(t=this.getRtlX(t)),this.timeAxisViewModel.getDateFromPosition(t,r,s)}getDateFromCoord(t){return this.getDateFromCoordinate(t.coord,t.roundingMethod,t.local,t.allowOutOfRange,t.ignoreRTL)}getDateFromVirtualCoord(t){return this.getDateFromCoordinate(t.coord,t.roundingMethod,t.local,t.allowOutOfRange,!0)}getDateFromXY(t,r,n=!0,s=!1){return this.currentOrientation.getDateFromXY(t,r,n,s)}getDateFromDomEvent(t,r,n=!1){return this.getDateFromXY([t.pageX,t.pageY],r,!1,n)}getStartEndDatesFromRectangle(t,r,n,s=!1,a=!0){const l=this,{isHorizontal:o}=l,d=o?t.x:t.top,c=o?t.right:t.bottom;let u,h;return d>=0&&c<l.timeAxisViewModel.totalSize?(u=l.getDateFromCoordinate(d,r,a),h=l.getDateFromCoordinate(c,r,a)):d<0?(h=l.getDateFromCoordinate(c,r,a,s),u=h&&C.add(h,-n,"ms")):(u=l.getDateFromCoordinate(d,r,a,s),h=u&&C.add(u,n,"ms")),{start:u,end:h}}getDisplayEndDate(t,r){return t.getHours()===0&&t.getMinutes()===0&&(!r||!(t.getYear()===r.getYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()))&&!C.formatContainsHourInfo(this.displayDateFormat)&&(t=C.add(t,-1,"day")),t}getFormattedEndDate(t,r){return this.getFormattedDate(this.getDisplayEndDate(t,r))}getCoordinateFromDate(t,r=!0){if(!t)throw new Error("Invalid date passed to getCoordinateFromDate");const n=this,{timeAxisViewModel:s}=n,{isContinuous:a,startMS:l,endMS:o,startDate:d,endDate:c,unit:u}=n.timeAxis,h=t.valueOf();r===!0?r={local:!0}:r?"local"in r||(r.local=!0):r={local:!1};let g;if(t instanceof Date||(QS.setTime(t),t=QS),a&&t.getTimezoneOffset()===d.getTimezoneOffset()&&d.getTimezoneOffset()===c.getTimezoneOffset()&&C.getUnitToBaseUnitRatio(u,"day")!==-1){if(h<l||h>o)return-1;g=(h-l)/(o-l)*s.totalSize}else g=s.getPositionFromDate(t,r);return n.rtl&&n.isHorizontal&&!(r!=null&&r.ignoreRTL)&&(g=s.totalSize-g),r.local||(g=n.currentOrientation.translateToPageCoordinate(g)),g}getVirtualCoordFromDate(t,r){return this.getCoordinateFromDate(t,{...r,ignoreRTL:!0})}getTimeSpanDistance(t,r){return this.timeAxisViewModel.getDistanceBetweenDates(t,r)}get viewportCenterDate(){if(this.isVisible){const{timeAxis:t,timelineScroller:r}=this;if(t.isContinuous){const n=(r.position+r.clientSize/2)/r.scrollSize;return new Date(t.startMS+(t.endMS-t.startMS)*n)}return this.getDateFromCoordinate(r.position+r.clientSize/2)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(t){this.timeAxis.resolution=typeof t=="number"?{increment:t,unit:this.timeAxis.resolution.unit}:t}get snap(){var t,r;return(r=(t=this._timeAxisViewModel)==null?void 0:t.snap)!=null?r:this._snap}updateSnap(t){this.isConfiguring||(this.timeAxisViewModel.snap=t,this.timeAxis.forceFullTicks=t&&this.fillTicks)}onSchedulerHorizontalScroll(t,r,n,s){s||(this.cachedCenterDate=null)}get widgetClass(){}},y(e,"$name","TimelineDateMapper"),y(e,"configurable",{snap:!1}),e},{eventNameMap:YF}=V,tD=i=>{var e;return e=class extends(i||$){constructor(){super(...arguments),y(this,"hoveredEvents",new Set)}initDomEvents(){const t=this,{schedulerEvents:r}=t;r.element=t.timeAxisSubGridElement,r.thisObj=t,V.on(r),V.on({element:t.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:t}),t.updateTimelineContextOnScroll&&Y.supportsPointerEventConstructor&&V.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:t})}getTimeSpanMouseEventParams(t,r){throw new Error("Implement in subclass")}getScheduleMouseEventParams(t,r){throw new Error("Implement in subclass")}handleScheduleEvent(t){const r=this;if(r.ignoreDomEventsWhileScrolling&&(r.scrolling||r.timeAxisSubGrid.scrolling))return;const n=r.getTimelineEventContext(t);r.lastPointerEvent=t,n&&r.trigger(`${n.eventElement?r.scheduledEventName:"schedule"}${YF[n.domEvent.type]||O.capitalize(n.domEvent.type)}`,n),r.timelineContext=n}handleScheduleLeaveEvent(t){t.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(t)}onScheduleScroll({target:t}){var r,n,s,a,l;const o=this;if(t&&o.updateTimelineContextOnScroll&&!((r=o.features.pan)!=null&&r.isActive)&&!o.partners.some(d=>{var c;return(c=d.features.pan)==null?void 0:c.isActive})&&(t.contains(o.element)||o.bodyElement.contains(t))){const{timelineContext:d,lastPointerEvent:c}=o;if(d){const u=E.elementFromPoint(d.domEvent.clientX,d.domEvent.clientY),h=new Y.PointerEventConstructor("pointermove",c),g=new MouseEvent("mousemove",c);Object.defineProperty(h,"pointerId",{value:(l=(a=(n=le.currentPointerDown)==null?void 0:n.pointerId)!=null?a:(s=le.currentTouch)==null?void 0:s.identifier)!=null?l:1}),h.scrollInitiated=g.scrollInitiated=!0,u==null||u.dispatchEvent(h),u==null||u.dispatchEvent(g)}}}updateTimelineContext(t,r){this.trigger("timelineContextChange",{oldContext:r,context:t}),t&&!r?this.trigger("scheduleMouseEnter",t):t||this.trigger("scheduleMouseLeave",{event:r.event})}getTimelineEventContext(t){var r,n;const s=this,{scheduleContext:a}=s.features;if(a){const{context:d}=a,{type:c}=t,u=c.endsWith("leave")||c.endsWith("out")?t.relatedTarget:t.target;if(d&&((r=a.widget)!=null&&r.owns(u)||a.element.contains(u)))return a.element.style.pointerEvents="none",d.eventElement=(n=document.elementFromPoint(t.clientX,t.clientY))==null?void 0:n.closest(s.eventSelector),d.eventRecord=s.resolveEventRecord(d.eventElement),a.element.style.pointerEvents="",s._timelineContext=null,d}const l=t.target.closest(s.eventInnerSelector),o=s.getCellElementFromDomEvent(t);if(o){const d=s.getDateFromDomEvent(t);if(!d)return;const c=s.timeAxis.floorDate(d),u=Oe.get(o),h=l?s.getTimeSpanMouseEventParams(l,t):s.getScheduleMouseEventParams(u,t);if(!h)return;const g=s.isVertical?s.resourceStore.indexOf(h.resourceRecord):u.row.dataIndex,f=s.timeAxis.getTickFromDate(c),m=s.timeAxis.getAt(Math.floor(f));if(m)return{scheduler:s,isTimelineContext:!0,domEvent:t,eventElement:l,cellElement:o,index:g,tick:m,tickIndex:f,date:c,time:d,tickStartDate:m.startDate,tickEndDate:m.endDate,tickParentIndex:m.parentIndex,row:u.row,event:t,...h}}}getCellElementFromDomEvent({target:t,clientY:r,type:n}){var s;const a=this,{isVertical:l,foregroundCanvas:o}=a,d=t.closest(a.eventSelector);return l?a.timeAxisSubGridElement.querySelector(a.timeCellSelector):d?a.getCell({record:a.resolveRowRecord(d)||a.store.getAt(a.rowManager.getRowAt(r,!1).dataIndex),column:a.timeAxisColumn}):o.contains(t)&&(t===o||t.closest(".b-sch-resourcetimerange")||n==="mousemove")?(s=a.rowManager.getRowAt(r,!1))==null?void 0:s.getCell(a.timeAxisColumn.id):t.matches(".b-grid-row")?t.firstElementChild:t.closest(a.timeCellSelector)}matchScheduleCell(t){return t.closest(this.timeCellSelector)}onElementMouseButtonEvent(t){const r=t.target.closest(".b-sch-header-timeaxis-cell");if(r){const n=this,s=r.parentElement.dataset.headerPosition,a=n.timeAxisViewModel.columnConfig[s],l=n.timeAxis.isFiltered?a.findIndex(c=>c.index==r.dataset.tickIndex):r.dataset.tickIndex,o=a[l],d=n.features.contextMenu;(!d||t.type!==d.triggerEvent)&&this.trigger(`timeAxisHeader${O.capitalize(t.type)}`,{startDate:o.start,endDate:o.end,event:t})}}onElementMouseDown(t){this.onElementMouseButtonEvent(t),super.onElementMouseDown(t)}onElementClick(t){this.onElementMouseButtonEvent(t),super.onElementClick(t)}onElementDblClick(t){this.onElementMouseButtonEvent(t),super.onElementDblClick(t)}onElementContextMenu(t){this.onElementMouseButtonEvent(t),super.onElementContextMenu(t)}onElementMouseOver(t){var r;const n=this;if(n.ignoreDomEventsWhileScrolling&&(n.scrolling||n.timeAxisSubGrid.scrolling))return;super.onElementMouseOver(t);const{target:s}=t,{hoveredEvents:a}=n;if((s.closest(n.eventInnerSelector)||s.matches(".b-sch-terminal-hover-area"))&&!((r=n.features.eventDrag)!=null&&r.isDragging)){const l=s.closest(n.eventSelector);if(!a.has(l)&&!n.preventOverCls){a.add(l),l.classList.add(n.overScheduledEventClass);const o=n.getTimeSpanMouseEventParams(l,t);o&&n.trigger(`${n.scheduledEventName}MouseEnter`,o)}}else a.size&&n.unhoverAll(t)}onElementMouseOut(t){var r;const n=this,{features:s}=n,{target:a,relatedTarget:l}=t;l!=null&&l.closest(".b-sch-canvas *")||super.onElementMouseOut(t);const o=a.closest(n.eventSelector),d=o==null?void 0:o.querySelector(n.eventInnerSelector),c=o&&n.resolveTimeSpanRecord(o);d&&c&&n.hoveredEvents.has(o)&&!((r=s.eventDrag)!=null&&r.isDragging)&&l&&(E.isDescendant(d,l)||l.matches(".b-sch-terminal-hover-area"))||o&&n.hoveredEvents.size&&n.unhover(o,t)}unhover(t,r){const n=this;t.classList.remove(n.overScheduledEventClass),n.getTimeSpanMouseEventParams(t,r)&&n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(t,r)),n.hoveredEvents.delete(t)}unhoverAll(t){for(const r of this.hoveredEvents)!r.isReleased&&!r.classList.contains("b-released")&&this.unhover(r,t);this.hoveredEvents.clear()}get widgetClass(){}},y(e,"$name","TimelineDomEvents"),y(e,"configurable",{timelineContext:{$config:{equal(t,r){return(t==null?void 0:t.index)===(r==null?void 0:r.index)&&(t==null?void 0:t.tickParentIndex)===(r==null?void 0:r.tickParentIndex)&&!(((t==null?void 0:t.tickStartDate)||0)-((r==null?void 0:r.tickStartDate)||0))&&(t==null?void 0:t.eventRecord)===(r==null?void 0:r.eventRecord)}}},updateTimelineContextOnScroll:!1,ignoreDomEventsWhileScrolling:null}),y(e,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}}),y(e,"delayable",{onScheduleScroll:"raf"}),e},iD=i=>{var e;return e=class extends(i||$){static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(t){const r={owner:this,data:t===!0?ll.data:[]};if(t!==!0)if(Array.isArray(t))for(const n of t)if(typeof n=="string"){const s=ll.getById(n);s&&r.data.push(s.data)}else r.data.push(n);else T.assign(r,t);return new Gd(r)}changeViewPreset(t,r){const n=this,{presets:s}=n;t?(t=s.createRecord(t),s.includes(t)||s.add(t)):t=s.first;const a=n.lastViewPresetOptions||{},l=t.options||(t.options={}),o={...l,from:r,to:t,preset:t},d=!n._viewPreset||!n._viewPreset.equals(t);if(delete a.event,(d||!T.isEqual(l,a))&&(l.event=o,d||(n._viewPreset=null),n.isConfiguring||n.trigger("beforePresetChange",o)!==!1))return t}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(t){this.trigger("displayDateFormatChange",{format:t})}getFormattedDate(t){return C.format(t,this.displayDateFormat)}updateViewPreset(t){var r;const n=this,{options:s}=t,{event:a,startDate:l,endDate:o}=s,{hasTimelineBoundaries:d,isHorizontal:c,_timeAxis:u,_timeAxisViewModel:h}=n,g=c&&n.rtl;let{centerDate:f,zoomDate:m,zoomPosition:p}=s,v=!1;if((r=n.syncSplits)==null||r.call(n,b=>b.viewPreset=t),delete t.options,n._viewPresetChanging=!0,u&&!n.isConfiguring){const{timelineScroller:b}=n;if(n.lastViewPresetOptions=s,u.isConfigured){n.suspendRefresh();const w=T.copyProperties({},n,["weekStartDay","startTime","endTime"]);n.range&&n.calendar&&!n.isConfiguring?(w.startDate=n.startDate,w.endDate=n.endDate):n.infiniteScroll?Object.assign(w,n.calculateInfiniteScrollingDateRange(f||(l&&o?new Date((l.getTime()+o.getTime())/2):n.viewportCenterDateCached),!0,t)):l?(w.startDate=l,w.endDate=o,!f&&o&&(f=new Date((l.getTime()+o.getTime())/2))):(w.startDate=u.startDate,w.endDate=o||u.endDate,f||(f=n.viewportCenterDate)),u.isConfigured=!1,w.viewPreset=t,u.reconfigure(w,!0),h.reconfigure({viewPreset:t,headers:t.headers,columnLinesFor:t.columnLinesFor!=null?t.columnLinesFor:t.headers.length-1,tickSize:s.tickSize||(c?t.tickWidth:t.tickHeight||t.tickWidth||60)}),s.tickSize&&(n.tickSize=s.tickSize),n.resumeRefresh(!1)}if(n.refresh(),!s.notScroll&&n.isPainted)if("scrollPosition"in s)v=b.position===s.scrollPosition,b.scrollTo(s.scrollPosition);else if(s.visibleDate)n.visibleDate=s.visibleDate;else if(m&&p){let w=15,D="minute";C.compareUnits(u.resolutionUnit,"hour")>0&&(w=1,D="hour");const S=C.asMilliseconds(w,D),x=new Date(Math.round(m/S)*S);a.zoomDate=m,a.zoomPosition=p,a.zoomLevel=s.zoomLevel,d&&b.position==0&&n.currentOrientation.updateFromHorizontalScroll(0,!0,!0),g?b.position=b.scrollWidth-(n.getCoordinateFromDate(x)+p):b.position=n.getCoordinateFromDate(x)-p}else if(f){n.cachedCenterDate=f,a.centerDate=f;const w=n.timelineScroller.clientSize,D=g?n.timeAxisViewModel.totalSize-n.getCoordinateFromDate(f,!0):n.getCoordinateFromDate(f,!0),S=Math.max(D-w/2,0);S===(n.isHorizontal?n.scrollLeft:n.scrollTop)?v=!0:n.isHorizontal?n.scrollHorizontallyTo(S,{scrollingToCenter:!0}):n.scrollVerticallyTo(S,{scrollingToCenter:!0})}else(n.isHorizontal?n.scrollLeft:n.scrollTop)===0?v=!0:n.timelineScroller.scrollTo(0)}n.dataset.presetId=t.id,t.rowHeight&&!n.initialConfig.rowHeight&&(n.rowHeight=t.rowHeight),n.trigger("presetChange",a),n._viewPresetChanging=!1,v&&(n.isHorizontal?n.currentOrientation.updateFromHorizontalScroll(n.scrollLeft,!0):n.currentOrientation.updateFromVerticalScroll(n.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(t){const r=super.getCurrentConfig(t);return r.viewPreset&&r.viewPreset.name&&!r.viewPreset.base&&delete r.viewPreset.name,r}get widgetClass(){}},y(e,"$name","TimelineViewPresets"),e},rp=i=>{var e;return e=class extends(i||$){constructor(){super(...arguments),y(this,"lastWheelTime",-1),y(this,"lastZoomPosition",-1)}construct(t){const r=this;super.construct(t),r.zoomOnMouseWheel&&V.on({element:r.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:n=>(n.ctrlKey||n.metaKey)&&n.preventDefault()},thisObj:r,capture:!0,passive:!1}),r.zoomOnTimeAxisDoubleClick&&r.ion({timeaxisheaderdblclick:({startDate:n,endDate:s})=>{r.forceFit||r.zoomToSpan({startDate:n,endDate:s})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(t){if(typeof t!="number"&&(t=this.presets.count-1),t<0||t>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=t}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(t){if(typeof t!="number"&&(t=0),t<0||t>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=t}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(t){this.zoomToLevel(t)}getMilliSecondsPerPixelForZoomLevel(t,r){const{bottomHeader:n}=t,s=this.isHorizontal?t.tickWidth:t.tickHeight;return Math.round((C.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(r?s:t.actualWidth||s))}zoomTo(t){const r=this;typeof t=="object"?t.preset?r.zoomToLevel(t.preset,t):t.level!=null?r.zoomToLevel(t.level,t):r.zoomToSpan(t):r.zoomToLevel(t)}zoomToLevel(t,r={}){const n=this;if(n.forceFit)return console.warn("Warning: The forceFit setting and zooming cannot be combined"),null;typeof t=="number"&&(t=Math.min(Math.max(t,n.minZoomLevel),n.maxZoomLevel));const{presets:s}=n,a=n.isVertical?"tickHeight":"tickWidth",l=s.createRecord(t),o=l[a],d=r.startDate?new Date(r.startDate):null,c=r.endDate?new Date(r.endDate):null;s.add(l);let u=d&&c?{startDate:d,endDate:c}:null,h=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;const g=r.centerDate?new Date(r.centerDate):u?new Date((d.getTime()+c.getTime())/2):n.viewportCenterDateCached;if(h===0){const{_beforeCollapseState:f}=n.timeAxisSubGrid;if(n.isHorizontal&&n.timeAxisSubGrid.collapsed&&(f!=null&&f.width))h=f.width;else return null}return u||(u=n.calculateOptimalDateRange(g,h,l)),"width"in r&&l.setData(a,r.width),n.isZooming=!0,l.options={...r,startDate:u.startDate||n.startDate,endDate:u.endDate||n.endDate,centerDate:g},n.viewPreset=l,l.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,l.setData(a,o),n.zoomLevel}zoomToFit(t){const r=this.eventStore,n=r.getTotalTimeSpan();t={leftMargin:0,rightMargin:0,...t,...n},t.startDate&&t.endDate&&(t.endDate>t.startDate?this.zoomToSpan(t):this.scrollToDate(t.startDate))}zoomToSpan(t={}){const r=this,{availableSpace:n}=r.timeAxisViewModel,s=t.endDate-t.startDate;if(n<=0)return;if((t.leftMargin||t.rightMargin)&&(t.adjustStart=0,t.adjustEnd=0),t.leftMargin||(t.leftMargin=0),t.rightMargin||(t.rightMargin=0),!t.startDate||!t.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");t.startDate=r.getMinDateOrDate(t.startDate),t.endDate=r.getMaxDateOrDate(t.endDate),t.endDate<=t.startDate&&(t.endDate=r.getMaxDateOrDate(C.add(t.startDate,s)));const{timeAxis:a}=r,l=t.adjustStart>=0||t.adjustEnd>=0;let{startDate:o,endDate:d}=t;if(l&&(o=C.add(o,-t.adjustStart,a.mainUnit),d=C.add(d,t.adjustEnd,a.mainUnit)),o<=d){const c=r.presets.allRecords,u=d-o||1;let h=r.zoomLevel,g,f;h===-1&&(h=0);let m=r.getMilliSecondsPerPixelForZoomLevel(c[h]),p=h+(g=u/m+t.leftMargin+t.rightMargin>n?-1:1),v,b=null;for(;p>=0&&p<=c.length-1;){v=c[p],m=r.getMilliSecondsPerPixelForZoomLevel(v);const M=u/m+t.leftMargin+t.rightMargin;if(g===-1){if(M<=n){b=p;break}}else if(M<=n)h!==p-g&&(b=p);else break;p+=g}b=b!=null?b:p-g,v=c[b];const w=v.bottomHeader.unit;m=r.getMilliSecondsPerPixelForZoomLevel(v),(t.leftMargin||t.rightMargin)&&(o=new Date(o.getTime()-m*t.leftMargin),d=new Date(d.getTime()+m*t.rightMargin));const D=C.getDurationInUnit(o,d,w,!0)/v.bottomHeader.increment;if(D===0)return null;const S=Math.floor(n/D),x=t.centerDate||new Date((o.getTime()+d.getTime())/2);l?f={startDate:o,endDate:d}:f=r.calculateOptimalDateRange(x,n,v);let R=r.zoomLevel;return r.zoomLevel===b?a.reconfigure(f):R=r.zoomToLevel(b,Object.assign(f,{width:S,centerDate:x})),this.trigger("zoomToSpan",{zoomLevel:b,startDate:o,endDate:d,centerDate:x}),R}return null}zoomIn(t=1,r){typeof t=="object"&&(r=t,t=1);const n=this.zoomLevel;return n>=this.maxZoomLevel?null:this.zoomToLevel(n+t,r)}zoomOut(t=1,r){typeof t=="object"&&(r=t,t=1);const n=this.zoomLevel;return n<=this.minZoomLevel?null:this.zoomToLevel(n-t,r)}zoomInFull(t){return this.zoomToLevel(this.maxZoomLevel,t)}zoomOutFull(t){return this.zoomToLevel(this.minZoomLevel,t)}calculateOptimalDateRange(t,r,n){const s=this,{timeAxis:a,minDate:l,maxDate:o}=s,{bottomHeader:d}=n,c=s.isHorizontal?n.tickWidth:n.tickHeight;if(s._originalConfiguredDateRange=s._originalConfiguredDateRange||{startDate:s.startDate,endDate:s.endDate},s.zoomKeepsOriginalTimespan)return s.getAllowedDateRange(t,n);const u=d.unit,h=Math.ceil(r/c*d.increment*s.visibleZoomFactor/2);let g=C.add(t,-h,u),f=C.add(t,h,u);return s.isBeforeMinDate(g)?(g=l,f=C.add(g,h*2,u)):s.isAfterMaxDate(f)&&(f=o,g=C.add(f,h*-2,u)),{startDate:a.floorDate(g,!1,u,d.increment),endDate:a.ceilDate(f,!1,u,d.increment)}}getAllowedDateRange(t,r){const n=this;t=t||new Date((n.startDate.getTime()+n.endDate.getTime())/2),r=r||n.viewPreset;const{timeAxis:s}=n,{bottomHeader:a}=r,{maxAllowedTickCount:l}=s,o=Math.ceil(l*C.asMilliseconds(a.increment,a.unit)/2),d=C.add(t,o);if(this.endDate>d){console.warn("Warn: start/end dates exceeds max allowed date range for current viewPreset, it was recalculated automatically.");const c=C.add(t,-o),u=C.add(t,o);return{startDate:c,endDate:u}}else{const{startDate:c,endDate:u}=n._originalConfiguredDateRange||n;if(u<d)return{startDate:c,endDate:u}}return{startDate:s.startDate,endDate:s.endDate}}onElementMouseMove(t){const{isHorizontal:r,zoomContext:n}=this;super.onElementMouseMove(t),t.isTrusted&&n&&Math.abs(t[`client${r?"X":"Y"}`]-n.coordinate)>10&&(this.zoomContext=null)}onWheel(t){if((t.ctrlKey||t.metaKey)&&!this.forceFit){t.preventDefault();const r=this,{zoomContext:n,isHorizontal:s,timelineScroller:a,zoomLevel:l}=r,o=performance.now(),d=t[`client${s?"X":"Y"}`];let c=d-a.viewport[`${s?"x":"y"}`];s&&r.rtl&&(c=a.viewport.width+a.viewport.x-d),o-r.lastWheelTime>200||!n||Math.abs(d-r.zoomContext.coordinate)>20?r.zoomContext={zoomLevel:l,coordinate:d,zoomPosition:c,zoomDate:r.getDateFromDomEvent(t)}:(l>n.zoomLevel&&(n.zoomDate=r.getDateFromDomEvent(t),n.zoomLevel=l),n.zoomPosition=c),r.lastWheelTime=o,r[`zoom${t.deltaY>0?"Out":"In"}`](void 0,r.zoomContext)}}shift(t,r){this.timeAxis.shift(t,r)}shiftNext(t){this.timeAxis.shiftNext(t)}shiftPrevious(t){this.timeAxis.shiftPrevious(t)}get widgetClass(){}},y(e,"$name","TimelineZoomable"),y(e,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),e},qF=i=>{var e;return(e=i.enableRecurringEvents)==null?void 0:e.defaultAction},Yd=class extends ft{get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){var e;(e=this.cancelFn)==null||e.call(this.thisObj),this.hide()}onRecurrenceClose(){var e;(e=this.cancelFn)==null||e.call(this.thisObj),this.hide()}confirm(e={}){var t;const r=this,n=r.closest(qF),s=(t=n==null?void 0:n.enableRecurringEvents)==null?void 0:t.defaultAction;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach(a=>{a in e&&(r[a]=e[a])}),s==="single"?(r.processSingleRecord(),!0):s==="future"?(r.processMultipleRecords(),!0):(r.confirmed=!1,r.updatePopupContent(),super.show(e),new Promise(a=>r.resolve=a))}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:r}=e.widgetMap,{eventRecord:n,actionType:s="update"}=e,a=n==null?void 0:n.isRecurring;!t||!r?((t||r).text=e.L("L{Object.Yes}"),a?e.html=e.L(`${s}-all-message`):t?e.html=e.L(`${s}-all-message`):e.html=e.L(`${s}-only-this-message`)):(a?(t.initialConfig.text||(t.text=e.L("L{Object.Yes}")),e.html=e.L(`${s}-all-message`)):(t.initialConfig.text||(t.text=e.L(`${s}-further-btn-text`)),e.html=e.L(`${s}-further-message`)),r.initialConfig.text||(r.text=e.L(`${s}-only-this-btn-text`))),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:r,finalizerFn:n}=this;e.beginBatch(),t&&this.callback(t,r,[e]),e.endBatch(),n&&this.callback(n,r,[e]),this.confirmed=!0}processSingleRecord(){const{eventRecord:e,changerFn:t,thisObj:r,finalizerFn:n}=this;if(e.beginBatch(),e.isRecurring){let s;e.recurrence.forEachOccurrence(e.startDate,null,(a,l,o)=>{if(o>1)return s=a,!1}),s==null||s.convertToRealEvent()}e.recurrence=null,t&&this.callback(t,r,[e]),e.recurrenceRule=null,e.endBatch(),n&&this.callback(n,r,[e]),this.confirmed=!0}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}hide(){var e;super.hide(),(e=this.resolve)==null||e.call(this,this.confirmed),this.resolve=null}};y(Yd,"$name","RecurrenceConfirmationPopup"),y(Yd,"type","recurrenceconfirmation"),y(Yd,"configurable",{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:Yd},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}});var os=Yd;os.initClass(),os._$name="RecurrenceConfirmationPopup";var np=i=>{var e;return e=class extends(i||$){construct(t){super.construct(t),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(t,r){if(t)return os.reconfigure(r,os.mergeConfigs({owner:this},t),this)}findRecurringEventToConfirmDelete(t){return t.find(r=>r.supportsRecurring&&(r.isRecurring||r.isOccurrence))}onRecurrableAssignmentBeforeDelete({assignmentRecords:t,context:r}){const n=t.map(a=>a.event),s=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&s)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:s,changerFn(){r.finalize(!0)},cancelFn(){r.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecords:r}=t,n=r.filter(s=>s.supportsRecurring&&(s.isRecurring||s.isOccurrence));n.length&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:t}){if(this.enableRecurringEvents){const{eventRecord:r}=t;r.supportsRecurring&&(r.isRecurring||r.isOccurrence)&&(t.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}))}}onAssignmentChange({action:t,records:r,changes:n}){var s;if(!(t==="update"&&n.event&&n.resource&&Object.keys(n).length===2)&&t!=="dataset"&&Array.isArray(r))for(const a of r)(s=a.event)!=null&&s.isRecurring&&!a.event.isBatchUpdating&&a.event.removeOccurrences(this.eventStore)}getOccurrencesFor(t){return this.eventStore.getOccurrencesForTimeSpan(t,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(t,r=null,n=this){const s=this;if(!s.readOnly&&t.length){const a={finalize(o=!0){r&&r(o),o!==!1&&(t.some(d=>{var c;return d.isOccurrence||((c=d.event)==null?void 0:c.isOccurrence)})?t.forEach(d=>d.isOccurrenceAssignment?d.event.remove():d.remove()):(t[0].isAssignment?s.assignmentStore:s.eventStore).remove(t))}};let l;if(t[0].isAssignment?l=await s.trigger("beforeAssignmentDelete",{assignmentRecords:t,context:a}):l=await s.trigger("beforeEventDelete",{eventRecords:t,context:a}),l!==!1){const o=t.find(d=>d.isRecurring||d.isOccurrence);return o?(s.recurrenceConfirmationPopup.owner=n,await s.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:o,changerFn(){a.finalize(!0)},cancelFn(){a.finalize(!1)}})):(a.finalize(!0),!0)}}return!1}get widgetClass(){}},y(e,"$name","RecurringEvents"),y(e,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),e},rD=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}updateFillTicks(t){const r=this;if(!r.isConfiguring){const{timeAxis:n}=r;n.forceFullTicks=t&&r.snap,t&&(r.timeResolution={unit:n.mainUnit,increment:1}),r.refreshWithTransition(),r.trigger("stateChange")}}changeBarMargin(t){return T.assertNumber(t,"barMargin",!0),this._resourceMargin==null&&this.changeResourceMargin(t),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),t):t}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}changeResourceMargin(t){const r=this;return t==null&&(t=this.resourceMargin),typeof t=="number"?(r.isHorizontal&&r.rowHeight&&(t=Math.min(Math.floor(r.rowHeight/2),t)),r.resourceMarginObject={start:t,end:t,total:t*2},t):(t!=null&&t.start||(t.start=0),t!=null&&t.end||(t.end=0),r.isHorizontal&&r.rowHeight&&(t.start=r.rowHeight<t.start+t.end?Math.ceil(r.rowHeight/2):t.start,t.end=r.rowHeight<t.start+t.end?Math.ceil(r.rowHeight/2):t.end),r.resourceMarginObject=T.assign({total:t.start+t.end},t),t)}updateResourceMargin(){const t=this;t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition())}changeTickSize(t){return T.assertNumber(t,"tickSize",!0),t}updateTickSize(t){const r=this,{timeAxisViewModel:n}=r;let s=null,a,l=0;if(!r.isConfiguring&&r.isHorizontal){s=r.timelineScroller;const o=s.viewport.width/2+s.scrollLeft*(r.rtl?-1:1),d=r.getDateFromCoordinate(o);a=t-n.tickSize,l=r.timeAxis.getTickFromDate(d)}n.tickSize=t,s==null||s.scrollBy(l*a,0),r.trigger("tickSizeChange",{tickSize:t})}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","magenta","purple","violet","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","gantt-green","lime","yellow","orange","amber","deep-orange","light-gray","gray","black"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}updateEventStyle(t){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}updateEventColor(t){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}get widgetClass(){}},y(e,"$name","TimelineEventRendering"),y(e,"configurable",{barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null}),e},nD=new Date(-864e13),sD=new Date(864e13),KF=i=>{var e;return e=class extends(i||$){applyViewStartEndDates(t,r){const n=this,{visibleDate:s={}}=n,a=s==null?void 0:s.date,l=a?C.min(t,a):t!=null?t:new Date,o=a?r?C.max(r,a):C.add(l,n.visibleDateRange.endDate-n.visibleDateRange.startDate):r;return l&&o?(n.setTimeSpan(l,o,{...s,visibleDate:a}),!0):l?(n.startDate=l,!0):!1}onEventStoreDataRefresh(t){this._initialStartDateFilled==="pending"&&this.tryToApplyPreCommitStartEndDates(t.source)}tryToApplyPreCommitStartEndDates(t){var r,n;const s=this,a=s.project,l=(r=a.get("startDate"))!=null?r:a.replica?null:a.startDate;if(l)s.applyViewStartEndDates(l,(n=a.get("endDate"))!=null?n:a.replica?null:a.endDate),s._initialStartDateFilled="applied";else if(t.count>0){let o=sD,d=nD;t.forEach(c=>{const u=c.get("startDate"),h=c.get("endDate");u&&u<o&&(o=u),h&&h>d&&(d=h)}),s.applyViewStartEndDates(o.getTime()!==sD.getTime()?o:null,d.getTime()!==nD.getTime()?d:null),s._initialStartDateFilled="applied"}}bindEventStoreForEarlyPositioning(t){var r;const n=this,s=n.initialConfig;n._initialStartDateFilled===void 0&&!s.startDate&&!s.date&&!((r=s.timeAxis)!=null&&r.startDate)&&!s.visibleDate&&!s.partner&&(n._initialStartDateFilled="pending",n.tryToApplyPreCommitStartEndDates(t)),n.detachListeners("eventStoreDataRefresh"),t.ion({name:"eventStoreDataRefresh",refreshPreCommit:"onEventStoreDataRefresh",once:!0,thisObj:n})}get widgetClass(){}},y(e,"$name","TimelineEarlyPositioning"),e},XF={maintainVisibleStart:!0},ZF={block:"nearest"},aD=i=>{var e;return e=class extends(i||$).mixin(rp){onZoomToSpan({startDate:t}){this.infiniteScroll&&this.scrollToDate(t,{block:"start"})}calculateOptimalDateRange(t,r,n){if(this.infiniteScroll){if(this.zoomKeepsOriginalTimespan){const{startDate:s,endDate:a}=this.timeAxis;return{startDate:s,endDate:a}}return this.calculateInfiniteScrollingDateRange(t,!0)}return super.calculateOptimalDateRange(...arguments)}initScroll(){var t;const r=this,{isHorizontal:n,visibleDate:s}=r;super.initScroll();const{scrollable:a}=n?r.timeAxisSubGrid:r;if(a.ion({scroll:"onTimelineScroll",thisObj:r}),r.infiniteScroll)if((t=r.partneredWith)!=null&&t.values.some(l=>l.infiniteScroll)){const l=a.element.getBoundingClientRect()[r.isHorizontal?"width":"height"];r.timeAxisViewModel.update(l,!1,!0)}else{const l=s?{...s,visibleDate:s.date}:{visibleDate:r.viewportCenterDate,block:"center"},{startDate:o,endDate:d}=r.calculateInfiniteScrollingDateRange(l.visibleDate,l.block==="center");r.setTimeSpan(o,d,l)}}get timelineScroller(){const t=this;return t.scrollInitialized||t.initScroll(),t._timelineScroller||(t._timelineScroller=new JF({widget:t,scrollable:t.isHorizontal?t.timeAxisSubGrid.scrollable:t.scrollable,isHorizontal:t.isHorizontal}))}calculateInfiniteScrollingDateRange(t,r,n=this.timeAxisViewModel.viewPreset){const s=this,{timeAxisViewModel:a,bufferCoef:l}=s,{timeAxis:o,availableSpace:d}=a,c=Math.ceil(o.totalCount/o.count),{leafUnit:u,leafIncrement:h,topUnit:g,topIncrement:f,tickSize:m}=n,p=u===g&&Math.round(f)===f&&Math.round(h)===h,v=p?f:h,b=p?g:u;if(r){const w=Math.ceil((d*l+d/2)/m)*c,D=o.floorDate(C.add(t,-w*h,u),!1,b,v),S=o.ceilDate(C.add(t,w*h,u),!1,b,v),x=S-D,R=s.getMinDateOrDate(D);let M=s.getMaxDateOrDate(S);return M<=R&&(M=s.getMaxDateOrDate(C.add(R,x))),{startDate:R,endDate:M}}else{const w=Math.ceil(d*l/m)*c,D=C.add(t,-w*h,u),S=C.add(t,Math.ceil((d/m+w)*h),u),x=S-D,R=s.getMinDateOrDate(D);let M=s.getMaxDateOrDate(S);return M<=R&&(M=s.getMaxDateOrDate(C.add(R,x))),{startDate:o.floorDate(R,!1,b,v),endDate:o.ceilDate(M,!1,b,v)}}}doDestroy(){var t;(t=this._timelineScroller)==null||t.destroy(),super.doDestroy()}onTimelineScroll(){this.infiniteScroll&&this.checkTimeAxisScroll()}checkTimeAxisScroll(){const t=this,{minDate:r,maxDate:n}=t,{startDate:s,endDate:a}=t.timeAxis,l=t.timelineScroller,{position:o,clientSize:d}=l,c=d*t.bufferCoef,u=c*t.bufferThreshold,h=l.maxPosition,{style:g}=t.timeAxisSubGrid.virtualScrollerElement,f=o<u&&(!r||C.isAfter(s,r)),m=h-o<u&&(!n||C.isBefore(a,n));if(f||m){g.overflow="hidden",g.pointerEvents="none",g.paddingBottom=`${E.scrollBarWidth}px`,t.setTimeout(()=>{g.overflow="",g.paddingBottom="",g.pointerEvents=""},100);let p;f&&m?p=l.position+d/2:p=l.position,t.shiftToDate(t.getDateFromCoordinate(p,"floor",!0,!1,!0),f&&m)}}shiftToDate(t,r){const n=this.calculateInfiniteScrollingDateRange(t,r);this.setTimeSpan(n.startDate,n.endDate,r?r===!0?{visibleDate:this.viewportCenterDate,block:"center"}:r:XF)}updateInfiniteScroll(t){!this.isConfiguring&&t&&this.checkTimeAxisScroll()}async scrollToDate(t,r={}){const n=this;if(n.timeAxisSubGrid.width===0)return;const{timeAxis:s,visibleDateRange:a,infiniteScroll:l,minDate:o,maxDate:d}=n,{unit:c,increment:u}=s,h=r.edgeOffset||0,g=C.ceil(a.endDate,u+" "+c)-C.floor(a.startDate,u+" "+c),f=t>n.viewportCenterDate?1:-1,m=(l?g*n.bufferCoef*n.bufferThreshold:r.block==="center"?g/2:h?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*h:0)*f,p=new Date(t.getTime()+m),v=p>s.endDate?1:p<s.startDate?-1:0;if(n.isBeforeMinDate(t)||n.isAfterMaxDate(t))return t=o&&t<o?o:d,n.scrollToDate(t,r);v&&n.infiniteScroll&&(await n.nextAnimationFrame(),n.shiftToDate(new Date(t-m),null,!0),await n.nextAnimationFrame());const b=n.timelineScroller.viewport,w=n.getCoordinateFromDate(t,!0),D=Math.min(n.timeAxisViewModel.tickSize,n.timeAxisViewModel.availableSpace),S=n.isHorizontal?new L(n.getCoordinateFromDate(t,!1)-(n.rtl?D:0),b.y,D,b.height):new L(b.x,n.getCoordinateFromDate(t,!1),b.width,n.timeAxisViewModel.tickSize);await n.scrollToCoordinate(w,S,t,r)}scrollToNow(t={}){return this.scrollToDate(new Date,t)}async scrollToCoordinate(t,r,n,s={}){const a=this,{startDate:l,endDate:o,hasTimelineBoundaries:d,minDate:c,maxDate:u}=a,{isContinuous:h,unit:g,increment:f}=a.timeAxis;if(t<0||h&&(n<l||n>o)){const m=o-l;let p=C.floor(new Date(n.getTime()-m/2),f+" "+g),v=C.add(p,m);if(d)if(!a.isBeforeMinDate(n)&&!a.isAfterMaxDate(n))a.isBeforeMinDate(p)?(p=c,v=C.add(p,m)):a.isAfterMaxDate(v)&&(v=u,p=C.add(v,-m));else return n=c&&n<c?c:u,a.scrollToDate(n,s);return p-l!==0&&v-o!==0?(await a.setTimeSpan(p,v),a.scrollToDate(n,s)):void 0}return await a.timelineScroller.scrollIntoView(r,s),!a.isDestroyed&&a.nextAnimationFrame()}set scrollLeft(t){this.timeAxisSubGrid.scrollable.element.scrollLeft=t}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(t){this.timeAxisSubGrid.scrollable.x=t}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(t){this.scrollable.y=t}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(t,r=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,r)}scrollVerticallyTo(t,r=!0){return this.scrollable.scrollTo(null,t,r)}scrollTo(t,r=!0){return this.timeAxisSubGrid.scrollable.scrollTo(t,null,r)}get widgetClass(){}},y(e,"$name","TimelineScroll"),y(e,"configurable",{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}),e},JF=class extends At{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(i){super.onScroll(i),this._position=null}syncPartners(i){this.scrollable.syncPartners(i)}updatePosition(i){this.scrollable[this.isHorizontal?"x":"y"]=i}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(i,e){return this.isHorizontal?this.scrollable.scrollTo(i,null,e):this.scrollable.scrollTo(null,i,e)}scrollBy(i=0,e=0,t=ZF){return this.isHorizontal?this.scrollable.scrollBy(i||e,0,t):this.scrollable.scrollBy(0,e||i,t)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(i){this.position=i}changeY(i){this.position=i}get x(){return this.position}set x(i){this.scrollable[this.isHorizontal?"x":"y"]=i}get y(){return this.position}set y(i){this.scroller[this.isHorizontal?"x":"y"]=i}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}},QF=["barMargin"],lD=i=>{var e;return e=class extends(i||$){getState(){const t=this,r=T.copyProperties(super.getState(),t,QF);return r.zoomLevel=t.zoomLevel,r.zoomLevelOptions={startDate:t.startDate,endDate:t.endDate,centerDate:!t.infiniteScroll||t.timeAxisViewModel.availableSpace?t.viewportCenterDate:void 0,width:t.tickSize},r}applyState(t){var r;const n=this;t=Object.assign({},t),n.suspendRefresh(),t.zoomLevel!=null&&(delete t.startDate,delete t.endDate,n.timeAxis.suspendEvents());const{zoomLevel:s,zoomLevelOptions:a}=t;delete t.zoomLevel,delete t.zoomLevelOptions,super.applyState(t),s!=null&&(n.timeAxis.resumeEvents(),n.infiniteScroll&&((r=t==null?void 0:t.scroll)!=null&&r.scrollLeft)&&(t.scroll.scrollLeft={}),n.whenVisible(()=>n.zoomToLevel(s,a))),n.resumeRefresh(!0,!1)}get widgetClass(){}},y(e,"$name","TimelineState"),e},sp=class extends ss{refreshContent(){var i;(i=this.headersElement)!=null&&i.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}};y(sp,"$name","SchedulerHeader"),sp._$name="Header";var qd=class extends qt{static get configurable(){return{sealedColumns:!0,headerClass:sp}}startConfigure(i){const{grid:e}=i;e.timeAxisSubGrid=this,super.startConfigure(i),i.header={cls:{"b-sticky-headers":e.stickyHeaders}},delete i.headerClass,"flex"in i||"width"in i||(i.flex=1)}changeScrollable(){const i=this,e=super.changeScrollable(...arguments);return e&&Object.defineProperty(e,"scrollWidth",{get(){var t,r;return(r=(t=this.element)==null?void 0:t.scrollWidth)!=null?r:0},set(){i.positionDirty=!0,i.grid.updateCanvasSize()}}),e}handleHorizontalScroll(i=!0){this.grid._viewPresetChanging||super.handleHorizontalScroll(i)}onInternalResize(i,e,t,r,n){const s=this;if(super.onInternalResize(...arguments),s.isPainted&&e!==r){const a=s.grid,l=a._bodyRectangle.height,o=s.monitorResize&&E.scrollBarWidth&&e<r;o&&(s.monitorResize=!1),a.onSchedulerViewportResize(e,l,r,l),o&&s.queueMicrotask(()=>s.monitorResize=!0)}}get headerScrollWidth(){return this.grid.isVertical?super.headerScrollWidth:this.grid.timeAxisViewModel.totalSize}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(i=!1,e=!1){const{owner:t}=this;await super.expand(i,e),t.isPainted&&t.timeAxisViewModel.update(this.width,!1,!0)}};y(qd,"$name","TimeAxisSubGrid"),y(qd,"type","timeaxissubgrid"),qd.initClass(),qd._$name="TimeAxisSubGrid";var oD=(i,e,t)=>e==null?t==null||i<t:t==null?i>=e:e<t?e<=i&&i<t:i<t||e<=i,eI=(i,e)=>oD(i.getDay(),e.fromDay,e.toDay)&&oD(i.getHours(),e.fromHour,e.toHour),ap={},sr=class extends Xr.mixin(eD,tD,rD,KF,rp,aD,lD,iD,np){constructor(){super(...arguments),y(this,"timeCellSelector",null)}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}updateTimeZone(i){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=i)}get timeZone(){var i;return(i=this.project)==null?void 0:i.timeZone}get hasTimelineBoundaries(){return!!(this.minDate||this.maxDate)}populateEventMenu(){}populateScheduleMenu(){}internalOnVisibleDateRangeChange(i){if(!this.handlingVisibleDateRangeChange){const e=this,{_visibleDateRange:t}=e;(!t||t.startDate-i.startDate||t.endDate-i.endDate)&&(e.timeView.range=i,e.handlingVisibleDateRangeChange=!0,e.trigger("visibleDateRangeChange",{old:t,new:i}),e.handlingVisibleDateRangeChange=!1,e._visibleDateRange=i)}}onVisibleResourceRangeChange(){}onVisibleResourceColumnChange(){}construct(i={}){const e=this;super.construct(i),e.$firstVerticalOverflow=!0,e.initDomEvents(),e.currentOrientation.init(),e.rowManager.ion({refresh:()=>{e.forceLayout=!1}})}createSubGrid(i,e={}){const t=this,{stickyHeaders:r}=t;return i===(t.schedulerRegion||"normal")?e.type="timeaxissubgrid":i==="locked"&&r&&t.isVertical&&(e.scrollable={overflowX:"visible",overflowY:"visible"},"resizable"in e||(e.resizable=!1),t.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(i,e)}doDestroy(){const i=this,{partneredWith:e,currentOrientation:t}=i;if(t==null||t.destroy(),i._bodyContainer&&Ge.removeResizeListener(i._bodyContainer,i.onBodyResize),e){for(let r=e.count-1;r>-1;--r){const n=e.getAt(r);i.removePartner(n)}e.destroy()}else i.timeAxisViewModel.destroy(),i.timeAxis.destroy();super.doDestroy()}startConfigure(i){const e=this;super.startConfigure(i),e.onBodyResize=e.onBodyResize.bind(e),e._bodyContainer&&Ge.addResizeListener(e._bodyContainer,e.onBodyResize),e.getConfig("partner")}onInternalPaint({firstPaint:i}){var e,t;if(i){const r=this,n=r.isHorizontal?r.timeAxisSubGrid.scrollable:r.scrollable,s=n.element.getBoundingClientRect()[r.isHorizontal?"width":"height"];r.timeAxisViewModel.update(s,r.infiniteScroll,!0),r.infiniteScroll&&((t=(e=r.currentOrientation).doUpdateTimeView)==null||t.call(e)),r.getConfig("hideRowHover")}super.onInternalPaint(...arguments)}onSchedulerHorizontalScroll(i,e,t,r){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(i,e,t,r)}initScroll(){const i=this;let e=0;super.initScroll(),i.ion({horizontalScroll:({subGrid:t,scrollLeft:r,scrollX:n,scrollingToCenter:s})=>{i.isPainted&&t===i.timeAxisSubGrid&&!i.isDestroying&&!i.refreshSuspended&&i.onSchedulerHorizontalScroll(t,r,n,s),e++}}),i.testPerformance==="horizontal"&&i.setTimeout(()=>{const t=performance.now();let r=5,n=1;const s=i.setInterval(()=>{if(r=r+5,i.scrollX+=(10+Math.floor(r))*n,n===1&&i.scrollX>5500&&(n=-1,r=5),n===-1&&i.scrollX<=0){const o=(performance.now()-t)/e,d=Math.round(1e3/o*10)/10;clearInterval(s),console.log(i.eventPositionMode,i.eventScrollMode,d+"fps")}},0)},500)}preserveViewCenter(i,e=this,...t){const r=this,n=r.viewportCenterDate,s=i.apply(e,t),a=r.timelineScroller,{clientSize:l}=a,o=Math.max(Math.floor(r.getCoordinateFromDate(n,!0)-l/2),0);return a.scrollTo(o,{scrollingToCenter:!0}),s}setTimeSpan(i,e,t=ap){const r=this,{timeAxis:n}=r,{preventThrow:s=!1,maintainVisibleStart:a=!1,visibleDate:l}=t,{startDate:o,endDate:d}=n.getAdjustedDates(i,e),c=n.startDate-o!==0,u=n.endDate-d!==0;if(c||u){if(a){const{timeAxisViewModel:g}=r,{totalSize:f}=g,m=g.tickSize,p=r.timelineScroller,v=p.position,b=g.getDateFromPosition(v);b>=o&&b<d&&g.ion({update(){const w=g.tickSize!==m;r.updateCanvasSize(),c&&!u&&!w?p.position+=g.totalSize-f:!c&&!w?p.position=v:p.position=g.getPositionFromDate(b),p.syncPartners(!0)},prio:1e4,once:!0})}r.lastViewPresetOptions&&(r.lastViewPresetOptions={startDate:o,endDate:d});const h=n.reconfigure({startDate:o,endDate:d},!1,s);return l?r.scrollToDate(l,t).then(()=>h):h}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(i=>this.timeAxis.isTimeSpanInAxis(i))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=O.capitalize(this.scheduledEventName)),this._capitalizedEventName}updatePartner(i){i&&this.addPartner(i)}addPartner(i){const e=this;if(!e.isPartneredWith(i)){e._partner==null&&(e._partner=i),(e.partneredWith||(e.partneredWith=new Bt)).add(i),(i.partneredWith||(i.partneredWith=new Bt)).add(e),e.getConfig("viewPreset"),e.getConfig("infiniteScroll"),i.ion({presetchange:"onPartnerPresetChange",thisObj:e});const r=e.partnerSharedConfigs.reduce((n,s)=>(n[s]=i[s],n),{});r.viewPreset.options={scrollPosition:i.timelineScroller.position,tickSize:i.tickSize},e._ownTimeAxis=e.timeAxis,e._ownTimeAxisViewModel=e.timeAxisViewModel,e.setConfig(r),e.ion({presetchange:"onPartnerPresetChange",thisObj:i}),e.isPainted?(i.scrollable.addPartner(e.scrollable,e.isHorizontal?"x":"y"),i.syncPartnerSubGrids()):e.initScroll=be.createSequence(e.initScroll,()=>{i.scrollable.addPartner(e.scrollable,e.isHorizontal?"x":"y"),i.syncPartnerSubGrids()},e)}}removePartner(i){const e=this,{partneredWith:t,timeAxis:r}=e;if(e.isPartneredWith(i)){e._partner===i&&(e._partner=null),t.remove(i),e.scrollable.removePartner(i.scrollable),e.un({presetchange:"onPartnerPresetChange",thisObj:i});const{scrollLeft:n,scrollTop:s}=i;if(i.removePartner(e,!0),r.owner!==e&&!e.isDestroying){e.timeAxis={...i.timeAxis.getCurrentConfig({skip:{owner:1}}),owner:e};const a=i.timeAxisViewModel.getCurrentConfig({skip:{owner:1,timeAxis:1,internalListeners:1}});e.timeAxisViewModel={...a,owner:e,timeAxis:e.timeAxis},e.scrollLeft=n,e.scrollTop=s,e.timeAxisViewModel.update(e.timeAxisSubGridElement.getBoundingClientRect()[e.isHorizontal?"width":"height"])}}}isPartneredWith(i){var e;return!!((e=this.partneredWith)!=null&&e.includes(i))}onPartnerPresetChange({preset:i,startDate:e,endDate:t,centerDate:r,zoomDate:n,zoomPosition:s,zoomLevel:a}){!this._viewPresetChanging&&this.viewPreset!==i&&(i.options={startDate:e,endDate:t,centerDate:r,zoomDate:n,zoomPosition:s,zoomLevel:a},this.viewPreset=i)}get partners(){const i=this.partner?[this.partner]:[];return this.partneredWith&&i.push.apply(i,this.partneredWith.allValues),[...new Set(i)]}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}async show(){await super.show(...arguments),this.partner&&this.partner.eachSubGrid(i=>i.scrollable.syncPartners())}changeColumns(i,e){const t=this;let r,{timeAxisColumnConfig:n}=t;if(i){const s=Array.isArray(i);let a=i;s||(a=i.data),r=a&&a.length,a.some((l,o)=>l.type==="timeAxis"?(r=o,n=T.assign(l,t.timeAxisColumn),!0):!1),t.isVertical?(a=[T.assign({type:"verticalTimeAxis"},t.verticalTimeAxisColumn),a[r]],r=1):a=a.slice(),a[r]=this._timeAxisColumn||T.assign({type:"timeAxis",cellCls:t.timeCellCls,mode:t.mode},n),s||i.isStore&&i.owner!==this?i=a:i.data=a}return super.changeColumns(i,e)}updateColumns(i,e){if(super.updateColumns(i,e),i){const t=this,r=t._timeAxisColumn=t.columns.find(n=>n.isTimeAxisColumn);t.isVertical&&(t.verticalTimeAxisColumn=t.columns.find(n=>n.isVerticalTimeAxisColumn),t.verticalTimeAxisColumn.relayAll(t)),r.relayAll(t)}}onColumnsChanged({action:i,changes:e,record:t,records:r}){var n;const{timeAxisColumn:s,columns:a}=this;(i==="dataset"||i==="batch")&&!a.includes(s)?a.add(s,!0):t===s&&"width"in e&&this.updateCanvasSize(),t&&((n=this.partneredWith)==null||n.forEach(l=>{const o=l.columns.getAt(t.allIndex);if(o!=null&&o.shouldSync(t)){const d={};for(const c in e)d[c]=e[c].value;o.set(d)}})),super.onColumnsChanged(...arguments)}get timeView(){var i,e;const t=this;return t.columns&&t.isVertical?(i=t.verticalTimeAxisColumn)==null?void 0:i.view:(e=t.timeAxisColumn)==null?void 0:e.timeAxisView}updateEventCls(i){const e=this;e.eventSelector||(e.unreleasedEventSelector=e.eventSelector=`.${i}-wrap`),e.eventInnerSelector||(e.eventInnerSelector=`.${i}`)}set timeAxisViewModel(i){var e;const t=this,r=t._timeAxisViewModel,n={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.isConfiguring&&t.initialConfig.partner&&(i=t.initialConfig.partner.timeAxisViewModel),!(r&&r===i)&&((r==null?void 0:r.owner)===t&&r.destroy(),t.detachListeners("timeAxisViewModel"),i!=null&&i.isTimeAxisViewModel?i.ion(n):i=ip.new({mode:t._mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,suppressFit:t.suppressFit,internalListeners:n,owner:t},i),t._timeAxisViewModel=i,t.isHorizontal&&t.timeAxisColumn?t.timeAxisColumn.timeAxisViewModel=i:t.isVertical&&((e=t.verticalTimeAxisColumn)!=null&&e.view)&&(t.verticalTimeAxisColumn.view.model=i),t.relayEvents(i,["update"],"timeAxisViewModel"),r&&i&&t.trigger("timeAxisViewModelChange",{timeAxisViewModel:i}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var i,e;return(e=(i=this._timeAxisViewModel)==null?void 0:i.suppressFit)!=null?e:this._suppressFit}set suppressFit(i){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=i:this._suppressFit=i}set timeAxis(i){const e=this,t=e._timeAxis,r={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:e};e._partner&&!i||t&&t===i||(t&&t.owner===e&&t.destroy(),e.detachListeners("timeAxis"),i!=null&&i.isTimeAxis||(i=T.assign({owner:e,viewPreset:e.viewPreset,autoAdjust:e.autoAdjustTimeAxis,weekStartDay:e.weekStartDay,forceFullTicks:e.fillTicks&&e.snap},i),e.startDate&&(i.startDate=e.startDate),e.endDate&&(i.endDate=e.endDate),e.workingTime&&e.applyWorkingTime(i),i=new tp(i)),i.ion(r),e._timeAxis=i)}onTimeAxisReconfigure({config:i,oldConfig:e}){i&&(!e||e.startDate-i.startDate||e.endDate-i.endDate)&&this.trigger("dateRangeChange",{old:{startDate:e.startDate,endDate:e.endDate},new:{startDate:i.startDate,endDate:i.endDate}}),this.trigger("timeAxisChange",{config:i})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(i){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=i)}set workingTime(i){this._workingTime=i,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(i){var e;const t=this,r=t._workingTime;if(r){let n=null;r.fromHour>=0&&r.fromHour<24&&r.toHour>r.fromHour&&r.toHour<=24&&r.toHour-r.fromHour<24&&(n={from:r.fromHour,to:r.toHour});let s=null;r.fromDay>=0&&r.fromDay<7&&r.toDay>r.fromDay&&r.toDay<=7&&r.toDay-r.fromDay<7&&(s={from:r.fromDay,to:r.toDay}),n||s?i.include={hour:n,day:s}:i.include=null}else i.include=null;t.isPainted&&(t.timeAxisColumn.refreshHeader(),(e=t.features.columnLines)==null||e.refresh(),t.refreshWithTransition())}changeMinDate(i){return typeof i=="string"?i=C.parse(i):C.isDate(i)||(i=null),i}updateMinDate(i){i&&C.isBefore(this.startDate,i)&&this.setStartDate(i,!1)}isBeforeMinDate(i){return this.minDate&&C.isBefore(i,this.minDate)}getMinDateOrDate(i){return this.minDate?C.max(this.minDate,i):i}changeMaxDate(i){return typeof i=="string"?i=C.parse(i):C.isDate(i)?this.isBeforeMinDate(i)&&(i=null):i=null,i}updateMaxDate(i){i&&C.isBefore(i,this.endDate)&&this.setEndDate(i,!1)}isAfterMaxDate(i){return this.maxDate&&C.isBefore(this.maxDate,i)}getMaxDateOrDate(i){return this.maxDate?C.min(this.maxDate,i):i}changeStartDate(i){return typeof i=="string"&&(i=C.parse(i)),i}updateStartDate(i){this.setStartDate(i)}setStartDate(i,e=!0){const t=this,r=t._timeAxis,{startDate:n,endDate:s,mainUnit:a}=r||ap;if(typeof i=="string"&&(i=C.parse(i)),i=t.getMinDateOrDate(i),r&&s){if(i){let l=s;if(e&&n){const o=C.diff(n,s,a,!0);l=C.add(i,o,a)}t.setTimeSpan(i,l)}}else t._tempStartDate=i}get startDate(){var i;const e=this,{range:t,workingTime:r}=e;let n=((i=e._timeAxis)==null?void 0:i.startDate)||e._tempStartDate;if(!n){if(n=C.floor(e.peekConfig("date")||new Date,t),e.calendar&&(e._tempEndDate=C.add(n,t)),r)for(;!eI(n,r);)n.setHours(n.getHours()+1);e._tempStartDate=n}return n}changeEndDate(i){this.setEndDate(i)}setEndDate(i,e=!1){const t=this,r=t._timeAxis,{startDate:n,endDate:s,mainUnit:a}=r||ap;if(typeof i=="string"&&(i=C.parse(i)),i=t.getMaxDateOrDate(i),r&&n){if(i){let l=n;if(e&&s){const o=C.diff(n,s,a,!0);l=C.add(i,-o,a)}t.setTimeSpan(l,i)}}else t._tempEndDate=i}get endDate(){const i=this;return i._timeAxis?i._timeAxis.endDate:i._tempEndDate||C.add(i.startDate,i.viewPreset.defaultSpan,i.viewPreset.mainHeader.unit)}changeVisibleDate(i){if(typeof i=="string")return this.changeVisibleDate({date:i});if(i instanceof Date)return{date:i,block:this.isConfiguring?"start":"nearest"};if(i instanceof Object)return{...i,date:typeof i.date=="string"?C.parse(i.date):i.date,block:i.block||(this.isConfiguring?"start":"nearest")}}updateVisibleDate(i){const e=this;e.infiniteScroll&&e.isConfiguring||(e.isPainted?e.scrollToDate(i.date,i):e.visibleDateProcessed||(e.whenVisible(()=>e.updateVisibleDate(e.visibleDate)),e.visibleDateProcessed=!0))}get features(){return super.features}set features(i){i=i===!0?{}:i,"regionResize"in i||(i.regionResize=!0),super.features=i}onLocaleChange(){super.onLocaleChange();const i=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=i}onBodyResize(i,e,{width:t,height:r}){this.isVertical&&e&&t!==e.width&&delete this.timeAxisSubGrid._width;const n=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&e&&r!==e.height&&this.onSchedulerViewportResize(n,r,n,e.height)}onSchedulerViewportResize(i,e,t,r){if(this.isPainted){const n=this,{isHorizontal:s,partneredWith:a}=n;n.currentOrientation.onViewportResize(i,e,t,r),n.updateViewModelAvailableSpace(s?i:Math.floor(e)),a&&!n.isSyncingFromPartner&&n.syncPartnerSubGrids(),n.trigger("timelineViewportResize",{width:i,height:e,oldWidth:t,oldHeight:r})}}updateViewModelAvailableSpace(i){this.timeAxisViewModel.availableSpace=i}onTimeAxisViewModelUpdate(){!this._viewPresetChanging&&this.timeAxisSubGrid&&!this.timeAxisSubGrid.collapsed&&(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(i=>{i.isSyncingFromPartner||(i.isSyncingFromPartner=!0,this.eachSubGrid(e=>{const t=i.subGrids[e.region];if(t.width!==e.width)if(e.flex)e.flex!==t.flex&&(t.flex=e.flex);else if(t.hasCalculatedWidth&&e.hasCalculatedWidth){const r=Math.max(t.totalFixedWidth,e.totalFixedWidth);t.width=e.width=r,t.hasCalculatedWidth=e.hasCalculatedWidth=!0}else t.width=e.width}),i.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const i=this;if(!i._svgCanvas){const e=i._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("id",Si.generateId("svg")),e.classList.add("b-sch-canvas","b-sch-dependencies-canvas"),e.retainElement=!0,i.timeAxisSubGridElement.appendChild(e),i.trigger("svgCanvasCreated",{svg:e})}return i._svgCanvas}get timeAxisSubGridElement(){var i;return this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=(i=this.timeAxisColumn)==null?void 0:i.subGridElement),this._timeAxisSubGridElement}updateCanvasSize(){const i=this;let e=!1;if(i.isVertical){const{totalSize:t}=i.timeAxisViewModel;i.isPainted&&i.refreshTotalHeight(t+i._rowBorderHeight,!0),i.suppressFit&&E.setLength(i.foregroundCanvas,"height",t),e=!0}return e}getHeaderDomConfigs(i){}getForegroundDomConfigs(i){}async onStoreDataChange({action:i}){var e;const t=this;t.isVisible?(i==="dataset"&&((e=t.project)!=null&&e.isRepopulatingStores)&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(i=!0){const e=this;e.isPainted&&!e.refreshSuspended&&(e.isVertical||e.hasVisibleEvents||e.timeAxisSubGridElement.querySelector(e.eventSelector)?!e.project||e.isEngineReady?e.refreshRows(null,!1,i):(e.refreshAfterProjectRefresh=!0,e.currentOrientation.refreshAllWhenReady=!0):e.rowManager.trigger("refresh"))}render(){const i=this,{total:e}=i.resourceMarginObject,t=i.timeAxisSubGridElement,r=i._foregroundCanvas=E.createElement({className:"b-sch-canvas b-sch-foreground-canvas",style:`font-size:${i.rowHeight-e}px`,parent:t});i.canvases={event:r},i.timeAxisSubGrid.insertRowsBefore=r,i.isVertical&&i.suppressFit&&i.updateCanvasSize(),super.render(...arguments)}refreshRows(i=null,e=!1,t=!0){const r=this;r.isConfiguring||(r.currentOrientation.refreshRows(i,t),super.refreshRows(i,e))}updateHideHeaders(i){const e=this,t=e.isPainted?e.scrollLeft:0;super.updateHideHeaders(i),e.isPainted&&(i||e.timeAxisColumn.refreshHeader(null,!0),e.nextAnimationFrame().then(()=>e.scrollLeft=t))}updateHideRowHover(i){this.timeAxisSubGridElement.classList.toggle("b-hide-row-hover",i)}getCellDataFromEvent(i,e){if(!i.target.closest(".b-verticaltimeaxis-cell"))return e&&(e=!i.target.closest(".b-sch-foreground-canvas")),super.getCellDataFromEvent(i,e)}onCellNavigate(i,e,t){var r,n;const s=t.target;(r=t.cell)!=null&&r.classList.contains("b-timeaxis-cell")&&!((n=le.currentMouseDown)!=null&&n.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),(!(s!=null&&s.matches(this.eventSelector))||this.selectResourceOnEventNavigate!==!1)&&(!(s!=null&&s.matches(".b-timeaxis-cell"))||this.selectResourceOnScheduleClick!==!1)&&super.onCellNavigate(...arguments)}async waitForAnimations(){!this.isEngineReady&&this.project&&await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(i,e=!0){const t=this;!t.refreshSuspended&&t.isPainted&&(t.rowManager.topRow?t.runWithTransition(()=>t.refresh(i),e):t.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...i){return super.isRowNumberSelecting(...i)||i.some(e=>{var t;return e.column?e.column.isTimeAxisColumn:(t=e.cell)==null?void 0:t.closest(".b-timeaxis-cell")})}formatDuration(i,e=this.durationDisplayPrecision){const t=Math.pow(10,e);return Math.round(i*t)/t}beginListeningForBatchedUpdates(){var i;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,(i=this.syncSplits)==null||i.call(this,e=>e.beginListeningForBatchedUpdates())}endListeningForBatchedUpdates(){var i;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),(i=this.syncSplits)==null||i.call(this,e=>e.endListeningForBatchedUpdates())}onConnectedCallback(i,e){i&&!e&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(i){const e=this,{isConfiguring:t}=e;let r;t||(r=e.visibleDateRange),super.updateRtl(i),t||(e.currentOrientation.clearAll(),e.infiniteScroll?(e.shiftToDate(r.startDate),e.scrollToDate(r.startDate,{block:"start"})):e.timelineScroller.position+=.5)}applyStartEndParameters(i){const e=this,t=e.eventStore.modelClass.fieldMap.startDate;e.passStartEndParameters&&(i[e.startParamName]=t.print(e.startDate),i[e.endParamName]=t.print(e.endDate))}intersectsVisibleTimeSpan(i){return this.timeAxis.isTimeSpanInAxis(i)}highlightEvents({events:i,scroll:e=!0,unhighlightOnClick:t=!0,unhighlightOthers:r=!1}){var n,s,a,l;const o=this,{viewportCenterDate:d,rowManager:c}=o,u=(n=o._highlightedAssignments)!=null?n:o._highlightedAssignments=[],h=o.internalGetAssignmentsToHighlight(i);let g,f,m;if(e&&h.length>1){const p=o.getMilliSecondsPerPixelForZoomLevel(o.viewPreset),{y:v,height:b}=o._bodyRectangle,w=v+b/2,D=(a=(s=c.getRowAt(w))!=null?s:c.bottomRow)==null?void 0:a.top;m=S=>{const x=S.isTask?S:S.event,R=S.isTask?S:S.resource,M=d>x.endDate?d-x.endDate:x.startDate-d,_=M/p,k=o.mode==="vertical"?o.variableColumnWidths?R.instanceMeta(o).insetStart:o.currentOrientation.allResourceRecords.indexOf(R)*o.resourceColumnWidth:c.getRecordCoords(R).y,F=Math.abs(D-k);return Math.sqrt(_*_+F*F)}}r&&u.length&&o.unhighlightEvents({events:[...u]}),h.forEach(p=>{u.includes(p)||(u.push(p),o.currentOrientation.toggleCls(p,"b-highlighted",!0),p.instanceMeta(o).isHighlighted=!0);let v;e&&o.store.includes(p.isTask?p:p.resource)&&(m?((v=m(p))<f||f==null)&&(f=v,g=p):g=p)}),o.timeAxisSubGridElement.classList.toggle("b-is-highlighting",!0),g&&o[`scroll${o.isGantt?"Task":"Assignment"}IntoView`](g,e!==!0?e:void 0),t&&!o._highlightEventsListener&&(o._highlightEventsListener=V.on({element:globalThis,autoDetach:!0,thisObj:o,pointerdown:o.unhighlightEvents})),(l=this.syncSplits)==null||l.call(this,p=>p.highlightEvents({...arguments[0],unhighlightOnClick:!1}))}unhighlightEvents(i){var e;const t=this,{_highlightedAssignments:r}=t;let n=i==null?void 0:i.events;if(i instanceof Event){const{target:s}=i;if(s.closest(".b-virtual-scroller")||t.bodyContainer===s&&t.scrollable.hasOverflowY&&(i.offsetX>s.clientWidth||!E.scrollBarWidth&&i.offsetX>s.clientWidth-15))return;n=null}if(r!=null&&r.length){const s=n&&t.internalGetAssignmentsToHighlight(n);for(let a=r.length-1;a>=0;a--){const l=r[a];(!s||s.includes(l))&&(t.currentOrientation.toggleCls(l,"b-highlighted",!1),l.instanceMeta(t).isHighlighted=!1,r.splice(a,1))}}r!=null&&r.length||t.timeAxisSubGridElement.classList.toggle("b-is-highlighting",!1),t._highlightEventsListener&&(t._highlightEventsListener(),t._highlightEventsListener=null),(e=this.syncSplits)==null||e.call(this,s=>s.unhighlightEvents(i))}};y(sr,"$name","TimelineBase"),y(sr,"type","timelinebase"),y(sr,"configurable",{animateTreeNodeToggle:!1,partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset","infiniteScroll"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},minDate:null,maxDate:null,partner:null,stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null,hideRowHover:{$config:"lazy",value:!0}}),sr.initClass(),re.setVersion("scheduler","6.2.2"),sr._$name="TimelineBase";var dD=i=>{var e;return e=class extends(i||$){get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,id:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:r,value:n}){super.onRecordIdChange({record:t,oldValue:r,value:n}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:r}){return this.query(n=>this.eventStore.isDateRangeAvailable(t,r,null,n))}},y(e,"$name","ResourceStoreMixin"),e},ar=i=>{var e;return e=class extends(i||$){},y(e,"$name","PartOfProject"),e},cD=i=>{var e;return e=class extends i{static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string"},"eventColor","eventStyle","imageUrl","image","resourceMargin",{name:"barMargin",type:"number"},"eventLayout",{name:"allowOverlap",type:"boolean"},{name:"showAvatar",type:"boolean"}]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,r)=>(r.event&&t.push(r.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){this.assignmentStore.remove(this.assignments),t.forEach(r=>{r.resource=this})}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const r=t.split(" "),n=r[0][0],s=r.length>1?r[r.length-1][0]:"";return n+s}isWorkingTime(t){var r,n;const s=this.effectiveCalendar||((r=this.project)==null?void 0:r.calendar);return!s||((n=s.isWorkingTime)==null?void 0:n.call(s,t))}getEventStartingAfter(t){let r=Number.MAX_VALUE,n;return this.events.forEach(s=>{s.isScheduled&&s.startDate>=t&&s.startDate<r&&(n=s,r=s.startDate)}),n}getEventEndingBefore(t){let r=0,n;return this.events.forEach(s=>{s.isScheduled&&s.endDate<=t&&s.endDate>r&&(n=s,r=s.endDate)}),n}get eventColor(){var t;return this.get("eventColor")||((t=this.parent)==null?void 0:t.eventColor)}set eventColor(t){return this.set("eventColor",t)}},y(e,"$name","ResourceModelMixin"),e};function uD(i){const e=[],t=[];let r;const n=function*(){for(r||(r=i[Symbol.iterator]());e.length&&(yield*e,e.length=0),!!r;){const{value:a,done:l}=r.next();if(l){r=null,i=null;break}t.push(a),yield a}},s=function*(){for(r||(r=i[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!r;){const{value:a,done:l}=r.next();if(l){r=null,i=null;break}e.push(a),yield a}};return[n(),s()]}function*tI(i,e){if(e<0)throw new Error("Batch size needs to a natural number");e=e|0;const t=[];for(const r of i)t.length===e&&(yield t,t.length=0),t.push(r);t.length>0&&(yield t)}function*iI(i,e){let t=0;for(const r of i)e(r,t++)&&(yield r)}function*rI(i,e){let t=0;for(const r of i)++t>e&&(yield r)}function nI(i,e){let t=0;for(const r of i)if(!e(r,t++))return!1;return!0}function sI(i,e){let t=0;for(const r of i)if(e(r,t++))return!0;return!1}function*aI(i,e){let t=0;for(const r of i)yield e(r,t++)}function lI(i,e,t){let r=0,n=t;for(const s of i)n=e(n,s,r++);return n}function*oI(i){const e=new Set;for(const t of i)e.has(t)||(e.add(t),yield t)}function*dI(i,e){const t=new Set;for(const r of i){const n=e(r);t.has(n)||(t.add(n),yield r)}}function*cI(i,e){let t=0;for(const r of i)if(e(r,t++))yield r;else return}function*uI(i){for(const e of i)yield*e}var lp=class Fg{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new Fg(e)}copy(){const[e,t]=uD(this.iterable);return this.iterable=t,new Fg(e)}split(){const[e,t]=uD(this.iterable);return[new Fg(e),this.derive(t)]}inBatchesBySize(e){return this.derive(tI(this.iterable,e))}filter(e){return this.derive(iI(this.iterable,e))}drop(e){return this.derive(rI(this.iterable,e))}map(e){return this.derive(aI(this.iterable,e))}reduce(e,t){return lI(this,e,t)}concat(){return this.derive(uI(this.iterable))}uniqueOnly(){return this.derive(oI(this.iterable))}uniqueOnlyBy(e){return this.derive(dI(this.iterable,e))}every(e){return nI(this,e)}some(e){return sI(this,e)}takeWhile(e){return this.derive(cI(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new hD(this)}},hI=i=>new lp(i),Jr=hI,hD=class extends lp{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(i){this.$iterable=i}get iterable(){return this}derive(i){return new lp(i)}*[Symbol.iterator](){const i=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let e=this.$iterator,t=i.length;for(t>0&&(yield*i);;){if(i.length>t){for(let s=t;s<i.length;s++)yield i[s];t=i.length}if(!e)break;const{value:r,done:n}=e.next();n?(e=this.$iterator=null,this.$iterable=null):(i.push(r),t++,yield r)}}else yield*i}},gI=i=>new hD(i),gD=gI,Ih=Symbol("MixinIdentity"),Kd=Symbol("MixinStateProperty"),fI=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=gD(this.linearizedByTopoLevels())}static new(i){const e=new this;return i&&Object.assign(e,i),e}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((i,e)=>i-e)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(i,e){let t=i.get(e);return t||(t=[],i.set(e,t)),t}buildElementsByTopoLevel(){let i=0;const e=this.baseEl?Jr(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,t=Jr(this.sourceEl.requirements).map(r=>r.walkDepthState.elementsByTopoLevel).concat().reduce((r,[n,s])=>(n>i&&(i=n),this.getOrCreateLevel(r,n).push(s),r),new Map);return this.getOrCreateLevel(t,i+1).push([this.sourceEl]),Jr(t).map(([r,n])=>[r,Jr(n).concat().uniqueOnly().filter(s=>!e.has(s)).sort((s,a)=>s.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*Jr(this.topoLevels).map(i=>this.elementsByTopoLevel.get(i)).concat()}},fD=1,mI=i=>class extends i{},Ah=class{},op=class{constructor(){this.id=fD++,this.requirements=[],this.baseClass=Ah,this.identitySymbol=void 0,this.mixinLambda=mI,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(i){const e=new this;i&&Object.assign(e,i),e.walkDepthState=fI.new({sourceEl:e,baseEl:vI(e.baseClass)});const t=e.mixinLambda,r=e.identitySymbol=Symbol(t.name),n=Object.assign(function(s){const a=t(s);return a.prototype[r]=!0,a},{[Ih]:r,[Kd]:e});return Object.defineProperty(n,Symbol.hasInstance,{value:mD}),e.mixinLambda=n,e}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(i){const e=this.constructor,t=e.baseClassesIds.get(i);if(t!==void 0)return t;const r=fD++;return e.baseClassesIds.set(i,r),r}buildMinimalClass(){const i=this.constructor;let e=this.baseClass;const t=this.walkDepthState.linearizedByTopoLevelsSource.reduce((n,s)=>{const{cls:a,hash:l}=n,o=l+String.fromCharCode(s.id);let d=i.minimalClassesByLinearHash.get(o);return d||(d=s.mixinLambda(a),s.name=d.name,i.minimalClassesByLinearHash.set(o,d)),n.cls=d,n.hash=o,n},{cls:e,hash:String.fromCharCode(this.getBaseClassMixinId(e))}).cls,r=Object.assign(t,{[Ih]:this.identitySymbol,[Kd]:this,mix:this.mixinLambda,derive:n=>De([r,n],s=>class extends s{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:mD}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((i,e)=>`${e.name}(${i})`,this.baseClass.name)}};op.minimalClassesByLinearHash=new Map,op.baseClassesIds=new Map;var pI=i=>Object.getPrototypeOf(i.prototype).constructor.hasOwnProperty(Kd),vI=i=>Object.getPrototypeOf(i.prototype).constructor[Kd],yI=(i,e)=>{let t;if(i.length>0){const s=i[i.length-1];!pI(s)&&s!==Ah&&(t=s)}const r=[];return i.forEach((s,a)=>{const l=s[Kd];if(l!==void 0){const o=l.baseClass;if(o!==Ah)if(t){if(t!==o){const d=o.prototype.isPrototypeOf(t.prototype),c=t.prototype.isPrototypeOf(o.prototype);if(!d&&!c)throw new Error("Base class mismatch");t=c?o:t}}else t=o;r.push(l)}else if(a!==i.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),op.new({requirements:r,mixinLambda:e,baseClass:t||Ah}).minimalClass},mD=function(i){return!!(i&&i[this[Ih]])},Oi=(i,e)=>!!(i&&i[e[Ih]]),De=yI,bI=class{initialize(i){i&&Object.assign(this,i)}static new(i){const e=new this;return e.initialize(i),e}},Lh=class extends De([],i=>{const e=i.prototype;class t extends i{get isPartOfProjectRaw(){return!0}async commitAsync(){return this.project.commitAsync()}set project(n){this.$project=n}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(n){return this.project=n}getProject(){const{project:n}=this;return n||this.setProject(this.calculateProject())}getAssignmentStore(){const n=this.getProject();return n==null?void 0:n.assignmentStore}getDependencyStore(){const n=this.getProject();return n==null?void 0:n.dependencyStore}getEventStore(){const n=this.getProject();return n==null?void 0:n.eventStore}getResourceStore(){const n=this.getProject();return n==null?void 0:n.resourceStore}getCalendarManagerStore(){const n=this.getProject();return n==null?void 0:n.calendarManagerStore}}return t}){},Ph=class extends De([Lh],i=>{const e=i.prototype;class t extends i{get eventStore(){var n;return(n=this.project)==null?void 0:n.eventStore}get resourceStore(){var n;return(n=this.project)==null?void 0:n.resourceStore}get assignmentStore(){var n;return(n=this.project)==null?void 0:n.assignmentStore}get dependencyStore(){var n;return(n=this.project)==null?void 0:n.dependencyStore}get calendarManagerStore(){var n;return(n=this.project)==null?void 0:n.calendarManagerStore}getEventById(n){var s;return(s=this.eventStore)==null?void 0:s.getById(n)}getDependencyById(n){var s;return(s=this.dependencyStore)==null?void 0:s.getById(n)}getResourceById(n){var s;return(s=this.resourceStore)==null?void 0:s.getById(n)}getAssignmentById(n){var s;return(s=this.assignmentStore)==null?void 0:s.getById(n)}getCalendarById(n){var s;return(s=this.calendarManagerStore)==null?void 0:s.getById(n)}}return t}){},ci=class extends De([Lh,pe],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(n={}){return n.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},e.construct.call(this,n)}trigger(n,s){const a=this,{asyncEvents:l,project:o}=a,d=l==null?void 0:l[n];return d&&(d===!0||d[s.action])?(e.trigger.call(a,`${n}PreCommit`,{...s}),!o||o.isEngineReady()&&!o.isWritingData?e.trigger.call(a,n,s):!a.eventsSuspended&&o&&(o.dataReadyDetacher||(o.queuedDataReadyEvents=[],o.dataReadyDetacher=o.ion({dataReady(){this.queuedDataReadyEvents.forEach(([u,h,g,f])=>{u.trigger.call(h,g,f)}),o.queuedDataReadyEvents=null,o.dataReadyDetacher(),o.dataReadyDetacher=null},once:!0})),o.queuedDataReadyEvents.push([e,a,n,s])),!0):e.trigger.call(a,n,s)}calculateProject(){return this.project}setStoreData(n){var s;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,e.setStoreData.call(this,n),this.isLoadingData=!1,(s=this.project)==null||s.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),e.doAutoCommit.call(this)}async addAsync(n,s){const a=this.add(n,s);return await this.project.commitAsync(),a}async insertAsync(n,s,a){const l=this.insert(n,s,a);return await this.project.commitAsync(),l}async loadDataAsync(n){this.data=n,await this.project.commitAsync()}}return t.$name="AbstractPartOfProjectStoreMixin",t}){},Xd=class extends De([Lh,me],i=>{const e=i.prototype;class t extends i{joinStore(n){let s=null;if(Oi(n,ci)){const a=n.getProject();a&&!this.getProject()&&(this.setProject(a),s=a)}e.joinStore.call(this,n),s&&!s.isRepopulatingStores&&this.joinProject()}unjoinStore(n,s=!1){var a;e.unjoinStore.call(this,n,s);const{project:l}=this,o=Oi(n,ci)&&!n.isFillingFromMaster&&l===(n.isChained&&n.project?n.masterStore.project:n.project);l&&!l.isDestroying&&!l.isRepopulatingStores&&o&&((a=n.untrackRecordFieldChanges)==null||a.call(n),this.leaveProject(s),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(n=!1){}calculateProject(){var n;const s=(n=this.stores)==null?void 0:n.find(a=>Oi(a,ci)&&!!a.getProject());return s==null?void 0:s.getProject()}async setAsync(n,s,a){var l;const o=this.set(n,s,a);return await((l=this.project)==null?void 0:l.commitAsync()),o}async getAsync(n){var s;return await((s=this.project)==null?void 0:s.commitAsync()),this.get(n)}get isStmRestoring(){const n=this.getProject();return(n==null?void 0:n.isRestoringData)||(n==null?void 0:n.stm.isRestoring)||!1}}return t}){},ol=class extends De([Xd,Ph,me],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){!this.isRoot&&this.invalidate()}leaveProject(n=!1){var s;this.project.$leaving.add(this),e.leaveProject.call(this,n),(s=this.project)==null||s.bufferedCommitAsync()}invalidate(){var n;!this._preventInvalidation&&((n=this.project)==null||n.invalidate(this))}getCurrentOrProposed(n){var s;return n in this.$changed&&this.$changed[n]!==!0?this.$changed[n]:(s=this.get(n))!=null?s:null}hasCurrentOrProposed(n){return n in this.$changed&&this.$changed[n]!=!0||this.get(n)!=null}propose(n){var s;if(this.project||(s=this.recurringTimeSpan)!=null&&s.project){const a=Object.keys(n);for(let l=0;l<a.length;l++){const o=a[l];this.$changed[o]=n[o]}this.invalidate()}else this.set(n)}setChanged(n,s,a=!0,l=!1){const o=this;o.$changed[n]=s,l&&(n in o.$beforeChange||(o.$beforeChange[n]=o.get(n)),o.setData(n,s)),a&&o.invalidate()}calculateInvalidated(){}finalizeInvalidated(n=!1){const s=this;s.$isCalculating=!0,n?s.setData(s.$changed):(s.setData(s.$beforeChange),s.set(s.$changed)),s.$changed={},s.$beforeChange={},s.$isCalculating=!1}}return t}){},dl=class extends De([ol],i=>{const e=i.prototype;class t extends i{get assigned(){var n;return(n=this.project)==null?void 0:n.assignmentStore.getResourcesAssignments(this)}joinProject(){var n;this.resourceStore&&!this.resourceStore.isLoadingData&&((n=this.assignmentStore)==null||n.query(s=>s.get("resource")===this.id).forEach(s=>s.setChanged("resource",this))),e.joinProject.call(this)}leaveProject(n=!1){var s;if(this.assigned&&!n&&!((s=this.resourceStore)!=null&&s.isLoadingData)){const a=this.resourceStore;this.assigned.forEach(l=>a.assignmentsForRemoval.add(l))}e.leaveProject.call(this)}applyValue(n,s,a,l,o){(o==null?void 0:o.name)==="id"&&this.assigned.forEach(d=>{d.set("resourceId",a)}),e.applyValue.call(this,n,s,a,l,o)}}return t}){},CI=dl,cl=class extends cD(ar(CI.derive(Kn))){};y(cl,"$name","ResourceModel"),cl.exposeProperties(),cl._$name="ResourceModel";var ul=class extends De([ci,Ph,pe],i=>{const e=i.prototype;class t extends i{setProject(n){const s=e.setProject.call(this,n);return n&&this.joinProject(n),s}joinProject(n){}onCommitAsync(){}joinRecordsToProject(n){const s=a=>{a.setProject(n),a.joinProject()};this.rootNode?this.rootNode.traverse(s):this.forEach(s)}unjoinRecordsFromProject(n){const s=l=>{l.leaveProject(),l.setProject(n)},a=this.rootNode;a?a.traverse(l=>{l!==a&&s(l)}):this.forEach(s)}}return t}){},wI={splice:1,clear:1},pD=class extends De([ci],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(n){var s;const a=wI[n.action];super.onDataChange(n),a&&((s=n.removed)!=null&&s.length)&&this.afterResourceRemoval()}remove(n,s){const a=e.remove.call(this,n,s);return this.afterResourceRemoval(),a}removeAll(n){const s=e.removeAll.call(this,n);return this.afterResourceRemoval(),s}afterResourceRemoval(){const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval){const s=[...this.assignmentsForRemoval].filter(a=>!n.assignmentsForRemoval.has(a));s.length>0&&n.remove(s)}this.assignmentsForRemoval.clear()}processRecord(n,s=!1){const a=this.getById(n.id);if(a&&a!==n)for(const o of a.assigned||[])o.resource=n;return n}}return t}){},dp=class extends De([pD,ul],i=>{const e=i.prototype;class t extends i{static get defaultConfig(){return{modelClass:dl}}joinProject(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"resource")}afterLoadData(){var n,s;(n=e.afterLoadData)==null||n.call(this),(s=this.assignmentStore)==null||s.linkAssignments(this,"resource")}clear(n){var s;e.clear.call(this,n),(s=this.assignmentStore)==null||s.unlinkAssignments("resource")}}return t}){},SI=i=>{var e;return e=class extends i{get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},y(e,"$name","PartOfBaseProject"),e},DI=ar(dp.derive(Dt)),Zd=class extends dD(DI){static get defaultConfig(){return{modelClass:cl}}};y(Zd,"$name","ResourceStore"),Zd._$name="ResourceStore";var EI=class{constructor(){y(this,"ranges",[]),y(this,"promises",[])}addPromise(i){i!=null&&i.then&&(this.promises.push(i),i.then(()=>{this.promises.splice(this.promises.indexOf(i),1)}))}addRange(i,e,t){this.addPromise(t);const r=this.getRange(i);if((r==null?void 0:r.endDate)<e){r.endDate.setTime(e.getTime());return}const n=this.getRange(e);if((n==null?void 0:n.startDate)>i){n.startDate.setTime(i.getTime());return}i=new Date(i.getTime()),e=new Date(e.getTime()),this.ranges.push({startDate:i,endDate:e})}containsRange(i,e){return this.ranges.some(t=>C.timeSpanContains(t.startDate,t.endDate,i,e))}getRange(i){return this.ranges.filter(e=>C.betweenLesserEqual(i,e.startDate,e.endDate))[0]}},$i=class extends Zo.mixin(fe){static get pluginConfig(){var i;const e={};for(const r in super.pluginConfig)e[r]=[...super.pluginConfig[r]];e.assign.push("updateProject");const t=e.assign.indexOf("lazyGetAt");return t>=0&&e.assign.splice(t,1),e.before=(i=e.before)!=null?i:[],e.before.push("getEventsAsArray"),e}afterConstruct(){super.afterConstruct(...arguments),this.listenToProject()}get project(){return this.client.project}get resourceStore(){var i;return(i=this.project)==null?void 0:i.resourceStore}updateProject(){this.listenToProject()}listenToProject(){var i;const{project:e}=this;(i=this.$projectListenersDetacher)==null||i.call(this),e!=null&&e.ion&&(this.$projectListenersDetacher=e.ion({resourceStoreChange:"listenToResourceStore",thisObj:this})),this.listenToResourceStore()}listenToResourceStore(){var i;const{resourceStore:e}=this;e!=null&&e.lazyLoad&&e.isResourceStore&&!e.lazyLoad.$isCrudManager&&((i=this.$resourceStoreListenersDetacher)==null||i.call(this),this.$resourceStoreListenersDetacher=e.ion({afterLazyLoad:"afterResourceStoreLazyLoad",thisObj:this}))}afterResourceStoreLazyLoad(i){const e=this,{resourceStore:t}=e;if(!e.client.isAssignmentStore&&(i.isReload||e.$delayedReloadLoad)){if(t.tree&&t.isLoading){e.$delayedReloadLoad=!0;return}e.load(),e.$delayedReloadLoad=!1}}getEventsAsArray({visibleDateRange:i,startDate:e,endDate:t,fromRowHeight:r,resourceRecord:n}){!r&&i&&this.bufferedLazyLoad({startDate:e,endDate:t,visibleStart:i.startDate,visibleEnd:i.endDate,resourceRecord:n})}get isLoading(){return super.isLoading||Object.values(this.loadQueue).some(i=>i.promises.length)}internalOnBeforeAdd(){}internalOnChange(){}internalOnCommit(){}updateAutoLoad(){super.autoLoad=!1}calculateDateRange({startDate:i,endDate:e,visibleStart:t,visibleEnd:r},n){let s=this.getResourceQueue(n);if(t&&r&&!this.loadFullDateRange){const{bufferAmount:a,bufferUnit:l,$bufferedResourceRecords:o,resourceStore:d}=this,c=l&&a!=null?C.asMilliseconds(a,l):r-t,u=(f,m)=>{const p=C.clearTime(new Date(f.getTime()+m));return p<i?p.setTime(i.getTime()):p>e&&p.setTime(e.getTime()),p},h=u(t,c/-2),g=u(r,c/2);if(h>g)return!1;if(s!=null&&s.containsRange(h,g)){let f=!1;if((o==null?void 0:o.length)>1){for(let m=1;m<o.length;m++)if(n=d.indexOf(o[m]),s=this.getResourceQueue(n),!(s!=null&&s.containsRange(h,g))){f=!0;break}}if(!f)return!1}i=u(t,c*-1),e=u(r,c)}else{if(i>e)return!1;i=new Date(i.getTime()),e=new Date(e.getTime())}if(s){const a=s.getRange(i);if(a)i.setTime(a.endDate.getTime());else{const l=s.getRange(e);l&&e.setTime(l.startDate.getTime())}}return i-e>=0?!1:{startDate:i,endDate:e,resourceIndex:n}}calculateResourceRange({resourceIndex:i,startDate:e,endDate:t}){var r,n,s,a;const{resourceStore:l,$bufferedResourceRecords:o}=this;let d=0,c=l.count-1;if(l.lazyLoad||!this.loadFullResourceRange&&l.count){const u=(n=(r=l.lazyLoad)==null?void 0:r.chunkSize)!=null?n:this.chunkSize;if(d=i-u,c=i+u,(o==null?void 0:o.length)>u){const h=l.indexOf(o.pop());h>c&&(c=h+u)}for(d=Math.max(d,0);!l.records[d]&&d<c;)d+=1;for(;!l.records[c]&&d<c;)c-=1}for(;d<i&&((s=this.getResourceQueue(d))!=null&&s.containsRange(e,t));)d+=1;for(;c>i&&((a=this.getResourceQueue(c))!=null&&a.containsRange(e,t));)c-=1;return{startIndex:d,count:c-d+1}}getResourceQueue(i){var e;if(i!=null){const{resourceStore:t}=this;return!this.client.isTimeRangeStore&&t.isTree&&(i=(e=t.records[i])==null?void 0:e.id),this.loadQueue[i]}}addToQueue({startDate:i,endDate:e,startIndex:t=0,count:r=1,promise:n,resourceIds:s}){const{loadQueue:a}=this,l=o=>(a[o]||(a[o]=new EI)).addRange(i,e,n);if(s)s.forEach(l);else for(let o=t;o<t+r;o++)l(o)}bufferedLazyLoad({resourceRecord:i}){const e=this;i||e.doLazyLoad(...arguments),e.$bufferedResourceRecords?e.$bufferedResourceRecords.push(i):(e.$bufferedResourceRecords=[i],e.requestAnimationFrame(()=>{e.doLazyLoad(...arguments),e.$bufferedResourceRecords=null}))}async doLazyLoad({isReload:i,...e}){var t,r,n,s,a,l,o;const d=this,{client:c,dateFormat:u}=d,{resourceStore:h}=d.project,g=!c.isTimeRangeStore&&h.isTree,f=(t=e.resourceIndex)!=null?t:e.resourceRecord?h.indexOf(e.resourceRecord):0;if(i&&d.clear(),e=d.calculateDateRange(e,f),!c.requestData||e===!1||g&&(h.isLoading||!h.count)||e.resourceIndex<0){!h.count&&c.clear();return}if(!c.isTimeRangeStore){const b=d.calculateResourceRange(e);if(g){const w=h.getRange(b.startIndex,b.startIndex+b.count+1),D=w.filter(S=>{var x;return!S.isPhantom&&!((x=d.loadQueue[S.id])!=null&&x.containsRange(e.startDate,e.endDate))});if(!D.length)return;e.resourceIds=D.map(S=>S.id)}else{if(Object.assign(e,b),h.remoteFilter&&h.isFiltered)if(c.readUrl){let{filterParamName:w="filters"}=h;c.filterParamName===w&&(w="resource"+w),e[w]=h.encodeFilterParams(h.filters)}else e.resourceFilters=h.getFilterParams(h.filters);if(h.remoteSort&&h.isSorted){const{sorters:w}=h;if(c.readUrl){let{sortParamName:D}=h;c.sortParamName===D&&(D="resource"+D),e[D]=h.encodeSorterParams(w)}else e.resourceFilters=w}}}delete e.resourceIndex,c.isEventStore&&!((s=(n=(r=c.crudManager)==null?void 0:r.transport)==null?void 0:n.load)!=null&&s.url)&&(d.loadAssignmentStore(e,i),(o=(l=(a=d.project)==null?void 0:a.timeRangeStore)==null?void 0:l.lazyLoad)==null||o.doLazyLoad(e)),d.triggerLazyLoadStart(e);let m=e;c.readUrl&&u?m={...e,startDate:C.format(e.startDate,u),endDate:C.format(e.endDate,u)}:c.readUrl||c.buildRemoteParams(m);const p=c.requestData(m);d.addToQueue({...e,promise:p});const{data:v}=await p;d.addData(v,e,i),d.triggerLazyLoadEnd(e,v)}addData(i,{resourceIds:e,startDate:t,endDate:r}={},n){const{client:s}=this;if(i!=null&&i.length&&e){const a=i.filter(l=>!e.includes(l.resourceId));a.length&&this.addToQueue({startDate:t,endDate:r,resourceIds:a.map(l=>l.resourceId)})}if(s.isTree){s.rootNode.appendChild(i,!0),s.added.clear();return}super.addData(i,null,n)}processAddedRecords(i){var e,t;const{client:r}=this;if(r.isEventStore&&r.$processResourceIds){const n=(t=r.assignmentStore)!=null?t:(e=r.crudManager)==null?void 0:e.assignmentStore,{stm:s}=n,a=(s==null?void 0:s.enabled)&&s.autoRecord,l=[];for(const{resourceId:o,resourceIds:d,id:c}of i)o!=null?l.push({resource:o,eventId:c}):d!=null&&d.length&&l.push(...d.map(u=>({resource:u,eventId:c})));a&&s.disable(),r.project.hasLoadedDataToCommit=!0,n.add(l),n.acceptChanges(),a&&s.enable(),r.$processResourceIds=!1}}async loadAssignmentStore(i,e){const{assignmentStore:t}=this.project,{lazyLoad:r}=t;if(r){r.triggerLazyLoadStart(),e&&r.clear();const n=t.requestData(i);r.addToQueue({...i,promise:n});const{data:s}=await n;r.addData(s,void 0,e),r.triggerLazyLoadEnd()}}load(i={}){var e;return(e=this.beforeLoadCall)==null||e.call(this,i),this.doLazyLoad({isReload:!0,...i})}doDestroy(){var i,e;(i=this.$projectListenersDetacher)==null||i.call(this),(e=this.$resourceStoreListenersDetacher)==null||e.call(this),super.doDestroy()}};y($i,"$name","DateStoreLazyLoadPlugin"),y($i,"configurable",{bufferUnit:null,bufferAmount:null,dateFormat:"YYYY-MM-DD",loadFullDateRange:!1,loadFullResourceRange:!1}),$i._$name="DateStoreLazyLoadPlugin";var Qr=class extends $i{listenToResourceStore(){var i,e;super.listenToResourceStore();const t=this,{resourceStore:r,client:n}=t;r&&!((i=n.lazyLoad)!=null&&i.$isCrudManager)&&!n.isTimeRangeStore&&((e=t.$pagedResourceStoreListenersDetacher)==null||e.call(t),t.$pagedResourceStoreListenersDetacher=t.resourceStore.ion({beforeLoadPage:"beforeResourceStoreLoad",thisObj:t}),(r.isLoading||r.count)&&t.requestAnimationFrame(t.beforeResourceStoreLoad))}beforeResourceStoreLoad(i){var e,t;const r={...(e=i==null?void 0:i.params)!=null?e:{},isReload:!0};(t=this.beforeLoadCall)==null||t.call(this,r),this.doLazyLoad(r)}calculateDateRange(i){var e,t,r;const n=super.calculateDateRange(...arguments);if(n){const{defaultPageParamName:s,pageSizeParamName:a}=this.client,{resourceStore:l}=this;n[s]=(t=(e=i[s])!=null?e:l.currentPage)!=null?t:1,n[a]=(r=i[a])!=null?r:l.pageSize}return n}calculateResourceRange(i){return i}addToQueue(i){i.startIndex=0,i.count=i.pageSize,super.addToQueue(i)}doDestroy(){var i;super.doDestroy(),(i=this.$pagedResourceStoreListenersDetacher)==null||i.call(this)}};y(Qr,"$name","PagedDateStoreLazyLoadPlugin"),y(Qr,"configurable",{loadFullDateRange:!0}),Qr._$name="PagedDateStoreLazyLoadPlugin";var vD=i=>{var e;return e=class extends(i||$){get $lazyLoadPluginClass(){return this.isPaged?Qr:$i}static get defaultConfig(){return{loadPriority:100,syncPriority:200,id:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}getEventCounts(t){const r=this,{filtersFunction:n,added:s}=r,a=r.getEvents({...t,storeFilterFn:r.isFiltered?r.reapplyFilterOnAdd?n:l=>s.includes(l)?r.indexOf(l)>-1:n(l):null,dateMap:t.dateMap||!0});return a.forEach((l,o)=>a.set(o,l.length)),a}forEachScheduledEvent(t,r=this){this.forEach(n=>{const{startDate:s,endDate:a}=n;if(s&&a)return t.call(r,n,s,a)})}getTotalTimeSpan(){let t=new Date(9999,0,1),r=new Date(0);return this.forEach(n=>{n.startDate&&(t=C.min(n.startDate,t)),n.endDate&&(r=C.max(n.endDate,r))}),t=t<new Date(9999,0,1)?t:null,r=r>new Date(0)?r:null,this.lastTotalTimeSpan={startDate:t||null,endDate:r||t||null}}isEventPersistable(t){return t.isPersistable}filterEventsForResource(t,r,n=this){return t.getEvents(this).filter(r.bind(n))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,r,n=!1){return this.assignmentStore.assignEventToResource(t,r,void 0,n)}unassignEventFromResource(t,r){this.assignmentStore.unassignEventFromResource(t,r)}reassignEventFromResourceToResource(t,r,n){const s=this,a=me.asId(n),l=s.assignmentStore.getAssignmentForEventAndResource(t,r);l?l.resourceId=a:s.assignmentStore.assignEventToResource(t,n)}isEventAssignedToResource(t,r){return this.assignmentStore.isEventAssignedToResource(t,r)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}append(t){return this.add(t)}get project(){return super.project}set project(t){var r,n;super.project=t,(r=this.updateProject)==null||r.call(this,t),this.detachListeners("project"),t&&((n=t.assignmentStore)!=null&&n.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesResourceIds(){var t,r;return(r=(t=this.modelClass.fieldMap)==null?void 0:t.resourceIds.persist)!=null?r:!1}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t,this.setupCheapAssignmentIdGeneration()}setupCheapAssignmentIdGeneration(){const{assignmentStore:t}=this;t!=null&&t.isStore&&!t.hasGenerateIdOverride&&(t.modelClass.generateId=function(){return this.singleAssignmentIdCounter==null&&(this.singleAssignmentIdCounter=0),`a-${++this.singleAssignmentIdCounter}`},t.hasGenerateIdOverride=!0)}processRecords(t,r,n){var s;const{assignmentStore:a}=this,l=[];return a&&(a.skipInvalidateIndices=!0),t=super.processRecords(t,a&&!((s=this.stm)!=null&&s.isRestoring)&&(o=>{var d;const c=this.usesResourceIds&&((d=o.resourceIds)!=null&&d.length)?o.resourceIds:[o.resourceId];if(!o.reassignedFromReplace&&(c==null?void 0:c[0])!=null)for(const u of c)a.includesAssignment(o.id,u)||l.push({id:a.modelClass.generateId(""),resourceId:u,eventId:o.id});o.reassignedFromReplace=!1})||void 0),a&&(a.storage.invalidateIndices(),a.skipInvalidateIndices=!1,a.add(l,n)),t}joinRecordsToStore(t){const{assignmentStore:r}=this;r?(r.skipInvalidateIndices=!0,super.joinRecordsToStore(t),r.storage.invalidateIndices(),r.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,r=!1){var n,s;t=super.processRecord(t,r);const a=this,l=t.get("resourceId"),{resourceIds:o}=t;if(o!=null&&o.length&&a.usesResourceIds)a.$processResourceIds=!0,a.setupCheapAssignmentIdGeneration();else if(l!=null&&!t.meta.skipEnforcingSingleAssignment){const d=a.getById(t.id);if(d&&d!==t&&!r){const u=(s=a.assignmentStore)!=null?s:(n=a.crudManager)==null?void 0:n.assignmentStore,h=u.storage.findItem("eventId",t.id);if(h!=null&&h.size){const g=h.values().next().value;g.resource=l,t.reassignedFromReplace=!0}}else a.$processResourceIds=!0;a.usesSingleAssignment=!0}return t}processResourceIds(){var t,r,n;const s=this,a=(r=s.assignmentStore)!=null?r:(t=s.crudManager)==null?void 0:t.assignmentStore;if(s.$processResourceIds&&(a!=null&&a.isAssignmentStore)&&!((n=s.project)!=null&&n.isSharingAssignmentStore&&s.isChained)){const l=[];s.forEach(o=>{const{resourceId:d,resourceIds:c,id:u}=o;d!=null?l.push({id:a.modelClass.generateId(""),resourceId:d,eventId:u}):c!=null&&c.length&&c.forEach(h=>{l.push({id:a.modelClass.generateId(""),resourceId:h,eventId:u})})},s,{includeFilteredOutRecords:!0}),a.useRawData={disableDefaultValue:!s.modelClass.isProEventModel,disableDuplicateIdCheck:!0,disableTypeConversion:!0},a.usesSingleAssignment=!1,a.verifyNoGeneratedIds=!1,a.data=l,a.usesSingleAssignment=!0,s.$processResourceIds=!1}}loadTreeData(){super.loadTreeData(...arguments),this.processResourceIds()}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var r;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&!((r=n.stm)!=null&&r.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const s=new Set;t.forEach(a=>{const{event:l}=a;l&&!l.isRemoved&&l.assignments.every(o=>t.includes(o))&&s.add(l)}),s.size&&n.remove([...s])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const r=this;r.detachListeners("assignmentStore"),t&&(r.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:n}){!r.isSettingData&&!r.isAssigning&&(r.usesSingleAssignment?n.forEach(s=>{const{event:a}=s;a!=null&&a.isEvent&&a.resourceId!==s.resourceId&&(a.meta.isAssigning=!0,a.set("resourceId",s.resourceId),a.meta.isAssigning=!1)}):r.usesResourceIds?n.forEach(s=>{var a;const{event:l}=s;if(l!=null&&l.isEvent){l.meta.isAssigning=!0;const o=(a=l.resourceIds)!=null?a:[];o.includes(s.resourceId)||(l.resourceIds=[...o,s.resourceId]),l.meta.isAssigning=!1}}):r.updateChainedStores())},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:n}){!r.isSettingData&&!r.isAssigning&&(r.usesSingleAssignment?n.forEach(s=>{var a;(a=r.getById(s.eventId))==null||a.set("resourceId",null)}):r.usesResourceIds?n.forEach(({event:s,resourceId:a})=>{var l;const o=(l=s.resourceIds)==null?void 0:l.slice(),d=o==null?void 0:o.indexOf(a);d>=0&&(o.splice(d,1),s.resourceIds=o)}):r.updateChainedStores())},removeAllPreCommit(){!r.isSettingData&&!r.isAssigning&&(r.usesSingleAssignment?r.allRecords.forEach(n=>n.set("resourceId",null)):r.usesResourceIds?r.allRecords.forEach(n=>{n.resourceIds=[]}):r.updateChainedStores())},update({record:n,changes:s}){if("resourceId"in s){const{event:a}=n;if(r.usesSingleAssignment)a.meta.isAssigning=!0,a.set("resourceId",s.resourceId.value),a.meta.isAssigning=!1;else if(r.usesResourceIds){a.meta.isAssigning=!0;const l=a.resourceIds.slice(),o=l==null?void 0:l.indexOf(s.resourceId.oldValue);o>=0&&l.splice(o,1),l!=null&&l.includes(s.resourceId.value)||(l.push(s.resourceId.value),a.resourceIds=l),a.meta.isAssigning=!1}else r.updateChainedStores()}},change({action:n,records:s}){n==="dataset"&&(r.usesResourceIds&&s.forEach(({event:a,resourceId:l})=>{var o;const d=(o=a.resourceIds)!=null?o:[];d.includes(l)||(d.push(l),a.meta.isAssigning=!0,a.setData("resourceIds",d),a.meta.isAssigning=!1)}),!r.usesSingleAssignment&&!r.usesResourceIds&&r.updateChainedStores())},thisObj:r}))}set data(t){const r=this;r.isSettingData=!0,r.usesSingleAssignment&&!r.syncDataOnLoad&&!r.isChained&&r.assignmentStore.removeAll(!0),super.data=t,r.isSettingData=!1}trigger(t,r){var n;const{changes:s}=r||{};return s&&"resourceId"in s&&Object.keys(s).length===1&&!((n=this.stm)!=null&&n.isRestoring)&&(r.isAssign=!0),super.trigger(...arguments)}remove(t,...r){var n,s;const a=super.remove(t,...r);if(a.length&&this.usesSingleAssignment)for(const l of a)l.isOccurrence||(s=this.assignmentStore||((n=this.crudManager)==null?void 0:n.assignmentStore))==null||s.remove(l.assignments,!0);return a}},y(e,"$name","EventStoreMixin"),e},xI=()=>!0,RI=i=>!i.isRecurring,yD=i=>{var e;return e=class extends i{constructor(){super(...arguments),y(this,"bufferIsUnavailableTime",!1)}getEvents({filter:t,date:r,startDate:n,endDate:s,startOnly:a,includeOccurrences:l,allowPartial:o,onlyAssigned:d=!1,dateMap:c=!1,dayTime:u=null,silent:h,getDateIndex:g,fromRowHeight:f}){const m=this,p=arguments[0],{lastDateRange:v,added:b,filtersFunction:w}=m,D=t;if(d&&(p.filter=D?R=>D(R)&&R.resources.length:R=>R.resources.length),"startDate"in p||(n=p.startDate=r),"includeOccurrences"in p||(l=p.includeOccurrences=!0),"allowPartial"in p||(o=p.allowPartial=!a),p.storeFilterFn=m.isFiltered&&!p.ignoreFilters&&!m.remoteFilter?m.reapplyFilterOnAdd?w:R=>b.includes(R)?m.indexOf(R)>-1:w(R):null,!s)if(n)s=p.endDate=C.clearTime(n),s.setDate(s.getDate()+1);else{if(l)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");p.dateFilter=xI}p.dateFilter||(a?p.dateFilter=R=>{const M=R.hasBatchedChange("startDate")?R.get("startDate"):R.startDate;return M&&!(C.clearTime(M)-n)}:o?p.dateFilter=R=>{const M=R.hasBatchedChange("startDate")?R.get("startDate"):R.startDate,_=R.hasBatchedChange("endDate")?R.get("endDate"):R.endDate||M,k=!(M-_);return M&&(k?C.betweenLesserEqual(M,n,s):C.intersectSpans(M,_,n,s))}:p.dateFilter=R=>{const M=R.hasBatchedChange("startDate")?R.get("startDate"):R.startDate,_=R.hasBatchedChange("endDate")?R.get("endDate"):R.endDate||M;return M&&M>=n&&_<=s});const S={startDate:n,endDate:s},x=!!(!v||v.startDate-S.startDate||v.endDate-S.endDate);return m.processConfiguredListeners(),h||(m.trigger("loadDateRange",{old:v||{},new:Z.clone(S),changed:x}),m.lastDateRange=Z.clone(S)),c?m.getEventsAsMap(p):m.getEventsAsArray(p)}getEventsAsArray({filter:t,date:r,resourceRecord:n,startDate:s=r,endDate:a,startOnly:l,includeOccurrences:o=!0,dayTime:d=null,dateFilter:c,storeFilterFn:u,getDateIndex:h}){const g=this,f=[];if(u?g.count:g.totalCount){let p=n?g.getEventsForResource(n):null;if(!n){const v=g.useDayIndex(d),b=new Set,w=l?"startDate":"date";g.recurringEvents.forEach(D=>{v.dayTime.startOfDay(D.startDate)<=s&&b.add(D)});for(const D=new Date(s);D<a;D.setDate(D.getDate()+1)){const S=v.get(h?h(D):w,D);S==null||S.forEach(x=>b.add(x))}p=[...b]}u&&(p=p.filter(u));for(let v=0,{length:b}=p;v<b;v++){const w=p[v];o&&w.isRecurring?f.push.apply(f,w.getOccurrencesForDateRange(s,a).filter(c)):c(w)&&f.push(w)}}return t?f.filter(t):f}getEventsAsMap({filter:t,date:r,resourceRecord:n,startDate:s=r,endDate:a,startOnly:l,includeOccurrences:o=!0,dateMap:d,dayTime:c=null,storeFilterFn:u,getDateIndex:h}){var g;const f=this;if(d!=null&&d.clear?d.clear():d=new Map,f.count){const m=f.useDayIndex(c),p=l?"startDate":"date",v=[],b=D=>(!t||t(D))&&(!u||u(D)),w=D=>RI(D)&&b(D);if(c=m.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");(g=f.recurringEvents)==null||g.forEach(D=>{c.startOfDay(D.startDate)<a&&v.push(D)});for(const D=new Date(s);D<a;D.setDate(D.getDate()+1)){let[S,x]=m.get(h?h(D):p,D,!0);S!=null&&S.size&&(S=[...S].filter(w),S.length&&(d.get(x)||d.set(x,[]).get(x)).push(...S))}for(let D=0,{length:S}=v;D<S;D++){const x=v[D],R=(o?x.getOccurrencesForDateRange(s,a):[x]).filter(b),M=C.add(a,1,"day");for(let _,k=0,{length:F}=R;k<F;k++){const I=R[k],A=c.startOfDay(I.startDate),P=h?h(A):l?"startDate":"date",H=P==="startDate"||!I.durationMS?C.add(A,1,"day"):C.min(I.endDate||C.add(I.startDate,I.duration,I.durationUnit),M);for(;A<H;A.setDate(A.getDate()+1)){const G=c.dateKey(A);(_=d.get(G))||d.set(G,_=[]),_.push(I)}}}}return d}isDateRangeAvailable(t,r,n,s){let a;return arguments.length===1&&(r=t.endDate,n=t.excludeEvent,s=t.resourceRecord,a=t.allowOverlap,t=t.startDate),s=B.asArray(s),s.every(l=>this.isResourceAvailable(t,r,n,l,a))}isResourceAvailable(t,r,n,s,a){var l;if(s.data.generatedParent)return!1;if(a=typeof s.allowOverlap=="boolean"?s.allowOverlap:a,a)return!0;const o=this.getEventsForResource(s);((l=this.recurringEvents)==null?void 0:l.size)>0&&o.push(...o.flatMap(h=>h.occurrences));const d=new Set(o);n&&(n=B.asArray(n),n.forEach(h=>{h.isAssignment&&h.event.resources.forEach(p=>{p.id!==h.resourceId&&this.getEventsForResource(p).forEach(v=>d.add(v))});const g=h.isAssignment?h.event:h;d.delete(g)}));const c=Array.from(d);if(t.getTime()===r.getTime())return!c.some(h=>h.isScheduled&&(h.duration===0?h.startDate.getTime()===t.getTime():C.intersectSpans(t,r,h.startDate,h.endDate)));const{bufferIsUnavailableTime:u}=this;return!c.some(h=>{const g=u&&h.outerStartDate||h.startDate,f=u&&h.outerEndDate||h.endDate;return h.isScheduled&&C.intersectSpans(t,r,g,f)})}},y(e,"$name","GetEventsMixin"),e},Oh={date:"_dateIndex",startDate:"_startDateIndex"},cp=Object.values(Oh),bD=Object.freeze([]),{MILLIS_PER_DAY:CD}=Me,$h=class{constructor(i,e){this.dayTime=e||Me.MIDNIGHT,this.store=i,this.users=[this.dayTime]}add(i,e,t){const r=this[Oh[i]],n=this.dayTime.dateKey(e);(r[n]||(r[n]=new Set)).add(t)}addEvent(i){var e,t,r;let n=(e=this.dayTime.startOfDay(i.startDate))==null?void 0:e.getTime(),s;if(n){s=(r=(t=i.endDate)==null?void 0:t.getTime())!=null?r:n,this.add("startDate",n,i);do this.add("date",n,i),n+=CD;while(n<s)}}clear(){cp.forEach(i=>this[i]=Object.create(null))}get(i,e,t){!this.initialized&&this.initialize();let r=this[Oh[i]],n;return e&&(n=this.dayTime.dateKey(e),r=t?[r[n],n]:r[n]),r}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,cp.forEach(i=>this[i]=null)}matches(i){return this.dayTime.startShift===i.startShift}remove(i,e,t){const r=this[Oh[i]],n=this.dayTime.dateKey(e),s=r[n];s&&s.delete(t)}removeEvent(i,e,t){var r,n;let s=(r=this.dayTime.startOfDay(e))==null?void 0:r.getTime(),a;if(s){a=(n=t==null?void 0:t.getTime())!=null?n:s,this.remove("startDate",s,i);do this.remove("date",s,i),s+=CD;while(s<a)}}sync(i,e,t,r,n){var s,a;e=e||bD,t=t||bD;const l=this,o=e.length,d=t.length,c=r==null?void 0:r.length;let u,h,g;if(l.initialized)switch(i){case"clear":l.clear();break;case"splice":if(c)for(e=e.slice(),t=t.slice(),u=0;u<c;u++)t.push(r[u][0]),e.push(r[u][1]);if(d)for(u=0;u<d;u++)g=t[u],l.removeEvent(g,g.startDate,g.endDate);if(o)for(u=0;u<o;u++)h=e[u],h.isScheduled&&!h.isParent&&l.addEvent(h);break;case"reschedule":g=e[0],l.removeEvent(g,((s=n.startDate)==null?void 0:s.oldValue)||g.startDate,((a=n.endDate)==null?void 0:a.oldValue)||g.endDate),l.sync("splice",e);break}}register(i){this.users.push(i)}unregister(i){const{users:e}=this,t=e.indexOf(i);return t>-1&&e.splice(t,1),!e.length}},wD=$h.prototype;cp.forEach(i=>wD[i]=null),wD.initialized=!1,$h._$name="EventDayIndex";var{MIDNIGHT:SD}=Me,TI=i=>{var e;return e=class extends i{construct(t){super.construct(t),this.dayIndices=null}afterLoadData(){var t;this.syncIndices("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:r,removed:n,replaced:s}){this.syncIndices(t,r,n,s),super.onDataChange(...arguments)}onDataReplaced(t,r){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(t,r)}onModelChange(t,r,n,s,a){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[t],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var t;(t=this.dayIndices)==null||t.forEach(r=>r.invalidate())}registerDayIndex(t){const r=this,n=r.dayIndices||(r.dayIndices=[]);let s,a;for(a=0;!s&&a<n.length;++a)n[a].matches(t)&&(s=n[a]).register(t);return!s&&n.push(s=new $h(r,t)),s}syncIndices(...t){var r;(r=this.dayIndices)==null||r.forEach(n=>n.sync(...t))}unregisterDayIndex(t){const r=this,{dayIndices:n}=r;for(let s=n==null?void 0:n.length;s-- >0;)if(n[s].matches(t)){n[s].unregister(t)&&n.splice(s,1);break}}useDayIndex(t){const r=this,{dayIndices:n}=r;t=t||SD;for(let s=0;n&&s<n.length;++s)if(n[s].matches(t))return n[s];if(t.startShift)throw new Error(`No day index registered for ${t} on ${r.id}`);return r.registerDayIndex(SD)}},y(e,"$name","DayIndexMixin"),e},DD=Object.freeze([]),Hh=i=>{var e;return e=class extends(i||$){construct(...t){const r=this;r.globalOccurrences=new Map,r.recurringEvents=new Set,r.ion({removeAll(){r.globalOccurrences.clear()}}),super.construct(...t)}afterLoadData(){var t;this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:r,removed:n,replaced:s}){this.refreshRecurringEventsCache(t,r,n,s),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,r=DD,n=DD,s){const a=this,{recurringEvents:l}=a,o=s==null?void 0:s.length;switch(t){case"clear":l.clear();break;case"splice":{if(o){r=r.slice(),n=n.slice();for(let u=0;u<o;u++)n.push(s[u][0]),r.push(s[u][1])}const d=r.length,c=n.length;if(c&&l.size)for(let u=0;u<c;u++)l.delete(n[u]);if(d)for(let u=0;u<d;u++){const h=r[u];h.isRecurring&&l.add(h)}break}}}getById(t){let r=super.getById(t);return r||(r=this.globalOccurrences.get(this.modelClass.asId(t))),r}onModelChange(t,r,n,s,a){const l=!s&&this.isRecurrenceRelatedFieldChange(t,n);if(l&&t.removeOccurrences(),super.onModelChange(...arguments),l){const o={action:"batch",records:this.storage.values};this.trigger("refresh",o),this.trigger("change",o)}}isRecurrenceRelatedFieldChange(t,r){return t.isRecurring||"recurrenceRule"in r}getOccurrencesForTimeSpan(t,r,n){const s=[];return t.isRecurring&&t.recurrence.forEachOccurrence(r,n,a=>s.push(a)),s}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},y(e,"$name","RecurringTimeSpansMixin"),y(e,"configurable",{autoAdjustRecurrence:null}),e},ED=i=>{var e;return e=class extends Hh(i||$){getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}},y(e,"$name","RecurringEventsMixin"),e},MI=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,xD=["SU","MO","TU","WE","TH","FR","SA"],nt=class extends ${static decodeDay(i){let e,t;return(e=MI.exec(i))&&(t=[xD.indexOf(e[2])],e[1]&&(e[1]=parseInt(e[1],10),t.push(e[1]))),t}static encodeDay(i){let e;return Array.isArray(i)&&([i,e]=i),(e?e.toString():"")+xD[i]}static decode(i){const e=[];let t;if(i)for(let r=0;r<i.length;r++)(t=this.decodeDay(i[r]))&&e.push(t);return e}static encode(i){const e=[];let t;if(i)for(let r=0;r<i.length;r++)(t=this.encodeDay(i[r]))&&e.push(t);return e}};nt._$name="RecurrenceDayRuleEncoder";var _I=/ly$/i,up=i=>{const e=i.replace(_I,"");return e==="DAI"?"DAY":e},kI=(i,e,t,r)=>r.buildOccurrence(i,t),FI=i=>hp=i,hp,lr=class extends ${static processIterationConfig(i){const{recurrence:e}=i,{frequency:t,interval:r,timeSpan:n,endDate:s,count:a}=e;if(!i.syncingStartDate&&!n.meta.isSyncedWithRule){const u=C.add(n.startDate,r,up(t)),h=C.min(u,i.endDate||u);this.forEachDate({syncingStartDate:!0,startDate:n.startDate,endDate:h,recurrence:e,fn:kI})}const l=n.startDate;let{startDate:o=l,endDate:d=s}=i;o<l&&(o=l),s?(!d||d>s)&&(d=s):a&&o>l&&(this.forEachDate({recurrence:e,fn:FI}),(!d||d>hp)&&(d=new Date(hp.getTime()+1)));const c=o;return i.startOnly||(o=new Date(C.max(C.add(o,-r,up(t)),l))),Object.assign({extraArgs:[],startOnly:!n.durationMS},i,{startDate:o,endDate:d,timeSpan:n,timeSpanStart:l,earliestVisibleDate:c,endDateMS:d==null?void 0:d.getTime(),timeSpanStartMS:l.getTime(),earliestVisibleDateMS:c.getTime(),durationMS:n.durationMS,spansStart:o<=l&&d>l})}static getOccurrenceIndex(i){if(i.isOccurrence)return C.diff(i.recurringTimeSpan.startDate,i.startDate,up(i.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(i,e,t,r){let n,s,a;if(r){r>0?(s=1,a=i):(s=-1,a=e);const l=t-a.getDay();s*l<0&&(r+=s),n=new Date(a),n.setDate(a.getDate()+(r-s)*7+l),(n<i||n>e)&&(n=null)}return n}static buildDate(i,e,t){const r=new Date(i,e,t);if(r.getFullYear()===i&&r.getMonth()===e&&r.getDate()===t)return r}static isValidPosition(i){return!!i}static forEachDateAtPositions(i,e,t,r){const n=i.length,s={};for(let a=0;a<e.length;a++){const l=e[a];if(this.isValidPosition(l)){const o=l>0?i[l-1]:i[n+l];if(o&&!s[o.getTime()]&&(s[o.getTime()]=!0,t.call(r,o)===!1))return!1}}}static isInView(i,e,t,r,n){return(i?e>=t:e.valueOf()+r>t)&&!n.hasException(e)}static isInViewMS(i,e,t,r,n,s){return(i?t>=r:t+n>r)&&!s.hasException(e)}};y(lr,"frequency","NONE"),y(lr,"MAX_OCCURRENCES_COUNT",1e6),lr._$name="AbstractRecurrenceIterator";var Vh=class extends lr{static forEachDate(i){const{startOnly:e,startDate:t,endDate:r,endDateMS:n,timeSpan:s,timeSpanStart:a,earliestVisibleDateMS:l,durationMS:o,spansStart:d,recurrence:c,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(i),{interval:f}=c,m=t-a,p=f*864e5,v=Math.floor(m/p);let{count:b}=c,w=0,D=C.add(a,v*f,"day"),S=D.getTime();for(!r&&!b&&(b=this.MAX_OCCURRENCES_COUNT);!n||S<n;){const x=this.isInViewMS(e,D,S,l,o,s);if(w++,b&&w>b||n&&S>=n||x&&u.apply(g,[D,w,w===1&&d,s,...h])===!1)break;D=C.add(D,f,"day"),S=D.getTime()}}};y(Vh,"frequency","DAILY"),Vh._$name="DailyRecurrenceIterator";var Nh=class extends lr{static forEachDate(i){const{startOnly:e,startDate:t,endDateMS:r,timeSpan:n,timeSpanStart:s,timeSpanStartMS:a,earliestVisibleDateMS:l,durationMS:o,spansStart:d,recurrence:c,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(i),{interval:f,days:m}=c,{weekStartDay:p}=C,v=s.getHours(),b=s.getMinutes(),w=s.getSeconds(),D=s.getMilliseconds();let S=0,{count:x}=c,R=nt.decode(m),M,_;if(R!=null&&R.length||(R=[[s.getDay()]]),p>0)for(let k=0;k<R.length;k++)p>R[k][0]?R[k][0]=7-p-R[k][0]:R[k][0]-=p;for(R.sort((k,F)=>k[0]-F[0]),M=C.getNext(x||f>1?s:t,"week",0),!r&&!x&&(x=this.MAX_OCCURRENCES_COUNT);!r||M.getTime()<r;){for(let k=0;k<R.length;k++){_=new Date(M.getFullYear(),M.getMonth(),M.getDate()+R[k][0],v,b,w,D);const F=_.getTime();if(F>=a){const I=this.isInViewMS(e,_,F,l,o,n);if(S++,x&&S>x||r&&F>=r||I&&u.apply(g,[_,S,S===1&&d,n,...h])===!1)return}}M=C.getNext(M,"week",f)}}};y(Nh,"frequency","WEEKLY"),Nh._$name="WeeklyRecurrenceIterator";var Jd=class extends lr{static getNthDayOfMonth(i,e){const t=C.daysInMonth(i);let r=null;return e&&Math.abs(e)<=t&&(r=new Date(i.getFullYear(),i.getMonth(),e<0?t+e+1:e)),r}static isValidPosition(i){return i&&Math.abs(i)>0&&Math.abs(i)<=31}static forEachDate(i){const{startOnly:e,startDate:t,endDate:r,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:l,spansStart:o,recurrence:d,fn:c,extraArgs:u,scope:h=this}=this.processIterationConfig(i),{interval:g,days:f,count:m,positions:p}=d,v=nt.decode(f),b=p&&p.length,w={};let{monthDays:D}=d,S=0,x,R,M,_,k,F;for(R=C.startOf(m||g>1?s:t,"month"),M=new Date(C.getNext(R,"month",1)-1),!(D&&D.length)&&!(v&&v.length)&&(D=[s.getDate()]),v&&v.length&&v.forEach(I=>{I[1]&&(x=x||{},x[I[0]]=I[1])});(!r||r>R)&&(!m||S<m);){if(_=[],v!=null&&v.length){if(v.forEach(I=>{const A=I[0];let P=1,H=53;for(I[1]&&(P=H=I[1]),F=P;F<=H;F++)(k=this.getNthDayInPeriod(R,M,A,F))&&(k=C.copyTimeValues(k,s),w[k.getTime()]||(w[k.getTime()]=!0,_.push(k)))}),_.sort((I,A)=>I-A),!b){for(F=0;F<_.length;F++)if(k=_[F],k>=s){const I=this.isInView(e,k,a,l,n);if(S++,m&&S>m||r&&k>=r||I&&c.apply(h,[k,S,S===1&&o,n,...u])===!1)return!1}}}else{const I=[];for(F=0;F<D.length;F++)(k=this.getNthDayOfMonth(R,D[F]))&&!w[k.getTime()]&&(w[k.getTime()]=!0,I.push(k));for(I.sort((A,P)=>A-P),F=0;F<I.length;F++)if(k=C.copyTimeValues(I[F],s),b)_.push(k);else if(k>=s){const A=this.isInView(e,k,a,l,n);if(S++,m&&S>m||r&&k>=r||A&&c.apply(h,[k,S,S===1&&o,n,...u])===!1)return}}if(b&&_.length&&this.forEachDateAtPositions(_,p,I=>{if(I>=s){const A=e?I>=a:I.valueOf()+l>a&&!n.hasException(I);if(S++,m&&S>m||r&&I>=r||A&&c.apply(h,[I,S,S===1&&o,n,...u])===!1)return!1}})===!1)return!1;R=C.getNext(R,"month",g),M=new Date(C.getNext(R,"month",1)-1)}}};y(Jd,"frequency","MONTHLY"),Jd._$name="MonthlyRecurrenceIterator";var Bh=class extends lr{static forEachDate(i){const{startOnly:e,startDate:t,endDate:r,timeSpan:n,timeSpanStart:s,earliestVisibleDate:a,durationMS:l,spansStart:o,recurrence:d,fn:c,extraArgs:u,scope:h=this}=this.processIterationConfig(i),{interval:g,days:f,count:m,positions:p}=d,v=nt.decode(f),b=p==null?void 0:p.length,w={};let{months:D}=d,S=0,x,R,M,_,k,F;for(_=C.startOf(m||g>1?s:t,"year"),k=new Date(C.getNext(_,"year",1)-1),D==null||D.sort((I,A)=>I-A),!(D!=null&&D.length)&&!(v!=null&&v.length)&&(D=[s.getMonth()+1]),v==null||v.forEach(I=>{I[1]&&(F=F||{},F[I[0]]=I[1])});(!r||r>_)&&(!m||S<m);){if(M=[],f!=null&&f.length&&(D!=null&&D.length))for(const I of D){_=new Date(_.getFullYear(),I-1),k=new Date(_.getFullYear(),I,-1);const A={...i,fn:(P,H,G,...q)=>{if(P>=s){const W=this.isInView(e,P,a,l,n);if(S++,W)return c.apply(h,[P,S,S===1&&G,...q])}},startDate:_,endDate:k,recurrence:d.constructor.new({timeSpan:d.timeSpan,frequency:"MONTHLY",days:f,positions:p})};Jd.forEachDate(A)}else{if(v!=null&&v.length){if(v.forEach(I=>{const A=I[0];let P=1,H=53;for(I[1]&&(P=H=I[1]),x=P;x<=H;x++)(R=this.getNthDayInPeriod(_,k,A,x))&&(R=C.copyTimeValues(R,s),w[R.getTime()]||(w[R.getTime()]=!0,M.push(R)))}),M.sort((I,A)=>I-A),!b){for(x=0;x<M.length;x++)if(R=M[x],R>=s){const I=this.isInView(e,R,a,l,n);if(S++,m&&S>m||r&&R>=r||I&&c.apply(h,[R,S,S===1&&o,n,...u])===!1)return}}}else for(x=0;x<D.length;x++)if((R=this.buildDate(_.getFullYear(),D[x]-1,s.getDate()))&&(R=C.copyTimeValues(R,s),!w[R.getTime()])){if(w[R.getTime()]=!0,b)M.push(R);else if(R>=s){const I=e?R>=a:R.valueOf()+l>a&&!n.hasException(R);if(S++,m&&S>m||r&&R>=r||I&&c.apply(h,[R,S,S===1&&o,n,...u])===!1)return}}if(b&&M.length&&this.forEachDateAtPositions(M,p,I=>{if(I>=s){const A=e?I>=a:I.valueOf()+l>a&&!n.hasException(I);if(S++,A&&(!r||I<r)&&(c.apply(h,[I,S,S===1&&o,n,...u])===!1||m&&S>=m))return!1}})===!1)return!1}_=C.getNext(_,"year",g),k=new Date(C.getNext(_,"year",1)-1)}}};y(Bh,"frequency","YEARLY"),Bh._$name="YearlyRecurrenceIterator";var RD={};[Vh,Nh,Jd,Bh].forEach(i=>{RD[i.frequency]=i});var II={DAILY:"days",WEEKLY:"weeks",MONTHLY:"months",YEARLY:"years"},AI={MO:"Mon",TU:"Tue",WE:"Wed",TH:"Thu",FR:"Fri",SA:"Sat",SU:"Sun"};function gp(i){return i?typeof i=="string"&&(i=i.split(",").map(e=>parseInt(e,10))):i=null,i}function LI(i){return i?typeof i=="string"&&(i=i.split(",")):i=null,i}function zh(i,e){return String(i)===String(e)}function TD(i){return this.defaultValue&&i===void 0?this.defaultValue:this.allowNull&&i==null?null:(i=parseInt(i),isNaN(i)?void 0:i)}var Qd=class extends me{construct(i={}){const e=this,{rule:t,timeSpan:r,laterJsSchedule:n}=i;e._suspendedTimeSpanNotifying=0,delete i.timeSpan,delete i.rule,delete i.laterJsSchedule,super.construct(...arguments),t&&(e.suspendTimeSpanNotifying(),e.rule=t,e.resumeTimeSpanNotifying()),e.timeSpan=r,n&&(e.laterJsSchedule=n)}static processData(i,e,t,r,n){const{fieldMap:s}=this,{name:a,dataSource:l}=s.date;let o=i[l||a];return typeof o=="string"&&(o=s.date.convert(o,i,r)),o&&(Object.assign(i,this.getDateValues(o)),i[l||a]=o),super.processData(i,e,t,r,n)}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(i){this._dateFormat=i}get recurrenceIterator(){return RD[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(i){this._timeSpan=i}get timeSpanDate(){var i;return(i=this.timeSpan)==null?void 0:i.startDate}static getDateValues(i){if(i)return{days:[nt.encodeDay(i.getDay())],monthDays:[i.getDate()],months:[i.getMonth()+1]}}getDateValues(i){return i=this.date||this.timeSpanDate,this.constructor.getDateValues(i)}getRRule(i=!1){var e;const t=this,r=t.date||t.timeSpanDate,n=[];if(t.frequency){n.push(`FREQ=${t.frequency}`);let{days:s,monthDays:a,months:l}=t;if(i&&r){const{days:o,monthDays:d,months:c}=t.constructor.getDateValues(r);switch(t.frequency){case"WEEKLY":s||(s=o);break;case"MONTHLY":a!=null&&a.length||(a=d);break;case"YEARLY":a!=null&&a.length||(a=d),l!=null&&l.length||(l=c);break}}t.interval>1&&n.push(`INTERVAL=${t.interval}`),s!=null&&s.length&&n.push("BYDAY="+s.join(",")),a!=null&&a.length&&n.push("BYMONTHDAY="+a.join(",")),l!=null&&l.length&&n.push("BYMONTH="+l.join(",")),t.count&&n.push(`COUNT=${t.count}`),t.endDate&&n.push("UNTIL="+C.format(t.endDate,t.dateFormat)),(e=t.positions)!=null&&e.length&&n.push("BYSETPOS="+t.positions.join(",")),t.timeZone!=null&&n.push("TZID="+t.timeZone)}return n.join(";")}get rule(){return this.getRRule()}set rule(i){const e=this,t={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null,timeZone:null};if(e.beginBatch(),i){const r=i.split(";");for(let n=0,s=r.length;n<s;n++){const a=r[n].split("="),l=a[1];switch(a[0]){case"FREQ":t.frequency=l;break;case"INTERVAL":t.interval=l;break;case"COUNT":t.count=l,t.until=null;break;case"UNTIL":l?t.endDate=C.parse(l,e.dateFormat):t.endDate=null,t.count=null;break;case"BYDAY":t.days=l;break;case"BYMONTHDAY":t.monthDays=l;break;case"BYMONTH":t.months=l;break;case"BYSETPOS":t.positions=l;break;case"TZID":t.timeZone=l;break}}}e.set(t),i&&e.sanitize(),e.endBatch()}forEachOccurrence(i,e,t){this.timeSpanDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:i,endDate:e,fn(r,n,s,a){return t(a.buildOccurrence(r,s),s,n,r)}})}sanitize(){var i,e;const t=this,{timeSpanDate:r}=t,n={};switch(t.isSanitizingSuspended=!0,t.frequency){case"DAILY":n.positions=null,n.days=null,n.monthDays=null,n.months=null;break;case"WEEKLY":{n.positions=null,n.monthDays=null,n.months=null;const{days:s}=t;r&&(s==null?void 0:s.length)===1&&s[0]===nt.encodeDay(r.getDay())&&(n.days=null);break}case"MONTHLY":{(i=t.monthDays)!=null&&i.length&&(n.positions=null,n.days=null),n.months=null;const{monthDays:s}=t;r&&(s==null?void 0:s.length)===1&&s[0]===r.getDate()&&(n.monthDays=null);break}case"YEARLY":{const{months:s}=t,a=((e=this.days)==null?void 0:e.length)||0;a===7&&(n.days=null),r&&(s==null?void 0:s.length)===1&&!(a&&a<7)&&s[0]===r.getMonth()+1&&(n.months=null);break}}t.set(n),t.isSanitizingSuspended=!1}copy(...i){const e=super.copy(...i);return e.dateFormat=this.dateFormat,e.timeSpan=this.timeSpan,e}afterChange(i,e,t){const r=super.afterChange(i,e,t),{timeSpan:n}=this;return this.isSanitizingSuspended||this.sanitize(),n&&(n.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||n.onRecurrenceChanged(this,...arguments)),r}setValue(i,e){return i==="monthDays"&&Number.isInteger(e)&&(e=[e]),super.setValue(i,e)}set(i,e,...t){const r=typeof i=="object"?i:{[i]:e};return r.count?r.endDate=null:r.endDate&&(r.count=null),super.set(r,void 0,...t)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}reset(){this.allFields.forEach(({name:i})=>this.set(i,null))}set laterJsSchedule(i){var e;if(i=((e=i==null?void 0:i.schedules)==null?void 0:e[0])||i,!i)return;this.reset();const{s:t,m:r,h:n,t:s,D:a,d:l,M:o}=i,d={interval:1};(t||r||n||s)&&(d.frequency="DAILY"),l&&(d.frequency="WEEKLY",d.days=l.map(c=>nt.encodeDay(c-1))),a&&(d.frequency="MONTHLY",d.monthDays=a.map(c=>c||-1)),o&&(d.frequency="YEARLY",d.months=o.slice()),Object.assign(this,d)}get laterJsSchedule(){const{frequency:i,interval:e,days:t,monthDays:r,months:n,positions:s}=this;let a=e>1?`every ${e} ${II[i]} `:"";switch(this.frequency){case"YEARLY":n!=null&&n.length&&(a+=`on the ${n.join(",")} month `);case"MONTHLY":if(r!=null&&r.length){a+=`on the ${r.join(",")} day `;break}case"WEEKLY":t!=null&&t.length&&(a+=`on ${t.map(l=>AI[l]).join(",")} `),s!=null&&s.length&&(a+=`on the ${s.join(",")} day instance `)}return a.trim()}};y(Qd,"$name","RecurrenceModel"),y(Qd,"fields",[{name:"date",type:"date"},{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:TD},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:TD},{name:"days",convert:LI,isEqual:zh},{name:"monthDays",convert:gp,isEqual:zh},{name:"months",convert:gp,isEqual:zh},{name:"positions",convert:gp,isEqual:zh},{name:"timeZone",allowNull:!0}]),Qd._$name="RecurrenceModel";function PI(i){const e={},{dateFormat:t}=this;return i&&(i=typeof i=="string"?i.split(","):B.asArray(i),i.forEach(r=>{typeof r=="string"&&(r=C.parse(r,t)),isNaN(r)||(e[C.makeKey(r)]=1)})),e}function OI(i){const e=[],{dateFormat:t}=this;for(const r in i)i[r]&&e.push(C.format(C.parseKey(r),t));return e}var $I=[],Wh=i=>{var e;return e=class extends(i||xt){get supportsRecurring(){return!0}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:r}=t;t.cancelBatch(),r.beginBatch(),t.detachFromRecurringEvent(),r.endBatch()}else return super.remove(...arguments)}get eventStore(){var t,r;let n=this.isOccurrence&&((t=this.recurringEvent)==null?void 0:t.eventStore)||super.eventStore;return!n&&((r=this.firstStore)!=null&&r.isRecurringTimeSpansMixin)&&(n=this.firstStore),n}get recurrenceModel(){return this._recurrenceModel||Qd}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,r,n){const s=this;let a;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},r&&(t.interval=r),n&&(n instanceof Date?t.endDate=n:t.count=n)),t=new s.recurrenceModel(t)),t.timeSpan=s,a=t.rule),s.recurrence=t,s.recurrenceRule=a}get recurrence(){const t=this,r=t.recurrenceRule;return!t._recurrence&&r&&(t._recurrence=new t.recurrenceModel({rule:r,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const r=this;r._recurrence=t,t?(t.timeSpan=r,r.recurrenceRule=t.rule):r.isOccurrence?r.setData("recurrenceRule",null):r.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,r=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,r)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(r=>{r!==this&&t.push(r)}),t}return $I}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t,r=this.eventStore){const n=t.isTimeSpan?t.occurrenceDate:t;r==null||r.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(C.makeKey(n))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((r,n)=>{C.parseKey(n)>=t&&this.removeOccurrence(r)})}removeOccurrences(t){[this,...this.occurrences].forEach(r=>this.removeOccurrence(r,t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)==null?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(this.removeOccurrences(),t.endDate){const r=C.clearTime(t.endDate),{exceptionDates:n}=this;if(n)for(const s in n)C.parseKey(s)>=r&&delete n[s]}}get occurrenceDate(){var t;return((t=this.meta.modified)==null?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return lr.getOccurrenceIndex(this)}buildOccurrence(t,r){var n,s,a;const l=this,{occurrenceMap:o,recurrence:d,meta:c}=l,u=(n=l.eventStore)==null?void 0:n.globalOccurrences,h=C.makeKey(t),g=l.createRecurrenceKey(t,h),f=!(t-l.startDate),{fieldMap:m}=l.constructor;let p=u==null?void 0:u.get(g),{duration:v}=l;l.endDate&&(l.allDay||!v)&&(v=C.as(l.durationUnit,l.endDate.getTime()-l.startDate.getTime()));const b=v!==void 0?C.add(t,v,l.durationUnit):void 0;return p||(r||f?(p=l,!f&&((s=l.recurrence)==null?void 0:s.timeZone)==null&&(l.preventRecurrenceSync=!0,l._preventInvalidation=(a=l.project)==null?void 0:a.isWritingData,l.setStartEndDate(t,b,!0),l._preventInvalidation=!1,l.preventRecurrenceSync=!1,d.suspendTimeSpanNotifying(),d.sanitize(),d.resumeTimeSpanNotifying()),c.isSyncedWithRule=!0):(p=l.copy({[m.id.dataSource]:g,[m.startDate.dataSource]:t,[m.endDate.dataSource]:b,[m.duration.dataSource]:v,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),p.recurringTimeSpan=l),u==null||u.set(g,p),o.set(h,p)),p}createRecurrenceKey(t=this.startDate,r=null){return`_generated:${this.id}:${r||C.makeKey(t)}`}convertToRealEvent(t,r){var n;if(!this.isOccurrence)return;const s=this,{recurringTimeSpan:a,resource:l,occurrenceIndex:o,recurrence:d}=s,c=d&&a.recurrence.count,u=((n=t==null?void 0:t.resourceRecords)==null?void 0:n.value)||s.data.newResource;a.beginBatch(),s.detachFromRecurringEvent(),s.internalClearChanges(),s._id=s.generateId(a.eventStore),s.setData("id",s._id),u&&delete s.data.resourceId,a.eventStore.add(s,r),c&&(s.recurrence.count=c-o),(u||l)&&s.assign(u||l),u&&delete s.data.resourceRecords,t&&delete t.resourceRecords,a.endBatch()}afterChange(t,r,n,...s){var a,l,o,d,c;const u=this,{eventStore:h}=u;if("recurrenceRule"in r&&(u._recurrence=null,h==null||h.recurringEvents[r.recurrenceRule.value?"add":"delete"](u)),u.isOccurrence)u.convertToRealEvent(r,n);else{if(!u.preventRecurrenceSync&&"startDate"in r&&u.isRecurring&&(h!=null&&h.autoAdjustRecurrence)){const{recurrence:g}=u,{startDate:f}=u,m=r.startDate.oldValue,p=f.getDate(m),v=Math.ceil(p/7),b=f.getDate(),w=f.getDay(),D=nt.encodeDay(w),S=f.getMonth()+1,x=Math.ceil(b/7),R=(a=g.days)==null?void 0:a.slice(),M=(l=g.months)==null?void 0:l.slice(),_=(o=g.monthDays)==null?void 0:o.slice(),k=(d=g.positions)==null?void 0:d.slice();g.beginBatch(),(c=u.getOccurrencesForDateRange(f,C.add(f,1)).filter(F=>!(F.startDate-f)))!=null&&c.length||(R!=null&&R.length&&(B.remove(R,nt.encodeDay(m.getDay())),R.push(D),g.days=R.sort()),_!=null&&_.length&&(B.remove(_,m.getDate()),_.push(b),g.monthDays=_.sort()),k!=null&&k.length&&(B.remove(k,v),k.push(x),g.positions=[...new Set(k)].sort()),M!=null&&M.length&&(B.remove(M,m.getMonth()+1),M.push(S),g.months=[...new Set(M)].sort())),g.endBatch()}"newExceptionDate"in r&&(u.meta.modified.exceptionDates=!0,delete u.meta.modified.newExceptionDate,u.removeOccurrence(r.newExceptionDate.value)),r.recurrenceRule&&!r.recurrenceRule.value&&(u.meta.modified.exceptionDates=!0,u.exceptionDates={})}return super.afterChange(t,r,n,...s)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:r,occurrenceDate:n,startDate:s}=t;t.recurringTimeSpan=null,r.addExceptionDate(n),t.recurrenceRule&&(r.recurrence.endDate=C.add(s,-1,"minute"))}set newExceptionDate(t){if(t){const r=this.exceptionDates||(this.exceptionDates={});r[C.makeKey(t)]=1}}addExceptionDate(t){this.set({newExceptionDate:t})}hasException(t){var r;return!!((r=this.exceptionDates)!=null&&r[C.makeKey(t)])}},y(e,"$name","RecurringTimeSpan"),y(e,"fields",[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:PI,serialize:OI,internal:!0}]),e},HI=1e3*60*60*24,MD=i=>{var e;return e=class extends i{static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}setValue(t,r){var n;if(t==="resource"&&!this.usesSingleAssignment)this.resources=(n=B.asArray(r))!=null?n:[];else return super.setValue(t,r)}get resources(){return this.assignments.reduce((t,{resource:r})=>(r&&t.push(r.$original),t),[])}set resources(t){var r;t=B.asArray(t);const n=this,s=t.map(n.constructor.asId);if(n.usesSingleAssignment)n.set("resourceId",s[0]);else if((r=n.fieldMap)!=null&&r.resourceIds.persist)n.resourceIds=s;else{const a=n.assignments.map(d=>d.resource.id),{onlyInA:l,onlyInB:o}=B.delta(s,a);n.assignmentStore.add(l.map(d=>({resource:d,event:n}))),n.assignmentStore.remove(o.map(d=>n.assignments.find(c=>c.resource.id===d)))}}forEachResource(t,r=this){for(const n of this.resources)if(t.call(r,n)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var t;let r;return this.isOccurrence?r=this.get("startDate"):r=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(r=this.constructor.getAllDayStartDate(r)),r}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var t;let r;return this.isOccurrence?r=this.get("endDate"):r=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(r=this.constructor.getAllDayEndDate(r)),r}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(t,r,n){const s=this,a=s.isPersistable;if(super.endBatch(t,r,n),s.isPersistable&&!a&&!s.ignoreBag&&s.assigned)for(const l of s.assigned)l.stores.forEach(o=>o.updateModifiedBagForRecord(l))}get isCreating(){return super.isCreating}set isCreating(t){var r,n;super.isCreating=t,(r=this.assignmentStore)==null||r.suspendAutoCommit(),this.assignments.forEach(s=>s.isCreating=t),(n=this.assignmentStore)==null||n.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const r=super.copy(...t);return this.usesSingleAssignment||(r.resourceId=null),r}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.assignments[0])==null?void 0:t.resourceId}set resourceId(t){this.applyResourceId(t)}get resourceIds(){var t,r,n;return(t=this.fieldMap)!=null&&t.resourceIds.persist?this.get("resourceIds"):(n=(r=this.resources)==null?void 0:r.map(s=>s.id))!=null?n:[]}set resourceIds(t){this.set("resourceIds",t)}get $linkedResources(){var t,r;return(r=(t=this.resources)==null?void 0:t.flatMap(n=>[n,...n.$links]))!=null?r:[]}applyResourceId(t,r=!1){var n,s;const a=this,{eventStore:l,assignments:o}=a;if(a.isApplyingResourceId){a.setData("resourceId",t);return}if(a.isApplyingResourceId=!0,l){const d=l.assignmentStore||((n=l.crudManager)==null?void 0:n.assignmentStore);if(t!=null)if(a.meta.skipEnforcingSingleAssignment||(l.usesSingleAssignment=!0),o!=null&&o.length&&t!==o[0].resourceId){const c=!!l.eventsSuspended;c&&d.suspendEvents(),o[0].resource=t,c&&d.resumeEvents()}else d.assignEventToResource(a,t);else(a.usesSingleAssignment||(s=a.resourceIds)!=null&&s.length)&&d.remove(o)}else r||a.set({resourceId:t});a.isApplyingResourceId=!1}applyResourceIds(t,r=!1){var n;const s=this,{eventStore:a,assignments:l}=s;if(s.fieldMap.resourceIds.persist===!1)return!1;if(t=[...new Set(t)],a){const o=a.assignmentStore||((n=a.crudManager)==null?void 0:n.assignmentStore);if(t!=null&&t.length)if(l!=null&&l.length){const d=!!a.eventsSuspended;d&&o.suspendEvents(),l.forEach(h=>{const g=t.find(f=>!l.some(m=>m.resourceId===f));g&&(h.resource=g)});const{onlyInA:c,onlyInB:u}=B.delta(t,l.map(h=>h.resourceId));o.add(c.map(h=>({resource:h,event:s}))),o.remove(u.map(h=>l.find(g=>g.resource.id===h))),d&&o.resumeEvents()}else o.add(t.map(d=>({resource:d,event:s})));else o.remove(l)}else r||s.set({resourceIds:t})}applyValue(t,r,n,s,a){if(a&&!this.meta.isAssigning){const{eventStore:l}=this;switch(a.name){case"resourceId":l&&(l.isAssigning=!0),this.applyResourceId(n,!0);break;case"resourceIds":l&&(l.isAssigning=!0),this.applyResourceIds(n,!0);break}l&&(l.isAssigning=!1)}super.applyValue(t,r,n,s,a)}get assignments(){return[...this.assigned||[]]}assign(t,r=!1){const{eventStore:n}=this;if(n&&!n.usesSingleAssignment)return n.assignEventToResource(this,t,r);this.resourceId=this.constructor.asId(t),n||(this.meta.skipEnforcingSingleAssignment=!0)}unassign(t,r=!1){var n;const s=this;t=s.constructor.asId(t),s.meta.removingResource=r,(n=s.eventStore)==null||n.unassignEventFromResource(s,t),s.meta.removingResource=null}reassign(t,r){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,r)}isAssignedTo(t){const r=this.constructor.asId(t);return this.assignments.some(n=>n.resourceId===r)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,r;return[...(t=this.incomingDeps)!=null?t:[],...(r=this.outgoingDeps)!=null?r:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=HI||!t&&this.allDay)return!0;const{endDate:r,startDate:n}=this,s=C.clearTime(n);if(n&&r)return s.setDate(s.getDate()+1),(r||C.add(n,t))>s}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=C.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=C.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),C.clearTime(t,!0)}static getAllDayDisplayEndDate(t,r){return t&&t.isEvent&&(r=t.get("endDate"),t=t.get("startDate")),r&&(t=this.constructor.getAllDayDisplayStartDate(t),C.clearTime(r,!0).valueOf()===r.valueOf()?r=C.add(r,C.DAY,-1):t.valueOf()!==r.valueOf()&&(r=C.clearTime(r,!0))),r}isEditable(t){let r=!0;switch(t){case"endDate":case"duration":case"fullDuration":r=this.isLeaf}return r&&super.isEditable(t)}},y(e,"$name","EventModelMixin"),e},or=class extends De([ol],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var n,s;return(s=(n=this._startDate)!=null?n:this.get("startDate"))!=null?s:null}get endDate(){var n,s;return(s=(n=this._endDate)!=null?n:this.get("endDate"))!=null?s:null}get duration(){var n,s;return(s=(n=this._duration)!=null?n:this.get("duration"))!=null?s:null}set startDate(n){this.proposeStartDate(n)}set endDate(n){this.proposeEndDate(n)}set duration(n){this.proposeDuration(n)}inSet(n,s,a,l,o){const d=this;return d.project&&!d.project.isWritingData&&typeof n!="string"&&!o&&("startDate"in n&&!("startDate"in d.$changed)&&(d.$changed.startDate=!0,d.invalidate()),"endDate"in n&&!("endDate"in d.$changed)&&(d.$changed.endDate=!0,d.invalidate())),e.inSet.call(d,n,s,a,l,o)}getStartDate(){return this.startDate}proposeStartDate(n,s=!("endDate"in this.$changed)){var a;(this.inSetting||(n==null?void 0:n.getTime())!==((a=this.startDate)==null?void 0:a.getTime()))&&(this._startDate=n,this.propose({startDate:n,keepDuration:s}))}async setStartDate(n,s=!0){var a;return this.proposeStartDate(n,s),(a=this.project)==null?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(n,s=!1){var a;(this.inSetting||(n==null?void 0:n.getTime())!==((a=this.endDate)==null?void 0:a.getTime()))&&(this._endDate=n,this.propose({endDate:n,keepDuration:s}))}async setEndDate(n,s=!1){var a;return this.proposeEndDate(n,s),(a=this.project)==null?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(n,s,a=!0){this._duration=n,this.propose({duration:n,keepStart:a}),s&&this.propose({durationUnit:s})}async setDuration(n,s,a=!0){var l;return this.proposeDuration(n,s,a),(l=this.project)==null?void 0:l.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var n,s;const a=this,l=a.$changed,o=a.getCurrentOrProposed("startDate"),d=a.getCurrentOrProposed("endDate"),c=a.getCurrentOrProposed("duration");if(o!=null&&(l.startDate=a._startDate=o),d!=null&&(l.endDate=a._endDate=d),c!=null&&(l.duration=a._duration=c),a.eventStore&&!a.eventStore.isLoadingData){const u=(n=a.assignmentStore)==null?void 0:n.storage.findItem("event",null);if(u){const h=(s=a.assignmentStore)==null?void 0:s.storage.findItem("eventId",a.id);if(h)for(const g of h)g.setChanged("event",a);else for(const g of u)g.getCurrentOrProposed("event")===a.id&&g.setChanged("event",a)}}e.joinProject.call(a)}applyValue(n,s,a,l,o){var d;if((this.project||(d=this.recurringTimeSpan)!=null&&d.project)&&o){const{name:c}=o;(c==="startDate"||c=="duration"||c==="endDate")&&(n=!0,this["_"+c]=a),l&&(n=!1)}e.applyValue.call(this,n,s,a,l,o)}afterChange(n,s,a,l,o){!this.$isCalculating&&!o&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),e.afterChange.call(this,n,s,a,l,o)}calculateInvalidated(){var n,s;const a=this,l=a.$changed,o="startDate"in l,d="endDate"in l,c="duration"in l,{startDate:u,endDate:h,duration:g,keepDuration:f,keepStart:m}=l;let p=null;o&&!d&&!c?u===null?l.endDate=null:a.hasCurrentOrProposed("endDate")&&u>a.getCurrentOrProposed("endDate")&&!f?(l.endDate=u,l.duration=0):a.hasCurrentOrProposed("duration")&&(f||!a.hasCurrentOrProposed("endDate"))?p="endDate":a.hasCurrentOrProposed("endDate")&&(p="duration"):!o&&d&&!c?h===null?l.startDate=null:a.hasCurrentOrProposed("startDate")&&!f&&h!==!0&&h<a.getCurrentOrProposed("startDate")?(l.startDate=h,l.duration=0):a.hasCurrentOrProposed("duration")&&(f||!a.hasCurrentOrProposed("startDate"))?p="startDate":a.hasCurrentOrProposed("startDate")&&(p="duration"):!o&&!d&&c?g===null?l.endDate=null:a.hasCurrentOrProposed("startDate")&&(m||!a.hasCurrentOrProposed("endDate"))?(m&&l.duration<0&&(l.duration=0),p="endDate"):a.hasCurrentOrProposed("endDate")&&(p="startDate"):o&&d&&!c?u===null&&h===null?l.duration=null:p="duration":o&&!d&&c?p="endDate":!o&&d&&c?p="startDate":o&&d&&c&&(g==null?p="duration":u==null?p="startDate":p="endDate");const v=a.getCurrentOrProposed("startDate"),b=a.getCurrentOrProposed("endDate"),w=a.getCurrentOrProposed("duration"),D=a.getCurrentOrProposed("durationUnit"),S=(s=(n=a.getProject())==null?void 0:n.adjustDurationToDST)!=null?s:!1;switch(p){case"startDate":const x=C.add(b,-w,D);if(S){const _=b.getTimezoneOffset()-x.getTimezoneOffset();x.setTime(x.getTime()-_*60*1e3)}l.startDate=x;break;case"endDate":const R=C.add(v,w,D);if(S){const _=v.getTimezoneOffset()-R.getTimezoneOffset();R.setTime(R.getTime()-_*60*1e3)}l.endDate=R;break;case"duration":let M=C.diff(v,b,"millisecond");if(S){const _=v.getTimezoneOffset()-b.getTimezoneOffset();M+=_*60*1e3}l.duration=C.as(D,M,"millisecond");break}"startDate"in l&&l.startDate!==!0&&(this._startDate=l.startDate),"endDate"in l&&l.endDate!==!0&&(this._endDate=l.endDate),"duration"in l&&l.duration!==!0&&(this._duration=l.duration),l.startDate===!0&&delete l.startDate,l.endDate===!0&&delete l.endDate,delete l.keepDuration,delete l.keepStart}}return t}){},_D=class extends De([Xd],i=>{const e=i.prototype;class t extends i{getAssignmentFor(n){var s;for(const a of(s=this.assigned)!=null?s:[])if(a.resource===n)return a;return null}isAssignedTo(n){return!!this.getAssignmentFor(n)}async assign(n){const s=this.project.assignmentStore.modelClass;return this.addAssignment(new s({event:this,resource:n})),this.commitAsync()}async unassign(n){const s=this.getAssignmentFor(n);return this.removeAssignment(s),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const n=this.getEventStore();this.assigned.forEach(s=>n.assignmentsForRemoval.add(s))}e.leaveProject.call(this,...arguments)}remove(){if(this.parent){const n=this.getEventStore();e.remove.call(this),n&&n.afterEventRemoval()}else return e.remove.call(this)}addAssignment(n){return this.getProject().assignmentStore.add(n),n}removeAssignment(n){return this.getProject().assignmentStore.remove(n),n}}return t}){},kD=class extends De([or,_D],i=>{const e=i.prototype;class t extends i{get assigned(){var n,s;return(s=(n=this.project)==null?void 0:n.assignmentStore.getEventsAssignments(this))!=null?s:this.$cachedAssignments}leaveProject(n=!1){this.$cachedAssignments=this.assigned,super.leaveProject(n)}applyValue(n,s,a,l,o){var d;s==="id"&&((d=this.assigned)==null||d.forEach(c=>c.set("eventId",a))),e.applyValue.call(this,n,s,a,l,o)}copy(n=null,s=null){const a=e.copy.call(this,n,s);return(T.isObject(s)&&!s.skipFieldIdentifiers||!T.isObject(s))&&(a.$cachedAssignments=this.assigned),a}}return t}){},FD=class extends De([or],i=>{const e=i.prototype;class t extends i{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const n=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),this.incomingDeps&&this.incomingDeps.forEach(s=>n.dependenciesForRemoval.add(s)),e.leaveProject.call(this)}}return t}){},jh=class extends De([or,kD,FD],i=>{const e=i.prototype;class t extends i{}return t}){},VI=jh,hl=class extends VI.derive(xt).mixin(Wh,ar,MD){};y(hl,"$name","EventModel"),hl.exposeProperties(),hl._$name="EventModel";var NI={splice:1,clear:1},ID=class extends De([ci],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(n){var s;const a=NI[n.action];super.onDataChange(n),a&&((s=n.removed)!=null&&s.length)&&this.afterEventRemoval()}remove(n,s){const a=e.remove.call(this,n,s);return this.afterEventRemoval(),a}removeAll(n){const s=e.removeAll.call(this,n);return this.afterEventRemoval(),s}clear(...n){const s=e.clear.apply(this,n);return this.afterEventRemoval(),s}onNodeRemoveChild(n,s,a,l){const o=e.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),o}afterEventRemoval(){const{assignmentsForRemoval:n,dependenciesForRemoval:s}=this;if(!n)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&n.size){const o=[...n].filter(d=>!a.assignmentsForRemoval.has(d));o.length>0&&a.remove(o)}n.clear();const l=this.getDependencyStore();if(l&&!l.allDependenciesForRemoval&&s.size){const o=[...s].filter(d=>!l.dependenciesForRemoval.has(d));o.length>0&&l.remove(o)}s.clear()}processRecord(n,s=!1){var a;if(!((a=this.project)!=null&&a.isRepopulatingStores)){const l=this.getById(n.id);if(l&&l!==n&&l.assigned)for(const d of l.assigned)d.event=n}return n}}return t}){},fp=class extends De([ID,ul],i=>{const e=i.prototype;class t extends i{static get defaultConfig(){return{modelClass:jh}}joinProject(){var n;(n=this.assignmentStore)==null||n.linkAssignments(this,"event")}afterLoadData(){var n;this.afterEventRemoval(),(n=this.assignmentStore)==null||n.linkAssignments(this,"event")}}return t}){},BI=ar(fp.derive(Dt)),ec=class extends BI.mixin(ED,vD,TI,yD){static get defaultConfig(){return{modelClass:hl}}};y(ec,"$name","EventStore"),ec._$name="EventStore";var tc=T.getPath,ic=(i,e,t,r)=>{t?T.setPath(i,e,r):i[e]=r},AD=(i,e,t,r)=>{var n;r!=null&&r.isModel&&!((n=tc(i,e))!=null&&n.model)&&ic(i,e,t,r)},LD=i=>{var e;return e=class extends i{static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...r){var n,s;t=t?Object.isExtensible(t)?t:Object.assign({},t):{};const{fieldMap:a}=this,l=a.eventId.dataSource,o=a.resourceId.dataSource,d=a.event.dataSource,c=a.resource.dataSource,u=a.eventId.complexMapping,h=a.resourceId.complexMapping,g=a.event.complexMapping,f=a.resource.complexMapping,m=u?tc(t,l):t[l],p=h?tc(t,o):t[o],v=(n=t.event)!=null&&n.isModel?t.event:g?tc(t,d):t[d],b=(s=t.resource)!=null&&s.isModel?t.resource:f?tc(t,c):t[c];if(m!=null)ic(t,d,g,m);else if(v!=null){const w=v.isModel?v.id:v;ic(t,l,u,w)}if(p!=null)ic(t,c,f,p);else if(b!=null){const w=b.isModel?b.id:b;ic(t,o,h,w)}AD(t,d,g,t.event),AD(t,c,f,t.resource),super.construct(t,...r)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,r){let n,s;return t?n=t.isModel?t.id:t:n=this.internalId,r?s=r.isModel?r.id:r:s=this.internalId,`${n}-${s}`}buildIndexKey({event:t,resource:r}){return this.buildEventResourceKey(t,r)}set(t,r,...n){var s,a;const l=this.fieldToKeys(t,r);return"resource"in l?((s=l.resource)==null?void 0:s.id)!==void 0&&(l.resourceId=l.resource.id):"resourceId"in l&&this.constructor.isProAssignmentModel&&(l.resource=l.resourceId),"event"in l?((a=l.event)==null?void 0:a.id)!==void 0&&(l.eventId=l.event.id):"eventId"in l&&this.constructor.isProAssignmentModel&&(l.event=l.eventId),super.set(l,null,...n)}afterChange(t,r,n,s,a){var l,o;const d=this;return!d.constructor.isProAssignmentModel&&(r!=null&&r.resourceId)&&((l=d.resource)==null?void 0:l.id)!==r.resourceId.value?d.resource=r.resourceId.value:d.constructor.isProAssignmentModel&&((o=d.project)!=null&&o.propagatingSyncChanges)&&(r!=null&&r.eventId)&&!(r!=null&&r.event)&&(t.event.value===r.eventId.value||t.event.value.id===r.eventId.value)&&(delete r.eventId,delete d.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:r}=this;r!=null&&r.isModel&&r.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t,r;return(r=(t=this.resource)==null?void 0:t.id)!=null?r:this.get("resourceId")}set eventId(t){const{event:r}=this;r!=null&&r.isModel&&r.id===t?this.set("eventId",t):this.event=t}get eventId(){var t,r;return(r=(t=this.event)==null?void 0:t.id)!=null?r:this.get("eventId")}get eventName(){var t;return(t=this.event)==null?void 0:t.name}get resourceName(){var t;return(t=this.resource)==null?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){const{event:t,resource:r,unjoinedStores:n,assignmentStore:s,eventStore:a}=this,l=s==null?void 0:s.crudManager;let o;return a!=null&&a.usesSingleAssignment?!1:(s?o=this.isValid&&!(t!=null&&t.isCreating)&&(l||!(t!=null&&t.isPhantom)&&!(r!=null&&r.isPhantom)):o=!this.isPhantom&&!!n[0],o&&super.isPersistable&&!(t!=null&&t.isCreating))}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,r,n){var s,a;if(!super.shouldRecordFieldChange(t,r,n))return!1;if(t==="event"||t==="eventId"){const l=(s=this.project)==null?void 0:s.eventStore;if(l&&l.oldIdMap[r]===l.getById(n))return!1}if(t==="resource"||t==="resourceId"){const l=(a=this.project)==null?void 0:a.resourceStore;if(l&&l.oldIdMap[r]===l.getById(n))return!1}return!0}},y(e,"$name","AssignmentModelMixin"),e};function Uh(i){return i!=null&&i.isModel?i.id:i}var Gh=class extends De([ol],i=>{const e=i.prototype;class t extends i{static get fields(){return[{name:"resource",isEqual:(n,s)=>n===s,persist:!1},{name:"event",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){const{assignmentStore:l,eventStore:o,resourceStore:d,project:c}=this;let u=!1;if(n==="event"){const h=Oi(s,or)?s:o==null?void 0:o.$master.getById(s);h&&(u=!0),s=h||s}if(n==="resource"){const h=Oi(s,dl)?s:d==null?void 0:d.$master.getById(s);h&&(u=!0),s=h||s}e.setChanged.call(this,n,s,a,!0),l&&u&&!c.isPerformingCommit&&!l.isLoadingData&&!(d!=null&&d.isLoadingData)&&!l.skipInvalidateIndices&&l.invalidateIndices()}joinProject(){e.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var n,s;let{event:a=this.event,resource:l=this.resource}=this.$changed;if(a!==null&&!Oi(a,or)){const o=(n=this.eventStore)==null?void 0:n.getById(a);o&&this.setChanged("event",o,!1)}if(l!==null&&!Oi(l,dl)){const o=(s=this.resourceStore)==null?void 0:s.getById(l);o&&this.setChanged("resource",o,!1)}}finalizeInvalidated(n){const s=this.$changed;"resource"in s&&(s.resourceId=Uh(s.resource)),"event"in s&&(s.eventId=Uh(s.event)),e.finalizeInvalidated.call(this,n)}set event(n){this.setChanged("event",n),this.setChanged("eventId",Uh(n))}get event(){const n=this.get("event");return(n==null?void 0:n.id)!=null?n:null}set resource(n){this.setChanged("resource",n),this.setChanged("resourceId",Uh(n))}get resource(){const n=this.get("resource");return(n==null?void 0:n.id)!=null?n:null}}return t}){},zI=Gh,gl=class extends LD(ar(zI.derive(me))){};y(gl,"$name","AssignmentModel"),gl.exposeProperties(),gl._$name="AssignmentModel";var PD=i=>{var e;return e=class extends i{static get defaultConfig(){return{loadPriority:300,syncPriority:300,id:"assignments"}}get $lazyLoadPluginClass(){return this.isPaged?Qr:$i}add(t,...r){var n;if(t=B.asArray(t),!!(t!=null&&t.length)){for(let s=0;s<t.length;s++){let a=t[s];if(a instanceof me||(t[s]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${a.eventId} to resource: ${a.resourceId}`);(n=a.event)!=null&&n.isCreating&&(a.isCreating=!0)}return super.add(t,...r)}}includesAssignment(t,r){return this.storage.findIndex("eventResourceKey",`${t}-${r}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined with EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0},onDuplicate(r){console.warn(`Duplicate assignment of event ${r.eventId} to resource ${r.resourceId}`)}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,r){if(!t||!(r!=null&&r.isOccurrence))return t;const n=this;return{id:`${r.id}:a${t.id}`,event:r,resource:t.resource,eventId:r.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(s){return n.occurrenceInstanceMeta(this,s)}}}occurrenceInstanceMeta(t,r){const n=this,s=r.id||r,{id:a}=t;let{occurrenceMeta:l}=n;return l||(l=n.occurrenceMeta={}),l[a]||(l[a]={}),l[a][s]||(l[a][s]={})}mapAssignmentsForEvent(t,r,n){t=this.eventStore.getById(t);const s=!!r,a=!!n;return s||a?t.assignments.reduce((l,o)=>{const d=s?r(o):o;return(!a||n(d))&&l.push(d),l},[]):t.assignments}mapAssignmentsForResource(t,r,n){t=this.resourceStore.getById(t);const s=!!r,a=!!n;return s||a?t.assignments.reduce((l,o)=>{const d=s?r(o):o;return(!a||n(d))&&l.push(d),l},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){return t=this.resourceStore.getById(t),t==null?void 0:t.events}assignEventToResource(t,r,n=null,s=!1){var a,l,o;const d=this,c=s?new Set(t.assignments):null;if(r=B.asArray(r).map(h=>{var g;return(g=h.$original)!=null?g:h}),(a=d.eventStore)!=null&&a.usesSingleAssignment){if((l=t.assignments)!=null&&l.length)return d.isEventAssignedToResource(t,r[0])||(t.resource=r[0]),[];t.resourceId=(o=r[0])==null?void 0:o.id}let u=[];return d.suspendAutoCommit(),r.forEach(h=>{var g;const f=d.getAssignmentForEventAndResource(t,h);if(f)s&&c.delete(f);else{const m={event:t,resource:h};u.push((g=n==null?void 0:n(m))!=null?g:m)}}),u=d.add(u),s&&d.remove(Array.from(c)),d.resumeAutoCommit(),u}unassignEventFromResource(t,r){const n=this,s=[];if(!r)return n.removeAssignmentsForEvent(t);r=B.asArray(r);for(let a=0;a<r.length;a++)n.isEventAssignedToResource(t,r[a])&&s.push(n.getAssignmentForEventAndResource(t,r[a]));return n.remove(s)}isEventAssignedToResource(t,r){return!!this.getAssignmentForEventAndResource(t,r)}getAssignmentForEventAndResource(t,r){let n;return!(t=this.eventStore.getById(t))||!(n=t.assignments)||!(r=this.resourceStore.$master.getById(r))?null:this.getOccurrence(n.find(s=>{var a;return((a=s.resource)==null?void 0:a.$original)===r.$original}),t)}},y(e,"$name","AssignmentStoreMixin"),e},WI=i=>Number(i)!==i,mp=i=>i instanceof Set||i instanceof Array?Jr(i):Jr([i]),OD=i=>new Promise(e=>setTimeout(e,i)),jI=(i,...e)=>i.replace(/{(\d+)}/g,(t,r)=>typeof e[r]!="undefined"?e[r]:t),$D=class extends De([ci],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(n,s){this.assignmentsForRemoval=mp(n).toSet();const a=e.remove.call(this,n,s);return this.assignmentsForRemoval.clear(),a}removeAll(n){this.allAssignmentsForRemoval=!0;const s=e.removeAll.call(this,n);return this.allAssignmentsForRemoval=!1,s}}return t}){},HD=new Set,pp=class extends De([$D,ul],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Gh,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(n){this.allAssignmentsForRemoval=!0,super.data=n,this.allAssignmentsForRemoval=!1}getEventsAssignments(n){return this.storage.findItem("event",n,!0)||HD}getResourcesAssignments(n){return this.storage.findItem("resource",n.$original,!0)||HD}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(n,s){n=n.masterStore||n;const a=this.count&&this.storage.findItem(s,null,!0);if(a){for(const l of a){const o=n.getById(l.getCurrentOrProposed(s));o&&l.setChanged(s,o)}this.invalidateIndices()}}unlinkAssignments(n){this.forEach(s=>{var a,l,o;return s.setChanged(n,(o=(l=(a=s[n])==null?void 0:a.id)!=null?l:s==null?void 0:s.getData(n))!=null?o:s[n+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},UI=ar(pp.derive(Dt)),rc=class extends PD(UI){static get defaultConfig(){return{modelClass:gl}}};y(rc,"$name","AssignmentStore"),rc._$name="AssignmentStore";var GI=["SS","SF","FS","FF"],VD=class xv extends me{static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],r=e[this.fieldMap.to.dataSource],n=this.fieldMap.type.type;if(n&&n!=="int"&&n!=="integer")throw new Error('Dependency type field must be of type "int"');t!=null&&(e.fromEvent=t),r!=null&&(e.toEvent=r),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||((e=this.unjoinedStores[0])==null?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;t!=null&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;t!=null&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,t=this.lagUnit){if(arguments.length===1){typeof e=="number"?this.lag=e:(e=C.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}));return}e=parseFloat(e),this.set({lag:e,lagUnit:t})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${C.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new we({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){typeof e=="string"?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:r}=e,n=t[0];let s;if(n){const{fromEvent:a,toEvent:l}=e,o=n.crudManager;s=a&&(o||!a.hasGeneratedId)&&l&&(o||!l.hasGeneratedId)}else s=!!r[0];return s&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if(e!=null&&e.isScheduled&&(t!=null&&t.isScheduled)){const r=xv.Type;let n,s;switch(this.type){case r.StartToStart:n=e.startDateMS,s=t.startDateMS;break;case r.StartToEnd:n=e.startDateMS,s=t.endDateMS;break;case r.EndToEnd:n=e.endDateMS,s=t.endDateMS;break;case r.EndToStart:n=e.endDateMS,s=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(n,s),end:Math.max(n,s)}}return null}highlight(e){var t,r;const n=(r=(t=this.highlighted)==null?void 0:t.split(" "))!=null?r:[];n.includes(e)||(this.highlighted=n.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const r=t.split(" "),n=r.indexOf(e);n>=0&&(r.splice(n,1),this.highlighted=r.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=GI[this.type];return e?t:this.type===xv.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:t,type:r}=this;return typeof r=="number"&&e&&t&&e!==t}get fromEventName(){var e;return((e=this.fromEvent)==null?void 0:e.name)||""}get toEventName(){var e;return((e=this.toEvent)==null?void 0:e.name)||""}shouldRecordFieldChange(e,t,r){var n;if(!super.shouldRecordFieldChange(e,t,r))return!1;if(e==="from"||e==="to"||e==="fromEvent"||e==="toEvent"){const s=(n=this.project)==null?void 0:n.eventStore;if(s&&s.oldIdMap[t]===s.getById(r))return!1}return!0}get skipCopyFields(){var e,t,r,n;const{fieldMap:s}=this;return{[s.from.dataSource]:!0,[s.to.dataSource]:!0,[(e=s.fromEvent)==null?void 0:e.dataSource]:!0,[(t=s.toEvent)==null?void 0:t.dataSource]:!0,[(r=s.fromTask)==null?void 0:r.dataSource]:!0,[(n=s.toTask)==null?void 0:n.dataSource]:!0}}};y(VD,"$name","DependencyBaseModel");var Kt=VD;Kt.exposeProperties(),Kt._$name="DependencyBaseModel";var Yh=class extends De([ol],i=>{const e=i.prototype;class t extends i{static get fields(){return[{name:"fromEvent",isEqual:(n,s)=>n===s,persist:!1},{name:"toEvent",isEqual:(n,s)=>n===s,persist:!1}]}setChanged(n,s,a){var l,o,d;let c=!1;if(n==="fromEvent"||n==="toEvent"){const u=Oi(s,or)?s:(l=this.eventStore)==null?void 0:l.getById(s);u&&(c=!0),s=u||s}e.setChanged.call(this,n,s,a,!0),c&&!this.project.isPerformingCommit&&!((o=this.dependencyStore)!=null&&o.isLoadingData)&&((d=this.dependencyStore)==null||d.invalidateIndices())}joinProject(){e.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var n,s;let{fromEvent:a,toEvent:l}=this.$changed;if(a!==null&&!Oi(a,or)){const o=(n=this.eventStore)==null?void 0:n.getById(a);o&&(this.$changed.fromEvent=o)}if(l!==null&&!Oi(l,or)){const o=(s=this.eventStore)==null?void 0:s.getById(l);o&&(this.$changed.toEvent=o)}}set fromEvent(n){this.setChanged("fromEvent",n)}get fromEvent(){const n=this.get("fromEvent");return(n==null?void 0:n.id)!=null?n:null}set toEvent(n){this.setChanged("toEvent",n)}get toEvent(){const n=this.get("toEvent");return(n==null?void 0:n.id)!=null?n:null}}return t}){},YI=Yh,mt=class extends ar(YI.derive(Kt)){getTypeFromSides(i,e,t){const r=Kt.Type,n=t?"right":"left",s=t?"left":"right";return i===n?e===n?r.StartToStart:r.StartToEnd:e===s?r.EndToEnd:r.EndToStart}};y(mt,"$name","DependencyModel"),mt.exposeProperties(),mt._$name="DependencyModel";var ND=i=>{var e;return e=class extends i{static get defaultConfig(){return{loadPriority:400,syncPriority:400,id:"dependencies"}}reduceEventDependencies(t,r,n,s=!0,a){return a=a||(l=>this.getEventDependencies(l)),t=B.asArray(t),t.reduce((l,o)=>{o.children&&!s?o.traverse(d=>{l=a(d).reduce(r,l)}):l=a(o).reduce(r,l)},n),n}mapEventDependencies(t,r,n,s,a){return this.reduceEventDependencies(t,(l,o)=>(n(o)&&l.push(o),l),[],s,a)}mapEventPredecessors(t,r,n,s){return this.reduceEventPredecessors(t,(a,l)=>(n(l)&&a.push(l),a),[],s)}mapEventSuccessors(t,r,n,s){return this.reduceEventSuccessors(t,(a,l)=>(n(l)&&a.push(l),a),[],s)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,r){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(r=>t==this.constructor.makeDependencySourceTargetCompositeKey(r.from,r.to))}getDependencyForSourceAndTargetEvents(t,r){return t=me.asId(t),r=me.asId(r),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,r))}getEventsLinkingDependency(t,r){return this.getDependencyForSourceAndTargetEvents(t,r)||this.getDependencyForSourceAndTargetEvents(r,t)}async isValidDependency(t,r,n){let s=t,a=r;return t==null?!1:(t.isDependencyModel&&({fromEvent:s,toEvent:a}=t),s=this.eventStore.getById(s),a=this.eventStore.getById(a),s&&a?!s.project||!a.project?!1:this.project.isValidDependency(s,a,n):t!==r)}isValidDependencyToCreate(t,r,n){return this.isValidDependency(t,r,n)}getHighlightedDependencies(t){return this.records.reduce((r,n)=>(n.isHighlightedWith(t)&&r.push(n),r),[])}static makeDependencySourceTargetCompositeKey(t,r){return`source(${t})-target(${r})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}},y(e,"$name","DependencyStoreMixin"),e},BD=class extends De([ci],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(n,s){this.dependenciesForRemoval=mp(n).toSet();const a=e.remove.call(this,n,s);return this.dependenciesForRemoval.clear(),a}removeAll(n){this.allDependenciesForRemoval=!0;const s=e.removeAll.call(this,n);return this.allDependenciesForRemoval=!1,s}}return t}){},zD=new Set,vp=class extends De([BD,ul],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:Yh,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(n){return this.storage.findItem("toEvent",n)||zD}getOutgoingDepsForEvent(n){return this.storage.findItem("fromEvent",n)||zD}set data(n){this.allDependenciesForRemoval=!0,super.data=n,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},qI=ar(vp.derive(Dt)),qh=class extends ND(qI.derive(Dt)){static get defaultConfig(){return{modelClass:mt}}};qh._$name="DependencyStore";var WD=i=>{var e;return e=class extends i{static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,r,n){const s=[],{storeId:a}=t,l=this.crudLoadValidationMandatoryStores,o={[a]:{}};return r?r.rows||(s.push(`- "${a}" store section should have a "rows" property with an array of the store records.`),o[a].rows=["..."]):l!=null&&l.includes(a)&&(s.push(`- No "${a}" store section found. It should contain the store data.`),o[a].rows=["..."]),s.length&&Object.assign(n,o),s}getLoadResponseWarnings(t,r){const n=[],s={};return this.skipSuccessProperty||(s.success=!0),this.forEachCrudStore((a,l,o)=>{var d;(!((d=r==null?void 0:r.stores)!=null&&d.length)||r.stores.includes(l))&&n.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[l],s))}),n.length&&(n.push(`Please adjust your response to look like this:
`+JSON.stringify(s,null,4).replace(/"\.\.\."/g,"...")),n.push(this.disableValidationNote)),n}validateLoadResponse(t,r){const n=this.getLoadResponseWarnings(t,r);n.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+n.join(`
`))}getStoreSyncResponseWarnings(t,r,n,s){const a=[],l=[],o=[],{storeId:d}=t,c={[d]:{}},u=t.phantomIdField||this.phantomIdField,{modelClass:h}=t.store,{idField:g}=h,f=(n==null?void 0:n.rows)||[],m=(n==null?void 0:n.removed)||[];let p=!1;if(r!=null&&r.added&&(l.push(...r.added.filter(v=>!f.find(b=>b[u]==v[u])&&!m.find(b=>b[u]==v[u]||b[g]==v[u])).map(v=>({[u]:v[u],[g]:"..."}))),l.length)){const v=l.map(b=>"#"+b[u]).join(", ");a.push(`- "${d}" store "rows" section should mention added record(s) ${v} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!l.length&&n&&((typeof n!="object"||Array.isArray(n))&&(a.push(`- "${d}" store section should be an Object.`),c[d]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(a.push(`- "${d}" store "rows" section should be an array`),l.push("...")),n.removed&&!Array.isArray(n.removed)&&(a.push(`- "${d}" store "removed" section should be an array:`),o.push("...")));else{if(r!=null&&r.updated){const v=r.updated.filter(b=>!f.find(w=>w[g]==b[g])).map(b=>({[g]:b[g]}));if(l.push(...v),v.length){const b=v.map(w=>"#"+w[g]).join(", ");a.push(`- "${d}" store "rows" section should mention updated record(s) ${b} sent in the request. It should contain the updated record identifiers.`),p=!0}}if(l.length&&l.push("..."),r!=null&&r.removed&&(o.push(...r.removed.filter(v=>!f.find(b=>b[g]==v[g])).map(v=>({[g]:v[g]}))),o.length)){const v=o.map(b=>"#"+b[g]).join(", ");a.push(`- "${d}" store "removed" section should mention removed record(s) ${v} sent in the request. It should contain the removed record identifiers.`),c[d].removed=o,o.push("..."),p=!0}}return l.length&&(c[d].rows=l),a.length||delete c[d],Object.assign(s,c),{messages:a,showSupportShortSyncResponseNote:p}}getSyncResponseWarnings(t,r){const n=[],s={},a=r.pack;this.skipSuccessProperty||(s.success=!0);let l=!1;return this.forEachCrudStore((o,d,c)=>{const u=this.getStoreSyncResponseWarnings(c,a==null?void 0:a[d],t[d],s);l=l||u.showSupportShortSyncResponseNote,n.push(...u.messages)}),n.length&&(n.push(`Please adjust your response to look like this:
`+JSON.stringify(s,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),l&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(t,r){const n=this.getSyncResponseWarnings(t,r);n.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+n.join(`
`))}},y(e,"$name","AbstractCrudManagerValidation"),e},KI=class extends Error{},jD=class extends KI{constructor(i={}){var e,t;super(i.message||i.request&&O.capitalize((e=i.request)==null?void 0:e.type)+" failed"||"Crud Manager request failed"),Object.assign(this,i),this.action=(t=this.request)==null?void 0:t.type}},UD=function(i,e,t){return i.store&&(i=i.store),e.store&&(e=e.store),i=i[t]||0,e=e[t]||0,i<e?-1:i>e?1:0},XI=function(i,e){return UD(i,e,"loadPriority")},ZI=function(i,e){return UD(i,e,"syncPriority")},yp=i=>{var e;i.$$meta=i.$meta;const t=[];return i.isEvents||t.push(Fe),i.isDelayable||t.push(fe),t.push(WD),e=class extends(i||$).mixin(...t){static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"id",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(r={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(r)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var r,n;return(n=(r=this.transport)==null?void 0:r.load)==null?void 0:n.url}updateLoadUrl(r){T.setPath(this,"transport.load.url",r)}get syncUrl(){var r,n;return(n=(r=this.transport)==null?void 0:r.sync)==null?void 0:n.url}updateSyncUrl(r){T.setPath(this,"transport.sync.url",r)}get shouldIgnoreRemoteChangesInSTM(){return this.ignoreRemoteChangesInSTM}getStoreDescriptor(r){return r?(r instanceof pe?r=r._crudManagerId||r.id:typeof r=="object"&&(r=r.storeId),this.crudStoresIndex[r]):null}fillStoreDescriptor(r){const{store:n}=r,{storeIdProperty:s=this.storeIdProperty,modelClass:a}=n;return r.storeId||(r.storeId=n[s]||n.id),r.idField||(r.idField=a.idField),r.phantomIdField||(r.phantomIdField=a.phantomIdField),r.phantomParentIdField||(r.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in r||(r.writeAllFields=n.writeAllFields),r}updateCrudStoreIndex(){const r=this.crudStoresIndex={};this.crudStores.forEach(n=>n.storeId&&(r[n.storeId]=n))}getCrudStore(r){const n=this.getStoreDescriptor(r);return n==null?void 0:n.store}forEachCrudStore(r,n=this){if(!r)throw new Error("Iterator function must be provided");this.crudStores.every(s=>r.call(n,s.store,s.storeId,s)!==!1)}set crudStores(r){this._crudStores=[],this.addCrudStore(r);for(const n of this._crudStores)n.loadPriority=n.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(r){return this._orderedCrudStores=r}set syncApplySequence(r){this._syncApplySequence=[],this.addStoreToApplySequence(r)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(r){const n=this;let s;return r instanceof pe?s={store:r}:typeof r=="object"?s=r.store?r:{store:new pe(r)}:s={store:pe.getStore(r)},n.fillStoreDescriptor(s),r=s.store,r.setCrudManager&&r.setCrudManager(n,s),r.crudManager=n,r._crudManagerId=s.storeId,r.isAjaxStore&&(r.pageSize=null),(n.loadUrl||n.syncUrl)&&(r.autoCommit=!1,r.autoLoad=!1,(r.createUrl||r.updateUrl||r.deleteUrl||r.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),n.bindCrudStoreListeners(r),s}addCrudStore(r,n,s){var a;if(r=B.asArray(r),!(r!=null&&r.length))return;const l=this,o=r.map(l.internalAddCrudStore,l);typeof n=="undefined"?l.crudStores.push(...o):(s&&((s instanceof pe||typeof s!="object")&&(s=l.getStoreDescriptor(s)),n+=l.crudStores.indexOf(s)),l.crudStores.splice(n,0,...o)),l.orderedCrudStores.push(...o),l.updateCrudStoreIndex(),(a=l.afterAddStore)==null||a.call(l,o)}addPrioritizedStore(r){const n=this;n.hasCrudStore(r)||n.addCrudStore(r,B.findInsertionIndex(r,n.crudStores,XI)),n.hasApplySequenceStore(r)||n.addStoreToApplySequence(r,B.findInsertionIndex(r,n.syncApplySequence,ZI))}hasCrudStore(r){var n;return(n=this.crudStores)==null?void 0:n.some(s=>s===r||s.store===r||s.storeId===r)}removeCrudStore(r){const n=this,{crudStores:s,orderedCrudStores:a}=n,l=n.getStoreDescriptor(r);if(l)n.unbindCrudStoreListeners(l.store),B.remove(s,l),B.remove(a,l),n.removeStoreFromApplySequence(l),delete n.crudStoresIndex[l.storeId];else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(r){r.ion({name:r.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(r){this.detachListeners(r.id)}addStoreToApplySequence(r,n,s){if(!r)return;r=B.asArray(r);const a=this,l=r.reduce((d,c)=>{const u=a.getStoreDescriptor(c);return u&&d.push(u),d},[]);if(typeof n=="undefined")a.syncApplySequence.push(...l);else{let d=n;s&&((s instanceof pe||typeof s!="object")&&(s=a.getStoreDescriptor(s)),d+=a.syncApplySequence.indexOf(s)),a.syncApplySequence.splice(d,0,...l)}const o=a.syncApplySequence.map(({storeId:d})=>d);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(d=>{o.includes(d.storeId)||a.orderedCrudStores.push(d)})}removeStoreFromApplySequence(r){const{syncApplySequence:n}=this,s=this.getStoreDescriptor(r);n&&s&&B.remove(n,s)}hasApplySequenceStore(r){return this.syncApplySequence.some(n=>n===r||n.store===r||n.storeId===r)}onCrudStoreDestroy({source:r}){this.removeCrudStore(r)}onCrudStoreChange(r){const n=this,s=r==null?void 0:r.source;if(s){const a=n.getStoreDescriptor(s);a&&!a.idFieldProcessed&&s.modelClass.idFieldProcessed&&(a.idField=s.modelClass.idField,a.idFieldProcessed=!0)}n.crudIgnoreUpdates||(n.crudStoreHasChanges(r==null?void 0:r.source)?(n.trigger("hasChanges"),n.autoSync&&n.scheduleAutoSync()):n.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++,this.forEachCrudStore(r=>r.suspendAutoCommit())}resumeAutoSync(r=!0){const n=this;n.autoSyncSuspendCounter--,n.forEachCrudStore(s=>s.resumeAutoCommit(r)),n.autoSyncSuspendCounter<=0&&(n.autoSyncSuspendCounter=0,r&&n.autoSync&&n.crudStoreHasChanges()&&n.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const r=this;!r.hasTimeout("autoSync")&&!r.isAutoSyncSuspended&&r.setTimeout({name:"autoSync",fn:()=>{r.sync().catch(n=>{})},delay:r.autoSyncTimeout})}async triggerFailedRequestEvents(r,n,s,a,l){const{options:o,type:d}=r;this.trigger("requestFail",{requestType:d,response:n,responseText:s,requestOptions:a,rawResponse:l,responseOptions:a}),this.trigger(d+"Fail",{response:n,requestOptions:a,responseText:s,options:o,rawResponse:l,responseOptions:a})}async internalOnResponse(r,n,s,a){const l=this,o=n?l.decode(n):null,{options:d,type:c}=r;if(n&&!o&&console.error("Failed to parse response: "+n),!o||(l.skipSuccessProperty?o.success===!1:!o.success))l.triggerFailedRequestEvents(r,o,n,s);else if(l.trigger("beforeResponseApply",{requestType:c,response:o})!==!1&&l.trigger(`before${O.capitalize(c)}Apply`,{response:o,options:d})!==!1){if(l.crudRevision=o.revision,l.afterSyncAttempt(r),await l.applyResponse(r,o,d),l.isDestroyed)return;l.trigger("requestDone",{requestType:c,response:o,requestOptions:s,rawResponse:a,responseOptions:s}),l.trigger(c,{response:o,requestOptions:s,options:d,rawResponse:a,responseOptions:s}),(c==="load"||!l.crudStoreHasChanges())&&(l.trigger("noChanges"),c==="load"&&l.emitCrudStoreEvents(r.pack.stores,"afterRequest"))}return o}afterSyncAttempt(r){var n;for(const s of Object.values(r.pack))(n=s==null?void 0:s.added)==null||n.forEach(a=>a.__record__.isBeingMaterialized=!1)}suspendChangeTracking(){this.crudIgnoreUpdates++,this.crudStores.forEach(({store:r})=>{r.suspendFilterOnUpdate(),r.suspendSortOnUpdate()})}resumeChangeTracking(r){this.crudStores.forEach(({store:n})=>{n.resumeFilterOnUpdate(),n.resumeSortOnUpdate()}),this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!r&&this.onCrudStoreChange()}get isChangeTrackingSuspended(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(r){return r?this.isCrudStoreDirty(this.getCrudStore(r)):this.crudStores.some(n=>this.isCrudStoreDirty(n.store))}isCrudStoreDirty(r){return r.hasChanges}doAutoLoad(){return this.load().catch(r=>{})}emitCrudStoreEvents(r,n,s){const a={action:"read"+n,...s};for(const l of this.crudStores)r.includes(l.storeId)&&l.store.trigger(n,a)}getLoadPackage(r){const n={type:"load",requestId:this.requestId},s=this.crudStores,a=Object.assign({},r);return delete a.request,n.stores=s.map(l=>{var o,d,c;const u=a==null?void 0:a[l.storeId],h=l.isPaged||((o=l.store)==null?void 0:o.isPaged);if(u||h){const g=(c=l.pageSize)!=null?c:(d=l.store)==null?void 0:d.pageSize,f=Object.assign({storeId:l.storeId,page:1},u);return g&&(f.pageSize=g),l.currentPage=f.page,u&&delete a[l.storeId],f}return l.storeId}),Object.assign(n,a),n}loadCrudStore(r,n,s){const a=n==null?void 0:n.rows;s!=null&&s.append||n!=null&&n.append?r.add(a,!1,{clean:!0}):r.data=a,r.trigger("load",{data:a})}loadDataToCrudStore(r,n,s){const a=r.store,l=n==null?void 0:n.rows;a.__loading=!0,l&&this.loadCrudStore(a,n,s,r),a.__loading=!1}loadCrudManagerData(r,n={}){const s=this;s.trigger("beforeLoadCrudManagerData"),s.suspendChangeTracking(),s.crudStores.forEach(a=>{const l=a.storeId,o=r[l];o&&s.loadDataToCrudStore(a,o,n[l])}),s.resumeChangeTracking(!0),s.trigger("loadCrudManagerData")}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(r){typeof r=="string"&&(r={request:{url:r}});const n=this,s=n.getLoadPackage(r);return n._autoLoadPromise=null,new Promise((a,l)=>{if(n.trigger("beforeLoad",{pack:s})!==!1){const{load:o}=n.activeRequests;o&&(n.cancelRequest(o.desc,o.reject),n.trigger("loadCanceled",{pack:s}));const d=Z.assign({id:s.requestId,data:n.encode(s),type:"load",success:n.onCrudRequestSuccess,failure:n.onCrudRequestFailure,thisObj:n},r==null?void 0:r.request);n.activeRequests.load={type:"load",options:r,pack:s,resolve:a,reject(...c){var u;d.success=d.failure=null,(u=c[0])!=null&&u.cancelled||l(...c)},id:s.requestId,desc:n.sendRequest(d)},n.emitCrudStoreEvents(s.stores,"loadStart"),n.trigger("loadStart",{pack:s})}else n.trigger("loadCanceled",{pack:s}),l({cancelled:!0})})}getActiveCrudManagerRequest(r){let n=this.activeRequests[r];return!n&&this.trackResponseType&&(n=Object.values(this.activeRequests)[0]),n}prepareAddedRecordData(r,n){const s=this,{store:a}=n,{isTree:l}=a,o=n.phantomIdField||s.phantomIdField,d=n.phantomParentIdField||s.phantomParentIdField,c=a.modelClass.allFields.filter(g=>g.subStore),u=r.constructor,h=Object.assign(r.persistableData,{[o]:r.id});if(r.$isPhantom=!0,l){const{parent:g}=r;g&&!g.isRoot&&g.isPhantom&&(h[d]=g.id)}return s.resetIdsBeforeSync&&T.deletePath(h,u.idField),c.forEach(g=>{const f=r.get(g.name);f.totalCount&&(h[g.dataSource]={added:f.getRange().map(m=>s.prepareAddedRecordData(m,{store:f}))})}),Object.defineProperty(h,"__record__",{value:r,enumerable:!1}),h}prepareAdded(r,n){return r.filter(s=>s.isValid).map(s=>this.prepareAddedRecordData(s,n))}prepareUpdated(r,n){const{store:s}=n,{isTree:a}=s,l=n.writeAllFields||n.writeAllFields!==!1&&this.writeAllFields,o=n.phantomParentIdField||this.phantomParentIdField,d=s.modelClass.allFields.filter(c=>c.subStore);if(n.store.tree){const c=n.store.rootNode;r=r.filter(u=>u!==c)}return r.filter(c=>c.isValid).reduce((c,u)=>{let h;if(l?h=u.persistableData:h=u.modificationDataToWrite,a){const{parent:g}=u;g&&!g.isRoot&&g.isPhantom&&(h[o]=g.id)}return d.forEach(g=>{const f=u.get(g.name);h[g.dataSource]=this.getCrudStoreChanges({store:f})}),T.isEmpty(h)||c.push(h),c},[])}prepareRemoved(r,{store:n}){var s,a;let l;if(this.includeChildrenInRemoveRequest)l=r;else{l=[];for(const o of r){const d=(a=o.parentId)!=null?a:(s=o.meta.modified)==null?void 0:s.parentId;d!=null&&(d===n.rootNode.id||!r.some(c=>c.id===d))&&l.push(o)}}return l.map(o=>T.setPath({},o.constructor.idField,o.id))}getCrudStoreChanges(r){var n,s;const{store:a}=r;let{added:l=[],modified:o=[],removed:d=[]}=a.changes||{},c;return l.length&&(l=this.prepareAdded(l,r)),(o.length||(n=a.modifiedMaterialized)!=null&&n.size)&&(o=this.prepareUpdated([...o,...(s=a.modifiedMaterialized)!=null?s:[]],r)),d.length&&(d=this.prepareRemoved(d,r)),(l.length||o.length||d.length)&&(c={},l.length&&(c.added=l),o.length&&(c.updated=o),d.length&&(c.removed=d)),c}getChangesetPackage(){const{changes:r}=this;return r||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...r}:null}get changes(){const r={};return this.crudStores.forEach(n=>{const s=this.getCrudStoreChanges(n);s&&(r[n.storeId]=s)}),Object.keys(r).length>0?r:null}isFieldValueEqual(r,n,s){return r!=null&&r.isEqual?r.isEqual(n,s):T.isEqual(n,s)}processRecordResponse(r,n,s,a,l,o){const d=r.syncConflictResolution||this.syncConflictResolution,{fieldDataSourceMap:c}=r.store.modelClass,{idField:u,phantomIdField:h=this.phantomIdField}=r;let g={};if(d==="local")for(const[f,m]of Object.entries(l)){let p=!1;const v=c[f];if(v&&(n||o)){const b=n?n.getFieldPersistentValue(v):o[f];let w=f in a,D=a[f];f===u&&a[h]&&(w=w||h in a,D=a[h]),p=w&&!this.isFieldValueEqual(v,D,b)||f!==u&&this.isFieldValueEqual(v,m,b)}p||T.setPath(g,f,m)}else g=s;return g}getRecordChangesToClear(r,n,s){const{store:a}=r,{fieldDataSourceMap:l}=a.modelClass,o=a.isTree&&a.modelClass.parentIdField;let d=!1,c;if(s){c={};for(const[u,h]of Object.entries(n)){let g=l[u];!g&&u===o&&(g={name:"parentId"}),g&&u in s&&this.isFieldValueEqual(g,h,s[u])&&(c[g.name]=!0,d=!0)}}return d?c:null}processStoreResponse(r,n,s){const a=this,{supportShortSyncResponse:l}=a,{idField:o,store:d,phantomIdField:c=a.phantomIdField}=r,{addedMap:u,updatedMap:h,removedMap:g}=a.buildStoreSyncRequestMaps(r,s,n),f=new Map,m=new Map,p=[],v=[],b=new Set;for(const w of(n==null?void 0:n.rows)||[]){const D=T.getPath(w,o),S=T.getPath(w,c),x=u.get(S)||h.get(D),R=d.getById(S||D)||d.removed.get(S||D),M=R==null?void 0:R.modificationDataToWrite,_=T.pathifyKeys(x),k=T.pathifyKeys(w),F=a.processRecordResponse(r,R,w,_,k,M);F&&(D&&f.set(D,F),S&&f.set(S,F),R?v.push(F):p.push(F))}for(const w of[...u.values(),...h.values()]){const D=T.getPath(w,c),S=T.getPath(w,o),x=d.getById(D||S)||d.removed.get(D||S);x&&(l||f.has(S)||f.has(D))&&m.set(x,a.getRecordChangesToClear(r,T.pathifyKeys(w),x.modificationDataToWrite))}for(const w of[...(n==null?void 0:n.removed)||[],...a.supportShortSyncResponse?g.values():[]]){const D=T.getPath(w,o);(d.getById(D)||d.removed.includes(D))&&!f.has(D)&&b.add(D)}return{added:p,updated:v,removed:[...b].map(w=>({[o]:w})),clearChanges:m}}buildStoreSyncRequestMaps({idField:r,phantomIdField:n=this.phantomIdField},s){const a=new Map,l=new Map,o=new Map;if(s){for(const d of s.added||[]){const c=T.getPath(d,n);a.set(c,d)}for(const d of s.updated||[]){const c=T.getPath(d,r);l.set(c,d)}for(const d of s.removed||[]){const c=T.getPath(d,r);o.set(c,d)}}return{addedMap:a,updatedMap:l,removedMap:o}}applyChangesToStore(r,n,s){var a,l,o;const d=this,c=r.phantomIdField||d.phantomIdField,{store:u}=r,h=u.modelClass.getFieldDataSource("id"),g=u.modelClass.allFields.filter(D=>D.subStore),{added:f,updated:m,removed:p,clearChanges:v}=d.processStoreResponse(r,n,s),b=[];if(m.length&&g.length)for(const D of m){const S=u.getById((a=D[c])!=null?a:D[h]),x=((l=s.added)==null?void 0:l.find(M=>M[c]==D[c]))||((o=s.updated)==null?void 0:o.find(M=>M[h]==D[h])),R={};for(const M of g){const{dataSource:_}=M,k=d.fillStoreDescriptor({store:S.get(M.name)});d.applyChangesToStore(k,D[_],x==null?void 0:x[_]),R[_]="foo",delete D[_]}b.push([S,R])}let w;(p.length||f.length||m.length)&&(w=u.applyChangeset({removed:p,added:f,updated:m},null,c,!0,!0)),b.forEach(([D,S])=>Object.assign(w.get(D.id),S));for(const[D,S]of v)S&&(D.isModel?D:u.getById(D)).internalClearChanges(!1,!0,S);return u.trigger("appliedCrudChangesToStore",{crudManager:d}),w}applySyncResponse(r,n){var s;const a=this,{orderedCrudStores:l,supportShortSyncResponse:o}=a;a.applyingChangeset=a.applyingSyncResponse=!0,a.suspendChangeTracking();for(const d of l){const c=r[d.storeId];(c||o)&&a.applyChangesToStore(d,c,(s=n==null?void 0:n.pack)==null?void 0:s[d.storeId])}a.resumeChangeTracking(!0),a.applyingChangeset=a.applyingSyncResponse=!1}applyLoadResponse(r,n){this.applyingLoadResponse=!0,this.loadCrudManagerData(r,n),this.applyingLoadResponse=!1}async applyResponse(r,n,s){const a=this;switch(a.trackResponseType&&n.type||r.type){case"load":a.validateResponse&&a.validateLoadResponse(n,s),a.applyLoadResponse(n,s);break;case"sync":a.validateResponse&&a.validateSyncResponse(n,r),a.applySyncResponse(n,r);break}}applyChangeset(r,n=null,s,a=!1){const l=this,o=a?new Map:void 0;l.applyingChangeset=!0,l.suspendAutoSync(),l.suspendChangeTracking();for(const{store:d,phantomIdField:c}of l.orderedCrudStores)if(r[d.id]){const u=d.applyChangeset(r[d.id],n,c||l.phantomIdField,!0,a);u&&o.set(d.id,u)}return l.applyingChangeset=!1,l.resumeChangeTracking(!0),l.resumeAutoSync(!1),o}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const r=this;return r.clearTimeout("autoSync"),r.activeRequests.sync?(r.trigger("syncDelayed"),r.activeSyncPromise=r.activeSyncPromise.finally(()=>r.sync())):r.activeSyncPromise=new Promise((n,s)=>{var a;const l=r.getChangesetPackage();if(!l){n(null);return}this.forEachCrudStore(d=>{var c;return(c=d.modifiedMaterialized)==null?void 0:c.clear()});for(const d of Object.values(l))(a=d==null?void 0:d.added)==null||a.forEach(c=>c.__record__.isBeingMaterialized=!0);r.activeRequests.sync={type:"sync",pack:l,resolve:n,reject:s,desc:null,id:l.requestId};const o=r.trigger("beforeSync",{pack:l});Promise.resolve(o).then(d=>{var c,u;d!==!1?(r.trigger("syncStart",{pack:l}),(c=r.eventStore)!=null&&c.usesSingleAssignment&&((u=r.assignmentStore)==null||u.acceptChanges()),r.activeRequests.sync.desc=r.sendRequest({id:l.requestId,data:r.encode(l),type:"sync",success:r.onCrudRequestSuccess,failure:r.onCrudRequestFailure,thisObj:r})):(r.trigger("syncCanceled",{pack:l}),r.activeRequests.sync=null,s({cancelled:!0}))}).catch(d=>{r.activeRequests.sync=null,s(d)})}).catch(n=>{if(n&&!n.cancelled)throw n;return n})}async onCrudRequestSuccess(r,n,s){const a=this,{type:l,id:o}=s;if(a.isDestroyed)return;let d="";s=a.activeRequests[l];try{d=await r.text()}catch(u){}if(a.isDestroyed)return;if((s==null?void 0:s.id)!==o)throw new Error(`Interleaved ${l} operation detected`);a.activeRequests[l]=null;const c=await a.internalOnResponse(s,d,n,r);if(!a.isDestroyed){if(!c||(a.skipSuccessProperty?(c==null?void 0:c.success)===!1:!(c!=null&&c.success))){const u={rawResponse:r,response:c,request:s};c!=null&&c.message&&(u.message=c.message),s.reject(new jD(u))}a["crud"+O.capitalize(s.type)+"ed"]=!0,s.resolve({response:c,rawResponse:r,responseText:d,request:s})}}async onCrudRequestFailure(r,n,s){var a;const l=this;if(l.isDestroyed)return;s=l.activeRequests[s.type];const o=(a=n==null?void 0:n.abortController)==null?void 0:a.signal,d=!!(o!=null&&o.aborted);if(l.afterSyncAttempt(s),!d){let c,u="";try{u=await r.text(),c=l.decode(u)}catch(h){}if(l.isDestroyed||(l.triggerFailedRequestEvents(s,c,u,n,r),l.isDestroyed))return;s.reject(new jD({rawResponse:r,request:s}))}l.activeRequests[s.type]=null}acceptChanges(){this.crudStores.forEach(({store:r})=>r.acceptChanges()),this.trigger("acceptChanges")}revertChanges(){this.revertCrudStoreChanges(),this.trigger("revertChanges")}revertCrudStoreChanges(){const{usesSingleAssignment:r}=this.eventStore;this.orderedCrudStores.forEach(({store:n})=>(!n.isAssignmentStore||!r)&&n.revertChanges())}doDestroy(){const r=this,{load:n,sync:s}=r.activeRequests;for(n&&r.cancelRequest(n.desc,n.reject),s&&r.cancelRequest(s.desc,s.reject);r.crudStores.length>0;)r.removeCrudStore(r.crudStores[0]);super.doDestroy&&super.doDestroy()}get crudStoresJSON(){var r;const n={};return this.forEachCrudStore((s,a)=>n[`${a}Data`]=s.toJSON()),(r=this.assignmentStore)!=null&&r.usesSingleAssignment&&delete n.assignmentsData,n}set crudStoresJSON(r){this.forEachCrudStore((n,s)=>{const a=`${s}Data`;r[a]&&(n.data=r[a])})}},y(e,"$name","AbstractCrudManagerMixin"),y(e,"configurable",{loadUrl:null,syncUrl:null,forceSync:null,ignoreRemoteChangesInSTM:!1,includeChildrenInRemoveRequest:!0,syncConflictResolution:"local"}),y(e,"delayable",{doAutoLoad:"raf"}),e},bp=i=>{var e;return e=class extends(i||$){static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,r){var n;(n=t.abort)==null||n.call(t),this.isDestroying||r==null||r({cancelled:!0})}shouldUseBodyForRequestData(t,r,n){return!(r==="HEAD"||r==="GET")&&!n}sendRequest(t){const r=this,{data:n}=t,s=r.transport[t.type]||{},a=Z.assign({},s);t.url&&(a.url=t.url),a.method=a.method||e.defaultMethod[t.type],a.params=Z.assign(a.params||{},t.params);let{paramName:l}=a;if(r.shouldUseBodyForRequestData(s,a.method,l)?(a.body=n,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(l=l||"data",a.params[l]=n),!a.url)throw new Error("Trying to request without URL specified");delete a.paramName;let o,d;function c(){a.queryParams=a.params,delete a.params;let h=!1;const g=Z.assign({},a);return o=kt.fetch(a.url,g),o.catch(f=>{var m,p;o.done=!0,(m=r.trigger)==null||m.call(r,"responseReceived",{success:!1});const v=(p=g.abortController)==null?void 0:p.signal;return v&&(h=v.aborted,h||console.warn(f)),{error:f,cancelled:h}}).then(f=>{var m;o.done=!0,(m=r.trigger)==null||m.call(r,"responseReceived",{success:!!(f!=null&&f.ok)});const p=f!=null&&f.ok?t.success:t.failure;return p==null?void 0:p.call(t.thisObj||r,f,g,t)})}const u=r.trigger("beforeSend",{params:a.params,requestType:t.type,requestConfig:a,config:t});return Z.isPromise(u)?d=u.then(c):d=c(),d.abort=()=>{var h;o.done||((h=o.abort)==null||h.call(o),d.aborted=!0)},d}},y(e,"$name","AjaxTransport"),e},Cp=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{encoder:{}}}encode(t){var r;return t=Object.assign({},(r=this.encoder)==null?void 0:r.requestData,t),O.safeJsonStringify(t)}decode(t){return O.safeJsonParse(t)}},y(e,"$name","JsonEncoder"),e},GD=i=>class extends(i||$).mixin(yp,bp,Cp){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const r=this,{project:n}=r;r.applyingProjectResponse=!0,"$input"in t&&(t=t.$input);const s=n.fieldMap.startDate,a=n.fieldMap.endDate,l=T.getPath(t,s.dataSource),o=T.getPath(t,a.dataSource);typeof l=="string"&&T.setPath(t,s.dataSource,s.convert(l)),typeof o=="string"&&T.setPath(t,a.dataSource,a.convert(o)),n.setByDataSource(t),r._changesToClear.set(r,t),r.applyingProjectResponse=!1}async loadCrudManagerData(t,r={}){const n=this,{project:s}=n;n.suspendChangeTracking(),await super.loadCrudManagerData(...arguments),t!=null&&t.project&&(s.delayEnteringReplica&&s.hasDataInStores?s.ion({recordsUnlinked:()=>{n.suspendChangeTracking(),n.applyProjectResponse(t.project),n.resumeChangeTracking()},once:!0}):n.applyProjectResponse(t.project)),n.resumeChangeTracking(),await(s==null?void 0:s.commitAsync())}async sync(){const{project:t}=this;if(this.suspendAutoSync(),this.suspendChangeTracking(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeChangeTracking(!0),this.resumeAutoSync(!1),super.sync()}async applyResponse(t,r,n){var s,a,l,o,d,c,u,h;const g=this;if(g.isDestroyed||(s=g.project)!=null&&s.isDestroyed)return;g.trigger("beforeApplyResponse"),g.crudStores.forEach(m=>m.store.suspendFilterOnUpdate());const f=(r==null?void 0:r.project)||g.supportShortSyncResponse&&((a=t==null?void 0:t.pack)==null?void 0:a.project);if(f){const m={};f.startDate&&(m.startDate=f.startDate),f.endDate&&(m.endDate=f.endDate),f.calendar&&(m.calendar=(o=(l=g.project)==null?void 0:l.getCalendarById(f.calendar))!=null?o:f.calendar,delete f.calendar),g.applyProjectResponse(m)}if(await super.applyResponse(t,r,n),f){const m=g._changesToClear.get(g);g.applyProjectResponse(f),g._changesToClear.set(g,T.assign({},m,f))}if(g.project){let m=t.type;g.trackResponseType&&(m=r.type||m);const p=`propagating${O.capitalize(m)}Changes`;g.suspendAutoSync(),g[p]=!0;const v=g.project.isInitialCommit&&!g.project.silenceInitialCommit;await g.project.commitAsync(),g[p]=!1,(d=g.resumeAutoSync)==null||d.call(g,v),(c=g.commitRespondedChanges)==null||c.call(g)}(u=g.crudStores)==null||u.forEach(m=>m.store.resumeFilterOnUpdate()),(h=g.trigger)==null||h.call(g,"applyResponse",{request:t,response:r,options:n})}applySyncResponse(...t){var r;const n=this,s=(r=n.project)==null?void 0:r.stm.disabled;s===!1&&n.shouldIgnoreRemoteChangesInSTM&&n.project.stm.disable(),n.suspendAutoSync(),super.applySyncResponse(...t),n.resumeAutoSync(!1),s===!1&&n.project.stm.enable()}shouldClearRecordFieldChange(t,r,n){const s=t.getValue(r);return r=t.getFieldDefinition(r),r!=null&&r.isEqual?r.isEqual(s,n):T.isEqual(s,n)}commitRespondedChanges(){this._changesToClear.forEach((t,r)=>{Object.entries(t).forEach(([n,s])=>{!(r===this&&this.project!==this)&&this.shouldClearRecordFieldChange(r,n,s)&&delete r.meta.modified[n]})}),this._changesToClear.clear()}applyChangesToStore(t,r,n,...s){const a=super.applyChangesToStore(t,r,n,...s);if(a!=null&&a.size&&this.project)for(const[l,o]of a){const d=t.store.getById(l);d&&this._changesToClear.set(d,o)}return a}},YD=["events","resourceTimeRanges","assignments","timeRanges"],qD=i=>{var e;return e=class extends(i||$){updateRemotePaging(t,r){t?this.lazyLoad=!0:r&&(this.lazyLoad=!1)}updatePageSize(){this.isConfiguring||this.load()}updateLazyLoad(t,r){if(!t&&!r)return;const n=this,{internalLoad:s,crudStores:a}=n;a.forEach(({store:l})=>n.storeShouldLazyLoad(l)&&n.setupLazyStore(l)),t?s||(n.internalLoad=n.load,n.load=n.internalLazyLoad):s&&(n.load=s)}afterAddStore(t){t.forEach(({store:r})=>this.storeShouldLazyLoad(r)&&this.setupLazyStore(r))}setupPagingStore(t){if(this.remotePaging){const{isResourceStore:r}=t;t.remotePaging=!0,t.syncDataOnLoad=!1,r?t._pageSize=this.pageSize:(t.lazyLoad=!0,t.lazyLoad.$isCrudManager=!0),r||t.isEventStore?t.requestData=n=>this.requestData(n,r):t.requestData=null}else t.remotePaging=!1}setupLazyStore(t){var r;if(this.remotePaging)return this.setupPagingStore(t);let{lazyLoad:n}=this;if(n){const{isResourceStore:s}=t;if(n!==!0){const{chunkSize:a,bufferUnit:l,bufferAmount:o}=n;n={},s&&a?n.chunkSize=a:s||(l&&(n.bufferUnit=l),o&&(n.bufferAmount=o))}t.lazyLoad=n,t.lazyLoad.$isCrudManager=!0,t.syncDataOnLoad=!1,s||t.isEventStore?t.requestData=a=>this.requestData(a,s):t.requestData=null}else(r=t.lazyLoad)!=null&&r.$isCrudManager&&(t.lazyLoad=!1)}internalLazyLoad(){return this.crudLoaded=!1,this.resourceStore.load()}loadCrudStore(t,r,n){if(!(this.lazyLoad&&this.storeShouldLazyLoad(t)))return super.loadCrudStore(t,r,n)}getLazyDateStores(t){return this.crudStores.filter(r=>YD.includes(r.storeId)&&(!t||!r.store.isEventStore))}storeShouldLazyLoad(t){return t.isResourceStore||this.getLazyDateStores().some(r=>r.store===t)}async requestData(t,r){if(!t.startDate||!t.endDate)return;const n=this,s=n.getLazyDateStores(!r),a=r&&n.resourceStore.isTree,l=n._lazyRequestPromises||(n._lazyRequestPromises=[]),o={type:"load",params:t,stores:n.crudStores.filter(f=>!n.crudLoaded||YD.includes(f.storeId)||r&&f.store.isResourceStore).map(f=>f.storeId)},d=Promise.all(l).then(()=>n.internalLoad(o)),c={...t,promise:d};a&&(c.startIndex=-1,c.count=1),s.forEach(({store:f})=>{r&&(n.remotePaging||!n.resourceStore.count)&&(f.clear(!0),f.lazyLoad.clear()),f.lazyLoad.addToQueue(c),f.lazyLoad.triggerLazyLoadStart()}),l.push(d);const{response:u}=await d,{rows:h,total:g}=r?u.resources:u.events;if(a){const{idField:f}=n.resourceStore.modelClass;c.resourceIds=h.map(m=>m[f])}return s.forEach(({store:{lazyLoad:f},storeId:m})=>{var p;a&&(delete f.loadQueue[-1],f.addToQueue(c)),f.addData((p=u[m])==null?void 0:p.rows,c),f.triggerLazyLoadEnd()}),l.splice(l.indexOf(d),1),{data:h,total:r?g:void 0}}},y(e,"$name","LazyLoadCrudManager"),y(e,"configurable",{lazyLoad:!1,remotePaging:!1,pageSize:50}),e},wp=class extends $.mixin(yp){get revision(){return this.crudRevision}set revision(i){this.crudRevision=i}get json(){const i=this.crudStoresJSON;return O.safeJsonStringify(i)}set json(i){typeof i=="string"&&(i=O.safeJsonParse(i)),this.crudStoresJSON=i}static get defaultConfig(){return{stores:null}}construct(i={}){i.stores&&(i.crudStores=i.stores,delete i.stores),super.construct(i)}toJSON(){return this.crudStoresJSON}get inlineData(){return this.crudStoresJSON}set inlineData(i){this.crudStoresJSON=i}set stores(i){i!==this.crudStores&&(this.crudStores=i)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...i){return this.addCrudStore(...i)}removeStore(...i){return this.removeCrudStore(...i)}getStore(...i){return this.getCrudStore(...i)}hasChanges(...i){return this.crudStoreHasChanges(...i)}loadData(...i){return this.loadCrudManagerData(...i)}};wp._$name="AbstractCrudManager";var KD=i=>{var e;return e=class extends(i||me){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null,json:null,shouldSyncDataOnLoad:null,toJSONResultFormat:"inlineData",useRawData:null}}static get autoExposeFields(){return!1}attachStore(t){super.attachStore(t),this.useRawData!=null&&(t.useRawData=this.useRawData)}toJSON(){switch(this.toJSONResultFormat){case"inlineData":return this.inlineData;case"model":return super.toJSON()}}get inlineData(){const t=this;let r;return t.isAbstractCrudManagerMixin?r=t.crudStoresJSON:r={eventsData:t.eventStore.toJSON(),resourcesData:t.resourceStore.toJSON(),dependenciesData:t.dependencyStore.toJSON(),timeRangesData:t.timeRangeStore.toJSON(),resourceTimeRangesData:t.resourceTimeRangeStore.toJSON(),assignmentsData:t.assignmentStore.toJSON()},t.eventStore.usesSingleAssignment&&r.assignmentsData&&delete r.assignmentsData,r.project=super.toJSON(),T.deletePath(r,"project.id"),T.deletePath(r,"project.children"),r}set inlineData(t){this.loadInlineData(t)}get json(){const{toJSONResultFormat:t}=this;this.toJSONResultFormat="inlineData";const r=super.json;return this.toJSONResultFormat=t,r}changeJson(t){return typeof t=="string"&&(t=O.safeJsonParse(t)),t}updateJson(t){t&&this.loadInlineData(t)}get assignments(){return this.assignmentStore.allRecords}updateAssignments(t){this.assignmentStore.data=t}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(t){this.dependencyStore.data=t}get resources(){return this.resourceStore.allRecords}updateResources(t){this.resourceStore.data=t}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(t,r){const n=this.timeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(t,r)):a.startDate<r&&t<a.endDate&&s.push(a);return s}updateTimeRanges(t){this.timeRangeStore.data=t}getResourceTimeRanges(t,r){const n=this.resourceTimeRangeStore,s=[];for(const a of n)a.isRecurring?s.push(...a.getOccurrencesForDateRange(t,r)):a.startDate<r&&(!a.endDate||t<a.endDate)&&s.push(a);return s}},y(e,"$name","ProjectModelCommon"),e},dr=class extends xt.mixin(Wh){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};y(dr,"$name","ResourceTimeRangeModel"),y(dr,"fields",["resourceId","timeRangeColor"]),y(dr,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),y(dr,"domIdPrefix","resourcetimerange"),dr._$name="ResourceTimeRangeModel";var fl=class extends Dt.mixin(Hh){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:dr,id:"resourceTimeRanges",project:null}}get $lazyLoadPluginClass(){return this.isPaged?Qr:$i}set project(i){var e;super.project=i,!this.resourceStore&&((e=i==null?void 0:i.resourceStore)!=null&&e.isStore)&&(this.resourceStore=i.resourceStore)}get project(){return super.project}set resourceStore(i){this._resourceStore=i,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(i){return[i.resource]}getRanges({resourceRecord:i,startDate:e,endDate:t}){return i.timeRanges.flatMap(n=>n.isRecurring?n.getOccurrencesForDateRange(e,t):n.intersectsRange(e,t)?n:[]).sort((n,s)=>n.startDate-s.startDate)}};y(fl,"$name","ResourceTimeRangeStore"),fl._$name="ResourceTimeRangeStore";var nc=class extends ie{static get pluginConfig(){return{before:["processRecord"],assign:["beforeSyncRecord","afterSyncRecord"],override:["getOccurrencesForTimeSpan"]}}get timeZone(){return this.client.project.timeZone}processRecord(i,e){(e||this.client.isLoadingData||i.timeZone!==void 0)&&this.convertRecordToTimeZone(i)}convertRecordToTimeZone(i,e=this.timeZone){var t;if(i.timeZone!==e){if((t=i.baselines)!=null&&t.count)for(const r of i.baselines)i.timeZone!==r.timeZone&&(r.timeZone=i.timeZone),r.convertToTimeZone(e);i.isRecurring&&i.removeOccurrences(),i.convertToTimeZone(e)}}beforeSyncRecord({record:i,data:e}){if(i.timeZone!=null){let t;!i.manuallyScheduled&&i.constraintDate&&!e.constraintDate&&(t=["constraintDate"]),i.$restoreTimeZone=i.timeZone,i.convertToTimeZone(null,t)}}afterSyncRecord({record:i,data:e}){if(i.$restoreTimeZone){let t;!i.manuallyScheduled&&i.constraintDate&&!e.constraintDate&&(t=["constraintDate"]),i.convertToTimeZone(i.$restoreTimeZone,t),i.$restoreTimeZone=null}}getOccurrencesForTimeSpan(i,e,t){let r=[];if(i.isRecurring){const{timeZone:n}=i.recurrence,s=i.timeZone;let a;if(n!=null&&s!=n&&(!i.project||s==i.project.timeZone)){a=i.startDate;const l=$e.toTimeZone(i.getLocalDate("startDate"),n);i.isResourceTimeRange?i.setData("startDate",l):i._startDate=l}r=this.overridden.getOccurrencesForTimeSpan(i,e,t),a!=null&&(i.isResourceTimeRange?i.setData("startDate",a):i._startDate=a,r.forEach(l=>{if(l!==i){let o=$e.fromTimeZone(l.startDate,n),d=$e.fromTimeZone(l.endDate,n);s!=null&&(o=$e.toTimeZone(o,s),d=$e.toTimeZone(d,s)),l.setData({startDate:o,endDate:d})}}))}return r}};y(nc,"$name","storeTimeZonePlugin"),nc._$name="StoreTimeZonePlugin";var XD=i=>{var e;return e=class extends(i||me){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(t=>t)}plugStore(t){var r;((r=t.hasPlugin)==null?void 0:r.call(t,nc))===!1&&t.addPlugins(nc)}unplugStore(t){var r;(r=t.plugins.storeTimeZonePlugin)==null||r.destroy()}attachStore(t){super.attachStore(t),t&&this.data&&this.timeZone!=null&&this._storesWithDates.includes(t)&&(this.plugStore(t),this.convertStoresToTimeZone([t]))}detachStore(t){super.detachStore(t),t&&!t.isDestroyed&&this.timeZone!=null&&(this.convertStoresToTimeZone([t],null),this.unplugStore(t))}relayStoreChange({source:t,action:r,records:n,replaced:s}){const a=this;a.timeZone!=null&&a._storesWithDates.includes(t)&&["add","replace"].includes(r)&&(!(n!=null&&n.length)&&(s!=null&&s.length)&&(n=s),n.length&&n.forEach(l=>l.timeZone=a.timeZone))}convertStoresToTimeZone(t,r=this.timeZone){var n;const{stm:s}=this,a=s==null?void 0:s.enabled;a&&(s.disabled=!0);for(const l of t)(n=l==null?void 0:l.forEach)==null||n.call(l,o=>l.plugins.storeTimeZonePlugin.convertRecordToTimeZone(o,r));a&&this.commitAsync().then(()=>{s.disabled=!1})}updateTimeZone(t,r){const n=this,s=n._isConfiguringTimeZone||n.isConfiguring;if(n.trigger("beforeTimeZoneChange",{timeZone:t,oldTimeZone:r,isConfiguring:s}),n.calendarManagerStore.forEach(a=>a.bumpVersion()),n._storesWithDates.forEach(a=>n.plugStore(a)),n.convertStoresToTimeZone(n._storesWithDates),n.startDate){const a=r!=null?$e.fromTimeZone(n.startDate,r):n.startDate;n.startDate=t!=null?$e.toTimeZone(a,t):a}n.ignoreRecordChanges=!0,n.commitAsync().then(()=>{n.isDestroyed||n.trigger("timeZoneChange",{timeZone:t,oldTimeZone:r,isConfiguring:s}),delete n._isConfiguringTimeZone})}},y(e,"$name","ProjectModelTimeZoneMixin"),y(e,"configurable",{timeZone:{$config:"lazy",value:null}}),e},ml=class extends xt.mixin(Wh){afterConstruct(){this.endDate||(this.endDate=this.startDate),super.afterConstruct()}};y(ml,"$name","TimeRangeModel"),ml._$name="TimeRangeModel";var pl=class extends Dt.mixin(Hh){get $lazyLoadPluginClass(){return this.isPaged?Qr:$i}};y(pl,"$name","TimeRangeStore"),y(pl,"defaultConfig",{loadPriority:500,syncPriority:500,modelClass:ml,id:"timeRanges"}),pl._$name="TimeRangeStore";var ZD=i=>{var e;return e=class extends(i||me).mixin(KD,XD){static get defaultConfig(){return{stm:{},timeRangeModelClass:ml,resourceTimeRangeModelClass:dr,timeRangeStoreClass:pl,resourceTimeRangeStoreClass:fl,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null,resourceTimeRangesData:null}}construct(t={}){super.construct(...arguments),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const t=this;!t.timeRangeStore.stm&&t.stm.addStore(t.timeRangeStore),!t.resourceTimeRangeStore.stm&&t.stm.addStore(t.resourceTimeRangeStore)}attachStore(t){t&&t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&(this.detachListeners(t.$$name),super.detachStore(t))}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}updateTimeRangeStore(t,r){this.detachStore(r),this.attachStore(t),r&&(r.project=null),t&&(t.project=this)}setTimeRangeStore(t){this.timeRangeStore=t}changeTimeRangeStore(t){return t&&!t.isStore&&(t=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},t)),t}updateResourceTimeRangeStore(t,r){this.detachStore(r),this.attachStore(t),r&&(r.project=null),t&&(t.project=this)}changeResourceTimeRangeStore(t){return t&&!t.isStore&&(t=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},t)),t}setResourceTimeRangeStore(t){this.resourceTimeRangeStore=t}get events(){return this.eventStore.allRecords}updateEvents(t){this.eventStore.data=t}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(t){this.resourceTimeRangeStore.data=t}async loadInlineData(t){return this.isLoadingInlineData=!0,t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),super.loadInlineData(t)}afterChange(t,r){super.afterChange(...arguments),r.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},y(e,"$name","ProjectModelMixin"),y(e,"configurable",{timeRangeStore:{value:{},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),e},JI=i=>class extends i{getCurrentConfig(t){const r=this,n=super.getCurrentConfig(t);if(n){for(const s of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const a=r[s];if(a){a.count&&(n[a.id+"Data"]=a.getInlineData(t));const l=a.getCurrentConfig(t);l&&Object.keys(l).length>0?Object.keys(l).length===1&&l.data?delete n[s]:n[s]=Object.assign(n[s]||{},l):n[s]&&Object.keys(n[s]).length===0&&delete n[s]}}return r.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}},JD=class extends ${set eventStore(i){const e=this;e.eventStoreDetacher&&e.eventStoreDetacher(),e._eventStore=i,i&&i.autoCommit&&(e.eventStoreDetacher=i.ion({beforecommit:e.onEventStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(i){const e=this;e.resourceStoreDetacher&&e.resourceStoreDetacher(),e._resourceStore=i,i&&i.autoCommit&&(e.resourceStoreDetacher=i.ion({beforecommit:e.onResourceStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(i){const e=this;e.assignmentStoreDetacher&&e.assignmentStoreDetacher(),e._assignmentStore=i,i&&i.autoSync&&(e.assignmentStoreDetacher=i.ion({beforecommit:e.onAssignmentStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(i){const e=this;e.dependencyStoreDetacher&&e.dependencyStoreDetacher(),e._dependencyStore=i,i&&i.autoSync&&(e.dependencyStoreDetacher=i.ion({beforecommit:e.onDependencyStoreBeforeSync,thisObj:e,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:i}){const e=this;return e.removeNonPersistableRecordsToCreate(i),e.shallContinueSync(i)}onResourceStoreBeforeSync({changes:i}){const e=this;return e.removeNonPersistableRecordsToCreate(i),e.shallContinueSync(i)}onAssignmentStoreBeforeSync({changes:i}){const e=this;return e.removeNonPersistableRecordsToCreate(i),e.shallContinueSync(i)}onDependencyStoreBeforeSync({changes:i}){const e=this;return e.removeNonPersistableRecordsToCreate(i),e.shallContinueSync(i)}removeNonPersistableRecordsToCreate(i){const e=i.added||[];let t,r;for(r=e.length-1;r>=0;--r)t=e[r],t.isPersistable||e.splice(e.indexOf(t),1);e.length===0&&(i.added.length=0)}shallContinueSync(i){return!!(i.added&&i.added.length>0||i.modified&&i.modified.length>0||i.removed&&i.removed.length>0)}};JD._$name="ModelPersistencyManager";var QD=(i,e)=>new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()+e,i.getMilliseconds()),Sp=function(){"use strict";var i={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),r=t.length>>>0;if(r===0)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:n!=0&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var s=n>=0?n:Math.max(r-Math.abs(n),0);s<r;s++)if(s in t&&t[s]===e)return s;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),i.array={},i.array.sort=function(e,t){e.sort(function(r,n){return+r-+n}),t&&e[0]===0&&e.push(e.shift())},i.array.next=function(e,t,r){for(var n,s=r[0]!==0,a=0,l=t.length-1;l>-1;--l){if(n=t[l],n===e)return n;if(n>e||n===0&&s&&r[1]>e){a=l;continue}break}return t[a]},i.array.nextInvalid=function(e,t,r){for(var n=r[0],s=r[1],a=t.length,l=t[a-1]===0&&n!==0?s:0,o=e,d=t.indexOf(e),c=o;o===(t[d]||l);)if(o++,o>s&&(o=n),d++,d===a&&(d=0),o===c)return;return o},i.array.prev=function(e,t,r){for(var n,s=t.length,a=r[0]!==0,l=s-1,o=0;o<s;o++){if(n=t[o],n===e)return n;if(n<e||n===0&&a&&r[1]<e){l=o;continue}break}return t[l]},i.array.prevInvalid=function(e,t,r){for(var n=r[0],s=r[1],a=t.length,l=t[a-1]===0&&n!==0?s:0,o=e,d=t.indexOf(e),c=o;o===(t[d]||l);)if(o--,o<n&&(o=s),d--,d===-1&&(d=a-1),o===c)return;return o},i.day=i.D={name:"day",range:86400,val:function(e){return e.D||(e.D=i.date.getDate.call(e))},isValid:function(e,t){return i.D.val(e)===(t||i.D.extent(e)[1])},extent:function(e){if(e.DExtent)return e.DExtent;var t=i.M.val(e),r=i.DAYS_IN_MONTH[t-1];return t===2&&i.dy.extent(e)[1]===366&&(r=r+1),e.DExtent=[1,r]},start:function(e){return e.DStart||(e.DStart=i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e)))},end:function(e){return e.DEnd||(e.DEnd=i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e)))},next:function(e,t){t=t>i.D.extent(e)[1]?1:t;var r=i.date.nextRollover(e,t,i.D,i.M),n=i.D.extent(r)[1];return t=t>n?1:t||n,i.date.next(i.Y.val(r),i.M.val(r),t)},prev:function(e,t){var r=i.date.prevRollover(e,t,i.D,i.M),n=i.D.extent(r)[1];return i.date.prev(i.Y.val(r),i.M.val(r),t>n?n:t||n)}},i.dayOfWeekCount=i.dc={name:"day of week count",range:604800,val:function(e){return e.dc||(e.dc=Math.floor((i.D.val(e)-1)/7)+1)},isValid:function(e,t){return i.dc.val(e)===t||t===0&&i.D.val(e)>i.D.extent(e)[1]-7},extent:function(e){return e.dcExtent||(e.dcExtent=[1,Math.ceil(i.D.extent(e)[1]/7)])},start:function(e){return e.dcStart||(e.dcStart=i.date.next(i.Y.val(e),i.M.val(e),Math.max(1,(i.dc.val(e)-1)*7+1||1)))},end:function(e){return e.dcEnd||(e.dcEnd=i.date.prev(i.Y.val(e),i.M.val(e),Math.min(i.dc.val(e)*7,i.D.extent(e)[1])))},next:function(e,t){t=t>i.dc.extent(e)[1]?1:t;var r=i.date.nextRollover(e,t,i.dc,i.M),n=i.dc.extent(r)[1];t=t>n?1:t;var s=i.date.next(i.Y.val(r),i.M.val(r),t===0?i.D.extent(r)[1]-6:1+7*(t-1));return s.getTime()<=e.getTime()?(r=i.M.next(e,i.M.val(e)+1),i.date.next(i.Y.val(r),i.M.val(r),t===0?i.D.extent(r)[1]-6:1+7*(t-1))):s},prev:function(e,t){var r=i.date.prevRollover(e,t,i.dc,i.M),n=i.dc.extent(r)[1];return t=t>n?n:t||n,i.dc.end(i.date.prev(i.Y.val(r),i.M.val(r),1+7*(t-1)))}},i.dayOfWeek=i.dw=i.d={name:"day of week",range:86400,val:function(e){return e.dw||(e.dw=i.date.getDay.call(e)+1)},isValid:function(e,t){return i.dw.val(e)===(t||7)},extent:function(){return[1,7]},start:function(e){return i.D.start(e)},end:function(e){return i.D.end(e)},next:function(e,t){return t=t>7?1:t||7,i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e)+(t-i.dw.val(e))+(t<=i.dw.val(e)?7:0))},prev:function(e,t){return t=t>7?7:t||7,i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e)+(t-i.dw.val(e))+(t>=i.dw.val(e)?-7:0))}},i.dayOfYear=i.dy={name:"day of year",range:86400,val:function(e){return e.dy||(e.dy=Math.ceil(1+(i.D.start(e).getTime()-i.Y.start(e).getTime())/i.DAY))},isValid:function(e,t){return i.dy.val(e)===(t||i.dy.extent(e)[1])},extent:function(e){var t=i.Y.val(e);return e.dyExtent||(e.dyExtent=[1,t%4?365:366])},start:function(e){return i.D.start(e)},end:function(e){return i.D.end(e)},next:function(e,t){t=t>i.dy.extent(e)[1]?1:t;var r=i.date.nextRollover(e,t,i.dy,i.Y),n=i.dy.extent(r)[1];return t=t>n?1:t||n,i.date.next(i.Y.val(r),i.M.val(r),t)},prev:function(e,t){var r=i.date.prevRollover(e,t,i.dy,i.Y),n=i.dy.extent(r)[1];return t=t>n?n:t||n,i.date.prev(i.Y.val(r),i.M.val(r),t)}},i.hour=i.h={name:"hour",range:3600,val:function(e){return e.h||(e.h=i.date.getHour.call(e))},isValid:function(e,t){return i.h.val(e)===t},extent:function(){return[0,23]},start:function(e){return e.hStart||(e.hStart=i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e),i.h.val(e)))},end:function(e){return e.hEnd||(e.hEnd=i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e),i.h.val(e)))},next:function(e,t){t=t>23?0:t;var r=i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e)+(t<=i.h.val(e)?1:0),t);return!i.date.isUTC&&r.getTime()<=e.getTime()&&(r=i.date.next(i.Y.val(r),i.M.val(r),i.D.val(r),t+1)),r},prev:function(e,t){return t=t>23?23:t,i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e)+(t>=i.h.val(e)?-1:0),t)}},i.minute=i.m={name:"minute",range:60,val:function(e){return e.m||(e.m=i.date.getMin.call(e))},isValid:function(e,t){return i.m.val(e)===t},extent:function(e){return[0,59]},start:function(e){return e.mStart||(e.mStart=i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e),i.h.val(e),i.m.val(e)))},end:function(e){return e.mEnd||(e.mEnd=i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e),i.h.val(e),i.m.val(e)))},next:function(e,t){var r=i.m.val(e),n=i.s.val(e),s=t>59?60-r:t<=r?60-r+t:t-r,a=new Date(e.getTime()+s*i.MIN-n*i.SEC);return!i.date.isUTC&&a.getTime()<=e.getTime()&&(a=new Date(e.getTime()+(s+120)*i.MIN-n*i.SEC)),a},prev:function(e,t){return t=t>59?59:t,i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e),i.h.val(e)+(t>=i.m.val(e)?-1:0),t)}},i.month=i.M={name:"month",range:2629740,val:function(e){return e.M||(e.M=i.date.getMonth.call(e)+1)},isValid:function(e,t){return i.M.val(e)===(t||12)},extent:function(){return[1,12]},start:function(e){return e.MStart||(e.MStart=i.date.next(i.Y.val(e),i.M.val(e)))},end:function(e){return e.MEnd||(e.MEnd=i.date.prev(i.Y.val(e),i.M.val(e)))},next:function(e,t){return t=t>12?1:t||12,i.date.next(i.Y.val(e)+(t>i.M.val(e)?0:1),t)},prev:function(e,t){return t=t>12?12:t||12,i.date.prev(i.Y.val(e)-(t>=i.M.val(e)?1:0),t)}},i.second=i.s={name:"second",range:1,val:function(e){return e.s||(e.s=i.date.getSec.call(e))},isValid:function(e,t){return i.s.val(e)===t},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(e,t){var r=i.s.val(e),n=t>59?60-r:t<=r?60-r+t:t-r,s=new Date(e.getTime()+n*i.SEC);return!i.date.isUTC&&s.getTime()<=e.getTime()&&(s=new Date(e.getTime()+(n+7200)*i.SEC)),s},prev:function(e,t,r){return t=t>59?59:t,i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e),i.h.val(e),i.m.val(e)+(t>=i.s.val(e)?-1:0),t)}},i.time=i.t={name:"time",range:1,val:function(e){return e.t||(e.t=i.h.val(e)*3600+i.m.val(e)*60+i.s.val(e))},isValid:function(e,t){return i.t.val(e)===t},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(e,t){t=t>86399?0:t;var r=i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e)+(t<=i.t.val(e)?1:0),0,0,t);return!i.date.isUTC&&r.getTime()<e.getTime()&&(r=i.date.next(i.Y.val(r),i.M.val(r),i.D.val(r),i.h.val(r),i.m.val(r),t+7200)),r},prev:function(e,t){return t=t>86399?86399:t,i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e)+(t>=i.t.val(e)?-1:0),0,0,t)}},i.weekOfMonth=i.wm={name:"week of month",range:604800,val:function(e){return e.wm||(e.wm=(i.D.val(e)+(i.dw.val(i.M.start(e))-1)+(7-i.dw.val(e)))/7)},isValid:function(e,t){return i.wm.val(e)===(t||i.wm.extent(e)[1])},extent:function(e){return e.wmExtent||(e.wmExtent=[1,(i.D.extent(e)[1]+(i.dw.val(i.M.start(e))-1)+(7-i.dw.val(i.M.end(e))))/7])},start:function(e){return e.wmStart||(e.wmStart=i.date.next(i.Y.val(e),i.M.val(e),Math.max(i.D.val(e)-i.dw.val(e)+1,1)))},end:function(e){return e.wmEnd||(e.wmEnd=i.date.prev(i.Y.val(e),i.M.val(e),Math.min(i.D.val(e)+(7-i.dw.val(e)),i.D.extent(e)[1])))},next:function(e,t){t=t>i.wm.extent(e)[1]?1:t;var r=i.date.nextRollover(e,t,i.wm,i.M),n=i.wm.extent(r)[1];return t=t>n?1:t||n,i.date.next(i.Y.val(r),i.M.val(r),Math.max(1,(t-1)*7-(i.dw.val(r)-2)))},prev:function(e,t){var r=i.date.prevRollover(e,t,i.wm,i.M),n=i.wm.extent(r)[1];return t=t>n?n:t||n,i.wm.end(i.date.next(i.Y.val(r),i.M.val(r),Math.max(1,(t-1)*7-(i.dw.val(r)-2))))}},i.weekOfYear=i.wy={name:"week of year (ISO)",range:604800,val:function(e){if(e.wy)return e.wy;var t=i.dw.next(i.wy.start(e),5),r=i.dw.next(i.Y.prev(t,i.Y.val(t)-1),5);return e.wy=1+Math.ceil((t.getTime()-r.getTime())/i.WEEK)},isValid:function(e,t){return i.wy.val(e)===(t||i.wy.extent(e)[1])},extent:function(e){if(e.wyExtent)return e.wyExtent;var t=i.dw.next(i.wy.start(e),5),r=i.dw.val(i.Y.start(t)),n=i.dw.val(i.Y.end(t));return e.wyExtent=[1,r===5||n===5?53:52]},start:function(e){return e.wyStart||(e.wyStart=i.date.next(i.Y.val(e),i.M.val(e),i.D.val(e)-(i.dw.val(e)>1?i.dw.val(e)-2:6)))},end:function(e){return e.wyEnd||(e.wyEnd=i.date.prev(i.Y.val(e),i.M.val(e),i.D.val(e)+(i.dw.val(e)>1?8-i.dw.val(e):0)))},next:function(e,t){t=t>i.wy.extent(e)[1]?1:t;var r=i.dw.next(i.wy.start(e),5),n=i.date.nextRollover(r,t,i.wy,i.Y);i.wy.val(n)!==1&&(n=i.dw.next(n,2));var s=i.wy.extent(n)[1],a=i.wy.start(n);return t=t>s?1:t||s,i.date.next(i.Y.val(a),i.M.val(a),i.D.val(a)+7*(t-1))},prev:function(e,t){var r=i.dw.next(i.wy.start(e),5),n=i.date.prevRollover(r,t,i.wy,i.Y);i.wy.val(n)!==1&&(n=i.dw.next(n,2));var s=i.wy.extent(n)[1],a=i.wy.end(n);return t=t>s?s:t||s,i.wy.end(i.date.next(i.Y.val(a),i.M.val(a),i.D.val(a)+7*(t-1)))}},i.year=i.Y={name:"year",range:31556900,val:function(e){return e.Y||(e.Y=i.date.getYear.call(e))},isValid:function(e,t){return i.Y.val(e)===t},extent:function(){return[1970,2099]},start:function(e){return e.YStart||(e.YStart=i.date.next(i.Y.val(e)))},end:function(e){return e.YEnd||(e.YEnd=i.date.prev(i.Y.val(e)))},next:function(e,t){return t>i.Y.val(e)&&t<=i.Y.extent()[1]?i.date.next(t):i.NEVER},prev:function(e,t){return t<i.Y.val(e)&&t>=i.Y.extent()[0]?i.date.prev(t):i.NEVER}},i.fullDate=i.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(e,t){return i.fd.val(e)===t},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(e,t){return i.fd.val(e)<t?new Date(t):i.NEVER},prev:function(e,t){return i.fd.val(e)>t?new Date(t):i.NEVER}},i.modifier={},i.modifier.after=i.modifier.a=function(e,t){var r=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-r)*e.range,val:e.val,isValid:function(n,s){return this.val(n)>=r},extent:e.extent,start:e.start,end:e.end,next:function(n,s){return s!=r&&(s=e.extent(n)[0]),e.next(n,s)},prev:function(n,s){return s=s===r?e.extent(n)[1]:r-1,e.prev(n,s)}}},i.modifier.before=i.modifier.b=function(e,t){var r=t[t.length-1];return{name:"before "+e.name,range:e.range*(r-1),val:e.val,isValid:function(n,s){return this.val(n)<r},extent:e.extent,start:e.start,end:e.end,next:function(n,s){return s=s===r?e.extent(n)[0]:r,e.next(n,s)},prev:function(n,s){return s=s===r?r-1:e.extent(n)[1],e.prev(n,s)}}},i.compile=function(e){var t=[],r=0,n;for(var s in e){var a=s.split("_"),l=a[0],o=a[1],d=e[s],c=o?i.modifier[o](i[l],d):i[l];t.push({constraint:c,vals:d}),r++}t.sort(function(h,g){var f=h.constraint.range,m=g.constraint.range;return m<f?-1:m>f?1:0}),n=t[r-1].constraint;function u(h){return h==="next"?function(g,f){return g.getTime()>f.getTime()}:function(g,f){return f.getTime()>g.getTime()}}return{start:function(h,g){for(var f=g,m=i.array[h],p=1e3,v;p--&&!v&&f;){v=!0;for(var b=0;b<r;b++){var w=t[b].constraint,D=w.val(f),S=w.extent(f),x=m(D,t[b].vals,S);if(!w.isValid(f,x)){f=w[h](f,x),v=!1;break}}}return f!==i.NEVER&&(f=h==="next"?n.start(f):n.end(f)),f},end:function(h,g){for(var f,m=i.array[h+"Invalid"],p=u(h),v=r-1;v>=0;v--){var b=t[v].constraint,w=b.val(g),D=b.extent(g),S=m(w,t[v].vals,D),x;S!==void 0&&(x=b[h](g,S),x&&(!f||p(f,x))&&(f=x))}return f},tick:function(h,g){return new Date(h==="next"?n.end(g).getTime()+i.SEC:n.start(g).getTime()-i.SEC)},tickSafe:function(h,g){return h==="next"?QD(n.end(g),1):QD(n.start(g),-1)},tickStart:function(h){return n.start(h)}}},i.schedule=function(e){if(!e)throw new Error("Missing schedule definition.");if(!e.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],r=e.schedules.length,n=[],s=e.exceptions?e.exceptions.length:0,a=0;a<r;a++)t.push(i.compile(e.schedules[a]));for(var l=0;l<s;l++)n.push(i.compile(e.exceptions[l]));function o(S,x,R,M,_){var k=w(S),F=x,I=1e6,A=[],P=[],H,G,q=[],W=S==="next",j,se=W?0:1,J=W?1:0;if(R=R?new Date(R):new Date,!R||!R.getTime())throw new Error("Invalid start date.");for(c(S,t,A,R),h(S,n,P,R);I--&&F&&(H=D(A,k))&&!(M&&k(H,M));){if(s&&(g(S,n,P,H),G=p(S,P,H))){u(S,t,A,G);continue}if(_){var Q=v(P,k);G=b(S,t,A,H,Q);var X=W?[new Date(Math.max(R,H)),G?new Date(M?Math.min(G,M):G):void 0]:[G?new Date(M?Math.max(M,G.getTime()+i.SEC):G.getTime()+i.SEC):void 0,new Date(Math.min(R,H.getTime()+i.SEC))];if(j&&X[se].getTime()===j[J].getTime()?(j[J]=X[J],F++):(j=X,q.push(j)),!G)break;u(S,t,A,G)}else q.push(W?new Date(Math.max(R,H)):m(t,A,H,M)),f(S,t,A,H);F--}for(var ee=0,ce=q.length;ee<ce;ee++){var ae=q[ee];q[ee]=Object.prototype.toString.call(ae)==="[object Array]"?[d(ae[0]),d(ae[1])]:d(ae)}return q.length===0?i.NEVER:x===1?q[0]:q}function d(S){if(S instanceof Date&&!isNaN(S.valueOf()))return new Date(S)}function c(S,x,R,M){for(var _=0,k=x.length;_<k;_++)R[_]=x[_].start(S,M)}function u(S,x,R,M){for(var _=w(S),k=0,F=x.length;k<F;k++)R[k]&&!_(R[k],M)&&(R[k]=x[k].start(S,M))}function h(S,x,R,M){for(var _=w(S),k=0,F=x.length;k<F;k++){var I=x[k].start(S,M);I?R[k]=[I,x[k].end(S,I)]:R[k]=i.NEVER}}function g(S,x,R,M){for(var _=w(S),k=0,F=x.length;k<F;k++)if(R[k]&&!_(R[k][0],M)){var I=x[k].start(S,M);I?R[k]=[I,x[k].end(S,I)]:R[k]=i.NEVER}}function f(S,x,R,M){for(var _=0,k=x.length;_<k;_++)if(R[_]&&R[_].getTime()===M.getTime()){const F=x[_].start(S,x[_].tick(S,M));F!==i.NEVER&&F.getTime()===R[_].getTime()?R[_]=x[_].start(S,x[_].tickSafe(S,M)):R[_]=F}}function m(S,x,R,M){for(var _,k=0,F=x.length;k<F;k++)if(x[k]&&x[k].getTime()===R.getTime()){var I=S[k].tickStart(R);if(M&&I<M)return M;(!_||I>_)&&(_=I)}return _}function p(S,x,R){for(var M=w(S),_,k=0,F=x.length;k<F;k++){var I=x[k];I&&!M(I[0],R)&&(!I[1]||M(I[1],R))&&(!_||M(I[1],_))&&(_=I[1])}return _}function v(S,x){for(var R,M=0,_=S.length;M<_;M++)S[M]&&(!R||x(R,S[M][0]))&&(R=S[M][0]);return R}function b(S,x,R,M,_){for(var k=w(S),F,I=0,A=x.length;I<A;I++){var P=R[I];if(P&&P.getTime()===M.getTime()){var H=x[I].end(S,P);if(_&&(!H||k(H,_)))return _;(!F||k(H,F))&&(F=H)}}return F}function w(S){return S==="next"?function(x,R){return!R||x.getTime()>R.getTime()}:function(x,R){return!x||R.getTime()>x.getTime()}}function D(S,x){for(var R=S[0],M=1,_=S.length;M<_;M++)S[M]&&x(R,S[M])&&(R=S[M]);return R}return{isValid:function(S){return o("next",1,S,S)!==i.NEVER},next:function(S,x,R){return o("next",S||1,x,R)},prev:function(S,x,R){return o("prev",S||1,x,R)},nextRange:function(S,x,R){return o("next",S||1,x,R,!0)},prevRange:function(S,x,R){return o("prev",S||1,x,R,!0)}}},i.setTimeout=function(e,t){var r=i.schedule(t),n;e&&s();function s(){var a=Date.now(),l=r.next(2,a);if(!l[0]){n=void 0;return}var o=l[0].getTime()-a;o<1e3&&(o=l[1]?l[1].getTime()-a:1e3),o<2147483647?n=setTimeout(e,o):n=setTimeout(s,2147483647)}return{isDone:function(){return!n},clear:function(){clearTimeout(n)}}},i.setInterval=function(e,t){if(!e)return;var r=i.setTimeout(s,t),n=r.isDone();function s(){n||(e(),r=i.setTimeout(s,t))}return{isDone:function(){return r.isDone()},clear:function(){n=!0,r.clear()}}},i.date={},i.date.timezone=function(e){i.date.build=e?function(n,s,a,l,o,d){return new Date(n,s,a,l,o,d)}:function(n,s,a,l,o,d){return new Date(Date.UTC(n,s,a,l,o,d))};var t=e?"get":"getUTC",r=Date.prototype;i.date.getYear=r[t+"FullYear"],i.date.getMonth=r[t+"Month"],i.date.getDate=r[t+"Date"],i.date.getDay=r[t+"Day"],i.date.getHour=r[t+"Hours"],i.date.getMin=r[t+"Minutes"],i.date.getSec=r[t+"Seconds"],i.date.isUTC=!e},i.date.UTC=function(){i.date.timezone(!1)},i.date.localTime=function(){i.date.timezone(!0)},i.date.UTC(),i.SEC=1e3,i.MIN=i.SEC*60,i.HOUR=i.MIN*60,i.DAY=i.HOUR*24,i.WEEK=i.DAY*7,i.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],i.NEVER=0,i.date.next=function(e,t,r,n,s,a){return i.date.build(e,t!==void 0?t-1:0,r!==void 0?r:1,n||0,s||0,a||0)},i.date.nextRollover=function(e,t,r,n){var s=r.val(e),a=r.extent(e)[1];return(t||a)<=s||t>a?new Date(n.end(e).getTime()+i.SEC):n.start(e)},i.date.prev=function(e,t,r,n,s,a){var l=arguments.length;return t=l<2?11:t-1,r=l<3?i.D.extent(i.date.next(e,t+1))[1]:r,n=l<4?23:n,s=l<5?59:s,a=l<6?59:a,i.date.build(e,t,r,n,s,a)},i.date.prevRollover=function(e,t,r,n){var s=r.val(e);return t>=s||!t?n.start(n.prev(e,n.val(e)-1)):n.start(e)},i.parse={},i.parse.cron=function(e,t){var r={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(b,w,D){return isNaN(b)?r[b]||null:Math.min(+b+(w||0),D||9999)}function l(b){var w={},D;for(D in b)D!=="dc"&&D!=="d"&&(w[D]=b[D].slice(0));return w}function o(b,w,D,S,x){var R=D;for(b[w]||(b[w]=[]);R<=S;)b[w].indexOf(R)<0&&b[w].push(R),R+=x||1;b[w].sort(function(M,_){return M-_})}function d(b,w,D,S){(w.d&&!w.dc||w.dc&&w.dc.indexOf(S)<0)&&(b.push(l(w)),w=b[b.length-1]),o(w,"d",D,D),o(w,"dc",S,S)}function c(b,w,D){var S={},x={};D===1?(o(w,"D",1,3),o(w,"d",r.MON,r.FRI),o(S,"D",2,2),o(S,"d",r.TUE,r.FRI),o(x,"D",3,3),o(x,"d",r.TUE,r.FRI)):(o(w,"D",D-1,D+1),o(w,"d",r.MON,r.FRI),o(S,"D",D-1,D-1),o(S,"d",r.MON,r.THU),o(x,"D",D+1,D+1),o(x,"d",r.TUE,r.FRI)),b.exceptions.push(S),b.exceptions.push(x)}function u(b,w,D,S,x,R){var M=b.split("/"),_=+M[1],k=M[0];if(k!=="*"&&k!=="0"){var F=k.split("-");S=a(F[0],R,x),x=a(F[1],R,x)||x}o(w,D,S,x,_)}function h(b,w,D,S,x,R){var M,_,k=w.schedules,F=k[k.length-1];b==="L"&&(b=S-1),(M=a(b,R,x))!==null?o(F,D,M,M):(M=a(b.replace("W",""),R,x))!==null?c(w,F,M):(M=a(b.replace("L",""),R,x))!==null?d(k,F,M,S-1):(_=b.split("#")).length===2?(M=a(_[0],R,x),d(k,F,M,a(_[1]))):u(b,F,D,S,x,R)}function g(b){return b.indexOf("#")>-1||b.indexOf("L")>0}function f(b,w){return g(b)&&!g(w)?1:b-w}function m(b){var w={schedules:[{}],exceptions:[]},D=b.replace(/(\s)+/g," ").split(" "),S,x,R,M;for(S in s)if(x=s[S],R=D[x[0]],R&&R!=="*"&&R!=="?"){M=R.split(",").sort(f);var _,k=M.length;for(_=0;_<k;_++)h(M[_],w,S,x[1],x[2],x[3])}return w}function p(b){var w=b.toUpperCase();return n[w]||w}var v=p(e);return m(t?v:"0 "+v)},i.parse.recur=function(){var e=[],t=[],r,n=e,s,a,l,o,d,c,u,h;function g(f,m,p){if(f=o?f+"_"+o:f,r||(n.push({}),r=n[0]),r[f]||(r[f]=[]),s=r[f],l){for(a=[],u=m;u<=p;u+=l)a.push(u);h={n:f,x:l,c:s.length,m:p}}a=d?[m]:c?[p]:a;var v=a.length;for(u=0;u<v;u+=1){var b=a[u];s.indexOf(b)<0&&s.push(b)}a=l=o=d=c=0}return{schedules:e,exceptions:t,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(f){return l=f||1,this},after:function(f){return o="a",a=[f],this},before:function(f){return o="b",a=[f],this},first:function(){return d=1,this},last:function(){return c=1,this},time:function(){for(var f=0,m=a.length;f<m;f++){var p=a[f].split(":");p.length<3&&p.push(0),a[f]=+p[0]*3600+ +p[1]*60+ +p[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,c?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,c?0:5),this},dayOfYear:function(){return g("dy",1,c?0:366),this},weekOfMonth:function(){return g("wm",1,c?0:5),this},weekOfYear:function(){return g("wy",1,c?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var f=0,m=a.length;f<m;f++)a[f]=a[f].getTime();return g("fd"),this},customModifier:function(f,m){var p=i.modifier[f];if(!p)throw new Error("Custom modifier "+f+" not recognized!");return o=f,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(f){var m=i[f];if(!m)throw new Error("Custom time period "+f+" not recognized!");return g(f,m.extent(new Date)[0],m.extent(new Date)[1]),this},startingOn:function(f){return this.between(f,h.m)},between:function(f,m){return r[h.n]=r[h.n].splice(0,h.c),l=h.x,g(h.n,f,m),this},and:function(){return r=n[n.push({})-1],this},except:function(){return n=t,r=null,this}}},i.parse.text=function(e){var t=i.parse.recur,r=0,n="",s,a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\d(t\d\d(:\d\d(:\d\d)?)?)?)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},l={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function o(S,x,R,M){return{startPos:S,endPos:x,text:R,type:M}}function d(S){var x=S instanceof Array?S:[S],R=/\s+/,M,_,k,F,I,A;for(x.push(R),I=r;!M||M.type===R;){A=-1,_=n.substring(I),M=o(I,I,n.split(R)[0]);var P,H=x.length;for(P=0;P<H;P++)F=x[P],k=F.exec(_),k&&k.index===0&&k[0].length>A&&(A=k[0].length,M=o(I,I+A,_.substring(0,A),F));M.type===R&&(I=M.endPos)}return M}function c(S){var x=d(S);return r=x.endPos,x}function u(S){for(var x=+w(S),R=v(a.through)?+w(S):x,M=[],_=x;_<=R;_++)M.push(_);return M}function h(S){for(var x=u(S);v(a.and);)x.push.apply(x,u(S));return S===a.dayName&&x.sort((R,M)=>R-M),x}function g(S){var x,R,M,_;v(a.weekend)?S.on(l.sun,l.sat).dayOfWeek():v(a.weekday)?S.on(l.mon,l.tue,l.wed,l.thu,l.fri).dayOfWeek():(x=w(a.rank),S.every(x),R=p(S),v(a.start)?(x=w(a.rank),S.startingOn(x),b(R.type)):v(a.between)&&(M=w(a.rank),v(a.and)&&(_=w(a.rank),S.between(M,_))))}function f(S){v(a.first)?S.first():v(a.last)?S.last():S.on(h(a.rank)),p(S)}function m(S){r=0,n=S,s=-1;for(var x=t();r<n.length&&s<0;){var R=b([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]);switch(R.type){case a.every:g(x);break;case a.after:d(a.time).type!==void 0?(x.after(w(a.time)),x.time()):d(a.fullDate).type!==void 0?(x.after(w(a.fullDate)),x.fullDate()):(x.after(w(a.rank)),p(x));break;case a.before:d(a.time).type!==void 0?(x.before(w(a.time)),x.time()):d(a.fullDate).type!==void 0?(x.before(w(a.fullDate)),x.fullDate()):(x.before(w(a.rank)),p(x));break;case a.onthe:f(x);break;case a.on:x.on(h(a.dayName)).dayOfWeek();break;case a.of:x.on(h(a.monthName)).month();break;case a.in:x.on(h(a.yearIndex)).year();break;case a.at:for(x.on(w(a.time)).time();v(a.and);)x.on(w(a.time)).time();break;case a.and:break;case a.also:x.and();break;case a.except:x.except();break;default:s=r}}return{schedules:x.schedules,exceptions:x.exceptions,error:s}}function p(S){var x=b([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(x.type){case a.second:S.second();break;case a.minute:S.minute();break;case a.hour:S.hour();break;case a.dayOfYear:S.dayOfYear();break;case a.dayOfWeek:S.dayOfWeek();break;case a.dayInstance:S.dayOfWeekCount();break;case a.day:S.dayOfMonth();break;case a.weekOfMonth:S.weekOfMonth();break;case a.weekOfYear:S.weekOfYear();break;case a.month:S.month();break;case a.year:S.year();break;default:s=r}return x}function v(S){var x=d(S).type===S;return x&&c(S),x}function b(S){var x=c(S);return x.type?x.text=D(x.text,S):s=r,x}function w(S){return b(S).text}function D(S,x){var R=S;switch(x){case a.time:var M=S.split(/(:|am|pm)/),_=M[3]==="pm"&&M[0]<12?parseInt(M[0],10)+12:M[0],k=M[2].trim();R=(_.length===1?"0":"")+_+":"+k;break;case a.rank:R=parseInt(/^\d+/.exec(S)[0],10);break;case a.monthName:case a.dayName:R=l[S.substring(0,3)];break;case a.fullDate:R=new Date(S.toUpperCase());break}return R}return m(e.toLowerCase())},i}();Sp.date.localTime();var ds=Sp,cs;(function(i){i.Millisecond="millisecond",i.Second="second",i.Minute="minute",i.ElapsedMinute="eminute",i.Hour="hour",i.ElapsedHour="ehour",i.Day="day",i.ElapsedDay="eday",i.Week="week",i.ElapsedWeek="eweek",i.Month="month",i.ElapsedMonth="emonth",i.Quarter="quarter",i.ElapsedQuarter="equarter",i.Year="year",i.ElapsedYear="eyear"})(cs||(cs={}));var Dp;(function(i){i.Honor="honor",i.Ignore="ignore",i.Conflict="conflict"})(Dp||(Dp={}));var Ep;(function(i){i.MustStartOn="muststarton",i.MustFinishOn="mustfinishon",i.StartNoEarlierThan="startnoearlierthan",i.StartNoLaterThan="startnolaterthan",i.FinishNoEarlierThan="finishnoearlierthan",i.FinishNoLaterThan="finishnolaterthan",i.AsSoonAsPossible="assoonaspossible",i.AsLateAsPossible="aslateaspossible"})(Ep||(Ep={}));var xp;(function(i){i.Normal="Normal",i.FixedDuration="FixedDuration",i.FixedEffort="FixedEffort",i.FixedUnits="FixedUnits"})(xp||(xp={}));var Rp;(function(i){i[i.NoError=0]="NoError",i[i.CyclicDependency=1]="CyclicDependency",i[i.DuplicatingDependency=2]="DuplicatingDependency"})(Rp||(Rp={}));var Tp;(function(i){i[i.StartToStart=0]="StartToStart",i[i.StartToEnd=1]="StartToEnd",i[i.EndToStart=2]="EndToStart",i[i.EndToEnd=3]="EndToEnd"})(Tp||(Tp={}));var Mp;(function(i){i.Project="Project",i.FromEvent="FromEvent",i.ToEvent="ToEvent",i.AllWorking="AllWorking"})(Mp||(Mp={}));var _p;(function(i){i.Auto="Auto",i.Manual="Manual"})(_p||(_p={}));var kp;(function(i){i[i.SchedulerBasic=1]="SchedulerBasic",i[i.SchedulerPro=2]="SchedulerPro",i[i.Gantt=3]="Gantt"})(kp||(kp={}));var Fp;(function(i){i.Forward="Forward",i.Backward="Backward",i.None="None"})(Fp||(Fp={}));var QI=(i,e)=>i&&!e||!i&&e?!1:!i&&!e?!0:i.direction===e.direction&&(i.kind==="own"&&e.kind==="own"||i.kind==="enforced"&&e.kind==="enforced"&&i.enforcedBy===e.enforcedBy||i.kind==="inherited"&&e.kind==="inherited"&&i.inheritedFrom===e.inheritedFrom),Ip;(function(i){i.Start="Start",i.End="End"})(Ip||(Ip={}));var us;(function(i){i.Week="Week",i.Exception="Exception"})(us||(us={}));var vl;(function(i){i.Skip="Skip",i.Throw="Throw"})(vl||(vl={}));function eA(i){return i?typeof i=="string"&&(i=i.split(","),i.map(e=>{const[t,r]=e.split("-");return{startDate:t,endDate:r}})):i=null,i}var Ap=class extends De([Xd],i=>{class e extends i{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","color","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"},{name:"type"},{name:"availability",convert:eA},{name:"compositeCode"}]}getCalendar(){return this.stores[0].calendar}get compositeIntervalCode(){var r,n;return this.compositeCode||(((r=this.startDate)==null?void 0:r.getTime())||"")+"-"+(((n=this.endDate)==null?void 0:n.getTime())||"")+"-"+(this.type||"")}resetPriority(){this.prioritySortValue=null,this.getCalendar().getDepth()}getPrioritySortValue(){if(this.prioritySortValue!=null)return this.prioritySortValue;let r=1e4,n=this.priority;if(n==null){switch(this.type){case us.Week:r+=this.getCalendar().getDepth()*100,n=this.isOverride()?30:20;break;case us.Exception:r+=this.getCalendar().getDepth()*1e4,n=40;break;default:r+=this.getCalendar().getDepth()*100,this.isRecurrent()?(n=20,this.isOverride()&&(n+=10)):n=40}n+=this.parentIndex}return this.prioritySortValue=r+n}isRecurrent(){return!!(this.getStartDateSchedule()||this.type===us.Exception&&this.getAvailabilityStartSchedule())}isStatic(){return!!(this.startDate&&this.endDate&&!this.isRecurrent())}isOverride(){return!!(this.startDate||this.endDate)}parseDateSchedule(r){let n=r;if(r&&r!==Object(r))try{n=JSON.parse(r)}catch(s){if(n=ds.parse.text(r.trim()),n.error>=0)throw new Error(`Parsing the 'later' schedule has failed: "${r}". Please consult the 'later' documentation for recognizable formats: https://bunkat.github.io/later/parsers.html`)}return n}getStartDateSchedule(){var r;if(!this.recurrentStartDate)return null;if(this.startDateSchedule)return this.startDateSchedule;const n=this.parseDateSchedule(this.recurrentStartDate);if((r=n==null?void 0:n.schedules)!=null&&r[0]){const s=n.schedules[0];!this.startDate&&s.fd_a&&(this.startDate=new Date(s.fd_a[0]),delete s.fd_a),!this.endDate&&s.fd_b&&(this.endDate=new Date(s.fd_b[0]),delete s.fd_b)}return this.startDateSchedule=ds.schedule(n)}getEndDateSchedule(){var r,n,s,a,l,o,d,c,u;if(this.endDateSchedule)return this.endDateSchedule;if(!this.recurrentEndDate||this.recurrentEndDate==="EOD")return null;const h=this.parseDateSchedule(this.recurrentEndDate);if((r=h==null?void 0:h.schedules)!=null&&r[0]){const g=h.schedules[0];(n=this.startDate)!=null&&n.getTime()&&((s=g.fd_a)!=null&&s[0])&&((a=this.startDate)==null?void 0:a.getTime())===((l=g.fd_a)==null?void 0:l[0])&&delete g.fd_a,(o=this.endDate)!=null&&o.getTime()&&((d=g.fd_b)!=null&&d[0])&&((c=this.endDate)==null?void 0:c.getTime())===((u=g.fd_b)==null?void 0:u[0])&&delete g.fd_b}return this.endDateSchedule=ds.schedule(h)}getAvailabilityStartSchedule(){var r;if((r=this.availability)!=null&&r.length){if(this.availabilityStartSchedule)return this.availabilityStartSchedule;const n="at "+this.availability.map(a=>a.startDate).sort().join(","),s=this.parseDateSchedule(n);return this.availabilityStartSchedule=ds.schedule(s)}}getAvailabilityEndSchedule(){var r;if((r=this.availability)!=null&&r.length){if(this.availabilityEndSchedule)return this.availabilityEndSchedule;const n="at "+this.availability.map(a=>a.endDate).sort().join(","),s=this.parseDateSchedule(n);return this.availabilityEndSchedule=ds.schedule(s)}}afterChange(r,n,s,a,l){super.afterChange(r,n,s,a,l),n!=null&&n.recurrentStartDate&&(this.startDateSchedule=void 0),n!=null&&n.recurrentEndDate&&(this.endDateSchedule=void 0),n!=null&&n.availability&&(this.availabilityStartSchedule=void 0,this.availabilityEndSchedule=void 0)}}return e}){},e0=class extends De([ci],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:Ap}}acceptChanges(){if(!this.isSyncingDataOnLoad)return super.acceptChanges(...arguments)}}return t}){},en=new Date(-864e13),cr=new Date(864e13),tA=i=>{if(!i)return!1;const e=i.getTime();return e!==en.getTime()&&e!==cr.getTime()},hs;(function(i){i[i.Left=0]="Left",i[i.Right=1]="Right"})(hs||(hs={}));var Xt;(function(i){i[i.FullRangeIterated=0]="FullRangeIterated",i[i.StoppedByIterator=1]="StoppedByIterator",i[i.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",i[i.MaxRangeReached=3]="MaxRangeReached"})(Xt||(Xt={}));var Lp=class{constructor(i){this.cacheFilledStartDate=cr,this.cacheFilledEndDate=en,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=cs.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,i&&Object.assign(this,i)}includeWrappingRangeFrom(i,e,t){i.ensureCacheFilledForInterval(e,t),this.intervalCache.includeWrappingRange(i.intervalCache,e,t)}ensureCacheFilledForInterval(i,e){const t=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(t!==cr.getTime()){const n=i.getTime(),s=e.getTime();if(t<=n&&s<=r)return;if(s<=t)e=new Date(t-1);else if(n>=r)i=new Date(r);else if(t<=n&&n<=r)i=new Date(r+1);else if(t<=s&&s<=r)e=new Date(t-1);else{this.ensureCacheFilledForInterval(i,new Date(t-1)),this.ensureCacheFilledForInterval(new Date(r+1),e);return}}(t===cr.getTime()||i.getTime()<r)&&(this.cacheFilledStartDate=i),(r===en.getTime()||r<e.getTime())&&(this.cacheFilledEndDate=e),this.fillCache(i,e)}fillCache(i,e){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=cr,this.cacheFilledEndDate=en,this.intervalCache.clear()}forEachAvailabilityInterval(i,e,t){var r;t=t||this;const n=i.startDate,s=i.endDate,a=n&&n.getTime(),l=s&&s.getTime(),o=(r=i.maxRange)!=null?r:this.maxRange,d=i.isForward!==!1;if(d?!n:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const c=this.intervalCache;let u=d?n:s,h=d?n:s;const g=h.getTime();for(let f=1;f<this.maxCacheExtendCycles;f++){d?this.ensureCacheFilledForInterval(u,s||C.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(n||C.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let m=c.getIntervalOf(h,d?hs.Left:hs.Right);for(;m;){const p=m.startDate,v=m.endDate;if(d&&l&&p.getTime()>=l||!d&&a&&v.getTime()<=a)return Xt.FullRangeIterated;if(d&&p.getTime()-g>=o||!d&&g-v.getTime()>=o)return Xt.MaxRangeReached;if(d&&p.getTime()>=this.cacheFilledEndDate.getTime()||!d&&v.getTime()<=this.cacheFilledStartDate.getTime())break;h=d?v:p;const b=a&&p.getTime()<a?n:p,w=l&&v.getTime()>l?s:v;if(e.call(t,b,w,m.cacheInterval)===!1)return Xt.StoppedByIterator;m=d?c.getNextInterval(m):c.getPrevInterval(m)}if(d&&h.getTime()===cr.getTime()||!d&&h.getTime()===en.getTime())return Xt.FullRangeIterated;u=d?this.cacheFilledEndDate:this.cacheFilledStartDate}return Xt.MaxCacheExtendCyclesReached}},sc=i=>Array.from(new Set(i)),Pp=(i,e)=>{const t=i.getPrioritySortValue();return e.getPrioritySortValue()-t},t0=class Rv{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),this.intervals=this.normalizeIntervals(this.intervals),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(this.intervals.indexOf(e)==-1){const t=this.intervals.slice();return t.push(e),new Rv({intervals:t,calendar:this.calendar})}else return this}combineWith(e){return new Rv({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){return this.isWorking!=null?this.isWorking:this.isWorking=this.intervals[0].isWorking}normalizeIntervals(e){const t=sc(e);return t.sort(Pp),t}},ac=(i,e,t=(r,n)=>r-n)=>{let r=0,n=e.length;for(;r<n;){const s=(r+n)/2|0,a=t(i,e[s]);if(a===0)return{found:!0,index:s};a<0?n=s:r=s+1}return{found:!1,index:n}},gs;(function(i){i[i.Exact=0]="Exact",i[i.Next=1]="Next"})(gs||(gs={}));var i0=class{constructor(i){this.keys=[],this.values=[],this.comparator=i||((e,t)=>e-t)}set(i,e){const t=ac(i,this.keys,this.comparator);return t.found?this.values[t.index]=e:(this.keys.splice(t.index,0,i),this.values.splice(t.index,0,e)),t.index}insertAt(i,e,t){this.keys.splice(i,0,e),this.values.splice(i,0,t)}setValueAt(i,e){this.values[i]=e}get(i){const e=ac(i,this.keys,this.comparator);return e.found?this.values[e.index]:void 0}getEntryAt(i){return i<this.keys.length?{key:this.keys[i],value:this.values[i]}:void 0}getKeyAt(i){return this.keys[i]}getValueAt(i){return this.values[i]}delete(i){const e=ac(i,this.keys,this.comparator);e.found&&this.deleteAt(e.index)}size(){return this.keys.length}deleteAt(i){this.keys.splice(i,1),this.values.splice(i,1)}indexOfKey(i){const e=ac(i,this.keys,this.comparator);return{found:e.found?gs.Exact:gs.Next,index:e.index}}map(i){const e=this.keys,t=this.values,r=[];for(let n=0;n<e.length;n++)r.push(i(t[n],e[n],n));return r}getAllEntries(){return this.map((i,e)=>({value:i,key:e}))}clear(){this.keys.length=0,this.values.length=0}},Op=class{constructor(i){if(this.points=new i0((e,t)=>e.getTime()-t.getTime()),this.leftInfinityKey=en,this.rightInfinityKey=cr,Object.assign(this,i),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(i){return this.points.indexOfKey(i)}getDateAt(i){return this.points.getKeyAt(i)}getPointAt(i){return this.points.getValueAt(i)}getIntervalOf(i,e=hs.Left){let{found:t,index:r}=this.indexOf(i),n;return e===hs.Left?n=t===gs.Exact?r:r-1:n=r-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(i){return i.startDateIndex===0?null:this.getIntervalWithStartDateIndex(i.startDateIndex-1)}getNextInterval(i){return i.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(i.startDateIndex+1)}getIntervalWithStartDateIndex(i){return{startDateIndex:i,startDate:this.getDateAt(i),endDate:i+1<this.size()?this.getDateAt(i+1):this.rightInfinityKey,cacheInterval:this.getPointAt(i)}}addInterval(i,e,t){const r=this.points,{found:n,index:s}=r.indexOfKey(i);let a,l;if(n==gs.Exact){const o=t(l=r.getValueAt(s));r.setValueAt(s,o),a=s+1}else{const o=t(l=r.getValueAt(s-1));r.insertAt(s,i,o),a=s+1}for(;a<r.size()&&!(r.getKeyAt(a).getTime()>=e.getTime());){const d=t(l=r.getValueAt(a));r.setValueAt(a,d),a++}a===r.size()?r.insertAt(r.size(),e,this.emptyInterval):r.getKeyAt(a).getTime()===e.getTime()||r.insertAt(a,e,l)}includeWrappingRange(i,e,t){let r=i.getIntervalOf(e);for(;r&&(this.addInterval(r.startDate,r.endDate,n=>this.combineIntervalsFn(n,r.cacheInterval)),!(r.endDate.getTime()>t.getTime()));)r=i.getNextInterval(r)}getSummary(){return this.points.map((i,e)=>({label:i,date:e}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},iA=ds.schedule(ds.parse.text("every 1 day")),r0=class extends Lp{constructor(i){if(super(i),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalUnspecifiedTimeIntervals=new Map,this.weekUnspecifiedTimeIntervalsByKey=new Map,this.treatInconsistentIntervals=(i==null?void 0:i.treatInconsistentIntervals)||vl.Skip,this.intervalCache=new Op({emptyInterval:new t0({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(i,e){var t;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,i,e);const r=this.calendar.ignoreTimeZone?null:(t=this.calendar.project)==null?void 0:t.timeZone;if(i>e)throw new Error("Invalid cache fill interval");for(const n of this.intervalStore)n.isRecurrent()&&this.cacheRecurrentInterval(i,e,r,n)}cacheRecurrentInterval(i,e,t,r){const n=r.startDate,s=r.endDate;if(n&&n>=e||s&&s<=i)return;const a=r.getAvailabilityStartSchedule(),l=r.getAvailabilityEndSchedule(),o=r.getStartDateSchedule()||a&&iA,d=r.getEndDateSchedule(),c=!d||d==="EOD";let u=i,h=e,g=o.prev(2,i),f;if(g&&(u=g[0],u.getTime()===i.getTime()&&g[1]&&(u=g[1])),c){const b=o.next(1,e);b&&(h=C.getStartOfNextDay(b,!0))}else f=d.next(2,e),f&&(h=f[0],h.getTime()===e.getTime()&&f[1]&&(h=f[1]));let m=o.next(1/0,u,new Date(h.getTime()-1e3));if(!(m!=null&&m.length))return;let p=c?m.map(b=>C.getStartOfNextDay(b,!0)):d.next(1/0,u,h);if(!(p!=null&&p.length))return;for(m[0].getTime()===p[0].getTime()&&p.splice(0,1);n&&m[0]<n;)p[0]>n?m[0]=n:(m.shift(),p.shift());for(;s&&p[p.length-1]>s;)m[p.length-1]<s?p[p.length-1]=s:(m.pop(),p.pop());const v=this.treatInconsistentIntervals;for(let b=0,w=m.length;b<w;b++){const D=m[b],S=p[b];if(!D||!S)break;if(D>S){if(v===vl.Skip)p.splice(b,1);else if(v===vl.Throw)throw new Error("Recurrent interval inconsistency: "+(r.name||r.id)+", caching startDate: "+C.format(D)+", caching endDate: "+C.format(S)+", recurrentStartDate: "+r.recurrentStartDate+", recurrentEndDate: "+r.recurrentEndDate)}}if(p.length>m.length?p.length=m.length:p.length<m.length&&(m.length=p.length),a){const b=[],w=[],D=this.getUnspecifiedTimeIntervalForException(r,{isWorking:!1});for(let S=0,x=m.length;S<x;S++){const R=m[S],M=p[S];this.intervalCache.addInterval(R,M,F=>F.includeInterval(D));let _=a.next(1/0,R,M);if(!_)return;let k=l.next(1/0,new Date(R.getTime()+1e3),M);if(!k)return;k.length>_.length?k.length=_.length:k.length<_.length&&(_.length=k.length),k[0]<_[0]&&(_.unshift(R),k.push(M)),b.push(..._),w.push(...k)}m=b,p=w}for(let b=0,w=m.length;b<w;b++){let D=m[b],S=p[b];t!=null&&(D=$e.toTimeZone(D,t),S=$e.toTimeZone(S,t)),this.intervalCache.addInterval(D,S,x=>x.includeInterval(r))}}getUnspecifiedTimeIntervalForException(i,e={}){let t=this.intervalUnspecifiedTimeIntervals.get(i);return t||(t=this.unspecifiedTimeInterval.copy(),this.intervalUnspecifiedTimeIntervals.set(i,t),Object.assign(t,{mainInterval:i,calendar:this.unspecifiedTimeInterval.calendar,name:i.name,cls:i.cls,startDate:i.startDate,endDate:i.endDate,prioritySortValue:i.getPrioritySortValue()-1,...e})),t}getUnspecifiedTimeIntervalForWeek(i){let e=this.intervalUnspecifiedTimeIntervals.get(i);if(!e){const t=i.compositeIntervalCode;e=this.weekUnspecifiedTimeIntervalsByKey.get(t),e||(e=this.unspecifiedTimeInterval.copy(),this.intervalUnspecifiedTimeIntervals.set(i,e),this.weekUnspecifiedTimeIntervalsByKey.set(t,e),Object.assign(e,{mainInterval:i,calendar:this.unspecifiedTimeInterval.calendar,name:i.name,cls:i.cls,startDate:i.startDate,endDate:i.endDate,prioritySortValue:i.getPrioritySortValue()-1}))}return e}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){var i;const e=(i=this.calendar.project)==null?void 0:i.timeZone,t=this.intervalCache;for(let r of this.intervalStore){const n=r.isStatic(),s=r.type===us.Week;if(n||s){s&&(r=this.getUnspecifiedTimeIntervalForWeek(r));let{startDate:a,endDate:l}=r;e!=null&&(a=$e.toTimeZone(a,e),l=$e.toTimeZone(l,e)),t.addInterval(a||en,l||cr,o=>o.includeInterval(r))}}}},n0=class extends De([Ap],i=>{class e extends i{getCalendar(){return this.calendar}getMainInterval(){return this.mainInterval}getPrioritySortValue(){return this.prioritySortValue!=null?this.prioritySortValue:this.prioritySortValue=this.getCalendar().getDepth()}}return e.$name="UnspecifiedTimeIntervalModel",e}){},s0=class extends De([Xd],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls",{name:"treatInconsistentIntervals",persist:!1}]}get intervalStoreClass(){return e0}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(n){n.storeClass=this.intervalStoreClass,n.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,n.calendar=this,n.syncDataOnLoad=!0}processIntervalsStoreData(n){this.bumpVersion()}isDefault(){const n=this.getProject();return n?this===n.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(n,s,a){var l,o;const d=(o=n.maxRange)!=null?o:(l=this.getProject())==null?void 0:l.maxCalendarRange;return d&&(n={...n,maxRange:d}),this.calendarCache.forEachAvailabilityInterval(n,s,a)}accumulateWorkingTime(n,s,a){var l,o,d;if(s===0)return{finalDate:new Date(n),remainingDurationInMs:0};if(isNaN(s))throw new Error("Invalid duration");let c=n;const u=(d=(o=(l=this.getProject())==null?void 0:l.adjustDurationToDST)!=null?o:this.adjustDurationToDST)!=null?d:!1;return this.forEachAvailabilityInterval(a?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(h,g,f)=>{let m=!0;if(f.getIsWorking()){let p=g.getTime()-h.getTime();if(s<=p){if(u){const v=a?h.getTimezoneOffset()-new Date(h.getTime()+s).getTimezoneOffset():new Date(g.getTime()-s).getTimezoneOffset()-g.getTimezoneOffset();s-=v*60*1e3}c=a?new Date(h.getTime()+s):new Date(g.getTime()-s),s=0,m=!1}else{if(u){const v=h.getTimezoneOffset()-g.getTimezoneOffset();p+=v*60*1e3}c=a?g:h,s-=p}}return m}),{finalDate:new Date(c),remainingDurationInMs:s}}calculateDurationMs(n,s,a=!1){var l,o,d;let c=0;const u=n.getTime()<=s.getTime()||!a?1:-1;u<0&&([n,s]=[s,n]);const h=(d=(o=(l=this.getProject())==null?void 0:l.adjustDurationToDST)!=null?o:this.adjustDurationToDST)!=null?d:!1;return this.forEachAvailabilityInterval({startDate:n,endDate:s},(g,f,m)=>{if(m.getIsWorking()&&(c+=f.getTime()-g.getTime(),h)){const p=g.getTimezoneOffset()-f.getTimezoneOffset();c+=p*60*1e3}}),c*u}calculateEndDate(n,s){const a=s>=0,l=this.accumulateWorkingTime(n,Math.abs(s),a);return l.remainingDurationInMs===0?l.finalDate:null}calculateStartDate(n,s){const a=s<=0,l=this.accumulateWorkingTime(n,Math.abs(s),a);return l.remainingDurationInMs===0?l.finalDate:null}skipNonWorkingTime(n,s=!0){let a;const l=this.forEachAvailabilityInterval(s?{startDate:n,isForward:!0}:{endDate:n,isForward:!1},(o,d,c)=>{if(c.getIsWorking())return a=s?o:d,!1});return l===Xt.MaxRangeReached||l===Xt.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(n)}addInterval(n){return this.addIntervals([n])[0]}addIntervals(n){return this.bumpVersion(),this.intervalStore.add(n)}removeInterval(n){return this.removeIntervals([n])}removeIntervals(n){return this.bumpVersion(),this.intervalStore.remove(n)}clearIntervals(n){return n||this.bumpVersion(),this.intervalStore.removeAll(n)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const n=new n0({isWorking:this.unspecifiedTimeIsWorking});return n.calendar=this,this.$calendarCache=new r0({calendar:this,unspecifiedTimeInterval:n,intervalStore:this.intervalStore,treatInconsistentIntervals:this.treatInconsistentIntervals,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(n=>{for(const s of n.intervalStore)s.resetPriority()})}insertChild(n,s,a){let l=e.insertChild.call(this,...arguments);return Array.isArray(l)||(l=[l]),l.forEach(o=>{o.bumpVersion(),o.resetPriorityOfAllIntervals()}),l}joinProject(){e.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){e.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(n){const s=C.clearTime(n),a=C.getNext(n,cs.Day);let l=!1;return this.forEachAvailabilityInterval({startDate:s,endDate:a,isForward:!0},(o,d,c)=>(l=c.getIsWorking(),!l)),!l}getDayIntervals(n){const s=C.clearTime(n),a=C.getNext(n,cs.Day);let l=[];return this.forEachAvailabilityInterval({startDate:s,endDate:a,isForward:!0},(o,d,c)=>l.push([o,d,c.intervals[0]])),l}getDailyHolidaysRanges(n,s){const a=[];for(n=C.clearTime(n);n<s;)this.isDayHoliday(n)&&a.push({startDate:n,endDate:C.getStartOfNextDay(n,!0,!0)}),n=C.getNext(n,cs.Day);return a}getWorkingTimeRanges(n,s,a){const l=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0,maxRange:a},(o,d,c)=>{if(c.getIsWorking()){const u=c.intervals[0];l.push({name:u.name,startDate:o,endDate:d})}}),l}getNonWorkingTimeRanges(n,s,a){const l=[];return this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0,maxRange:a},(o,d,c)=>{if(!c.getIsWorking()){const u=c.intervals[0];l.push({name:u.name,type:u.type,iconCls:u.iconCls,cls:u.cls,startDate:o,endDate:d})}}),l}isWorkingTime(n,s,a){if(a){let l;const o=this.forEachAvailabilityInterval({startDate:n,endDate:s,isForward:!0},(d,c,u)=>{if(u.getIsWorking()&&d<=n&&c>=s)return l=!0,!1});return o===Xt.MaxRangeReached||o===Xt.FullRangeIterated?!1:l}else{const l=this.skipNonWorkingTime(n);return l&&l!=="empty_calendar"?s?l<s:l.getTime()===n.getTime():!1}}}return t}){},$p=class extends De([s0,ol],i=>{const e=i.prototype;class t extends i{}return t}){},a0=class extends De([ci],i=>{class e extends i{doDestroy(){var r;const n=[];!this.isChained&&!((r=this.rootNode)!=null&&r.isDestroyed)&&this.traverse(s=>n.push(s)),super.doDestroy(),n.forEach(s=>s.destroy())}}return e}){},l0=class extends De([a0,ul],i=>{const e=i.prototype;class t extends i{static get defaultConfig(){return{tree:!0,modelClass:$p}}}return t}){},rA=class extends De([],Fe){},nA=class extends De([],fe){},sA=class extends De([rA,nA,me],i=>{const e=i.prototype;class t extends i{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(n={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const s="silenceInitialCommit"in n?n.silenceInitialCommit:!0,a="adjustDurationToDST"in n?n.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in n?n.maxCalendarRange:15768e7,delete n.maxCalendarRange,delete n.silenceInitialCommit,delete n.adjustDurationToDST,e.construct.call(this,n),this.silenceInitialCommit=s,this.adjustDurationToDST=a}repopulateStore(n){}repopulateReplica(){}deferUntilRepopulationIfNeeded(n,s,a){s(...a)}attachStore(n){}detachStore(n){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return t}){},o0=class extends De([],fe){},d0=class extends De([sA,Ph,o0,me],i=>{const e=i.prototype;class t extends i{static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"}]}static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:jh,assignmentModelClass:Gh,resourceModelClass:dl,dependencyModelClass:Yh,calendarModelClass:$p,eventStoreClass:fp,assignmentStoreClass:pp,resourceStoreClass:dp,dependencyStoreClass:vp,calendarManagerStoreClass:l0,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(n={}){var s;const a=this;if(a.$invalidated=new Set,a.$leaving=new Set,a.isPerformingCommit=!1,a.silenceInitialCommit=!0,a.ongoing=Promise.resolve(),n.eventStore&&!n.assignmentStore){const g=n.eventStore.masterStore||n.eventStore,f=g.assignmentStore||((s=g.crudManager)==null?void 0:s.assignmentStore);f!=null&&f.isAssignmentStore&&(n.assignmentStore=f,a.isSharingAssignmentStore=!0)}e.construct.call(a,n),a.defaultCalendar=new a.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:a.unspecifiedTimeIsWorking}),a.defaultCalendar.project=a;const{calendarsData:l,eventsData:o,dependenciesData:d,resourcesData:c,assignmentsData:u}=a;!!(l||o||d||c||u)?(a.loadInlineData({calendarsData:l,eventsData:o,dependenciesData:d,resourcesData:c,assignmentsData:u}),delete a.calendarsData,delete a.eventsData,delete a.dependenciesData,delete a.resourcesData,delete a.assignmentsData):a.bufferedCommitAsync()}doDestroy(){var n,s,a,l,o,d;const c=this;(n=c.eventStore)==null||n.destroy(),(s=c.dependencyStore)==null||s.destroy(),(a=c.assignmentStore)==null||a.destroy(),(l=c.resourceStore)==null||l.destroy(),(o=c.calendarManagerStore)==null||o.destroy(),c.defaultCalendar.destroy(),(d=c.stm)==null||d.destroy(),e.doDestroy.call(this)}async loadInlineData(n){const s=this;s.isLoadingInlineData=!0,n.calendarsData&&(s.calendarManagerStore.data=n.calendarsData),n.resourcesData&&(s.resourceStore.data=n.resourcesData),n.assignmentsData&&(s.assignmentStore.data=n.assignmentsData),n.eventsData&&(s.eventStore.data=n.eventsData),n.tasksData&&(s.eventStore.data=n.tasksData),n.dependenciesData&&(s.dependencyStore.data=n.dependenciesData),await s.commitLoad(),s.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}resolveStoreAndModelClass(n,s){const a=(s==null?void 0:s.storeClass)||this[`${n}StoreClass`];let l=s==null?void 0:s.modelClass;return l||(this.getDefaultConfiguration()[`${n}ModelClass`]!==a.getDefaultConfiguration().modelClass?l=a.getDefaultConfiguration().modelClass:l=this[`${n}ModelClass`]),{storeClass:a,modelClass:l}}setEventStore(n){this.eventStore=n}changeEventStore(n,s){const a=this,{stm:l}=a;if(a.detachStore(s),n instanceof pe)n.project=a,l.addStore(n),n.joinRecordsToProject(a);else{const{storeClass:o,modelClass:d}=a.resolveStoreAndModelClass("event",n);n=new o(T.assign({modelClass:d,project:a,stm:l},n))}if(s&&l.hasStore(s)){l.removeStore(s),s.unjoinRecordsFromProject(a);const{assignmentsForRemoval:o}=s;o.forEach(d=>{const c=d.event;if(c){const u=n.getById(c.id);u&&(d.event=u,o.delete(d))}}),s.afterEventRemoval()}return n.setProject(a),n}updateEventStore(n,s){this.attachStore(n),this.trigger("eventStoreChange",{store:n})}setAssignmentStore(n){this.assignmentStore=n}changeAssignmentStore(n,s){const a=this,{stm:l}=a;if(a.detachStore(s),s&&l.hasStore(s)&&(l.removeStore(s),s.unjoinRecordsFromProject(a)),n instanceof pe)n.project=a,l.addStore(n),n.joinRecordsToProject(a);else{const{storeClass:o,modelClass:d}=a.resolveStoreAndModelClass("assignment",n);n=new o(T.assign({modelClass:d,project:a,stm:l},n))}return n.setProject(a),n}updateAssignmentStore(n,s){this.attachStore(n),this.trigger("assignmentStoreChange",{store:n})}setResourceStore(n){this.resourceStore=n}changeResourceStore(n,s){const a=this,{stm:l}=a;if(a.detachStore(s),n instanceof pe)n.project=a,l.addStore(n),n.joinRecordsToProject(a);else{const{storeClass:o,modelClass:d}=a.resolveStoreAndModelClass("resource",n);n=new o(T.assign({modelClass:d,project:a,stm:l},n))}if(s&&l.hasStore(s)){l.removeStore(s),s.unjoinRecordsFromProject(a);const{assignmentsForRemoval:o}=s;o.forEach(d=>{const c=d.resource;if(c){const u=n.getById(c.id);u&&(d.resource=u,o.delete(d))}}),s.afterResourceRemoval()}return n.setProject(a),n}updateResourceStore(n,s){this.attachStore(n),this.trigger("resourceStoreChange",{store:n})}setDependencyStore(n){this.dependencyStore=n}changeDependencyStore(n,s){const a=this;if(a.detachStore(s),n instanceof pe)n.project=a,a.stm.addStore(n),n.joinRecordsToProject(a);else{const{storeClass:l,modelClass:o}=a.resolveStoreAndModelClass("dependency",n);n=new l(T.assign({modelClass:o,project:a,stm:a.stm},n))}return n}updateDependencyStore(n,s){this.attachStore(n),this.trigger("dependencyStoreChange",{store:n})}setCalendarManagerStore(n){this.calendarManagerStore=n}changeCalendarManagerStore(n,s){const a=this;if(a.detachStore(s),n instanceof pe)a.stm.addStore(n);else{const l=(n==null?void 0:n.storeClass)||a.calendarManagerStoreClass,o=(n==null?void 0:n.modelClass)||l.getDefaultConfiguration().modelClass||a.calendarModelClass;n=new l(T.assign({modelClass:o,project:a,stm:a.stm},n))}return n.setProject(a),n}updateCalendarManagerStore(n,s){this.attachStore(n),this.trigger("calendarManagerStoreChange",{store:n})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(n){this.$calendar=n}get effectiveCalendar(){return this.calendar}async addEvent(n){return this.eventStore.add(n),this.commitAsync()}async addAssignment(n){return this.assignmentStore.add(n),this.commitAsync()}async addResource(n){return this.resourceStore.add(n),this.commitAsync()}async addDependency(n){return this.dependencyStore.add(n),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:()=>{var n;return(n=this.commitAsync)==null?void 0:n.call(this)},name:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:(this.trigger("beforeCommit"),this.ongoing=this.doCommitAsync())}async doCommitAsync(){const n=this;if(!n.$invalidated.size&&!n.$leaving.size&&!n.hasLoadedDataToCommit&&!n.isInitialCommit){n.trigger("commitFinalized");return}if(n.$leaving.clear(),n.isPerformingCommit=!0,await OD(0),!n.isDestroyed){n.unScheduleAutoCommit();for(const d of n.$invalidated)d.calculateInvalidated();const{isInitialCommit:s,silenceInitialCommit:a}=n,l=s&&a;n.assignmentStore.onCommitAsync(),n.dependencyStore.onCommitAsync(),n.isInitialCommitPerformed=!0,n.hasLoadedDataToCommit=!1,n.isPerformingCommit=!1;const o=[n.assignmentStore,n.dependencyStore,n.eventStore,n.resourceStore,n.calendarManagerStore];if(o.forEach(d=>{var c,u;(c=d.suspendAutoCommit)==null||c.call(d),(u=d.suspendSortOnUpdate)==null||u.call(d)}),n.isWritingData=!0,n.trigger("refresh",{isInitialCommit:s,isCalculated:!0}),l)for(const d of n.$invalidated)d.finalizeInvalidated(!0);else{for(const d of n.$invalidated)d.beginBatch(!0),d.finalizeInvalidated();for(const d of n.$invalidated)d.endBatch(!1,!0)}return n.isWritingData=!1,n.$invalidated.clear(),n.trigger("dataReady"),o.forEach(d=>{var c,u;(c=d.resumeAutoCommit)==null||c.call(d),(u=d.resumeSortOnUpdate)==null||u.call(d)}),n.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(n){this.$invalidated.add(n),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(n){n=this.$stm=new Ko(T.assign({disabled:!0},n)),n.ion({restoringStop:async()=>{n.disable(),await this.commitAsync(),this.isDestroyed||(n.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return t.$name="SchedulerCoreProjectMixin",t.applyConfigs=!0,t}){},aA=d0,tn=class extends JI(ZD(aA)){static get defaultConfig(){return{eventModelClass:hl,dependencyModelClass:mt,resourceModelClass:cl,assignmentModelClass:gl,eventStoreClass:ec,dependencyStoreClass:qh,resourceStoreClass:Zd,assignmentStoreClass:rc}}construct(...i){super.construct(...i),re.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new JD({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};y(tn,"$name","ProjectModel"),tn.applyConfigs=!0,tn.initClass(),tn._$name="ProjectModel";var lc=class extends wp.mixin(GD,bp,Cp,qD){static get defaultConfig(){return{projectClass:tn,resourceStoreClass:Zd,eventStoreClass:ec,assignmentStoreClass:rc,dependencyStoreClass:qh,resourceTimeRangeStoreClass:fl,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null,resourceTimeRangeStore:{}}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return T.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(i){const e=this;i!==e._project&&(e.detachListeners("beforeDataReady"),e.detachListeners("afterDataReady"),e._project=i,i&&(e.eventStore=i.eventStore,e.resourceStore=i.resourceStore,e.assignmentStore=i.assignmentStore,e.dependencyStore=i.dependencyStore,e.timeRangeStore=i.timeRangeStore,e.resourceTimeRangeStore=i.resourceTimeRangeStore,i.ion({name:"beforeDataReady",dataReady:()=>e.suspendChangeTracking(),prio:100,thisObj:e}),i.ion({name:"afterDataReady",dataReady:()=>e.resumeChangeTracking(),prio:-100,thisObj:e})),e.eventStore||(e.eventStore={}),e.resourceStore||(e.resourceStore={}),e.assignmentStore||(e.assignmentStore={}),e.dependencyStore||(e.dependencyStore={}),e.resourceTimeRangeStore||(e.resourceTimeRangeStore={}))}get project(){return this._project}get timeRangeStore(){var i;return(i=this._timeRangeStore)==null?void 0:i.store}set timeRangeStore(i){var e;this.setFeaturedStore("_timeRangeStore",i,(e=this.project)==null?void 0:e.timeRangeStoreClass)}get resourceTimeRangeStore(){var i;return(i=this._resourceTimeRangeStore)==null?void 0:i.store}set resourceTimeRangeStore(i){this.setFeaturedStore("_resourceTimeRangeStore",i,this.resourceTimeRangeStoreClass)}get resourceStore(){var i;return(i=this._resourceStore)==null?void 0:i.store}set resourceStore(i){this.setFeaturedStore("_resourceStore",i,this.resourceStoreClass)}get eventStore(){var i;return(i=this._eventStore)==null?void 0:i.store}set eventStore(i){this.setFeaturedStore("_eventStore",i,this.eventStoreClass)}get assignmentStore(){var i;return(i=this._assignmentStore)==null?void 0:i.store}set assignmentStore(i){this.setFeaturedStore("_assignmentStore",i,this.assignmentStoreClass)}get dependencyStore(){var i;return(i=this._dependencyStore)==null?void 0:i.store}set dependencyStore(i){this.setFeaturedStore("_dependencyStore",i,this.dependencyStoreClass)}setFeaturedStore(i,e,t){var r;const n=this,s=(r=n[i])==null?void 0:r.store;return s!==e&&(e=pe.getStore(e,(e==null?void 0:e.storeClass)||t),s&&n.removeStore(s),n[i]=e&&{store:e}||null,n.addPrioritizedStore(n[i])),n[i]}getChangesetPackage(){var i,e;const t=this,r=super.getChangesetPackage();return r&&(t.eventStore.usesSingleAssignment||(e=(i=t.eventStore.modelClass.fieldMap)==null?void 0:i.resourceIds)!=null&&e.persist)&&(delete r[t.assignmentStore.id],!t.forceSync&&!t.crudStores.some(n=>r[n.storeId]))?null:r}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}};y(lc,"$name","CrudManager"),lc._$name="CrudManager";var lA=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],oA=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"],c0=i=>{var e;return e=class extends i{preProcessCurrentConfigs(t){for(const r of oA)delete t[r];super.preProcessCurrentConfigs(t)}getCurrentConfig(t){var r,n;const s=(n=(r=this.project).getCurrentConfig)==null?void 0:n.call(r,t),a=super.getCurrentConfig(t);if(s){a.project=s;const{crudManager:l}=a;if(l)for(const o of lA)l[o]&&(s[o]=l[o]);Object.keys(s).length===0&&delete a.project}return delete a.data,delete a.store,delete a.eventStore,delete a.resourceStore,delete a.crudManager,a}get widgetClass(){}},y(e,"$name","CurrentConfig"),e},u0=i=>!i||Array.isArray(i)?i:[i],h0=(i,e,t)=>i&&i[e]!==!0?i[e]:t,Hp=i=>{var e;return e=class extends(i||$){get dateBounds(){return[this.date]}get description(){const t=this,{descriptionRenderer:r}=t;return r?t.callback(r,t,[t]):t.formattedDescription}get formattedDescription(){var t,r;if(((t=this.range)==null?void 0:t.magnitude)===1&&this.range.unit!=="day")return this.rangeDescription;{const n=this,{dateBounds:s,dateFormat:a}=n,l=(r=n.descriptionFormat)!=null?r:u0(n.defaultDescriptionFormat),o=h0(l,0,a),d=s.length>1&&(l==null?void 0:l.length)>1&&C.format(s[0],o)!==C.format(s[1],o);let c=C.format(s[0],o);return d&&(c=C.formatRange(s,h0(l,1,`S${a}${n.dateSeparator}E${a}`))),c}}get rangeDescription(){const t=this,{date:r,startDate:n,endDate:s,range:a}=t,l=t.month||(t.month=new _i({date:r}));let o;switch(a.unit){case"day":o=C.format(r,"L");break;case"week":{const d=n.getMonth(),c=s.getMonth(),u=d===c?C.format(n,"MMMM"):`${C.format(n,"MMM")} - ${C.format(s,"MMM")}`,h=l.getWeekNumber(n);o=`${t.L("L{Object.Week}")} ${h[1]}, ${u} ${h[0]}`;break}case"month":o=C.format(r,"MMMM, YYYY");break;case"year":o=C.format(r,"YYYY");break;case"decade":o=`${C.format(n,"DC")}`}return o}changeDescriptionFormat(t){return u0(t)}get widgetClass(){}},y(e,"$name","Describable"),y(e,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),e},g0=i=>{var e;return e=class extends(i||$){getElementFromAssignmentRecord(t,r=!1,n=!1,s=!1){var a,l,o,d,c,u,h;const g=this;if(g.isPainted&&t){const{foregroundCanvas:f}=g;let m=(a=f.syncIdMap)==null?void 0:a[t.id];if(!m){const p=s&&(((l=g.subViews)==null?void 0:l[0])||g.splitFrom);if(p&&(m=p.getElementFromAssignmentRecord(t,!0,n)),!m&&((o=t.resource)!=null&&o.hasLinks))for(const v of t.resource.$links){if(m=(d=f.syncIdMap)==null?void 0:d[`${t.id}_${v.id}`],m)break;if(n&&(m=(c=f.releasedIdMap)==null?void 0:c[`${t.id}_${v.id}`],m))break}}return!m&&n&&(m=(u=f.releasedIdMap)==null?void 0:u[t.id]),r?m:(h=m==null?void 0:m.syncIdMap)==null?void 0:h.event}return null}getElementFromEventRecord(t,r=(a=>(a=t.resources)==null?void 0:a[0])(),n=!1,s=!1){var a;if(t.isResourceTimeRange){const o=(a=this.foregroundCanvas.syncIdMap)==null?void 0:a[t.domId];return n?o:o==null?void 0:o.syncIdMap.event}const l=this.assignmentStore.getAssignmentForEventAndResource(t,r);return this.getElementFromAssignmentRecord(l,n,s)}getElementsFromEventRecord(t,r,n=!1,s=!1){return r?[this.getElementFromEventRecord(t,r,n,s)]:t.resources.reduce((a,l)=>{const o=this.getElementFromEventRecord(t,l,n,s);return o&&a.push(o),a},[])}resolveResourceRecord(t,r){var n;const s=t instanceof Event?t.target:t,a=(n=s.dataset)==null?void 0:n.resourceId,l=a&&this.resourceStore.getById(a)||this.currentOrientation.resolveRowRecord(t,r);return l!=null&&l.isSpecialRow?null:l}resolveRowRecord(t){return this.resolveResourceRecord(t)}resolveEventRecord(t){t instanceof Event&&(t=t.target);const r=t==null?void 0:t.closest(this.eventSelector);if(r){if("eventId"in r.dataset)return this.eventStore.getById(r.dataset.eventId);if("assignmentId"in r.dataset)return this.assignmentStore.getById(r.dataset.assignmentId).event}return null}resolveTimeSpanRecord(t){return this.resolveEventRecord(t)}resolveAssignmentRecord(t,r=!1){const n=t.closest(r?"[data-assignment-id][data-event-id]":this.eventSelector),s=n&&this.assignmentStore.getById(n.dataset.assignmentId),a=n&&this.eventStore.getById(n.dataset.eventId);return this.assignmentStore.getOccurrence(s,a)}isRowVisible(t){return this.store.indexOf(t)>=0}get widgetClass(){}isEventElement(t){const r=t==null?void 0:t.className;return!!(r!=null&&r[this.eventCls+"-wrap"])}},y(e,"$name","SchedulerDom"),e},f0=i=>{var e;return e=class extends(i||$){getTimeSpanMouseEventParams(t,r){const n=this.resolveEventRecord(t);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(t),assignmentRecord:this.resolveAssignmentRecord(t),eventElement:t,event:r}}getScheduleMouseEventParams(t,r){const n=this.isVertical?this.resolveResourceRecord(r):this.store.getById(t.id);return n?{resourceRecord:n}:null}onElementKeyDown(t){const r=super.onElementKeyDown(t),n=this;return n.selectedEvents.length&&t.target.closest(".b-sch-event-wrap")&&n.trigger(n.scheduledEventName+"KeyDown",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:t}),r}onElementKeyUp(t){super.onElementKeyUp(t);const r=this;r.selectedEvents.length&&r.trigger(r.scheduledEventName+"KeyUp",{eventRecords:r.selectedEvents,assignmentRecords:r.selectedAssignments,event:t})}get widgetClass(){}},y(e,"$name","SchedulerDomEvents"),e},Vp=class extends ${static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(i){i?delete this.nbrOfBandsByResource[i.id]:this.nbrOfBandsByResource={}}applyLayout(i,e){return this.nbrOfBandsByResource[e.id]=this.layoutEventsInBands(i,e)}layoutEventsInBands(i,e){throw new Error("Implement in subclass")}};Vp._$name="HorizontalLayout";var Kh=class extends Vp{static get configurable(){return{type:"stack"}}layoutEventsInBands(i,e,t=!1){let r=0;do{let n=0,s=i[0];for(;s;)t||(s.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,r,s.eventRecord,s.resourceRecord)),i.splice(n,1),n=this.findClosestSuccessor(s,i),s=i[n];r++}while(i.length>0);return r}findClosestSuccessor(i,e){var t,r;const{endMS:n,group:s}=i,a=((t=i.eventRecord)==null?void 0:t.duration)===0;let l=1/0,o,d,c,u;for(let h=0,g=e.length;h<g;h++)if(c=e[h],d=c.startMS-n,u=c.endMS-c.startMS===0&&!((r=c.eventRecord)!=null&&r.meta.isDragCreating),d>=0&&d<l&&(d>0||!u||!a)){if(this.grouped&&s!==c.group)break;o=h,l=d}return o}};y(Kh,"$name","HorizontalLayoutStack"),Kh._$name="HorizontalLayoutStack";var m0=(i,e,t,r)=>t<=i&&i<r||i<=t&&t<e,Xh=i=>{var e;return e=class extends(i||$){isSameGroup(t,r){return this.grouped?t.group===r.group:!0}packEventsInBands(t,r){const n=this,{coordProp:s,sizeProp:a}=n;let l,o,d,c;for(let u=0,h=t.length;u<h;u++){if(o=t[u],l=n.findStartSlot(t,o),d=n.getCluster(t,u),d.length>1){for(o[s]=l.start,o[a]=l.end-l.start,c=1;c<d.length-1&&d[c+1].start-o.start===0;)c++;const m=n.findStartSlot(t,d[c]);m&&m.start<.8&&(d.length=c)}const g=d.length,f=(l.end-l.start)/g;for(c=0;c<g;c++)r(d[c],c,l,f);u+=g-1}return 1}findStartSlot(t,r){const{inBandSizeProp:n,inBandCoordProp:s,coordProp:a,sizeProp:l}=this,o=this.getPriorOverlappingEvents(t,r);let d;if(o.length===0)return{start:0,end:1};for(d=0;d<o.length;d++){const c=o[d],u=s in c?s:a,h=n in c?n:l;if(d===0&&c[u]>0)return{start:0,end:c[u]};if(c[u]+c[h]<(d<o.length-1?o[d+1][u]:1))return{start:c[u]+c[h],end:d<o.length-1?o[d+1][u]:1}}return!1}getPriorOverlappingEvents(t,r){const{startMS:n,endMS:s}=r,a=[];for(let l=0,o=t.indexOf(r);l<o;l++){const d=t[l];this.isSameGroup(d,r)&&m0(n,s,d.startMS,d.endMS)&&a.push(d)}return a.sort(this.sortOverlappers.bind(this)),a}sortOverlappers(t,r){const{coordProp:n}=this;return t[n]-r[n]}getCluster(t,r){const n=t[r],s=[n];if(r>=t.length-1)return s;let{startMS:a,endMS:l}=n;for(let o=r+1,d=t.length;o<d;o++){const c=t[o];if(!this.isSameGroup(c,n)||!m0(a,l,c.startMS,c.endMS))break;s.push(c),a=Math.max(a,c.startMS),l=Math.min(c.endMS,l)}return s}},y(e,"$name","PackMixin"),y(e,"configurable",{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}),e},oc=class extends Vp.mixin(Xh){layoutEventsInBands(i){const e=this.packEventsInBands(i,(t,r,n,s)=>{t.height=s,t.top=n.start+r*s});return i.forEach(t=>{Object.assign(t,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t.top,t.height,t.eventRecord,t.resourceRecord))}),e}};y(oc,"$name","HorizontalLayoutPack"),y(oc,"configurable",{type:"pack"}),oc._$name="HorizontalLayoutPack";var p0=i=>{var e;return e=class extends(i||$){get resourceColumns(){var t;return((t=this.timeAxisColumn)==null?void 0:t.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var t;return((t=this.resourceColumns)==null?void 0:t.columnWidth)||null}getResourceMarginObject(t){var r;if(t!=null&&t.resourceMargin){const n=(r=t==null?void 0:t.resourceMargin)!=null?r:this.resourceMargin;return typeof n=="number"?{start:n,end:n,total:n*2}:(n.total=n.start+n.end,n)}else return this.resourceMarginObject}getBarMargin(t){var r;return(r=t==null?void 0:t.barMargin)!=null?r:this.barMargin}getResourceHeight(t){var r;return(r=t.rowHeight)!=null?r:this.isHorizontal?this.rowHeight:this.getResourceWidth(t)}getResourceWidth(t){var r;return(r=t.instanceMeta(this).columnWidth)!=null?r:this.resourceColumnWidth}getAppliedResourceHeight(t){var r;const n=this.getRowById(t);return(r=n==null?void 0:n.maxRequestedHeight)!=null?r:this.getResourceHeight(t)}getResourceLayoutSettings(t,r=null){const n=this.getResourceMarginObject(t,r),s=this.getAppliedResourceHeight(t,r);return{barMargin:this.getBarMargin(t,r),contentHeight:Math.max(s-n.total,1),rowHeight:s,resourceMarginObject:n}}get widgetClass(){}},y(e,"$name","SchedulerResourceRendering"),y(e,"configurable",{resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"}),e},v0=i=>{var e;return e=class extends p0(i||$){static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",horizontalLayoutPackClass:oc,horizontalLayoutStackClass:Kh,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,eventReleaseThreshold:null,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move",testConfig:{useInitialAnimation:!1}}}changeEventLayout(t){return this.isConfiguring&&this.mode==="vertical"&&(t==="stack"||t.type==="stack")&&(t="pack"),this.internalEventLayout=t,this.internalEventLayout.type}changeInternalEventLayout(t){return this.getEventLayout(t)}updateInternalEventLayout(t,r){const n=this;r&&n.element.classList.remove(`b-eventlayout-${r.type}`),n.element.classList.add(`b-eventlayout-${t.type}`),t.type==="layoutFn"&&n.isVertical&&(n.resourceColumns.fitWidth=n.resourceColumns.fillWidth=!1),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}updateOverlappingEventSorter(t){this.isConfiguring||this.refreshWithTransition()}updateEventReleaseThreshold(){this.isConfiguring||this.refresh()}getEventLayout(t){return t!=null&&t.isModel&&(t=t.eventLayout||this.internalEventLayout),typeof t=="string"&&(t={type:t}),t}getEventLayoutHandler(t){const r=this;if(!r.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:s}=r,{type:a}=t;switch(r.layouts||(r.layouts={}),a){case"stack":return r.layouts.horizontalStack||(r.layouts.horizontalStack=new r.horizontalLayoutStackClass(T.assign({scheduler:r,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:s},t))),r.layouts.horizontalStack;case"pack":return r.layouts.horizontalPack||(r.layouts.horizontalPack=new r.horizontalLayoutPackClass(T.assign({scheduler:r,timeAxisViewModel:n,bandIndexToPxConvertFn:s.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:s},t))),r.layouts.horizontalPack;default:return null}}getEventsToRender(t,r){return r}repaintEventsForResource(t){this.currentOrientation.repaintEventsForResource(t)}repaintEvent(t){this.eventStore.getResourcesForEvent(t).forEach(n=>this.repaintEventsForResource(n))}getEventStyle(t,r){return t.eventStyle||r.eventStyle||this.eventStyle}getEventColor(t,r){var n,s;return t.eventColor||((n=t.event)==null?void 0:n.eventColor)||((s=t.parent)==null?void 0:s.eventColor)||r.eventColor||this.eventColor}generateRenderData(t,r,n={viewport:!0}){var s,a;const l=this,o=l.currentOrientation.getTimeSpanRenderData(t,r,n),{isEvent:d}=t,{eventResize:c}=l.features,u=!t.meta.isDragCreating&&t.isMilestone,h=d&&t.assignments.find(f=>f.resourceId===r.$originalId),g={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(o){Object.assign(o,{isWrap:!0,wrapperStyle:"",tabIndex:"0",eventGeneration:t.generation,resourceGeneration:r.generation,assignmentGeneration:h==null?void 0:h.generation});let f=t.isResizable;c&&f&&(o.startsOutsideView&&(f===!0?f="end":f==="start"&&(f=!1)),o.endsOutsideView&&(f===!0?f="start":f==="end"&&(f=!1)),f&&(l.isHorizontal?!l.rtl&&!c.leftHandle||l.rtl&&!c.rightHandle?f=f==="start"?!1:"end":(!l.rtl&&!c.rightHandle||l.rtl&&!c.leftHandle)&&(f=f==="end"?!1:"start"):c.topHandle?c.bottomHandle||(f=f==="end"?!1:"start"):f=f==="start"?!1:"end"));const m=!!(t.hasPersistableChanges||h!=null&&h.hasPersistableChanges),p={[r.cls]:r.cls,[l.generatedIdCls]:!t.isOccurrence&&t.hasGeneratedId,[l.dirtyCls]:m,[l.committingCls]:t.isCommitting,[l.endsOutsideViewCls]:o.endsOutsideView,[l.startsOutsideViewCls]:o.startsOutsideView,"b-clipped-start":o.clippedStart,"b-clipped-end":o.clippedEnd,"b-iscreating":t.isCreating,"b-rtl":l.rtl},v={[`${l.eventCls}-parent`]:r.isParent,"b-readonly":t.readOnly||(h==null?void 0:h.readOnly),"b-linked-resource":r.isLinked,"b-original-resource":r.hasLinks},b=t.isResourceTimeRange?new te:t.internalCls.clone(),w=t.isResourceTimeRange?t.internalCls.clone():new te;if(d){const R=h&&l.isAssignmentSelected(h);T.assign(p,{[l.eventCls]:1,"b-milestone":u,"b-sch-event-narrow":!u&&o.width<l.narrowEventWidth,[l.fixedEventCls]:t.isDraggable===!1,[`b-sch-event-resizable-${f}`]:!!(c&&!t.readOnly),[l.eventSelectedCls]:R,[l.eventAssignHighlightCls]:l.eventAssignHighlightCls&&!R&&l.isEventSelected(t),"b-recurring":t.isRecurring,"b-occurrence":t.isOccurrence,"b-inactive":t.inactive}),o.eventId=t.id;const M=l.getEventStyle(t,r),_=l.getEventColor(t,r),k=l.isFirstRender&&l.useInitialAnimation&&globalThis.bryntum.noAnimations!==!0;if(T.assign(v,{[`${l.eventCls}-wrap`]:1,"b-milestone-wrap":u,[l.navigator.focusCls]:t.assignments.some(F=>F===l.activeAssignment)}),k){const F=o.row?o.row.index:(o.top-l.scrollTop)/l.tickSize,I=F/20*1e3;o.wrapperStyle=`animation-delay: ${I}ms;`,l.maxDelay=Math.max(l.maxDelay||0,I),l.initialAnimationDetacher||(l.initialAnimationDetacher=V.on({element:l.foregroundCanvas,delegate:l.eventSelector,once:!0,animationend:()=>l.setTimeout({fn:"stopInitialAnimation",delay:l.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:l.initialAnimationDuration+l.maxDelay},thisObj:l}))}o.eventColor=_,o.eventStyle=M,o.assignmentRecord=o.assignment=h}if(o.wrapperCls=T.assign(w,v),o.cls=T.assign(b,p),o.iconCls=new te(t.getValue(l.eventBarIconClsField)||t.iconCls),t.isResourceTimeRange?(o.style="",o.wrapperStyle+=t.style||""):o.style=t.style||"",o.resource=o.resourceRecord=r,o.resourceId=o.rowId,d){let R=null,M=null,_;if(l.eventRenderer){const k=l.eventRenderer.call(l.eventRendererThisObj||l,{eventRecord:t,resourceRecord:r,assignmentRecord:o.assignmentRecord,scheduler:l,renderData:o});o.ariaLabel&&(o.ariaLabelFromEventRenderer=!0),typeof o.cls=="string"&&(o.cls=new te(o.cls)),typeof o.wrapperCls=="string"&&(o.wrapperCls=new te(o.wrapperCls)),typeof o.iconCls=="string"&&(o.iconCls=new te(o.iconCls)),_=k}else l.eventBarTextField&&(_=O.encodeHtml(t.getValue(l.eventBarTextField)||""));g.children=[],u&&(l.milestoneLayoutMode==="default"||l.milestoneTextPosition==="always-outside")&&_!=null&&_!==""&&g.children.unshift(M={tag:"label",children:[],dataset:{isMilestone:!0}}),(s=o.iconCls)!=null&&s.length&&g.children.unshift({tag:"i",className:o.iconCls}),Array.isArray(_)?(M||g).children.push(..._):O.isHtml(_)?g.children.length?R={tag:"span",class:"b-event-text-wrap",html:_}:(g.children=null,g.html=_):typeof _=="string"||typeof _=="object"?R=_:_!=null&&(R=String(_)),R!=null&&((M||g).children.push(R),o.cls.add("b-has-content")),(g.html!=null||g.children.length)&&o.children.push(g),o.cls.toggle("b-highlighted",!!(h!=null&&h.instanceMeta(l).isHighlighted))}const{eventStyle:D,eventColor:S,wrapperCls:x}=o;if(x[`b-sch-style-${D||"none"}`]=1,E.isNamedColor(S))x[`b-sch-color-${S}`]=S;else if(S){const R=D?"color":"background-color",M=`${R}:${S};`;o.style=M+o.style,x["b-sch-custom-color"]=1,o._customColorStyle=M}else x["b-sch-color-none"]=1;if(o.style&&u&&g&&(g.style=o.style,delete o.style),o.cls["b-sch-event-withicon"]=(a=o.iconCls)==null?void 0:a.length,o.eventContent=g,o.wrapperChildren=[],!o.ariaLabelFromEventRenderer){const R=C.format(t.startDate,this.displayDateFormat);o.ariaLabel=l.L("L{SchedulerBase.eventAriaLabel}")(t,R)}l.onEventDataGenerated(o)}return o}onEventDataGenerated(t){}changeUseInitialAnimation(t){return t===!0?"fade-in":t}updateUseInitialAnimation(t,r){const{classList:n}=this.element;r&&n.remove(`b-initial-${r}`),t&&(n.add(`b-initial-${t}`),Y.isFirefox&&n.add("b-prevent-event-transitions"))}restartInitialAnimation(t){var r;const n=this;(r=n.initialAnimationDetacher)==null||r.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=t,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const t=this;t.initialAnimationDetacher(),t.isFirstRender=!1,t.useInitialAnimation=!1,Y.isFirefox&&t.setTimeout(()=>t.element.classList.remove("b-prevent-event-transitions"),100)}getMilestoneLabelWidth(t,r){const n=this,s=n.milestoneLayoutMode,a=n.getResourceLayoutSettings(r).contentHeight;if(s==="measure"){const l=O.encodeHtml(t.name),o=n.getEventColor(t,r),d=n.getEventStyle(t,r),c=n.milestoneMeasureElement||(n.milestoneMeasureElement=E.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${o}`]:o,[`b-sch-style-${d}`]:d},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:n.foregroundCanvas}));if(c.retainElement=!0,c.style.fontSize=`${a}px`,n.milestoneTextPosition==="always-outside"){const u=c.firstElementChild.firstElementChild.firstElementChild;u.innerHTML=l;const h=L.from(u,u.parentElement);return h.left+h.width+2}else return c.firstElementChild.firstElementChild.innerHTML=`<label></label>${l}`,c.firstElementChild.offsetWidth}return s==="estimate"?t.name.length*n.milestoneCharWidth+(n.milestoneTextPosition==="always-outside"?a:0):s==="data"?t.milestoneWidth+(n.milestoneTextPosition==="always-outside"?a:0):0}updateMilestoneLayoutMode(t){const r=this,n=r.milestoneTextPosition==="always-outside";r.element.classList.toggle("b-sch-layout-milestones",t!=="default"&&!n),r.element.classList.toggle("b-sch-layout-milestone-labels",t!=="default"&&n),r.isConfiguring||r.refreshWithTransition()}updateMilestoneTextPosition(t){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside",t==="inside"),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},y(e,"$name","SchedulerEventRendering"),e},y0=["assignmentStore","dependencyStore","eventStore","resourceStore"],Np=i=>{var e,t;return e=class extends(i||$){constructor(){super(...arguments),Lv(this,t,void 0)}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:tn,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(r){this.getConfig("project"),super.startConfigure(r)}changeProject(r,n){const s=this,{projectDataNames:a}=s.constructor;if(s.projectCallbacks=new Set,r){if(s.buildingProjectConfig=!0,!r.isModel){if(s.isConfiguring){s._project=r;const{crudManager:d}=s;d&&this.updateStoresFromCrudManager(),s.getConfig("projectStores");for(const c of a)s.getConfig(c)}const{eventStore:l}=r;let{_sharedProject:o}=s;if(l!=null&&l.autoLoad&&!l.isEventStoreMixin&&!l.count&&!l.lazyLoad&&(l.autoLoad=!1,s.delayAutoLoad=!0),o&&y0.some(d=>r[d]&&r[d]!==o[d])){for(const d of y0)r[d]&&r[d]===o[d]&&(r[d]=r[d].chain());o=null}r=o||new s.projectModelClass(r),delete s._project}s.buildingProjectConfig=!1}return r}updateStoresFromCrudManager(){const{crudManager:r}=this,{isCrudManager:n}=r;for(const s of this.constructor.projectStoreNames)r[s]&&(this[s]=r[s],n||delete r[s])}updateProject(r,n){var s;const a=this,{projectListeners:l,crudManager:o}=a;if(a.detachListeners("projectConsumer"),a.detachListeners("projectDestroy"),delete a._crudManager,r){l.thisObj=a,r.ion(l),r.isCrudManager?a.crudManager=r:o&&(o.project=r,a.crudManager=o),a.projectSubscribers.forEach(d=>{d.detachFromProject(n),d.attachToProject(r)});for(const d of a.constructor.projectStoreNames)a[d]=r[d];a.delayAutoLoad&&(r.eventStore.autoLoad=!0,r.eventStore.load()),(s=r.stm)==null||s.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:a}),r.ion({name:"projectDestroy",beforeDestroy:"onProjectBeforeDestroy",thisObj:a})}a.trigger("projectChange",{project:r})}changeCrudManager(r){if(this.buildingProjectConfig)this._crudManager=r.isCrudManager?r:Object.assign({},r);else return super.changeCrudManager(r)}updateCrudManager(r){!this.isConfiguring&&r&&this.updateStoresFromCrudManager()}onProjectBeforeDestroy(r){const n=new r.source.constructor;this.project=n}onProjectDataReady(){const r=this;r.whenVisible(()=>{r.projectCallbacks.size&&(r.projectCallbacks.forEach(n=>n()),r.projectCallbacks.clear())},null,null,"onProjectDataReady")}onProjectRestoringStart({stm:r}){const{rawQueue:n}=r;n.length&&n[n.length-1].length>1&&(Bs(this,t,!0),this.suspendRefresh())}onProjectRestoringStop(){Av(this,t)&&(Bs(this,t,!1),this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:r,oldTimeZone:n}){const s=this;if(s.startDate&&s.timeAxis.timeZone!==r){const a=n!=null?$e.fromTimeZone(s.startDate,n):s.startDate;s.startDate=r!=null?$e.toTimeZone(a,r):a,s.timeAxis.timeZone=r}}onStartApplyChangeset(){this.suspendRefresh()}onEndApplyChangeset(){this.resumeRefresh(!0)}whenProjectReady(r){this.isEngineReady?r():this.projectCallbacks.add(r)}get isEngineReady(){var r,n;return!!((n=(r=this.project).isEngineReady)!=null&&n.call(r))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:r}=this.constructor;return r.map(n=>this[n])}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce((r,n)=>{const{dataName:s}=this.projectStores[n];return s&&r.push(s),r},[])}static setupProjectStores(r,n){const{projectStores:s}=r;if(s){const a={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset",startApplyingRevision:"onStartApplyChangeset",stopApplyingRevision:"onEndApplyChangeset"},l={projectListeners:a};let o;for(const d in s){const{dataName:c}=s[d];l[d]=l[c]=null,c&&(Object.defineProperty(n.class.prototype,c,{configurable:!0,get(){var u;return(u=this.project[d])==null?void 0:u.records}}),this.createDataUpdater(d,c,o,n)),this.createStoreDescriptor(n,d,s[d],a),o=c}this.setupConfigs(n,l)}}static createDataUpdater(r,n,s,a){a.class.prototype[`update${O.capitalize(n)}`]=function(l){const{project:o}=this;s&&this.getConfig(s),this.buildingProjectConfig?o[`${n}Data`]=l:o[r].data=l}}static createStoreDescriptor(r,n,{listeners:s},a){const{prototype:l}=r.class,o=O.capitalize(n);a[`${n}Change`]=function({store:d}){this[n]=d},l[`change${o}`]=function(d,c){const u=this,{project:h}=u,g=d==null?void 0:d.project;if(u.buildingProjectConfig){g!=null&&g.isProjectModel&&(u._sharedProject=g),h[n]=d;return}return u.initializingProject||h[n]!==d&&(h[`set${o}`](d),d=h[n]),d!==c&&(s&&(s.thisObj=u,s.name=`${n}Listeners`,s.startApplyChangeset="onProjectStoreStartApplyChangeset",s.endApplyChangeset="onProjectStoreEndApplyChangeset",u.detachListeners(s.name),d.ion(s)),u[`_${n}`]=d,u.projectSubscribers.forEach(f=>{var m;(m=f[`attachTo${o}`])==null||m.call(f,d)}),u[`_${n}`]=null),d}}onProjectStoreStartApplyChangeset(){this.suspendRefresh()}onProjectStoreEndApplyChangeset(){this.resumeRefresh(!0)}relayProjectDataChange(r){if(!((r.isExpand||r.isCollapse)&&!r.records[0].fieldMap.expanded.persist))return this.trigger("dataChange",{project:r.source,...r,source:this})}get widgetClass(){}},t=new WeakMap,y(e,"$name","ProjectConsumer"),e},b0=i=>{var e;return e=class extends Np(i||$){static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!0,crudManagerClass:null,crudManager:null}}updateProject(t,r){super.updateProject(t,r),this.detachListeners("schedulerStores"),t.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this}),this.bindEventStoreForEarlyPositioning(t.eventStore)}onProjectRefresh({isInitialCommit:t}){const r=this;r.isVisible?(t&&r.isVertical&&(r.refreshAfterProjectRefresh=!1,r.refreshWithTransition()),r.refreshAfterProjectRefresh&&(r.refreshWithTransition(!1,!t),r.refreshAfterProjectRefresh=!1),r.navigateToAfterRefresh&&(r.navigateTo(r.navigateToAfterRefresh,{scrollIntoView:!1}),r.navigateToAfterRefresh=null)):r.whenVisible("refresh",r,[!0])}changeCrudManager(t){const r=this;t&&!t.isCrudManager&&(t=r.crudManagerClass.new({scheduler:r},t)),r._crudManager=t,r.bindCrudManager(t)}get store(){return!this._store&&this.isVertical&&(this._store=new pe({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}],filter:()=>!1})),super.store}set store(t){super.store=t}refreshFromRowOnStoreAdd(t,{isExpand:r,records:n}){const s=arguments,a=this;a.runWithTransition(()=>{a.currentOrientation.suspended=!r&&!n.some(l=>l.isLinked),a.element.classList.add("b-no-transitions"),super.refreshFromRowOnStoreAdd(t,...s),a.element.classList.remove("b-no-transitions"),a.currentOrientation.suspended=!1},!r)}onStoreAdd(t){super.onStoreAdd(t),this.isPainted&&this.calculateRowHeights(t.records)}onStoreUpdateRecord({source:t,record:r,changes:n}){let s=0;"assigned"in n&&s++,"calendar"in n&&s++,s!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(t){t&&this.isHorizontal&&(t.metaMapId=this.id,this.store=t)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(t){var r,n;(n=(r=this.currentOrientation).onEventStoreIdChange)==null||n.call(r,t)}onEventStoreBatchedUpdate(t){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(t)}onInternalEventStoreChange(t){!this.isPainted||!this._mode||t.isAssign||this.assignmentStore.isRemovingAssignment||(this.isVisible?this.currentOrientation.onEventStoreChange(t):this.whenVisible(this.onInternalEventStoreChange,this,[t]))}onEventCommit({changes:t}){let r=[...t.added,...t.modified].map(n=>this.eventStore.getResourcesForEvent(n));r=Array.prototype.concat.apply([],r),new Set(r).forEach(n=>this.repaintEventsForResource(n))}onEventCommitStart({changes:t}){const{currentOrientation:r,committingCls:n}=this;[...t.added,...t.modified].forEach(s=>s.assignments.forEach(a=>r.toggleCls(a,n,!0)))}onEventException({action:t}){if(t==="commit"){const{changes:r}=this.eventStore;[...r.added,...r.modified,...r.removed].forEach(n=>this.repaintEvent(n))}}onAssignmentCommit({changes:t}){this.repaintEventsForAssignmentChanges(t)}onAssignmentCommitStart({changes:t}){const{currentOrientation:r,committingCls:n}=this;[...t.added,...t.modified].forEach(s=>{r.toggleCls(s,n,!0)})}onAssignmentException({action:t}){t==="commit"&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(t){const r=[...t.added,...t.modified,...t.removed].map(n=>n.getResource());new Set(r).forEach(n=>this.repaintEventsForResource(n))}onAssignmentBeforeRemove({records:t,removingAll:r}){if(r)return;const n=this,{activeAssignment:s}=n,a=t.includes(s);let l;if(!n.isConfiguring&&(n.navigateToAfterRefresh||s&&a)){t.includes(n.navigateToAfterRefresh)&&(n.navigateToAfterRefresh=null);const o=n.getElementFromAssignmentRecord(s,!0);if(a&&o){const d=n.timeAxisSubGrid.rectangle().intersect(n._bodyRectangle),c=L.from(o),u=c.center,h=n.isHorizontal?"y":"x",g=({element:m,distance:p,center:v,edgeDistance:b},{element:w,distance:D,center:S,edgeDistance:x})=>{if(m.dataset.resourceId!==w.dataset.resourceId){if(Math.abs(v[h]-u[h])<Math.abs(S[h]-u[h]))return-1;if(Math.abs(v[h]-u[h])>Math.abs(S[h]-u[h]))return 1}return Math.min(b,p)-Math.min(x,D)||S[h]-v[h]},f=Array.from(n.foregroundCanvas.querySelectorAll(n.navigator.itemSelector)).reduce((m,p)=>{if(p!==o){const v=L.from(p).intersect(d),b=v&&n.resolveAssignmentRecord(p);if(b){const{center:w}=v,D=u.getDelta(w),S=w.y<u.y?c.y-v.bottom:w.y>u.y?v.y-c.bottom:0,x=w.x<u.x?c.x-v.right:w.x>u.x?v.x-c.right:0;m.push({element:p,assignment:b,center:w,distance:Math.sqrt(D[0]**2+D[1]**2),edgeDistance:Math.max(S,x)})}}return m},[]).sort(g)[0];f&&(l=f.assignment)}l?(n.navigateTo(l,{scrollIntoView:!1}),n.navigateToAfterRefresh=l):n.focusElement.focus({preventScroll:!0})}}set timeRanges(t){this.project.timeRanges=t}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(t){this.project.resourceTimeRanges=t}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:t}){this.applyStartEndParameters(t)}getResourcesEventsPerTick(t,r){const{timeAxis:n,resourceStore:s}=this,a=[];return t=t||s.records,t.forEach(l=>{l.events.forEach(o=>{if(!n.isTimeSpanInAxis(o)||r&&!r.call(this,{resource:l,event:o}))return;let d=Math.floor(n.getTickFromDate(o.startDate)),c=Math.ceil(n.getTickFromDate(o.endDate));d==-1&&(d=0),c===-1&&(c=n.ticks.length);do a[d]?a[d].push(o):a[d]=[o];while(++d<c)})}),a}get widgetClass(){}},y(e,"$name","SchedulerStores"),e},dc={block:"nearest",edgeOffset:20},C0=i=>{var e;return e=class extends(i||$){async scrollEventIntoView(t,r=dc){const n=this,s=t.resources||[t];if(s.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");if(!s.length){console.warn("You have asked to scroll to an event which is not assigned to a resource");return}await n.scrollResourceEventIntoView(s[0],t,r)}scrollAssignmentIntoView(t,...r){return this.scrollResourceEventIntoView(t.resource,t.event,...r)}async scrollResourceEventIntoView(t,r,n=dc){var s,a;const l=this,{store:o,timeAxis:d,visibleDateRange:c,scrollExtensionThreshold:u}=l,h=d.endDate-d.startDate,g=r.startDate,f=r.endDate,m=r.isScheduled&&g.getTime(),p=r.isScheduled&&f.getTime(),v=r.isScheduled&&g<l.timeAxis.startDate|(f>l.timeAxis.endDate)<<1;!o.includes(t)&&t.$links.length&&(t=t.$links.find(D=>o.includes(D))),await l.waitForReadiness(),l.isLockedRows&&l.syncSplits(D=>D.scrollResourceEventIntoView(...arguments));let b=!1,w;if(n.edgeOffset==null&&(n.edgeOffset=20),v&&n.extendTimeAxis!==!1)if(v===3)await l.setTimeSpan(new Date(m-h/2),new Date(p+h/2));else if(l.infiniteScroll){const D={start:d.startDate.getTime(),end:d.endDate.getTime()},S=u?new we(u).milliseconds:h;if(v===1?D.start-=S:D.end+=S,m>=D.start&&p<=D.end)await l.setTimeSpan(new Date(D.start),new Date(D.end),{visibleDate:c.startDate}),b=!0;else{const R=c.endMS-c.startMS,M=v&1?1:-1,_=M===1?new Date(p+R):new Date(m-R);await l.setTimeSpan(new Date(m-h/2),new Date(m+h/2),{visibleDate:_})}}else{const D=l.presets.allRecords[l.zoomLevel],S=n.edgeOffset*l.getMilliSecondsPerPixelForZoomLevel(D,!1);v&1?await l.setTimeSpan(new Date(m-S),new Date(m-S+h)):await l.setTimeSpan(new Date(p+S-h),new Date(p+S))}if(!l.isDestroyed){if(o.tree&&await((s=l.expandTo)==null?void 0:s.call(l,t)),o.isGrouped&&await o.expand(o.getGroupHeaderForRecord(t)),(a=l.features.nestedEvents)!=null&&a.enabled&&r.parent&&!r.parent.isRoot&&await l.scrollEventIntoView(r.parent),w=l.getElementFromEventRecord(r,t),w){if(E.isFocusable(w)||(w=w.parentNode),await l.timeAxisSubGrid.scrollable.scrollIntoView(w,n),l.isDestroyed)return;let S;do if(S=l.getElementFromEventRecord(r,t),S||await Qe.animationFrame(),l.isDestroyed)return;while(!S)}else v===3&&n.extendTimeAxis===!1?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!r.isOccurrence&&l.eventStore.isFilteredOut(r)?console.warn("You have asked to scroll to an event which is not available"):r.isScheduled?await l.scrollUnrenderedEventIntoView(t,r,n):await l.scrollResourceIntoView(t,n);b&&(v===1?await l.setTimeSpan(d.startDate,new Date(d.endDate.getTime()-h),{maintainVisibleStart:!0}):await l.setTimeSpan(new Date(d.startDate.getTime()+h),d.endDate,{maintainVisibleStart:!0}))}}scrollUnrenderedEventIntoView(t,r,n=dc){return new Promise(async s=>{const a=this,l=a.timeAxisSubGrid.scrollable,o=l.viewport,{rowManager:d}=a,c=l.y;if(!o){s();return}const u=Object.assign({},dc);let h,g,f=0;do{if(++f>=50)throw new Error(`Too many preparational scrolls during 'scrollIntoView' for event id = ${r.id}`);const p=a.getResourceEventBox(r,t);if(!p){s();return}p.x=Math.ceil(p.x),p.y=Math.ceil(p.y),a.rtl&&(p._x=-(p.x-o.width)),p.translate(o.x-l.scrollLeft,o.y-l.y),g===void 0&&(g=l.getDeltaTo(p,u));const v=l.scrollIntoView(p,n);if(await v,v.cancelled||a.isDestroyed||(await Qe.animationFrame(),a.isDestroyed))return s(),!0;h=a.getElementFromEventRecord(r,t)}while(!h);l.suspendEvents(),g.yDelta>=0?l.y=Math.max(d.topRow.top-l.viewport.height,c):l.y=Math.min(d.bottomRow.bottom,c),a.fixElementHeights(),l.resumeEvents();const m=l.scrollIntoView(h,u);if(await m,m.canceled||a.isDestroyed)return s(),!0;await Qe.animationFrame(),s()})}async scrollResourceIntoView(t,r=dc){await this.waitForReadiness(),this.isVertical?await this.currentOrientation.scrollResourceIntoView(t,r):await this.scrollRowIntoView(t,r)}get widgetClass(){}},y(e,"$name","SchedulerScroll"),y(e,"configurable",{scrollExtensionThreshold:null}),e},w0=i=>{var e;return e=class extends(i||$){getScheduleRegion(t,r,n=!0,s){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(t,r,n){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(t,r){return this.getResourceEventBox(t.event,t.resource,r)}getResourceEventBox(t,r,n=!1,s=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(t,r=!1){return t.resources.map(n=>this.getResourceEventBox(t,n,r))}get widgetClass(){}},y(e,"$name","SchedulerRegions"),e},dA=["startDate","endDate","eventLayout","barMargin","mode","tickSize","eventColor","eventStyle","fillTicks"],S0=i=>{var e;return e=class extends(i||$){getState(){return T.copyProperties(super.getState(),this,dA)}applyState(t){var r;t=Object.assign({},t),this.suspendRefresh(),(t==null?void 0:t.eventLayout)==="layoutFn"&&delete t.eventLayout,(r=t==null?void 0:t.zoomLevelOptions)!=null&&r.width&&delete t.tickSize,super.applyState(t),this.resumeRefresh(!0,!1)}get widgetClass(){}},y(e,"$name","SchedulerState"),y(e,"configurable",{statefulEvents:["dateRangeChange"]}),e},Bp=i=>{var e;return e=class extends(i||$){static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectResourceOnEventNavigate:!0,selectResourceOnScheduleClick:!0,selectedCollection:{}}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}afterConstruct(){var t;super.afterConstruct(),(t=this.navigator)==null||t.ion({navigate:"onEventNavigate",thisObj:this})}changeSelectedCollection(t){return t.isCollection||(t=new Bt(t)),t}updateSelectedCollection(t){const r=this;t.owner||(t.owner=r),t.ion({change:(...n)=>r.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(...s)=>!r.isDestroying&&r.onSelectedCollectionChange(...s),n),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:r})}get selectedCollection(){return this._selectedCollection}getActionType(t,r,n,s){return s&&t.length>0&&n.length===t.length&&r.length===0||!s&&t.length===0&&n.length>0?"clear":r.length>0&&n.length>0?"update":r.length>0?"select":"deselect"}getEventsFromAssignments(t){return B.unique(t.map(r=>r.event))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(t){const r=[];t=B.asArray(t),t==null||t.forEach(n=>{this.isEventSelectable(n)!==!1&&(n.isOccurrence?n.assignments.forEach(s=>{r.push(this.assignmentStore.getOccurrence(s,n))}):r.push(...n.assignments))}),this.selectedCollection.splice(0,this.selectedCollection.count,r)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(t){this.selectedCollection.splice(0,this.selectedCollection.count,t||[])}isEventSelected(t){const{selectedCollection:r}=this;return!!(r.count&&r.includes(t.assignments))}isEventSelectable(t){}isAssignmentSelected(t){return this.selectedCollection.includes(t)}select(t,r=!1){t.isAssignment?this.selectAssignment(t,r):this.selectEvent(t,r)}selectEvent(t,r=!1){this.isEventSelected(t)||this.selectEvents([t],r)}selectAssignment(t,r=!1,n){this.isAssignmentSelected(t)||(r?this.selectedCollection.add(t):this.selectedAssignments=t)}deselect(t){t.isAssignment?this.deselectAssignment(t):this.deselectEvent(t)}deselectEvent(t){this.isEventSelected(t)&&this.selectedCollection.remove(...t.assignments)}deselectAssignment(t){this.isAssignmentSelected(t)&&this.selectedCollection.remove(t)}selectEvents(t,r=!1){if(r){const n=t.reduce((s,a)=>(this.isEventSelectable(a)!==!1&&s.push(...a.assignments),s),[]);this.selectedCollection.add(n)}else this.selectedEvents=t}deselectEvents(t){this.selectedCollection.remove(t.reduce((r,n)=>(r.push(...n.assignments),r),[]))}selectAssignments(t){this.selectedCollection.add(t)}deselectAssignments(t){this.selectedCollection.remove(t)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:t,toRemove:r,index:n}){const s=this,a=s._selectedCollection.values,l=t,o=r>0?a.slice(n,r+n):[],d=s.getActionType(a,l,o,!0);if(!(t.length===0&&r===0)&&(s.trigger("beforeEventSelectionChange",{action:d,selection:s.getEventsFromAssignments(a)||[],selected:s.getEventsFromAssignments(l)||[],deselected:s.getEventsFromAssignments(o)||[]})===!1||s.trigger("beforeAssignmentSelectionChange",{action:d,selection:a,selected:l,deselected:o})===!1))return!1}onSelectedCollectionChange({added:t,removed:r}){const n=this,s=n.selectedAssignments,a=t||[],l=r||[];function o(d,c){const u=d.event;if(u){const{eventAssignHighlightCls:f}=n;if(n.currentOrientation.toggleCls(d,n.eventSelectedCls,c,!1,!0),f){const m=n.getElementFromAssignmentRecord(d,!1,!0);n.getElementsFromEventRecord(u,null,!1,!0).forEach(p=>{if(p!==m){const v=n.resolveAssignmentRecord(p,!0);n.currentOrientation.toggleCls(v,f,c,!1,!0),c&&!p.parentElement.isReleased&&(p.style.animation="none",p.offsetHeight,p.style.animation=""),p.classList.toggle(f,c)}})}}}if(l.forEach(d=>o(d,!1)),a.forEach(d=>o(d,!0)),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=s.map(d=>({eventId:d.eventId,resourceId:d.resourceId})),!n.silent){const d=this.getActionType(s,a,l);n.trigger("assignmentSelectionChange",{action:d,selection:s,selected:a,deselected:l}),n.trigger("eventSelectionChange",{action:d,selection:n.selectedEvents,selected:n.getEventsFromAssignments(a),deselected:n.getEventsFromAssignments(l)})}}onAssignmentChange(t){super.onAssignmentChange(t);const r=this,{action:n,records:s}=t;if(r.silent=!r.triggerSelectionChangeOnRemove,n==="remove")r.deselectAssignments(s);else if(n==="removeall"&&!r.eventStore.isSettingData)r.clearEventSelection();else if(n==="dataset"&&r.$selectedAssignments)if(!r.maintainSelectionOnDatasetChange)r.clearEventSelection();else{const a=r.$selectedAssignments.map(l=>s.find(o=>o.eventId===l.eventId&&o.resourceId===l.resourceId));r.selectedAssignments=B.clean(a)}r.silent=!1}onInternalEventStoreChange({source:t,action:r,records:n}){!t.isResourceTimeRangeStore&&r==="dataset"&&!n.length&&this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(t,r){const n=this;n.isAssignmentSelected(r)?(n.deselectOnClick||t.ctrlKey)&&n.deselectAssignment(r,n.multiEventSelect,t):this.isEventSelectable(r.event)!==!1&&n.selectAssignment(r,t.ctrlKey&&n.multiEventSelect,t)}onEventNavigate({event:t,item:r}){if(!this.eventSelectionDisabled){const n=r&&(r.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(r):r);n?this.onAssignmentSelectionClick(t,n):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(t){return this.changeLinkedEvents(t)}changeHighlightPredecessors(t){return this.changeLinkedEvents(t)}changeLinkedEvents(t){const r=this;return t?(r.highlighted=r.highlighted||new Set,r.highlightLinkedEvents(r.selectedEvents)):r.highlighted&&r.highlightLinkedEvents(),t}highlightLinkedEvents(t=[]){const r=this,{highlighted:n,eventStore:s}=r,a=r.features.dependencies;n.forEach(l=>{t.includes(l)||(l.meta.highlight=!1,n.delete(l),s.includes(l)&&l.dependencies.forEach(o=>a.unhighlight(o,"b-highlight")))}),t.forEach(l=>{const o=[l];for(;o.length;){const d=o.pop();n.add(d),r.highlightSuccessors&&d.outgoingDeps.forEach(c=>{a.highlight(c,"b-highlight"),!n.has(c.toEvent)&&o.push(c.toEvent)}),r.highlightPredecessors&&d.incomingDeps.forEach(c=>{a.highlight(c,"b-highlight"),!n.has(c.fromEvent)&&o.push(c.fromEvent)})}n.forEach(d=>d.meta.highlight=!0)}),r.element.classList.toggle("b-highlighting",t.length>0),r.refreshWithTransition()}onEventDataGenerated(t){(this.highlightSuccessors||this.highlightPredecessors)&&(t.cls["b-highlight"]=t.eventRecord.meta.highlight),super.onEventDataGenerated(t)}updateProject(t,r){this.clearEventSelection(),super.updateProject(t,r)}doDestroy(){var t;super.doDestroy(),((t=this._selectedCollection)==null?void 0:t.owner)===this&&this._selectedCollection.destroy()}get widgetClass(){}},y(e,"$name","EventSelection"),e},D0=i=>i.preventDefault(),cA={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},uA={animate:100},hA=Object.freeze({}),gA=({event:{startDate:i}},{event:{startDate:e}})=>i-e,fA=({event:{startDate:i}},{event:{startDate:e}})=>e-i,zp=i=>{var e;return e=class extends fe(i||$){construct(t){const r=this;super.construct(t),r.isInTimeAxis=r.isInTimeAxis.bind(r),r.onDeleteKey=r.throttle(r.onDeleteKey,r.onDeleteKeyBuffer,r)}changeNavigator(t){const r=this,{isVertical:n}=r;return r.getConfig("subGridConfigs"),n&&(t.prevKey="ArrowUp",t.nextKey="ArrowDown",t.keys.ArrowUp=t.keys.ArrowDown=null,t.keys.ArrowLeft=t.keys.ArrowRight="navigateResourceHeaderCells"),new Ki(r.constructor.mergeConfigs({ownerCmp:r,target:n?r.bodyElement:r.timeAxisSubGridElement,processEvent:r.processEvent,itemSelector:`.${r.eventCls}-wrap${n?",.b-resourceheader-cell":""}`,focusCls:r.focusCls,navigatePrevious:r.throttle(r.navigatePrevious,{delay:r.navigatePreviousBuffer,throttled:D0}),navigateNext:r.throttle(r.navigateNext,{delay:r.navigateNextBuffer,throttled:D0})},t))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(t){return!t.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(t)}onElementKeyDown(t){var r,n,s;const a=this,{navigator:l}=a;if(((r=a.focusedCell)==null?void 0:r.rowIndex)!==-1&&((n=a.focusedCell)==null?void 0:n.column)===a.timeAxisColumn&&!t.target.closest(l.itemSelector)&&t.key==="Enter"){const o=a.getFirstVisibleAssignment();if(o)return a.navigateTo(o,{uiEvent:t}),!1}else(s=super.onElementKeyDown)==null||s.call(this,t)}getFirstVisibleAssignment(t=this.focusedCell){var r,n,s;const a=this,{currentOrientation:l,rowManager:o,eventStore:d}=a;if(a.isHorizontal){let c=l.rowMap.get(o.getRow(t.rowIndex));if(c!=null&&c.length)return(r=c[0])==null?void 0:r.elementData.assignmentRecord;if(c=(n=l.resourceMap.get(t.id))==null?void 0:n.eventsData,c!=null&&c.length)return(s=c.filter(u=>d.isAvailable(u.eventRecord))[0])==null?void 0:s.assignmentRecord}else{const c=[...l.resourceMap.values()][0],u=c&&Object.values(c);if(u!=null&&u.length)return u.filter(h=>d.isAvailable(h.renderData.eventRecord))[0].renderData.assignmentRecord}}onGridBodyFocusIn(t){var r;const n=t.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(t.target)){const s=this,{navigationEvent:a}=s,{target:l}=t,o=l.closest(s.navigator.itemSelector),d=o?s.normalizeCellContext({rowIndex:s.isVertical?0:s.resourceStore.indexOf(s.resolveResourceRecord(l)),column:s.timeAxisColumn,target:l}):new Se(l);if(o){const{_focusedCell:c}=s;s._focusedCell=d,(r=s.onCellNavigate)==null||r.call(s,s,c,d,a,!0);return}if(n&&(!a||cA[a.key])){const c=s.getFirstVisibleAssignment(d);if(c){s.navigateTo(c,{scrollIntoView:!!(a&&a.type!=="mousedown"),uiEvent:a||t});return}}}n&&super.onGridBodyFocusIn(t)}accessibleFocusCell(t,r){const n=this;if(t=n.normalizeCellContext(t),t.columnId!==n.timeAxisColumn.id)return super.focusCell(t,r)}normalizeTarget(t){return t.assignmentRecord}getPrevious(t,r){const n=this,{resourceStore:s,visibleDateRange:a}=n,{eventSorter:l}=n.currentOrientation,{startDate:o,endDate:d}=n.timeAxis,c=t.event,u=n.eventStore.getEvents({resourceRecord:t.resource,startDate:o,endDate:d,visibleDateRange:a}).filter(this.isInTimeAxis).sort(l);let h=t.resource,g=u[u.indexOf(c)-1];if(!g)for(let f=s.indexOf(h)-1;(!g||r&&g===c)&&f>=0;f--){h=s.getAt(f);const m=n.eventStore.getEvents({resourceRecord:h,startDate:o,endDate:d}).filter(n.isInTimeAxis).sort(l);g=m.length&&m[m.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(g,h)}navigateResourceHeaderCells(t){const{target:r}=t;if(r.closest(".b-resourceheader-cell")){const n=this.resourceStore[t.key==="ArrowRight"?"getNext":"getPrev"](this.resolveResourceRecord(r)),s=r.parentElement.querySelector(`[data-resource-id="${n==null?void 0:n.id}"]`);s&&(t.handled=!0,t.preventDefault(),s.scrollIntoView(),s.focus())}}navigatePrevious(t){const r=this,n=t.target.closest(r.eventSelector)&&r.getPrevious(r.normalizeTarget(t));return n?(t.preventDefault(),t.ctrlKey||r.clearEventSelection(),r.navigateTo(n,{uiEvent:t})):(t.handled=!1,r.doGridNavigation(t))}getNext(t,r){const n=this,{resourceStore:s,visibleDateRange:a}=n,{eventSorter:l}=n.currentOrientation,{startDate:o,endDate:d}=n.timeAxis,c=t.event,u=n.eventStore.getEvents({resourceRecord:t.resource,startDate:o,endDate:d,visibleDateRange:a}).filter(this.isInTimeAxis).sort(l);let h=t.resource,g=u[u.indexOf(c)+1];if(!g)for(let f=s.indexOf(h)+1;(!g||r&&g===c)&&f<s.count;f++)h=s.getAt(f),g=n.eventStore.getEvents({resourceRecord:h,startDate:o,endDate:d}).filter(n.isInTimeAxis).sort(l)[0];return n.assignmentStore.getAssignmentForEventAndResource(g,h)}navigateNext(t){const r=this,{target:n}=t,s=n.closest(r.eventSelector)&&r.getNext(r.normalizeTarget(t));if(s)return t.preventDefault(),t.ctrlKey||r.clearEventSelection(),r.navigateTo(s,{uiEvent:t});if(r.isVertical&&n.closest(".b-resourceheader-cell")){const a=r.resolveResourceRecord(n),{visibleDateRange:l}=r,{eventSorter:o}=r.currentOrientation,{startDate:d,endDate:c}=r.timeAxis,u=r.eventStore.getEvents({resourceRecord:a,filter:r.isInTimeAxis,startDate:d,endDate:c,visibleDateRange:l}).sort(o),h=u[0],g=h&&r.assignmentStore.getAssignmentForEventAndResource(h,a);return g?r.navigateTo(g,{uiEvent:t}):r.navigateDown()}else return t.handled=!1,r.doGridNavigation(t)}doGridNavigation(t){var r;!t.handled&&t.key.indexOf("Arrow")===0&&((r=this[`navigate${t.key.substring(5)}ByKey`])==null||r.call(this,t))}async navigateTo(t,{scrollIntoView:r=!0,uiEvent:n={}}=hA){const s=this,{navigator:a}=s,{skipScrollIntoView:l}=a;t&&(r?(a.disabled=!0,await s.scrollAssignmentIntoView(t,{extendTimeAxis:s.infiniteScroll,...uA}),a.disabled=!1):a.skipScrollIntoView=!0,!s.isDestroyed&&this.getElementFromAssignmentRecord(t)&&(s.activeAssignment=t,a.skipScrollIntoView=l,a.trigger("navigate",{event:n,item:s.getElementFromAssignmentRecord(t).closest(a.itemSelector)})))}set activeAssignment(t){const r=this.getElementFromAssignmentRecord(t,!0);r&&(this.navigator.activeItem=r)}get activeAssignment(){const{activeItem:t}=this.navigator;if(t)return this.resolveAssignmentRecord(t)}get previousActiveEvent(){const{previousActiveItem:t}=this.navigator;if(t)return this.resolveEventRecord(t)}processEvent(t){const r=this,n=t.target.closest(r.eventSelector);return n&&(t.assignmentRecord=r.resolveAssignmentRecord(n),t.eventRecord=r.resolveEventRecord(n),t.resourceRecord=r.resolveResourceRecord(n)),t}onTab(t){t.target.closest(this.eventSelector)&&this.navigateNext(this.processEvent(t)),t.defaultPrevented||super.onTab(...arguments)}onShiftTab(t){t.target.closest(this.eventSelector)&&this.navigatePrevious(this.processEvent(t)),t.defaultPrevented||super.onShiftTab(...arguments)}onDeleteKey(t){const r=this;if(!r.readOnly&&r.enableDeleteKey){const n=r.eventStore.usesSingleAssignment?r.selectedEvents:r.selectedAssignments;r.removeEvents(n.filter(s=>{var a;return!s.readOnly&&!((a=s.event)!=null&&a.readOnly)}))}}onArrowUpKey(t){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),t.handled=!0}onArrowDownKey(t){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),t.handled=!0)}navigateLeft(t){if(this.isVertical&&this.activeAssignment){const r=this,{activeAssignment:n,eventStore:s,resourceStore:a}=r,{resource:l}=n,{startDate:o,endDate:d}=n.event;let c=s.getAssignmentsForResource(l).filter(({event:{startDate:u,endDate:h}})=>C.intersectSpans(u,h,o,d)&&u<o);if(!c.length)for(let u=a.indexOf(l)-1;!c.length&&u>=0;u--)c=r.eventStore.getAssignmentsForResource(a.getAt(u));return c.length?r.navigateTo(c.sort(fA)[0],{uiEvent:t}):super.navigateLeft(t)}else return super.navigateLeft(t)}navigateRight(t){if(this.isVertical&&this.activeAssignment){const r=this,{activeAssignment:n,eventStore:s,resourceStore:a}=r,{resource:l}=n,{startDate:o,endDate:d}=n.event;let c=s.getAssignmentsForResource(l).filter(u=>u!==n).filter(({event:{startDate:u,endDate:h}})=>C.intersectSpans(u,h,o,d)&&u>=o);if(!c.length)for(let u=a.indexOf(l)+1;!c.length&&u<a.count;u++)c=this.eventStore.getAssignmentsForResource(a.getAt(u));return c.length?r.navigateTo(c.sort(gA)[0],{uiEvent:t}):super.navigateRight(t)}else return super.navigateRight(t)}onEscapeKey(t){t.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn},{disableActionable:!0,scroll:!1}),t.handled=!0)}onEventSpaceKey(t){}onEventEnterKey(t){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}onNavigate({item:t,event:r}){var n;(n=t==null?void 0:t.elementData)!=null&&n.ariaLabel&&t.setAttribute("aria-label",t.elementData.ariaLabel)}get widgetClass(){}},y(e,"$name","EventNavigation"),y(e,"configurable",{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey"},internalListeners:{navigate:"up.onNavigate"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}),y(e,"defaultConfig",{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}),e},E0=i=>{var e;return e=class extends i{get widgetClass(){}get transactionalFeaturesEnabled(){return this.enableTransactionalFeatures&&this.project&&!!this.project._queue}get isTransactionalFeatureActive(){return this._featureTransactionId!=null}get featureTransactionId(){return this._featureTransactionId}construct(...t){super.construct(...t),this.ion({beforeFeatureTransactionStart:({id:r})=>this._featureTransactionId=r,featureTransactionComplete:()=>delete this._featureTransactionId})}afterFeatureTransaction(t){this.transactionalFeaturesEnabled&&(this.isTransactionalFeatureActive?this.once("featureTransactionComplete",t):t.call(this))}},y(e,"$name","TransactionalFeatureMixin"),y(e,"configurable",{enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}}),e},Wp=i=>{var e;return e=class extends i.mixin(pm){afterConstruct(){super.afterConstruct();const{crudManager:t,project:r}=this;this.loadMask&&(t||r).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:t}=this;t&&(this.masked=Mn.mergeConfigs(this.loadMaskDefaults,t))}bindCrudManager(t){this.detachListeners("crudManager");let r={};this.isTaskBoardBase||(r={beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",beforeLoadCrudManagerData:"onCrudManagerBeforeLoadCrudManagerData",loadCrudManagerData:"onCrudManagerLoadCrudManagerData"}),t==null||t.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",requestDone:"onAjaxTransportResponseDone",...r,thisObj:this})}onCrudManagerBeforeSend({params:t}){var r;(r=this.applyStartEndParameters)==null||r.call(this,t)}onCrudManagerLoadStart(){var t;this.applyLoadMask(),(t=this.toggleEmptyText)==null||t.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){this.suspendRefresh()}onCrudManagerApplyResponse({request:t}){this.resumeRefresh(!0,t.type==="sync")}onCrudManagerBeforeLoadCrudManagerData(){this.crudManager.applyingLoadResponse||this.suspendRefresh()}async onCrudManagerLoadCrudManagerData(){this.crudManager.applyingLoadResponse||(await this.project.commitAsync(),!this.isDestroyed&&this.resumeRefresh(!0))}onCrudManagerRequestFinalize(t=!0,r,n){var s;const a=this;t?(s=a.toggleEmptyText)==null||s.call(a):(a.masked||a.applyLoadMask(),a.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${a.L(`L{GridBase.${r}FailedMessage}`)}</div>
                    ${n&&n.message?`<div class="b-grid-load-fail">${a.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}
                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:t,response:r}){this.onCrudManagerRequestFinalize(!1,t,r)}onAjaxTransportResponseDone(){const t=this;t.clearMaskDelay!=null?t.setTimeout(()=>t.masked=null,t.clearMaskDelay):t.masked=null}get widgetClass(){}},y(e,"$name","CrudManagerView"),y(e,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),e},x0=i=>{var e;return e=class extends i{construct(t){var r;const n=this;if(n.$lazyLoadDetachers=new Map,n.$lazyLoadCount=0,super.construct(t),(r=n.crudManager)!=null&&r.lazyLoad){let s=n.resourceStore.lazyLoad,a="doLazyLoad";n.crudManager.remotePaging&&(s=n.resourceStore,a="requestData"),n.$lazyLoadDetachers.set(n,be.before(s,a,"beforeResourceStoreLoad",n)),n.passStartEndParameters=!1}}beforeResourceStoreLoad(t){const r=this,n={startDate:r.startDate,endDate:r.endDate,visibleStart:r.visibleDateRange.startDate,visibleEnd:r.visibleDateRange.endDate};if(r.crudManager.remotePaging){const a=r.resourceStore.defaultPageParamName,l=r.resourceStore.pageSizeParamName;n[a]=t[a],n[l]=t[l]}const s=r.eventStore.lazyLoad.calculateDateRange(n);Object.assign(t,s)}updateEventStore(t,r){var n;(n=super.updateEventStore)==null||n.call(this,t,r),this.lazyLoadAttachStore(t,r),t.lazyLoad&&(this.passStartEndParameters=!1)}updateResourceTimeRangeStore(t,r){var n;(n=super.updateResourceTimeRangeStore)==null||n.call(this,t,r),this.lazyLoadAttachStore(t,r)}updateAssignmentStore(t,r){var n;(n=super.updateAssignmentStore)==null||n.call(this,t,r),this.lazyLoadAttachStore(t,r)}updateTimeRangeStore(t,r){var n;(n=super.updateTimeRangeStore)==null||n.call(this,t,r),this.lazyLoadAttachStore(t,r)}lazyLoadAttachStore(t,r){var n,s,a;const l=this,{$lazyLoadDetachers:o}=l;r&&((n=o.get(r))==null||n(),o.delete(r),r.lazyLoad.beforeLoadCall&&(r.lazyLoad.beforeLoadCall=null)),t&&((s=l.resourceStore)!=null&&s.isPaged)&&(t.lazyLoad&&!t.isPaged?t.remotePaging=!0:t.isPaged&&!t.lazyLoad&&(t.lazyLoad=!0)),t!=null&&t.lazyLoad&&((a=o.get(t))==null||a(),o.set(t,t.ion({lazyLoadStarted:"storeLazyLoadStarted",lazyLoadEnded:"storeLazyLoadEnded",thisObj:l})),t.lazyLoad.isDateStoreLazyLoadPlugin&&(t.lazyLoad.beforeLoadCall=d=>{Object.assign(d,{startDate:l.startDate,endDate:l.endDate,visibleStart:l.visibleDateRange.startDate,visibleEnd:l.visibleDateRange.endDate,resourceRecord:l.resourceStore.first})}))}set $lazyLoadCount(t){this.$_lazyLoadCount===0&&t>0?this.lazyLoadShowLoadingIndicator():this.$_lazyLoadCount>0&&t===0&&this.lazyLoadHideLoadingIndicator(),this.$_lazyLoadCount=t}get $lazyLoadCount(){return this.$_lazyLoadCount}storeLazyLoadStarted(){this.$lazyLoadCount+=1}storeLazyLoadEnded(){this.$lazyLoadCount-=1}lazyLoadShowLoadingIndicator(){const t=this;t.$lazyLoadingIndicatorElement?t.timeAxisSubGrid.header.element.appendChild(t.$lazyLoadingIndicatorElement):t.$lazyLoadingIndicatorElement=E.createElement({parent:t.timeAxisSubGrid.header.element,retainElement:!0,className:"b-timeline-loading-indicator-wrap",children:[{className:"b-timeline-loading-indicator"}]}),t.readOnly=!0}lazyLoadHideLoadingIndicator(){var t;(t=this.$lazyLoadingIndicatorElement)==null||t.remove(),this.readOnly=!1}doDestroy(){var t;(t=this.$lazyLoadDetachers)==null||t.forEach(r=>r()),super.doDestroy()}},y(e,"$name","LazyLoadView"),e},Zt=i=>{var e;return e=class extends i{async afterConstruct(){var t;super.afterConstruct();const r=this,n=r.client||r.grid,{project:s}=n;(t=n.projectSubscribers)==null||t.push(r),s&&(r.attachToProject(s),r.attachToResourceStore(s.resourceStore),r.attachToEventStore(s.eventStore),r.attachToAssignmentStore(s.assignmentStore),r.attachToDependencyStore(s.dependencyStore),r.attachToCalendarManagerStore(s.calendarManagerStore))}attachToProject(t){var r;this.detachListeners("project"),this._project=t,(r=super.attachToProject)==null||r.call(this,t)}detachFromProject(t=this._project){var r;this.detachListeners("project"),(r=super.detachFromProject)==null||r.call(this,t)}attachToEventStore(t){var r;this.detachListeners("eventStore"),(r=super.attachToEventStore)==null||r.call(this,t)}attachToResourceStore(t){var r;this.detachListeners("resourceStore"),(r=super.attachToResourceStore)==null||r.call(this,t)}attachToAssignmentStore(t){var r;this.detachListeners("assignmentStore"),(r=super.attachToAssignmentStore)==null||r.call(this,t)}attachToDependencyStore(t){var r;this.detachListeners("dependencyStore"),(r=super.attachToDependencyStore)==null||r.call(this,t)}attachToCalendarManagerStore(t){var r;this.detachListeners("calendarManagerStore"),(r=super.attachToCalendarManagerStore)==null||r.call(this,t)}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},y(e,"$name","AttachToProjectMixin"),e},mA={releaseElement:1,reuseElement:1},pA={newElement:1,reuseOwnElement:1,reuseElement:1},jp=9999999,vA=new Date(0),yA=new Date(9999,0,1),bA=({startDateMS:i},{startDateMS:e})=>i-e,CA={startDate:1,endDate:1,duration:1};function R0(i,e,t,r,n){var s,a;const{timeAxis:l}=i,o=e.isBatchUpdating&&!n?e.get(r):e[r],d=(s=e.hasBatchedChange)==null?void 0:s.call(e,r);if(i.fillTicks&&(!((a=e.meta)!=null&&a.isResizing)||!d)){let u=l.getTickFromDate(o);if(u>=0){t&&u===Math.round(u)&&u>0&&u--;const h=Math.floor(u);return l.getAt(h)[r].getTime()}}return o==null?void 0:o.getTime()}var Zh=class extends $.mixin(Zt){static get configurable(){return{bufferSize:150,verticalBufferSize:150,maxZIndexStacks:50}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],entityNames:new Set,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(i){const e=this;e.client=e.scheduler=i,e.eventSorter=e.eventSorter.bind(i),e.scrollBuffer=i.scrollBuffer,i.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:e}),i.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:e}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:i}=this.scheduler;this.scheduler.isPainted&&i.renderRows(i.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(i,e,t,r=!1){const{scheduler:n}=this;let s=i[0];return t||(s=this.translateToScheduleCoordinate(s)),s=n.getRtlX(s),n.timeAxisViewModel.getDateFromPosition(s,e,r)}translateToScheduleCoordinate(i){const{scheduler:e}=this,{scrollable:t}=e.timeAxisSubGrid;let r=i-e.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return e.rtl?r+=t.maxX-Math.abs(e.scrollLeft):r+=e.scrollLeft,r}translateToPageCoordinate(i){const{scheduler:e}=this,{scrollable:t}=e.timeAxisSubGrid;let r=i+e.timeAxisSubGridElement.getBoundingClientRect().left;return e.rtl?r-=t.maxX-Math.abs(e.scrollLeft):r-=e.scrollLeft,r}getScheduleRegion(i,e,t=!0,r,n=!1){var s;const a=this,{scheduler:l}=a,{timeAxisSubGridElement:o,timeAxis:d}=l,{start:c,end:u}=(!n||i)&&l.getResourceMarginObject(i)||{start:0,end:0};let h;if(i){const b=l.getRowById(i.id),w=e&&l.getElementsFromEventRecord(e,i)[0];if(h=b?L.from(b.getElement("normal"),o):l.getRecordCoords(i,!0),w){const D=L.from(w,o);h.y=D.y,h.bottom=D.bottom}else h.y=h.y+c,h.bottom=h.bottom-u}else h=L.from(o).moveTo(null,0),h.width=o.scrollWidth,h.y=h.y+c,h.bottom=h.bottom-u;const g=d.startDate,f=d.endDate;r=(r==null?void 0:r.start)&&r||((s=l.getDateConstraints)==null?void 0:s.call(l,i,e))||{start:g,end:f},r.start=r.start||vA,r.end=r.end||yA;const m=r.end<=g||r.start>=f;let p=m?-1:l.getVirtualCoordFromDate(r.start?C.max(g,r.start):g),v=m?-1:l.getVirtualCoordFromDate(r.end?C.min(f,r.end):f);return t||(p=a.translateToPageCoordinate(p),v=a.translateToPageCoordinate(v)),h.left=Math.min(p,v),h.right=Math.max(p,v),h}getRowRegion(i,e,t){const{scheduler:r}=this,{timeAxis:n}=r,s=r.getRowById(i.id);if(!s)return null;const a=n.startDate,l=n.endDate,o=e?C.max(a,e):a,d=t?C.min(l,t):l,c=r.getCoordinateFromDate(o),u=r.getCoordinateFromDate(d,!0,!0),h=s.top,g=Math.min(c,u),f=h+s.offsetHeight;return new L(g,h,Math.max(c,u)-g,f-h)}getResourceEventBox(i,e,t,r=!1){var n;const{scheduler:s}=this,a=this.resourceMap.get(e.id);let l=null,o=!1;if(a&&(l=a.eventsData.find(d=>d.eventRecord===i)),l||(l=this.getTimeSpanRenderData(i,e,{viewport:!0,timeAxis:t}),o=!0),l){const d=(n=l.height)!=null?n:s.getResourceLayoutSettings(e).contentHeight,c=s.rowManager.getRecordCoords(e,!0,r);if(!c)return null;const u=l.top+c.top,h=new L(l.left,u,l.width,d);return h.layout=!o,h.rowTop=c.top,h.rowBottom=c.bottom,h.resourceId=e.id,h}return null}resolveRowRecord(i){const e=this,{scheduler:t}=e,r=i.nodeType?i:i.target,n=r.nodeType===Element.TEXT_NODE?r.parentElement:r,s=n.closest("[data-resource-id]");return s?e.resourceStore.getById(s.dataset.resourceId):t.getRecordFromElement(n)}attachToProject(i){super.attachToProject(i),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),i==null||i.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:i,toDrawOnDataReady:e,project:t}=this;i.isVisible?i.isPainted&&!i.refreshSuspended&&(!e.size&&t.timeZone!=null&&t.ignoreRecordChanges&&t.resourceStore.forEach(r=>e.add(r.id)),e.size&&(this.clearResources(e),this.refreshResources(e)),e.clear()):i.whenVisible("refreshRows")}onProjectRefresh({isCalculated:i,isInitialCommit:e}){const t=this,{scheduler:r,toDrawOnProjectRefresh:n}=t;if(r.isVisible){if(r.isPainted&&!r.isConfiguring&&!r.refreshSuspended){if(t.refreshAllWhenReady||e&&i){r.calculateAllRowHeights(!0);const{rowManager:s}=r;s.topRow?(t.clearAll(),r.refreshAfterProjectRefresh||(s.topRow.dataIndex>=r.store.count?r.renderRows(!1):r.refreshWithTransition(!1,i&&!e))):s.reinitialize(),t.refreshAllWhenReady=!1}else n.size&&t.refreshResources(n);n.clear()}}else r.whenVisible("refresh",r,[!0])}attachToAssignmentStore(i){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(i),i&&i.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:i,action:e,records:t=[],replaced:r,changes:n}){const s=this,{scheduler:a}=s,l=new Set(t.flatMap(o=>{var d,c,u;return[o.resourceId,...(u=(c=(d=o.resource)==null?void 0:d.$links)==null?void 0:c.map(h=>h.id))!=null?u:[]]}));if(!(s.resourceStore.isRemoving||s.resourceStore.isChangingId))switch(e){case"dataset":{s.eventStore.usesSingleAssignment||(l.size?s.refreshResourcesWhenReady(l):(s.clearAll(),a.refreshWithTransition()));return}case"add":case"remove":s.refreshResourcesWhenReady(l);return;case"removeall":s.refreshAllWhenReady=!0;return;case"replace":r.forEach(([o,d])=>{l.add(o.resourceId),l.add(d.resourceId)}),s.refreshResourcesWhenReady(l);return;case"filter":s.clearAll(),a.calculateAllRowHeights(!0),a.refreshWithTransition();return;case"update":{("eventId"in n||"resourceId"in n||"id"in n)&&("resourceId"in n&&l.add(n.resourceId.oldValue),i===a.project.assignmentStore?s.refreshResourcesOnDataReady(l):s.refreshResources(l));break}case"clearchanges":{const{added:o,modified:d,removed:c}=n;d.length?a.refreshWithTransition():(o.forEach(u=>l.add(u.resourceId)),c.forEach(u=>l.add(u.resourceId)),s.refreshResourcesOnDataReady(l))}}}onAssignmentStoreRefresh({action:i,records:e}){i==="batch"&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(i){this.refreshAllWhenReady=!0,super.attachToEventStore(i),i&&i.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:i}){for(const e of this.client.getElementsFromEventRecord(i))e.classList.remove("b-iscreating")}onEventStoreRefresh({action:i}){if(i==="batch"){const{scheduler:e}=this;e.isEngineReady&&e.isPainted&&(this.clearAll(),e.refreshWithTransition())}}onEventStoreChange({action:i,records:e=[],record:t,replaced:r,changes:n,source:s}){var a,l,o,d;const c=this,{scheduler:u}=c,h=s.isResourceTimeRangeStore,g=new Set;if(u.isPainted)if(e.forEach(f=>{var m;const p=(m=f.$linkedResources)==null?void 0:m.filter(v=>c.resourceStore.includes(v));p==null||p.forEach(v=>g.add(v.id))}),h){switch(i){case"removeall":case"dataset":c.clearAll(),u.refreshWithTransition();return}c.refreshResources(g,i!=="lazyload")}else{switch(i){case"batch":case"sort":case"group":case"move":return;case"remove":return;case"clearchanges":c.clearAll(),u.refreshWithTransition();return;case"lazyload":{u.isEngineReady?u.refreshRows():c.refreshAllWhenReady=!0;return}case"dataset":{c.clearAll(),u.isEngineReady?u.refreshWithTransition():c.refreshAllWhenReady=!0;return}case"add":break;case"replace":r.forEach(([,f])=>{f.resources.map(m=>g.add(m.id))});break;case"removeall":case"filter":if(!u.isEngineReady){c.refreshAllWhenReady=!0;return}c.clearAll(),u.calculateAllRowHeights(!0),u.refreshWithTransition();return;case"update":{const f=t.$entity?!Object.keys(n).some(p=>!t.$entity.getField(p)):!Object.keys(n).some(p=>!CA[p]);let m=0;if("startDate"in n&&m++,"endDate"in n&&m++,"duration"in n&&m++,"resourceId"in n&&g.add(n.resourceId.oldValue),g.size&&(!f||m&&!("duration"in n&&m===1)||"percentDone"in n||"inactive"in n||"constraintDate"in n||"constraintType"in n||"segments"in n)){const{eventResize:p,eventDragCreate:v}=u.features,b=p==null?void 0:p.isResizing,w=v==null?void 0:v.isResizing,{store:D}=u,S=t.isBatchUpdating&&[...g].every(x=>{const R=D.getById(x),M=u.getEventLayout(R);return!u.getEventLayoutHandler(M)});if(t.isBatchUpdating&&(b&&p.lockLayout||w&&v.lockLayout||(b||w)&&S)){const x=b&&p.lockLayout==="minimal-updates"||w&&v.lockLayout==="minimal-updates";for(const R of g){const M=u.store.getById(R);if(M)if(x){const _=(a=c.resourceMap.get(R))==null?void 0:a.eventsData.find(I=>I.eventRecord===t),k=u.getRowFor(R),F=(l=c.rowMap.get(k))==null?void 0:l.find(I=>I.elementData.eventRecord===t);if(_&&F){const I=u.generateRenderData(t,D.getById(R),!0);Object.assign(_,I);const A=this.renderEvent(_);Object.assign(F,A)}}else c.refreshEventsForResource(M,void 0,!1)}c.onRenderDone()}else(o=c.project)!=null&&o.propagatingLoadChanges||(d=c.project)!=null&&d.isWritingData?c.refreshResourcesOnDataReady(g):c.refreshResources(g)}return}}c.refreshResourcesWhenReady(g)}}attachToResourceStore(i){this.refreshAllWhenReady=!0,super.attachToResourceStore(i),i&&(this.clearAll({clearLayoutCache:!0}),i.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:i,isExpand:e,records:t,changes:r}){const n=this,s=t==null?void 0:t.flatMap(a=>a.isLinked?[a.id,a.$originalId]:[a.id]);if(n.scheduler.isPainted){switch(i){case"add":e||(t.every(a=>a.isLinked)?n.refreshResources(s):n.refreshResourcesWhenReady(s));return;case"update":{!n.project.isChangeTrackingSuspended&&!r.isLeaf&&n.refreshResources(s);return}case"filter":return;case"removeall":n.clearAll({clearLayoutCache:!0});return;case"dataset":return}s&&n.clearResources(s)}}onTranslateRow({row:i}){i.id!=null&&this.refreshEventsForResource(i,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(i){var e,t,r;const{scheduler:n}=this,s=n.getResourceHeight(i),a=n.getEventLayout(i),l=a.type,o=(e=n.features.eventResize)==null?void 0:e.lockLayout,d=(t=n.features.eventDragCreate)==null?void 0:t.lockLayout;if(l==="stack"&&n.isEngineReady&&!i.isSpecialRow&&((r=i.assigned)==null?void 0:r.size)>1){const{assignmentStore:c,eventStore:u,timeAxis:h}=n,{barMargin:g,resourceMarginObject:{total:f},contentHeight:m}=n.getResourceLayoutSettings(i),p=(u.isFiltered||c.isFiltered)&&(D=>D.assignments.some(S=>S.resource===i.$original&&c.includes(S))),v=u.getEvents({resourceRecord:i,includeOccurrences:n.enableRecurringEvents,startDate:h.startDate,endDate:h.endDate,filter:p,fromRowHeight:!0}).sort(bA).map(D=>{var S,x;const R=D.isBatchUpdating&&!(o&&((S=D.meta)!=null&&S.isResizing))&&!(d&&((x=D.meta)!=null&&x.isCreating)),M=R?D.get("startDate"):D.startDate,_=R?D.get("endDate"):D.endDate||M;return{eventRecord:D,resourceRecord:i,startMS:M.getTime(),endMS:_.getTime()}}),b=n.getEventLayoutHandler(a),w=b.layoutEventsInBands(v,i,!0);return b.type==="layoutFn"?w:w*m+(w-1)*g+f}return s}doUpdateTimeView(){const{scrollable:i}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(i.x,!0)}onTimeAxisViewModelUpdate(){const i=this,{scheduler:e}=i;i.clearAll(),e.refreshSuspended&&(i.detachListeners("renderingSuspend"),e.ion({name:"renderingSuspend",resumeRefresh({trigger:t}){e.isEngineReady&&t&&i.doUpdateTimeView()},thisObj:i,once:!0})),i.doUpdateTimeView()}getConnectorStartSide(i){return"start"}getConnectorEndSide(i){return"end"}refreshRows(i,e){i?this.clearResources(i):e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(i,e,t,r){e>r&&this.onRenderDone()}onDragAbort({context:i,dragData:e}){const{record:t}=e;!t.isEventSegmentModel&&this.resourceStore.indexOf(t.resource)<this.scheduler.topRow.dataIndex&&i.element.remove()}toggleCls(i,e,t=!0,r=!1,n=!1){const s=this.client.getElementFromAssignmentRecord(i,r,n),a=this.resourceMap.get(i.isModel?i.get("resourceId"):i.resourceId),l=a==null?void 0:a.eventsData.find(o=>o.eventId===i.eventId);l&&(l[r?"wrapperCls":"cls"][e]=t),s&&(s.classList.toggle(e,t),s.lastDomConfig.className[e]=t)}onRemoveRows({rows:i}){i.forEach(e=>this.rowMap.delete(e)),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(i,e,t){var r,n;const s=this,{scheduler:a,scrollBuffer:l}=s,o=l===-1,{timeAxisSubGrid:d,timeAxis:c}=a,{width:u}=d,{totalSize:h}=a.timeAxisViewModel,g=i,f=Math.abs(d.scrollable.maxX)>1&&Math.abs(d.scrollable.maxX)<=Math.round(g)+5,m=o?c.startDate:a.getDateFromVirtualCoord({coord:Math.max(0,g-l)}),p=f||o?c.endDate:a.getDateFromVirtualCoord({coord:g+u+l})||c.endDate;if(m&&(!a._viewPresetChanging||t)&&(!o||e||m-(((r=s._visibleDateRange)==null?void 0:r.startDate)||0)||p-(((n=s._visibleDateRange)==null?void 0:n.endDate)||0))){s._visibleDateRange={startDate:m,endDate:p,startMS:m.getTime(),endMS:p.getTime()},s.viewportCoords=o?{left:0,right:h}:{left:i-l,right:i+u+l};const v=a.timeView.range={startDate:m,endDate:p};if(a.internalOnVisibleDateRangeChange(v),!a.refreshSuspended&&a.rowManager.rows.length){if(a.rowManager.rows[0].id===null)return;s.fromScroll=!0,a.rowManager.rows.forEach(b=>s.refreshEventsForResource(b,!1,!1)),s.onRenderDone()}}}repaintEventsForResource(i){this.refreshResources([i.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(i){i.forEach(e=>this.toDrawOnDataReady.add(e))}refreshResourcesWhenReady(i){this.clearResources(i),i.forEach(e=>this.toDrawOnProjectRefresh.add(e))}refreshResources(i,e=!0){const t=this,{scheduler:r}=t;if(t.clearResources(i),!r.refreshSuspended){const n=[],s=[];i.forEach(a=>{const l=r.getRowById(a);l?n.push(l):s.push(l)}),r.runWithTransition(()=>{r.calculateRowHeights(s.map(a=>this.resourceStore.getById(a)),!0),r.rowManager.renderRows(n)},e)}}layoutEventVerticallyStack(i,e,t){const{barMargin:r,resourceMarginObject:{start:n},contentHeight:s}=this.scheduler.getResourceLayoutSettings(t,e.parent);return i===0?n:n+i*s+i*r}layoutEventVerticallyPack(i,e,t,r){const{barMargin:n,resourceMarginObject:{start:s},contentHeight:a}=this.scheduler.getResourceLayoutSettings(r,t.parent),l=1/e,o=i*l,d=(a-(l-1)*n)*e;return{top:s+o*d+o*n,height:Math.max(d,0)}}addTemporaryDragElement(i,e=i.resource){const{scheduler:t}=this,r=t.generateRenderData(i,e,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:t.getResourceEventBox(i,e,!0).top;const n=this.renderEvent(r),{dataset:s}=n;delete n.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const a=E.createElement(n,{reactCallback({jsx:l,domConfig:o,targetElement:d}){var c;const{reactComponent:u}=t;l&&((c=t.processEventContent)==null||c.call(t,{jsx:l,action:"add",domConfig:o,targetElement:d,isRelease:!1,reactComponent:u}))}});return a.innerElement=a.firstChild,i.instanceMeta(t).hasTemporaryDragElement=!0,a}eventSorter(i,e){if(this.overlappingEventSorter)return this.overlappingEventSorter(i.eventRecord||i,e.eventRecord||e);const t=i.isModel?i.startDateMS:i.dataStartMS||i.startMS,r=i.isModel?i.endDateMS:i.dataEndMS||i.endMS,n=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,s=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,a=i.isModel?i.name:i.eventRecord.name,l=e.isModel?e.name:e.eventRecord.name;return t-n||s-r||(a<l?-1:a==l?0:1)}calculateMS(i,e,t,r,n){var s,a;const l=this,{scheduler:o}=l,{timeAxisViewModel:d}=o,{eventResize:c}=o.features;let u=R0(o,i,!1,e,r),h=R0(o,i,!0,t,r),g=h-u;if(o.milestoneLayoutMode!=="default"&&g===0){const v=d.getSingleUnitInPixels("minute"),b=o.getMilestoneLabelWidth(i,n);if(g=b*(1/v)*60*1e3,o.milestoneTextPosition==="always-outside"){const D=o.getResourceLayoutSettings(n,i.parent).contentHeight,S=D*(1/v)*60*1e3;if(u-=S/2,h=u+g,o.timeAxis.isContinuous===!1){const x=o.getCoordinateFromDate(u);h=(s=o.getDateFromCoordinate(x+b))!=null?s:h}}else switch(o.milestoneAlign){case"start":case"left":h=u+g;break;case"end":case"right":h=u,u=h-g;break;default:h=u+g/2,u=h-g;break}}const f=u,m=h,p=g;return(a=i.meta)!=null&&a.isResizing&&(c!=null&&c.isResizing)&&c.lockLayout&&!c.isMultiResizing&&(u=i.startDate.getTime(),h=i.endDate.getTime(),g=m-f),{startMS:u,endMS:h,durationMS:g,elementStartMS:f,elementEndMS:m,elementDurationMS:p}}setupRenderData(i,e){var t;const r=this,{scheduler:n}=r,{timeAxis:s,timeAxisViewModel:a}=n,{preamble:l,postamble:o}=i,d=r.isProHorizontalRendering&&((t=n.features.eventBuffer)==null?void 0:t.enabled)&&(l||o)&&!i.isMilestone,c=a.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=i,h=d?"wrapStartDate":"startDate",g=d?"wrapEndDate":"endDate",f=u&&!d?i.get(h):i[h],m=u&&!d?i.get(g):i[g]||f,p=s.startMS,v=s.endMS,b=r.calculateMS(i,h,g,d,e),{durationMS:w,elementStartMS:D,elementEndMS:S}=b,x=D<p|(D>v)<<1,R=S>v|(S<=p)<<1,M=w/(1e3*60),_=R?c*M:null,k=n.getRowById(e);return w===0&&b.startMS--,{eventRecord:i,taskRecord:i,start:f,end:m,rowId:e.id,children:[],startsOutsideView:x,endsOutsideView:R,width:_,row:k,useEventBuffer:d,...b}}fillTimeSpanHorizontalPosition(i){const{elementStartMS:e,elementEndMS:t,elementDurationMS:r}=i,n=e!=null&&t!=null&&this.calculateHorizontalPosition(i,e,t,r);return n?(Object.assign(i,n),!0):!1}calculateHorizontalPosition(i,e,t,r){const{scheduler:n}=this,{timeAxis:s,timeAxisViewModel:a}=n,{startsOutsideView:l,endsOutsideView:o,eventRecord:d}=i,c=s.startMS,u=a.getSingleUnitInPixels("minute");let h=null,g=n.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0}),f,m=!1,p=!1;if(l?f=(e-c)/(1e3*60)*u:(f=n.getVirtualCoordFromDate(e,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:g!==-1}),m=f===-1),o){const v=a.totalSize-f,b=t-s.endMS,w=b/(1e3*60);h=v+u*w,Y.isSafari&&Y.safariVersion<16&&n.features.stickyEvents&&s.endMS&&!l?g=n.getCoordinateFromDate(s.endMS):g=f+h}else p=g===-1;return p&&!m&&(g=n.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),h>jp&&(l===1?o===1?(f=-100,g=n.timeAxisColumn.width+100):f=g-jp:o===1&&(g=f+jp)),m&&p&&(f=n.getVirtualCoordFromDate(e,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:t}),g=n.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:e}),f===g)?(d.instanceMeta(n).excluded=!0,null):{left:Math.min(f,g),width:Math.abs(g-f)||(d.isMilestone&&!d.meta.isDragCreating?0:6),clippedStart:m,clippedEnd:p}}fillTimeSpanVerticalPosition(i,e){const{scheduler:t}=this,{start:r,end:n}=i,{resourceMarginObject:{start:s},contentHeight:a}=t.getResourceLayoutSettings(e);t.fillTicks&&(i.dataStartMS=r.getTime(),i.dataEndMS=n.getTime()),i.top=Math.max(0,s),t.managedEventSizing&&(i.height=a)}getTimeSpanRenderData(i,e,t=!1){const r=this.setupRenderData(i,e);return this.fillTimeSpanHorizontalPosition(r)?(this.fillTimeSpanVerticalPosition(r,e),r):null}layoutEvents(i,e,t=!1,r,n){const s=this,{scheduler:a}=s,{timeAxis:l}=a,o=e.reduce((g,f)=>{if(t||l.isTimeSpanInAxis(f)){const m=a.generateRenderData(f,i,t);m&&g.push(m)}return g},[]);o.sort(n!=null?n:s.eventSorter);let d=a.getAppliedResourceHeight(i,r);const c=o.filter(({eventRecord:g})=>g.isEvent&&!g.meta.excludeFromLayout),u=a.getEventLayout(i,r),h=a.getEventLayoutHandler(u);if(h){const{barMargin:g,resourceMarginObject:{total:f},contentHeight:m}=a.getResourceLayoutSettings(i,r),p=h.applyLayout(c,i,a)||1;h.type==="layoutFn"?d=p:d=p*m+(p-1)*g+f}else if(c.length>0){const g=Math.min(c.length,s.maxZIndexStacks);for(let f=0;f<g;f++){const m=c[f];m.wrapperStyle+=`;z-index:${f+5}`}}return{rowHeight:d,eventsData:o}}layoutResourceEvents(i,e=!1){const t=this,{scheduler:r}=t,{eventStore:n,assignmentStore:s,timeAxis:a}=r,l=n.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:i,startDate:a.startDate,endDate:a.endDate,visibleDateRange:t.visibleDateRange,filter:(s.isFiltered||n.isFiltered)&&(d=>d.assignments.some(c=>c.resource===i.$original&&s.includes(c)))}),o=r.getEventsToRender(i,l)||[];return t.layoutEvents(i,o,e)}renderEvent(i,e){const{scheduler:t}=this,{resourceRecord:r,assignmentRecord:n,eventRecord:s}=i,a=n?this.assignmentStore.getOccurrence(n,s).id:i.eventId,l={className:i.cls,style:i.style||"",children:i.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},o={className:i.wrapperCls,tabIndex:"tabIndex"in i?i.tabIndex:-1,"aria-label":i.wrapperCls["b-active"]?i.ariaLabel:void 0,children:[l,...i.wrapperChildren],style:{insetBlockStart:i.absoluteTop,insetInlineStart:i.left,height:i.fillSize?e:i.height,width:i.width,style:i.wrapperStyle,fontSize:i.height+"px"},dataset:{resourceId:r.id,eventId:i.eventId,syncId:r.isLinked?`${a}_${r.id}`:a},elementData:i,retainElement:(n==null?void 0:n.instanceMeta(t).retainElement)||s.instanceMeta(t).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return s.isMilestone&&t.milestoneLayoutMode!=="default"&&t.milestoneTextPosition==="always-outside"&&t.getEventLayout(r).type==="pack"&&(o.style.insetInlineStart+=(t.getResourceLayoutSettings(r,s.parent).contentHeight-i.height)/2),i.fillSize&&(i.height=e),i.zIndex&&(o.zIndex=i.zIndex),n&&(o.dataset.assignmentId=n.id),i.elementConfig=o,t.afterRenderEvent({renderData:i,rowHeight:e,domConfig:o}),o}refreshEventsForResource(i,e=!0,t=!0){const r=this,{store:n}=r.scheduler,s=i.isRow?n.getAt(i.dataIndex):n.getById(i),a=r.scheduler.rowManager.getRowFor(s);e&&r.clearResources([s]),a&&s&&(r.renderer({row:a,record:s}),e&&t&&r.onRenderDone())}getResourceLayout(i){const e=this;let t=e.resourceMap.get(i.id);if(!t||t.invalid||e.eventStore.lazyLoad){if(e.suspended)return;t=e.layoutResourceEvents(i,!1),e.resourceMap.set(i.id,t)}return t}getEventDOMConfigForCurrentView(i,e,t,r){var n;const s=this,{bufferSize:a,scheduler:l}=s,{labels:o,eventBuffer:d}=l.features,c=(d==null?void 0:d.enabled)||(o==null?void 0:o.enabled)&&(o.left||o.right||o.before||o.after),{eventsData:u}=i,h=s.fromScroll?s.rowMap.get(e):null,g=[];let f,m;for(let p=0;p<u.length;p++){const v=u[p];if(f=t,m=r,(c||v.width===0)&&(f-=a,m+=a),v.left+v.width>=f&&v.left<=m){v.absoluteTop=v.top+e.top;const b=h==null?void 0:h.find(w=>w.elementData.eventId===v.eventId&&w.elementData.resourceId===v.resourceId);b&&(b.style.top=v.absoluteTop),v.hidden=(n=e.cls)==null?void 0:n.contains("b-row-placeholder"),g.push(b!=null?b:s.renderEvent(v,i.rowHeight))}}return g}renderer({row:i,record:e,size:t={}}){const r=this;if(e.isSpecialRow){r.rowMap.delete(i);return}const{left:n,right:s}=r.viewportCoords,a=r.getResourceLayout(e);if(!a)return;t.height=a.rowHeight,t.transient=!0;const l=r.getEventDOMConfigForCurrentView(a,i,n,s);r.rowMap.set(i,l),r.rendererCalled=!0}onRenderDone(){var i;const{scheduler:e,rowMap:t,verticalBufferSize:r,fromScroll:n}=this;if(e.refreshSuspended)return;const{entityNames:s}=this,a={event:[]},l=(i=e._scrollTop)!=null?i:0,o=l-r,d=l+e._bodyRectangle.height+r,c=r<0,u=!e.managedEventSizing;for(const h of s)a[h]=[];t.forEach((h,g)=>{if(!g.isDestroyed&&!g.cls.contains("b-row-placeholder")&&(c||g.bottom>o&&g.top<d))for(let f=0;f<h.length;f++){const m=h[f],p=m.elementData,{absoluteTop:v,eventRecord:b,entityName:w="event"}=p;(c||u||b.meta.isDragCreating||b.meta.isResizing||v+p.height>o&&v<d)&&(a[w]||(a[w]=[],s.add(w)),a[w].push(m))}for(let f=0;f<h.length;f++)h[f]={...h[f]}}),this.fromScroll=!1;for(const h in a)oe.sync({domConfig:{onlyChildren:!0,children:a[h]},targetElement:e.canvases[h],syncIdField:"syncId",releaseThreshold:e.eventReleaseThreshold,callback:({action:g,domConfig:f,lastDomConfig:m,targetElement:p,jsx:v})=>T0(e,n,{action:g,domConfig:f,lastDomConfig:m,targetElement:p,jsx:v})})}clearResources(i){i=B.asArray(i),i.map(me.asId).forEach(t=>{const r=this.resourceMap.get(t);r&&(r.invalid=!0);const n=this.scheduler.getRowById(t);n&&this.rowMap.delete(n)})}clearAll({clearDom:i=!1,clearLayoutCache:e=!1}={}){const t=this,{layouts:r,foregroundCanvas:n}=t.scheduler;if(e&&r)for(const s in r)r[s].clearCache();if(n&&i){n.syncIdMap=n.lastDomConfig=n.releasedIdMap=null;for(const s of n.children)s.lastDomConfig=s.elementData=null}t.resourceMap.clear(),t.rowMap.clear()}};y(Zh,"$name","HorizontalRendering");function T0(i,e,{action:t,domConfig:r,lastDomConfig:n,targetElement:s,jsx:a}){var l,o,d;const{reactComponent:c}=i,u=mA[t],h=pA[t];if(!u&&((l=i.processEventContent)==null||l.call(i,{jsx:a,action:t,domConfig:r,targetElement:s,isRelease:u,reactComponent:c,scrolling:e})),!(t==="none"||!((o=r==null?void 0:r.elementData)!=null&&o.isWrap))){if(u&&(n!=null&&n.elementData)){const{eventRecord:g,resourceRecord:f,assignmentRecord:m}=n.elementData,p={renderData:n.elementData,element:s,eventRecord:g,resourceRecord:f,assignmentRecord:m};(d=i.processEventContent)==null||d.call(i,{isRelease:u,domConfig:n,targetElement:s,reactComponent:c}),s===E.getActiveElement(s)&&i.focusElement.focus(),i.trigger("releaseEvent",p)}if(h){const{eventRecord:g,resourceRecord:f,assignmentRecord:m}=r.elementData,p={renderData:r.elementData,element:s,isReusingElement:t==="reuseElement",isRepaint:t==="reuseOwnElement",eventRecord:g,resourceRecord:f,assignmentRecord:m};t==="reuseElement"&&i.isAnimating&&E.addTemporaryClass(s,"b-reusing-own",50,i,`b-reusing-own-${(m||g).id}`),i.trigger("renderEvent",p)}}}Zh._$name="HorizontalRendering";var M0=class extends Xh(){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(i,e,t){const r=this,n=r.scheduler.getResourceWidth(e,t),{barMargin:s,resourceMarginObject:{start:a,total:l}}=r.scheduler.getResourceLayoutSettings(e,t),o=r.scheduler.getEventLayout(e,t),d=o.type;return r.packEventsInBands(i,(c,u,h,g)=>{if(d==="none")c.width=n-l,c.left+=a;else{c.widthFactor=g;const f=c.leftFactor=h.start+u*g,m=Math.round(1/g),p=f/g,v=n-l-s*(m-1);d==="mixed"&&m===2?(c.left+=f*n/5+s,c.width=n-f*n/5-s*2,c.zIndex=5+p):(c.width=g*v,c.appliedMargin=a+s*p,c.left+=f*v+c.appliedMargin)}c.cls["b-sch-event-narrow"]=c.width<r.scheduler.narrowEventWidth})}};M0._$name="VerticalLayout";var wA={releaseElement:1,reuseElement:1},SA={newElement:1,reuseOwnElement:1,reuseElement:1},DA={startDate:1,endDate:1,duration:1},EA=Object.freeze({}),Up=class extends $.mixin(fe,Zt){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(i){this.client=this.scheduler=i,this.verticalLayout=new M0({scheduler:i}),super.construct({})}init(){const i=this,{scheduler:e,resourceColumns:t}=i;t.resourceStore=i.resourceStore,t.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:i}),i.initialized=!0,e.isPainted&&i.renderer(),t.availableWidth=e.timeAxisSubGridElement.offsetWidth}resolveRowRecord(i,e){const t=this,{scheduler:r}=t,n=i.nodeType?null:i,s=n?n.target:i,a=n?[n.borderOffsetX,n.borderOffsetY]:e,l=s.nodeType===Element.TEXT_NODE?s.parentElement:s,o=l.closest(r.eventSelector);if(o)return r.resourceStore.getById(o.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error(`Vertical mode needs coordinates to resolve this element. Can also be called with a browser
                event instead of element to extract element and coordinates from`);if(r.variableColumnWidths||r.resourceStore.isGrouped){let c=0;for(const u of t.resourceStore)if(u.isSpecialRow||(c+=r.getResourceWidth(u)),c>=a[0])return u;return null}const d=Math.floor(a[0]/t.resourceColumns.columnWidth);return t.allResourceRecords[d]}toggleCls(i,e,t=!0,r=!1){var n;const s=(n=this.eventMap.get(i.eventId))==null?void 0:n[i.resourceId];if(s){s.renderData[r?"wrapperCls":"cls"][e]=t;const a=this.client.getElementFromAssignmentRecord(i,r);a&&a.classList[t?"add":"remove"](e)}}getDateFromXY(i,e,t,r=!1){let n=i[1];return t||(n=this.translateToScheduleCoordinate(n)),this.scheduler.timeAxisViewModel.getDateFromPosition(n,e,r)}translateToScheduleCoordinate(i){return i-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(i){return i+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(i,e){var t,r,n;const s=i.id,a=e.id;let{renderData:l}=((t=this.eventMap.get(s))==null?void 0:t[a])||EA;return l||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(a)),l=(n=(r=this.eventMap.get(s))==null?void 0:r[a])==null?void 0:n.renderData),l?new L(l.left,l.top,l.width,l.bottom-l.top):null}getScheduleRegion(i,e,t){var r;const n=this,{scheduler:s}=n,a=L.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);i&&(a.left=n.allResourceRecords.indexOf(i)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const l=s.timeAxis.startDate,o=s.timeAxis.endDate,d=((r=s.getDateConstraints)==null?void 0:r.call(s,i,e))||{start:l,end:o},c=s.getCoordinateFromDate(C.max(l,d.start)),u=s.getCoordinateFromDate(C.min(o,d.end));return t?(a.top=c,a.bottom=u):(a.top=n.translateToPageCoordinate(c),a.bottom=n.translateToPageCoordinate(u)),a}getRowRegion(i,e,t){const r=this,{scheduler:n}=r,s=r.allResourceRecords.indexOf(i)*n.resourceColumnWidth,a=n.timeAxis.startDate,l=n.timeAxis.endDate,o=e?C.max(a,e):a,d=t?C.min(l,t):l,c=n.getCoordinateFromDate(o),u=n.getCoordinateFromDate(d,!0,!0),h=Math.min(c,u),g=Math.abs(c-u);return new L(s,h,n.resourceColumnWidth,g)}get visibleDateRange(){const i=this.scheduler,e=i.scrollable.y,t=i.scrollable.clientHeight,r=i.getDateFromCoordinate(e)||i.timeAxis.startDate,n=i.getDateFromCoordinate(e+t)||i.timeAxis.endDate;return{startDate:r,endDate:n,startMS:r.getTime(),endMS:n.getTime()}}onResourceColumnWidthChange({width:i,oldWidth:e}){const t=this,{scheduler:r}=t;t.resourceColumns.width=r.timeAxisColumn.width=t.allResourceRecords.length*i,t.clearAll(),t.refresh(Math.abs(i-e)>30),r.onVisibleResourceColumnChange(i,e)}attachToProject(i){super.attachToProject(i),i&&i.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const i=this,{scheduler:e,toDrawOnProjectRefresh:t}=i;e.isVisible?e.rendered&&!e.refreshSuspended&&(i.refreshAllWhenReady?(i.clearAll(),i.refresh(),i.refreshAllWhenReady=!1):t.size&&i.refresh(),t.clear()):e.whenVisible("refresh",e,[!0])}attachToEventStore(i){super.attachToEventStore(i),this.refreshAllWhenReady=!0,i&&i.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:i}){for(const e of this.client.getElementsFromEventRecord(i))e.classList.remove("b-iscreating")}onEventStoreRefresh({action:i}){i==="batch"&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:i,records:e=[],record:t,replaced:r,changes:n,isAssign:s}){const a=this,l=new Set;switch(e.forEach(o=>{var d;const c=(d=o.$linkedResources)==null?void 0:d.filter(u=>a.resourceStore.includes(u));c==null||c.forEach(u=>l.add(u.id))}),i){case"sort":case"group":case"move":case"remove":case"batch":return;case"dataset":a.refreshAllResourcesWhenReady();return;case"add":break;case"replace":r.forEach(([,o])=>{o.resources.map(d=>l.add(d.id))}),a.clearResources(l);break;case"removeall":case"filter":a.clearAll(),a.refresh();return;case"update":{const o=t.$entity?!Object.keys(n).some(c=>!t.$entity.getField(c)):!Object.keys(n).some(c=>!DA[c]);let d=0;"startDate"in n&&d++,"endDate"in n&&d++,"duration"in n&&d++,(!o||d||"percentDone"in n||"inactive"in n||"segments"in n)&&(a.shouldWaitForInitializeAndEngineReady?a.refreshResourcesWhenReady(l):(a.clearResources(l),a.refresh()));return}}a.refreshResourcesWhenReady(l)}attachToResourceStore(i){const e=this;super.attachToResourceStore(i),e.refreshAllWhenReady=!0,e.resourceColumns&&(e.resourceColumns.resourceStore=i),i.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>e.scheduler.unmaskBody(),thisObj:e,prio:1}),e.initialized&&e.scheduler.isPainted&&(e.firstResource=e.lastResource=null,e.clearAll(),e.renderer())}onResourceStoreChange({source:i,action:e,records:t=[],record:r,replaced:n,changes:s}){const a=this,l=n?n.map(c=>c[1]):t,o=new Set(l.map(c=>c.id));a.firstResource=a.lastResource=null,i._allResourceRecords=null;const{allResourceRecords:d}=i;if(a.scheduler.isEngineReady){switch(e){case"update":s!=null&&s.id?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([r.id]);break;case"filter":a.clearAll();break}s&&"columnWidth"in s&&(r.instanceMeta(a.scheduler).columnWidth=r.columnWidth,a.clearAll()),a.refresh(!0)}else{switch(e){case"dataset":case"remove":case"removeall":a.refreshAllResourcesWhenReady();return;case"replace":case"add":if(!i.isGrouped){const c=l.reduce((u,h)=>Math.min(u,d.indexOf(h)),d.length);for(let u=c;u<d.length;u++)o.add(d[u].id)}}a.refreshResourcesWhenReady(o)}}onResourceStoreRefresh({action:i}){const e=this;(i==="sort"||i==="group")&&(e.firstResource=e.lastResource=e.resourceStore._allResourceRecords=null,e.clearAll(),e.refresh())}attachToAssignmentStore(i){super.attachToAssignmentStore(i),this.refreshAllWhenReady=!0,i&&i.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:i,records:e=[],replaced:t,changes:r}){const n=this,s=new Set(e.map(a=>a.resourceId));if(n.scheduler.isEngineReady){switch(i){case"add":case"remove":n.clearResources(s);break;case"filter":n.clearAll();break;case"update":{if("resourceId"in r&&s.add(r.resourceId.oldValue),!Object.keys(r).filter(a=>a!=="resource"&&a!=="event").length)return;n.clearResources(s)}}n.refresh(!0)}else{switch(r&&"resourceId"in r&&s.add(r.resourceId.oldValue),i){case"removeall":n.refreshAllResourcesWhenReady();return;case"replace":t.forEach(([a,l])=>{s.add(a.resourceId),s.add(l.resourceId)})}n.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:i,records:e}){i==="batch"&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(i,e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(i){const{resourceColumns:e}=this.scheduler;this.renderResource(i),this.scheduler.internalEventLayout.type==="layoutFn"&&(e.updateWidthCache(),e.refresh())}updateFromHorizontalScroll(i){i!==this.prevScrollX&&(this.fromScroll=!0,this.renderer(),this.prevScrollX=i)}updateFromVerticalScroll(){this.fromScroll=!0,this.renderer()}scrollResourceIntoView(i,e){const{scheduler:t}=this,r=this.allResourceRecords.indexOf(i)*t.resourceColumnWidth;return t.scrollHorizontallyTo(r,e)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(i){this.resourceColumns.availableWidth!==i&&(this.resourceColumns.availableWidth=i,this.scheduler.refreshVirtualScrollbars()),this.renderer()}get resourceColumns(){var i;return(i=this.scheduler.timeAxisColumn)==null?void 0:i.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(i){return"top"}getConnectorEndSide(i){return"bottom"}refreshResourcesWhenReady(i){this.clearResources(i),i.forEach(e=>this.toDrawOnProjectRefresh.add(e))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:i,last:e}=this.getResourceRange();return{first:this.allResourceRecords[i],last:this.allResourceRecords[e]}}getResourceRange(i){const{scheduler:e,resourceStore:t}=this,{resourceColumnWidth:r,scrollX:n}=e,{scrollWidth:s}=e.timeAxisSubGrid.scrollable,a=i?this.resourceBufferSize:0,l=n-a,o=n+s+a;if(!(t!=null&&t.count))return{first:-1,last:-1};if(e.variableColumnWidths){let d,c=0,u,h=0;return this.allResourceRecords.forEach((g,f)=>{if(g.instanceMeta(e).insetStart=u=h,h=u+e.getResourceWidth(g),u>o)return!1;h>l&&d==null?d=f:u<o&&(c=f)}),{first:d,last:c}}else return{first:Math.max(Math.floor(n/r)-a,0),last:Math.min(Math.floor((n+e.timeAxisSubGrid.width)/r)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:i}=this;let e=i.getDateFromCoordinate(Math.min(i.scrollTop+i.bodyHeight+i.tickSize-1,(i.virtualScrollHeight||i.scrollable.scrollHeight)-1));e||(e=i.timeAxis.last.endDate);let t=i.getDateFromCoordinate(Math.max(i.scrollTop-i.tickSize,0));return t||(t=i.timeAxis.first.startDate,e=i.getDateFromCoordinate(i.bodyHeight+i.tickSize-1)),{topDate:t,bottomDate:e}}getTimeSpanRenderData(i,e,t=!1){var r;const n=this,{scheduler:s}=n,{preamble:a,postamble:l}=i,{variableColumnWidths:o}=s,d=((r=s.features.eventBuffer)==null?void 0:r.enabled)&&n.isProVerticalRendering&&(a||l)&&!i.isMilestone,c=d?"wrapStartDate":"startDate",u=d?"wrapEndDate":"endDate",h=i.isBatchUpdating&&i.hasBatchedChange(c)&&!d?i.get(c):i[c],g=i.isBatchUpdating&&i.hasBatchedChange(u)&&!d?i.get(u):i[u],{resourceMarginObject:{total:f}}=s.getResourceLayoutSettings(e),m=s.getCoordinateFromDate(h),p=e.instanceMeta(s),v=o?p.insetStart:n.allResourceRecords.indexOf(e)*s.resourceColumnWidth,b=s.getResourceWidth(e),w=b-f,D=h.getTime(),S=g.getTime();let x=s.getCoordinateFromDate(g),R=x-m;return x===-1&&(R=Math.round((S-D)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),x=m+R),{eventRecord:i,resourceRecord:e,left:v,top:m,bottom:x,resourceWidth:b,width:w,height:R,startDate:h,endDate:g,startDateMS:D,endDateMS:S,useEventBuffer:d,children:[],start:h,end:g,startMS:D,endMS:S}}eventSorter(i,e){const t=i.dataStartMs||i.startDateMS,r=i.dataEndMs||i.endDateMS,n=e.dataStartMs||e.startDateMS,s=e.dataEndMs||e.endDateMS,a=i.isModel?i.name:i.eventRecord.name,l=e.isModel?e.name:e.eventRecord.name;return t-n||s-r||(a<l?-1:a==l?0:1)}layoutEvents(i,e,t=!1,r,n){const s=this,{scheduler:a}=s,{variableColumnWidths:l}=a,{id:o}=i,d=i.instanceMeta(a),c=r?`${o}-${r.id}`:o,u=s.resourceMap.set(c,{}).get(c),h=s.allResourceRecords.indexOf(i),g=e.reduce((f,m)=>{if(m.isScheduled){const p=a.generateRenderData(m,i,!1),v={renderData:p},b=T.getMapPath(s.eventMap,p.eventId,{});b[o]=v,u[p.eventId]=v,p.fillSize?(p.left=l?d.insetStart:h*a.resourceColumnWidth,p.width=a.getResourceWidth(i)):f.push(p)}return f},[]);return g.sort(n!=null?n:s.eventSorter),s.verticalLayout.applyLayout(g,i,r),u}layoutResourceEvents(i,e,t){const r=this,{scheduler:n}=r,{assignmentStore:s,eventStore:a,timeAxis:l}=n;let o=a.getEvents({includeOccurrences:n.enableRecurringEvents,resourceRecord:i,startDate:e!=null?e:l.startDate,endDate:t!=null?t:l.endDate,filter:(s.isFiltered||a.isFiltered)&&(d=>d.assignments.some(c=>c.resource===i&&s.includes(c)))});return o=n.getEventsToRender(i,o),r.layoutEvents(i,o)}addTemporaryDragElement(i){const{scheduler:e}=this,t=e.generateRenderData(i,i.resource,{timeAxis:!0,viewport:!0});t.top=t.row?t.top+t.row.top:e.getResourceEventBox(i,i.resource,!0).top;const r=this.renderEvent({renderData:t}),{dataset:n}=r;delete r.tabIndex,delete n.eventId,delete n.resourceId,delete n.assignmentId,delete n.syncId,n.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const s=E.createElement(r,{reactCallback({jsx:a,domConfig:l,targetElement:o}){var d;const{reactComponent:c}=e;a&&((d=e.processEventContent)==null||d.call(e,{jsx:a,action:"add",domConfig:l,targetElement:o,isRelease:!1,reactComponent:c}))}});return s.innerElement=s.firstChild,i.instanceMeta(e).hasTemporaryDragElement=!0,s}renderEvent(i){const{scheduler:e}=this,t=i.renderData,{resourceRecord:r,assignmentRecord:n,eventRecord:s}=t,a={className:t.wrapperCls,tabIndex:-1,"aria-label":t.wrapperCls["b-active"]?t.ariaLabel:void 0,children:[{role:"presentation",className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{top:t.top,[e.rtl?"right":"left"]:t.left,height:s.isMilestone?"1em":t.height,width:t.width,style:t.wrapperStyle||"",fontSize:s.isMilestone?Math.min(t.width,40):null},dataset:{resourceId:r.id,eventId:t.eventId,syncId:n?this.assignmentStore.getOccurrence(n,s).id:t.eventId},elementData:i,retainElement:(n||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,t.zIndex&&(a.style.zIndex=t.zIndex),n&&(a.dataset.assignmentId=n.id),t.elementConfig=i.elementConfig=a,e.afterRenderEvent({renderData:t,domConfig:a}),a}renderResource(i,e,t){var r,n,s;const a=this,l=(r=e==null?void 0:e.getTime())!=null?r:a.topDateMS,o=(n=t==null?void 0:t.getTime())!=null?n:a.bottomDateMS,d=[];let c=a.resourceMap.get(i.id);c||(c=a.layoutResourceEvents(i,e,t));for(const u in c){const h=c[u],{endDateMS:g,startDateMS:f,eventRecord:m}=h.renderData;if(g>=l&&f<=o&&!m.instanceMeta(a.scheduler).hasTemporaryDragElement){const p=((s=h.elementConfig)==null?void 0:s.className)!=="b-released"&&h.elementConfig||a.renderEvent(h);d.push(p)}}return d}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const i=this,{scheduler:e}=i,{topDate:t,bottomDate:r}=i.dateRange,n=[],s=[],a={event:[]},{allResourceRecords:l,fromScroll:o}=i;let{first:d,last:c}=i.resourceRange;if(!i.shouldWaitForInitializeAndEngineReady){if(!C.isEqual(t,i.topDate)||!C.isEqual(r,i.bottomDate)){i.topDate=t,i.bottomDate=r,i.topDateMS=t.getTime(),i.bottomDateMS=r.getTime();const u=i.timeView.range={startDate:t,endDate:r};e.internalOnVisibleDateRangeChange(u)}if(d!==-1&&c!==-1){if(e.internalEventLayout.type==="layoutFn"&&d!==void 0)i.renderResourceCustomLayout(n);else for(let h=d;h<=c;h++)n.push.apply(n,i.renderResource(l[h]));const{resourceRange:u}=i;d=u.first,c=u.last}e.getForegroundDomConfigs(s),n.push.apply(n,s);for(const u of n){const{entityName:h="event"}=u.elementData.renderData;a[h]||(a[h]=[]),a[h].push(u)}for(const u in a)oe.sync({domConfig:{onlyChildren:!0,children:a[u]},targetElement:e.canvases[u],syncIdField:"syncId",releaseThreshold:e.eventReleaseThreshold,callback({action:h,domConfig:g,lastDomConfig:f,targetElement:m,jsx:p}){_0(e,o,{domConfig:g,jsx:p,action:h,targetElement:m,lastDomConfig:f})}});if(i.firstResource!==d||i.lastResource!==c){const u=i.resourceColumns.visibleResources={firstResource:d,lastResource:c};i.firstResource=d,i.lastResource=c,e.onVisibleResourceRangeChange(u),e.trigger("resourceRangeChange",u)}this.fromScroll=!1}}refresh(i){this.scheduler.runWithTransition(()=>this.renderer(),i)}refreshResources(i){i=i.map(e=>{var t;return(t=e.id)!=null?t:e}),this.clearResources(i),this.refresh()}refreshEventsForResource(i,e=!0,t=!0){this.refreshResources([i.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(i){const{resourceMap:e,eventMap:t}=this;i.forEach(r=>{e.has(r)&&(Object.values(e.get(r)).forEach(({renderData:{eventId:n}})=>{delete t.get(n)[r]}),e.delete(r))})}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}};function _0(i,e,{domConfig:t,jsx:r,action:n,targetElement:s,lastDomConfig:a}){var l,o,d;const{reactComponent:c}=i;if(i.isEventElement(t)||r||(l=t==null?void 0:t.elementData)!=null&&l.jsx){const u=wA[n],h=SA[n];if((o=i.processEventContent)!=null&&o.call(i,{action:n,domConfig:t,isRelease:!1,targetElement:s,reactComponent:c,jsx:r,scrolling:e}))return;if(u&&i.isEventElement(a)&&!a.isReleased){const g=a.elementData.renderData,f={renderData:g,assignmentRecord:g.assignmentRecord,eventRecord:g.eventRecord,resourceRecord:g.resourceRecord,element:s};(d=i.processEventContent)==null||d.call(i,{isRelease:u,domConfig:a,targetElement:s,reactComponent:c}),s===E.getActiveElement(s)&&i.focusElement.focus(),i.trigger("releaseEvent",f)}if(h){const g=t.elementData.renderData,f={renderData:g,assignmentRecord:g.assignmentRecord,eventRecord:g.eventRecord,resourceRecord:g.resourceRecord,element:s,isReusingElement:n==="reuseElement",isRepaint:n==="reuseOwnElement"};f.reusingElement=n==="reuseElement",i.trigger("renderEvent",f)}}}Up._$name="VerticalRendering";function xA(i,e){return i===e.length-1}function RA(i,e){return e===i.cells[i.cells.length-1]}var cc=class extends z{constructor(){super(...arguments),y(this,"startDate",null),y(this,"endDate",null),y(this,"levels",[]),y(this,"size",null)}set range({startDate:i,endDate:e}){var t;const r=this;if(r.startDate-i||r.endDate-e){const{client:n}=r;if(r.startDate=i,r.endDate=e,r.sizeProperty==="width"&&(n!=null&&n.hideHeaders)||r.sizeProperty==="height"&&((t=n==null?void 0:n.verticalTimeAxisColumn)!=null&&t.hidden))return;r.refresh()}}buildCells(i=this.startDate,e=this.endDate){var t;const r=this,{sizeProperty:n}=r,{stickyHeaders:s,isVertical:a}=r.client||{},l=[],{length:o}=r.levels,d=r.levels.map((c,u)=>{var h;const g=s&&(a||u<o-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${c.position}`]:1,"b-sch-header-row-main":u===r.model.viewPreset.mainHeaderLevel,"b-lowest":xA(u,r.levels),"b-sticky-header":g},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${u}`,headerPosition:c.position},children:(h=c.cells)==null?void 0:h.filter(f=>f.start<e&&f.end>i).map((f,m)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[f.headerCellCls]:f.headerCellCls,[`b-align-${f.align}`]:f.align,"b-last":RA(c,f)},dataset:{tickIndex:f.index,...globalThis.DEBUG&&{date:f.start.getTime()}},style:{[r.positionProperty]:f.coord,[n]:f.width,[`min-${n}`]:f.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":g},html:f.value}]}))}});return(t=r.client)==null||t.getHeaderDomConfigs(l),d.push(...l),{onlyChildren:!0,syncOptions:{releaseThreshold:0},children:d}}render(i){super.render(i),this.refresh(!0)}refresh(i=!this.levels.length){const e=this,{columnConfig:t}=e.model,{levels:r}=e,n=r.length;if(i){r.length=0,t.forEach((a,l)=>r[l]={position:l,cells:a}),e.size=r[0].cells.reduce((a,l)=>a+l.width,0);const{parentElement:s}=e.element;s&&(r.length!==n||i)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${n}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}!e.startDate||!e.endDate||(oe.sync({domConfig:e.buildCells(),targetElement:e.element,syncIdField:"headerFeature"}),e.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}};y(cc,"$name","TimeAxisBase"),y(cc,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),cc._$name="TimeAxisBase";var yl=class extends cc{get positionProperty(){return"insetInlineStart"}get width(){return this.size}onModelUpdate(){var i;!((i=this.owner)!=null&&i.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(i){this.detachListeners("tavm"),i==null||i.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}};y(yl,"$name","HorizontalTimeAxis"),y(yl,"type","horizontaltimeaxis"),y(yl,"configurable",{model:null,sizeProperty:"width"}),yl._$name="HorizontalTimeAxis";var bl=class extends z{constructor(){super(...arguments),y(this,"firstResource",-1),y(this,"lastResource",-1)}construct(i){const e=this;i.scheduler._resourceColumns=e,super.construct(i),e.imagePath!=null&&e.element.classList.add("b-has-images"),V.on({element:e.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:e})}changeShowAvatars(i){var e;return(e=this.avatarRendering)==null||e.destroy(),i&&(this.avatarRendering=new La({element:this.element})),i}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(i){const e=this;e.detachListeners("resourceStore"),i&&(i.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:e}),i.count&&e.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:i}){const e=this;e.getConfig("fillWidth"),e.getConfig("fitWidth"),e.updateWidthCache();const{element:t}=e,r=e.totalWidth;e.scheduler.variableColumnWidths?e._fillWidth=e._fitWidth=!1:(e._fillWidth=e.configuredFillWidth,e._fitWidth=e.configuredFitWidth),r!==e.width&&(E.setLength(t,"width",r),e.column.set("width",r,e.column.grid.isConfiguring)),i==="removeall"&&(t.innerHTML=""),(i==="remove"||i==="add"||i==="filter"||e.fitWidth||e.fillWidth)&&e.refreshWidths(),e.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let i=0;const{scheduler:e}=this;return e.variableColumnWidths=!1,e.resourceStore.forEach(t=>{const r=t.instanceMeta(e);r.columnWidth==null&&t.columnWidth&&(r.columnWidth=t.columnWidth),r.insetStart=i,r.insetEnd=i+e.getResourceWidth(t),r.columnWidth==null?i+=e.resourceColumnWidth:(i+=r.columnWidth,e.variableColumnWidths=!0)}),i}changeColumnWidth(i){return this.refreshingWidths||(this.configuredColumnWidth=i),i}updateColumnWidth(i,e){const t=this;t.refreshingWidths||t.refreshWidths(),t.isConfiguring||(t.resourceStore.isGrouped&&t.updateWidthCache(),t.refresh(),t.trigger("columnWidthChange",{width:i,oldWidth:e}))}changeFillWidth(i){return this.configuredFillWidth=i}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(i){return this.configuredFitWidth=i}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(i){return O.joinPaths([this.imagePath||"",i||""])+(i!=null&&i.includes(".")?"":this.imageExtension)}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(i){this.refreshWidths()}refreshWidths(){var i;const e=this,{availableWidth:t,configuredColumnWidth:r}=e,n=(i=e.resourceStore)==null?void 0:i.count;if(!t||!n||e.scheduler.variableColumnWidths)return;e.refreshingWidths=!0;const s=e.fitWidth||e.fillWidth&&r*n<t,a=s?Math.floor(t/n):r,l=e.column.grid.enableEventAnimations&&Math.abs(e._columnWidth-a)>30;E.addTemporaryClass(e.element,"b-animating",l?300:0,e),e.columnWidth=a,e.refreshingWidths=!1}set visibleResources({firstResource:i,lastResource:e}){this.firstResource=i,this.lastResource=e,this.updateWidthCache(),this.refresh()}refresh(){const i=this,{firstResource:e,scheduler:t,resourceStore:r,lastResource:n}=i,s=r.isGrouped&&r.groupers[0].field;i.element.classList.toggle("b-grouped",!!s);const a=i.renderResourceHeaders(e,n);oe.sync({domConfig:{onlyChildren:!0,children:a},targetElement:i.element,syncIdField:"resourceId",callback:({jsx:l,targetElement:o,domConfig:d})=>{var c;(c=t.processResourceHeader)==null||c.call(t,{jsx:l,targetElement:o,domConfig:d})}})}renderResourceHeaders(i,e){var t,r;const n=this,{scheduler:s,resourceStore:a}=n,{variableColumnWidths:l}=s,o=a.isGrouped&&a.groupers[0].field,d=[];if(!n.column.grid.isConfiguring&&i>-1&&e>-1&&e<a.count){let c;for(let u=i;u<=e;u++){const h=a.allResourceRecords[u],g=h.instanceMeta(a).groupParent,f=g==null?void 0:g.groupChildren;if(o&&g.id!==(c==null?void 0:c.dataset.resourceId)){const w=f[0].instanceMeta(s).insetStart,D=f[f.length-1].instanceMeta(s).insetEnd-w,S=(t=s.features.group)==null?void 0:t.renderer;let x=f[0][o],R="text";if(S){const M=h.instanceMeta(a).groupParent,_=M.meta,k=_.groupRowFor,F=_.childCount;x=s.features.group.groupRenderer({groupRowFor:k,groupRecords:M.groupChildren,count:F}),typeof x=="string"&&x.includes("<")?R="html":typeof x=="object"&&(R="children",x=[x])}c={className:"b-resourceheader-group-cell",dataset:{resourceId:g.id},style:{left:w,width:D},children:[{className:"b-resourceheader-group-text-wrap",children:Array.isArray(x)?x:[{tag:"span",[R]:x}]},{className:"b-resourceheader-group-children",children:[]}]},d.push(c)}const m=h.instanceMeta(s),p=m.columnWidth||n.columnWidth,v=o?m.insetStart-c.style.left:l?m.insetStart:u*n.columnWidth,b={tabIndex:0,className:new te({"b-resourceheader-cell":1}),dataset:{resourceId:h.id},style:{[s.rtl?"right":"left"]:v,width:p},children:[]};if(n.headerRenderer){const w=n.headerRenderer({elementConfig:b,resourceRecord:h});w&&(typeof w=="string"?b.html=w:typeof w=="object"&&(b.children=[w]))}else{let w;if(h.imageUrl)w=h.imageUrl;else if(n.imagePath!=null&&h.image!==!1){const D=h.image||((r=h.name)==null?void 0:r.toLowerCase());w=D&&n.getImageURL(D)}b.children.push(n.showAvatars&&n.avatarRendering.getResourceAvatar({resourceRecord:h,initials:h.initials,color:h.eventColor,iconCls:h.iconCls,defaultImageUrl:n.defaultImageName&&n.getImageURL(n.defaultImageName),imageUrl:w}),{tag:"span",className:"b-resource-name",html:O.encodeHtml(h.name)})}o?c.children[1].children.push(b):d.push(b)}}return d}onResourceMouseEvent(i){const e=i.target.closest(".b-resourceheader-cell"),t=this.resourceStore.getById(e.dataset.resourceId);this.trigger("resourceHeader"+O.capitalize(i.type),{resourceRecord:t,event:i})}getCurrentConfig(i){const e=super.getCurrentConfig(i);return delete e.resourceStore,delete e.column,delete e.type,e}};y(bl,"$name","ResourceHeader"),y(bl,"type","resourceheader"),y(bl,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),bl._$name="ResourceHeader";var Cl=class extends Fe(ir){constructor(){super(...arguments),y(this,"headerHoverable",!1)}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,ariaLabel:null,mode:null,region:"normal",exportable:!1,htmlEncode:!1,id:"timeaxiscolumn"}}construct(i){const e=this;i.disableRendererWarning=!0,super.construct(...arguments),e.thisObj=e,e.grid._timeAxisColumn=e,e.timeAxisViewModel=e.grid.timeAxisViewModel,e.mode=e.mode,e.grid.ion({paint:"onTimelinePaint",thisObj:e,once:!0}),Le.ion({locale:e.updateHeaderAriaLabel,thisObj:e})}static get autoExposeFields(){return!0}updateHeaderAriaLabel(){const{grid:i}=this,{visibleDateRange:e}=i,t=C.format(e==null?void 0:e.startDate,i.displayDateFormat),r=C.format(e==null?void 0:e.endDate,i.displayDateFormat);return super.updateHeaderAriaLabel(this.L(this.ariaLabel||"L{TimeAxisColumn.ariaLabel}")(t,r))}doDestroy(){var i,e;(i=this.resourceColumns)==null||i.destroy(),(e=this.timeAxisView)==null||e.destroy(),super.doDestroy()}set mode(i){const e=this,{grid:t}=e;e.set("mode",i),i==="horizontal"?e.timeAxisView=new yl({model:e.timeAxisViewModel,compactCellWidthThreshold:e.compactCellWidthThreshold,owner:t,client:t}):i==="vertical"&&(e.resourceColumns=bl.new({column:e,scheduler:t,resourceStore:t.resourceStore,imagePath:t.resourceImagePath,imageExtension:t.resourceImageExtension,defaultImageName:t.defaultResourceImageName},t.resourceColumns||{}),e.relayEvents(e.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:i}){const e=this;e.grid.timeAxisSubGrid.collapsed||i.totalSize===0||(e.mode==="horizontal"?(e.refreshHeader(!0),e.width=i.totalSize,e.grid.refresh(),e.subGrid.refreshFakeScroll()):e.mode==="vertical"&&e.grid.refreshRows())}onTimelinePaint({firstPaint:i}){var e;const t=this;t.subGrid.insertRowsBefore&&i&&(t.updateHeaderAriaLabel(),t.subGridElement.classList.add("b-timeline-subgrid"),t.mode==="vertical"&&(t.refreshHeader(),(e=t.grid)==null||e.onHeightChange()))}onCellFocus(){this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel"))}refreshHeader(i){const e=this,{element:t}=e;t&&(e.mode==="horizontal"?(!i&&e.timeAxisViewModel.update(void 0,void 0,!0),e.timeAxisView.rendered?e.timeAxisView.refresh(!0):(t.querySelector(".b-grid-header-text").remove(),e.timeAxisView.render(t))):e.mode==="vertical"&&(e.resourceColumns.currentElement?e.resourceColumns.refresh():(t.innerHTML="",e.resourceColumns.render(t))))}defaultRenderer(i){var e;const{grid:t}=this;if(!t.isTimelineHistogramBase)return t.project.isInitialCommitPerformed||t.project.isDelayingCalculation||(e=t.eventStore)!=null&&e.lazyLoad?(t.currentOrientation.renderer(i),super.defaultRenderer(i)):""}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(i){const e=this;e.detachListeners("tavm"),i==null||i.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:e}),e._timeAxisViewModel=i,e.timeAxisView&&(e.timeAxisView.model=i)}getState(){const i=super.getState();return delete i.width,delete i.flex,i}};y(Cl,"$name","TimeAxisColumn"),y(Cl,"type","timeAxis"),y(Cl,"fields",[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]),Ve.registerColumnType(Cl),Cl._$name="TimeAxisColumn";var Gp=class extends cc{static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const i=this,{client:e}=i,t=e==null?void 0:e.stickyHeaders,r=[],n=i.levels.reduce((s,a,l)=>{var o;return a.cells&&s.push(...(o=a.cells)==null?void 0:o.filter(d=>d.start<i.endDate&&d.end>i.startDate).map((d,c,u)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[d.headerCellCls]:d.headerCellCls,[`b-align-${d.align}`]:d.align,"b-last":c===u.length-1,"b-lowest":l===i.levels.length-1},dataset:{tickIndex:d.index,cellId:`${l}-${d.index}`,headerPosition:l,...globalThis.DEBUG&&{date:d.start.getTime()}},style:{top:d.coord,height:d.width,minHeight:d.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":t},html:d.value}]}))),s},[]);return e==null||e.getHeaderDomConfigs(r),n.push(...r),{className:i.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:n}}get height(){return this.size}};y(Gp,"$name","VerticalTimeAxis"),Gp._$name="VerticalTimeAxis";var uc=class extends He{static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1,ariaLabel:null}}updateHeaderAriaLabel(){const{grid:i}=this,{visibleDateRange:e}=i,t=C.format(e==null?void 0:e.startDate,i.displayDateFormat),r=C.format(e==null?void 0:e.endDate,i.displayDateFormat);return super.updateHeaderAriaLabel(this.L(this.ariaLabel||"L{TimeAxisColumn.ariaLabel}")(t,r))}get isFocusable(){return!0}construct(i){const e=this;super.construct(...arguments),e.view=new Gp({model:e.grid.timeAxisViewModel,client:e.grid}),e.grid.ion({paint:"onTimelinePaint",thisObj:e,once:!0}),Le.ion({locale:e.updateHeaderAriaLabel,thisObj:e})}defaultRenderer({cellElement:i,size:e}){this.view.render(i),e.height=this.view.height}getCurrentConfig(i){const e=super.getCurrentConfig(i);return delete e.id,delete e.region,delete e.type,delete e.field,delete e.ariaLabel,delete e.cellAriaLabel,e}onTimelinePaint({firstPaint:i}){i&&this.updateHeaderAriaLabel()}};y(uc,"$name","VerticalTimeAxisColumn"),y(uc,"type","verticalTimeAxis"),Ve.registerColumnType(uc),uc._$name="VerticalTimeAxisColumn";var TA={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},k0=(i,e)=>i&&e?i.unit===e.unit&&i.magnitude===e.magnitude:i===e,F0=Object.freeze({}),Jh=class PE extends sr.mixin(Wp,x0,Hp,g0,f0,b0,C0,S0,v0,w0,Bp,zp,c0,E0){constructor(){super(...arguments),y(this,"timeCellSelector",".b-sch-timeaxis-cell"),y(this,"resourceTimeRangeSelector",".b-sch-resourcetimerange")}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:lc,liveRedrawWhileMovingSplitterThreshold:100,eventContainerSelector:".b-timeaxissubgrid",testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){super.afterConstruct(),this.ion({scroll:"onVerticalScroll",splitterDragStart:"internalOnSplitterDragStart",thisObj:this})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const r=this;return r.isVertical?r.currentOrientation.visibleResources:{first:r.store.getById((e=r.firstVisibleRow)==null?void 0:e.id),last:r.store.getById((t=r.lastVisibleRow)==null?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}changeCreateEventOnDblClick(e){re.deprecate("scheduler","7.0.0","createEventOnDblClick is deprecated use autoCreate instead"),this.autoCreate=e}changeAutoCreate(e){if(e){const t=typeof e;t!=="object"&&(e={gesture:t==="string"?e:"dblclick"}),e=Re.merge(e,PE.$meta.config.autoCreate),e.duration&&(e.duration=C.parseDuration(e.duration))}return e}updateAutoCreate(e,t){(e==null?void 0:e.gesture)!==(t==null?void 0:t.gesture)&&(this.detachListeners("scheduleAutoCreateGesture"),this.ion({name:"scheduleAutoCreateGesture",[`schedule${e.gesture}`]:"onScheduleAutoCreateGesture",thisObj:this})),t||this.updateLocalization()}async onScheduleAutoCreateGesture({domEvent:e,time:t,resourceRecord:r}){const n=this,s=n.autoCreate||F0,a=s.snapType||"floor",{step:l}=s,o=l?C[a](t,C.parseDuration(l)):n.timeAxis[`${a}Date`](t);if(await n.trigger("beforeAutoCreate",{domEvent:e,date:o,resourceRecord:r})!==!1)return n.createEvent(o,r,!0)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}internalOnSplitterDragStart(){this.isHorizontal&&this.foregroundCanvas.syncIdMap&&Object.keys(this.foregroundCanvas.syncIdMap).length>this.liveRedrawWhileMovingSplitterThreshold&&(this.suspendRefresh(),this.ion({splitterDragEnd:()=>this.resumeRefresh(!0,!1),once:!0}))}onEventCreated(e){}get isHorizontal(){return this.mode==="horizontal"}get isVertical(){return this.mode==="vertical"}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),e==="horizontal"?(t.horizontal=new Zh(t),t.isPainted&&t.horizontal.init()):e==="vertical"&&(t.vertical=new Up(t),t.sortFeatureStore="resourceStore",t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}afterRenderEvent(){}get hasEventEditor(){return!!this.eventEditingFeature}get eventEditingFeature(){const{eventEdit:e,taskEdit:t,simpleEventEdit:r}=this.features;return e!=null&&e.enabled?e:t!=null&&t.enabled?t:r!=null&&r.enabled?r:null}async createEvent(e,t){var r,n,s,a,l;const o=this,{enableEventAnimations:d,eventStore:c,assignmentStore:u,hasEventEditor:h}=o,g=o.autoCreate||F0,{newName:f,useEventModelDefaults:m}=g,p=(g==null?void 0:g.duration)||{magnitude:m&&(r=c.modelClass.defaultValues.duration)!=null?r:1,unit:m&&(n=c.modelClass.defaultValues.durationUnit)!=null?n:o.timeAxis.unit},v=[t],b=c.createRecord({startDate:e,endDate:C.add(e,p),duration:p.magnitude,durationUnit:p.unit,name:o.resolveCallback(f,o,!1)?o.callback(f,o,[o,e,t]):f});if(o.readOnly||t.isSpecialRow||t.readOnly||!o.isDateRangeAvailable(b.startDate,b.endDate,null,t))return;(s=o.eventEditingFeature)==null||s.captureStm(!0),b.isCreating=h,o.onEventCreated(b);const w=u==null?void 0:u.assignEventToResource(b,t);if(o.trigger("beforeEventAdd",{eventRecord:b,resourceRecords:v,assignmentRecords:w})===!1){u==null||u.remove(w),(a=o.eventEditingFeature)==null||a.freeStm(!1);return}o.enableEventAnimations=!1;const D=c.add(b);if(o.project.commitAsync().then(()=>o.enableEventAnimations=d),!D){u==null||u.remove(w),(l=o.eventEditingFeature)==null||l.freeStm(!1);return}o.isCreating=!0,o.refreshRows(),o.isCreating=!1,await o.scrollEventIntoView(b),!o.isDestroyed&&(o.trigger("eventAutoCreated",{eventRecord:b,resourceRecord:t}),h&&o.editEvent(b,t,o.getEventElement(b)))}isDateRangeAvailable(e,t,r,n){return this.eventStore.isDateRangeAvailable({startDate:e,endDate:t,excludeEvent:r,resourceRecord:n,allowOverlap:this.allowOverlap})}async resumeRefresh(e=!0,t=!0){super.resumeRefresh(!1);const r=this;if(!r.refreshSuspended&&e){if(!r.isEngineReady)return r.currentOrientation.refreshAllWhenReady=!0,r.project.commitAsync();r.isDestroyed||(t?r.refreshWithTransition():r.refresh())}}refreshResource(e){this.refreshResources([e])}refreshResources(e){this.currentOrientation.refreshResources(e)}toggleEmptyText(){var e;E.toggleClasses(this.element,"b-grid-empty",!(this.resourceStore.count>0||(e=this.crudManager)!=null&&e.isLoading))}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){const{store:r}=this;for(const n of e)n&&r.isAvailable(n)&&this.getRowHeight(n);t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:r}=this,n=Math.min(t.count,this.preCalculateHeightLimit);if(n){r.clearKnownHeights();for(let s=0;s<n;s++){const a=t.records[s];a&&this.getRowHeight(a)}e||r.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return e.range.unit==="week"&&t.push(e.lastDate),t}get description(){const e=this,{startDate:t,endDate:r}=e;if(!e.resolveCallback("descriptionRenderer",e,!1)&&e.range.unit==="day"&&r-t&&!C.isStartOf(t,"d")&&!C.isStartOf(r,"d")){const s=C.getMonthName(t.getMonth()),a=C.getMonthName(r.getMonth()),l=s!==a?`${a} `:"";return`${s} ${t.getDate()} - ${l}${r.getDate()}, ${r.getFullYear()}`}return super.description}get defaultDescriptionFormat(){return TA[this.range.unit]}get lastDate(){const{endDate:e}=this;if(e)return C.isStartOf(e,"d")?C.add(e,-1,"day"):e}getEventRecord(e){return e=E.getEventElement(e),this.resolveEventRecord(e)}getResourceRecord(e){return this.resolveResourceRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeListRangeMenu(e){if(e)return sr.mergeConfigs({view:this},e)}changeRange(e){if(e){if(typeof e=="string"){const t=C.parseTimeUnit(e);t?e={magnitude:1,unit:t}:e=C.parseDuration(e)}else if(typeof e=="number")return{magnitude:e,unit:"day"}}return e}updateRange(e){if(!this.isConfiguring){const t=this.date,r=this.date=C.clamp(t,C.floor(t,e),C.ceil(t,e));t.getTime()===r.getTime()&&this.updateDate(r,t,!0)}}changeShiftIncrement(e){return this.changeRange(e)}updateShiftIncrement(e,t){this.trigger("shiftIncrementChange",{old:e,new:t})}get shiftIncrement(){return this._shiftIncrement||this.range}get stepUnit(){const{shiftIncrement:e}=this;return e.magnitude===1?C.getLocalizedNameOfUnit(e.unit):`${e.magnitude} ${C.getLocalizedNameOfUnit(e.unit,!0)}`}set stepUnit(e){re.deprecate("scheduler","7.0.0","changeStepUnit is deprectaed use shiftIncrement instead"),this.shiftIncrement=e}async updateDate(e,t,r){var n;const s=this,{timeAxis:a,vertical:l,range:o,workingTime:d}=s,c=C.clearTime(((n=s.visibleDateRange)==null?void 0:n.startDate)||e),u=r?c:e,{startDate:h}=a,g=C.floor(h,o),f=C.add(g,o),m=s.isShifting?s.shiftIncrement:s.range,p=C.floor(h,m,h),v=C.add(p,o),b={[l?"x":"y"]:!1,animate:!0,block:e<p?"start":e>=v?"end":"nearest"},w=s.timeAxisColumn.width;if(r||!C.betweenLesser(e,g,f)){const D=C.floor(e,o),S=C.add(D,o);d&&(D.setHours(d.fromHour),S.setHours(d.toHour-24)),Object.assign(b,{animate:!1,block:"start",edgeOffset:r?{start:s.getCoordinateFromDate(c)-s.timelineScroller.position}:0}),s.setTimeSpan(D,S),s.timeAxisColumn.width<w&&await Qe.sleep(0)}if(s._date=C.clamp(e,a.startDate,a.endDate),!s.preventScroll)if(s.isConfiguring)s.visibleDate={date:s._date,block:"start",animate:s.isPainted};else{const D=s.getCoordinateFromDate(u,!1),S=s.getCoordinateFromDate(C.min(C.add(u,1,"d"),a.endDate),!1),x=Math.abs((S===-1?s.timelineScroller.scrollSize:S)-D),R=l?new L(0,D,1,x):new L(s.rtl?S:D,0,Math.abs(x),1);s.timelineScroller.scrollIntoView(R,b)}s.trigger("descriptionChange")}updateScrollBuffer(e){this.isConfiguring||(this.currentOrientation.scrollBuffer=e)}previous(){this.move(-1)}next(){this.move(1)}move(e=1){e=Math.sign(e);const t=this,{shiftIncrement:r}=t;r&&(t.isShifting=!0,t.date=C.add(t.date,{unit:r.unit,magnitude:e*r.magnitude}),t.isShifting=!1)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:r,element:n}){const s=this;if(s.eventStore.includes(t)||([t]=s.eventStore.add(t)),t.beginBatch(),t.startDate=e,t.assign(r),t.endBatch(),n){const a=L.from(n,s.foregroundCanvas);E.setTranslateXY(n,0,0),E.setTopLeft(n,a.y,a.x),oe.addChild(s.foregroundCanvas,n,t.assignments[0].id)}return await s.project.commitAsync(),t}internalGetAssignmentsToHighlight(e){const{eventStore:t,assignmentStore:r,resourceStore:n}=this,{usesSingleAssignment:s}=t;return B.asArray(e).reduce((a,l)=>(l=(s&&!l.isModel||l.isEvent?t:r).getById(l),l!=null&&l.isEvent?a.push(...l.assignments.filter(d=>d.resource.stores.includes(n))):l!=null&&l.isAssignment&&l.resource.stores.includes(n)&&a.push(l),a),[])}};y(Jh,"$name","SchedulerBase"),y(Jh,"type","schedulerbase"),y(Jh,"configurable",{localizableProperties:["autoCreate.newName"],date:{value:null,$config:{equal:"date"}},listRangeMenu:{$config:"lazy",value:{type:"rangemenu"}},shiftIncrement:{$config:{lazy:!0,equal:k0},value:null},range:{$config:{equal:k0},value:"week"},getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}"},scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",showEventColorPickers:null,updateTimelineContextOnScroll:!0});var wl=Jh;wl.initClass(),wl._$name="SchedulerBase";var Sl=class extends Hn{updateRecord(i){i&&(re.deprecate("scheduler","7.0.0","record config is deprecated in favor of records"),this.records=[i])}colorSelected({color:i}){this.records&&this.records.forEach(e=>e.eventColor=i)}};y(Sl,"$name","EventColorPicker"),y(Sl,"type","eventcolorpicker"),y(Sl,"configurable",{colorClasses:wl.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null,records:null}),Sl.initClass(),Sl._$name="EventColorPicker";var Dl=class extends Vn{};y(Dl,"$name","EventColorField"),y(Dl,"type","eventcolorfield"),y(Dl,"configurable",{picker:{type:"eventcolorpicker"},name:"eventColor"}),Dl.initClass(),Dl._$name="EventColorField";var El=class extends zr{};y(El,"$name","EventColorColumn"),y(El,"type","eventcolor"),y(El,"defaults",{editor:"eventcolorfield",field:"eventColor"}),Ve.registerColumnType(El),El._$name="EventColorColumn";var xl=class extends He{static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:i,column:e})=>({tag:"button","aria-label":e.L("L{ResourceCollapseColumn.toggleResourceLayout}"),class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":i.eventLayout!=="none"}})}}onCellClick({record:i,event:e}){!i.isSpecialRow&&e.target.classList.contains("b-icon")&&(e.preventDefault(),i.eventLayout=i.eventLayout!=="none"?"none":"stack")}};y(xl,"$name","ResourceCollapseColumn"),y(xl,"type","resourceCollapse"),y(xl,"fields",[{name:"ariaLabel",defaultValue:"L{ResourceCollapseColumn.toggleResourceLayout}"}]),Ve.registerColumnType(xl),xl._$name="ResourceCollapseColumn";var hc=class extends He{static get fields(){return["showEventCount","showRole","showMeta","showImage","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",width:140,cellCls:"b-resourceinfo-cell",editor:re.isTestEnv?!1:"text"}}construct(...i){super.construct(...i),this.avatarRendering=new La({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(i){const e=this.grid.resourceImagePath||"",t=e.split("//"),r=t.length>1?t[1]:e,n=O.joinPaths([r||"",i||""]);return t.length>1?t[0]+"//"+n:n}template(i,e){const t=this,{showImage:r,showRole:n,showMeta:s,showEventCount:a,grid:l}=t,{timeAxis:o,resourceImageExtension:d="",defaultResourceImageName:c}=l,u=typeof n=="string"?n:"role",h=a&&i.eventStore.getEvents({includeOccurrences:l.enableRecurringEvents,resourceRecord:i,startDate:o.startDate,endDate:o.endDate}).length,g=i.showAvatar!==!1;let f;if(g&&r&&i.image!==!1)if(i.imageUrl)f=i.imageUrl;else{const m=typeof r=="string"?r:i.image||e&&t.useNameAsImageName&&e.toLowerCase()+d||c||"";f=m&&t.getImageURL(m),f&&!m.includes(".")&&(f+=d)}return{class:{"b-resource-info":1,"b-no-avatar":!g},children:[r&&g&&t.avatarRendering.getResourceAvatar({resourceRecord:i,initials:i.initials,color:i.eventColor,iconCls:i.iconCls,imageUrl:f,defaultImageUrl:c&&this.getImageURL(c)}),n||a||s?{tag:"dl",children:[{tag:"dt",text:e},n?{tag:"dd",class:"b-resource-role",text:i.getValue(u)}:null,a?{tag:"dd",class:"b-resource-events",text:t.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:t.showMeta(i)}:null]}:e]}}defaultRenderer({grid:i,record:e,cellElement:t,value:r,isExport:n}){let s;return e.isSpecialRow?s="":n?s=r:(this.autoScaleThreshold&&i.rowHeight<this.autoScaleThreshold?t.style.fontSize=i.rowHeight/40+"em":t.style.fontSize="",s=this.template(e,r)),s}};y(hc,"$name","ResourceInfoColumn"),y(hc,"type","resourceInfo"),Ve.registerColumnType(hc),hc._$name="ResourceInfoColumn";var rn=class extends He{onDestroy(){this.scaleWidget.destroy()}set width(i){super.width=i,this.scaleWidget.width=i}get width(){return super.width}applyValue(i,e,t){return e==="scalePoints"&&(this.scaleWidget[e]=t),super.applyValue(...arguments)}buildScaleWidget(){const i=this,e=new Ia({owner:i.grid,appendTo:i.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:i.scalePoints,monitorResize:!1});return Object.defineProperties(e,{width:{get(){return i.width},set(t){this.element.style.width=`${t}px`,this._width=i.width}},height:{get(){return this._height},set(t){this.element.style.height=`${t}px`,this._height=t}}}),e.width=i.width,e}get scaleWidget(){const i=this;return i._scaleWidget||(i._scaleWidget=i.buildScaleWidget()),i._scaleWidget}defaultRenderer({cellElement:i,value:e,scaleWidgetConfig:t,scaleWidget:r=this.scaleWidget}){T.assign(r,{scalePoints:e||this.scalePoints,height:this.grid.rowHeight},t),r.refresh();const n=r.element.cloneNode(!0);n.removeAttribute("id"),n.classList.remove("b-hide-offscreen"),i.innerHTML="",i.appendChild(n)}};y(rn,"$name","ScaleColumn"),y(rn,"type","scale"),y(rn,"isScaleColumn",!0),y(rn,"fields",["scalePoints"]),y(rn,"defaults",{text:"\xA0",width:40,minWidth:40,field:"scalePoints",cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:null}),Ve.registerColumnType(rn),rn._$name="ScaleColumn";var gc=class extends xt{constructor(){super(...arguments),y(this,"isTickCell",!0)}get indexKey(){return`${this.startDate.getTime()}-${this.resourceId}`}async setValue(i){this.value=i}};y(gc,"$name","ResourceTickModel"),y(gc,"fields",["resourceId","value"]),gc._$name="ResourceTickModel";var Rl=class extends Dt{get $lazyLoadPluginClass(){return this.isPaged?Qr:$i}};y(Rl,"$name","ResourceTickStore"),y(Rl,"defaultConfig",{loadPriority:500,syncPriority:500,modelClass:gc,id:"resourceTicks"}),Rl._$name="ResourceTickStore";var fc=class extends Nt(){static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter((i,e)=>!C.nonWorkingDays[e]).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter((i,e)=>C.nonWorkingDays[e]).join(",")}static getLegend(i,e){const t=this,{timeSpan:r,interval:n,days:s,monthDays:a,months:l,positions:o}=i,d=e||r.startDate,c={interval:n};let u;switch(i.frequency){case"DAILY":return n===1?t.L("L{Daily}"):t.L("L{Every {0} days}",c);case"WEEKLY":return s&&s.length?c.days=t.getDaysLegend(s):d&&(c.days=C.getDayName(d.getDay())),t.L(n===1?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",c);case"MONTHLY":return s&&s.length&&o&&o.length?c.days=t.getDaysLegend(s,o):a&&a.length?(a.sort((h,g)=>h-g),c.days=t.arrayToText(a)):d&&(c.days=d.getDate()),t.L(n===1?"L{Monthly on {1}}":"L{Every {0} months on {1}}",c);case"YEARLY":return s&&s.length&&o&&o.length?c.days=t.getDaysLegend(s,o):c.days=d.getDate(),l&&l.length?(l.sort((h,g)=>h-g),l.length>2?u=h=>C.getMonthShortName(h-1):u=h=>C.getMonthName(h-1),c.months=t.arrayToText(l,u)):c.months=C.getMonthName(d.getMonth()),t.L(n===1?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",c)}}static getDaysLegend(i,e){const t=this,r={position:""};let n;if(e&&e.length&&(r.position=t.arrayToText(e,s=>t.L(`L{position${s}}`))),i.length)switch(i.sort((s,a)=>nt.decodeDay(s)[0]-nt.decodeDay(a)[0]),i.join(",")){case t.allDaysValue:r.days=t.L("L{day}");break;case t.workingDaysValue:r.days=t.L("L{weekday}");break;case t.nonWorkingDaysValue:r.days=t.L("L{weekend day}");break;default:i.length>2?n=s=>C.getDayShortName(nt.decodeDay(s)[0]):n=s=>C.getDayName(nt.decodeDay(s)[0]),r.days=t.arrayToText(i,n)}return t.L("L{daysFormat}",r)}static arrayToText(i,e){return e&&(i=i.map(e)),i.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}};y(fc,"$name","RecurrenceLegend"),fc._$name="RecurrenceLegend";var ur=class extends ${static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(i){return`<div class="b-sch-clockwrap b-sch-clock-${i.mode||this.mode} ${i.cls||""}">
                    <div class="b-sch-clock">
                        <div class="b-sch-hour-indicator">${i.date?C.format(i.date,"MMM"):""}</div>
                        <div class="b-sch-minute-indicator">${i.date?C.format(i.date,"D"):""}</div>
                        <div class="b-sch-clock-dot"></div>
                    </div>
                    <span class="b-sch-clock-text">${O.encodeHtml(i.text||"")}</span>
                </div>`}}}generateContent(i){return this.div.innerHTML=this.template(i)}updateDateIndicator(i,e){const t=i==null?void 0:i.querySelector(".b-sch-hour-indicator"),r=i==null?void 0:i.querySelector(".b-sch-minute-indicator");e&&t&&r&&Y.isBrowserEnv&&(this.mode==="hour"?(t.style.transform=`rotate(${e.getHours()%12*30}deg)`,r.style.transform=`rotate(${e.getMinutes()*6}deg)`):(t.style.transform="none",r.style.transform="none"))}set mode(i){this._mode=i}get mode(){if(this._mode)return this._mode;const i=C.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,e=C.formatContainsHourInfo(this.scheduler.displayDateFormat);return i&&e?"hour":"day"}set template(i){this._template=i}get template(){return this._template}};ur._$name="ClockTemplate";var Yp=class extends ie{static get defaultConfig(){return{tooltipTemplate:i=>`
                <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                    ${i.startClockHtml}
                    ${i.endClockHtml}
                    <div class="b-sch-tip-message">${i.message}</div>
                </div>
            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip",allowNonWorkingTimeSNET:null}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0,capitalizedEventName:null,eventName:null}}static get pluginConfig(){return{chain:["onInternalPaint"]}}afterConstruct(...i){const e=this,{client:t}=this;e.capitalizedEventName=e.capitalizedEventName||t.capitalizedEventName,e.eventName=e.eventName||t.scheduledEventName,super.afterConstruct(...i)}internalSnapToPosition(i){var e;const{dragData:t}=this;(e=this.snapToPosition)==null||e.call(this,{assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.newResource||t.resourceRecord,startDate:t.startDate,endDate:t.endDate,snapTo:i})}buildDragHelperConfig(){const i=this,{client:e,constrainDragToTimeline:t,constrainDragToResource:r,constrainDragToTimeSlot:n,dragHelperConfig:s={}}=i,{timeAxisViewModel:a,isHorizontal:l}=e,o=l?r:n,d=l?n:r;return i.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${i.externalDropTargetSelector}`),Z.merge({name:i.constructor.name,positioning:"inset",rtlSource:e,lockX:d,lockY:o,minX:!0,maxX:!0,constrain:!1,cloneTarget:!t,removeProxyAfterDrop:!1,dragWithin:t?null:e.floatRoot,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",allowDropOutside:!t,dropTargetCls:i.externalDropTargetSelector?"b-drop-target":"",outerElement:e.timeAxisSubGridElement,targetSelector:e.eventSelector,scrollManager:t?e.scrollManager:null,createProxy:c=>i.createProxy(c),snapCoordinates:({element:c,newX:u,newY:h})=>{var g,f,m,p,v;const{dragData:b}=i;if(e&&i.constrainDragToTimeline&&!i.constrainDragToTimeSlot&&(i.showExactDropPosition||a.snap)){const{timeAxis:D}=e,S=(g=b.record.event)!=null?g:b.record,{calendar:x}=S,{startDate:R}=b,M=i.getCoordinate(S,c,[u,h]);let _;if(e.fillTicks&&D.isContinuous?_=e.snap?D.roundDate(R):R:(_=a.getDateFromPosition(M,"round"),(e.snapRelativeToEventStartDate||e.snap&&e.fillTicks)&&(_=D.roundDate(_,R))),!x||_&&x.isWorkingTime(_,C.add(_,S.fullDuration))){const k=_&&a.getPositionFromDate(_);_&&_>=e.startDate&&k!=null&&(l?u=k:h=k)}if(e.snap&&i.snapToResource&&!r){let k;if(l){const H=(f=e.rowManager.getRowAt(b.context.clientY))==null?void 0:f.id;k=e.resourceStore.getById(H)}else{const H=b.context.clientX-e.timeAxisSubGrid.rectangle().x,{first:G,last:q}=e.visibleResources;k=e.vertical.allResourceRecords.filter(W=>W.id>=G.id&&W.id<=q.id).find(W=>W.instanceMeta(e).insetStart<=H&&W.instanceMeta(e).insetEnd>H)}const F=k||b.newResource||b.resourceRecord,{start:I}=e.getResourceMarginObject(F),A=l?(m=e.getRowFor(F))==null?void 0:m.height:e.getResourceWidth(F),P=l?(p=e.getRowFor(F))==null?void 0:p.top:(v=F.instanceMeta(e))==null?void 0:v.insetStart;if(A!==void 0&&P!==void 0){let H=P+I,G=i.snapToResource.threshold?Math.min(A,i.snapToResource.threshold):A/4+I,q=Math.abs(l?h-P:u-P);F.id===b.resourceRecord.id&&(H=l?b.context.elementStartY:b.context.elementStartX,q=Math.abs(l?h-H:u-H)),q<=G&&(l?h=H:u=H)}}}const w={x:u,y:h};return i.internalSnapToPosition(w),w},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:i}},s,{isElementDraggable:(c,u)=>(!s||!s.isElementDraggable||s.isElementDraggable(c,u))&&i.isElementDraggable(c,u)})}onInternalPaint({firstPaint:i}){var e;const t=this,{client:r}=t;(e=t.drag)==null||e.destroy(),t.drag=si.new(t.buildDragHelperConfig()),i&&r.rowManager.ion({changeTotalHeight:()=>{var n;return t.updateYConstraint((n=t.dragData)==null?void 0:n[`${r.scheduledEventName}Record`])},thisObj:t}),t.showTooltip&&(t.clockTemplate=new ur({scheduler:r}))}doDestroy(){var i,e,t;(i=this.drag)==null||i.destroy(),(e=this.clockTemplate)==null||e.destroy(),(t=this.tip)==null||t.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(i,e){const t=this;if(i){const r=ve.reconfigure(e,ve.mergeConfigs({forElement:t.element,id:t.tipId,getHtml:t.getTipHtml.bind(t),cls:t.tooltipCls,owner:t.client},i),{owner:t.client,defaults:{type:"tooltip"}});return r.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:t}),r}else e==null||e.destroy()}createProxy(i){const e=i.cloneNode(!0);return delete e.id,e.classList.add(`b-sch-${this.client.mode}`),e}onBeforeDragStart({context:i,event:e}){var t;const r=this,{client:n}=r,s=r.getMinimalDragData(i,e),a=s==null?void 0:s[`${n.scheduledEventName}Record`],l=s.resourceRecord,o=r.constrainDragToResource&&r.constrainDragToTimeSlot;if(n.readOnly||r.disabled||!a||a.isDraggable===!1||a.readOnly||l!=null&&l.readOnly||o)return!1;i.pointerStartDate=n.getDateFromCoord({coord:n.isVertical?i.startPageY:i.startPageX,local:!1});const d=r.triggerBeforeEventDrag(`before${r.capitalizedEventName}Drag`,{...s,event:e,context:{...i,...s}})!==!1;return d&&(r.updateYConstraint(a,l),(t=n[`before${r.capitalizedEventName}DragStart`])==null||t.call(n,i,s)),d}onAfterDragStart({context:i,event:e}){}get isDragging(){var i;return(i=this.drag)==null?void 0:i.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:i,event:e}){var t,r,n;const s=this,a=(t=s.findClientFromTarget(e,i))!=null?t:s.client;s.currentOverClient=a,s.drag.unifiedProxy=s.unifiedDrag,s.onMouseOverNewTimeline(a,!0);const l=s.dragData=s.getDragData(i);if(s.suspendElementRedrawing(i.element),s.showTooltip&&s.tip){const u=l.context.dragProxy?l.context.dragProxy.firstChild:i.element;s.tip.showBy(u)}s.triggerDragStart(l),(r=a[`after${s.capitalizedEventName}DragStart`])==null||r.call(a,i,l);const{eventMenu:o,taskMenu:d}=a.features,c=o||d;(n=c==null?void 0:c.hideContextMenu)==null||n.call(c,!1)}updateDateIndicator(){const{startDate:i,endDate:e}=this.dragData,{tip:t,clockTemplate:r}=this,n=t.element.querySelector(".b-sch-tooltip-enddate");r.updateDateIndicator(t.element,i),n&&r.updateDateIndicator(n,e)}findClientFromTarget(i,e){let{target:t}=i;if(/^touch/.test(i.type)){const n=L.from(e.element,null,!0).center;t=E.elementFromPoint(n.x,n.y)}const r=z.fromElement(t,"timelinebase");return r!=null&&r.isResourceHistogram?null:r}onDrag({context:i,event:e}){const t=this,r=t.dragData,n=r.startDate;let s;if(t.constrainDragToTimeline?s=t.client:s=t.findClientFromTarget(e,r.context),t.updateDragContext(i,e),!!s){if(s!==t.currentOverClient&&t.onMouseOverNewTimeline(s),r.dirty||!t.throttleDragEvent){const a=r.valid;t.triggerEventDrag(r,n),a!==r.valid&&(r.context.valid=r.externalDragValidity=r.valid)}t.showTooltip&&t.tip&&(t.tip.lastAlignSpec.allowTargetOut=!r.valid,t.tip.realign())}}onMouseOverNewTimeline(i,e){const t=this,{drag:{lockX:r,lockY:n}}=t,s=[];t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),i.element.classList.add("b-dragging-"+i.scheduledEventName),e||t.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:i.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n||s.push({element:i.scrollable.element,direction:"vertical"}),i.scrollManager.startMonitoring({scrollables:s,callback:t.drag.onScrollManagerScrollCallback}),t.currentOverClient=i}triggerBeforeEventDropFinalize(i,e,t){t.trigger(i,e)}onDrop({context:i,event:e}){var t;const r=this,{currentOverClient:n,dragData:s}=r;let a=!1;if(n==null||n.scrollManager.stopMonitoring(),(t=r.tip)==null||t.hide(),i.valid=i.valid&&r.isValidDrop(s),r.drag.removeProxyAfterDrop=!!s.externalDropTarget,i.valid&&s.startDate&&s.endDate){let l=!1;s.finalize=async o=>{l||s.async?await r.finalize(o):i.valid=i.valid&&o},r.triggerBeforeEventDropFinalize(`before${r.capitalizedEventName}DropFinalize`,{context:s,domEvent:e},n),l=!0,i.async=s.async,!i.async&&!s.externalDropTarget&&(a=s.startDate-s.origStart!==0||s.newResource!==s.resourceRecord)}i.async||r.finalize(s.valid&&i.valid&&a)}onDragAbort({context:i}){var e,t;const r=this;r.isAborting=!0,(e=r.currentOverClient)==null||e.scrollManager.stopMonitoring(),r.client.currentOrientation.onDragAbort({context:i,dragData:r.dragData}),r.resetDraggedElements(),(t=r.tip)==null||t.hide(),r.triggerDragAbort(r.dragData)}onDragAbortFinalized({context:i}){var e,t;const r=this;r.triggerDragAbortFinalized(r.dragData),(t=(e=r.client)[`after${r.capitalizedEventName}DragAbortFinalized`])==null||t.call(e,i,r.dragData),r.isAborting=!1}onDragReset({source:i}){var e;const t=this,r=t.currentOverClient;(e=i.context)!=null&&e.started&&(t.resetDraggedElements(),r.trigger(`${t.eventName}DragReset`)),r==null||r.element.classList.remove(`b-dragging-${r.scheduledEventName}`),t.dragData=null}resetDraggedElements(){const{dragData:i}=this,{eventBarEls:e,draggedEntities:t}=i;this.resumeRecordElementRedrawing(i.record),t.forEach((r,n)=>{this.resumeRecordElementRedrawing(r),e[n]&&(e[n].classList.remove(this.drag.draggingCls),e[n].retainElement=!1)}),i.context.element.retainElement=!1}onInternalInvalidDrop(i){var e;const t=this,{context:r}=t.drag;(e=t.tip)==null||e.hide(),t.triggerAfterDrop(t.dragData,!1),r.valid=!1,i&&t.drag.abort()}async finalize(i){const e=this,{dragData:t,currentOverClient:r}=e,{eventBarEls:n}=t,s=r.features.taskTooltip||r.features.eventTooltip;if(!t||e.finalizing)return;const{context:a,draggedEntities:l,externalDropTarget:o}=t;let d;return e.finalizing=!0,l.forEach((c,u)=>{e.resumeRecordElementRedrawing(c),n[u]&&(n[u].classList.remove(e.drag.draggingCls),n[u].retainElement=!1)}),a.element.retainElement=!1,o&&t.valid||i?(d=e.updateRecords(t),!o&&Z.isPromise(d)&&(a.async=!0,await d),t.valid?(a.async&&a.finalize(),o&&e.client.refreshRows(null,!1),e.triggerAfterDrop(t,!0)):e.onInternalInvalidDrop(!0)):e.onInternalInvalidDrop(a.async||t.async),e.finalizing=!1,s!=null&&s.enabled&&(s.disabled=!0,r.setTimeout(()=>{s.disabled=!1},200)),d}getEventStartEndDatesFromGraph(i,e,t){let r;const{newResource:n,resourceRecord:s,assignmentRecords:a}=this.dragData,l=t.project,o=l.graph,d=l!==i.project,c=o.branch({autoCommit:!1,onComputationCycle:"throw",project:l});if(d){i=i.copy(),i.parentEvent=l.eventStore.rootNode,i.project=l,c.addEntity(i);for(const u of a)c.addEntity(u.copy({eventId:i.id,event:i,resourceId:n.id,resource:n}))}else if(n&&n!==s)for(const u of a)c.write(u.$.resource,n);c.write(i.$.startDate,e);try{e=c.read(i.$.startDate),r=c.read(i.$.endDate)}catch(u){return!1}finally{c.clearBranch()}return{startDate:e,endDate:r}}getEventNewStartEndDates(i,e,t){let r=this.adjustStartDate(i.startDate,e),n;if(i.graph&&!this.allowNonWorkingTimeSNET&&(!i.manuallyScheduled||i.project.skipNonWorkingTimeWhenSchedulingManually))try{({startDate:r,endDate:n}=this.getEventStartEndDatesFromGraph(i,r,t))}catch(s){return{valid:!1}}else n=C.add(r,i.fullDuration);return{startDate:r,endDate:n}}updateDragContext(i,e){var t,r,n;const s=this,{drag:a}=s,l=s.dragData,o=s.currentOverClient,{isHorizontal:d,timeAxis:c}=o,{record:u}=l,h=u.isAssignment?u.event:u,g=l.startDate,f=s.constrainDragToTimeSlot||(d?a.lockX:a.lockY);if(l.browserEvent=e,Object.assign(l,s.getProductDragContext(l)),f)l.timeDiff=0;else{let p;if(c.isContinuous||l.startsOutsideView&&l.endsOutsideView){const v=o.isHorizontal?(t=i.pageX)!=null?t:i.startPageX:(r=i.pageY)!=null?r:i.startPageY,b=o.getDateFromCoordinate(v,null,!1,!0);p=l.timeDiff=b-i.pointerStartDate,p!==null&&(Object.assign(l,s.getEventNewStartEndDates(h,p,o)),l.valid&&(l.timeDiff=l.startDate-l.origStart))}else{const v=s.resolveStartEndDates(i.element);l.valid=!!(v.startDate&&v.endDate),l.valid&&(p=v.startDate-l.origStart),p!==void 0&&(h.graph&&!s.allowNonWorkingTimeSNET?Object.assign(l,s.getEventStartEndDatesFromGraph(h,v.startDate,o)):(l.startDate=v.startDate,l.endDate=v.endDate)),l.timeDiff=p}}const m=l.dirty=l.dirty||g-l.startDate!==0;if(l.valid)if(s.constrainDragToTimeline&&(l.endDate<=c.startDate||l.startDate>=c.endDate))l.valid=!1,l.context.message=s.L("L{EventDrag.noDropOutsideTimeline}");else if(m||l.externalDropTarget){const p=l.externalDragValidity=!e||i.pageX&&s.checkDragValidity(l,e);!p||typeof p=="boolean"?(l.valid=p!==!1,l.context.message=""):(l.valid=p.valid!==!1,l.context.message=p.message)}else l.valid=l.externalDragValidity!==!1&&((n=l.externalDragValidity)==null?void 0:n.valid)!==!1;else l.valid=!1;l.context.valid=l.valid}suspendRecordElementRedrawing(i,e=!0){this.suspendElementRedrawing(this.getRecordElement(i),e),i.instanceMeta(this.client).retainElement=e}resumeRecordElementRedrawing(i){this.suspendRecordElementRedrawing(i,!1)}suspendElementRedrawing(i,e=!0){i&&(i.retainElement=e)}resumeElementRedrawing(i){this.suspendElementRedrawing(i,!1)}getDragData(i){const e=this,{client:t,drag:r}=e,n=e.setupProductDragData(i),{record:s,eventBarEls:a,draggedEntities:l}=n,{startEvent:o}=r,d=s.isAssignment?s.event:s,c=d.startDate,u=d.endDate,h=t.timeAxis,g=c<h.startDate,f=u>h.endDate,m=t.isSchedulerBase?t.multiEventSelect:t.selectionMode.multiSelect,p=e.getCoordinate(d,i.element,[i.elementStartX,i.elementStartY]),v=e.getCoordinate(d,i.element,[i.startClientX,i.startClientY]);e.suspendRecordElementRedrawing(s),l.forEach(w=>e.suspendRecordElementRedrawing(w)),t.selectionMode.checkboxOnly||(s.isAssignment?t.selectAssignment(s,o.ctrlKey&&m):t.selectEvent(s,o.ctrlKey&&m));const b={context:i,...n,sourceDate:g?c:t.getDateFromCoordinate(p),screenSourceDate:t.getDateFromCoordinate(v,null,!1),startDate:c,endDate:u,timeDiff:0,origStart:c,origEnd:u,startsOutsideView:g,endsOutsideView:f,duration:u-c,browserEvent:o};return a.length>1&&(i.relatedElements=a.filter(w=>w&&w!==r.context.grabbed)),a.forEach(w=>w==null?void 0:w.classList.remove("b-sch-event-hover","b-active")),b}setupConstraints(i,e,t,r,n){const s=this,a=!s.showExactDropPosition&&t>1?t:0,l=0;r?s.setXConstraint(i.left,i.right-e.width,a):s.setXConstraint(!0,!0,a),n?s.setYConstraint(i.top,i.bottom-e.height,l):s.setYConstraint(0,!0,l)}updateYConstraint(i,e){const t=this,{client:r}=t,{context:n}=t.drag,s=r.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let a;if(t.constrainDragToTimeline)a=r.getScheduleRegion(e,i);else{t.setYConstraint(null,null,s);return}t.setYConstraint(a.top,a.bottom-n.element.offsetHeight,s)}else t.setYConstraint(null,null,s)}setXConstraint(i,e,t){const{drag:r}=this;r.minX=i,r.maxX=e}setYConstraint(i,e,t){const{drag:r}=this;r.minY=i,r.maxY=e}adjustStartDate(i,e){const{currentOverClient:t}=this,r=t.timeAxis.roundDate(new Date(i-0+e),t.snapRelativeToEventStartDate||t.snap&&t.fillTicks?i:!1);return t.fillTicks&&(t.timeAxis.mainUnit==="day"||C.compareUnits(t.timeResolution.unit,"d")===0)&&C.copyTimeValues(r,this.dragData.origStart),this.constrainStartDate(r)}normalizeDraggedElement(i){return E.down(i,this.currentOverClient.eventInnerSelector)}resolveStartEndDates(i){const e=this.currentOverClient,{timeAxis:t}=e,r=this.normalizeDraggedElement(i),n=L.from(r,e.timeAxisSubGridElement),s=this.dragData,[a]=s.draggedEntities,l=a.isAssignment?a.event:a,o=e.fillTicks&&e.snapRelativeToEventStartDate,d=l.endDate-l.startDate;let{start:c,end:u}=e.getStartEndDatesFromRectangle(n,o?null:"round",d,!0);if(c&&u){if(o){const h=l.startDate-C.startOf(l.startDate,t.unit),g=u-c,f=h/g*n.width;n.deflate(e.isVertical?f:0,0,0,e.isHorizontal?f:0);const m=n.getStart(e.rtl,!e.isVertical);c=e.getDateFromCoordinate(m,null,!0),c=t.roundDate(c,l.startDate)}if(c=this.adjustStartDate(c,0),s.startsOutsideView)s.endsOutsideView||(c=u&&C.add(u,-d));else{if(!t.dateInAxis(c,!1)){const h=t.getTickFromDate(c);h>=0&&(c=t.getDateFromTick(h))}u=c&&C.add(c,d)}}return{startDate:c,endDate:u}}getTipHtml(){const i=this,{dragData:e,client:t,tooltipTemplate:r}=i,{startDate:n,endDate:s,draggedEntities:a,newResource:l}=e,o=t.getFormattedDate(n),d=s&&t.getFormattedEndDate(s,n)||"",{valid:c,message:u,element:h,dragProxy:g}=e.context,f=g?g.firstChild:h,m=a[0],p=m.isTask?m:m.event;return i.tip.lastAlignSpec.target=f,r({valid:c,startDate:n,endDate:s,startText:o,endText:d,dragData:e,newResource:l||e.resourceRecord,message:u||"",[t.scheduledEventName+"Record"]:p,startClockHtml:i.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:p.isMilestone?"":i.clockTemplate.template({date:s,text:d,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(i){if(this.drag){const e=this.client.isHorizontal?"lockX":"lockY";this.drag[e]=i}}updateConstrainDragToResource(i){const e=this;if(e.drag){const{constrainDragToTimeSlot:t}=e,{isHorizontal:r}=e.client;i&&(e.constrainDragToTimeline=!0),e.drag.lockY=r?i:t,e.drag.lockX=r?t:i}}updateConstrainDragToTimeline(i){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!i,allowDropOutside:!i,dragWithin:i?null:this.client.floatRoot,scrollManager:i?this.client.scrollManager:null})}constrainStartDate(i){const{dragData:e}=this,{dateConstraints:t}=e,r=e.eventRecord||e.taskRecord||e.record;return t!=null&&t.start&&(i=C.max(t.start,i)),t!=null&&t.end&&(i=C.min(new Date(t.end-r.rawDurationMS),i)),i}getElementFromContext(i){return i.grabbed||i.dragProxy||i.element}getRelatedRecords(i){return[]}getMinimalDragData(i,e){return{}}isValidDrop(i){throw new Error("Implement in subclass")}checkDragValidity(i){throw new Error("Implement in subclass")}updateRecords(i){throw new Error("Implement in subclass")}isElementDraggable(i,e){throw new Error("Implement in subclass")}getCoordinate(i,e,t){throw new Error("Implement in subclass")}setupProductDragData(i){throw new Error("Implement in subclass")}getProductDragContext(i){throw new Error("Implement in subclass")}getRecordElement(i){throw new Error("Implement in subclass")}};Yp._$name="DragBase";var Qh=i=>{var e;return e=class extends(i||$).mixin(Zt){detachFromProject(t){this.rejectFeatureTransaction(),super.detachFromProject(t)}getStmCapture(){var t,r;const n=(r=(t=super.getStmCapture)==null?void 0:t.call(this))!=null?r:{};return n._editorPromiseResolve=this._editorPromiseResolve,n}applyStmCapture(t){var r;(r=super.applyStmCapture)==null||r.call(this,t),this._editorPromiseResolve=t._editorPromiseResolve}captureFeatureTransaction(){if(this.client.transactionalFeaturesEnabled)return this._hasFeatureTransactionCapture=!0,{source:this,resolve:this._editorPromiseResolve}}applyCapturedFeatureTransaction(t={}){if(this.client.transactionalFeaturesEnabled){const{source:r,resolve:n}=t;r!==this&&(r._hasFeatureTransactionCapture=!1,r.cleanupTransactionMetadata(),this._hasFeatureTransactionCapture=!0,this._editorPromiseResolve=n)}}releaseFeatureTransaction(){this.client.transactionalFeaturesEnabled&&(this._hasFeatureTransactionCapture=!1)}get canStartFeatureTransaction(){return!this.client.transactionalFeaturesEnabled||!this._hasFeatureTransactionCapture&&!this.client.project.stm.isNavigatingRevisions}async startFeatureTransaction(){if(!this.client.transactionalFeaturesEnabled||this._hasFeatureTransactionCapture)return;const t=this,{project:r}=t.client,{stm:n}=r,s=Si.generateId("featureTransaction");t.client.trigger("beforeFeatureTransactionStart",{id:s});let a;t.hasStmCapture?n.startTransaction():a=r.queue(async()=>{r.isEngineReady()||await r.commitAsync()}),r.queue(()=>(t.hasStmCapture||(t._stmInitiallyDisabled=n.disabled,t._stmInitiallyAutoRecord=n.autoRecord,n.isRecording?n.stopTransaction():t._stmInitiallyDisabled&&n.enable(),n.autoRecord=!1),n.isRecording||n.startTransaction(),t.client.trigger("featureTransactionStart",{id:s}),new Promise(l=>t._editorPromiseResolve=l))),await a}rejectFeatureTransaction(){var t;const r=this,{stm:n}=r.client.project,s=r.client.featureTransactionId;!s||r.finishingFeatureTransaction||((t=r._editorPromiseResolve)==null||t.call(r),r._hasFeatureTransactionCapture&&r.releaseFeatureTransaction(),r.cleanupTransactionMetadata(),n.isRecording&&n.rejectTransaction(),!r.hasStmCapture&&r._stmInitiallyDisabled!=null&&(n.disabled=r._stmInitiallyDisabled,n.autoRecord=r._stmInitiallyAutoRecord),r.client.trigger("featureTransactionReject",{id:s}),r.client.trigger("featureTransactionComplete",{id:s}))}cleanupTransactionMetadata(){this._editorPromiseResolve=null}async finishFeatureTransaction(){var t;const r=this,{client:n,_stmInitiallyDisabled:s,_stmInitiallyAutoRecord:a}=r,{project:l,featureTransactionId:o}=n,{stm:d}=l;!o||r._hasFeatureTransactionCapture||(n.trigger("featureTransactionFinalizeStart",{id:o}),r.finishingFeatureTransaction=!0,await l.commitAsync(),d.isRecording&&d.stopTransaction(),(t=r._editorPromiseResolve)==null||t.call(r),r._editorPromiseResolve=null,!r.hasStmCapture&&d&&!d.isDestroying&&s!=null&&(d.disabled=s,d.autoRecord=a),r.isDestroying||(r.finishingFeatureTransaction=!1,n.trigger("featureTransactionFinalized",{id:o}),n.trigger("featureTransactionComplete",{id:o})))}},y(e,"$name","TransactionalFeature"),e},I0={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},Tl=class extends ie.mixin(ad,Ju,Qh){static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:1,dragThreshold:0,dragTouchStartDelay:300,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:i=>`
                <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                    ${i.startClockHtml}
                    ${i.endClockHtml}
                    <div class="b-sch-tip-message">${i.message}</div>
                </div>
            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event",lockLayout:!0,resizeSelected:!0}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var i;super.doDestroy(),(i=this.dragging)==null||i.destroy()}render(){const i=this,{client:e}=i;i.dragSelector=i.dragItemSelector=e.eventSelector,i.dragRootElement=i.dropRootElement=e.timeAxisSubGridElement,i.dragLock=e.isVertical?"y":"x"}isEventElementDraggable(i,e,t,r){const n=this,s=e==null?void 0:e.resizable;return n.disabled||!s||e.isMilestone?!0:(s!==!0&&s!=="start"||!n.isOverStartHandle(r,i))&&(s!==!0&&s!=="end"||!n.isOverEndHandle(r,i))}onEventDataGenerated({eventRecord:i,wrapperCls:e,cls:t}){var r,n;(n=(r=this.dragging)==null?void 0:r.context)!=null&&n.eventContexts.some(s=>s.eventRecord===i)&&(e["b-active"]=e[this.draggingItemCls]=e["b-over-resize-handle"]=t["b-resize-handle"]=t[this.resizingItemInnerCls]=1)}onDragPointerMove(i){var e;const{client:t,dragging:r}=this,{visibleDateRange:n,isHorizontal:s}=t,a=s&&t.rtl,l=s?"X":"Y",o=globalThis[`page${l}Offset`],d=i[`page${l}`]+(((e=r.context)==null?void 0:e.offset)||0),c=L.from(t.timeAxisSubGridElement,null,!0),u=c.getStart(a,s),h=c.getEnd(a,s);let g=t.getDateFromCoord({coord:d,local:!1});a?d-o>u?g=n.startDate:d<h&&(g=n.endDate):d-o<u?g=n.startDate:d-o>h&&(g=n.endDate),r.clientStartCoord=u,r.clientEndCoord=h,r.date=g,super.onDragPointerMove(i)}get isResizing(){return!!this.dragging}get isMultiResizing(){var i;return this.isResizing&&((i=this.dragging)==null?void 0:i.context.eventContexts.length)>1}beforeDrag(i){const e=this,{client:t}=e,r=t.resolveTimeSpanRecord(i.itemElement),n=!t.isGanttBase&&t.resolveResourceRecord(t.isVertical?i.startEvent:i.itemElement);return e.disabled||t.readOnly||n!=null&&n.readOnly||r&&(r.readOnly||!(r.project||r.isOccurrence))||super.beforeDrag(i)===!1?!1:!e.hasStmCapture&&!e.canStartFeatureTransaction?(t.trigger("eventResizePrevented",{reason:"revision"}),!1):(i.mousedownDate=i.date=t.getDateFromCoordinate(i.event[`page${t.isHorizontal?"X":"Y"}`],null,!1),e.triggerBeforeResize(i))}initEventRecordContext(i,e){const t=i===e.timespanRecord?e.element:this.getSelectedRecordElement(i),r=i.isAssignmentModel?i.event:i,{isBatchUpdating:n,wrapEndDate:s,wrapStartDate:a}=r,l=n?r.get("startDate"):r.startDate,o=n?r.get("endDate"):r.endDate,d=e.draggingEnd?o:l;return{mainContext:e,eventRecord:r,element:t,startDate:l,endDate:o,date:d,wrapEndDate:s,wrapStartDate:a,oldValue:d,originalStartDate:l,originalEndDate:o,timespanRecord:r}}initResizeContext(i){var e,t,r;const n=this,{client:s}=n,{startEvent:a,itemElement:l}=i,o=s.resolveEventRecord(l),d=o.endDate,c=o.startDate,u=(e=s.features.eventBuffer)==null?void 0:e.enabled,h=n.dragLock==="x",g=h&&s.rtl,f=n.isOverEndHandle(a,l),m=L.from(l),p=h?a.clientX:a.clientY,v=f?m.getEnd(g,h):m.getStart(g,h),b=f?d:c,w={owner:n,valid:!0,offset:u?0:v-p,edge:h?f?"right":"left":f?"bottom":"top",finalize:n.finalize,event:i.event,toSet:f?"endDate":"startDate",otherEnd:f?"startDate":"endDate",setMethod:f?"setEndDate":"setStartDate",setOtherMethod:f?"setStartDate":"setEndDate",wrapToSet:u?f?"wrapEndDate":"wrapStartDate":null,oldValue:b,draggingEnd:f,timespanRecord:o,[`${s.scheduledEventName}Record`]:o,element:((r=(t=this.eventContexts)==null?void 0:t[0])==null?void 0:r.element)||l};let D;return n.resizeSelected&&n.isRecordSelected(o)?(D=n.selectedRecords.filter(S=>S.isAssignmentModel?!S.event.readOnly&&S.event.isScheduled:!S.readOnly&&S.isScheduled),D.sort((S,x)=>S===o?-1:x===o?1:0)):D=[o],w.eventContexts=D.map(S=>n.initEventRecordContext(S,w)),w}get selectedRecords(){return this.client.selectedAssignments}isRecordSelected(i){var e,t;return(t=(e=this.client).isEventSelected)==null?void 0:t.call(e,i)}getSelectedRecordElement(i){return i.isAssignmentModel?this.client.getElementFromAssignmentRecord(i,!1,!1,this.client.isLockedRowsView):this.client.getElementFromEventRecord(i)}startDrag(...i){const e=super.startDrag(...i);return e!==!1&&!this.hasStmCapture&&this.startFeatureTransaction().then(),e}dragStart(i){const e=this,{client:t,tip:r}=e,n=i.context=e.initResizeContext(i);t.element.classList.add(...e.dragActiveCls.split(" ")),t.listenToBatchedUpdates||t.beginListeningForBatchedUpdates();for(const s of n.eventContexts){const{eventRecord:a}=s;a.meta.isResizing=!0,a.isBatchUpdating||e.beginEventRecordBatch(a),s.element&&e.setupProductResizeContext(s,i.startEvent)}e.triggerEventResizeStart(`${t.scheduledEventName}ResizeStart`,e.getTriggerParams(n),n),r&&(r.show(),r.align=I0[n.edge],r.showBy(e.getTooltipTarget(i)))}getTriggerParams(i){const e=i.eventContexts.map(s=>({...s})),t=this.client.capitalizedEventName.toLowerCase(),r=e.find(({element:s,mainContext:a})=>{var l;return(l=s==null?void 0:s.closest(`.b-sch-${t}-wrap`))==null?void 0:l.isEqualNode(a.element)})||e[0],n={...r,event:i.event,async:i.async,finalize:(...s)=>i.finalize(...s),resizeData:e};return delete n.mainContext,n}triggerBeforeResize(i){const{client:e}=this,t=e.resolveTimeSpanRecord(i.itemElement);return e.trigger(`before${e.capitalizedEventName}Resize`,{[`${e.scheduledEventName}Record`]:t,event:i.event,...this.getBeforeResizeParams({event:i.startEvent,element:i.itemElement})})}triggerEventResizeStart(i,e,t){var r,n;this.client.trigger(i,e),(n=(r=this.client)[`after${O.capitalize(i)}`])==null||n.call(r,t,e)}triggerEventResizeEnd(i,e){this.client.trigger(i,e)}triggerEventPartialResize(i,e){const t=this.client.scheduledEventName+"Record",r=new Map;for(const n of e){const s=n[t];r.set(s,s.batching),s.batching=0}this.client.trigger(i,{...e[0],resizeData:e});for(const n of e){const s=n[t];s.batching=r.get(s)}}async triggerBeforeEventResizeFinalize(i,e){await this.client.trigger(i,e)}dragEnter(i){var e;return((e=i.context)==null?void 0:e.owner)===this}resizeEventPartiallyInternal(i,e){var t;const{client:r}=this,{toSet:n}=e.mainContext;if((t=r.features.eventBuffer)!=null&&t.enabled){if(n==="startDate"){const s=e.startDate.getTime()-e.originalStartDate.getTime();i.wrapStartDate=new Date(e.wrapStartDate.getTime()+s)}else if(n==="endDate"){const s=e.endDate.getTime()-e.originalEndDate.getTime();i.wrapEndDate=new Date(e.wrapEndDate.getTime()+s)}}i.set(n,e[n])}applyDateConstraints(i,e,t){var r,n;const s=(r=t.dateConstraints)==null?void 0:r.start,a=(n=t.dateConstraints)==null?void 0:n.end;return(s||a)&&(i=C.constrain(i,s,a),t.snappedDate=C.constrain(t.snappedDate,s,a)),i}isDateRangeValid(i){var e;const{client:t}=this,{startDate:r,endDate:n,eventRecord:s}=i,a=(e=t.features.eventBuffer)==null?void 0:e.bufferIsUnavailableTime;return t.isDateRangeAvailable(s.preamble&&a?C.add(r,-s.preamble.milliseconds,"ms"):r,s.postamble&&a?C.add(n,s.postamble.milliseconds,"ms"):n,s,i.eventRecord.resources)}hasValidSize(i,e){const{client:t}=this,r=e==="startDate"?"endDate":"startDate";return t.timeAxisViewModel.snap||this.allowResizeToZero?!0:i[e]-i[r]!==0}resizeEventRecord(i,e,t){const r=this,{client:n}=r,{timeAxis:s,enableEventAnimations:a}=n,{eventRecord:l,oldValue:o,element:d}=i,{resolutionUnit:c,resolutionIncrement:u}=s,h=l.get("startDate"),g=l.get("endDate"),f=i.mainContext;let{toSet:m,otherEnd:p}=f,v,b;m==="endDate"?t<h&&(v=-1):t>g&&(v=1),v&&r.onDragEndSwitch&&(r.onDragEndSwitch(i,t,v),p=f.otherEnd,m=f.toSet),n.snapRelativeToEventStartDate&&(t=s.roundDate(t,o)),i.snappedDate=C.round(t,s.resolution,null,s.weekStartDay);const w=C.diff(t,i[p],c)*(f.draggingEnd?-1:1);if(r.isEventDragCreate&&i.eventRecord===i.mainContext.eventRecord)i.mainContext.tooNarrow=Math.abs(w)<u/2;else if(w<u){if(w<0)return;if(r.allowResizeToZero)i.snappedDate=t=i[p];else{const D=p==="startDate"?1:-1;let S=s.ceilDate(C.add(l.get(p),u*D,c));C.diff(S,i[p],c)*(f.draggingEnd?-1:1)>u&&(S=s.roundDate(C.add(S,-D,c))),(S-o)*D<0||(t-o)*D>0?(t=D>0?C.max(t,S):C.min(t,S),i.snappedDate=S):(t=D>0?C.max(t,o):C.min(t,o),i.snappedDate=o),b=!0}}if(t=r.applyDateConstraints(t,l,i),(!i.date||t-i.date||b)&&(i.date=t,i[m]=r.showExactResizePosition||n.timeAxisViewModel.snap?i.snappedDate:t,i.valid=r.isDateRangeValid(i)&&r.hasValidSize(i,m),l.get(m)-i[m]))return i.valid=r.checkValidity(i,e.event,m),i.message="",i.valid&&typeof i.valid!="boolean"&&(i.message=i.valid.message,i.valid=i.valid.valid),i.valid=i.valid!==!1,l.isOccurrence&&(l.stores=[n.eventStore]),n.enableEventAnimations=!1,this.resizeEventPartiallyInternal(l,i),n.enableEventAnimations=a,l.isOccurrence&&(l.stores=null),i.tooNarrow&&(i.valid=!1),{[n.scheduledEventName+"Record"]:l,startDate:h,endDate:g,element:d,[m]:i[m]}}moveDrag(i){var e;const t=this,{context:r,event:n}=i,{client:s,tip:a}=t,l=t.dragLock==="x",o=l?"X":"Y",{visibleDateRange:d}=s,c=l&&s.rtl,u=r.offset*(c?-1:1),h=n[`client${o}`]+u,g=L.from(s.timeAxisSubGridElement,null,!0),f=g.getStart(c,l),m=g.getEnd(c,l),p=[];let{date:v}=i;r.event=n,n.isScroll&&(i.date=s.getDateFromCoordinate(n[`page${o}`]+u,null,!1)),c?h>f?v=i.date=d.startDate:h<m&&(v=i.date=d.endDate):h<f?v=i.date=d.startDate:h>m&&(v=i.date=d.endDate),r.message="",r.valid=!0;let b=v-r.oldValue;t.client.capitalizedEventName==="Task"&&(b=v-r.eventContexts[0].oldValue);for(const w of r.eventContexts){const D=new Date(w.oldValue.getTime()+b),S=t.resizeEventRecord(w,i,D);S&&p.push(S),w.valid||(r.valid=!1),(e=w.message)!=null&&e.length&&(r.message=w.message)}a&&(a.align=I0[r.edge],a.alignTo(t.getTooltipTarget(i))),p.length&&t.triggerEventPartialResize(`${t.client.scheduledEventName}PartialResize`,p),super.moveDrag(i)}dragEnd(i){const{context:e}=i;e&&(e.event=i.event),i.aborted?e==null||e.finalize(!1):!this.isEventDragCreate&&!i.started&&!V.getPagePoint(i.event).equals(V.getPagePoint(i.startEvent))&&(this.dragStart(i),this.cleanup(i.context,!1))}async dragDrop({context:i,event:e}){var t;const r=this,{client:n}=r,{toSet:s}=i;let a=!0,l;(t=r.tip)==null||t.hide();for(const o of i.eventContexts){o[s]=o.snappedDate;const{startDate:d,endDate:c}=o;o.valid=d&&c&&(r.allowResizeToZero||c-d>0)&&o[s]-o.oldValue&&o.valid!==!1,o.valid||(a=!1)}if(a){const o=r.getTriggerParams(i),d={...o,context:o};await r.triggerBeforeEventResizeFinalize(`before${n.capitalizedEventName}ResizeFinalize`,d),(d.async||o.async)&&(i.async=!0),l=!0}i.async||await i.finalize(l)}async eventRecordFinalize(i,e){const t=this,{client:r}=t;let n=[],s=!1;if(e)n=i.eventContexts.map(a=>t.internalUpdateRecord(a,a.eventRecord));else for(const a of i.eventContexts){const{eventRecord:l}=a;t.cancelEventRecordBatch(l),l.isOccurrence&&l.resources.forEach(o=>r.repaintEventsForResource(o))}if(n.length){if(await Promise.all(n),t.isDestroyed)return;s=n.some(a=>a)}t.cleanup(i,s)}async finalize(i){const e=this.owner,t=this,{snapRelativeToEventStartDate:r,timeAxis:n}=e.client,{toSet:s}=t;t.finalizing||(t.finalizing=!0,i&&(t.eventContexts.forEach(a=>{const{oldValue:l}=a;r&&(a[s]=a.snappedDate=n.roundDate(a.date,l)),e.adjustRecordBeforeUpdating(a,a.eventRecord)}),e.client.endListeningForBatchedUpdates()),await e.eventRecordFinalize(t,i),i?await e.finishFeatureTransaction():e.rejectFeatureTransaction())}cleanup(i,e){var t;const r=this,{client:n}=r;for(const{element:s,eventRecord:a}of i.eventContexts)a.meta.isResizing=!1,r.unHighlightHandle(s);n.endListeningForBatchedUpdates(),(t=r.tip)==null||t.hide(),n.element.classList.remove(...r.dragActiveCls.split(" ")),r.triggerEventResizeEnd(`${n.scheduledEventName}ResizeEnd`,{...r.getTriggerParams(i),changed:e})}adjustRecordBeforeUpdating(i,e){const{startDate:t,endDate:r}=i,{toSet:n,draggingEnd:s,otherEnd:a}=i.mainContext;if(!e.isOccurrence&&e.isEntity&&(!e.manuallyScheduled||e.project.skipNonWorkingTimeWhenSchedulingManually)){const l=e.run("calculateProjectedDuration",t,r);e.set({[n]:e.run("calculateProjectedXDateWithDuration",s?t:r,s,l),[a]:i[a]})}}async internalUpdateRecord(i,e){var t;const{client:r}=this,{generation:n}=e,{startDate:s,endDate:a}=i,{toSet:l,wrapToSet:o,setMethod:d}=i.mainContext;if(e.isOccurrence)e[e.batching>1?"endBatch":"cancelBatch"](),e.set(xt.prototype.inSetNormalize.call(e,{startDate:s,endDate:a}));else{const c=Object.assign({},e.meta.batchChanges);delete c[l],delete c.duration,this.cancelEventRecordBatch(e),(t=r.features.eventBuffer)!=null&&t.enabled&&(e[o]=null),e[d](i[l],!1),Object.keys(c).length&&e.set(c)}return await r.project.commitAsync(),e.generation!==n}onDragItemMouseMove(i){i.pointerType!=="touch"&&!this.handleSelector&&i.buttons===0&&this.checkResizeHandles(i)}checkResizeHandles(i){const e=this,{overItem:t}=e;if(t&&!e.client.readOnly&&(!e.allowResize||e.allowResize(t,i))){const r=e.client.resolveTimeSpanRecord(t);if(r!=null&&r.readOnly)return;e.isOverAnyHandle(i,t)?e.highlightHandle():e.unHighlightHandle()}}onDragItemMouseLeave(i,e){this.unHighlightHandle(e)}highlightHandle(){var i,e;const{overItem:t,client:r}=this;((e=(i=t.syncIdMap)==null?void 0:i[r.scheduledEventName])!=null?e:t.querySelector(r.eventInnerSelector)).classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(i=this.overItem){var e,t;if(i){const r=this,n=(t=(e=i.syncIdMap)==null?void 0:e[r.client.scheduledEventName])!=null?t:i.querySelector(r.client.eventInnerSelector);n&&n.classList.remove("b-resize-handle",r.resizingItemInnerCls),i.classList.remove("b-over-resize-handle",r.draggingItemCls)}}isOverAnyHandle(i,e){return!!(this.isOverStartHandle(i,e)||this.isOverEndHandle(i,e))}isOverStartHandle(i,e){var t;return!!((t=this.getHandleRect("start",i,e))!=null&&t.contains(V.getPagePoint(i)))}isOverEndHandle(i,e){var t;return!!((t=this.getHandleRect("end",i,e))!=null&&t.contains(V.getPagePoint(i)))}getHandleRect(i,e,t){if(this.overItem){if(t=e.target.closest(`.${this.client.eventCls}`)||t.querySelector(`.${this.client.eventCls}`),!t)return;const r=this,n=i==="start",{client:s}=r,a=!!s.rtl,l=r.dragLock,o=l==="x",d=o?"width":"height",c=`${o?n?a?"right":"left":a?"left":"right":n?"top":"bottom"}Handle`,u=s.resolveTimeSpanRecord(t),h=u==null?void 0:u.isResizable,g=L.from(t),f=g.clone(),m=globalThis.getComputedStyle(t,":before"),p=r.dynamicHandleSize?r.reservedSpace/2:0,v=[0,0,0,0];let b=parseFloat(m[d]);if(!r.disabled&&b&&!isNaN(b)&&r[c]&&r.dynamicHandleSize&&(h===!0||h===i)){const w=!o&&!n||o&&a===n,D=g[d];if(b>.5*D&&(b=Math.max(Math.floor(D/4)-1,1)),w?(f[l]+=D-b,v[o?3:0]=D/2+p):v[o?1:2]=D/2+p,g.deflate(...v),f[d]=b,f.constrainTo(g),f[d])return f}}}setupDragContext(i){const e=this;if(e.overItem&&e.isOverAnyHandle(i,e.overItem)&&e.isElementResizable(e.overItem,i)){const t=super.setupDragContext(i);return t.scrollManager=e.client.scrollManager,t}}changeTip(i,e){var t;const r=this;return r.showTooltip?(i?(i.isTooltip?i.owner=r:i=ve.reconfigure(e,ve.mergeConfigs({id:r.tipId},i,{getHtml:r.getTipHtml.bind(r),owner:r.client},r.tip),{owner:r,defaults:{type:"tooltip"}}),i.ion({innerhtmlupdate:"updateDateIndicator",thisObj:r}),r.clockTemplate=new ur({scheduler:r.client})):e&&(e.destroy(),(t=r.clockTemplate)==null||t.destroy()),i):null}isElementResizable(i,e){var t;const r=this,{client:n}=r,s=n.resolveTimeSpanRecord(i);if(n.readOnly)return!1;let a=s==null?void 0:s.isResizable;const l=(t=i==null?void 0:i.syncIdMap[n.scheduledEventName])!=null?t:i,o=e.target.closest('[class$="-handle"]');if(!a||o&&o!==l||(i=e.target.closest(r.dragSelector),!i))return!1;const d=i.classList.contains("b-sch-event-startsoutside"),c=i.classList.contains("b-sch-event-endsoutside");if(a===!0){if(d&&c)return!1;if(d)a="end";else if(c)a="start";else return r.isOverStartHandle(e,i)||r.isOverEndHandle(e,i)}return d&&a==="start"||c&&a==="end"?!1:!!(r.isOverStartHandle(e,i)&&a==="start"||r.isOverEndHandle(e,i)&&a==="end")}updateDateIndicator(){const{clockTemplate:i}=this,{context:e}=this.dragging,{eventRecord:t,snappedDate:r}=e.eventContexts[0],{draggingEnd:n}=e,s=n?t.get("startDate"):r,a=n?r:t.get("endDate"),{element:l}=this.tip;i.updateDateIndicator(l.querySelector(".b-sch-tooltip-startdate"),s),i.updateDateIndicator(l.querySelector(".b-sch-tooltip-enddate"),a)}getTooltipTarget({itemElement:i,context:e}){const t=this,{rtl:r}=t.client,n=L.from(i,null,!0);return t.dragLock==="x"?(!r&&e.edge==="right"||r&&e.edge==="left"?n.x=n.right-1:n.x-=t.tip.anchorSize[0]/2,n.width=t.tip.anchorSize[0]/2):(e.edge==="bottom"&&(n.y=n.bottom-1),n.height=t.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(i,e){return i.startDate&&(i.endDate>i.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,i,e)}getTipHtml({tip:i}){const e=this,{context:t}=e.dragging,r=t.eventContexts.find(h=>h.eventRecord===t.timespanRecord),{startDate:n,endDate:s,snappedDate:a,eventRecord:l}=r,{toSet:o,valid:d,message:c=""}=t;if(!n||!s)return i.html;const u={record:l,valid:d,message:c,startDate:n,endDate:s,[o]:a};return u.startText=e.client.getFormattedDate(u.startDate),u.endText=e.client.getFormattedDate(u.endDate),u.startClockHtml=e.clockTemplate.template({date:u.startDate,text:u.startText,cls:"b-sch-tooltip-startdate"}),u.endClockHtml=e.clockTemplate.template({date:u.endDate,text:u.endText,cls:"b-sch-tooltip-enddate"}),e.tooltipTemplate(u)}beginEventRecordBatch(i){i.beginBatch()}cancelEventRecordBatch(i){i.cancelBatch()}getBeforeResizeParams(i){const{client:e}=this;return{resourceRecord:e.resolveResourceRecord(e.isVertical?i.event:i.element)}}setupProductResizeContext(i,e){var t,r,n;const{client:s}=this,{element:a}=i,l=s.resolveEventRecord(a),o=(t=s.resolveResourceRecord)==null?void 0:t.call(s,a),d=(r=s.resolveAssignmentRecord)==null?void 0:r.call(s,a);Object.assign(i,{eventRecord:l,resourceRecord:o,assignmentRecord:d,dateConstraints:(n=s.getDateConstraints)==null?void 0:n.call(s,o,l)})}checkForEventOverlap({startDate:i,endDate:e,snappedDate:t,eventRecord:r,toSet:n}){var s;const{client:a}=this,l=(s=a.features.eventBuffer)==null?void 0:s.bufferIsUnavailableTime,{resources:o}=r;return r.preamble&&l&&(n==="startDate"?t=C.add(t,-r.preamble.milliseconds,"ms"):i=C.add(i,-r.preamble.milliseconds,"ms")),r.postamble&&l&&(n==="startDate"?e=C.add(e,r.postamble.milliseconds,"ms"):t=C.add(t,r.postamble.milliseconds,"ms")),n==="startDate"?!a.isDateRangeAvailable(t,e,r,o):!a.isDateRangeAvailable(i,t,r,o)}checkValidity({startDate:i,endDate:e,eventRecord:t,snappedDate:r,resourceRecord:n},s,a){return this.checkForEventOverlap({startDate:i,endDate:e,snappedDate:r,eventRecord:t,toSet:a})?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}};y(Tl,"$name","EventResize"),Tl._$name="EventResize",K.registerFeature(Tl,!0,"Scheduler"),K.registerFeature(Tl,!1,"ResourceHistogram");var eg=i=>{var e;return e=class extends(i||$){getStmCapture(){var t,r;return Object.assign((r=(t=super.getStmCapture)==null?void 0:t.call(this))!=null?r:{},{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1})}applyStmCapture(t){this.stmInitiallyAutoRecord=t.stmInitiallyAutoRecord,this.stmInitiallyDisabled=t.stmInitiallyDisabled,this.hasStmCapture=!0,this.stmCapture=t,t.transferred=!0}captureStm(t=!1){const r=this,n=r.project,s=n.getStm();r.hasStmCapture||(r.hasStmCapture=!0,r.stmInitiallyDisabled=s.disabled,r.stmInitiallyAutoRecord=s.autoRecord,r.stmInitiallyDisabled?(s.enable(),s.autoRecord=!1):(r.stmInitiallyAutoRecord&&(s.autoRecord=!1),s.isRecording&&s.stopTransaction()),t&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const t=this,r=t.project.getStm();if(!t.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");r.enabled&&(r.stopTransaction(),t.stmInitiallyDisabled&&r.resetQueue())}async rejectStmTransaction(){var t;const r=this.project.getStm(),{client:n}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");r.enabled&&((t=r.transaction)!=null&&t.length?(n.suspendRefresh(),r.rejectTransaction(),await n.resumeRefresh(!0)):r.isRecording&&r.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}async freeStm(t=null){const r=this,n=r.project.getStm(),{stmInitiallyDisabled:s,stmInitiallyAutoRecord:a}=r;if(!r.hasStmCapture)return;let l;r.rejectingStmTransaction=!0,t===!0?l=r.commitStmTransaction():t===!1&&(l=r.rejectStmTransaction()),r.hasStmCapture=!1,r.stmCapture=null,await l,n.isDestroying||(n.disabled=s,n.autoRecord=a),r.isDestroying||(r.rejectingStmTransaction=!1)}},y(e,"$name","TaskEditStm"),e},A0=i=>{var e;return e=class extends(i||$){captureStm(t){if(this.client.transactionalFeaturesEnabled)return super.captureStm(),this.startStmTransaction(t);super.captureStm(t)}freeStm(t){if(this.hasStmCapture||!this.client.transactionalFeaturesEnabled)return super.freeStm(t)}async startStmTransaction(t){this.client.transactionalFeaturesEnabled?await this.startFeatureTransaction(t):super.startStmTransaction()}commitStmTransaction(){if(this.client.transactionalFeaturesEnabled)return this.finishFeatureTransaction();super.commitStmTransaction()}afterCancel(){this.client.transactionalFeaturesEnabled&&this.rejectFeatureTransaction()}},y(e,"$name","TaskEditTransactional"),e},MA=function(i){var e,t;return(t=(e=this.source)==null?void 0:e.client.features.taskEdit)!=null&&t._canceling?!1:V.getDistanceBetween(this.startEvent,i)},tg=class extends Tl.mixin(eg,A0){static get pluginConfig(){return{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}}construct(i,e){(e==null?void 0:e.showTooltip)===!1&&(e.tip=null),super.construct(...arguments)}changeValidatorFn(i){this.createValidatorFn=i}render(){const i=this,{client:e}=i;i.dragRootElement=i.dropRootElement=e.timeAxisSubGridElement,i.dragLock=e.isVertical?"y":"x"}onDragEndSwitch(i){const{client:e}=this,{enableEventAnimations:t}=e,{eventRecord:r}=i,{draggingEnd:n}=i.mainContext,s=this.dragLock==="x",{initialDate:a}=this.dragging;e.enableEventAnimations=!1,r.set({startDate:a,endDate:a}),n?(i.endDate=a,Object.assign(i.mainContext,{toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"})):(i.startDate=a,Object.assign(i.mainContext,{toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"})),i.mainContext.draggingEnd=this.draggingEnd=!n,e.enableEventAnimations=t}beforeDrag(i){const e=this,t=super.beforeDrag(i),{pan:r,eventDragSelect:n}=e.client.features;return t===!1||e.preventMultiple&&!e.isRowEmpty(i.rowRecord)||e.disabled||r&&!r.disabled||n&&!n.disabled?!1:(e.client.preventDragSelect=!0,t)}startDrag(i){const e=super.startDrag(i);if(e!==!1){const[t]=i.context.eventContexts;i.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:i.element,eventElement:i.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),i.context.offset=0,i.context.oldValue=i.mousedownDate}return e}isOverEndHandle(){return this.draggingEnd}setupDragContext(i){const{client:e}=this;if(e.matchScheduleCell(i.target)){const t=e.resolveResourceRecord(i),r=t==null?void 0:t.$original;if(r&&!r.isSpecialRow){const n=ad().prototype.setupDragContext.call(this,i),s=[];return e.isVertical?s.push({element:e.scrollable.element,direction:"vertical"}):s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=e.scrollManager,n.monitoringConfig={scrollables:s},n.resourceRecord=n.rowRecord=r,t!==r&&(n.resourceRecordLink=t),n.getDistance=MA,n}}}async dragDrop({context:i,event:e}){var t;const{client:r}=this,{toSet:n}=i,[s]=i.eventContexts;s[n]=s.snappedDate;const{startDate:a,endDate:l,eventRecord:o}=s,{generation:d}=o;let c;(t=this.tip)==null||t.hide(),await r.project.commitAsync(),o.generation!==d&&(o[n]=s.oldValue,o[n]=s[n]),i.valid=a&&l&&l-a>0&&s[n]-s.oldValue&&i.valid!==!1,i.valid&&(i.startDate=s.startDate,i.endDate=s.endDate,r.trigger("beforeDragCreateFinalize",{context:i,event:e,proxyElement:s.element,eventElement:s.element,eventRecord:s.eventRecord,resourceRecord:s.resourceRecord}),c=!0),i.async||await i.finalize(c)}updateDragTolerance(i){this.dragThreshold=i}changeTip(i,e){return super.changeTip(!i||i.isTooltip?i:T.assign({id:`${this.client.id}-drag-create-tip`},i),e)}async finalize(i){var e;if(this.finalized)return;this.finalized=!0;const t=this.owner,r=this,[n]=r.eventContexts,s=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:n.element,eventElement:n.element,eventRecord:n.eventRecord,resourceRecord:n.resourceRecord}),t.cleanup(r))};i?(await t.finalizeDragCreate(r),s()):(await t.cancelDragCreate(r),(e=t.onAborted)==null||e.call(t,r),s())}async cancelDragCreate(i){}async finalizeDragCreate(i){const e=this,{client:t}=e,[r]=i.eventContexts,{eventRecord:n,resourceRecord:s}=r;t.snapRelativeToEventStartDate&&(r[i.toSet]=r.snappedDate=t.timeAxis.roundDate(r.date,r.oldValue)),e.adjustRecordBeforeUpdating(r,n),t.endListeningForBatchedUpdates(),await e.internalUpdateRecord(r,n);const a=e.getStmCapture();return!t.isDestroyed&&t.trigger("dragCreateEnd",{eventRecord:n,resourceRecord:s,event:i.event,eventElement:r.element,stmCapture:a}),!t.isDestroyed&&t.trigger("eventAutoCreated",{eventRecord:n,resourceRecord:s}),a.transferred}cleanup(i){var e;const{client:t}=this,[r]=i.eventContexts;r.eventRecord.meta.isResizing=!1,t.endListeningForBatchedUpdates(),(e=this.tip)==null||e.hide(),t.element.classList.remove(...this.dragActiveCls.split(" ")),r.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(i,e,t,r=!1){return{...i,async:r,event:e,finalize:t}}onEventDataGenerated(i){var e,t;((t=(e=this.dragging)==null?void 0:e.context)==null?void 0:t.eventRecord)===i.eventRecord&&(i.wrapperCls["b-sch-dragcreating"]=!0,i.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}get isDragCreating(){const{dragging:i}=this;return i&&i.state===i.constructor.STATE.DRAGGING}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(i,e){throw new Error("Implement in subclass")}handleBeforeDragCreate(i,e){throw new Error("Implement in subclass")}isRowEmpty(i){throw new Error("Implement in subclass")}};y(tg,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:i=>`
            <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                ${i.startClockHtml}
                ${i.endClockHtml}
                <div class="b-sch-tip-message">${i.message}</div>
            </div>
        `,dragActiveCls:"b-dragcreating"}),tg._$name="DragCreateBase";var fs=C,_A=["startDate","endDate","resource","recurrenceRule"],L0=i=>{if(i.length===1)return i[0].value;if(i.length===2){const[e,t]=i[0]instanceof Ii?i:i.reverse(),r=fs.parse(e.value);return r&&t.value&&r.setHours(t.value.getHours(),t.value.getMinutes(),t.value.getSeconds(),t.value.getMilliseconds()),r?C.clone(r):null}return null},qp=(i,e)=>{const t=new Date(i.getTime());return t.setHours(e.getHours(),e.getMinutes()),t},Kp=(i,e,t)=>{if(!t.editor.assigningValues&&i&&e&&t.endDateField&&t.endTimeField){const r=fs.add(qp(t.startDateField.value,t.startTimeField.value),t._durationMS,"milliseconds");t.endDateField.value=r,t.endTimeField.value=fs.clone(r)}},Xp=class extends ie{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(i,e){const t=this;i.eventEdit=t,super.construct(i,T.assign({weekStartDay:i.weekStartDay},e)),t.clientListenersDetacher=i.ion({[t.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:t})}doDestroy(){var i;this.clientListenersDetacher(),(i=this._editor)==null||i.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(i){const{items:e}=this;return e&&(i=Z.clone(i),i.items=Re.merge(e,i.items)),i}changeItems(i){return this.cleanItemsConfig(i),i}cleanItemsConfig(i){for(const e in i){const t=i[e];t===!0?delete i[e]:t!=null&&t.items&&this.cleanItemsConfig(t.items)}}onDatesChange({value:i,source:e}){var t,r,n,s,a,l,o,d,c,u,h;const g=this;if(i&&e===g.startDateField&&((t=g.startTimeField)!=null&&t.keepDate)&&g.startTimeField.value&&(g.startTimeField.value.setFullYear(i.getFullYear()),g.startTimeField.value.setMonth(i.getMonth()),g.startTimeField.value.setDate(i.getDate())),(e===g.endDateField||e===g.endTimeField)&&g.startDateField){const f=(r=g.endTimeField)!=null&&r.value&&((n=g.endDateField)!=null&&n.value)?qp(g.endDateField.value,g.endTimeField.value):(s=g.endDateField)==null?void 0:s.value,m=(a=g.startTimeField)!=null&&a.value&&((l=g.startDateField)!=null&&l.value)?qp(g.startDateField.value,g.startTimeField.value):(o=g.startDateField)==null?void 0:o.value;f&&m&&(g._durationMS=f-m)}switch(g.startDateField&&g.endDateField&&(g.endDateField.min=g.startDateField.value),g.endTimeField&&(fs.isEqual(fs.clearTime((d=g.startDateField)==null?void 0:d.value),fs.clearTime((c=g.endDateField)==null?void 0:c.value))?g.endTimeField.min=g.startTimeField.value:g.endTimeField.min=null),e.ref){case"startDateField":(u=g.startTimeField)!=null&&u.value&&Kp(i,g.startTimeField.value,g);break;case"startTimeField":(h=g.startDateField)!=null&&h.value&&Kp(g.startDateField.value,i,g);break}}async save(){throw new Error("Implement in subclass")}get values(){const i=this,{editor:e}=i,t=[],r=[],{values:n}=e;return _A.forEach(s=>delete n[s]),e.eachWidget(s=>{var a;const{name:l}=s;if(!l||s.hidden||s.up(o=>o===i.recurrenceEditor)){delete n[l];return}switch(l){case"startDate":t.push(s);break;case"endDate":r.push(s);break;case"resource":n[l]=s.record;break;case"recurrenceRule":n[l]=((a=e.widgetMap.recurrenceCombo)==null?void 0:a.value)==="none"?"":s.value;break}},!0),n.allDay&&!i.eventRecord.allDay&&(t.push(i.startTimeField),r.push(i.endTimeField)),t.length&&(n.startDate=L0(t)),r.length&&(n.endDate=L0(r)),"startDate"in n&&"endDate"in n&&(n.duration=fs.diff(n.startDate,n.endDate,i.editor.record.durationUnit,!0)),n}onBeforeSave(i){}onAfterSave(i){}updateRecord(i){var e;const{values:t}=this;return this.assignmentStore&&delete t.resource,this._durationMS=C.asMilliseconds((e=t.duration)!=null?e:i.duration,i.durationUnit),i.set(t)}onBeforeEditorShow(){const{eventRecord:i,editor:e}=this.editingContext,{nameField:t}=e.widgetMap;t&&i.isCreating&&(e.assigningValues=!0,t.value="",e.assigningValues=!1,t._configuredPlaceholder=t.placeholder,t.placeholder=i.name)}resetEditingContext(){var i;const e=this;if(!e.editingContext)return;const{client:t}=e,{editor:r,eventRecord:n}=e.editingContext,{eventStore:s}=t,{nameField:a}=r.widgetMap;n.isCreating&&(t.isTimelineBase&&((i=e.editingContext.eventElement)==null||i.closest("[data-event-id]").classList.add("b-released")),s.remove(n),n.isCreating=!1),a&&(a.placeholder=a._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),e.targetEventElement=e.editingContext=r._record=null}onPopupKeyDown({event:i}){const e=this;!e.readOnly&&i.key==="Enter"&&e.saveAndCloseOnEnter&&i.target.tagName.toLowerCase()==="input"&&(i.preventDefault(),i.target.name==="startDate"&&e.startTimeField&&Kp(e.startDateField.value,e.startTimeField.value,e),e.onSaveClick())}async finalizeStmCapture(i){}async onSaveClick(){const i=this;i.editor.focus(),i.isFinalizingEventSave=!0;const e=await i.save();return i.isFinalizingEventSave=!1,e&&(await i.finalizeStmCapture(!1),i.isDestroyed||(i.editor.close(i),i.client.trigger("afterEventEdit",{...i.editingContext,action:"save"}))),e}async onDeleteClick(){const i=this;i.isDeletingEvent=!0;const e=await i.deleteEvent();i.isDeletingEvent=!1,e&&(await i.finalizeStmCapture(!1),i.isDestroyed||(i.editor.close(i),i.client.trigger("afterEventEdit",{...i.editingContext,action:"delete"})))}async onCancelClick(){const i=this;i.isCancelingEdit=!0,i.editor.close(i),i.isCancelingEdit=!1,i.hasStmCapture&&await i.finalizeStmCapture(!0),i.isDestroyed||i.client.trigger("afterEventEdit",{...i.editingContext,action:"cancel"})}};Xp._$name="EditBase";var Ml=class extends ie.mixin(Zt){static get pluginConfig(){return{before:["onInternalPaint"],chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:i}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some(e=>i.isTimeSpanInAxis(e))}doDisable(i){this.client.isPainted&&this.client.refresh(),super.doDisable(i)}updateTabIndex(){this.isConfiguring||this.client.refresh()}onInternalPaint({firstPaint:i}){i&&this.setupCanvas()}setupCanvas(){const{entityName:i,client:e}=this;this.canvas||(this.canvas=e.canvases[i]=E.createElement({className:`b-${O.hyphenate(i)}-canvas b-sch-canvas`,parent:e.timeAxisSubGridElement,retainElement:!0}))}getEventsToRender(i,e){throw new Error("Implement in subclass")}onEventDataGenerated(i){const e=this,{client:t}=e,{eventRecord:r,iconCls:n}=i;e.shouldInclude(r)&&(t.isVertical?i.width=t.getResourceWidth(i.resourceRecord):i.top=0,i.entityName=e.entityName,i.fillSize=!0,i.wrapperCls["b-sch-resourcetimerange"]=1,e.rangeCls&&(i.wrapperCls[e.rangeCls]=1),i.wrapperCls[`b-sch-color-${r.timeRangeColor}`]=r.timeRangeColor,e.renderContent(r,i),i.children.push(i.eventContent),i.tabIndex=e.tabIndex!=null?String(e.tabIndex):null,(n==null?void 0:n.length)>0&&i.children.unshift({tag:"i",className:n.toString()}),i.eventId=e.generateElementId(r))}renderContent(i,e){e.eventContent.text=i.name}generateElementId(i){return i.domId}resolveResourceTimeRangeRecord(i){var e;return(e=i==null?void 0:i.closest(`.${this.rangeCls}`))==null?void 0:e.elementData.eventRecord}getElementFromResourceTimeRangeRecord(i){return this.canvas.syncIdMap[i.domId]}resolveResourceRecord(i){var e;return this.overridden.resolveResourceRecord(...arguments)||((e=this.resolveResourceTimeRangeRecord(i.target||i))==null?void 0:e.resource)}shouldInclude(i){throw new Error("Implement in subclass")}onStoreChange(i){(i.action==="removeall"||i.action==="dataset")&&(this.needsRefresh=!0),this.client.onInternalEventStoreChange(i),this.needsRefresh=!1}matchScheduleCell(i){let e=this.overridden.matchScheduleCell(i);if(!e&&this.enableMouseEvents){const{client:t}=this,r=i.closest(`.${this.rangeCls}`);e=r&&t.getCell({record:t.isHorizontal?r.elementData.resource:t.store.first,column:t.timeAxisColumn})}return e}handleRangeMouseEvent(i){var e;const t=this,r=i.target.closest(`.${t.rangeCls}`);if(r){const n=(e=V.eventNameMap[i.type])!=null?e:O.capitalize(i.type),s=t.resolveResourceTimeRangeRecord(r);t.client.trigger(t.entityName+n,{feature:t,[`${t.entityName}Record`]:s,resourceRecord:t.client.resourceStore.getById(s.resourceId),startDate:s.startDate,endDate:s.endDate,domEvent:i})}}updateEnableMouseEvents(i){var e;const t=this,{client:r}=t;(e=t.mouseEventsDetacher)==null||e.call(t),t.mouseEventsDetacher=null,r.whenVisible(()=>{i&&(t.mouseEventsDetacher=V.on({element:r.canvases[t.entityName],delegate:`.${t.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:t})),t.canvas.classList.toggle("b-interactive",!!i)})}};y(Ml,"configurable",{tabIndex:null,entityName:"resourceTimeRange"}),Ml.featureClass="",Ml._$name="ResourceTimeRangesBase";var ig=class extends Ir{};ig._$name="TimeSpanMenuBase";var kA=0,Zp=class extends ie{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onInternalPaint"]}}construct(i,e){const t=this;e=t.processConfig(e),super.construct(i,e),t.forSelector||(t.forSelector=`${i.eventInnerSelector}:not(.b-dragproxy,.b-iscreating)`),t.clockTemplate=new ur({scheduler:i}),i.ion({[`before${i.scheduledEventName}drag`]:()=>{var r;(r=t.tooltip)==null||r.hide()}})}processConfig(i){return typeof i=="function"?{template:i}:i}setConfig(i){super.setConfig(this.processConfig(i))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(i){this.tooltip&&(this.tooltip.disabled=i),super.doDisable(i)}onInternalPaint({firstPaint:i}){var e;if(i){const t=this,{client:r}=t,n=`:not(${[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${r.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].join()})`;(e=t.tooltip)==null||e.destroy();const s=t.tooltip=new ve({axisLock:"flexible",id:t.tipId||`${t.client.id}-event-tip-${kA++}`,cls:t.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${t.forSelector}`,scrollAction:"realign",forElement:r.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:t.getTipHtml.bind(t),disabled:t.disabled,...t.config,internalListeners:t.configuredListeners});s.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:t}),Object.keys(s.$meta.configs).forEach(a=>{Object.defineProperty(this,a,{set:l=>s[a]=l,get:()=>s[a]})})}}processConfiguredListeners(){}addListener(...i){var e;const t=super.addListener(...i),r=(e=this.tooltip)==null?void 0:e.addListener(...i);if(t||r)return()=>{t==null||t(),r==null||r()}}removeListener(...i){var e;super.removeListener(...i),(e=this.tooltip)==null||e.removeListener(...i)}updateDateIndicator(){const i=this,e=i.tooltip,t=e.element.querySelector(".b-sch-tooltip-enddate");i.record&&(i.clockTemplate.updateDateIndicator(e.element,i.record.startDate),t&&i.clockTemplate.updateDateIndicator(t,i.record.endDate))}resolveTimeSpanRecord(i){return this.client.resolveTimeSpanRecord(i)}resolveData(i,e){const t=this,{client:r}=t,n=t.recordType||`${r.scheduledEventName}Record`,s=t.resolveTimeSpanRecord(e);if(s&&!s.isCommitting){i.eventRecord=i.record=s;const{startDate:a,endDate:l}=s,o=r.getFormattedDate(a),d=r.getDisplayEndDate(l,a),c=r.getFormattedDate(d);return{tip:i,[`${n}`]:s,startDate:a,endDate:l,startText:o,endText:c,startClockHtml:t.clockTemplate.template({date:a,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":t.clockTemplate.template({date:d||"",text:c||"",cls:"b-sch-tooltip-enddate"})}}return null}getTipHtml({tip:i,activeTarget:e}){const t=this.resolveData(i,e);if(!(!t||!this.template))return t.startDate instanceof Date?this.template(t):(i.hide(),"")}get record(){return this.tooltip.eventRecord}onTipShow(){const i=this;i.monitorRecordUpdate&&!i.updateListener&&(i.updateListener=i.client.eventStore.ion({change:i.onRecordUpdate,buffer:300,thisObj:i}))}onTipHide(){var i;this.tooltip.eventRecord=this.tooltip.record=null,(i=this.updateListener)==null||i.call(this),this.updateListener=null}onOverNewTarget({newTarget:i}){const{tooltip:e}=this;e.isVisible&&(this.client.timeAxisSubGrid.scrolling||this.client.scrolling?e.hide(!1):e.eventRecord=this.resolveTimeSpanRecord(i))}onRecordUpdate({record:i}){const{tooltip:e}=this;e!=null&&e.isVisible&&i===this.record&&(e.updateContent(),e.lastAlignSpec.aligningToElement?e.realign():e.internalOnPointerOver(this.client.lastPointerEvent))}};Zp._$name="TooltipBase";var nn=class extends ie.mixin(fe){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,hoverTooltip:null,tooltipTemplate:null,dragTipTemplate:i=>`
                <div class="b-sch-tip-${i.valid?"valid":"invalid"}">
                    <div class="b-sch-tip-name">${O.encodeHtml(i.name)||""}</div>
                    ${i.startClockHtml}
                    ${i.endClockHtml||""}
                </div>
            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}static get pluginConfig(){return{chain:["updateFillTicks","onInternalPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}}construct(i,e){const t=this;super.construct(i,e),i.isVertical&&i.ion({renderRows:t.onUIReady,thisObj:t,once:!0}),t.cls=t.cls||`b-sch-${t.constructor.$$name.toLowerCase()}`,t.baseSelector=`.${t.baseCls}.${t.cls}`,t.enableResizing&&(t.showHeaderElements=!0)}doDestroy(){var i,e,t,r;const n=this;n.detachListeners("timeAxisViewModel"),n.detachListeners("timeAxis"),(i=n.clockTemplate)==null||i.destroy(),(e=n.tip)==null||e.destroy(),(t=n.drag)==null||t.destroy(),(r=n.resize)==null||r.destroy(),super.doDestroy()}doDisable(i){this.isConfiguring||this.renderRanges(),super.doDisable(i)}setupTimeAxisViewModelListeners(){const i=this;i.detachListeners("timeAxisViewModel"),i.detachListeners("timeAxis"),i.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:i}),i.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:i}),i.updateLineBuffer()}onUIReady(){const i=this,{client:e}=i;e.ion({timeAxisViewModelChange:i.setupTimeAxisViewModelListeners,thisObj:i}),i.setupTimeAxisViewModelListeners(),e.hideHeaders||(i.headerContainerElement&&V.on({click:i.onTimeRangeClick,dblclick:i.onTimeRangeClick,contextmenu:i.onTimeRangeClick,delegate:i.baseSelector,element:i.headerContainerElement,thisObj:i}),i.enableResizing&&(i.drag=si.new({name:"rangeDrag",lockX:e.isVertical,lockY:e.isHorizontal,constrain:!0,outerElement:i.headerContainerElement.parentElement,targetSelector:`${i.baseSelector}`,isElementDraggable:(t,r)=>!e.readOnly&&i.isElementDraggable(t,r),rtlSource:e,positioning:"inset",scrollManager:e.scrollManager,internalListeners:{dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:i}},i.dragHelperConfig),i.resize=Fn.new({direction:e.mode,targetSelector:`${i.baseSelector}.b-sch-range`,outerElement:i.headerContainerElement,isElementResizable:(t,r)=>!t.matches(".b-dragging,.b-readonly")&&!r.target.matches(".b-fa"),rtlSource:e,positioning:"inset",internalListeners:{resizeStart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:i}},i.resizeHelperConfig))),i.renderRanges(),i.tooltipTemplate&&(i.hoverTooltip=new ve(T.assign({forElement:i.headerContainerElement,getHtml({activeTarget:t}){const r=i.resolveTimeRangeRecord(t);return i.tooltipTemplate({timeRange:r})},forSelector:`.b-timelinebase:not(.b-dragging-timerange, .b-resizing-timerange) .${i.baseCls}${i.cls?"."+i.cls:""}`},i.hoverTooltip)))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(i,e){const t=this,r=[],n=[];if(!t.disabled){t._labelRotationMap={};for(const s of t.timeRanges){const a=t.renderRange(s,i,e);a&&(r.push(a.bodyConfig),n.push(a.headerConfig))}}return[r,n]}renderRanges(){const i=this,{client:e}=i;if(e.isPainted&&!e.timeAxisSubGrid.collapsed){const{headerContainerElement:t}=i,r=[],[n,s]=i.getDOMConfig();i.bodyCanvas||(i.bodyCanvas=E.createElement({className:`b-timeranges-canvas b-timeranges-body-canvas ${i.cls}-canvas b-sch-canvas`,parent:e.timeAxisSubGridElement,retainElement:!0})),oe.sync({targetElement:i.bodyCanvas,domConfig:{children:n,onlyChildren:!0,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:i.showHeaderElements?null:({targetElement:a,action:l})=>{(l==="reuseElement"||l==="newElement"||l==="reuseOwnElement")&&r.push(a)}}),i.showHeaderElements&&!i.headerCanvas&&(i.headerCanvas=E.createElement({className:`b-timeranges-canvas b-timeranges-header-canvas ${i.cls}-canvas`,parent:t,retainElement:!0})),i.headerCanvas&&oe.sync({targetElement:i.headerCanvas,domConfig:{onlyChildren:!0,children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const a of r)i.cacheRotation(a.elementData.timeRange,a);for(const a of r)i.applyRotation(a.elementData.timeRange,a)}}get timeRanges(){return[]}shouldRenderRange(i,e=this.client.visibleDateRange.startDate,t=this.client.visibleDateRange.endDate){const{timeAxis:r}=this.client,{startDate:n,endDate:s,duration:a}=i;return!!(n&&(r.isContinuous||r.isTimeSpanInAxis(i))&&C.intersectSpans(e,t,n,a?s:C.add(n,this._lineBufferDurationMS)))}getRangeDomConfig(i,e,t,r=0){const n=this,{client:s}=n,{rtl:a,timeAxis:l}=s;let{startDate:o,endDate:d}=i;if(s.fillTicks&&(d&&d-o!==0||i.fillAlign)&&(o=d||i.fillAlign==="start"?l.getSnappedTickFromDate(o).startDate:l.getSnappedTickFromDate(o).endDate,d)){const f=Math.ceil(l.getTickFromDate(d))-1;d=l.getAt(f).endDate}const c=s.getVirtualCoordFromDate(C.max(o,e),{respectExclusion:!0})-r,u=d?s.getVirtualCoordFromDate(C.min(d,t),{respectExclusion:!0,isEnd:!0})-r:c,h=Math.abs(u-c),g=h>0;return{className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:g,[n.lineCls]:!g,[i.cls]:i.cls,"b-narrow-range":g&&h<n.narrowThreshold,"b-readonly":i.readOnly,"b-rtl":a},dataset:{id:i.id},elementData:{timeRange:i},style:s.isVertical?`inset-block-start: ${c}px; ${g?`height:${h}px`:""};`:`inset-inline-start: ${c}px; ${g?`width:${h}px`:""};`}}renderRange(i,e,t){const r=this,{client:n}=r,{timeAxis:s}=n;if(n.timeAxisViewModel.availableSpace>0&&s.startDate&&r.shouldRenderRange(i,e,t)){const a=r.getRangeDomConfig(i,s.startDate,s.endDate),l=i.iconCls&&O.xss`<i class="${i.iconCls}"></i>`,o=i.name&&O.encodeHtml(i.name),d=o||l?`${l||""}<label>${o||"&nbsp;"}</label>`:"",c={...a,style:a.style+(i.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:i}):r.showHeaderElements&&!r.showLabelInBody?"":d};let u;return r.showHeaderElements&&(u={...a,html:r.headerRenderer?r.headerRenderer({timeRange:i}):r.showLabelInBody?"":d}),{bodyConfig:c,headerConfig:u}}}cacheRotation(i,e){if(!i.iconCls&&!i.name||!i.duration)return;const t=e.firstElementChild;t&&!i.recurringTimeSpan&&(this._labelRotationMap[i.id]=this.client.isVertical?t.offsetHeight<e.offsetHeight:t.offsetWidth>e.offsetWidth)}applyRotation(i,e){var t,r,n;const s=this._labelRotationMap[(r=(t=i.recurringTimeSpan)==null?void 0:t.id)!=null?r:i.id];(n=e.firstElementChild)==null||n.classList.toggle("b-vertical",!!s)}getBodyElementByRecord(i){const e=typeof i=="string"?i:i==null?void 0:i.id;return e!=null&&oe.getChild(this.bodyCanvas,e)}resolveTimeRangeRecord(i){}get headerContainerElement(){const i=this,{isVertical:e,timeAxisColumn:t}=i.client;return i._headerContainerElement||(e?i._headerContainerElement=i.client.subGrids.locked.element:e||(i._headerContainerElement=t.element)),i._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(i){const{client:e}=this;this.isConfiguring||(e.element.classList.toggle("b-sch-timeranges-with-headerelements",!!i),this.renderRanges())}populateTimeAxisHeaderMenu({column:i,items:e}){}onInternalPaint({firstPaint:i}){i&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:i}=this.client;this._lineBufferDurationMS=i.getDateFromPosition(300)-i.getDateFromPosition(0)}onInternalResize(i,e,t,r,n){this.client.isVertical&&n!==t&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(i){const e=this.resolveTimeRangeRecord(i.target);this.client.trigger(`timeRangeHeader${O.capitalize(i.type)}`,{domEvent:i,timeRangeRecord:e})}showTip(i){const e=this;e.showTooltip&&(e.clockTemplate=new ur({scheduler:e.client}),e.tip=ve.reconfigure(e.tip,ve.mergeConfigs({type:"tooltip",id:`${e.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:i.element,getHtml:()=>e.getTipHtml(i.record,i.element)},e.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(i){return i=i.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"),i&&!i.classList.contains("b-over-resize-handle")}onDragStart({context:i}){const{client:e,drag:t}=this;e.isVertical?(t.minY=0,t.maxY=e.timeAxisViewModel.totalSize-i.element.offsetHeight,t.minX=0,t.maxX=Number.MAX_SAFE_INTEGER):(t.minX=0,t.maxX=e.timeAxisViewModel.totalSize-i.element.offsetWidth,t.minY=0,t.maxY=Number.MAX_SAFE_INTEGER),e.element.classList.add("b-dragging-timerange")}onDrop({context:i}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}updateDateIndicator({startDate:i,endDate:e}){const t=this,{tip:r}=t,n=r.element.querySelector(".b-sch-tooltip-enddate");t.clockTemplate.updateDateIndicator(r.element,i),n&&t.clockTemplate.updateDateIndicator(n,e)}onDrag({context:i}){const e=this;if(e.showTooltip){const{client:t}=e,r=L.from(i.element),n=r.getStart(t.rtl,t.isHorizontal),s=r.getEnd(t.rtl,t.isHorizontal),a=t.getDateFromCoordinate(n,"round",!1),l=t.getDateFromCoordinate(s,"round",!1);e.updateDateIndicator({startDate:a,endDate:l})}}onDragReset(){}onResizeStart(){var i;this.client.element.classList.add("b-resizing-timerange"),(i=this.hoverTooltip)==null||i.hide()}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){this.client.element.classList.remove("b-resizing-timerange")}getTipHtml(i,e){const t=this,{client:r}=t,n=L.from(e),s=n.getStart(r.rtl,r.isHorizontal),a=n.getEnd(r.rtl,r.isHorizontal),l=r.getDateFromCoordinate(s,"round",!1),o=i.endDate&&r.getDateFromCoordinate(a,"round",!1),d=r.getFormattedDate(l),c=o&&r.getFormattedEndDate(o,l);return t.dragTipTemplate({name:i.name||"",startDate:l,endDate:o,startText:d,endText:c,startClockHtml:t.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&t.clockTemplate.template({date:o,text:c,cls:"b-sch-tooltip-enddate"})})}updateFillTicks(){this.isConfiguring||this.refresh()}};y(nn,"configurable",{showHeaderElements:!0}),nn._$name="AbstractTimeRanges";var FA=Object.freeze({}),mc=class extends ie.mixin(Zt,fe){static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","internalOnVisibleDateRangeChange","onVisibleResourceRangeChange","onVisibleResourceColumnChange"]}}attachToResourceStore(i){const{client:e}=this;super.attachToResourceStore(i),e.isVertical&&e.resourceStore.ion({name:"resourceStore",group({groupers:t}){t.length===0&&this.refresh()},thisObj:this})}doDisable(i){super.doDisable(i),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(i,e,t,r){const n=this,{client:s}=n,{timeAxisViewModel:a,isHorizontal:l,resourceStore:o,variableColumnWidths:d}=s,{columnConfig:c}=a,u=a.columnLinesFor,h=Math.max(u-1,0),g=i.getTime(),f=e.getTime(),m=[],p=new Set,v=l?"insetInlineStart":"insetBlockStart";if(!n.disabled){const b=(w,D)=>{const S=w.start.getTime();if(S>g&&S<f&&!p.has(S)){const x={role:"presentation",className:{"b-column-line-major":D,"b-column-line":!D},style:{[v]:w.coord},dataset:{line:D?`major-${w.index}`:`line-${w.index}`}};p.add(S),m.push(x),n.renderer&&n.callback(n.renderer,n,[w.start,x])}};if(u!==h)for(let w=1;w<=c[h].length-1;w++)b(c[h][w],!0);for(let w=1;w<=c[u].length-1;w++)b(c[u][w],!1);if(!l&&s.columnLines){const{columnWidth:w}=s.resourceColumns;!t&&!r&&({first:t,last:r}=s.currentOrientation.getResourceRange(!0));let D=0;if(t>-1)for(let S=t;S<r+1;S++){const x=o.getAt(S);if(x.isGroupHeader){r++,D++;continue}const R=x.instanceMeta(s),M=d?R.insetStart+s.getResourceWidth(x)-1:(S-D+1)*w-1,_=x.instanceMeta(s.resourceStore).groupParent;m.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":o.isGrouped&&(_==null?void 0:_.groupChildren[(_==null?void 0:_.groupChildren.length)-1])===x},style:{insetInlineStart:M},dataset:{line:`resource-${S}`}})}}}return m}refresh(){const i=this,{client:e}=i,{timeAxis:t}=e,{startDate:r,endDate:n}=e.visibleDateRange||FA;if(!t.startDate||!r||i.client.timeAxisSubGrid.collapsed)return;i.element||(i.element=E.createElement({parent:e.timeAxisSubGridElement,className:"b-column-lines-canvas b-sch-canvas"}));const a=i.getColumnLinesDOMConfig(r,n);oe.sync({targetElement:i.element,domConfig:{onlyChildren:!0,children:a,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}internalOnVisibleDateRangeChange(){this.refresh.now()}onVisibleResourceRangeChange({firstResource:i,lastResource:e}){this.refresh()}onVisibleResourceColumnChange(i,e){this.refresh()}updateCanvasSize(){this.refresh()}};y(mc,"$name","ColumnLines"),y(mc,"configurable",{renderer:null}),mc._$name="ColumnLines",K.registerFeature(mc,!0,["Scheduler","Gantt","TimelineHistogram"]);var P0=i=>{var e;return e=class extends(i||$){static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(t,r){super.construct(t,r);const n=this;n.eventName=t.scheduledEventName,t.ion({readOnly:()=>n.updateCreateListeners()}),n.updateCreateListeners(),n.chain(t,"onElementTouchMove","onElementTouchMove")}doDestroy(){var t,r;const n=this;n.detachListeners("view"),n.creationData=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(r=n.creationTooltip)==null||r.destroy(),super.doDestroy()}updateCreateListeners(){const t=this;t.client&&(t.detachListeners("view"),t.isCreateAllowed&&t.client.ion({name:"view",[`${t.eventName}MouseEnter`]:"onTimeSpanMouseEnter",[`${t.eventName}MouseLeave`]:"onTimeSpanMouseLeave",thisObj:t}))}set allowCreate(t){this._allowCreate=t,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.client.readOnly&&!this.disabled}updateAllowCreateOnlyParent(t){this.client.element.classList.toggle("b-dependency-only-parent",t)}updateTerminalOffset(t){this.client.whenVisible(()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-offset",`${-t}px`)})}updateTerminalSize(t){typeof t=="number"&&(t=`${t}px`),this.client.whenVisible(()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-size",t?`${t}`:null)})}onTimeSpanMouseEnter({event:t,source:r,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:s,resourceRecord:a}){if(!n.isCreating&&!n.readOnly){const l=this,{creationData:o,client:d}=l,c=E.down(s,r.eventInnerSelector);if(n!==(o==null?void 0:o.source)){const{parent:u}=n;if(n.isEventModel&&u&&!u.isRoot&&d.eventStore.includes(u)){const h=d.getElementFromEventRecord(u,a,!0);h&&l.delayHideTerminals(h)}l.delayShowTerminals(n,s),o&&t.target.closest(d.eventSelector)&&(o.timeSpanElement=c,l.onOverTargetEventBar(t))}}}onTimeSpanMouseLeave(t){var r,n,s,a,l;const{eventRecord:o,event:d}=t;if(!d)return;const c=this,{creationData:u,client:h}=c,g=(r=d.relatedTarget)!=null&&r.matches(".b-sch-terminal-hover-area, .b-sch-terminal")?null:(n=d.relatedTarget)==null?void 0:n.closest(h.eventSelector),f=(l=(s=g==null?void 0:g.elementData)==null?void 0:s.eventRecord)!=null?l:(a=g==null?void 0:g.elementData)==null?void 0:a.taskRecord,{parent:m}=o!=null?o:{},p=t[`${c.eventName}Element`];if((d.isTrusted||re.isTestEnv||u)&&c.delayHideTerminals(p),m&&!m.isRoot&&h.eventStore.includes(m)){const v=h.getElementFromEventRecord(m);v&&c.delayShowTerminals(m,v)}u&&c.onOverNewTargetWhileCreating(d.relatedTarget,!(f!=null&&f.readOnly)&&!(f!=null&&f.isOccurence)?f:null,d)}onTerminalMouseOver(t){this.clearTimeout(`hide-${t.target.closest(this.client.eventSelector).dataset.syncId}`),this.creationData&&this.onOverTargetEventBar(t)}onTerminalMouseOut(t){var r,n,s,a;const l=this,{creationData:o,client:d}=l,c=t.target.closest(d.eventSelector),u=(r=t.relatedTarget)==null?void 0:r.closest(d.eventSelector),h=(a=(n=u==null?void 0:u.elementData)==null?void 0:n.eventRecord)!=null?a:(s=u==null?void 0:u.elementData)==null?void 0:s.taskRecord;u!==c&&c&&!l.hasTimeout(`show-${c.dataset.syncId}`)&&(!o||c!==o.timeSpanElement)&&(l.delayHideTerminals(c),d.unhover(c,t)),o&&l.onOverNewTargetWhileCreating(t.relatedTarget,!(h!=null&&h.readOnly)&&!(h!=null&&h.isOccurence)?h:null,t)}onTerminalPointerDown(t){var r;const n=this;if(t.button===0&&!n.creationData){const{client:s}=n,a=s.timeAxisSubGridElement,l=t.target,o=l.closest(s.eventInnerSelector),d=L.from(s.element);t.stopPropagation(),n.creationData={sourceElement:o,source:s.resolveTimeSpanRecord(o).$original,fromSide:l.dataset.side,startPoint:L.from(l,a).center,startX:t.pageX-d.x+s.scrollLeft,startY:t.pageY-d.y+s.scrollTop,valid:!1,sourceResource:(r=s.resolveResourceRecord)==null?void 0:r.call(s,t),tooltip:n.creationTooltip},n.pointerUpMoveDetacher=V.on({pointerup:{element:E.getRootElement(s.element),handler:"onMouseUp",passive:!1},pointermove:{element:a,handler:"onMouseMove",passive:!1},thisObj:n}),n.documentPointerUpDetacher=V.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:c})=>{c==="Escape"&&n.abort()}},thisObj:n})}}onElementTouchMove(t){var r;(r=super.onElementTouchMove)==null||r.call(this,t),this.connector&&t.preventDefault()}onMouseMove(t){const r=this,{client:n,creationData:s}=r,a=L.from(n.element),l=t.pageX-a.x+n.scrollLeft-s.startX,o=t.pageY-a.y+n.scrollTop-s.startY,d=Math.round(Math.sqrt(l*l+o*o))-3,c=Math.atan2(o,l);let{connector:u}=r;if(!u){if(r.onRequestDragCreate(t)===!1){r.abort();return}u=r.connector}u.style.width=`${d}px`,u.style.transform=`rotate(${c}rad)`,r.lastMouseMoveEvent=t}onRequestDragCreate(t){const r=this,{client:n,creationData:s}=r;if(n.trigger("beforeDependencyCreateDrag",{data:s,source:s.source})===!1)return!1;if(n.element.classList.add("b-creating-dependency"),r.createConnector(s.startPoint.x,s.startPoint.y),n.trigger("dependencyCreateDragStart",{data:s,source:s.source}),r.showCreationTooltip){const a=r.creationTooltip||(r.creationTooltip=r.createDragTooltip());r.creationData.tooltip=a,a.disabled=!1,a.show(),a.onMouseMove(t)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>r.lastMouseMoveEvent&&r.onMouseMove(r.lastMouseMoveEvent)})}onOverTargetEventBar(t){const r=this,{client:n,creationData:s,allowDropOnEventBar:a}=r,{target:l}=t;let o=n.resolveTimeSpanRecord(l).$original;o!=null&&o.isEventSegment&&(o=o.event),!(Z.isPromise(s.valid)||!a&&!l.classList.contains(r.terminalCls))&&o!==s.source&&r.onOverNewTargetWhileCreating(l,o,t)}async onOverNewTargetWhileCreating(t,r,n){var s,a;const l=this,{client:o,creationData:d,allowDropOnEventBar:c,connector:u}=l;if(!Z.isPromise(d.valid)&&!d.finalizing&&u){if(u.classList.remove("b-valid","b-invalid"),d.timeSpanElement&&E.removeClsGlobally(d.timeSpanElement,"b-sch-terminal-active"),!r||r===d.source||!c&&!t.classList.contains(l.terminalCls)||l.allowCreateOnlyParent&&!r.isParent)d.target=d.toSide=null,d.valid=!1,u.classList.add("b-invalid");else{const h=d.target=r,{source:g}=d;let f=t.dataset.side;c&&!t.classList.contains(l.terminalCls)&&(f=l.getTargetSideFromType(l.dependencyStore.modelClass.fieldMap.type.defaultValue||Kt.Type.EndToStart)),o.resolveResourceRecord&&(d.targetResource=o.resolveResourceRecord(n));let m;d.toSide=f;const p=d.fromSide,v=D=>{l.isDestroyed||(d.valid=D,t.classList.add(D?"b-valid":"b-invalid"),u.classList.add(D?"b-valid":"b-invalid"),o.trigger("dependencyValidationComplete",{data:d,source:g,target:h,dependencyType:m}))};switch(!0){case(p==="start"&&f==="start"):m=Kt.Type.StartToStart;break;case(p==="start"&&f==="end"):m=Kt.Type.StartToEnd;break;case(p==="end"&&f==="start"):m=Kt.Type.EndToStart;break;case(p==="end"&&f==="end"):m=Kt.Type.EndToEnd;break}o.trigger("dependencyValidationStart",{data:d,source:g,target:h,dependencyType:m});let b=d.valid=l.dependencyStore.isValidDependency(g,h,m);Z.isPromise(b)&&(b=await b),v(b);const w=b?"b-valid":"b-invalid";u.classList.add(w),(a=(s=d.timeSpanElement)==null?void 0:s.querySelector(`.${l.terminalCls}[data-side=${f}]`))==null||a.classList.add("b-sch-terminal-active",w)}l.updateCreationTooltip()}}async onMouseUp(){var t;const r=this,n=r.creationData;if(n.finalizing=!0,(t=r.pointerUpMoveDetacher)==null||t.call(r),n.valid)if(await r.client.trigger("beforeDependencyCreateFinalize",n)===!1?n.valid=!1:Z.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let a=await r.createDependency(n);a!==null&&(Z.isPromise(a)&&(a=await a),n.dependency=a,r.client.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:a}),await r.doAfterDependencyDrop(n))}else await r.doAfterDependencyDrop(n);else n.valid=!1,await r.doAfterDependencyDrop(n);r.abort()}doAfterDependencyDrop(t){this.client.trigger("afterDependencyCreateDrop",{data:t,...t})}onDocumentMouseUp({target:t}){this.client.timeAxisSubGridElement.contains(t)||this.abort()}abort(){var t,r;const n=this,{client:s,creationData:a}=n;if(a){const{source:l,sourceResource:o,target:d,targetResource:c}=a;if(l){const u=s.getElementFromEventRecord(l,o);u&&n.hideTerminals(u)}if(d){const u=s.getElementFromEventRecord(d,c);u&&n.hideTerminals(u)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(r=n.documentPointerUpDetacher)==null||r.call(n),n.removeConnector()}createConnector(t,r){const n=this,{client:s}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=E.createElement({parent:s.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${t}px;top:${r}px`}),s.element.classList.add("b-creating-dependency")}createDragTooltip(){const t=this,{client:r}=t;return t.creationTooltip=ve.new({id:`${r.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:r.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:t}},t.creationTooltip)}removeConnector(){const t=this,{connector:r,client:n}=t;r&&(r.classList.add("b-removing"),r.style.width="0",t.removeConnectorTimeout=t.setTimeout(()=>{r.remove(),t.connector=null},200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring()}delayShowTerminals(t,r){const n=this,{syncId:s}=r.dataset;n.clearTimeout(`hide-${s}`),n.clearTimeout(`show-${s}`),r.classList.remove("b-hiding-terminals"),n.terminalShowDelay?n.setTimeout({fn:()=>n.showTerminals(t,r),name:`show-${s}`,args:[t,r],delay:n.terminalShowDelay}):n.showTerminals(t,r)}delayHideTerminals(t){const r=this,{syncId:n}=t.dataset;r.clearTimeout(`hide-${n}`),r.clearTimeout(`show-${n}`),t.classList.add("b-hiding-terminals"),r.terminalHideDelay?r.setTimeout({fn:()=>r.hideTerminals(t),name:`hide-${n}`,args:[t],delay:r.terminalHideDelay}):r.hideTerminals(t)}showTerminals(t,r=this.client.getElementFromEventRecord(t)){const n=this;if(!n.isCreateAllowed||!t.project||!r||n.allowCreateOnlyParent&&!t.isParent)return;const{client:s}=n,a=n.terminalCls,l=`${a}s-visible`;if(n.showingTerminalsFor&&n.hideTerminals(n.showingTerminalsFor),r=E.down(r,n.client.eventInnerSelector),!r.classList.contains(l)&&!s.element.classList.contains("b-resizing-event")&&!s.readOnly){if(s.trigger("beforeShowTerminals",{source:t})===!1)return;E.createElement({parent:r.closest(s.eventSelector),className:"b-sch-terminal-hover-area"}),n.terminalSides.forEach(o=>{o=n.fixSide(o);const d=E.createElement({parent:r,className:`${a} ${a}-${o}`,dataset:{side:o,feature:!0}});d.detacher=V.on({element:d,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})}),r.classList.add(l),t.internalCls.add(l)}}fixSide(t){return t==="left"?"start":t==="right"?"end":t}hideTerminals(t){var r;const n=this,{client:s}=n,a=s.getTimeSpanMouseEventParams(t),l=a==null?void 0:a[`${n.eventName}Record`],o=`${n.terminalCls}s-visible`;(r=t.querySelector(".b-sch-terminal-hover-area"))==null||r.remove(),E.forEachSelector(t,`> ${s.eventInnerSelector} > .${n.terminalCls}`,d=>{var c;(c=d.detacher)==null||c.call(d),d.remove()}),E.down(t,s.eventInnerSelector).classList.remove(o),l==null||l.internalCls.remove(o),t.classList.remove("b-hiding-terminals")}createDependency(t){const{source:r,target:n,fromSide:s,toSide:a}=t,l=(s==="start"?0:2)+(a==="end"?1:0),o=this.dependencyStore.add({from:r.id,to:n.id,type:l,fromSide:s,toSide:a});return o!==null?o[0]:null}getTargetSideFromType(t){return t===Kt.Type.StartToStart||t===Kt.Type.EndToStart?"start":"end"}updateCreationTooltip(){const t=this;if(!t.showCreationTooltip)return;const r=t.creationData,{valid:n}=r,s=t.creationTooltip,{classList:a}=s.element;if(Z.isPromise(n))return a.remove("b-invalid"),a.add("b-checking"),new Promise(l=>n.then(o=>{r.valid=o,s.isDestroyed||l(t.updateCreationTooltip())}));s.html=t.creationTooltipTemplate(r)}creationTooltipTemplate(t){var r,n;const s=this,{tooltip:a,valid:l}=t,{classList:o}=a.element;Object.assign(t,{fromText:t.source.name,toText:(n=(r=t.target)==null?void 0:r.name)!=null?n:"",fromSide:t.fromSide,toSide:t.toSide||""});let d,c;return o.toggle("b-invalid",!l),o.remove("b-checking"),l===!0?(d="valid",c=s.L("L{Dependencies.valid}")):(d="invalid",c=s.L("L{Dependencies.invalid}")),a.title=`<i class="b-icon b-icon-${d}"></i>${c}`,[{dataset:{ref:"fromLabel"},tag:"label",text:s.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:t.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${t.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:s.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:t.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${t.toSide}`}]}doDisable(t){this.isConfiguring||this.updateCreateListeners(),super.doDisable(t)}},y(e,"$name","DependencyCreation"),y(e,"configurable",{allowDropOnEventBar:!0,terminalSize:null,terminalOffset:null,terminalShowDelay:0,terminalHideDelay:0,allowCreateOnlyParent:!1}),e},rg=25,IA=i=>{var e;return e=class extends i{constructor(){super(...arguments),y(this,"gridCache",null)}getDependenciesToConsider(t,r,n,s){const a=this,{gridCache:l}=a,{timeAxis:o}=a.client;if(l){const d=new Set,c=Math.floor((t-o.startMS)/a.MS_PER_CELL),u=Math.floor((r-o.startMS)/a.MS_PER_CELL),h=Math.floor(n/rg),g=Math.floor(s/rg);for(let f=c;f<=u;f++){const m=l[f];if(m)for(let p=h;p<=g;p++){const v=m[p];if(v)for(let b=0;b<v.length;b++)d.add(v[b])}}return d}}afterDrawDependency(t,r,n,s,a){var l,o;const d=this;if(d.constructGridCache){const{MS_PER_CELL:c}=d,{startMS:u,endMS:h}=d.client.timeAxis,g=Math.ceil((h-u)/c),f=Math.floor((s-u)/c),m=Math.floor((a-u)/c),p=Math.floor(r/rg),v=Math.floor(n/rg),b=Math.min(f,m),w=Math.max(f,m),D=Math.min(p,v),S=Math.max(p,v);if(b<0&&w<0||b>g&&w>g)return;const x=Math.max(b,0),R=Math.min(w,g);for(let M=x;M<=R;M++){const _=(l=d.gridCache[M])!=null?l:d.gridCache[M]={};for(let k=D;k<=S;k++)((o=_[k])!=null?o:_[k]=[]).push(t)}}}beforeDraw(){const t=this;if(!t.gridCache){const{visibleDateRange:r}=t.client;t.constructGridCache=!0,t.MS_PER_CELL=Math.max(r.endMS-r.startMS,1e3),t.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},y(e,"$name","DependencyGridCache"),e},AA=Math.min(1/globalThis.devicePixelRatio,.75),LA=["start","end","top","bottom"],sn=(i,e)=>Math.abs(i-e)<.1,PA={l:"left",r:"right",t:"top",b:"bottom"},Jp=class Ig extends ${static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const r=this,n=e;let s,a,l,o,d,c,u,h,g,f,m,p,v,b,w,D,S,x,R,M,_,k,F,I,A,P,H,G,q;for(t=B.asArray(t),q=0;e&&!G;)for(s=Object.assign(r.config,e),a=s.startBox,l=s.endBox,o=s.startShift,d=s.endShift,c=s.startSide,u=s.endSide,h=s.startArrowMargin,g=s.endArrowMargin,f=s.horizontalMargin,m=s.verticalMargin,p=s.hasOwnProperty("startHorizontalMargin")?s.startHorizontalMargin:f,v=s.hasOwnProperty("startVerticalMargin")?s.startVerticalMargin:m,b=s.hasOwnProperty("endHorizontalMargin")?s.endHorizontalMargin:f,w=s.hasOwnProperty("endVerticalMargin")?s.endVerticalMargin:m,D=s.hasOwnProperty("otherHorizontalMargin")?s.otherHorizontalMargin:f,S=s.hasOwnProperty("otherVerticalMargin")?s.otherVerticalMargin:m,x=s.otherBoxes,c=r.normalizeSide(c),u=r.normalizeSide(u),R=r.getConnectionCoordinatesFromBoxSideShift(a,c,o),M=r.getConnectionCoordinatesFromBoxSideShift(l,u,d),A=r.calcGridBaseBoxFromBoxAndDrawParams(a,c,h,p,v),P=r.calcGridBaseBoxFromBoxAndDrawParams(l,u,g,b,w),LA.forEach(W=>{Math.abs(A[W]-P[W])<=AA&&(P[W]=A[W])}),r.shouldLookForPath(a,l,A,P)&&(x=x==null?void 0:x.map(W=>r.calcGridBaseBoxFromBoxAndDrawParams(W,!1,0,D,S)),_=r.getConnectionCoordinatesFromBoxSideShift(A,c,o),k=r.getConnectionCoordinatesFromBoxSideShift(P,u,d),H=r.buildPathGrid(A,P,_,k,c,u,x),F=r.convertDecartPointToGridPoint(H,_),I=r.convertDecartPointToGridPoint(H,k),G=r.findPathOnGrid(H,F,I,c,u)),e=!1;!G&&!e&&t&&q<t.length;q++)e=t[q](s,n);return G&&(G=r.prependPathWithArrowStaffSegment(G,R,c),G=r.appendPathWithArrowStaffSegment(G,M,u),G=r.optimizePath(G)),G}static calculateRelativePosition(e,t,r=!1){const n=r?"top":"start",s=r?"bottom":"end";let a;return e[s]<t[n]?a=0:e[s]<=t[s]&&e[s]>=t[n]&&e[n]<t[n]?a=1:e[n]>=t[n]&&e[s]<=t[s]?a=2:e[n]<t[n]&&e[s]>t[s]?a=-2:e[n]<=t[s]&&e[s]>t[s]?a=3:a=4,a}static boxOverlapChanged(e,t,r,n,s=!1){const a=Ig.calculateRelativePosition,l=a(e,t,s),o=a(r,n,s);return l!==o}shouldLookForPath(e,t,r,n){let s=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&Math.abs(Ig.calculateRelativePosition(e,t,!0))===2&&(s=!Ig.boxOverlapChanged(e,t,r,n)),s}getConnectionCoordinatesFromBoxSideShift(e,t,r){let n;switch(t){case"left":n={x:e.start,y:(e.top+e.bottom)/2+r};break;case"right":n={x:e.end,y:(e.top+e.bottom)/2+r};break;case"top":n={x:(e.start+e.end)/2+r,y:e.top};break;case"bottom":n={x:(e.start+e.end)/2+r,y:e.bottom};break}return n}calcGridBaseBoxFromBoxAndDrawParams(e,t,r,n,s){let a;switch(this.normalizeSide(t)){case"left":a={start:e.start-Math.max(r,n),end:e.end+n,top:e.top-s,bottom:e.bottom+s};break;case"right":a={start:e.start-n,end:e.end+Math.max(r,n),top:e.top-s,bottom:e.bottom+s};break;case"top":a={start:e.start-n,end:e.end+n,top:e.top-Math.max(r,s),bottom:e.bottom+s};break;case"bottom":a={start:e.start-n,end:e.end+n,top:e.top-s,bottom:e.bottom+Math.max(r,s)};break;default:a={start:e.start-n,end:e.end+n,top:e.top-s,bottom:e.bottom+s}}return a}normalizeSide(e){const{rtl:t}=this.client;return e==="start"?t?"right":"left":e==="end"?t?"left":"right":e}buildPathGrid(e,t,r,n,s,a,l){let o,d,c,u,h,g,f,m,p,v,b,w,D;const S={},x=[];for(o=[e.start,s==="left"||s==="right"?(e.start+e.end)/2:r.x,e.end,t.start,a==="left"||a==="right"?(t.start+t.end)/2:n.x,t.end],d=[e.top,s==="top"||s==="bottom"?(e.top+e.bottom)/2:r.y,e.bottom,t.top,a==="top"||a==="bottom"?(t.top+t.bottom)/2:n.y,t.bottom],l&&l.forEach(R=>{o.push(R.start,(R.start+R.end)/2,R.end),d.push(R.top,(R.top+R.bottom)/2,R.bottom)}),o=[...new Set(o.sort((R,M)=>R-M))],d=[...new Set(d.sort((R,M)=>R-M))],g=0,m=d.length;g<m;++g)for(S[g]=S[g]||{},c=d[g],h=0,f=o.length;h<f;++h){if(u=o[h],w=(u<=e.start||u>=e.end||c<=e.top||c>=e.bottom)&&(u<=t.start||u>=t.end||c<=t.top||c>=t.bottom),l)for(p=0,v=l.length;w&&p<v;++p)b=l[p],w=u<=b.start||u>=b.end||c<=b.top||c>=b.bottom||u===r.x&&c===r.y||u===n.x&&c===n.y;D={distance:Number.MAX_SAFE_INTEGER,permitted:w,x:u,y:c,ix:h,iy:g},S[g][h]=D,x.push(D)}return{width:o.length,height:d.length,xs:o,ys:d,points:S,linearPoints:x}}convertDecartPointToGridPoint(e,t){const r=e.xs.indexOf(t.x),n=e.ys.indexOf(t.y);return e.points[n][r]}findPathOnGrid(e,t,r,n,s){const a=this;let l=!1;return t.permitted&&r.permitted&&(e=a.waveForward(e,t,0),l=a.collectPath(e,r,s)),l}getGridPointNeighbors(e,t,r){const n=t.ix,s=t.iy,a=[];let l;return s<e.height-1&&(l=e.points[s+1][n],(!r||r(l))&&a.push(l)),s>0&&(l=e.points[s-1][n],(!r||r(l))&&a.push(l)),n<e.width-1&&(l=e.points[s][n+1],(!r||r(l))&&a.push(l)),n>0&&(l=e.points[s][n-1],(!r||r(l))&&a.push(l)),a}waveForward(e,t,r){const n=this;return Ui.preWalkUnordered([t,r],([s,a])=>n.getGridPointNeighbors(e,s,l=>l.permitted&&l.distance>a+1).map(l=>[l,a+1]),([s,a])=>s.distance=a),e}collectPath(e,t,r){const n=this,s=[];let a=!0,l,o,d,c;for(;a&&t.distance;)if(l=n.getGridPointNeighbors(e,t,u=>u.permitted&&u.distance===t.distance-1),a=l.length>0,a){switch(l=l.sort((u,h)=>{let g,f;g=u.ix-t.ix,f=u.iy-t.iy;const m=(r==="left"||r==="right")&&f===0||(r==="top"||r==="bottom")&&g===0?-1:1;g=h.ix-t.ix,f=h.iy-t.iy;const p=(r==="left"||r==="right")&&f===0||(r==="top"||r==="bottom")&&g===0?-1:1;if(m>p)return 1;if(m<p)return-1;if(m===p)return u.y>h.y?-1:u.y<h.y?1:0}),o=l[0],s.push({x1:o.x,y1:o.y,x2:t.x,y2:t.y}),d=o.ix-t.ix,c=o.iy-t.iy,!0){case(!c&&d>0):r="left";break;case(!c&&d<0):r="right";break;case(!d&&c>0):r="top";break;case(!d&&c<0):r="bottom";break}t=o}return a&&s.reverse()||!1}prependPathWithArrowStaffSegment(e,t,r){if(e.length>0){const n=e[0],s={x2:n.x1,y2:n.y1};switch(r){case"left":s.x1=t.x,s.y1=n.y1;break;case"right":s.x1=t.x,s.y1=n.y1;break;case"top":s.x1=n.x1,s.y1=t.y;break;case"bottom":s.x1=n.x1,s.y1=t.y;break}e.unshift(s)}return e}appendPathWithArrowStaffSegment(e,t,r){if(e.length>0){const n=e[e.length-1],s={x1:n.x2,y1:n.y2};switch(r){case"left":s.x2=t.x,s.y2=n.y2;break;case"right":s.x2=t.x,s.y2=n.y2;break;case"top":s.x2=n.x2,s.y2=t.y;break;case"bottom":s.x2=n.x2,s.y2=t.y;break}e.push(s)}return e}optimizePath(e){const t=[];let r,n;if(e.length>0)for(r=e.shift(),t.push(r);e.length>0;)n=e.shift(),sn(r.x1,n.x1)&&sn(r.y1,n.y1)&&sn(r.x2,n.x2)&&sn(r.y2,n.y2)?r=n:sn(r.y1,r.y2)&&sn(n.y1,n.y2)?r.x2=n.x2:sn(r.x1,r.x2)&&sn(n.x1,n.x2)?r.y2=n.y2:(t.push(n),r=n);return t}};Jp._$name="RectangularPathFinder";function O0(i){return i.x1===i.x2?i.y2>i.y1?"d":"u":i.x2>i.x1?"r":"l"}function Qp(i){return i.x1===i.x2?i.y2-i.y1:i.x2-i.x1}function OA(i,e,t){const r=O0(i)+O0(e),n=t*(r.includes("l")?-1:1),s=t*(r.includes("u")?-1:1);return`a${n},${s} 0 0 ${r==="ur"||r==="lu"||r==="dl"||r==="rd"?1:0} ${n},${s}`}function $A(i,e,t,r,n){let s=i.x1===i.x2?"v":"h",a=r;if(r){const l=Qp(i),o=e?Math.abs(Qp(e)):Number.MAX_SAFE_INTEGER,d=Math.sign(l);n==null&&(n=r),(Math.abs(l)<r*2||o<r*2)&&(a=Math.min(Math.abs(l),o)/2);const c=t==="single"?0:t==="first"?a:t==="between"?n+a:n,u=l-c*d;s+=Math.sign(u)!==d?0:u,t!=="last"&&t!=="single"&&a>0&&(s+=` ${OA(i,e,a)}`)}else s+=Qp(i);return{line:s,currentRadius:r!==a?a:null}}function HA(i,e){const{length:t}=e;if(!t)return"";let r=null;return`M${e[0].x1},${e[0].y1} ${e.map((n,s)=>{const a=t===1?"single":s===t-1?"last":s===0?"first":"between",l=$A(n,e[s+1],a,i,r);return{currentRadius:r}=l,l.line}).join(" ")}`}var VA=i=>{var e;return e=class extends i{constructor(){super(...arguments),y(this,"lineCache",{})}onSVGReady(){const t=this;t.pathFinder=new Jp({...t.pathFinderConfig,client:t.client}),t.lineDefAdjusters=t.createLineDefAdjusters(),t.createMarker()}changeRadius(t){return t!==null&&T.assertNumber(t,"radius",!0),t}resetAtRuntime(){this.isConfiguring||this.reset()}updateRadius(){this.resetAtRuntime()}updateRenderer(){this.resetAtRuntime()}changeClickWidth(t){return t!==null&&T.assertNumber(t,"clickWidth",!0),t}updateClickWidth(){this.resetAtRuntime()}updateDrawAroundParents(){this.resetAtRuntime()}createMarker(){var t,r;const n=this,{markerDef:s}=n,a=this.client.svgCanvas,l=s?`${n.client.id}-arrowEnd`:"arrowEnd";(t=n.marker)==null||t.remove(),a.style.setProperty("--scheduler-dependency-marker",`url(#${l})`),n.marker=E.createElement({parent:a,id:l,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:(r=n.markerDef)!=null?r:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||(this.createMarker(),Y.isSafari&&(this.client.svgCanvas.innerHTML+=""))}getAssignmentElement(t){var r,n;return((n=(r=this.client.features.eventDrag)==null?void 0:r.getProxyElement)==null?void 0:n.call(r,t))||this.client.getElementFromAssignmentRecord(t)}getDomConfigs(t,r,n,s){var a,l;const o=this,d=o.getDependencyKey(t,r,n),c=o.lineCache[d];if(o.constructLineCache||!c||s||o.drawingLive&&(o.getAssignmentElement(r)||o.getAssignmentElement(n))){const u=o.prepareLineDef(t,r,n,s),h=u&&o.pathFinder.findPath(u,o.lineDefAdjusters),{client:g,clickWidth:f}=o,{toEvent:m}=t;if(h){const p=o.highlighted.get(t),v={tag:"path",ns:"http://www.w3.org/2000/svg",d:HA((a=o.radius)!=null?a:0,h),role:"presentation",dataset:{syncId:d,depId:t.id,fromId:r.id,toId:n.id},elementData:{dependency:t,points:h},class:{[o.baseCls]:1,[t.cls]:t.cls,[t.highlighted]:t.highlighted,[p&&[...p].join(" ")]:p,[o.noMarkerCls]:u.hideMarker,"b-inactive":t.active===!1,"b-sch-bidirectional-line":t.bidirectional,"b-readonly":t.readOnly,"b-sch-dependency-ends-outside":!m.milestone&&(g.showUnscheduledTasks&&!m.isScheduled?m._endDate<=g.startDate||g.endDate<=m._startDate:m.endDate<=g.startDate||g.endDate<=m.startDate)||m.milestone&&(m.endDate<g.startDate||g.endDate<m.startDate)}};(l=o.renderer)==null||l.call(o,{domConfig:v,points:h,dependencyRecord:t,fromAssignmentRecord:r,toAssignmentRecord:n,fromBox:u.startBox,toBox:u.endBox,fromSide:u.startSide,toSide:u.endSide});const b=[v];return f>1&&b.push({...v,class:{...v.class,"b-click-area":1},dataset:{...v.dataset,syncId:`${v.dataset.syncId}-click-area`},style:{strokeWidth:f}}),o.lineCache[d]=b}return o.lineCache[d]=null}return c}generateBoundaryBoxes(t,r){return r==="top"?[]:r==="bottom"?[{start:t.left,end:t.left+t.width/2,top:t.rowTop,bottom:t.rowBottom},{start:t.left+t.width/2,end:t.right,top:t.rowTop,bottom:t.rowBottom}]:[{start:t.left-this.pathFinder.startArrowMargin,end:t.right+this.pathFinder.startArrowMargin,top:t.rowTop,bottom:t.rowBottom}]}getAssignmentBounds(t){const{client:r}=this,n=this.getAssignmentElement(t);if(n&&!r.isExporting){const s=L.from(n,this.relativeTo);if(s.fromElement=!0,r.isHorizontal){let a=r.getRowById(t.resource.id);if(a){if(s.y<a.top||s.bottom>a.bottom){const l=r.rowManager.getRowAt(s.center.y,!0);l&&(a=l)}s.rowTop=a.top,s.rowBottom=a.bottom}else return r.getAssignmentEventBox(t,!0)}return s}return r.isEngineReady&&r.getAssignmentEventBox(t,!0)}getConnectorStartSide(t){return this.client.currentOrientation.getConnectorStartSide(t)}getConnectorEndSide(t){return this.client.currentOrientation.getConnectorEndSide(t)}getDependencyStartSide(t){const{fromEvent:r,type:n,fromSide:s}=t;if(s)return s;switch(!0){case n===mt.Type.StartToEnd:case n===mt.Type.StartToStart:return this.getConnectorStartSide(r);case n===mt.Type.EndToStart:case n===mt.Type.EndToEnd:return this.getConnectorEndSide(r);default:return this.getConnectorEndSide(r)}}getDependencyEndSide(t){const{toEvent:r,type:n,toSide:s}=t;if(s)return s;switch(!0){case n===mt.Type.EndToEnd:case n===mt.Type.StartToEnd:return this.getConnectorEndSide(r);case n===mt.Type.EndToStart:case n===mt.Type.StartToStart:return this.getConnectorStartSide(r);default:return this.getConnectorStartSide(r)}}createLineDefAdjusters(){var t;const{client:r}=this;function n(o){const{barMargin:d}=r;return o.startArrowMargin>d||o.endArrowMargin>d?(o.startArrowMargin=o.endArrowMargin=d,o):!1}function s(o){return o.startArrowMargin>0||o.endArrowMargin>0?(o.startArrowMargin=o.endArrowMargin=0,o):!1}function a(o,d){return o.horizontalMargin>2?(o.horizontalMargin=1,d.hideMarker=!0,o):!1}const l=[n,s,a];return(t=r.features.nestedEvents)!=null&&t.enabled&&l.unshift(o=>(o.otherBoxes.length&&(o.otherBoxes.length=o.otherBoxes.nestedStart),o)),l}adjustLineDef(t,r){return r}prepareLineDef(t,r,n,s){var a,l,o,d;const c=this,{client:u}=c,h=c.getDependencyStartSide(t),g=c.getDependencyEndSide(t),f=(a=s==null?void 0:s.from)!=null?a:c.getAssignmentBounds(r),m=(l=s==null?void 0:s.to)!=null?l:c.getAssignmentBounds(n),p=[];if(!f||!m)return null;let{startArrowMargin:v,verticalMargin:b}=c.pathFinder;if(u.isHorizontal){if(u.rtl){const{totalSize:w}=u.timeAxisViewModel;f&&!f.fromElement&&(f._x=w-f.x-f.width),m&&!m.fromElement&&(m._x=w-m.x-m.width)}if(f.rowTop!=null&&f.rowTop!==m.rowTop&&p.push(...c.generateBoundaryBoxes(f,h)),(o=u.features.nestedEvents)!=null&&o.enabled&&c.drawAroundParents){const{resourceStore:w}=u,D=r.resource,S=n.resource,x=w.indexOf(D),R=w.indexOf(S),M=Math.min(x,R),_=Math.max(x,R);p.nestedStart=p.length;for(const k of u.assignmentStore)if(k!==r&&k!==n&&((d=k.event)!=null&&d.isParent)&&r.event.parent!==k.event&&n.event.parent!==k.event){const F=w.indexOf(k.resource);if(F>=M&&F<=_){const I=c.getAssignmentBounds(k).inflate(v);I.isNestedParent=!0,p.push(I)}}}t.bidirectional||(/(top|bottom)/.test(h)&&(v=u.barMargin/2),b=u.barMargin/2)}return c.adjustLineDef(t,{startBox:f,endBox:m,otherBoxes:p,startArrowMargin:v,verticalMargin:b,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:h,endSide:g})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},y(e,"$name","DependencyLineGenerator"),e},NA=["start","start","end","end"],BA=["start","end","start","end"],$0=i=>{var e;return e=class extends i{changeTooltip(t,r){const n=this;if(r==null||r.destroy(),!t)return null;const s=ve.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},t);return s.element.classList.add("b-sch-dependency-tooltip"),s}updateShowTooltip(t){const r=this;r.isConfiguring&&!t||(t&&!r._tooltip&&r.tooltip,r._tooltip&&(r._tooltip.disabled=!t))}getHoverTipHtml({activeTarget:t}){return this.tooltipTemplate(this.resolveDependencyRecord(t))}},y(e,"$name","DependencyTooltip"),y(e,"configurable",{showTooltip:!0,showLagInTooltip:!1,tooltipTemplate(t){const r=this;return[{tag:"label",text:r.L("L{Dependencies.from}")},{text:t.fromEvent.name},{className:`b-sch-box b-${t.fromSide||NA[t.type]}`},{tag:"label",text:r.L("L{Dependencies.to}")},{text:t.toEvent.name},{className:`b-sch-box b-${t.toSide||BA[t.type]}`},r.showLagInTooltip&&{tag:"label",text:r.L("L{DependencyEdit.Lag}")},r.showLagInTooltip&&{text:`${t.lag||0} ${C.getLocalizedNameOfUnit(t.lagUnit,t.lag!==1)}`}]},tooltip:{$config:["nullify","lazy"],value:{}}}),e},zA={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},H0=i=>{var e;const t=[i];return(e=i.resource)!=null&&e.hasLinks&&t.push(...i.resource.$links.map(r=>({id:`${r.id}_${i.id}`,resource:r,event:i.event,drawDependencies:i.drawDependencies}))),t},_l=class extends ie.mixin(Zt,fe,P0,IA,VA,$0){constructor(){super(...arguments),y(this,"domConfigs",new Map),y(this,"drawingLive",!1),y(this,"lastScrollX",null),y(this,"highlighted",new Map),y(this,"visibleResources",null),y(this,"usingLinks",null),y(this,"visibleDateRange",null),y(this,"relativeTo",null),y(this,"generation",0)}static get pluginConfig(){return{chain:["render","onInternalPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","onElementPointerDown","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(i,e){super.construct(i,e);const{scheduledEventName:t}=i;i.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[t+"DragStart"]:"refresh",[t+"DragAbort"]:"refresh",[t+"ResizeStart"]:"refresh",[t+"SegmentDragStart"]:"refresh",[t+"SegmentResizeStart"]:"refresh",timelineViewportResize:"immediateReset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),i.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(i.store)}doDisable(i){this.isConfiguring||(this._isDisabling=i,this.draw(),this._isDisabling=!1),super.doDisable(i)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}get eventStore(){return this.client.project.eventStore}bindStore(i){const e=this;e.client.isVertical||(e.detachListeners("store"),e.client.usesDisplayStore&&(i==null||i.ion({name:"store",refresh:"onStoreRefresh",thisObj:e})),e.usingLinks=null,e.immediateReset())}onStoreRefresh(){this.reset()}attachToProject(i){super.attachToProject(i),i==null||i.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(i){super.attachToResourceStore(i),i==null||i.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(i){super.attachToEventStore(i),i==null||i.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(i){super.attachToAssignmentStore(i),i==null||i.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(i){super.attachToDependencyStore(i),i==null||i.ion({name:"dependencyStore",change:"reset",refresh:"onDependencyStoreRefresh",thisObj:this})}onDependencyStoreRefresh({action:i}){i==="dataset"&&this.generation++,this.reset()}updateDrawOnScroll(i){const e=this;e.detachListeners("scroll"),i?e.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:e}):(e.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:e}),e.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:e}))}onHorizontalScroll({subGrid:i,scrollX:e}){e!==this.lastScrollX&&i===this.client.timeAxisSubGrid&&(this.lastScrollX=e,this.draw())}onInternalPaint(){this.refresh()}static getLocalizedDependencyType(i){return i?this.L(`L{DependencyType.${i}}`):""}getElementForDependency(i,e,t){return this.getElementsForDependency(i,e,t)[0]}getElementsForDependency(i,e,t){let r=`[data-dep-id="${i.id}"]`;return e&&(r+=`[data-from-id="${e.id}"]`),t&&(r+=`[data-to-id="${t.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(r))}resolveDependencyRecord(i){var e;return(e=i.elementData)==null?void 0:e.dependency}isDependencyElement(i){return i.matches(`.${this.baseCls}`)}onElementPointerDown({target:i}){const e=this,{client:t}=e;e.enableDelete&&!t.readOnly&&i!==e.removeIconElement&&(e.removeRemoveIcon(),E.removeClsGlobally(t.svgCanvas,"b-sch-dependency-selected"))}onElementClick(i){const e=this.resolveDependencyRecord(i.target);if(e){const t=zA[i.type];i.type==="click"&&this.onDependencyClick(i.target),this.client.trigger(`dependency${t}`,{dependency:e,event:i})}}onDependencyClick(i){const e=this,{client:t}=e,{svgCanvas:r}=t,{dependency:n}=i.elementData;if(e.enableDelete&&!t.readOnly&&!n.readOnly){const s=i.getPointAtLength(t.isGanttBase?0:i.getTotalLength());t.topCanvas||(t.topCanvas=E.createElement({className:"b-sch-canvas b-sch-top-canvas",parent:t.foregroundCanvas.parentElement})),e.removeIconElement=E.createElement({className:"b-sch-dependency-remove-icon "+e.removeIconCls,retainElement:!0,style:{insetInlineStart:s.x+"px",top:s.y+"px"},dataset:{depId:n.id},elementData:{dependencyEl:i},parent:t.topCanvas}),e.removeIconElement.addEventListener("click",e.onRemoveIconClick.bind(e));for(const a of e.getElementsForDependency(n))a.classList.add("b-sch-dependency-selected"),r.moveBefore?r.moveBefore(a,null):r.appendChild(a)}}positionRemoveIcon(){var i;const{dependencyEl:e}=((i=this.removeIconElement)==null?void 0:i.elementData)||{};if(e){const t=e.getPointAtLength(this.client.isGanttBase?0:e.getTotalLength());Object.assign(this.removeIconElement.style,{insetInlineStart:t.x+"px",top:t.y+"px"})}}async removeRemoveIcon(){const{removeIconElement:i}=this;i&&(await this.client.executeAndAwaitAnimations(i,()=>i.classList.add("b-removing")),i.remove())}onRemoveIconClick({target:i}){this.client.dependencyStore.remove(i.dataset.depId),this.removeRemoveIcon()}onElementDblClick(i){return this.onElementClick(i)}onElementContextMenu(i){return this.onElementClick(i)}onElementMouseOver(i){const e=this,t=e.resolveDependencyRecord(i.target);t&&(e.client.trigger("dependencyMouseOver",{dependency:t,event:i}),e.overCls&&e.highlight(t))}onElementMouseOut(i){const e=this,t=e.resolveDependencyRecord(i.target);t&&(e.client.trigger("dependencyMouseOut",{dependency:t,event:i}),e.overCls&&e.unhighlight(t))}isDependencyVisible(i){const e=this,{rowStore:t}=e,{fromEvent:r,toEvent:n}=i;if(!r||!n)return!1;const s=r.resource,a=n.resource;return!t.isAvailable(s)||!t.isAvailable(a)?!1:r.isModel&&!s.instanceMeta(t).hidden&&!a.instanceMeta(t).hidden}updateHighlightDependenciesOnEventHover(i){const e=this;if(i){const{client:t}=e;t.ion({name:"highlightOnHover",[`${t.scheduledEventName}MouseEnter`]:r=>e.highlightEventDependencies(r.eventRecord||r.taskRecord),[`${t.scheduledEventName}MouseLeave`]:r=>e.unhighlightEventDependencies(r.eventRecord||r.taskRecord),thisObj:e})}else e.detachListeners("highlightOnHover")}highlight(i,e=this.overCls){let t=this.highlighted.get(i);t||this.highlighted.set(i,t=new Set),t.add(e);for(const r of this.getElementsForDependency(i))r.classList.add(e)}unhighlight(i,e=this.overCls){var t;const r=(t=this.highlighted)==null?void 0:t.get(i);r&&(r.delete(e),r.size||this.highlighted.delete(i));for(const n of this.getElementsForDependency(i))n.classList.remove(e)}highlightEventDependencies(i,e){i.dependencies.forEach(t=>this.highlight(t,e))}unhighlightEventDependencies(i,e){i.dependencies.forEach(t=>this.unhighlight(t,e))}getDependenciesToConsider(i,e,t,r){var n;const{eventStore:s}=this,a=(n=super.getDependenciesToConsider)==null?void 0:n.call(this,i,e,t,r);return a!=null&&a.size?a:this.project.dependencyStore.records.filter(l=>l.isValid&&!s.isFiltered||s.isAvailable(l.fromEvent)&&s.isAvailable(l.toEvent))}getDependencyKey(i,e,t){return`dep:${i.id};from:${e.id};to:${t.id};gen:${this.generation}`}drawDependency(i,e=!1,t=null){var r,n,s,a;const l=this,{domConfigs:o,client:d,rowStore:c,topIndex:u,bottomIndex:h}=l,{useInitialAnimation:g}=d,{idMap:f}=c,{startMS:m,endMS:p}=l.visibleDateRange,{fromEvent:v,toEvent:b}=i;let w=v.assigned,D=b.assigned;if(v.isScheduled&&b.isScheduled&&(w!=null&&w.size)&&(D!=null&&D.size)){l.usingLinks&&(w=[...w].flatMap(H0),D=[...D].flatMap(H0));for(const S of w)for(const x of D){const R=(n=f[(r=S.resource)==null?void 0:r.id])==null?void 0:n.index,M=(a=f[(s=x.resource)==null?void 0:s.id])==null?void 0:a.index,_=Math.min(v.startDateMS,b.startDateMS),k=Math.max(v.endDateMS,b.endDateMS);if(d.isExporting||R!=null&&M!=null&&S.drawDependencies!==!1&&x.drawDependencies!==!1&&c.isAvailable(S.resource)&&c.isAvailable(x.resource)&&!(R<u&&M<u||R>h&&M>h||_<m&&k<m||_>p&&k>p)){const F=l.getDependencyKey(i,S,x),I=l.getDomConfigs(i,S,x,t);I?(g&&(I[0].style={animationDelay:`${Math.max(R,M)/20*1e3}ms`}),o.set(F,I)):o.delete(F)}l.afterDrawDependency(i,R,M,_,k)}}e||l.domSync()}afterDrawDependency(i,e,t,r,n){var s;(s=super.afterDrawDependency)==null||s.call(this,i,e,t,r,n)}beforeDraw(){var i;(i=super.beforeDraw)==null||i.call(this)}afterDraw(){var i;(i=super.afterDraw)==null||i.call(this)}domSync(i=this.client.svgCanvas,e=!1){oe.sync({targetElement:i,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}}),e&&this.clearDomConfigs()}fillDrawingCache(){const i=this,{client:e,rowStore:t}=i;i.relativeTo=L.from(e.svgCanvas),i.visibleResources=e.visibleResources,i.visibleDateRange=e.visibleDateRange,i.topIndex=t.indexOf(i.visibleResources.first),i.bottomIndex=t.indexOf(i.visibleResources.last),i.usingLinks==null&&(i.usingLinks=t.isChainedTree||e.resourceStore.some(r=>r.hasLinks))}clearDomConfigs(){this.domConfigs.clear()}draw(){var i;const e=this,{client:t}=e,{visibleDateRange:r}=t;if(!(t.refreshSuspended||!t.foregroundCanvas||!r||!t.isEngineReady||e.disabled&&!e._isDisabling||t.isExporting)){if(e.fillDrawingCache(),e.clearDomConfigs(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&r.endMS-r.startMS>0){const{topIndex:n,bottomIndex:s}=e,a=e.getDependenciesToConsider(r.startMS,r.endMS,n,s);e.beforeDraw();for(const l of a)e.drawDependency(l,!0);e.afterDraw(),(i=e.removeIconElement)!=null&&i.isConnected&&t.waitForAnimations().then(()=>e.positionRemoveIcon())}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var i,e,t,r,n;const s=this,{client:a}=s,{scheduledEventName:l,features:o}=a;s.draw(),s.drawingLive=a.dependencyStore.count&&(a.isAnimating||a.useInitialAnimation&&s.eventStore.count||((i=o[`${l}Drag`])==null?void 0:i.isActivelyDragging)||((e=o[`${l}Drag`])==null?void 0:e.isAborting)||((t=o[`${l}Resize`])==null?void 0:t.isResizing)||((r=o[`${l}SegmentDrag`])==null?void 0:r.isActivelyDragging)||((n=o[`${l}SegmentResize`])==null?void 0:n.isResizing)),s.drawingLive&&s.refresh(!1,!0)}rafRefresh(){this.doRefresh.now()}refresh(i=this.immediateRefresh,e=!1){const t=this,{client:r}=t;!r.refreshSuspended&&!t.disabled&&r.isPainted&&!r.timeAxisSubGrid.collapsed&&(i?t.doRefresh.now():e?t.rafRefresh():t.doRefresh())}reset(i={},e=!1){var t;(t=super.reset)==null||t.call(this),this.refresh(e)}immediateReset(){this.reset({},!0)}render(){this.client.getConfig("svgCanvas")}};y(_l,"$name","Dependencies"),y(_l,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",removeIconCls:"b-icon b-icon-remove-circle",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,enableDelete:!0,drawOnScroll:!0,clickWidth:null,immediateRefresh:null,drawAroundParents:null}),y(_l,"delayable",{doRefresh:10,rafRefresh:"raf"}),_l._$name="Dependencies",K.registerFeature(_l,!1,["Scheduler","ResourceHistogram"]);var ev=class extends ft{static get defaultConfig(){return{items:[],axisLock:"flexible"}}processWidgetConfig(i){const{dependencyEditFeature:e}=this;return i.ref==="lagField"&&!e.showLagField||i.ref==="deleteButton"&&!e.showDeleteButton?!1:super.processWidgetConfig(i)}afterShow(...i){const{deleteButton:e}=this.widgetMap;e&&(e.hidden=!this.record.isPartOfStore()),super.afterShow(...i)}onInternalKeyDown(i){this.trigger("keyDown",{event:i}),super.onInternalKeyDown(i)}};y(ev,"$name","DependencyEditor"),ev._$name="DependencyEditor";var kl=class extends ie{static get pluginConfig(){return{chain:["populateDependencyMenu"]}}construct(e,t){const r=this;if(e.dependencyEdit=r,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit")}doDestroy(){var e;this.clientListenersDetacher(),(e=this.editor)==null||e.destroy(),super.doDestroy()}changeEditorConfig(e){const t=this,{autoClose:r,cls:n,client:s}=t;return T.assign({owner:s,align:"b-t",id:`${s.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:r,cls:n},e)}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!e.name||e.hidden?!0:e.isValid!==!1)}get values(){const e={};return this.editor.eachWidget(t=>{!t.name||t.hidden||(e[t.name]=t.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(e.fromSide!=null&&(t.fromSide=null),e.toSide!=null&&(t.toSide=null)),T.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){e.key==="Enter"&&this.saveAndCloseOnEnter&&e.target.tagName.toLowerCase()==="input"&&(e.preventDefault(),this.onSaveClick())}onHide(){this.isApplyingChanges||this.afterCancel()}async onSaveClick(){const e=this;e.isApplyingChanges=!0,await e.save()&&(e.afterSave(),await e.editor.hide()),e.isApplyingChanges=!1}async onDeleteClick(){const e=this;e.isApplyingChanges=!0,await e.deleteDependency()&&e.afterDelete(),await e.editor.hide(),e.isApplyingChanges=!1}onCancelClick(){this.editor.hide()}afterSave(){}afterDelete(){}afterCancel(){}internalShowEditor(e){const t=this,{client:r,lastPointerDown:n}=t,{dependencies:s}=r.features,a=t.getEditor(e),l=(s==null?void 0:s.getElementForDependency(e))||(n==null?void 0:n.target)||r.timeAxisSubGridElement,o=L.from(l);t.loadRecord(e),r.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:a});let d;n?(Object.defineProperties(n,{offsetX:{configurable:!0,value:n.clientX-o.x},offsetY:{configurable:!0,value:n.clientY-o.y}}),d={target:n,align:"t50-b0"}):d={target:l,align:"c-c"};const c=a.showBy(d),u=[];let h=0;return a.eachWidget(g=>{const{labelElement:f,element:m}=g;if(f){if(f.getBoundingClientRect().top<m.getBoundingClientRect().top)return!1;g.labelWidth=null,h=Math.max(h,f.offsetWidth),u.push(g)}}),u.forEach(g=>g.labelWidth=h),c}async editDependency(e){const t=this,{client:r}=t;return r.readOnly||e.readOnly||await r.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e})===!1?!1:(await this.internalShowEditor(e),!0)}getEditor(){var e,t,r;const n=this;let{editor:s}=n;return s||(s=n.editor=ev.new({dependencyEditFeature:n,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:n.autoClose,cls:n.cls,rootElement:n.client.rootElement,internalListeners:{keydown:n.onPopupKeyDown,hide:n.onHide,thisObj:n}},n.editorConfig),s.items.length===0&&console.warn("Editor configured without any `items`"),s.eachWidget(a=>{const l=a.ref||a.id;l&&!n[l]&&(n[l]=a)}),(e=n.saveButton)==null||e.ion({click:"onSaveClick",thisObj:n}),(t=n.deleteButton)==null||t.ion({click:"onDeleteClick",thisObj:n}),(r=n.cancelButton)==null||r.ion({click:"onCancelClick",thisObj:n}),n.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new we(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}async save(){var e;const t=this,{client:r,dependencyRecord:n}=t;if(!n||!t.isValid)return;const{dependencyStore:s,values:a}=t;if(r.trigger("beforeDependencySave",{dependencyRecord:n,values:a})!==!1){if(t.onBeforeSave(n),t.updateRecord(n),s&&!n.stores.length){if(r.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:t})===!1)return;s.add(n)}await((e=r.project)==null?void 0:e.commitAsync()),r.trigger("afterDependencySave",{dependencyRecord:n}),t.onAfterSave(n)}return n}async deleteDependency(){var e;const{client:t,editor:r,dependencyRecord:n}=this;return t.trigger("beforeDependencyDelete",{dependencyRecord:n})!==!1?(r.containsFocus&&r.revertFocus(),t.dependencyStore.remove(n),await((e=t.project)==null?void 0:e.commitAsync()),!0):!1}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDown=t,this.editDependency(e))}updateTriggerEvent(e){var t;(t=this.clientListenersDetacher)==null||t.call(this),e&&(this.clientListenersDetacher=this.client.ion({[e]:this.onActivateEditor,thisObj:this}))}populateDependencyMenu({dependencyRecord:e,items:t}){!this.client.readOnly&&!this.disabled&&(t.edit={text:"L{DependencyEdit.Edit dependency}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editDependency(e)}})}};y(kl,"$name","DependencyEdit"),y(kl,"configurable",{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:kl,closable:!0,defaults:{localeClass:kl},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const i=this.parent;return Object.keys(mt.Type).map(e=>({id:mt.Type[e],name:i.L(e),localeKey:e}))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0,highlightExternalChange:!1}},bbar:{defaults:{localeClass:kl},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}});var tv=kl;tv._$name="DependencyEdit",K.registerFeature(tv,!1);var Fl=class extends Ir{static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateDependencyMenu"),i}getDataFromEvent(i){const e=super.getDataFromEvent(i),{dependencies:t}=this.client.features,r=i.target.closest(`.${t.baseCls}`);if(r){const n=t.resolveDependencyRecord(r);return Object.assign(e,{element:r,dependencyRecord:n})}}shouldShowMenu(i){return i.dependencyRecord}populateDependencyMenu({items:i,dependencyRecord:e}){i.delete={disabled:e.readOnly,hidden:this.client.readOnly}}changeItems(i){return Z.merge({delete:{text:"L{DependencyEdit.Delete}",icon:"b-icon b-icon-trash",cls:"b-separator",weight:500,onItem({dependencyRecord:e}){e.remove()}}},i)}};y(Fl,"$name","DependencyMenu"),y(Fl,"configurable",{processItems:null,type:"dependency"}),Fl.featureClass="",Fl._$name="DependencyMenu",K.registerFeature(Fl,re.checkVersion("core","7.0",">="),["Scheduler","Gantt"]);var Il=class extends ie.mixin(fe){constructor(){super(...arguments),y(this,"cursorTrackingSuspended",0)}construct(i,e){super.construct(i,e);const{triggerEvent:t}=this,r={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clear",thisObj:this};t==="mouseover"?r.timelineContextChange="onTimelineContextChange":((t==="click"||t==="mousedown")&&(r.schedulecontextmenu="onScheduleContextGesture"),r[`schedule${t}`]="onScheduleContextGesture"),i.ion(r),i.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(i){return(i==="hover"||i==="mousemove")&&(i="mouseover"),i}changeWidget(i,e){if(i)return z.reconfigure(e,{...i,owner:this.client,positioned:!0,appendTo:this.client.timeAxisSubGridElement,hidden:!0,showAnimation:!1},this);e.destroy()}get element(){var i;return this._element||(this._element=((i=this.widget)==null?void 0:i.element)||E.createElement({parent:this.client.timeAxisSubGridElement}),this.element.classList.add("b-schedule-selected-tick")),this._element}onTimelineContextChange({context:i}){this.context=i}onScheduleContextGesture(i){this.context=i}onTimeAxisViewModelUpdate({source:i}){var e;i.timeAxis.includes((e=this.context)==null?void 0:e.tick)?this.syncContextElement():this.clear()}clear(){this.context=null}changeContext(i){var e;if(!((e=this.widget)!=null&&e.query(t=>t.floating&&t.isVisible)))return!this.shareWithEvent&&this.hasEvent(i)||!this.activateOnEvent&&(i!=null&&i.eventElement)?null:i||null}updateActivateOnEvent(i){const e=this;if(i){const{triggerEvent:t,client:r}=e;e.shareWithEvent=!0,t!=="mouseover"&&r.ion({name:"scheduleContextTrigger",[`${r.scheduledEventName}${t}`]:"onScheduleContextGesture",thisObj:e})}else e.shareWithEvent=e.config.shareWithEvent,e.detachListeners("scheduleContextTrigger")}hasEvent(i){var e;return!!(i&&((e=this.client.eventStore.getEvents({resourceRecord:i.resourceRecord,startDate:i.tickStartDate,endDate:i.tickEndDate}))!=null&&e.length))}updateContext(i,e){this.syncContextElement()}syncContextElement(){const i=this,{client:e,element:t,widget:r,context:n}=i,{isVertical:s}=e,a=n&&(s?e.rowManager.rows[0]:e.getRowFor(n.resourceRecord));if(n&&a&&this.enabled&&!n.domEvent.buttons){const l=this,{renderer:o}=l,{style:d}=t,{tickStartDate:c,tickEndDate:u,resourceRecord:h}=n,g=e.currentOrientation.getTimeSpanRenderData({startDate:c,endDate:u,startDateMS:c.getTime(),endDateMS:u.getTime()},h);let f,m,p;s?(f=g.top,m=g.resourceWidth,p=g.height):(f=a.top,m=g.width,p=a.height),n.index=a.index,t.classList.add("b-schedule-selected-tick"),t.classList.toggle("b-contains-widget",!!t.querySelector(".b-widget")),r?(r.hide(!1),n.eventRecord||(r.setConfig({width:m,height:p,timelineContext:n,x:g.left,y:f}),r.show({animate:!1}))):t&&(d.width=`${m}px`,d.height=`${p}px`,E.setTranslateXY(t,g.left,f),t.innerHTML="",o&&l.callback(o,l,[n,t]),d.display="")}else r!=null&&r.hide(!1)||(t.style.display="none")}};y(Il,"$name","ScheduleContext"),y(Il,"configurable",{triggerEvent:"click",renderer:null,widget:{$config:["lazy","nullify"],value:null},context:{$config:{equal(i,e){return(i==null?void 0:i.index)===(e==null?void 0:e.index)&&(i==null?void 0:i.tickParentIndex)===(e==null?void 0:e.tickParentIndex)&&!(((i==null?void 0:i.tickStartDate)||0)-((e==null?void 0:e.tickStartDate)||0))&&(i==null?void 0:i.eventRecord)===(e==null?void 0:e.eventRecord)}}},activateOnEvent:null,shareWithEvent:null}),Il.featureClass="b-scheduler-context",Il._$name="ScheduleContext",K.registerFeature(Il,!1,["Scheduler"]);var ms=class extends Ha.mixin(Zt){constructor(){super(...arguments),y(this,"entityName","event")}static get pluginConfig(){return{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}}construct(i,e){super.construct(i,e),i.ion({eventClick:"onEventClick",scheduleClick:"onScheduleClick",projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this})}get scheduler(){return this.client}attachToEventStore(i){super.attachToEventStore(i),delete this._eventClickedContext}onEventDataGenerated(i){const{assignmentRecord:e}=i;e&&(i.cls["b-cut-item"]=e.meta.isCut)}onEventClick(i){this._cellClickedContext=null,this._eventClickedContext=i}onScheduleClick(i){this._cellClickedContext=i,this._eventClickedContext=null}isActionAvailable({event:i,actionName:e}){return super.isActionAvailable(...arguments)&&!!i.target.closest(this.client.eventContainerSelector)}async copy(){return await this.copyEvents()}async cut(){return await this.copyEvents(void 0,!0)}async paste(){return await this.pasteEvents()}async copyEvents(i=this.scheduler.selectedAssignments,e=!1){var t;const r=this,{scheduler:n}=r;if(n.splitFrom)return n.splitFrom.features.eventCopyPaste.copyEvents(i,e);if(!(i!=null&&i.length))return;const{isEventModel:s}=i[0];e?i=i.filter(d=>s?!d.readOnly:!d.event.readOnly):i=i.slice();const a=s?i.flatMap(d=>d.assignments):i,l=a.length?a.map(d=>d.event):i;if(!a.length&&(!r.allowNoAssignments||!l.length))return;const o=(t=await r.writeToClipboard({assignmentRecords:a,eventRecords:l},e))==null?void 0:t.data;o&&(n.trigger("copy",{originalAssignmentRecords:a,originalEventRecords:l,assignmentRecords:o.assignmentRecords,eventRecords:o.eventRecords,isCut:e,entityName:r.entityName}),r.refreshClient(),r._focusedEventOnCopy=r._eventClickedContext)}async beforeCopy({data:{assignmentRecords:i,eventRecords:e},isCut:t}){return await this.scheduler.trigger("beforeCopy",{assignmentRecords:i,eventRecords:e,isCut:t,entityName:this.entityName})}handleCutData({source:i}){var e;const t=this;if(i!==t&&((e=t.cutData)!=null&&e.length)){const{assignmentRecords:r,eventRecords:n}=t.cutData[0];r!=null&&r.length&&t.scheduler.assignmentStore.remove(r),n!=null&&n.length&&t.scheduler.eventStore.remove(n)}}stringConverter({eventRecords:i}){const e=[];for(const t of i)e.push(this.eventToStringFields.map(r=>{const n=t[r];return n instanceof Date?C.format(n,this.dateFormat):n}).join("	"));return e.join(`
`)}setIsCut({assignmentRecords:i},e){i.forEach(t=>{t.meta.isCut=e}),this.refreshClient()}cloneData({data:i,isPaste:e}){const t=this,{eventStore:r}=t,n=r.modelClass,s=new Set,a=[],l=[],o=r.usesSingleAssignment||t.copyPasteAction==="clone",d=(h,g)=>{var f,m;const p=h.copy(null,!0);return e&&p.traverse(v=>{v.name=t.generateNewName(v,h,r)}),p.meta.originalResourceId=e?h.meta.originalResourceId:(f=g==null?void 0:g.resourceId)!=null?f:h.resourceId,(m=p.fieldMap)!=null&&m.resourceIds.persist&&(p.resourceIds=[]),p};let{assignmentRecords:c,eventRecords:u}=i;if(e&&!c&&!u)return i!=null&&i.length&&i[0].isModel?(u=i.map(h=>new n({...h.toJSON(),[n.idField]:void 0})),{eventRecords:u,assignmentRecords:[]}):void 0;if(e&&o)a.push(...u.map(h=>d(h)));else{let h=c;!(h!=null&&h.length)&&t.allowNoAssignments&&(h=u);for(const g of h){let f=g.isEventModel?g:r.getById(g.eventId);s.has(f)||(s.add(f),o||g.isEventModel?(f=d(f,c==null?void 0:c.find(m=>m.eventId===f.id)),f.constraintDate&&(f.constraintDate=null),a.push(f)):l.push(g.copy()))}}return{assignmentRecords:l,eventRecords:a}}async pasteEvents(i,e){var t,r,n,s,a,l,o,d,c;const u=this,{scheduler:h,copyPasteAction:g,entityName:f,unifiedPaste:m,_cellClickedContext:p,_eventClickedContext:v}=u,{eventStore:b,assignmentStore:w,resourceStore:D}=h;if(arguments.length===0&&(p?(i=p.date,e=p.resourceRecord):u._focusedEventOnCopy!==v&&(i=v.eventRecord.startDate,e=v.resourceRecord)),e&&(e=e.$original),h.splitFrom)return h.splitFrom.features.eventCopyPaste.pasteEvents(i,e);const{data:S,isCut:x,originalData:R}=(t=await u.readFromClipboard({resourceRecord:e,date:i}))!=null?t:{},M=(r=S==null?void 0:S.assignmentRecords)!=null&&r.length?S.assignmentRecords:S==null?void 0:S.eventRecords,_=[],k=[];let F,I,A;if(M!=null&&M.length){for(let P of M){let H;if(P.isEventModel?(H=P,P=null):(H=(n=P.event)!=null?n:b.getById(P.eventId),P.meta.isCut=!1),k.includes(H)||(i&&(m&&I&&(i=new Date(i.getTime()+(H.startDate-I))),I=H.startDate,H.startDate=i,H.constraintDate&&(H.constraintDate=null)),x||(b.add(H),e!=null||(e=D.getById(H.meta.originalResourceId))),k.push(H)),e){const G=D.getById((a=(s=P==null?void 0:P.resourceId)!=null?s:H.resourceId)!=null?a:H.meta.originalResourceId);if(m&&A&&!h.isCalendar){const q=D.indexOf(G)-D.indexOf(A);e=(l=D.getAt(D.indexOf(e)+q))!=null?l:D.last}!e.readOnly&&!H.isAssignedTo(e)&&(P=H.assign(e),H.traverse(q=>q.assign(e),!0)),G&&!G.readOnly&&e!==G&&!b.usesSingleAssignment&&(x||g==="clone")&&H.unassign(G),A=G}else!x&&h.isCalendar&&P&&!H.isAssignedTo(P.resourceId)&&w.add(P);P?(_.push(P),F=P):F=w.last}if(e||(e=(c=(o=_==null?void 0:_[0])==null?void 0:o.resource)!=null?c:(d=k==null?void 0:k[0])==null?void 0:d.resource),h.trigger("paste",{eventRecords:k,assignmentRecords:_,pastedEventRecords:k,originalEventRecords:R==null?void 0:R.eventRecords,originalAssignmentRecords:R==null?void 0:R.assignmentRecords,resourceRecord:e,date:i,isCut:x,entityName:f}),h.isSchedulerBase){const P=h.ion({renderEvent({assignmentRecord:H}){H===F&&(h.navigateTo(H,{scrollIntoView:!1}),P())}})}x&&await u.clearClipboard()}}async beforePaste({originalData:i,data:{assignmentRecords:e,eventRecords:t},resourceRecord:r,isCut:n,date:s}){var a;const{scheduler:l}=this,o=i==null?void 0:i.assignmentRecords;r||(r=(a=o==null?void 0:o[0])==null?void 0:a.resource);const d={assignmentRecords:e,eventRecords:t,resourceRecord:r,originalAssignmentRecords:o,originalEventRecords:i==null?void 0:i.eventRecords,date:s,isCut:n,entityName:this.entityName};let c;if(r!=null&&r.readOnly&&(c="resourceReadOnly"),!c&&!l.allowOverlap){const u=e!=null&&e.length?e:t;for(const h of u){const g=h.isAssignmentModel?h.event:h;if(!l.isDateRangeAvailable(s!=null?s:g.startDate,s?C.add(s,g.duration,g.durationUnit):g.endDate,n?g:null,r!=null?r:h.resource)){c="overlappingEvents";break}}}return c?(l.trigger("pasteNotAllowed",{...d,reason:c}),!1):await this.scheduler.trigger("beforePaste",d)}stringParser(i){const{eventStore:e,assignmentStore:t}=this.scheduler,{modifiedRecords:r}=this.setFromStringData(i,!0,e,this.eventToStringFields),n=[];for(const s of r){const a=t.createRecord({eventId:s.id});a.event=s,n.push(a)}return{eventRecords:r,assignmentRecords:n}}populateEventMenu({assignmentRecord:i,items:e}){var t;const r=this,{scheduler:n}=r;r.disabled||(e.copyEvent={text:"L{copyEvent}",localeClass:r,icon:"b-icon b-icon-copy",cls:"b-separator",weight:110,onItem:()=>{const s=n.isAssignmentSelected(i)?n.selectedAssignments:[i];r.copyEvents(s)}},n.readOnly||(e.cutEvent={text:"L{cutEvent}",localeClass:r,icon:"b-icon b-icon-cut",weight:120,disabled:i.readOnly||((t=i.event)==null?void 0:t.readOnly),onItem:()=>{const s=n.isAssignmentSelected(i)?n.selectedAssignments:[i];r.copyEvents(s,!0)}}))}populateScheduleMenu({items:i,resourceRecord:e}){const t=this,{scheduler:r}=t;!t.disabled&&!r.readOnly&&t.hasClipboardData()!==!1&&(i.pasteEvent={text:"L{pasteEvent}",localeClass:t,icon:"b-icon b-icon-paste",disabled:r.resourceStore.count===0&&!t.allowNoAssignments||(e==null?void 0:e.readOnly),weight:110,internalListeners:{item:t.onScheduleMenuPasteClick,thisObj:t}})}onScheduleMenuPasteClick({date:i,resourceRecord:e}){this.pasteEvents(i,e)}refreshClient(){this.scheduler.refreshWithTransition()}};y(ms,"$name","EventCopyPaste"),y(ms,"configurable",{nameField:"name",copyPasteAction:"clone",eventToStringFields:["name","startDate","endDate","duration","durationUnit","allDay"],unifiedPaste:!0,allowedDataSources:["EventCopyPaste","RowCopyPaste","TaskCopyPaste"],allowNoAssignments:!1}),ms.featureClass="b-event-copypaste",ms._$name="EventCopyPaste",K.registerFeature(ms,!0,"Scheduler");var pc=class extends Yp.mixin(Qh){static get configurable(){return{singleDirection:null,constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:(i,e)=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,snapToResource:re.checkVersion("core","7.0",">="),copyKey:"CTRL",copyMode:"auto",mode:"move",alwaysCopy:null}}changeMode(i){const{dragData:e,copyMode:t}=this;if((t==="event"||t==="auto"||t==="assignment"&&!this.scheduler.eventStore.usesSingleAssignment)&&(!e||e.eventRecords.every(r=>!r.isRecurring)))return i}updateMode(i){this.dragData&&(i==="copy"?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:i}))}setCopying(){const{dragData:i}=this;i&&(i.eventBarCopies.some(e=>e.isConnected)?i.eventBarCopies.forEach(e=>{e.classList.remove("b-hidden")}):i.eventBarCopies.forEach(e=>{e.classList.add("b-drag-proxy-copy"),e.classList.remove("b-hidden"),i.context.grabbedParent.appendChild(e),e.retainElement=!0}))}setMoving(){const{dragData:i}=this;i&&i.eventBarCopies.forEach(e=>{e.classList.add("b-hidden")})}get scheduler(){return this.client}onBeforeDragStart(...i){let e=super.onBeforeDragStart(...i);return e&&(this.canStartFeatureTransaction?this.startFeatureTransaction().then():(this.client.trigger("eventDragPrevented",{reason:"revision"}),e=!1)),e}onDragAbortFinalized(...i){super.onDragAbortFinalized(...i),this.rejectFeatureTransaction()}async finalize(...i){await super.finalize(...i),await this.finishFeatureTransaction()}onAfterDragStart(i){const e=this,{drag:t}=e,{context:{element:r}}=i;e.singleDirection&&(t.lockY=i.initialDirection==="horizontal",t.lockX=!t.lockY),super.onAfterDragStart(i),e.handleKeyDownOrMove(i.event),e.keyEventDetacher=V.on({element:E.getRootElement(r),keydown:e.handleKeyDownOrMove,keyup:e.handleKeyUp,thisObj:e})}onDragReset(i){var e;super.onDragReset(i),(e=this.keyEventDetacher)==null||e.call(this),this.mode="move"}onDrop(i){var e;return(e=this.dragData.eventBarCopies)==null||e.forEach(t=>t.remove()),super.onDrop(i)}getDraggableElement(i){return i==null?void 0:i.closest(this.drag.targetSelector)}resolveEventRecord(i,e=this.client){return e.resolveEventRecord(i)}isElementDraggable(i,e){var t;const r=this,{client:n}=r,s=r.getDraggableElement(i);if(!s||r.disabled||n.readOnly||i.matches('[class$="-handle"]'))return!1;const a=r.resolveEventRecord(s,n);return!a||!a.isDraggable||a.readOnly?!1:!(((t=n[`is${r.capitalizedEventName}ElementDraggable`])==null?void 0:t.call(n,s,a,i,e))===!1)}getTriggerParams(i){const{assignmentRecords:e,eventRecords:t,resourceRecord:r,browserEvent:n}=i;return{context:i,eventRecords:t,resourceRecord:r,assignmentRecords:e,domEvent:n}}getGroupedToStoreResources(i){if(i.resourcesInStore)return i.resourcesInStore;const e=this.client,t=e.isVertical?e.resourceStore:e.store;return i.resourcesInStore=[...new Set(t.getAllDataRecords().map(r=>r.$original))].filter(r=>r.isLeaf)}getIndexDiff(i){const e=this,t=e.client,r=e.currentOverClient,n=t!==r,{isVertical:s}=r,a=t.isVertical?t.resourceStore:t.store,l=s?r.resourceStore:r.store,{resourceRecord:o,newResource:d}=i;let c;if(n)c=l.indexOf(d)-a.indexOf(o.$original);else if(e.constainDragToResource)c=0;else if(s&&l.isGrouped){const u=e.getGroupedToStoreResources(i);c=u.indexOf(o.$original)-u.indexOf(d)}else c=a.indexOf(o.$original)-a.indexOf(d);return c}getNewResource(i,e,t){const r=this,n=r.client,s=r.currentOverClient,a=n!==s,{isVertical:l}=s,o=n.isVertical?n.resourceStore:n.store,d=l?s.resourceStore:s.store;let{newResource:c}=i;if(a){const u=o.indexOf(e);c=d.getAt(u+t)||c}else if(t!==0){let u;if(l&&d.isGrouped){const h=r.getGroupedToStoreResources(i);u=Math.max(Math.min(h.indexOf(e)-t,h.length-1),0),c=h[u]}else u=Math.max(Math.min(o.indexOf(e)-t,o.count-1),0),c=o.getAt(u),c.isSpecialRow&&(c=o.getNext(c,!1,!0)||o.getPrevious(c,!1,!0));c=c==null?void 0:c.$original}else c=e;return c}getDropData(i){const e=this.getIndexDiff(i);return{events:i.eventRecords.map(t=>({eventRecord:t,...this.getEventNewStartEndDates(t,i.timeDiff,this.currentOverClient)})),assignments:i.assignmentRecords.map(t=>({assignmentRecord:t,resourceRecord:this.getNewResource(i,t.resource,e)}))}}triggerBeforeEventDropFinalize(i,e,t){e.context.dropData=this.getDropData(e.context),super.triggerBeforeEventDropFinalize(i,e,t)}triggerBeforeEventDrag(i,e){return this.client.trigger(i,e)}triggerEventDrag(i,e){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(i),{startDate:i.startDate,endDate:i.endDate,newResource:i.newResource}))}triggerDragStart(i){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(i))}triggerDragAbort(i){this.client.trigger("eventDragAbort",this.getTriggerParams(i))}triggerDragAbortFinalized(i){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(i))}triggerAfterDrop(i,e){const t=this;if(t.currentOverClient.trigger("afterEventDrop",Object.assign(t.getTriggerParams(i),{valid:e})),!e){const{assignmentStore:r,eventStore:n}=t.client;t.dragData.initialAssignmentsState.find(({resource:a,assignment:l},o)=>{var d;return!r.includes(l)||!n.includes(l.event)||a.id!==((d=t.dragData.assignmentRecords[o])==null?void 0:d.resourceId)})&&t.client.refresh()}t.client.setTimeout(()=>t.client.navigator.skipNextClick=!1,10)}handleKeyDownOrMove(i){var e,t;const r=this;r.mode!=="copy"&&(r.alwaysCopy||r.isCtrlKeyPress(i)||i.key&&V.specialKeyFromEventKey(i.key)===((e=r.copyKey)==null?void 0:e.toLowerCase())||i[`${(t=r.copyKey)==null?void 0:t.toLowerCase()}Key`])&&(r.mode="copy")}handleKeyUp(i){(this.isCtrlKeyPress(i)||V.specialKeyFromEventKey(i.key)===this.copyKey.toLowerCase())&&(this.mode="move")}isCtrlKeyPress(i){return this.copyKey==="CTRL"&&i.key===(Y.ctrlKey==="ctrlKey"?"Ctrl":"Meta")}isValidDrop(i){const{newResource:e,resourceRecord:t,browserEvent:r}=i,n=i.draggedEntities[0],{target:s}=r;return e?e.isSpecialRow||e.readOnly?!1:t.$original!==e?!n.event.resources.includes(e):!0:!this.constrainDragToTimeline&&this.externalDropTargetSelector?!!s.closest(this.externalDropTargetSelector):!1}checkDragValidity(i,e){var t,r;const n=this,s=n.currentOverClient,{newResource:a}=i;let l;return a!=null&&a.readOnly?!1:(a&&n.hasOverlaps()?l={valid:!1,message:n.L("L{eventOverlapsExisting}")}:l=n.validatorFn.call(n.validatorFnThisObj||n,i,e),(!l||l.valid)&&(l=(r=(t=s.checkEventDragValidity)==null?void 0:t.call(s,i,e))!=null?r:l),l)}hasOverlaps(){const i=this,{dragData:e,currentOverClient:t}=i,{startDate:r,origStart:n}=e,s=r-n,a=i.getIndexDiff(i.dragData),{bufferIsUnavailableTime:l}=t.features.eventBuffer||{};return e.assignmentRecords.some(o=>{const d=i.getNewResource(e,o.resource,a),c=o.event,u=l&&c.outerStartDate||c.startDate,h=l&&c.outerEndDate||c.endDate,g=C.add(u,s,"ms"),f=C.add(h,s,"ms");return!i.currentOverClient.isDateRangeAvailable(g,f,e.assignmentRecords,d)})}async updateRecords(i){const e=this,t=e.client,r=e.currentOverClient,n=e.mode==="copy",{draggedEntities:s,timeDiff:a,initialAssignmentsState:l}=i,o=l[0].startDate,d=e.adjustStartDate(o,a);let c;return i.externalDropTarget||(r.timeAxis.timeSpanInAxis(d,C.add(d,s[0].event.rawDurationMS,"ms"))||(i.valid=!1),i.valid&&(t.eventStore.suspendAutoCommit(),r.eventStore.suspendAutoCommit(),c=await e.updateAssignments(t,r,i,n),t.eventStore.resumeAutoCommit(),r.eventStore.resumeAutoCommit())),i.valid&&r.trigger("eventDrop",Object.assign(e.getTriggerParams(i),{isCopy:n,copyMode:e.copyMode,domEvent:i.browserEvent,targetEventRecord:i.targetEventRecord,targetResourceRecord:i.newResource,externalDropTarget:i.externalDropTarget})),c}async updateAssignments(i,e,t,r){var n,s,a;const l=this,{copyMode:o}=l,d=i!==e,{isVertical:c}=e,{assignmentStore:u,eventStore:h}=i,{assignmentStore:g,eventStore:f}=e,m=i.isVertical?i.resourceStore:i.store,{eventRecords:p,assignmentRecords:v,timeDiff:b,initialAssignmentsState:w,newResource:D}=t,{unifiedDrag:S}=l,x=f.usesSingleAssignment||f.usesSingleAssignment!==!1&&h.usesSingleAssignment,R=o==="event"?"event":o==="assignment"?"assignment":x?"event":"assignment",M=l.adjustStartDate(v[0].event.startDate,b),_=[],k=[],F=[],I=[],A=[],P=new Set;i.suspendRefresh(),e.suspendRefresh();let H=!1,G=!1;const q=l.getIndexDiff(t);c&&p.forEach((J,Q)=>{const X=t.eventBarEls[Q];delete J.instanceMeta(i).hasTemporaryDragElement,X.dataset.transient&&X.remove()});const W=t.eventBarEls.slice(),j=[],se={};for(let J=0;J<v.length;J++){const Q=v[J];let X=Q.event,ee;if(r?(ee=Q.copy(),se[Q.id]=ee):ee=Q,!ee.isOccurrenceAssignment&&(!u.includes(Q)||!h.includes(X))){W[J].remove(),W.splice(J,1),v.splice(J,1),J--;continue}const ce=w[J],ae=X,Ie=ce.startDate,ue=ce.resource,Ne=this.constrainDragToTimeSlot?Ie:S?M:l.adjustStartDate(Ie,b);if(!u.equals(g)){const xe=ae.assignments.length>1||r;let he;r?he=ee:(he=ee.copy(),se[ee.id]=he),he.event&&!x&&(he.event=he.event.id,he.resource=he.resource.id),r||I.push(ee),xe||k.push(ae),(r&&(o==="event"||o==="auto"&&f.usesSingleAssignment)||!f.getById(ae.id))&&(X=f.createRecord({...ae.data,children:(n=ae.children)==null?void 0:n.map(st=>st.copy()),id:r&&(o==="event"||o==="auto")?void 0:ae.id,calendar:null}),he.set({eventId:X.id,event:X}),_.push(X)),x||F.push(he),ee=he}let ye=D,Ee=null;S||(ye=l.getNewResource(t,ue,q)||D),ye=ye.$original;const Ye=ee.resourceId!==ye.id;if(Ye){if(Ee=m.getById(ee.resourceId),r&&u.equals(g)){ee.setData({resource:null,resourceId:null}),ee.resource=ye,ee.event=f.getById(ee.eventId);const xe=o==="event"||h.usesSingleAssignment&&o==="auto";xe&&(X=X.copy(),X.meta.endDateCached=l.adjustStartDate(X.endDate,b),X.endDate=null,ee.event=X,f.usesSingleAssignment&&(X.resource=ye,X.resourceId=ye.id)),!g.find(he=>he.eventId===ee.eventId&&he.resourceId===ee.resourceId)&&!F.find(he=>he.eventId===ee.eventId&&he.resourceId===ee.resourceId)&&(xe&&_.push(X),F.push(ee))}else ee.resource=ye,x?ee.event.resourceId=ye.id:ee.resourceId=ye.id;X.isEvent&&P.add(X),H=!0,X.isOccurrence&&X.set("newResource",ye),d&&x&&(X.resourceId=ye.id)}else r&&(o==="event"||o==="auto"&&h.usesSingleAssignment)&&!_.includes(X)&&(X=X.copy(),X.meta.endDateCached=l.adjustStartDate(X.endDate,b),X.endDate=null,_.push(X),ee.event=X,f.usesSingleAssignment&&X.set({resource:ye,resourceId:ye.id}),F.push(ee));if(!A.find(xe=>xe.draggedEvent===X)&&!C.isEqual(X.startDate,Ne)){for(;!X.isOccurrence&&X.isBatchUpdating;)X.endBatch(!0);r&&!d&&!x&&R==="assignment"&&Ye||(X.startDate=Ne,A.push({draggedEvent:X,originalStartDate:Ie})),X.isEvent&&P.add(X),G=!0}e.processEventDrop({eventRecord:X,resourceRecord:ye,element:J===0?t.context.element:t.context.relatedElements[J-1],context:t,toScheduler:e,reassignedFrom:Ee,eventsToAdd:_,addedEvents:j,draggedAssignment:ee}),e.trigger("processEventDrop",{originalAssignment:Q,draggedAssignment:ee,context:t,copyMode:o,isCopy:r})}if(u.remove(I),h.remove(k),g.add(F),r&&u.equals(g)){const{syncIdMap:J}=i.foregroundCanvas;Object.entries(se).forEach(([Q,X])=>{const ee=J[Q];delete J[Q],J[X.id]=ee})}if(_.length&&j.push(...f.add(_)),j==null||j.forEach(J=>P.add(J)),(I.length||k.length||F.length||_.length)&&(H=!0),H||G){if(!l.constrainDragToTimeline)for(let X=0;X<v.length;X++){const ee=se[v[X].id]||v[X],ce=ee.event,ae=(j==null?void 0:j.find(ye=>ye.id===ce.id))||ce,Ie=t.eventBarEls[X],ue=X===0?t.context.element:t.context.relatedElements[X-1],Ne=e.isInTimeAxis(ae);if(delete ae.meta.endDateCached,r||oe.removeChild(Ie.parentElement,Ie),ae.resource&&(c||e.rowManager.getRowFor(ee.resource))&&Ne){if(!ae.parent||ae.parent.isRoot){const ye=L.from(ue,e.foregroundCanvas,!0),Ee=e.rtl?e.timeAxisViewModel.totalSize-ye.right:ye.x;E.setTopInsetInlineStart(ue,ye.y,Ee),oe.addChild(e.foregroundCanvas,ue,ae.assignments[0].id),d&&e.processCrossSchedulerEventDrop({eventRecord:ae,toScheduler:e})}ue.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),ue.retainElement=!1}else ue.remove()}x&&P.forEach(X=>X.beginBatch());const J=(s=f.$master.project)!=null?s:e.project,Q=(a=h.$master.project)!=null?a:i.project;await Promise.all([J!==Q?J.commitAsync():null,Q.commitAsync()]),x&&P.forEach(X=>X.endBatch(!1,!0))}H||(H=A.some(({draggedEvent:J,originalStartDate:Q})=>!C.isEqual(J.startDate,Q))),e.resumeRefresh(!1),i.resumeRefresh(!1),v.length>0&&(H?(W.forEach(J=>delete J.lastDomConfig),e.refreshWithTransition(),d&&(i.refreshWithTransition(),e.selectedEvents=j)):t.valid=!1)}getProductDragContext(i){const e=this,{currentOverClient:t}=e,r=i.browserEvent.target,n=i.newResource||i.resourceRecord,s=i.targetEventRecord;let a=t?e.resolveEventRecord(r,t):null,l,o;if(i.eventRecords.includes(a)&&(a=null),e.constrainDragToResource?l=i.resourceRecord:e.constrainDragToTimeline?t&&(l=e.resolveResource()||i.newResource||i.resourceRecord):l=e.resolveResource(),a&&!a.isParent&&!a.parent){const g=r.parentElement.dataset.resourceId;l&&g!=l.id&&(a=t.eventStore.getEvents({startDate:i.startDate,endDate:i.endDate,resourceRecord:l})[0])}const{assignmentRecords:d,eventRecords:c}=i,u=n!==l;let h=!!(l&&!l.isSpecialRow);return!l&&e.externalDropTargetSelector&&(o=r.closest(e.externalDropTargetSelector),h=!!o),{valid:h,externalDropTarget:o,eventRecords:c,assignmentRecords:d,newResource:l,targetEventRecord:a,dirty:u||a!==s,proxyElements:[i.context.element,...i.context.relatedElements||[]]}}getMinimalDragData(i){const e=this,{scheduler:t}=e,r=e.getElementFromContext(i),n=e.resolveEventRecord(r,t),s=t.resolveResourceRecord(r),a=t.resolveAssignmentRecord(r);let l=a?[a]:[];a&&(t.isAssignmentSelected(l[0])||e.drag.startEvent.ctrlKey&&t.multiEventSelect)&&l.push.apply(l,e.getRelatedRecords(a)),l=l.filter(d=>t.resourceStore.isAvailable(d.resource));const o=[...new Set(l.map(d=>d.event))];return{eventRecord:n,resourceRecord:s,assignmentRecord:a,eventRecords:o,assignmentRecords:l}}setupProductDragData(i){var e;const t=this,{scheduler:r}=t,n=t.getElementFromContext(i),{eventRecord:s,resourceRecord:a,assignmentRecord:l,assignmentRecords:o}=t.getMinimalDragData(i),d=[];if(t.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);let c;if(t.constrainDragToTimeline){c=(e=t.getDateConstraints)==null?void 0:e.call(t,a,s);const u=t.constrainRectangle=t.getConstrainingRectangle(c,a,s),h=L.from(n,r.timeAxisSubGridElement),g=!!c.start;super.setupConstraints(u,h,r.timeAxisViewModel.snapPixelAmount,g&&r.isHorizontal,g&&r.isVertical)}return o.forEach(u=>{let h=r.getElementFromAssignmentRecord(u,!0,!1,r.isLockedRowsView);h||(h=r.currentOrientation.addTemporaryDragElement(u.event,u.resource)),d.push(h)}),{record:l,draggedEntities:o,dateConstraints:c!=null&&c.start?c:null,eventBarCopies:d.map(u=>t.createProxy(u)),eventBarEls:d}}getDateConstraints(i,e){var t;const{scheduler:r}=this,n=(t=r.getDateConstraints)==null?void 0:t.call(r,i,e);let s,a;return this.constrainDragToTimeSlot?(s=e.startDate,a=e.endDate):n&&(s=n.start||new Date(0),a=n.end||new Date(9999,0,1)),{start:s,end:a}}getConstrainingRectangle(i,e,t){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&e,t,!0,i&&{start:i.start,end:i.end})}getDragData(i){const e=this.getMinimalDragData(i)||{};return{...super.getDragData(i),...e,initialAssignmentsState:e.assignmentRecords.map(t=>({startDate:t.event.startDate,resource:t.resource,assignment:t}))}}getRelatedRecords(i){return this.scheduler.selectedAssignments.filter(e=>e!==i&&!e.resource.readOnly&&e.event.isDraggable)}getCoordinate(i,e,t){const r=this.currentOverClient;if(r.isHorizontal){let n=t[0];if(r.milestoneLayoutMode!=="default"&&i.isMilestone)switch(r.milestoneAlign){case"center":n+=e.offsetWidth/2;break;case"end":n+=e.offsetWidth;break}return n}else{let n=t[1];if(r.milestoneLayoutMode!=="default"&&i.isMilestone)switch(r.milestoneAlign){case"center":n+=e.offsetHeight/2;break;case"end":n+=e.offsetHeight;break}return n}}resolveResource(){const i=this,e=i.currentOverClient,{isHorizontal:t}=e,{context:r,browserEvent:n,dragProxy:s}=i.dragData,a=s||r.element,l=L.from(a,null,!0),o=e.isVertical||i.unifiedDrag?r.clientY:l.center.y,d=L.from(a,e.timeAxisSubGridElement,!0),{x:c,y:u}=d.center;let h=null,g;if(n.touches?g=L.from(e.element).contains(ti.from(n,!0)):g=e.element.contains(i.getMouseMoveEventTarget(n)),g)if(t){const f=e.rowManager.getRowAt(o);h=f&&e.store.storage.getAt(f.dataIndex)}else h=e.resolveResourceRecord(e.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[c,u]);return h==null?void 0:h.$original}getRecordElement(i){return this.client.getElementFromAssignmentRecord(i,!0)}getProxyElement(i){var e;const{dragData:t}=this;if(this.isDragging&&((e=t==null?void 0:t.proxyElements)!=null&&e.length)){const r=t.assignmentRecords.indexOf(i);if(r>=0)return t.proxyElements[r]}return null}getMouseMoveEventTarget(i){return i.target}};y(pc,"$name","EventDrag"),pc._$name="EventDrag",K.registerFeature(pc,!0,"Scheduler"),K.registerFeature(pc,!1,"ResourceHistogram");var Al=class extends tg{get scheduler(){return this.client}get store(){return this.client.eventStore}get project(){return this.client.project}updateLockLayout(i){this.dragActiveCls=`b-dragcreating${i?" b-dragcreate-lock":""}`}handleBeforeDragCreate(i,e,t){var r;const n=this,{scheduler:s}=n,{resourceRecordLink:a,resourceRecord:l}=i;if(n.disabled||l.readOnly||!(s.resourceStore.isAvailable(l)||a&&s.store.isAvailable(a))||!s.isDateRangeAvailable(i.mousedownDate,i.mousedownDate,null,l))return!1;const o=!s.isSchedulerPro||e.ignoreResourceCalendar||l.isWorkingTime(i.mousedownDate),d=o&&s.trigger("beforeDragCreate",{resourceRecord:l,date:i.mousedownDate,event:t});return n.dateConstraints=(r=s.getDateConstraints)==null?void 0:r.call(s,l,e),d}dragStart(i){var e,t,r;const n=this,{client:s}=n;if((t=(e=s.project)==null?void 0:e.stm)!=null&&t.isNavigatingRevisions)return s.trigger("eventDragCreatePrevented",{reason:"revision"}),!1;const{eventStore:a,assignmentStore:l,enableEventAnimations:o,enableTransactionalFeatures:d}=s,{resourceRecordLink:c,resourceRecord:u}=i,h=n.createEventRecord(i),g=[u];if(h.set("duration",C.diff(h.startDate,h.endDate,h.durationUnit,!0)),h.isCreating=!0,h.meta.isDragCreating=!0,s.features.taskEdit&&s.features.taskEdit.doCancel(),n.handleBeforeDragCreate(i,h,i.event)===!1)return!1;n.captureStm(!0);let f=[];if(u&&(a.usesSingleAssignment||!d?f=l.assignEventToResource(h,u):f=[l.createRecord({event:h,resource:u})]),s.trigger("beforeEventAdd",{eventRecord:h,resourceRecords:g,assignmentRecords:f})===!1)return(a.usesSingleAssignment||!d)&&l.remove(f),!1;n.lockLayout&&(h.meta.excludeFromLayout=!0),(r=s.onEventCreated)==null||r.call(s,h),s.enableEventAnimations=!1;const m=a.add(h);return this.project.commitAsync().then(()=>s.enableEventAnimations=o),m?(!a.usesSingleAssignment&&d&&l.add(f[0]),s.isCreating=!0,s.isHorizontal?s.rowManager.renderRows([s.getRowFor(c||u)]):s.refreshRows(),s.isCreating=!1,i.itemElement=i.element=s.getElementFromEventRecord(h),E.isInView(i.itemElement)||s.scrollable.scrollIntoView(i.itemElement,{animate:!0,edgeOffset:s.barMargin}),super.dragStart(i)):((a.usesSingleAssignment||!d)&&l.remove(f),!1)}checkValidity(i,e){const t=this,{client:r}=t,n=i.resourceRecord=t.dragging.resourceRecord;return r.isDateRangeAvailable(i.startDate,i.endDate,i.eventRecord,n)?t.createValidatorFn.call(t.validatorFnThisObj||t,i,e):{valid:!1,message:t.L("L{EventDrag.eventOverlapsExisting}")}}isRowEmpty(i){const e=this.store.getEventsForResource(i);return!e||!e.length}createEventRecord(i){const e=this,{client:t}=e,r=t.isHorizontal?"X":"Y",{timeAxis:n,eventStore:s,weekStartDay:a}=t,{event:l,mousedownDate:o}=i,d=e.draggingEnd=l[`page${r}`]>i.startEvent[`page${r}`],c={name:s.modelClass.fieldMap.name.defaultValue||e.L("L{Object.newEvent}"),startDate:d?C.floor(o,n.resolution,null,a):o,endDate:d?o:C.ceil(o,n.resolution,null,a)};return t.project.isGanttProjectMixin&&T.assign(c,{constraintDate:c.startDate,constraintType:"startnoearlierthan"}),s.createRecord(c)}async internalUpdateRecord(i,e){await super.internalUpdateRecord(i,e),this.client.hasEventEditor||(i.eventRecord.isCreating=!1)}async finalizeDragCreate(i){const{meta:e}=i.eventRecord;e.excludeFromLayout=!1,e.isDragCreating=!1;const t=await super.finalizeDragCreate(i);return t?this.hasStmCapture=!1:await this.freeStm(!0),t}async cancelDragCreate(i){var e;await super.cancelDragCreate(i),await this.freeStm(!1),await((e=this.afterCancel)==null?void 0:e.call(this))}getTipHtml(...i){const e=super.getTipHtml(...i),{element:t}=this.tip;return t.classList.add("b-sch-dragcreate-tooltip"),t.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),e}onAborted(i){var e,t;const{eventRecord:r,resourceRecord:n}=i.eventContexts[0];(t=(e=this.store).unassignEventFromResource)==null||t.call(e,r,n),this.store.remove(r)}};y(Al,"$name","EventDragCreate"),y(Al,"configurable",{validatorFn:()=>!0}),Al._$name="EventDragCreate",K.registerFeature(Al,!0,"Scheduler"),K.registerFeature(Al,!1,"ResourceHistogram");var ng=class extends fe(ie){constructor(){super(...arguments),y(this,"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid")}construct(i,e){i.multiEventSelect=!0,super.construct(i,e)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(i){const e=this,{client:t}=e,{foregroundCanvas:r}=t,{target:n,button:s,touches:a,clientX:l,clientY:o}=i,d=L.from(r,!0);a||s!==0||e.disabled||!n.matches(e.targetSelector)||t.trigger("beforeEventDragSelect",{event:i})===!1||(t.preventDragSelect=!0,e.startX=l-d.x,e.startY=o-d.y,e.element||(e.element=E.createElement({className:"b-dragselect-rect",retainElement:!0})),t.foregroundCanvas.appendChild(e.element),e.element.style.transform=`translate(${e.startX}px, ${e.startY}px)`,t.navigator.disabled=!0,e.mouseUpDetacher=V.on({element:document,mouseup:"onDocumentMouseUp",thisObj:e,capture:!0}))}get eventRectangles(){const{client:i}=this;return Array.from(i.foregroundCanvas.children).filter(t=>t.matches(`${i.eventSelector}, .b-nested-events-container`)).map(t=>{const r=i.resolveAssignmentRecord(t);return{rectangle:L.from(t,!0),record:r,selected:i.selectedAssignments.includes(r)}})}onElementMouseMove(i){const e=this,{client:t}=e;if(typeof e.startX=="number"){const r=e.rectangle=L.from(e.client.foregroundCanvas,!0),n=Math.min(Math.max(i.clientX-r.x,0),r.width+1),s=Math.min(Math.max(i.clientY-r.y,0),r.height+1),a=new L(Math.min(n,e.startX),Math.min(s,e.startY),Math.abs(n-e.startX),Math.abs(s-e.startY));E.setTranslateXY(e.element,a.x,a.y),e.element.style.width=`${a.width}px`,e.element.style.height=`${a.height}px`,e.dragging||(t.element.classList.add("b-dragselecting"),!i.ctrlKey&&!i.metaKey&&t.clearEventSelection(),e.originalSelection=t.selectedAssignments.slice(),e.subGridElementRect=L.from(t.timeAxisSubGridElement,!0),t.navigator.disabled=!0,t.enableScrollingCloseToEdges(t.timeAxisSubGrid),e.dragging=!0),e.updateSelection()}}onDocumentMouseUp(i){var e;const t=this,{client:r}=t,{selectedAssignments:n,navigator:s}=r,a=L.from(r.timeAxisSubGridElement);r.disableScrollingCloseToEdges(r.timeAxisSubGrid),!t.dragging&&r.deselectAllOnScheduleClick&&r.clearEventSelection(),t.element&&(t.element.style="",t.element.remove()),r.element.classList.remove("b-dragselecting"),t.startX=t.startY=null,s.skipNextClick=a.contains(ti.from(i,!0)),s.disabled=!1,t.dragging=!1,n.length&&(s.skipScrollIntoView=!0,r.activeAssignment=n[n.length-1],(e=s.activeItem)==null||e.focus(),s.skipScrollIntoView=!1),t.mouseUpDetacher(),r.trigger("afterEventDragSelect")}updateSelection(){const i=this,e=i.rectangle=L.from(i.element,!0),{eventRectangles:t,client:r}=i,n=r.selectedAssignments.reduce((a,l)=>(r.getElementFromAssignmentRecord(l)||a.push(l),a),[]);for(const a of t)e.intersect(a.rectangle,!0,!0)&&r.isEventSelectable(a.record.event)!==!1&&(a.selected=!0,n.push(a.record));n.push(...i.originalSelection),r.selectedAssignments=n;const s=r.getStartEndDatesFromRectangle(e,void 0,void 0,void 0,!1);r.trigger("eventDragSelect",{startDate:s.start,endDate:s.end,rectangle:e,selectedAssignments:r.selectedAssignments,selectedEvents:r.selectedEvents})}};y(ng,"$name","EventDragSelect"),ng._$name="EventDragSelect",K.registerFeature(ng,!1,"Scheduler");var ps=class extends ft{revertFocus(){var i,e,t;const{owner:r}=this,n=(i=this.focusInEvent)==null?void 0:i.relatedTarget;n&&!E.isFocusable(n)&&r.isTimelineBase&&((t=(e=r.focusedCell)==null?void 0:e.cell)==null||t.focus()),super.revertFocus()}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain(i=>!i.isSpecialRow,null,{storeClass:pe,excludeCollapsedRecords:!1})}processWidgetConfig(i){var e;if((e=i.type)!=null&&e.includes("date")&&i.weekStartDay==null&&(i.weekStartDay=this.weekStartDay),i.type==="extraItems")return!1;const{eventEditFeature:t}=this,r={};if(i.ref==="resourceField"){const{store:n}=i;i.store=this.chainResourceStore(),n&&i.store.setConfig(n),"multiSelect"in i||(i.multiSelect=!t.eventStore.usesSingleAssignment)}return(i.name==="startDate"||i.name==="endDate")&&i.type==="date"&&(r.format=t.dateFormat),(i.name==="startDate"||i.name==="endDate")&&i.type==="time"&&(r.format=t.timeFormat),Object.assign(i,r),super.processWidgetConfig(i)}setupEditorButtons(){const{record:i}=this,{deleteButton:e}=this.widgetMap;e&&(e.hidden=this.readOnly||i.isCreating)}onInternalBeforeShow(...i){this.setupUIForEditing()}onBeforeToggleReveal({reveal:i}){i&&this.setupUIForEditing()}setupUIForEditing(){const i=this,{record:e,titleRenderer:t}=i;i.setupEditorButtons(),i.ariaLabel=i.L("L{Object.editing}",e.name),t&&(i.title=i.callback(t,i,[e]))}onInternalKeyDown(i){this.trigger("keyDown",{event:i}),i.key==="Escape"?(i.stopImmediatePropagation(),this.eventEditFeature.onCancelClick()):super.onInternalKeyDown(i)}close(i){const{eventEditFeature:e}=this;if(!(e!=null&&e.editingContext)||i===e){if(!this.isClosing){this.isClosing=!0;try{super.close()}finally{this.isClosing=!1}}}else e.onCancelClick()}updateReadOnly(i){const{deleteButton:e,saveButton:t,cancelButton:r}=this.widgetMap;super.updateReadOnly(i),e&&(e.hidden=i),t&&(t.hidden=i),r&&(r.hidden=i)}};y(ps,"type","eventeditor"),y(ps,"$name","EventEditor"),y(ps,"configurable",{items:[],axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null,maximizeOnMobile:!0,internalListeners:{beforeShow:"onInternalBeforeShow"}}),ps.initClass(),ps._$name="EventEditor";var vs=class extends Ze{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}};y(vs,"$name","RecurrenceFrequencyCombo"),y(vs,"type","recurrencefrequencycombo"),y(vs,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1,picker:{align:{matchSize:"min"}}}),vs.initClass(),vs._$name="RecurrenceFrequencyCombo";var vc=class extends vs{static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){const i=this;return[{value:"none",text:"L{None}"},...super.buildItems(),{value:i.customValue,text:"L{Custom}",cls:i.splitCls}]}set value(i){i=i||"none",super.value=i}get value(){return super.value}set recurrence(i){const e=this;i?e.value=e.isCustomRecurrence(i)?e.customValue:i.frequency:e.value=null}isCustomRecurrence(i){const{interval:e,days:t,monthDays:r,months:n}=i;return!!(e>1||t&&t.length||r&&r.length||n&&n.length)}};y(vc,"$name","RecurrenceCombo"),y(vc,"type","recurrencecombo"),vc.initClass(),vc._$name="RecurrenceCombo";var yc=class extends Lt{static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(i){this._recurrence=i,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(i){this._eventStartDate=i,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:i}=this;this.text=i?fc.getLegend(i,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}};y(yc,"$name","RecurrenceLegendButton"),y(yc,"type","recurrencelegendbutton"),yc.initClass(),yc._$name="RecurrenceLegendButton";var bc=class extends Ze{static get defaultConfig(){const i=["SU","MO","TU","WE","TH","FR","SA"],e=i.join(",");return{allDaysValue:e,editable:!1,defaultValue:e,workingDaysValue:i.filter((t,r)=>!C.nonWorkingDays[r]).join(","),nonWorkingDaysValue:i.filter((t,r)=>C.nonWorkingDays[r]).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const i=this;return i._weekDays=null,i.weekDays.concat([{value:i.allDaysValue,text:i.L("L{day}"),cls:i.splitCls},{value:i.workingDaysValue,text:i.L("L{weekday}")},{value:i.nonWorkingDaysValue,text:i.L("L{weekend day}")}])}get weekDays(){const i=this;if(!i._weekDays){const e=C.weekStartDay,t=C.getDayNames().map((r,n)=>({text:r,value:nt.encodeDay(n)}));i._weekDays=t.slice(e).concat(t.slice(0,e))}return i._weekDays}set value(i){const e=this;i&&Array.isArray(i)&&(i=i.join(",")),(!i||!e.store.findRecord("value",i))&&(i=e.defaultValue),super.value=i}get value(){let i=super.value;return i&&Array.isArray(i)&&(i=i.join(",")),i}};y(bc,"$name","RecurrenceDaysCombo"),y(bc,"type","recurrencedayscombo"),bc.initClass(),bc._$name="RecurrenceDaysCombo";var an=class extends Pn{updateItemText(i){const e=nt.decodeDay(i.value)[0],t=C.getDayName(e);i.text=t.substring(0,this.dayNameLength),i.tooltip=t}changeItems(i){if(i===!0){const e=C.weekStartDay,t=C.getDayNames().map((r,n)=>({text:r.substring(0,this.dayNameLength),tooltip:r,value:nt.encodeDay(n),pressedCls:this.pressedCls,dataset:{dayIndex:n}}));i=t.slice(e).concat(t.slice(0,e)),i=super.changeItems(i)}return i}set value(i){(i==null?void 0:i.length)>0&&typeof i[0]=="number"&&(i=i.map(e=>nt.encodeDay(e))),i&&Array.isArray(i)&&(i=i.join(this.separator)),super.value=i}get value(){let i=super.value;return i&&Array.isArray(i)&&(i=i.join(this.separator)),i}get valueAsDayNumbers(){return this.value?this.value.split(this.separator).map(i=>nt.decodeDay(i)[0]):[]}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}};y(an,"$name","DayButtons"),y(an,"type","daybuttons"),y(an,"defaultConfig",{value:null,items:!0}),y(an,"configurable",{pressedCls:"b-raised b-blue",dayNameLength:1,separator:",",defaults:{toggleable:!0}}),an.initClass(),an._$name="DayButtons";var Cc=class extends an{};y(Cc,"$name","RecurrenceDaysButtonGroup"),y(Cc,"type","recurrencedaysbuttongroup"),Cc.initClass(),Cc._$name="RecurrenceDaysButtonGroup";var Ll=class extends Pn{get minValue(){return 1}get maxValue(){return 31}construct(i={}){i.items=this.buildItems(),super.construct(i)}buildItems(){const i=[];for(let e=this.minValue;e<=this.maxValue;e++)i.push({text:e+"",value:e});return i}};y(Ll,"$name","RecurrenceMonthDaysButtonGroup"),y(Ll,"type","recurrencemonthdaysbuttongroup"),y(Ll,"configurable",{defaults:{toggleable:!0}}),Ll.initClass(),Ll._$name="RecurrenceMonthDaysButtonGroup";var Pl=class extends Pn.mixin(cd){construct(i={}){i.items=this.buildItems(),super.construct(i)}buildItems(){return C.getMonthNames().map((i,e)=>({text:i.substring(0,3),value:e+1}))}updateItemText(i){i.text=C.getMonthName(i.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}};y(Pl,"$name","RecurrenceMonthsButtonGroup"),y(Pl,"type","recurrencemonthsbuttongroup"),y(Pl,"configurable",{defaults:{toggleable:!0}}),Pl.initClass(),Pl._$name="RecurrenceMonthsButtonGroup";var Ol=class extends Ze{buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(i){i=i||"never",super.value=i}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(i){let e=null;i.endDate?e="date":i.count&&(e="count"),this._recurrence=i,this.value=e}};y(Ol,"$name","RecurrenceStopConditionCombo"),y(Ol,"type","recurrencestopconditioncombo"),y(Ol,"configurable",{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}),Ol.initClass(),Ol._$name="RecurrenceStopConditionCombo";var wc=class extends Ze{static get defaultConfig(){return{editable:!1,splitCls:"b-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return pe.new({fields:["value","text","cls"],data:this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])})}buildDayNumbers(){return B.populate(this.maxPosition,i=>({value:i+1,text:this.L(`position${i+1}`)}))}set value(i){i&&Array.isArray(i)&&(i=i.join(",")),(!i||!this.store.findRecord("value",i))&&(i=this.defaultValue),super.value=i}get value(){const i=super.value;return i?`${i}`.split(",").map(e=>parseInt(e,10)):[]}};y(wc,"$name","RecurrencePositionsCombo"),y(wc,"type","recurrencepositionscombo"),wc.initClass(),wc._$name="RecurrencePositionsCombo";var $l=class extends Xe{changeItems(i,e){const t=super.changeItems(i,e),{positionAndDayRadioField:r,monthDaysNumberRadioField:n,monthDaysNumberField:s}=this.widgetMap;return n?r.label=this.L("L{RecurrenceEditor.the}"):(r.label=this.L("L{RecurrenceEditor.On the}"),s&&t.remove(s)),t}setupWidgetConfig(i){return Y.isMobile&&!("editable"in i)&&(i.editable=!1),super.setupWidgetConfig(...arguments)}updateRecord(i){var e,t,r;super.updateRecord(i);const n=this,{frequencyField:s,daysButtonField:a,monthDaysButtonField:l,monthDaysNumberField:o,monthsButtonField:d,monthDaysRadioField:c,monthDaysNumberRadioField:u,positionAndDayRadioField:h,stopRecurrenceField:g}=n.widgetMap;if(i){const f=i.getDateValues();f&&((e=i.days)!=null&&e.length||(a.value=f.days),(t=i.monthDays)!=null&&t.length||(l&&(l.value=f.monthDays),o&&(o.value=f.monthDays[0])),!((r=i.months)!=null&&r.length)&&d&&(d.value=f.months[0])),a.value&&i.positions?(h.check(),n.isPainted||c.uncheck()):l!=null&&l.value&&(u&&!u.hidden?u.check():c.check(),(!n.isPainted||!n.element.isConnected)&&h.uncheck()),g&&(g.recurrence=i)}else s.value="NONE"}get valuesCleanState(){return{frequency:null,interval:null,days:null,months:null,monthDays:null,positions:null,endDate:null,count:null}}processValues(i){"monthDays"in i&&(typeof i.monthDays=="string"?i.monthDays=i.monthDays.split(","):i.monthDays=B.asArray(i.monthDays))}get values(){const i={...this.valuesCleanState,...super.values};return this.processValues(i),i}set values(i){super.values=i}getValues(){const i={...this.valuesCleanState,...super.getValues(...arguments)};return this.processValues(i),i}syncEventRecord(i){if(i=i||this.record,i){const e=this.getValues(t=>t.name in i&&!t.disabled);i.set(e)}}toggleStopFields(i){var e;const t=this,r=(e=t.widgetMap.stopRecurrenceField)==null?void 0:e.value,{countField:n,endDateField:s,frequencyField:a}=t.widgetMap,l=r==="count"&&a.value!=="NONE",o=!l&&r==="date";n._userAction=s._userAction=i,n.disabled=n.hidden=!l,s.disabled=s.hidden=!o,n._userAction=s._userAction=!1}isWidgetAvailableForFrequency(i,e=this.widgetMap.frequencyField.value){return!i.forFrequency||i.forFrequency.includes(e)}onFieldChange({source:i,userAction:e}){const{record:t}=this;e&&this.autoUpdateRecord&&t&&(t.isSanitizingSuspended=!0),super.onFieldChange(...arguments),e&&this.autoUpdateRecord&&t&&(t.isSanitizingSuspended=!1,this.setTimeout({fn:()=>t.sanitize(),delay:50,cancelOutstanding:!0}))}onFieldBeforeUpdateDisabled({source:i,disabled:e}){!e&&i._userAction&&i.triggerFieldChange({userAction:!0})}onMonthDaysRadioFieldChange({source:i,checked:e,userAction:t,propagatingUserActionFrom:r}){const{monthDaysButtonField:n,emptyMonthsHiddenField:s}=this.widgetMap;n&&(n._userAction=t,n.disabled=!e||!this.isWidgetAvailableForFrequency(n),n._userAction=!1),s&&(s._userAction=t||r,s.disabled=e||!this.isWidgetAvailableForFrequency(s),s._userAction=!1)}onMonthsButtonFieldChange({value:i}){const e=C.getMonthNames(),{monthDaysNumberField:t}=this.widgetMap;i&&t&&(t.hint=i.split(",").map(r=>e[r-1]).join(", "))}onMonthDaysNumberRadioFieldChange({checked:i,userAction:e}){const{monthDaysNumberField:t}=this.widgetMap;t._userAction=e,t.disabled=!i||!this.isWidgetAvailableForFrequency(t),t._userAction=!1}onPositionAndDayRadioFieldChange({source:i,checked:e,userAction:t}){const{daysCombo:r,positionsCombo:n}=this.widgetMap;r._userAction=n._userAction=t,r.disabled=n.disabled=!e||!this.isWidgetAvailableForFrequency(r),r._userAction=n._userAction=!1}onStopRecurrenceFieldChange({userAction:i}){this.toggleStopFields(i)}onFrequencyFieldChange({value:i,oldValue:e,valid:t,userAction:r}){const n=this,s=n.queryAll(d=>"forFrequency"in d),{intervalField:a,stopRecurrenceField:l}=n.widgetMap,o=i==="NONE";if(t&&i){for(const d of s)d._userAction=r,d.disabled=d.hidden=!n.isWidgetAvailableForFrequency(d,i),d._userAction=!1;n.widgetMap.countField.hidden=i==="NONE",l&&(l.hidden=o),a&&(a.hidden=o,o||(a.hint=n.L(`L{RecurrenceEditor.${i}intervalUnit}`)),e==="NONE"&&a.value==null&&(a.value=1)),n.toggleFieldsState()}}toggleFieldsState(i){const e=this,{widgetMap:t}=e,{monthDaysRadioField:r}=t;r&&e.onMonthDaysRadioFieldChange({checked:r.checked,userAction:i}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked,userAction:i}),e.onStopRecurrenceFieldChange({userAction:i})}updateLocalization(){const{countField:i,intervalField:e,frequencyField:t}=this.widgetMap;i.hint=this.L("L{RecurrenceEditor.time(s)}"),t.value&&t.value!=="NONE"&&(e.hint=this.L(`L{RecurrenceEditor.${t.value}intervalUnit}`)),super.updateLocalization()}};y($l,"$name","RecurrenceEditorPanel"),y($l,"type","recurrenceeditorpanel"),y($l,"configurable",{focusable:!1,cls:"b-recurrenceeditor",record:!1,addNone:!1,strictRecordMapping:!0,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysLabel:{type:"label",text:"L{RecurrenceEditor.Days}",weight:18,forFrequency:"WEEKLY",cls:"b-button-group-label"},daysButtonField:{type:"daybuttons",cls:"b-recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY",useGap:!0,required:!0},emptyMonthsHiddenField:{type:"field",inputType:"hidden",name:"monthDays",forFrequency:"MONTHLY",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled",change(){this._value=null}}},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange",cls:"b-label-with-checkbox"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY",cls:"b-space-above",required:!0,internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},monthDaysNumberRadioField:{type:"checkbox",weight:53,cls:"b-label-with-checkbox",toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"YEARLY",label:"L{RecurrenceEditor.on}",style:"display:inline-flex;",onChange:"up.onMonthDaysNumberRadioFieldChange"},monthDaysNumberField:{type:"numberfield",weight:56,flex:1,name:"monthDays",forFrequency:"YEARLY",min:1,max:31,required:!0,internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},monthsLabel:{type:"label",text:"L{RecurrenceEditor.Months}",weight:57,forFrequency:"YEARLY",cls:"b-button-group-label"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:58,cls:"b-space-above b-space-below",name:"months",forFrequency:"YEARLY",onChange:"up.onMonthsButtonFieldChange",required:!0},positionAndDayRadioField:{type:"checkbox",weight:60,cls:"b-label-with-checkbox b-space-below",toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY",cls:"b-space-below b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",cls:"b-space-below b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange",cls:"b-no-inner-span"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" ",cls:"b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0,cls:"b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}}}}),$l.initClass(),$l._$name="RecurrenceEditorPanel";var Sc=class extends ft{static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",items:{monthDaysNumberRadioField:!1},title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}},scrollable:{overflowY:!0}}}updateReadOnly(i){super.updateReadOnly(i),this.bbar.hidden=i}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(i){this.recurrenceEditorPanel.record=i}onSaveClick(){const i=this;i.saveHandler?i.saveHandler.call(i.thisObj||i,i,i.record):(i.recurrenceEditorPanel.syncEventRecord(),i.close())}onCancelClick(){const i=this;i.cancelHandler?i.cancelHandler.call(i.thisObj||i,i,i.record):i.close()}};y(Sc,"$name","RecurrenceEditor"),y(Sc,"type","recurrenceeditor"),Sc.initClass(),Sc._$name="RecurrenceEditor";var V0=i=>{var e;return e=class extends(i||$){changeEditorConfig(t){return t.items={...t.items,...this.recurringEventsItems},t=super.changeEditorConfig(t),t}doDestroy(){var t,r;(t=this._recurrenceConfirmation)==null||t.destroy(),(r=this._recurrenceEditor)==null||r.destroy(),super.doDestroy()}onEditorConstructed(t){var r;const n=this;t.ion({hide:n.onRecurringEventEditorHide,show:n.onRecurringEventEditorShow,reveal:n.onRecurringEventEditorShow,unreveal:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&n.client.enableRecurringEvents!==!1&&n.setTimeout(()=>n.editRecurrenceButton.menu=n.recurrenceEditor,100),(r=n.recurrenceCombo)==null||r.ion({change:n.onRecurrenceComboChange,thisObj:n})}updateReadOnly(t){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=t)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&this.showRecurringUI!==!1)}toggleRecurringFieldsVisibility(t=!0){var r,n,s,a;const l=t?"show":"hide";(n=(r=this.editRecurrenceButton)==null?void 0:r[l])==null||n.call(r),(a=(s=this.recurrenceCombo)==null?void 0:s[l])==null||a.call(s)}onRecurringEventEditorShow({source:t}){var r;if(this.recurrenceCombo&&((r=t.record)!=null&&r.startDate)&&!t.record.isRecurring&&this.useContextualRecurrenceRules){const n=this,{recurrenceCombo:s}=n,{store:a}=s;a.modelClass.fieldMap.isCustom||a.modelClass.addField({name:"isCustom",defaultValue:!1});const l=t.record.startDate,o=l.getDate(),d=l.getDay(),c=nt.encodeDay(d),u=l.getMonth(),h=Math.ceil(o/7),g=n.L(`L{RecurrenceLegend.position${h}}`),f=[{isCustom:!0,text:n.L("L{RecurrenceLegend.Weekly on {1}}",{days:C.getDayName(d)}),value:"WEEKLY"},{isCustom:!0,text:n.L("L{RecurrenceLegend.Monthly on {1}}",{days:C.format(l,"Do")}),value:"MONTHLY"},{isCustom:!0,text:n.L("L{RecurrenceLegend.Monthly on {1}}",{days:`${g} ${C.getDayName(d)}`}),value:`MONTHLY;BYDAY=${c};BYSETPOS=${h}`},{isCustom:!0,text:n.L("L{RecurrenceLegend.Yearly on {1} of {2}}",{days:C.format(l,"Do"),months:C.getMonthName(u)}),value:"YEARLY"},{isCustom:!0,text:n.L("L{RecurrenceLegend.Yearly on {1} of {2}}",{days:`${g} ${C.getDayName(d)}`,months:C.getMonthName(u)}),value:`YEARLY;BYDAY=${c};BYMONTH=${u+1};BYSETPOS=${h}`}];n.defaultRules=a.records.slice(),a.add(f),a.filter(m=>m.isCustom||m.value==="none"||m.value==="DAILY")}}onRecurringEventEditorHide(){if(this.recurrenceCombo){const{store:t}=this.recurrenceCombo;t&&this.defaultRules&&(t.clearFilters(),t.data=this.defaultRules)}}makeRecurrence(t){const r=this.eventRecord,n=r.copy();let s=r.recurrence;return!t&&s?s=s.copy():s=new r.recurrenceModel(t?{rule:t}:{}),n.timeZone!=null&&(s.timeZone=n.timeZone),s.timeSpan=n,n.setStartDate(this.values.startDate),s.suspendTimeSpanNotifying(),s}onRecurrableEventBeforeSave({eventRecord:t,context:r}){const n=this;n.isEditing&&!t.isCreating&&t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(n.recurrenceConfirmation.confirm({actionType:"update",eventRecord:t,changerFn(){r.finalize(!0)},cancelFn(){r.finalize(!1)}}),r.async=!0)}changeRecurrenceConfirmation(t,r){if(t)return os.reconfigure(this.client.recurrenceConfirmationPopup,os.mergeConfigs({owner:this.editor},t),this)}set recurrenceEditor(t){this._recurrenceEditor=t}get recurrenceEditor(){const t=this;let r=t._recurrenceEditor;return(!r||!r.$$name)&&(t._recurrenceEditor=r=z.create({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,minWidth:"auto",constrainTo:globalThis,anchor:!1,rootElement:t.rootElement,saveHandler:t.recurrenceEditorSaveHandler,thisObj:t,internalListeners:{beforeShow:t.onBeforeShowRecurrenceEditor,thisObj:t},...r}),r.readOnly=t._readOnly),r}onBeforeShowRecurrenceEditor(){const t=this,{recurrenceEditor:r,eventRecord:n}=t;r&&(n!=null&&n.supportsRecurring)&&(t.recurrence||(t.recurrence=t.makeRecurrence()),t.recurrence.timeSpan.setStartDate(t.values.startDate),r.record=t.recurrence,r.centered=!0)}loadRecurrenceData(t){this.recurrence=t,this.updateRecurrenceFields(t)}updateRecurrenceFields(t){const r=this,{editRecurrenceButton:n}=r;r.recurrenceCombo&&!r.processingRecurrenceComboChange&&(r.recurrenceCombo.recurrence=t),n&&(n.recurrence=t,n.value=t?t.rule:null,t&&r.client.enableRecurringEvents&&r.showRecurringUI!==!1?n.show():n.hide())}onRecurrenceComboChange({source:t,value:r,userAction:n}){if(n){const s=this,{recurrenceEditor:a}=s;r===t.customValue?(s.recurrenceCombo.recurrence=s.makeRecurrence(),a.centered?a.show():a.show((s.editRecurrenceButton||t).element)):(s.processingRecurrenceComboChange=!0,s.loadRecurrenceData(r&&r!=="none"?s.makeRecurrence(`FREQ=${r}`):null),s.processingRecurrenceComboChange=!1)}}recurrenceEditorSaveHandler(t,r){t.recurrenceEditorPanel.syncEventRecord(r);const{store:n}=this.recurrenceCombo;n.clearFilters(),n.remove(n.query(s=>s.isCustom)),this.updateRecurrenceFields(r),t.close()}onDatesChange(...t){if(super.onDatesChange(...t),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:r}=this.values;r&&(this.editRecurrenceButton.eventStartDate=r)}}internalLoadRecord(t){t!=null&&t.supportsRecurring&&this.loadRecurrenceData(t.recurrence?this.makeRecurrence():null)}updateRecord(t){return t.recurrenceRule&&!this.recurrence&&(t.recurrenceRule=null),super.updateRecord(t)}},y(e,"$name","RecurringEventEdit"),y(e,"configurable",{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},recurrenceConfirmation:{$config:"lazy",value:{type:"recurrenceconfirmation"}},showRecurringUI:null,useContextualRecurrenceRules:!0}),e},Dc=class extends Ze{static get configurable(){return{showEventColor:null,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl(i){if(this.owner.showEventColor){const{eventColor:e}=i,t=!E.isNamedColor(e),r=e?t?` style="color:${e}"`:"":' style="display:none"';return`<div aria-hidden="true" class="b-icon b-icon-square${!e||t?"":` b-sch-foreground-${e}`}"${r}></div>`}return this.multiSelect?'<div aria-hidden="true" class="b-icon b-icon-square"></div>':""}}}}changeShowEventColor(i){return!!i}updateShowEventColor(i){var e;this.element.classList.toggle("b-show-event-color",!!i),(e=this._picker)==null||e.element.classList.toggle("b-show-event-color",!!i)}changePicker(i,e){return i=super.changePicker(i,e),i==null||i.element.classList.toggle("b-show-event-color",!!this.showEventColor),i}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var i,e;const t=this,{resourceIcon:r,lastResourceIconCls:n}=t,{classList:s}=r,a=(e=(i=t.selected)==null?void 0:i.eventColor)!=null?e:"";super.syncInputFieldValue(),r.style.color="",n&&s.remove(n),t.lastResourceIconCls=null,a?(E.isNamedColor(a)?(t.lastResourceIconCls=`b-sch-foreground-${a}`,s.add(t.lastResourceIconCls)):r.style.color=a,s.remove("b-hide-display")):s.add("b-hide-display")}};y(Dc,"$name","ResourceCombo"),y(Dc,"type","resourcecombo"),Dc.initClass(),Dc._$name="ResourceCombo";var N0=/[^\w\d]/g,Hl=class extends Xp.mixin(eg,V0,fe){static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}construct(e,t){this.readOnly=e.readOnly,super.construct(e,t),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get project(){return this.client.project}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e,this._editor&&(this.editor.readOnly=e)}get editor(){var e,t,r,n,s;const a=this,l={beforeHide:"resetEditingContext",beforeShow:"onBeforeEditorShow",keyDown:"onPopupKeyDown",thisObj:a};let{_editor:o}=a;if(o)return o;o=a._editor=z.create(a.getEditorConfig());const{startDateField:d,startTimeField:c,endDateField:u,endTimeField:h}=o.widgetMap;return!d&&c&&(c.label=a.L("L{Start}"),c.flex="1 0 100%"),!u&&h&&(h.label=a.L("L{End}"),h.flex="1 0 100%"),!o.floating&&!o.positioned&&(re.deprecate("scheduler","7.0.0",'"editorConfig" with "appendTo" deprecated in favor of "drawer : true" config'),o.element.parentNode||a.client.add(o),delete l.beforeHide,delete l.beforeShow,l.beforeToggleReveal="onBeforeEditorToggleReveal"),o.readOnly=a.readOnly,o.items.length===0&&console.warn("Event Editor configured without any `items`"),o.ion(l),a.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach(g=>{const f=g.ref||g.id;if(f&&!a[f])switch(a[f]=g,g.name){case"startDate":case"endDate":g.ion({change:"onDatesChange",thisObj:a});break}}),(e=a.onEditorConstructed)==null||e.call(a,o),(t=a.eventTypeField)==null||t.ion({change:"onEventTypeChange",thisObj:a}),(r=a.saveButton)==null||r.ion({click:"onSaveClick",thisObj:a}),(n=a.deleteButton)==null||n.ion({click:"onDeleteClick",thisObj:a}),(s=a.cancelButton)==null||s.ion({click:"onCancelClick",thisObj:a}),o}getEditorConfig(){const e=this,{cls:t,scheduler:r}=e,n=T.assign({owner:r,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${r.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:e.editorConfig.autoUpdateRecord?null:"realign",constrainTo:globalThis,cls:t},e.editorConfig);return z.prototype.getRenderContext(n)[0]&&(n.floating=!1),n.floating===!1&&!n.positioned&&(n.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},n.collapsed=!0,n.hidden=n.anchor=!1,n.hide=function(){this.collapsible.toggleReveal(!1)}),!r.showEventColorPickers&&n.items.colorField&&(n.items.colorField.hidden=!0),n.onElementCreated=e.updateCSSVars.bind(this),n}updateCSSVars({element:e}){const t=new Date(2e3,12,31,23,55,55),r=C.format(t,this.dateFormat).replace(N0,"").length,n=C.format(t,this.timeFormat).replace(N0,"").length,s=r+n;e.style.setProperty("--date-time-length",`${s}em`),e.style.setProperty("--date-width-difference",`${(r-n)/2}em`)}async internalShowEditor(e,t,r=null){var n,s;const a=this,{scheduler:l,editor:o}=a,{useInitialAnimation:d}=l,c=((n=r==null?void 0:r.target)==null?void 0:n.nodeType)===Element.ELEMENT_NODE?r.target:l.getElementFromEventRecord(e,t),u=e.isPartOfStore(l.eventStore);if(r=r!=null?r:{target:c,anchor:!0},r.target||!u||e.resources.length===0||e.isCreating){l.element.classList.add("b-eventeditor-editing"),a.resourceRecord=t,a.editingContext={eventEdit:a,eventRecord:e,resourceRecord:t,eventElement:c,editor:o,isPartOfStore:u},(s=super.internalShowEditor)==null||s.call(this,e,t,r),a.typeField&&a.toggleEventType(e.getValue(a.typeField)),a.loadRecord(e,t),o.readOnly=a.readOnly||e.readOnly||l.readOnly,o.title=o.readOnly?a.L("L{Object.information}"):o.initialTitle,o.collapsed?(await o.collapsible.toggleReveal(!0),o.focus()):o.centered||!o.anchor||!o.floating?o.show():c&&(!e.isCreating||!d||d===!0||d==="fade-in")?(a.targetEventElement=c,o.showBy(r)):(o.show(),o.updateCentered(!0));const h=l.timeAxisViewModel.timeResolution;if(h.unit==="hour"||h.unit==="minute"){const g=`${h.increment}${h.unit}`;a.startTimeField&&(a.startTimeField.step=g),a.endTimeField&&(a.endTimeField.step=g)}a.detachListeners("changesWhileEditing"),l.eventStore.ion({change:a.onChangeWhileEditing,refresh:a.onChangeWhileEditing,thisObj:a,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;!e.editor.autoUpdateRecord&&!e.isFinalizingEventSave&&e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",{...this.editingContext})}updateTargetEventElement(e,t){e==null||e.classList.add("b-editing"),t==null||t.classList.remove("b-editing")}editEvent(e,t,r=null,n=null){var s,a,l;const o=this,{client:d}=o,{eventStore:c,assignmentStore:u,enableEventAnimations:h}=d,{simpleEventEdit:g}=d.features;e.isModel||(e=c.createRecord(e));const f=!e.isOccurrence&&!c.$master.includes(e);if(f){const m=[];e.isCreating=!0;let p=[];if(t&&!u.includesAssignment(e.id,t.id)&&(m.push(t),p=u.assignEventToResource(e,t)),d.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:m,assignmentRecords:p})===!1)return u==null||u.remove(p),e.isCreating=!1,!1}if(o.isEditing&&o.resetEditingContext(),!(o.disabled||e.isCreating&&(g!=null&&g.enabled)))return d.trigger("beforeEventEdit",{eventEdit:o,eventRecord:e,resourceRecord:t,eventElement:((s=d.getElementFromEventRecord)==null?void 0:s.call(d,e,t))||r})===!1?(d.element.classList.remove("b-eventeditor-editing"),d.isCalendar&&(e.isCreating=!1),!1):(n?o.applyStmCapture(n):n!==!1&&!d.isCalendar&&!o.hasStmCapture&&o.captureStm(!0),d.refreshRows&&(f&&(o.enableEventAnimations=!1,c.$master.add(e),d.project.commitAsync().then(()=>d.enableEventAnimations=h),d.refreshRows()),e.isCreating&&((l=(a=d.getElementFromEventRecord)==null?void 0:a.call(d,e,t,!0))==null||l.focus({preventScroll:!0}))),o.doEditEvent(e,t,r,n).then(m=>{if(!o.isDestroying&&!o.isEditing&&!d.isCalendar&&!o.rejectingStmTransaction)return m!==!1&&o.hasStmCapture?o.freeStm(!1):o.freeStm()}))}get isEditing(){const{_editor:e}=this;return!!(e!=null&&e.isVisible&&!(e.collapsed&&!e.revealed))}async doEditEvent(e,t,r=null){const n=this,{scheduler:s}=n,a=e.isCreating;if(t||(t=e.resource||n.resourceStore.getById(e.resourceId)),a&&xt.prototype.normalize.call(e),r||a||e.resources.length===0)return n.internalShowEditor(e,t,r?{target:r}:null);{const l=s.isVertical?"maxHeight":"maxWidth";await s.scrollResourceEventIntoView(t,e,{[l]:n.minEditSize,animate:!0,edgeOffset:0,extendTimeAxis:!1}),s.isDestroyed||(await n.internalShowEditor(e,t),s.isDestroyed||s.element.classList.remove("b-eventeditor-editing"))}}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){var e;return(e=this._editor)==null?void 0:e.record}internalLoadRecord(e,t){var r;const n=this,{eventStore:s}=n.client,{editor:a,resourceField:l}=n,{endTimeField:o}=a.widgetMap;if(n.resourceRecord=t,l&&((r=l.store)==null?void 0:r.masterStore)!==n.resourceStore&&(l.store=a.chainResourceStore()),o&&(o.min=null),a.record=e,l){const d=s.assignmentStore.getResourcesForEvent(e);a.assigningValues=!0,!e.isOccurrence&&!s.storage.includes(e,!0)&&t?n.resourceField.value=t.getValue(n.resourceField.valueField):n.assignmentStore&&(n.resourceField.value=d.map(c=>c.getValue(n.resourceField.valueField))),a.assigningValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget(t=>{var r;(r=t.dataset)!=null&&r.eventType&&(t.hidden=t.dataset.eventType!==e)})}async finalizeEventSave(e,t,r,n){const s=this,{scheduler:a,assignmentStore:l}=s,o=!1;l.suspendAutoCommit(),a.suspendRefresh(),s.onBeforeSave(e),e.beginBatch(),s.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):s.resourceField&&l.assignEventToResource(e,t,null,!0),e.isCreating=!1,o||await a.project.commitAsync(),l.resumeAutoCommit(),a.resumeRefresh(!0),o||(a.trigger("afterEventSave",{eventRecord:e}),s.onAfterSave(e)),r(o?!1:e)}save(){return new Promise((e,t)=>{var r;const n=this,{scheduler:s,eventRecord:a}=n;if(!a||!n.editor.isValid){e(!1);return}const{eventStore:l,values:o}=n,d=((r=n.resourceField)==null?void 0:r.records)||(n.resourceRecord?[n.resourceRecord]:[]);if(l&&s.isDateRangeAvailable){let{startDate:g,endDate:f}=o;if(f||("duration"in o?f=C.add(g,o.duration,o.durationUnit||a.durationUnit):"fullDuration"in o?f=C.add(g,o.fullDuration):f=a.endDate),!s.isDateRangeAvailable(g,f,a,d)){const{startDateField:p}=this.editor.widgetMap;p&&(p.setError(n.L("L{EventDrag.eventOverlapsExisting}"),!1,!0),p.focus()),e(!1);return}}const c={finalize(g){try{g!==!1?n.finalizeEventSave(a,d,e,t):e(!1)}catch(f){t(f)}}},u=s.trigger("beforeEventSave",{eventRecord:a,resourceRecords:d,values:o,context:c});function h(g,f,m){g===!1?e(!1):(n.onRecurrableEventBeforeSave({eventRecord:f,context:m}),m.async||m.finalize())}T.isPromise(u)?u.then(g=>h(g,a,c)):h(u,a,c)})}async deleteEvent(){const{editor:e}=this,{autoClose:t}=e;return this.detachListeners("changesWhileEditing"),await this.scheduler.removeEvents([this.eventRecord],this.client.isScheduler?r=>{r&&e.containsFocus&&(e.autoClose=!1,e.revertFocus(),e.autoClose=t)}:null,e)}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:r,domEvent:n}){var s;const{ignoreSelector:a}=this;(!a||!((s=n.target)!=null&&s.closest(a)))&&this.editEvent(e,t,r)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:r,stmCapture:n}){this.editEvent(e,t,r,n)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:r}){const{client:n}=this,s=r[r.matches(n.eventSelector)?"querySelector":"closest"](n.eventInnerSelector);e?this.editEvent(t,e.resource,s):t&&this.editEvent(t,t.resource,s)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:r}){const n=this,s=!n.readOnly&&!n.scheduler.readOnly&&!e.readOnly&&!n.disabled;r.editEvent={text:"L{EventEdit.Edit event}",localeClass:n,icon:"b-icon b-icon-edit",weight:100,hidden:!s,onItem:()=>n.editEvent(e,t)},r.showDetails={text:"L{Object.showDetails}",localeClass:n,icon:"b-icon b-icon-show-details",weight:100,hidden:s,onItem:()=>n.editEvent(e,t)}}onBeforeEditorToggleReveal({reveal:e}){e&&this.editor.setupEditorButtons(),this[e?"onBeforeEditorShow":"resetEditingContext"]()}async resetEditingContext(){const e=this;e.detachListeners("changesWhileEditing"),super.resetEditingContext(),e.hasStmCapture&&!e.isDeletingEvent&&!e.isCancelingEdit&&await e.freeStm(!1),e.resourceRecord=null}finalizeStmCapture(e){return this.freeStm(!e)}updateLocalization(){this._editor&&this.updateCSSVars({element:this._editor.element}),super.updateLocalization(...arguments)}};y(Hl,"$name","EventEdit"),y(Hl,"configurable",{triggerEvent:"eventdblclick",ignoreSelector:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:Hl,defaults:{localeClass:Hl},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"timefield",clearable:!1,required:!0,ariaLabel:"L{startTime}",name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"timefield",clearable:!1,required:!0,ariaLabel:"L{endTime}",name:"endDate",cls:"b-match-label",weight:600},colorField:{label:"L{SchedulerBase.color}",type:"eventColorField",name:"eventColor",weight:700}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:Hl},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null,minEditSize:100});var Vl=Hl;Vl._$name="EventEdit",K.registerFeature(Vl,!0,"Scheduler"),K.registerFeature(Vl,!1,["SchedulerPro","ResourceHistogram"]),Vl.initClass();var Nl=class extends ie{static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:i}){const e=this;i.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:e.disabled,localeClass:e,weight:100,menu:{localeClass:e,cls:"b-eventfilter-menu",items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:e,width:200,internalListeners:{change:e.onEventFilterChange,thisObj:e}}},onBeforeShow({source:t}){const[r]=t.items,n=e.store.filters.getBy("property","name");r.value=(n==null?void 0:n.value)||""}}}}onEventFilterChange({value:i}){i!==""?this.store.filter("name",i):this.store.removeFilter("name")}get store(){const{client:i}=this;return i.isGanttBase?i.store:i.eventStore}};y(Nl,"$name","EventFilter"),Nl.featureClass="b-event-filter",Nl._$name="EventFilter",K.registerFeature(Nl,!0,["Scheduler","Gantt"]),K.registerFeature(Nl,!1,"ResourceHistogram");var ys=class extends ig{static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateEventMenu"),i}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(i){var e;const t=super.getDataFromEvent(i),r=t.targetElement,{client:n}=this,s=n.resolveEventRecord(r),a=s&&((e=n.resolveResourceRecord(r)||this.resourceStore.last)==null?void 0:e.$original),l=s&&n.resolveAssignmentRecord(r);return Object.assign(t,{date:n.getDateFromXY([i.pageX,i.pageY],null,!1),eventElement:r,eventRecord:s,resourceRecord:a,assignmentRecord:l})}getTargetElementFromEvent({target:i}){return i.closest(this.client.eventSelector)||i}shouldShowMenu(i){return i.eventRecord}showContextMenuFor(i,{targetElement:e}={}){this.disabled||!e&&(e=this.getElementFromRecord(i),!e)||E.triggerMouseEvent(e,this.triggerEvent)}getElementFromRecord(i){return this.client.getElementsFromEventRecord(i)[0]}populateEventMenu({items:i,eventRecord:e,assignmentRecord:t}){const{client:r}=this;i.deleteEvent={disabled:e.readOnly||(t==null?void 0:t.readOnly),hidden:r.readOnly},i.unassignEvent={disabled:e.readOnly||(t==null?void 0:t.readOnly),hidden:r.readOnly||r.eventStore.usesSingleAssignment},r.showEventColorPickers||r.showTaskColorPickers?i.eventColor={disabled:e.readOnly,hidden:r.readOnly}:i.eventColor={hidden:!0}}populateItemsWithData({items:i,eventRecord:e}){var t,r;super.populateItemsWithData(...arguments);const{client:n}=this;(n.showEventColorPickers||n.isSchedulerPro&&n.showTaskColorPickers)&&((t=i.eventColor)!=null&&t.menu)&&Z.merge(i.eventColor.menu.colorMenu,{value:e.eventColor,records:(r=n.selectedRecords)!=null?r:[e]})}changeItems(i){const{client:e}=this;return Z.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",cls:"b-separator",weight:500,onItem({menu:t,eventRecord:r}){var n;const s=(n=t.focusInEvent)==null?void 0:n.relatedTarget;s&&(s.focus(),e.navigator.activeItem=s),e.removeEvents(e.isEventSelected(r)?e.selectedEvents:[r])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:t,eventRecord:r,resourceRecord:n,assignmentRecord:s}){var a;const l=(a=t.focusInEvent)==null?void 0:a.relatedTarget;l&&(l.focus(),e.navigator.activeItem=l),e.isAssignmentSelected(s)?e.assignmentStore.remove(e.selectedAssignments):r.unassign(n)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},i)}};y(ys,"$name","EventMenu"),ys.featureClass="",ys._$name="EventMenu",K.registerFeature(ys,!0,"Scheduler"),K.registerFeature(ys,!1,"ResourceHistogram");var iv=i=>{var e;return e=class extends i{getNonWorkingTimeRanges(t,r,n){const s=n.getTime()-r.getTime()+864e5;if(!t.getNonWorkingTimeRanges){const a=[];return t.forEachAvailabilityInterval({startDate:r,endDate:n,isForward:!0,maxRange:s},(l,o,d)=>{for(const[c,u]of d.intervalGroups)u.getIsWorking()||a.push({name:c.name,iconCls:c.iconCls,cls:c.cls,type:c.type,startDate:l,endDate:o})}),a}return t.getNonWorkingTimeRanges(r,n,s)}getCalendarTimeRanges(t,r=!1){const n=this,{timeAxis:s,fillTicks:a}=n.client,{unit:l,increment:o}=s,d=!n.maxTimeAxisUnit||C.compareUnits(l,n.maxTimeAxisUnit)<=0;if(t&&d&&s.count){const c=n.getNonWorkingTimeRanges(t,s.startDate,s.endDate),u=c.map(f=>new xt({name:f.type!=="Week"?f.name:"",cls:`b-nonworkingtime ${f.cls||""}`,startDate:f.startDate,endDate:f.endDate}));let h=[],g=null;for(const f of u)g&&f.startDate<=g.endDate&&(r||f.name===g.name)&&f.duration>0?g.endDate=f.endDate:(h.push(f),f.setData("id",`nonworking-${h.length}`),g=f);return a&&(h=h.filter(f=>C.ceil(f.startDate,{magnitude:o,unit:l})<C.floor(f.endDate,{magnitude:o,unit:l})),h.forEach(f=>f.setStartEndDate(C.ceil(f.startDate,{magnitude:o,unit:l}),C.floor(f.endDate,{magnitude:o,unit:l})))),h}else return[]}setupDefaultCalendar(){const{project:t}=this;!this.autoGeneratedWeekends&&t.isSchedulerCoreProjectMixin&&t.effectiveCalendar===t.defaultCalendar&&!t.defaultCalendar.intervalStore.count&&(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const t=this.client.project.effectiveCalendar,r=this.defaultNonWorkingIntervals,n=!!r.length;t.ignoreTimeZone=!0,t.clearIntervals(n),n&&t.addIntervals(r)}}updateLocalization(){var t;(t=super.updateLocalization)==null||t.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return C.nonWorkingDaysAsArray.map(r=>({recurrentStartDate:`on ${t[r]} at 0:00`,recurrentEndDate:`on ${t[(r+1)%7]} at 0:00`,isWorking:!1}))}},y(e,"$name","NonWorkingTimeMixin"),y(e,"configurable",{maxTimeAxisUnit:"week"}),e},sg=class extends ie.mixin(Zt,iv){static get pluginConfig(){return{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}}static get properties(){return{calendarRangeCache:new Map}}doDisable(i){this.client.refresh(),super.doDisable(i)}attachToCalendarManagerStore(i){super.attachToCalendarManagerStore(i);const e=this;i.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:e}),e.client.isScheduler&&e.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:e}),e.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(i,e,t,r){const n=this,{client:s}=n,a=s.getVirtualCoordFromDate(C.max(i.startDate,e))-r,l=i.endDate?s.getVirtualCoordFromDate(C.min(i.endDate,t))-r:a,o=Math.abs(l-a),d=s.isVertical?"insetBlockStart":"insetInlineStart",c=s.isVertical?"height":"width";return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[i.cls]:i.cls,"b-rtl":s.rtl},dataset:{id:i.id},elementData:{timeRange:i},style:{[d]:a,[c]:o>0?o:null}}}getCalendarTimeRanges(i){let e=this.calendarRangeCache.get(i);return e||(e=super.getCalendarTimeRanges(i,!0),this.calendarRangeCache.set(i,e)),e}onEventDataGenerated({eventRecord:i,startMS:e,endMS:t,start:r,end:n,left:s,top:a,children:l,bufferBeforeWidth:o}){var d;if(this.enabled){const{isVertical:c}=this.client,u=(d=i.effectiveCalendarsCombination)!=null?d:this.client.project.calendar;let h=c?a:s;o&&(h+=o);for(const g of this.getCalendarTimeRanges(u))if(g.startDateMS<t&&g.endDateMS>e){const f=this.getRangeDomConfig(g,r,n,h);l.push(f)}}}};y(sg,"$name","EventNonWorkingTime"),sg._$name="EventNonWorkingTime",K.registerFeature(sg,!1,"Scheduler");var B0=[0,0],WA=[null,[0,10],[10,0]],Ec=class extends Zp{static get defaultConfig(){return{template:i=>`
                ${i.eventRecord.name?O.xss`<div class="b-sch-event-title">${i.eventRecord.name}</div>`:""}
                ${i.startClockHtml}
                ${i.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(i,e){super.construct(i,e),typeof this.align=="string"&&(this.align={align:this.align})}resolveData(i,e){const t=this.client,r=super.resolveData(i,e);return r&&{...r,resourceRecord:t.resolveResourceRecord(e),assignmentRecord:t.resolveAssignmentRecord(e)}}onInternalPaint({firstPaint:i}){if(super.onInternalPaint(...arguments),i){const{dependencies:e}=this.client.features;e&&this.tooltip.ion({beforeAlign({source:t,offset:r=B0}){const{edgeAligned:n}=nf(t.align.align),s=e.disabled||!e.allowCreate?B0:WA[n];arguments[0].offset=[r[0]+s[0],r[1]+s[1]]}})}}};y(Ec,"$name","EventTooltip"),Ec._$name="EventTooltip",K.registerFeature(Ec,!0,"Scheduler"),K.registerFeature(Ec,!1,"ResourceHistogram");var jA={update:1,filter:1},UA={add:1,remove:1,update:1,removeAll:1,filter:1},xc=class extends Ua{static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(i,e){const t=this;if(i.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");t.scheduler=i,super.construct(i,e),!t.summaries&&t.renderer&&(t.summaries=[{renderer:t.renderer}]),i.isSchedulerBase&&(i.eventStore.ion({changePreCommit:t.onEventStoreChange,thisObj:t}),i.assignmentStore.ion({changePreCommit:t.onAssignmentStoreChange,thisObj:t}),i.ion({timeAxisViewModelUpdate:t.onTimeAxisChange,thisObj:t}),i.project.ion({dataReady:t.onProjectDataReady,thisObj:t}))}doDestroy(){var i;(i=this._tip)==null||i.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach(i=>{i.isGroupFooter&&i.render()})}onEventStoreChange({action:i,records:e,changes:t}){if(jA[i]){const r=new Set;e.forEach(n=>n.resources.forEach(s=>r.add(s))),this.afterChange(r)}}onAssignmentStoreChange({action:i,records:e,changes:t}){var r;if(UA[i]){const n=new Set;if(e.forEach(s=>s.resource&&n.add(s.resource)),((r=t==null?void 0:t.resourceId)==null?void 0:r.oldValue)!=null){const s=this.scheduler.resourceStore.getById(t.resourceId.oldValue);s&&n.add(s)}this.afterChange(n)}}afterChange(i){const{resourceStore:e}=this.scheduler;for(const t of i){let r=t;if(this.target==="header")for(;r&&!r.isGroupHeader;)r=e.getPrev(r);else for(;r&&!r.isGroupFooter;)r=e.getNext(r);const n=this.scheduler.rowManager.getRowFor(r);r&&n&&this.footersToUpdate.add(n)}}onProjectDataReady(){var i;const{footersToUpdate:e,client:t}=this;if(t.isVisible){if(e.size){for(const r of e)(i=r.render)==null||i.call(r);e.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:i,record:e}){if(i.isGroupFooter&&!e.meta.hasOwnProperty("groupFooterFor")){const t=i.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(i,e,t,r,n,s){if(i.type==="timeAxis"){const a=this,{scheduler:l}=a,{eventStore:o}=l,d=l.timeAxisViewModel.columnConfig;let c="";const u=l.getResourcesEventsPerTick(e,({event:h})=>h.resources.some(g=>e.includes(g))&&(!o.isFiltered||o.records.includes(h)));return l.timeAxis.forEach((h,g)=>{const f=u[g]||[],m=a.summaries.map(p=>{var v,b;return`<div class="b-timeaxis-summary-value">${(b=(v=p.renderer)==null?void 0:v.call(p,{startDate:h.startDate,endDate:h.endDate,resourceStore:l.resourceStore,events:f,resources:e,eventStore:o,groupRecord:r,groupField:n,groupValue:s}))!=null?b:""}</div>`}).join("");c+=`<div class="b-timeaxis-tick" style="width: ${d[d.length-1][g].width}px">${m}</div>`}),`<div class="b-timeaxis-group-summary">${c}</div>`}return super.generateHtml(i,e,t)}updateSummaryHtml(i,e,t){const r=super.updateSummaryHtml(i,e,t);if(e.type==="timeAxis"){const n={count:0,height:0};return this.summaries.forEach(s=>{s.height?n.height+=s.height:n.count++}),n}return r}getTipHtml({activeTarget:i}){const e=this,{client:t}=e,r=[],n=Array.from(i.parentElement.children).indexOf(i),s=t.timeAxis.getAt(n),a=t.getRecordFromElement(i),l=a.isGroupFooter?a.meta.groupRecord:a,{eventStore:o}=t,d=l.groupChildren,c=t.getResourcesEventsPerTick(d,({event:g})=>g.resources.some(f=>d.includes(f))&&(!o.isFiltered||o.includes(g)));let u="",h=!1;return E.forEachSelector(i,".b-timeaxis-summary-value",(g,f)=>{const m=e._labels[f],p=g.innerText.trim();r.push({label:m,text:p}),g.innerHTML&&(h=!0)}),u=e.tooltipTemplate({groupSummaryValues:r,startDate:s.startDate,endDate:s.endDate,resourceStore:t.resourceStore,events:c[n]||[],resources:d,eventStore:o,groupRecord:l,groupField:l.meta.groupField,groupValue:l.meta.groupRowFor}),h?u:null}tooltipTemplate({groupSummaryValues:i,startDate:e,endDate:t,events:r,resources:n,eventStore:s,resourceStore:a,groupRecord:l,groupField:o,groupValue:d}){const{client:c}=this;let u=`<header>${this.L("L{Summary.Summary for}",c.getFormattedDate(e))}</header>`;return i.forEach(({label:h="",text:g})=>{u+=`<label>${h}</label><div class="b-timeaxis-summary-value">${g}</div>`}),u}render(){const i=this,{scheduler:e}=i;e.isSchedulerBase&&i.showTooltip&&!i._tip&&(i._tip=new ve({id:`${e.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:e.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:i.getTipHtml.bind(i)}))}removeSummaryElements(i){const e=i.querySelector(".b-timeaxis-group-summary");e==null||e.remove(),super.removeSummaryElements()}hasSummary(i){return super.hasSummary(i)||i.isTimeAxisColumn}updateSummaries(){this._labels=this.summaries.map(i=>i.label||""),this.isConfiguring||super.updateSummaries(...arguments)}};y(xc,"$name","GroupSummary"),y(xc,"configurable",{showTooltip:!0,summaries:null,renderer:null}),xc._$name="GroupSummary",K.registerFeature(xc,!1,"Scheduler");var z0=i=>{var e;return e=class extends(i||$){constructor(){super(...arguments),y(this,"moveThreshold",3),y(this,"_dragging",!1)}construct(){super.construct(...arguments),this.chain(this.client,"onElementMouseDown","onElementMouseDown"),this.chain(this.client,"onElementMouseMove","onElementMouseMove")}onElementMouseDown(t){const r=this;t.touches||t.button!==0||r.disabled||!r.enableDragSelect||t.target.closest(".b-sch-header-timeaxis-cell")&&(r.startX=t.clientX,V.on({element:E.getRootElement(t.target),mouseup:"onMouseUp",thisObj:r,once:!0}))}onElementMouseMove(t){const r=this;if(typeof r.startX=="number"){if(!r._dragging&&Math.abs(r.startX-t.clientX)>=r.moveThreshold){const n=r.client.subGrids.normal.header.headersElement;r.element=E.createElement({parent:n,tag:"div",className:"b-header-drag-selection-rect b-headerzoom-rect"}),r.headerElementRect=L.from(n),r._dragging=!0}if(r.isDragging){const n=Math.max(t.clientX,r.headerElementRect.left),s=Math.min(r.startX,n),a=Math.abs(r.startX-n),l=new L(s-r.headerElementRect.x+r.client.scrollLeft,0,a,r.headerElementRect.height);E.setTranslateX(r.element,l.left),r.element.style.width=l.width+"px"}}}onMouseUp(){var t;const r=this;if(r.startX=null,r.isDragging){const{client:n}=r,s=L.from(r.element),a=n.getDateFromCoordinate(s.left,"round",!1),l=n.getDateFromCoordinate(s.right,"round",!1);r.element.remove(),V.on({element:E.getRootElement(n.element),thisObj:r,click:o=>o.stopPropagation(),capture:!0,expires:50,once:!0}),r._dragging=null,(t=r.onTimeSpanDragSelected)==null||t.call(r,{startDate:a,endDate:l})}}get isDragging(){return this._dragging}},y(e,"configurable",{enableDragSelect:!0}),e},ag=class extends ie.mixin(z0){onTimeSpanDragSelected({startDate:i,endDate:e}){this.client.zoomToSpan({startDate:i,endDate:e})}};y(ag,"$name","HeaderZoom"),ag._$name="HeaderZoom",K.registerFeature(ag,!1,"Scheduler");var GA=["top","before","after","bottom"],YA=(i,e)=>{switch(i){case"top":return"b-b";case"after":return e.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return e.rtl?"l-l":"r-r";case"left":return"r-r"}},qA={top:1,bottom:1},KA={estimate:1,measure:1},XA={before:1,after:1},Bl=class extends ie{static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(i,e){const t=this;if(i.isVertical)throw new Error("Labels feature is not supported in vertical mode");t.scheduler=i,super.construct(i,e),(t.top||t.bottom||t.before||t.after)&&t.updateHostClasslist()}updateHostClasslist(){const{top:i,bottom:e}=this,{classList:t}=this.scheduler.element;t.remove("b-labels-topbottom"),t.remove("b-labels-top"),t.remove("b-labels-bottom"),(i||e)&&(t.add("b-labels-topbottom"),i&&t.add("b-labels-top"),e&&t.add("b-labels-bottom"))}onLabelDblClick(i){var e;const t=this,r=(e=i.target)==null?void 0:e.closest("."+t.labelCls);if(r&&!t.scheduler.readOnly){const{side:n}=r.dataset,s=t[n],{editor:a,field:l}=s;if(a){const o=t.scheduler.resolveEventRecord(i.target);return o.readOnly?void 0:(a instanceof Gt||(s.editor=new Gt({blurAction:t.blurAction,inputField:a,scrollAction:"realign"})),s.editor.render(t.scheduler.element),s.editor.startEdit({target:r,align:YA(n,t.client),matchSize:!1,record:o,field:l}),i.stopImmediatePropagation(),!1)}}}changeTop(i){return this.processLabelSpec(i,"top")}updateTop(){this.updateHostClasslist()}changeAfter(i){return this.processLabelSpec(i,"after")}updateAfter(){this.updateHostClasslist()}changeRight(i){this[this.client.rtl?"before":"after"]=i}changeBottom(i){return this.processLabelSpec(i,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(i){return this.processLabelSpec(i,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(i){this[this.client.rtl?"after":"before"]=i}processLabelSpec(i,e){if(typeof i=="function")i={renderer:i};else if(typeof i=="string")i={field:i};else if(i)i=Object.create(i);else return null;const{scheduler:t}=this,{eventStore:r,resourceStore:n,taskStore:s,id:a}=t,{field:l,editor:o}=i;if(qA[e]&&(t.milestoneWidth=null),r&&!s?i.recordType="event":i.recordType="task",l){let d,c=!1;r&&!s&&(d=r.modelClass.fieldMap[l],d?(i.fieldDef=d,i.recordType="event",c=!0):Reflect.has(r.modelClass.prototype,l)&&(i.recordType="event",c=!0)),!d&&s&&(d=s.modelClass.fieldMap[l],d?(i.fieldDef=d,i.recordType="task",c=!0):Reflect.has(n.modelClass.prototype,l)&&(i.recordType="task",c=!0)),!d&&n&&(d=n.modelClass.fieldMap[l],d?(i.fieldDef=d,i.recordType="resource",c=!0):Reflect.has(n.modelClass.prototype,l)&&(i.recordType="resource",c=!0)),o&&!this.editListenerAdded&&(V.on({element:t.timeAxisSubGrid.element,delegate:"."+this.labelCls,dblclick:"onLabelDblClick",thisObj:this}),this.editListenerAdded=!0)}return i}doDisable(i){super.doDisable(i),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(i){var e;const t=this,r=[];for(const n of GA)if(t[n]){const{field:s,fieldDef:a,recordType:l,renderer:o,thisObj:d}=t[n],c={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${n}`]:1},dataset:{side:n,taskFeature:`label-${n}`}};let u;const h=`${l}Record`,g=i[h];o?(u=o.call(d||t.thisObj||t,{[h]:g,resourceRecord:i.resourceRecord,assignmentRecord:i.assignmentRecord,domConfig:c,...t.scheduler.isSchedulerPro?{eventRecord:g}:{}}),typeof u=="object"&&(Object.assign(c,u),u=null)):(u=g.getValue(s),(a==null?void 0:a.type)==="date"&&!o?u=C.format(u,t.client.displayDateFormat):u=O.encodeHtml(u)),u!=null&&u!==!1&&(c.html=u),(c.html!=null||(e=c.children)!=null&&e.length||c.text!=null)&&r.push(c)}return r}measureLabels(i,e){const t=this,r=t.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const n of i)if(XA[n.dataset.side]){let{html:s}=n,a=0;if(t.labelLayoutMode==="estimate")s.includes("<")&&(s=E.stripTags(s)),a=s.length*t.labelCharWidth+18;else{const o=t.labelMeasureElement||(t.labelMeasureElement=E.createElement({className:"b-sch-event-wrap b-measure-label",parent:t.client.foregroundCanvas}));o.retainElement=!0,oe.sync({targetElement:o,domConfig:{onlyChildren:!0,children:[n]}}),a=o.firstElementChild.offsetWidth}const l=a/r;switch(n.dataset.side){case"before":e.startMS-=l;break;case"after":e.endMS+=l;break}}}onEventDataGenerated(i){var e;if(!this.disabled&&!((e=i.eventRecord)!=null&&e.isResourceTimeRange)){const t=this.generateLabelConfigs(i);KA[this.labelLayoutMode]&&this.measureLabels(t,i),i.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}};y(Bl,"$name","Labels"),y(Bl,"configurable",{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}),Bl.featureClass="b-sch-labels",Bl._$name="Labels",K.registerFeature(Bl,!1,"Scheduler");var Rc=class extends nn.mixin(Zt,iv){static get defaultConfig(){return{hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("attachToProject","onConfigChange"),i}doDestroy(){this.attachToCalendar(null),super.doDestroy()}onConfigChange({name:i}){!this.isConfiguring&&i==="fillTicks"&&this.refresh()}attachToProject(i){super.attachToProject(i),this.attachToCalendar(i.effectiveCalendar),!i.graph&&!this.client.isScheduler&&i.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(i.effectiveCalendar),once:!0},thisObj:this}),i.ion({name:"project",calendarChange:()=>this.attachToCalendar(i.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...i){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...i)}attachToCalendar(i){const e=this,{project:t,client:r}=e;e.detachListeners("calendar"),e.autoGeneratedWeekends=!1,i&&(e.setupDefaultCalendar(),i.intervalStore.ion({name:"calendar",change:()=>e.setTimeout(()=>e.refresh(),1),thisObj:e})),r.isEngineReady&&!r.project.isDelayingCalculation&&!r.isDestroying?e.refresh():t.isDestroyed||(e.detachListeners("initialProjectListener"),t.ion({name:"initialProjectListener",refresh({isCalculated:n}){n!==!1&&(e.refresh(),e.detachListeners("initialProjectListener"))},thisObj:e}))}get calendar(){var i;return(i=this.project)==null?void 0:i.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=C.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(i,e,t){return super.shouldRenderRange(i,e,t)&&(!this.hideRangesOnZooming||i.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const i=this;return i._timeRanges||(i._timeRanges=i.getCalendarTimeRanges(i.calendar)),i._timeRanges}};y(Rc,"$name","NonWorkingTime"),Rc._$name="NonWorkingTime",K.registerFeature(Rc,!1,"Scheduler"),K.registerFeature(Rc,!0,["SchedulerPro","Gantt","ResourceHistogram"]);var Tc=class extends ie{get targetSelector(){return`.b-sch-timeaxis-cell,.b-tasknonworkingtime,.b-sch-resourcetimerange,.b-timeline-subgrid${this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":""}`}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(i){var e;const t=this,{client:r}=t,{button:n,touches:s,target:a,clientX:l,clientY:o}=i,d=r.features.taskDrag||r.features.eventDrag,c=r.readOnly||!(d!=null&&d.enabled);s||n!==0||t.disabled||r.trigger("beforePan",{event:i})===!1||(a.matches(t.targetSelector)||c&&a.closest(r.eventSelector))&&(t.mouseX=l,t.mouseY=o,t.onHeader=t.enableInHeader&&a.closest(".b-sch-header-timeaxis-cell"),(e=t.mouseDetacher)==null||e.call(t),t.mouseDetacher=V.on({element:E.getRootElement(r.element),mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:t}))}onMouseMove(i){const e=this,{client:t}=e,r=t.timeAxisSubGrid.scrollable,n=t.scrollable,s=i.clientX,a=i.clientY;if(i.buttons===0){e.onMouseUp();return}i.preventDefault(),e.vertical&&(t.isVertical||!e.onHeader)&&n.scrollBy(0,e.mouseY-a),e.horizontal&&(t.isHorizontal||!e.onHeader)&&r.scrollBy(e.mouseX-s),t.eventSelectionDisabled||(t.eventSelectionDisabled=!0,e.panControllingEventSelection=!0),e.mouseX=s,e.mouseY=a}onMouseUp(){var i;const{client:e}=this;(i=this.mouseDetacher)==null||i.call(this),this.mouseDetacher=null,e.setTimeout(()=>{this.panControllingEventSelection&&(e.eventSelectionDisabled=!1,e.panControllingEventSelection=!1)},50)}get isActive(){return!!this.mouseDetacher}};y(Tc,"$name","Pan"),y(Tc,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0}),Tc._$name="Pan",K.registerFeature(Tc,!1,["Scheduler","Gantt"]);var zl=class extends Ir{static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateResourceMenu"),i}getDataFromEvent(i){const e=super.getDataFromEvent(...arguments),t=e.cellElement=i.target.closest(".b-resourceheader-cell"),r=t==null?void 0:t.dataset.resourceId;if(r)return e.resourceRecord=this.client.resourceStore.getById(r),e}populateResourceMenu({items:i,resourceRecord:e}){const{client:t}=this;t.readOnly||(i.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:e.readOnly,onItem:()=>t.resourceStore.remove(e)})}get showMenu(){return!0}};y(zl,"$name","ResourceMenu"),y(zl,"configurable",{processItems:null,items:null,type:"resource"}),zl.featureClass="",zl._$name="ResourceMenu",K.registerFeature(zl,!1,["Scheduler"]);var Wl=class extends Ml{static get pluginConfig(){return{...super.pluginConfig,assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]}}attachToProject(i){const e=this,{client:t}=e;if(super.attachToProject(i),!i.resourceTimeRangeStore){i.resourceTimeRangeStore=t.resourceTimeRangeStore||new fl({owner:e});const{crudManager:n}=t;n&&!n.resourceTimeRangeStore&&(n.resourceTimeRangeStore=i.resourceTimeRangeStore)}const r=i.resourceTimeRangeStore;e.exposedOnScheduler||(t.resourceTimeRanges&&(r.add(t.resourceTimeRanges),delete t.resourceTimeRanges),Object.defineProperty(t,"resourceTimeRanges",{get:()=>r.records,set:n=>r.data=n}),e.exposedOnScheduler=!0),r.resourceStore||(r.resourceStore=i.resourceStore),e.detachListeners("store"),r.ion({name:"store",change:e.onStoreChange,thisObj:e})}attachToResourceTimeRangeStore(i){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(i,e){var t;if(!this.disabled){const{timeRanges:r}=i.$original,{startDate:n,endDate:s,visibleDateRange:a}=this.client;(t=this.store.lazyLoad)==null||t.bufferedLazyLoad({startDate:n,endDate:s,resourceRecord:i,visibleStart:a.startDate,visibleEnd:a.endDate}),r!=null&&r.length&&r.forEach(l=>{l.isRecurring?e.push(...l.getOccurrencesForDateRange(n,s)):e.push(l)})}return e}shouldInclude(i){return i.isResourceTimeRange&&!i.isNonWorking&&!i.isCalendarHighlightModel}renderContent(i,e){const{client:t}=this,{eventContent:r}=e;if(t.resourceTimeRangeRenderer){const n=t.resourceTimeRangeRenderer({resourceTimeRangeRecord:i,resourceRecord:e.resourceRecord,renderData:e});Array.isArray(n)?r.children=n:O.isHtml(n)?(r.children=null,r.html=n):typeof n=="string"||typeof n=="object"?r.children=[n]:n!=null&&(r.text=n)}else super.renderContent(...arguments)}doDestroy(){var i;((i=this.store)==null?void 0:i.owner)===this&&this.store.destroy(),super.doDestroy()}};y(Wl,"$name","ResourceTimeRanges"),y(Wl,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"}),Wl.featureClass="",Wl._$name="ResourceTimeRanges",K.registerFeature(Wl,!1,"Scheduler");var Mc=class extends Qh(Jn){onDragStart(...i){if(super.onDragStart(...i),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}onDrop(...i){return this.rejectFeatureTransaction(),super.onDrop(...i)}onAbort(...i){return this.rejectFeatureTransaction(),super.onAbort(...i)}};y(Mc,"$name","RowReorder"),Mc._$name="RowReorder",K.registerFeature(Mc,!1,"Scheduler"),K.registerFeature(Mc,!0,"Gantt");var lg=class extends Xa{onResizeStart({context:i}){var e,t,r;super.onResizeStart(...arguments);const{client:n}=this,{record:s}=i;n.isTimelineBase&&(n.suspendAnimations(),(t=(e=n.crudManager)==null?void 0:e.suspendAutoSync)==null||t.call(e),n.features.eventDragCreate&&(this._oldDragCreateDisabled=n.features.eventDragCreate.disabled,n.features.eventDragCreate.disabled=!0)),n.isSchedulerBase&&(((r=n.getEventLayout)==null?void 0:r.call(n,s).type)==="stack"&&(i.oldEventLayout=s.eventLayout,s.eventLayout="pack",s.rowHeight=i.elementHeight),i.originalBarMargin=n.getBarMargin(s),i.originalResourceMarginObject=n.getResourceMarginObject(s),i.originalRecordResourceMargin=s.resourceMargin)}onResizing({context:i}){const{record:e,newHeight:t,elementHeight:r,originalBarMargin:n,originalResourceMarginObject:s}=i;if(super.onResizing(...arguments),!this.applyToAllRows&&!this.client.fixedRowHeight&&i.valid){if(e.beginBatch(),e.rowHeight=t,t<r){const a=t/r;e.barMargin=n*a,s.start===s.end&&(e.resourceMargin=s.start*a)}e.endBatch()}}onCancel({context:i}){i.record.eventLayout=i.oldEventLayout,i.record.resourceMargin=i.originalRecordResourceMargin,i.record.barMargin=i.originalBarMargin,super.onCancel(...arguments)}cleanup(){var i,e;const{client:t}=this;t.isTimelineBase&&(t.resumeAnimations(),(e=(i=t.crudManager)==null?void 0:i.resumeAutoSync)==null||e.call(i),t.features.eventDragCreate&&(t.features.eventDragCreate.disabled=this._oldDragCreateDisabled)),super.cleanup()}};y(lg,"$name","RowResize"),lg._$name="RowResize",K.registerFeature(lg,!1);var jl=class extends ig{static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateScheduleMenu"),i}shouldShowMenu(i){const{client:e}=this,{targetElement:t,resourceRecord:r}=i,n=e.timeAxisSubGridElement.contains(t);return!t.closest(e.eventSelector)&&n&&!(r&&r.isSpecialRow)}getDataFromEvent(i){var e,t;if(E.isDOMEvent(i)){if(i.target.closest(".b-verticaltimeaxis-cell"))return;const{client:r}=this,n=(e=r.getCellDataFromEvent)==null?void 0:e.call(r,i),s=(t=r.getDateFromDomEvent)==null?void 0:t.call(r,i,"floor"),a=r.resolveResourceRecord(i)||r.isVertical&&r.resourceStore.last;return T.assign(super.getDataFromEvent(i),n,{date:s,resourceRecord:a})}return i}populateScheduleMenu({items:i,resourceRecord:e,date:t}){const{client:r}=this;!r.readOnly&&r.eventStore&&(i.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:this.disableAddEvent,weight:100,onItem(){r.createEvent(t,e,r.getRowFor(e))}})}get disableAddEvent(){const{resourceRecord:i,date:e}=this.menuContext;return!i||i.readOnly||!i.isWorkingTime(e)}};y(jl,"$name","ScheduleMenu"),jl.featureClass="",jl._$name="ScheduleMenu",K.registerFeature(jl,!0,"Scheduler");var _c=class extends ie{static get pluginConfig(){return{chain:["onPaint","onElementClick"]}}doDisable(i){this.client.refresh(),super.doDisable(i)}onPaint({firstPaint:i}){if(i){const{client:e,renderer:t}=this,{timeAxisColumn:r}=e,{defaultRenderer:n}=r;e.timeAxisSubGrid.scrollable.ion({scrollEnd(){e.refreshColumn(r)}}),r.defaultRenderer=(...s)=>(n.apply(r,s),t.apply(this,s))}}renderer({record:i,grid:e}){const{visibleDateRange:t}=e,{labelRenderer:r,forwardIconCls:n,backwardIconCls:s}=this;let a=0,l=0;return i.events.forEach(({isScheduled:o,startDate:d,endDate:c})=>{o&&(c<=t.startDate?l++:d>=t.endDate&&a++)}),{class:"b-scroll-buttons-container",children:[{class:`b-scroll-button-wrap b-scroll-backward ${l>0?"":"b-scroll-button-hidden"}`,children:[{tag:"i",class:{"b-icon":1,"b-scroll-button":1,[s]:1}},r&&{tag:"span",class:"b-scroll-button-content",text:r({resourceRecord:i,isBefore:!0,nbrEvents:l})}]},a>0?{class:"b-scroll-button-wrap b-scroll-forward",children:[r&&{tag:"span",class:"b-scroll-button-content",text:r({resourceRecord:i,isBefore:!1,nbrEvents:a})},{tag:"i",class:{"b-icon":1,"b-scroll-button":1,[n]:1}}]}:null]}}onElementClick(i){const{client:e}=this,{target:t}=i,r=t.closest(".b-scroll-button-wrap"),n=r&&e.getRecordFromElement(t);if(r&&e.trigger("scrollButtonClick",{domEvent:i,resourceRecord:n})!==!1){const{visibleDateRange:s}=e;t.closest(".b-scroll-forward")?e.scrollResourceEventIntoView(n,n.getEventStartingAfter(s.endDate),T.assign({block:"end"},this.scrollOptions)):e.scrollResourceEventIntoView(n,n.getEventEndingBefore(s.startDate),T.assign({block:"start"},this.scrollOptions))}}};y(_c,"$name","ScrollButtons"),y(_c,"configurable",{backwardIconCls:"b-icon-before",forwardIconCls:"b-icon-after",labelRenderer:null,scrollOptions:{animate:{duration:600,easing:"easeTo"},y:!1,edgeOffset:50},testConfig:{scrollOptions:{animate:{duration:20,easing:"easeTo"},y:!1,edgeOffset:50}}}),_c._$name="ScrollButtons",K.registerFeature(_c,!1,"Scheduler");var Ul=class extends ie{static get configurable(){return{messageTemplate:i=>`<div class="b-sch-hovertip-msg">${i.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onInternalPaint"]}}onInternalPaint({firstPaint:i}){if(!i)return;const e=this,{client:t}=e;t.isSchedulerPro&&e.hideForNonWorkingTime===void 0&&(e.hideForNonWorkingTime=!0);let r;const n=e.hoverTip=new ve({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event,.b-dragcreating,.b-creating-dependency) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas,.b-group-footer,.b-group-row) *:not(.b-scroll-button-wrap *,.b-sch-dependency)",getHtml:e.getHoverTipHtml.bind(e),onDocumentMouseDown(s){n.forElement.contains(s.event.target)&&(r=V.on({thisObj:e,element:t.timeAxisSubGridElement,mousemove:l=>n.internalOnPointerOver(l),capture:!0}));const a=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,s),n.hideAnimation=a},...e.config,internalListeners:e.configuredListeners});n.ion({pointerover({event:s}){const a="buttons"in s?s.buttons>0:s.which>0;if(!a&&r&&r(),e.disabled||a)return n.hide(),!1},innerhtmlupdate({source:s}){e.clockTemplate.updateDateIndicator(s.element,e.lastTime)}}),t.ion({timeAxisViewModelUpdate:"updateTip",thisObj:e}),e.clockTemplate=new ur({scheduler:t})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:i,event:e}){const t=this,r=t.client,n=e&&r.getDateFromDomEvent(e,"floor",!0);let s=t.lastHtml;if(n&&e.target){const a=r.resolveResourceRecord(e);if(a&&(n-t.lastTime!==0||a.id!==t.lastResourceId)){if(t.hideForNonWorkingTime){const l=a.isWorkingTime(n);i.element.classList.toggle("b-nonworking-time",!l)}t.lastResourceId=a.id,s=t.lastHtml=t.generateTipContent({date:n,event:e,resourceRecord:a})}}else i.hide(),t.lastTime=null,t.lastResourceId=null;return s}generateTipContent({date:i,event:e,resourceRecord:t}){const r=this,n=r.clockTemplate.generateContent({date:i,text:r.client.getFormattedDate(i)}),s=r.messageTemplate({message:r.getText(i,e,t)||""});return r.lastTime=i,n+s}getText(i,e,t){}};y(Ul,"$name","ScheduleTooltip"),Ul.featureClass="b-scheduletip",Ul._$name="ScheduleTooltip",K.registerFeature(Ul,!0,"Scheduler"),K.registerFeature(Ul,!1,"ResourceUtilization");var og=class extends ie.mixin(eg){static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(i,e){const t=this;t.scheduler=i,i.eventEdit=t,super.construct(i,e),t.clientListenersDetacher=i.ion({[t.triggerEvent]:({eventRecord:r,eventElement:n})=>t.editEvent(r,r.resource,n),dragcreateend:t.onDragCreateEnd,thisObj:t})}doDestroy(){var i;this.clientListenersDetacher(),(i=this.editor)==null||i.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}get project(){return this.client.project}async editEvent(i,e,t,r){const n=this,{scheduler:s}=n,{eventEdit:a}=n.client.features;if(e||(e=i.resource),t||(t=s.getElementFromEventRecord(i)),s.readOnly||n.disabled||i.readOnly||e.readOnly||a&&!a.disabled&&!i.isCreating)return;let{editor:l}=n;t=E.down(t,s.eventInnerSelector)||t,i=i.isAssignment?i.event:i,n.resource=e,n.eventRecord=i,n.element=t,s.element.classList.add("b-eventeditor-editing"),l?l.render(s.timeAxisSubGridElement):(n.editor=l=Gt.new({owner:s.timeAxisSubGrid,appendTo:s.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:s.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:n},onInternalKeyDown:o=>o.stopPropagation()},n.editorConfig),l.revertFocus=()=>s.getElementFromEventRecord(n.eventRecord,n.resourceRecord,!0).focus({scrollIntoView:!1}),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),r?n.applyStmCapture(r):r!==!1&&!n.hasStmCapture&&n.captureStm(!0),i.isCreating&&(i.name=""),await l.startEdit({target:t,record:i,field:n.field}),s.isVertical&&i.startDate<s.visibleDateRange.startDate&&l.element.scrollIntoView(),s.navigator.disabled=!0}onEditorComplete(){this.eventRecord.isCreating=!1,this.reset(),this.freeStm(!0)}onEditorCancel(){const{eventRecord:i}=this;this.reset(),this.freeStm(!1),i.isCreating&&i.remove()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.eventRecord=null,this.resource=null}onEventEnterKey({assignmentRecord:i,eventRecord:e}){const t=i?this.scheduler.getElementFromAssignmentRecord(i):this.scheduler.getElementFromEventRecord(e),r=(i||e).resource;this.editEvent(e,r,t)}onDragCreateEnd({eventRecord:i,resourceRecord:e,eventElement:t,stmCapture:r}){this.element=t,this.editEvent(i,e,t,r)}};y(og,"$name","SimpleEventEdit"),og._$name="SimpleEventEdit",K.registerFeature(og,!1,"Scheduler");var ZA=Object.freeze({animate:!1,block:"start"}),JA=Object.freeze({animate:!1,block:"end"}),bs=class extends Gr{static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateScheduleMenu"),i}getClientConfig(i,e,t,r){var n;const{client:s}=this,a=super.getClientConfig(i,e,t,r);return!s.isSchedulerBase&&!s.isSchedulerProBase&&!s.isGanttBase||(delete a.store,delete a.events,delete a.resources,delete a.assignments,delete a.dependencies,delete a.resourceTimeRanges,delete a.timeRanges,a.project=s.project,a.assignmentStore=a.project.assignmentStore,a.crudManager=s.crudManager,a.viewPreset=s.viewPreset,a.startDate=s.startDate,a.endDate=s.endDate,a.selectedCollection=s.selectedCollection,a.useInitialAnimation=!1,((n=a.features)==null?void 0:n.eventDrag)!==!1&&(T.setPath(a,"features.eventDrag.constrainDragToTimeline",!1),s.features.eventDrag.constrainDragToTimeline=!1)),a}unsplitCleanup(i){this.client.timeAxisSubGrid.onElementResize()}processOptions(i){const{client:e}=this;let{atDate:t,atRecord:r}=i;if(i.direction!=="horizontal"&&!i.atColumn&&!i.atRecord&&!t){const n=L.from(e.element),s=e.getDateFromCoordinate(n.center.x,"round",!1);s&&(i.atDate=t=s,i.atColumn=e.timeAxisColumn)}return t&&(i.direction||(i.direction=r?"both":"vertical"),i.splitX=e.getVirtualCoordFromDate(t)-e.timeAxisSubGrid.scrollable.x,e.rtl?i.splitX+=e._bodyRectangle.width-L.from(e.timeAxisSubGridElement).right+E.scrollBarWidth:i.splitX+=L.from(e.timeAxisSubGridElement,e.bodyContainer).left,i.remainingWidth=L.from(e.element).width-i.splitX),super.processOptions(i)}async split(i={}){const{client:e}=this;if(this.detachListeners("onReconfigure"),e.isVertical)throw new Error("Splitting is not supported in vertical mode");const t=await super.split(i),r=(n,s)=>{n.reconfigure({viewPreset:s.viewPreset,startDate:s.startDate,endDate:s.endDate})};return t&&(i.atDate&&await Promise.all([t[0].scrollToDate(C.add(i.atDate,-1,e.timeAxis.unit),JA),t[1].scrollToDate(i.atDate,ZA)]),e.infiniteScroll&&(i.direction==="horizontal"&&r(t[1].timeAxis,t[0].timeAxis),i.direction==="both"&&(r(t[2].timeAxis,t[0].timeAxis),r(t[3].timeAxis,t[1].timeAxis)))),e.timeAxisSubGrid.scrollable.x+=.5,t.forEach(n=>{n.timeAxis.ion({name:"onReconfigure",reconfigure:"onReconfigure",thisObj:this})}),t}populateCellMenu(){}populateScheduleMenu({items:i,date:e,record:t}){const r=this,{isSplit:n}=r,{splitFrom:s}=r.client;!r.disabled&&r.client.isHorizontal&&(i.splitSchedule={text:"L{split}",localeClass:r,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:n||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:r,weight:100,onItem(){r.split({atRecord:t,direction:"horizontal"}).then()}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:r,weight:200,onItem(){r.split({atDate:e}).then()}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:r,weight:300,onItem(){r.split({atDate:e,atRecord:t,direction:"both"}).then()}}}},i.unsplitSchedule={text:"L{unsplit}",localeClass:r,icon:"b-icon b-icon-clear",hidden:!(n||s),weight:550,onItem(){(s||r).unsplit()}})}onReconfigure({suppressRefresh:i,config:e}){var t;const{client:r}=this;if(e&&!this.isReconfiguring){this.isReconfiguring=!0;const n=r.splitFrom?r.splitFrom:r;n.splitDirection&&n.splitDirection!=="vertical"&&((t=r.syncSplits)==null||t.call(r,s=>{var a,l;const{subViews:o}=n,d=o.indexOf(s),c=o.length>2?d+(d>1?-1:1)*2:1-d;(a=o[d])==null||a.timeAxis.reconfigure(e,i,!1),(l=o[c])==null||l.timeAxis.reconfigure(e,i,!1)})),this.isReconfiguring=!1}}};y(bs,"$name","Split"),y(bs,"configurable",{relayProperties:{value:{barMargin:1,eventColor:1,eventStyle:1,eventLayout:1,fillTicks:1,resourceMargin:1,snap:1,tickSize:1},$config:{merge:"merge"}}}),bs._$name="Split",K.registerFeature(bs,!1,"Scheduler");var QA={width:0,height:0},Gl=class extends ie{static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(i,e){super.construct(i,e),i.isVertical&&(this.toUpdate=new Set,i.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(i){this.client.isHorizontal?i.wrapperCls["b-disable-sticky"]=i.eventRecord.stickyContents===!1:(this.syncEventContentPosition(i,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:i}){i===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:i,style:e}of this.toUpdate)E.applyStyle(i,e);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(i){const{resourceMap:e}=i.currentOrientation;for(const t of e.values())for(const{renderData:r,elementConfig:n}of Object.values(t)){const s=[r];n&&r.eventRecord.isResourceTimeRange&&s.push(n.children[0]),this.syncEventContentPosition.apply(this,s)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(i,e=i.eventContent,t=!1){if(this.disabled||i.eventRecord.stickyContents===!1)return;const{client:r}=this,{eventRecord:n,resourceRecord:s,useEventBuffer:a,bufferAfterWidth:l,bufferBeforeWidth:o,top:d,height:c}=i,u=r.scrollable.y,h=t?null:r.getElementFromEventRecord(n,s,!0),g=h&&oe.getChild(h,"event.content"),f=n.instanceMeta(r),m=typeof e.style=="string"?e.style=E.parseStyle(e.style):e.style||(e.style={});if(h!=null&&h.classList.contains("b-dragging"))return;let p=d,v=c,b=p+v;if(a&&(p+=o,v=v-o-l,b=p+v),p<u&&b>=u&&!n.isMilestone){const w=g==null?void 0:g.offsetWidth,D=(g==null?void 0:g.parentNode)&&E.getStyleValue(g.parentNode,"justifyContent"),S=D==="center"?(i.width-w)/2:0,x=p,R=x+v-1;if((!g||w)&&x<u&&R>=u){const M=this.getEventContentMargins(g),_=g?v-g.offsetHeight-M.height-S:Number.MAX_SAFE_INTEGER,k=Math.min(u-x,_-2);m.transform=k>0?`translateY(${k}px)`:"",f.stuck=!0}else m.transform="",f.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:m})}else g&&f.stuck&&(m.transform="",f.stuck=!1,this.toUpdate.add({contentEl:g,style:m}))}getEventContentMargins(i){return i!=null&&i.classList.contains("b-sch-event-content")?E.getEdgeSize(i,"margin"):QA}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}};y(Gl,"$name","StickyEvents"),y(Gl,"type","stickyEvents"),Gl._$name="StickyEvents",K.registerFeature(Gl,!0,"Scheduler"),K.registerFeature(Gl,!1,"ResourceHistogram");var Yl=class extends Ga{onInternalPaint({firstPaint:i}){const e=this,{project:t}=e.client,{resourceStore:r}=t;if(i)if(e.refreshSuspended&&e.client.resumeRefresh(),r.count)e.lockRows();else{const n=t.ion({refresh:()=>{r.count&&(n(),e.lockRows())}})}}getClientConfig(i,e,t,r){const n=this.superGetClientConfig(i,e,t,r);return n.partner=this.client,delete n.crudManager,n}};y(Yl,"$name","LockRows");var eL=Yl.prototype,tL=bs.prototype;eL.superGetClientConfig=tL.getClientConfig,Yl.configurable.relayProperties=bs.configurable.relayProperties,Yl._$name="LockRows",K.registerFeature(Yl,!1,"Scheduler");var dg=class extends Qa{static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(i,e){const t=this;super.construct(i,e),t.summaries||(t.summaries=[{renderer:t.renderer}]),i.isTimelineBase&&(t.updateProject(i.project),i.ion({timeAxisViewModelUpdate:t.renderRows,thisObj:t}))}updateProject(i){this.detachListeners("summaryProject"),i.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){var i;this.client.isHorizontal&&((i=this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer"))==null||i.classList.add("b-sch-summarybar")),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const i=this,{client:e}=i,t=e.isHorizontal?"width":"height",r=e.timeAxisViewModel.columnConfig,n=i.summaryBarElement;n&&(!i._tip&&i.showTooltip&&i.summaries.some(s=>s.label)&&(i._tip=new ve({id:`${e.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:n,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:s})=>s._tipHtml})),n.innerHTML=r[r.length-1].map(s=>`<div class="b-timeaxis-tick" style="${t}: ${s.width}px"></div>`).join(""),i.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(i){var e;const{isConfiguring:t}=this.client;super.doDisable(i),(e=this.summaryColumn)==null||e.toggle(!i),!t&&!i&&this.render()}doDestroy(){var i;(i=this._tip)==null||i.destroy(),super.doDestroy()}};y(dg,"$name","TimelineSummary"),dg._$name="TimelineSummary";var cg=class extends dg{static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("bindStore","updateEventStore","updateResourceStore"),i}construct(i,e){const t=this;t.scheduler=i,i.isVertical&&(i.timeAxisSubGrid.resizable=!1,e.hideFooters=!0,i.add(i.createSubGrid("right")),t.summaryColumn=i.columns.add(T.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:t.disabled},t.verticalSummaryColumnConfig))[0]),super.construct(i,e),i.isSchedulerBase&&(t.updateEventStore(i.eventStore),t.updateResourceStore(i.resourceStore))}updateEventStore(i){this.detachListeners("summaryEventStore"),i.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(i){this.detachListeners("summaryResourceStore"),i.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const i=this,{client:e}=i,{eventStore:t,timeAxis:r}=e,n=i.summaryBarElement,s=i.selectedOnly&&e.selectedRecords.length?e.selectedRecords:e.resourceStore.records;if(n&&e.isEngineReady){const a=e.getResourcesEventsPerTick(s,({event:l})=>!t.isFiltered||t.records.includes(l));Array.from(n.children).forEach((l,o)=>{const d=r.getAt(o),c=a[o]||[];let u="",h=`<header>${i.L("L{Summary for}",e.getFormattedDate(d.startDate))}</header>`;i.summaries.forEach(g=>{const f=g.renderer({startDate:d.startDate,endDate:d.endDate,resourceStore:e.resourceStore,eventStore:t,events:c,element:l}),m=f?`<div class="b-timeaxis-summary-value">${f}</div>`:"";(i.summaries.length>1||f)&&(u+=m),h+=m?`<label>${g.label||""}</label>`+m:""}),l.innerHTML=u,l._tipHtml=u?h:""})}}updateSummaries(){this.isConfiguring||this.refreshSummaries()}};y(cg,"$name","Summary"),cg._$name="Summary",K.registerFeature(cg,!1,"Scheduler");var iL={maintainVisibleStart:!0},kc=class extends Ya{static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateTimeAxisHeaderMenu"),i}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(i){const{column:e,targetElement:t}=i,{client:r}=this;return r.isHorizontal?(e==null?void 0:e.enableHeaderContextMenu)!==!1&&(e==null?void 0:e.isTimeAxisColumn):t.closest(".b-verticaltimeaxis-cell")}populateTimeAxisHeaderMenu({items:i}){const e=this,{client:t}=e,r={magnitude:t.timeAxis.shiftIncrement,unit:t.timeAxis.shiftUnit};Object.assign(i,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:e,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||e.disabled,weight:200,menu:{items:{zoomSlider:{type:"slider",weight:210,minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:n}){const[s]=n.items;s.min=t.minZoomLevel,s.max=t.maxZoomLevel,s.value=t.zoomLevel,e.zoomDetacher=s.ion({change:"onZoomSliderChange",thisObj:e})},onHide(){var n;(n=e.zoomDetacher)==null||n.call(e),e.zoomDetacher=null}}},dateRange:{text:"L{activeDateRange}",localeClass:e,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:e},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,highlightExternalChange:!1,picker:{internalListeners:{beforeShow:e.updateMinAllowedStartDate,thisObj:e}},internalListeners:{change:e.onRangeDateFieldChange,thisObj:e}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,highlightExternalChange:!1,picker:{internalListeners:{beforeShow:e.updateMaxAllowedEndDate,thisObj:e}},internalListeners:{change:e.onRangeDateFieldChange,thisObj:e}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:e.onLeftShiftBtnClick,thisObj:e}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,internalListeners:{click:e.onTodayBtnClick,thisObj:e}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:e.onRightShiftBtnClick,thisObj:e}}},internalListeners:{paint:e.initDateRangeFields,thisObj:e}}}})}onZoomSliderChange({value:i}){this.client.zoomLevel=i}initDateRangeFields({source:i,firstPaint:e}){if(e){const{widgetMap:t}=i;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const i=this;i.startDateField.suspendEvents(),i.endDateField.suspendEvents(),i.startDateField.value=i.startDateFieldInitialValue=i.client.startDate,i.endDateField.value=i.endDateFieldInitialValue=i.client.endDate,i.startDateField.resumeEvents(),i.endDateField.resumeEvents()}updateMaxAllowedEndDate({source:i}){return i.maxDate=this.client.getAllowedDateRange().endDate,!0}updateMinAllowedStartDate({source:i}){return i.minDate=this.client.getAllowedDateRange().startDate,!0}onRangeDateFieldChange({source:i}){const e=this,t=i===e.startDateField,{client:r}=e,{timeAxis:n}=r,s=e.startDateFieldInitialValue&&!t?e.startDateFieldInitialValue:e.startDateField.value;let a=e.endDateFieldInitialValue&&t?e.endDateFieldInitialValue:e.endDateField.value;t?e.startDateFieldInitialValue=null:e.endDateFieldInitialValue=null,a-s?a<s&&(a=C.add(s,n.shiftIncrement,n.shiftUnit)):a=C.add(a,n.shiftIncrement,n.shiftUnit),r.setTimeSpan(s,a,iL),e.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const i=C.clearTime(new Date);this.client.setTimeSpan(i,C.add(i,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}};y(kc,"$name","TimeAxisHeaderMenu"),y(kc,"configurable",{menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",align:{monitorResize:!1},scrollAction:null,constrainTo:globalThis}},processItems:null,items:null,type:"timeAxisHeader"}),kc._$name="TimeAxisHeaderMenu",K.registerFeature(kc,!0,["Scheduler","TimelineHistogram","Gantt"]);var ql=class extends nn.mixin(Zt){get timeRanges(){var i;const e=this,{store:t}=e;if(!e._timeRanges){let r=[];if(t&&(r=t.records,(i=t.recurringEvents)!=null&&i.size)){const{startDate:n,endDate:s}=e.client.timeAxis;r=r.flatMap(a=>a.isRecurring?a.getOccurrencesForDateRange(n,s):a)}e.showCurrentTimeLine&&e.currentTimeLine&&(r=[e.currentTimeLine,...r]),e._timeRanges=r}return e._timeRanges}attachToProject(i){var e,t;const r=this;r.attachToTimeRangeStore(i.timeRangeStore),super.attachToProject(i),(e=r.projectTimeZoneChangeDetacher)==null||e.call(r),r.showCurrentTimeLine&&(r.projectTimeZoneChangeDetacher=(t=r.client.project)==null?void 0:t.ion({timeZoneChange:"updateCurrentTimeLine",thisObj:r}),r.currentTimeLine&&r.updateCurrentTimeLine())}initCurrentTimeLine(){var i,e,t;const r=this;if(r.currentTimeLine||!r.showCurrentTimeLine)return;const n=typeof r.showCurrentTimeLine=="object"?r.showCurrentTimeLine:{};r.currentTimeLine=(((i=r.store)==null?void 0:i.modelClass)||xt).new({id:"currentTime",cls:"b-sch-current-time"},n),r.currentTimeInterval=r.setInterval(()=>r.updateCurrentTimeLine(),r.currentTimeLineUpdateInterval),r._timeRanges=null,r.updateCurrentTimeLine(),(t=(e=r.client).syncSplits)==null||t.call(e,s=>{var a,l,o;return(o=(l=(a=s.features)==null?void 0:a.timeRanges)==null?void 0:l.initCurrentTimeLine)==null?void 0:o.call(l)})}updateCurrentTimeLine(){var i;const e=this,{currentTimeLine:t,client:r}=e;t.timeZone=(i=e.project)==null?void 0:i.timeZone,t.setLocalDate("startDate",new Date),t.endDate=t.startDate,t.originalData.name||(t.name=C.format(t.startDate,e.currentDateFormat)),e.renderRanges(),r.trigger("currentTimelineUpdate",{date:t.startDate})}hideCurrentTimeLine(){var i,e;const t=this;t.currentTimeLine&&(t.clearInterval(t.currentTimeInterval),t.currentTimeLine=null,t.refresh(),(e=(i=t.client).syncSplits)==null||e.call(i,r=>{var n,s,a;return(a=(s=(n=r.features)==null?void 0:n.timeRanges)==null?void 0:s.hideCurrentTimeLine)==null?void 0:a.call(s)}))}updateShowCurrentTimeLine(i){i?this.initCurrentTimeLine():this.hideCurrentTimeLine(),this.client.trigger("stateChange")}populateTimeAxisHeaderMenu({items:i}){i.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.currentTimeLine,onToggle:({checked:e})=>{this.showCurrentTimeLine?this.updateShowCurrentTimeLine(e):this.showCurrentTimeLine=e}}}attachToStore(i){const e=this;e.storeDetacher&&e.storeDetacher(),e.storeDetacher=i.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:e}),e._timeRanges=null,e.renderRanges()}get store(){var i;return(i=this.client.project)==null?void 0:i.timeRangeStore}attachToTimeRangeStore(i){const{client:e}=this;this.attachToStore(i),e.timeRanges&&!e._timeRangesExposed&&(i.add(e.timeRanges),delete e.timeRanges)}resolveTimeRangeRecord(i){const e=i.closest(this.baseSelector).dataset.id;return e==="currentTime"?this.currentTimeLine:this.store.getById(e)}onStoreChange({type:i,action:e}){const t=this;t._timeRanges=null,!(t.disabled||!t.client.isVisible||t.isConfiguring||i==="refresh"&&e!=="batch")&&t.client.runWithTransition(()=>t.renderRanges(),!t.client.refreshSuspended)}onDragStart(i){const e=this,{context:t}=i,r=e.resolveTimeRangeRecord(t.element.closest(e.baseSelector)),n=e.getBodyElementByRecord(r);t.relatedElements=[n],Object.assign(t,{record:r,rangeBodyEl:n,originRangeX:i.source.getX(n),originRangeY:i.source.getY(n)}),t.element.retainElement=!0,n.retainElement=!0,super.onDragStart(i),e.showTip(t)}onDrop(i){const{context:e}=i,{rangeBodyEl:t,element:r}=e;if(r.retainElement=void 0,t.retainElement=void 0,!e.valid)return this.onInvalidDrop({context:e});const n=this,{client:s}=n,{record:a}=e,l=s.isHorizontal?e.newX:e.newY,o=s.getDateFromVirtualCoord({coord:l,roundingMethod:"round"});a.startDate-o!==0?a.setStartDate(o):n.drag.abort(),n.destroyTip(),super.onDrop(i)}onResizeStart({context:i}){const e=this,t=e.resolveTimeRangeRecord(i.element.closest(e.baseSelector)),r=e.getBodyElementByRecord(t);Object.assign(i,{record:t,rangeBodyEl:r}),e.showTip(i),super.onResizeStart(...arguments)}onResizeDrag({source:i,context:e}){const t=this,{rangeBodyEl:r}=e,{client:n}=t,{isHorizontal:s}=n,a=s?e.newX:e.newY,l=s?e.newX+e.newWidth:e.newY+e.newHeight,o=n.getDateFromVirtualCoord({coord:a,roundingMethod:"round"}),d=n.getDateFromVirtualCoord({coord:l,roundingMethod:"round"});s?(e.edge==="left"&&i.setX(r,e.newX),r.style.width=e.newWidth+"px"):(e.edge==="top"&&i.setY(r,e.newY),r.style.height=e.newHeight+"px"),t.updateDateIndicator({startDate:o,endDate:d})}onResize({context:i}){if(!i.valid)return this.onInvalidDrop({context:i});const e=this,{client:t}=e,{record:r}=i,n=t.isHorizontal?i.newX:i.newY,s=t.isHorizontal?i.newX+i.newWidth:i.newY+i.newHeight,a=t.getDateFromVirtualCoord({coord:n,roundingMethod:"round"}),l=t.getDateFromVirtualCoord({coord:s,roundingMethod:"round"}),o=i.edge==="left"||i.edge==="top";(o&&r.startDate-a!==0||l&&r.endDate-l!==0)&&l>a?o?r.setStartDate(a,!1):r.setEndDate(l,!1):e.onInvalidResize({context:i}),e.destroyTip()}onInvalidResize({context:i}){const e=this;e.resize.reset(),i.rangeBodyEl.parentElement.lastDomConfig=i.rangeBodyEl.lastDomConfig=i.element.lastDomConfig=null,e.renderRanges(),e.destroyTip()}get state(){return{showCurrentTimeLine:this.showCurrentTimeLine}}};y(ql,"stateProperties",["showCurrentTimeLine"]),y(ql,"$name","TimeRanges"),y(ql,"configurable",{currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:{$config:"lazy",value:null}}),ql._$name="TimeRanges",K.registerFeature(ql,!1,["TimelineBase"]);var ug=class extends nn.mixin(z0){static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},enableDragSelect:!1,headerRenderer({timeRange:i}){const{dateFormat:e}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${C.format(i.startDate,e)}</span>
                        <span class="b-selection-end">${C.format(i.endDate,e)}</span>
                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:{$config:null,value:null,default:null}}}onUIReady(){const i=this;super.onUIReady(),i.hoverTooltip&&(i.hoverTooltip.getHtml=()=>i.tooltipTemplate({...i.selectedTimeSpan})),i.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",timeAxisHeaderClick:"onTimeAxisHeaderClick",thisObj:i})}onTimeAxisHeaderMouseDown({startDate:i,endDate:e}){!this.disabled&&this.enableDragSelect&&(this.selectedTimeSpan=null)}onTimeAxisHeaderClick({startDate:i,endDate:e}){this.disabled||(this.selectedTimeSpan={startDate:i,endDate:e})}onTimeRangeClick(i){super.onTimeRangeClick(i);const e=this;!e.disabled&&i.target.closest(".b-selected-time-span")&&(i.target.matches('[data-ref="closeButton"]')?e.selectedTimeSpan=null:e.client.trigger("timeSelectionElementClick",{...e.selectedTimeSpan,domEvent:i}))}updateFromCoords(i,e,t,r){const{client:n}=this,s=n.isHorizontal?t:r,a=n.isHorizontal?i:e,l=n.getDateFromVirtualCoord({coord:a,roundingMethod:"round"})||n.startDate,o=n.getDateFromVirtualCoord({coord:a+s,roundingMethod:"round"})||n.endDate;this.selectedTimeSpan={startDate:l,endDate:o}}onResizeStart({source:i}){const{timeAxisViewModel:e,timeResolution:t}=this.client,r=C.asMilliseconds(t.increment,t.unit);this.resize.minWidth=e.getDistanceForDuration(r),super.onResizeStart(...arguments)}onResizeDrag({context:i}){var e,t;this.updateFromCoords(i.newX,i.newY,(e=i.newWidth)!=null?e:i.elementWidth,(t=i.newHeight)!=null?t:i.elementHeight)}onDragStart(i){super.onDragStart(i);const{context:e}=i;e.elementWidth=e.element.offsetWidth,e.elementHeight=e.element.offsetHeight}onDrag({context:i}){this.updateFromCoords(i.newX,i.newY,i.elementWidth,i.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(i){return i&&(i.id="time-selection"),i}updateSelectedTimeSpan(i){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",{...i!=null?i:{}})}onTimeSpanDragSelected({startDate:i,endDate:e}){this.selectedTimeSpan={startDate:i,endDate:e}}};y(ug,"$name","TimeSelection"),ug._$name="TimeSelection",K.registerFeature(ug,!1,["TimelineBase"]);var Kl=class extends Gt{async onEditorKeyDown(i){if(i.key==="Tab"||i.key==="Enter"){const e=this,{record:t,owner:r}=e;if(i.preventDefault(),i.stopImmediatePropagation(),i.key==="Tab"){const n=r.getAdjacentDate(t.startDate,!i.shiftKey);n&&(await e.completeEdit(),r.editTickCell({id:t.resourceId},n))}else if(i.key==="Enter"){const n=r.getAdjacentResource(t.resourceId,!i.shiftKey);n&&(await e.completeEdit(),r.editTickCell(n,t.startDate))}}else super.onEditorKeyDown(i)}};y(Kl,"$name","TickEditor"),y(Kl,"type","tickeditor"),y(Kl,"configurable",{appendToTargetParent:!0,cls:"b-tick-editor",inputField:{type:"numberfield",autoSelect:!0}}),Kl.initClass(),Kl._$name="TickEditor";var Xl=class extends Ml{changeResourceTickStore(i){return pe.getStore(i,Rl)}updateResourceTickStore(i,e){this.detachStore(e),i=pe.getStore(i,Rl),i.id||(i.id="resourceTicks"),i.storage.addIndex({property:"indexKey"}),this.attachStore(i)}detachStore(i){i&&this.detachListeners(i.$$name)}attachStore(i){this.syncDataOnLoad&&(i.syncDataOnLoad=this.syncDataOnLoad),i.ion({name:i.$$name,change:"internalOnStoreChange",thisObj:this})}updateResourceTicksData(i){this.resourceTickStore.data=i}updateClient(i){i.ion({scheduleDblClick:"onTimeAxisCellDblClick",thisObj:this})}getEventsToRender(i,e){const{client:t}=this,{timeAxis:r}=t;if(!this.disabled){const n=Math.floor(r.getTickFromDate(r.startDate)),s=Math.ceil(r.getTickFromDate(r.endDate));for(let a=n;a<=s;a++){const l=r.getDateFromTick(a),o=this.getResourceTickRecord(i,l);o&&e.push(o)}}return e}shouldInclude({isTickCell:i}){return i}generateElementId(i){return`tick-cell-${i.id}`}getElementFromResourceTimeRangeRecord(i){return this.canvas.syncIdMap[`tick-cell-${i.domId}`]}tickRenderer(i){return i.value}onEventDataGenerated(i){const e=this,{client:t}=e,{eventRecord:r}=i;if(e.shouldInclude(r)){t.isVertical?i.width=t.getResourceWidth(i.resourceRecord):i.top=0,i.fillSize=!0,i.wrapperCls[e.rangeCls]=1,i.wrapperCls["b-sch-style-none"]=0,i.wrapperCls["b-sch-color-none"]=0,i.cls[e.cls]=1,i.entityName=e.entityName,i.eventId=e.generateElementId(r);const n=e.tickRenderer(r);t.isVertical&&typeof n!="object"&&(i.eventContent={text:n}),i.children=B.asArray(n)}}internalOnStoreChange(i){return this.client.refresh(),this.trigger("change",{store:i.source,...i,source:this})}getResourceTickRecord(i,e){return this.resourceTickStore.storage.getBy("indexKey",`${e.getTime()}-${i.id}`)}editTickCell(i,e){const t=this,{client:r}=t;let n=t.getResourceTickRecord(i,e);n||([n]=t.resourceTickStore.add({resourceId:i.id,startDate:e,duration:r.timeAxis.increment,durationUnit:r.timeAxis.unit}));const s=t.getElementFromResourceTimeRangeRecord(n);t.editor=new Kl({appendTo:t.canvas,owner:t}),t.editor.startEdit({target:s,record:n,field:"value"})}getNextDate(i){return this.getAdjacentDate(i)}getPrevDate(i){return this.getAdjacentDate(i,!1)}getAdjacentDate(i,e=!0){const{timeAxis:t}=this.client,r=C.add(i,t.increment*(e?1:-1),t.unit);return r>=t.startDate&&r<t.endDate?r:null}getNextResource(i){return this.getAdjacentResource(i)}getPrevResource(i){return this.getAdjacentResource(i,!1)}getAdjacentResource(i,e=!0){return i=this.client.store.getById(i),this.client.store[e?"getNext":"getPrev"](i)}onTimeAxisCellDblClick({resourceRecord:i,tickStartDate:e}){this.showEditor&&this.editTickCell(i,e)}};y(Xl,"$name","TickCells"),y(Xl,"configurable",{resourceTickStore:{},entityName:"tickCell",rangeCls:"b-sch-tick-cell",cls:"",resourceTicksData:null,showEditor:!0}),Xl._$name="TickCells",K.registerFeature(Xl,!1,["Scheduler","SchedulerPro","Gantt"]);var Fc=class extends Xl{static get pluginConfig(){return{before:["onInternalPaint","internalOnVisibleDateRangeChange"],chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}changeRenderer(i){if(!i)throw new Error("The TreeSummary feature requires defining a `renderer` function");return i}onInternalPaint({firstPaint:i}){super.onInternalPaint(...arguments),i&&this.client.ion({treeGroupChange:()=>this.updateResourceTickCell()})}attachToEventStore(i){i.ion({name:"eventStore",change:"onEventStoreChange",buffer:1,thisObj:this})}attachToResourceStore(i){i.ion({name:"resourceStore",change:"onResourceStoreChange",buffer:1,thisObj:this})}doDisable(i){super.doDisable(i),this.isConfiguring||this.client.renderRows()}internalOnVisibleDateRangeChange(){this.disabled||this.updateResourceTickCell()}async onEventStoreChange(){await this.client.project.commitAsync(),this.disabled||this.updateResourceTickCell()}async onResourceStoreChange({action:i,records:e}){if(await this.client.project.commitAsync(),!this.disabled)if(i==="remove"||i===void 0)this.updateResourceTickCell();else{const t=new Set;e.forEach(r=>{r.bubble(n=>(t.add(n),!r.isParent))}),this.updateResourceTickCell(t,!1)}}updateDisabled(i){this.isConfiguring||(i?this.resourceTickStore.removeAll():this.updateResourceTickCell())}updateResourceTickCell(i=null,e=!0){const t=this,{client:r,resourceTickStore:n}=t,{timeAxis:s,visibleDateRange:a}=r;if(!t.disabled){const l=Math.floor(s.getTickFromDate(a.startDate)),o=Math.ceil(s.getTickFromDate(a.endDate)),d=[];if((i&&i.size!==0?i:r.store.storage.allValues).forEach(c=>{if(c!=null&&c.isParent)for(let u=l;u<o;u++){const h=s.getDateFromTick(u),g=s.getDateFromTick(u+1),f=t.renderer({startDate:h,endDate:g,resourceRecord:c,eventStore:r.eventStore,resourceStore:r.resourceStore,timeline:r});(f||f===0)&&d.push({id:`${u}-${c.id}`,startDate:h,endDate:g,value:f,resourceId:c.id})}}),e)t.resourceTicksData=d;else{const{allValues:c}=n.storage,u=[];for(const h of i)for(const g of c)g.resourceId===h.id&&u.push(g);r.suspendRefresh(),n.remove(u),n.add(d),r.resumeRefresh(!1),r.refresh()}}}};y(Fc,"$name","TreeSummary"),y(Fc,"configurable",{rangeCls:"b-sch-tick-summary-cell",cls:"b-tree-summary-cell",showEditor:!1,renderer:!1,enableMouseEvents:!0}),Fc._$name="TreeSummary",K.registerFeature(Fc,!1,["Scheduler","SchedulerPro","Gantt"]);var Hi={completeview:"completeview",currentview:"currentview",daterange:"daterange"},Ic=i=>class extends i{cloneElement(t,r,n){super.cloneElement(t,r,n);const s=this.element.querySelector(".b-schedulerbase");s==null||s.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map(a=>`b-initial-${a}`))}async prepareComponent(t){const r=this,{client:n}=t,{isVertical:s}=n,a=n.timeAxisSubGrid.width>0;switch(t.scheduleRange){case Hi.completeview:t.rangeStart=n.startDate,t.rangeEnd=n.endDate;break;case Hi.currentview:{const{startDate:p,endDate:v}=n.visibleDateRange;t.rangeStart=p,t.rangeEnd=v;break}}await n.waitForAnimations(),t.infiniteScroll=n.infiniteScroll,n.infiniteScroll=!1,a&&(t.scheduleRange!==Hi.currentview&&n.setTimeSpan(t.rangeStart,t.rangeEnd),t.scheduleRange===Hi.daterange&&(t.rangeStart=n.startDate,t.rangeEnd=n.endDate),n.svgCanvas),r._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,await super.prepareComponent(t);const{exportMeta:l,element:o}=r,d=o.querySelector(".b-sch-foreground-canvas"),c=o.querySelector(".b-resource-time-range-canvas"),u=o.querySelector(`.b-${s?"vertical":"horizontal"}timeaxis`),h=l.subGrids.normal;if(E.forEachSelector(o,".b-sch-canvas",p=>{let v="";for(const w of p.classList.values())v+=`.${w}`;const b=n.element.querySelector(v);b&&b.clientWidth&&(p.style.width=`${b.clientWidth}px`)}),l.includeTimeline=a,l.timeAxisHeaders=[],l.timeAxisPlaceholders=[],l.headersCollected=!1,l.eventsBoxes=new Map,l.resourceTimeRangesMap=new Map,l.eventsMap=new Map,l.verticalTimeAxisMargin=0,l.isHorizontal=!s,l.client=n,a)if(t.scheduleRange!==Hi.completeview)if(s)l.totalHeight=n.headerHeight+n.getTimeSpanDistance(t.rangeStart,t.rangeEnd)+n.footerHeight,l.verticalTimeAxisMargin=-1*n.getCoordinateFromDate(t.rangeStart);else{if(l.totalWidth-=h.width,l.totalWidth+=h.width=n.timeAxisViewModel.getDistanceBetweenDates(t.rangeStart,t.rangeEnd),r.isMultiPageExporter){const p=Math.ceil(l.totalWidth/l.pageWidth),v=p*l.verticalPages;l.horizontalPages=p,l.totalPages=v}h.scrollLeft=n.getCoordinateFromDate(t.rangeStart)}else s&&(l.totalHeight=n.headerHeight+n.timeAxisViewModel.totalSize+n.footerHeight);if(!a)return;E.forEachSelector(u,".b-sch-header-row",p=>{l.timeAxisPlaceholders.push(r.createPlaceholder(p)),l.timeAxisHeaders.push(new Map)}),l.eventsPlaceholder=r.createPlaceholder(d,!1),E.removeEachSelector(d,".b-sch-event-wrap"),E.removeEachSelector(r.element,".b-released"),c&&(l.resourceTimeRangesPlaceholder=r.createPlaceholder(c,!1),E.removeEachSelector(c,".b-sch-resourcetimerange"));const g=o.querySelector(".b-column-lines-canvas"),f=o.querySelector(".b-timeranges-header-canvas"),m=o.querySelector(".b-timeranges-body-canvas");if(n.hasActiveFeature("columnLines")&&g&&(l.columnLinesPlaceholder=r.createPlaceholder(g),l.columnLines=""),m&&Object.values(n.features).some(p=>p instanceof nn)&&(l.timeRanges={},f&&(l.timeRanges.header="",l.timeRangesHeaderPlaceholder=r.createPlaceholder(f)),l.timeRanges.body="",l.timeRangesBodyPlaceholder=r.createPlaceholder(m)),n.hasActiveFeature("dependencies")){n.features.dependencies.fillDrawingCache();const p=o.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);p&&(l.dependenciesPlaceholder=r.createPlaceholder(p,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),E.removeEachSelector(p,".b-sch-dependency"))}}async restoreComponent(t){const{client:r}=t;r.infiniteScroll=t.infiniteScroll,r.enableEventAnimations=this._oldEnableEventAnimations,await super.restoreComponent(t)}async onRowsCollected(t,r){const n=this;if(await super.onRowsCollected(t,r),n.exportMeta.includeTimeline){const{pageRangeStart:s,pageRangeEnd:a}=n.getCurrentPageDateRange(r);s&&a&&(n.renderTimeAxisHeaders(r,s,a),n.renderResourceHeaders(r),n.renderLines(r,s,a),n.renderRanges(r,s,a),n.renderEvents(r,t,s,a))}}async stateNextPage(t){var r,n;await((r=super.stateNextPage)==null?void 0:r.call(this,t));const s=this;s.exportMeta.eventsBoxes.clear(),s.exportMeta.eventsMap.clear(),(n=s.exportMeta.rowsMap)==null||n.clear(),s.exportMeta.resourceTimeRangesMap.clear(),s.exportMeta.timeAxisHeaders.forEach(a=>a.clear()),s.exportMeta.columnLines="",s.exportMeta.timeRanges={}}getCurrentPageDateRange({rangeStart:t,rangeEnd:r,client:n}){const s=this,{exportMeta:a}=s,{horizontalPages:l,horizontalPosition:o,pageWidth:d,subGrids:c}=a;let u,h;if(l>1){const g=o*d,f=(o+1)*d,m=c.locked.width+c.locked.splitterWidth;if(f<=m)h=u=null;else{const{scrollLeft:p=0}=c.normal;u=n.getDateFromCoordinate(Math.max(g-m+p,0)),h=n.getDateFromCoordinate(f-m+p)||r}}else u=t,h=r;return{pageRangeStart:u,pageRangeEnd:h}}prepareExportElement(){const{element:t,exportMeta:r}=this,{id:n,headerId:s,footerId:a,scrollLeft:l}=r.subGrids.normal;return t.querySelector(`[id="${n}"]`).querySelectorAll(".b-sch-canvas").forEach(d=>{d.style.height="",l&&(d.style.marginInlineStart=`-${l}px`)}),l&&[s,a].forEach(d=>{const c=t.querySelector(`[id="${d}"] .b-widget-scroller`);c&&(c.style.marginInlineStart=`-${l}px`)}),super.prepareExportElement()}renderTimeAxisHeaders(t,r,n){const s=this,{exportMeta:a}=s,{client:l}=t,{isHorizontal:o,timeAxisHeaders:d}=a,c=o?l.timeAxisColumn.timeAxisView:l.verticalTimeAxisColumn.view,u=c.buildCells(r,n),h=document.createElement("div");oe.sync({targetElement:h,domConfig:u}),E.forEachSelector(h,".b-sch-header-row",(g,f)=>{const m=d[f];E.forEachSelector(g,".b-sch-header-timeaxis-cell",p=>{m.has(p.dataset.tickIndex)||m.set(p.dataset.tickIndex,p.outerHTML)})})}renderResourceHeaders(t){const r=this,{client:n}=t;if(n.isHorizontal)return;const{exportMeta:s}=r,a=n.timeAxisColumn.resourceColumns,l=a.renderResourceHeaders(0,n.resourceStore.allResourceRecords.length-1),o=document.createElement("div");oe.sync({targetElement:o,domConfig:{onlyChildren:!0,children:l}}),s.resourceHeaders=o.innerHTML}renderEvents(t,r,n,s){const a=this,{client:l}=t,{isHorizontal:o,eventsMap:d,eventsBoxes:c,resourceTimeRangesMap:u}=a.exportMeta,h=E.createElement({parent:document.body,style:"visibility:hidden;",children:[{tag:"div"}]}),g=h.firstChild;if(o)for(const f of r){const m=l.store.getAt(f.dataIndex),p=l.currentOrientation.getResourceLayout(m),v=l.getCoordinateFromDate(n),b=l.getCoordinateFromDate(s),w=l.currentOrientation.getEventDOMConfigForCurrentView(p,f,l.rtl?b:v,l.rtl?v:b);for(const D of w){const{eventId:S}=D.dataset,{insetInlineStart:x,insetBlockStart:R,width:M,height:_}=D.style;oe.sync({targetElement:g,domConfig:D,callback:({action:F,domConfig:I,lastDomConfig:A,targetElement:P,jsx:H})=>T0(l,!1,{action:F,domConfig:I,lastDomConfig:A,targetElement:P,jsx:H})});const k=String(S);D.elementData.entityName==="resourceTimeRange"?u.set(k,g.outerHTML):(c.set(k,new L(x,R,M,_)),d.set(k,g.outerHTML))}}else l.resources.forEach(f=>{const m=l.vertical.renderResource(f,n,s);for(const p of m){const{eventId:v}=p.dataset,{left:b,width:w,height:D,fontSize:S}=p.style,x=p.style.top;oe.sync({targetElement:g,domConfig:p,callback:({action:R,domConfig:M,lastDomConfig:_,targetElement:k,jsx:F})=>_0(l,!1,{action:R,domConfig:M,lastDomConfig:_,targetElement:k,jsx:F})}),p.elementData.renderData.entityName==="resourceTimeRange"?u.set(String(v),g.outerHTML):(d.set(v,g.outerHTML),c.set(String(v),new L(b,x,w,typeof D=="string"?S:D)))}});h.remove()}renderLines(t,r,n){const s=this,{client:a}=t,{exportMeta:l}=s,{columnLinesPlaceholder:o}=l;if(o){const d=a.features.columnLines.getColumnLinesDOMConfig(r,n,0,a.resourceStore.allResourceRecords.length-1),c=document.createElement("div");oe.sync({targetElement:c,domConfig:{onlyChildren:!0,children:d}}),l.columnLines=c.innerHTML}}renderRanges(t,r,n){const s=this,{client:a}=t,{exportMeta:l}=s,{timeRanges:o}=l;if(o){o.body=o.header="";for(const d of Object.values(a.features).filter(c=>c instanceof nn)){const c=d.getDOMConfig(r,n),u=document.createElement("div");c.forEach((h,g)=>{oe.sync({targetElement:u,domConfig:{children:h,onlyChildren:!0}}),g===0?o.body+=u.innerHTML:o.header+=u.innerHTML})}}}buildPageHtml(){const t=this,{subGrids:r,timeAxisHeaders:n,timeAxisPlaceholders:s,eventsMap:a,eventsPlaceholder:l,resourceTimeRangesMap:o,resourceHeaders:d,resourceHeaderPlaceholder:c,columnLines:u,columnLinesPlaceholder:h,timeRanges:g,timeRangesHeaderPlaceholder:f,timeRangesBodyPlaceholder:m,resourceTimeRangesPlaceholder:p,isHorizontal:v}=t.exportMeta;let b=t.prepareExportElement();return v&&Object.values(r).forEach(({placeHolder:w,rows:D,mergedCellsHtml:S})=>{const x=w.outerHTML;let R=D.join("");S!=null&&S.length&&(R+=`<div class="b-grid-merged-cells-container">${S.join("")}</div>`),b=b.replace(x,R)}),l&&(b=b.replace(l.outerHTML,Array.from(a.values()).join(""))),p&&(b=b.replace(p.outerHTML,Array.from(o.values()).join(""))),c&&(b=b.replace(c.outerHTML,d)),n.forEach((w,D)=>{b=b.replace(s[D].outerHTML,Array.from(w.values()).join(""))}),u&&(b=b.replace(h.outerHTML,u)),g&&m&&(b=b.replace(m.outerHTML,g.body),f&&(b=b.replace(f.outerHTML,g.header))),b=t.buildDependenciesHtml(b),b}getEventBox(t,r){const n=this,{client:s,eventsBoxes:a,currentPageFirstRowIndex:l,exactGridHeight:o,totalHeight:d}=n.exportMeta,{resourceColumnWidth:c,rowHeight:u,isHorizontal:h,resourceStore:g}=s;let f=t&&a.get(String(t.id));if(f&&t.isMilestone&&f.translate(-f.width/2,0),!f){const m=t.assignments.reduce((p,{resource:v})=>(p===null?p=g.indexOf(v):p=Math.max(p,g.indexOf(v)),p),null);h?m<l?f=new L(0,-u*2,10,u):f=new L(0,o+u,10,u):f=new L(m*c,d+u,c,u)}return f}renderDependencies(){const t=this,{client:r,eventsBoxes:n}=t.exportMeta,{dependencies:s}=r,a=r.features.dependencies,l=E.createElement();let o=!1;return s.forEach(d=>{var c,u;if(!n.has(String((c=d.fromEvent)==null?void 0:c.id))&&!n.has(String((u=d.toEvent)==null?void 0:u.id))||!a.isDependencyVisible(d))return;const h=t.getEventBox(d.fromEvent,d),g=t.getEventBox(d.toEvent,d);a.drawDependency(d,!0,{from:h==null?void 0:h.clone(),to:g==null?void 0:g.clone()}),o=!0}),o&&a.domSync(l,!0),l.innerHTML}buildDependenciesHtml(t){const{dependenciesPlaceholder:r,includeTimeline:n}=this.exportMeta;if(r&&n){const s=r.outerHTML;t=t.replace(s,this.renderDependencies())}return t}},Zl=class extends Ic(qr){async stateNextPage(i){await super.stateNextPage(i),this.exportMeta.eventsBoxes.clear()}};y(Zl,"isHorizontal",!0),y(Zl,"$name","MultiPageExporter"),y(Zl,"type","multipage"),Zl._$name="MultiPageExporter";var ln=class extends Ic(Kr){async prepareComponent(i){await super.prepareComponent(i),i.scheduleRange!==Hi.completeview&&this.estimateTotalPages(i)}};y(ln,"isHorizontal",!0),y(ln,"$name","MultiPageVerticalExporter"),y(ln,"type","multipagevertical"),ln._$name="MultiPageVerticalExporter";var Ac=class extends Ze{static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(Hi).map(([i,e])=>({value:i,text:"L{"+e+"}"}))}}}};y(Ac,"$name","ScheduleRangeCombo"),y(Ac,"type","schedulerangecombo"),Ac.initClass(),Ac._$name="ScheduleRangeCombo";var Lc=class extends es{static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",name:"scheduleRange",value:"completeview",weight:150,onChange({value:i}){this.parent.widgetMap.rangesContainer.hidden=i!==Hi.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",name:"rangeStart",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:i}){this.parent.widgetMap.rangeEndField.min=i?C.add(i,1,"d"):null}},rangeEndField:{type:"datefield",label:"L{Export to}",name:"rangeEnd",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:i}){this.parent.widgetMap.rangeStartField.max=i?C.add(i,-1,"d"):null}}}}}}}onLocaleChange(){const i=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.items.forEach(e=>{e instanceof rt?e.labelWidth=i:e.ref==="rangesContainer"&&(e.items[0].width=i)})}applyInitialValues(i){super.applyInitialValues(i);const e=this,{client:t,scheduleRange:r}=i,n=i.items=i.items||{},s=n.scheduleRangeField=n.scheduleRangeField||{},a=n.rangesContainer=n.rangesContainer||{},l=a.items=a.items||{},o=l.filler=l.filler||{},d=l.rangeStartField=l.rangeStartField||{},c=l.rangeEndField=l.rangeEndField||{};o.width=e.L("L{labelWidth}"),s.value=s.value||r,s.value===Hi.daterange&&(a.hidden=!1);const u=d.value=d.value||t.startDate;d.max=C.max(t.startDate,C.add(t.endDate,-1,"d"));let h=c.value||t.endDate;h<=u&&(h=C.add(u,1,"d")),c.value=h,c.min=C.min(t.endDate,C.add(t.startDate,1,"d"))}};y(Lc,"$name","SchedulerExportDialog"),y(Lc,"type","schedulerexportdialog"),Lc._$name="SchedulerExportDialog";var Jl=class extends Ic(ts){};y(Jl,"isHorizontal",!0),y(Jl,"$name","SinglePageExporter"),y(Jl,"type","singlepage"),Jl._$name="SinglePageExporter";var hg=class extends zd{cloneElement(i,e=this.element,t=!0){super.cloneElement(i,e,t)}async prepareComponent(i){await super.prepareComponent(i);const{exportMeta:e,element:t}=this,{resourceColumns:r}=i.client.timeAxisColumn;e.resourceHeaderPlaceholder=this.createPlaceholder(t.querySelector(`#${r.id}`)),e.resourceHeaders=""}async onRowsCollected(){}};y(hg,"isHorizontal",!1),hg._$name="VerticalExporter";var Ql=class extends Ic(hg){static get title(){return this.localize("L{SinglePageExporter.singlepage}")}async prepareComponent(i){await super.prepareComponent(i),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async renderPage(i){const{totalHeight:e}=this.exportMeta;return await this.onRowsCollected([],i),this.exportMeta.exactGridHeight=e,e}buildPageHtml(i){const{subGrids:e}=this.exportMeta;let t=super.buildPageHtml(i);return Object.values(e).forEach(({placeHolder:r})=>{const n=r.outerHTML,s="";t=t.replace(n,s)}),t}};y(Ql,"$name","SinglePageExporterVertical"),y(Ql,"type","verticalsinglepage"),y(Ql,"configurable",{centerContentHorizontally:!1}),Ql.prototype.pagesExtractor=async function*(e){const t=this,{client:r}=e,{totalWidth:n,verticalTimeAxisMargin:s}=t.exportMeta,a=t.stylesheets,l=e.orientation===Yr.portrait,o=Pi[e.paperFormat],d=t.getPaperWidth(o,l),c=t.getPaperHeight(o,l);let u,h,g;if(u=await t.renderPage(e),e.headerTpl){h=t.prepareHTML(e.headerTpl({totalWidth:n}));const w=t.measureElement(h,"b-export-header");u+=w}if(e.footerTpl){g=t.prepareHTML(e.footerTpl({totalWidth:n}));const w=t.measureElement(g,"b-export-footer");u+=w}const f=t.buildPageHtml(e),m=u,p=Math.min(1,t.getScaleValue(t.inchToPx(d),n)),v=Math.min(1,t.getScaleValue(t.inchToPx(c),u)),b=Math.min(p,v);a.push(`<style>
                #${r.id} {
                    height: ${m}px !important;
                    width: ${n}px !important;
                }
                .b-verticaltimeaxiscolumn {
                    margin-top: ${s}px;
                }
                .b-page-wrap {
                    width: ${d}in;
                    height: ${c}in;
                    ${t.centerContentHorizontally?"display: flex; justify-content: center":""}
                }
                .b-print .b-export-content {
                    scale: ${b};
                    transform-origin: top left;
                    height: calc(100% / ${b});
                    width: calc(100% / ${b});
                }
            </style>`),yield{html:t.pageTpl({html:f,header:h,footer:g,styles:a,paperWidth:d,paperHeight:c,currentPage:0})}},Ql._$name="SinglePageExporterVertical";var Pc=class extends Ic(hg){static get title(){return this.localize("L{MultiPageVerticalExporter.multipagevertical}")}calculateScale(){const{exportMeta:i}=this;return i.scale=this.getScaleValue(i.pageWidth,i.totalWidth)}estimateTotalPages(i){var e;const t=this,{exportMeta:r}=t,{client:n,headerTpl:s,footerTpl:a,repeatHeader:l,rangeStart:o,rangeEnd:d}=i,{pageHeight:c}=r,{timeAxisViewModel:u}=n,h=u.getDistanceBetweenDates(o,d),g=(d-o)/h,f=r.totalWidth=n.timeAxisColumn.resourceColumns.totalWidth+n.subGrids.locked.width+((e=n.subGrids.locked.splitterElement)==null?void 0:e.offsetWidth)||0,m=t.calculateScale();let p=r.totalHeight=h+n.headerHeight+n.footerHeight,v=c/m;s&&(v-=t.measureElement(s({totalWidth:f,totalPages:-1,currentPage:-1}),"b-export-header")),a&&(v-=t.measureElement(a({totalWidth:f,totalPages:-1,currentPage:-1}),"b-export-footer")),l&&(p-=n.headerHeight);let b=Math.ceil(p/v);l&&(p+=n.headerHeight*b,b=Math.ceil(p/v)),Object.assign(r,{scale:m,contentHeight:v,totalWidth:f,totalHeight:p,verticalPages:b,msPerPixel:g,initialScroll:0,horizontalPages:1,totalPages:b,currentPage:0,firstTickTop:0})}async stateNextPage(i){++this.exportMeta.currentPage,++this.exportMeta.verticalPosition,await super.stateNextPage(i)}async prepareComponent(i){await super.prepareComponent(i),this.estimateTotalPages(i),this.exportMeta.pageRangeStart=i.rangeStart,this.exportMeta.exactGridHeight=this.exportMeta.totalHeight}async renderRows(i){const e=this,{exportMeta:t}=e,{client:r}=i,{rangeEnd:n,repeatHeader:s}=i,{currentPage:a,contentHeight:l,msPerPixel:o,pageRangeStart:d}=t;let c=l;(a===0||s)&&(c-=r.headerHeight);const u=c*o;if(t.firstTickTop=r.timeAxisViewModel.getPositionFromDate(d),t.pageRangeEnd=C.min(new Date(d.getTime()+u),n),await e.onRowsCollected([],i),t.pageRangeEnd.getTime()<n.getTime()){const h=Math.floor(r.timeAxis.getTickFromDate(t.pageRangeEnd,!0));t.pageRangeStart=r.timeAxis.getAt(h).startDate}}getCurrentPageDateRange(){return{pageRangeStart:this.exportMeta.pageRangeStart,pageRangeEnd:this.exportMeta.pageRangeEnd}}async buildPage(i){const e=this,{exportMeta:t}=e,{headerTpl:r,footerTpl:n}=i,{totalWidth:s,totalPages:a,currentPage:l,subGrids:o}=t;Object.values(o).forEach(h=>h.rows=[]);let d,c;return r&&(d=e.prepareHTML(r({totalWidth:s,totalPages:a,currentPage:l}))),n&&(c=e.prepareHTML(n({totalWidth:s,totalPages:a,currentPage:l}))),await e.renderRows(i),{html:e.buildPageHtml(i),header:d,footer:c}}};y(Pc,"$name","MultiPageVerticalExporterVertical"),y(Pc,"type","verticalmultipagevertical"),Pc.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalPages:s,totalWidth:a,paperWidth:l,paperHeight:o,realPaperWidth:d,realPaperHeight:c,title:u}=r;let h,g;for(;(h=r.currentPage)<s;){t.trigger("exportStep",{text:ln.L(ln.exportingPageText,{currentPage:h,totalPages:s}),progress:Math.round((h+1)/s*90)});const{html:f,header:m,footer:p}=await t.buildPage(e),{scale:v,firstTickTop:b}=t.exportMeta;g=`
            .b-page-${h} .b-grid-vertical-scroller {
                margin-top: -${b}px
            }
            .b-page-${h} #${e.client.id} {
                height: ${r.exactGridHeight}px !important;
                width: ${a}px !important;
            }
            .b-page-wrap {
                width: ${d}in;
                height: ${c}in;
            }
            .b-print .b-export-viewport {
                scale: ${v};
                transform-origin: top left;
                height: calc(100% / ${v});
                width: calc(100% / ${v});
            }
        `,e.repeatHeader?g=`
                ${g}
                .b-export-body {
                    height: 100%;
                    display: flex;
                }
                .b-export-viewport {
                    height: 100%;
                }
            `:g=`
                ${g}
                ${h===0?"":`.b-page-${h} .b-grid-header-container {
                    display: none;
                }`}
                .b-export-body {
                    overflow: hidden;
                }
            `;const w=[...n,`<style>${g}</style>`];await t.stateNextPage(e),yield{html:t.pageTpl({html:f,title:u,header:m,footer:p,styles:w,paperWidth:l,paperHeight:o,realPaperWidth:d,realPaperHeight:c,currentPage:h})}}},Pc._$name="MultiPageVerticalExporterVertical";var Oc=class extends is{static get defaultConfig(){return{exporters:[Jl,Zl,ln,Ql,Pc],dialogClass:Lc,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){const i=T.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"]),{isHorizontal:e}=this.client;return e||(i.items.exporterTypeField.value="verticalsinglepage"),T.merge(i,{items:{columnsField:{hidden:!e},rowsRangeField:{hidden:!e},alignRowsField:{hidden:!e}}}),i.exporters=i.exporters.filter(t=>t.isHorizontal===e),i}buildExportConfig(i){i=super.buildExportConfig(i);const{scheduleRange:e,rangeStart:t,rangeEnd:r}=this;return i.columns&&!i.columns.find(n=>n.type==="timeAxis")&&i.columns.push(i.client.timeAxisColumn.id),T.assign({scheduleRange:e,rangeStart:t,rangeEnd:r},i)}};y(Oc,"$name","PdfExport"),Oc._$name="PdfExport",K.registerFeature(Oc,!1,"Scheduler");var gg=class extends Gm(Oc){};y(gg,"$name","Print"),gg._$name="Print",K.registerFeature(gg,!1,"Scheduler");var fg=class extends Nt(Mh){construct(i={},...e){super.construct(i,...e),this.eventSortFn||(this.eventSortFn=(t,r)=>t.internalId-r.internalId)}normalizeColumns(i){i.columns=i.resourceColumns||i.columns,super.normalizeColumns(i),i.columns=i.columns.filter(e=>!e.isVerticalTimeAxisColumn),i.eventColumns=i.eventColumns.map(e=>typeof e=="string"?{field:e}:e)}generateExportData(i){const e=this,t=e.generateResourceColumns(i),r=e.target.eventStore?e.generateEventColumns(i):[],n=t.concat(r),s=e.generateRows(i);return{columns:n,rows:s}}generateEventColumns(i){return i.eventColumns.map(e=>this.processEventColumn(e,i))}generateResourceColumns(i){const e=this.target;return e instanceof wl&&e.isHorizontal?super.generateColumns(i):i.columns.map(t=>this.processResourceColumn(t,i))}processEventColumn(i,e){const{width:t,minWidth:r}=i,{defaultColumnWidth:n}=e;return{field:i.field,value:i.text,width:Math.max(t||n,r||n),eventColumn:!0,type:this.getColumnType(i,this.target.eventStore)}}processResourceColumn(i,e){const{width:t,minWidth:r}=i,{defaultColumnWidth:n}=e;return{field:i.field,value:i.text,width:Math.max(t||n,r||n),type:this.getColumnType(i,this.target.resourceStore)}}generateRows(i){const e=this,{target:t}=e;let r;if(!t.resourceStore||t.isGanttBase)r=super.generateRows(i);else{if(r=[],t.resourceStore.map(n=>{const s=n.events||[];s.sort(e.eventSortFn),t.isSchedulerBase&&!s.length&&s.push(""),s.forEach(a=>{(a===""||t.eventStore.isAvailable(a)&&(i.includeEventsOutsideTimeAxis||a.isScheduled&&t.intersectsVisibleTimeSpan(a)))&&r.push(e.getRowData(i,n,a))})}),i.includeUnassigned&&i.eventColumns.length){const n=t.eventStore.query(s=>!s.resources.length);if(n.length){const s=new Array(i.columns.length).fill("");s.push(e.L("L{ExcelExporter.No resource assigned}")),r.push(s),n.forEach(a=>r.push(e.getRowData(i,null,a)))}}r=r.filter(n=>n.length)}return r}getRowData(i,e,t){const{columns:r,eventColumns:n}=i,s=[],a=this.processRecord(e,r,i);if(a&&s.push(...a),!e||!e.isSpecialRow){const l=this.processRecord(t,n,i);l&&s.push(...l)}return s}};y(fg,"configurable",{includeUnassigned:!0,includeEventsOutsideTimeAxis:null,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140,type:"date"},{text:"Ends",field:"endDate",width:140,type:"date"}],resourceColumns:null,eventSortFn:null}),fg._$name="ScheduleTableExporter";var eo=class extends il{};y(eo,"$name","ExcelExporter"),y(eo,"configurable",{exporterClass:fg,exporterConfig:null}),eo._$name="ExcelExporter",K.registerFeature(eo,!1,["Scheduler"]);var $c=class extends wl{};y($c,"$name","Scheduler"),y($c,"type","scheduler"),$c.initClass(),$c._$name="Scheduler";var W0=i=>{var e;return e=class extends(i||$){static get properties(){return{recordsToRefresh:new Set}}beforeRenderRow({record:t}){var r;return(r=this.recordIsReadyForRendering)!=null&&r.call(this,t)&&this.unscheduleRecordRefresh(t),super.beforeRenderRow(...arguments)}cleanupScheduledRecord(){const{rowManager:t,store:r}=this;for(const n of[...this.recordsToRefresh])(!n.stores.includes(r)||!t.getRowById(n))&&this.recordsToRefresh.delete(n)}renderScheduledRecords(){const t=this;if(t.refreshSuspended)t.scheduleRecordRefresh();else{t.cleanupScheduledRecord();const{rowManager:r}=t,n=[...t.recordsToRefresh],s=n.map(a=>r.getRowById(a));s.length&&(r.renderRows(s),t.trigger("scheduledRecordsRender",{records:n,rows:s})),t.recordsToRefresh.size&&t.scheduleRecordRefresh()}}unscheduleRecordRefresh(t=!0){const r=this;t===!0?r.recordsToRefresh.clear():t&&B.asArray(t).forEach(n=>r.recordsToRefresh.delete(n)),r.scheduledRecordsRefreshTimer&&!r.recordsToRefresh.size&&r.clearTimeout(r.scheduledRecordsRefreshTimer)}scheduleRecordRefresh(t){const r=this;t&&B.asArray(t).forEach(n=>r.recordsToRefresh.add(n)),r.scheduledRecordsRefreshTimer=r.setTimeout({fn:"renderScheduledRecords",delay:r.scheduledRecordsRefreshTimeout,cancelOutstanding:!0})}get widgetClass(){}},y(e,"$name","DelayedRecordsRendering"),y(e,"configurable",{scheduledRecordsRefreshTimeout:15}),e},rv=class extends ${construct(i){super.construct(),this.client=i}init(){}onTimeAxisViewModelUpdate(){const{scrollable:i}=this.client.timeAxisSubGrid;this.updateFromHorizontalScroll(i.x)}updateFromHorizontalScroll(i){const e=this,{client:t,scrollBuffer:r}=e,{timeAxisSubGrid:n,timeAxis:s,rtl:a}=t,{width:l}=n,{totalSize:o}=t.timeAxisViewModel,d=i,c=n.scrollable.maxX!==0&&Math.abs(n.scrollable.maxX)<=Math.round(d)+5,u=t.getDateFromVirtualCoord({coord:Math.max(0,d-r)}),h=c?s.endDate:t.getDateFromVirtualCoord({coord:d+l+r})||s.endDate;if(u&&!t._viewPresetChanging){e._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},e.viewportCoords=a?{left:o-i-l+r,right:o-i-r}:{left:i-r,right:i+l+r};const g=t.timeView.range={startDate:u,endDate:h};if(t.internalOnVisibleDateRangeChange(g),!t.refreshSuspended&&t.rowManager.rows.length){if(t.rowManager.rows[0].id===null)return;(e._timeAxisStartDate-s.startDate||e._timeAxisEndDate-s.endDate)&&(e._timeAxisStartDate=s.startDate,e._timeAxisEndDate=s.endDate,t.rowManager.renderRows(t.rowManager.rows))}}}onViewportResize(){}refreshRows(){}get visibleDateRange(){return this._visibleDateRange}translateToPageCoordinate(i){const{client:e}=this,{scrollable:t}=e.timeAxisSubGrid;let r=i+e.timeAxisSubGridElement.getBoundingClientRect().left;return e.rtl?r-=t.maxX-Math.abs(e.scrollLeft):r-=e.scrollLeft,r}translateToScheduleCoordinate(i){const{client:e}=this,{scrollable:t}=e.timeAxisSubGrid;let r=i-e.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return e.rtl?r+=t.maxX-Math.abs(e.scrollLeft):r+=e.scrollLeft,r}getDateFromXY(i,e,t,r=!1){const{client:n}=this;let s=i[0];return t||(s=this.translateToScheduleCoordinate(s)),s=n.getRtlX(s),n.timeAxisViewModel.getDateFromPosition(s,e,r)}};y(rv,"configurable",{scrollBuffer:0}),rv._$name="TimelineHistogramRendering";var rL={series:null,topValue:null},nL=()=>{},on=class extends sr.mixin(W0){static get properties(){return{histogramDataByRecord:new Map,collectingDataFor:new Map,_refreshRequested:0}}updateGetRecordData(i){this._getRecordData=i?this.resolveCallback(i):null}updateHardRefreshOnTimeAxisReconfigure(i){const e="hardRefreshOnTimeAxisReconfigure";i?this.timeAxis.ion({name:e,endReconfigure:"onTimeAxisEndReconfigure",thisObj:this}):this.detachListeners(e)}construct(i){super.construct(i);const e=this;e.scheduleRefreshRows=e.createOnFrame(e.refreshRows,[],e,!0),e.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",thisObj:e})}onDestroy(){var i;this.clearHistogramDataCache(),(i=this._histogramWidget)==null||i.destroy(),this.barTooltip=null}resolveTimeSpanRecord(i){}getScheduleMouseEventParams(i,e){return{record:this.store.getById(i.id)}}get currentOrientation(){return this._currentOrientation||(this._currentOrientation=new rv(this)),this._currentOrientation}updateSeries(i){const e=this;e.histogramWidget.series=i,e._series=e.histogramWidget.series,e.isPainted&&!e.isConfiguring&&e.scheduleRefreshRows()}getAsyncEventSuffixForStore(i){return i.isAbstractPartOfProjectStoreMixin?"PreCommit":""}scheduleRefreshRows(){}refreshRows(...i){return this.refreshSuspended?this._refreshRequested++:this._refreshRequested=0,super.refreshRows(...i)}getRowHeight(){return this.rowHeight}onInternalPaint({firstPaint:i}){super.onInternalPaint({firstPaint:i}),i&&this.showBarTip&&(this.barTooltip={})}changeBarTooltip(i,e){return e==null||e.destroy(),i?i.isTooltip?i:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,i):null}async getTipHtml(i){if(this.showBarTip&&this.barTooltipTemplate){const{activeTarget:e}=i,t=parseInt(e.dataset.index,10),r=this.getRecordFromElement(e),n=await this.getRecordHistogramData(r);return this.barTooltipTemplate({...i,datum:this.extractHistogramDataArray(n,r)[t],record:r,index:t})}}collectTicksWidth(){const{ticks:i}=this.timeAxis,e=i[0].endDate-i[0].startDate,t={0:e};let r=e,n=!0;for(let s=1,{length:a}=i;s<a;s++){const l=i[s],o=l.endDate-l.startDate;e!==o&&(n=!1),r+=o,t[s]=o}if(n)this.ticksWidth=null;else{const s={};for(let a=0,{length:l}=i;a<l;a++)s[a]=t[a]/r;this.ticksWidth=s}}changeHistogramWidget(i){var e;const t=this;return i&&!i.isHistogram&&(t.getBarTextDOMConfig&&!i.getBarTextDOMConfig&&(i.getBarTextDOMConfig=t.getBarTextDOMConfig),i=t.histogramWidgetClass.new({owner:t,appendTo:t.element,height:t.rowHeight,width:((e=t.timeAxisColumn)==null?void 0:e.width)||0,getBarTip:nL,getBarClass:t.getBarClass||t.getBarClassDefault,getBarText:t.getBarText||t.getBarTextDefault,getBarDOMConfig:t.getBarDOMConfig,getOutlineClass:t.getOutlineClass,getOutlineDOMConfig:t.getOutlineDOMConfig},i),i.suspendRefresh(),t.getBarTextDefault=t.getBarTextDefault.bind(i)),i}getBarClassDefault(i,e,t){}getBarTextDefault(i,e){}updateShowBarTip(i){this.barTooltip=i}onHistogramDataCacheSet({record:i,data:e}){this.scheduleRecordRefresh(i)}onTimeAxisEndReconfigure(){this.hardRefreshOnTimeAxisReconfigure&&(this.clearHistogramDataCache(),this.scheduleRefreshRows())}onStoreUpdateRecord({record:i,changes:e}){const t=this;return!t.getRecordData&&t.dataModelField&&e[t.dataModelField]&&t.clearHistogramDataCache(i),super.onStoreUpdateRecord(...arguments)}onStoreRemove({records:i}){super.onStoreRemove(...arguments);for(const e of i)this.clearHistogramDataCache(e)}onBeforeRowHeight({height:i}){if(this._timeAxisColumn){const e=this._histogramWidget;e&&(e.height=i,e.onElementResize(e.element))}}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);const i=this._histogramWidget;i&&(i.width=this.timeAxisViewModel.totalSize,i.onElementResize(i.element)),this.collectTicksWidth()}extractHistogramDataArray(i,e){return i}processRecordRenderData(i){return i}clearHistogramDataCache(i){const e=B.asArray(i);if(e)for(const t of e)this.histogramDataByRecord.delete(t);else this.histogramDataByRecord.clear()}setHistogramDataCache(i,e){const t={record:i,data:e};this.trigger("beforeHistogramDataCacheSet",t),this.histogramDataByRecord.set(t.record,t.data),this.trigger("histogramDataCacheSet",t)}getHistogramDataCache(i){return i?this.histogramDataByRecord.get(i):this.histogramDataByRecord}hasHistogramDataCache(i){return this.histogramDataByRecord.has(i)}finalizeDataRetrievingInternal(i,e){return this.collectingDataFor.delete(i),this.setHistogramDataCache(i,e),e}finalizeDataRetrieving(i,e){return Z.isPromise(e)?(this.collectingDataFor.set(i,e),e.then(t=>{var r;return(r=this.finalizeDataRetrievingInternal)==null?void 0:r.call(this,i,t)})):this.finalizeDataRetrievingInternal(i,e)}getRecordHistogramData(i){const e=this,{getRecordData:t}=e;let r=e.collectingDataFor.get(i)||e.getHistogramDataCache(i);return!r&&!e.hasHistogramDataCache(i)&&(t?r=t.handler.call(t.thisObj,...arguments):r=i.get(e.dataModelField),r=e.finalizeDataRetrieving(i,r)),r}recordIsReadyForRendering(i){return!this.collectingDataFor.has(i)}beforeRenderRow(i){const e=this,t=e.getRecordHistogramData(i.record);if(!Z.isPromise(t)){const r=t?e.extractHistogramDataArray(t,i.record):[];if(!r)return;if(e.ticksWidth)for(let s=0,{length:a}=r;s<a;s++)r[s].width=e.ticksWidth[s];const n=Z.merge({topValue:null},e.initialConfig.histogramWidget,{data:r,series:{...e.series}});i={...i,histogramConfig:n,histogramData:t,histogramWidget:e.histogramWidget},e.trigger("beforeRenderHistogramRow",i),delete i.eventName,delete i.source,delete i.type,delete i.oldId,delete i.row,delete i.recordIndex,e._recordRenderData=e.processRecordRenderData(i)}super.beforeRenderRow(...arguments)}applyHistogramWidgetConfig(i=this.histogramWidget,e){Object.assign(i,rL,e)}renderRecordHistogram(i){const e=this,{histogramData:t,cellElement:r}=i;if(!t){r.innerHTML="";return}e.trigger("beforeRenderRecordHistogram",i),delete i.eventName,delete i.type,delete i.source;const n=i.histogramWidget||e.histogramWidget;e.applyHistogramWidgetConfig(n,i.histogramConfig),n.refresh({args:[i]});const s=n.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),r.innerHTML="",r.appendChild(s)}histogramRenderer(i){const e=this,t=i.histogramData||e.getRecordHistogramData(i.record);return Z.isPromise(t)?"":(Object.assign(i,e._recordRenderData),e.renderRecordHistogram(...arguments))}buildGroupHeader(i){return i.column===this.timeAxisColumn?this.histogramRenderer(i):this.features.group.buildGroupHeader(i)}get widgetClass(){}};y(on,"$name","TimelineHistogramBase"),y(on,"type","timelinehistogrambase"),y(on,"configurable",{timeCellCls:"b-sch-timeaxis-cell b-timelinehistogram-cell",mode:"horizontal",rowHeight:50,showBarTip:!1,barTooltip:null,barTooltipClass:ve,series:null,dataModelField:"histogramData",getRecordData:null,hardRefreshOnTimeAxisReconfigure:!0,getBarClass:null,getOutlineClass(i){return""},getOutlineDOMConfig(i,e,t){return e},readOnly:!0,barTooltipTemplate:null,getBarText:null,getBarDOMConfig:null,getBarTextDOMConfig:void 0,histogramWidgetClass:Gn,histogramWidget:{cls:"b-hide-offscreen b-timelinehistogram-histogram",omitZeroHeightBars:!0,data:[]},fixedRowHeight:!0,timeAxisColumnConfig:{type:"timeAxis",renderer:"up.histogramRenderer"}}),on.initClass(),on._$name="TimelineHistogramBase";var j0=i=>{var e;return e=class extends(i||on){afterConfigure(){const t=this;t.internalAggregateDataEntry=t.internalAggregateDataEntry.bind(this),t.internalInitAggregatedDataEntry=t.internalInitAggregatedDataEntry.bind(this),super.afterConfigure(),t.features.treeGroup&&t.features.treeGroup.ion({beforeDataLoad:t.onTreeGroupBeforeDataLoad,thisObj:t})}updateAggregateFunctions(t){for(const[r,n]of Object.entries(t))if(n.id=r,n.aliases)for(const s of n.aliases)t[s]=n}updateStore(t){super.updateStore(...arguments),this.detachListeners("store"),t&&t.ion({name:"store",group:this.onStoreGroup,sort:this.onStoreSort,thisObj:this})}changeAggregateDataEntry(t){return this.bindCallback(t)}changeGetDataEntryForAggregating(t){return this.bindCallback(t)}changeInitAggregatedDataEntry(t){return this.bindCallback(t)}onHistogramDataCacheSet({record:t,data:r}){super.onHistogramDataCacheSet(...arguments),this.aggregateHistogramDataForGroups&&this.scheduleRecordParentsRefresh(t)}onTreeGroupBeforeDataLoad(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreGroup(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreSort({source:t}){this.aggregateHistogramDataForGroups&&t.isGrouped&&this.resetGeneratedRecordsHistogramDataCache()}getRecordHistogramData(t,r){const n=this;let s;return n.aggregateHistogramDataForGroups&&n.isGroupRecord(t)?(s=n.collectingDataFor.get(t)||n.getHistogramDataCache(t),!s&&!n.hasHistogramDataCache(t)&&(s=n.getGroupRecordHistogramData(t,r),s=n.finalizeDataRetrieving(t,s))):s=super.getRecordHistogramData(...arguments),s}internalAggregateDataEntry(t,...r){const{aggregateFunctions:n}=this;for(const{id:s,aggregate:a="sum"}of Object.values(this.series)){let l;a!==!1&&(l=n[a].entry)&&(t=l(s,t,...r))}return this.aggregateDataEntry?this.aggregateDataEntry(t,...r):t}internalInitAggregatedDataEntry(){const t=this.initAggregatedDataEntry?this.initAggregatedDataEntry(...arguments):{},{aggregateFunctions:r}=this;for(const{id:n,aggregate:s="sum"}of Object.values(this.series)){const a=r[s].init;a&&s!==!1&&a(n,t,...arguments)}return t}resetGeneratedRecordsHistogramDataCache(){const{store:t}=this;for(const r of this.getHistogramDataCache().keys())(r.isGroupHeader||r.generatedParent||r.isLinked&&!t.includes(r))&&this.clearHistogramDataCache(r)}setHistogramDataCache(t,r){if(super.setHistogramDataCache(t,r),t.isLinked)super.setHistogramDataCache(t.$original,r);else if(t.$links){const{store:n}=this;for(const s of t.$links)n.includes(s)&&super.setHistogramDataCache(s,r)}}getHistogramDataCache(t){let r=super.getHistogramDataCache(t);return!r&&t.isLinked&&(r=super.getHistogramDataCache(t.$original)),r}getGroupRecordHistogramData(t,r={}){r.parentRecord=t;const n=this.aggregateRecordsHistogramData(this.getGroupChildren(t),r);return Z.isPromise(n)?n.then(s=>s):n}aggregateRecordsHistogramData(t,r={}){const n=this,s=[],{parentRecord:a}=r;let l=!1;for(const o of t){const d=n.getRecordHistogramData(o,r);l=l||Z.isPromise(d),d&&s.push(d)}return l?Promise.all(s).then(o=>(r.parentRecord=a,o=o.filter(d=>d),t.length>0&&!n.isDestroyed?n.aggregateHistogramData(o,t,r):[])):n.aggregateHistogramData(s,t,r)}isGroupRecord(t){return t.isGroupHeader||this.isTreeGrouped&&t.generatedParent}getGroupChildren(t){return t.groupChildren||t.children}getRecordParent(t){const{groupParent:r}=t.instanceMeta(this.store);return r||this.isTreeGrouped&&t.parent}scheduleRecordParentsRefresh(t,r=!0){const n=this;let s;for(;s=n.getRecordParent(t);)r&&n.clearHistogramDataCache(s),n.scheduleRecordRefresh(s),t=s}aggregateHistogramData(t,r,n={}){const s=this,{aggregateFunctions:a}=s;n.recordsData=t,n.records=r;const l=t.map((d,c)=>s.extractHistogramDataArray(d,r[c])),o=B.aggregate(l,s.getDataEntryForAggregating||(d=>d),s.internalAggregateDataEntry,s.internalInitAggregatedDataEntry,n);for(const{id:d,aggregate:c="sum"}of Object.values(s.series)){const u=a[c].finalize;u&&c!==!1&&u(d,o,...arguments)}return o}get widgetClass(){}},y(e,"$name","TimelineHistogramGrouping"),y(e,"configurable",{aggregateHistogramDataForGroups:!0,aggregateDataEntry:null,getDataEntryForAggregating:null,initAggregatedDataEntry:null,aggregateFunctions:{sum:{aliases:["add"],entry(t,r,n){return r[t]=(r[t]||0)+n[t],r}},min:{entry(t,r,n){const s=n[t];return s<(r[t]||Number.MAX_VALUE)&&(r[t]=s),r}},max:{entry(t,r,n){const s=n[t];return s>(r[t]||Number.MIN_VALUE)&&(r[t]=s),r}},count:{init(t,r,n,s){r[t]=s.arrays.length}},avg:{entry(t,r,n){return r[t]=(r[t]||0)+n[t],r},finalize(t,r,n,s,a){const l=a.arrays.length;r.forEach(o=>o[t]/=l)}}}}),e},U0=i=>{var e;return e=class extends i{changeScalePoints(t){return t==null||t.sort((r,n)=>r.value-n.value),t}updateScalePoints(t){const r=this,n=t[t.length-1];n&&(r.scaleUnit=n.unit,r.calculateTopValueByScalePoints&&(r.histogramWidget.topValue=r.getTopValueByScalePoints(t))),r.scaleColumn&&(r.scaleColumn.scalePoints=t)}changeColumns(t,r){const n=this,s=n.getConfig("scaleColumn");if(t&&s){const a=Array.isArray(t);let l=t;a||(l=t.data);let o=l==null?void 0:l.length,d=s;l.some((c,u)=>{if(c.type==="scale")return o=u,d=T.assign(c,d),!0}),l=l.slice(),l[o]={type:"scale",...d},a?t=l:t.data=l}return super.changeColumns(t,r)}updateColumns(t,r){super.updateColumns(t,r),t&&(this._scaleColumn=this.columns.find(n=>n.isScaleColumn))}onColumnsChanged({action:t,changes:r,record:n,records:s}){const{scaleColumn:a,columns:l}=this;a&&(t==="dataset"||t==="batch")&&!l.includes(a)&&l.add(a,!0),super.onColumnsChanged(...arguments)}convertUnitsToHistogramValue(t,r){return t}convertHistogramValueToUnits(t,r){return t}extractHistogramDataArray(t,r){return t}getTopValueByScalePoints(t){const r=this,{scaleColumn:n}=r,s=t[t.length-1],{value:a,unit:l}=s;let o=a;return n&&(o*=1+(n.scaleWidget.scaleMaxPadding||0)),r.convertUnitsToHistogramValue(o,l||r.scaleUnit)}processRecordRenderData(t){var r;t=super.processRecordRenderData(...arguments);const{scaleColumn:n}=this;if(n){const s=this,{record:a,histogramData:l,histogramConfig:o={}}=t;let d=(r=s.initialConfig.histogramWidget)==null?void 0:r.topValue,c=s.scalePoints||a.get(n.field);if(!d){if(c&&s.calculateTopValueByScalePoints&&(d=s.getTopValueByScalePoints(c)),!d&&l){const u=t.histogramWidget||s.histogramWidget;T.assign(u,o),d=u.getDataTopValue(l),c=[{value:s.convertHistogramValueToUnits(d,s.scaleUnit),text:s.convertHistogramValueToUnits(d,s.scaleUnit)}],d+=s.scaleColumn.scaleWidget.scaleMaxPadding*d}t.scaleWidgetConfig={scalePoints:c},t.histogramConfig={...o,topValue:d}}}return t}buildGroupHeader(t){return t.column===this.scaleColumn?this.scaleColumn.renderer(t):super.buildGroupHeader(...arguments)}beforeRenderCell(t){return this.scaleColumn&&t.column===this.scaleColumn&&(t.histogramData=this.getRecordHistogramData(t.record),T.isPromise(t.histogramData)||Object.assign(t,this._recordRenderData)),super.beforeRenderCell(...arguments)}renderRecordScale(t,r){if(this.scaleColumn){const n=this.getRowFor(t),s=n==null?void 0:n.getCell(this.scaleColumn.id);s&&n.renderCell(s)}}get widgetClass(){}},y(e,"$name","TimelineHistogramScaleColumn"),y(e,"configurable",{scaleColumn:{},scalePoints:null,calculateTopValueByScalePoints:!0}),e},Hc=class extends on.mixin(j0,U0){};y(Hc,"$name","TimelineHistogram"),y(Hc,"type","timelinehistogram"),Hc.initClass(),Hc._$name="TimelineHistogram";var Vc=class extends Ze{static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1,internalListeners:{change:"onInternalChange"}}}updateProject(i){var e;(e=i.transport.load)!=null&&e.url&&(this.value=i.transport.load.url)}onInternalChange({value:i,userAction:e}){e&&this.project&&(this.project.transport.load.url=i,this.project.load())}};y(Vc,"$name","ProjectCombo"),y(Vc,"type","projectcombo"),Vc.initClass(),Vc._$name="ProjectCombo";var Nc=class extends jt{static get delayable(){return{applyFilters:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,useResourceColor:!0,toggleAllIfCtrlPressed:!0,collapsibleGroups:!0,itemTpl:i=>O.encodeHtml(i.name||""),masterFilter:i=>!0,filterResources:null,allowGroupSelect:!1}}itemIconTpl(i,e){const{eventColor:t}=i,{useResourceColor:r}=this,n=E.isNamedColor(t)&&r?` b-sch-color-${t}`:"",s=!n&&t&&r?` style="--checkbox-background-color:${t}"`:"";return this.multiSelect&&this.callback(this.isSelectable,this,[i])?`<div aria-hidden="true" class="b-selected-icon b-icon${n}"${s}></div>`:""}changeStore(i){if(this.eventStore)return super.changeStore(...arguments);this._storeConfig=i}changeEventStore(i){return this.getConfig("store"),i}updateEventStore(i){var e;const t=this,r=t._storeConfig||{},{resourceStore:n}=i,s={...r,syncSort:!0,excludeCollapsedRecords:!1},a={name:"resourceStore",change:"onStoreChange",thisObj:t};n.tree&&(s.sorters=[]),(e=t.store)==null||e.destroy(),t.detachListeners("project","resourceStore"),(t.store=n.chain(t.masterFilter,null,s)).un(a),n.ion(a),n.count?t.initFilter():n.project.ion({name:"project",refresh:"initFilter",thisObj:t})}changeMasterFilter(i){const e=this;if(!e.filterResources)return function(t){return e.callback(i,e,[t])}}initFilter(){var i;const e=this;if(e.eventStore.resourceStore.count){const{selected:t}=e;t.count||(((i=e.initialConfig.selected)==null?void 0:i.length)===0?e.onInternalSelectionChange({source:t,added:[],removed:[]}):t.add(e.store.allRecords.filter(r=>!r.isGroupHeader))),e.detachListeners("project")}}onStoreRefresh({source:i,action:e}){if(e==="filter"&&this.eventStoreFilter){const{eventStoreFilter:t}=this,{disabled:r}=t,n=!i.isFiltered&&this.allSelected;n!==r&&(t.disabled=n,this.applyFilters())}super.onStoreRefresh(...arguments)}onInternalSelectionChange({source:i,added:e=[],removed:t}){const r=this,n=!r.store.isFiltered&&r.allSelected;super.onInternalSelectionChange(...arguments);let s=!1;if(r.eventStoreFilter||(r.eventStoreFilter=r.eventStore.addFilter({id:`${r.id}-filter-instance`,filterBy:o=>!o.resource||r.selected.includes(o.resources),disabled:n},(e==null?void 0:e.length)===r.store.count),s=!0),r.filterResources&&!r.resourceStoreFilter&&(r.resourceStoreFilter=r.eventStore.resourceStore.addFilter({id:`${r.id}-filter-instance`,filterBy:o=>r.selected.includes(o),disabled:n},(e==null?void 0:e.length)===r.store.count),s=!0),s)return;r.eventStoreFilter.disabled=n,r.resourceStoreFilter&&(r.resourceStoreFilter.disabled=n),r.applyFilters();const a=i.values,l=a.concat(t);B.remove(l,...e),r.triggerFieldChange({value:a,oldValue:l})}get value(){return this.selected.values}applyFilters(){this.eventStore.filter(),this.filterResources&&this.eventStore.resourceStore.filter()}updateUseResourceColor(i){this.element.classList.toggle("b-plain-color",!i)}doDestroy(){var i;(i=this.store)==null||i.destroy(),super.doDestroy()}};y(Nc,"$name","ResourceFilter"),y(Nc,"type","resourcefilter"),Nc.initClass(),Nc._$name="ResourceFilter";var mg=class Tv extends Fi{changeEventFilter(e){if(typeof e=="string"){const{handler:t,thisObj:r}=this.resolveCallback(e);e=t.bind(r)}return e}doRefresh(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),super.doRefresh(...arguments);this.whenVisible("doRefresh")}updateShowEvents(e,t){const r=this,{classList:n}=r.contentElement;let{eventStore:s}=r;if(r.requestAnimationFrame(()=>{var a;r.element.classList.toggle("b-datepicker-with-events",!!e),(a=r.owner)==null||a.element.classList.toggle("b-datepicker-with-events",!!e),e&&n.add(`b-show-events-${e}`),n.remove(`b-show-events-${t}`)}),e){if(!s){const a=r.up(l=>l.eventStore);if(a)r._eventStore=s=a.eventStore;else throw new Error("DatePicker configured with events but no eventStore")}}else r.cellMap=null;r.isConfiguring||(r.updateEventStore(s),r.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.cellMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.cellMap,filter:e.eventFilter}))}updateEventStore(e){var t;e.findListener("change","refresh",this)===-1&&((t=e==null?void 0:e[this.showEvents?"on":"un"])==null||t.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:t}){var r,n;const{showEvents:s}=this,a=(n=(r=this.cellMap)==null?void 0:r.get)==null?void 0:n.call(r,C.makeKey(t)),l=Array.isArray(a)?a.length:a,o=s==="count";delete e.dataset.btip,l&&(!o&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",l)),E.createElement({dataset:{count:l},class:{[o?"b-cell-events-badge":"b-icon b-icon-circle"]:s!=="heatmap",[Tv.getEventCountClass(l)]:1},parent:e,[o?"text":""]:l}))}getCellClassList({date:e}){var t,r;const n=(r=(t=this.cellMap)==null?void 0:t.get)==null?void 0:r.call(t,C.makeKey(e)),s=Array.isArray(n)?n.length:n,a=super.getCellClassList(...arguments);return a[Tv.getEventCountClass(s)]=s>0,a}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-datepicker-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}};y(mg,"$name","SchedulerDatePicker"),y(mg,"type","datepicker"),y(mg,"configurable",{showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}});var to=mg;to.initClass(),to._$name="SchedulerDatePicker";var sL=i=>i.isProjectConsumer,pg=class OE extends Fa{construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(sL))}changeScheduler(e){return e.isProjectConsumer?e:OE.getById(e)}updateScheduler(e){const t=this,{crudManager:r}=e;e.ion({projectChange:"onProjectChanged",thisObj:t}),r?t.setupLoadListener(r):t.onLoad(),!t.project&&(e!=null&&e.project)&&(t.project=e.project),t.stm=e.project.stm}setupLoadListener(e){this.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){super.updateProject(...arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}};y(pg,"$name","UndoRedo"),y(pg,"type","undoredo"),y(pg,"configurable",{scheduler:null,project:null});var nv=pg;nv.initClass(),nv._$name="UndoRedo";var io=class extends Ze{construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up(i=>i.isTimelineBase)||z.query(i=>i.isTimelineBase)}changeValue(i,e){return this.getConfig("presets"),super.changeValue(i,e)}updatePresets(i){this.store=this.scheduler.presets.chain(e=>i.includes(e.id)),this.store.sort((e,t)=>i.indexOf(e.id)-i.indexOf(t.id))}onClientPresetChange({preset:i}){const e=this;e._isSelecting||(e.isSettingValue=!0,e.store.includes(i.id)?e.value=i:e.clear(),e.isSettingValue=!1)}onSelect({record:i}){var e;if(!this.isSettingValue){const{scheduler:t}=this,{mainUnit:r,start:n,defaultSpan:s}=i,a={};if(r&&s&&this.useFixedDuration){let l=r;n&&typeof n=="string"&&(l=(e=C.parseTimeUnit(n))!=null?e:n),a.startDate=C.startOf(t.viewportCenterDate,l),typeof n=="number"&&(a.startDate=C.add(a.startDate,n,r)),a.endDate=C.add(a.startDate,s,r)}t.zoomToLevel(i,a)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}};y(io,"$name","ViewPresetCombo"),y(io,"type","viewpresetcombo"),y(io,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,useFixedDuration:!0,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"}),io.initClass(),io._$name="ViewPresetCombo";var G0=class $E{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new $E({intervalGroups:t})}getIsWorkingForEvery(){if(this.isWorkingForEvery!=null)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(this.isWorkingForSome!=null)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,r]of this.getGroups())e.set(t,r[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach(([r,n])=>{let s=t.get(r);s||(e.push(r),s=[],t.set(r,s)),s.push.apply(s,n.intervals)}),t.forEach((r,n)=>{const s=sc(r);s.sort(Pp),t.set(n,s)}),this.intervalsByCalendar=t}},Y0=class extends Lp{constructor(i){super(i),this.calendarCaches=sc(this.calendarCaches),this.intervalCache=new Op({emptyInterval:new G0,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(i,e){this.calendarCaches.forEach(t=>{t.fillCache(i,e),this.includeWrappingRangeFrom(t,i,e)})}},aL=new Map,lL=i=>{const e=sc(i);if(e.length===0)throw new Error("No calendars to combine");e.sort((a,l)=>a.internalId<l.internalId?-1:1);const t=e.map(a=>a.internalId+"/").join(""),r=e.map(a=>a.version+"/").join("");let n=aL.get(t),s;return n&&n.versionsHash===r?s=n.cache:s=new Y0({calendarCaches:e.map(a=>a.calendarCache)}),s},Bc=class extends He{static get defaults(){return{id:"agenda",text:"Agenda",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!1,alwaysClearCell:!1}}construct(){super.construct(...arguments),this.grid.ion({beforeResponsiveStateChange:"onBeforeGridResponsiveStateChange",thisObj:this})}defaultRenderer({cellElement:i,row:e,record:t,grid:r,size:n}){var s;const a=this,{events:l,date:o}=t,{previousEvents:d}=t.data,c=[];for(let u=0;u<l.length;u++){const h=l[u],g=h.endDate||C.add(h.startDate,h.duration,h.durationUnit),f=h.startDate<o,m=g>t.tomorrow,p=r.createEventDomConfig({date:t.date,isAllDay:h.allDay||m||f,eventRecord:h});p.className["b-continues-future"]=m,p.className["b-continues-past"]=f,c.push({className:{"b-cal-agenda-event-row":1},dataset:{rowId:h.id},children:[r.callback("eventListEventTimeRenderer",r,[h,o]),p],syncOptions:{syncIdField:"rowId",releaseThreshold:0,strict:!0}})}if(e[d&&d.date.getMonth()!==o.getMonth()?"addCls":"removeCls"]("b-new-month"),(s=r._cellRenderer)==null||s.call(r,...arguments),i.classList[t.isNonWorking?"add":"remove"](r.nonWorkingDayCls),oe.sync({domConfig:{onlyChildren:!0,children:[r.callback("agendaEventDateRenderer",r,[o]),{className:{"b-cal-event-bar-container":1},children:c}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:i}),i.setAttribute("aria-label",`${C.format(o,"dddd MMMM Do, YYYY")}, ${r.L("eventCount",l.length)}`),i.setAttribute("tabIndex",-1),i.dataset.date=t.id,!a.autoHeight){const u=i.querySelector(".b-cal-agenda-date"),h=a._cellTbPadding!=null?a._cellTbPadding:a._cellTbPadding=E.getEdgeSize(i,"padding","tb").height,g=a._containerPadding!=null?a._containerPadding:a._containerPadding=E.getEdgeSize(i.querySelector(".b-cal-event-bar-container"),"margin","tb").height,f=a._dateBlockHeight!=null?a._dateBlockHeight:a._dateBlockHeight=L.outer(u).height;n.height=Math.max(t.events.length*(r.eventHeightInPixels+r.eventRowSpacing)-r.eventRowSpacing+h+g+(r.responsiveState==="small"?f:0),86)}}onBeforeGridResponsiveStateChange(){this._cellTbPadding=this._containerPadding=this._dateBlockHeight=this._dateBlockHeight=null}getCellClass(i){const e=super.getCellClass(i);return e["b-sticky-cell"]=e[`b-day-of-week-${i.record.day}`]=1,e}headerRenderer({headerElement:i}){i.innerHTML="",oe.sync({domConfig:{className:{"b-cal-agenda-header":1,"b-grid-header":1,"b-last-leaf":1},children:[{className:{"b-cal-agenda-header-date":1},text:"Date"},{className:{"b-cal-agenda-header-time":1},text:"Time"},{className:{"b-cal-agenda-header-event":1},text:"Event"}]},targetElement:i})}};y(Bc,"$name","AgendaColumn"),y(Bc,"type","agendacolumn"),Ve.registerColumnType(Bc),Bc._$name="AgendaColumn";var ro=class extends He{static get defaults(){return{id:"calendarevents",text:"Event Details",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!0,alwaysClearCell:!1}}renderer({cellElement:i,record:e,grid:t}){var r,n;const s=(r=t.calendar)==null?void 0:r.widgetMap.resourceFilter,a=s?e.resources.filter(l=>s.selected.includes(l)):e.resources;(n=t._cellRenderer)==null||n.call(t,...arguments),t.showResourceAvatars=!0,oe.sync({domConfig:{onlyChildren:!0,children:[{class:"b-cal-event-resource-avatars",children:a.map(l=>({class:"b-cal-event-resource-avatar-row",children:[t.getResourceAvatar(l),{class:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:l.name},{class:"b-event-column-resource-role",text:l.role}]}]}))},{class:"b-cal-event-column-event-desc",children:[{class:"b-cal-event-column-event-name",text:e.name}]},{class:"b-cal-event-column-times",children:[t.eventListEventTimeRenderer(e)]}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:i})}};y(ro,"$name","EventColumn"),y(ro,"type","calendarevents"),Ve.registerColumnType(ro),ro.exposeProperties(),ro._$name="EventColumn";var dn=class extends ml{};y(dn,"fields",[{name:"alignment",defaultValue:"start",internal:!0},{name:"color",internal:!0},{name:"footer",internal:!0},{name:"rotation",internal:!0}]),dn._$name="TimeRangeModel";var zc=class extends pl{};y(zc,"defaultConfig",{modelClass:dn}),zc.initClass(),zc._$name="TimeRangeStore";var hr=class extends tn{};y(hr,"$name","ProjectModel"),y(hr,"configurable",{timeRangeStore:{modelClass:dn}}),y(hr,"defaultConfig",{timeRangeModelClass:dn,timeRangeStoreClass:zc}),hr.applyConfigs=!0,hr.initClass(),hr._$name="ProjectModel";var no=class extends lc{buildProjectConfig(){const i=super.buildProjectConfig(),{timeRangeStore:e}=this;return e&&(i.timeRangeStore=e),i}get timeRangeStore(){return super.timeRangeStore}set timeRangeStore(i){var e;i&&T.isObject(i)&&(i=T.assign({modelClass:this.timeRangeClass},i)),this.setFeaturedStore("_timeRangeStore",i,(e=this.project)==null?void 0:e.timeRangeStoreClass)}};y(no,"$name","CrudManager"),y(no,"configurable",{projectClass:hr,timeRangeClass:dn}),no.initClass(),no._$name="CrudManager";var qe=class extends ie.mixin(ii){static get factoryable(){return{}}getViewZoneType(i){const{zoneTypes:e}=this;let t;return e&&(t=e[i.type])===void 0&&(i.isWeekView&&e.week!==void 0?t=e.week:i.isDayView?t=e.day:i.isMonthView?t=e.month:i.isYearView?t=e.year:i.isResourceView?t=e.resource:i.isAgendaView&&(t=e.agenda)),t}updateDisableOnReadOnly(i){const e=this,{client:t}=e,r="readonlyToggle",n="onClientReadOnlyToggle";i?(e[n]({readOnly:t.readOnly}),t.ion({name:r,readOnly:n,thisObj:e})):e.detachListeners(r)}doDestroy(){this.syncModes(),super.doDestroy()}createZone(i,e){return new i({owner:this,...e})}onClientReadOnlyToggle({readOnly:i}){this.disabled=i}updateDisabled(i,e){super.updateDisabled(i,e),this.client.isPainted&&this.syncModes()}onCalendarPaint({firstPaint:i}){i&&this.syncModes()}syncModes(){const i=this,{client:e,_modeDetacher:t,zones:r}=i;let n=null,s,a,l,o,d;if(i.disabled||i.isDestroying||!i.zoneTypes)t==null||t();else{e.isCalendar?(t||(i._modeDetacher=e.ion({addMode:()=>i.syncModes()})),s=e.modes):s={view:e};for(a in s)d=r==null?void 0:r[a],l=s[a],o=i.getViewZoneType(l),o&&((T.isObject(d)?d.type:d==null?void 0:d.constructor)===o?delete r[a]:l.isPainted?d=i.createZone(o,{view:l}):d=i.whenPainted(a,l,o),(n||(n={}))[a]=d)}if(i.zones=n,r)for(a in r)r[a].destroy()}whenPainted(i,e,t){const r=this,n={type:t,destroy:e.ion({once:!0,prio:1e4,paint(){r.zones[i]===n&&(r.zones[i]=r.createZone(t,{view:e}))}})};return n}};y(qe,"configurable",{disableOnReadOnly:null,zoneTypes:null}),y(qe,"properties",{clientListeners:{paint:"onCalendarPaint"}}),qe._$name="CalendarFeature";var so=class extends ${updateView(i){const e=this,t=i&&e.viewListeners;e.detachListeners("viewListeners"),t&&(i==null||i.ion(T.merge({thisObj:e,name:"viewListeners"},t)))}};y(so,"$name","CalendarZone"),y(so,"configurable",{owner:null,view:{$config:"nullify",value:null},viewListeners:null}),so.initClass(),so._$name="CalendarZone";var ao=class extends Zi{getItemCls(i){return E.isNamedColor(i.eventColor)?` b-sch-${i.eventColor}`:""}getItemStyle(i){return`color:#fff;${i.eventColor&&!E.isNamedColor(i.eventColor)?`background-color:${i.eventColor}`:""}`}iconTpl(i){return E.createElement(this.owner.ownerFeature.client.activeView.getResourceAvatar(i)).outerHTML}};y(ao,"$name","ResourceChipView"),y(ao,"type","resourcechipview"),y(ao,"configurable",{navigator:null,itemsFocusable:!1,closable:!1,scrollable:!1,itemTpl(i){var e;return E.createElement({className:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:i.name},(e=i.role)!=null&&e.length?{class:"b-event-column-resource-role",text:i.role}:null]}).outerHTML}}),ao.initClass(),ao._$name="ResourceChipView";var oL=new String(""),sv=i=>{var e;return e=class extends(i||$){updateEventRenderer(){this.refreshSoon()}createEventDomConfig(t,r=this.eventRenderer){var n,s,a,l,o,d,c,u;const h=this,{intradayCls:g,alldayCls:f,solidBarCls:m,pastEventCls:p,showTime:v,timeFormat:b,eventHeaderRenderer:w,rtl:D}=h,S=h.up("calendar"),{eventRecord:x,minimal:R}=t,M=R?"auto":h.eventHeight,_=t.eventEndDate||x.endingDate,k=h.callback(h.getPrimaryResource,h,[x.isOccurrence?x.recurringEvent:x]),F=x.isRecurring||x.isOccurrence,I="isAllDay"in t?t.isAllDay:(n=h.isAllDayEvent)==null?void 0:n.call(h,x),A={height:M!=="auto"?E.setLength(M):null},P=S==null?void 0:S.eventSelectedCls,H=(s=S==null?void 0:S.navigator)==null?void 0:s.focusCls,G=t.dataset={eventId:x.id},q=Object.assign(E.parseStyle(k==null?void 0:k.eventStyle),E.parseStyle(x.style)),W={className:"b-cal-event",style:A};let j=t.eventColor||x.color||x.eventColor||(k==null?void 0:k.eventColor)||oL;t.wrapperChildren=[W],t.cls=x.cls.clone(),t.solidBar=I||R,t.iconStyle=h.iconTarget==="header"&&h.showTime&&!E.isNamedColor(j)?{color:j}:{},t.iconCls=new te(x.iconCls),t.style=q,t.eventColor=j,t.eventHeight=M,t.cls[h.shortEventCls]=x.rawDurationMS<=h.shortEventDuration,t.bodyStyle={},t.resourceRecord=k,t.view=h,k!=null&&k.cls&&t.cls.add(k.cls);let se=(a=h.internalBodyContentRenderer(x,k,t,!R&&r))!=null?a:"";const J=typeof se=="string",Q=J?O.isHtml(se):!0;r&&!R&&(t.eventHeight!==M&&(A.height=E.setLength(t.eventHeight)),typeof t.cls=="string"&&(t.cls=new te(t.cls)),typeof t.iconCls=="string"&&(t.iconCls=new te(t.iconCls)),typeof t.style=="string"&&(t.style=E.parseStyle(t.style)),typeof t.bodyStyle=="string"&&(t.bodyStyle=E.parseStyle(t.bodyStyle))),se=[{className:{"b-cal-event-desc":1,"b-cal-event-desc-complex":Q},[J?"html":"children"]:se}],Object.assign(t.cls,{"b-cal-event-wrap":1,"b-iscreating":x.isCreating,"b-readonly":x.readOnly,"b-minimal":R,"b-milestone":x.isMilestone&&!I,[f]:f&&I,[m]:m&&t.solidBar,[g]:g&&!I,[p]:p&&_<new Date,[P]:(S==null?void 0:S.isEventSelected(x))||t.asSelected,"b-rtl":D,[H]:((l=S==null?void 0:S.navigator.activeItem)==null?void 0:l.dataset.eventId)===x.id}),j=t.eventColor;const{bodyColor:X}=t;if(X!=null&&X.length&&(t.cls["b-custom-body-color"]=1,t.bodyStyle["--dayview-body-background-color"]=X),j!=null&&j.length&&(q["--cal-event-color"]=E.createColorStyle(j)),w){const he=h.callback(w,h,[{view:h,eventRecord:x,resourceRecord:k,renderData:t}]),st=Array.isArray(he);!st&&typeof he=="object"?(he.className=te.normalize(he.className,"object"),he.className["b-event-header"]=1,se.unshift(he)):se.unshift({className:"b-event-header",[st?"children":he.includes("<")?"html":"text"]:he})}else v&&!(I&&h.showAllDayHeader)&&se.unshift({className:"b-event-header",children:[{className:"b-event-time",html:h.renderTimes(x,v,b)}]});const ee=!!((o=t.iconCls)!=null&&o.length),ce=!ee&&F,ae="showBullet"in t?t.showBullet:h.showBullet===!0||((d=h.showBullet)==null?void 0:d.bar)&&t.solidBar||((c=h.showBullet)==null?void 0:c.noBar)&&!t.solidBar,Ie=!ee&&!F&&ae,ue={tag:"i",className:Object.assign({"b-cal-event-icon":!ce,"b-cal-recurrence-icon":ce,"b-icon":1,"b-fw-icon":1,"b-icon-circle":Ie,"b-icon-recurring":ce},t.iconCls),style:t.iconStyle},Ne=[{className:"b-cal-event-body",children:se,style:t.bodyStyle}],ye=h.iconTarget==="header"&&h.showTime?((u=se[0].children)==null?void 0:u.length)>0?se[0].children:se:Ne;(ee||ce||Ie)&&(h.iconTarget==="header"&&h.showTime?ye.push(ue):ye.unshift(ue)),ee&&F&&ye.push({tag:"i",className:{"b-cal-recurrence-icon":1,"b-icon":1,"b-fw-icon":1,"b-icon-recurring":1},style:t.iconStyle}),R||(W.children=Ne);const{startText:Ee,endText:Ye}=Ls.getStartAndEndDates(h,x),xe={role:"button","aria-label":x.name+","+(Ye?`${Ee} ${h.L("L{Object.to}")} ${Ye}`:`${x.isMilestone?h.L("L{Object.at}"):h.L("L{Object.on}")} ${Ee}`)+".",dataset:G,tabIndex:R?null:0,className:t.cls,style:t.style,children:t.wrapperChildren};return S==null||S.onEventDataGenerated(t,xe),xe}renderTimes(t,{startTime:r,endTime:n},s){const a=!t.isMilestone&&n;return`${r?C.format(t.startDate,s):""}${r&&a?` ${this.rtl?"\u2190":"\u2192"} `:""}${a?C.format(t.endDate,s):""}`}internalBodyContentRenderer(t,r,n,s){var a;const l=this,{showResourceAvatars:o}=l,d=s&&l.callback(s,l,[{view:l,eventRecord:t,resourceRecord:r,renderData:n}])||O[l.eventHeight==="auto"?"encodeHtmlBR":"encodeHtml"](t.name),c=typeof d=="string",u=Array.isArray(d);if(o&&((a=t.assigned)!=null&&a.size)){const h=[{class:"b-cal-event-resource-avatars",children:t.resources.map(f=>l.getResourceAvatar(f))}],g=[o==="last"?0:1,0];return typeof d=="string"?g.push({class:"b-cal-event-name",text:d}):g.push[u?"apply":"call"](g,d),h.splice(...g),h}else return u||c?d:[d]}},y(e,"$name","EventRenderer"),y(e,"configurable",{eventRenderer:null,eventHeaderRenderer:null,filterEventResources:null,getPrimaryResource({resources:t}){var r,n;if(this.resource)return this.resource;if(t.length){const s=this.filterEventResources&&((n=(r=this.calendar)==null?void 0:r.widgetMap)==null?void 0:n.resourceFilter);return s?t.find(a=>s.selected.includes(a)):t[0]}}}),e},dL=new String,Cs=class extends to.mixin(sv){construct(i){var e;const t=this.calendar=(e=i.owner||i.parent)==null?void 0:e.up("calendar");t&&!i.eventStore&&(i.eventStore=t.eventStore),super.construct(...arguments)}changeEventDots(i){const e=this;return new Proxy(i,{set(t){const r=Reflect.set(...arguments);return e.updateEventDots(t),r}})}updateEventDots({marginTop:i,gap:e,size:t,stripe:r}){const{style:n,classList:s}=this.weeksElement;n.setProperty("--event-count-margin-top",`${i}px`),n.setProperty("--event-count-dot-size",`${t}px`),n.setProperty("--event-count-dot-gap",`${e}px`),s[r?"add":"remove"]("b-event-count-dots-striped"),this.isConfiguring||this.refresh()}updatemaxDots(i){re.deprecate("calendar","7.0.0","maxDots property is deprecated in favor of eventDots"),this.eventDots.max=i,this.updateEventDots(this.eventDots)}refreshEventsMap(){var i,e;const t=this,r=t.eventSorter||((e=(i=t.calendar)==null?void 0:i.activeView)==null?void 0:e.eventSorter);if(t.showEvents&&(t.cellMap=t.eventStore[t.showEvents==="dots"?"getEvents":"getEventCounts"]({startDate:t.startDate,endDate:t.endDate,dateMap:t.cellMap||(t.cellMap=new Map),filter:t.eventFilter}),t.showEvents==="dots"&&r))for(const n of t.cellMap.values())n.sort(r)}cellRenderer({cell:i,date:e}){var t,r;const n=this,{showEvents:s}=n,a=s==="count",l=s==="dots",o=(r=(t=n.cellMap)==null?void 0:t.get)==null?void 0:r.call(t,C.makeKey(e)),d=l?o==null?void 0:o.length:o,c=a?"b-cell-events-badge":l?"b-cal-minimal-event-container":"b-icon b-icon-circle";if(l&&(i.innerHTML="",E.createElement({class:"b-date-cell-inner",text:e.getDate(),parent:i})),i.parentNode.setAttribute("aria-label",`${C.format(e,"dddd MMMM Do YYYY")}${s?`, ${n.L("L{ResourceInfoColumn.eventCountText}",d||0)}`:""}.`),delete i.parentNode.dataset.btip,d){!a&&n.eventCountTip&&(i.parentNode.dataset.btip=n.L("L{ResourceInfoColumn.eventCountText}",d));const u={dataset:{count:d},class:{[c]:s!=="heatmap",[to.getEventCountClass(d)]:1},parent:i,[a?"text":""]:d};if(l){const{max:h}=n.eventDots,g=u.children=[];for(let f=0;f<Math.min((o==null?void 0:o.length)||0,h);f++){const m=n.createEventDomConfig({date:e,eventRecord:o[f],eventColor:h>1?null:dL,minimal:!0});g.push(m)}}E.createElement(u)}}static setupClass(i){i.replaceType=!0,super.setupClass(i)}};y(Cs,"$name","CalendarDatePicker"),y(Cs,"type","datepicker"),y(Cs,"configurable",{showEvents:null,maxDots:null,eventDots:{marginTop:4,max:4,gap:3,size:5},eventCountTip:null,alwaysRefreshOnMonthChange:!0}),Cs.initClass(),Cs._$name="CalendarDatePicker";var Wc=class HE extends Xe.mixin(Aa){setupWidgetConfig(e,t){var r;const n=this;let s=super.setupWidgetConfig(...arguments);return s.ref==="eventFilter"&&(s.store=n.initialConfig.eventStore),s.ref==="resourceFilter"&&(!s.type||s.type===n.resourceFilter.type)&&(s=HE.mergeConfigs(n.resourceFilter,s)),s.type==="datepicker"&&(n.element.classList.add("b-has-datepicker"),n.element.classList.toggle("b-datepicker-with-events",!!s.events),(r=n.up("calendar"))==null||r.ion({rangeChange:"onCalendarViewRangeChange",thisObj:n})),s}onInternalPaint({firstPaint:e}){var t,r;const{datePicker:n}=this.widgetMap;e&&(this.getConfig("highlightMultiSelectSpan"),n!=null&&n.multiSelect&&((t=this.owner)==null||t.eachView(s=>{s.isDateRangeOwner&&!s.fixedDuration&&n.multiSelect===!0&&(s.dateFilter=s.resourceDateFilter=({date:a})=>n.isSelected(a))}),this.onDatePickerSelectionChange({source:n,selection:n.selection},!0))),(r=super.onInternalPaint)==null||r.call(this,...arguments)}updateHighlightMultiSelectSpan(e){const{datePicker:t}=this.widgetMap;t&&t.element.classList.toggle("b-highlight-selection",!!e)}updateSide(e,t){const{classList:r}=this.element;r.remove(`b-sidebar-${t}`),r.add(`b-sidebar-${e}`),this.collapsible&&(this.collapsible.direction=e)}updateStepUnitText(e){const t=this,{prevButtonSidebar:r,nextButtonSidebar:n}=t.widgetMap;r&&(r.tooltip=e?t.L("L{Calendar.previous}",e):"",r.disabled=!e),n&&(n.tooltip=e?t.L("L{Calendar.next}",e):"",n.disabled=!e)}updateEventStore(e){const{resourceFilter:t,datePicker:r,eventFilter:n}=this.widgetMap;n&&(n.store=e),t&&(t.eventStore=e),r&&(r.eventStore=e)}onCalendarViewRangeChange({source:e,new:{startDate:t,endDate:r}}){const{datePicker:n}=this.widgetMap;e.isEventList&&!e.range&&(n==null?void 0:n.multiSelect)==="range"&&(n.selection=[t,r])}onDatePickerSelectionChange({source:e,selection:t,oldSelection:r,userAction:n},s){var a;const l=this,{multiSelect:o}=e,[d,c]=[t[0],t[t.length-1]];if(l.UIdateChange=n,d){const[u,h]=[new Date(e.month.year,e.month.month,1),new Date(e.month.year,e.month.month+1,0)],g=o?C.max(C.min(d,h),u):d,f={};o&&((a=l.owner)==null||a.eachView(m=>{if(m.isDateRangeOwner&&!m.fixedDuration){const{_hidden:p}=m,v=e.getRange(o===!0);if(m.hasConfig("endDate")?(f.startDate=v.startDate,f.endDate=C.add(v.endDate,m.isEventList?0:-1,"d")):f.range=v,!m.initialConfig.shiftIncrement&&l.snapMultiSelectNavigation){const b=o===!0?v:e.getRange(!0);f.shiftIncrement={unit:b.unit,magnitude:1}}!s&&!C.betweenLesser(m.date,d,c)&&(f.date=g),m._hidden=!0,m.setConfig(f),m._hidden=p}}),l.isConfiguring||l.owner.eventStore.trigger("change")),l.inOnDatePickerSelectionChange=!0,l.date=g,l.inOnDatePickerSelectionChange=!1,l.UIdateChange=!1}}changeDate(e,t){if(e=typeof e=="string"?C.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=C.clearTime(e),!t||e-t)return e}updateDate(e,t){const r=this,{datePicker:n}=r.widgetMap;if(!r.isConfiguring&&n){const{multiSelect:s,selection:a}=n,l=r.owner.views.find(o=>o.isDateRangeOwner&&!o.fixedDuration&&o.isVisible);if(s&&l){const o=n.getRange(s===!0),d={date:e};let c;if(!r.inOnDatePickerSelectionChange){if(s===!0){const u=e>t,h={unit:"day",magnitude:Math.abs(C.diff(o.startDate,l.startDate,"d"))};if(c=a.map(g=>C.add(g,h.magnitude*(u?1:-1),h.unit)),o.wholeMonth){const g=c[c.length-1];let f=C.getLastDateOfMonth(c[0]).getDate()-c.length;if(f<0)c.length+=f;else if(f)for(let m=C.add(g,1,"d");f;f--,m=C.add(m,1,"d"))c.push(m)}}else l.range?(e=l.snapDate(e),c=[e,C.add(C.add(e,o),-1,"d")]):e>a[a.length-1]?(o.magnitude*=-1,c=[C.add(C.add(e,o),1,"d"),e]):e<a[0]&&(c=[e,C.add(C.add(e,o),-1,"d")]);c&&(d.selection=c)}n.setConfig(d)}else n.value=e}r.trigger("dateChange",{date:e,oldDate:t,userAction:!!r.UIdateChange})}};y(Wc,"$name","Sidebar"),y(Wc,"type","sidebar"),y(Wc,"configurable",{focusable:!1,ignoreParentReadOnly:!0,ariaLabel:"Sidebar",bbar:{cls:"b-cal-nav-item",layout:{justify:"center"},items:{todayButtonSidebar:{text:"L{Calendar.Today}",onClick:"up.shiftToNow",weight:200},prevButtonSidebar:{onClick:"up.shiftPrevious",cls:"b-borderless",icon:"b-icon-previous",weight:300},nextButtonSidebar:{onClick:"up.shiftNext",cls:"b-borderless",icon:"b-icon-next",weight:400}}},items:{datePicker:{type:"datepicker",ariaLabel:"L{Sidebar.selectDate}",weight:100,internalListeners:{selectionChange:"up.onDatePickerSelectionChange"}},eventFilter:{type:"filterfield",field:"name",weight:150,placeholder:"L{Sidebar.matchEvents}",ariaLabel:"L{Sidebar.filterEvents}",localeClass:Wc},resourceFilter:{ignoreParentReadOnly:!0,ariaLabel:"L{Sidebar.filterResources}"}},date:{$config:{equal:"date"},value:null},eventStore:null,responsive:{},stepUnitText:null,side:"left",collapsible:{tool:null},resourceFilter:{type:"resourcefilter",flex:"1 1 auto",weight:200,minHeight:110,scrollable:{overflowY:"auto"},store:{sorters:[{field:"name",ascending:!0}]},masterFilter(i){return this.eventStore.resourceStore.isAvailable(i)}},highlightMultiSelectSpan:{$config:"lazy",value:null},snapMultiSelectNavigation:!0});var vg=Wc;vg.initClass(),vg._$name="Sidebar";var av=i=>{var e;return e=class extends Np(i||$){static get projectStores(){return{resourceStore:{dataName:"resources",listeners:{changePreCommit:"onCalendarStoreChange"}},eventStore:{dataName:"events",listeners:{changePreCommit:"onCalendarStoreChange"}},assignmentStore:{dataName:"assignments"},timeRangeStore:{dataName:"timeRanges",modelClass:dn},resourceTimeRangeStore:{dataName:"resourceTimeRanges",modelClass:dr}}}changeCrudManager(t){var r;const n=this;return t&&!t.isCrudManager&&(t=(t.type||n.crudManagerClass).new({scheduler:n},t)),(r=n.bindCrudManager)==null||r.call(n,t),n._crudManager=null,t}updateTimeZone(t){this.project.timeZone=t}get timeZone(){return this.project.timeZone}onBeforeTimeZoneChange({timeZone:t,oldTimeZone:r}){if(this.isConfiguring)return;const n=this,s=n.isCalendar?n.activeView:!n.calendar&&n;if((s==null?void 0:s.duration)===1){const a=s.events.filter(l=>l.startDate>=s.startDate&&l.endDate&&l.endDate<=s.endDate);if(a.length){const l=a.map(u=>(u.startDate.getTime()+u.endDate.getTime())/2),o=new Date(Math.floor(l.reduce((u,h)=>u+h,0)/l.length)),d=r!=null?$e.fromTimeZone(o,r):o,c=t!=null?$e.toTimeZone(d,t):d;(c<s.startDate||c>s.endDate)&&((s.calendar||s).date=c)}}}onTimeZoneChange(){}get defaultCalendar(){const{eventStore:t}=this,r=T.hasOwn(this,"_defaultCalendar")?this._defaultCalendar:t.defaultCalendarId;if(r!==null)return r!=null?r.isResourceModel?r:t.resourceStore.getById(r):t.resourceStore.first}get defaultCalendarId(){return this.eventStore.modelClass.asId(this.defaultCalendar)}updateProject(t,r){super.updateProject(t,r);const n=this;n.getConfig("timeZone"),n.detachListeners("CalendarStores"),t&&(t.ion({name:"CalendarStores",dataReady:"onCalendarStoreChange",refresh:"onProjectRefresh",thisObj:n}),n.isConfiguring||(n.eachView(s=>{s.project=t}),n.onCalendarStoreChange({source:t})))}onProjectRefresh({source:t,isInitialCommit:r}){r&&t.eventStore.invalidateDayIndices()}updateEventStore(t){if(t&&!t.isCalendarEventStore){const r=this;Object.defineProperty(t,"defaultCalendar",{get:()=>r.defaultCalendar}),t.isCalendarEventStore=!0,"removeUnassignedEvent"in t.initialConfig||(t.removeUnassignedEvent=!1)}}get widgetClass(){}},y(e,"$name","CalendarStores"),y(e,"configurable",{defaultCalendar:null,crudManagerClass:no,crudManager:null,timeZone:{$config:"lazy",value:null}}),y(e,"defaultConfig",{projectModelClass:hr}),e},q0=i=>i.isCalendarMixin&&i.eventStore,cL=/(click|touch|mouse|pointer|key|context|dbl)(.*)/,uL=(i,e,t)=>`${O.capitalize(e)}${O.capitalize(t)}`,hL=i=>i.type.replace(cL,uL),K0=i=>{var e;return e=class extends(i||$){calendarHitTest(t){const{activeView:r}=this,n=E.getEventElement(t);return r!=null&&r.element.contains(n)?r.calendarHitTest(t):null}get timeAxis(){const t=this;return t._timeAxis||(t._timeAxis={get startDate(){return t.activeView.startDate},get endDateDate(){return t.activeView.endDate},isTimeSpanInAxis(r){return C.intersectSpans(r.startDate,r.endDate,this.startDate,this.endDate)}}),this._timeAxis}get timeAxisViewModel(){const t=this;return t._timeAxisViewModel||(t._timeAxisViewModel={get timeResolution(){return t.activeView.timeResolution||{}}}),this._timeAxisViewModel}resolveEventRecord(t){var r;t instanceof Event&&(t=t.target);const n=(r=this.constructor.fromElement(t))==null?void 0:r.closest(q0);return n==null?void 0:n.getEventRecord(t)}resolveAssignmentRecord(){}resolveResourceRecord(t){var r,n;const s=t.nodeType===Node.ELEMENT_NODE?t:t.target;return this.resourceStore.getById((r=s.closest("[data-resource-id]"))==null?void 0:r.dataset.resourceId)||((n=this.resolveEventRecord(s))==null?void 0:n.resource)}handleEvent(t){var r;const n=hL(t);super.handleEvent?super.handleEvent(t):!t.handled&&!t.schedulerRedirected&&(this.trigger(`beforeElement${n}`,{event:t,target:t.target})!==!1&&((r=this[`onElement${n}`])==null||r.call(this,t)),t.schedulerRedirected=!0)}getCellDataFromEvent(t){var r;return(r=super.getCellDataFromEvent)==null?void 0:r.call(this,t)}getDateFromDomEvent(t){var r;const n=(r=this.constructor.fromElement(t))==null?void 0:r.closest(q0);if(n)return n.getDateFromDomEvent(t)}getDateFromXY(t,r,n=!0,s){const a=this.activeSubView;if(a)return a.getDateFromPosition(t[0]-globalThis.scrollX,t[1]-globalThis.scrollY,n)}createEvent(){this.activeView.createEvent(...arguments)}get enableRecurringEvents(){return!0}intersectsVisibleTimeSpan(t){const{activeView:r}=this;return C.intersectSpans(r.startDate,r.endDate,t.startDate,t.endDate)}getRowFor(){}suspendRefresh(){}resumeRefresh(){}get widgetClass(){}},y(e,"$name","SchedulerInterface"),e},gL={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,EventEdit:{Calendar:"Calendar","All day":"All day",day:"Day",week:"Week",month:"Month",year:"Year",decade:"Decade"},EventMenu:{duplicateEvent:"Duplicate",copy:"copy"},Calendar:{toggleSidebar:"Toggle sidebar visibility",Today:"Today",Tomorrow:"Tomorrow",next:i=>`Next ${i}`,previous:i=>`Previous ${i}`,plusMore:i=>`+${i} more`,moreEvents:i=>`${i} more events`,allDay:"All day",endsOn:i=>`Ends ${i}`,weekOfYear:([i,e])=>`Week ${e}, ${i}`,loadFail:"Calendar data load failed. Please contact your system administrator",gotoDate:"Go to date",timeRange:"Time range"},CalendarDrag:{holdCtrlForRecurrence:"Hold CTRL for a recurring event"},CalendarMixin:{eventCount:i=>`${i||"No"} event${i===1?"":"s"}`},EventTip:{"Edit event":"Edit",timeFormat:"LST"},ModeSelector:{includeWeekends:"Include weekends",weekends:"Weekends"},AgendaView:{Agenda:"Agenda"},MonthView:{Month:"Month",monthUnit:"month"},WeekView:{weekUnit:"week"},YearView:{Year:"Year",yearUnit:"year",noEvents:"No events"},EventList:{List:"List",Start:"Start",Finish:"End",days:i=>`${i>1?`${i} `:""}day${i===1?"":"s"}`},DayView:{Day:"Day",dayUnit:"day",daysUnit:"days",expandAllDayRow:"Expand all-day section",collapseAllDayRow:"Collapse all-day section",timeFormat:"LST",timeAxisTimeFormat:"LST",noMatchingDates:"No matching dates"},DayAgendaView:{dayAgenda:"Day Agenda"},DayResourceView:{dayResourceView:"Day resources"},Sidebar:{selectDate:"Select calendar date",matchEvents:"Match events",filterEvents:"Filter events by event name",filterResources:"Filter events by selected resource"},WeekExpander:{expandTip:"Click to expand row",collapseTip:"Click to collapse row"}},YP=lt.publishLocale(gL),jc=class extends ${static defaultSorterFn(i,e){i=i.eventRecord||i,e=e.eventRecord||e;const{startDate:t}=i,{startDate:r}=e;return t?r?t-r||e.durationMS-i.durationMS:1:-1}static interDaySorterFn(i,e){i=i.eventRecord||i,e=e.eventRecord||e;const{startDate:t,isInterDay:r}=i,{startDate:n,isInterDay:s}=e;return t?n?r!==s?Number(s)-Number(r):!r&&!s?t-n:e.durationMS-i.durationMS||e.endingDate-i.endingDate||t-n:1:-1}};jc._$name="EventSorter";var X0=Object.freeze({}),{eventNameMap:fL}=V,mL=i=>i.isCalendarMixin&&i.containsFocus,gr=i=>{var e;return e=class extends(i||$).mixin(Hp,K0,mm,av,sv,Aa){static get configurable(){return{localizableProperties:["autoCreate.newName","timeFormat","shortDateFormat","shortDateTimeFormat"],contentElMutationObserver:null,eventStore:null,resourceStore:null,eventSorter:jc.defaultSorterFn,responsive:{},hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",weekStartDay:C.weekStartDay,nonWorkingDays:{value:C.nonWorkingDays,$config:{merge:"replace"}},nonWorkingDayCls:"b-nonworking-day",dayCellCls:"b-calendar-cell",weekendCls:"b-weekend",todayCls:"b-today",pastEventCls:"b-past-event",shortEventCls:"b-short-event",shortEventDuration:"30 minutes",eventHeight:25,eventSpacing:2,intradayCls:"b-intraday",alldayCls:"b-allday",solidBarCls:"b-solid-bar",dayNameSelector:".b-day-name",showTime:!1,timeFormat:{value:"LT",$config:{localeKey:"L{timeFormat}"}},showBullet:{bar:!1,noBar:!0},eventColourStyleProperty:"color",handlePointerInteraction:!0,shortDateFormat:{value:"ll",$config:{localeKey:"L{shortDateFormat}"}},title:null,shortDateTimeFormat:{value:"ll LT",$config:{localeKey:"L{shortDateTimeFormat}"}},readOnly:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",snapType:"round",duration:"1 hour",startHour:8},dragUnit:"hour",autoRefresh:{$config:{merge:"classList"},value:null},allowOverlap:!0,syncViewDate:!0,syncCalendarDate:!0,focusable:!1,avatarRendering:{$config:"lazy",value:null},showResourceAvatars:null,resourceImagePath:null,minDate:null,maxDate:null,animateTimeShift:!0,includeTimeRanges:null,defaultScrollOptions:{animate:!0},selectorButton:null,selectorMenuItem:null,testConfig:{animateTimeShift:!1},extendAllDayEndDay:null,activationKey:null,keyMap:{"Ctrl+z":"undoRedoDataChange","Shift+Ctrl+z":"undoRedoDataChange"}}}static get delayable(){return{refreshSoon:{type:"raf",cancelOutstanding:!0}}}static get featureable(){return{factory:qe}}construct(t){var r;const n=this;super.construct(t),!n.isYearView&&n.element.tabIndex!==-1&&((r=n.contentElement)==null?void 0:r.tabIndex)!==-1&&((n.contentElement||n.element).tabIndex=-1),n.getConfig("avatarRendering"),V.on({element:n.element,keydown:"onCalendarKeyDown",thisObj:n}),n.handlePointerInteraction&&(V.on({element:n.element,mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:{handler:"onCalendarPointerInteraction",block:300},dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction",thisObj:n}),V.on({element:n.element,mouseenter:"onEventMouseEnterLeave",mouseleave:"onEventMouseEnterLeave",capture:!0,thisObj:n}))}focusDate(t=this.date){var r;const n=this,s=n.eventContentElement||n.contentElement;t=n.ingestDate(t);let a=(r=n.getDayElement)==null?void 0:r.call(n,t);a&&!E.isFocusable(a)&&(a=a.querySelector('[role="link"]')),(!a||!E.isFocusable(a))&&(a=[...s.querySelectorAll("*")].find(E.isFocusable)),(a||n).focus({preventScroll:!0,focusVisible:!0})}getTimeRanges(t,r){const{resourceId:n,project:s}=this,a=n?this.owner.includeTimeRanges:!0,l=n==null||a?s==null?void 0:s.getTimeRanges(t,r):[];if(n!=null){const o=s==null?void 0:s.getResourceTimeRanges(t,r).filter(d=>d.resourceId==n);o.forEach(d=>{d.color||(d.color=this.resource.eventColor)}),l.push(...o)}return l}updateIncludeTimeRanges(){this.isConfiguring||this.refresh()}onConfigChange(t){var r;(r=this.autoRefresh)!=null&&r[t==null?void 0:t.name]&&this.refreshSoon(),super.onConfigChange(t)}changeAvatarRendering(t){return La.new({element:this.element},t)}updateShowResourceAvatars(t){t&&(this.avatarRendering||(this.avatarRendering=!0)),this.refresh()}getResourceAvatar(t){return this.avatarRendering.getResourceAvatar({resourceRecord:t,imageUrl:t.image===!1?null:t.imageUrl||t.image&&this.resourceImagePath+t.image,color:t.eventColor,initials:t.initials,dataset:{btip:O.encodeHtml(t.name),resourceId:t.id}})}updateEventHeight(t){const{style:r}=this.element;this._eventHeightInPixels=null,r.setProperty("--event-height",E.setLength(t)),r.setProperty("--arrow-width","calc(var(--event-height) / 3)"),r.setProperty("--arrow-margin","calc(var(--event-height) / -3)"),this.isConfiguring||this.refreshSoon()}get eventHeightInPixels(){const t=this,{eventHeight:r}=t;let n=t._eventHeightInPixels;return r!=="auto"&&(n||(n=t._eventHeight,typeof n=="string"&&(n=E.measureSize(n,t.contentElement.querySelector(`.${t.eventBarContainerCls}`),!1)),t._eventHeightInPixels=n)),n}get visibleCellSelector(){const t=[];return this.hideOtherMonthCells&&t.push(`.${this.otherMonthCls}`),this.hideNonWorkingDays&&t.push(`.${this.nonWorkingDayCls}`),`.${this.dayCellCls}${t.length?`:not(${t.join(",")})`:""}`}get activeView(){return this}get activeSubView(){var t,r;return((r=(t=this.items)==null?void 0:t.filter(mL))==null?void 0:r[0])||this}eachView(t,r,n=null){this.callback(t,n||this,r||[this])}get focusElement(){const{calendar:t}=this;if(t){const{navigator:r}=t;return r.activeItem||r.previousActiveItem||this.element.querySelector(r.itemSelector)||super.focusElement}}captureFocusItem(t){const r=this.getEventRecord(t),n=super.captureFocusItem(t);return(s=!0)=>{const a=r&&this.getEventElement(r);a?s?a.focus():a.focus({preventScroll:!0}):n==null||n(s)}}refresh(){this.refreshSoon.cancel(),this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.whenVisible("refreshNow")}refreshNow(){const t=this.captureFocus();this.doRefresh(),t()}afterRefresh(t,r={delay:100,forceRefresh:!1}){return typeof t=="object"?(r=t,t=null):t&&(t=this.resolveCallback(t,this),t=t.handler.bind(t.thisObj)),typeof r=="number"&&(r={delay:r}),new Promise(n=>{this.ion({name:this.constructor.generateId("refresh-expiry-timer-"),refresh:()=>{t==null||t(),n(!0)},once:!0,expires:{delay:r.delay||100,alt:()=>{r.forceRefresh&&this.refresh(),t==null||t(),n(r.forceRefresh)}}})})}get displayName(){return O.capitalize(this._displayName||this.title||this.type)}get hasNonWorkingDays(){return!!Object.values(this.nonWorkingDays||X0).some(t=>t)&&!(this.isDayView&&this.duration===1)}get hiddenNonWorkingDays(){return this.hideNonWorkingDays?this.nonWorkingDays||this.month.nonWorkingDays:X0}changeAutoCreate(t){if(t){const r=typeof t;r!=="object"&&(t={gesture:r==="string"?t:"dblclick"}),t=Re.merge(t,e.$meta.config.autoCreate),t.durationUnit=we.from(t.duration).unit}return t}updateDateSeparator(){this.refreshCalendarDescription()}updateDescriptionFormat(){this.refreshCalendarDescription()}refreshCalendarDescription(){const{calendar:t}=this;t!=null&&t.isPainted&&t.activeView===this&&t.updateViewDescription()}changeShortEventDuration(t){return isNaN(t)?C.as("ms",t):Number(t)}updateShortEventDuration(){this.isConfiguring||this.setTimeout({fn:"whenVisible",delay:200,cancelOutstanding:!0,args:["refreshNow"]})}updateLocalization(){"weekStartDay"in this.initialConfig||(this.weekStartDay=C.weekStartDay),"nonWorkingDays"in this.initialConfig||(this.nonWorkingDays=C.nonWorkingDays),super.updateLocalization(),this.refreshCalendarDescription()}updateAutoCreate(t){this.updateLocalization()}updateWeekStartDay(t){var r;const{refreshCount:n,month:s}=this;(r=super.updateWeekStartDay)==null||r.call(this,t),s&&(s.weekStartDay=t),this.isPainted&&this.refreshCount===n&&this.refresh()}changeNonWorkingDays(t){const r=this;return new Proxy(T.assign({},t),{set(s){const a=Reflect.set(...arguments);return r.updateNonWorkingDays(s),a},deleteProperty(s){const a=Reflect.deleteProperty(...arguments);return r.updateNonWorkingDays(s),a}})}updateNonWorkingDays(t){var r;const{refreshCount:n,month:s}=this;(r=super.updateNonWorkingDays)==null||r.call(this,t),s&&(s.nonWorkingDays=t),this.isPainted&&this.refreshCount===n&&this.refresh()}dayOfDate(t){return C.clearTime(t)}ingestDate(t){if(t=typeof t=="string"?C.parse(t):new Date(t),isNaN(t))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");return this.dayOfDate(t)}changeDate(t,r){const n=this,{isEventList:s}=n,a=n.ingestDate(t),l=s&&!n.range?"betweenLesserEqual":"betweenLesser";if(t=n.constrainTargetDate(a),arguments.length===1)return t;if((!r||t-r)&&n.trigger("beforeDateChange",{date:t,oldDate:r})!==!1){const o=C.diff(a,t,"d");if(o&&C[l](t,n.startDate,n.endDate)){if(s&&n.rowManager.rowCount){const d=n[o<0?"lastFullyVisibleRow":"firstFullyVisibleRow"],c=d&&n.getDateFromElement(d.cells[0]);c&&(t=c)}n._date=t}else return t}}constrainTargetDate(t,r){var n,s;const a=this,l=a.minDate||((n=a.calendar)==null?void 0:n.minDate),o=a.maxDate||((s=a.calendar)==null?void 0:s.maxDate);if(!a.isInCoerceTargetDate&&(!isNaN(l)||!isNaN(o))){a.isInCoerceTargetDate=!0;const d=r?a[`change${O.capitalize(r)}Date`](t,null):t;if(a.isInCoerceTargetDate=!1,!isNaN(l)&&d<l)return l;if(!isNaN(o)&&d>o)return o}return t}changeStartDate(t){if(t)return this.ingestDate(t)}changeEndDate(t){if(t)return this.ingestDate(t)}async scrollTo(t,r){const n=this,{scrollable:s}=n;if(await n.scrollPromise,r=T.assign({},n.defaultScrollOptions,typeof r=="boolean"?{animate:r}:r),t.isEvent){const a=t;C.intersectSpans(n.startDate,n.endDate,t.startDate,t.endDate)||(n.date=t.startDate),t=n.getEventElement(t),t||(n.refresh(),t=n.getEventElement(a))}else t=n.ingestDate(t),(!C.betweenLesser(t,n.startDate,n.endDate)||!n.getDayElement(t,!0))&&(n.date=t),t=n.getDayElement(t);if(t!=null)return s?n.scrollPromise=s.scrollIntoView(t,r).then(()=>n.scrollPromise=null):r.highlight&&(typeof r.highlight=="boolean"?E.highlight(L.from(t)):n.callback(r.highlight,n,[t,n])),n.scrollPromise}async checkAutoCreateGesture(t,r,n){var s;const a=this,{autoCreate:l}=a;if(r&&a.isVisible&&!a.readOnly&&t.type===((s=l==null?void 0:l.gesture)==null?void 0:s.toLowerCase())){const o=C.startOf(r,void 0,void 0,a.weekStartDay),d=isNaN(l.startHour)?C.getTimeOfDay(C.parse(l.startHour,"HH:mm:ss")):l.startHour*1e3*60*60;if(a.trigger("beforeAutoCreate",{view:a,domEvent:t,date:a.isDayView?C[l.snapType](r,l.step):C.add(o,d),resourceRecord:n})!==!1)return a.createEvent(r,n,!0)}}createEvent(t,r,n){var s;(this.calendar||((s=this.owner)==null?void 0:s.calendar)||this).doCreateEvent(t,r,this,n)}async doCreateEvent(t,r,n=this,s){var a;r=r!=null?r:this.defaultCalendar;const l=this,{isDayView:o}=l.viewType||l,d=l.calendar||((a=l.owner)==null?void 0:a.calendar),c=(d==null?void 0:d.eventStore)||l.eventStore,u=n.autoCreate||n.changeAutoCreate(!0),{modelClass:h}=c,{newName:g}=u;if(t==null||!o&&s){const{dayStartHour:R,dayEndHour:M}=l.activeView,_=Math.min(Math.max(u.startHour,R),M),k=_===M?R:_,F=isNaN(k)?isNaN(u.startHour)?C.getTimeOfDay(C.parse(u.startHour,"HH:mm:ss")):u.startHour*36e5:k*36e5;t=C.add(t||l.date,F)}const f=C.parseDuration(u.duration),m=new Date(t.getTime()+(l.dayStartShift||0)),p=o?C[u.snapType](t,u.step):m,v=o&&s?{magnitude:l.dayTime.startShift?Math.min(f.magnitude,C.diff(p,C.add(l.dayTime.startOfDay(t),l.dayTime.duration(),"ms"),f.unit)):Math.min(f.magnitude,C.diff(p,C.add(C.startOf(t),l.dayTime.timeEnd),f.unit)),unit:f.unit}:f,b=C.add(p,v.magnitude,v.unit),w=l.resolveCallback(g,l,!1)?l.callback(g,l,[l,p,r]):g,D={[h.getFieldDataSource("name")]:w,[h.getFieldDataSource("startDate")]:p,[h.getFieldDataSource("endDate")]:b,[h.getFieldDataSource("duration")]:v.magnitude,[h.getFieldDataSource("durationUnit")]:v.unit,allDay:C.diff(p,b,"day")===1},S=n.isEventList&&!n.range?"betweenLesserEqual":"betweenLesser",x=c.createRecord(D);d!=null&&d.features.eventEdit&&!d.features.eventEdit.disabled&&(x.isCreating=!0),r&&c.assignmentStore.assignEventToResource(x,r),await c.addAsync(x),C[S](p,n.startDate,n.endDate)&&(n.getEventElement(x,p)?n.editAutoCreatedEvent(x):n.ion({refresh({source:R}){var M;(M=R.editAutoCreatedEvent)==null||M.call(R,x)},once:!0,prio:-1e4,buffer:100,expires:500}))}editAutoCreatedEvent(t){this.trigger("eventAutoCreated",{eventRecord:t})}get duration(){return this.endDate?this.calculateDuration(this.startDate,this.endDate):1}calculateDuration(t,r){return C.diff(t,r,"day")}next(){this.date=C.add(this.date,this.duration,"day")}previous(){this.date=C.add(this.date,-this.duration,"day")}get eventContentElement(){return this.contentElement}get eventCount(){var t;const r=this,{dateFilter:n,hiddenNonWorkingDays:s}=r;return r.views?r.views.reduce((a,l)=>a+=l.eventCount||0,0):r.cellMap?[...r.cellMap.values(),...((t=r.allDayEvents)==null?void 0:t.cellMap.values())||[]].reduce((a,l)=>((!n||r.callback(n,r,[l]))&&!s[l.day]&&(a+=l.events.length),a),0):r.eventStore.getEvents({startDate:r.startDate,endDate:r.endDate}).length}get firstVisibleCell(){return this.eventContentElement.querySelector(this.visibleCellSelector)}get lastVisibleCell(){const t=this.contentElement.querySelectorAll(this.visibleCellSelector);return t[t.length-1]}get firstVisibleDate(){const t=this,r=new Date(t.startDate),{month:n}=t.month;let{duration:s}=t;for(;s&&(t.hideOtherMonthCells&&r.getMonth()!==n||t.hiddenNonWorkingDays[r.getDay()]);)r.setDate(r.getDate()+1),s--;return r}get lastVisibleDate(){const t=this,r=C.add(t.endDate,-1,"d"),{month:n}=t.month;let{duration:s}=t;for(;s&&(t.hideOtherMonthCells&&r.getMonth()!==n||t.hiddenNonWorkingDays[r.getDay()]);)r.setDate(r.getDate()-1),s--;return r}updateHideNonWorkingDays(t){var r,n;const s=this,{month:a,calendar:l}=s;if((r=s.contentElement)==null||r.classList[t?"add":"remove"](s.hideNonWorkingDaysCls),a==null)return;let o,d,c;if(!s.isConfiguring&&t&&(d=s.date,c=d==null?void 0:d.getDay(),d&&s.nonWorkingDays[c]&&s.getDayElement(d)&&(o=a.visibleDayColumnIndex[c])),a.hideNonWorkingDays=t,(n=super.updateHideNonWorkingDays)==null||n.call(this,t),typeof o=="number"){const u=a.getWeekStart(a.getWeekNumber(d)),h=Math.min(o,a.visibleColumnCount-1);for(let g=-1;!(typeof a.visibleDayColumnIndex[u.getDay()]=="number"&&++g===h);u.setDate(u.getDate()+1));s.date=u,l&&(l.date=d)}}onCalendarStoreChange({source:t,action:r}){var n;const s=this;r==="dataset"&&!t.isChained||s.project.isInitialCommitPerformed&&!s.project.isWritingData&&s.project.isEngineReady()&&((n=s._cellMap)==null||n.clear(),s.isVisible&&s.allowTransitionsOnRefresh==null&&(s.allowTransitionsOnRefresh=!0),s.refreshSoon())}refreshSoon(){this.refresh()}onEventCreated(t){}getEventRecord(t){var r;let n=t instanceof Event?t.target:t;return n=(r=n==null?void 0:n.closest)==null?void 0:r.call(n,"[data-event-id]"),n&&this.eventStore.getById(n.dataset.eventId)}getResourceRecord(t){let r=t instanceof Event?t.target:t;return r=(r==null?void 0:r.closest("[data-resource-id]"))||null,r&&this.resourceStore.getById(r.dataset.resourceId)}resolveEventRecord(t){return this.getEventRecord(t)}getDateFromElement(t,r=null,n=!1){var s;let a=t==null?void 0:t.closest("[data-date],[data-header-date],[data-month-date]");if(a){const l=a.dataset.date||a.dataset.headerDate||a.dataset.monthDate;return n?l:(r||(this.isDayView?this.dayTime:C)).parseKey(l)}if(a=t==null?void 0:t.closest("[data-week]"),a)return(s=this.month)==null?void 0:s.getWeekStart(a.dataset.week.split(",").map(Number))}getDateFromDomEvent(t){return this.getDateFromElement(E.getEventElement(t))}getDateFromPosition(){return null}dateKey(t){return C.makeKey(t)}getDayElement(t,r){return typeof t!="string"&&(t=this.dateKey(t)),this.eventContentElement.querySelector(`[data-date="${t}"]`)}getDayElementFromX(t){const r=this.eventContentElement.querySelectorAll("[data-date]");for(let n,s,a=0,{length:l}=r;a<l;a++)if(n=(s=r[a]).getBoundingClientRect(),t>=n.x&&t<=n.x+n.width)return s;return r[0]}getEventElement(t,r=Math.max(t.startDate,this.firstVisibleDate||this.startDate)){var n;const s=this,a=(n=s.calendar)==null?void 0:n.navigator.activeItem,l=s.getDateFromElement(a),o=s.eventStore.modelClass.asId(t);if(document.contains(a)&&(a==null?void 0:a.dataset.eventId)===String(o)&&l&&!(r-l))return a;if(r){const d=s.getDayElement(r);if(d)return E.down(d,`[data-event-id="${o}"]`)}return s.getEventElements(t)[0]}getEventElements(t){const r=this.eventStore.modelClass.asId(t);return this.eventContentElement.querySelectorAll(`[data-event-id="${r}"]`)}onEventMouseOverOut(t){const r=this,{currentOverEventEl:n}=r,s=t.type==="mouseout",a=t[s?"relatedTarget":"target"],l=(a==null?void 0:a.closest(".b-cal-event-wrap"))||null;if(l!==(n||null))return s?(r.currentOverEventEl=null,n&&Object.defineProperty(t,"target",{configurable:!0,get:()=>n}),r.onCalendarPointerInteraction(t)):(r.currentOverEventEl=l,r.onCalendarPointerInteraction(t))}onEventMouseEnterLeave(t){if(t.target.classList.contains("b-cal-event"))return this.onCalendarPointerInteraction(t)}calendarHitTest(t){const r=this,{monthSelector:n}=r,s=r.getDateFromDomEvent(t),a=E.getEventElement(t);let l=null,o,d;if((o=a.closest(".b-cal-event-wrap"))&&(d=r.eventStore.getById(o.dataset.eventId)))l={type:"event",eventElement:o,eventRecord:d};else if(o=a.closest(r.dayNameSelector))l={type:"dayNumber",dayNumberElement:o};else if(o=a.closest(".b-week-num,.b-week-number-cell")){const c=a.closest(".b-calendar-week");c&&c.dataset.week&&(l={type:"weekNumber",week:c.dataset.week.split(",").map(Number),weekNumberElement:o,weekElement:c})}else n&&a.closest(n)&&(l={type:"monthName",month:s.getMonth(),date:s});return l||((o=a.closest(".b-cal-cell-overflow"))?l={type:"cellOverflow",cellOverflowElement:o}:s&&(l={type:"schedule"})),l&&(l.resource=r.getResourceRecord(t),l.cell=a.closest(".b-calendar-cell"),l.date=s,l.view=r),l}onCalendarPointerInteraction(t){const r=this,{monthSelector:n}=r,{target:s}=t,a=!!s.closest(".b-overflowpopup"),l=fL[t.type],o=s.closest(".b-cal-event-wrap"),d=o?r.eventStore.getById(o.dataset.eventId):r.getEventRecord(s),c=!a&&r.isDayCellRenderer&&(d==null?void 0:d.isInterDay),u=!t.key&&c?r.getDateFromXY([t.clientX,t.clientY]):r.getDateFromDomEvent(t),h=o||d&&r.getEventElement(d,u),g=s.closest("[data-resource-id]"),f=g&&r.resourceStore.getById(g.dataset.resourceId);let m;if(f&&(m=r.trigger(`resource${l}`,{domEvent:t,date:u,eventElement:h,eventRecord:d,resourceRecord:f,fromOverflowPopup:a})),s.closest(r.dayNameSelector)&&(m=r.trigger(`dayNumber${l}`,{domEvent:t,date:u,cellData:r.cellMap.get(u)||r.createCellData(u),resourceRecord:f,fromOverflowPopup:a}),m===!1))return m;if(!(!a&&!r.eventContentElement.contains(s))){if(m!==!1&&d){const p=r.trigger(`event${l}`,{domEvent:t,date:u,eventElement:h,eventRecord:d,resourceRecord:f,fromOverflowPopup:a});p&&(m=p)}if(d)return m;if(s.closest(".b-week-num,.b-week-number-cell")){const p=t.target.closest("[data-week]");if(p)return r.trigger(`weekNumber${l}`,{domEvent:t,week:p.dataset.week.split(",").map(Number),date:r.getDateFromElement(p.querySelector(".b-calendar-cell")),fromOverflowPopup:a})}if(n&&s.closest(n))return r.trigger(`monthName${l}`,{domEvent:t,month:u.getMonth(),date:u,fromOverflowPopup:a});if(!(s.closest(".b-cal-cell-overflow")&&r.trigger(`cellOverflow${l}`,{domEvent:t,date:u,fromOverflowPopup:a,resourceRecord:f})!==!1))return u&&r.dayCellCls&&t.target.closest(`.${r.dayCellCls}`)&&(m=r.trigger(`schedule${l}`,{domEvent:t,date:u,fromOverflowPopup:a,resourceRecord:f}),m===!1)||r.checkAutoCreateGesture(t,r.getDateFromDomEvent(t,!0),f||void 0),m}}undoRedoDataChange(t){var r,n,s;if((r=this.calendar)!=null&&r.enableUndoRedoKeys)return(s=(n=this.project)==null?void 0:n.stm)==null?void 0:s.onUndoKeyPress(t)}onCalendarKeyDown(t){this.onCalendarPointerInteraction(t)}isAllDayEvent(t){return t.allDay||(t.isScheduled&&this.dayTime?this.dayTime.isInterDay(t):t.isInterDay)}sortEvents(t){t.sort(this.eventSorter)}preProcessCurrentConfigs(t){super.preProcessCurrentConfigs(t),delete t.calendar,delete t.project}getCurrentConfig(t){const r=super.getCurrentConfig(t);return delete r.project,r}},y(e,"$name","CalendarMixin"),e},yg=class extends Array{constructor(){super(...arguments),y(this,"firstFreeSlot",0)}set(i,e){const t=this;if(i==null)return t.add(e);if(t[i]=e,t.firstFreeSlot===i)for(;t[t.firstFreeSlot];)t.firstFreeSlot++}add(i){const e=this.firstFreeSlot;for(this[e]=i;this[this.firstFreeSlot];)this.firstFreeSlot++;return e}setEvents(i){const e=this.length=this.firstFreeSlot=i.length;for(let t=0;t<e;t++)this[t]=i[t]}};yg._$name="EventSlots";var pL=({key:i},{key:e})=>i<e?-1:e<i?1:0,vL=i=>i.endDate||C.add(i.startDate,i.duration,i.durationUnit),lo=i=>{var e;return e=class extends(i||$){get dayTime(){return Me.MIDNIGHT}get cellMonth(){return this._cellMonth||(this._cellMonth=new _i({}))}changeEventFilter(t){if(typeof t=="string"){const{handler:r,thisObj:n}=this.resolveCallback(t);t=r.bind(n)}return t}updateStackMultiDayEvents(){this.whenVisible("refresh")}createCellMap(t={}){const r=this,{filter:n,skipPropagate:s}=t,{eventFilter:a,cellMonth:l,lastVisibleDate:o}=r,d=t.cellMap||r._cellMap||(r._cellMap=new yL);r.stackMultiDayEvents&&(r.eventSorter=jc.defaultSorterFn),o&&o.setDate(o.getDate()+1);let c=t.startDate||r.firstVisibleDate||r.startDate,u=t.endDate||o||r.endDate;if(l.configure({weekBase:null,weekStartDay:r.weekStartDay,nonWorkingDays:r.nonWorkingDays,hideNonWorkingDays:r.hideNonWorkingDays,sixWeeks:r.sixWeeks,date:c}),r.eventStore){t=T.assign({dayTime:Me.MIDNIGHT},t,{filter:n&&a?h=>n(h)&&a(h):n||a,dateMap:d,startDate:c,endDate:u}),r.collectEvents(t),c=t.startDate,u=t.endDate;for(const h of[...d.keys()]){let g=0;const f=t.dayTime,m=f.dayOfDate(C.parseKey(h)),p=r.createCellData(m),v={events:d.get(h),date:m};r.sortEvents(v.events,m),r.trigger("dayCellPopulated",v);const b=v.events;if(t.rawEvents?(g=Math.min(u,Math.max.apply(Math,b.map(vL))),p.events=b):p.events=b.map(w=>{const D=w.endingDate,S=D>p.tomorrow,x={isAllDay:r.isAllDayEvent(w),isOverflow:w.startDate<p.date&&m-c,eventRecord:w,eventEndDate:D,overflows:S,date:m};return s||(g=Math.min(u,Math.max(g,D)),S&&(x.propagateEndDate=r.calculatePropagateEndDate(x,u))),x}),!s)for(;m<g;m.setDate(m.getDate()+1)){const w=f.dateKey(m);d.has(w)||d.set(w,r.createCellData(m))}d.set(h,p)}if(d.size){const h=[...d.values()].sort(pL);let g;d.clear(),h.forEach(f=>{d.set(f.key,f),g&&(g.nextEvents=f,f.previousEvents=g),g=f}),s||r.propagateCellEvents(h[0],d)}}return d.populated=!0,r.trigger("cellMapPopulated",{cellMap:d}),d}calculatePropagateEndDate(t,r=this.endDate){const{eventEndDate:n}=t,s=this.dayTime.startOfDay(n);return t.propagateEndDate=new Date(Math.min(n>s?C.add(s,1,"day"):n,r)),this.trigger("eventPropagate",t),t.propagateEndDate}collectEvents(t){return this.eventStore.getEvents(t)}propagateCellEvents(t,r){var n;const s=this,{events:a,renderedEvents:l,previousEvents:o,nextEvents:d,date:c}=t,{stackMultiDayEvents:u}=s,h=s.getEventsPerCell(c),{length:g}=a;for(let m=0;m<g;m++){const p=a[m],{eventRecord:v,propagateEndDate:b,eventEndDate:w}=p;let D=l.add(p);if(p.overflows){let S=t.visible,x;for(let R=d;R&&R.date<b;R=R.nextEvents)(!R.columnIndex||u)&&(D=R.renderedEvents.firstFreeSlot),R.renderedEvents.set(D,x={eventRecord:v,eventEndDate:w,propagateEndDate:b,isAllDay:p.isAllDay,isOverflow:S,overflows:!0}),S=S||R.visible;x&&(x.overflows=!1)}}t.maxRow=l.length;const f=l[h-1];if(l.length===h)f!=null&&f.isOverflow&&(o!=null&&o.hasOverflow)&&(t.maxRow--,t.hasOverflow=!0);else if(l.length>h&&(t.maxRow=h-1,t.hasOverflow=!0,f!=null&&f.isOverflow&&!s.hiddenNonWorkingDays[t.day])){const m=((n=s.getWeekContext)==null?void 0:n.call(s,c).visibleWeekStart)||s.firstVisibleDate,p=C.clearTime(f.eventRecord.startDate).valueOf();let v=r.get(C.makeKey(new Date(Math.max(m,p))));for(;v.key!==t.key;)v.hasOverflow=!0,v.maxRow=h-1,v=v.nextEvents}d&&s.propagateCellEvents(d,r)}createCellData(t){return Object.assign(this.cellMonth.getCellData(t,this.month,this.dayTime),{view:this,events:[],resource:this.resource,renderedEvents:new yg})}},y(e,"$name","DayCellCollecter"),y(e,"configurable",{eventFilter:{$config:"lazy",value:null},stackMultiDayEvents:null}),e},yL=class extends Map{constructor(){super(...arguments),y(this,"populated",!1)}get(i,e){return super.get(C.makeKey(i),e)}set(i,e){return i=C.makeKey(i),this.has(i)||(this.generation=(this.generation||0)+1),super.set(i,e)}delete(i,e){return i=C.makeKey(i),this.has(i)&&this.generation++,super.delete(i,e)}has(i){return super.has(C.makeKey(i))}clear(){if(this.populated)return this.populated=!1,this.generation=(this.generation||0)+1,super.clear()}},ws=class extends ft{calendarHitTest(i){const e=E.getEventElement(i),t=e.closest(".b-cal-event-wrap");let r;return t&&(r=this.owner.eventStore.getById(t.dataset.eventId))?{eventRecord:r,type:"event",eventElement:t,view:this}:null}onPanelHeaderClick({event:i}){var e;i.target.closest(".b-header-title")?(e=this.owner)==null||e.trigger("dayNumberClick",{domEvent:i,date:this.activeDate,cellData:this.cellData,source:this.owner,fromOverflowPopup:!0}):super.onPanelHeaderClick(...arguments)}get focusElement(){var i,e;const t=E.getActiveElement(this);return this.element.contains(t)?t:((e=(i=this.eventList)==null?void 0:i.element)==null?void 0:e.firstElementChild)||super.focusElement}getDateFromPosition(){return this.activeDate}getEventElement(i){return this.contentElement.querySelector(`[data-event-id="${i.id}"]`)}showOverflow(i,e){var t;const r=this,n=r.activeDate=e.date;r.cellData=e,r.targetCell=i,e.resource&&(r.element.dataset.resourceId=e.resource.id),r.refresh(e),r.showBy(i),r.isVisible&&((t=r.owner)==null||t.trigger("showOverflowPopup",{cell:i,cellData:e,date:n,overflowPopup:r}))}onCalendarStoreChange(){const i=this;i.isVisible&&(i.cellData=i.owner.cellMap.get(C.makeKey(i.activeDate)),i.refresh(i.cellData))}refresh(i){if(!this.eventList)return;i?this.cellData=i:i=this.cellData;const e=this,{owner:t,eventRenderer:r,eventSorter:n}=e,{element:s}=e.eventList,a=e.onlyShowOverflow?Math.max(t.eventsPerCell-1,0):0,l=i==null?void 0:i.renderedEvents.slice(a),o=[];if(!(l!=null&&l.length)||!(i!=null&&i.hasOverflow)&&!t.isYearView)return e.hide();n&&l.sort(n);for(let d=0,c=0,{length:u}=l;d<u;d++,c++){const h=l[d];if(h){const g=t.createEventDomConfig(h,r);Object.assign(g.className,{"b-continues-past":h.eventRecord.startDate<i.date,"b-continues-future":h.eventRecord.endDate>i.tomorrow}),g.style.marginBottom=`${t.eventSpacing}px`,o.push(g)}}oe.sync({domConfig:{children:o},targetElement:s}),s.dataset.date=i.key,s.classList.add(`b-day-of-week-${i.day}`),s.classList.remove(`b-day-of-week-${e.lastRefreshDay}`),e.lastRefreshDay=i.day,e.realign()}changeItems(i){const{eventList:e}=this;e&&(i.eventList=e);const t=super.changeItems(i);return e&&(this.eventList=this.widgetMap.eventList),t}changeActiveDate(i,e){if(i=typeof date=="string"?C.parse(i):new Date(i),isNaN(i))throw new Error("OverflowPopup date ingestion must be passed a Date, or a YYYY-MM-DD date string");return i}updateActiveDate(i){this.element.dataset.date=C.makeKey(i),this.title=`<span tabIndex="0" role="link" aria-label="${C.format(i,"dddd, D MMMM")}">${C.format(i,this.dateFormat)}</span>`}onDocumentMouseDown({event:i}){var e;const t=(e=this.lastAlignSpec)==null?void 0:e.target,{target:r}=i;if(t!=null&&t.contains(r)){const n=r.closest(".b-cal-cell-overflow");if(r.closest(".b-cal-event-bar-container")||r.matches(".b-cal-cell-overflow")||(n==null?void 0:n.children.length)===1)return i.preventDefault()}super.onDocumentMouseDown(...arguments)}};y(ws,"$name","OverflowPopup"),y(ws,"type","overflowpopup"),y(ws,"configurable",{defaultFocus:".b-cal-event-wrap",textContent:!1,autoShow:!1,floating:!1,cls:"b-cal-event-list",closable:!0,draggable:{handleSelector:":not(.b-cal-event-wrap)"},anchor:!0,layout:"vbox",eventRenderer:null,eventSorter:null,eventList:{type:"widget",cls:"b-cal-event-bar-container",weight:500},items:{},tools:{maximize:null},dateFormat:"dddd, MMM DD",activeDate:{$config:{equal:"date"},value:null},scrollAction:"realign",align:{axisLock:"flexible",constrainPadding:20,minHeight:400},scrollable:{overflowY:"auto"},onlyShowOverflow:null}),ws.initClass(),ws._$name="OverflowPopup";var bL=()=>{},{eventNameMap:CL}=V,bg=i=>{var e;return e=class extends(i||$){static get configurable(){return{monitorResize:!0,dayCellRenderer:null,dynamicHideNonWorkingdayCls:"b-dynamic-nonworking-day",overflowPopup:{$config:["lazy","nullify"],value:{type:"overflowpopup"}},overflowPopupTrigger:"click",eventBarContainerCls:"b-cal-event-bar-container",overflowButtonRenderer:null,dayCellNameFormat:null,eventSpacing:2,emptyCellCls:"b-cal-empty-cell",emptyCellRenderer:null}}onCalendarStoreChange(){var t;super.onCalendarStoreChange(...arguments),(t=this._overflowPopup)!=null&&t.isVisible&&this._overflowPopup.onCalendarStoreChange(...arguments)}onCellOverflowGesture({domEvent:t,date:r}){const n=this,s=n.cellMap.get(C.makeKey(r));if(s){const{overflowPopup:a}=n,l=n.getCellFromEvent(t);a&&n.trigger("beforeShowOverflowPopup",{cell:l,cellData:s,date:r,overflowPopup:a})&&a.showOverflow(l,s)}}getCellFromEvent(t){return t.target.closest(".b-calendar-cell[data-date]")}changeOverflowPopupTrigger(t){return t=t.toLowerCase(),(t==="mouseover"||t==="hover")&&(t="mouseOver"),t}updateOverflowPopupTrigger(t,r){r&&(this[`onCellOverflow${O.capitalize(r)}`]=bL),this[`onCellOverflow${O.capitalize(t)}`]=this.onCellOverflowGesture}onEventMouseOverOut({target:t,relatedTarget:r,type:n}){var s;if(this.overflowPopupTrigger==="mouseOver"&&t.closest(".b-cal-cell-overflow")&&!r.closest(".b-cal-cell-overflow")){if(n==="mouseover")return this.onCalendarPointerInteraction(...arguments);(s=this._overflowPopup)==null||s.hide()}return this.onCalendarPointerInteraction(...arguments)}changeOverflowPopup(t,r){var n;const s=this,a=s.up("calendar")||s.owner||s,l=ws.reconfigure(r,t,{owner:s,defaults:{positioned:!(t!=null&&t.floating),owner:s,align:{constrainTo:((n=s.up("popup"))==null?void 0:n.contentElement)||globalThis}}});if(l){const{element:o}=l,{eventHeightInPixels:d}=s;l.element.classList.add(`b-${s.type}-overflowpopup`),l.positioned&&l.render(a.isCalendar?a.element:a.contentElement),d&&(o.style.setProperty("--event-height",`${d}px`),o.style.setProperty("--arrow-width",`${d/3}px`)),l!==r&&a!==s&&(V.on({thisObj:s,element:l.bodyElement,delegate:".b-cal-event-wrap",mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}),l.headerElement&&V.on({thisObj:s,element:l.headerElement,mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}))}return l}onInternalResize(t,r,n,s,a){const{_eventsPerCell:l,_eventContainerTop:o}=this;super.onInternalResize(t,r,n,s,a),this.rendered&&n!==a&&this.performResizeRefresh(l,o)}performResizeRefresh(t,r,n){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null;const s=this,{eventsPerCell:a,_overflowPopup:l}=s;a!==t&&s.trigger("eventsPerCellChange",{value:a,oldValue:t}),(s.eventContainerTop!==r||a!==t)&&(n?s.doRefresh():s.refresh(),l!=null&&l.isVisible&&l.refresh(s._cellMap.get(C.makeKey(l.activeDate))))}updateEventHeight(){super.updateEventHeight(...arguments),this._eventsPerCell=null,this.element.style.setProperty("--event-height-px",`${this.eventHeightInPixels}px`)}updateEventSpacing(t){this._eventsPerCell=null,this.isConfiguring||this.refreshSoon(),this.element.style.setProperty("--event-spacing",`${t}px`)}get weeksElement(){return this.contentElement}get eventContainerHeight(){if(this._eventContainerHeight==null&&this.isVisible&&!this.isConfiguring){const{firstVisibleCell:t}=this;this._eventContainerHeight=t?t.offsetHeight-this.eventContainerTop:NaN}return this._eventContainerHeight}get eventContainerTop(){const t=this;if(t._eventContainerTop==null&&t.isVisible&&!t.isConfiguring){const{firstVisibleCell:r}=t,n=r&&r.querySelector(".b-cal-cell-header"),s=n?n.getBoundingClientRect().height:0;t._eventContainerTop=s===0?null:s,t.element.style.setProperty("--event-top",`${t._eventContainerTop}px`)}return t._eventContainerTop||0}getEventsPerCell(t){return this.eventsPerCell}get eventsPerCell(){const t=this;return t._eventsPerCell==null&&(t._eventsPerCell=Math.floor((t.eventContainerHeight+t.eventSpacing)/(t.eventHeightInPixels+t.eventSpacing))),t._eventsPerCell}get cellMap(){var t;return(t=this._cellMap)!=null&&t.populated?this._cellMap:this.createCellMap()}cellRenderer({cell:t}){const r=this.getCellDomConfig(...arguments);oe.sync({domConfig:r,targetElement:t})}getCellDomConfig({cell:t,columnIndex:r,row:n,date:s,day:a,dayTime:l=Me.MIDNIGHT,visibleColumnIndex:o,key:d}){var c,u;let h,g=!this.isConfiguring&&this.cellMap.get(C.makeKey(s));const f=this,{isMonthView:m,eventHeightInPixels:p,eventSpacing:v,weekLength:b,todayCls:w,emptyCellRenderer:D,dayCellNameFormat:S,resource:x}=f,R={tabIndex:m?0:-1,role:m?"link":"columnheader","aria-label":`${C.format(s,"dddd Do MMMM")}${x?` ${x.name}`:""}.`,dataset:{headerDate:d}},M=f.dayTime.startOfDay(((c=f.calendar)==null?void 0:c.dateTimeNow)||new Date),_=s.getTime()===M.getTime(),k=s.getDate(),F={className:f.eventBarContainerCls,role:"presentation",children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}},I={style:{},className:new te({"b-cal-cell-header":!0,[w]:_})},A={tabIndex:-1,role:"gridcell","aria-label":`${C.format(s,"dddd Do MMMM")}${x?` ${x.name}`:""},  ${f.L("eventCount",((u=(g==null?void 0:g.renderedEvents)||(g==null?void 0:g.events))==null?void 0:u.length)||0)}.`,dataset:{},style:{},className:new te(t==null?void 0:t.className),children:[I,F]},P=!(s-(f.firstVisibleDate||-1));A.className[w]=_,f.addCellHeaderContent?h=f.addCellHeaderContent(I,g||(g=f.createCellData(s))):I.children=[h={className:{"b-day-name":!0}}],Object.assign(m?h:I,R);let H;if(f.dayCellRenderer&&!f.isConfiguring){g||(g=f.createCellData(s)),g.style=A.style,g.cls=A.className,g.headerStyle=I.style,g.headerCls=I.className;const G=g&&g.isNonWorking,q=f.callback(f.dayCellRenderer,f,[g,A]);typeof g.cls=="string"&&(A.className=new te(g.cls)),typeof g.style=="string"&&(A.style=E.parseStyle(g.style)),typeof g.headerCls=="string"&&(I.className=new te(g.headerCls)),typeof g.headerStyle=="string"&&(I.style=E.parseStyle(g.headerStyle)),q!=null&&(typeof q=="string"?h.html=q:(h.text=null,h.children=B.asArray(q))),H=!G&&g.isNonWorking}if(h&&(h.text||h.html||(S?h.html=C.format(s,f.dayCellNameFormat):h.text=k),k===1&&(h.dataset={startOf:C.format(s,"MMM")}),String(h.text||h.html).endsWith(k)&&(h.className["b-day-num"]=!0)),g.visible){const{hasOverflow:G,renderedEvents:q,maxRow:W}=g,{stackMultiDayEvents:j}=f,se=q,{length:J}=se,Q=F.children;A.className[f.nonWorkingDayCls]=g.isNonWorking,A.className[f.dynamicHideNonWorkingdayCls]=H,A.className[f.weekendCls]=C.weekends[a];let X=0,ee=0,ce=0;for(;X<W;X++,ee++){const Ie=se[X];if(Ie){const{eventRecord:ue,isOverflow:Ne,propagateEndDate:ye}=Ie,Ee=Ie.eventEndDate||ue.endingDate,Ye=Math.max(1,f.getDaySpan(s,ye||Ee,l)),xe=f.getDaySpan(s,Ee,l,!0),he=b-o,st=!j&&o&&Ne,Do=E.percentify(T.round((st||j?1:Math.min(Ye,he))/b*100,4)),fn=f.createEventDomConfig(Ie);Object.assign(fn.style,{width:Do,top:`${ee*p+ee*v+f.eventContainerTop}px`}),Object.assign(fn.className,{"b-overflow":st,"b-continues-past":!st&&(!o||j||P)&&ue.startDate<s,"b-continues-future":!st&&(xe>he||xe>Ye||j&&xe>1)}),Q.push(fn)}}for(;X<J;)se[X++]&&ce++;if(G?(n.classList.add("b-has-overflow"),A.children.push(f.getOverflowButtonDomConfig(ce))):r||n.classList.remove("b-has-overflow"),(A.className[f.emptyCellCls]=!se.length)&&D){const Ie=typeof D,ue=Ie==="function"||Ie==="string"?f.resolveCallback(D,f,!1):null;(ue!=null&&ue.handler?ue.handler.call(ue.thisObj,g):D)&&(F.children[0]={tag:"button",class:"b-cal-cell-no-content",children:[ue!=null&&ue.handler?ue.handler.call(ue.thisObj,g):D]})}}return A}onCalendarPointerInteraction(t){const r=this,{target:n}=t;return n.closest(`.${r.emptyCellCls} .${r.eventBarContainerCls}`)&&(!r.emptyCellRenderer||n.closest(".b-cal-cell-no-content"))&&r.trigger(`emptyCell${CL[t.type]}`,{date:r.getDateFromDomEvent(t),domEvent:t})===!1?!1:super.onCalendarPointerInteraction(t)}getDaySpan(t,r,n,s){if(this.hideNonWorkingDays&&!s){let a=0;for(const l=new Date(t),o=n.ceil(r,"1 day");l<o;l.setDate(l.getDate()+1))this.nonWorkingDays[l.getDay()]||a++;return a}else return Math.max(C.diff(t,n.ceil(r,"1 day"),"day"),1)}getOverflowButtonDomConfig(t){const{overflowButtonRenderer:r}=this,n={tag:"button","aria-label":`${this.L("L{Calendar.moreEvents}",t)}.`,className:{"b-cal-cell-overflow":1},text:this.L("L{Calendar.plusMore}",t),style:{},dataset:{eventId:"overflow"}};return r?this.callback(r,this,[n,t]):n}getCell(t){return typeof t!="string"&&(t=this.dayTime.dateKey(t)),this.contentElement.querySelector(`[data-date="${t}"]`)}getCellOverflowButton(t){var r;return(r=this.getCell(t))==null?void 0:r.querySelector(".b-cal-cell-overflow")}},y(e,"$name","DayCellRenderer"),e},wL={day:1,week:1,month:1,year:1,decade:1},Z0=(i,e)=>i&&e?i.unit===e.unit&&i.magnitude===e.magnitude:i===e,Cg=i=>{var e;return e=class extends(i||$){previous(){this.move(-1)}next(){this.move(1)}move(t=1){t=Math.sign(t);const r=this,{shiftIncrement:n,range:s}=r;s?n&&(r.isShifting=!0,r.date=C.add(r.date,{unit:n.unit,magnitude:t*n.magnitude}),r.isShifting=!1):r.startDate=C.add(r.startDate,t*r.duration,"day")}changeDate(t,r){if(t=super.changeDate(t||this.startDate,r),this.isConfiguring||this.isValidRange(this.range,t))return t}updateDate(t){var r;const n=this,s=n.changeStartDate(t),{startDate:a,_month:l}=n,o=l==null?void 0:l.generation;if(!a||s-a)if(n.hasConfig("endDate")||n.range.unit==="day"){const{endDate:d,duration:c}=n,u=n.isEventList&&!n.range?"betweenLesserEqual":"betweenLesser";(!n.isConfiguring||!a||!C[u](t,a,d))&&(!a||!d||t<a?n.startDate=t:(n.isEventList?t>d:t>=d)&&(n.startDate=C.add(t,-(c-1),"day")))}else n.startDate=C.floor(t,n.isShifting?n.shiftIncrement:n.range,n.startDate,n.weekStartDay);l&&l.generation===o?l.date=t:!n.isConfiguring&&n.scrollToDateOnDateChange!==!1&&n.whenVisible("scrollTo",n,[t]),(r=super.updateDate)==null||r.call(this,...arguments)}changeStartDate(t,r){const n=this;return t=super.changeStartDate(n.snapDate(n.ingestDate(t)),r),r&&!(r-t)&&n.afterStartDateSet(t,r),t}updateStartDate(t,r){var n;const s=this,{_month:a}=s;s.hasConfig("date")||s.date||(s.date=t),a&&(a.date=t),(n=super.updateStartDate)==null||n.call(this,...arguments),s.afterStartDateSet(t,r)}afterStartDateSet(t,r){var n;const s=this,{refreshCount:a,_endDate:l}=s,o=s.peekEndDate(),d=o&&l&&!(o-l);if(s.hasConfig("endDate")&&(!o||s.isConfiguring)){const c=C.diff(r||t,s.endDate,"day");s.endDate=C.add(t,c,"day")}!s.isConfiguring&&(!o||d)&&s.refreshCount===a&&((n=s._cellMap)==null||n.clear(),s.refresh(),s.triggerRangeChange(t,s.endDate))}peekEndDate(){const t=this.peekConfig("endDate");if(t)return this.changeEndDate(t)}updateEndDate(t){var r,n;const s=this,{duration:a}=s;(r=super.updateEndDate)==null||r.call(this,...arguments),s.isConfiguring||(s.element.style.setProperty("--range-magnitude",a),s.element.dataset.duration=a,(n=s._cellMap)==null||n.clear(),s.refresh(),s.triggerRangeChange(s.startDate,t))}triggerRangeChange(t,r){const n=this,{lastRangeAnnounced:s}=n;(!s||s.startDate-t||s.endDate-r)&&(n.peekConfig("date")||(n.date=C.constrain(n.date,t,C.add(r,n.isEventList&&!n.range?0:-1,"d"))),n.trigger("rangeChange",{old:s,new:n.lastRangeAnnounced={startDate:t,endDate:r}}))}get range(){return this.hasConfig("endDate")?null:this._range}get shiftIncrement(){if(this._shiftIncrement!==null)return this._shiftIncrement||this.range||{magnitude:this.duration,unit:"day"}}get stepUnit(){const{shiftIncrement:t}=this;if(t)return t.magnitude===1?C.getLocalizedNameOfUnit(t.unit):`${t.magnitude} ${C.getLocalizedNameOfUnit(t.unit,!0)}`}get endDate(){const t=this;return t.hasConfig("endDate")?t._endDate:t.startDate&&C.add(t.startDate,t.range.magnitude,t.range.unit)}snapDate(t,r){const n=this,s=n._endDate||n.peekEndDate()?null:n.range;return s&&s.unit!=="day"&&t?C[r?"ceil":"floor"](t,s,void 0,n.weekStartDay):t}parseRange(t){if(t){if(typeof t=="string"){const r=C.parseTimeUnit(t);r?t={magnitude:1,unit:r}:t=C.parseDuration(t)}else{if(typeof t=="number")return{magnitude:t,unit:"day"};t.unit=C.parseTimeUnit(t.unit)}if(!wL[t.unit])throw new Error("Range must be in days, weeks, months, years or decades")}return t}changeRange(t){if(!(t&&!this.hasConfig("endDate")&&(t=this.parseRange(t),this._date&&!this.isValidRange(t))))return t}changeShiftIncrement(t){return this.changeRange(t)}updateShiftIncrement(t,r){this.trigger("shiftIncrementChange",{old:t,new:r})}isValidRange(t,r=this.date){var n,s;const a=this.minDate||((n=this.calendar)==null?void 0:n.minDate),l=this.maxDate||((s=this.calendar)==null?void 0:s.maxDate);if(t&&!isNaN(a)||!isNaN(l)){const o=this.calculateDateRange(t,r);if(!isNaN(a)&&o.endDate<=a||!isNaN(l)&&o.startDate>l)return!1}return!0}updateRange(t){const r=this,{date:n,_startDate:s}=r,a=()=>{const{duration:l}=r;r.element.style.setProperty("--range-magnitude",l),r.element.dataset.duration=l};t&&n&&!r.hasConfig("endDate")&&(!s||s-n?r.startDate=n:r.updateStartDate(r._startDate=r.snapDate(s),s)),r.isConfiguring?r.whenVisible(a):a()}calculateDateRange(t,r){if(r)return t.unit!=="day"?{startDate:C.floor(r,t,void 0,this.weekStartDay),endDate:C.ceil(C.add(r,1,"day"),t,void 0,this.weekStartDay)}:{startDate:r,endDate:C.add(r,t.magnitude,"day")}}changeMonth(t){const r=this,{date:n}=r;return super.changeMonth?super.changeMonth(...arguments):(t!=null&&t.isMonth||(t=new _i({date:n,weekStartDay:r.weekStartDay,hideNonWorkingDays:r.hideNonWorkingDays,nonWorkingDays:r.nonWorkingDays}),r.nonWorkingDays==null&&(r.nonWorkingDays=t.nonWorkingDays),r.weekStartDay==null&&(r.weekStartDay=t.weekStartDay)),t)}get dateBounds(){return[this.startDate,this.lastDate]}getDuration(t=this.startDate){const{range:r}=this;return r?t?C.diff(t,C.add(t,r.magnitude,r.unit),"d"):C.as("d",r.magnitude,r.unit):C.diff(t,this.peekEndDate()||this._endDate,"day")}get duration(){return this.getDuration()}get lastDate(){const t=this.endDate;return t&&C.add(t,-1,"day")}},y(e,"$name","DateRangeOwner"),y(e,"configurable",{month:!0,date:{$config:{equal:"date"},value:null},range:{$config:{lazy:!0,equal:Z0},value:null},shiftIncrement:{$config:{lazy:!0,equal:Z0},value:null},startDate:{$config:{equal:"date"}},endDate:{$config:{equal:"date"}}}),e},SL=Object.freeze({}),DL={shrinkwrap:1,expand:1},J0=(i,e,t,r,n)=>{const s=C.format(t,i);return r?`${s}${n?e.trim():e}${C.format(r,i).slice(n?-1:0)}`:s},Vi=class extends z.mixin(gr,lo,bg,Cg){constructor(){super(...arguments),y(this,"heightAnimation",Promise.resolve)}static get configurable(){return{cls:"b-calendar-days",dragUnit:"day",animate:!0,autoHeight:null,autoRefresh:["dayNameFormat","dayNumberCompress","dayNumberFormat","daySeparator","hideEmptyDays","dateFilter"],descriptionFormat:[!0,!0],dayStartShift:null,dayTime:0,defaultEventRowCount:3,fullWeek:null,minDayWidth:null,scrollable:{overflowX:"hidden",overflowY:"hidden",propagateSync:!0},headerScroller:{$config:["lazy","nullify"],value:{overflowX:"hidden",overflowY:"hidden",propagateSync:!0}},dayNameFormat:"ddd",dayNumberCompress:null,dayNumberFormat:"D",daySeparator:"-",responsive:{small:{dayNameFormat:"d1",dayNumberCompress:!0,daySeparator:"/"},"*":{dayNameFormat:"ddd",dayNumberCompress:!1,daySeparator:"-"}},dayNameSelector:".b-cal-cell-header",monitorResize:!1,gutterHeight:null,expanded:null,overflowClickAction:"popup",dayHeaderRenderer:null,hideEmptyDays:null,dateFilter:null}}compose(){return{children:{headerElement:{className:"b-calendarrow-header",children:{headerCellContainer:{role:"row",className:"b-calendarrow-header-container"},scrollPadElement:{...E.scrollBarPadElement}}},bodyElement:{className:"b-calendarrow-body",children:{cellContainer:{role:"row",reference:"cellContainer",className:"b-calendarrow-cell-container"}}}}}}onInternalPaint({firstPaint:i}){if(i){const e=this,{fonts:t}=document,r=()=>{e._eventContainerTop=e._eventContainerHeight=null,e.eventStore.count&&e.performResizeRefresh(null,null,!0)};(t==null?void 0:t.status)!=="loaded"&&t.ready.then(()=>!e.isDestroyed&&r()),r()}}changeDaySeparator(i){return Array.isArray(i)?i:[i,i]}changeElement(){const i=super.changeElement(...arguments);return this.scrollable.addPartner(this.headerScroller,"x"),i}changeHeaderScroller(i,e){return i?i=At.new({_id:`${this.id}-header-scroller`,element:this.headerCellContainer,widget:this},i):e==null||e.destroy(),i}async scrollTo(i){const e=this,{eventFilter:t}=e;return i.isEvent&&(!t||t(i))&&C.intersectSpans(e.startDate,e.endDate,i.startDate,i.endDate)&&(e.getEventElement(i)||e.expanded||e.autoHeight||e.toggleExpandCollapse()),super.scrollTo(...arguments)}updateDate(i,e){var t;const r=this;let n=e&&r.getDayHeader(e);n==null||n.classList.remove("b-selected-date"),(t=super.updateDate)==null||t.call(this,i,e),n=i&&r.getDayHeader(i),n==null||n.classList.add("b-selected-date")}getDayHeader(i){return typeof i!="string"&&(i=this.dateKey(i)),this.headerCellContainer.querySelector(`.b-cal-cell-header[data-header-date="${i}"]`)}get overflowElement(){return this.bodyElement}get maxHeightElement(){var i;return((i=this.owner)==null?void 0:i.alldayRowElement)||super.maxHeightElement}createCellMap(i={}){const e=this,t=e.hideNonWorkingDays?e.nonWorkingDays:SL,{maxEventCount:r}=e,n=T.assign({dayTime:e.dayTime,getDateIndex:d=>Number(d)===Number(e.firstVisibleDate||e.startDate)?"date":"startDate"},i),s=super.createCellMap(n),{owner:a}=e;let l=0,o;return s.forEach(d=>{t[d.day]||(o=d),l=Math.max(l,d.renderedEvents.length)}),e.maxEventCount=l,l!==r?(s.clear(),e.createCellMap(n)):(o&&(o.isRowEnd=!0),a==null||a.element.classList.toggle("b-has-allday-events",!!s.size),s)}collectEvents(i){return i=T.assign({dayTime:this.dayTime},i,{getDateIndex:e=>Number(e)===Number(this.firstVisibleDate||this.startDate)?"date":"startDate"}),super.collectEvents(i)}createCellData(i){const e=this,t=C.diff(e.startDate,i,"day"),r=t;return Object.assign(super.createCellData(i),{visibleColumnIndex:r,columnIndex:t,isRowStart:r===0,isRowEnd:!1,renderedEvents:new yg})}get dayStartShift(){var i,e;return(e=(i=this.dayTime)==null?void 0:i.startShift)!=null?e:this._dayStartShift}updateDayStartShift(i){this.element.classList.toggle("b-shifted-day",!!i),this.dayTime=new Me(i)}changeDayTime(i){var e;if(i||(i=new Me(this.dayStartShift)),i.isDayTime||(i=new Me(i)),!((e=this._dayTime)!=null&&e.equals(i)))return i}dayOfDate(i){return this.dayTime.dayOfDate(i)}updateMinDayWidth(i){const{style:e}=this.element;e.setProperty("--min-day-width",i?E.setLength(i):0),e.setProperty("--cell-container-overflow",i?"visible":"hidden"),this.afterUpdateMinDayWidth()}afterUpdateMinDayWidth(){const{headerScroller:i,minDayWidth:e,scrollable:t}=this,{element:r}=t;e&&r.scrollWidth>r.clientWidth?t.overflowX=i.overflowX="hidden-scroll":t.overflowX=i.overflowX=!1}updateEventHeight(){super.updateEventHeight(...arguments),!this.autoHeight&&!this.isConfiguring&&!this.expanded&&this.setEventContentHeight(this.cellContentHeight)}updateGutterHeight(){this.isConfiguring||this.setEventContentHeight(this.cellContentHeight)}updateNonWorkingDays(){this.onVisibleDateRangeChange()}updateHideNonWorkingDays(){super.updateHideNonWorkingDays(...arguments),this.onVisibleDateRangeChange()}onCellOverflowGesture({date:i}){DL[this.overflowClickAction.toLowerCase()]?this.expanded=!0:super.onCellOverflowGesture(...arguments)}onVisibleDateRangeChange(){var i;this.isConfiguring||((i=this._cellMap)==null||i.clear(),this.refresh())}changeAutoHeight(i){const e=this,{eventsPerCell:t}=e;e._autoHeight=i,e.setEventContentHeight(e.cellContentHeight),e.isConfiguring||e.performResizeRefresh(t,e.eventContainerTop,!0)}async setEventContentHeight(i,e){var t,r,n;const s=this,{cellContainer:a,parent:l}=s;if(s._eventContentHeight!==i){if(!e&&(l!=null&&l.isDayView)&&((t=l.parent)!=null&&t.isResourceView)){const u=l.parent.items.map(h=>h.allDayEvents).filter(h=>h&&h!==s);i=Math.max(i||0,...u.filter(h=>!h.owner.isResourceDayViewTimeAxis).map(h=>h.calculateCellContentHeight()||0)),u==null||u.forEach(h=>{h.setEventContentHeight(i,!0)})}const{height:o}=s;let{animate:d}=s;s.isAnimating=d;const c=E.getPropertyTransitionDuration(a,"height");if(c||(s.isAnimating=d=!1),a.style.height=`${i||1}px`,s.bodyElement.classList.toggle("b-zero-height",!i),d&&await(s.heightAnimation=V.waitForTransitionEnd({property:"height",element:a,duration:c})),!s.isDestroyed){const{height:u}=s;s.isAnimating=!1,s._eventContentHeight=i,(n=(r=s.owner)==null?void 0:r.syncScrollbarPadding)==null||n.call(r),u!==o&&s.trigger("heightChange",{height:u,oldHeight:o})}}}get hasOverflow(){return!this.autoHeight&&this.maxEventCount>this.defaultEventRowCount}get eventsPerCell(){const i=this,{maxEventCount:e}=i;return i.expanded||i.autoHeight?e:Math.min(e,i.defaultEventRowCount)}get cellContentHeight(){var i;return((i=this.owner)==null?void 0:i.showAllDayHeader)===!1?0:this.calculateCellContentHeight()}calculateCellContentHeight(){const i=this,{gutterHeight:e}=i;let t=Math.ceil(i.eventContainerTop+i.eventsPerCell*(i.eventHeightInPixels+i.eventSpacing));return e&&(i.eventsPerCell&&(t-=i.eventSpacing),isNaN(e)?t=`calc(${t}px + ${e})`:t+=Number(e)),t}getDateFromPosition(i,e,t=!1,r){const n=this,{eventContentElement:s}=n,a=s.getBoundingClientRect(),l=n.rtl?a.right-i:i-a.left,o=s.scrollWidth,d=n.getDayElementFromX(i);return l<0||o<l||e<a.top||a.bottom<e?null:n.getDateFromElement(d,r)}async toggleExpandCollapse(){const{expanded:i}=this;await this.updateExpanded(!i,i)}async updateExpanded(i,e){const t=this;t._expanded=e;const{eventsPerCell:r}=t;t._expanded=i,t.expanded?t.isVisible&&(t.performResizeRefresh(r,t.eventContainerTop,!0),await t.heightAnimation):(t.scrollable.overflowY="hidden",await t.setEventContentHeight(t.cellContentHeight),e&&!t.isDestroyed&&t.performResizeRefresh(r,t.eventContainerTop,!0))}get visibleDateHeaders(){const i=this;let e,t;if(i.fullWeek){for(e=i.month.getWeekStart(i.month.getWeekNumber(i.startDate));i.hiddenNonWorkingDays[e.getDay()];)e.setDate(e.getDate()+1);for(t=C.add(e,6,"d");i.hiddenNonWorkingDays[t.getDay()];)t.setDate(t.getDate()-1)}else e=i.firstVisibleDate,t=i.lastVisibleDate;return[e,t]}doRefresh(){var i,e,t;(i=this._cellMap)==null||i.clear();const r=this,{dayTime:n,fullWeek:s,startDate:a,endDate:l,headerCellContainer:o,cellContainer:d,dayHeaderRenderer:c,hiddenNonWorkingDays:u,hideEmptyDays:h,dateFilter:g,owner:f}=r,[m,p]=r.visibleDateHeaders,v=(a||l)&&r.cellMap,b=(e=r.nonWorkingDays)!=null?e:r.month.nonWorkingDays,w=[],D=[],S=[];if(!v)return;let x=0,R=0,M,_,k;for(const I=m;!(p<I);I.setDate(I.getDate()+1),x++){const A=v.get(n.dateKey(I))||r.createCellData(I),{day:P,key:H}=A,G=h&&(f?f.getEventsForDay(H,r.startDate):A.renderedEvents),q=h&&!(G!=null&&G.length)||g&&!r.callback(g,r,[A]);u[P]||q||(A.columnIndex=A.cellIndex=x++,A.isRowStart=R===0,A.visibleColumnIndex=R,s||R++,w.push(A))}r.weekLength=s?1:R;const F=w.length;for(_=0;_<F;_++){const I=w[_],{day:A,key:P}=I,H=b[A],G=`b-day-of-week-${A}`;M=!(I.date-((f==null?void 0:f.date)||r.date)),I.cell=r.getCell(P),I.row=r.cellContainer;const q=r.getCellDomConfig(I);if(q){const W=Z.merge({dataset:{headerDate:P}},q.children[0]);W.className["b-selected-date"]=M,W.className["b-current-date"]=s&&M,W.className[G]=1,c&&r.callback(c,r,[W,I]),q.dataset.date=P,Object.assign(q.className,{"b-dayview-allday":1,[r.nonWorkingDayCls]:H,[r.weekendCls]:C.weekends[A],[r.dayCellCls]:1,[G]:1}),q.children.shift(),S.push(W),(!s||M)&&(D.push(q),H||(k=q))}}k&&(k.className["b-last-working-day"]=1),oe.sync({targetElement:o,domConfig:{children:S,onlyChildren:!0,syncOptions:{releaseThreshold:0,strict:!0}}}),oe.sync({targetElement:d,domConfig:{children:D,onlyChildren:!0,syncOptions:{releaseThreshold:0,strict:!0}}}),r.refreshCount=(r.refreshCount||0)+1,r.collapseGutter(),r.setEventContentHeight(((t=this.owner)==null?void 0:t.showAllDayHeader)===!1?0:r.cellContentHeight),r.trigger("refresh")}get eventContainerTop(){return 0}async expandGutter(){const i=this;i._isTemporarilyExpanded||(i.gutterHeight=(i.gutterHeight||0)+i.eventHeightInPixels+i.eventSpacing,await i.setEventContentHeight(i.cellContentHeight),i._isTemporarilyExpanded=!0)}async collapseGutter(){const i=this;i._isTemporarilyExpanded&&(i.gutterHeight=i.gutterHeight-(i.eventHeightInPixels+i.eventSpacing),await i.setEventContentHeight(i.cellContentHeight),i._isTemporarilyExpanded=!1)}onCalendarKeyDown(i){var e,t,r,n;const{dayTime:s,element:a,owner:l}=this,{target:o}=i,d=`.${this.dayCellCls}`,c=o.closest(`.b-cal-cell-header,${d}`)||o,u=c.matches(".b-cal-cell-header"),h=c.matches(d),g=h?"date":"header-date",f=this.duration===1&&i.key==="ArrowDown"?s.dateKey(this.date):c.dataset[h?"date":"headerDate"],m=s.parseKey(f),p=u?".b-cal-cell-header":d;let v;switch(i.key){case"ArrowUp":h&&(i.preventDefault(),(e=a.querySelector(`.b-cal-cell-header[data-header-date="${f}"]`))==null||e.focus());break;case"ArrowDown":u&&E.isInView(v=a.querySelector(`${d}[data-date="${f}"]`))?(i.preventDefault(),v==null||v.focus()):l.isDayView&&(i.preventDefault(),(t=l.eventContentElement.querySelector(`.${l.dayCellCls}[data-date="${f}"]`))==null||t.focus());break;case"ArrowLeft":i.preventDefault(),(r=a.querySelector(`${p}[data-${g}="${s.dateKey(C.add(m,-1,"d"))}"]`))==null||r.focus();break;case"ArrowRight":i.preventDefault(),(n=a.querySelector(`${p}[data-${g}="${s.dateKey(C.add(m,1,"d"))}"]`))==null||n.focus();break;default:return super.onCalendarKeyDown(i)}}addCellHeaderContent(i,e){var t;const r=this,{resource:n}=r,{date:s,day:a,tomorrow:l}=e,{dayNameFormat:o,dayNumberCompress:d,daySeparator:c}=r,u=(t=r==null?void 0:r.dayTime)==null?void 0:t.startShift;i.children=[{className:`b-day-name-part b-day-name-day${d?" b-day-name-short":""}`,html:J0(o,c[0],s,u&&l)},{tabIndex:0,role:"link",className:"b-day-name-part b-day-name-date","aria-label":`${C.format(s,"dddd Do MMMM")}${n?` ${n.name}`:""}.`,html:J0(r.dayNumberFormat,c[1],s,u&&l,d)}],i.className[r.nonWorkingDayCls]=e.isNonWorking,i.className[r.weekendCls]=C.weekends[a]}updateLocalization(){this.isConfiguring||this.refresh(),super.updateLocalization()}updateFullWeek(){this.isConfiguring||this.refresh()}};y(Vi,"$name","CalendarRow"),y(Vi,"type","calendarrow"),y(Vi,"delayable",{afterUpdateMinDayWidth:{type:"raf",cancelOutstanding:!0}}),Vi.initClass(),Vi._$name="CalendarRow";var Ss=class extends Vi{afterConfigure(){var i;const e=this,{owner:t}=e;super.afterConfigure(),(i=t.scrollable)==null||i.ion({overflowChange:"onOwnerOverflowChange",thisObj:e}),t.descriptionRenderer=e.descriptionRenderer.bind(e),be.before(t,"updateDate",this.beforeOwnerDateUpdate,this)}beforeOwnerDateUpdate(i){this.isShifting=!0,this.date=i,this.isShifting=!1}onOwnerOverflowChange({y:i}){this.headerElement.classList.toggle("b-show-yscroll-padding",!!i)}onDayNumberClick({date:i}){return this.owner&&(this.owner.date=i),!1}scrollTo(){}descriptionRenderer(){const{startDate:i,endDate:e,owner:t}=this,r=i.getMonth(),n=e.getMonth(),s=r===n?C.format(i,"MMMM"):`${C.format(i,"MMM")} - ${C.format(e,"MMM")}`,a=t.month.getWeekNumber(i);return`${this.L("L{Object.Week}")} ${a[1]}, ${s} ${a[0]}`}};y(Ss,"$name","DaySelector"),y(Ss,"type","dayselector"),y(Ss,"configurable",{readOnly:!0,autoCreate:!1,flex:"0 0 auto",dock:"top"}),Ss.initClass(),Ss._$name="DaySelector";var lv=i=>{var e;return e=class extends(i||$){static get configurable(){return{daySelector:null}}changeDaySelector(t,r){const n=this;if(t){n.range="1 day",n.settings=null,n.hideHeaders=!0;const s=n.dayTime.shiftDate(n.month.getWeekStart(n.month.getWeekNumber(n.startDate))),a=Ss.reconfigure(r,t,{owner:n,defaults:{type:"dayselector",calendar:n.calendar,parent:n,cls:{[`b-${n.type}-dayselector`]:1},dayStartShift:n.dayStartShift,dayTime:n.dayTime,month:n.month,date:n.date,startDate:s,range:{magnitude:1,unit:"week"},shiftIncrement:{unit:"d",magnitude:n.duration},hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay}});return n.element.classList.add(`b-${n.type}-with-dayselector`),n.tbar=a,a}else r==null||r.destroy()}getCurrentConfig(t){const r=super.getCurrentConfig(t);return delete r.daySelector,r}},y(e,"$name","CalendarMixin"),e},EL=i=>i==null?void 0:i.eventStore,Ds=class extends li{construct(){super.construct(...arguments),this.ion({beforeShow:"syncRangeOptions",toggle:"syncViewRange",thisObj:this})}syncViewRange(i){if(i.checked){const{view:e}=this,{date:t}=e;e.range||(e._date=e._endDate=null),e.setConfig({range:i.item.range,date:t}),i.bubbles=!1}}syncRangeOptions(){const{view:i}=this,{range:e}=i;if(e){const{unit:t,magnitude:r}=e;for(const n of Object.values(this.items))if(n){const s={};n._unit===t?(s.checked=!0,s.range={unit:t,magnitude:r},s.text=r===1?O.capitalize(C.getLocalizedNameOfUnit(t)):C.formatDelta(s.range)):(s.checked=!1,s.text=O.capitalize(C.getLocalizedNameOfUnit(n._unit)),s.range=n._unit),n.setConfig(s)}}}changeItems(i){const e=this,t=e.view||(e.view=e.up(EL)),r=`${t.id}-range-items`;return Object.values(i).forEach(n=>{n&&(n.toggleGroup=r)}),super.changeItems(i)}updateView(i){i==null||i.scrollable.ion({overflowChange:()=>{var e;return(e=this.realign)==null?void 0:e.call(this)}})}};y(Ds,"$name","RangeMenu"),y(Ds,"type","rangemenu"),y(Ds,"configurable",{autoShow:!1,view:null,floating:!1,positioned:!0,anchor:!0,defaults:{checked:!1},items:{listRangeDayItem:{range:"day",text:"L{EventEdit.day}",_unit:"day"},listRangeWeekItem:{range:"week",text:"L{EventEdit.week}",_unit:"week"},listRangeMonthItem:{range:"month",text:"L{EventEdit.month}",_unit:"month"},listRangeYearItem:{range:"year",text:"L{EventEdit.year}",_unit:"year"},listRangeDecadeItem:{range:"decade",text:"L{EventEdit.decade}",_unit:"decade"}}}),Ds.initClass(),Ds._$name="RangeMenu";var xL=(i,e)=>i.startDate.valueOf()-e.startDate.valueOf(),RL=(i,e)=>{if(e)if(i=i.data||i,T.isObject(i)){const t=e.slice();for(const r in i){const n=i[r],s=t.findIndex(a=>a.id===r||a.field===r);if(n){const a=Re.merge(n,t[s]);a.id=r,t[s===-1?t.length:s]=a}else s>-1&&t.splice(s,1)}return t}else{e=new Bt({values:e,idProperty:"field"});for(let t=0,{length:r}=i;t<r;t++){const n=i[t],s=e.get(n.field);s&&(i[t]=Re.merge(n,s),e.remove(s))}return i.push(...e.values),i}else return i},fr=class extends as.mixin(gr,lo,lv,Cg){construct(...i){const e=this,t=T.getPropertyDescriptor(this,"features");Object.defineProperty(e,"features",{get:()=>t.get.call(this)||{},set:r=>{var n;r===!0&&(r={}),r.print||(r.print=!!((n=this.calendar)!=null&&n.features.print)),t.set.call(this,r)},configurable:!0}),super.construct(...i)}doRefresh(){this.refreshRows()}getEventElement(i,e=Math.max(i.startDate,this.firstVisibleDate||this.startDate)){return this.eventContentElement.querySelector(`.b-grid-row[data-event-id="${i.id}"][data-date="${C.makeKey(e)}"]`)||super.getEventElement(...arguments)}containsDate(i){const e=this.range?"betweenLesser":"betweenLesserEqual";return C[e](i,this.startDate,this.endDate)}eventListEventTimeRenderer(i,e){const t=this;let r;t.eventTimeRenderer?r=t.callback(t.eventTimeRenderer,t,arguments):r=t.defaultEventTimeRenderer(i,e);const n=typeof r=="string"?"text":"children";return{className:{"b-cal-eventlist-event-time":1},"aria-hidden":!0,[n]:n==="text"?r:B.asArray(r)}}defaultEventTimeRenderer(i,e){const t=this,{startDate:r,endDate:n,allDay:s}=i,a=C.clearTime(r),l=C.clearTime(n),o=l&&(n-l?n:C.add(l,-1,"d")),d=!i.isMilestone&&(n-l?l:o)-a;let c;return d?!s&&!(e-a)?c=`${C.format(r,t.eventListTimeFormat)} - ${C.format(o,"DD MMM")}`:!s&&!(e-l)?c=t.L("L{Calendar.endsOn}",C.format(n,t.eventListTimeFormat)):c=t.L("L{Calendar.endsOn}",C.format(o,"DD MMM")):c=s?t.L("L{Calendar.allDay}"):`${C.format(i.startDate,t.eventListTimeFormat)} - ${C.format(n,t.eventListTimeFormat)}`,c}agendaEventDateRenderer(i){return{className:{"b-day-name":1,"b-cal-agenda-date":1,"b-today":!(C.clearTime(new Date)-C.clearTime(i))},"aria-hidden":!0,children:[{className:{"b-cal-agenda-date-date-number":1},text:i.getDate()},{className:{"b-cal-agenda-date-date-text":1},children:[{text:C.format(i,"dddd")},{text:C.format(i,"MMM YYYY")}]}]}}destroy(){var i;for(const e of Object.values(this.features))(i=e.destroy)==null||i.call(e);super.destroy()}populateHeaderMenu({items:i}){const{listRangeMenu:e}=this;e&&(e.appendTo=this.element,i.listRangeItem={weight:-1e3,icon:"b-icon-calendar-week",text:"L{Calendar.timeRange}",menu:e}),super.populateHeaderMenu(...arguments)}refreshVirtualScrollbars(){super.refreshVirtualScrollbars(),this.bodyElement.classList[E.scrollBarWidth&&this.hasVerticalOverflow?"add":"remove"]("b-has-scrollbar")}changeListRangeMenu(i){if(i)return Ds.mergeConfigs({view:this,floating:!1},i)}updateRowManager(i){var e;(e=super.updateRowManager)==null||e.call(this,...arguments),i.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this})}onBeforeRenderRow({row:i,record:e}){var t,r;const{_elementsArray:n}=i,{id:s,startDate:a}=e;if(e.isSpecialRow)i.eachElement(l=>delete l.dataset.eventId);else if(e.isEventModel){for(let l=0,{length:o}=n;l<o;l++)n[l].dataset.eventId=s,n[l].dataset.date=C.makeKey(a);i.cls[`b-day-of-week-${a.getDay()}`]=1,(r=(t=this.calendar)==null?void 0:t.beforeListRenderRow)==null||r.call(t,{row:i,record:e})}}onInternalKeyDown(i){}get displayName(){let i=this.title;return typeof i!="string"&&(i=this.type),O.capitalize(i)}async scrollTo(i,e){const t=this;if(e=T.assign({},t.defaultScrollOptions,typeof e=="boolean"?{animate:e}:e),i instanceof t.store.modelClass)await t.scrollRowIntoView(i,Object.assign({},e,{highlight:!1})),e.highlight&&(i=t.getEventElement(i,i.startDate),typeof e.highlight=="boolean"?E.highlight(i,t):(t.widget||t).callback(e.highlight,null,[i]));else if(T.isDate(i=t.ingestDate(i))&&t.store.count){const r=C.makeKey(i=t.findClosestOccupiedDate(i));t.scrollingToDate=!0,await t.scrollRowIntoView(t.dateIndex[r],e),t.scrollingToDate=!1,t.scrolledToDate=i}}findClosestOccupiedDate(i){const e=this,{dayTime:t}=e,r=e.dateIndex;if(!Object.keys(r).length||r[t.dateKey(i)])return i;let n=Number.MAX_SAFE_INTEGER;const s=Object.keys(r);for(let a=0,{length:l}=s;a<l;a++){const o=t.parseKey(s[a]);Math.abs(o-i)<Math.abs(n-i)&&(n=o)}return new Date(n)}updateStartDate(){const{refreshCount:i}=this;this.preventScroll=!0,super.updateStartDate(...arguments),this.preventScroll=!1,!this.isConfiguring&&this.refreshCount===i&&this.populateStoreSoon()}updateEndDate(){var i;const{refreshCount:e}=this;(i=super.updateEndDate)==null||i.call(this,...arguments),!this.isConfiguring&&this.refreshCount===e&&this.populateStoreSoon()}get dateBounds(){return[this.startDate,this.endDate]}get descriptionFormat(){return super.descriptionFormat||[this.shortDateFormat,`S{${this.shortDateFormat}} - E{${this.shortDateFormat}}`]}set descriptionFormat(i){super.descriptionFormat=i}descriptionRenderer(){return`${this.formattedDescription}. ${this.L("L{eventCount}",this.eventCount)}`}get count(){return re.deprecate("calendar","7.0.0","count property is deprecated in favor of eventCount"),this.eventCount}get eventCount(){return this.store.getAllDataRecords().length}get store(){return super.store}set store(i){i&&!i.modelClass&&this.project&&(i.modelClass=this.project.eventStore.modelClass),super.store=i}updateEventStore(i){var e;(e=super.updateEventStore)==null||e.call(this,i),this.detachListeners("eventStore"),i.ion({name:"eventStore",refresh:"onCalendarStoreChange",thisObj:this}),this.populateStoreSoon()}changeStore(i){const e=this;return i&&(i=pe.mergeConfigs({useRawData:{ignoreDefaults:!0,disableDefaultValue:!0,disableTypeConversion:!0,enabled:!0},modelClass:e.modelClass},i)),i=super.changeStore(i),i!=null&&i.modelClass.isEventModel&&(e.nonWorkingDaysFilter=i.addFilter({id:`${e.id}-nonworkingday-filter`,filterBy:t=>!e.dayTime.isIntraDay(t)||!e.hiddenNonWorkingDays[t.startDate.getDay()],disabled:!e.hideNonWorkingDays},!0)),i}updateHideNonWorkingDays(i){const e=this,{store:t}=e;super.updateHideNonWorkingDays(i),t&&(e.nonWorkingDaysFilter.disabled=!i,t.filter()),e.trigger("refresh")}afterRemove({records:i}){this.eventStore.remove(i),super.afterRemove(...arguments)}get modelClass(){return this.eventStore.modelClass}populateStoreSoon(){const i=this,{project:e}=i;i.isVisible?(e.isInitialCommitPerformed&&!e.isWritingData||!e.eventStore.count)&&i.populateStore():i.whenVisible("populateStore")}get duration(){return super.duration+(this.range?0:1)}populateStore(){var i;const e=this,{cellEdit:t}=e.features,r=t==null?void 0:t.editorContext,n=e.eventStore.getEvents({startDate:e.startDate,endDate:C.add(e.endDate,e.range?0:1,"d"),filter:e.eventFilter}).sort(xL);e.dateIndex=n.reduce((s,a)=>{const l=C.makeKey(a.startDate);return s[l]||(s[l]=a),s},{}),r&&t.cancelEditing(),e.store.data=n,e.trigger("refresh"),r&&t.startEditing(r),(i=e.calendar)==null||i.syncUIWithActiveView(this)}changeMonth(){const i=super.changeMonth(...arguments);return i.ion({dateChange:"onMonthChange",thisObj:this}),i}onMonthChange({newDate:i}){const e=this,{startDate:t}=e,r=e.changeStartDate(i);(!t||r-t&&!e.containsDate(r))&&e.updateRange(e.range),!e.preventScroll&&e.isVisible&&e.store.count&&(e.populateStoreSoon.flush(),e.scrollTo(i))}onCalendarStoreChange({source:i}){this.date||(this.date=i.map(e=>e.startDate).sort((e,t)=>e.valueOf()-t.valueOf())[0]),this.populateStoreSoon()}changeSettingsButton(i,e){return i&&Lt.reconfigure(e,Lt.mergeConfigs({type:"button",positioned:!0,icon:"b-icon-cog",menuIcon:null,cls:"b-blue b-cal-widget-settings-button",insertBefore:this.bodyWrapElement},i),this)}getCurrentConfig(i){const e=super.getCurrentConfig(i);return delete e.store,delete e.data,e}};y(fr,"$name","EventList"),y(fr,"type","eventlist"),y(fr,"configurable",{preserveScrollOnDatasetChange:!0,cls:"b-slide-vertical",eventFilter:null,localizableProperties:["title","text"],title:"L{List}",range:"1 month",month:!0,columns:{$config:{merge:RL},value:[{text:"L{EventEdit.Name}",field:"name",flex:"1 0 12em"},{text:"L{EventList.Start}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"startDate",width:"16.5em",format:"L LT",renderer({record:i,value:e}){return i.allDay?C.format(e,"L"):this.defaultRenderer(...arguments)}},{text:"L{EventList.Finish}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"endDate",width:"16.5em",format:"L LT",renderer({record:i,value:e}){return i.allDay?C.format(e,"L"):this.defaultRenderer(...arguments)}},{type:"widget",text:"Resources",field:"resources",minWidth:250,autoHeight:!0,widgets:[{type:"chipview",valueProperty:"items",displayField:"name",itemsFocusable:!1,navigator:null,closable:!1,style:{flexFlow:"row nowrap",display:"flex",padding:"5px 0 3px 0"},scrollable:{overflowX:"hidden-scroll",overflowY:!1},getItemCls:i=>E.isNamedColor(i.eventColor)?` b-sch-${i.eventColor}`:"",getItemStyle:i=>`color:#fff;${i.eventColor&&!E.isNamedColor(i.eventColor)?`background-color:${i.eventColor}`:""}`}],editor:!1}]},features:{group:!1,rowCopyPaste:!1,columnPicker:{createColumnsFromModel:!0}},internalListeners:{beforeCellEditStart({editorContext:i}){var e,t,r,n;const{editor:s,record:a}=i;if(a.isRecurring||a.isOccurrence)return xi.show({html:"Please use EventEdit to edit recurring events"}),!1;(r=(t=(e=this.calendar)==null?void 0:e.features.eventTooltip)==null?void 0:t._tooltip)==null||r.hide(),(n=s.timeField)==null||n[a.allDay?"hide":"show"]()}},settingsButton:{$config:"lazy",value:null},listRangeMenu:{$config:"lazy",value:{type:"rangemenu"}},eventListTimeFormat:"HH:mm",eventTimeRenderer:null}),y(fr,"delayable",{populateStoreSoon:{type:"raf",cancelOutstanding:!0}}),fr.initClass(),fr._$name="EventList";var TL={mouseover:1,mouseout:1},ML={mousedown:1,mouseup:1,click:1,dblclick:1,contextmenu:1},_L=({date:i},{date:e})=>i-e,Es=class extends fr.mixin(Aa){construct(i){const e=this,t=T.getPropertyDescriptor(this,"features");Object.defineProperty(e,"features",{get:()=>t.get.call(this),set:r=>{var n;const s=K.getInstanceDefaultFeatures(this);for(const a in s)s[a]=!1;s.print=(r==null?void 0:r.print)||!!((n=this.calendar)!=null&&n.features.print),t.set.call(this,s)},configurable:!0}),super.construct(i),e.keyMap=gr().$meta.config.keyMap}onCalendarKeyDown(i){var e,t;const{eventContentElement:r}=this,{target:n}=i,s=`.${this.dayCellCls}`,a=n.closest(s);if(a)switch(i.key){case"ArrowUp":i.preventDefault(),(e=Ti.getVisitor(r,s).previous(a))==null||e.focus();break;case"ArrowDown":i.preventDefault(),(t=Ti.getVisitor(r,s).next(a))==null||t.focus();break;default:return super.onCalendarKeyDown(i)}else return super.onCalendarKeyDown(i)}initScroll(){super.initScroll(...arguments),this.scrollable.ion({scroll:"onAgendaViewScroll",scrollEnd:"onAgendaViewScroll",thisObj:this})}onResponsiveStateChange({state:i,oldState:e}){var t;(t=super.onResponsiveStateChange)==null||t.call(this,...arguments),e&&(e==="small"||i==="small")&&this.refresh()}onAgendaViewScroll(){if(!this.scrollingToDate){const{firstVisibleRow:i}=this;i&&(this.topDate=this.getDateFromElement(i.cells[0]))}}updateRange(i,e){const t=this,{rowManager:r}=t;if(e&&r.rowCount){const{dayTime:n}=t,s=n.parseKey(r.topRow.id),a=n.parseKey(r.bottomRow.id);if(!C.betweenLesserEqual(t.date,s,a)){t.scrollToDateOnDateChange=!1,t._startDate=C.floor(t._startDate,i,null,t.weekStartDay),t.date=t.firstVisibleRow.id,t.scrollToDateOnDateChange=!0;return}}super.updateRange(...arguments)}updateTopDate(i){this.trigger("topDateChange",{date:i})}changeColumns(){var i;const e=super.changeColumns(...arguments);return(i=e==null?void 0:e.forEach)==null||i.call(e,t=>{t.autoHeight=!!(!t.isAgendaColumn||t.renderer!==t.defaultRenderer||this.eventRenderer)}),e}onFocusGesture(){}onGridElementFocus(){}onGridBodyFocusIn(){}focusCell(){}setHoveredRow(){}onElementKeyDown(){}onElementMouseDown(){}editAutoCreatedEvent(i,e){this.populateStoreSoon.now(),super.editAutoCreatedEvent(i,e)}handleEvent(i){const{type:e}=i;super.handleEvent(i),TL[i.type]?this.onEventMouseOverOut(i):this.consumeGridPointerEvents!==!1&&ML[e]&&this.onCalendarPointerInteraction(i)}getCellDataFromEvent(i){if(i.target.closest(".b-grid-cell")){const e=super.getCellDataFromEvent(i);return e&&(e.record=this.getEventRecord(i.target)),e}}getDateFromPosition(i,e){const t=this.rowManager.getRowAt(e),r=t==null?void 0:t._cells.normal[0];return r&&this.getDateFromElement(r)}updateOffsetStartsBeforeEvents(i){this.element.classList.toggle("b-offset-continues-past",!!i)}updateEventRowSpacing(i){this.contentElement.style.setProperty("--event-row-spacing",E.setLength(i))}updateSuppressLongEvents(){this.fillFromMaster()}onCalendarStoreChange({action:i,oldCount:e,records:t,removed:r,added:n}){const s=this;if(s.isPainted){if(i==="filter"&&!(r!=null&&r.length)&&!(n!=null&&n.length)||i==="dataset")return;if(i==="remove"&&t.length===1&&t[0].isEventModel){const{store:a}=s,l=t[0],o=C.clearTime(l.startDate),d=C.clearTime(l.endDate);do{const c=C.makeKey(o),u=s.cellMap.get(c);u&&(B.remove(u.events,l),u.events.length?s.onStoreUpdateRecord({source:a,record:s.store.getById(c),changes:{}}):(s.cellMap.delete(c),delete s.dateIndex[c],a.remove(c,!0))),o.setDate(o.getDate()+1)}while(o<d);return}}s.populateStoreSoon()}get cellMap(){var i;const e=this;return(i=e._cellMap)!=null&&i.populated?e._cellMap:e.createCellMap({endDate:C.add(e.endDate,e.range?0:1,"d"),rawEvents:!0,skipPropagate:!0})}onMonthChange(){var i;super.onMonthChange(...arguments),!((i=this._cellMap)!=null&&i.size)&&this.alwaysShowCurrentDate&&this.populateStoreSoon()}populateStore(){var i,e;(i=this._cellMap)==null||i.clear();const t=this,{store:r,rowManager:n,dateFilter:s,hiddenNonWorkingDays:a,dayTime:l,scrollable:o,initialScrollDone:d}=t,c=isNaN(t.eventHeight)?25:t.eventHeight,{firstVisibleRow:u}=n,h=u==null?void 0:u.id,g=u?u.top-o.y:0;t._eventCount=0,t.populateStoreSoon.cancel(),t.element.dataset.duration=t.duration,t.date||(t.isConfiguring=!0,t.date=t.eventStore.map(_=>_.startDate).sort((_,k)=>_.valueOf()-k.valueOf())[0],t.isConfiguring=!1);const{cellMap:f,firstVisibleDate:m,eventRowSpacing:p}=t,v=C.add(t.endDate,t.range?0:1,"d"),b=t.showEmptyDates?t.createRangeCellMapEntries():[...f.values()],w=[],D=t.dateIndex={};for(let _=0,{length:k}=b;_<k;_++){const F=b[_],{date:I}=F;if(I>=m&&I<v&&(!s||t.callback(s,t,[F]))&&!a[I.getDay()]){const A=r.createRecord(F),P=B.findInsertionIndex(A,w,_L);w.splice(P,0,A),D[F.id]=A}}if(t.alwaysShowCurrentDate&&!(r.isFiltered?w.filter(r.filtersFunction):w).length){const _=r.createRecord({...t.createCellData(t.date),cls:"b-current-date-placeholder"});w.push(_),D[_.id]=_}r.suspendEvents(),r.loadData(w),r.resumeEvents(),t.onAgendaStoreFilter();const{count:S}=r,x=S?r.records.map(_=>_.events.length).reduce((_,k)=>_+k,0)/S:0,R=t.findClosestOccupiedDate(t.date),M=r.getById(d?h:l.dateKey(R));if(n._rowHeight=n.minRowHeight=Math.max(x*(c+p)-p,70),n.calculateRowCount(!1,!0,!0),n.estimateTotalHeight(!0),S){const{topRow:_}=n,k=Math.max(r.indexOf(M)-n.prependRowBuffer,0);n.topIndex=_.dataIndex=k,_.setTop(n.rowHeight*k)}if(n.refresh(),M){const _=n.getRecordCoords(M,!0),k=d?{animate:!1,block:"start",edgeOffset:g}:{animate:!1};o.y+=o.getDeltaTo(_,k).yDelta,n.lastScrollTop=o.y,t.scrollTo(M,k),t.initialScrollDone=!0}t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh"),(e=t.calendar)==null||e.syncUIWithActiveView(t),t.columns.forEach(_=>{var k,F;return(F=(k=_.constructor).exposeProperties)==null?void 0:F.call(k)}),t.getConfig("settingsButton")}createRangeCellMapEntries(){const i=this,{cellMap:e,startDate:t,endDate:r}=i,n=[];for(const s=new Date(t);s<r;s.setDate(s.getDate()+1))n.push(e.get(C.makeKey(s))||i.createCellData(s));return n}toggleEmptyText(){var i;const{store:e}=this,t=e.count===1&&!((i=e.first)!=null&&i.events.length)?0:e.count,r=!(t>0||e.isLoading||e.isCommitting);this.element.classList.toggle("b-grid-empty",r)}scrollRowIntoView(i){const{scrollable:e,rowManager:t}=this,r=this.store.getById(i);if(!t.getRowFor(r)){const n=this.columns.find(s=>s.type==="agendacolumn");if(n.renderer===n.defaultRenderer){const s=this.calculateRowTop(r);e.y=s<t.firstVisibleRow.top?s+t.averageRowHeight:s-e.clientHeight,t.jumpToPosition(e.y)}}super.scrollRowIntoView(...arguments)}calculateRowTop(i){var e;let t=0;if(this.rowManager.rowCount){const r=this,n=isNaN(r.eventHeight)?25:r.eventHeight,{eventRowSpacing:s}=r,a=r.rowManager.topRow.cells[0],l=E.getEdgeSize(a,"padding","tb").height,o=(((e=a.querySelector(".b-cal-agenda-date"))==null?void 0:e.offsetHeight)||0)+l;for(let d=0,{count:c}=r.store;d<c;d++){const u=r.store.getAt(d),h=Math.max(u.events.length*(n+s)-s+l,o);if(u===i)break;t+=h}}return t}get eventCount(){return this._eventCount}collectEvents(i){return i.getDateIndex=e=>Number(e)===Number(this.startDate)||!this.hideEventOverflow?"date":"startDate",super.collectEvents(i)}changeStore(i){return i=super.changeStore(i),i&&(this.nonWorkingDaysFilter=i.addFilter({id:`${this.id}-nonworkingday-filter`,filterBy:e=>!e.isNonWorking,disabled:!this.hideNonWorkingDays},!0),this.detachListeners("agendaStoreFilter"),i.ion({name:"agendaStoreFilter",filter:"onAgendaStoreFilter",thisObj:this}),i.reapplyFilterOnAdd=!0),i}onAgendaStoreFilter(){const i=this;i._eventCount=i.store.reduce((e,t,r)=>{const{events:n,date:s}=t;for(let a=0,{length:l}=n;a<l;a++){const o=n[a];(!i.isAllDayEvent(o)||!r||C.clearTime(o.startDate).valueOf()===s.valueOf())&&e++}return e},0)}updateHideEventOverflow(){this.refresh()}updateHideNonWorkingDays(i){this.isConfiguring||(this.nonWorkingDaysFilter.disabled=!i),this.refresh()}doRefresh(){this.populateStore()}createCellData(i){return Object.assign(this.cellMonth.getCellData(i,this.month),{view:this,id:C.makeKey(i),events:[]})}set cellRenderer(i){this._cellRenderer=i}changeSettingsButton(i){const{listRangeMenu:e}=this;return e&&(e.appendTo=this.element),i=i&&e&&super.changeSettingsButton(this.constructor.mergeConfigs({menu:e},i)),i&&this.addKeyBinding(i.actionKey,()=>{i.focus,i.element.click()}),i}};y(Es,"$name","AgendaView"),y(Es,"type","agendaview"),y(Es,"configurable",{eventSorter:(i,e)=>{const{startDate:t,isInterDay:r}=i,{startDate:n,isInterDay:s}=e;return r!==s?Number(s)-Number(r):!r&&!s?t-n:t-n||e.durationMS-i.durationMS||e.endingDate-i.endingDate},eventRowSpacing:8,title:"L{Agenda}",range:"year",hideEventOverflow:null,offsetStartsBeforeEvents:!0,handlePointerInteraction:!1,hideHeaders:!0,columns:{name:null,startDate:null,endDate:null,resources:null,agenda:{type:"agendacolumn"}},enableSticky:!0,preserveScrollOnDatasetChange:!0,positionMode:"position",settingsButton:{actionKey:"Ctrl+R",ariaLabel:"L{settings}",keyMap:{Escape:"revertFocus"}},cellTabIndex:null,rowCls:{"b-cal-agenda-grid-row":1},cellCls:{"b-calendar-cell":1},eventBarContainerCls:"b-cal-event-bar-container",keyMap:null,store:{modelClass:Kn},listRangeMenu:{align:{align:"t100-b100"}},dateFilter:null,alwaysShowCurrentDate:null,showEmptyDates:null,emptyText:"L{YearView.noEvents}",topDate:{$config:{equal:"date"},value:null}}),Es.initClass(),Es._$name="AgendaView";var kL=/^[+-]?\d+(?:\.\d+)?(?:%|px)?$/,bt=class Cr{static from(e){return e==null?null:e instanceof Cr?e:(Array.isArray(e)||typeof e=="string"&&isNaN(e)||(e=Number(e),e=e===0?[0,new Number(0)]:e<1?[e,0]:[0,e]),new Cr(...e))}static get(e){return Cr.from(e)||Cr.ZERO}constructor(e,t){this.r=e,this.d=t}add(e){return e=Cr.from(e),e?new Cr(this.r+e.r,this.d+e.d):this}adjust(e,t){return this.r+=e||0,this.d+=t||0,this}freeze(){return Object.freeze(this)}px(e){return this.r*(e||100)+this.d}sub(e){return e=Cr.from(e),e?new Cr(this.r-e.r,this.d-e.d):this}*[Symbol.iterator](){yield"r",yield"d"}stringify(){const e=this.toString();return kL.test(e)?e:`calc(${e})`}toString(){const{r:e,d:t}=this;let r;return e?(r=E.percentify(e*100),t&&(r=`${r} + ${t}px`.replace("+ -","- "))):r=t?`${t}px`:"0",r}};bt.ZERO=new bt(0,0).freeze(),bt._$name="LayoutDim";var FL=function(i){var e,t;const r=this;return{[i?"right":"left"]:(e=r.left)==null?void 0:e.stringify(),top:r.top.stringify(),width:(t=r.width)==null?void 0:t.stringify(),height:r.height.stringify(),minWidth:r.minWidth}},oo=class extends $.mixin(ii){beforeLayoutEvents(i){return this.owner.trigger("beforeLayoutEvents",{context:i}),i}clusterize(i,e,t,r){const n=i[i.length-1]||null;e.push(t),n&&this.overlaps(n,t)?(t.cluster=n,n.end=Math.max(n.end,t.end),n.items.push(t)):i.push(t.cluster={context:r,start:t.start,end:t.end,items:[t]})}createLayoutContext(i,e){const t=i==null?void 0:i.events;return{cellData:i,dayDomConfig:e,events:(t==null?void 0:t.length)>1?i.dayTime.sortEvents(i.date,t.slice()):t||[],clusters:[],items:[],layout:this}}layoutEvents(i,e){const t=this,r=t.beforeLayoutEvents(t.createLayoutContext(i,e)),{clusters:n,events:s,items:a}=r;let l,o,d,c;for(l of s)d=t.createLayoutItem(l,r),t.clusterize(n,a,d,r);for(o=0,c=n.length;o<c;++o)t.layoutCluster(n[o]);return t.owner.trigger("layoutEvents",{context:r}),r}createLayoutItem(i,e){const{date:t,tomorrow:r,dayEnd:n,dayTime:s}=e.cellData,{allDay:a,startDate:l,endingDate:o}=i,d=a||l<t?0:s.delta(l,"s"),c=we.from(i.preamble),u=we.from(i.postamble);let h=a||o>=r?n:s.delta(o,"s");i.isMilestone&&!i.isTimeRangeModel&&!i.allDay&&(h=d+this.owner.milestoneDuration/1e3);const g=Math.max(d,0),f=Math.min(h,n),m=bt.from(g/n);return{eventRecord:i,getStyles:FL,start:g,end:f,top:m,id:i.id,height:new bt(f/n,0).sub(m),startsBefore:l<t||d<0,endsAfter:r<o||h>n,preambleSec:c?C.as("s",c):0,postambleSec:u?C.as("s",u):0}}overlaps(i,e,t,r){return typeof t=="string"&&(r=t,t=null),r=r||"end",t=t!=null?t:this.overlapTolerance*60||0,i.start<e[r]-t&&e.start<i[r]-t}syncGutter(){this.owner.setStyle("--dayview-cell-gutter",String(bt.get(this.gutter&&this.gutterWidth)))}updateGutter(){this.syncGutter()}updateGutterWidth(){this.syncGutter()}updateInset(i){this.owner.setStyle("--dayview-cell-inset-size",String(bt.get(i)))}};y(oo,"factoryable",{}),y(oo,"configurable",{gutter:!0,gutterWidth:5,inset:40,overlapTolerance:null,owner:null}),oo._$name="DayLayout";var IL=class extends Xh(){static get defaultConfig(){return{coordProp:"left",sizeProp:"width"}}pack(i){const e=i.map(t=>{const{startDate:r}=t.eventRecord,n=new Date(r);return n.setSeconds(n.getSeconds()+t.maxEnd-t.start),{item:t,start:r,end:n,x:0}});this.packEventsInBands(e,(t,r,n,s)=>{t.width=s,t.w=s*wg,t.x+=(t.left=n.start+r*s)*wg,t.item.x=t.x,t.item.w=t.w})}},wg=1e4,Q0=Object.freeze([]),AL=new IL,Uc=class extends oo{createLayoutContext(i,e){const t=this,r=super.createLayoutContext(i,e),{staggerWidth:n}=t;return Object.assign(r,{indentWidth:bt.get(t.indentWidth),stagger:new bt,staggerMaximum:bt.from(t.staggerMaximum),staggerMinimum:t.staggerMinimum,staggerWidth:bt.from(n===!0?t.gutterWidth:n),stretch:t.stretch})}layoutCluster(i){const e=this,{context:t,items:r}=i,{indentWidth:n,stagger:s,staggerMaximum:a,staggerMinimum:l,staggerWidth:o,stretch:d}=t,c=e.treeify(r);e._assignSizes(r,c);for(const u of r){const h=u.depth,g=new bt,f=new bt,m=u.majorParent||u;for(const p of s)s[p]=o[p]*(h.height+h.overlap),s[p]=a!=null&&a[p]?Math.min(a[p],s[p]):s[p];g.r=m.x+h.minor*n.r*m.w,g.d=h.minor*n.d,f.r=d?1-g.r:m.w-g.r+m.x,f.d=-g.d,l&&(u.minWidth=`calc(${l} * (${f}))`),f.r-=s.r*m.w,f.d-=s.d,u.left=g,u.width=f}}treeify(i){const e=[];for(let t=0;t<i.length;t++)this._addChild(i[t],t,e);return e}_addChild(i,e,t){const r=this,{clearanceMinutes:n,escapeMinutes:s,stretch:a}=r,l=n*60,o=l+s*60,d=(r.overlapTolerance||0)*60,c=(D,S)=>Math.abs(S.start-D.start)>=l,u=D=>D.depth.minor*10+D.depth.major*(a?1:0),h={depth:0,height:0,heightMajor:0,overlap:0,major:0,minor:0};if(i.parent=null,i.maxEnd=i.maxEndMajor=i.end,i.depth=h,i.order=e,!t.length){t[0]=i,i.barriers=Q0;return}let g=0,f,m,p,v,b,w;for(v of t){if(f=v.lastItem||v,!r.overlaps(i,v,d,"maxEnd")){b=v.parent,m=!0;break}if(c(i,f)){for(p=!0,m&&(m=!1,b=null);f!==v&&!r.overlaps(f,i,d);f=f.parent);w=u(f),(!b||w<g)&&(b=f,g=w)}else p||(m=!0,b=v)}if(m)p=0,m=b?b.depth.major+1:0,v=b=t[m-1]||null;else{for(v=b.majorParent||b;o&&b!==v&&!(r.overlaps(b,i,d)&&i.start-b.start<o);b=b.parent);p=b.depth.minor+1,m=b.depth.major}i.parent=b,h.major=m,h.minor=p,h.depth=b?b.depth.depth+1:0,p?(i.majorParent=v,i.previousItem=v.lastItem,v.lastItem=i):r._addMajor(i,t),r._adjustOverlap(i),r._adjustParents(i)}_addMajor(i,e){const t=this,{stretch:r}=t,n=i.depth.major;if(e[n]=i,i.barriers=t._getOverlaps(e,i,1),r||i.barriers.length)for(const s of t._getOverlaps(e,i,-1)){const a=s.barriers.filter(l=>!i.barriers.includes(l));(r||a.length<s.barriers.length)&&(s.barriers=a,a.push(i))}}_adjustOverlap(i){if(i.depth.minor){let e,t;for(t=i;t.depth.minor>1;t=t.parent);for(e=0;t=t.previousItem;)this.overlaps(t,i)&&(e=Math.max(e,t.depth.height+t.depth.overlap+1));i.depth.overlap=e}}_adjustParents(i){const{depth:e,end:t}=i,r=e.minor+e.overlap;for(let n,s=i;s=s.parent;){if(n=s.depth,n.major!==e.major){n.heightMajor=Math.max(n.heightMajor,e.major-n.major);continue}for(s.maxEnd=Math.max(s.maxEnd,t);n.height<r-n.minor;)++n.height,n.overlap&&--n.overlap}}_assignSizes(i,e){const{complexityLimit:t,stretch:r}=this,n=i.filter(s=>!s.depth.minor);if(t)for(const s of n){const a=s.barriers.map(v=>[v]),{parent:l}=s,o=s.depth.heightMajor+1;s.x=l?l.x+l.w:0;let d=(1-s.x)/o,c,u,h,g,f,m,p;if(a.length){for(c=0;c<a.length;){if(g=a[c],h=h||g,c>t){d=1/e.length;break}if(f=g[g.length-1],f.order<s.order)++c,p=f.x,u=0;else if(!f.barriers.length)++c,p=1,u=1;else{a.splice(c,1,...f.barriers.map(v=>g.concat(v))),h===g&&(h=null);continue}m=(p-s.x)/(u+g.length),m<d&&(d=m,h=g)}if(r){for(m=h.reduce((v,b)=>v+b.depth.height+1,0),c=s.lastItem;c;c=c.previousItem)c.depth.overlap+=m;s.depth.overlap+=m}}s.w=d}else{AL.pack(n);for(const s of n)s.x/=wg,s.w/=wg}}_getOverlaps(i,e,t){const{end:r}=e,n=t<0?-1:i.length;let{start:s}=e,a,l,o;for(a=e.depth.major+t;a!==n&&s<r;a+=t)l=i[a],s<l.maxEnd&&l.start<r&&((o||(o=[])).push(l),s=l.maxEnd);return o||Q0}};y(Uc,"type","fluid"),y(Uc,"configurable",{clearanceMinutes:45,complexityLimit:2e3,escapeMinutes:null,indentWidth:10,staggerMaximum:null,staggerMinimum:.4,staggerWidth:!0,stretch:null}),Uc.initClass(),Uc._$name="FluidDayLayout";var{MILLIS_PER_HOUR:cn}=Me,LL=new Date(2020,11,22,22,59,59),PL={paint:1,refresh:1,resize:1,eventspercellchange:1,rangechange:1,beforedatechange:1,localized:1},OL=i=>{i.stopImmediatePropagation()},$L=i=>i.ctrlKey&&i.preventDefault(),eE={level:0,step:"1 hour"},HL=new L(0,0,0,0),VL=["30 minutes","15 minutes","10 minutes","5 minutes"],NL=["30 minutes","12 minutes","6 minutes"],BL=i=>i.eventRecord||i,zL=Object.freeze([]),WL=i=>typeof i=="string"?{text:i}:i,ui=class extends Xe.mixin(gr,lo,lv,Cg){static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0},adjustCoreHours:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{role:"grid",localizableProperties:["timeFormat","timeAxisTimeFormat","noMatchingDates"],layout:"vbox",textContent:!1,scrollable:{overflowY:!0,propagateSync:!0},title:"L{Day}",eventHeight:"auto",hourHeight:42,minHourHeight:15,range:{magnitude:1,unit:"day"},fixedDuration:null,visibleStartTime:{$config:"lazy",value:7},dayStartShift:null,dayStartTime:null,dayEndTime:null,dayTime:0,increment:"15 min",timeSnapType:"round",intradayCls:null,showTime:!0,showBullet:!1,iconTarget:"header",eventLayout:{type:"fluid"},minDayWidth:null,eventColourStyleProperty:"backgroundColor",monitorResize:!!E.scrollBarWidth,eventFilter:null,snapRelativeToEventStartDate:!1,timeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},timeAxisTimeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},allDayEvents:{$config:["lazy","nullify"],value:{type:"calendarrow"}},overflowPopup:null,showAllDayHeader:{value:null,$config:null,default:!0},eventSpacing:1,responsive:{small:{descriptionFormat:"MMMM YYYY"},"*":{descriptionFormat:null}},maxAllDayHeight:null,fitHours:null,dayCellRenderer:null,tickRenderer:null,coreHours:null,zoomOnMouseWheel:!0,allowZoomUnderflow:!1,hourHeightBreakpoints:[70,140,300,500],sixMinuteTicks:null,minEventHeight:"1em",shortEventHeight:32,currentTimeIndicatorRenderer:null,actionButtons:null,hideEmptyDays:null,dateFilter:null,autoRefresh:["hideEmptyDays","dateFilter"],dashedSubticks:null,columnHeaderRenderer:null,showCurrentTime:{$config:"lazy",value:{onTop:!0}},noMatchingDates:"L{noMatchingDates}",interDayResize:null,interDayDrag:null,keyMap:{"+":"zoomIn","Shift++":"zoomIn","-":"zoomOut"}}}construct(i){var e;const t=this;t.configuredHiddenVerticalScroll=((e=i.scrollable)==null?void 0:e.overflowY)==="hidden-scroll",t.cellMapEventFilter=t.cellMapEventFilter.bind(t),super.construct(...arguments),t.startDate||(t.startDate=t.month.date),le.ion({theme:"onThemeChange",thisObj:t})}startConfigure(i){!this.hasConfig("fixedDuration")&&!this.isDayResourceView&&(this.fixedDuration=!(this.initialConfig.range||this.initialConfig.endDate)),super.startConfigure(i)}updateProject(i,e){this.isConfiguring||this.allDayEvents&&(this.allDayEvents.project=i),super.updateProject(i,e)}updateZoomOnMouseWheel(i){var e;i?this.zoomListener=V.on({element:this.dayContentElement,wheel:"onDayContentMousewheel",thisObj:this,throttled:{buffer:100,alt:$L}}):(e=this.zoomListener)==null||e.call(this)}get childItems(){const{allDayEvents:i}=this,e=super.childItems;return i&&e.push(i),e}get dayEndTime(){var i,e;return(e=(i=this.dayTime)==null?void 0:i.timeEnd)!=null?e:this._dayEndTime}get dayStartTime(){var i,e;return(e=(i=this.dayTime)==null?void 0:i.timeStart)!=null?e:this._dayStartTime}get dayStartShift(){var i,e;return(e=(i=this.dayTime)==null?void 0:i.startShift)!=null?e:this._dayStartShift}changeDayEndTime(i){return this.adjustCoreHours(),Math.ceil((this.configuredDayEndTime=Me.parse(i))/cn)*cn}updateDashedSubticks(i){this.dayContainerElement.classList.toggle("b-dashed-subticks",!!i)}updateDayEndTime(i){this._dayTime=null,this.dayTime=new Me({startShift:this.dayStartShift,timeStart:this.dayStartTime,timeEnd:i})}changeDayStartTime(i){return this.adjustCoreHours(),Math.floor((this.configuredDayStartTime=Me.parse(i))/cn)*cn}adjustCoreHours(){if(this.initialConfig.coreHours==null){const{_dayStartTime:i,_dayEndTime:e,configuredDayStartTime:t,configuredDayEndTime:r}=this;i<t||e>r?this.coreHours={start:t||0,end:r||24,overlayDay:!0}:this.coreHours=null}}updateDate(i,e){const{allDayEvents:t}=this;t&&(t.date=i),super.updateDate(i,e)}updateDayStartTime(i){this._dayTime=null,this.dayTime=new Me({startShift:this.dayStartShift,timeStart:i,timeEnd:this.dayEndTime})}updateDayStartShift(i){this._dayTime=null,this.dayTime=new Me({startShift:i,timeStart:this.dayStartTime,timeEnd:this.dayEndTime})}changeDayTime(i){var e;if(i||(i=new Me(this)),!((e=this._dayTime)!=null&&e.equals(i)))return i}updateDayTime(i,e){var t;const r=this,{eventStore:n}=r;if(n&&(n.registerDayIndex(i),e&&n.unregisterDayIndex(e)),!r.isConfiguring&&(r.syncHours(),i.startShift!==(e==null?void 0:e.startShift))){const s=i.startOfDay(r.startDate),a=i.startOfDay(r.date);r.setConfig({date:a,startDate:s}),(t=r.allDayEvents)==null||t.setConfig({date:a,dayTime:i,startDate:s})}}dateKey(i){return this.dayTime.dateKey(i)}dayOfDate(i){return i&&this.dayTime.dayOfDate(i)}async scrollTo(i,e){const t=this,{allDayEvents:r}=t,n=[],s=typeof i=="number",a=s?C.add(t.startDate,i,"hour"):typeof i=="string"?C.parse(i):new Date(i),l=!isNaN(a);if(await t.scrollPromise,await(r==null?void 0:r.heightAnimation),t.isDestroyed)return;e=T.assign({},t.defaultScrollOptions,typeof e=="boolean"?{animate:e}:e),n.push(await super.scrollTo(l?a:i,{...e,y:!l,highlight:!1}));let o;if(l){const{firstVisibleDate:d,lastVisibleDate:c}=t;d.setHours(t.dayStartHour),c.setHours(t.dayEndHour),a.setTime(C.clamp(a,d,c));let u=-1;for(;!t.getDayElement(a);){if((a<d||a>c)&&(u=-u,u<0))return;a.setDate(a.getDate()+u)}o=t.getDayElement(a),o&&e.y!==!1&&(i=a.getHours()+a.getMinutes()/60,n.push(t.scrollable.scrollTo(null,t.getPositionFromTime(i),e)))}else if(o=t.getEventElement(i),o){const d=L.from(o.closest(".b-calendar-cell")),c=L.from(o);e.edgeOffset={end:t.rtl?c.x-d.x:d.right-c.right}}return o&&(!l||t.duration>1&&!s)&&n.push(t.horizontalScroller.scrollIntoView(o,e)),t.scrollPromise=Promise.all(n).then(()=>t.scrollPromise=null)}getEventElement(i,e){var t;return super.getEventElement(i,e)||((t=this.allDayEvents)==null?void 0:t.getEventElement(i,e))}getEventElements(i){var e;return super.getEventElements(i)||((e=this.allDayEvents)==null?void 0:e.getEventElements(i))}getPositionFromTime(i){return Me.parse(i)<Me.parse(this.dayStartTime)-this.dayStartShift?0:this.dayTime.delta(i,"h")*this.hourHeight}updateShowAllDayHeader(i){var e,t;const r=this,{_allDayEvents:n}=r;(e=r._cellMap)==null||e.clear(),r.element.classList.toggle("b-hide-allday-header",!i),n&&((t=n._cellMap)==null||t.clear(),n.element.classList.toggle("b-hide-allday-header",!i),n.refresh()),r.isConfiguring||r.refresh()}changeAllDayEvents(i,e){var t;if(!i)return e==null?void 0:e.destroy();this.getConfig("date"),i.maxHeight&&(this.maxAllDayHeight=i.maxHeight,i.maxHeight=null);const r=this,{autoCreate:n,dayHeaderRenderer:s,overflowButtonRenderer:a,overflowClickAction:l,overflowPopup:o,avatarRendering:d,range:c,shiftIncrement:u}=r,h=r.isConfiguring?r.peekConfig("showAllDayHeader"):r.showAllDayHeader,g=Vi.reconfigure(e,i,{owner:r,defaults:{calendar:r.calendar,parent:r,rtl:r.rtl,cls:{"b-dayview-schedule-container":1,"b-dayview-initializing":1,"b-hide-allday-header":!h},[o!==void 0?"overflowPopup":"_"]:o,[a?"overflowButtonRenderer":"_"]:a,[l?"overflowClickAction":"_"]:l,[s?"dayHeaderRenderer":"_"]:s,[d?"avatarRendering":"_"]:d,[u?"shiftIncrement":"_"]:u,autoCreate:n!==!1?{newName:n.newName,gesture:n.gesture,startHour:0,duration:(t=r.initialConfig.autoCreate)!=null&&t.duration?`${C.as(n.durationUnit,"1 day")} ${n.durationUnit}`:"1 day"}:!1,[r.initialConfig.dragUnit?"dragUnit":"_"]:r.dragUnit,dayNameSelector:".b-day-name-date",eventFilter:f=>r.showAllDayHeader&&r.isAllDayEvent(f)&&(!r.eventFilter||r.eventFilter(f)),dayStartTime:r.dayStartTime,dayEndTime:r.dayEndTime,dayStartShift:r.dayStartShift,eventRenderer:r.eventRenderer,eventStore:r.eventStore,month:r.month,fullWeek:r.duration===1&&r.fixedDuration&&!r.dayTime.startShift,filterEventResources:r.filterEventResources,startDate:r.startDate,[c?"range":"_"]:c,[c?"_":"endDate"]:r.endDate,nonWorkingDays:r.nonWorkingDays,dateFilter:r.dateFilter,nonWorkingDayCls:r.nonWorkingDayCls,weekendCls:r.weekendCls,weekStartDay:r.weekStartDay,defaultCalendar:r.defaultCalendar,emptyCellRenderer:r.emptyCellRenderer,hideEmptyDays:r.hideEmptyDays,syncCalendarDate:r.syncCalendarDate,internalListeners:{heightChange:"updateElementLayout",refresh:"updateElementLayout",catchall:"relayAllDayEvents",showoverflowpopup:"onAllDayOverflowPopupShown",thisObj:r},editAutoCreatedEvent(f){(r.showAllDayHeader?this:r).trigger("eventAutoCreated",{eventRecord:f})},createCellMap(){return r.showAllDayHeader?this.constructor.prototype.createCellMap.call(this,...arguments):r.emptyMap||(r.emptyMap=new Map)},actionButtons:r.actionButtons},setup(f){f.hideNonWorkingDays=r.duration===1&&!f.fullWeek?!1:r._hideNonWorkingDays}});return g&&(g.height=g.flex=null,r.originalAllDayEventsScrollTo=g.scrollTo,g.scrollTo=r.allDayEventsScrollTo.bind(r)),g}onAllDayOverflowPopupShown({overflowPopup:i}){this._overflowPopup=i}allDayEventsScrollTo(i){const e=this,t=i.isEvent?i.startDate:e.changeEndDate(i);if(!(i.isEvent?C.intersectSpans(e.startDate,e.endDate,i.startDate,i.endDate):C.betweenLesser(t,e.startDate,e.endDate)))e.date=t;else return e.originalAllDayEventsScrollTo.call(e.allDayEvents,...arguments)}updateAutoCreate(i){var e;const{_allDayEvents:t}=this;(e=super.updateAutoCreate)==null||e.call(this,i),t&&(t.autoCreate=i?{newName:i.newName,gesture:i.gesture,startHour:0,duration:"1 day"}:!1)}updateWeekStartDay(i,e){var t;(t=super.updateWeekStartDay)==null||t.call(this,i),!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.weekStartDay=i)}updateEventStore(i,e){super.updateEventStore(i,e);const{dayTime:t}=this;t&&(i==null||i.registerDayIndex(t),e==null||e.unregisterDayIndex(t))}get overflowPopup(){var i;return((i=this._allDayEvents)==null?void 0:i.overflowPopup)||this._overflowPopup}get description(){const i=this,{range:e,shortDateFormat:t}=i;return i.descriptionRenderer||i.fixedDuration||i.duration===1||(e==null?void 0:e.magnitude)===1&&e.unit==="day"?super.description:e&&!i.dateFilter?`${C.format(i.startDate,t)}, ${e.magnitude} ${C.getLocalizedNameOfUnit(e.unit,e.magnitude>1)}`:`${C.format(i.startDate,t)} - ${C.format(C.add(i.endDate,-1,"d"),t)}`}get eventContentElement(){return this.dayContainerElement}getDateFromDomEvent(i,e=!1){let t=super.getDateFromDomEvent(i);const r=this,n=E.getEventElement(i);if(t&&n!==i&&r.dayContainerElement.contains(n)){const s=(i.clientY||n.getBoundingClientRect().y)-.5;t=C.add(t,r.dayStartHour-r.dayStartShift/36e5+(s-r.scrollable.element.getBoundingClientRect().y+r.scrollable.y)/r.hourHeight,"hour"),e||(t=C[r.timeSnapType](t,r.increment))}return t}getDateFromPosition(i,e,t=!1,r){const n=this,{eventContentElement:s,allDayEvents:a}=n,l=t?HL:L.fromScreen(s).roundPx().translate(-s.scrollLeft),o=s.scrollWidth,d=t?i:i-l.x,c=n.rtl?n.eventContentElement.offsetWidth-d:d,u=e-l.y,h=n.getDayElementFromX(i),g=(h==null?void 0:h.offsetHeight)||n.hourHeight*n.getDayLength("hour"),f=n.getDateFromElement(h,r)||n.date;return a&&(c<0||o<c||u<0||g<u)?a.getDateFromPosition(i,e,r):(C.clearTime(f,!1),f.setMilliseconds(f.getMilliseconds()+n.dayStartMs+Math.floor(u/g*n.getDayLength())),C[n.timeSnapType](f,n.increment))}doRefresh(){var i,e;const t=this,{element:r,noMatchingDates:n}=t,s=t.resolveCallback(t.columnHeaderRenderer,t,!1);if(t.isVisible){t.allowTransitionsOnRefresh||E.addTemporaryClass(r,"b-no-transitions",200,t),t.allowTransitionsOnRefresh=null;const a=[],l=[];t.today=t.dayTime.startOfDay(((i=t.calendar)==null?void 0:i.dateTimeNow)||new Date);for(let o=0,d=new Date(t.startDate);d<t.endDate;o++,d.setDate(d.getDate()+1)){const c=t.getDayDomConfig(d);if(c&&(l.push(c),s))if(l[o]){const u=t.dayTime.dateKey(d),h={dataset:{syncId:u},className:{"b-day-column-header-cell":1}},g=s.handler.call(s.thisObj,t.cellMap.get(u));g&&(h[typeof g=="string"?"html":"children"]=g),a.push(h)}else a.push(null)}s?(r.classList.add("b-has-day-header"),oe.sync({targetElement:t.dayHeaderContentElement,domConfig:{onlyChildren:!0,children:a,syncOptions:{syncIdField:"syncId",releaseThreshold:0,strict:!0}}})):r.classList.remove("b-has-day-header"),r.classList.toggle("b-multidayview",l.length>1),r.style.setProperty("--visible-column-count",l.length),(e=t.onDayCellConfigGenerated)==null||e.call(t,l),oe.sync({targetElement:t.dayContainerElement,domConfig:{onlyChildren:!0,children:l.length?l:[{className:"b-empty-text",[n!=null&&n.includes("<")?"html":"text"]:n}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:l.length>0}}}),t.element.classList.toggle("b-no-days",!l.length),t.refreshDayBackground(),t.refreshCount=(t.refreshCount||0)+1,t.syncCurrentTimeIndicators(),t.trigger("refresh")}}getEventsForDay(i,e){var t,r,n,s,a;const l=this,o=typeof i=="string"?i:l.dayTime.dateKey(i),{allDayEvents:d}=l;e&&l.startDate-e&&((t=l._cellMap)==null||t.clear(),l.startDate=e);const c=((n=(r=l.cellMap.get(o))==null?void 0:r.events)==null?void 0:n.slice())||[];return d&&(d.startDate-l.startDate&&((s=d._cellMap)==null||s.clear(),d.startDate=l.startDate),c.push.apply(c,((a=d.cellMap.get(o))==null?void 0:a.renderedEvents)||zL)),c.map(BL)}getBaseDayDomConfig(i){var e;const t=this,{dateFilter:r,resource:n}=t,s=t.dayTime.dateKey(i),a=t.cellMap.get(s)||t.cellMap.set(s,t.createCellData(i)).get(s),{day:l}=a;if(!(t.hiddenNonWorkingDays[l]&&t.duration!==1||t.hideEmptyDays&&!t.getEventsForDay(s).length||r&&!t.callback(r,t,[a]))){const d=t.nonWorkingDays||t.month.nonWorkingDays;return[a,{tabIndex:-1,role:"gridcell","aria-label":`${C.format(i,"dddd Do MMMM")}${n?` ${n.name}`:""}, ${t.L("eventCount",((e=a.events)==null?void 0:e.length)||0)}.`,dataset:{date:s},className:{"b-dayview-day-detail":1,[t.dayCellCls]:1,[t.nonWorkingDayCls]:d[l]||!1,[t.weekendCls]:C.weekends[l],[t.todayCls]:!(i-t.today),"b-last-cell":!(i-t.lastVisibleDate),[`b-day-of-week-${l}`]:1,"b-past-date":i<t.today},style:{},children:{inset:{className:{"b-dayview-inset":1}},events:{className:{"b-dayview-event-container":1},children:[]},...t.renderTickBackground(a,n)},syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}}renderTickBackground(i,e){const t=this,r=t.resolveCallback(t.tickRenderer,t,!1),n={};if(r){const s=parseInt(E.getStyleValue(t.contentElement,"--subtick-count")),a=t.getDayLength("h"),l=a*s,o=a/l,{dayTime:d}=t,{startHour:c}=d;let u,h=new Date(i.date),g,f;for(h.setHours(c),g=0,f=0;g<l;g++){const m=h;if(h=C.add(h,o,"h"),u=r.handler.call(r.thisObj,{events:i.events.filter(p=>C.intersectSpans(m,h,p.startDate,p.endingDate)),startTime:m,endTime:h,tickIndex:g,subtickIndex:f,subTickCount:s,resourceRecord:e}),u){typeof u=="string"?u={text:u}:Array.isArray(u)&&(u={children:u.map(WL)});const p=!h.getMinutes(),v=u.rowspan||u.rowSpan;typeof u.style=="string"&&(u.style=E.parseStyle(u.style)),(u.style||(u.style={}))["--tick-index"]=g,v&&(u.style["--tick-rowspan"]=v,u.rowspan=u.rowSpan=null),u.className={...te.from(u.className,!0),"b-dayview-subtick":1,"b-last-in-hour":p},(u.dataset||(u.dataset={})).hour=m.getHours(),u.dataset.minute=m.getMinutes(),u.dataset.index=f++,p&&(f=0),n[`subtick-${g}`]=u}}}return n}getDayDomConfig(i){const e=this,t=e.getBaseDayDomConfig(i);if(t){const{dayCellRenderer:r}=e,[n,s]=t;return e.coreHours&&(s.style.backgroundImage=e.getCoreHoursGradient(e.getCoreHoursForDate(i))),e.renderEvents(n,s),E.normalizeChildren(r?e.callback(r,e,[s,n]):s)}}onCalendarKeyDown(i){var e,t,r,n;const{target:s}=i,{dayCellCls:a,allDayEvents:l}=this,{eventContentElement:o}=(e=this.owner)!=null&&e.isCalendarMixin?this.owner:this;if(o.contains(s)){const d=`${s.matches(".b-dayview-day-detail")?".b-dayview-day-detail":""}.${a}`,c=s.closest(d)||s,u=(t=c.closest("[data-date]"))==null?void 0:t.dataset.date,h=c.matches(d),{resourceId:g}=c.dataset,f=g?` [data-resource-id="${g}"]`:"";switch(i.key){case"ArrowUp":if(h&&l){i.preventDefault();let m=l.eventContentElement.querySelector(`.${l.dayCellCls}[data-date="${u}"]${f}`);(!E.isFocusable(m)||!E.isInView(m))&&(m=l.headerCellContainer.querySelector(`[data-header-date="${u}"]`).focus()),m==null||m.focus()}return;case"ArrowLeft":i.preventDefault(),(r=Ti.getVisitor(o,d).previous(c))==null||r.focus();return;case"ArrowRight":i.preventDefault(),(n=Ti.getVisitor(o,d).next(c))==null||n.focus();return}return super.onCalendarKeyDown(i)}}getCoreHoursGradient(i){if(!i)return"";const e=this,{dayTime:t}=e,r=t.duration("h"),n=["linear-gradient(to bottom"];i=B.asArray(i);let s=0;for(let a=0,{length:l}=i;a<l;a++){const o=i[a],d=Math.max(t.delta(o.start,"h"),0)/r*100,c=Math.min(t.delta(o.end,"h"),r)/r*100;if(l===1&&d===0&&c===100)return"";s<d&&n.push(`var(--dayview-outside-core-hours-color) ${E.percentify(s)}, var(--dayview-outside-core-hours-color) ${E.percentify(d)}`),n.push(`transparent ${E.percentify(d)}, transparent ${E.percentify(c)}`),s=c}return s<100&&n.push(`var(--dayview-outside-core-hours-color) ${E.percentify(s)}, var(--dayview-outside-core-hours-color) 100%`),n.join(",")+")"}getCoreHoursForDate(i){const{coreHours:e}=this;return e.length===7?e[i.getDay()]:typeof e=="object"?e.overlayDay?e:null:this.callback(e,this,[i])}refreshDayEvents(i){const e=this;i=e.changeEndDate(i),e.today=e.dayTime.startOfDay(new Date);const t=e.getDayDomConfig(i);E.addTemporaryClass(e.element,"b-no-transitions",200,e),t.onlyChildren=!0,oe.sync({targetElement:e.getDayElement(i),domConfig:t})}renderEvents(i,e){const t=this,r=t.eventLayout.layoutEvents(i,e),{items:n}=r,{eventSpacing:s,rtl:a}=t;for(const l of n){const o=t.createEventDomConfig({date:i.date,eventRecord:l.eventRecord});t.insertActionButtons(o.children[0].children[0].children,l.eventRecord,i),o.className["b-starts-above"]=l.startsBefore,o.className["b-ends-below"]=l.endsAfter,l.cluster.items.length>1&&(o.className["b-cal-in-cluster"]=1),Object.assign(o.style,{[s?"padding-bottom":""]:`${s}px`,...l.getStyles(a)}),e.children.events.children.push(o)}t.trigger("renderEvents",{context:r})}changeActionButtons(i){const e=Array.isArray(i);e&&i.forEach((r,n)=>{"ref"in r||(r.ref=`action-button-${n+1}`)}),this._actionButtonsObject=e?T.transformArrayToNamedObject(i):i;let t;return i=new Proxy(i,{deleteProperty(r,n){return delete(t||(t=T.clone(r)))[n]},get(r,n){return n==="$value"?t||r:n==="$reset"?()=>t=null:Array.isArray(r)&&typeof r[n]=="function"?(t||(t=T.clone(r)))[n].bind(t):Reflect.get(...arguments)},set(r,n,s){return Reflect.set(t||(t=T.clone(r)),n,s)}})}insertActionButtons(i,e,t){const{actionButtons:r}=this;if(r){const{$value:n}=r,s=Array.isArray(n)?n:T.transformNamedObjectToArray(n);s.length&&i.push({className:"b-event-action-buttons",children:s.sort(z.weightSortFn).map(({cls:a,tooltip:l,ref:o},d)=>({tag:"button",className:{"b-tool":1,"b-icon":1,[a]:1},dataset:{ref:o,btip:l},"aria-label":l}))}),r.$reset()}}onEventClick({domEvent:i}){const e=i.target.closest(".b-event-action-buttons button[data-ref]");if(e)return this.callback(this._actionButtonsObject[e.dataset.ref].handler,this,arguments),!1}get overflowElement(){return this.dayContentElement}get cellMap(){var i;return(i=this._cellMap)!=null&&i.populated?this._cellMap:this.createCellMap()}get bodyConfig(){const i=this,{allDayEvents:e,maxAllDayHeight:t}=i;return Object.assign(super.bodyConfig,{children:{alldayRowElement:e?{className:{"b-dayview-allday-row":1},style:{[t?"maxHeight":""]:E.setLength(t)},children:{cornerElement:{className:{"b-dayview-allday-row-start":1,"b-dayview-allday-autoheight":e.autoHeight},children:{allDayTextElement:{className:"b-dayview-allday-text",html:i.L("L{EventEdit.All day}")},allDayToggleIcon:{tag:"button",className:"b-expand-allday-button b-icon b-icon-expand-row",dataset:{btip:i.L("L{DayView.expandAllDayRow}")},"aria-label":i.L("L{DayView.expandAllDayRow}"),"aria-expanded":!1}}},allDayEvents:e==null?void 0:e.element,$scrollerPad:E.scrollBarPadElement}}:null,dayHeaderElement:{className:"b-day-column-header",children:{dayHeaderScrollerElement:{className:"b-day-column-header-scroller",children:{dayHeaderContentElement:{className:"b-day-column-content"}}},$scrollerPad:E.scrollBarPadElement}},dayContentElement:{role:"presentation",className:{"b-dayview-day-content":1},children:{timeAxisElement:{children:i.getTimeElementConfigs(),className:{"b-timeaxis-container":1},"aria-hidden":!0},dayContainerElement:{role:"row",className:{"b-dayview-day-container":1}}}},horizontalScrollerElement:{className:"b-virtual-scrollers b-hide-display",children:[{className:"b-virtual-scroller"},E.scrollBarPadElement]}}})}async onDayContentMousewheel(i){if(i.ctrlKey){i.preventDefault();const{zoomOnMouseWheel:e}=this,t=typeof e=="number"?e:1,r=i.clientY-this.scrollable.element.getBoundingClientRect().y,n=-Math.min(Math.abs(i.deltaY),10)*Math.sign(i.deltaY);await this.zoomPromise,this.zoomPromise=this.zoomBy(n*t,r,this.allowZoomUnderflow)}}zoomIn(){this.zoomBy(2)}zoomOut(){this.zoomBy(-2,void 0,!0)}zoomBy(i,e=Math.min(this.scrollable.scrollHeight,this.scrollable.clientHeight)/2-1,t){return new Promise(r=>{const n=this,s=n.getDayLength("h"),a=n.hourHeight*s;n.updateElementLayout.cancel(),e=Math.min(e,a);const{scrollable:l,hourHeight:o}=n,{clientHeight:d}=l,{scrollTop:c}=l.element,u=i<0&&a>=d-5&&!t,h=C.round(typeof e=="number"?n.getDateFromPosition(n.dayContainerElement.offsetWidth/2,e+c,!0):C.parse(e,"HH:mm:ss"),n.increment),g=u?n.dayContentClientHeight/s:n.minHourHeight,f=n.getPositionFromTime(h)-c,m=Math.max(Math.max(o+i,g),n.minHourHeight);if(u&&m*s<d)return n.fitHours=!0,r();o!==m?(l.overflowY=n.configuredOverflowY,n.ion({layoutUpdate:()=>{l.scrollTo(null,n.getPositionFromTime(h)-f),l.syncPartners(!1,!0),r()},once:!0,prio:1e3}),n.fitHours=!1,n.hourHeight=m):(n.configuredOverflowY=l.overflowY,m===g&&(l.overflowY="hidden"),r())})}zoomTo(i,e){return this.zoomBy(i-this.hourHeight,e,!0)}async zoomToFit(i){const e=this,t=e.eventStore.getEvents({startDate:e.startDate,endDate:e.endDate,filter:s=>!s.isInterDay}),[r,n]=t.reduce((s,a)=>{const l=C.getTimeOfDay(C.floor(a.startDate,"0.5h"),"h"),o=C.getTimeOfDay(C.ceil(a.endDate,"0.5h"),"h");return[l<s[0]?l:s[0],o>s[1]?o:s[1]]},[24,0]);await e.zoomTo(Math.floor(e.scrollable.clientHeight/(n-r))),await e.scrollTo(r,i)}createCellMap(){const{showAllDayHeader:i}=this;return super.createCellMap({dayTime:this.dayTime,startOnly:i,allowPartial:!i,skipPropagate:!0,rawEvents:!0,filter:this.cellMapEventFilter})}cellMapEventFilter(i){const{dayTime:e,hiddenNonWorkingDays:t,showAllDayHeader:r}=this;return(!r||e.isIntraDay(i)&&!i.allDay)&&e.intersects(i)&&!t[e.dayOfWeek(i.startDate)]}getDayLength(i="ms"){return this.dayTime.duration(i)}changeIncrement(i){return typeof i=="string"?(i=C.parseDuration(i),C.as("ms",i.magnitude,i.unit)):i}get dayStartHour(){return this.dayStartTime==null?0:Math.floor(this.dayStartTime/cn)}get dayEndHour(){return this.dayEndTime==null?24:Math.ceil(this.dayEndTime/cn)}get dayStartMs(){return this.dayStartTime==null?0:this.dayStartTime}get dayEndMs(){return this.dayEndTime==null?24*cn:this.dayEndTime}get dayStartOffset(){return this.dayTime.startTimeOffsetMs/cn*this.hourHeight}changeEventFilter(i){return i===void 0&&(i=e=>!this.isAllDayEvent(e)),i}changeEventLayout(i,e){return oo.reconfigure(e,i,{owner:this,defaults:{owner:this}})}updateHideEmptyDays(i){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.hideEmptyDays=i)}updateDateFilter(i){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.dateFilter=i)}updateNonWorkingDays(i){var e,t;const r=this;(e=super.updateNonWorkingDays)==null||e.call(this,i),r._allDayEvents&&(r._allDayEvents.nonWorkingDays=i),r.isConfiguring||((t=r._cellMap)==null||t.clear(),r.refresh())}updateMaxAllDayHeight(i){this.alldayRowElement&&E.setLength(this.alldayRowElement,"max-height",i)}get hideNonWorkingDays(){return this._hideNonWorkingDays===!0&&this.duration===1?!1:this._hideNonWorkingDays}set hideNonWorkingDays(i){super.hideNonWorkingDays=i}updateHideNonWorkingDays(i){var e;const t=this,{_allDayEvents:r}=t;super.updateHideNonWorkingDays(i),r&&(r.hideNonWorkingDays=t.duration===1&&!r.fullWeek?!1:t._hideNonWorkingDays),t.isConfiguring||((e=t._cellMap)==null||e.clear(),t.refresh())}updateSyncCalendarDate(i){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.syncCalendarDate=i)}syncHours(){var i;const e=this;(i=e._cellMap)==null||i.clear(),oe.sync({targetElement:e.timeAxisElement,domConfig:{onlyChildren:!0,children:e.getTimeElementConfigs()}}),e.updateElementLayout.now(),e.refresh()}syncCurrentTimeIndicators(){var i,e,t,r;const n=this,s=((i=n.calendar)==null?void 0:i.dateTimeNow)||new Date,{showCurrentTime:a,dayTime:l,currentTimeIndicatorRenderer:o}=n,{style:d}=n.element,c=a!=null&&a.showTime?C.round(s,{unit:"minute",magnitude:1}):s;if(l.contains(s)?(d.setProperty("--current-time",`"${C.format(c,n.timeAxisTimeFormat)}"`),d.setProperty("--current-time-seconds",l.delta(c,"second"))):(d.setProperty("--current-time",""),d.setProperty("--current-time-seconds","")),a&&C.betweenLesser(s,n.startDate,n.endDate)&&l.contains(s)){const{currentTimeElement:u,timeAxisElement:h}=n;a.showTime?u.parentNode!==h&&(h==null||h.insertBefore(u,h.firstChild)):u.remove(),o&&((e=n.getDayElement(s))==null||e.appendChild(n.currentTimeIndicator))}else(t=n._currentTimeIndicator)==null||t.remove(),(r=n._currentTimeElement)==null||r.remove()}updateShowCurrentTime(i){const{dayContentElement:e}=this;e.classList.toggle("b-custom-current-time",!!this.currentTimeIndicatorRenderer),e.classList.toggle("b-hide-current-time",!i),e.classList.toggle("b-show-current-time",!!(i!=null&&i.showTime)),e.classList.toggle("b-show-time-full-width",!!(i!=null&&i.fullWidth)),e.classList.toggle("b-show-time-on-top",!!(i!=null&&i.onTop)),this.isConfiguring||this.syncCurrentTimeIndicators()}get currentTimeIndicator(){const i=this._currentTimeIndicator||(this._currentTimeIndicator=E.createElement(this.callback(this.currentTimeIndicatorRenderer,this)));return i.style.top="var(--current-time-position)",i}get currentTimeElement(){return this._currentTimeElement||(this._currentTimeElement=E.createElement({retainElement:!0,className:"b-time-axis-current-time",children:[{className:"b-current-time-text"}]}))}eachHour(i){const e=this,{dayTime:t}=e,{startHour:r}=t,n=t.duration("h");i=e.resolveCallback(i);for(let s=new Date(2e3,5,15,r,0,0),a=0;a<n;a++)i.handler.call(i.thisObj,s.getHours(),new Date(s),a),s.setHours(s.getHours()+1)}getTimeElementConfigs(){const i=this,{startHour:e}=i.dayTime,t=[];return i.eachHour((r,n,s)=>{const a=i.createLeafTicks(n);!s&&i.showDayStartHour&&a.unshift({className:"b-dayview-timeaxis-tick b-dayview-hour-tick b-dayview-start-hour",text:C.format(new Date(2e3,5,15,e,0,0),i.timeAxisTimeFormat)}),n.setHours(r=n.getHours()+1),n.setMinutes(0),t.push({className:`b-dayview-timeaxis-time b-dayview-timeaxis-time-${r<10?"0":""}${r}`,children:a.concat([{className:"b-dayview-timeaxis-tick b-dayview-hour-tick",text:C.format(n,i.timeAxisTimeFormat)}])})}),i.coreHours&&i._simpleCoreHours&&t.unshift({className:"b-dayview-timeaxis-background",style:{backgroundImage:i.getCoreHoursGradient(i.coreHours)}}),t}createLeafTicks(i){return this[this.sixMinuteTicks?"createSixMinuteTicks":"createFiveMinuteTicks"](i)}createFiveMinuteTicks(i){const e=[];for(let t=1;t<12;t++)i.setMinutes(t*5),e.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-4":1,"b-dayview-tick-level-3":!(t&1),"b-dayview-tick-level-2":!(t%3),"b-dayview-tick-level-1":t===6},text:C.format(i,this.timeAxisTimeFormat)});return e}createSixMinuteTicks(i){const e=[];for(let t=1;t<10;t++)i.setMinutes(t*6),e.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-3":1,"b-dayview-tick-level-2":!(t&1),"b-dayview-tick-level-1":t===5},text:C.format(i,this.timeAxisTimeFormat)});return e}changeCoreHours(i){const e=this;return e._simpleCoreHours=T.isObject(i)||Array.isArray(i)&&i.length!==7,e._simpleCoreHours&&(i=T.clone(i),i._overlayDay=i.overlayDay,Object.defineProperty(i,"overlayDay",{set(t){this._overlayDay=t,e.updateCoreHours()},get(t){return this._overlayDay}})),i}updateCoreHours(){this.isConfiguring||this.syncHours()}changeScrollable(){this.refreshDayBackground();const i=super.changeScrollable(...arguments);return this.configuredOverflowY=i==null?void 0:i.overflowY,i}changeShowTime(i){return i===!0?{startTime:!0,endTime:!1}:i}updateShowTime(){this.isConfiguring||this.refresh()}changeStartDate(){return this.dayOfDate(super.changeStartDate(...arguments))}updateRange(i){!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.range=i),super.updateRange(...arguments)}updateShiftIncrement(i){var e;!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.shiftIncrement=i),(e=super.updateShiftIncrement)==null||e.call(this,...arguments)}updateStartDate(i){const{_allDayEvents:e}=this;if(e){const t=!this.range&&this.peekConfig("endDate"),r={startDate:i};t&&(r.endDate=t),e==null||e.setConfig(r)}super.updateStartDate(...arguments)}changeEndDate(){return this.dayOfDate(super.changeEndDate(...arguments))}updateEndDate(i){var e,t;(e=super.updateEndDate)==null||e.call(this,...arguments),this.updatingRange||(t=this._allDayEvents)==null||t.setConfig({date:this.date,endDate:i})}changeMinDayWidth(i){return typeof i=="number"?Math.max(i,50):typeof i=="string"?i:null}updateMinDayWidth(i){this.element.style.setProperty("--min-day-width",i?E.setLength(i):null),this._allDayEvents&&(this._allDayEvents.minDayWidth=i),this.updateElementLayout()}updateMinHourHeight(i){this.hourHeight=Math.max(this.hourHeight,i)}changeHourHeight(i){if(i)return Math.max(i,this.minHourHeight)}updateHourHeight(i){this.isConfiguring&&(this.milestoneHeight=Math.max(Math.min(i/2,this.shortEventHeight),22)),this.milestoneDuration=36e5/(i/this.milestoneHeight),this.shortEventDuration=36e5/(i/this.shortEventHeight),this.isConfiguring||(this.updateElementLayout(),this.fitHours&&this.refresh())}updateShortEventHeight(i){this.updateHourHeight(this.hourHeight)}updateMinEventHeight(i){this.contentElement.style.setProperty("--dayview-min-event-height",E.setLength(i))}get hourHeight(){return!this.isConfiguring&&this.fitHours?Math.max(this.dayContentClientHeight/this.getDayLength("hour"),this.minHourHeight):this._hourHeight}changeFitHours(i){const e=this;return i?e.configuredMinHourHeight=e.minHourHeight:e.configuredMinHourHeight&&(e.minHourHeight=e.configuredMinHourHeight),i}get dayContentClientHeight(){return E.floorPx(L.client(this.dayContentElement).height)}updateFitHours(i){const e=this;i&&(i.minHeight?e.minHourHeight=Math.max(i.minHeight,9):e.minHourHeight=17),e.isConfiguring||i&&(e.hourHeight=Math.max(e.dayContentClientHeight/e.getDayLength("hour"),e.minHourHeight)),e.element.classList.toggle("b-fit-hours",!!i),e.monitorResize=E.scrollBarWidth||i}updateEventSpacing(){var i;this.isConfiguring||((i=this._cellMap)==null||i.clear(),this.refresh())}onInternalPaint({firstPaint:i}){var e;const t=this,{dayContainerElement:r,horizontalScrollerElement:n}=t,{scrollBarWidth:s}=E;if((e=super.onInternalPaint)==null||e.call(this,...arguments),i){const{allDayEvents:a}=t;t.horizontalScroller=new At({widget:t,element:r,overflowX:s?"hidden-scroll":!0,overflowY:"clip",propagateSync:!0,internalListeners:{overflowChange:"updateElementLayout",thisObj:t}}),t.dayHeaderScroller=new At({_id:`${t.id}-dayheader-scroller`,widget:t,element:t.dayHeaderScrollerElement,overflowX:s?"hidden-scroll":!0,overflowY:"clip",propagateSync:!0}),t.horizontalScroller.addPartner(t.dayHeaderScroller),a&&(a.element.classList.remove("b-dayview-initializing"),t.horizontalScroller.addPartner(a.headerScroller)),Ge.addResizeListener(t.dayContainerElement,t.onDayContainerResize.bind(t)),t.scrollbarScroller=new At({_id:`${t.id}-scrollbar-scroller`,widget:t,element:n.firstChild,scrollWidth:r.scrollWidth-s,overflowX:!0,overflowY:!1}),t.horizontalScroller.addPartner(t.scrollbarScroller),t.updateElementLayout.now(),t.setInterval(t.syncCurrentTimeIndicators.bind(t),15*1e3,"syncCurrentTimeIndicators"),a&&(V.on({click:{element:t.cornerElement,handler:"onCornerClick"},mousemove:{element:t.allDayEvents.element.nextSibling,handler:OL,capture:!0},thisObj:t}),t.scrollable.ion({overflowChange:"syncScrollbarPadding",thisObj:t}))}}afterInternalPaint({firstPaint:i}){var e;(e=super.afterInternalPaint)==null||e.call(this,...arguments),i&&this.refresh()}scrollToVisibleStartTime(i=!0){if(this.visibleStartTime!=null){const e=this,{scrollable:t,allDayEvents:r,eventStore:n}=e,s=e.getPositionFromTime(e.visibleStartTime),a=async()=>{var l;(l=t.scrollTo)==null||l.call(t,null,s,{animate:!1,block:"start"})};s&&(s>t.maxY&&r&&e.showAllDayHeader!==!1?i&&!n.storage.generation?n.ion({refresh:()=>e.scrollToVisibleStartTime(!1),once:!0,expires:{delay:2e3,alt:a}}):e.scrollToStartTimer=e.allDayEvents.ion({heightChange:a,once:!0,expires:{delay:500,alt:a}}):a())}}relayAllDayEvents(i){if(!PL[i.type])return this.trigger(i.eventName,i)}async onCornerClick(){const{allDayEvents:i}=this;i.isAnimating||(await i.toggleExpandCollapse(),this.isDestroyed||(this.allDayToggleIcon.setAttribute("aria-label",i.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}")),this.allDayToggleIcon.setAttribute("aria-expanded",i.expanded)))}syncScrollbarPadding(){if(!this.configuredHiddenVerticalScroll&&this.allDayEvents)if(E.scrollBarWidth){if(!this.allDayEvents.isAnimating){const{allDayEvents:i,alldayRowElement:e,dayHeaderElement:t,scrollable:r}=this,n=this.fitHours&&r.clientHeight/this.getDayLength("hour")>=this.minHourHeight,s=!n&&r.hasOverflow(),{headerElement:a,scrollable:l}=i,o=i.expanded||i.autoHeight,d=!!(o&&l.hasOverflow());t.classList[s||d?"add":"remove"]("b-show-yscroll-padding"),s&&d?(a.classList.add("b-show-yscroll-padding"),e.classList.remove("b-show-yscroll-padding"),r.overflowY=l.overflowY="auto"):d!==s?d?(a.classList.add("b-show-yscroll-padding"),l.overflowY="auto",r.overflowY="scroll"):(a.classList.remove("b-show-yscroll-padding"),e.classList.add("b-show-yscroll-padding"),l.overflowY="hidden",r.overflowY=!n&&"auto"):(e.classList.remove("b-show-yscroll-padding"),a.classList.remove("b-show-yscroll-padding"),r.overflowY=!n&&"auto",l.overflowY="hidden")}}else this.scrollable.overflowY=this.allDayEvents.scrollable.overflowY="auto"}onInternalResize(i,e,t,r,n){var s;const{_allDayEvents:a}=this;super.onInternalResize(i,e,t,r,n),n&&((s=a==null?void 0:a.cellMap)!=null&&s.size&&(a==null||a.performResizeRefresh(a.eventsPerCell,a.eventContainerTop)),t!==n&&(this.updateElementLayout(),this.syncScrollbarPadding()))}onThemeChange(){this.updateElementLayout()}onDayContainerResize(i,{height:e}={},{height:t}){e&&(t!==e||E.scrollBarWidth&&this.minDayWidth)&&(this.updateElementLayout(),this.fitHours&&this.updateFitHours(this.fitHours))}async updateElementLayout(){var i;if((i=this.owner)!=null&&i.isDestroyed)return;const e=this,{dayHeaderContentElement:t,dayContainerElement:r,horizontalScrollerElement:n,dayHeaderScroller:s,horizontalScroller:a,scrollbarScroller:l,allDayEvents:o}=e,d=r.querySelectorAll("[data-date]"),{scrollBarWidth:c}=E;let u,h;if(o&&e.refreshCount){const g=e.cornerElement.classList;o.hasOverflow?(g.add("b-has-cell-overflow"),g.toggle("b-expanded",!!o.expanded)):g.remove("b-has-cell-overflow")}for(e.refreshDayBackground.now(),u=0,h=d.length-1;u<=h;u++)d[u].classList.toggle("b-last-cell",u===h);if(o&&e.syncScrollbarPadding(),c&&n.classList.toggle("b-show-yscroll-padding",e.scrollable.hasOverflow()),d.length){const g=L.from(d[d.length-1],r),f=E.roundPx(L.client(r).width),m=E.roundPx(e.rtl?f-g.left:g.right-1);m>f?(n.classList.remove("b-hide-display"),s.scrollWidth=m,t.style.minWidth=`${m}px`,l.scrollWidth=m,a.overflowX="hidden-scroll"):(n.classList.add("b-hide-display"),s.scrollWidth=null,t.style.minWidth="",l.scrollWidth=null,a.overflowX=!1),e.peekConfig("visibleStartTime")&&e.scrollToVisibleStartTime()}e.hasPainted&&e.trigger("layoutUpdate")}refreshDayBackground(){var i;const e=this,{contentElement:t,hourHeight:r,dayStartOffset:n,_hourHeightLevel:s,hourHeightLevel:a}=e,l=new te(t.classList),o=e.getDayLength("hour"),d=r*o,c=r/(60*60),u=(r-2)/2,h=(r-4)/4,g=(r-5)/5,f=(r-6)/6,m=(r-10)/10,p=(r-12)/12,v=t.style,b=Math.ceil(C.format(LL,e.timeAxisTimeFormat).length/2);l.remove("b-dayview-hourheight-level-1","b-dayview-hourheight-level-2","b-dayview-hourheight-level-3","b-dayview-hourheight-level-4"),a.level&&l.add(`b-dayview-hourheight-level-${a.level}`),l.toggle("b-six-minute-ticks",!!e.sixMinuteTicks),E.syncClassList(t,l),e.element.style.setProperty("--time-axis-width",`${b}em`),v.setProperty("--day-length",o),v.setProperty("--day-height",`${d}px`),v.setProperty("--hour-height",`${r}px`),v.setProperty("--half-hour-height",`${u}px`),v.setProperty("--fifteen-minute-height",`${h}px`),v.setProperty("--twelve-minute-height",`${g}px`),v.setProperty("--ten-minute-height",`${f}px`),v.setProperty("--six-minute-height",`${m}px`),v.setProperty("--five-minute-height",`${p}px`),v.setProperty("--leaf-tick-height",`${e.sixMinuteTicks?m:p}px`),v.setProperty("--second-height",`${c}px`),v.setProperty("--day-start-offset",`${n}px`),v.setProperty("--short-event-height",`${E.setLength(e.shortEventHeight||"")}`),(i=e.onRefreshDayBackground)==null||i.call(e),a.level!==(s==null?void 0:s.level)&&(e.tickRenderer&&e.doRefresh(),e.trigger("tickChange",{old:s||eE,new:a}))}updateSixMinuteTicks(i){this.isConfiguring||this.updateElementLayout()}changeHourHeightBreakpoints(i){return Array.isArray(i)?i:Object.values(i)}updateHourHeightBreakpoints(){this.isConfiguring||this.updateElementLayout()}get hourHeightLevel(){const i=this,{hourHeight:e,hourHeightBreakpoints:t,sixMinuteTicks:r}=i,n=r?NL:VL;for(let s=r?2:3;s>=0;s--)if(e>=t[s])return i._hourHeightLevel={level:s+1,step:n[s]};return i._hourHeightLevel=eE}updateLocalization(){!this.isConfiguring&&this.allDayTextElement&&oe.sync({targetElement:this.allDayTextElement,domConfig:{text:this.L("L{EventEdit.All day}")}}),super.updateLocalization()}};y(ui,"$name","DayView"),y(ui,"type","dayview"),ui.initClass(),ui._$name="DayView";var{MILLIS_PER_HOUR:jL}=Me,UL=new L(0,0,0,0),GL={column:"column",vertical:"column",row:"row",horizontal:"row"},xs=class extends ui{constructor(){super(...arguments),y(this,"allowDragCreate",!1),y(this,"allowDragResizee",!1)}static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0},scrollToVisibleStartTime:{type:"raf",cancelOutstanding:!0}}}getPositionFromTime(i){var e;if(Me.parse(i)<Me.parse(this.dayStartTime)-this.dayStartShift)return 0;const t=Me.parse(i)/(1e3*60*60),r=(e=this.eventContentElement.querySelector("[data-date]"))==null?void 0:e.querySelector(`[data-hour="${t}"]`);return r?r.offsetTop+r.offsetHeight:0}getDateFromDomEvent(i,e=!1){const t=this,r=E.getEventElement(i),n=this.getDateFromElement(r);if(n&&r!==i&&t.dayContainerElement.contains(r)){let s=r.closest("[data-hour]"),a=parseInt((s==null?void 0:s.dataset.hour)||0);s||(s=[...r.querySelectorAll(`[data-hour]${t.hideEmptyHours?".b-has-events":""}`)].at(-1),a=Math.min(parseInt((s==null?void 0:s.dataset.hour)||-1)+1,t.dayEndHour-1)),n.setHours(a)}return n}getDateFromPosition(i,e,t=!1,r){const n=this,{eventContentElement:s,allDayEvents:a}=n,l=t?UL:L.fromScreen(s).roundPx().translate(-s.scrollLeft),o=s.scrollWidth,d=t?i:i-l.x,c=n.rtl?n.eventContentElement.offsetWidth-d:d,u=e-l.y,h=n.getDayElementFromX(i),g=h.offsetHeight,f=n.getDateFromElement(h,r)||n.date;if(a&&(c<0||o<c||u<0||g<u))return a.getDateFromPosition(i,e,r);C.clearTime(f,!1);const m=[...h.querySelectorAll(".b-day-agenda-hour")];let p,v;for(v=0,p=m[v];v<m.length&&u>=p.offsetTop&&u>p.offsetTop+p.offsetHeight;p=m[v],v++);f.setHours(parseInt(p.dataset.hour));const b=(u-p.offsetTop)/p.offsetHeight;return f.setMilliseconds(f.getMilliseconds()+b*jL),C[n.timeSnapType](f,n.increment)}getBaseDayDomConfig(i){var e;const t=this,{dateFilter:r,resource:n}=t,s=t.dayTime.dateKey(i),a=t.cellMap.get(s)||t.cellMap.set(s,t.createCellData(i)).get(s),{day:l}=a,o=t.hiddenNonWorkingDays[l]&&t.duration!==1||t.hideEmptyDays&&!t.getEventsForDay(s).length||r&&!t.callback(r,t,[a]);if(t.getConfig("showCurrentTime"),!o){const d=t.nonWorkingDays||t.month.nonWorkingDays,c=[];return t.eachHour((u,h)=>{h.setHours(u),c.push({className:{"b-day-agenda-hour":1,"b-has-events":0},dataset:{hour:u},children:{time:{className:{"b-day-agenda-hour-time":1},text:C.format(h,t.timeAxisTimeFormat)},events:{className:{"b-day-agenda-hour-events":1},children:[]}}})}),[a,{tabIndex:-1,role:"gridcell","aria-label":`${C.format(i,"dddd Do MMMM")}${n?` ${n.name}`:""}, ${t.L("L{eventCount}",((e=a.events)==null?void 0:e.length)||0)}.`,dataset:{date:s},className:{"b-dayview-day-detail":1,[t.dayCellCls]:1,[t.nonWorkingDayCls]:d[l]||!1,[t.weekendCls]:C.weekends[l],[t.todayCls]:!(i-t.today),"b-last-cell":!(i-t.lastVisibleDate),[`b-day-of-week-${l}`]:1},style:{},children:c,syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}}getDayDomConfig(i){const e=this,t=e.getBaseDayDomConfig(i);if(t){const{dayCellRenderer:r}=e,[n,s]=t;return e.renderEvents(n,s),E.normalizeChildren(r?e.callback(r,e,[s,n]):s)}}renderEvents(i,e){for(const t of i.events){const r=e.children[t.startDate.getHours()-this.dayTime.startHour];if(r){const n=this.createEventDomConfig({date:i.date,eventRecord:t});this.insertActionButtons(n.children[0].children[0].children,t,i),r.className["b-has-events"]=1,r.children.events.children.push(n)}}this.trigger("renderEvents",i)}onInternalResize(i,e,t,r){super.onInternalResize(...arguments),e!==r&&this.syncHourHeights&&this.syncHeights()}changeShowCurrentTime(){return!1}onDayContentMousewheel(){}zoomBy(){}zoomTo(){}async zoomToFit(){}get dayStartOffset(){return 0}changeEventLayout(){}syncCurrentTimeIndicators(){}updateEventSpacing(i){this.element.style.setProperty("--event-spacing",E.setLength(i)),this.refreshDayBackground()}updateMinEventWidth(i){this.element.style.setProperty("--min-event-width",E.setLength(i)),this.refreshDayBackground()}updateHourSpacing(i){this.element.style.setProperty("--hour-event-padding-top",E.setLength(i)),this.refreshDayBackground()}updateGutterWidth(i){this.element.style.setProperty("--gutter-width",E.setLength(i)),this.refreshDayBackground()}updateHideEmptyHours(i){this.element.classList.toggle("b-hide-empty-hours",!!i),this.refreshDayBackground()}updateHideTimeAxis(i){this.element.classList.toggle("b-hide-timeaxis",!!i),this.refreshDayBackground()}updateHideBorders(i){this.element.classList.toggle("b-hide-borders",!!i),this.refreshDayBackground()}updateBorderColor(i){this.element.style.setProperty("--hour-border-color",i)}changeEventFlowDirection(i){return GL[i]}updateEventFlowDirection(i){this.element.style.setProperty("--event-flow-direction",i),this.element.classList.toggle("b-event-flow-row",i==="row"),this.refreshDayBackground()}updateSyncHourHeights(i){this.element.classList.toggle("b-synced-hour-heights",!!i),this.refresh()}updateOverHour(i,e){var t,r;e&&((t=this.getHourElement(e))==null||t.classList.toggle("b-hover-hour",!1)),i&&((r=this.getHourElement(i))==null||r.classList.toggle("b-hover-hour",!0))}getHourElement(i){var e;return(e=this.getDayElement(i))==null?void 0:e.querySelector(`[data-hour="${i.getHours()}"]`)}onDayCellConfigGenerated(i){if(this.syncHourHeights){const{timeAxisElement:e}=this;this.eachHour((t,r,n)=>{const s=i.some(l=>l.children[n].className["b-has-events"]),a=e.querySelector(`[data-hour="${t}"]`);i.forEach(l=>l.children[n].className["b-has-events"]=s),a.classList.toggle("b-has-events",s)})}}onRefreshDayBackground(){var i;(i=super.onRefreshDayBackground)==null||i.call(this),this.whenVisible("syncHeights")}syncHeights(){const i=this,{timeAxisElement:e,dayContainerElement:t,syncHourHeights:r}=i;i.contentElement.style.setProperty("--hour-height",i.hideEmptyHours&&i.hideBorders?"auto":`${i.hourHeight}px`),t.querySelectorAll(".b-day-agenda-hour").forEach(n=>n.style.minHeight=""),i.eachHour(n=>{const s=[...t.querySelectorAll(`.b-day-agenda-hour[data-hour="${n}"]`)],a=r?`${Math.max(...s.map(o=>o.offsetHeight))}px`:"",l=e.querySelector(`[data-hour="${n}"]`);s.forEach(o=>{o.style.minHeight=a}),l.style.minHeight=a})}getTimeElementConfigs(){const i=[];return this.eachHour((e,t)=>{i.push({className:{"b-day-agenda-hour":1},dataset:{hour:e},children:[{className:"b-day-agenda-hour-time",text:C.format(t,this.timeAxisTimeFormat)}]})}),i}};y(xs,"$name","DayAgendaView"),y(xs,"type","dayagenda"),y(xs,"configurable",{shortEventCls:"",increment:"1 h",showCurrentTime:!1,hourHeight:55,showTime:{startTime:!0,endTime:!0},hourSpacing:"0.5em",hideEmptyHours:null,hideTimeAxis:null,borderColor:null,hideBorders:null,title:"L{dayAgenda}",timeSnapType:"floor",gutterWidth:10,eventFlowDirection:null,eventSpacing:5,syncHourHeights:null,minEventWidth:null,overHour:null}),xs.initClass(),xs._$name="DayAgendaView";var tE=/^(\d+)ev$/,YL={shrinkwrap:1,expand:1},Rs=class extends ki.mixin(gr,lo,bg){static get configurable(){return{eventSorter:jc.interDaySorterFn,localizableProperties:["title","stepUnit"],title:"L{Month}",stepUnit:"L{monthUnit}",dragUnit:"day",localeClass:this,descriptionFormat:"MMMM YYYY",dayNumberCentered:null,showWeekNumber:!0,eventHeight:20,minHeight:485,autoRowHeight:{$config:"lazy",value:!1},persistShrinkWrappedRows:null,maxEventsPerCell:100,minRowHeight:null,overflowClickAction:"popup",alwaysRefreshOnMonthChange:!0}}onCalendarKeyDown(i){const e=this,{dayTime:t,eventContentElement:r}=e,{target:n}=i,s=`.${this.dayCellCls}`,a=n.closest(s)||n,l=a.matches(s),o=l?"date":"header-date",d=a.dataset[l?"date":"headerDate"],c=t.parseKey(d);let u,h;switch(i.key){case"ArrowUp":i.preventDefault(),u=-7;break;case"ArrowDown":i.preventDefault(),u=7;break;case"ArrowLeft":i.preventDefault(),u=-1;break;case"ArrowRight":i.preventDefault(),u=1;break;default:return super.onCalendarKeyDown(i)}const g=C.add(c,u,"d"),f=u>0?e.nextSibling:e.previousSibling;for(;e.hiddenNonWorkingDays[g.getDay()];)g.setDate(g.getDate()+Math.sign(u));if(h=r.querySelector(`${s}[data-${o}="${t.dateKey(g)}"]`),!h&&f){const m=u>0?e.firstVisibleDate:e.lastVisibleDate;h=f.eventContentElement.querySelector(`${s}[data-${o}="${t.dateKey(m)}"]`)}h==null||h.focus()}get eventContainerHeight(){const i=this,{classList:e}=i.weeksElement;return i._eventContainerHeight==null&&i.isVisible&&!i.isConfiguring&&(e.add("b-measuring-container-height"),i._eventContainerHeight=super.eventContainerHeight,e.remove("b-measuring-container-height")),i._eventContainerHeight}onCalendarStoreChange(){super.onCalendarStoreChange(...arguments),this.syncShrinkwrappedRows()}onDateChange({changes:i}){if(i.m){const e=this,{autoRowHeight:t}=e;t&&e.weekElements.forEach(({classList:r})=>r.add("b-shrinkwrapped")),e.persistShrinkWrappedRows||t?e.syncShrinkwrappedRows():e.shrinkwrappedRows.forEach(r=>e.flexWeekRow(r))}}onCellOverflowGesture({date:i}){YL[this.overflowClickAction.toLowerCase()]?this.shrinkwrapWeekRow(i):super.onCellOverflowGesture(...arguments)}addCellHeaderContent(i,e){const t={className:{"b-day-name":!0},role:"button"};return i.children=[e.visibleColumnIndex||this.showWeekColumn?null:{tabIndex:0,role:"link","aria-label":this.L("L{Calendar.weekOfYear}",e.week),className:"b-week-num",text:e.week[1]},t],t}get shrinkwrappedRows(){return this.weeksElement.querySelectorAll(".b-shrinkwrapped")}get shrinkwrapRowHeights(){const i=this,e=[],{cellMap:t}=i;return i.month.eachWeek((r,[n])=>{let s=0;for(let a=0;a<7;a++,n.setDate(n.getDate()+1)){const l=t.get(C.makeKey(n));l&&(s=Math.max(s,l.renderedEvents.length))}e.push(s)}),e.map(r=>i.eventHeightInPixels*r+i.eventSpacing*(r+1)+Math.ceil(i._eventContainerTop))}getEventsPerCell(i){const e=this;if(e.hasShrinkwrappedRows){const t=Math.floor(C.diff(e.startDate,i,"d")/7);if(e.weekElements[t].classList.contains("b-shrinkwrapped"))return e.maxEventsPerCell;{const r=e.weekElements[t].querySelector(e.visibleCellSelector),n=r.offsetHeight-e.eventContainerTop;return Math.floor((n+e.eventSpacing)/(e.eventHeightInPixels+e.eventSpacing))}}else return e.eventsPerCell}getMaxEventsForWeek(i){const{row:e}=this.getWeekContext(i);return Math.max(...Array.from(e.querySelectorAll(this.visibleCellSelector)).map(t=>{const r=this.cellMap.get(t.dataset.date);return(r==null?void 0:r.renderedEvents.length)||0}))}getWeekContext(i){var e,t;let r=this,n,s,a;if(typeof i=="number")a=i,n=C.parseKey((e=r.weekElements[i].querySelector("[data-date]"))==null?void 0:e.dataset.date);else if(i.nodeType===1)n=C.parseKey((t=i.closest(".b-calendar-row").querySelector("[data-date]"))==null?void 0:t.dataset.date),a=Math.floor(C.diff(r.startDate,n,"d")/7);else{const l=(i.getDay(i)-r.weekStartDay+7)%7;n=C.add(C.clearTime(i),-l,"d"),a=Math.floor(C.diff(r.startDate,i,"d")/7)}if(n)for(s=new Date(n);r.hiddenNonWorkingDays[s.getDay()];)s.setDate(n.getDate()+1);return{rowIndex:a,weekStart:n,visibleWeekStart:s,row:r.weekElements[a]}}shrinkwrapWeekRow(i,e=!0){const t=this,{weekStart:r,row:n}=t.getWeekContext(i),{maxEventsPerCell:s,eventContainerTop:a}=t,l=n.classList.contains("b-shrinkwrapped"),o=t.getMaxEventsForWeek(i),d=s?Math.min(s,o):o,c=t.eventHeightInPixels*d+t.eventSpacing*(d+1)+Math.ceil(a),u=o>t.eventsPerCell,h=n.querySelector(".b-week-toggle-tool");if(e&&(t.scrollable={overflowY:"auto"}),n.classList.add("b-shrinkwrapped"),n.classList.contains("b-empty-row")?n.style.flex="":(h&&(h.dataset.btip=t.L("L{WeekExpander.collapseTip}")),n.classList.remove("b-has-overflow"),n.classList.toggle("b-expanded",u),n.style.flex=u?`0 0 ${c}px`:`1 0 ${c}px`),t.hasShrinkwrappedRows=!0,e&&t.refresh(),l||t.trigger("weekShrinkwrap",{weekStart:r,element:n}),e)return t.isAnimating||(t.isAnimating=!0),new Promise(g=>{V.onTransitionEnd({element:n,property:"flex-basis",handler:"onAllWeekElementsExpanded",thisObj:t,args:[g]})})}onAllWeekElementsExpanded(i,e,t){this.isAnimating=!1,this.syncCalendarWeekDaysWithScrollable(),t()}async flexWeekRow(i,e=!0,t=!1){const r=this,{weekStart:n,row:s}=r.getWeekContext(i),a=s.querySelector(".b-week-toggle-tool");s.classList.contains("b-shrinkwrapped")&&(s.style.flex="",s.classList.add("b-flexing"),a&&(a.dataset.btip=this.L("L{WeekExpander.expandTip}")),r.trigger("weekFlex",{weekStart:n,element:s}),r._autoRowHeight=!1,e&&!r.isAnimating&&await r.executeAndAwaitAnimations(r.element,()=>r.isAnimating=!0),e?r.onAllWeekElementsFlexed(s,t):r.onWeekElementFlexed(s))}onWeekElementFlexed(i){i.classList.remove("b-shrinkwrapped","b-flexing","b-expanded")}onAllWeekElementsFlexed(i,e){const t=this;t.scrollable.overflowY=t.scrollable.hasOverflow("y"),e?t.shrinkwrappedRows.forEach(r=>r.classList.remove("b-shrinkwrapped","b-flexing","b-expanded")):i.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),t.isAnimating=!1,t.hasShrinkwrappedRows=t.shrinkwrappedRows.length,t.refresh(),t.syncCalendarWeekDaysWithScrollable()}syncCalendarWeekDaysWithScrollable(){var i;this.weekdaysHeader.classList[(i=this.scrollable)!=null&&i.hasScrollbar()?"add":"remove"]("b-show-yscroll-padding")}updateHideOtherMonthCells(){super.updateHideOtherMonthCells(...arguments),this.refresh()}updateEventHeight(i,e){var t;const r=this;if(super.updateEventHeight(i,e),!r.isConfiguring){(t=r.minRowHeight)!=null&&t.match(tE)&&r.updateMinRowHeight(r._minRowHeight),r.syncShrinkwrappedRows();const n=E.getEdgeSize(r.element,"padding","tb");r.minHeight=((r.eventHeightInPixels+1)*2+r.eventSpacing*3+Math.ceil(r.eventContainerTop))*6+r.weekdaysHeader.offsetHeight+7+n.height}}updateMinRowHeight(i){var e,t;const r=this,n=parseInt((t=(e=i==null?void 0:i.match)==null?void 0:e.call(i,tE))==null?void 0:t[1]);if(!isNaN(n)){if(r.isConfiguring)return r.ion({paint:"updateMinRowHeight",args:[i],once:!0});i=r.eventHeightInPixels*n+r.eventSpacing*(n+1)+Math.ceil(r.eventContainerTop)}super.updateMinRowHeight(i),r.isAnimating?r.ion({animationEnd:"performResizeRefresh",thisObj:r,args:[r._eventsPerCell,r._eventContainerTop],once:!0}):r.performResizeRefresh(r._eventsPerCell,r._eventContainerTop)}changeMaxEventsPerCell(i){return i==null?this.constructor.configurable.maxEventsPerCell:i}updateMaxEventsPerCell(){this.isConfiguring||this.syncShrinkwrappedRows()}async updateAutoRowHeight(i,e){var t,r;if(this.initializingAutoRowHeight&&i===!!e)return;const n=this,{visibleWeekCount:s}=n,a=(r=n.features||((t=n.calendar)==null?void 0:t.features))==null?void 0:r.weekExpander;let l;if(a&&i&&(a.disabled=a.disabledByAutoRowHeight=!0),i)for(let o=0;o<s;o++)l=n.shrinkwrapWeekRow(o,o===s-1);else for(let o=0;o<s;o++)l=n.flexWeekRow(o,o===s-1,!0);await l,a&&i&&a.disabledByAutoRowHeight&&(a.disabled=a.disabledByAutoRowHeight=!1),i||(n._eventContainerHeight=n._eventsPerCell=null,n.refresh())}syncShrinkwrappedRows(){if(this.isVisible){const{shrinkwrappedRows:i}=this;for(let e=0,t=Math.min(i.length,this.visibleWeekCount);e<t;e++)this.shrinkwrapWeekRow(i[e],e===t-1)}else this.whenVisible("refreshNow"),this.whenVisible("syncShrinkwrappedRows")}changeScrollable(i,e){return i=super.changeScrollable(i,e),i!=null&&i.overflowX&&(this.weekdaysScrollable||(this.weekdaysScrollable=new At({widget:this,element:this.weekdaysHeader,overflowX:"hidden-scroll"})),i.addPartner(this.weekdaysScrollable,"x")),i}async scrollTo(i,e){const t=this,{scrollable:r}=t,n=typeof i=="string"?C.parse(i):new Date(i),s=!isNaN(n);if(await t.scrollPromise,!t.isDestroyed&&(await super.scrollTo(s?n:i,{x:!1,y:!1}),s&&r)){const{firstVisibleDate:a,lastVisibleDate:l}=t;l.setHours(23,59,59),n.setTime(C.clamp(n,a,l));let o=n.getDay()===(t.weekStartDay+6)%7?-1:1;for(;!E.isVisible(t.getDayElement(n));){if((n<a||n>l)&&(o=-o,o<0))return;n.setDate(n.getDate()+o)}i=t.getDayElement(n),i&&r.scrollIntoView(i,T.assign({},t.defaultScrollOptions,typeof e=="boolean"?{animate:e}:e))}}collectEvents(i){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;i.startDate=new Date(e,t,1),i.endDate=new Date(e,t+1,1)}return i.getDateIndex=e=>Number(e)===Number(this.firstVisibleDate||this.startDate)?"date":"startDate",super.collectEvents(i)}getDayElement(i,e){if(typeof i!="string"&&(i=C.makeKey(i)),!(e&&parseInt(i.substr(5,2))!==this.month.month+1))return super.getDayElement(i)}calendarHitTest(i){var e,t;const r=super.calendarHitTest(i),n=E.getEventElement(i);if(r){if(r.date.getMonth()!==this.month.month&&(this.disableOtherMonthCells||this.hideOtherMonthCells))return;const s=n.closest(".b-calendar-week"),a=(e=s==null?void 0:s.dataset.week)==null?void 0:e.split(",").map(Number);a&&(r.cell=r.cell||n.closest(".b-calendar-cell"),r.dayNumber=Number((t=r.cell)==null?void 0:t.dataset.columnIndex),r.week=a,r.weekElement=s,r.weekNumber=a[1],r.weekOffset=a[1]-Number(this.weeksElement.firstElementChild.dataset.week.split(",")[1]))}return r}getDateFromPosition(i,e){const t=this,r=t.weeksElement.childNodes;for(let n,s=0;s<r.length;++s)if(n=r[s].getBoundingClientRect(),n.top<=e&&e<n.bottom&&n.left<=i&&i<n.right){const a=t.rtl?n.right-i:i-n.x,l=Math.floor(a*t.weekLength/n.width);if(t.hideNonWorkingDays)return Array.from(r[s].querySelectorAll(t.visibleCellSelector)).map(d=>t.getDateFromElement(d))[l];{const o=t.getDateFromElement(r[s].querySelector(t.visibleCellSelector));return o.setDate(o.getDate()+l),o}}return null}getWeekElementFor(i){const e=E.getEventElement(i);return(e==null?void 0:e.closest(".b-calendar-week"))||null}updateEventStore(i,e){var t;(t=super.updateEventStore)==null||t.call(this,i,e),ki.prototype.doRefresh.call(this)}updateOverflowClickAction(){this.refresh()}updateSixWeeks(){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null,super.updateSixWeeks(...arguments)}onMonthDateChange({changes:i}){i.r&&!this.sixWeeks&&(this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null),super.onMonthDateChange(...arguments)}doRefresh(){var i;const e=this,{weekElements:t}=e;e.isConfiguring||(e.getConfig("autoRowHeight"),(i=e._cellMap)==null||i.clear());const r=super.doRefresh();for(let n=0,{length:s}=t;n<s;n++){const a=t[n],l=Array.prototype.reduce.call(a.querySelectorAll(e.visibleCellSelector),(o,d)=>{const c=e.cellMap.get(d.dataset.date);return o+((c==null?void 0:c.renderedEvents.length)||0)},0);a.classList.toggle("b-empty-row",!l)}return e.syncCalendarWeekDaysWithScrollable(),r}showEvent(i){this.setDate(i.startDate)}changeDayNumberCentered(i){return!!i}updateShowWeekColumn(i){!i&&!this.element.querySelector(".b-week-num")&&this.doRefresh(),super.updateShowWeekColumn(i)}updateShowWeekNumber(i){this.element.classList.toggle("b-show-week-number",i)}updateHideNonWorkingDays(i){var e;(e=super.updateHideNonWorkingDays)==null||e.call(this,i),this.isConfiguring||this.refresh()}updateDayNumberCentered(i){const e=this;!e._dayNumberCentered&&!("nonCenteredDayNumShowWeekColumn"in e)&&(e.nonCenteredDayNumShowWeekColumn=e.showWeekColumn),e._dayNumberCentered=i,e.element.classList[i?"add":"remove"]("day-number-center"),e.showWeekColumn=i?!0:e.nonCenteredDayNumShowWeekColumn}get dayNameSelector(){return this.showWeekColumn?".b-cal-cell-header":super.dayNameSelector}set dayNameSelector(i){this._dayNameSelector=i}set startDate(i){this.date=i}get startDate(){return super.startDate}next(){this.date=C.add(this.date||this.startDate,1,"month")}previous(){this.date=C.add(this.date||this.startDate,-1,"month")}};y(Rs,"$name","MonthView"),y(Rs,"type","monthview"),y(Rs,"delayable",{syncCalendarWeekDaysWithScrollable:{type:"raf",cancelOutstanding:!0},onAllWeekElementsFlexed:{type:"raf",cancelOutstanding:!0}}),Rs.initClass(),Rs._$name="MonthView";var co=class extends ui{static get configurable(){return{localizableProperties:["title"],title:"L{Week}",range:{magnitude:1,unit:"week"},responsive:{small:{descriptionFormat:"Wp YYYY"},large:{descriptionFormat:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"]},"*":{descriptionFormat:["MMMM YYYY","S{MMM} - E{MMM YYYY}"]}},week:null,fixedDuration:!0}}calculateDuration(){return 7}updateWeekStartDay(i,e){var t;if((t=super.updateWeekStartDay)==null||t.call(this,i),!this.isConfiguring){const r=new Date(this.startDate);r.setDate(r.getDate()+i-e),this.startDate=r}}changeMonth(){const i=super.changeMonth(...arguments);return i.ion({weekChange:"onMonthWeekChange",thisObj:this}),i}onMonthWeekChange({source:i,newDate:e}){var t;((t=this.range)==null?void 0:t.unit)==="week"&&(this.week=i.getWeekNumber(e))}changeWeek(i,e){var t,r;const n=this;if(i=Array.isArray(i)?i:[n.month.year,i],!T.isEqual(i,e)){const s=n.minDate||((t=n.calendar)==null?void 0:t.minDate),a=n.maxDate||((r=n.calendar)==null?void 0:r.maxDate);if(!isNaN(s)||!isNaN(a)){const{month:l}=n,o=l.getWeekStart(i),d=C.add(o,n.duration,"d");if(!isNaN(s)&&d<=s)return l.getWeekNumber(s);if(!isNaN(a)&&o>a)return l.getWeekNumber(a)}return i}}updateWeek(i){const e=this,{month:t,date:r,dayTime:n}=e;(!r||!T.isEqual(t.getWeekNumber(r),i))&&(e.date=n.shiftDate(t.getWeekStart(i))),e.week=t.getWeekNumber(e.date)}};y(co,"$name","WeekView"),y(co,"type","weekview"),co.initClass(),co._$name="WeekView";var qL={hover:1,mouseover:1},KL=new String,XL=(i,e)=>i+e.renderedEvents.filter(t=>!t.isOverflow).length,uo=class extends Xe.mixin(gr,lo,bg){static get configurable(){return{textContent:!1,localizableProperties:["title","stepUnit"],title:"L{Year}",scrollable:{overflowY:!0},stepUnit:"L{yearUnit}",dragUnit:"day",month:!0,date:{$config:{equal:"date"},value:null},descriptionFormat:"YYYY",year:null,monitorResize:!1,showWeekColumn:!0,hideWeekColumnCls:"b-hide-week-numbers",otherMonthCls:"b-other-month",sixWeeks:!0,dayCellRenderer:null,monthSelector:".b-yearview-month-name",focusable:!1,showEvents:"heatmap",maxDots:null,eventDots:{marginTop:4,max:4,gap:3,size:5},eventCountTip:null}}onCalendarKeyDown(i){var e,t,r,n,s,a,l,o,d,c,u,h,g,f,m,p,v;const{dayTime:b,eventContentElement:w}=this,{target:D}=i,S=`.${this.dayCellCls}:not(.b-other-month)`,x=`${S}>[tabIndex]`,R=`:is(.b-week-number-cell>[tabIndex],${x})`,M=D.closest(x)||D;if(i.key==="Escape"){i.preventDefault(),(t=(e=M.closest(".b-yearview-month"))==null?void 0:e.querySelector(".b-yearview-month-name"))==null||t.focus();return}if(M.matches(x)){const _=b.parseKey(M.parentNode.dataset.date);switch(i.key){case"ArrowUp":i.preventDefault(),(r=w.querySelector(`${S}[data-date="${b.dateKey(C.add(_,-7,"d"))}"]>[tabIndex]`))==null||r.focus();break;case"ArrowDown":i.preventDefault(),(n=w.querySelector(`${S}[data-date="${b.dateKey(C.add(_,7,"d"))}"]>[tabIndex]`))==null||n.focus();break;case"ArrowLeft":i.preventDefault(),(s=Ti.getVisitor(w,R).previous(M))==null||s.focus();break;case"ArrowRight":i.preventDefault(),(a=Ti.getVisitor(w,R).next(M))==null||a.focus();break;case"PageUp":i.preventDefault(),_.setMonth(_.getMonth()-1),_.setDate(Math.min(_.getDate(),C.getLastDateOfMonth(_))),(l=w.querySelector(`${S}[data-date="${b.dateKey(_)}"]>[tabIndex]`))==null||l.focus();break;case"PageDown":i.preventDefault(),_.setMonth(_.getMonth()+1),_.setDate(Math.min(_.getDate(),C.getLastDateOfMonth(_))),(o=w.querySelector(`${S}[data-date="${b.dateKey(_)}"]>[tabIndex]`))==null||o.focus();break;default:return super.onCalendarKeyDown(i)}}else if(M.matches(".b-week-number-cell > [tabIndex]")){const _=b.parseKey(M.parentNode.nextSibling.dataset.date);let k,F;switch(i.key){case"ArrowUp":i.preventDefault(),k=C.getWeekNumber(C.add(_,-1,"w")),F=`[data-week="${k[0]},${k[1]}"]:not(.b-other-month)>.b-week-number-cell>[tabIndex]`,(d=M.closest(".b-yearview-month").querySelector(F)||w.querySelector(F))==null||d.focus();break;case"ArrowDown":i.preventDefault(),k=C.getWeekNumber(C.add(_,1,"w")),(c=w.querySelector(`[data-week="${k[0]},${k[1]}"]:not(.b-other-month)>.b-week-number-cell>[tabIndex]`))==null||c.focus();break;case"ArrowLeft":i.preventDefault(),(u=Ti.getVisitor(w,R).previous(M))==null||u.focus();break;case"ArrowRight":i.preventDefault(),(h=Ti.getVisitor(w,R).next(M))==null||h.focus();break;case"PageUp":i.preventDefault(),k=C.getWeekNumber(C.add(_,-6,"w")),(g=w.querySelector(`[data-week="${k[0]},${k[1]}"]>.b-week-number-cell>[tabIndex]`))==null||g.focus();break;case"PageDown":i.preventDefault(),k=C.getWeekNumber(C.add(_,6,"w")),(f=w.querySelector(`[data-week="${k[0]},${k[1]}"]>.b-week-number-cell>[tabIndex]`))==null||f.focus();break;default:return super.onCalendarKeyDown(i)}}else if(M.matches(".b-yearview-month-name")){const _=b.parseKey(M.dataset.monthDate);switch(i.key){case"ArrowDown":i.preventDefault(),(m=M.parentElement.querySelector(R))==null||m.focus();break;case"ArrowLeft":i.preventDefault(),(p=w.querySelector(`[data-month-date="${b.dateKey(C.add(_,-1,"M"))}"]`))==null||p.focus();break;case"ArrowRight":i.preventDefault(),(v=w.querySelector(`[data-month-date="${b.dateKey(C.add(_,1,"M"))}"]`))==null||v.focus();break;default:return super.onCalendarKeyDown(i)}}else return super.onCalendarKeyDown(i)}createCellMap(i){const e=super.createCellMap(i={skipPropagate:!0,...i});for(const t of e.values())t.renderedEvents.setEvents(t.events);return e}get date(){return this._date||!this.isConfiguring&&this.firstEventDate||new Date(this.year,0,1)}next(){this.date=new Date(this.year+1,this.date.getMonth(),this.date.getDate())}previous(){this.date=new Date(this.year-1,this.date.getMonth(),this.date.getDate())}get firstEventDate(){const i=[...this.cellMap.values()];if(i.length)return i[0].date}get lastEventDate(){const i=[...this.cellMap.values()];if(i.length)return i[i.length-1].date}onCalendarPointerInteraction(i){var e,t;const r=this,n=super.onCalendarPointerInteraction,{target:s,type:a}=i;if((a==="mousedown"||a.endsWith("click"))&&r.clearTimeout(r.cellOverflowTimer),a==="mousedown"&&((e=r._overflowPopup)!=null&&e.isVisible)&&s.closest(".b-cal-cell-overflow")&&i.preventDefault(),r.overflowPopupTrigger==="click"&&((t=r.autoCreate)==null?void 0:t.gesture)==="dblclick"&&a==="click"&&s.closest(`.${r.emptyCellCls}`)&&!r.emptyCellRenderer)r.cellOverflowTimer=r.setTimeout({fn:n,delay:300,args:[i]});else return n.apply(r,arguments)}changeMonth(i,e){const t=this,r={name:"yearChangeListener",yearChange:"onMonthYearChange",thisObj:t};return t.detachListeners("yearChangeListener"),i instanceof _i?(i.ion(r),t._year=i.year):i=new _i({date:new Date(t.year||new Date().getFullYear(),0,1),weekStartDay:t.weekStartDay,hideNonWorkingDays:t.hideNonWorkingDays,nonWorkingDays:t.nonWorkingDays,sixWeeks:t.sixWeeks,internalListeners:r}),t.nonWorkingDays==null&&(t.nonWorkingDays=t._month.nonWorkingDays),t._year=i.year,i}onMonthYearChange({source:{year:i,date:e}}){var t;const r=this;r._year=i,r.isConfiguring||((t=r._cellMap)==null||t.clear(),r.date=e,r.refresh())}scrollTo(i,e={animate:!0}){const t=this;if(i=t.ingestDate(i.isEventModel?i.startDate:i),!C.betweenLesser(i,t.startDate,t.endDate)||!t.getDayElement(i,!0))t.date=i;else{const r=t.eventContentElement.querySelector(`[data-month-index="${i.getMonth()}"]`);r&&t.scrollable.scrollIntoView(r,e)}}get eventsPerCell(){return 0}get startDate(){return this.month.getOtherMonth(new Date(this.year,0,1)).startDate}get endDate(){return C.add(this.month.getOtherMonth(new Date(this.year,11,1)).endDate,1,"day")}set startDate(i){this.date=i}updateDate(i){this.month.date=i,this.isVisible&&!this.isConfiguring&&this.scrollTo(i)}changeYear(i){return this.isConfiguring?i:(this.month.year=i,this.month.year)}changeShowEvents(i,e){return i===!0?"heatmap":i}updateShowEvents(i,e){const t=this,{classList:r}=t.contentElement;i&&r.add(`b-show-events-${i}`),r.remove(`b-show-events-${e}`),t.isConfiguring||t.whenVisible(()=>{t.doRefresh(),t.scrollTo(t.date)})}changeEventDots(i){const e=this;return new Proxy(i,{set(t){const r=Reflect.set(...arguments);return e.updateEventDots(t),r}})}updateEventDots({marginTop:i,gap:e,size:t,stripe:r}){const{style:n,classList:s}=this.contentElement;n.setProperty("--event-count-margin-top",`${i}px`),n.setProperty("--event-count-dot-size",`${t}px`),n.setProperty("--event-count-dot-gap",`${e}px`),s[r?"add":"remove"]("b-event-count-dots-striped"),this.isConfiguring||this.refresh()}updatemaxDots(i){re.deprecate("calendar","7.0.0","maxDots property is deprecated in favor of eventDots"),this.eventDots.max=i,this.updateEventDots(this.eventDots)}updateShowWeekNumber(){this.bodyElement.classList[this.showWeekColumn?"remove":"add"](this.hideWeekColumnCls)}createCellData(i){return this.month.month=i.getMonth(),super.createCellData(i)}doRefresh(){var i;const e=this,{bodyElement:t,month:r,dayCellCls:n,otherMonthCls:s,weekendCls:a,todayCls:l,nonWorkingDayCls:o,emptyCellCls:d,cellMap:c,showEvents:u,eventCountTip:h}=e,g=[],f=((i=e.calendar)==null?void 0:i.today)||new Date,m=C.makeKey(f);for(let p=0;p<12;p++){r.month=p;const v=`${r.year}-${String(r.month+101).substring(1)}`,b=[...c.values()].filter(F=>F.key.startsWith(v)).reduce(XL,0),w=C.getMonthName(p),D={tabIndex:0,role:"link",className:"b-yearview-month-name",html:w,"aria-label":`${w} ${e.year}. ${e.L("eventCount",b)}`,dataset:{monthDate:C.makeKey(new Date(e.year,p,1))}},S=[{className:"b-week-number-cell"}],x={"aria-hidden":!0,className:"b-calendar-week b-calendar-weekdays",children:S},R={role:"grid",className:"b-calendar-weeks",children:[]},M={role:"presentation",className:"b-yearview-month",children:[D,x,R],dataset:{monthIndex:p}},_=R.children;g.push(M);let k=0;r.eachWeek((F,I,A,P)=>{var H;if(S.length===1)for(let Q=0;Q<7;Q++)S.push({className:{"b-yearview-weekday-cell":1,[o]:e.nonWorkingDays[r.canonicalDayNumbers[Q]]},text:C.format(I[Q],"d1")});const G=p===0&&A===0,q=p===11&&P,W={role:"row",className:{"b-calendar-week":1},dataset:{week:`${F[0]},${F[1]}`}},j=W.children=[{role:"gridcell",className:"b-week-number-cell"}];_.push(W);let se=0,J=0;for(let Q=0;Q<7;Q++){const X=I[Q],ee=X.getMonth()!==r.month,ce=C.makeKey(X),ae=X.getDay(),Ie=!e.isConfiguring&&c.get(ce),ue=Ie==null?void 0:Ie.events,Ne=ee?0:(ue==null?void 0:ue.length)||0,ye=Ne,Ee={role:"gridcell",style:{},className:{"b-day-name":1,[n]:1,[d]:!Ne},dataset:{date:ce,cellIndex:k,columnIndex:Q}};se+=Ne;let Ye=String(X.getDate());if(Object.assign(Ee.className,{[a]:C.weekends[ae],[l]:ce===m&&!ee,[o]:e.nonWorkingDays[ae],[s]:ee,"b-cal-cell-overflow":ye,[to.getEventCountClass(Ne)]:ye,[`b-day-of-week-${ae}`]:1}),e.dayCellRenderer){const xe=e.callback(e.dayCellRenderer,e,[{cellConfig:Ee,date:X,events:((H=Ie==null?void 0:Ie.events)==null?void 0:H.map(he=>he.eventRecord))||[]}]);xe!=null&&(Ye=xe)}if(h&&!qL[e.overflowPopupTrigger]){const xe=Ne?e.L("L{ResourceInfoColumn.eventCountText}",Ne):h.showNoEvents?e.L("L{noEvents}"):null;if(xe){const he=ve.encodeConfig(h);Ee.dataset={...Ee.dataset,...he,btip:xe}}}if(u==="dots"){const{max:xe}=e.eventDots,he=[];for(let st=0;st<Math.min(Ne||0,xe);st++){const Do=e.createEventDomConfig({date:X,eventRecord:ue[st].eventRecord,eventColor:xe>1?null:KL,minimal:!0});he.push(Do)}Ye=[typeof Ye=="object"?Ye:{tag:"span",html:Ye},{className:"b-cal-minimal-event-container",children:he}]}else if(u==="count"){const xe=Ne;Ye=[typeof Ye=="object"?Ye:{tag:"span",html:Ye},xe?{dataset:{count:xe},class:{"b-cell-events-badge":1},text:xe}:null]}Ee.children=[{className:"b-calendar-cell-inner",[typeof Ye=="string"?"html":"children"]:Ye}],ee?J++:(Ee.children[0].role="link",Ee.children[0].tabIndex=-1,Ee.children[0]["aria-label"]=`${C.format(X,"dddd Do MMMM")}, ${e.L("eventCount",Ne)}`),j.push(Ee),k++}J===7?j[0].text=F[1]:j[0].children=[{className:"b-calendar-cell-inner",tabIndex:-1,role:"link",text:F[1],"aria-label":`${e.L("L{Calendar.weekOfYear}",F)}, ${e.L("eventCount",se)}`}],W.className["b-other-month"]=J===7||J>3&&!(G||q)?1:0})}oe.sync({targetElement:t,domConfig:{children:g}}),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}getDayElement(i,e){if(typeof i!="string"&&(i=C.makeKey(i)),!(e&&parseInt(i.substr(0,4))!==this.year))return this.contentElement.querySelector(`.b-calendar-cell[data-date="${i}"]:not(.b-other-month)`)}getCell(){return this.getDayElement(...arguments)}onInternalPaint({firstPaint:i}){i&&this.refresh(),this.setTimeout(()=>this.scrollTo(this.date,{animate:!1}),10)}};y(uo,"$name","YearView"),y(uo,"type","yearview"),uo.initClass(),uo._$name="YearView";var ZL=C.startOf(new Date),iE=Object.freeze(new Map),JL={hourHeight:1,showAllDayHeader:1,dayStartTime:1,dayEndTime:1},rE=["range","shiftIncrement","allowOverlap","timeFormat","coreHours","fitHours","hourHeight","visibleStartTime","dateFormat","dayStartTime","dayEndTime","hideNonWorkingDays","nonWorkingDays","readOnly","zoomOnMouseWheel","filterEventResources","tickRenderer","project"],Gc=(i,e,t)=>{if(e)for(const r of t)!(r in i)&&e[r]!==void 0&&(i[r]=e[r]);return i},QL=i=>!i.isSpecialRow,un=class extends Xe.mixin(gr){construct(){var i,e,t;super.construct(...arguments),(t=(e=(i=this.calendar)==null?void 0:i.sidebar)==null?void 0:e.widgetMap.resourceFilter)==null||t.ion({change:"onResourceFilterSelectionChange",thisObj:this})}get isDateRangeOwner(){return this.viewType.isDateRangeOwner}snapDate(i){var e,t;return((t=(e=this.views[0]).snapDate)==null?void 0:t.call(e,...arguments))||i}get isAnimating(){return super.isAnimating||this.items.some(i=>i.isAnimating)}changeScrollable(i){return i=super.changeScrollable(...arguments),i&&Object.defineProperty(i,"viewport",{get:this.getScrollingViewport.bind(this)}),i}getScrollingViewport(){const{dayViewTimeAxis:i,dayViewScroller:e}=this,t=e.isVisible?e.width:0,r=L.client(this.scrollable.element);return this.rtl?r.adjust(t,0,-i.width,0):r.adjust(i.width,0,-t,0)}changeView(i){const e=this,t=new Proxy(T.assign({},i),{set(r,n,s){const a=Reflect.set(...arguments);return e.syncViewConfig(n,s),a},deleteProperty(r,n){const s=Reflect.deleteProperty(...arguments);return e.syncViewConfig(n,null),s}});return e.viewType=bryntum.Calendar.Modes.resolveType(i.type),t}eachView(i,e,t=null){const r=e==null,n=[...this.viewCache];for(let s=0,{length:a}=n;s<a;s++){const l=n[s];if(r&&(e=[l,s]),l.callback(i,t||l,e)===!1)return}}get views(){return[...this.viewCache]}updateResourceStore(i){var e;this.detachListeners("resourceViewResourceChange"),(e=super.updateResourceStore)==null||e.call(this,i),i.ion({name:"resourceViewResourceChange",change:"onResourceStoreChange",sort:"onResourceStoreSort",thisObj:this}),this.refreshSoon()}updateViewGap(i){this.element.style.setProperty("--view-gap",E.setLength(i||-1))}onResourceStoreChange(){this.refreshSoon()}onResourceStoreSort({source:i}){const e=this.items.filter(n=>n.isVisible&&!n.isResourceDayViewTimeAxis),t=i.map(n=>this.createViewId(n)),r=e.map(n=>n.id);T.isEqual(t,r)||(this.remove(...e),this.refreshSoon())}onResourceFilterSelectionChange(){this.refreshSoon()}changeViewCache(i,e){if(i)return new ia;e&&(e.forEach(t=>t.destroy()),e.clear())}getResourceView(i){return i=i.isResourceModel?i:this.resourceStore.getById(i),this.viewCache.get(this.createViewId(i))||this.createView(i)}doRefresh(){var i,e,t;const r=this,{scrollBarWidth:n}=E,{calendar:s,_items:a,resourceStore:l}=r,o=s==null?void 0:s.widgetMap.resourceFilter,d=r.resourceStore.records.filter(p=>(!o||o.value.includes(p))&&QL(p)),{length:c}=d,u=[],h=[],g={};if(!l.count){const{weekStartDay:p}=r,v=C.getFirstDateOfMonth(r.date),b=C.add(v,1,"month");r.eventStore.getEvents({startDate:C.add(v,-(v.getDay()-p+7)%7,"d"),endDate:C.add(b,7-(b.getDay()-p+7)%7,"d")})}r.refreshSoon.cancel();let f=0;for(let p=0;p<c;p++){const v=r.getResourceView(d[p]),b=a.includes(v);l.getById(v.resourceId)?(v.title=r.titleTemplate(v.resource),b?f++:u.push(v),g[v.id]=1):b&&h.push(v)}f<a.count&&(r.eachView(p=>{g[p.id]||h.push(p)}),r.remove(h)),r.viewType.isDayView&&(a.includes(r.dayViewTimeAxis)||u.unshift(r.dayViewTimeAxis),n&&!a.includes(r.dayViewScroller)&&u.push(r.dayViewScroller));const m=(e=(i=r.items[0])==null?void 0:i.scrollable)==null?void 0:e.y;if(r.add(...u),m!=null&&u.forEach(p=>{p.scrollable.element.scrollTop=m,p.removeListener("scrollToVisibleStartTime")}),u.length||h.length){let p;for(let v=0,{items:b}=r,{length:w}=b;v<w;v++){const D=b[v],{scrollable:S}=D;D.element.classList.remove("b-last-resource-view"),D.isResourceDayViewTimeAxis||(D.element.classList[v>1?"remove":"add"]("b-first-resource-view"),p=D),S&&(S.clearPartners(),v&&D.scrollable.addPartner(b[v-1].scrollable,"y")),(t=D.allDayEvents)==null||t.refresh()}if(p&&p.element.classList.add("b-last-resource-view"),r.viewType.isDayView){const v=r.views.filter(w=>w.allDayEvents&&w.isVisible),b=v.length&&Math.max(...v.map(w=>w.allDayEvents.cellContentHeight));b&&a.forEach(w=>{var D;(D=w.allDayEvents)==null||D.setEventContentHeight(b,!1,!0)})}}r.viewType.isDayView&&r.syncDayViewScrollerVisibility(),r.refreshCount=(r.refreshCount||0)+1,r.trigger("refresh")}onCalendarPointerInteraction(){}onCalendarStoreChange(){}onChildAdd(i){super.onChildAdd(i),be.before(i,"onConfigChange","onChildViewConfigChange",this,{return:!1})}onChildViewConfigChange({name:i,value:e,applied:t}){const r=this;t===2&&!r.syncingChildViewConfigs&&!r.syncingViewConfig&&r.timeAxisConfigs.includes(i)&&(r.viewSyncConfigs||(r.viewSyncConfigs={},r.queueMicrotask("flushViewSyncConfigs")),r.viewSyncConfigs[i]=e)}flushViewSyncConfigs(){var i;const e=this,{viewSyncConfigs:t}=e,r=T.copyProperties({},t,["startDate","endDate"]);delete t.startDate,delete t.endDate,Object.assign(r,t);const n=new Set(e.items.concat([...e.viewCache]));e.syncingChildViewConfigs=!0,n.forEach(s=>s.setConfig(r)),e.views.length&&(e.date=(i=e.views[0])==null?void 0:i.date),e.syncingChildViewConfigs=e.viewSyncConfigs=!1}createViewConfig(i){const e=this,{id:t}=i,{viewCache:r,viewType:n}=e,s=[...r][0]||e,a=Z.merge({calendar:e.calendar,id:e.createViewId(i),cls:"b-resourceview-resource",defaultCalendar:t,resource:i,resourceId:t,includeTimeRanges:e.includeTimeRanges,weekStartDay:e.weekStartDay,parent:e,date:e.date,dateFormat:e.dateFormat,autoCreate:e.autoCreate,title:e.titleTemplate(i),syncCalendarDate:e.syncCalendarDate,showCurrentTime:{...e.showCurrentTime,showTime:!1}},e.view);return Gc(a,s,e.sharedConfigs),n.isDateRangeOwner&&s._endDate&&(a.endDate=s._endDate),e.visibleStartTime&&(a.visibleStartTime=e.visibleStartTime),e.hasConfig("startDate")&&(a.startDate=e.startDate,e.timeAxisConfigs.unshift("startDate")),n.isDayView&&(a.allDayEvents!==null&&(a.allDayEvents={...a.allDayEvents,fullWeek:!1,resource:i}),E.scrollBarWidth&&(a.scrollable={overflowX:!1,overflowY:"hidden-scroll"})),a}createView(i){var e;const t=this,{resourceStore:r,viewCache:n}=t,{id:s}=i,a=t.createViewConfig(i),l=bryntum.Calendar.Modes.create(a);return l.range||t.timeAxisConfigs.unshift("endDate"),l.ion({catchAll:"onChildViewCatchAll",thisObj:t}),l.element.removeAttribute("tabIndex"),l.element.dataset.resourceId=s,(e=l.contentElement)==null||e.removeAttribute("tabIndex"),Object.defineProperties(l,{weight:{get(){return t.stableResourceOrder?r.allIndexOf(s):0}},resource:{get(){return r.getById(s)}},eventFilter:{get(){return o=>o.resources.includes(this.resource)}}}),n.add(l),t.trigger("viewCreate",{view:l}),l}onChildViewCatchAll(i){const e=this,{type:t}=i;i.resourceRecord||(i.resourceRecord=i.source.resource),t==="rangechange"?e.triggerRangeChangeTimer||(e.triggerRangeChangeTimer=e.queueMicrotask(()=>{e.triggerRangeChangeTimer=null,e.trigger(i.eventName,{...i,source:e})})):t==="heightchange"?e.syncDayViewScrollerVisibility():t!=="paint"&&e.trigger(i.eventName,i)}changeAvatarRendering(i){if(i)return La.new({element:this.element},i)}titleTemplate(i){const e=this,{meta:t}=e,r=typeof t=="string"?i[t]:t==null?void 0:t(i),n=E.isNamedColor(i.eventColor)&&i.eventColor,s=!n&&i.eventColor;return{class:{"b-resourceview-title":1,"b-has-meta":r},children:[e.showAvatars&&T.merge({class:{[`b-sch-foreground-${n}`]:n},style:{color:s||null},reference:"resourceAvatar"},e.getResourceAvatar(i)),{class:"b-resource-name",text:i.name,reference:"resourceName"},r&&{class:"b-resource-meta",text:r,reference:"resourceMeta"}]}}getEventElement(i,e=i.startDate,t){var r;return(r=this.getResourceView(i.resource||t))==null?void 0:r.getEventElement(i,e)}get dayViewTimeAxis(){const i=this;if(!i._dayViewTimeAxis){const e=Gc({},i,i.timeAxisConfigs);Gc(e,i.view,i.timeAxisConfigs),delete e.endDate,i._dayViewTimeAxis=ho.create({...e,weight:-1,project:i.project,type:"resourcedayviewtimeaxis",minWidth:0,cls:"b-resource-dayview-timeaxis",startDate:i.date,scrollable:{overflowX:!1,overflowY:"hidden-scroll"},onCornerClick(){const{expanded:t}=i.firstChild.allDayEvents,r=[];let n=null;i.eachView(({allDayEvents:a})=>{t?(!n||a.maxEventCount<n.maxEventCount)&&(n=a):(!n||a.maxEventCount>n.maxEventCount)&&(n=a)});const s=n.refreshCount;n.expanded=!t,n.refreshCount===s&&r.push(n),i.items.forEach(a=>{if(a!==n){const{allDayEvents:l}=a,o=l.refreshCount;a.allDayEvents.expanded=!t,l.refreshCount===o&&r.push(l)}});for(let a=0,{length:l}=r;a<l;a++)r[a].doRefresh()}},i),Ge.addResizeListener(i._dayViewTimeAxis.timeAxisElement,i.syncDayViewScrollerVisibility.bind(i))}return i._dayViewTimeAxis}get dayViewScroller(){const i=this;if(!i._dayViewScroller){const e=Gc({},i,i.timeAxisConfigs);Gc(e,i.view,i.timeAxisConfigs),delete e.endDate,i._dayViewScroller=ho.create({...e,weight:999,project:i.project,type:"resourcedayviewtimeaxis",flex:`0 0 ${E.scrollBarWidth}px`,minWidth:E.scrollBarWidth,cls:"b-resource-dayview-scroller",startDate:ZL,scrollable:{overflowX:!1,overflowY:"scroll"}},i),i._dayViewScroller.scrollable.addPartner(i.dayViewTimeAxis.scrollable,"y"),i.monitorResize=!0}return i._dayViewScroller}onElementResize(){super.onElementResize(),E.scrollBarWidth&&this.syncDayViewScrollerVisibility()}syncDayViewScrollerVisibility(){if(this._dayViewScroller){const i=this.dayViewTimeAxis.scrollable.hasOverflow("y");this.dayViewScroller.isVisible!==i&&this.dayViewScroller[i?"show":"hide"]()}}async scrollTo(i,e){const{views:t}=this;if(i.isEventModel){const r=t.find(n=>n.eventStore.includes(i));if(r==null||r.scrollTo(...arguments),i=r.getEventElement(i),i)return this.scrollable.scrollIntoView(i,e)}return t[0].scrollTo(...arguments)}createViewId(i){return`${this.id}-resource${this.config.view.type}-${i.id}`}updateDate(i){const e=this,{_dayViewTimeAxis:t}=e;e.suspendVisibility(),e.viewCache.forEach(r=>{r.date=i}),e.resumeVisibility(),e.viewType.isDayView&&(e.items.forEach(r=>{var n,s;(s=r.allDayEvents)==null||s.setEventContentHeight((n=r.allDayEvents)==null?void 0:n.cellContentHeight)}),t&&(t.showCurrentTime=e.showCurrentTime,t.date=i))}updateResourceWidth(i){this.contentElement.style.setProperty("--resource-width",E.setLength(i))}updateShowCurrentTime(i){this.dayViewTimeAxis&&(this.dayViewTimeAxis.showCurrentTime={showTime:i==null?void 0:i.showTime}),this.isConfiguring||this.syncViewConfig("showCurrentTime",{...i,showTime:!1})}updateWeekStartDay(i,e){var t;(t=super.updateWeekStartDay)==null||t.call(this,i),this.isConfiguring||this.syncViewConfig("weekStartDay",i)}updateHideNonWorkingDays(i){this.isConfiguring||this.syncViewConfig("hideNonWorkingDays",i)}updateNonWorkingDays(i){this.isConfiguring||this.syncViewConfig("nonWorkingDays",i)}updateIncludeTimeRanges(i){this.isConfiguring||this.syncViewConfig("includeTimeRanges",i)}updateSyncCalendarDate(i){this.isConfiguring||this.syncViewConfig("syncCalendarDate",i)}syncViewConfig(i,e){const t=r=>{r[i]=e};this.syncingViewConfig=!0,JL[i]?this.items.forEach(t):this.eachView(t),this.syncingViewConfig=!1}descriptionRenderer(){var i;return((i=[...this.viewCache.items][0])==null?void 0:i.description)||"No resources"}updateRange(i){this.isConfiguring||this.views[0]&&(this.views[0].range=i)}set startDate(i){var e;const t=this;if(t._startDate=t.changeDate(i),(e=t.views)!=null&&e.length){const r={startDate:i},n=t.peekConfig("endDate");n&&(r.endDate=n),t.views[0].setConfig(r)}}get date(){var i;return((i=this.views[0])==null?void 0:i.date)||this._date}get startDate(){const{views:i}=this;return i.length?i[0].startDate:this._startDate||this.date}changeEndDate(i){return this.changeDate(i)}updateEndDate(i){var e;(e=this.views)!=null&&e.length&&(this.views[0].endDate=i)}get endDate(){var i;const e=this,{viewType:t}=e;let r,n=((i=e.views[0])==null?void 0:i.endDate)||e._endDate||(r=e.createViewConfig({id:"dummy"})).endDate;if(!n){const s=r.range||t.$meta.config.range;n=C.add(e.startDate,t.prototype.parseRange(s))}return n}get fixedDuration(){const{viewType:i}=this;if(i.isDayView){const e=[...this.viewCache][0];if(e)return e.fixedDuration;const t=this.createViewConfig({id:"dummy"});return!(t.range||t.endDate)}return!i.isDateRangeOwner}set shiftIncrement(i){(this.view||(this.view={})).shiftIncrement=i}get shiftIncrement(){const i=[...this.viewCache][0];return i==null?void 0:i.shiftIncrement}get stepUnit(){const i=[...this.viewCache][0];return i==null?void 0:i.stepUnit}get firstChild(){return this.items.filter(i=>!i.isResourceDayViewTimeAxis)[0]}set tickRenderer(i){(this.view||(this.view={})).tickRenderer=i}set hourHeight(i){(this.view||(this.view={})).hourHeight=i}get hourHeight(){var i,e,t;return((e=(i=this.views)==null?void 0:i[0])==null?void 0:e.hourHeight)||((t=this.view)==null?void 0:t.hourHeight)||ui.configurable.hourHeight}previous(){var i;(i=[...this.viewCache][0])==null||i.previous()}next(){var i;(i=[...this.viewCache][0])==null||i.next()}zoomTo(...i){var e,t;(t=(e=this.views)==null?void 0:e[0])!=null&&t.zoomTo&&this.eachView(r=>{r.isVisible&&r.zoomTo(...i)})}zoomBy(...i){var e,t;(t=(e=this.views)==null?void 0:e[0])!=null&&t.zoomBy&&this.eachView(r=>{r.isVisible&&r.zoomBy(...i)})}getDateFromPosition(i,e){for(const t of this.views){const r=t.getDateFromPosition(i,e);if(r)return r}}};y(un,"$name","ResourceView"),y(un,"type","resourceview"),y(un,"configurable",{layout:"box",textContent:!1,scrollable:{overflowX:!0},date:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},view:{type:"weekview"},viewGap:"0.5em",stableResourceOrder:!0,resourceWidth:null,hideNonWorkingDays:null,viewCache:{$config:["lazy","nullify"],value:!0},avatarRendering:{},meta:null,showAvatars:!0,includeTimeRanges:null,responsiveRoot:!0,range:null}),y(un,"properties",{sharedConfigs:rE,timeAxisConfigs:["allDayEvents"].concat(rE)});var ov=class extends Vi{get hasOverflow(){return this.up("resourceview").views.some(i=>{var e;return(e=i.allDayEvents)==null?void 0:e.hasOverflow})}createCellMap(){return iE}};y(ov,"$name","ResourceDayViewAllDayEvents"),y(ov,"type","resourcedayviewalldayevents");var ho=class extends ui{compose(){return super.compose()}onCalendarStoreChange(){}doRefresh(){this.syncCurrentTimeIndicators()}scrollToVisibleStartTime(){}createCellMap(){return iE}calculateCellContentHeight(){return 0}getDateFromPosition(i,e,t=!1){const r=this,n=r.startDate,s=t?0:r.dayContentElement.getBoundingClientRect().y,a=r.timeAxisElement.offsetHeight,l=e-s;return C.round(C.add(C.clearTime(n),r.dayStartMs+Math.floor(l/a*r.getDayLength()),"ms"),r.increment)}};y(ho,"$name","ResourceDayViewTimeAxis"),y(ho,"type","resourcedayviewtimeaxis"),y(ho,"configurable",{range:"1 day",allDayEvents:{type:"resourcedayviewalldayevents",disabled:"inert"}}),ov.initClass(),ho.initClass(),un.initClass(),un._$name="ResourceView";var eP=i=>!i.isSpecialRow,go=class extends Vi{get eventContentElement(){return this.bodyElement}expandGutter(){}get viewResources(){var i;const e=this,{resourceStore:t}=e,r=(i=e.calendar)==null?void 0:i.widgetMap.resourceFilter;return t.records.filter(n=>(!r||r.value.includes(n))&&eP(n))}onCellOverflowGesture({resourceRecord:i,date:e}){const t=this.cellMap.get(C.makeKey(e)),{renderedEvents:r}=t;t.renderedEvents=r.filter(n=>{var s;return(s=n.eventRecord.resources)==null?void 0:s.includes(i)}),super.onCellOverflowGesture(...arguments),t.renderedEvents=r}getCellFromEvent(i){return i.target.closest(".b-calendar-cell[data-date] [data-resource-id]")}createCellMap(){const i=super.createCellMap(...arguments),{viewResources:e}=this;return this.maxEventCount=0,i.forEach(t=>{for(let r=0,{length:n}=e;r<n;r++)this.maxEventCount=Math.max(this.maxEventCount,t.renderedEvents.filter(s=>{var a;return(a=s.eventRecord.resources)==null?void 0:a.includes(e[r])}).length)}),i}getCellDomConfig(i){var e,t;const r=this,{viewResources:n,eventsPerCell:s,showHeaderAvatars:a,hideEmptyResources:l,resourceDateFilter:o,resourceHeaderRenderer:d,resourceHeaderExtraRenderer:c}=r,{renderedEvents:u,date:h}=i,g=[],f=r.dayTime.startOfDay(((e=r.calendar)==null?void 0:e.dateTimeNow)||new Date),m=h.getTime()===f.getTime(),{maxRow:p,day:v}=i,b=r.nonWorkingDays||r.month.nonWorkingDays,w=l&&(((t=r.owner)==null?void 0:t.getEventsForDay(i.key,r.startDate))||u),D=n.reduce((x,R)=>{var M;i.resource=R;const _=(M=w==null?void 0:w.filter)==null?void 0:M.call(w,F=>{var I;return(I=F.resources)==null?void 0:I.includes(R)});return l&&!(_!=null&&_.length)||o&&!r.callback(o,r,[i])||x.push(R),x},[]);r.weekLength=1;for(let x=0,{length:R}=D;x<R;x++){const M=D[x];i.renderedEvents=u.filter(k=>{var F;return(F=k.eventRecord.resources)==null?void 0:F.includes(M)}),i.visibleColumnIndex=i.columnIndex=0,i.maxRow=i.renderedEvents.length>s?p:s;const _=super.getCellDomConfig(i);_.children[1].dataset={resourceId:M.id},g.push({className:"b-resourcecalendarrow-column-resource-cell",dataset:{resourceId:M.id},children:[_.children[1],i.hasOverflow&&i.renderedEvents.length>s?_.children[2]:null]})}g.length||g.push({className:"b-resourcecalendarrow-column-resource-cell"}),i&&(i.renderedEvents=u);const S={role:"gridcell",tabIndex:-1,className:{"b-dayresourcecalendarrow-column":1},style:{"--visible-resource-count":D.length},children:[{style:{"--visible-resource-count":D.length},role:"gridcell",tabIndex:-1,className:{"b-dayresource-allday":1,"b-cal-cell-header":1,[r.todayCls]:m,[r.nonWorkingDayCls]:b[v]||!1,[r.weekendCls]:C.weekends[v],[`b-day-of-week-${v}`]:1},children:[{className:{"b-dayname-date":1}},...D.length?D.map(x=>{let R;if(d||c){const M=x.events.filter(_=>C.intersectSpans(_.startDate,_.endDate,h,i.tomorrow));R={...i,resourceDayEvents:M}}return{className:{"b-dayresourcecalendarrow-resource-header":1,"b-avatar-after":a==="last","b-has-info":!!c},html:d?r.callback(d,r,[x,R]):void 0,children:d?void 0:[a?r.getResourceAvatar(x):null,{className:"b-dayresourcecalendarrow-resource-name",text:r.resourceNameRenderer(x)},c?{className:"b-dayresourcecalendarrow-resource-info",html:r.callback(c,r,[x,R])}:void 0],dataset:{resourceId:x.id}}}):[r.dummyResourceHeader]]},...g],dataset:{}};return r.addCellHeaderContent(S.children[0].children[0],i),S}get dummyResourceHeader(){return{className:{"b-dayresourcecalendarrow-resource-header":1},children:[this.showHeaderAvatars?{class:"b-resource-avatar"}:null,{className:"b-dayresourcecalendarrow-resource-name",text:"\xA0"}]}}updateMinResourceWidth(i){const{scrollable:e,headerScroller:t}=this;this.element.style.setProperty("--cell-container-overflow",i?"visible":"hidden"),i?e.overflowX=t.overflowX="hidden-scroll":e.overflowX=t.overflowX=!1}resourceNameRenderer(i){return i.name}updateShowHeaderAvatars(i){i&&(this.avatarRendering||(this.avatarRendering=!0)),this.refresh()}changeFullWeek(){}};y(go,"$name","DayResourceCalendarRow"),y(go,"type","dayresourcecalendarrow"),y(go,"configurable",{showHeaderAvatars:!0,resourceHeaderRenderer:null,resourceHeaderExtraRenderer:null,responsive:{small:{dayNameFormat:"ddd",dayNumberCompress:!1}},autoRefresh:["hideEmptyResources","resourceDateFilter"],hideEmptyResources:null,resourceDateFilter:null}),go.initClass(),go._$name="DayResourceCalendarRow";var tP=i=>!i.isSpecialRow,Ts=class extends ui{changeAllDayEvents(){const i=super.changeAllDayEvents(...arguments);return i&&(i.hideEmptyResources=this.hideEmptyResources,i.resourceDateFilter=this.resourceDateFilter),i}checkAutoCreateGesture(i,e,t){if(t)return super.checkAutoCreateGesture(...arguments)}onLayoutUpdate(){var i;this.syncNarrowResourceWidth(),(i=super.onLayoutUpdate)==null||i.call(this,...arguments)}onDayContainerResize(){var i;return this.syncNarrowResourceWidth(),(i=super.onDayContainerResize)==null?void 0:i.call(this,...arguments)}syncNarrowResourceWidth(){const i=this.element.querySelector(".b-dayresourcecalendarrow-resource-header");i&&this.allDayEvents.element.classList.toggle("b-narrow-resource-header",i.offsetWidth<100)}updateHideResourceNameWhenNarrow(i){var e;(e=this.allDayEvents)==null||e.element.classList.toggle("b-hide-resource-name-when-narrow",!!i)}updateHideEmptyResources(i){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.hideEmptyResources=i)}updateResourceDateFilter(i){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.resourceDateFilter=i)}changeMinResourceWidth(i){return i||this.constructor.configurable.minResourceWidth}updateMinResourceWidth(i){var e;this.element.style.setProperty("--min-resource-width",E.setLength(i)),this.updateElementLayout(),(e=this.allDayEvents)==null||e.updateMinResourceWidth(i)}updateShowHeaderAvatars(i){const{allDayEvents:e}=this;e&&(e.resourceImagePath=this.resourceImagePath,e.showHeaderAvatars=i)}updateWeekStartDay(i,e){var t;if((t=super.updateWeekStartDay)==null||t.call(this,i),!this.isConfiguring){const r=new Date(this.startDate);this.range.unit==="week"&&(r.setDate(r.getDate()+i-e),this.startDate=r)}}getDayDomConfig(i){const e=this,{hideEmptyDays:t,hideEmptyResources:r,dateFilter:n,resourceDateFilter:s}=e,a=e.dayTime.dateKey(i),l=i.getDay(),o=e.cellMap.get(a)||e.createCellData(i),d=(t||r)&&e.getEventsForDay(a);if(!(e.hiddenNonWorkingDays[l]&&e.duration!==1||e.hideEmptyDays&&!e.getEventsForDay(a).length||n&&!e.callback(n,e,[o]))){const u=e.dayTime.dateKey(i),h=o.events,g=[],{calendar:f,resourceStore:m}=e,p=f==null?void 0:f.widgetMap.resourceFilter,v=m.records.filter(b=>(!p||p.value.includes(b))&&tP(b));for(let b=0,{length:w}=v,D;b<w;b++){const S=e.resource=o.resource=v[b],x=M=>{var _;return(_=M.resources)==null?void 0:_.includes(S)},R=r&&!d.filter(x).length||s&&!e.callback(s,e,[o]);e.resourceId=S.id,o.events=h.filter(x),e._hideEmptyDays=!1,R||(D=super.getDayDomConfig(i),delete D.dataset.date,D.dataset.resourceId=S.id,g.push(D)),e.resource=e.resourceId=null}if(!g.length){o.events.length=0;const b=super.getDayDomConfig(i);delete b.dataset.date,g.push(b)}return o.events=h,e._hideEmptyDays=t,{className:{"b-dayresourceview-column":1,[`b-day-of-week-${o.day}`]:1},dataset:{date:u},children:g}}}};y(Ts,"$name","DayResourceView"),y(Ts,"type","dayresource"),y(Ts,"configurable",{minResourceWidth:"4em",showAvatars:!0,title:"L{dayResourceView}",allDayEvents:{type:"dayresourcecalendarrow"},range:"1w",showHeaderAvatars:!0,autoRefresh:["hideEmptyResources","resourceDateFilter"],hideEmptyResources:null,resourceDateFilter:null,hideResourceNameWhenNarrow:null}),Ts.initClass(),Ts._$name="DayResourceView";var nE=i=>i.isCalendarMixin||i.isScheduler,sE=i=>class extends zp(i||$){static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,datasetIdProperty:"eventId",itemsTabbable:!0,keys:{ArrowUp:null,ArrowDown:null,Escape:null,Tab:null,"SHIFT+Tab":null}}}}normalizeTarget(t){return t.eventRecord}processEvent(t){const{target:r}=t;if(t.key==="Enter"){if(r.closest(".b-sch-event-wrap"))return;if(r.role==="link"&&r.closest(".b-overflowpopup"))return E.triggerMouseEvent(r,"click"),t}return super.processEvent(...arguments)}changeNavigator(t){const r=this;return r.getConfig("eventCls"),super.changeNavigator(r.constructor.mergeConfigs({target:r.element,itemSelector:`.b-cal-cell-overflow,.b-cal-cell-no-content,${r.eventSelector}:not(.b-minimal),.b-sch-event-wrap`,skipScrollIntoView:!0},t))}onViewRefresh(){var t,r;const{activeItem:n}=this.navigator;if((t=super.onViewRefresh)==null||t.call(this,...arguments),n&&!((r=this.activeView._overflowPopup)!=null&&r.containsFocus)){const s=this.getEventRecord(n);this.navigator.updateActiveItem(s?this.getElementFromEventRecord(s):null,n)}}onCalendarStoreChange({action:t,records:r}){var n,s;const a=this,{navigator:l}=a,o=l==null?void 0:l.activeItem,d=(n=L.from(o))==null?void 0:n.center,{usingKeyboard:c}=E;if(o&&"eventId"in o.dataset&&!a.eventStore.includes(o.dataset.eventId)){const u=a.constructor.fromElement(o,nE)||a.activeView,{_overflowPopup:h,isScheduler:g}=u,f=g?u.navigator:a.navigator,m=f.next,p=E.findParent(o,E.isFocusable);if(g){const v=u.getCellElementFromDomEvent({target:o,clientY:d.y});return(m||f.previous||v).focus({preventScroll:!c})}if(m===o.nextSibling&&!m.parentNode.syncIdMap)f.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:m},m);else{let v=m||f.previous;if((!v||!p.contains(v))&&(v=p),h!=null&&h.containsFocus&&!h.contentElement.contains(v)){const{target:b}=h.lastAlignSpec;v=f.getAdjacent(1,b.nextSibling)||f.getAdjacent(-1,b)}if(!v||!a.element.contains(v))a.widgetMap.viewContainer.revertFocus(!0);else{const b=g?u.getDateFromXY([d.x,d.y],null,!1):u.getDateFromElement(v),w=v.dataset.eventId,D=a.constructor.fromElement(v).closest(nE);v.focus({preventScroll:!c}),D.ion({refresh:()=>{var S;w?(v=D.getEventElement(w,b),v&&(v===E.getActiveElement(v)?f.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:v},v):v.focus({preventScroll:!c})),f.updateActiveItem(v,o)):D.isCalendarRow&&((S=D.parent)!=null&&S.isDayView)&&!D.cellMap.size&&D.requestAnimationFrame(()=>D.parent.focusDate(v.dataset.date))},once:!0})}}}(s=super.onCalendarStoreChange)==null||s.call(this,...arguments)}onElementKeyDown(t){var r;t.target.closest(this.navigator.itemSelector)&&((r=super.onElementKeyDown)==null||r.call(this,t))}get activeEvent(){const{activeItem:t}=this.navigator;if(t)return this.resolveEventRecord(t)}get widgetClass(){}},aE=i=>{var e;return e=class extends Bp(i||$){normalizeTarget(t){return t.eventRecord}updateDeselectAllOnScheduleClick(t){this[t?"ion":"un"]({scheduleClick:"clearEventSelection"})}onSelectedCollectionChange({added:t,removed:r}){const n=this,s=n.selectedCollection,a=t||[],l=r||[];if(n.updateSelected(),!n.silent){const o=s.count>0?a.length>0&&l.length>0?"update":a.length>0?"select":"deselect":"clear";n.trigger("selectionChange",{action:o,selection:s.values,selected:a,deselected:l})}}onCalendarStoreChange({action:t,records:r}){var n;t==="remove"&&this.selectedCollection.remove(...r),(n=super.onCalendarStoreChange)==null||n.call(this,...arguments)}clearEventSelection(){this.selectedCollection.clear()}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(t){t=B.asArray(t),this.selectedCollection.splice(0,this.selectedCollection.count,t)}isEventSelected(t){return this.selectedCollection.includes(t)}select(t,r=!1){this.selectEvent(t,r)}selectEvent(t,r=!1){const{selectedCollection:n}=this;!this.isEventSelected(t)&&this.isEventSelectable(t)!==!1&&(r?n.add(t):n.splice(0,n.count,t))}deselect(t){this.deselectEvent(t)}deselectEvent(t){this.isEventSelected(t)&&this.selectedCollection.remove(t)}selectEvents(t){this.selectedCollection.add(t.filter(r=>this.isEventSelectable(r)!==!1))}deselectEvents(t){this.selectedCollection.remove(t)}onEventSelectionClick(t){this.isEventSelected(t)?le.ctrlKeyDown&&this.deselectEvent(t):this.selectEvent(t,this.multiEventSelect&&le.ctrlKeyDown)}onEventNavigate({event:t,item:r}){if(r){const n=this.activeView.getEventRecord(r);if(n){if(t.button===2&&this.isEventSelected(n))return;this.onEventSelectionClick(n)}else this.deselectAllOnScheduleClick&&this.clearEventSelection()}}get widgetClass(){}},y(e,"configurable",{deselectAllOnScheduleClick:!0,eventSelectedCls:"b-selected"}),e},iP={hide(){this.$overflowClone.hide()},show(){this.$overflowClone.show()}},Ms=class extends gt.mixin(In,ES,Aa){get childItems(){const i=super.childItems,{_button:e}=this;return e&&i.push(e),i}get hideNonWorkingDays(){var i;return(i=this.calendar)==null?void 0:i.hideNonWorkingDays}set hideNonWorkingDays(i){const{calendar:e}=this;e&&!(!i&&e.hideNonWorkingDays==null)&&(e.hideNonWorkingDays=i)}configure(i={}){this.isConstructing&&"minified"in i&&!("minifiable"in i)&&(i=T.assign({minifiable:!1},i)),super.configure(i)}changeIncludeWeekendsButton(i,e){var t;const r=this,n=i&&((t=r.calendar)==null?void 0:t.includeWeekendsButton);return n&&(i=Lt.mergeConfigs(i,n)),i&&!e?r.add(i):Lt.reconfigure(e,i,r)}updateIncludeWeekendsButton(i){i&&(i.toggleGroup=null),this.syncFullWeek()}changeIncludeWeekendsMenuItem(i,e){var t;const r=(t=this==null?void 0:this.button)==null?void 0:t.menu;return i&&!e?r==null?void 0:r.add(i):ai.reconfigure(e,i,r)}updateIncludeWeekendsMenuItem(){this.syncFullWeek()}onBeforeFirstShowModeMenu({menu:i}){const e=this,{calendar:t}=e,{activeView:r}=t,n=Object.values(t.modes);let s,a;for(a of n)s=a.$modeMenuItem,s.hidden=a.$modeSelectorItem.hidden,i.add(s),s.checked=a===r,s.onToggle="up.onToggleMenuItem";e.getConfig("includeWeekendsMenuItem"),e.syncFullWeek(),e.menuReady=!0}addMode(i,e,t){const r=this,{buttonBar:n,calendar:s}=r,a=e[r.titleProperty]||e.displayName||e.type,l=e.activationKey||a.charAt(0).toLowerCase(),o=a.toLowerCase().indexOf(l),d=e.$modeMenuItem=ai.reconfigure(e.$modeMenuItem,ai.mergeConfigs({type:ai,view:e,ref:`${i}ShowMenuItem`,checked:!1,closeParent:!0,toggleGroup:`${r.id}-modeSelectorMenuItem`,localizable:!1,text:[{text:a},{text:l.toUpperCase(),class:"b-menuitem-key"}],weight:0},t,e.selectorMenuItem)),c=e.$modeSelectorItem=d.$overflowClone=n.add(Lt.mergeConfigs({view:e,ref:`${i}ShowButton`,toggleGroup:`${r.id}-modeSelectorButton`,text:o<0?[a,{text:l.toUpperCase(),class:"b-button-key b-align-end"}]:[o?a.substring(0,o):null,{text:l[o?"toLowerCase":"toUpperCase"](),class:"b-button-key"},a.substring(o+1)],ariaLabel:a,localizable:!1,onBeforeToggle:"up.onBeforeToggleButton",onToggle:"up.onToggleButton",weight:0},t,e.selectorButton));e.$activateMode=u=>{var h;return s.setConfig({date:((h=u.target.closest("[data-date]"))==null?void 0:h.dataset.date)||s.date,mode:e})},d.ion(iP),(r.ownedWidgets||(r.ownedWidgets={}))[d.id]=d,s.addKeyBinding(l,e.$activateMode),s.addDescendant(d),r.getConfig("includeWeekendsButton"),e.ion({thisObj:r,localized(){const u=e[r.titleProperty]||e.displayName||e.type,h=(e.activationKey||u.charAt(0)).toLowerCase(),g=u.toLowerCase().indexOf(h);h!==l&&(s.removeKeyBinding(l,e.$activateMode),s.addKeyBinding(h,e.$activateMode)),c.text=g<0?[{text:u},{text:h.toUpperCase(),class:"b-button-key"}]:[g?{text:u.substring(0,g)}:null,{text:h.toUpperCase(),class:"b-button-key"},{text:u.substring(g+1)}],d.text=[{text:u},{text:h.toUpperCase(),class:"b-menuitem-key"}]}})}onBeforeToggleButton({pressed:i}){if(i&&this.calendar.viewContainer.layout.isChangingCard)return!1}onToggleButton({source:i,pressed:e}){e&&(this.calendar.mode=i.view)}updateDisabled(i,e){super.updateDisabled(i,e),this.buttonBar.items.forEach(t=>{(!i||!t.containsFocus)&&(t.disabled=i)})}onToggleMenuItem({source:i,checked:e}){e&&(this.calendar.mode=i.view)}onToggleWorkingDaysButton({pressed:i}){this.hideNonWorkingDays=!i}onToggleWorkingDaysMenu({checked:i}){this.hideNonWorkingDays=!i}syncActiveMode(i){var e;const t=this,r=t.buttonBar.items;let n;t.button.text=i.displayName,t.includeWeekendsButton.hidden=!i.hasNonWorkingDays,t.syncFullWeek();for(n of r)n.view&&(n.pressed=n.view===i);if(t.menuReady)for(n of t.button.menu.items)((e=n.view)==null?void 0:e.$modeMenuItem)===n&&(n.checked=n.view===i);t[r.length>1?"show":"hide"]()}syncFullWeek(){const{calendar:i,hideNonWorkingDays:e,_includeWeekendsButton:t,_includeWeekendsMenuItem:r}=this,n=!e;i.isConfiguring||(t&&(t.pressed=n),r&&(r.checked=n))}changeButton(i,e){return Lt.reconfigure(e,i)}updateButton(i){i&&this.add(i)}changeButtonBar(i,e){return Pn.reconfigure(e,i)}updateButtonBar(i){i&&this.add(i)}changeCalendar(i){return i&&!i.isWidget&&(i=this.up(i)),i}updateCalendar(i){this.detachListeners("cal"),this.syncFullWeek(),i==null||i.ion({name:"cal",changeHideNonWorkingDays:"syncFullWeek",thisObj:this})}};y(Ms,"$name","ModeSelector"),y(Ms,"type","calendarmodeselector"),y(Ms,"configurable",{minifiable:!0,titleProperty:"title",minified:null,button:{ref:"modeSelectorButton",type:"button",icon:"b-icon-calendar-days",cls:"b-calendar-mode-button",menu:[],internalListeners:{beforeShowMenu:"up.onBeforeFirstShowModeMenu",once:!0}},buttonBar:{type:"buttongroup",ignoreParentReadOnly:!0},calendar:{value:"calendar",$config:"lazy"},includeWeekendsButton:{$config:"lazy",value:{ref:"weekendsButton",type:"button",cls:"b-calendar-fullweek-button",toggleGroup:"no",text:"L{ModeSelector.weekends}",tooltip:"L{ModeSelector.includeWeekends}",onToggle:"up.onToggleWorkingDaysButton",weight:-1}},includeWeekendsMenuItem:{$config:"lazy",value:{ref:"weekendsMenuItem",separator:!0,text:"L{ModeSelector.includeWeekends}",checked:!1,onToggle:"up.onToggleWorkingDaysMenu",weight:10}},layout:{type:"box",wrap:!1},overflowable:"none",responsive:{large:{minifiable:!0,minified:null},"*":{minifiable:!1,minified:!0}},responsiveTarget:"@calendar"}),y(Ms,"fenced",{onToggleButton:!0,onToggleMenuItem:!0,syncFullWeek:!0,syncActiveMode:{all:"syncActiveMode",lock:["onToggleButton","onToggleMenuItem","syncActiveMode"]}}),Ms.initClass(),Ms._$name="ModeSelector";var _s=class extends ms{static get pluginConfig(){const i={};for(const e in super.pluginConfig)i[e]=[...super.pluginConfig[e]];return i.assign.push("beforeListRenderRow"),i}constructor(i){super(i.client,i),this.client.ion({cellOverFlowClick:"onScheduleClick",thisObj:this}),V.on({element:this.client.element,focusmove:"onFocusMove",thisObj:this})}onFocusMove(i){const e=this,{client:t}=e,{_target:r}=i,n=t.getDateFromDomEvent(r);if(n){const s=t.getEventRecord(r.closest("[class*=-event-wrap]"));s?e.targetTime=s.startDate:e.targetTime&&C.copyTimeValues(n,e.targetTime),e._cellClickedContext={date:n,domEvent:i,source:t.activeView,view:t.activeView,resourceRecord:e.client.resolveResourceRecord(r)}}else e._cellClickedContext-null}populateEventMenu(i){const{client:e}=this;this.fixEventData(i),super.populateEventMenu(i),e.activeView.isEventList&&!e.readOnly&&this.hasClipboardData()!==!1&&(i.items.pasteEvent={text:"L{pasteEvent}",localeClass:this,icon:"b-icon b-icon-paste",disabled:e.resourceStore.count===0||i.resourceRecord.readOnly,weight:110,onItem:({eventRecord:t})=>{this.pasteEvents(t.startDate)}})}onScheduleMenuPasteClick({date:i,resourceRecord:e,domEvent:t,feature:r}){const{activeView:n,constructor:s}=this.client,a=s.fromElement(r.menuContext.targetElement,l=>l.isCalendarMixin);!n.isResourceView&&!n.isDayResourceView&&(e=null),a!=null&&a.parent&&a.parent.allDayEvents===a&&(this._isPastingIntoAllDay=!0),this.pasteEvents(i,e)}onEventDataGenerated(i){this.fixEventData(i),super.onEventDataGenerated(i)}fixEventData(i){var e;if(!i.assignmentRecord){const{eventRecord:t,resourceRecord:r}=i;i.assignmentRecord=(e=r&&t.assignments.find(n=>n.eventId===t.id&&n.resourceId===r.id))!=null?e:t}}copyEvents(i,e){return i!=null&&i[0].isAssignmentModel&&(i=i.map(t=>t.event)),super.copyEvents(i,e)}pasteEvents(i,e){const{_cellClickedContext:t}=this,{isResourceView:r,isDayResourceView:n}=this.client.activeView;return i&&(this.targetTime=i),!i&&!e&&t&&(r||n)?super.pasteEvents(t.date,t.resourceRecord):super.pasteEvents(...arguments)}cloneData({data:i,isPaste:e}){var t,r;const n=super.cloneData({data:i,isPaste:e});return n.assignmentRecords=i.assignmentRecords.map(s=>{const a=s.copy(),l=i.eventRecords.find(o=>o.id===a.eventId);return a.event=n.eventRecords.find(o=>o.originalInternalId===l.internalId),a}),(t=n.eventRecords)==null||t.forEach(s=>delete s.meta.originalResourceId),e&&this._isPastingIntoAllDay&&((r=n.eventRecords)==null||r.forEach(s=>s.allDay=!0),this._isPastingIntoAllDay=!1),n}refreshClient(){var i;const{activeView:e}=this.client;this.client.refresh(),(i=e._overflowPopup)!=null&&i.isVisible&&e._overflowPopup.refresh(),e.isResourceView&&e.eachView(t=>t.refresh())}beforeListRenderRow({row:i,record:e}){i.cls["b-cut-item"]=e.assignments.some(t=>t.meta.isCut)}};y(_s,"$name","EventCopyPaste"),y(_s,"type","eventCopyPaste"),y(_s,"configurable",{allowNoAssignments:!0}),qe.register(_s.type,_s),_s._$name="EventCopyPaste";var fo=class extends ps{updateRecord(i){this.fixTimeFieldVisibility(i.allDay),super.updateRecord(i)}onAllDayChange({value:i,userAction:e}){this.fixTimeFieldVisibility(i,e)}fixTimeFieldVisibility(i,e){const t=i?"hide":"show",{startDateField:r,startTimeField:n,endDateField:s,endTimeField:a}=this.widgetMap;n==null||n[t](),a==null||a[t](),!i&&e&&(r&&(r.value=n.value=this.record.getData("startDate")),s&&(s.value=a.value=this.record.getData("endDate")))}onFocusOut(){super.onFocusOut(...arguments),this.owner=this.initialConfig.owner}};y(fo,"$name","EventEditor"),y(fo,"type","calendareventeditor"),y(fo,"configurable",{align:{monitorResize:!0}}),fo.initClass(),fo._$name="EventEditor";var rP=i=>i.isCalendar,ks=class extends Vl{construct(i){super.construct(i.client,i)}async onDragCreateEnd({eventRecord:i,resourceRecord:e}){i._dragCreated=!0,await this.editNewlyCreatedEvent(i,e),i._dragCreated=null}onEventAutoCreated({eventRecord:i}){this.editNewlyCreatedEvent(i)}editNewlyCreatedEvent(i,e){if(!this.disabled)return i.isCreating=!0,this.editEvent(i,e,null,!1)}async doEditEvent(i,e,t){var r,n,s,a,l,o;const d=this,{client:c}=d,{eventStore:u}=c,{startDate:h,endDate:g}=i;let f=c.eventSource||c.activeSubView;if(f.isScheduler){d.client=f,await super.doEditEvent(...arguments),d.client=c;return}if(!f.isCalendarMixin||(n=(r=f.features)==null?void 0:r.cellEdit)!=null&&n.isEditing)return;if(i.startDate&&i.endDate&&!C.intersectSpans(h,g,f.startDate,f.endDate)&&(c.date=i.startDate),f.allDayEvents&&f.isAllDayEvent(i)&&f.showAllDayHeader&&(f=f.allDayEvents),!i.isOccurrence){let w;u.includes(i)||(u.add(i),w=!0),(w||i._dragCreated)&&await f.afterRefresh({forceRefresh:!0})}const{_overflowPopup:m}=f,p=f.getDateFromElement(t);let v=m==null?void 0:m.isVisible,b=v?m.getEventElement(i):f.getEventElement(i,p);if(v&&(b?v=!1:b=m.getEventElement(i)),i.isCreating&&((s=c.onEventCreated)==null||s.call(c,i)),!b&&f.isEventList&&(b=(l=(a=f==null?void 0:f.rowManager)==null?void 0:a.getRowFor(i))==null?void 0:l.element),v)b.focus();else if(b){const w=E.isInView(b);!w||w.height<100&&b.offsetHeight>Math.ceil(w.height)||w.width<b.getBoundingClientRect().width?await At.scrollIntoView(b,{animate:!0,focus:!0,maxHeight:100}):b.focus({preventScroll:!0})}else{if(!f.isAllDayEvent(i)&&(!h||f.hiddenNonWorkingDays[h.getDay()])){d.internalShowEditor(i,null,{target:!0});return}h&&(!i.isCreating||!i._dragCreated)&&await f.scrollTo(i),b=f.getEventElement(i)}!b&&!t&&f.isDayCellRenderer&&(b=f.getCell(i.startDate)),!d.isDestroyed&&(d.internalShowEditor(i,null,{target:b||t,allowTargetOut:f.isAnimating}),(o=d.editor)!=null&&o.lastAlignSpec&&(d.editor.lastAlignSpec.allowTargetOut=!1))}async onSaveClick(){var i;const e=this,{eventRecord:t}=e,{isCreating:r}=t.meta;e.isValid&&(t.isCreating=!1);const n=await super.onSaveClick(...arguments);r&&n&&(e.eventStore.added.add(t),e.eventStore.usesSingleAssignment||e.assignmentStore.added.add(t.assignments),(i=e.client.crudManager)==null||i.onCrudStoreChange())}internalShowEditor(){var i,e,t,r;const{client:n,editor:s,startTimeField:a,endTimeField:l}=this,o=n.closest(rP)||n,d=(e=(i=o.activeView)==null?void 0:i.autoCreate)!=null?e:o.autoCreate||n.constructor.configurable.autoCreate,c=d==null?void 0:d.step,{activeSubView:u}=o,h=u==null?void 0:u._overflowPopup;if((r=(t=(n.isSchedulerBase?n.calendar:n).features.eventTooltip)==null?void 0:t._tooltip)==null||r.hide(),s.owner=h!=null&&h.isVisible?h:u,super.internalShowEditor(...arguments)===!1){s.owner=s.initialConfig.owner;return}c&&(a&&!a.initialConfig.step&&(a.step=c),l&&!l.initialConfig.step&&(l.step=c))}async finalizeStmCapture(i){}};y(ks,"$name","EventEdit"),y(ks,"type","eventEdit"),y(ks,"configurable",{editorConfig:{type:"calendareventeditor",items:{resourceField:{label:"L{Calendar}",showEventColor:!0},allDay:{type:"checkbox",cls:"b-match-label",name:"allDay",weight:250,label:"L{All day}",internalListeners:{change:"up.onAllDayChange"}}}}}),qe.register(ks.type,ks),ks._$name="EventEdit";var nP=i=>i.eventStore,Fs=class extends ys{populateEventMenu({items:i,eventRecord:e,assignmentRecord:t}){super.populateEventMenu(...arguments);const{client:r}=this;i.duplicate={disabled:e.readOnly||(t==null?void 0:t.readOnly),hidden:r.readOnly}}getDataFromEvent(i){var e;const{client:t}=this,{activeView:r}=t,{eventTooltip:n}=t.features;if(this.triggerEvent==="contextmenu"&&(n==null?void 0:n.showOn)==="contextmenu"&&n.enabled)i.preventDefault();else{r.isScheduler?this.client=r:(e=i.target.closest(".b-cal-event-wrap"))==null||e.focus();const s=super.getDataFromEvent(i);return this.client=t,s}}changeMenu(){const i=this,e=super.changeMenu(...arguments);return e==null||e.ion({beforeShow({source:t}){const{activeSubView:r}=i.client,{_overflowPopup:n}=r;t.owner=n!=null&&n.containsFocus?n:r}}),e}changeItems(i){return i=super.changeItems(...arguments),i.unassignEvent=null,i}};y(Fs,"$name","EventMenu"),y(Fs,"type","eventMenu"),y(Fs,"configurable",{menu:{scrollAction:"realign"},items:{duplicate:{text:"L{EventMenu.duplicateEvent}",icon:"b-icon b-icon-copy",weight:400,onItem({eventRecord:i}){const e=i.copy(null,{skipFieldIdentifiers:!0}),{eventStore:t}=this.up(nP),{resources:r}=i;e.name=`${i.name} (${this.L("L{EventMenu.copy}")})`,e.recurrence=null,r!=null&&r.length&&t.assignmentStore.assignEventToResource(e,r),t.add(e)}}},triggerEvent:null}),qe.register(Fs.type,Fs),Fs._$name="EventMenu";var sP=i=>i.eventStore,aP=["activeElement","client","clientListeners","disabled","showOn","tooltip"],mo=class extends qe{static get pluginConfig(){return{chain:["render"]}}get isVisible(){return!0}changeRecurrenceConfirmation(i,e){return i&&(i.rootElement=this.owner.rootElement),z.reconfigure(e,i,{owner:this})}changeTooltip(i,e){const t=this,r=t.config;return i&&(i=Ps.mergeConfigs({ownerFeature:t,forElement:t.client.element,id:`${t.client.id}-event-tip`,forSelector:t.showOn==="hover"&&".b-cal-event-wrap,.b-sch-event-wrap,.b-gantt-task-wrap,.b-taskboard-card",resources:t.resources,disabled:t.disabled,internalListeners:{thisObj:t,delete:"onDeleteClick",edit:"onEditClick",overTarget:"onTipPointerOver"}},i),Object.keys(r).forEach(n=>{!aP[n]&&(t.hasConfig(n)||n in t.initialConfig)&&(i[n]=r[n])})),Ps.reconfigure(e,i,t)}render(){const i=this,e={eventsPerCellChange:"onClientEventsPerCellChange",navigate:"onClientNavigate",renderEvents:"onRenderEvents",thisObj:i};i.showOn==="hover"?i.getConfig("tooltip"):(i.showOn==="contextmenu"&&(i.alignToDomEvent=!0),e[`event${i.showOn}`]=e[`task${i.showOn}`]="onClientTooltipGesture"),i.client.ion(e)}get owner(){var i;return(i=this.client.activeView._overflowPopup)!=null&&i.containsFocus?this.client.activeView.overflowPopup:this.client}addListener(...i){var e;(e=this.tooltip)==null||e.addListener(...i)}removeListener(...i){var e;(e=this.tooltip)==null||e.removeListener(...i)}onEditClick(){var i,e;const{client:t,activeClient:r,tooltip:n}=this,{overflowPopup:s}=r,a=((i=r==null?void 0:r.features)==null?void 0:i.eventEdit)||t.features.eventEdit,l=(e=s==null?void 0:s.element)==null?void 0:e.contains(n.activeTarget),o=l?s.targetCell:n.activeTarget;a&&!a.disabled&&(a.editEvent(this.eventRecord,null,o,!1),n.hide())}onDeleteClick(){this.activeClient.calendar.removeEvents([this.eventRecord],()=>{var i;return(i=this.tooltip)==null?void 0:i.hide()},this.tooltip)}onClientEventsPerCellChange(){var i,e;(e=this._tooltip)==null||e.requestAnimationFrame((i=this._tooltip)==null?void 0:i.hide)}onClientNavigate(i){var e;const{_tooltip:t}=this;t!=null&&t.activeTarget&&(!this.owner.owns(i.event)||i.item&&i.item!==t.activeTarget)&&!t.owns((e=i.event)==null?void 0:e.relatedTarget)&&t.hide()}onRenderEvents(i){const{_tooltip:e}=this;e!=null&&e.activeTarget&&!this.activeClient.element.contains(this.tooltip.activeTarget)&&e.hide()}onClientTooltipGesture({domEvent:i,event:e,eventElement:t,eventRecord:r,source:n}){const{tooltip:s}=this;i=i||e,this.onTipPointerOver({event:i,newTarget:t,eventRecord:r,owningCalendarWidget:n})!==!1&&(t.classList.contains("b-cal-in-cluster")&&(this.alignToDomEvent||nf(s.align.align).edgeAligned===2)?s.setTimeout({fn:"showByEvent",args:[i,t],delay:130}):s.showByEvent(i,t.closest("[data-event-id],[data-task-id]")))}onTipPointerOver({event:i,newTarget:e,owningCalendarWidget:t,eventRecord:r}){var n,s,a,l,o;const{tooltip:d,client:c}=this;return t||(t=(n=z.fromElement(e))==null?void 0:n.closest(sP)),r||(r=t.getEventRecord(e)),(a=(s=c.features)==null?void 0:s.eventEdit)!=null&&a.isEditing||(o=(l=c.activeView.features)==null?void 0:l.cellEdit)!=null&&o.isEditing||c.floatRoot.querySelector(".b-eventeditor,.b-taskeditor")?!1:(t&&(i&&(d.triggeredByEvent=i,d.activeTarget=e),this.activeClient=t,r=t.getEventRecord(e),d.eventRecord=this.eventRecord=r),r!=null)}updateDisabled(i,e){super.updateDisabled(i,e),this._tooltip&&(this._tooltip.disabled=i)}};y(mo,"$name","EventTooltip"),y(mo,"type","eventTooltip"),y(mo,"configurable",{showOn:"click",closable:!0,axisLock:"flexible",tooltip:{$config:["lazy","nullify"],value:{type:"eventTip"}},titleRenderer:i=>O.encodeHtml(i.name),renderer:null,recurrenceConfirmation:{$config:["lazy","nullify"],value:{type:"recurrenceconfirmation"}},extendAllDayEndDay:null,align:null,revealEventsInCluster:!0,resources:null,clickDelay:null,alignToDomEvent:null}),mo.initClass(),mo._$name="EventTooltip";var lE=i=>i.isCalendarMixin,Is=class extends qe{static get pluginConfig(){return{chain:["render"]}}changeTooltip(i,e){if(i){const t=this,{client:r}=t,n=ve.reconfigure(e,T.assign({},i,{id:`${r.id}-schedule-tip`,owner:r,forElement:r.viewContainer.element,getHtml:t.getHtml.bind(t),filterTarget:t.filterTarget.bind(t),internalListeners:{innerHtmlUpdate({source:s}){t.clockTemplate.updateDateIndicator(s.element,t.lastTime)}}}));return t.clockTemplate=new ur({scheduler:r,mode:"hour"}),n}}filterTarget({target:i}){var e;if(!le.isMouseDown()&&this.callback(this.showScheduleTip,this,[(e=z.fromElement(i))==null?void 0:e.closest(lE)]))return i.closest(".b-cal-event-wrap")?null:i}getHtml({tip:i,event:e,activeTarget:t}){var r,n;const s=this,a=(r=z.fromElement(t))==null?void 0:r.closest(lE),l=s.callback(s.showScheduleTip,s,[a])&&a.getDateFromDomEvent(e);if(l&&!(e.type==="pointermove"&&e.pointerType==="touch"&&Object.values(((n=s.client.features.drag)==null?void 0:n.zones)||{}).some(o=>o.dragging))){const{isDayView:o}=a,d=C.format(l,`${a.dateFormat}${o?" "+(a.timeFormat||"LST"):""}`);return s.lastTime=l,o?s.clockTemplate.generateContent({date:l,text:d}):d}i.hide()}onCalendarScroll(){const{tooltip:i}=this;if(i.isVisible){const{triggeredByEvent:e}=i;E.elementFromPoint(e.clientX,e.clientY).dispatchEvent(new Y.PointerEventConstructor("pointermove",e))}}render(){this.getConfig("tooltip"),V.on({element:this.client.element,scroll:"onCalendarScroll",thisObj:this,capture:!0})}updateDisabled(i,e){super.updateDisabled(i,e),this._tooltip&&(this._tooltip.disabled=i)}};y(Is,"$name","ScheduleTooltip"),y(Is,"type","ScheduleTooltip"),y(Is,"configurable",{showScheduleTip:i=>{var e;return(i==null?void 0:i.isDayView)||((e=i==null?void 0:i.viewType)==null?void 0:e.isDayView)},tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",allowOver:!0,hoverDelay:0,hideDelay:100,forSelector:"*",showOnHover:!0,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,layoutStyle:"white-space:nowrap"}}}),qe.register(Is.type,Is,!0),Is._$name="ScheduleTooltip";var lP=i=>i.isCalendarMixin,As=class extends jl{getDataFromEvent(i){const{client:e}=this,{activeView:t}=e,r=e.resolveResourceRecord(i)||e.defaultCalendar;t.isScheduler&&(this.client=t);const n=super.getDataFromEvent(i);return n.resourceRecord||(n.resourceRecord=r),this.client=e,n}shouldShowMenu({date:i,targetElement:e}){const{client:t}=this,{activeView:r}=t;if(r.isEventList&&!r.isAgendaView)return!1;if(r.isScheduler){this.client=r;const n=super.shouldShowMenu(...arguments);return this.client=t,n}return!!(i&&!e.closest(t.eventSelector))}populateScheduleMenu({items:i,domEvent:e,date:t}){super.populateScheduleMenu(...arguments);const{client:r}=this,{addEvent:n}=i,s=r.constructor.fromElement(this.menuContext.targetElement,lP);n&&(n.disabled=this.disableAddEvent,n.onItem=()=>{const a=r.activeView.getResourceRecord(e);r.activeView.trigger("beforeAutoCreate",{view:s,domEvent:e,date:t,resourceRecord:a})!==!1&&(s||r).createEvent(t,a,!0)})}get disableAddEvent(){const{resourceRecord:i,date:e}=this.menuContext;return i?i.readOnly||!i.isWorkingTime(e):!1}changeMenu(){const i=this,e=super.changeMenu(...arguments);return e==null||e.ion({beforeShow({source:t}){const{activeSubView:r}=i.client,{_overflowPopup:n}=r;t.owner=n!=null&&n.containsFocus?n:r}}),e}};y(As,"$name","ScheduleMenu"),y(As,"type","scheduleMenu"),y(As,"configurable",{menu:{scrollAction:"realign"},triggerEvent:null}),qe.register(As.type,As,!0),As._$name="ScheduleMenu";var oP=/^refresh$|.*event.*|.*resource.*|.*cell.*|.*row.*|.*schedule.*|daynumber.*|weeknumber.*|monthname.*|weekname.*$|beforedatechange|tickchange|.*showoverflowpopup|beforeautocreate|rangechange|weekflex|layoutupdate/,dP=i=>i.isCalendarMixin&&i.containsFocus,cP=Object.freeze([]),uP=i=>i.weight!=null,hP={weeknumberclick:1,monthnameclick:1},gP=i=>{var e;return i.isMonthView||((e=i.view)==null?void 0:e.type)==="monthview"},fP=i=>{var e;return i.isWeekView||((e=i.view)==null?void 0:e.type)==="weekview"},mP=i=>{var e;return((e=i.getAttribute)==null?void 0:e.call(i,"role"))!=="presentation"&&E.isFocusable(i)},oE=(i,e)=>T.hasOwn(i,e)&&(i[e]===null||i[e]===!1),pP=(i,e,t)=>{for(let r=0,{length:n}=t;r<n;r++){const s=t[r];!(s in i)&&e[s]!==void 0&&(i[s]=e[s])}},dv=class Mv extends Xe.mixin(K0,av,mm,Wp,sE,aE,c0,Aa,Po,np){static get configurable(){return{layout:"hbox",enableRecurringEvents:!0,localizableProperties:["autoCreate.newName"],crudManager:null,features:{drag:{},eventCopyPaste:{},eventEdit:{},eventTooltip:{},scheduleMenu:{},eventMenu:{}},navigatorPlacement:null,eventContainerSelector:".b-eventrenderer,.b-overflowpopup",responsive:{small:{when:600,once:{mode:"day"},dateFormat:"MMM DD, YYYY"},medium:{when:800},large:{overlaySidebar:!1},"*":{overlaySidebar:!0,once:{mode:"week"}}},responsiveRoot:!0,stateful:["hideNonWorkingDays","mode"],tbar:{cls:"b-calendar-toolbar",items:{toggleSidebar:{icon:"b-icon-menu-vertical",cls:"b-sidebar-toggle b-borderless b-transparent",onClick:"up.onToggleSidebarClick",tooltip:"L{Calendar.toggleSidebar}",weight:100},todayButton:{text:"L{Calendar.Today}",cls:"b-cal-nav-item b-calendar-today-button",icon:"b-icon-calendar-day",onClick:"up.shiftToNow",weight:200},prevButton:{onClick:"up.shiftPrevious",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-previous",weight:300},nextButton:{onClick:"up.shiftNext",cls:"b-cal-nav-item b-borderless b-transparent b-cal-nav-next",icon:"b-icon-next",weight:400},viewDescription:{cls:"b-calendar-view-desc",type:"widget",flex:"",html:"\xA0",overflowable:"none",weight:500},spacer:{type:"widget",cls:"b-toolbar-fill",weight:600},modeSelector:{type:"calendarModeSelector",weight:700}}},items:{},viewContainer:{$config:"lazy",value:{type:"container",role:"presentation",weight:100,cls:{"b-calendar-viewcontainer":1},flex:"1 1 100%",layout:{type:"card"},scrollable:{overflowY:!0,overflowX:!0},suppressChildHeaders:!0,layoutStyle:{padding:0},internalListeners:{beforeActiveItemChange:"up.onBeforeViewContainerCardChange",activeItemChange:"up.onViewContainerCardChange"}}},includeWeekendsButton:!1,layoutStyle:{padding:0,flexFlow:"row nowrap"},modes:{day:{},week:{},month:{},year:{},agenda:{}},mode:{$config:"lazy",value:"week"},modeDefaults:{value:null},sidebar:{$config:{merge:"objects"},value:{type:"sidebar",side:"left",scrollable:{overflowY:!0},internalListeners:{dateChange:"up.onCalendarDateChange",collapse:"up.onCalendarSidebarToggle",expand:"up.onCalendarSidebarToggle"}}},datePicker:{$config:{merge:"objects"},value:{weight:100,dayNameFormat:"d1",editMonth:null,trapFocus:!1}},overlaySidebar:null,date:{$config:{equal:"date"},value:new Date},dateFormat:"MMMM DD, YYYY",scrollManager:{$config:["lazy","nullify"],value:{direction:"vertical"}},viewUpdateDelay:2e3,readOnly:null,allowOverlap:!0,testConfig:{viewUpdateDelay:5,loadMask:{text:"L{GridBase.loadMask}",showDelay:0}},highlightDate:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},focusable:!1,eventCls:"b-cal-event",weekStartDay:!1,hideNonWorkingDays:null,nonWorkingDays:!1,coreHours:null,contextMenuTriggerEvent:"contextmenu",enableUndoRedoKeys:!0,resourceImagePath:null,minDate:null,maxDate:null,filterEventResources:null,activeDateCls:null,keyMap:{Enter:"onEnterKey",Escape:"onEscapeKey",Home:"focusModeSelector",p:"shiftPrevious",n:"shiftNext",t:"shiftToNow",g:"gotoDate","Ctrl+d":"focusCurrentDate","/":"focusEventFilter",[/\d/]:"onDigitKey"},gotoDatePopup:{$config:"lazy",value:{cls:"b-calendar-goto-date-popup",type:"popup",title:"L{Calendar.gotoDate}",floating:!1,positioned:!0,centered:!0,items:{dateField:{type:"datefield"}},bbar:{items:{cancel:{text:"L{Object.Cancel}",onClick:"up.close"},go:{text:"L{Object.go}",onClick:"up.onGotoDateClick"}}},keyMap:{Enter:"up.onGotoDateClick"}}},propagatedConfigs:{value:["dateFormat","date","rtl","project","readOnly","weekStartDay","nonWorkingDays","hideNonWorkingDays","coreHours","timeZone","minDate","maxDate","resourceImagePath","visibleStartTime","visibleEndTime","filterEventResources"],$config:{merge:"distinct"}}}}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0},syncUIWithActiveView:{type:"buffer",delay:1,cancelOutstanding:!0}}}compose(){const{includeWeekendsButton:e,navigatorPlacement:t}=this;return{class:{[`b-calendar-nav-${t||"toolbar"}`]:1,"b-calendar-include-weekends-button":e}}}applyState(){this._hidden=!0,super.applyState(...arguments),this._hidden=!1,this.triggerPaint()}onPaintOverride(){}onInternalPaint(){this.onPaintOverride()||super.onInternalPaint()}onShowOverflowPopup({overflowPopup:e}){this.element.classList.add("b-overflow-popup-visible"),e.ion({hide:()=>this.element.classList.remove("b-overflow-popup-visible"),once:!0})}static getStartAndEndDates(e,t,r="dddd Do MMMM",n=e.timeFormat||"LT",s=e==null?void 0:e.extendAllDayEndDay){const a=e.dayTime||(e.dayTime=new Me(0)),{allDay:l,startDate:o}=t,d=t.endDate||C.add(o,t.fullDuration),c=l?s?C.ceil(d,"1 day"):C.add(d,-1,"day"):d,u=a.startOfDay(o)<a.startOfDay(c),h=!l&&C.clearTime(o)<o||C.clearTime(d)<c,g=h?u?`${r} ${n}`:n:r,f=t.isMilestone||l&&!u;return{multiDay:u,startDate:o,startText:C.format(o,g),endDate:c,endText:f?null:C.format(c,g)}}static get featureable(){return{factory:qe}}get dateTimeNow(){return this.timeZone!=null?$e.toTimeZone(new Date,this.timeZone):new Date}get today(){const e=this.dateTimeNow;return e.setHours(0,0,0,0),e}finalizeInit(){var e;super.finalizeInit();const t=this,r=(e=t.activeView)==null?void 0:e.hideNonWorkingDays;r!=null&&t.hideNonWorkingDays==null&&(t.hideNonWorkingDays=r)}toggleEmptyText(){const{crudManager:e}=this,{eventStore:t}=e||this;E.toggleClasses(this.contentElement,"b-calendar-empty",!(t.count||e!=null&&e.isLoading))}refresh(){this.eachView(e=>{var t;return(t=e.refresh)==null?void 0:t.call(e)})}get views(){const{modes:e}=this;return e?Object.values(e):[]}get activeView(){return this.viewContainer.layout.activeItem}get activeSubView(){var e;const{activeView:t}=this,{items:r}=t;return((e=r.filter(dP))==null?void 0:e[0])||t}captureFocus(){return this.activeView.captureFocus()}getEventRecord(e){return this.activeView.getEventRecord(e)}resolveEventRecord(e){return this.getEventRecord(e)}onBeforeViewContainerCardChange({prevActiveItem:e,activeItem:t}){var r,n;if(this.trigger("beforeActiveItemChange",arguments[0])===!1)return!1;if((n=(r=e._overflowPopup)==null?void 0:r.hide)==null||n.call(r),"date"in t&&t.syncViewDate!==!1){const s=this.date||e.date;s&&(t.isCalendarMixin?t.date=s:t.whenVisible(()=>t.date=s))}}onViewContainerCardChange(e){var t;if(this.trigger("activeItemChange",e),e.containedFocus){const{activeItem:r}=e;(t=r.focusDate||r.focus)==null||t.call(r,this.date)}}onToggleSidebarClick(){const{sidebar:e}=this,{collapsible:t}=e;t!=null&&t.isPanelCollapserOverlay?t.revealing||t.toggleReveal(!e.revealed):e.toggleCollapsed()}onEnterKey(e){const{target:t}=e,r=Mv.fromElement(t),{dayContentElement:n}=r,s=t.getAttribute("role"),a=r.isDayView?{clientY:n.getBoundingClientRect().top+r.hourHeight*r.autoCreate.startHour-n.scrollTop}:{};return(s==="link"||s==="columnheader"||t.matches(".b-calendar-cell,.b-day-cell"))&&(E.triggerMouseEvent(t,s==="link"?"click":"dblclick",a),e.stopPropagation()),!1}onEscapeKey(e){var t;return this.element.matches(".b-draghelper-active")||((t=E.findParent(e.target,mP,this.element))==null||t.focus(),e.preventDefault(),e.stopPropagation()),!1}onDigitKey(e){return!E.isEditable(e.target)&&e.key.match(/\d/)&&(this.mode=this.viewContainer.items[Number(e.key)-1]),!1}focusModeSelector(){var e,t;const r=(e=this.widgetMap.modeSelector)==null?void 0:e.widgetMap;r&&((t=[r[`${this.activeView.modeName}ShowButton`],r.modeSelectorButton].find(n=>n==null?void 0:n.isFocusable))==null||t.focus())}gotoDate(){const{gotoDatePopup:e}=this;e.widgetMap.dateField.value=this.date,e.show()}changeGotoDatePopup(e){return ft.create(ft.mergeConfigs({appendTo:this.contentElement},e))}onGotoDateClick(){var e;const{gotoDatePopup:t,activeView:r}=this,{dateField:n}=t.widgetMap;t.hide(),n.isValid&&(this.date=n.value,(e=r.focusDate||r.focus)==null||e.call(r,this.date))}focusEventFilter(){var e;(e=this.widgetMap.eventFilter)==null||e.focus()}focusCurrentDate(){var e;const{activeView:t}=this;(e=t.focusDate||t.focus)==null||e.call(t,this.date)}shiftToNow(){var e,t;const r=this,{activeView:n}=r,s=(e=r.sidebar)==null?void 0:e.widgetMap.datePicker,{dayTime:a}=n,l=new Date,o=a?a.startOfDay(l):C.clearTime(l);r.date=o,n.isScheduler?n.updateDate(o,o):n.scrollTo(o,{y:!n.isDayView}),s&&(s.date=o),r.updateViewDescription(),(t=n.focusDate||n.focus)==null||t.call(n,o)}shiftPrevious(e){var t;const{activeItem:r}=this.viewContainer.layout,{startDate:n}=r;r!=null&&r.previous&&(r.previous(),this.updateViewDescription(r),r.startDate-n&&r.animateTimeShift&&E.slideIn(r.contentElement,-1),e!=null&&e.type.startsWith("key")&&((t=r.focusDate||r.focus)==null||t.call(r,this.date)))}shiftNext(e){var t;const{activeItem:r}=this.viewContainer.layout,{startDate:n}=r;r!=null&&r.next&&(r.next(),this.updateViewDescription(r),r.startDate-n&&r.animateTimeShift&&E.slideIn(r.contentElement,1),e!=null&&e.type.startsWith("key")&&((t=r.focusDate||r.focus)==null||t.call(r,this.date)))}onCalendarSidebarToggle(e){e.source=this,this.trigger(`sidebar${O.capitalize(e.type)}`,e)}async onCalendarDateChange({date:e,oldDate:t,userAction:r}){var n,s,a,l;const o=this,{layout:d}=o.viewContainer,{activeItem:c}=d.isChangingCard?d.animateDetacher.event:d,{highlightDate:u}=o;if(c&&c.syncViewDate!==!1&&"date"in c){const{getDayElement:h}=c;if(C.betweenLesser(e,c.startDate,c.endDate)||(s=(n=c._overflowPopup)==null?void 0:n.hide)==null||s.call(n),c.date=e,r&&!(c.isAgendaView||c.isYearView||c.isScheduler)&&((a=c.scrollTo)==null||a.call(c,e,{y:!c.isDayView})),e=o.date=c.date,r&&u&&h){c.scrollTo&&(await c.scrollTo(e),c.scrolledToDate&&(e=c.scrolledToDate));const g=(l=c.getDayElement)==null?void 0:l.call(c,e);g&&(isNaN(u)?o.callback(u,o,[g,o]):E.highlight(L.from(g)))}}o.syncViewActiveDates(t,e),o.trigger("dateChange",{oldDate:t,date:e})}updateActiveDateCls(e,t){this.syncViewActiveDates(this.date,this.date,t)}syncViewActiveDates(e,t=this.date,r=this.activeDateCls){const n=this,{activeDateCls:s}=n,{contentElement:a}=n.viewContainer;if(r){const l=e?a.querySelectorAll(`[data-date="${C.makeKey(e)}"],[role="gridcell"][data-header-date="${C.makeKey(e)}"]`):cP;for(let o=0,{length:d}=l;o<d;o++)l[o].classList.remove(r)}if(s){const l=a.querySelectorAll(`[data-date="${C.makeKey(t)}"],[role="gridcell"][data-header-date="${C.makeKey(t)}"]`);for(let o=0,{length:d}=l;o<d;o++)l[o].classList.add(s)}}updateViewDescription(e=this.activeView){const t=this,{tbar:r,widgetMap:n,element:s}=t,{viewDescription:a}=n,l=(e==null?void 0:e.description)||"Calendar",o=`<span class="b-calendar-view-desc-text">${l}</span>`;if(s.dataset.mode=t.activeView.modeName,s.setAttribute("aria-label",l),e){r&&a&&a.content!==o&&(a.content=o);const d=e.date||e.startDate;d&&(this.date=d)}}getStepUnitText(e=this.activeView){return e.stepUnit}syncUIWithActiveView(e=this.activeView){const t=this,{tbar:r,sidebar:n,widgetMap:s}=t;if(r&&(e!=null&&e.isVisible)){const{prevButton:a,nextButton:l,modeSelector:o}=s,d=t.getStepUnitText(e);o==null||o.syncActiveMode(e),n&&(n.stepUnitText=d),t.updateViewDescription(e),a&&(a.tooltip=d?t.L("L{previous}",d):"",a.disabled=!d||!e.previous),l&&(l.tooltip=d?t.L("L{next}",d):"",l.disabled=!d||!e.next)}}updateEventStore(e){this.detachListeners("eventStoreDateRange"),this.features.loadOnDemand,this.processConfiguredListeners(),e.ion({loadDateRange:"onEventStoreDateRangeRequested",name:"eventStoreDateRange",thisObj:this}),this.sidebar&&(this.sidebar.eventStore=e)}eachView(e,t,r=null){const n=t==null;for(const s of this.views)if(n&&(t=[s]),s.callback(e,r||s,t)===!1)return}onEventStoreDateRangeRequested(e){e.changed&&this.trigger("dateRangeChange",e),this.trigger("dateRangeRequested",e)}async onModeSelectorToggle({source:e,pressed:t}){if(t){const r=this,{layout:n}=r.viewContainer,{view:s}=e;await r.modeSelectionPromise,r.modeSelectionPromise=n.setActiveItem(s).promise}}updateMode(e,t){const r=this,{isConfiguring:n}=r,{layout:s}=r.viewContainer,a=r.initialConfig||{};n||r._responsiveUpdating&&("mode"in a||"activeIndex"in a)||(e=typeof e=="string"?r.modes[e]:e,e?e!==r.activeView&&(s.setActiveItem(e,void 0,{animation:!r.isResponsiveUpdating}),!n&&s.activeItem!==e&&(r._mode=t,r.syncUIWithActiveView())):r._mode=t)}onEventStoreRefresh(){this.isConfiguring||this.syncUIWithActiveView(this.viewContainer.layout.activeItem)}handleViewRangeChange(){this.syncUIWithActiveView()}handleViewPaint({source:e}){this.syncUIWithActiveView(e),this._mode=e.modeName,this.trigger("viewPaint",{...arguments[0]})}onViewRefresh({source:e}){var t;(t=super.onViewRefresh)==null||t.call(this,...arguments),e.isVisible&&(e===this.activeView?this.updateViewDescription(e):this.activeView.owns(e)&&this.syncUIWithActiveView(this.activeView)),this.syncViewActiveDates()}updateEventCls(e){this.initialConfig.eventInnerSelector||(this.eventInnerSelector=`.${e}`),this.initialConfig.eventSelector||(this.eventSelector=`${this.eventInnerSelector}-wrap`)}changeModes(e,t){var r,n;const s=this,{modeDefaults:a}=s,l=[];s.getConfig("crudManager","defaultCalendar","eventCls");let o;for(const g in e)o=e[g],o&&l.push(T.assign({modeType:g,weight:(n=(r=o.weight)!=null?r:a==null?void 0:a.weight)!=null?n:0},o));if(l.some(uP)){e={},l.sort(z.weightSortFn);for(let g=0,{length:f}=l;g<f;g++)o=l[g],e[o.modeType]=o}const{tbar:d,element:c}=s,u={thisObj:s,descriptionChange:"onViewDescriptionChange",weekNumberClick:"onViewWeekNumberClick",monthNameClick:"onViewMonthNameClick",dayNumberClick:"onViewDayNumberClick",beforeEventAdd:"onViewBeforeEventAdd",catchAll:{fn:"onViewCatchAll",prio:1e4},dateRangeChange:"handleViewRangeChange",shiftIncrementChange:"handleViewRangeChange",rangeChange:"handleViewRangeChange",paint:"handleViewPaint",refresh:"onViewRefresh"},h=s.$modes||(s.$modes=new kr({factory:Jt,inferType:!0,owner:s,ownerName:"calendar",created(g,f){var m,p;if(g.modeName=f,g.isScheduler){const{features:b}=g,{eventEdit:w}=s.features;if(w&&(w.applyPluginConfig(g),g.editEvent=s.editEvent.bind(s)),g.ion({renderrow:()=>s.syncUIWithActiveView()}),!oE(b,"timeAxisHeaderMenu")){const{listRangeMenu:D}=g;T.setPath(b.timeAxisHeaderMenu||(b.timeAxisHeaderMenu={}),"items.dateRange",!1),oE(b.timeAxisHeaderMenu.items,"setRange")||(b.timeAxisHeaderMenu.items.setRange={text:"L{Calendar.timeRange}",icon:"b-fw-icon b-icon-calendar",weight:300,menu:D}),(m=s.sidebar)!=null&&m.widgetMap.eventFilter&&(b.timeAxisHeaderMenu.items.eventsFilter=!1)}}c.classList.add(`b-cal-${f}`),g.ion(u),s.relayEvents(g,["eventPropagate"]),s.isConfiguring||s.trigger("addMode",{mode:g});const v=(p=d==null?void 0:d.widgetMap)==null?void 0:p.modeSelector;v&&(v.calendar=s,v.addMode(f,g)),T.getPropertyDescriptor(g,"eventCount")||Object.defineProperty(g,"eventCount",{get(){return this.eventStore.getEvents({startDate:this.startDate,endDate:this.endDate}).length}})},setup(g,f){const{defaultCalendar:m}=s,p=Jt.resolveType(g.type);if(a&&(g=T.merge({},a,g)),p.isSchedulerBase){const v=g.features||(g.features={});v.eventTooltip=v.eventMenu=v.eventEdit=v.scheduleMenu=!1,"syncCalendarDate"in g||(g.syncCalendarDate=!0)}else g.eventSelector=s.eventSelector,g.eventInnerSelector=s.eventInnerSelector;return g.type==="list"&&(g.selectedRecordCollection=s.selectedCollection),"autoCreate"in s.initialConfig&&!("autoCreate"in g)&&(g.autoCreate=s.autoCreate),T.hasOwn(s,"_defaultCalendar")?g.defaultCalendar=s._defaultCalendar:m!=null&&(g.defaultCalendar=m),pP(g,s,s.propagatedConfigs),s.trigger("beforeCreateMode",{config:g})===!1?null:g}}));if(h.update(e),!t)return h.target}changeModeDefaults(e){const t=this;return new Proxy({...e},{set(n,s,a){const l=Reflect.set(...arguments);return t.updateModeDefaults({[s]:a}),l},deleteProperty(n,s){const a=Reflect.deleteProperty(...arguments);return t.updateModeDefaults({[s]:null}),a}})}updateModeDefaults(e){this.isConfiguring||this.eachView(t=>t.setConfig(e))}get collapsibleConfig(){const e=this.peekConfig("overlaySidebar"),t={type:e?"overlay":"inline",tool:null};return e&&(t.recollapseTool=null),t}updateOverlaySidebar(e){const{sidebar:t,collapsibleConfig:r}=this,n=t==null?void 0:t.collapsible;n&&(n.type!==r.type&&(t.collapsible=r),e?t.collapsed||(t.collapsed=!0,t.collapsedDueToOverlay=!0):(t.collapsedDueToOverlay||t.isVisible&&n.isPanelCollapserOverlay)&&(t.collapsed=!1,t.collapsedDueToOverlay=!1))}changeSidebar(e,t){var r,n;const s=this,{datePicker:a,statefulId:l}=s;if(e){const o=e.items||(e.items={}),d=o.datePicker;return a?d!==null&&d!==!1&&(o.datePicker=Mv.mergeConfigs(o.datePicker,a)):o.datePicker=null,vg.reconfigure(t,e,{owner:s,setup:(c,u)=>s.setupWidgetConfig(c,u),defaults:{stateId:l&&`${l}:sidebar`,eventStore:s.eventStore,date:s.date,weight:(e==null?void 0:e.side)==="right"||(e==null?void 0:e.side)==="end"?200:-10,collapsible:s.collapsibleConfig,items:{datePicker:{weekStartDay:s.weekStartDay}}}})}else t==null||t.destroy(),(n=(r=s.tbar)==null?void 0:r.widgetMap.toggleSidebar)==null||n.hide()}changeTbar(e){var t;e!=null&&e.toggleSideBar&&!e.isWidget&&(re.deprecate("calendar","7.0.0","toggleSideBar ref is deprecated in favor of toggleSidebar"),e.toggleSidebar=e.toggleSideBar,delete e.toggleSideBar);const r=super.changeTbar(...arguments);return r&&!this.hasConfig("sidebar")&&((t=r.widgetMap.toggleSidebar)==null||t.hide()),r}changeDatePicker(e){if(e)return Object.assign(e,{eventStore:this.eventStore,date:this.date,minDate:this.minDate,maxDate:this.maxDate})}get datePicker(){var e,t;return this.isConfiguring?this._datePicker:(t=(e=this.sidebar)==null?void 0:e.widgetMap)==null?void 0:t.datePicker}changeItems(e){const{modes:t,sidebar:r}=this;r&&(e.sidebar=r),e.viewContainer=this.viewContainer,e.viewContainer.items=t,e.viewContainer.activeIndex=Math.max(Object.keys(t).indexOf(this.mode),0),this.activeModeIndex&&(e.viewContainer.layout.activeIndex=this.activeModeIndex);const n=super.changeItems(e);return this._viewContainer=this.widgetMap.viewContainer,n}onViewCatchAll(e){var t;const r=this,{fromOverflowPopup:n,type:s,source:a}=e;if(e.bubbles)return;let l,o,{domEvent:d}=e;if(!d&&E.isDOMEvent(e.event)&&(d=e.event),r.eventSource=a,!d||r.handleEvent(d)!==!1){const c=s.startsWith("emptycell"),u=a.isEventList&&!a.range?"betweenLesserEqual":"betweenLesser";if(s.endsWith("click")&&!hP[s]&&(o=e.date||((t=a.getDateFromDomEvent)==null?void 0:t.call(a,d)))){a.isDayView&&a.dayTime&&(o=a.dayTime.startOfDay(o));const h=n||s==="celloverflowclick"||d.target.closest(".b-cal-cell-overflow"),g=a.getDayElement&&!a.getDayElement(o,!0)||a.isDateRangeOwner&&!C[u](o,a.startDate,a.endDate);a.syncCalendarDate&&(a.isCalendarRow||!(n&&g)&&!c&&!(a.isDateRangeOwner&&g)&&(s==="daynumberclick"||!(g&&(h||s.startsWith("event")||s.startsWith("schedule")))))&&(a.preventScroll=!0,r.date=o,a.preventScroll=!1)}(c||oP.test(s))&&(!e.view&&(e.view=a),l=r.trigger(e.eventName,e))}return r.eventSource=null,l}onViewDescriptionChange(){this.updateViewDescription()}onViewWeekNumberClick({date:e,week:t}){const r=this.modes.week||this.viewContainer.query(fP);r&&(r.week=t,C.betweenLesser(this.date,r.startDate,r.endDate)||(this.date=e),this.viewContainer.layout.activeItem=r)}onViewMonthNameClick({date:e}){const t=this.modes.month||this.viewContainer.query(gP);t?(t.getDayElement(e,!0)||(this.date=e),this.viewContainer.layout.activeItem=t):this.date=e}onViewDayNumberClick({source:e,date:t,cellData:r,fromOverflowPopup:n,domEvent:s}){var a;const{activeView:l}=this,o=e.isYearView&&(e.overflowPopupTrigger!=="click"||n||!e.overflowPopup||r.isOtherMonth||!((a=r.events)!=null&&a.length)&&!e.emptyCellRenderer);if(!(l.isDayView&&l.duration===1)&&(e.isCalendarRow||e.isMonthView||o||e.isAgendaView)){const{viewContainer:d}=this,c=this.modes.day||d.query(u=>{var h;return((h=u.view)==null?void 0:h.type.toLowerCase())==="dayview"});if(c&&e!==c.allDayEvents){const{layout:u}=d,{activeItem:h}=u,{syncViewDate:g}=h;return h.syncViewDate=!1,this.date=t,d.layout.activeItem=c,h.syncViewDate=g,!1}}}onViewBeforeEventAdd({eventRecord:e,assignmentRecords:t}){const{eventEdit:r}=this.features,n=r&&!r.disabled;e.isCreating=n,t==null||t.forEach(s=>s.isCreating=n)}createEvent(e,t){this.doCreateEvent(e,t)}doCreateEvent(e,t,r=this.activeSubView,n){const{modes:s}=this,a=r.isYearView&&(s.week||s.month||s.day)||r;if(this.activeView.owns(a))r.doCreateEvent?r.doCreateEvent(e,t,a,n):r.createEvent(e,t,n);else{const{viewContainer:l}=this.widgetMap,{layout:o}=l;if(a)return l.ion({activeItemChange:"doCreateEvent",thisObj:r,once:!0,args:[e,t,a]}),e&&(this.date=e),o.activeItem=a,!1}}changeDate(e,t){if(e=typeof e=="string"?C.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=C.clearTime(e),!t||e-t)return e}changeMinDate(e){return this.changeDate(e)}changeMaxDate(e){return this.changeDate(e)}updateMinDate(e){this.isConfiguring||(this.syncCommonConfig("minDate"),this.datePicker&&(this.datePicker.minDate=e))}updateMaxDate(e){this.isConfiguring||(this.syncCommonConfig("maxDate"),this.datePicker&&(this.datePicker.maxDate=e))}updateAutoCreate(){this.isConfiguring||this.syncCommonConfig("autoCreate")}updateDate(e,t){if(!this.isConfiguring){const{sidebar:r}=this;r?r.date=e:this.onCalendarDateChange({date:e,oldDate:t})}}updateDateFormat(){this.isConfiguring||this.syncCommonConfig("dateFormat")}changeIncludeWeekendsButton(e){return e===!0?{}:e}updateIncludeWeekendsButton(e){!this.isConstructing&&e&&T.isObject(e)&&(this.widgetMap.modeSelector.includeWeekendsButton=e)}changeScrollManager(e,t){if(t==null||t.destroy(),!this.isDestroying)return new dd(Object.assign({element:this.element},e))}updateDefaultCalendar(){this.isConfiguring||this.syncCommonConfig("defaultCalendar")}changeWeekStartDay(e){return e===!1&&(e=C.weekStartDay),e}updateReadOnly(){super.updateReadOnly(...arguments),this.isConfiguring||this.syncCommonConfig("readOnly")}updateWeekStartDay(e){var t;this.isConfiguring||(this.syncCommonConfig("weekStartDay"),(t=this.sidebar)!=null&&t.widgetMap.datePicker&&(this.sidebar.widgetMap.datePicker.weekStartDay=e))}changeHideNonWorkingDays(e){return!!e}updateHideNonWorkingDays(e,t){this.isConfiguring||(this.syncCommonConfig("hideNonWorkingDays"),this.trigger("changeHideNonWorkingDays",{value:e,was:t}))}changeNonWorkingDays(e){e===!1&&(e=C.nonWorkingDays);const t=this;return new Proxy({...e},{set(n){const s=Reflect.set(...arguments);return t.updateNonWorkingDays(n),s},deleteProperty(n){const s=Reflect.deleteProperty(...arguments);return t.updateNonWorkingDays(n),s}})}updateNonWorkingDays(){this.isConfiguring||this.syncCommonConfig("nonWorkingDays")}updateCoreHours(){this.isConfiguring||this.syncCommonConfig("coreHours")}syncCommonConfig(e){this.eachView(t=>{t[e]=this[e]})}onCalendarStoreChange(){var e;if(this.isPainted){const{element:t,resourceStore:r}=this,{resourceFilter:n}=this.widgetMap,s=(n?r.records.filter(a=>n.value.includes(a)):r.records).length;t.classList.toggle("b-no-visible-resources",!!(n&&!s)),t.style.setProperty("--visible-resource-count",s)}(e=super.onCalendarStoreChange)==null||e.call(this,...arguments)}updateSelected(){const e=this.viewContainer.contentElement.querySelectorAll(".b-cal-event-wrap");for(let t=0,{length:r}=e;t<r;t++)e[t].classList.toggle(this.eventSelectedCls,this.isEventSelected(e[t].dataset.eventId))}getElementFromEventRecord(e,t){return this.activeView.getEventElement(e,void 0,t)}getElementsFromEventRecord(e,t){return[this.getElementFromEventRecord(e,t)]}updateLocalization(){const e=this;if(e.isPainted){let t=!1;!("weekStartDay"in e.initialConfig)&&e.weekStartDay!==C.weekStartDay&&(e.weekStartDay=C.weekStartDay,t=!0),!("nonWorkingDays"in e.initialConfig)&&!T.isEqual(e.nonWorkingDays,C.nonWorkingDays)&&(e.nonWorkingDays=C.nonWorkingDays,t=!0),t||e.refresh(),e.syncUIWithActiveView()}super.updateLocalization()}onEventDataGenerated(e,t){}};y(dv,"$name","Calendar"),y(dv,"type","calendar");var Ls=dv;Ls.initClass(),globalThis.bryntum&&(globalThis.bryntum.Calendar=Ls);var Jt=class extends $.mixin(ii){static get factoryable(){return{extends:z}}};Jt.register("agenda",Es),Jt.register("year",uo),Jt.register("month",Rs),Jt.register("week",co),Jt.register("day",ui),Jt.register("dayagenda",xs),Jt.register("list",fr),Jt.register("resource",un),Jt.register("dayresource",Ts),Ls.Modes=Jt,re.setVersion("calendar","6.2.2"),Ls._$name="Calendar";var dE=i=>i.eventStore,Ps=class extends ve{constructor(){super(...arguments),y(this,"clockTemplate",new ur({}))}static get configurable(){return{localizableProperties:["timeFormat"],align:{monitorResize:!0},dateFormat:"ll",eventRecord:{$config:"nullify",value:null},recurrenceHint:"",timeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},axisLock:"flexible",closable:null,forSelector:".b-cal-event-wrap",maxWidth:"30em",minWidth:"14em",scrollAction:"realign",cls:{"b-sch-event-tooltip":1},tools:{edit:{cls:"b-icon-edit",handler:"up.onEditClick",tooltip:"L{EventEdit.Edit event}",weight:100},delete:{cls:"b-icon-trash",handler:"up.onDeleteClick",tooltip:"L{SchedulerBase.Delete event}",weight:0},maximize:null},titleRenderer:i=>O.encodeHtml(i.name),renderer:null,extendAllDayEndDay:null,activeClient:null,revealEventsInCluster:!0}}static get delayable(){return{refreshContent:20}}get owner(){return ve.fromElement(this.activeTarget)||this.ownerFeature.client}onEditClick(){this.trigger("edit")}onDeleteClick(){this.trigger("delete")}getHtml(i){const e=this,{eventRecord:t}=e;if(t)return i.eventRecord=t,e.title=e.titleRenderer?e.callback(e.titleRenderer,e,[t]):"",e.callback(e.renderer||e.internalRenderer,e,[{...i,eventRecord:t}])}internalRenderer({eventRecord:i}){var e;const{clockTemplate:t,recurrenceHint:r}=this,{allDay:n,recurrence:s}=i,a=((e=ve.fromElement(this.activeTarget))==null?void 0:e.closest(dE))||this.owner.activeView,l=s?fc.getLegend(s):r,o=C.formatDelta(C.diff(i.startDate,i.endDate),n?{precision:"d"}:null),{multiDay:d,startDate:c,startText:u,endDate:h,endText:g}=Ls.getStartAndEndDates(a,i,this.dateFormat,this.timeFormat,this.extendAllDayEndDay);return t.mode=d?"day":"hour",t.template({date:c,text:u,cls:"b-sch-tooltip-startdate"})+(g?t.template({date:h,text:g,cls:"b-sch-tooltip-enddate"}):"")+(i.isMilestone?"":`<div class="b-cal-tooltip-duration b-icon b-icon-duration">${o}</div>`)+(l?`<div class="b-cal-tooltip-recurrence b-icon b-icon-recurring">${l}</div>`:"")}showByEvent(i,e=i.target){var t,r;const n=this,s=(t=n.ownerFeature)==null?void 0:t.clickDelay;if(n.activeTarget=e,n.pointerEvent=i,n.updateContent(),(r=n.ownerFeature)!=null&&r.alignToDomEvent&&(i.target.dataset.eventId=e.dataset.eventId,e={domEvent:i,anchor:!1,align:"s0-e100",axisLock:!0}),i.type==="click"&&s){n.hasTimeout("show")?n.clearTimeout("show"):(n.hoverDelay=s,i.type="pointerover",n.delayShow(e));return}return n.showBy(e)}afterShowByTarget(){var i;const{delete:e}=this.tools;this.activeClient=(i=ve.fromElement(this.activeTarget))==null?void 0:i.closest(dE),super.afterShowByTarget(),e&&(e.disabled=this.ownerFeature.client.readOnly)}afterHide(){super.afterHide(...arguments),this.activeClient=null}updateActiveTarget(i,e){var t;(t=super.updateActiveTarget)==null||t.call(this,...arguments),e==null||e.classList.remove("b-cal-event-reveal"),i?i.classList.contains("b-cal-in-cluster")&&this.revealEventsInCluster&&i.classList.add("b-cal-event-reveal"):this.eventRecord=null}refreshContent(){this.eventRecord&&this.updateContent()}updateEventRecord(i){var e;const t=this;(e=t._changeHook)==null||e.call(t),t._changeHook=i&&be.after(i,"afterChange",t.refreshContent,t),i&&(t.tools.delete&&(t.tools.delete.hidden=i.readOnly),t.tools.edit&&(t.tools.edit.hidden=i.readOnly))}updateContent(){var i;const{clockTemplate:e,element:t,eventRecord:r}=this,n=super.updateContent(),s=t.querySelector(".b-sch-tooltip-startdate"),a=t.querySelector(".b-sch-tooltip-enddate"),{edit:l,delete:o}=this.tools,{client:d}=this.ownerFeature,{eventEdit:c}=d.features,u=d.readOnly||r.readOnly;if(s&&e.updateDateIndicator(s,r.startDate),a&&e.updateDateIndicator(a,r.endDate),l&&(l.hidden=u||!(c!=null&&c.enabled)),o&&(o.hidden=u),this.resources){const{chipView:h}=this;h.items=r.resources,(i=this.contentElement.querySelector(".b-resourcechipview"))==null||i.remove(),this.contentElement.appendChild(h.element.cloneNode(!0))}return n}realign(){var i;const{lastAlignSpec:e}=this;this.isVisible&&(e!=null&&e.aligningToElement)&&e.target.dataset.eventId!==String((i=this.eventRecord)==null?void 0:i.id)&&this.hide(),super.realign(...arguments)}updateActiveClient(i){this.detachListeners("clientOverflowChange"),i&&i.ion({name:"clientOverflowChange",eventsPerCellChange:"onClientOverflowChange",thisObj:this})}onClientOverflowChange(){E.isVisible(this.lastAlignSpec.target)||this.hide()}onDocumentMouseDown({event:i}){if(!(!i.button&&this.ownerFeature.showOn==="click"&&this.activeTarget.contains(i.target)))return super.onDocumentMouseDown(...arguments)}get chipView(){const i=this;return i._chipView||(i._chipView=new ao({parent:i}),Object.defineProperty(i.chipView,"isVisible",{get(){return!0}}),i.chipView.triggerPaint()),i._chipView}};y(Ps,"$name","EventTip"),y(Ps,"type","eventtip"),Ps.initClass(),Ps._$name="EventTip";var vP="b-cal-tentative-event",yP=1e3,bP=60*yP,CP="YYYY-MM-DD",wP=/^b-hover-(top|right|bottom|left)$/,hi=Symbol("eventDragMode"),cE=(i,e)=>{let t;return i.className==="b-cal-event-body"?i.children.push(t=e):Array.isArray(i.children)&&i.children.forEach(r=>{!t&&r&&(t=cE(r,e))}),t},cv=i=>Object.freeze({type:i,create:!1,move:!1,resize:!1,[i]:!0}),Sg={create:{finisher:"finishDropCreate",mode:cv("create"),validatorFn:"validateCreateFn"},move:{finisher:"finishDropMove",mode:cv("move"),validatorFn:"validateMoveFn"},resize:{finisher:"finishDropResize",mode:cv("resize"),validatorFn:"validateResizeFn"}},SP={calendarrow:!0,monthview:!0,dayresourcecalendarrow:!0},Dg=Symbol("meta"),hn=class extends so.mixin(ad,Ju,Uw){static get configurable(){return{droppableSelector:"*",droppable:!0,hoverable:null,hoverAnimationCls:"b-hover-anim",days:{$config:{equal:(i,e)=>T.isEqual(i,e)&&(i==null?void 0:i.resource)===(e==null?void 0:e.resource)},value:null},dragProxy:{type:"tip",tooltip:null},eventRecord:null,hit:null,dragItemSelector:".b-cal-event-wrap",overflow:{$config:"nullify",value:null},rootElement:null}}get dayTime(){var i;return(i=this.view)==null?void 0:i.dayTime}clearTime(i){return this.dayTime.startOfDay(i)}findRootElement(i){return i.contentElement}getDateFromPosition(i,e){return this.view.getDateFromPosition(i,e,!1,this.view.dayTime)}get dragEventer(){return this.owner}beforeDrag(i){const e=this,{owner:t}=e,r=e.hitTest(i),n=r==null?void 0:r.eventRecord,s=e.view.rtl?"right":"left";if(!r||n!=null&&n.readOnly||n!=null&&n.isCreating)return!1;r.date&&i.set("date",r.date),r.resource&&i.set("resource",r.resource);let a,l;switch(r.type){case"event":i.set("eventRecord",n),i.set("eventSourceHit",r),i.set("eventInset",r.eventElement.style[s]),i.set("eventWidth",r.eventElement.offsetWidth),a="move",l=!t.draggable||!n.isDraggable||e.draggable===!1,l||e.captureDragOffset(n,r,i);break;case"resize":i.set("eventRecord",n),i.set("eventSourceHit",r),i.set("eventInset",r.eventWrap.style[s]),i.set("eventWidth",r.eventWrap.offsetWidth),a="resize",l=!t.resizable||!n.resizable||e.resizable===!1;break;case"schedule":case"dayNumber":i.set("eventCreate",r),a="create",l=!t.creatable||e.creatable===!1;break;default:return!1}if(l||e.view[`allowDrag${O.capitalize(a)}`]===!1)return!1;i.set("eventDragMode",i[hi]=Sg[a].mode)}dragStart(){var i,e;const t=this,{dragging:r,owner:n,view:s}=t,{client:a}=n,l=()=>{r.lastMoveEvent&&r.move(r.lastMoveEvent)},o={scrollables:a.scrollManager?[{element:a.viewContainer.element,callback:l}]:[]};(t.isResizing||t.isMoving)&&(t.refocus=n.client.captureFocus()),t.isResizing&&((i=r.itemElement)==null||i.classList.add("b-resizing")),s.scrollable&&o.scrollables.push({element:s.scrollable.element,callback:l}),s.horizontalScroller&&o.scrollables.push({element:s.horizontalScroller.element,callback:l}),(e=a.scrollManager)==null||e.startMonitoring(o)}captureDragOffset(){}cleanupDrag(){var i;const e=this,{dragProxy:t,dragging:r}=e,{tooltip:n}=t,s=e.view.isOverflowPopup?e.view.owner:e.view,{client:a}=e.owner,l=E.getActiveElement(a);(i=r==null?void 0:r.itemElement)==null||i.classList.remove("b-resizing"),r!=null&&r.aborted&&(e.days=null),s.afterRefresh(()=>{var o;e.eventRecord&&(e.days=null),E.getActiveElement(a)===l&&((o=e.refocus)==null||o.call(e,!1,!0)),e.refocus=null}),n&&(n.hide(),t.tooltip=null)}dragEnd(){var i,e;(e=(i=this.owner.client)==null?void 0:i._scrollManager)==null||e.stopMonitoring(),this.cleanupDrag()}makeDays(i,e){const{dayTime:t,firstVisibleDate:r,lastVisibleDate:n}=this.view,s=[];e=C.add(e,-1,"d"),[i,e]=[i,e].map(l=>l<r?r:n<l?n:l);let a=t.startOfDay(i);for(const l=t.ceil(e);!(l<a);a=C.add(a,1,"day"))s.push(t.dateKey(a));return s}onShowOverflowPopup({overflowPopup:i}){this.overflow||(this.overflow=new gE({owner:this.owner,view:i}))}get calendarCellSelector(){return this.view.visibleCellSelector}get calendarCells(){const i=this.dropRootElement;return i&&E.children(i,this.calendarCellSelector)}get isCreating(){var i,e;return(e=(i=this.dropping)==null?void 0:i[hi])==null?void 0:e.create}get isMoving(){var i,e,t;const r=((i=this.dropping)==null?void 0:i[hi])||((e=this.dragging)==null?void 0:e[hi]);return r?r.move:!!((t=this.dropping)!=null&&t.peek("eventRecord"))}get isResizing(){var i,e;return(e=(i=this.dragging)==null?void 0:i[hi])==null?void 0:e.resize}get recurrable(){return this.isDayZone||this.isMonthZone}cleanupDrop(){this.eventRecord=this.eventDom=this.days=null,this.noTip=!1}createEvent(i,e=this.dropping){const t=(e==null?void 0:e[hi])||Sg.create.mode;this.setupEvent(i,t.create)}async dragDrop(i){if(this.isResizing||i.target===this)return i.finalizer=this.finishDrop(i)}dragEnter(i){const e=this,t=i[hi],r=i.source===e&&i.peek("eventSourceHit")||e.hitTest(i);if(e.isMoving)e._hit=r,e.startMove(i.peek("eventRecord"));else{if(!t||i.source!==e)return!1;if(t.resize)e._hit=r,e.startResize(r);else if(t.create)e._hit=r,e.startCreate(i.peek("date"),i.peek("eventCreate"));else return!1}}dragLeave(){this.isResizing||this.cleanupDrop()}dragMove(i){this.hit=this.pickDropTarget(i)}dropHitMove(i,e,t){const r=this,{endDate:n,startDate:s}=t.isScheduled?t:r.eventRecord,a=C.diff(s,n,"s");let{date:l,resource:o}=e;l=r.clearTime(l),t.allDay||(l=C.add(l,C.diff(r.clearTime(s),s,"s"),"s")),l=r.applyDragOffset(l,i);const d={startDate:l,endDate:C.add(l,a,"s")};o!=null&&o.eventColor&&(d.eventColor=o.eventColor),r.setEventData(d)}dropHitNowhere(){this.days=null}dropHitResize(i,e,t){const r=this,{eventRecord:n}=r,{startDate:s,endDate:a}=n,l=r.clearTime(e.date);let o,d;t.atEnd?(d=C.add(l,1,"d"),o={startDate:s,endDate:s<d?d:C.add(s,1,"d")}):o={startDate:l<a?l:C.add(a,-1,"d"),endDate:a},o.duration=C.diff(o.startDate,o.endDate,n.durationUnit),r.setEventData(o)}async finishDrop(i){const e=this,{eventRecord:t,owner:r,view:n}=e,{eventStore:s}=n,a=i[hi],l=Sg[(a==null?void 0:a.type)||"move"];if(l&&e.hit){const o=l.validatorFn?await r.callback(r[l.validatorFn],r,[{drag:i,eventRecord:t,event:i.event}]):!0;o!==!1&&await e[l.finisher](i,r,t,s,o,async(d,c,u)=>{let h={drag:i,eventRecord:t,newStartDate:t.startDate,newEndDate:t.endDate,resourceRecord:e.hit.resource||n.resource,validation:o,event:i.event,feature:r,view:i[e.isResizing?"source":"target"].view};return await r.client.trigger("before"+O.capitalize(d),h)===!1?(h=!1,await(u==null?void 0:u())):(n.allowTransitionsOnRefresh=!1,await(c==null?void 0:c()),delete h.newStartDate,delete h.newEndDate,(a==null?void 0:a.type)!=="create"&&(h.eventRecord=i.peek("eventRecord")||t),r.client.trigger(d,h)),h})}e.isFinishing=!0,e.cleanupDrop()}async finishDropCreate(i,e,t,r,n,s){const a=(n==null?void 0:n.add)!==!1;await s("dragCreateEnd")===!1?a&&r.remove(t):a&&!r.includes(t)&&r.add(t)}async finishDropMove(i,e,t,r,n,s){var a;let l=await i.get("eventRecord");const o=this,{view:d}=o,c=l.isOccurrence?l.recurringTimeSpan:l,{source:u}=i,h=await i.get("resource"),g=o.hit.resource,f=u!==o,m=f&&((a=u.view)!=null&&a.eventStore)&&d.eventStore&&u.view.eventStore!==d.eventStore?u.view.eventStore:await i.get("sourceStore"),p=g&&g!==h;!p&&i.source===i.target&&C.isEqual(t.startDate,l.startDate)&&C.isEqual(t.endDate,l.endDate)&&l.eventStore===r||await s("dragMoveEnd",async()=>{if(r.getByInternalId(c.internalId))l=await o.finishDropConfirm(l),l&&(await o.moveEventTo(i,l),p&&(l.isOccurrence&&l.convertToRealEvent(),l.assign(g),l.unassign(h)));else{m?o.owner.removeFromExternalStore?m.remove(l):l=l.copy():l=t,l.setData("resourceId",null),r.add(l),await o.moveEventTo(i,l);const v=g!=null?g:!p&&!d.project.resourceStore.includes(l.resource)&&o.owner.client.defaultCalendarId;v!=null&&d.project.resourceStore.includes(v)?l.assign(v):d.project.resourceStore.includes(l.resource)||(l.resources=[])}await d.project.commitAsync()})}async finishDropResize(i,e,t,r,n,s){const a=this,{view:l}=a,{eventRecord:o,edge:d}=await i.get("eventSourceHit"),c=d.bottom||(l.rtl?d.left:d.right)?"endDate":"startDate";t[c]-o[c]&&await s("dragResizeEnd",async()=>{const u=await this.finishDropConfirm(o);u&&u.set({startDate:t.startDate,endDate:t.endDate,duration:C.diff(t.startDate,t.endDate,u.durationUnit)}),await l.project.commitAsync()})}async finishDropConfirm(i){return i.isOccurrence||i.isRecurring?new Promise(e=>{const t=this.owner.client.recurrenceConfirmationPopup;t.owner=this.owner,t.confirm({actionType:"update",eventRecord:i,cancelFn(){e(null)},changerFn(r){e(r)}})}):i}async moveEventTo(i,e){const t=this;let r=t.view.getDateFromElement(i.targetElement);if(e.startDate&&(r=C.copyTimeValues(t.clearTime(r),e.startDate)),r=t.applyDragOffset(r,i),i.peek("sourceStore")!==t.view.eventStore&&!e.startDate){const n=i.target.view.autoCreate||t.owner.client.autoCreate;r.setHours((n==null?void 0:n.startHour)||8)}await t.setStartDate(e,r)}pickDropTarget(i){let e=this.hitTest(i);return!e&&this.isResizing&&(e=this.hit),e!=null&&e.date?e:null}setStartDate(i,e){return i.set({startDate:e,endDate:C.add(e,i.fullDuration)})}getHoverHandleCls(i){return i?"":"b-gripper-vert"}hoverEnter(){var i,e;const t=this,r=t.hitTest(t.hoverTarget),{gripper:n}=t.owner,s=t.getHoverHandleCls(),a=t.getHoverHandleCls(!0);a&&n.classList.remove(a),((i=r==null?void 0:r.eventRecord)==null?void 0:i.resizable)!==!1&&!((e=r==null?void 0:r.eventRecord)!=null&&e.readOnly)&&(s&&n.classList.add(s),t.hoverTarget.appendChild(n))}hoverLeave(i){const e=this,{gripper:t}=e.owner,r=e.getHoverHandleCls();t.parentNode===i&&(r&&t.classList.remove(r),i.removeChild(t))}applyDragOffset(i,e){var t;const r=e.peek("eventOffset");return i&&(r!=null&&r[0])&&e.source.constructor===((t=e.target)==null?void 0:t.constructor)&&(i=C.add(i,-r[0],r[1])),i}hitTest(i){const e=this,t=i==null?void 0:i.isDragContext,r=t?i.event:i,n=t&&i.targetElement||E.getEventElement(r);let s=e.view,a=null,l,o;if(n){s.calendarHitTest||(s=e.owner.client);const d=s.rtl?"right":"left";a=s.calendarHitTest(n),a&&(a.eventWrap=o=n.closest(".b-cal-event-wrap"),n.classList.contains("b-gripper")?(a={type:"resize",cell:a.cell,date:a.date,edge:l={},eventRecord:a.eventRecord,resource:a.resource,eventWrap:o,gripper:n,view:a.view},te.normalize(o.className,"array").forEach(c=>{c=wP.exec(c),c&&(l[c[1]]=!0)}),a.atEnd=!(l.top||l[d])):a.eventRecord||(o=null),o&&(a.eventTop=o.style.top),n!==r&&(a.date=e.getDateFromPosition(r.clientX,r.clientY)||a.date))}return a}renderEvent(i,e,t){var r,n;const{view:s,owner:a}=this;Object.defineProperty(i,"assigned",this.assignmentsProperty);const l=s.createEventDomConfig({eventRecord:i,isAllDay:SP[s.type],asSelected:i.data.realEventId&&((n=(r=a.client).isEventSelected)==null?void 0:n.call(r,i.data.realEventId))});if(l.className["b-cal-tentative-event"]=1,l.className["b-cal-tentative-event-first"]=e,l.className["b-cal-tentative-event-last"]=t,delete i.assigned,t){const{footer:o}=a;o&&!s.showTime.endTime&&cE(l,T.assign({html:C.format(i.endDate,s.timeFormat)},o))}return l}setEventData(i,e){const t=this,{eventRecord:r,view:n}=t,{duration:s,startDate:a}=i;if(a&&s!=null&&!i.endDate&&(i={...i,endDate:C.add(a,s,r.durationUnit)}),r.set(i),t.eventDom)t.eventDom.className[n.shortEventCls]=r.rawDurationMS<=n.shortEventDuration;else{if(e){let l,{newName:o}=t.owner;if(o){const d=t.view.resolveCallback(o,n,!1);l=(d==null?void 0:d.handler.call(n,r))||o}else o=n.autoCreate.newName,l=n.resolveCallback(o,n,!1)?n.callback(o,n,[n,r.startDate,n.resource||n.defaultCalendar]):o;r.name=l}t.eventDom=t.renderEvent(r)}}setupEvent(i,e){var t;const r=this,{owner:n}=r,{defaultCalendar:s,eventStore:a}=r.view,{tooltip:l}=n,o=r.eventRecord=n.eventRecord=a.createRecord({}),d=e?new Set([a.assignmentStore.createRecord({event:o,resource:s})]):i.assigned;r.assignmentsProperty={configurable:!0,value:d},delete i.assigned,i[Dg]&&(o.meta=i[Dg]),r.setEventData(i,e),r.isCreating&&s&&a.assignmentStore.assignEventToResource(o,s);const{eventDom:c}=r;return c.className[vP]=1,!r.noTip&&!l.disabled&&((t=r.dragging)!=null&&t.has("eventCreate"))&&(l.eventRecord=o,l.recurrenceHint=e&&r.recurrable?n.recurrenceTip:"",r.dragProxy.tooltip=l),c}startCreate(i){this.createEvent({allDay:!0,startDate:i,durationUnit:this.durationUnit,endDate:C.add(i,1,"d")})}get durationUnit(){return this.view.dragUnit||we.from(this.view.autoCreate.duration).unit||this.owner.durationUnit}startMove(i){var e,t,r,n;const s=this,a=T.clone(i.dataByFieldName),l=s.dropping,{hit:o}=s,d=(r=(e=o==null?void 0:o.resource)==null?void 0:e.eventColor)!=null?r:(t=l.peek("resource"))==null?void 0:t.eventColor;d&&!a.eventColor&&(a.eventColor=d),a.assigned=i.assigned,a.startDate||(a.startDate=(o==null?void 0:o.date)||new Date,a.endDate=C.add(a.startDate,i.duration||1,i.durationUnit||"h")),o!=null&&o.resource&&(a.resourceId=o.resource.id),a.resourceId||(a.resourceId=l.peek("resourceId")||((n=s.owner.client)==null?void 0:n.defaultCalendarId)),a.realEventId=a.id,delete a.id,a[Dg]=T.clone(i.meta),s.setupEvent(a)}startResize(i){var e;const{eventRecord:t}=i,r=T.clone(t.dataByFieldName);r[Dg]=T.clone(t.meta),this.createEvent({...r,assigned:t.assigned,id:`dragResize-event-${r.id}`,eventColor:r.eventColor||((e=t.resource)==null?void 0:e.eventColor),recurrenceRule:null,realEventId:r.id})}configureListeners(i){const e=super.configureListeners(i);return e.element=this.view.rootElement,e}updateHit(i){const e=this,t=e.dropping,r=i&&t[hi];i?e.isMoving?e.dropHitMove(t,i,t.peek("eventRecord")):r!=null&&r.create?e.dropHitCreate(t,i,t.peek("eventCreate")):r!=null&&r.resize&&e.dropHitResize(t,i,t.peek("eventSourceHit")):e.dropHitNowhere(t)}updateDays(i){const e=this,{calendarCells:t,eventDom:r,dayValues:n}=e,s=t&&{};let a=!0,l,o,d,c,u;if(e.dayValues=s,t&&r){for(c=0;c<t.length;++c)l=t[c],i!=null&&i.includes(l.dataset.date)&&(u=l);for(c=0;c<t.length;++c)l=t[c],o=l.dataset.date,i!=null&&i.includes(o)&&((d=n==null?void 0:n[o])?delete n[o]:(d=e.includeDay(o,l,a,l===u)||!0,a=!1),s[o]=d);if(n){const h=()=>{for(c in n)e.removeDay(c,n[c],e.isCreating)};!i&&e.isCreating&&!e.dragging.aborted?e.view.afterRefresh(h):h()}}}updateEventRecord(i){this.owner.eventRecord=i}updateOverflow(i,e){return!i&&e&&e.destroy(),i}updateOwner(i){this.hoverIgnoreElement=i==null?void 0:i.gripper}updateRootElement(i){const e=this;e.dragRootElement=i,e.dropRootElement=e.droppable?i:null,e.owner.resizable||(e.hoverable=!1),e.hoverRootElement=e.hoverable?i:null}updateView(i,e){var t;super.updateView(i,e);const r=this;r.rootElement=i?r.findRootElement(i):null,(t=r._overflowDetacher)==null||t.call(r),i!=null&&i.isDayCellRenderer&&(r._overflowDetacher=i.ion({thisObj:r,showOverflowPopup:"onShowOverflowPopup"}))}};y(hn,"$name","Zone"),hn.prototype._eventRecord=null;var uv=class extends hn{static get configurable(){return{hoverSelector:".b-cal-event-wrap",draggingClsSelector:".b-dayview-content"}}getHoverHandleCls(i){let e=this.isAllDayZone;return i&&(e=!e),`b-gripper-${e?"vert":"horz"}`}};y(uv,"$name","BaseDayZone");var hv=class extends uv{static get configurable(){return{hoverEdges:"lr"}}dragEnter(i){return this.view.eventsPerCell||this.view.expandGutter(),super.dragEnter(i)}dragLeave(i){this.view.collapseGutter(),super.dragLeave(i)}captureDragOffset(i,e,t){t.set("eventOffset",[Math.max(Math.floor(C.diff(i.startDate,e.date,"d")),0),"d"])}dropHitCreate(i,e,t){let r=this.clearTime(e.date),n=this.clearTime(t.date);r<n&&([n,r]=[r,n]),this.setEventData({startDate:n,duration:C.as(this.eventRecord.durationUnit,C.diff(n,r,"d")+1,"d")})}async moveEventTo(i,e){const t=this,r=t.hitTest(i),n=t.applyDragOffset(r==null?void 0:r.date,i),s=new Date(e.startDate);n&&(s.setFullYear(n.getFullYear()),s.setMonth(n.getMonth()),s.setDate(n.getDate()),t.view.dayTime.startShift?(s.setHours(n.getHours()),s.setMinutes(n.getMinutes()),s.setSeconds(n.getSeconds()),e.duration=1):t.view.isAllDayEvent(e)||(e.allDay=!0),await t.setStartDate(e,s))}setEventData(i,e){super.setEventData(i,e);const t=this,{eventRecord:r}=t,{startDate:n,endDate:s}=r;e&&!t.view.dayTime.startShift&&(r.allDay=!0),t.days=t.makeDays(n,s)}updateDays(i){var e,t;const r=this;let{eventEl:n}=r;if(i!=null&&i.length){n||(r.eventEl=n=E.createElement({...r.eventDom}),n.classList.add("b-allday"));const{dropRootElement:s}=r,{visibleCellSelector:a,weekLength:l}=r.view,o=(t=(e=r.dragging)==null?void 0:e.peek("eventSourceHit"))==null?void 0:t.eventTop,d=E.children(s,a),c=E.down(s,`${a}[data-date='${i[i.length-1]}']`);E.down(c,".b-cal-event-bar-container").appendChild(n),n.style[r.view.rtl?"right":"left"]=E.percentify(100*(d.indexOf(c)-i.length+1)/l),n.style.width=E.percentify(100*i.length/l),o&&(n.style.top=o),r.view.scrollable.scrollIntoView(n,!0)}else n&&(n.classList.contains("b-cal-tentative-event")&&n.remove(),r.eventEl=null)}updateView(i,e){if(i){const t=C.diff(i.startDate,i.endDate,"d")>1;this.hoverable=t,this.draggable=t||this.view.owner.isDayView}super.updateView(i,e)}};y(hv,"$name","AllDayZone");var Yc=class extends uv{construct(...i){super.construct(...i);const e=this,{allDayEvents:t}=e.view;t&&e.view.showAllDayHeader!==!1&&(e.allDayZone=new e.allDayZoneClass({owner:e.owner,view:t,resource:e.resource}))}syncDraggingElements(i,e){var t;const{dragging:r}=this,{draggingItemCls:n}=r.source,s=r.itemElement.closest(".b-dayview-day-container"),a=(t=s==null?void 0:s.querySelectorAll(`[data-event-id="${i}"]`))!=null?t:[];for(const l of a)l.classList.toggle(n,e)}hitTest(i){const{view:e,dragging:t}=this,{dayTime:r}=e,n=super.hitTest(i);if(n){const{date:s}=n,a=i!=null&&i.isDragContext?e.getDateFromPosition(i.event.clientX,L.fromScreen(e.dayContainerElement).y+1,!1,r):r.startOfDay(n.date);if(t&&!this.isMoving&&e.interDayResize===!1||this.isMoving&&e.interDayDrag===!1){const l=t.peek("date");s.setDate(l.getDate()),s.setMonth(l.getMonth()),s.setFullYear(l.getFullYear()),a&&(a.setDate(l.getDate()),a.setMonth(l.getMonth()),a.setFullYear(l.getFullYear()))}n.overDate=a}return n}updateDragEventId(i,e){e&&this.syncDraggingElements(e,!1),i&&this.syncDraggingElements(i,!0)}get eventRecord(){var i;return super.eventRecord||((i=this.allDayZone)==null?void 0:i.eventRecord)}set eventRecord(i){super.eventRecord=i}get recurring(){var i;return this.isCreating&&((i=this.eventRecord)==null?void 0:i.recurrenceRule)!=null}get droppingAllDay(){var i,e;const t=(i=this.dropping)==null?void 0:i.peek("eventRecord");return(t==null?void 0:t.startDate)&&((e=this.view)==null?void 0:e.isAllDayEvent(t))||!1}get useAllDay(){return this.droppingAllDay&&this.view.showAllDayHeader&&this.dropping.source!==this.allDayZone}get wasAllDay(){return this.droppingAllDay&&this.dropping.source===this.allDayZone}doDestroy(){var i;(i=this.allDayZone)==null||i.destroy(),super.doDestroy()}dragStart(){var i,e;super.dragStart(),this.dragEventId=(e=(i=this.dragging.peek("eventRecord"))==null?void 0:i.id)!=null?e:null}findRootElement(i){return i.eventContentElement}captureDragOffset(i,e,t){t.set("eventOffset",[Math.floor(C.diff(i.startDate,e.date,"m")),"m"])}cleanupDrag(){var i;this.dragEventId=null,super.cleanupDrag(),(i=this.allDayZone)==null||i.cleanupDrag()}cleanupDrop(){var i,e,t;super.cleanupDrop(),(e=(i=this.owner.client)==null?void 0:i._scrollManager)==null||e.stopMonitoring(),(t=this.allDayZone)==null||t.cleanupDrop()}dropHitCreate(i,e){const t=this,{durationUnit:r}=t.eventRecord;let n=e.date,s=i.peek("eventCreate").date,a=n,l=s,o,d;const c=!(t.clearTime(s)-t.clearTime(n)),u=i.ctrlKey&&!c;u||c?(a=t.clearTime(n),l=t.clearTime(s),s=s-l,n=n-a,a<l&&([l,a]=[a,l]),n<s&&([s,n]=[n,s]),l.setTime(l.getTime()+s),o=C.as(r,Math.max(t.view.increment,Math.floor(n-s))),u&&(d=C.diff(t.clearTime(l),t.clearTime(a),"d")+1)):(a<l&&([l,a]=[a,l]),o=C.as(r,Math.floor((a-l)/bP),"m")),t.setEventData({startDate:l,duration:o,recurrenceRule:u?`FREQ=DAILY;COUNT=${d}`:null})}dropHitMove(i,e,t){let r=e.date;const n=this,{view:s}=n,a=s.dayTime.startOfDay(r);if(n.useAllDay)n.allDayZone.dropHitMove(i,e,t);else{if(t=n.eventRecord,r=n.applyDragOffset(r,i),s.showAllDayHeader&&r<a)r=a;else if(!s.snapRelativeToEventStartDate){const l=i.event.clientX>i.startEvent.clientX?"ceil":"floor";r=C[l](r,s.increment)}n.setEventData({startDate:r,endDate:C.add(r,t.duration,t.durationUnit),duration:t.duration})}}applyDragOffset(i,e){let t=super.applyDragOffset(i,e);if(this.constrainToDay){const{overDate:r}=this.hit;t=new Date(Math.max(Math.min(t,r.getTime()+this.view.dayTime.timeEnd-this.eventRecord.rawDurationMS),r))}return t}dropHitResize(i,e,t){const r=this,{eventRecord:n}=r,s=e.date;t.atEnd?n.startDate<s&&r.setEventData({endDate:s}):s<n.endDate&&r.setEventData({startDate:s})}async moveEventTo(i,e){const t=this,r=t.hitTest(i),n=r==null?void 0:r.date;if(n)if(t.useAllDay)await t.allDayZone.moveEventTo(i,e);else{const{view:s}=t,a=t.applyDragOffset(n,i),l=i.event.clientX>i.startEvent.clientX?"ceil":"floor",o=s.snapRelativeToEventStartDate?a:C[l](a,s.increment);if(t.wasAllDay){const d=C.add(s.dayTime.startOfDay(o),24,"h"),c=C.add(o,e.duration,e.durationUnit);if(e.allDay=!1,c>d){const u=s.autoCreate||s.changeAutoCreate(!0),h=C.parseDuration(u.duration),g=new Date(Math.min(C.add(o,h.magnitude,h.unit),d)),f=C.diff(o,g,e.durationUnit);e.setDuration(f,e.unit)}}await t.setStartDate(e,o)}}startCreate(i){this.createEvent({duration:0,durationUnit:this.durationUnit,startDate:i,isCreating:!0})}includeDay(i,e,t,r){return E.createElement({parent:e.querySelector(".b-dayview-event-container"),...this.renderEvent(this.eventRecord,t,r)})}removeDay(i,e){e.classList.contains("b-cal-tentative-event")&&e.remove()}setEventData(i,e){const t=this;if(t.useAllDay){t.allDayZone.setEventData(i,e);return}super.setEventData(i,e);const{eventRecord:r}=t,{endDate:n,startDate:s}=r,{dayTime:a}=t.view;let l=n;t.recurring&&(l=C.add(l,r.recurrence.count-1,"d")),t.days=t.makeDays(s,l),t.times=[a.delta(s,"s"),a.delta(n,"s")]}setupEvent(i,e){const t=this;t.useAllDay?t.allDayZone.setupEvent(i,e):(this.wasAllDay&&(i.allDay=!1,i.endDate=C.add(i.startDate,i.duration=1,i.durationUnit="hour")),super.setupEvent(i,e))}updateDays(i,e){super.updateDays(i,e),this.updateTimes(this.times,null)}updateTimes(i){if(!i)return;const e=this,{allDayZone:t,dayValues:r,dragging:n,eventRecord:s,isResizing:a,recurring:l,view:o}=e,{dayTime:d,eventSpacing:c}=o,{endDate:u,startDate:h}=s,[g,f]=i,m=!(n!=null&&n.aborted)&&(n==null?void 0:n.peek("eventInset")),p=!(n!=null&&n.aborted)&&(n==null?void 0:n.peek("eventWidth")),v=o.rtl?"right":"left",b=d.dateKey(h),w=d.dateKey(u),D=d.startOfDay(h)<d.startOfDay(u),S=100/d.duration("s");let{days:x}=e,R,M,_,k,F,I,A,P;if(x){for(R in r)M=r[R],_=R===b,A=M.style,P=g*S,k=(f-g)*S,oe.sync({targetElement:M,domConfig:e.renderEvent(e.eventRecord,_,R===x[x.length-1])}),!l&&D&&(_?k=100-P:R===w?k=P+k:k=100),A.top=l||_?E.percentify(P):0,A.height=E.percentify(k),A.paddingBottom=E.setLength(c),a&&(m&&(A[v]=m),p&&(A.width=`${p}px`)),F=L.from(M.querySelector(".b-cal-event-desc")),F&&(I=L.from(M.querySelector(".b-cal-event-footer")),I&&M.classList.toggle("b-cal-event-footer-desc-overlap",!!F.intersect(I)));if(!x||x.length<2||l)t==null||t.cleanupDrop(),x=null;else if(t&&o.showAllDayHeader){if(!t.eventRecord){t.noTip=!0;const H={startDate:s.startDate,endDate:s.endDate};if(a){const G=n.peek("eventRecord");H.assigned=G.assigned,H.eventColor=G.eventColor}t.createEvent(H,e.dropping)}t.eventRecord.set({startDate:s.startDate,endDate:C.add(s.startDate,x.length-1,"d")}),t.days=x}}}};y(Yc,"$name","DayZone"),y(Yc,"configurable",{dragEventId:null,hoverable:!0,hoverEdges:"tb",times:{$config:{equal:"array"},value:null},allDayZoneClass:hv,constrainToDay:!1});var uE=class extends Yc{static get $name(){return"DayAgendaZone"}findRootElement(){return this.view.eventContentElement}hitTest(i){var e,t;const r=hn.prototype.hitTest.call(this,i);return r&&(r.hourElement=(t=((e=i.event||i.domEvent)==null?void 0:e.target)||i)==null?void 0:t.closest("[data-hour]")),r}setEventData(){return hn.prototype.setEventData.apply(this,arguments)}dropHitMove(i,e,t){let r=e.date;const n=this,{view:s}=n,a=s.dayTime.startOfDay(r);if(t=n.eventRecord,r<a)r=a;else if(!s.snapRelativeToEventStartDate){const l=i.event.clientX>i.startEvent.clientX?"ceil":"floor";r=C[l](r,s.increment)}n.setEventData({startDate:r,endDate:C.add(r,t.duration,t.durationUnit),duration:t.duration})}async moveEventTo(i,e){const t=this,{date:r,hourElement:n}=t.hitTest(i);if(r&&n){const{view:s}=t,a=i.event.clientX>i.startEvent.clientX?"ceil":"floor",l=s.snapRelativeToEventStartDate?r:C[a](r,s.increment);if(t.wasAllDay){const o=C.add(s.dayTime.startOfDay(l),24,"h"),d=C.add(l,e.duration,e.durationUnit);if(e.allDay=!1,d>o){const c=s.autoCreate||s.changeAutoCreate(!0),u=C.parseDuration(c.duration),h=new Date(Math.min(C.add(l,u.magnitude,u.unit),o)),g=C.diff(l,h,e.durationUnit);e.setDuration(g,e.unit)}}await t.setStartDate(e,l)}}};y(uE,"configurable",{hoverable:!1,dragProxy:{type:"default",open(i){const e=this,{source:t}=i,r=i.element.closest(".b-cal-event-wrap");e.proxyEl=r.cloneNode(!0),e.proxyEl.classList.add("b-cal-drag-proxy"),e.proxyEl.style.width=`${r.offsetWidth}px`,e.proxyEl.style.setProperty("--cal-event-color",r.style.getPropertyValue("--cal-event-color")),e.proxyOffset=V.getClientPoint(i.startEvent).getDelta(L.from(r)),t.view.firstVisibleCell.appendChild(e.proxyEl)},dragMove(i){const{source:e}=i,{view:t,eventRecord:r}=e;e.hit&&this.proxyEl?(oe.sync({targetElement:this.proxyEl,domConfig:{...e.renderEvent(r),onlyChildren:!0}}),E.alignTo(this.proxyEl,V.getClientPoint(i.event).translate(20,20),{align:"t0-t0",constrainTo:e.dragRootElement}),t.overHour=e.hit.date):t.overHour=null},close(i){var e;i.source.view.overHour=null,(e=this.proxyEl)==null||e.remove()}}});var gv=class extends hv{syncHoverListeners(){}beforeDrag(i){const e=this.hitTest(i);return!(e!=null&&e.resource)||e.type==="resize"||e.type==="schedule"?!1:super.beforeDrag(i)}setupEvent(){return this.view.defaultCalendar=(this.dragging||this.dropping).peek("resource"),super.setupEvent(...arguments)}updateHit(i,e){(!i||i.resource)&&super.updateHit(i,e)}makeDays(i){var e;const t=this,{isMoving:r}=t,n=t.dragging||t.dropping,s=r?new Date(Math.max(i,t.view.firstVisibleDate)):n.peek("date"),a=super.makeDays(s,C.add(s,1,"d"));return a.resource=(e=t.hit)==null?void 0:e.resource,a}updateDays(i){var e,t;const r=this;let{view:n,eventEl:s}=r;if(i!=null&&i.length){s||(r.eventEl=s=E.createElement({...r.eventDom}),s.classList.add("b-allday"));const a=(t=(e=r.dragging)==null?void 0:e.peek("eventSourceHit"))==null?void 0:t.eventTop;E.down(r.dropRootElement,`${n.visibleCellSelector}:is(${i.map(o=>`[data-date="${o}"]`).join(",")}) [data-resource-id="${i.resource.id}"] > .b-cal-event-bar-container`).appendChild(s),s.style.width="100%",a&&(s.style.top=a),n.scrollable.scrollIntoView(s,!0)}else s&&(s.classList.contains("b-cal-tentative-event")&&s.remove(),r.eventEl=null)}};y(gv,"$name","ResourceCalendarRowZone"),y(gv,"configurable",{droppableSelector:".b-calendarrow-cell-container,.b-dayresourcecalendarrow-cell-resources,.b-dayresource-allday.b-cal-cell-header"});var fv=class extends Yc{beforeDrag(i){const e=this.hitTest(i);return e!=null&&e.resource?super.beforeDrag(i):!1}setupEvent(){return this.view.defaultCalendar=(this.dragging||this.dropping).peek("resource"),super.setupEvent(...arguments)}hitTest(i){const e=this.dragging||this.dropping,t=super.hitTest(i);if(t&&e&&!this.isMoving){const r=e.peek("date");t.resource=e.peek("resource"),t.date.setDate(r.getDate()),t.date.setMonth(r.getMonth()),t.date.setFullYear(r.getFullYear())}return t}updateHit(i,e){(!i||i.resource)&&super.updateHit(i,e)}makeDays(i,e){var t;const r=this,{isMoving:n}=r,s=r.dragging||r.dropping,a=n?i:s.peek("date"),l=super.makeDays(a,C.add(a,1,"d"));return l.resource=(t=r.hit)==null?void 0:t.resource,l}updateDays(i){const e=this;let{eventEl:t}=e;if(i!=null&&i.length){const r=E.down(e.dropRootElement,`:is(${i.map(n=>`[data-date="${n}"]`).join(",")}) ${e.view.visibleCellSelector}[data-resource-id="${i.resource.id}"] .b-dayview-event-container`);t||(e.eventEl=t=E.createElement({...e.eventDom})),r.appendChild(t)}else t&&(t.classList.contains("b-cal-tentative-event")&&e.view.setTimeout(()=>t.remove(),100),e.eventEl=null);e._times=null}updateTimes(i){if(!i||!this.days)return;const e=this,{dayTime:t,eventSpacing:r}=e.view,[n,s]=i,a=100/t.duration("s"),{style:l}=e.eventEl,o=n*a,d=(s-n)*a;oe.sync({targetElement:e.eventEl,domConfig:e.renderEvent(e.eventRecord,!0,!0)}),l.top=E.percentify(o),l.height=E.percentify(d),l.paddingBottom=E.setLength(r),l.width="100%"}};y(fv,"$name","DayResourceZone"),y(fv,"configurable",{allDayZoneClass:gv});var hE=class extends hn{static get configurable(){return{coverage:{$config:{equal:T.isEqual},value:null},hoverable:!0,hoverEdges:"lr",hoverSelector:".b-cal-event-wrap.b-allday"}}findRootElement(i){return i.weeksElement}captureDragOffset(i,e,t){t.set("eventOffset",[Math.floor(C.diff(this.clearTime(i.startDate),e.date,"d")),"d"])}cleanupDrag(){super.cleanupDrag();const i=()=>this.coverage=null;this.isCreating?this.view.afterRefresh(i):i()}cleanupDrop(){var i,e;super.cleanupDrop(),(e=(i=this.owner.client)==null?void 0:i._scrollManager)==null||e.stopMonitoring();const t=()=>this.coverage=null;this.isCreating?this.view.afterRefresh(t):t()}dropHitCreate(i,e){const t=this,r=i.ctrlKey,n=i.peek("eventCreate");let s=null,a,l,o,d,c,u,h;d=t.clearTime(e.date),c=t.clearTime(n.date),l=n.dayNumber,o=e.dayNumber,u=n.weekOffset,h=e.weekOffset,h<u&&([u,h]=[h,u]),r?(a=h-u+1,s=a>1?`FREQ=WEEKLY;COUNT=${a}`:null,d<c?(c=d,l<o&&(c=C.add(c,l-o,"d"))):o<l&&(c=C.add(c,o-l,"d")),o<l&&([l,o]=[o,l])):d<c&&([c,d]=[d,c],[l,o]=[o,l]),t.setEventData({startDate:c,duration:C.as(t.eventRecord.durationUnit,(r?o-l:C.diff(c,d,"d"))+1,"d"),recurrenceRule:s})}dropHitNowhere(i){super.dropHitNowhere(i),this.coverage=null}setEventData(i,e){super.setEventData(i,e);const{dropping:t,eventRecord:r,view:n}=this,{visibleCellSelector:s}=n,a=E.children(n.weeksElement,"> .b-calendar-week"),l={},o=d=>{const{startDate:c,endDate:u}=d;for(let h,g,f,m,p=0;p<a.length;++p){for(h=E.children(a[p],s),m=h.length,g="",f=0;f<m;++f){const v=n.getDateFromElement(h[f]),b=C.add(v,1,"d");c<b&&v<u&&(!f&&c<v&&(g="<"),g+=f,f===m-1&&b<u&&(g+=">"))}g&&(l[p]||(l[p]=[])).push(g)}};t!=null&&t.has("eventRecord")||!r.recurrence?o(r):r.recurrence.forEachOccurrence(n.startDate,n.endDate,o),this.coverage=l}updateCoverage(i){var e;const t=this,{dragging:r,weekValues:n,view:s}=t,{rtl:a}=s,{visibleCellSelector:l}=s,o=i&&(r==null?void 0:r.peek("eventSourceHit")),d=o==null?void 0:o.eventTop,c={},u=s.getWeekElementFor(o==null?void 0:o.eventElement),{weekElements:h}=s;let g,f,m,p,v,b,w,D,S,x,R;for(t.weekValues=c,S=0;S<h.length;++S)if(p=i==null?void 0:i[S])for(R=h[S],f=E.children(R,l),x=0;x<p.length;++x)(b=(e=n==null?void 0:n[S])==null?void 0:e.shift())||(b=E.createElement(t.eventDom)),(c[S]||(c[S]=[])).push(b),m=p[x],w=m.includes("<")?1:0,D=m.includes(">")?1:0,m=m.substr(w,m.length-D-w),b.classList[w?"add":"remove"]("b-continues-past"),b.classList[D?"add":"remove"]("b-continues-future"),b.style[a?"right":"left"]=E.percentify(100*Number(m[0])/f.length),b.style.width=E.percentify(100*m.length/f.length),d&&R===u&&(b.style.top=d),g=f[Number(m[m.length-1])],v=E.down(g,".b-cal-event-bar-container"),v!==b.parentNode&&v.appendChild(b);if(n)for(S in n)n[S].forEach(M=>{M.classList.contains("b-cal-tentative-event")&&M.remove()})}};y(hE,"$name","MonthZone");var gE=class extends hn{static get configurable(){return{droppable:!1,dragProxy:{type:"default",open(i){const e=this,{owner:t}=i.source.view,r=i.element.closest(".b-cal-event-wrap");t.isYearView&&(e.proxyEl=r.cloneNode(!0),e.proxyEl.classList.add("b-cal-drag-proxy"),e.proxyEl.style.width=`${r.offsetWidth}px`,e.proxyOffset=V.getClientPoint(i.startEvent).getDelta(L.from(r)),t.contentElement.appendChild(e.proxyEl))},dragMove(i){this.proxyEl&&E.alignTo(this.proxyEl,V.getClientPoint(i.event).translate(15,15),{align:"t0-t0"})},close(){var i;(i=this.proxyEl)==null||i.remove()}}}}findRootElement(i){return i.contentElement}beforeDrag(i){const e=this.hitTest(i);if((e==null?void 0:e.type)!=="event"||!this.owner.draggable||!e.eventRecord.isDraggable)return!1;i.set("eventRecord",e.eventRecord),i.set("eventDragMode",i[hi]=Sg.move.mode)}dragStart(){this.view.hide()}};y(gE,"$name","OverflowZone");var fE=class extends hn{startCreate(){var i;(i=this.view._overflowPopup)==null||i.hide(),super.startCreate(...arguments)}dragEnter(i){const e=super.dragEnter(i);return e!==!1&&this.view.contentElement.classList.add(this.draggingCls),e}dragLeave(i){super.dragLeave(i),this.view.contentElement.classList.remove(this.draggingCls)}dropHitCreate(i,e,t){const r=this;let n=r.clearTime(e.date),s=r.clearTime(t.date);n<s&&([s,n]=[n,s]),r.setEventData({startDate:s,endDate:C.add(n,1,"d")}),r.days=r.makeDayRange(s,n)}dropHitMove(i,e,t){super.dropHitMove(i,e,t);const r=this,n=r.eventRecord;let{endDate:s}=n;n.allDay&&(s=C.add(s,-1,"d")),r.days=r.makeDayRange(n.startDate,s)}includeDay(i){const e=E.children(this.view.bodyElement,`[data-date='${i}']`);return e.forEach(t=>t.classList.add(`b-cal-tentative-event${this.view.hideNonWorkingDays?":not(.b-nonworking-day)":""}`)),e}makeDayRange(i,e){const t=[];for(let r=i;r<=e;r=C.add(r,1,"d"))t.push(C.format(r,CP));return t}removeDay(i,e){e.forEach(t=>t.classList.remove("b-cal-tentative-event"))}};y(fE,"$name","YearZone");var DP=class extends ${static get configurable(){return{view:null,zones:{$config:["nullify"],value:[]}}}updateView(i){i.eachView(e=>{this.onResourceViewViewCreate({view:e})}),i.ion({viewCreate:"onResourceViewViewCreate",thisObj:this})}onResourceViewViewCreate({view:i}){const e=this,{zones:t,owner:r}=e,n=r.client.constructor.Modes,s=r.getViewZoneType(n.resolveType(i.type));s&&t.push(r.createZone(s,{view:i,resource:i.defaultCalendar}))}changeZones(i,e){if(e!=null&&e.length&&!i)for(let t=0,{length:r}=e;t<r;t++)e[t].destroy();return i}},qc=class extends qe{constructor(){super(...arguments),y(this,"callOnFunctions",!0)}static get configurable(){return{disableOnReadOnly:!0,localizableProperties:["newName","recurrenceTip"],creatable:!0,draggable:!0,durationUnit:null,footer:{className:"b-cal-event-footer"},gripper:{class:"b-gripper"},newName:"L{newEvent}",recurrenceTip:"(L{holdCtrlForRecurrence})",resizable:!0,tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",disabled:!0,forSelector:null,tools:null}},validateCreateFn:()=>{},validateMoveFn:()=>{},validateResizeFn:()=>{},zoneTypes:{day:Yc,dayagenda:uE,month:hE,year:fE,resource:DP,dayresource:fv},removeFromExternalStore:!0}}onBeforeDragStart(i){var e;const{client:t}=this,{drag:r,event:n}=i,{view:s}=r.source,a=r[hi].type,l=(e=s.getResourceRecord)==null?void 0:e.call(s,r.element),o=r.peek("date"),d={drag:r,domEvent:n,view:s,date:o,resourceRecord:l,eventRecord:r.peek("eventRecord"),feature:this.owner};if(t.trigger(`beforeDrag${O.capitalize(a)}`,d)===!1)return!1;if(r.peek("eventDragMode").type==="create")return t.trigger("beforeAutoCreate",{view:s,domEvent:n,date:o,resourceRecord:l})}changeGripper(i,e){return e==null||e.remove(),i&&E.createElement(i)}changeTooltip(i,e){return i&&(i=i===!0?this.constructor.configurable.tooltip.value:i,this.initialConfig.tooltip&&(i.disabled=!1),i.ownerFeature=this),z.reconfigure(e,i,this)}};y(qc,"$name","CalendarDrag"),y(qc,"type","drag"),qc.initClass(),qc._$name="CalendarDrag";var EP={wrapStartDate:{get(){return C.add(this.startDate,we.from(this.preamble).negate())}},wrapEndDate:{get(){return C.add(this.endDate,we.from(this.postamble))}},outerStartDate:{get(){return this.wrapStartDate}},outerEndDate:{get(){return this.wrapEndDate}}},Os=class extends qe{static get pluginConfig(){return{chain:["onEventDataGenerated"]}}onEventDataGenerated({eventRecord:i,resourceRecord:e,view:t},{children:r}){var n,s;if(Object.getOwnPropertyDescriptor(i.constructor.prototype,"wrapStartDate")||Object.defineProperties(i.constructor.prototype,EP),this.enabled&&t.isDayView){const{showDuration:a,renderer:l}=this,o={},d={};let c=we.from(i.preamble),u=we.from(i.postamble);l&&t.callback(l,t,[{eventRecord:i,resourceRecord:e,preambleConfig:o,postambleConfig:d}]),c!=null&&c.magnitude||(c=null),u!=null&&u.magnitude||(u=null);const h=c?C.as("minute",c):0,g=u?C.as("minute",u):0;if(c){const f={className:{"b-cal-event-buffer":1,"b-cal-preamble":1,[o.cls]:o.cls},style:{height:`calc(var(--hour-height) * ${h/60} + 1px)`},children:a?[{className:"b-travel-time-label",children:[o.icon?{tag:"i",className:o.icon}:void 0,{tag:"span",className:"b-buffer-label",text:(n=o.text)!=null?n:c.toString()}]}]:void 0};a&&o.tooltip&&(f.children[0].dataset={btip:o.tooltip}),r.push(f)}if(u){const f={className:{"b-cal-event-buffer":1,"b-cal-postamble":1,[d.cls]:d.cls},style:{height:`calc(var(--hour-height) * ${g/60} + 1px)`},children:a?[{className:"b-travel-time-label",children:[d.icon?{tag:"i",className:d.icon}:void 0,{tag:"span",className:"b-buffer-label",text:(s=d.text)!=null?s:u.toString()}]}]:void 0};a&&d.tooltip&&(f.children[0].dataset={btip:d.tooltip}),r.push(f)}}}updateShowDuration(){this.isConfiguring||this.client.eachView("refresh")}doDisable(){this.isConfiguring||this.client.eachView("refresh")}};y(Os,"$name","EventBuffer"),y(Os,"type","eventBuffer"),y(Os,"configurable",{showDuration:!0,renderer:null}),qe.register(Os.type,Os),Os._$name="EventBuffer";var xP={magnitude:1,unit:"hour"},mE=class extends $.mixin(ad,Ju){static get configurable(){return{dragItemSelector:".b-grid-row",dragProxy:{type:"default",open(i){const e=this.owner.owner,t=e.openProxy(i);return i.cleaners.push(()=>{e.insertionPoint=null,t.remove()}),t},dragMove(i){return this.owner.owner.moveProxy(i)},close(){var i;(i=this.owner.owner.proxyEl)==null||i.remove()}}}}beforeDrag(i){return this.owner.onDragStart(i)}dragEnter(i){i.source.isMoving&&(i.element=i.targetElement,this.dragProxy.open(i))}dragMove(i){if(i.source.isMoving&&this.dragProxy.dragMove(i),i.source.isMoving||i.source.isExternalZone)return this.owner.onDragMove(i)}dragDrop(i){if(i.source.isMoving&&this.dragProxy.close(),i.target===this&&(i.source.isMoving||i.source.isExternalZone))return this.owner.onDragDrop(i)}};y(mE,"$name","ExternalZone");var mv=class _v extends qe.mixin(fe){static get delayable(){return{onCalendarPaint:"raf"}}static get configurable(){return{grid:{$config:["lazy"],value:null},dragRootElement:{$config:"lazy",value:null},dragItemSelector:null,getRecordFromElement:function(e){const t=this.grid||(this.grid=z.fromElement(e,"grid"));return t?t.getRecordFromElement(e):e.innerText},hideExternalProxy:!0,draggable:{$config:["lazy"],value:{}},droppable:{$config:["lazy"],value:null},insertionPoint:null}}construct(){super.construct(...arguments),this.client.isPainted&&this.onCalendarPaint({source:this.client,firstPaint:!0})}onCalendarPaint({source:e,firstPaint:t}){if(t){const{draggable:r={},droppable:n={}}=this,s=new mE({view:this.grid,...r,...n});this._draggable&&(this._draggable=s),this._droppable&&(this._droppable=s)}e.ion({beforeDragMoveEnd:"onBeforeDragMoveEnd",dragMoveEnd:"onDragMoveEnd",thisObj:this})}onBeforeDragMoveEnd({drag:e}){var t;if(e.source===this.draggable){e.dropOnCalendar=!0;const r=(t=this.grid)==null?void 0:t.store,n=this.client.trigger("beforeDropExternal",e);return r!=null&&r.isChained&&r.fillFromMaster(),n}}onDragMoveEnd({drag:e}){if(e.source===this.draggable)return this.client.trigger("dropExternal",e)}onDragStart(e){var t;const r=this,{client:n,grid:s}=r,{eventStore:a}=n,{modelClass:l}=a;if(!e.itemElement)return!1;let o=r.callback(r.getRecordFromElement,r,[e.itemElement]);if(o.isModel)s&&e.set("sourceStore",s.store),o.isEventModel||(o=a.createRecord(o.data));else{if(typeof o=="string"){const d=n.activeView.autoCreate||n.autoCreate,c=C.parseDuration((d==null?void 0:d.duration)||xP);o={[l.getFieldDataSource("name")]:o,[l.getFieldDataSource("duration")]:c.magnitude,[l.getFieldDataSource("durationUnit")]:c.unit}}o=a.createRecord(o)}e.set("sourceStore",(t=r.grid)==null?void 0:t.store),e.set("eventRecord",o),e.eventRecord=o}onDragMove(e){const{grid:t}=this;if(t){const r=t.rowManager.getRowFor(e.targetElement),n=r&&t.store.getAt(r.index);if(r){const s=e.lastMoveEvent.clientY<r.getRectangle(Object.keys(t.subGrids)[0]).center.y;e.overIndex=r.index,e.overRecord=n,e.isAbove=s,this.insertionPoint=n===e.peek("eventRecord")?{}:{row:r,isAbove:s}}else if(t.contains(e.targetElement)){const s=t.headerContainer.classList,{bottomRow:a}=t.rowManager;e.overIndex=(a==null?void 0:a.index)||-1,e.overRecord=a?t.store.getById(a.id):null,e.isAbove=!1,this.insertionPoint={row:a||{addCls:l=>s.add(l),removeCls:l=>s.remove(l)}}}else e.overIndex=NaN,this.insertionPoint=null}e.eventRecord=e.data.get("eventRecord"),this.client.trigger("dragMoveExternal",e)}changeInsertionPoint(e,t){if((e==null?void 0:e.row)!==(t==null?void 0:t.row)||(e==null?void 0:e.isAbove)!==(t==null?void 0:t.isAbove))return e}updateInsertionPoint(e,t){var r,n;(r=t==null?void 0:t.row)==null||r.removeCls(t.isAbove?"b-drop-above":"b-drop-below"),(n=e==null?void 0:e.row)==null||n.addCls(e.isAbove?"b-drop-above":"b-drop-below")}async onDragDrop(e){const{client:t,grid:r}=this,{eventStore:n}=t,{eventRecord:s}=e,a=r==null?void 0:r.store,l=a===n||(a==null?void 0:a.masterStore)===n;if(t.trigger("beforeDropExternal",e)===!1){a!=null&&a.isChained&&a.fillFromMaster();return}isNaN(e.overIndex)||(n.includes(s)&&!l&&!e.source.view.resource&&n.remove(s),l?n.move(s,n.getAt(e.overIndex+e.isAbove?1:0)):a.insert(e.overIndex+(e.isAbove?0:1),s),a!=null&&a.isChained&&a.fillFromMaster()),t.trigger("dropExternal",e)}openProxy(e){var t;const{grid:r,dragRootElement:n,client:s}=this,a=e.element.closest(this.draggable.dragItemSelector)||e.element,l=r?a.querySelector('[data-column="name"]'):a,o=this.proxyEl||(this.proxyEl=E.createElement({className:"b-grid-to-cal-drag-proxy"})),d=(r==null?void 0:r.element)||n.parentNode,c=s.element.contains(d)?s.element:d;return o.innerHTML=((t=e.peek("eventRecord"))==null?void 0:t.name)||(l==null?void 0:l.innerHTML)||this.owner.L("L{newEvent}"),this.proxyOffset=V.getClientPoint(e.event).getDelta(L.from(a)),c.appendChild(o),o}moveProxy(e){var t;const{proxyEl:r}=this,{targetElement:n}=e,{activeView:s}=this.client;r&&((s.eventContentElement.contains(n)||((t=s.allDayEvents)==null?void 0:t.contains(n)))&&this.hideExternalProxy?r.classList.add("b-hide-display"):(r.classList.remove("b-hide-display"),E.alignTo(r,V.getClientPoint(e.event).translate(10,10),{align:"t0-t0"})))}changeDragRootElement(e){return typeof e=="string"&&(e=document.querySelector(e)||document.getElementById(e)),e}changeDraggable(e){const{grid:t}=this,r=(t==null?void 0:t.contentElement)||this.dragRootElement,{dragItemSelector:n}=this;return e=_v.mergeConfigs({owner:this,grid:t},e),r&&(e.dragRootElement=r),n&&(e.dragItemSelector=n),e}changeDroppable(e){const{grid:t}=this,r=(t==null?void 0:t.contentElement)||this.dropRootElement;return e&&(e=_v.mergeConfigs({owner:this,grid:t},e),r&&(e.dropRootElement=r)),e}changeGrid(e){if(e){const t=typeof e,{resourceStore:r,project:n}=this.client;t==="string"&&(e=z.getById(e)),e.setConfig({resourceStore:r,project:n})}return e}};y(mv,"$name","ExternalEventSource"),y(mv,"type","externalEventSource");var pv=mv;pv.initClass(),pv._$name="ExternalEventSource";var po=class extends eo{constructor(i){super(i.client,i)}get exporter(){const i=this;return i._exporter||(i._exporter=i.exporterClass.new({target:i.client},i.exporterConfig))}};y(po,"$name","ExcelExporter"),y(po,"type","excelExporter"),qe.register(po.type,po),po._$name="ExcelExporter";var vo=class extends qe{construct(i){const{client:e}=i;e.eventStore.syncDataOnLoad=!1,e.ion({dateRangeRequested:"onClientDateRangeRequested",thisObj:this}),e.crudManager.ion({beforeLoadApply:"onCrudManagerBeforeApply",thisObj:this,prio:9999}),super.construct(...arguments)}hasOutstandingLoadFor(i,e){var t;const{load:r}=this.client.crudManager.activeRequests;if(r){const n=(t=r.options)==null?void 0:t.dateRangeRequested;if(n&&C.timeSpanContains(n.startDate,n.endDate,i,e))return!0}}onCrudManagerBeforeApply({response:i,options:e}){this.lastRangeLoaded=i.success&&(e==null?void 0:e.dateRangeRequested)}onClientDateRangeRequested({new:{startDate:i,endDate:e},changed:t}){const r=this,{client:n}=r;if(!t&&r.alwaysLoadNewRange)return;const{lastRangeLoaded:s}=r;if(s&&!r.alwaysLoadNewRange){const{startDate:a,endDate:l}=r.lastRangeLoaded;if(C.timeSpanContains(a,l,i,e))return}t&&(E.addTemporaryClass(n.element,"b-notransition",100,n),r.clearOnNewRange&&(n.eventStore.clear(!0),r.lastRangeLoaded=null)),!r.disabled&&!r.hasOutstandingLoadFor(i,e)&&r.loadDateRange(i,e)}refresh(){const{lastRangeLoaded:i}=this;i&&this.loadDateRange(i.startDate,i.endDate)}loadDateRange(i,e){const t=this,{pendingLoad:r,client:n}=t,{datePicker:s}=n;if(s!=null&&s.showEvents){const{activeView:a}=n;i=new Date(Math.min(a.startDate,s.startDate)),e=new Date(Math.max(a.endDate,s.endDate))}r?(r.startDate=C.min(i,r.startDate),r.endDate=C.max(e,r.endDate)):(t.pendingLoad={startDate:i,endDate:e},t.client.requestAnimationFrame(()=>t.load()))}async load(){const i=this,{client:e,beforeRequest:t,dateFormat:r}=i,{crudManager:n}=e,{load:s}=n.activeRequests,{startDate:a,endDate:l}=i.pendingLoad,o={dateRangeRequested:i.pendingLoad,request:{params:{[i.startDateParamName]:C.format(a,r),[i.endDateParamName]:C.format(l,r)}}};if(i.pendingLoad=null,t&&i.callback(t,e,[o]),s){if(i.hasOutstandingLoadFor(a,l))return;try{await n.cancelRequest(s.desc,s.reject)}catch(c){}}let d;try{d=await n.load(o)}catch(c){!e.isDestroyed&&!c.cancelled&&e.trigger("loadOnDemandFail",c)!==!1&&Ea.alert({title:e.L("L{Calendar.loadFail}"),message:c.message})}d&&!e.isDestroyed&&e.trigger("dateRangeLoad",{response:d.response,options:o,startDate:a,endDate:l})}};y(vo,"$name","LoadOnDemand"),y(vo,"type","loadOnDemand"),y(vo,"configurable",{startDateParamName:"startDate",endDateParamName:"endDate",dateFormat:"YYYY-MM-DD",beforeRequest:null,alwaysLoadNewRange:null,clearOnNewRange:null}),vo.initClass(),vo._$name="LoadOnDemand";var pE=class extends tl{restoreState({client:i}){}saveState({client:i}){}cloneElement(i,e=this.element,t=!0){t&&(e.innerHTML=""),e.appendChild(i.cloneNode(!0))}pageTpl(i){const{config:e,title:t,header:r,footer:n,styles:s,htmlClasses:a,bodyStyle:l,bodyClasses:o=[`b-${this.constructor.type}`,...this.owner.bodyClasses,...z.outerCls],paperHeight:d,paperWidth:c,html:u}=i,h=Y.isSafari?"":"window.removeElement && window.removeElement();",g=e!=null&&e.debug?"":`<script type="text/javascript">window.addEventListener('load', function() { window.print(); ${h} });<\/script>`;return Pt.tpl`
            <!DOCTYPE html>
            <html class="${a}" style="width: ${c}in; height: ${d}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${s.join("")}
                </head>
                <body class="b-print ${o.join(" ")}" style="width: ${c}in; height: ${d}in; ${l}">
                    <div class="b-print-content">
                        ${r&&`<div class="b-print-header" style="width: 100%">${r}</div>`}
                        <div class="b-print-body"><div class="b-print-viewport">${u}</div></div>
                        ${n&&`<div class="b-print-footer" style="width: 100%">${n}</div>`}
                    </div>
                    ${g}
                </body>
            </html>`}};pE._$name="Printer";var vE={configurable:!0,get:()=>Number.MAX_SAFE_INTEGER},RP=(i,e)=>i+e,yo=class extends pE{getTotalHeight(i){const{activeView:e}=i;switch(i.mode){case"agenda":return e.virtualScrollHeight;case"day":return e.dayContentElement.scrollHeight+e.alldayRowElement.offsetHeight;case"week":return e.dayContentElement.scrollHeight+e.alldayRowElement.offsetHeight;case"month":if(this.owner.wysiwyg)return e.weeksElement.scrollHeight+e.weekdaysHeader.offsetHeight+10;break;case"year":return this.inchToPx(Pi.A4.width)}}getTotalWidth(i){switch(i.mode){case"year":return this.inchToPx(Pi.A4.height);default:return this.inchToPx(Pi.A4.width)}}async prepareComponent(i){const e=this,{owner:t}=e,{wysiwyg:r}=t,n=!r,{client:s}=i,{activeView:a}=s;if(e.exportMeta={title:t.callback(t.titleRenderer,t,[a]),totalWidth:e.getTotalWidth(s),totalHeight:e.getTotalHeight(s),subGrids:{}},s.mode==="month"&&n&&(Object.defineProperty(a,"eventsPerCell",vE),Object.defineProperty(a,"maxEventsPerCell",vE),a.doRefresh()),e.cloneElement(a.currentElement),s.mode==="month"){let l;n&&(l=a.shrinkwrapRowHeights,delete a.eventsPerCell,delete a.maxEventsPerCell,a.doRefresh(),e.exportMeta.totalHeight=l.reduce(RP,a.weekdaysHeader.offsetHeight)),a.weekElements.forEach((o,d)=>{const c=e.element.querySelector(`[data-week="${o.dataset.week}"]`);c.style.minHeight="",n?c.style.flex=`0 0 ${l[d]}px`:r?c.style.flex=`1 0 ${o.offsetHeight}px`:c.style.flex=`1 0 ${250/6}mm`})}}pxToInch(i){return(i/96).toFixed(2)}};y(yo,"$name","CalendarPrinter"),y(yo,"type","calendar"),yo.prototype.pagesExtractor=async function*(e){const t=this,{totalHeight:r,totalWidth:n,title:s}=t.exportMeta;yield{html:t.pageTpl({config:e,title:s,html:t.prepareExportElement(),styles:t.stylesheets,paperWidth:t.pxToInch(n),paperHeight:t.pxToInch(r)})}},yo._$name="CalendarPrinter";var TP=Object.freeze([]),Kc=class extends qe{static get configurable(){return{printer:{$config:["lazy","nullify"],value:{type:"calendar"}},wysiwyg:!1,titleRenderer:i=>i.description,printers:new Map([[yo.type,yo]]),gridPrintConfig:null}}construct(){super.construct(...arguments),this.client.print=this.print.bind(this)}changePrinter(i){const e=this,t=e.printersMap||(e.printersMap=new Map);if(i){let r;const{type:n}=i;if(t.has(n))r=t.get(n),r.setConfig(i);else{const s=e.printers.get(n);if(!s)throw new Error(`Printer type ${n} is not found. Make sure you've configured it`);i=T.clone(i),i.owner=e,r=new s(i),r.relayAll(e),t.set(n,r)}return r}else t.forEach(r=>r.destroy())}get bodyClasses(){return this.shrinkwrapRowHeights?["b-shrinkwrap-row-heights"]:TP}async print(i={}){var e;const t=this,{client:r,printer:n}=t,s=`${r.id}-print-iframe`;if(r.trigger("beforePrint",{config:i,printer:n})!==!1)if(r.activeView.isEventList)await r.activeView.print(T.assign({exporterType:"multipagevertical",useRenderedColumnWidth:!0},this.gridPrintConfig||{})),r.trigger("print");else{i.client=r;const a=await t.printer.export(i);if(i.debug)r.trigger("print",a);else{(e=document.getElementById(s))==null||e.remove();const l=E.createElement({id:s,class:"b-calendar-print-iframe",tag:"iframe",parent:document.body});return l.contentWindow.removeElement=()=>{l.remove(),r.trigger("print",a)},l.contentWindow.document.write(a[0].html),l.contentWindow.document.close(),a}}}};y(Kc,"$name","Print"),y(Kc,"type","print"),Kc.initClass(),Kc._$name="Print";var Eg=i=>({className:i.cls,style:i.style}),MP={end:"pos",start:"neg"},_P={end:"start",start:"end"},kP=Object.entries({alignment:"alignment",color:"color",footer:"footer",header:"name",rotation:"rotation"}),xg=class extends so{onBeforeLayoutEvents({source:i,context:e}){const[t,r]=i.isDayView?[C.add(e.cellData.date,i.dayStartMs),C.add(e.cellData.date,i.dayEndMs)]:[e.cellData.date,e.cellData.tomorrow],n=i.getTimeRanges(t,r);if(n.length){const{layout:s}=e,a={},l={},o=[],d=[];let c,u;e.timeRangeHeaders=l,e.timeRanges=n;for(const h of n)u=s.createLayoutItem(h,e),u.values=Object.fromEntries(kP.map(([g,f])=>[g,h[f]])),u.values.rotation=u.values.rotation||MP[u.values.alignment],s.clusterize(o,d,u,e),c=e.dayDomConfig.children.inset,c=c.children||(c.children=[]),c.push(this.renderTimeSpan(e,u,l,a));(l.end||a.end)&&(e.dayDomConfig.className["b-dayview-inset-after"]=1),(l.start||a.start)&&(e.dayDomConfig.className["b-dayview-inset-before"]=1)}}renderPart(i,e,t,r,n,s,a){const l=r==="footer",{record:o}=t,d={timeRange:o};let c=t,u,h,g;if(typeof r=="string"?(t[r]=c=T.merge({part:r,record:o,outer:t,cls:{[`b-cal-timerange-${r}`]:1}},a),g=t.values[r],g!=null&&(d.value=c.value=g)):(h=r,r="outer"),i=i==null?void 0:i[r],e=e==null?void 0:e[r],d.renderData=c,d.domConfig=h,e){c.style={};const f=e(d);typeof f=="string"?h=Object.assign({html:f},h):T.isObject(f)&&(u=f)}return u=u||(i==null?void 0:i(d)),h&&(u=T.merge(u||{},h)),n&&u&&(s=l&&_P[s]||s,n[s]=(n[s]||0)+1),c.domConfig=u,u}renderTimeSpan(i,e,t,r){const n=this,{owner:s}=n,{defaultRenderer:a,renderer:l}=s,o=e.eventRecord,d=isNaN(e.end)?0:Math.abs(e.end-e.start),c=d>1,u=!c,{rtl:h}=i.layout.owner,{values:g}=e,{alignment:f,color:m,rotation:p}=g,v={color:m,values:g,isLine:u,record:o,layoutContext:i,cls:{"b-readonly":o.readOnly,"b-rtl":h,"b-cal-timerange":1,"b-cal-timerange-line":u,"b-cal-timerange-narrow":c&&d<=s.narrowThreshold*60,[`b-cal-timerange-align-${f}`]:f,[`b-cal-timerange-rotate-${p}`]:c&&p}};c&&e.height.adjust(0,-1);const b=e.getStyles(h);return E.normalizeChildren(n.renderPart(a,l,v,{dataset:{"timerange-id":o.id,btip:u&&g.header||null},className:{[o.cls]:o.cls},elementData:{timeRange:o},style:{top:b.top,height:b.height},children:c&&{header:n.renderPart(a,l,v,"header",t,f,{cls:{[o.iconCls]:o.iconCls}}),body:n.renderPart(a,l,v,"body"),footer:n.renderPart(a,l,v,"footer",r,f)}}))}};y(xg,"$name","DayZone"),y(xg,"configurable",{viewListeners:{beforeLayoutEvents:"onBeforeLayoutEvents"}});var $s=class extends qe.mixin(Zt){attachToProject(i){var e,t;super.attachToProject(i),this.detachListeners("project"),(e=i.timeRangeStore)==null||e.ion({name:"project",change:"refresh",thisObj:this}),(t=i.resourceTimeRangeStore)==null||t.ion({name:"project",change:"refresh",thisObj:this})}changeRenderer(i){return typeof i=="function"&&(i={header:i}),i}updateHeaderWidth(i){var e,t;const r=(e=this.owner)==null?void 0:e.element;r&&r.style.setProperty("--timerange-header-width",(t=bt.from(i))==null?void 0:t.toString())}refresh(){this.client.refresh()}};y($s,"$name","TimeRanges"),y($s,"type","timeRanges"),y($s,"configurable",{defaultRenderer:{outer({renderData:i}){var e;const t=Eg(i),{color:r}=i;return r&&(E.isNamedColor(r)?t.className[`b-cal-color-${r}`]=1:(t.style||(t.style={}))["--timerange-color"]=r),t.className["b-cal-timerange-has-header"]=(e=i.header)==null?void 0:e.domConfig,t},body:({renderData:i})=>Eg(i),header:({renderData:i,value:e})=>e?{...Eg(i),children:[{className:{"b-cal-timerange-header-text":1},text:e}]}:null,footer:({renderData:i,value:e})=>e?{...Eg(i),children:[{className:{"b-cal-timerange-footer-text":1},text:e}]}:null},headerWidth:40,narrowThreshold:60,renderer:null,zoneTypes:{day:xg,resource:xg}}),qe.register($s.type,$s),$s._$name="TimeRanges";var Xc=class extends qe{static get pluginConfig(){return{chain:["render"]}}render(){const{client:i}=this,e=this.monthView=i.isMonthView?i:i.modes.month;if(e){const{weekRenderer:t}=this;e.showWeekColumn=!0,e.weekRenderer=e.weekRenderer?be.createSequence(e.weekRenderer,t):t,e.ion({weeknumberclick:"onWeekNumberClick",thisObj:this,prio:1e4})}}weekRenderer(i,[e,t]){i.querySelector(".b-week-toggle-tool-wrap")||E.createElement({parent:i,className:"b-week-toggle-tool-wrap",children:[{className:"b-icon b-week-toggle-tool",dataset:{btip:this.L("L{WeekExpander.expandTip}")}}]})}onWeekNumberClick({domEvent:i,date:e}){const t=i.target.closest(".b-week-toggle-tool");if(t&&!this.disabled){const r=i.target.closest(".b-calendar-row");return r.classList.contains("b-shrinkwrapped")?(this.monthView.flexWeekRow(e,!0),t.dataset.btip=this.L("L{expandTip}")):r.classList.contains("b-has-overflow")&&(this.monthView.shrinkwrapWeekRow(e),t.dataset.btip=this.L("L{collapseTip}")),!1}}updateDisabled(i,e){super.updateDisabled(i,e),this.client.element.classList.toggle("b-weekexpander",!i)}};y(Xc,"$name","WeekExpander"),y(Xc,"type","weekExpander"),Xc.initClass(),Xc._$name="WeekExpander";var Zc=class kv extends Cs.mixin(gr){checkAutoCreateGesture(e){this.agenda.eventContentElement.contains(e.target)&&super.checkAutoCreateGesture(...arguments)}get description(){const{date:e}=this.agenda,t=C.clearTime(new Date);return t-e?C.diff(e,C.add(t,1,"d"))?super.description:this.L("L{Calendar.Tomorrow}"):this.L("L{Calendar.Today}")}agendaHeaderRenderer(e){}changeShiftIncrement(e){return we.from(e)}get stepUnit(){const{shiftIncrement:e}=this;return e?e.magnitude===1?C.getLocalizedNameOfUnit(e.unit):`${e.magnitude} ${C.getLocalizedNameOfUnit(e.unit,!0)}`:this.agenda.stepUnit}getEventElement(){return this.agenda.getEventElement(...arguments)}next(){const{date:e,animateTimeShift:t}=this,r=C.add(e,we.from(this.shiftIncrement));this.animateTimeShift=r.getMonth()!==e.getMonth(),this.date=r,this.animateTimeShift=t}previous(){const{date:e,animateTimeShift:t}=this,r=C.add(e,we.from(this.shiftIncrement).negate());this.animateTimeShift=r.getMonth()!==e.getMonth(),this.date=r,this.animateTimeShift=t}changeAgenda(e,t){if(t&&this.remove(t),e){const r=this,{date:n}=r;e=kv.reconfigure(t,kv.mergeConfigs({date:n,flex:1,project:r.project,title:r.callback(r.agendaHeaderRenderer,r,[n]),ref:"agenda",cls:{"b-monthagenda-agenda":1},range:"day",settingsButton:null,alwaysShowCurrentDate:!0,consumeGridPointerEvents:!1,defaultScrollOptions:{block:"start"},internalListeners:{topDateChange:"onAgendaTopDateChange",rangeChange:"onAgendaRangeChange",thisObj:r}},e),r),r.add(e),r.eventSorter=e.eventSorter;const{classList:s}=e.element;s.remove("b-slide-vertical"),s.add("b-slide-horizontal")}else t==null||t.destroy();return e}onAgendaTopDateChange({source:e,date:t}){e.scrollable.scrollAnimation||(e.preventScroll=!0,this.date=t,e.preventScroll=!1)}onAgendaRangeChange({source:e}){if(e.isAgendaView&&e.store.count>1){const t=new Date(Math.min(Math.max(this.date,e.store.first.date),e.store.last.date));e.scrollTo(t,{animate:!1,block:"start"})}}createCellData(){return this.agenda.createCellData(...arguments)}updateDate(e,t){const{agenda:r}=this;this.selection=e,super.updateDate(e),r&&(r.date=e,r.title=this.callback(this.agendaHeaderRenderer,this,[e]),r.duration===1&&E.slideIn(r.element,e-t))}getDateFromDomEvent(e){return super.getDateFromDomEvent(e)||this.agenda.getDateFromDomEvent(e)}};y(Zc,"$name","MonthAgendaView"),y(Zc,"type","monthagenda"),y(Zc,"delayable",{refresh:"raf"}),y(Zc,"configurable",{title:"L{MonthView.Month}",showEvents:"dots",tbar:null,animateTimeShift:!1,eventHeight:"auto",trapFocus:!1,focusable:!0,shiftIncrement:{unit:"day",magnitude:1},agendaDateFormat:"dddd DD MMMM YYYY",agendHeaderRenderer:null,agenda:{type:"agendaview"}});var vv=Zc;vv.initClass(),vv._$name="MonthAgendaView";export{$D as AbstractAssignmentStoreMixin,a0 as AbstractCalendarManagerStoreMixin,s0 as AbstractCalendarMixin,wp as AbstractCrudManager,yp as AbstractCrudManagerMixin,WD as AbstractCrudManagerValidation,Im as AbstractDateRange,BD as AbstractDependencyStoreMixin,ID as AbstractEventStoreMixin,_D as AbstractHasAssignmentsMixin,Lh as AbstractPartOfProjectGenericMixin,Xd as AbstractPartOfProjectModelMixin,ci as AbstractPartOfProjectStoreMixin,lr as AbstractRecurrenceIterator,pD as AbstractResourceStoreMixin,nn as AbstractTimeRanges,Gi as ActionBase,Br as ActionColumn,Mu as AddAction,Bc as AgendaColumn,Es as AgendaView,Pa as AggregateColumn,kt as AjaxHelper,Dt as AjaxStore,Zo as AjaxStoreLazyLoadPlugin,bp as AjaxTransport,yt as Animator,Zs as ArrayDataField,B as ArrayHelper,gl as AssignmentModel,LD as AssignmentModelMixin,rc as AssignmentStore,PD as AssignmentStoreMixin,Qe as AsyncHelper,Zt as AttachToProjectMixin,La as AvatarRendering,sm as Badge,ia as Bag,rs as Bar,$ as Base,fd as BooleanCombo,Cn as BooleanDataField,Fr as Box,Y as BrowserHelper,Lt as Button,Pn as ButtonGroup,Jr as CI,mp as CIFromSetOrArrayOrValue,xn as CSSHelper,Ls as Calendar,Lp as CalendarCache,t0 as CalendarCacheInterval,G0 as CalendarCacheIntervalMultiple,Y0 as CalendarCacheMultiple,r0 as CalendarCacheSingle,Cs as CalendarDatePicker,qc as CalendarDrag,qe as CalendarFeature,Ap as CalendarIntervalMixin,e0 as CalendarIntervalStore,us as CalendarIntervalType,Xt as CalendarIteratorResult,gr as CalendarMixin,ki as CalendarPanel,Vi as CalendarRow,av as CalendarStores,_a as Card,Ji as Carousel,Td as CellCopyPaste,Ch as CellEdit,Ba as CellMenu,Md as CellTooltip,Yn as CheckColumn,Qi as Checkbox,fa as CheckboxGroup,ja as ChecklistFilterCombo,Zi as ChipView,bI as ChronoMixinBase,Nu as ClickRepeater,Bw as Clipboardable,ur as ClockTemplate,er as CodeEditor,td as CollapseTool,Bt as Collection,Je as CollectionFilter,jo as CollectionSorter,zr as ColorColumn,Vn as ColorField,Hn as ColorPicker,He as Column,za as ColumnAutoWidth,_d as ColumnDragToolbar,mc as ColumnLines,kd as ColumnPicker,Fd as ColumnRename,Wa as ColumnReorder,Id as ColumnResize,Ve as ColumnStore,Ze as Combo,Pu as ComboModel,Re as Config,Nn as ConfirmationBar,Ip as ConstraintIntervalSide,Ep as ConstraintType,gt as Container,Ir as ContextMenuBase,Ha as CopyPasteBase,Gh as CoreAssignmentMixin,pp as CoreAssignmentStoreMixin,l0 as CoreCalendarManagerStoreMixin,$p as CoreCalendarMixin,Yh as CoreDependencyMixin,vp as CoreDependencyStoreMixin,or as CoreEventMixin,fp as CoreEventStoreMixin,kD as CoreHasAssignmentsMixin,FD as CoreHasDependenciesMixin,Ph as CorePartOfProjectGenericMixin,ol as CorePartOfProjectModelMixin,ul as CorePartOfProjectStoreMixin,dl as CoreResourceMixin,dp as CoreResourceStoreMixin,no as CrudManager,Wp as CrudManagerView,Vh as DailyRecurrenceIterator,dt as DataField,Lw as DataGenerator,Wr as DateColumn,Js as DateDataField,Ii as DateField,C as DateHelper,Fi as DatePicker,zn as DateRangeField,Cg as DateRangeOwner,va as DateRangePicker,$i as DateStoreLazyLoadPlugin,Wn as DateTimeField,xs as DayAgendaView,an as DayButtons,lo as DayCellCollecter,bg as DayCellRenderer,oo as DayLayout,go as DayResourceCalendarRow,Ts as DayResourceView,lv as DaySelectable,Ss as DaySelector,Me as DayTime,ui as DayView,fe as Delayable,o0 as DelayableWrapper,W0 as DelayedRecordsRendering,Pw as DemoBot,gh as DemoCodeEditor,yS as DemoHeader,_l as Dependencies,Mp as DependenciesCalendar,Kt as DependencyBaseModel,P0 as DependencyCreation,tv as DependencyEdit,Fl as DependencyMenu,mt as DependencyModel,qh as DependencyStore,ND as DependencyStoreMixin,$0 as DependencyTooltip,Tp as DependencyType,Rp as DependencyValidationResult,Hp as Describable,Fp as Direction,ma as DisplayField,te as DomClassList,Oe as DomDataStore,E as DomHelper,oe as DomSync,Yp as DragBase,ca as DragContext,tg as DragCreateBase,si as DragHelper,sd as DragProxy,nh as DragTipProxy,ad as Draggable,Ju as Droppable,we as Duration,Zr as DurationColumn,ba as DurationField,Vo as DurationUnitDataField,kr as DynamicObject,hs as EdgeInclusion,Xp as EditBase,Gt as Editor,Uu as ElementResizeHelper,Ti as ElementVisitor,Os as EventBuffer,El as EventColorColumn,Dl as EventColorField,Sl as EventColorPicker,ro as EventColumn,_s as EventCopyPaste,$h as EventDayIndex,pc as EventDrag,Al as EventDragCreate,ng as EventDragSelect,ks as EventEdit,fo as EventEditor,Nl as EventFilter,V as EventHelper,fr as EventList,Fs as EventMenu,hl as EventModel,MD as EventModelMixin,sE as EventNavigation,sg as EventNonWorkingTime,sv as EventRenderer,Tl as EventResize,aE as EventSelection,yg as EventSlots,jc as EventSorter,ec as EventStore,vD as EventStoreMixin,Ps as EventTip,mo as EventTooltip,Fe as Events,po as ExcelExporter,es as ExportDialog,Bd as ExportOrientationCombo,Nd as ExportRowsCombo,tl as Exporter,zd as ExporterBase,pv as ExternalEventSource,ii as Factoryable,mm as Featureable,In as Fencible,rt as Field,ud as FieldContainer,Ai as FieldFilterPicker,fh as FieldFilterPickerGroup,On as FieldSet,_h as FileDrop,bd as FileField,Rh as FileFormat,Da as FilePicker,Ad as FillHandle,Dh as Filter,Ld as FilterBar,Cd as FilterField,zw as Finalizable,ua as Fit,Uc as FluidDayLayout,nl as Footer,zo as Formatter,eS as FormulaField,Ho as FormulaProvider,Et as Fullscreen,be as FunctionHelper,yD as GetEventsMixin,le as GlobalEvents,as as Grid,Xr as GridBase,Na as GridEditBase,zS as GridElementEvents,il as GridExcelExporter,K as GridFeatureManager,WS as GridFeatures,zm as GridFieldFilterPicker,Xn as GridFieldFilterPickerGroup,Ua as GridGroupSummary,Se as GridLocation,Ga as GridLockRows,qr as GridMultiPageExporter,Kr as GridMultiPageVerticalExporter,is as GridPdfExport,Th as GridPrint,jS as GridResponsive,Kn as GridRowModel,Jn as GridRowReorder,Xa as GridRowResize,US as GridSelection,ts as GridSinglePageExporter,Gr as GridSplit,GS as GridState,qS as GridSubGrids,Qa as GridSummary,Pd as Group,sl as GroupBar,xc as GroupSummary,ss as Header,Ya as HeaderMenu,ag as HeaderZoom,_e as Helpers,Mi as Hint,vm as HintFlow,Gn as Histogram,oc as HorizontalLayoutPack,Kh as HorizontalLayoutStack,Zh as HorizontalRendering,yl as HorizontalTimeAxis,Uw as Hoverable,Si as IdHelper,Oo as Identifiable,gs as IndexPosition,Ri as InfinityAxis,Nw as InfinityScrollable,Xu as InfinityScroller,_u as InsertAction,Ru as InsertChildAction,ie as InstancePlugin,Sn as IntegerDataField,Op as IntervalCache,Pp as IntervalSorterFn,Cp as JsonEncoder,UC as KeyMap,Sa as Label,wm as Labelable,Bl as Labels,Di as Layout,bt as LayoutDim,qD as LazyLoadCrudManager,x0 as LazyLoadView,jt as List,pm as LoadMaskable,vo as LoadOnDemand,lt as LocaleHelper,Le as LocaleManager,Nt as Localizable,Yl as LockRows,cr as MAX_DATE,gD as MI,en as MIN_DATE,Mn as Mask,li as Menu,ai as MenuItem,$d as MergeCells,Ea as MessageDialog,ES as Minifiable,Ms as ModeSelector,me as Model,Qs as ModelDataField,wb as ModelLink,yb as ModelStm,_i as Month,vv as MonthAgendaView,Pr as MonthPicker,Rs as MonthView,Jd as MonthlyRecurrenceIterator,$r as MultiDatePicker,Zl as MultiPageExporter,ln as MultiPageVerticalExporter,Ki as Navigator,Rc as NonWorkingTime,iv as NonWorkingTimeMixin,Yt as NumberColumn,Rr as NumberDataField,wa as NumberField,wi as NumberFormat,ea as ObjectDataField,T as ObjectHelper,Z as Objects,Yr as Orientation,ws as OverflowPopup,Gw as Override,Xh as PackMixin,xa as PagingToolbar,Tc as Pan,Xe as Panel,Yi as PanelCollapser,ya as PanelCollapserOverlay,Pi as PaperFormat,Z_ as Parser,SI as PartOfBaseProject,ar as PartOfProject,Ra as PasswordField,Oc as PdfExport,qn as PercentColumn,Ln as PickerField,pf as Pluggable,ti as Point,ft as Popup,ll as PresetManager,Gd as PresetStore,Kc as Print,Gm as PrintMixin,Vc as ProjectCombo,Dp as ProjectConstraintResolution,Np as ProjectConsumer,GD as ProjectCrudManager,hr as ProjectModel,KD as ProjectModelCommon,ZD as ProjectModelMixin,XD as ProjectModelTimeZoneMixin,kp as ProjectType,Xo as Promissory,Hd as QuickFind,GC as RTL,ga as Radio,$n as RadioGroup,da as RandomGenerator,Ds as RangeMenu,jr as RatingColumn,L as Rectangle,Jp as RectangularPathFinder,vc as RecurrenceCombo,os as RecurrenceConfirmationPopup,nt as RecurrenceDayRuleEncoder,Cc as RecurrenceDaysButtonGroup,bc as RecurrenceDaysCombo,Sc as RecurrenceEditor,$l as RecurrenceEditorPanel,vs as RecurrenceFrequencyCombo,fc as RecurrenceLegend,yc as RecurrenceLegendButton,Qd as RecurrenceModel,Ll as RecurrenceMonthDaysButtonGroup,Pl as RecurrenceMonthsButtonGroup,wc as RecurrencePositionsCombo,Ol as RecurrenceStopConditionCombo,V0 as RecurringEventEdit,np as RecurringEvents,ED as RecurringEventsMixin,Wh as RecurringTimeSpan,Hh as RecurringTimeSpansMixin,qa as RegionResize,ku as RemoveAction,Fu as RemoveAllAction,Tu as RemoveChildAction,Rw as Resizable,Fn as ResizeHelper,Ge as ResizeMonitor,xl as ResourceCollapseColumn,Dc as ResourceCombo,Nc as ResourceFilter,bl as ResourceHeader,hc as ResourceInfoColumn,zl as ResourceMenu,cl as ResourceModel,cD as ResourceModelMixin,Zd as ResourceStore,dD as ResourceStoreMixin,gc as ResourceTickModel,Rl as ResourceTickStore,dr as ResourceTimeRangeModel,fl as ResourceTimeRangeStore,Wl as ResourceTimeRanges,Ml as ResourceTimeRangesBase,un as ResourceView,Aa as Responsive,Yo as RevisionException,Qo as Ripple,Bu as Rotatable,rl as Row,Li as RowCopyPaste,Vd as RowEdit,Ka as RowExpander,Wd as RowManager,xd as RowNumberColumn,Mc as RowReorder,lg as RowResize,rr as RowsRange,Ia as Scale,rn as ScaleColumn,Il as ScheduleContext,As as ScheduleMenu,Hi as ScheduleRange,Ac as ScheduleRangeCombo,fg as ScheduleTableExporter,Is as ScheduleTooltip,$c as Scheduler,wl as SchedulerBase,jh as SchedulerCoreEvent,d0 as SchedulerCoreProjectMixin,lc as SchedulerCrudManager,to as SchedulerDatePicker,g0 as SchedulerDom,f0 as SchedulerDomEvents,ms as SchedulerEventCopyPaste,Vl as SchedulerEventEdit,ps as SchedulerEventEditor,ys as SchedulerEventMenu,zp as SchedulerEventNavigation,v0 as SchedulerEventRendering,Bp as SchedulerEventSelection,Ec as SchedulerEventTooltip,eo as SchedulerExcelExporter,Lc as SchedulerExportDialog,gg as SchedulerPrint,tn as SchedulerProjectModel,w0 as SchedulerRegions,p0 as SchedulerResourceRendering,jl as SchedulerScheduleMenu,Ul as SchedulerScheduleTooltip,C0 as SchedulerScroll,S0 as SchedulerState,b0 as SchedulerStores,ml as SchedulerTimeRangeModel,pl as SchedulerTimeRangeStore,ql as SchedulerTimeRanges,xp as SchedulingMode,_c as ScrollButtons,dd as ScrollManager,At as Scroller,Za as Search,vg as Sidebar,og as SimpleEventEdit,Jl as SinglePageExporter,Sd as SlideToggle,wd as Slider,Ja as Sort,i0 as SortedMap,bs as Split,tr as Splitter,_p as StartedTaskScheduling,Po as State,Tr as StateBase,Lo as StateProvider,Xs as StateStorage,Ko as StateTrackingManager,Eh as StickyCells,Gl as StickyEvents,pe as Store,Ab as StoreCRUD,Yb as StoreChained,Lb as StoreChanges,No as StoreDataField,Pb as StoreFilter,$b as StoreGroup,ra as StoreLazyLoadPlugin,Vb as StorePaging,Nb as StoreProxy,Bb as StoreRelation,Ub as StoreSearch,Gb as StoreSort,qb as StoreState,IC as StoreStm,zb as StoreSum,Xb as StoreSync,nc as StoreTimeZonePlugin,Kb as StoreTree,wn as StringDataField,O as StringHelper,xh as Stripe,tF as Styleable,qt as SubGrid,cg as Summary,Ta as Tab,Ma as TabBar,Un as TabPanel,Mh as TableExporter,eg as TaskEditStm,A0 as TaskEditTransactional,Oa as TemplateColumn,Pt as TemplateHelper,ka as TextAreaField,Bm as TextAreaPickerField,oi as TextField,Xl as TickCells,tp as TimeAxis,Cl as TimeAxisColumn,kc as TimeAxisHeaderMenu,qd as TimeAxisSubGrid,ip as TimeAxisViewModel,Ur as TimeColumn,Ot as TimeField,Bn as TimePicker,dn as TimeRangeModel,zc as TimeRangeStore,$s as TimeRanges,ug as TimeSelection,xt as TimeSpan,ig as TimeSpanMenuBase,cs as TimeUnit,$e as TimeZoneHelper,ZS as TimeZonedDatesMixin,sr as TimelineBase,eD as TimelineDateMapper,tD as TimelineDomEvents,rD as TimelineEventRendering,Hc as TimelineHistogram,on as TimelineHistogramBase,j0 as TimelineHistogramGrouping,U0 as TimelineHistogramScaleColumn,aD as TimelineScroll,lD as TimelineState,dg as TimelineSummary,iD as TimelineViewPresets,rp as TimelineZoomable,xi as Toast,_n as Tool,nm as Toolable,kn as Toolbar,ve as Tooltip,Zp as TooltipBase,It as Transaction,Qh as TransactionalFeature,E0 as TransactionalFeatureMixin,vl as TreatInconsistentIntervals,Qn as Tree,$a as TreeColumn,al as TreeCombo,Ud as TreeGrid,el as TreeGroup,bb as TreeNode,Fc as TreeSummary,nv as UndoRedo,Fa as UndoRedoBase,n0 as UnspecifiedTimeIntervalModel,xu as UpdateAction,Sh as VALUE_COUNT,la as VBox,cd as Validatable,re as VersionHelper,Up as VerticalRendering,uc as VerticalTimeAxisColumn,ls as ViewPreset,io as ViewPresetCombo,Ui as WalkHelper,Du as Wbs,Xc as WeekExpander,co as WeekView,Nh as WeeklyRecurrenceIterator,z as Widget,ir as WidgetColumn,Iw as WidgetHelper,qm as WriteExcelFileProvider,Aw as XMLHelper,Ym as XlsProviderBase,Or as YearPicker,uo as YearView,Bh as YearlyRecurrenceIterator,ac as binarySearch,lL as combineCalendars,OD as delay,jI as format,tA as isDateFinite,QI as isEqualEffectiveDirection,WI as isNotNumber,Sp as later,sc as stripDuplicates};
//# sourceMappingURL=calendar.module.min.js.map
