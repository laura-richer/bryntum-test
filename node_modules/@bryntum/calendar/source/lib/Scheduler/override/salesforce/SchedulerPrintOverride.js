import Override from '../../../Core/mixin/Override.js';
import Print from '../../feature/export/Print.js';

Override.apply(class SchedulerPrintOverride {
    static target = {
        class : Print
    };

    addStylesToDocument(doc, fragment, html) {
        html.matchAll(/<link .+?>/g).forEach(([linkStr]) => {
            const href = linkStr.match(/ href="(.+?)"/)?.[1];

            // We only need to load css from static resources (our resource, to be exact). LWC app styles contain a lot
            // of unnecessary styles and have a greedy `!important` override to disable the backgrounds for print media.
            if (/resource/.test(href)) {
                const linkEl = doc.createElement('link');
                linkEl.rel = 'stylesheet';
                linkEl.href = href;

                doc.head.appendChild(linkEl);
            }
        });

        fragment.head.querySelectorAll('style,link[rel="stylesheet"],link[as="style"]').forEach(styleEl => {
            // Styles are scoped to the LWC using the attribute. We need to remove that attribute selector because we
            // do not generate attribute when printing.
            if (styleEl.tagName === 'STYLE') {
                const el = doc.createElement('style');
                el.textContent = styleEl.textContent.replace(/\[c-.+?]/g, '');
                doc.head.appendChild(el);
            }
            else {
                const el = doc.adoptNode(styleEl);
                doc.head.appendChild(el);
            }
        });
    }
});
