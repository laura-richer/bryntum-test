/*!
 *
 * Bryntum Calendar 6.2.2
 *
 * Copyright(c) 2025 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 * Bryntum incorporates third-party code licensed under the MIT and Apache-2.0 licenses.
 * See the licenses below or visit https://bryntum.com/products/calendar/docs/guide/Calendar/licenses
 *
 * # Third Party Notices
 * 
 * Bryntum uses the following third party libraries:
 * 
 * * [Font Awesome 6 Free](https://fontawesome.com/license/free) (MIT/SIL OFL 1.1)
 * * [Roboto font](https://github.com/google/roboto) (Apache-2.0)
 * * [Styling Cross-Browser Compatible Range Inputs with Sass](https://github.com/darlanrod/input-range-sass) (MIT)
 * * [Tree Walker polyfill (only applies to Salesforce)](https://github.com/Krinkle/dom-TreeWalker-polyfill) (MIT)
 * * [chronograph](https://github.com/bryntum/chronograph) (MIT)
 * * [later.js](https://github.com/bunkat/later) (MIT)
 * * [Monaco editor (only used in our demos)](https://microsoft.github.io/monaco-editor) (MIT)
 * * Map/Set polyfill to fix performance issues for Salesforce LWS (MIT)
 * 
 * Note: the **chronograph** and **later.js** libraries are used in Bryntum Scheduler Pro and Bryntum Gantt, but they are
 * listed for all Bryntum products since the distribution contains trial versions of the thin bundles for all other
 * products. TreeWalker is only used in the LWC bundle for Salesforce. Roboto font is only used in the material theme.
 * 
 * ## Font Awesome 6 Free
 * 
 * [Font Awesome Free 6 by @fontawesome](https://fontawesome.com/)
 * 
 * Font Awesome Free is free, open source, and GPL friendly. You can use it for commercial projects, open source projects,
 * or really almost whatever you want.
 * 
 * [Full Font Awesome Free license](https://fontawesome.com/license/free)
 * 
 * ## Roboto font
 * 
 * [Apache License Version 2.0, January 2004](https://www.apache.org/licenses/LICENSE-2.0)
 * 
 * TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
 * 
 * 1. Definitions.
 * 
 * "License" shall mean the terms and conditions for use, reproduction, and distribution as defined by Sections 1 through 9
 * of this document.
 * 
 * "Licensor" shall mean the copyright owner or entity authorized by the copyright owner that is granting the License.
 * 
 * "Legal Entity" shall mean the union of the acting entity and all other entities that control, are controlled by, or are
 * under common control with that entity. For the purposes of this definition,
 * "control" means (i) the power, direct or indirect, to cause the direction or management of such entity, whether by
 * contract or otherwise, or (ii) ownership of fifty percent (50%) or more of the outstanding shares, or (iii) beneficial
 * ownership of such entity.
 * 
 * "You" (or "Your") shall mean an individual or Legal Entity exercising permissions granted by this License.
 * 
 * "Source" form shall mean the preferred form for making modifications, including but not limited to software source code,
 * documentation source, and configuration files.
 * 
 * "Object" form shall mean any form resulting from mechanical transformation or translation of a Source form, including
 * but not limited to compiled object code, generated documentation, and conversions to other media types.
 * 
 * "Work" shall mean the work of authorship, whether in Source or Object form, made available under the License, as
 * indicated by a copyright notice that is included in or attached to the work
 * (an example is provided in the Appendix below).
 * 
 * "Derivative Works" shall mean any work, whether in Source or Object form, that is based on (or derived from) the Work
 * and for which the editorial revisions, annotations, elaborations, or other modifications represent, as a whole, an
 * original work of authorship. For the purposes of this License, Derivative Works shall not include works that remain
 * separable from, or merely link (or bind by name) to the interfaces of, the Work and Derivative Works thereof.
 * 
 * "Contribution" shall mean any work of authorship, including the original version of the Work and any modifications or
 * additions to that Work or Derivative Works thereof, that is intentionally submitted to Licensor for inclusion in the
 * Work by the copyright owner or by an individual or Legal Entity authorized to submit on behalf of the copyright owner.
 * For the purposes of this definition, "submitted"
 * means any form of electronic, verbal, or written communication sent to the Licensor or its representatives, including
 * but not limited to communication on electronic mailing lists, source code control systems, and issue tracking systems
 * that are managed by, or on behalf of, the Licensor for the purpose of discussing and improving the Work, but excluding
 * communication that is conspicuously marked or otherwise designated in writing by the copyright owner as "Not a
 * Contribution."
 * 
 * "Contributor" shall mean Licensor and any individual or Legal Entity on behalf of whom a Contribution has been received
 * by Licensor and subsequently incorporated within the Work.
 * 
 * 2. Grant of Copyright License. Subject to the terms and conditions of this License, each Contributor hereby grants to
 *    You a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce,
 *    prepare Derivative Works of, publicly display, publicly perform, sublicense, and distribute the Work and such
 *    Derivative Works in Source or Object form.
 * 
 * 3. Grant of Patent License. Subject to the terms and conditions of this License, each Contributor hereby grants to You a
 *    perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 *    (except as stated in this section) patent license to make, have made, use, offer to sell, sell, import, and otherwise
 *    transfer the Work, where such license applies only to those patent claims licensable by such Contributor that are
 *    necessarily infringed by their Contribution(s) alone or by combination of their Contribution(s)
 *    with the Work to which such Contribution(s) was submitted. If You institute patent litigation against any entity (
 *    including a cross-claim or counterclaim in a lawsuit) alleging that the Work or a Contribution incorporated within
 *    the Work constitutes direct or contributory patent infringement, then any patent licenses granted to You under this
 *    License for that Work shall terminate as of the date such litigation is filed.
 * 
 * 4. Redistribution. You may reproduce and distribute copies of the Work or Derivative Works thereof in any medium, with
 *    or without modifications, and in Source or Object form, provided that You meet the following conditions:
 * 
 * (a) You must give any other recipients of the Work or Derivative Works a copy of this License; and
 * 
 * (b) You must cause any modified files to carry prominent notices stating that You changed the files; and
 * 
 * (c) You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark,
 * and attribution notices from the Source form of the Work, excluding those notices that do not pertain to any part of the
 * Derivative Works; and
 * 
 * (d) If the Work includes a "NOTICE" text file as part of its distribution, then any Derivative Works that You distribute
 * must include a readable copy of the attribution notices contained within such NOTICE file, excluding those notices that
 * do not pertain to any part of the Derivative Works, in at least one of the following places: within a NOTICE text file
 * distributed as part of the Derivative Works; within the Source form or documentation, if provided along with the
 * Derivative Works; or, within a display generated by the Derivative Works, if and wherever such third-party notices
 * normally appear. The contents of the NOTICE file are for informational purposes only and do not modify the License. You
 * may add Your own attribution notices within Derivative Works that You distribute, alongside or as an addendum to the
 * NOTICE text from the Work, provided that such additional attribution notices cannot be construed as modifying the
 * License.
 * 
 * You may add Your own copyright statement to Your modifications and may provide additional or different license terms and
 * conditions for use, reproduction, or distribution of Your modifications, or for any such Derivative Works as a whole,
 * provided Your use, reproduction, and distribution of the Work otherwise complies with the conditions stated in this
 * License.
 * 
 * 5. Submission of Contributions. Unless You explicitly state otherwise, any Contribution intentionally submitted for
 *    inclusion in the Work by You to the Licensor shall be under the terms and conditions of this License, without any
 *    additional terms or conditions. Notwithstanding the above, nothing herein shall supersede or modify the terms of any
 *    separate license agreement you may have executed with Licensor regarding such Contributions.
 * 
 * 6. Trademarks. This License does not grant permission to use the trade names, trademarks, service marks, or product
 *    names of the Licensor, except as required for reasonable and customary use in describing the origin of the Work and
 *    reproducing the content of the NOTICE file.
 * 
 * 7. Disclaimer of Warranty. Unless required by applicable law or agreed to in writing, Licensor provides the Work (and
 *    each Contributor provides its Contributions) on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 *    either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT,
 *    MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. You are solely responsible for determining the appropriateness
 *    of using or redistributing the Work and assume any risks associated with Your exercise of permissions under this
 *    License.
 * 
 * 8. Limitation of Liability. In no event and under no legal theory, whether in tort (including negligence), contract, or
 *    otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing,
 *    shall any Contributor be liable to You for damages, including any direct, indirect, special, incidental, or
 *    consequential damages of any character arising as a result of this License or out of the use or inability to use the
 *    Work (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or
 *    any and all other commercial damages or losses), even if such Contributor has been advised of the possibility of such
 *    damages.
 * 
 * 9. Accepting Warranty or Additional Liability. While redistributing the Work or Derivative Works thereof, You may choose
 *    to offer, and charge a fee for, acceptance of support, warranty, indemnity, or other liability obligations and/or
 *    rights consistent with this License. However, in accepting such obligations, You may act only on Your own behalf and
 *    on Your sole responsibility, not on behalf of any other Contributor, and only if You agree to indemnify, defend, and
 *    hold each Contributor harmless for any liability incurred by, or claims asserted against, such Contributor by reason
 *    of your accepting any such warranty or additional liability.
 * 
 * END OF TERMS AND CONDITIONS
 * 
 * APPENDIX: How to apply the Apache License to your work.
 * 
 * To apply the Apache License to your work, attach the following boilerplate notice, with the fields enclosed by
 * brackets "[]"
 * replaced with your own identifying information. (Don't include the brackets!)  The text should be enclosed in the
 * appropriate comment syntax for the file format. We also recommend that a file or class name and description of purpose
 * be included on the same "printed page" as the copyright notice for easier identification within third-party archives.
 * 
 * Copyright [yyyy] [name of copyright owner]
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the
 * License. You may obtain a copy of the License at
 * 
 * [APACHE LICENSE, VERSION 2.0](http://www.apache.org/licenses/LICENSE-2.0)
 * 
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "
 * AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 * 
 * ## Styling Cross-Browser Compatible Range Inputs with Sass
 * 
 * Github: [input-range-sass](https://github.com/darlanrod/input-range-sass)
 * 
 * Author: [Darlan Rod](https://github.com/darlanrod)
 * 
 * Version 1.4.1
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2016 Darlan Rod
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Tree Walker polyfill
 * 
 * The MIT License (MIT)
 * 
 * [Copyright 2013–2017 Timo Tijhof](https://github.com/Krinkle/dom-TreeWalker-polyfill)
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## chronograph
 * 
 * GitHub: [chronograph](https://github.com/bryntum/chronograph)
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2023 Bryntum
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## later.js
 * 
 * GitHub: [later.js](https://github.com/bunkat/later)
 * 
 * The MIT License (MIT)
 * 
 * Copyright © 2013 BunKat
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Monaco editor
 * 
 * GitHub: [Monaco editor](https://microsoft.github.io/monaco-editor) (MIT)
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) 2016 - present Microsoft Corporation
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
 * documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit
 * persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the
 * Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
 * WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * ## Map/Set polyfill to fix performance issues for Salesforce LWS
 * 
 * Copyright © 2024 Certinia Inc.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).bryntum=e.bryntum||{},e.bryntum.calendar={}))}(this,(function(e){"use strict";const t="calendar",n=Object.create(null),r=["Array","Browser",["Css","CSSHelper"],"Date","Dom","Event","Function","Object","String","TimeZone","Version"].map((e=>Array.isArray(e)?e:[e,`${e}Helper`])),i=e=>Object.assign(Object.create(null),Object.fromEntries(e)),s=i(r),o=i(r.map((([e,t])=>[t,e]))),a=e=>(t,n)=>{throw new Error(`Cannot ${e} "Helpers.${n}": object is readonly`)},l=new Proxy(n,{defineProperty:a("define property"),deleteProperty:a("delete"),set:a("assign"),get(e,t){const r=n[t];if(!r)throw new Error(`Property not defined "Helpers.${t}": ${t in s?`import ${s[t]} before using it`:"invalid helper name"}`);return r}});var d;Object.defineProperty(n,"register",{value(e){const t=e.$name,r=o[t];n[r]=e}}),r.forEach((e=>n[e[0]]=null));class c{static $name="BrowserHelper";static supportsPointerEvents=Boolean(globalThis.PointerEvent||globalThis.MSPointerEvent);static supportsPointerEventConstructor="undefined"!=typeof PointerEvent;static PointerEventConstructor=globalThis.PointerEvent||globalThis.CustomEvent;static isPhone=null===(d=globalThis.matchMedia)||void 0===d?void 0:d.call(globalThis,"(max-height:414px) or (max-width:414px)").matches;static cacheFlags(e=navigator.platform,t=navigator.userAgent){const n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isMobile=Boolean(t.match(/Mobile|Opera Mini|Opera Mobi|Puffin/)||"number"==typeof globalThis.orientation),n._isWebkit=Boolean(t.match(/WebKit/)&&!t.match(/Edg/)),n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),n._safariVersion=n.getVersion(t,/Version\/(.*).Safari/),n._isAndroid=Boolean(t.match(/Android/g))}static get supportsOverflowClip(){if(null==this._supportsOverflowClip){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip="clip"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow"),e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,t){const n=e.match(t);return n?parseFloat(n[1]):0}static get isTouchDevice(){return void 0===this._isTouchDevice&&(this._isTouchDevice=globalThis.matchMedia("(any-pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return void 0===this._isHoverableDevice&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return"undefined"!=typeof window}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get isMobile(){return this._isMobile}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsRandomUUID(){if(void 0===this._supportsRandomUUID)try{var e,t;this._supportsRandomUUID=Boolean((null===(e=(t=globalThis.crypto).randomUUID)||void 0===e?void 0:e.call(t).length)>0)}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static get ctrlKey(){return this.isMac?"metaKey":"ctrlKey"}static get metaKey(){return this.isMac?"ctrlKey":"metaKey"}static searchParam(e,t=null,n=document.location.search){const r=new RegExp(`[?&]${e}=?([^&]*)`),i=n.match(r);return i&&i[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return""}static download(e,t){const n=document.createElement("a");n.download=e,n.href=t||e,n.style.cssText="display:none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static downloadBlob(e,t){const n=globalThis.URL.createObjectURL(e);this.download(t,n),globalThis.URL.revokeObjectURL(n)}static get queryString(){var e;const t=new URL(globalThis.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}static copyToClipboard(e){let t=!0;const n=document.createElement("textarea");n.value=e,n.style.height=n.style.width=0,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){t=!1}return n.remove(),t}static isBryntumOnline(e){var t;return e=Array.isArray(e)?e:[e],Boolean(/^(www\.)?bryntum\.com$/.test(globalThis.location.host)||(null===(t=e)||void 0===t?void 0:t.some((e=>null!=this.queryString[e]))))}static get isCSP(){const{bryntum:e,document:t}=globalThis;return null==e.CSP&&(e.CSP=Boolean(t.querySelector('meta[http-equiv="Content-Security-Policy"]'))),e.CSP}}l.register(c),c.isBrowserEnv&&c.cacheFlags(),c._$name="BrowserHelper";const{hasOwnProperty:u,propertyIsEnumerable:h,toString:g}=Object.prototype,{isFrozen:m}=Object,p=/\s*<\s*/,f=/\s*>\s*/,v={},y={},b=Object.freeze({});class C{static assign(e,...t){for(let n,r,i=0;i<t.length;i++)if(n=t[i],n)for(r in n)"__proto__"!==r&&"constructor"!==r&&(e[r]=n[r]);return e}static assignIf(e,...t){for(let n,r,i=0;i<t.length;i++)if(n=t[i],n)for(r in n)"__proto__"!==r&&"constructor"!==r&&(r in e&&void 0!==e[r]||(e[r]=n[r]));return e}static blend(e,t,n){n=n||v,e=e||{};const{clone:r=C.clone,merge:i=C.blend}=n;if(Array.isArray(t)){if(t.length>1)return t.forEach((t=>{e=C.blend(e,t,n)})),e;t=t[0]}if(t){let s,o,a;for(o in t)"__proto__"!==o&&"constructor"!==o&&(a=t[o],a&&C.isObject(a)&&(s=e[o],n.key=o,s&&C.isObject(s)?(m(s)&&(e[o]=s=r(s,n)),a=i(s,a,n)):a=m(a)?a:r(a,n)),e[o]=a)}return e}static clone(e,t){let n,r=e;if(e&&"object"==typeof e&&!(e instanceof Event)){if(t&&"object"==typeof t&&t&&(t=null),C.isObject(e))if(e.skipClone)r=e;else for(n in r={},e)"__proto__"!==n&&"constructor"!==n&&(r[n]=C.clone(e[n]));else if(Array.isArray(e))for(r=[],n=e.length;n-- >0;)r[n]=C.clone(e[n]);else C.isDate(e)?r=new Date(e.getTime()):t&&(r=t(e))}return r}static mergeUniformObjects(e,...t){for(const n of t)for(const t in n)if("__proto__"!==t&&"constructor"!==t){const r=n[t];r&&(this.isObject(r)?this.mergeUniformObjects(e[t]||(e[t]={}),r):Array.isArray(r)?(t in e||(e[t]=[]),this.mergeArrayOfIdentityObjects(e[t],r)):e[t]=this.clone(r))}return e}static mergeArrayOfIdentityObjects(e,t){for(const n of t)if(this.isObject(n)){const t=e.find((e=>e.id===n.id));t?this.mergeUniformObjects(t,n):e.push(this.clone(n))}else e.push(n)}static createTruthyKeys(e){const t=N.split(e),n=t&&{};if(t)for(const e of t)e&&(n[e]=!0);return n}static getPath(e,t){return t.split(".").reduce(((e,t)=>(e||b)[t]),e)}static getPathDefault(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=r.length-1;return r.reduce(((e,t,r)=>(n&&!(t in e)&&(e[t]=r===i?n:{}),(e||b)[t])),e)}static getPropertyDescriptor(e,t){let n=null;for(let r=e;r&&!n&&!C.hasOwn(r,"isBase");r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,t);return n}static hasPath(e,t){return t.split(".").every((t=>!(!e||!(t in e))&&(e=e[t],!0)))}static getTruthyKeys(e){let t;if("string"==typeof e)t=[e];else if(Array.isArray(e))t=e.slice();else if(t=[],e)for(const n in e)e[n]&&t.push(n);return t}static getTruthyValues(e){const t=[];if(e)for(const n in e)e[n]&&t.push(e[n]);return t}static isClass(e){var t;return"function"==typeof e&&(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e}static isDate(e){return Boolean(null==e?void 0:e.getUTCDate)&&"date"===C.typeOf(e)}static isPromise(e){if(null!=Promise&&Promise.resolve)return Promise.resolve(e)===e||"function"==typeof(null==e?void 0:e.then);throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&"object"==typeof e)for(const t in e)return!1;return!0}static isObject(e){const t=null==e?void 0:e.constructor;return Boolean(!t||"function"!=typeof t||C.hasOwn(e,"constructor")||h.call(e,"constructor")?e&&"object"==typeof e:(t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype))&&e!==globalThis)}static isInstantiated(e){return!!e&&("object"==typeof e&&!C.isObject(e))}static merge(e,...t){return C.blend(e,t)}static mergeItems(e,t,n){let r,i,s,o,a,l,d;n=n||v;const{merge:c=C.blend}=n;if(e=e||{},Array.isArray(t))t.forEach((t=>{e=C.mergeItems(e,t,n)}));else if(t)for(a in t)if("__proto__"!==a&&"constructor"!==a)if(d=t[a],r=null,a.includes(">")?([a,r]=a.split(f),i=0):a.includes("<")&&([r,a]=a.split(p),i=1),a in e)d&&e[a]&&c&&(n.key=a,d=c(e[a],d,n)),e[a]=d;else if(r){if(!o){o=new Map,s=0;for(const t in e)o.set(t,s++)}if(s=o.get(r),e[a]=d,null==s&&i)s=o.size;else{l=l||[],s=(s||0)+i;for(const e of o){const[t,n]=e;s<=n&&(l&&(l[o.size-n-1]=t),o.set(t,n+1))}if(l)for(;l.length;){const t=l.pop(),n=e[t];delete e[t],e[t]=n}}o.set(a,s)}else{var u;e[a]=d,null===(u=o)||void 0===u||u.set(a,o.size)}return e}static setPath(e,t,n){return t.split(".").reduce(((e,t,r,i)=>r===i.length-1?e[t]=n:(e[t]instanceof Object||(e[t]={}),e[t])),e),e}static typeOf(e){let t,n;return null===e?n="null":e!=e?n="nan":(n=typeof e,"object"===n?e.isBase?n="instance":Array.isArray(e)?n="array":(n=y[t=g.call(e)])||(y[t]=n=t.slice(8,-1).toLowerCase()):"function"===n&&e.isBase&&(n="class")),n}}let w,S,D,E;Object.defineProperty(C,"hasOwn",{value:Object.hasOwn||((e,t)=>u.call(e,t))}),C._$name="Objects";const x=/([a-z])([A-Z])/g,R=/[\n\r]/g,T=/[.*+?^${}()|[\]\\]/g,M=/[&<]/,k=/(^[^a-z]+[^\w]+)/gi,F=/\s+/,I=/^[^a-z]+|[^\w:.-]+/gi,A=(e,t)=>S[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10)),L=(e,t)=>w[t],P=(e,t,n)=>`${t}-${n.toLowerCase()}`,O=(e,t,n)=>`${t} ${n.toLowerCase()}`,$=e=>e?`_x${[...e].map((e=>e.charCodeAt(0).toString(16))).join("")}`:"__blank__",_={},H={},V=[];class N{static $name="StringHelper";static circularReplacer(e,t){if(null!=t&&t.isBase)return t.id;if(t&&"object"==typeof t){for(;V.length&&V[V.length-1]!==this;)V.pop();if(V.includes(t))return"[Circular]";V.push(t)}return t}static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=_[e];return t||(_[e]=e.replace(x,P))}static hyphenateAttributeName(e){return/^(data|aria)[A-Z]/.test(e)?e.replace(/^(data|aria)([A-Z])/,((e,t,n)=>`${t}-${n}`)).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase():e}static separate(e){const t=H[e];return t||(H[e]=this.capitalize(e.replace(x,O)))}static createId(e){return String(e).replace(k,$)}static makeValidDomId(e,t=""){return null==e?null:String(e).replace(I,t)}static escapeRegExp(e,t){let n=e.replace(T,"\\$&");return void 0!==t&&(n=new RegExp(n,t)),n}static decodeHtml(e){return e&&String(e).replace(E,A)}static encodeHtml(e=""){return e&&String(e).replace(D,L)}static encodeHtmlBR(e){var t;return null===(t=N.encodeHtml(e))||void 0===t?void 0:t.replace(R,"<br>")}static isHtml(e){return"string"==typeof e&&M.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);w=e,S=t.reduce(((t,n)=>(t[e[n]]=n,t)),{}),D=new RegExp(`([${t.map((e=>"[-]".includes(e)?"\\"+e:e)).join("")}])`,"g"),E=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){}return t}static safeJsonStringify(e,t=null,n=null){let r=null;try{"circular"===t&&(V.length=0,t=this.circularReplacer),r=JSON.stringify(e,t,n)}catch{}return r}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=F){let n=e;return"string"==typeof n&&(n=e.trim(),n=n?n.split(t):[]),n}static xss(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+N.encodeHtml(t[r]);return n.join("")}static xssBR(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+N.encodeHtmlBR(t[r]);return n.join("")}static toJavaScriptValue(e,t){const n=C.typeOf(e);if("boolean"===n||"string"===n||"number"===n||null===e)return N.safeJsonStringify(e);if(e===globalThis)return"window";if("date"===n)return`new Date(${e.getFullYear()}, ${e.getMonth()}, ${e.getDate()}, ${e.getHours()}, ${e.getMinutes()}, ${e.getSeconds()}, ${e.getMilliseconds()})`;if("array"===n)return`[${e.map((e=>N.toJavaScriptValue(e,t)))}]`;if("object"===n||"instance"===n)return this.toJavaScriptString(e,t);if("function"===n){let t=e.toString();return t.match(/^async (\w+?)\(/)?t=t.replace(/^async (\w+?)\(/,"async function("):!t.startsWith("async(")&&t.match(/^(\w+?)\(/)&&(t=t.replace(/^(\w+?)\(/,"function(")),t}return"class"===n?e.toJavaScriptValue?e.toJavaScriptValue(t):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name:void 0}static toJavaScriptString(e,t={}){const n=t.level??0;return"{\n"+Object.keys(e).map((r=>" ".repeat(2*(n+1))+(r.match(/[- *]/)?`"${r}"`:r)+`: ${N.toJavaScriptValue(e[r],{...t,level:n+1})}`)).join(",\n")+"\n"+" ".repeat(2*n)+"}"}static encodeAttributeSelector(e,t){return`[${e}="${String(t).replace(/["\\]/g,"\\$&")}"]`}static fakeNodeUUIDIndex=0;static generateUUID(){var e;return c.supportsRandomUUID?globalThis.crypto.randomUUID():null!==(e=globalThis.crypto)&&void 0!==e&&e.getRandomValues?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))):`${Date.now()}-${++N.fakeNodeUUIDIndex}`}}N.initHtmlEntities(),l.register(N),N._$name="StringHelper";const B=Object.freeze([]),{hasOwn:z}=C,j="1.01"===1.005.toFixed(2)?null:(e,t)=>{const n=e.toString().split("."),r=+(n[1]?n.join(".")+"1":n[0]);return e.toFixed.call(r,t)};class W extends C{static $name="ObjectHelper";static forEach(e,t){let n;if(e)if(Array.isArray(e))e.forEach(t);else for(n in e)t(e[n],n)}static transformArrayToNamedObject(e,t="ref"){const n={};return e.forEach(((e,r)=>{const i=null!=e[t]&&e[t].toString().length?e[t]:r;n[i]=e})),n}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter((t=>e[t])).map((n=>{const r=e[n];return r[t]=n,r}))}static isEqual(e,t,n=!1,r=!1){if(!r&&(null===e&&null!==t||void 0===e&&void 0!==t||null===t&&null!==e||void 0===t&&void 0!==e))return!1;if(null==e||null==t)return null==e&&null==t;if(e===t)return!0;const i=typeof e;if(i===typeof t){switch(i){case"number":case"string":case"boolean":return e===t}switch(!0){case e.isModel&&t.isModel:return e.equals(t);case e.isBase&&t.isBase:return e===t;case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every(((e,r)=>U.isEqual(e,t[r],n)));case"object"===i&&e.constructor.prototype===t.constructor.prototype:return n?U.isDeeplyEqual(e,t,n):l.String.safeJsonStringify(e,"circular")===l.String.safeJsonStringify(t,"circular")}}return String(e)===String(t)}static isDeeplyEqual(e,t,n={}){if(e===t)return!0;if(!e||!t)return!1;const r=U.keys(e,n.ignore),i=U.keys(t,n.ignore);if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++){const o=r[s],a=i[s];if(o!==a)return!1;const l=e[o],d=t[a];if(!n.shouldEvaluate||!1!==n.shouldEvaluate(o,{value:l,object:e},{value:d,object:t})){if(n.evaluate){const r=n.evaluate(o,{value:l,object:e},{value:d,object:t});if(!1===r)return!1;if(!0===r)continue}if(!U.isEqual(l,d,n))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!==e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?l.Date.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?l.Date.isAfter(e,t):e>t}static first(e,t){let n,r=t;if(e)if(e[Symbol.iterator])for(r of e)break;else if(e[Symbol.asyncIterator])r=(async(e,t)=>{let n=t;for await(n of e)break;return n})(e,t);else if(W.isObject(e))for(n in void 0===r&&(r=B),e){r=[n,e[n]];break}return r}static fork(e){let t,n,r;if(e&&e.constructor===Object)for(n in t=Object.create(e),e)r=e[n],r&&(r.constructor===Object?t[n]=U.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static copyProperties(e,t,n){let r,i;for(i=0;i<n.length;i++)r=n[i],r in t&&(e[r]=t[r]);return e}static copyPropertiesIf(e,t,n){if(t)for(const r of n)!(r in e)&&r in t&&(e[r]=t[r]);return e}static copyPropertiesExcept(e,t,n){if(t)for(const r in t)null!=n&&n[r]||(e[r]=t[r]);return e}static entries(e,t){const n=[],r="function"==typeof t;if(e)for(const i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push([i,e[i]]);return n}static fromEntries(e,t){if(t=t||{},e)for(let n=0;n<e.length;++n)t[e[n][0]]=e[n][1];return t}static keys(e,t,n){const r=[],i="function"==typeof t;if(e){let s=0;for(const o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(o,s):o),++s)}return r}static values(e,t,n){const r=[],i="function"==typeof t;if(e){let s=0;for(const o in e)(i?t(o,e[o]):null!=t&&t[o])||(r.push(n?n(e[o],s):e[o]),++s)}return r}static pathExists(e,t){return t.split(".").every((t=>!(!e||!(t in e))&&(e=e[t],!0)))}static pathifyKeys(e,t){const n={};for(const r in e)if(z(e,r)){const i=null==t?void 0:t[r],s="object"===(null==i?void 0:i.type)||(null==i?void 0:i.complexMapping)||!Boolean(t);if(s&&Array.isArray(e[r]))n[r]=e[r].slice();else if(s&&e[r]instanceof Object){const t=this.pathifyKeys(e[r]);for(const e in t)n[`${r}.${e}`]=t[e]}else n[r]=e[r]}return n}static deletePath(e,t){t.split(".").reduce(((e,t,n,r)=>{if(null==e)return null;if(z(e,t)){if(n!==r.length-1)return e[t];delete e[t]}}),e)}static coerce(e,t){const n=C.typeOf(e),r=C.typeOf(t),i="string"==typeof e;if(n!==r)switch(r){case"string":return String(e);case"number":return Number(e);case"boolean":return!(i&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!i||e&&"null"!==e)&&null;case"undefined":return!(!i||e&&"undefined"!==e)&&void 0;case"date":return i&&isNaN(e)?l.Date.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,n,r,i=!0){const s={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&i;)o=Object.getPrototypeOf(o),o&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?s.set=t=>{a.set.call(e,t),r&&r.call(e,a.get.call(e))}:s.set=r,a.get?s.get=()=>{let t=a.get.call(e);return n&&(t=n.call(e,t)),t}:s.get=n):(s.set=n=>{e[`_${t}`]=n,r&&r.call(e,n)},s.get=()=>{let r=e[`_${t}`];return n&&(r=n.call(e,r)),r}),Object.defineProperty(e,t,s)}static hookProperty(e,t,n){const r=W.getPropertyDescriptor(n.prototype,"value"),i=W.getPropertyDescriptor(e,t),s=`_${t}`,o=class{get value(){return i?i.get.call(this):this[s]}set value(e){i?i.set.call(this,e):this[s]=e}},a=W.getPropertyDescriptor(o.prototype,"value");return Object.setPrototypeOf(n.prototype,o.prototype),Object.defineProperty(e,t,{configurable:!0,get:r.get||a.get,set:r.set||a.set}),()=>delete e[t]}static cleanupProperties(e,t=!1){return Object.entries(e).forEach((([n,r])=>{t?void 0===r&&delete e[n]:null==r&&delete e[n]})),e}static removeAllProperties(e){return Object.keys(e).forEach((t=>delete e[t])),e}static assertType(e,t,n){const r=C.typeOf(e);if(null!=e&&r!==t)throw new Error(`Incorrect type "${r}" for ${n}, expected "${t}"`)}static assertObject(e,t){U.assertType(e,"object",t)}static assertInstance(e,t){U.assertType(e,"instance",t)}static assertClass(e,t){U.assertType(e,"class",t)}static assertFunction(e,t){if("function"!=typeof e||e.isBase||e.$$name)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a function)`)}static assertNumber(e,t,n){const r=Number(e);if("number"!=typeof e||isNaN(r)||n&&e<0)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a ${n?"positive ":""}Number)`)}static assertBoolean(e,t){U.assertType(e,"boolean",t)}static assertString(e,t){U.assertType(e,"string",t)}static assertArray(e,t){U.assertType(e,"array",t)}static toFixed(e,t){return j?j(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const n=10**t;return Math.round(e*n)/n}static getMapPath(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=1===r.length,s=r[0],o=e.has(s)?e.get(s):e.set(s,i?n:{}).get(s);return i?o:U.getPathDefault(o,r.slice(1),n)}}l.register(W);const U=W;W._$name="ObjectHelper";class G{static $name="VersionHelper";static setVersion(e,n){e=e.toLowerCase(),Y[e]={version:n,isNewerThan:e=>G.semanticCompareVersion(e,n,"<"),isOlderThan:e=>G.semanticCompareVersion(e,n,">")};let r="";r=`${t}.`;const i=`${r}${e}${n.replace(/\./g,"-")}`;if(c.isBrowserEnv&&!globalThis.bryntum.silenceBundleException)if(!0===globalThis.bryntum[i]){if(!this.isTestEnv){let t=r||e;"core"===t&&(t="grid");let n=N.capitalize(t);throw"schedulerpro"===t&&(n="SchedulerPro"),new Error(`The Bryntum ${n} bundle was loaded multiple times by the application.\n\nCommon reasons you are getting this error includes:\n\n* Imports point to different types of the bundle (e.g. *.module.js and *.umd.js)\n* Imports point to both sources and bundle\n* Imports do not use the shortest relative path, JS treats them as different files\n* Cache busters differ between imports, JS treats ${t}.module.js?1 and ${t}.module.js?2 as different files\n* Imports missing file type, verify they all end in .js\n\nSee https://bryntum.com/products/${t}/docs/guide/${n}/gettingstarted/es6bundle#troubleshooting for more information\n\n`)}globalThis.BUNDLE_EXCEPTION=!0}else globalThis.bryntum[i]=!0}static getVersion(e){if(e=e.toLowerCase(),!Y[e])throw new Error("No version specified! Please check that you import VersionHelper correctly into the class from where you call `deprecate` function.");return Y[e].version}static semanticCompareVersion(e,t,n="="){t=t||"";const r=(e=e||"").split(/[-.]/),i=t.split(/[-.]/),s=n.includes("<"),o=(e,t)=>{const n=["rc","beta","alpha"],r=e.map((e=>{if(n.includes(e))return-n.indexOf(e)-2;const t=Number.parseInt(e);return Number.isNaN(t)?-n.length:t}));for(;r.length<t;)r.push(-1);return r},a=()=>{const e=Math.max(r.length,i.length),t=o(r,e),n=o(i,e);for(let r=0;r<e;r++)if(t[r]!==n[r])return s?t[r]<n[r]:t[r]>n[r];return!0};switch(n){case"=":return e===t;case"<=":case">=":return e===t||a();case"<":case">":return e!==t&&a()}return!1}static checkVersion(e,t,n){return G.semanticCompareVersion(Y.getVersion(e),t,n)}static deprecate(e,t,n){if(!Y.checkVersion(e,t,"<"))throw new Error(`Deprecated API use. ${n}`);console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${n}`)}static get isTestEnv(){var e;const t=Boolean(null===(e=globalThis.bryntum)||void 0===e?void 0:e.isTestEnv);try{var n;return t||Boolean(null===(n=globalThis.parent)||void 0===n||null===(n=n.bryntum)||void 0===n?void 0:n.isTestEnv)}catch(e){return t}}static get isDebug(){return!1}}const Y=G;c.isBrowserEnv&&(Y.isTestEnv&&(c._isHoverableDevice=!0),globalThis.bryntum=Object.assign(globalThis.bryntum||{},{getVersion:Y.getVersion.bind(Y),checkVersion:Y.checkVersion.bind(Y),deprecate:Y.deprecate.bind(Y),license:"9867512b-2f0e-11f0-ab90-0aa8b363f5dd"})),l.register(G),G._$name="VersionHelper";const q=/,\s*/,K=Symbol("decompiled"),X=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,Z=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,J=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:Q}=Object.prototype;class ee{static $name="FunctionHelper";static after(e,t,n,r,i){const s="string"==typeof n,o=!1!==(null==i?void 0:i.return),a=(...t)=>{const i=a.$nextHook.call(e,...t),l=null!=r&&r.isDestroyed?void 0:o?s?r[n](i,...t):n.call(r,i,...t):s?r[n](...t):n.call(r,...t);return void 0===l?i:l};return ee.hookMethod(e,t,a)}static before(e,t,n,r){const i="string"==typeof n,s=(...t)=>{const o=null!=r&&r.isDestroyed?0:i?r[n](...t):n.call(r,...t);return!1===o?o:s.$nextHook.call(e,...t)};return ee.hookMethod(e,t,s)}static curry(e){return function t(...n){return n.length>=e.length?e.apply(this,n):function(...e){return t.apply(this,n.concat(e))}}}static bindAll(e){for(const t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,n){return function(...r){const i=n||this;return!1!==t.call(i,...r)&&e.call(i,...r)}}static createSequence(e,t,n,r){return function(...i){const s=e.call(n=n||this,...i),o=t.call(r||n,...i);return void 0===o?s:o}}static createThrottled(e,t,n,r,i){let s,o,a=-Number.MAX_VALUE;const l=()=>{o=0,a=performance.now(),s.push.apply(s,r),e.apply(n,s)},d=function(...e){const d=performance.now()-a;s=e,d>=t?(clearTimeout(o),l()):(o||(o=setTimeout(l,t-d)),i&&(s.push.apply(s,r),i.apply(n,s)))};return d.cancel=()=>clearTimeout(o),d}static createBuffered(e,t,n,r){let i,s;const o=()=>{s=0,a.isPending=!1,i.push.apply(i,r),e.apply(n,i)},a=function(...e){i=e,s&&clearTimeout(s),a.isPending=!0,s=setTimeout(o,t)};return a.cancel=()=>{a.isPending=!1,clearTimeout(s)},a}static decompile(e){if(!(K in e)){var t,n;const r=e.toString();let i,s,o,a,l,d=X.exec(r);d?(i=[d[2]],s=d[3]):(d=Z.exec(r))?(l=d[2].trim(),i=l?l.split(q):[],s=d[3]):(d=J.exec(r))&&(o=d[2],l=d[3].trim(),i=l?l.split(q):[],s=d[4]),s=null===(t=s)||void 0===t?void 0:t.trim(),e[K]=a=d&&{args:i,async:Boolean(d[1]),body:null!==(n=s)&&void 0!==n&&n.startsWith("{")?s.substring(1,s.length-1).trim():s},o&&(a.name=o)}return e[K]}static hookMethod(e,t,n){return n.$nextHook=e[t],e[t]=n,()=>{if(Q.call(e,t)){let s,o=e[t];var r;if(o===n)(null===(r=Object.getPrototypeOf(e))||void 0===r?void 0:r[t])===n.$nextHook?delete e[t]:e[t]=n.$nextHook;else for(;s=null===(i=o)||void 0===i?void 0:i.$nextHook;o=s){var i;if(s===n){o.$nextHook=n.$nextHook;break}}}}}static noThrow(e,t,n){const r=e[t];e[t]=(...t)=>{try{return r.apply(e,t)}catch(e){return null==n?void 0:n(e)}}}static returnTrue(){return!0}static animate(e,t,n,r="linear"){let i=!1;const s=new Promise((s=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1),d=null!=n&&n.setTimeout?n:globalThis;i||!1===t.call(n,this.easingFunctions[r](l))&&s(),i||1===l?d.requestAnimationFrame((()=>s())):d.requestAnimationFrame(a)};a()}));return s.cancel=()=>(i=!0,s.cancelled=!0,!1),s}}l.register(ee);const te=.5,ne=1.70158,re=7.5625,ie=1.525,se=2/2.75,oe=2.25/2.75,ae=1/2.75,le=1.5/2.75,de=2.5/2.75,ce=2.625/2.75,ue=.75,he=.9375,ge=.984375;ee.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=te)<1?te*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=te)<1?te*Math.pow(e,3):te*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=te)<1?te*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=te)<1?te*Math.pow(e,5):te*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=te)<1?te*Math.pow(2,10*(e-1)):te*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=te)<1?-.5*(Math.sqrt(1-e*e)-1):te*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<ae?re*e*e:e<se?re*(e-=le)*e+ue:e<de?re*(e-=oe)*e+he:re*(e-=ce)*e+ge,easeInBack:e=>e*e*((ne+1)*e-ne),easeOutBack:e=>(e-=1)*e*((ne+1)*e+ne)+1,easeInOutBack:e=>{let t=1.70158;return(e/=te)<1?te*(e*e*((1+(t*=ie))*e-t)):te*((e-=2)*e*((1+(t*=ie))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=te)<1?te*(e*e*((1+(t*=ie))*e-t)):te*((e-=2)*e*((1+(t*=ie))*e+t)+2)},swingFrom:e=>e*e*((ne+1)*e-ne),swingTo:e=>(e-=1)*e*((ne+1)*e+ne)+1,bounce:e=>e<ae?re*e*e:e<se?re*(e-=le)*e+ue:e<de?re*(e-=oe)*e+he:re*(e-=ce)*e+ge,bouncePast:e=>e<ae?re*e*e:e<se?2-(re*(e-=le)*e+ue):e<de?2-(re*(e-=oe)*e+he):2-(re*(e-=ce)*e+ge),easeFromTo:e=>(e/=te)<1?te*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},ee._$name="FunctionHelper";const{defineProperty:me,getOwnPropertyDescriptor:pe}=Reflect,{hasOwnProperty:fe,toString:ve}=Object.prototype,ye=Symbol("instanceProperties"),be=Symbol("configuring"),Ce=Symbol("lazyConfigValues"),we=ve.call(new Date),Se=/\s+/,De=Object.hasOwn||((e,t)=>fe.call(e,t)),Ee=(e,t)=>e===t||!(!e||!t||ve.call(e)!==we||ve.call(t)!==we)&&e.getTime()===t.getTime(),xe=(e,t)=>(e.setHours(0,0,0,0),t&&e.setDate(e.getDate()+t),e),Re={now:()=>new Date,today:()=>xe(new Date),tomorrow:()=>xe(new Date,1),yesterday:()=>xe(new Date,-1)},Te=(e,t)=>(e[t]=1,e),Me=(e,t)=>function(){var n;return null===(n=this.configObserver)||void 0===n||n.get(e,this),t.call(this)};class ke{static get(e,t){const{cache:n}=this,r=n[e]||(n[e]=new ke(e));let i,s=r;return t&&(i=ke.makeCacheKey(e,t),(s=i&&n[i])||(s=r.extend(t),i&&(n[i]=s))),s}constructor(e){const t=this,n=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=n,t.changer="change"+n,t.initializing="initializing"+n,t.updater="update"+n,t.updaterResult=`${e}Updated`}get descriptor(){let e=this._descriptor;return e&&De(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return e&&De(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}convert(e,t){return e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{convert:n,equal:r,merge:i}=e,{convertMethods:s,equalityMethods:o}=ke;return"string"==typeof n&&!(t.convert=s[n])&&n.endsWith("[]")&&(t.convert=s[n]=ke.makeArrayConvert(s[n.slice(0,-2)])),"string"==typeof r&&!(t.equal=o[r])&&r.endsWith("[]")&&(t.equal=o[r]=ke.makeArrayEquals(o[r.slice(0,-2)])),"string"==typeof i&&(t.merge=ke.mergeMethods[i]),t}define(e){const{name:t}=this,n=pe(e,t);let r=this.descriptor;null!=n&&n.get&&(r=Object.assign({},r),r.get=Me(t,n.get)),me(e,t,r)}defineInitter(e,t){const n=this,{name:r}=n,i=e[ye];let s,o;i[r]||!(o=pe(e,r))||"value"in o||(i[r]=o),me(e,r,n.initDescriptor),n.lazy&&(s=e[Ce]||(e[Ce]=new Map),s.set(r,t))}static makeArrayConvert(e){return function(t,n){return null!=t&&(t=Array.isArray(t)?t.map(((t,r)=>e.call(this,t,n))):[e.call(this,t,n)]),t}}static makeArrayEquals(e){return(t,n)=>{let r,i=t&&n&&t.length===(r=n.length);if(i&&Array.isArray(t)&&Array.isArray(n))if(e)for(;i&&r-- >0;)i=e(t[r],n[r]);else for(;i&&r-- >0;)i=t[r]===n[r];else i=e?e(t,n):t===n;return i}}static makeCacheKey(e,t){const n=Object.keys(t).sort();for(let e,r,i,s=n.length;s-- >0;)if(i=t[e=n[s]],null==i&&!1===i)n.splice(s,1);else{if(r=typeof i,"function"===r)return null;"string"===r?n[s]=`${e}:"${i}"`:"number"===r&&(n[s]=`${e}:${i}`)}return n.length?`${e}>${n.join("|")}`:e}makeDescriptor(){const{base:e,field:t,changer:n,updater:r,name:i,updaterResult:s}=this;return e!==this?e.descriptor:{get(){var e;return null===(e=this.configObserver)||void 0===e||e.get(i,this),this[t]},set(e){const o=this,a=e,l=o.$meta.configs[i];let d,c,u=o[t];if("string"==typeof e){let t=e;var h;if(e.startsWith("up."))t=null===(h=o.owner)||void 0===h?void 0:h.resolveProperty(e.slice(3));else e.startsWith("this.")&&(t=o.resolveProperty(e.slice(5)));void 0!==t&&"function"!=typeof t&&(e=t)}var g;(l.convert!==Ie&&(e=l.convert(e,o)),o[n]&&(d=void 0===(c=o[n](e,u))&&1,d||(e=c,u=o[t])),d||(l.equal===Ae?u===e:l.equal(u,e)))||(o[t]=e,d=2,o[s]=null===(g=o[r])||void 0===g?void 0:g.call(o,e,u));!d||o.isDestroyed||o.onConfigChange.$nullFn||o.onConfigChange({name:i,value:e,was:u,config:l,applied:d,origPassedValue:a})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this;return e.removeInitter(r),r[t]=!0,r[n]=r[be][n],r[t]=!1,r.configDone[n]=!0,r[n]},set(t){e.removeInitter(this),this.configDone[n]=!0,this[n]=t}}}makeLazyInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this,i=r[Ce].get(n);return e.removeInitter(r),r.isDestroying||(r[t]=!0,r[n]=i,r[t]=!1),r[n]},set(t){e.removeInitter(this),this[n]=t}}}removeInitter(e){const{name:t}=this,n=e[ye][t],r=e[Ce];n?me(e,t,n):delete e[t],null!=r&&r.delete(t)&&!r.size&&delete e[Ce]}setDefault(e,t){me(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}merge(e,t){if(t&&e&&C.isObject(e)){if(t.isBase)return t.setConfig(e);C.isObject(t)&&(e=C.merge(C.clone(t),e))}return e}}const{prototype:Fe}=ke,{convert:Ie,equal:Ae}=Fe;ke.symbols={configuring:be,instanceProperties:ye,lazyConfigs:Ce},ke.cache=Object.create(null),ke.convertMethods={array:ke.makeArrayConvert(Ie),date(e,t){let n,r,i,s=e;if(Re[e])s=Re[e]();else if(null!=e){if("string"!=typeof e)n=new Date(e);else{if(i=this.formats,i)for(r of(i=i.flatMap((e=>e in t?t[e]:e)),i))if(n=r&&l.Date.parse(e,r),n)break;n||(n=l.Date.parse(e))}if(isNaN(n)){if(this.strict)throw new Error(`Invalid date: ${e}`)}else s=n}return s},day(e,t){var n;return null===(n=e=ke.convertMethods.date.call(this,e,t))||void 0===n||n.setMinutes(0,0,0),e}},ke.equalityMethods={array:ke.makeArrayEquals(),date:Ee,day:Ee,strict:ke.equal=Ae},ke.mergeMethods={distinct(e,t){let n=t?t.slice():[];if(null!=e)if(C.isObject(e))if(void 0===t)n=e;else{let t,r;for(t in e)r=n.indexOf(t),e[t]?r<0&&n.push(t):r>-1&&n.splice(r,1)}else Array.isArray(e)?e.forEach((e=>!n.includes(e)&&n.push(e))):n.includes(e)||n.push(e);return n},merge:ke.merge=Fe.merge,classList(e,t){if("string"==typeof e){if(!e.length)return t;e=e.split(Se)}return Array.isArray(e)&&(e=e.reduce(Te,{})),ke.merge(e,t)},objects:(e,t)=>!0===e?t||{}:ke.merge(e,t),replace:e=>e,items:(e,t,n,r)=>r?C.mergeItems(t,e,{merge:(e,t)=>Fe.merge(t,e)}):Fe.merge(e,t)},Object.assign(Fe,{_descriptor:null,_initDescriptor:null,date:!1,lazy:!1,nullify:!1,render:!1}),ke._$name="Config";class Le{constructor(e,t,n,r){const i=this;let s,o;for(s in i.destroyed=!1,i.mapFwd={},i.mapRev={},i.source=e,i.syncing=!1,i.target=t,i.sourceHook=l.Function.after(e,"onConfigChange",(e=>i.onConfigChange(e,!0)),i,qe),i.targetHook=null!=r&&r.oneway?null:l.Function.after(t,"onConfigChange",(e=>i.onConfigChange(e,!1)),i,qe),n)o=n[s],o&&("string"!=typeof o&&(o=s),i.mapFwd[s]=o,i.mapRev[o]=s);i.unbind=i.destroy.bind(i),i.unbind.binding=i}destroy(){var e,t;this.destroyed||(this.destroyed=!0,null===(e=this.sourceHook)||void 0===e||e.call(this),null===(t=this.targetHook)||void 0===t||t.call(this))}onConfigChange(e,t){const n=this;(t?n.mapFwd:n.mapRev)[e.name]&&n.sync(t)}sync(e){e=!1!==e;const t=this,[n,r,i]=e?[t.source,t.target,t.mapFwd]:[t.target,t.source,t.mapRev];if(!t.syncing&&!n.isDestroying&&!r.isDestroying){let e,s,o,a,l,d,c=0;for(s in t.syncing=!0,i)a=i[s],o=n[s],o!==r[a]&&(++c,(e||(e={}))[l=a]=d=o);c>1?r.setConfig(e):c&&(r[l]=d),t.syncing=!1}}}class Pe{constructor(e){e&&Object.assign(this,e)}getInherited(e,t=!0){let n=this[e];var r;e in this||(n=null===(r=this.super)||void 0===r?void 0:r.getInherited(e,t),(n||t)&&(this[e]=n=Object.create(n||null),$e(n,"$meta",{value:this})));return n}}const{getPrototypeOf:Oe}=Object,{defineProperty:$e}=Reflect,_e=(e=>(t,n)=>e.call(t,n))(Object.prototype.hasOwnProperty),He=Symbol("classMetaData"),Ve=Symbol("mixinTag"),Ne=Symbol("originalConfig"),Be=ke.symbols.configuring,ze=ke.symbols.instanceProperties,je=ke.symbols.lazyConfigs,We={merge:"replace",simple:!0},Ue=e=>l.Object.clone(e),Ge=()=>{},Ye=e=>l.Object.isObject(e),qe={return:!1},Ke={},Xe=Object.freeze({}),Ze=Object.freeze([]),Je=/^(date|day)(\[])?$/;class Qe{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,n=t.constructor;t.$meta.class!==n&&(n.$meta.initialized=!0),t.construct(...e),t.afterConstruct(),t.isConstructing=!1}static new(...e){return new this(e=(e=e.filter((e=>e))).length>1?this.mergeConfigs(...e):e[0])}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=e=>{null!=e&&e.destroy?e.destroy():Array.isArray(e)&&e.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=Ge,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)"destroy"!==t&&"isDestroying"!==t&&delete e[t];delete e[Ne],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return _e(this,"$name")&&this.$name||_e(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}animateProperty(e,t,n=1e3,r){const i=null==t,s=this[e]||0,o=(t||0)-s,a=ee.animate(n,(t=>this[e]=s+o*t),null,r);return i&&a.then((()=>this[e]=null)),a}callback(e,t,n=Ze){const{handler:r,thisObj:i}=this.resolveCallback(e,"this"===t?this:t)||Xe;return null==r?void 0:r.apply(i,n)}resolveProperty(e){let t=this;for(;t;){if(Qe.hasConfigPath(t,e,!0))return l.Object.getPath(t,e);t=t.owner}}resolveCallback(e,t=this,n=!0){var r;if(null!==(r=e)&&void 0!==r&&r.substring){if(e.endsWith("?")&&(n=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substring(5),t=this);if(!(t&&t instanceof Object))return;e=t[e]}if("function"==typeof e)return{handler:e,thisObj:t};if(n)throw new Error(`No method named ${e} on ${t.$$name||"thisObj object"}`)}bindCallback(e,t=this){if(e){const{handler:n,thisObj:r}=this.resolveCallback(e,t);if(n)return n.bind(r)}}delay(e,t,n=e.name||e){e=this.setTimeout?e:e.bind(this);return(this.setTimeout?this:globalThis)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t,n)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let n=0;n<t.length;++n)null!=e[t[n].field]&&(e[t[n].name]=null)}destroyProperties(...e){const t=this;let n;for(n of e){var r,i;if(n in t&&(!t[Be]||!t[Be][n]))null===(r=t[n])||void 0===r||null===(i=r.destroy)||void 0===i||i.call(r),delete t[n]}}configure(e={}){const t=this,n=t.$meta,{beforeConfigure:r}=t.initialConfig=e,{configs:i}=n,s=t.getDefaultConfiguration();let o,a,l;for(a in t.isConfiguring=!0,Object.assign(t,t.getProperties()),e)l=e[a],o=i[a],s[a]=o?o.merge(l,s[a],null,n):l;r&&(delete s.beforeConfigure,r(t,s)),t.setConfig(t[Ne]=s,!0),t.isConfiguring=!1}bindConfigs(e,t,n){const r=new Le(this,e,t,n);return!1!==(null==n?void 0:n.sync)&&r.sync(),r.unbind}getConfig(e,...t){const n=this[e];return t.length?[n,...t.map((e=>this[e]))]:n}updateConfiguration(e){const t=this,{configDone:n}=t,{configs:r}=t.$meta,i=t[Be],s=t[je];t.recompose.suspend();for(const a in e){var o;if(n[a])t[a]=e[a];else null!==(o=r[a])&&void 0!==o&&o.lazy?s.set(a,e[a]):i[a]=e[a]}t.recompose.resume(),t.recompose.flush()}setConfig(e,t=!1){const n=this,r=n[Be],i=r?n.configDone:n.configDone={},s=n.$meta.configs,o=n[je];let a,l;for(l in n[ze]={},n[Be]=r?Object.assign(Object.create(r),e):e,e)a=s[l]||ke.get(l),null!==e[l]||_e(e,l)||null===a.default?(null!=o&&o.has(l)||a.defineInitter(n,e[l]),t||(i[l]=!1)):i[l]=!0;for(l in t&&n.startConfigure(e),e){var d;i[l]||t&&null!==(d=s[l])&&void 0!==d&&d.lazy||(n[l]=e[l])}return r?n[Be]=r:delete n[Be],t&&n.finishConfigure(e),n}hasConfig(e){var t;const n=this,r=n[Be];return Boolean(null!=n["_"+e]||null!=(null===(t=n[je])||void 0===t?void 0:t.get(e))||!n.configDone[e]&&r&&(null!=r[e]||_e(r,e)))}static hasConfigPath(e,t){return t.split(".").every((t=>{var n,r;const i=null===(n=e)||void 0===n||null===(n=n.$meta)||void 0===n||null===(n=n.configs)||void 0===n?void 0:n[t];return!!(i&&i.descriptor.get===(null===(r=l.Object.getPropertyDescriptor(e,t))||void 0===r?void 0:r.get)?e.hasConfig(t):t in e)&&(e=e[t],void 0!==Object)}))}peekConfig(e){const t=this,n=t[je],r=t[Be];if(null!=n&&n.has(e))return n.get(e);if(r&&e in r){if(t.configDone[e])return t[e];if(null!=r[e]||_e(r,e))return r[e]}}triggerConfig(e){const t=this,{configDone:n}=t,r=t[je],i=t[Be],s=null!=r&&r.has(e)||i&&(null!=i[e]||_e(i,e))?!n[e]:null;return s&&t.getConfig(e),s}triggerConfigs(e){const t=this,n=t.$meta.configs,r=t[je],i=r?[...r.keys()].filter((t=>n[t].lazy===e)):Ze;for(const e of i)t.triggerConfig(e);return i.length?i:null}onConfigChange(){}get config(){const e={},t=this[Ne];for(const n in t)e[n]=t[n];return e}static processConfigValue(e,t){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map((e=>Qe.processConfigValue(e,t)));if(e instanceof Qe){if(t.visited.has(e))return;return e.getCurrentConfig(t)}if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(Ye(e)){const n={};for(const r in e)"owner"!==r&&(n[r]=Qe.processConfigValue(e[r],t));return n}return e}getConfigValue(e,t){var n;const r=this,i=r[je];return null!==(n=r.$meta.configs[e])&&void 0!==n&&n.lazy?null!=i&&i.has(e)?Qe.processConfigValue(i.get(e),t):void 0:Qe.processConfigValue(r[e],t)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const t=this,n="all"===e.configs?t.config:Ue(t.initialConfig),r=e.skip||{},i=e.visited||(e.visited=new Set),s=e.depth||(e.depth=0),o={};if(!i.has(t)){i.add(t),this.preProcessCurrentConfigs(n);for(const i in n){if(r[i])continue;const n=t.getConfigValue(i,{...e,depth:s+1});void 0!==n&&(o[i]=n)}return o}}getConfigString(e={}){return l.String.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const t=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(t){const n=t.toLowerCase(),r=`../../build/${n}.module.js`;let i,s;"static"===e.import?(i=`import * as module from "${r}";Object.assign(window, module);`,s=""):(i=`import("${r}").then(module => { Object.assign(window, module);\n`,s="});");const o=G.getVersion(n);return o&&(i+=`\nconsole.log('${t} ${o}');\n`),`${i}      \nconst ${n} = new ${t}(${this.getConfigString(e)});\n${s}`}}downloadTestCase(e={}){e.output="return";const t=this.getTestCase(e);l.Browser.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}static initClass(){return this.$meta.class}static get $meta(){if(!_e(this,He)){const e=this[He]=new Pe;return e.class=this,this.setupClass(e),e}return this[He]}static onClassMixedIn(){}static mergeConfigs(e,...t){const n=this.$meta.configs,r=Ue(e)||{};let i,s,o,a;for(s=0;s<t.length;++s)if(i=t[s],i)for(o in i)a=i[o],n[o]?a=n[o].merge(a,r[o]):r[o]&&a&&(a=ke.merge(a,r[o])),r[o]=a;return r}static mixin(...e){let t,n=this;for(t=0;t<e.length;++t){const r=e[t],i=r[Ve]||(r[Ve]=Symbol("mixinTag"));n[i]||(n=r(n),n[i]=!0,_e(n,"onClassMixedIn")&&n.onClassMixedIn())}return n}static setupClass(e){var t;const n=e.class,r=Oe(n).$meta,i=n.$$name,s=r.names,o=n.prototype;if($e(o,"$meta",{value:e}),Object.assign(e,{super:r,config:Object.create(r.config),configs:Object.create(r.configs),declarables:r.declarables,forkConfigs:r.forkConfigs,hierarchy:Object.freeze([...r.hierarchy,n]),names:s.includes(i)?s:Object.freeze([...s,i]),properties:r.properties,nullify:null===(t=r.nullify)||void 0===t?void 0:t.slice()}),s!==e.names){const e=`is${i}`,t=t=>{_e(t,e)||$e(t,e,{get:()=>!0})};t(o),t(n)}for(let t,r,i=0;i<e.declarables.length;++i)t=e.declarables[i],_e(n,t)&&(r=Ke[t]||(Ke[t]=`setup${l.String.capitalize(t)}`),n[r](n,e))}static setupConfigs(e,t,n){const r=e.config,i=e.configs,s=e.class,o=e.super;let a,d,c,u,h,g,{nullify:m}=e;for(const p in t)h=t[p],n?(a=i[p])?h=a.merge(h,r[p],e,o):a=ke.get(p,We):(d=c=u=void 0,h&&"object"==typeof h&&"$config"in h&&(c=h.$config,Je.test(String(c))&&(c={type:c}),c&&(Ye(c)?c.type&&(c={convert:c.type,equal:c.type,...c},delete c.type):c=l.Object.createTruthyKeys(c)),u="default"in h,d=u?h.default:d,h="value"in h?h.value:null),(a=i[p])?(g=a.nullify,c&&(a=a.extend(c)),h=a.merge(h,r[p],e,o)):(a=ke.get(p,c),a.define(s.prototype),u=!(a.field in s.prototype),g=!1),u&&a.setDefault(s,d),a.nullify&&!g&&(m||(m=e.nullify||(e.nullify=[]))).push(a)),h&&(Ye(h)||Array.isArray(h))&&!Object.isFrozen(h)&&(e.forkConfigs=!0),i[p]=a,r[p]=h}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const n=e.declarable;let r,i,s=t.declarables;for(i=0;i<n.length;++i)s.includes(n[i])||(r||(t.declarables=r=s=s.slice()),s.push(n[i]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}static fork(e){let t,n,r=e;if(e&&Ye(e)&&!Object.isFrozen(e))for(t in r=Object.create(e),e)n=e[t],n&&(Ye(n)?r[t]=Qe.fork(n):Array.isArray(n)&&(r[t]=n.slice()));return r}static getDefaultConfiguration(){return this.$meta.class.prototype.getDefaultConfiguration()}getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?Qe.fork(e.config):Object.create(e.config);if(G.isTestEnv&&l.Browser.isBrowserEnv&&t.testConfig&&globalThis.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}getProperties(){const e=this.$meta.properties,t={};for(let n=0;n<e.length;n++){const r=Object.getOwnPropertyDescriptor(e[n],"properties");Object.assign(t,void 0!==r.get?e[n].properties:Ue(r.value))}return t}static applyDefaults(e){for(const t in e)this.$meta.config[t]=e[t]}static get superclass(){return Oe(this)}classHierarchy(e){const t=this.$meta.hierarchy,n=e?t.indexOf(e):0;return n>0?t.slice(n):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(...e){const{$detachers:t}=this;if(t)for(let n,r=0,{length:i}=e;r<i;r++)if(n=t[e[r]])for(;n.length;)n.pop()()}trackDetacher(e,t){const n=this.$detachers||(this.$detachers={});(n[e]||(n[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const n in t){const r=t[n];for(let t=r.length;t-- >0;)r[t].eventer===e&&r.splice(t,1)}}}const et=Qe.prototype;var tt;et.onConfigChange.$nullFn=Ge.$nullFn=!0,Qe[He]=et.$meta=(tt={class:Qe,config:Object.freeze({}),configs:Object.create(null),declarables:Qe.declarable,forkConfigs:!1,hierarchy:Object.freeze([Qe]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null},new Pe(tt)),Object.assign(et,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),Qe.emptyFn=Ge,G.setVersion("core","6.2.2"),Qe._$name="Base";class nt{static $name="ArrayHelper";static clean(e){return e.reduce(((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e)),[])}static from(e,t,n){const r=[];if(e)for(const i of e)t&&!t(i)||r.push(n?n(i):i);return r}static remove(e,...t){let n,r,i=!1;t=t[0]instanceof Set?[...t[0]]:t;for(let s=0;s<t.length;s++)r=t[s],-1!==(n=e.indexOf(r))&&(e.splice(n,1),i=!0);return i}static findInsertionIndex(e,t,n=this.lexicalCompare,r){const i=t.length;let s,o;return r<i&&(s=r>0?n(t[r-1],e):0,o=r<i-1?n(e,t[r]):0,s<1&&o<1)?r:this.binarySearch(t,e,n)}static findLast(e,t,n){for(let{length:r}=e,i=r-1;i>=0;i--)if(t.call(n,e[i],i,e))return e[i]}static binarySearch(e,t,n=0,r=e.length,i=this.lexicalCompare){const s=e.length;let o,a;for(n instanceof Function?(i=n,n=0):r instanceof Function&&(i=r,r=s),--r;n<=r;)o=n+r>>1,a=i(t,e[o]),a>=0?n=o+1:a<0&&(r=o-1);return n}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},n=null){const r=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(const e of i){const i=Object.assign({},e);n&&n(i,t),r.push(i)}return r}static populate(e,t,n=!1){const r=[];for(let i=0;i<e;i++)r.push(t(i+(n?1:0)));return r}static include(e,...t){for(const n of t)e.includes(n)||e.push(n)}static unique(e){return[...new Set(e)]}static countUnique(e){const t=new Map;for(const n of e){const e=t.get(n);t.set(n,void 0===e?1:e+1)}return[...t.entries()].map((([e,t])=>({value:e,count:t})))}static allowNegative(e){return new Proxy(e,{get(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,n,r):(e[i<0?e.length+i:i]=n,!0)}})}static delta(e,t,n=!1){if(!t)return n?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const r=[],i=[],s=new Set,o=new Set(t);for(let t=0;t<e.length;t++){const n=e[t];o.has(n)?s.add(n):r.push(n)}for(let e=0;e<t.length;e++){const n=t[e];s.has(n)||i.push(n)}return n?{toAdd:r,toRemove:i,toKeep:s}:{onlyInA:r,onlyInB:i,inBoth:[...s]}}static asArray(e){return null==e?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,t,n=nt.identity){const r="string"==typeof t?e=>null==e?void 0:e[t]:t,i="string"==typeof n?e=>null==e?void 0:e[n]:n;return e.reduce(((e,t)=>(e[r(t)]=i(t),e)),{})}static aggregate(e,t,n,r,i={}){const s=e.length,o=[];if(!s)return o;const a=e[0].length;i.targetArray=o,i.arrays=e;for(let e=0;e<a;e++)i.entryIndex=e,o.push(r(e,i));for(let r=0;r<s;r++){const s=e[r];i.rowIndex=r;for(let e=0;e<a;e++){i.entryIndex=e;const a=t(s[e],i);o[e]=n(o[e],a,r,e,i)}}return o}static groupBy(e,t){const n="string"==typeof t?e=>null==e?void 0:e[t]:t;return e.reduce(((e,t)=>{const r=n(t);return(e[r]=e[r]||[]).push(t),e}),{})}static groupByIndexed(e,t){return e.reduce(((e,n)=>{const r=t(n);let i=e.get(r);return void 0===i&&(i=new Set,e.set(r,i)),i.add(n),e}),new Map)}}l.register(nt),nt._$name="ArrayHelper";const{isArray:rt}=Array,{hasOwnProperty:it}=Object.prototype,st={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},ot=(e,t)=>t.prio-e.prio,at=(e,t)=>{if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[rt(t)?"apply":"call"](e,t)}return e};var lt=e=>class t extends(e||Qe){eventsSuspended=null;static $name="Events";static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(e,t){const n=t.getInherited("deprecatedEvents"),r=e.deprecatedEvents;for(const e in r)n[e.toLowerCase()]=n[e]=r[e]}static get configurable(){return{listeners:{value:null,$config:{merge:at}},internalListeners:{value:null,$config:{merge:at}},bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(e,...t){var n;(this.configuredListeners=null===(n=e)||void 0===n?void 0:n.listeners)&&delete(e=C.assign({},e)).listeners,super.construct(e,...t),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const e=this,{isConfiguring:t}=e;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(e){super.setupClass(e),t.prototype.onListen.$nullFn=!0,t.prototype.onUnlisten.$nullFn=!0}addListener(e,t,n){if(rt(e)){for(let n=0,{length:r}=e;n<r;n++)this.addListener(e[n],t);return}const r=this,i=r.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return r.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:n});{t=e.thisObj=void 0!==e.thisObj?e.thisObj:t;for(const n in e)if(!st[n]&&null!=e[n]){const o=n.toLowerCase(),a=null==i?void 0:i[o],l=r.eventListeners||(r.eventListeners={}),d=nt.asArray(e[n]);if(a){const{product:e,invalidAsOfVersion:t,message:n}=a;G.deprecate(e,t,n)}for(const i of d){var s;const a=i.expires||e.expires,d={fn:"object"==typeof i?i.fn:i,thisObj:void 0!==i.thisObj?i.thisObj:t,args:i.args||e.args,prio:void 0!==i.prio?i.prio:void 0!==e.prio?e.prio:0,once:void 0!==i.once?i.once:void 0!==e.once&&e.once,buffer:i.buffer||e.buffer,throttle:i.throttle||e.throttle,$internal:e.$internal,catchAll:"catchAll"===n};if(a){const{alt:i}=a,s=i?a.delay:a,l=e.name||n,c=()=>{r.un(o,d),i&&!d.called&&r.callback(i,t)};r.isDelayable?r.setTimeout({fn:c,name:l,cancelOutstanding:!0,delay:s}):globalThis.setTimeout(c,s)}let c=l[o]||(l[o]=[]);c.$firing&&(l[o]=c=c.slice()),c.splice(nt.findInsertionIndex(d,c,ot,c.length),0,d),!r.onListen.$nullFn&&c.length<2&&r.onListen(o),null===(s=r.afterAddListener)||void 0===s||s.call(r,o,d)}}e.relayAll&&r.relayAll(e.relayAll),t&&t!==r&&r.attachAutoDetacher(e,t);const n=!1!==e.detachable,a=e.name,l=e.expires||n||a?()=>{r.isDestroyed||r.removeListener(e,t)}:null;var o;if(l)if(l.eventer=r,l.listenerName=a,a&&null!==(o=t)&&void 0!==o&&o.trackDetacher&&t.trackDetacher(a,l),e.expires&&r.delay(l,isNaN(e.expires)?e.expires.delay:e.expires,a),n)return l}}on(e,t,n){return this.addListener(e,t,n)}ion(e){return e.$internal=!0,this.on(e)}un(...e){this.removeListener(...e)}updateInternalListeners(e,t){null==t||t.detach(),e&&(e.detach=this.ion(e))}get listeners(){return this.eventListeners}changeListeners(e){if(!this.isConfiguring){if(Array.isArray(e))for(let t=0,n=e[0],{length:r}=e;t<r;n=e[++t])"thisObj"in n||(e[t]=C.assign({thisObj:this},n));else e&&!("thisObj"in e)&&(e=C.assign({thisObj:this},e));return e}this.getConfig("internalListeners"),e&&this.on(e,this)}updateListeners(e,t){t&&this.un(t),e&&this.on(e)}removeListener(e,t=e.thisObj,n){const r=this;if("string"==typeof e)return r.removeListener({[e]:t},n);for(let n in e){const s=e[n];if(!st[n]&&null!=s){n=n.toLowerCase();const{eventListeners:e}=r,o=r.findListener(n,s,t);if(o>=0){var i;let t=e[n];null===(i=r.afterRemoveListener)||void 0===i||i.call(r,n,t[o]),t.length>1?(t.$firing&&(e[n]=t=t.slice()),t.splice(o,1)):(delete e[n],r.onUnlisten.$nullFn||r.onUnlisten(n))}}}e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)}findListener(e,t,n){var r;const i=null===(r=this.eventListeners)||void 0===r?void 0:r[e],s=t.fn||t,o=t.thisObj||n;if(i)for(let e,t=0,{length:n}=i;t<n;t++)if(e=i[t],e.fn===s&&e.thisObj===o)return t;return-1}hasListener(e){var t;return Boolean(null===(t=this.eventListeners)||void 0===t?void 0:t[null==e?void 0:e.toLowerCase()])}relayAll(e,t,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const{relayAllTargets:r}=this;e.ion({beforeDestroy:({source:t})=>{if(t===e){r.filter((t=>t.through===e)).forEach((e=>nt.remove(r,e)))}}}),r.push({through:e,prefix:t,transformCase:n})}removeAllListeners(e=!0){const t=this.eventListeners;let n,r;for(const o in t){const a=t[o];for(n=a.length;n-- >0;){const t=a[n];var i,s;if(!t.$internal||!e)this.removeListener(o,t),r=t.thisObj,null===(i=r)||void 0===i||null===(s=i.untrackDetachers)||void 0===s||s.call(i,this)}}}relayEvents(e,t,n="",r){const i={detachable:!0,thisObj:this};return t.forEach((e=>{n&&(e=N.capitalize(e)),i[e]=(t,...i)=>(r&&(t=Object.assign({},t,{source:this})),this.trigger(n+e,t,...i))})),e.on(i)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:e,target:t,oldDestructor:n}=this;for(let n=0;n<e.length;n++){const{dispatcher:r,config:i}=e[n];r.isDestroyed||r.removeListener(i,t)}n.call(t)}attachAutoDetacher(e,t){const n=e.thisObj||t,r="doDestroy"in n?"doDestroy":"destroy";if(r in n){let{$autoDetachers:t}=n;t||(n.$autoDetachers=t=[]),n.$oldDestructor||(n.$oldDestructor=n[r],n[r]=this.destructorInterceptor.bind({autoDetachers:t,oldDestructor:n.$oldDestructor,target:n})),t.push({config:e,dispatcher:this})}else n[r]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj;t.$oldDestructor&&!t.isDestroying&&(nt.remove(t.$autoDetachers,t.$autoDetachers.find((t=>t.config===e&&t.dispatcher===this))),t.$autoDetachers.length||(t["doDestroy"in t?"doDestroy":"destroy"]=t.$oldDestructor,t.$oldDestructor=null))}once(e,t){return this.ion({[e]:e=>this.callback(t,this,[e]),once:!0})}await(e,t={checkLog:!0,resetLog:!0,args:null,expires:null}){const n=this;!1===t&&(t={checkLog:!1});const{args:r}=t;return new Promise((i=>{var s;if(t.checkLog&&null!==(s=n._triggered)&&void 0!==s&&s[e]&&(i(),t.resetLog&&n.clearLog(e)),r){const s=n.on({[e]:(...o)=>{("function"==typeof r?r(...o):Object.keys(r).every((e=>e in o[0]&&o[0][e]===r[e])))&&(i(...o),t.resetLog&&n.clearLog(e),s())},expires:t.expires,prio:-1e4})}else n.on({[e]:(...r)=>{i(...r),t.resetLog&&n.clearLog(e)},expires:t.expires,prio:-1e4,once:!0})}))}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}trigger(e,t){var n,r,i,s,o;const a=this,l=e.toLowerCase(),{eventsSuspended:d,relayAllTargets:c,callOnFunctions:u}=a;let h,g,m=null===(n=a.eventListeners)||void 0===n?void 0:n[l];if(a._triggered||(a._triggered={}),a._triggered[e]=!0,d)return d.shouldQueue&&d.queue.push(arguments),!0;if(null!==(r=a.eventListeners)&&void 0!==r&&r.catchall&&((m=m?m.slice():[]).push(...a.eventListeners.catchall),m.sort(ot)),!m&&!c&&!u)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=a:(t=Object.create(t),Object.assign(t,{source:a}))):t={source:a},t.type!==l&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>l}):t.type=l),t.eventName=e,!("bubbles"in t)&&null!==(i=a.bubbleEvents)&&void 0!==i&&i[e]&&(t.bubbles=a.bubbleEvents[e]),u){const n="on"+N.capitalize(e);if(n in a){var p;const e=!a[n]||a.callback(a[n],a,[t]);let r;if(C.isPromise(e)?(h||(h=[])).push(e):r=!1===e||r,!a.isDestroyed&&it.call(a,n)&&(null===(p=a.pluginFunctionChain)||void 0===p||!p[n])){const e=Object.getPrototypeOf(a);if(n in e){const i=e[n].call(a,t);if(C.isPromise(i)?(h||(h=[])).push(i):r=!1===i||r,a.isDestroyed)return}}if(r)return!1}}if(m){let e=0,n=!1;for(m.$firing=!0;e<m.length&&!a.isDestroyed&&!n;e++){const r=m[e];if(!1===g&&!r.$internal)continue;let i,s=r.thisObj;if(!s||!s.isDestroyed){if(r.called=!0,r.once&&a.removeListener(l,r),"string"==typeof r.fn){if(s&&(i=s[r.fn]),!i){const e=a.resolveCallback(r.fn);i=e.handler,s=e.thisObj}}else i=r.fn;if(r.buffer){if(!r.bufferFn){const e=Number(r.buffer);if("number"!=typeof e||isNaN(e))throw new Error(`Incorrect type for buffer, got "${e}" (expected a Number)`);r.bufferFn=ee.createBuffered(i,e,s,r.args)}i=r.bufferFn}if(r.throttle){const e=Number(r.throttle);if("number"!=typeof e||isNaN(e))throw new Error(`Incorrect type for throttle, got "${e}" (expected a Number)`);r.throttledFn||(r.throttledFn=ee.createThrottled(i,e,s,r.args)),i=r.throttledFn}const e=i.call(s||a,...r.args||[],t);!1!==g&&(g=e),r.$internal&&!1===e&&(n=!0),C.isPromise(e)&&(e.$internal=r.$internal,(h||(h=[])).push(e))}}if(m.$firing=!1,n)return!1}return null==c||c.forEach((n=>{let r=e;if(n.transformCase&&(r=N.capitalize(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1})),t.bubbles&&a.owner&&!a.owner.isDestroyed?a.owner.trigger(e,t):(h=null===(s=h)||void 0===s?void 0:s.filter((e=>!1!==g||e.$internal)),null!==(o=h)&&void 0!==o&&o.length?new Promise((e=>{Promise.allSettled(h).then((t=>{const n=!t.some((e=>"fulfilled"===e.status&&!1===e.value));e(n)}))})):!1!==g)}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}};class dt{static animationFrame(){return new Promise((e=>{requestAnimationFrame(e)}))}static sleep(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static waitFor(e,t=6e4,n=100){let r;const i=new Promise(((i,s)=>{let o;r=i;const a=()=>{const t=e();if(t)return clearInterval(o),i(t),!0};a()||(o=setInterval(a,n),t&&setTimeout((()=>{clearInterval(o),t>0?s():i()}),Math.abs(t)))}));return i.resolve=r,i}static yield(){return Promise.resolve()}}let ct;dt._$name="AsyncHelper";const ut=["border-top-width","border-right-width","border-bottom-width","border-left-width"],ht=["margin-top","margin-right","margin-bottom","margin-left"],gt=["padding-top","padding-right","padding-bottom","padding-left"],mt="border-top-width",pt="border-right-width",ft="border-bottom-width",vt="border-left-width",yt="padding-top",bt="padding-right",Ct="padding-bottom",wt="padding-left",St=/^([trblc])(\d*)-([trblc])(\d*)$/i,Dt=/^([trblc])(\d*)$/i,Et=["top","right","bottom","left"],xt={t:0,r:1,b:2,l:3},Rt=["b-t","l-r","t-b","r-l"],Tt={bt:1,tb:1,lr:2,rl:2},Mt=Object.freeze([0,0]),kt=["width","height"],Ft=(e,t=e,n=e,r=t)=>Array.isArray(e)?Ft.apply(null,e):[e,t,n,r],It=(e,t,n,r)=>Array.isArray(e)?Ft.apply(null,e):"number"==typeof e.top?[e.top,e.right,e.bottom,e.left]:[e,t,n,r],At=(e,t)=>{const n=St.exec(e),r=n[1],i=n[3],s=parseInt(n[2]||50),o=parseInt(n[4]||50),a=!t||1&xt[r]?s:100-s,l=!t||1&xt[i]?o:100-o;return{myAlignmentPoint:r+a,myEdge:r,myOffset:a,targetAlignmentPoint:i+l,targetEdge:i,targetOffset:l,startZone:xt[i],edgeAligned:Tt[r+i]}},Lt=e=>`${Et[(xt[e.myEdge]+2)%4][0]}${e.myOffset}-${Et[(xt[e.targetEdge]+2)%4][0]}${e.targetOffset}`,Pt={hidden:1,clip:1};class Ot{isRectangle=!0;static from(e,t,n){var r,i;if("string"==typeof e?e=document.querySelector(e):(null===(r=e)||void 0===r?void 0:r.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),"string"==typeof t&&(t=document.querySelector(t)),null==e||e.isRectangle)return e;if(e=e.element||e,void 0===n&&"boolean"==typeof t&&(n=t,t=null),null===(i=t)||void 0===i||!i.isRectangle)if(t){let{scrollLeft:e,scrollTop:n}=t;c.isSafari&&t===document.body&&(e=n=0),t=Ot.from(t).translate(-e,-n)}else ct||(ct=new Ot(0,0,0,0)),t=ct;const s=e===document||e===globalThis,o=e===document.body&&0===document.body.offsetHeight,a=o&&e.getBoundingClientRect(),l=o?new Ot(a.left,a.top,a.width,document.body.parentElement.scrollHeight):s?new Ot(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),d=n||s?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new Ot(l.left+d[0]-t.x,l.top+d[1]-t.y,l.width,l.height)}static fromScreen(e,t){return Ot.from(e,t,!0)}static inner(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Yn.getStyleValue(e,ut);r.x+=parseFloat(t[vt]),r.y+=parseFloat(t[mt]),r.right-=parseFloat(t[pt]),r.bottom-=parseFloat(t[ft])}return r}static content(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Yn.getStyleValue(e,ut),n=Yn.getStyleValue(e,gt);r.x+=parseFloat(t[vt])+parseFloat(n[wt]),r.y+=parseFloat(t[mt])+parseFloat(n[yt]),r.right-=parseFloat(t[pt])+parseFloat(n[bt]),r.bottom-=parseFloat(t[ft])+parseFloat(n[Ct])}return r}static client(e,t,n=!1,r,i,s=!0){const o=this[s?"content":"inner"](e,t,n),a=Yn.scrollBarWidth;let l;return a&&!e.classList.contains("b-hide-scroll")&&(e.scrollHeight>e.clientHeight&&!Pt[Yn.getStyleValue(e,"overflow-y")]&&(l=s?parseFloat(Yn.getStyleValue(e,"padding-inline-end")):0,"rtl"===Yn.getStyleValue(e,"direction")?o.x+=l+Math.max(l,a):o.right+=l-Math.max(l,a)),e.scrollWidth>e.clientWidth&&!Pt[Yn.getStyleValue(e,"overflow-x")]&&(l=s?parseFloat(Yn.getStyleValue(e,"padding-bottom")):0,o.bottom+=l-Math.max(l,a))),r&&this.clipStickies(o,e,t,n=!1,i),o}static clipStickies(e,t,n,r=!1,i){let s=[...t.children].filter((e=>"sticky"===Yn.getStyleValue(e,"position")));if(i){const e=i&&Ot.from(i,n,r);s=s.filter((t=>!t.contains(i)&&e.intersect(Ot.from(t))))}for(let t=0,{length:n}=s;t<n;t++){const n=s[t],r=this.fromScreen(n);0===parseFloat(Yn.getStyleValue(n,"left"))?e.x+=r.width:0===parseFloat(Yn.getStyleValue(n,"right"))?e.right-=r.width:0===parseFloat(Yn.getStyleValue(n,"top"))?e.y+=r.height:0===parseFloat(Yn.getStyleValue(n,"bottom"))&&(e.bottom-=r.height)}return e}static outer(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=Yn.getStyleValue(e,ht);r.x-=parseFloat(t["margin-left"]),r.y-=parseFloat(t["margin-top"]),r.right+=parseFloat(t["margin-right"]),r.bottom+=parseFloat(t["margin-bottom"])}return r}static union(...e){let t,{x:n,y:r,right:i,bottom:s}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)t=e[o],t.x<n&&(n=t.x),t.y<r&&(r=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new Ot(n,r,i-n,s-r)}roundPx(e=globalThis.devicePixelRatio||1){const t=this;return t._x=Yn.roundPx(t._x,e),t._y=Yn.roundPx(t._y,e),t._width=Yn.roundPx(t._width,e),t._height=Yn.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,n,r,i=!0){i&&(W.assertNumber(e,"Rectangle.x"),W.assertNumber(t,"Rectangle.y"),W.assertNumber(n,"Rectangle.width",!0),W.assertNumber(r,"Rectangle.height",!0));const s=this;n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),s._x=e,s._y=t,s._width=n,s._height=r}clone(){const e=this,t=new Ot(e.x,e.y,e.width,e.height,!1);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return!!e.isRectangle&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}exclude(...e){const t=this;let n,r=t.clone();for(n of Array.from(e).flat()){var i,s;let e,o,a=[0,0,0,0];((e=n.x<=t.x)||n.right>=t.right)&&(null===(i=o=n.intersect(t))||void 0===i?void 0:i.height)>=t.height?a[e?3:1]=-o.width:((e=n.y<=t.y)||n.bottom>=t.bottom)&&(null===(s=o=n.intersect(t))||void 0===s?void 0:s.width)>=t.width&&(a[e?0:2]=-o.height),r=r.inflate(...a)}return r}intersect(e,t=!1,n=!1){const r=this,i=Math.max(r.y,e.y),s=Math.min(r.right,e.right),o=Math.min(r.bottom,e.bottom),a=Math.max(r.x,e.x);return!!(n?o>=i&&s>=a:o>i&&s>a)&&(!!t||new Ot(a,i,s-a,o-i))}equals(e,t=!1){const n=t?e=>Math.round(e):e=>e;return e.isRectangle&&n(e.x)===n(this.x)&&n(e.y)===n(this.y)&&n(e.width)===n(this.width)&&n(e.height)===n(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){const e=new $t(this.x+this.width/2,this.y+this.height/2,0,0);return e.target=this.target,e}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){W.assertNumber(e,"Rectangle.width",!this._allowNegative),this._width=e}get width(){return this._width}set height(e){W.assertNumber(e,"Rectangle.height",!this._allowNegative),this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,t=!0){return t?e?this.right:this.left:this.top}getEnd(e,t=!0){return t?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,n,r,i){const s=this;return s._allowNegative=i,s.x+=e,s.y+=t,s.width+=n,s.height+=r,s}inflate(e,t=e,n=e,r=t){return[e,t,n,r]=It(e,t,n,r),this.adjust(-r,-e,t,n)}deflate(e,t=e,n=e,r=t){return[e,t,n,r]=It(e,t,n,r),this.adjust(r,e,-t,-n)}constrainTo(e,t){const n=this,r=n.height,i=n.y,s=n.minWidth||n.width,o=n.minHeight||n.height;if(n.height>=e.height){if(t&&o>e.height)return!1;n._y=e.y,n.height=e.height}if(n.width>=e.width){if(t&&s>e.width)return n.y=i,n.height=r,!1;n._x=e.x,n.width=e.width}return n.translate.apply(n,n.constrainVector=[Math.min(e.right-n.right,0),Math.min(e.bottom-n.bottom,0)]),n.translate(Math.max(e.x-n.x,0),Math.max(e.y-n.y,0)),n}alignTo(e){let t,n,r,i,s=this.clone(),{target:o,constrainTo:a,constrainPadding:l,inflate:d}=e;if(o&&(o=o.isRectangle?o.clone():Ot.from(o.element?o.element:o),d&&o.inflate.apply(o,Array.isArray(d)?d:[d])),a){if(!a.isRectangle){i=a===globalThis||a===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!i;a=Ot.from(a.element?a.element:a,null,t)}l&&(l=Ft(l),l[0]=Math.min(l[0],o.top),l[1]=Math.min(l[1],a.right-o.right),l[2]=Math.min(l[2],a.bottom-o.bottom),l[3]=Math.min(l[3],o.left),a=a.deflate.apply(a.clone(),l))}const c=this,u=null==(R=e.offset)?Mt:"number"==typeof R?[R,R]:R,{align:h,axisLock:g,anchorSize:m,anchorPosition:p,matchSize:f,position:v,rtl:y}=e,b=o&&o.width<2&&o.height<2,C=At(h,y),w=a&&a.clone(),S=[],D=[{zone:n=C.startZone,align:h}],E=f&&kt[1&C.startZone],x=c[E];var R;if(E&&g?s[E]="min"===f?Math.max(s.width,o[E]):o[E]:!C.edgeAligned&&f&&(s.width=o.width,s.height=o.height),a&&s.constrainTo(a),a&&null!=C.startZone)if(g)D.push({zone:n=(n+2)%4,align:Lt(C)}),"flexible"===g&&(D.push({zone:n=(C.startZone+1)%4,align:Rt[n]}),D.push({zone:n=(n+2)%4,align:Rt[n]}));else for(let e=1;e<4;e++)D.push({zone:n=(n+1)%4,align:Rt[n]});if(p){const e=1&C.startZone?"y":"x";t={[e]:p[e],edge:Et[(C.startZone+2)%4]}}if(w&&o&&(w.adjust(-o.width,-o.height,o.width,o.height),o.constrainTo(w)),s.minWidth=c.minWidth,s.minHeight=c.minHeight,v)s.moveTo(v.x,v.y),s.translate.apply(s,u),a&&s.constrainTo(a);else{const e="c"===C.myEdge||"c"===C.targetEdge,n=m&&!e?[m[1]+u[0],m[1]+u[1]]:u,l=o.getAlignmentPoint(C.targetAlignmentPoint),d=o.getAlignmentPoint(C.targetAlignmentPoint,n);let h=s.getAlignmentPoint(C.myAlignmentPoint),p=!b&&s.clone().translate(l[0]-h[0],l[1]-h[1]).intersect(o,!0);if(s.translate(d[0]-h[0],d[1]-h[1]),p)s.translate(-(d[0]-h[0]),-(d[1]-h[1])),h=s.getAlignmentPoint(C.myAlignmentPoint),s.translate(l[0]-h[0],l[1]-h[1]),s.translate(...n),a&&s.constrainTo(a),r=C.startZone;else if(a&&!a.contains(s)){const e=s.clone(),l=[];let d,u;t=null,S[0]=d=a.clone(),d.bottom=o.y-n[1],S[1]=d=a.clone(),d.x=o.right+n[0],S[2]=d=a.clone(),d.y=o.bottom+n[1],S[3]=d=a.clone(),d.right=o.x-n[0];for(let e=0;e<D.length;e++){if(E&&2===e&&(s[E]=x),d=S[r=D[e].zone],s=s.alignTo({target:o,offsets:n,align:D[e].align}),s.constrainTo(d,!0)&&(l.push({result:s,zone:r}),!u||s.width<c.width||s.height<c.height)){s.align=D[e].align;break}if(!u||d.area>u.area){const e=s.clone();switch(r){case 0:e.moveTo(null,d.bottom-e.height);break;case 1:e.moveTo(d.left);break;case 2:e.moveTo(null,d.top);break;case 3:e.moveTo(d.right-e.width)}u={area:d.area,result:e,zone:r}}}l.length?(l.length>1&&!g&&l.sort(((t,n)=>Math.sqrt((e.x-t.result.x)**2+(e.y-t.result.y)**2)-Math.sqrt((e.x-n.result.x)**2+(e.y-n.result.y)**2))),s=l[0].result,r=l[0].zone):(s=u.result,r=u.zone,i&&s.constrainTo(a))}else r=C.startZone;if(s.overlap=p=!b&&s.intersect(o,!0),s.zone=r,m&&!p){if(!t){const e=1&r,n=e?"y":"x",i=e?"bottom":"right",a=Math.max(o[n],s[n]);let l=a+(Math.min(o[i],s[i])-a)/2-m[0]/2;const d=l+m[0];d>s[i]&&(l-=d-s[i]),l<s[n]&&(l+=s[n]-l),t={[n]:l-s[n],edge:Et[(r+2)%4]}}s.anchor=t}}return s}getAlignmentPoint(e,t=Mt){e=String(e);const n=this,r=Dt.exec(e)||St.exec(e),i=r&&r[1].toLowerCase(),s=r&&Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(i){case"t":return[n.x+n.width*s,n.y-t[1]];case"r":return[n.right+t[0],n.y+n.height*s];case"b":return[n.x+n.width*s,n.bottom+t[1]];case"l":return[n.x-t[0],n.y+n.height*s];case"c":return[n.x+n.width/2,n.y+n.height/2]}}highlight(){const e=this,t=Yn.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return Yn.highlight(t).then((()=>t.remove()))}visualize(e,t=!1,n=!1){const r=this,i=W.merge({style:{width:`${r.width}px`,height:`${r.height}px`,pointerEvents:"none",...e.class?{}:{position:"absolute","z-index":9999999},...n?{insetInlineStart:r.x,top:r.y}:{left:0,top:0,transform:`translate(${r.x}px, ${r.y}px)`}}},e);return t?i:Yn.createElement(i)}toString(e=","){return[`${this.top}px`,`${this.right}px`,`${this.bottom}px`,`${this.left}px`].join(e)}}class $t extends Ot{static from(e,t=!0){const n=t?"client":"screen";e.changedTouches&&(e=e.changedTouches[0]);return new this(e[`${n}X`],e[`${n}Y`])}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Ot._$name="Rectangle";const _t=Symbol("value"),Ht=Symbol("length");class Vt{static change(e,t,n,r="string"){n=Vt.normalize(n,"object");const i=Vt.normalize(e,"array").filter((e=>!n[e]));if(t){t=Vt.normalize(t,"array");for(let e=0;e<t.length;++e)i.includes(t[e])||i.push(t[e])}return Vt.normalize(i,r)}static from(e,t){return e&&(e.isDomClassList?t=t??!0:(t=t??(C.isObject(e)&&!C.isEmpty(e)),e=new Vt(e)),e.value||t||(e=null)),e||(t?new Vt:null)}static normalize(e,t="string"){const n=typeof(e=e||""),r="array"===t,i=!r&&!("object"===t);let s,o,a,l="string"===n;var d;"object"===n&&(e.nodeType===Element.ELEMENT_NODE&&"function"==typeof e.getAttribute?(e=e.getAttribute("class")||"",l=!0):null!==(d=e)&&void 0!==d&&d.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter((t=>e.get(t))):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=C.getTruthyKeys(e)));for(l&&(e=N.split(e)),o=e.length;o-- >0;)s=e[o],s.length?s.includes(" ")&&e.splice(o,1,...N.split(s)):e.splice(o,1);if(e=[...new Set(e)],r)a=e;else if(i)a=e.join(" ");else for(a=Object.create(null),o=0;o<e.length;++o)a[e[o]]=!0;return a}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new Vt(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=Vt.normalize(e,"array"),n=t.length;if(this.length===n){for(let e=0;e<n;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){let e,t=this[_t];return null==t&&(e=C.getTruthyKeys(this),this[Ht]=e.length,this[_t]=t=e.join(" ")),t}set value(e){const t=this,n=Object.keys(t),r=n.length;for(let e=0;e<r;e++)delete t[n[e]];e?t.process(1,[e]):delete t[_t]}get values(){return C.getTruthyKeys(this)}get length(){return this.value?this[Ht]:0}process(e,t){for(let n,r,i=0;i<t.length;i++)if(t[i])if(n=t[i],n.isDomClassList||C.isObject(n))for(r in n)this[r]=e?n[r]:!n[r];else for(n=Vt.normalize(t[i],"array"),r=0;r<n.length;++r)this[n[r]]=e;return delete this[_t],this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[_t]);return this}assignTo(e){const t=e.nodeType===Element.ELEMENT_NODE?e.classList:e,n=Vt.from(t);n.add(this),t.value=n.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,t=Boolean(!this[e])){if(t=Boolean(t),Boolean(this[e])!==t)return this[e]=t,delete this[_t],!0}split(){return C.getTruthyKeys(this)}forEach(e){return C.getTruthyKeys(this).forEach(e)}}Vt.prototype[_t]=null,Vt._$name="DomClassList";const Nt=["clientX","clientY","pageX","pageY","screenX","screenY"],Bt={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1,raw:1,fromGlobal:1},zt={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},jt={Control:"ctrl",Alt:"alt",Shift:"shift",Meta:"meta"},Wt=/^(ctrl|shift|alt|meta)$/,Ut=["altKey","bubbles","button","buttons","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"],Gt=Object.fromEntries("abcdefghijklmnopqrstuvwxyz".split("").map((e=>[e,e.toUpperCase()]))),Yt=((...e)=>e.reduce(((e,t)=>{for(let n=0,r=e.length;n<r;++n)e.push(n?`${e[n]}+${t}`:t);return e}),[""]))("Ctrl","Alt","Meta","Shift"),qt=e=>Yt[(e.ctrlKey&&1)|(e.altKey&&2)|(e.metaKey&&4)|(e.shiftKey&&8)],{isSafari:Kt}=c,Xt=new WeakMap,Zt=e=>(null==e?void 0:e.nodeType)===Element.TEXT_NODE?e.parentElement:e;class Jt{static $name="EventHelper";static eventNameMap={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseenter:"MouseEnter",mouseleave:"MouseLeave",mousemove:"MouseMove",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"};static normalizeEvent(e){return W.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],Nt)}static copyEvent(e,t){return W.copyProperties(e,t,Ut)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t,n){const r=Qt.getXY(e),i=Qt.getXY(t),s=r[0]-i[0],o=r[1]-i[1];return null!=n&&n.x?s:null!=n&&n.y?o:Math.sqrt(Math.pow(s,2)+Math.pow(o,2))}static getPagePoint(e){return new $t(e.pageX,e.pageY)}static getClientPoint(e){return new $t(e.clientX,e.clientY)}static addListener(e,t,n,r){return r=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:n},r):Object.assign({element:e},t):e,Qt.on(r)}static on(e){const t=e.element,n=e.thisObj,r=[];for(const n in e)if(!Bt[n]){let i=e[n];"object"!=typeof i&&(i={handler:i});const s=i.element||t;r.push(Qt.addElementListener(s,n,i,e))}const i=()=>{for(let e,t=0;t<r.length;t++)e=r[t],Qt.removeEventListener(e[0],e[1],e[2]);r.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=ee.createInterceptor(n.doDestroy,i,n)),i}static addElementListener(e,t,n,r){const i=Qt.createHandler(e,t,n,r),{spec:s}=i,o=n.expires||r.expires,a=null!=s.capture||null!=s.passive?{capture:s.capture,passive:s.passive}:void 0;if(e.addEventListener(t,i,a),o){const s=n.thisObj||r.thisObj,a=null!=s&&s.isDelayable?s:globalThis,{alt:l}=o,d=l?o.delay:o,{spec:c}=i;c.expires=o,c.timerId=a["number"==typeof d?"setTimeout":"requestAnimationFrame"]((()=>{c.timerId=null,Qt.removeEventListener(e,t,i),l&&!i.called&&("string"==typeof l?s[l]:l).call(s)}),d,`listener-timer-${performance.now()}`)}return[e,t,i,a]}static getComposedPathTarget(e){var t;return e.composedPath()[0]||(null===(t=e.path)||void 0===t?void 0:t[0])}static fixEvent(e,t){var n;if(e.isBryntumEvent)return e;if(Xt.has(e))return Xt.get(e);const{ctrlKey:r,metaKey:i,type:s,target:o}=e,a=this.getComposedPathTarget(e),l="open"===(null==a||null===(n=a.getRootNode)||void 0===n||null===(n=n.call(a))||void 0===n?void 0:n.mode),d={set(e,t,n){var r;return t in e&&null!==(r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),"type"))&&void 0!==r&&r.set?Reflect.set(e,t,n):(d[t]=n,!0)},get(e,t){if(W.hasOwn(d,t))return d[t];switch(t){case"fixed":case"isBryntumEvent":return!0;case"key":return zt[e.key]||e.key;case"code":return" "!==e.key||e.code?e.code:"Space";case"ctrlKey":return c.isMac&&i!==r?i:r;case"metaKey":return c.isMac&&i!==r?r:i;case"virtualKey":return(e=>{const t=[qt(e)],{code:n,key:r}=e;return t[t[0]?1:0]=null!=n&&n.includes("Numpad")?n:Gt[r]||r,t.join("+")})(u);case"virtualModKeys":return qt(u);case"borderOffsetX":return isNaN(e.offsetX)?void 0:e.offsetX+(Kt?0:parseInt(o.ownerDocument.defaultView.getComputedStyle(Zt(o)).getPropertyValue("border-left-width")));case"borderOffsetY":return isNaN(e.offsetY)?void 0:e.offsetY+(Kt?0:parseInt(o.ownerDocument.defaultView.getComputedStyle(Zt(o)).getPropertyValue("border-top-width")));case"target":return l?a:Zt(e.target);case"relatedTarget":return Zt(e.relatedTarget);case"originalTarget":return o;case"deepTarget":return a;case"currentTarget":return d.delegatedTarget||e.currentTarget;case"browserEvent":return e;default:if(t in d)return d[t];{const n=Reflect.get(e,t);return"function"==typeof n?n.bind(e):n}}},has:(e,t)=>t in e||t in d},u=new Proxy(e,d);if(Xt.set(e,u),s.startsWith("touch")&&this.normalizeEvent(u),!t)switch(s){case"keydown":ir.currentKeyDown=u;break;case"mousedown":ir.currentMouseDown=u;break;case"pointerdown":ir.currentPointerDown=u;break;case"touchstart":ir.currentTouch=u}return u}static createHandler(e,t,n,r){const i=n.delay||r.delay,s=n.throttled||r.throttled,o=n.block||r.block,a="once"in n?n.once:r.once,l="capture"in n?n.capture:r.capture,d="passive"in n?n.passive:r.passive,c="delegate"in n?n.delegate:r.delegate,u="fromGlobal"in n?n.fromGlobal:r.fromGlobal,h=n.handler,g=n.expires,m=n.thisObj||r.thisObj;let p=(e,...t)=>{Qt.playingDemo&&e.isTrusted||null!=m&&m.isDestroyed||(p.called=!0,("string"==typeof h?m[h]:h).call(m,Qt.fixEvent(e,u),...t))};if(o){const e=p;let t,n;p=(r,...i)=>{const s=performance.now();(!t||r.target!==n||s-t>o)&&(n=r.target,t=s,e(r,...i))}}if(null!=i){const e=p,t=null!=m&&m.setTimeout?m:globalThis;p=(...n)=>{t.setTimeout((()=>{e(...n)}),i)}}if(null!=s){let e,t=s;s.buffer&&(e=e=>s.alt.call(Qt,Qt.fixEvent(e,u)),t=s.buffer),p=null!=m&&m.isDelayable?m.throttle(p,{delay:t,throttled:e}):ee.createThrottled(p,t,m,null,e)}if(a){const n=p;p=(...r)=>{Qt.removeEventListener(e,t,p),n(...r)}}if(c){const e=p;p=(t,...n)=>{var r,i;const s=null===(r=(i=(t=Qt.fixEvent(t,u)).target).closest)||void 0===r?void 0:r.call(i,c);s&&(t.delegatedTarget=s,e(t,...n))}}return n.thisObj&&!1!==n.autoDetach&&(m.doDestroy=ee.createInterceptor(m.doDestroy,(()=>Qt.removeEventListener(e,t,p)),m)),p.spec={delay:i,throttled:s,block:o,once:a,thisObj:m,capture:l,expires:g,passive:d,delegate:c},p}static removeEventListener(e,t,n){const{expires:r,timerId:i,thisObj:s,capture:o}=n.spec;if(null!=r&&r.alt&&i){(null!=s&&s.isDelayable?s:globalThis)["number"==typeof r.delay?"clearTimeout":"cancelAnimationFrame"](i)}e.removeEventListener(t,n,o)}static onTransitionEnd({element:e,animationName:t,property:n,handler:r,mode:i=(t?"animation":"transition"),duration:s=Yn[`get${"transition"===i?"Property":""}${N.capitalize(i)}Duration`](e,n),timeout:o,thisObj:a=globalThis,args:l=[],timerSource:d,runOnDestroy:c}){let u,h;d=d||(a.isDelayable?a:globalThis);const{isDelayable:g}=d,m=performance.now(),p=`transitionTimer${m}`,f=`timeoutTimer${m}`,v=[e,n,...l],y=()=>{var e;(b(),a.isDestroyed)||(null!==(e=a.$meta)&&void 0!==e&&e.class.isBase?a.callback(r,a,v):r.apply(a,v))},b=Qt.on({element:e,[`${i}end`]({animationName:r,propertyName:i,target:s}){if(s===e&&(i===n||null!=r&&r.match(t))){if(u){var o,a,l,c;if(h)null===(l=(c=d).clearTimeout)||void 0===l||l.call(c,g?f:h);null===(o=(a=d).clearTimeout)||void 0===o||o.call(a,g?p:u),u=null}y()}}});return o&&(h=d.setTimeout(y,Math.max(o,(s||0)+100),f)),null!=s&&(u=d.setTimeout(y,s+50,p,c)),b}static async waitForTransitionEnd(e){return new Promise((t=>{e.handler=t,Jt.onTransitionEnd(e)}))}static createDblClickWrapper(e,t,n){let r,i,s;return()=>{i||(i=Qt.on({element:e,touchstart:e=>{r=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===r){e.preventDefault(),clearTimeout(s),r=i=null;const o=Ot.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-o.x,l=e.changedTouches[0].pageY-o.y,d=Object.assign({browserEvent:e},e),c=new MouseEvent("dblclick",d);Object.defineProperties(c,{target:{value:e.target},offsetX:{value:a},offsetY:{value:l}}),"string"==typeof t&&(t=n[t]),t.call(n,c)}},once:!0}),s=setTimeout((()=>{i(),r=i=null}),Qt.dblClickTime))}}static toSpecialKey(e,t="ctrlKey"){let n=!1;return!0===e?n=t:"string"==typeof e&&(e=e.toLowerCase()).match(Wt)&&(n=`${e}Key`),n}static specialKeyFromEventKey(e){return jt[e]||"no-special-key"}}l.register(Jt);const Qt=Jt;Qt.longPressTime=700,Qt.dblClickTime=300,c.isTouchDevice&&Qt.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),Jt._$name="EventHelper";const en={align:"t0-t0"},tn=Node.ELEMENT_NODE,nn=Node.TEXT_NODE,rn={text:1,password:1,date:1,search:1,email:1,number:1,time:1,"datetime-local":1,tel:1,url:1,month:1,week:1},{isObject:sn}=W,on=/[+-]?\d*\.?\d+[eE]?-?\d*/g,an=on.source,ln=new RegExp(`matrix\\((?:${an}),\\s?(?:${an}),\\s?(?:${an}),\\s?(?:${an}),\\s?(${an}),\\s?(${an})`),dn=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),cn=new RegExp(`(?:${ln.source})|(?:${dn.source})`),un=new RegExp(`translate(3d|X)?\\((${an})px(?:,\\s?(${an})px)?`),hn=new RegExp(`translate(3d|Y)?\\((${an})px(?:,\\s?(${an})px)?`),gn=/\s+/,mn=/\s*;\s*/,pn=/\s*:\s*/,fn=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,vn={},yn={elementData:"",for:"htmlFor",retainElement:""},bn={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},Cn=[["f","focusable"],["n","natural"],["p","programmatic"],["t","tabbable"]],wn={length:1,parentRule:1,style:1},Sn={INPUT:1,TEXTAREA:1},Dn={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},En=globalThis,xn=document,Rn=Object.freeze({}),Tn=Array.prototype.slice,Mn=Promise.resolve(),kn=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],Fn=e=>e._hidden,In=(e,t,n)=>"children"===n.key?W.mergeItems(e,t,n):W.blend(e,t,n),An=(e,t)=>{if(e.isConnected){const n=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==n.getPropertyValue("display")&&(t||"hidden"!==n.getPropertyValue("visibility"))}},Ln=e=>e&&e.isConnected&&(e===xn.body||Boolean(e.offsetParent)||(e.ownerDocument.defaultView&&"offsetParent"in e&&"fixed"!==Yn.getStyleValue(e,"position")?e.offsetParent:Ln(e.parentNode))),Pn=e=>e instanceof Node?e:"string"==typeof e?qn.createElementFromTemplate(e):qn.createElement(e),On=Object.create(null),$n=(e,t)=>{const n=On[e]||[N.hyphenate(e),t];return On[e]||(On[n[0]]=On[e]=n),n},_n=/b-slide-in-from-\w+/,Hn=(e,t)=>{if(e){const n=(e.ownerSVGElement||e)[t&&"static"!==Yn.getStyleValue(e,"position")?"offsetParent":"parentNode"]||Hn(e.target,t);return(null==n?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?n.host:n}},Vn=e=>(null==e?void 0:e.nodeType)===Node.ELEMENT_NODE,Nn=(e=xn)=>{var t;return(null===(t=e.getAnimations())||void 0===t?void 0:t.reduce(((e,{effect:t,playState:n})=>("running"===n&&t.getTiming().iterations!==1/0&&e.push(t.target),e)),[]))||[]};["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","insetBlockEnd","insetBlockStart","insetInlineEnd","insetInlineStart","marginTop","marginRight","marginBottom","marginLeft","marginInlineStart","marginInlineEnd","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing","insetInlineStart","insetBlockStart","insetInlineEnd","insetBlockEnd"].forEach((e=>$n(e,!0)));let Bn,zn,jn,Wn=null,Un=0,Gn=null;class Yn{static _usingKeyboard=!1;static enableKeyboardCssModifiers=!0;static get devicePixelRatio(){let e=globalThis.devicePixelRatio;if(null==e){const t=.05,n=.5,r=e=>`(-webkit-min-device-pixel-ratio: ${e}),\n                (min--moz-device-pixel-ratio: ${e}),\n                (min-resolution: ${e}dppx)`;for(let i=100*5;i>=100*n;i-=100*t)if(globalThis.matchMedia(r(i/100)).matches){e=i/100;break}}return e}static get usingKeyboard(){return qn._usingKeyboard}static set usingKeyboard(e){return qn._usingKeyboard=e}static setUsingKeyboard(e,t){qn.setFocusRendition(e,t),qn._usingKeyboard=t}static setFocusRendition(e,t){var n;qn.enableKeyboardCssModifiers&&(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?t?Array.from(e.children).forEach((e=>{var t;return(null===(t=e.matches)||void 0===t?void 0:t.call(e,".b-outer"))&&e.classList.add("b-using-keyboard")})):qn.removeClsGlobally(e,"b-using-keyboard"):null===(n=e.classList)||void 0===n||n.toggle("b-using-keyboard",t))}static $name="DomHelper";static findParent(e,t,n){return this.closest(null==e?void 0:e.parentNode,t,n)}static closest(e,t,n){if(e&&e!==n)return t(e)?e:this.closest(e.parentNode,t,n)}static async slideIn(e,t=1){const n="b-slide-in-"+(t>0?"next":"previous"),{classList:r,parentNode:{classList:i}}=e;i.add("b-sliding-child-element"),r.add(n),await Jt.waitForTransitionEnd({element:e,animationName:_n}),r.remove(n),i.remove("b-sliding-child-element")}static getFocusability(e){let t="";if(e&&!e.hasAttribute("inert")){const{nodeName:n}=e,r=e.getAttribute("tabIndex");t=Dn[n]||("A"===n||"LINK"===n)&&e.href||"true"===e.contentEditable?"n":"","-1"===r?t+="fp":(t||null!=r)&&(t+="ft")}return vn[t]||(vn[t]=(n=t,Object.freeze(Object.fromEntries(Cn.map((([e,t])=>[t,n.includes(e)]))))));var n}static isFocusable(e,t){return!(e&&!t&&(!qn.isVisible(e)||qn.Widget.fromElement(e,Fn)))&&qn.getFocusability(e).focusable}static isEditable(e,t){return Boolean((e.isContentEditable||Sn[e.nodeName])&&(!t||"INPUT"!==e.nodeName||rn[e.type.toLowerCase()])&&!(e.readOnly||e.disabled||e.closest("[inert]")))}static isTextualInput(e){return Sn[e.nodeName]&&("INPUT"!==e.nodeName||rn[e.type.toLowerCase()])}static isInView(e,t=!1,n){if(!e||!Ln(Vn(e.target)?e.target:e))return!1;const r=(null==n?void 0:n.positioned)&&"fixed"!==Yn.getStyleValue(n.element,"position"),i=Ot.from(globalThis),s=t?"contains":"intersect",o=r&&n.element.offsetParent,a=r&&Ot.from(o);if(i.height=xn.scrollingElement.scrollHeight,e===xn.body)return i;const l=this.getViewportIntersection(e,i,s);return l&&r&&l.translate(xn.scrollingElement.scrollLeft,xn.scrollingElement.scrollTop),r&&l?l.translate(-a.x+o.scrollLeft,-a.y+o.scrollTop):l}static getViewportIntersection(e,t,n){var r;const i=Vn(e.target)?e.target:null,s=i||e,o=Yn.getVisibleViewport(Hn(s,1),t,s),a=Ot.from(s,null,!0);return i&&(a.translate(e.offsetX+1,e.offsetY+1),a.height=a.width=0),null==o||null===(r=o[n])||void 0===r?void 0:r.call(o,a,!1,!0)}static getVisibleViewport(e,t,n){const{fullscreenElement:r}=xn;let i,s,o,a,l,d=t;for(l=e;!s&&l&&l!==xn.body;l=Hn(l,1))if((i=s=l===r)||(a=l.ownerDocument.defaultView.getComputedStyle(l),i=("visible"!==a.overflowX||"visible"!==a.overflowY)&&"contents"!==a.display),i){var c;const e=Ot.client(l,null,!0,!1,n,!1);if(!e.height||!e.width)return!1;d=(null===(c=d)||void 0===c?void 0:c.intersect(e))||e,o=l}return o&&(d=Ot.clipStickies(d,o,null,!0,n)),d}static isVisible(e){let t=!1;for(;e;e=Hn(e)){if(e.nodeType===Element.DOCUMENT_NODE)return!0;if(e.nodeType===Element.ELEMENT_NODE){var n;const r=null===(n=e.ownerDocument)||void 0===n?void 0:n.defaultView.getComputedStyle(e);if(t=t||"visible"===r.getPropertyValue("visibility"),Vn(e)&&!An(e,t))return!1}}return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return W.blend(e,t,{merge:In})}static normalizeChildren(e,t,n){var r;let i,s,o,a,l,d=null==e?void 0:e.children;if(null!=e&&null!==(r=e.syncOptions)&&void 0!==r&&r.ignoreRefs&&(n=!0),d&&!(e instanceof Node))if(Array.isArray(d))for(s=0;s<d.length;++s)qn.normalizeChildren(d[s],t,n);else for(o in a=d,e.children=d=[],a){var c;i=a[o],null!==(c=i)&&void 0!==c&&c.isWidget&&(i=i.element),l=!o.startsWith("$")&&!qn.isElement(i),l&&(null==t||t(o,!n)),i&&(i instanceof Node||(!1===i.reference?delete i.reference:l&&"string"!=typeof i&&(i.reference=o),qn.normalizeChildren(i,t,n)),d.push(i))}return e}static roundPx(e,t=globalThis.devicePixelRatio||1){const n=1/t;return Math.round(e/n)*n}static floorPx(e,t=globalThis.devicePixelRatio||1){const n=1/t;return Math.floor(e*n)/n}static isCustomElement(e){return Boolean(null==e?void 0:e.shadowRoot)}static elementFromPoint(e,t){let n=document.elementFromPoint(e,t);return qn.isCustomElement(n)&&(n=n.shadowRoot.elementFromPoint(e,t)||n),n}static childFromPoint(e,t,n,r=e){const i=null==n?t:new Ot(t,n,0,0);let s=null;return Array.from(e.children).reverse().some((e=>{if(Ot.from(e,r).contains(i))return s=e.children.length&&qn.childFromPoint(e,i,null,r)||e,!0})),s}static unitize(e,t,n="px"){const[r,i]=$n(e);return null!=t&&(t=String(t),t=i&&fn.test(t)?t+n:t),[r,t]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){var t,n;null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element);let r=((null===(n=e)||void 0===n?void 0:n.getRootNode())||document).activeElement;for(;null!==(i=r)&&void 0!==i&&i.shadowRoot;){var i;r=r.shadowRoot.activeElement}return r}static getRootElement(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e),{nodeType:r}=n;return r===Node.DOCUMENT_NODE?n.body:r===Node.DOCUMENT_FRAGMENT_NODE?n:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var t,n;const r=null===(t=(n=e).getRootNode)||void 0===t?void 0:t.call(n);if(null!=r&&r.body)return null==r?void 0:r.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){var t;return"BODY"===(null===(t=e.tagName)||void 0===t?void 0:t.toUpperCase())||e.getRootNode().nodeType===Node.DOCUMENT_FRAGMENT_NODE}static getId(e){return e.id||(e.id="b-element-"+ ++Un)}static getCommonAncestor(e,t){if(e===t)return e;for(;e&&!(null!==(n=(r=e)[e.isWidget?"owns":"contains"])&&void 0!==n&&n.call(r,t)||e===t);){var n,r,i;e=Vn(e)?Hn(e):null!==(i=e.owner)&&void 0!==i&&i.isWidget&&e.owner!==e?e.owner:null}return e}static waitForSelector(e,t=5e3,n=100){if(null!=e){var r;const i=null===(r=e.endsWith)||void 0===r?void 0:r.call(e,"?"),s=e.nodeType?e:document.querySelector(i?e.substring(0,e.length-1):e);if(i){if(!s)return;t>0&&(t=-t)}return s&&Yn.isVisible(s)&&!Nn().some((e=>e.contains(s)))&&Yn.isInView(s,!1)?s:dt.waitFor((()=>{const t=s||document.querySelector(e);if(t&&Yn.isVisible(t)&&!Nn().some((e=>e.contains(t)))&&Yn.isInView(t,!1))return t}),t,n)}}static getElement(e){return"string"==typeof e?xn.querySelector(e):e}static setAttributes(e,t){const n=qn.getElement(e);if(n&&t)for(const e in t)null==t[e]?n.removeAttribute(e):n.setAttribute(e,t[e])}static toggleAttribute(e,t,n){const r=qn.getElement(e);r&&(r.toggleAttribute?r.toggleAttribute(t,n):null!=n?r[n?"setAttribute":"removeAttribute"](t,""):r.hasAttribute(t)?r.removeAttribute(t):r.setAttribute(t,""))}static addAttributeValue(e,t,n){const r=qn.getElement(e);var i;r&&n&&r.setAttribute(t,[...new Set(null===(i=r.getAttribute(t))||void 0===i?void 0:i.split(" ")).add(n)].join(" "))}static removeAttributeValue(e,t,n){const r=qn.getElement(e);if(r&&n){var i;const e=new Set(null===(i=r.getAttribute(t))||void 0===i?void 0:i.split(" "));e.delete(n),e.size?r.setAttribute(t,[...e].join(" ")):r.removeAttribute(t)}}static setLength(e,t,n){return n=1===arguments.length?"number"==typeof e?`${e}px`:e??"":(e=qn.getElement(e)).style[t]="number"==typeof n?`${n}px`:n??""}static percentify(e,t=2){const n=Math.pow(10,t);return null==e||""===e||isNaN(e)?"":Math.round(e*n)/n+"%"}static getChild(e,t){return e.querySelector(":scope>"+t)}static hasChild(e,t){return null!=qn.getChild(e,t)}static children(e,t){return(">"===t[0]||t.startsWith("# "))&&("#"===t[0]&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){var n;return e?null!==(n=e.matches)&&void 0!==n&&n.call(e,t)?e:(t=":scope "+t,e.querySelector(t)):null}static isDescendant(e,t){const n=e.contains(t);if(!n&&t){const n=qn.getRootElement(e),r=qn.getRootElement(t);if(r&&n!==r&&r.host)return qn.isDescendant(n,r.host)}return n}static getEventElement(e,t="target"){return!e||qn.isElement(e)?e:e[t]}static isElement(e){return(null==e?void 0:e.nodeType)===document.ELEMENT_NODE&&qn.isNode(e)}static isReactElement(e){var t;return Boolean(null===(t=globalThis.bryntum)||void 0===t||null===(t=t.react)||void 0===t?void 0:t.isReactElement(e))}static handleReactElement(e,t){var n;return Boolean(null===(n=globalThis.bryntum)||void 0===n||null===(n=n.react)||void 0===n?void 0:n.handleReactElement(e,t))}static handleReactHeaderElement(e,t,n){var r;return Boolean(null===(r=globalThis.bryntum)||void 0===r||null===(r=r.react)||void 0===r?void 0:r.handleReactHeaderElement(e,t,n))}static isVueConfig(e){var t;return Boolean(null===(t=globalThis.bryntum)||void 0===t||null===(t=t.vue)||void 0===t?void 0:t.isVueConfig(e))}static handleVueContent(e,t){var n;null===(n=globalThis.bryntum)||void 0===n||null===(n=n.vue)||void 0===n||n.handleVueContent(e,t)}static isNode(e){return Boolean(e)&&"number"==typeof e.nodeType&&!sn(e)}static forEachSelector(e,t,n){if("string"==typeof e)throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");qn.children(e,t).forEach(n)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){qn.forEachSelector(e,t,(e=>e.remove()))}static removeClsGlobally(e,...t){t.forEach((t=>qn.forEachSelector(e,"."+t,(e=>e.classList.remove(t)))))}static getAncestor(e,t,n=null){let r,i=!1,s=e;for(t=nt.asArray(t);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(n&&s===n)break;r=s}return i?r||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return N.makeValidDomId(e,t)}static createElement(e={},t){var n,r,i;let s,o,a,l,d,c,u,h,g,m,p,f=t;if("boolean"==typeof f)throw new Error("Clean up");t&&(d=t.ignoreRefs,g=t.refOwner,m=t.refs,f=t.returnAll,p=t.syncIdField,d&&(a=!0,d="children"!==d)),"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent));const v=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:y,html:b,reference:C,syncOptions:w,text:S}=e;if(w&&(p=w.syncIdField||p,l=w.ignoreRefs,l&&(a=!0,d="children"!==l,t={...t,ignoreRefs:!0})),d&&(g=null),s=e.ns?xn.createElementNS(e.ns,e.tag||"svg"):xn.createElement(e.tag||"div"),null!=S?qn.setInnerText(s,S):null!=b&&(b instanceof DocumentFragment?s.appendChild(b):s.innerHTML=b),e.tooltip&&qn.Widget.attachTooltip(s,e.tooltip),e.style&&qn.applyStyle(s,e.style),y)for(u in y)h=y[u],null!=h&&(s.dataset[u]=h);v&&this.addChild(v,s,e.nextSibling),g&&(s.$refOwnerId=g.id),C&&!d&&(g?(s.$reference=C,g.attachRef(C,s,e)):(m||((t=Object.assign({},t)).refs=m={}),m[C]=s,s.setAttribute("data-reference",C)));const D=e.className||e.class,E=Object.keys(e);for(D&&s.setAttribute("class",Vt.normalize(D)),o=0;o<E.length;++o)u=E[o],h=e[u],null!=(c=yn[u])?s[c||u]=h:!bn[u]&&u&&null!=h&&s.setAttribute(u,h);e["aria-hidden"]||"role"in e||e.tabIndex||e.alt||Yn.isFocusable(s,!0)||s.htmlFor||s.setAttribute("role","presentation"),null===(n=t)||void 0===n||null===(r=n.callback)||void 0===r||r.call(n,{action:"newElement",domConfig:e,targetElement:s,syncId:g?C:t.syncIdField&&(null===(i=e.dataset)||void 0===i?void 0:i[t.syncIdField])}),!0===f?t.returnAll=f=[s]:Array.isArray(f)&&f.push(s),e.children&&(p&&(s.syncIdMap={}),nt.asArray(e.children).forEach((n=>{if(n)if("string"==typeof n){const e=document.createTextNode(n);g&&(e.$refOwnerId=g.id),s.appendChild(e)}else if(this.isReactElement(n)){var r,i;null===(r=t)||void 0===r||null===(i=r.reactCallback)||void 0===i||i.call(r,{jsx:n,domConfig:e,targetElement:s})}else if(isNaN(n.nodeType)){var o,l;n.parent=s,!n.ns&&e.ns&&(n.ns=e.ns);const r=qn.createElement(n,{...t,ignoreRefs:(null===(o=e.syncOptions)||void 0===o?void 0:o.ignoreRef)??a}),i=null===(l=n.dataset)||void 0===l?void 0:l[p];null!=i&&(s.syncIdMap[i]=r),delete n.parent}else s.appendChild(n)}))),s.lastDomConfig=e;const x=m||f||s;return e.replaceElement&&e.replaceElement.replaceWith(x),x}static createElementFromTemplate(e,t=Rn){const{array:n,raw:r,fragment:i}=t;let s;if(qn.supportsTemplate){if((Bn||(Bn=xn.createElement("template"))).innerHTML=e,s=Bn.content,i)return s.cloneNode(!0)}else if(s=(zn||(zn=new DOMParser)).parseFromString(e,"text/html").body,i){const e=s.childNodes;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}return s=r?s.childNodes:s.children,1!==s.length||n?Tn.call(s):s[0]}static triggerMouseEvent(e,t="contextmenu",n={}){const r=this.isInView(e),i=null==r?void 0:r.center;if(r){const s=new MouseEvent(t,{clientX:i.x,clientY:i.y,offsetX:r.width/2,offsetY:r.height/2,bubbles:!0,...n});return e.dispatchEvent(s),s}}static insertFirst(e,t){return t&&t.nodeType!==tn&&t.tag&&(t=qn.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,n){return t&&t.nodeType!==tn&&t.tag&&(t=qn.createElement(t)),n?e.insertBefore(t,n):qn.insertFirst(e,t)}static insertAt(e,t,n){const r=Array.from(e.children);if(n>=r.length)return qn.append(e,t);const i=r[n];return qn.insertBefore(e,t,i)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((e=>Pn(e)))),e.append)e.append(...t);else{const n=document.createDocumentFragment();t.forEach((function(e){n.appendChild(e)})),e.appendChild(n)}return t}return e.appendChild(Pn(t))}static getTranslateX(e){const t=e.style.transform;let n=un.exec(t);return n?parseFloat(n[2]):(n=cn.exec(t)||cn.exec(qn.getStyleValue(e,"transform")),n?parseFloat(n[1]||n[3]):0)}static getTranslateY(e){const t=e.style.transform;let n=hn.exec(t);if(n){const e=parseFloat(n["Y"===n[1]?2:3]);return isNaN(e)?0:e}return n=cn.exec(t)||cn.exec(qn.getStyleValue(e,"transform")),n?parseFloat(n[2]||n[4]):0}static getTranslateXY(e){return[qn.getTranslateX(e),qn.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[qn.getOffsetX(e,t),qn.getOffsetY(e,t)]}static getPageX(e){return e.getBoundingClientRect().left+En.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+En.pageYOffset}static getExtremalSizePX(e,t){const n=N.hyphenate(t),r=n.split("-")[1];let i=qn.getStyleValue(e,n);return i=/%/.test(i)?e.parentElement?parseInt(qn.getStyleValue(e.parentElement,r),10):NaN:parseInt(i,10),i}static setScale(e,t,n=t){const r=qn.getStyleValue(e,"transform").split(/,\s*/);r.length>1?(r[0].startsWith("matrix3d")?(r[0]=`matrix3d(${t}`,r[5]=n):(r[0]=`matrix(${t}`,r[3]=n),e.style.transform=r.join(",")):e.style.transform=`scale(${t}, ${n})`}static setTranslateX(e,t){const n=qn.getStyleValue(e,"transform").split(/,\s*/);t=qn.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?12:4]=t,e.style.transform=n.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const n=qn.getStyleValue(e,"transform").split(/,\s*/);t=qn.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?13:5]=t,e.style.transform=n.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){qn.setLength(e,"top",t)}static setLeft(e,t){qn.setLength(e,"left",t)}static setTopLeft(e,t,n){qn.setLength(e,"top",t),qn.setLength(e,"left",n)}static setTopInsetInlineStart(e,t,n){qn.setLength(e,"top",t),qn.setLength(e,"inset-inline-start",n)}static setRect(e,{x:t,y:n,width:r,height:i}){qn.setTopInsetInlineStart(e,n,t),qn.setLength(e,"width",r),qn.setLength(e,"height",i)}static setTranslateXY(e,t,n){if(null==t)return qn.setTranslateY(e,n);if(null==n)return qn.setTranslateX(e,t);t=qn.roundPx(t),n=qn.roundPx(n);const r=qn.getStyleValue(e,"transform").split(/,\s*/),i=r[0].startsWith("matrix3d");r.length>1?(r[i?12:4]=t,r[i?13:5]=n,e.style.transform=r.join(",")+")"):e.style.transform=`translate(${t}px, ${n}px)`}static addTranslateX(e,t){qn.setTranslateX(e,qn.getTranslateX(e)+t)}static addTranslateY(e,t){qn.setTranslateY(e,qn.getTranslateY(e)+t)}static addLeft(e,t){qn.setLeft(e,qn.getOffsetX(e)+t)}static addTop(e,t){qn.setTop(e,qn.getOffsetY(e)+t)}static alignTo(e,t,n=en,r,i="translate"){t=t instanceof Ot?t:Ot.from(t,!0);const s=Ot.from(e,!0);r&&(s.roundPx(),t.roundPx());const o=s.alignTo(Object.assign(n,{target:t}));if("topInset"===i){const t=[parseInt(e.style.insetInlineStart||0,10),parseInt(e.style.top||0,10)];qn.setTopInsetInlineStart(e,t[1]+o.y-s.y,t[0]+o.x-s.x)}else if("topLeft"===i){const t=[parseInt(e.style.left||0,10),parseInt(e.style.top||0,10)];qn.setTopLeft(e,t[1]+o.y-s.y,t[0]+o.x-s.x)}else{const t=qn.getTranslateXY(e);qn.setTranslateXY(e,t[0]+o.x-s.x,t[1]+o.y-s.y)}}static getStyleValue(e,t,n,r){const i=n?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){const e={};for(const n of t)e[n]=i.getPropertyValue(N.hyphenate(n));return e}return i.getPropertyValue(N.hyphenate(t))}static getEdgeSize(e,t,n){const r="border"===t?"-width":"",i={raw:{}};for(const s of["top","right","bottom","left"])n&&!n.includes(s[0])||(i[s]=parseFloat(i.raw[s]=qn.getStyleValue(e,`${t}-${s}${r}`)));return i.width=(i.left||0)+(i.right||0),i.height=(i.top||0)+(i.bottom||0),i}static parseStyle(e){if("string"==typeof e){const t=e.split(mn);e={};for(let n=0,{length:r}=t;n<r;n++){const r=t[n].split(pn);e[r[0]]=r[1]}}return e||{}}static applyStyle(e,t,n=!1){if("string"==typeof t)n?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){let r,i;for(r in n&&(e.style.cssText=""),t.style&&"string"!=typeof t.style&&(t=W.assign({},t,t.style)),t)wn[r]||([r,i]=qn.unitize(r,t[r]),null==i?e.style.removeProperty(r):e.style.setProperty(r,i));"string"==typeof t.style&&(e.style.cssText+=t.style)}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const n in e)wn[n]||(t+=`${N.hyphenate(n)}:${e[n]};`);return t}static assignClasses(e,t){W.forEach(t,((t,n)=>e.classList.toggle(n,Boolean(t))))}static toggleClasses(e,t,n=null){t=nt.asArray(t),!0===n?e.classList.add(...t):!1===n?e.classList.remove(...t):t.forEach((t=>e.classList.toggle(t)))}static addTemporaryClass(e,t,n,r=globalThis,i=t){n>0&&(e.classList.add(t),r===globalThis?r.setTimeout((()=>null==e?void 0:e.classList.remove(t)),n):r.setTimeout({fn:t=>e.classList.remove(t),delay:n,name:i,args:[t],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,t){const n=globalThis.getComputedStyle(e),r=n.transitionProperty.split(", "),i=n.transitionDuration.split(", "),s=r.indexOf(N.hyphenate(t));let o;return-1!==s&&(o=1e3*parseFloat(i[s])),o}static getAnimationDuration(e){return 1e3*parseFloat(qn.getStyleValue(e,"animation-duration"))}static highlight(e,t=globalThis){return e instanceof Ot?e.highlight():new Promise((n=>{t.setTimeout((()=>{e.classList.add("b-fx-highlight"),t.setTimeout((()=>{e.classList.remove("b-fx-highlight"),n()}),2e3)}),0)}))}static get scrollBarWidth(){if(null===Wn){const e=jn||(jn=qn.createElement({parent:xn.documentElement,className:"b-scrollbar-measure-element",style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==xn.documentElement&&xn.documentElement.appendChild(e),Wn=e.offsetWidth,xn.documentElement.style.setProperty("--b-scrollbar-width",`${Wn}px`)}return Wn}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static get scrollLimit(){const e=Yn.createElement({parent:document.body,style:"position:absolute; left:-999px; top:0; width:5px; height:5px",children:[{style:"position:absolute; width:1px; height:1px"}]}),t=e.firstElementChild;let n=0,r=2e7;for(;r>1e6&&(t.style.transform=`translateY(${r}px)`,e.style.lineHeight=""+(n=1-n),!(e.scrollHeight>=r));)r-=1e6;return Object.defineProperty(Yn,"scrollLimit",{value:r}),e.remove(),r}static resetScrollBarWidth(){Wn=null}static measureText(e,t,n=!1,r=void 0){const i=qn.getMeasureElement(t,r);i[n?"innerHTML":"innerText"]=e;const s=i.clientWidth;return i.className="",s}static measureSize(e,t,n=!0){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){var r;const i=null===(r=e.includes)||void 0===r?void 0:r.call(e,"%"),s=qn.getMeasureElement(t,i?t.parentNode:void 0),{parentElement:o}=s;s.innerHTML="",i&&(o.style.display="contents"),s.style.minWidth=s.style.maxWidth=qn.setLength(e);const a=n?s.offsetWidth:s.getBoundingClientRect().width;return o.style.display="",s.style.minWidth=s.style.maxWidth=s.className="",a}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t){t=t||xn.body;const n=En.getComputedStyle(e),r=t.offScreenDiv=t.offScreenDiv||qn.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return kn.forEach((e=>{r.style[e]!==n[e]&&(r.style[e]=n[e])})),r.className=e.className,r.parentElement.parentElement!==t&&t.appendChild(r.parentElement),r}static stripTags(e){return(qn.$domParser||(qn.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=qn.createElementFromTemplate(e)}return qn.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(qn.syncAttributes(e,t),qn.syncContent(e,t),qn.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},n=[];for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r];if(i.specified){const e=i.name.toLowerCase();t[e]=i.value,n.push(e)}}return{attributes:t,names:n}}static syncAttributes(e,t){const{attributes:n,names:r}=qn.getSyncAttributes(e),{attributes:i,names:s}=qn.getSyncAttributes(t),o=r.includes("dataset"),a=r.filter((e=>!s.includes(e))),l=s.filter((e=>!(r.includes(e)||o&&e.startsWith("data-")))),d=r.filter((e=>s.includes(e)));if(a.length>0)for(let e=0;e<a.length;e++){const r=a[e];"style"===r?qn.applyStyle(t,n.style,!0):"dataset"===r?Object.assign(t.dataset,n.dataset):t.setAttribute(r,n[r])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(d.length>0)for(let e=0;e<d.length;e++){const r=d[e];if("style"===r)qn.applyStyle(t,n.style,!0);else if("dataset"===r)Object.assign(t.dataset,n.dataset);else if("class"!==r||!n.class.isDomClassList&&"object"!=typeof n.class)i[r]!==n[r]&&t.setAttribute(r,n[r]);else{let e;e=n.class.isDomClassList?n.class:new Vt(n.class),e.isEqual(i.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===qn.getChildElementCount(e)&&(t.innerText=e.innerText)}static setInnerText(e,t){const{firstChild:n}=e;(null==n?void 0:n.nodeType)===Element.TEXT_NODE?n.data=t:e.textContent=t}static syncChildren(e,t){const n=this,r=Tn.call(e.childNodes),i=Tn.call(t.childNodes);for(;r.length;){const e=r.shift(),s=i.shift();if(e&&e.nodeType!==nn&&e.nodeType!==tn)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(s&&s.nodeType!==nn&&s.nodeType!==tn)throw new Error(`Target node type ${s.nodeType} not supported by DomHelper.sync()`);if(s)if(e.nodeType===s.nodeType)e.nodeType===nn?s.data=e.data:e.tagName===s.tagName?n.performSync(e,s):(t.insertBefore(e,s),s.remove());else{if(e.nodeType!==nn||s.nodeType!==tn){const t=e.parentElement||e;throw new Error(`Currently no support for transforming nodeType.\n${t.outerHTML}`)}t.innerText=e.data.trim()}else t.appendChild(e)}i.forEach((e=>{e.remove()}))}static syncClassList(e,t){const{classList:n}=e,r="string"==typeof t,i=r?t.split(gn):Vt.normalize(t,"array"),s=i.length;let o,a=n.length!==s;for(o=0;!a&&o<s;o++)a=!n.contains(i[o]);return a&&(e.className=r?t:i.join(" ")),a}static updateClassList(e,t){const{classList:n}=e;let r,i,s=!1;for(r in t)i=Boolean(t[r]),n.contains(r)!==i&&(n[i?"add":"remove"](r),s=!0);return s}static setTheme(e,t){e=e.toLowerCase();const{head:n}=document,r=qn.getThemeInfo(t).name.toLowerCase();let i=n.querySelectorAll("[data-bryntum-theme]:not([data-loading])"),s=0;if(r===e)return Mn;qn.removeEachSelector(n,"#bryntum-theme[data-loading],link[data-bryntum-theme][data-loading]");const o={theme:e,prev:r};function a(t,n,a){const l=Yn.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,bryntumTheme:!0},href:t.href.replace(r,e),nextSibling:t});l.addEventListener("load",(()=>{delete l.dataset.loading,Gn=null,++s===i.length&&(i.forEach((e=>e.remove())),ir.trigger("theme",o),n(o))})),l.addEventListener("error",(e=>{delete l.dataset.loading,a(e)}))}if(i.length)return new Promise(((e,t)=>{i.forEach(((n,r)=>{a(n,e,t,i.length)}))}));{const e=n.querySelector("#bryntum-theme:not([data-loading])")||n.querySelector(`[href*="${r}.css"]:not([data-loading])`);if(null==e||!e.href.includes(`${r}.css`))throw new Error(`Theme link for ${r} not found`);return i=[e],new Promise(((t,n)=>a(e,t,n)))}}static get themeInfo(){return Yn.getThemeInfo()}static getThemeInfo(e){if(!Gn){const t=qn.createElement({parent:document.body,className:"b-theme-info"}),n=qn.getStyleValue(t,"content",!1,":before");if(n)try{Gn=JSON.parse(n.replace(/^["']|["']$|\\/g,""))}catch(e){Gn=null}Gn=Gn||(e?{name:e}:null),t.remove()}return Gn}static async transition({element:e,selector:t="[data-dom-transition]",duration:n,action:r,thisObj:i=this,addTransition:s={},removeTransition:o={}}){const a=new Set,l=!e.style.height,d=Array.from(e.querySelectorAll(t)),c=new Map(d.map((t=>{let n=0,r=t.parentElement;for(;r&&r!==e;)n++,r=r.parentElement;t.$depth=n,t.scrollHeight>t.offsetHeight&&"auto"===getComputedStyle(t).overflow&&(t.$scrollTop=t.scrollTop,a.add(t));const{parentElement:i}=t,s=Ot.from(t,e),o=Ot.from(t,i),l=getComputedStyle(i),d=parseFloat(l.borderLeftWidth);return d&&(s.left-=d,o.left-=d),[t.id,{element:t,globalBounds:s,localBounds:o,depth:n,parentElement:i}]})));l&&(e.style.height=e.offsetHeight+"px"),r.call(i);const u=Array.from(e.querySelectorAll(t)),h=new Map(u.map((t=>{const n=Ot.from(t,e),r=Ot.from(t,t.parentElement),i=globalThis.getComputedStyle(t.parentElement),s=parseFloat(i.borderLeftWidth);return s&&(n.left-=s,r.left-=s),[t.id,{element:t,globalBounds:n,localBounds:r}]}))),g=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];e.classList.add("b-dom-transition-snapshot");for(const[t,n]of c){const r=h.get(t);if(r){const{element:t}=r,{style:i,parentElement:s}=t,o=parseInt(qn.getStyleValue(t,"zIndex")),{globalBounds:l,localBounds:d,depth:c,parentElement:u}=n,h=u!==s;let m;W.copyProperties(t.$initial={parentElement:s},i,g),h?(r.bounds=r.globalBounds,m=l,e.appendChild(t)):(r.bounds=r.localBounds,m=d,u.appendChild(t));let p="hidden";a.has(t)&&(t.$scrollPlaceholder=qn.createElement({parent:t,style:{height:t.scrollHeight}}),p="auto");const f={position:"absolute",top:`${m.top}px`,left:`${m.left}px`,width:`${m.width}px`,height:`${m.height}px`,minWidth:0,minHeight:0,margin:0,zIndex:c+(o||0),overflow:p};"preserve-padding"!==t.dataset.domTransition&&(f.padding=0),Object.assign(i,f),r.processed=!0}else{const{element:e,localBounds:r,depth:i,parentElement:s}=n;e.$initial={removed:!0},Object.assign(e.style,{position:"absolute",top:`${r.top}px`,left:`${r.left}px`,width:`${r.width}px`,height:`${r.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:i,overflow:"hidden"}),s.appendChild(e),h.set(t,{element:e,bounds:r,removed:!0,processed:!0}),u.push(e)}}for(const[,e]of h)if(!e.processed){const{element:t}=e,{style:n,parentElement:r}=t,i=e.bounds=e.localBounds;t.classList.add("b-dom-transition-adding"),W.copyProperties(t.$initial={parentElement:r},n,g),Object.assign(n,{position:"absolute",top:s.top?0:`${i.top}px`,left:s.left?0:`${i.left}px`,width:s.width?0:`${i.width}px`,height:s.height?0:`${i.height}px`,opacity:s.opacity?0:null,zIndex:r.$depth+1,overflow:"hidden"})}for(const e of a)e.scrollTop=e.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:e,bounds:t,removed:n}]of h)n?Object.assign(e.style,{top:o.top?0:`${t.top}px`,left:o.left?0:`${t.left}px`,width:o.width?0:`${t.width}px`,height:o.height?0:`${t.height}px`,opacity:o.opacity?0:e.$initial.opacity}):Object.assign(e.style,{top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,opacity:e.$initial.opacity});await dt.sleep(n),e.classList.remove("b-dom-transition","b-dom-transition-snapshot");for(const e of u)e.$initial&&(e.$initial.removed?e.remove():(W.copyProperties(e.style,e.$initial,g),e.$scrollPlaceholder&&(e.$scrollPlaceholder.remove(),delete e.$scrollPlaceholder),e.classList.remove("b-dom-transition-adding"),e.$initial.parentElement.appendChild(e)));l&&(e.style.height="");for(const e of a)e.scrollTop=e.$scrollTop,delete e.$scrollTop}static async loadScript(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)}))}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb|lab|lch|oklab|oklch)/.test(e)}static createColorStyle(e){return null!=e&&e.length?this.isNamedColor(e)?`var(--cal-color-${e})`:e:""}static get NodeFilter(){return NodeFilter}static addChild(e,t,n){e.insertBefore(t,n)}static cloneStylesIntoShadowRoot(e,t){return new Promise(((n,r)=>{t&&e.querySelectorAll('style, link[rel="stylesheet"]').forEach((e=>e.remove()));const i=document.querySelectorAll('link[rel="stylesheet"]');let s=0;i.forEach((t=>{const o=t.cloneNode();o.addEventListener("load",(()=>{s+=1,s===i.length&&n()})),o.addEventListener("error",(e=>{r(o.href)})),e.appendChild(o)})),document.querySelectorAll("style").forEach((t=>{const n=t.cloneNode();n.innerHTML=t.innerHTML,e.appendChild(n)})),i.length||n()}))}}l.register(Yn);const qn=Yn;let Kn;const Xn=()=>qn.isTouchEvent=!1,Zn=()=>{qn.isTouchEvent=!0,clearTimeout(Kn),Kn=setTimeout(Xn,400)};xn.addEventListener("touchstart",Zn,!0),xn.addEventListener("touchend",Zn,!0),qn.canonicalStyles=On,qn.supportsTemplate="content"in xn.createElement("template"),qn.elementPropKey="$bryntum",qn.numberRe=on,Node.prototype.closest=function(e){var t;return null===(t=this.parentNode)||void 0===t?void 0:t.closest(e)},globalThis.addEventListener("resize",(()=>Wn=null)),Yn._$name="DomHelper";const Jn=new Map,Qn=e=>e.floating,er={touchend:1,pointerup:1},tr={Meta:1,Control:1,Alt:1,Shift:1},nr=e=>{var t;(null===(t=ur)||void 0===t?void 0:t.pointerId)===e.pointerId&&(ur=null)},rr=e=>{const{touches:t}=e;if(Jn.clear(),t)for(let n=0;n<t.length;n++){const r=t.item(n);Jn.set(r.identifier,[r,e])}},ir=new class extends(Qe.mixin(lt)){suspendFocusEvents(){mr=!0}resumeFocusEvents(){mr=!1}setupFocusListenersOnce(e,t){e&&!ir.observedElements.has(e)&&(ir.setupFocusListeners(e,t),ir.observedElements.add(e))}detachFocusListeners(e){e.$globalEventsDetacher&&(e.$globalEventsDetacher(),e.$globalEventsDetacher=null,ir.observedElements.delete(e))}setupFocusListeners(e=document,t,n=!1){var r;let i,s,o;const a={element:e,fromGlobal:!0,touchstart(e){const{touches:n}=e;if(rr(e),2===n.length&&n[0].target.closest(".b-widget")&&n[1].target.closest(".b-widget"))return i=[n[0],n[1]],s=[(i[0].clientX+i[1].clientX)/2,(i[0].clientY+i[1].clientY)/2],void(o=Yn.elementFromPoint(s[0],s[1]));if(or||1!==e.changedTouches.length)or=null;else if(or=e.changedTouches[0],!c.isAndroid){const n=({clientX:e,clientY:t,type:n})=>{(er[n]||!or||Math.max(Math.abs(e-or.clientX),Math.abs(t-or.clientY))>5)&&(ar=null,r(),clearTimeout(i))},r=t.on({element:document,touchmove:n,touchend:n,pointermove:n,pointerup:n,capture:!0}),i=setTimeout((()=>{ar=or.identifier,r(),e.target.dispatchEvent(new MouseEvent("contextmenu",t.copyEvent({},e)))}),t.longPressTime)}},touchmove:{passive:!1,handler:e=>{const{touches:n}=e;if(2===n.length&&i){const r=[n[0],n[1]],a=t.getDistanceBetween(i[0],i[1])-t.getDistanceBetween(r[0],r[1]),l=Math.abs(i[0].clientX-i[1].clientX)-Math.abs(r[0].clientX-r[1].clientX),d=Math.abs(i[0].clientY-i[1].clientY)-Math.abs(r[0].clientY-r[1].clientY);if(Math.abs(a)>2){const t={clientX:s[0],clientY:s[1],bubbles:!0};if(ir.Widget.convertPinchToMousewheel){e.preventDefault(),e.stopImmediatePropagation();const n=new MouseEvent("wheel",{...t,ctrlKey:!0});n.deltaY=d,n.deltaX=l,o.dispatchEvent(n)}const n=new MouseEvent("bryntum-pinch",t);n.deltaY=d,n.deltaX=l,n.touchMove=e,o.dispatchEvent(n)}i=r}}},touchend:{passive:!1,handler:e=>{rr(e),2!==e.touches.length&&(i=null),or&&(e.changedTouches[0].identifier===ar?(e.stopImmediatePropagation(),!1!==e.cancelable&&e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===or.identifier&&ir.trigger("globaltap",{event:e}),or=null)}},touchcancel:{passive:!1,handler:rr},mousedown:{handler:e=>{lr="mouse",or||ir.trigger("globaltap",{event:e}),cr=e;const t=e.ctrlKey||e.altKey||e.shiftKey||e.metaKey;!dr&&t?dr=new KeyboardEvent("keydown",{key:e.ctrlKey?"Control":e.shiftKey?"Shift":e.altKey?"Alt":"Meta",ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey}):dr&&!t&&(dr=null)},passive:!1},mouseup:{handler:e=>{ir.trigger("mouseup",{event:e}),cr=null},passive:!1},pointerdown:{passive:!1,handler:t=>{ur=t,Yn.setUsingKeyboard(e,!1)}},pointerup:{passive:!1,handler:nr},pointercancel:{passive:!1,handler:nr},keydown(t){const{key:n,target:r}=t;if(lr="key",dr=t,hr=r,!tr[n]){if(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(const t of e.children)t.matches(".b-outer")&&Yn.setUsingKeyboard(t,!0);else Yn.setUsingKeyboard(e,!0);"Escape"===n&&ir.Widget.queryAll((e=>e.isTooltip&&e.isVisible)).forEach((e=>e.hide()))}},mouseenter(e){hr=e.target},keypress(){lr="key"},keyup(){dr=null},focusin(e){const{Widget:t}=ir,{target:n}=e;if(null!=n&&n.shadowRoot||null!=n&&n._shadowRoot)return;if(c.supportsPointerEvents&&null!=n&&n.matches(":focus-visible")&&!bryntum.fromElement(n,(e=>e.isDestroying||e.isDestroyed))){const e=n.matches("[class*=event-wrap],[class*=task-wrap]")?n.firstElementChild:n,t=Ot.from(e).center;e.dispatchEvent(new PointerEvent("pointerover",{bubbles:!0,clientX:t.x,clientY:t.y,pointerType:"focus"}))}if(mr||n&&!n.isConnected)return;const r=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,i=n||document.body,s=t.fromElement(r),o=t.fromElement(i),a=Yn.getCommonAncestor(s,o),l=Boolean(r&&4&i.compareDocumentPosition(r)),d=t.query(sr);let u=null;if(u=i&&i!==document.body?Yn.getActiveElement(i):Yn.getActiveElement(document),d&&!d._isRevertingFocus&&(!o||!d.owns(o)&&!(4&d.element.compareDocumentPosition(o.element)&&o.up(Qn))))return d.focus();let h=pr("focusout",r,n,s,o,l);for(let e,t=s;t&&t!==a;t=e)if(e=t.owner,!t.isDestroying&&t.onFocusOut&&(t.onFocusOut(h),n&&u!==Yn.getActiveElement(n)))return;if(a&&n===a.element)!a.isDestroying&&Yn.getActiveElement(a)===i&&a.focusElement&&a.focusElement!==a.element&&(a.element.contains(u)&&!a.focusDescendant||a.setTimeout((()=>{var e;return null===(e=a.focus)||void 0===e?void 0:e.call(a)}),0));else{h=pr("focusin",i,r,s,o,l);for(let e=o;e&&e!==a;e=e.owner){var g,m;if(!e.isDestroying)null===(g=(m=e).onFocusIn)||void 0===g||g.call(m,h)}}const p=Yn.getCommonAncestor((null==r?void 0:r.nodeType)===Element.ELEMENT_NODE?r:null,i)||i.parentNode;p&&(h=pr("focusmove",i,r,s,o,l,{bubbles:!0}),p.dispatchEvent(h))},focusout(e){if(!(mr||e.relatedTarget&&ir.Widget.fromElement(e.relatedTarget))){const t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;a.focusin({target:t,relatedTarget:e.target}),dr=cr=null}},blur:{element:globalThis,handler(e){e.target===globalThis&&(dr=null,cr=null)}},capture:!0,passive:!0};n&&(null===(r=gr)||void 0===r||r()),gr=this.detachEvents=e.$globalEventsDetacher=t.on(a)}get activeTouches(){return Array.from(Jn.values())}get hasActiveTouches(){return Jn.size>0}get lastInteractionType(){return lr}get shiftKeyDown(){var e;return Boolean(null===(e=dr)||void 0===e?void 0:e.shiftKey)}get ctrlKeyDown(){var e,t;return Boolean((null===(e=dr)||void 0===e?void 0:e.ctrlKey)||(null===(t=dr)||void 0===t?void 0:t.metaKey))}get altKeyDown(){var e;return Boolean(null===(e=dr)||void 0===e?void 0:e.altKey)}get currentOverElement(){return hr}isKeyDown(e){var t;return e?(null===(t=dr)||void 0===t?void 0:t.key)===e||!0===dr[(null==e?void 0:e.toLowerCase())+"Key"]:Boolean(dr)}isMouseDown(e=0){var t;return(null===(t=cr)||void 0===t?void 0:t.button)===e}get currentMouseDown(){return cr}set currentMouseDown(e){cr=e}get currentPointerDown(){return ur}set currentPointerDown(e){ur=e}get currentTouch(){return or}set currentTouch(e){or=e}get currentKeyDown(){return dr}set currentKeyDown(e){dr=e}},sr=e=>e.isTopModal;ir.observedElements=new Set;let or,ar,lr,dr,cr,ur,hr,gr,mr=!1;function pr(e,t,n,r,i,s,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"_target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>n}),a.fromWidget=r,a.toWidget=i,a.backwards=s,a}const fr=/^(\w+)=(.*)$/;class vr{static DEFAULT_FETCH_OPTIONS={};static get(e,t){return this.fetch(e,t)}static post(e,t,n={}){return n=C.assign({},n),t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},n))}static fetch(e,t){let n;if(t=C.merge({},vr.DEFAULT_FETCH_OPTIONS,t),"undefined"!=typeof AbortController&&(n=t.abortController=new AbortController,t.signal=n.signal),t.queryParams){const n=Object.entries(t.queryParams);if(n.length){let r=!1;if(t.headers&&!0===t.addQueryParamsToBody){let e;switch(new Headers(t.headers).get("Content-Type")){case"application/x-www-form-urlencoded":e=URLSearchParams;break;case"multipart/form-data":e=FormData}if(e){const i=t.body||(t.body=new e);i instanceof e&&(n.forEach((([e,t])=>i.set(e,t))),r=!0)}}r||(e+=(e.includes("?")?"&":"?")+n.map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"))}}const r=new Promise(((n,i)=>{fetch(e,t).then((e=>{t.parseJson?e.json().then((t=>{e.parsedJson=t,n(e)})).catch((t=>{e.parsedJson=null,e.error=t,i(e)})):n(e)})).catch((e=>{e.stack=r.stack,i(e)}))}));return r.stack=(new Error).stack,r.abort=function(){var e;null===(e=n)||void 0===e||e.abort(new DOMException("User aborted request","AbortError")),this.aborted=!0},r}static mockUrl(e,t){const n=this;(n.mockAjaxMap||(n.mockAjaxMap={}))[e]=t,vr.originalFetch||(vr.originalFetch=vr.fetch,vr.fetch=n.mockAjaxFetch.bind(n))}static async mockAjaxFetch(e,t){const n=e.split("?");let r=this.mockAjaxMap[n[0]],i=null;if(r){"function"==typeof r&&(r=await r(n[0],n[1]&&function(e){const t={},n=e.split("&");for(const e of n){const[n,r,i]=fr.exec(e),s=decodeURIComponent(r),o=decodeURIComponent(i);if(n){let e=t[s];e?(Array.isArray(e)||(e=t[s]=[e]),e.push(o)):t[s]=o}}return t}(n[1]),t));try{i=(null==t?void 0:t.parseJson)&&JSON.parse(r.responseText)}catch(e){i=null,r.error=e}return r=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:i,text:()=>new Promise((e=>{e(r.responseText)})),json:()=>new Promise((e=>{e(i)}))},r),new Promise((function(e,t){r.synchronous?e(r):setTimeout((function(){e(r)}),"delay"in r?r.delay:100)}))}return vr.originalFetch(e,t)}}vr._$name="AjaxHelper";class yr{static skipLocaleIntegrityCheck=!1;static mergeLocales(...e){const t={};return e.forEach((e=>{Object.keys(e).forEach((n=>{"object"==typeof e[n]?t[n]={...t[n],...e[n]}:t[n]=e[n]}))})),t}static trimLocale(e,t){const n=(t,n)=>{e[t]&&(n?e[t][n]&&delete e[t][n]:delete e[t])};Object.keys(t).forEach((e=>{Object.keys(t[e]).length>0?Object.keys(t[e]).forEach((t=>n(e,t))):n(e)}))}static normalizeLocale(e,t){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if("string"==typeof e){if(!t)throw new Error('"config" parameter can not be empty');t.locale?t.name=e||t.name:t.localeName=e}else t=e;let n={};if(t.name||t.locale)n=Object.assign({localeName:t.name},t.locale),t.desc&&(n.localeDesc=t.desc),t.code&&(n.localeCode=t.code),t.path&&(n.localePath=t.path);else{if(!t.localeName)throw new Error('"config" parameter doesn\'t have "localeName" property');n=Object.assign({},t)}for(const e of["name","desc","code","path"])n[e]&&delete n[e];if(!n.localeName)throw new Error("Locale name can not be empty");return n}static get locales(){return yr.global.bryntum.locales||{}}static set locales(e){yr.global.bryntum.locales=e}static get localeName(){return yr.global.bryntum.locale||"En"}static set localeName(e){yr.global.bryntum.locale=e||yr.localeName}static get locale(){return yr.localeName&&this.locales[yr.localeName]||this.locales.En||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,t){const{locales:n}=yr.global.bryntum,r=yr.normalizeLocale(e,t),{localeName:i}=r;return n[i]&&!0!==t?n[i]=this.mergeLocales(n[i]||{},r||{}):n[i]=r,n[i]}static get global(){return globalThis}}yr.global.bryntum=yr.global.bryntum||{},yr.global.bryntum.locales=yr.global.bryntum.locales||{},yr._$name="LocaleHelper";class br extends(lt(Qe)){static get defaultConfig(){return{throwOnMissingLocale:G.isTestEnv}}construct(...e){const t=this;if(super.construct(...e),c.isBrowserEnv){var n;const e=document.querySelector("script[data-default-locale]");e?t.applyLocale(e.dataset.defaultLocale):null!==(n=t.locale)&&void 0!==n&&n.localeName&&t.applyLocale(t.locale.localeName)}}get locales(){return yr.locales}set locales(e){yr.locales=e}set locale(e){this.applyLocale(e)}get locale(){return yr.locale}get localeCode(){var e;return(null===(e=this.locale)||void 0===e?void 0:e.localeCode)??"en-US"}applyLocale(e,t,n=!1){const r=this;let i;if("string"==typeof e)if("object"!=typeof t){if(i=r.locales[e],!i){if(n)return!0;throw new Error(`Locale "${e}" is not published. Publish with LocaleHelper.publishLocale() before applying.`)}}else i=yr.publishLocale(e,t);else i=yr.publishLocale(e);if(r.locale.localeName&&r.locale.localeName===i.localeName&&!0!==t)return r.locale;i.oldLocaleName=r.locale.localeName,i.oldLocaleCode=r.locale.localeCode,yr.localeName=i.localeName;const s=()=>{r.trigger("locale",i)};return i.localePath?new Promise(((e,t)=>{r.loadLocale(i.localePath).then((t=>{t.text().then((t=>{new Function(t)(),c.isBrowserEnv&&(i=r.locales[i.localeName],i&&delete i.localePath),s(),e(i)}))})).catch((e=>t(e)))})):(s(),i)}loadLocale(e){return vr.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const Cr=new br,wr=Object.getPrototypeOf(Object),Sr=/L{.*?}/g,Dr=/L{(.*?)}/g,Er=/((.*?)\.)?(.+)/g,xr=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),Rr=Object.freeze(Object.create(null));var Tr=e=>class t extends(e||Qe){static $name="Localizable";static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(e){var t,n;return"string"==typeof e?e:e===wr?"Object":e.$$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$$name)||(null===(n=e.prototype)||void 0===n?void 0:n.name)}static parseLocaleString(e){var t;const n=[];let r;if(null!==(t=e)&&void 0!==t&&t.includes("L{"))for(e=e.replace(/{(\d+)}/gm,"[[$1]]"),Dr.lastIndex=0;null!=(r=Dr.exec(e));){Er.lastIndex=0;const e=Er.exec(r[1]);n.push({match:xr(r[0]),localeKey:xr(e[3]),localeClass:e[2]})}return n.length>0?n:[{match:e,localeKey:e,localeClass:void 0}]}construct(e={},...t){super.construct(e,...t),Cr.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(e){var n,r;const i=this,s=C.getPath(i,e),o=(null===(n=i.$meta.configs[e])||void 0===n?void 0:n.localeKey)||(null===(r=i.fieldMap)||void 0===r||null===(r=r[e])||void 0===r?void 0:r.defaultValue);let a;if(o){if(a=t.localize(o,i,i.localeClass||i),!a||e in(i.initialConfig||Rr)||e in(i.originalData||Rr))return s;C.setPath(i.isColumn?i.data:i,e,a)}else"string"==typeof s&&(i.originalLocales=i.originalLocales||{},a=C.getPath(i.originalLocales,e),void 0===a&&(C.setPath(i.originalLocales,e,s),a=s),a&&C.setPath(i,e,a=i.optionalL(a,i)));return a||s}updateLocalization(){var e,t;!1!==this.localizable&&(null===(e=this.localizableProperties)||void 0===e||e.forEach(this.localizeProperty,this),null===(t=this.trigger)||void 0===t||t.call(this,"localized"))}static getTranslation(e,n,r){const i=Cr.locale;let s,o,a=null;if(i)for(const{match:l,localeKey:d,localeClass:c}of this.parseLocaleString(e)){const u=t=>{var s;const o=null===(s=i[t])||void 0===s?void 0:s[d];return o&&(a="function"==typeof o?null!=n?o(n):o:"object"==typeof o||e===l?o:(a||e).replace(l,o),"string"==typeof o&&o.includes("L{")&&(a=this.getTranslation(o,n,r))),o};let h=!1;for(o=r;o&&(s=t.clsName(o))&&!(h=u(s))&&"string"!=typeof o;o=Object.getPrototypeOf(o));!h&&c&&u(c)}return a}static localize(e,n=void 0,...r){var i;0===(null===(i=r)||void 0===i?void 0:i.length)&&(r=[this]);let s=null;return r.some((r=>(s=t.getTranslation(e,n,r),null!=s))),s}static L(e,n=void 0,...r){var i;0===(null===(i=r)||void 0===i?void 0:i.length)&&(r=[this]);const s=this.localize(e,n,...r);if(null==s&&Cr.throwOnMissingLocale&&e.includes("L{"))throw new Error(`Localization is not found for '${e}' in '${r.map((e=>t.clsName(e))).join(", ")}'. ${Cr.locale.localeName?`Locale : ${Cr.locale.localeName}`:""}`);return s??e}L(e,n,r=this.localeClass){const{constructor:i}=this;return r&&t.clsName(r)!==t.clsName(i)?t.L(e,n,r,i):t.L(e,n,i)}static optionalL(e,n=void 0,...r){var i;const s=Cr.throwOnMissingLocale;Cr.throwOnMissingLocale=s&&Sr.test(e),0===(null===(i=r)||void 0===i?void 0:i.length)&&(r=[this]);const o=t.L(e,n,...r);return Cr.throwOnMissingLocale=s,o}optionalL(e,t=this,n=!1){const r=Cr.throwOnMissingLocale;Cr.throwOnMissingLocale=r&&Sr.test(e)&&!n;const i=this.L(e,t);return Cr.throwOnMissingLocale=r,i}get localeManager(){return Cr}get localeHelper(){return yr}};class Mr extends(Qe.mixin(lt,Tr)){static $name="InstancePlugin";static configurable={disabled:!1,client:null,keyMap:null};static properties={clientListeners:null};onConfigChange(...e){var t,n;(super.onConfigChange(...e),this.isConfiguring)||(null===(t=this.client)||void 0===t||null===(n=t.afterPluginConfigChange)||void 0===n||n.call(t,{plugin:this,...e[0]}))}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:t}=this;t.keyMap=t.mergeKeyMaps(t.keyMap,e,N.uncapitalize(this.constructor.$name))}static initPlugins(e,...t){for(const n of t)this.initPlugin(e,n)}static initPlugin(e,t,n){const r=e.plugins||(e.plugins={}),i=[e];return n&&i.push(n),r[t.$$name]=new t(...i)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return null===(e=this.client)||void 0===e?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let n,[r,i]=e;1===e.length?W.isObject(r)&&(i=r,r=i.client):(i=W.assign({},i),delete i.client),t.client=r,super.construct(i),t.applyPluginConfig(r),n=t.clientListeners,n&&(n=W.assign({},n),n.thisObj=t,r.ion(n))}applyPluginConfig(e){const t=this,n=t.pluginConfig||t.constructor.pluginConfig;if(n){const{assign:r,chain:i,after:s,before:o,override:a}=n;r&&t.applyAssign(e,r),(i||s)&&t.applyChain(e,i||s),o&&t.applyChain(e,o,!1),a&&t.applyOverride(e,a)}}applyAssign(e,t){t.forEach((t=>this.assign(e,t)))}applyChain(e,t,n=!0){if(Array.isArray(t))for(const r of t)this.chain(e,r,r,n);else for(const r in t)this.chain(e,r,t[r],n)}applyOverride(e,t){const n=this;n.overridden||(n.overridden={}),t.forEach((t=>{if(!n[t])throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${n.$$name}#${t} does not exist`);"function"==typeof e[t]&&(n.overridden[t]=e[t].bind(e)),e[t]=n[t].bind(n)}))}assign(e,t){const n=this,r=function(e,t){const n=W.getPropertyDescriptor(e,t);return n&&(n.get||n.set)?n:null}(n,t);r?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(n),set:r.set&&r.set.bind(n)}):e[t]=n[t].bind(n)}chain(e,t,n,r=!0){let i=0;"object"==typeof t&&(t=t.fn),"object"==typeof n&&(i=n.prio||0,n=n.fn);const s=this,o=e.pluginFunctionChain||(e.pluginFunctionChain={}),a=s[n]&&s[n].bind(s),l=s.functionChainRunner;if(!a)throw new Error(`Trying to chain fn ${e.$$name}#${n}, but plugin fn ${s.$$name}#${n} does not exist`);if(!o[t]){let n=e[t];n&&(n=n.bind(e),n.$this=e,n.$prio=0),o[t]=n?[n]:[],e[t]=(...e)=>l(o[t],e)}a.$this=s,a.$prio=i,o[t][r?"push":"unshift"](a),o[t].$sorted=!1}functionChainRunner(e,t){let n,r,i;for(e.$sorted||(e.sort(((e,t)=>t.$prio-e.$prio)),e.$sorted=!0),r=0;r<e.length&&(n=e[r],n.$this.isDestroyed||(i=n(...t),!1!==i));r++);return i}doDisable(e){const t=this,{constructor:n}=t,r="featureClass"in n?n.featureClass:`b-${n.$$name.toLowerCase()}`,i=N.uncapitalize(n.$$name);var s,o,a;r&&(null===(s=t.client)||void 0===s||null===(s=s._element)||void 0===s||s.classList[e?"remove":"add"](r));t.isConfiguring||(e?t.trigger("disable"):t.trigger("enable"),null===(o=(a=t.client).syncSplits)||void 0===o||o.call(a,(t=>{const n=t.features[i];n&&(n.disabled=e)})))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}get state(){var e;return null===(e=this.constructor.stateProperties)||void 0===e?void 0:e.reduce(((e,t)=>(e[t]=this[t],e)),{})}}Mr._$name="InstancePlugin";var kr=e=>class extends(e||Qe){static $name="Pluggable";get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),Mr.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){Mr.initPlugins(this,...e)}addPlugin(e,t){return Mr.initPlugin(this,e,t)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){var t;return"function"==typeof e&&(e=e.$$name),null===(t=this.plugins)||void 0===t?void 0:t[e]}get widgetClass(){}};yr.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK",Week:"Week",None:"None",previous:"Previous",next:"Next",to:"to",at:"At",on:"On",editing:e=>`Editing ${e}`,settings:"Settings",close:"Close",go:"Go",save:"Save",cancel:"Cancel",revert:"Revert"},CheckboxGroup:{wrongNbrOfOptionsSelected:e=>`Select exactly ${e}`,tooFewOptionsSelected:e=>`Select at least ${e}`,tooManyOptionsSelected:e=>`Select no more than ${e}`},CodeEditor:{apply:"Apply",autoApply:"Auto apply",downloadCode:"Download code",editor:"Code editor",viewer:"Code viewer"},ColorPicker:{noColor:"No color"},Combo:{noResults:"No results",recordNotCommitted:"Record could not be added",addNewValue:e=>`Add ${e}`},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:e=>"Invalid date input, expected format is "+e},DatePicker:{gotoPrevYear:"Go to previous year",gotoPrevMonth:"Go to previous month",gotoNextMonth:"Go to next month",gotoNextYear:"Go to next year"},Hint:{dontShowAgain:"Don't show again"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},TimePicker:{hour:"Hour",minute:"Minute",second:"Second"},List:{loading:"Loading...",selectAll:"Select All"},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},PanelCollapser:{Collapse:"Collapse",Expand:"Expand"},Popup:{close:"Close"},TabPanel:{containsInvalidFields:"Tab contains invalid fields"},Toolbar:{showOverflowingItems:"Show overflowing items",scrollForMore:"Scroll for more"},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action",NoActions:"No items in the undo queue"},FieldFilterPicker:{equals:"equals",doesNotEqual:"does not equal",isEmpty:"empty",isNotEmpty:"not empty",contains:"contains",doesNotContain:"does not contain",startsWith:"starts with",endsWith:"ends with",isOneOf:"one of",isNotOneOf:"not one of",isGreaterThan:"greater than",isLessThan:"less than",isGreaterThanOrEqualTo:"greater or equals",isLessThanOrEqualTo:"less or equals",isBetween:"between",isNotBetween:"not between",isBefore:"before",isAfter:"after",timeEquals:"time equals",timeDoesNotEqual:"time does not equal",isToday:"today",isTomorrow:"tomorrow",isYesterday:"yesterday",isThisWeek:"this week",isNextWeek:"next week",isLastWeek:"last week",isThisMonth:"this month",isNextMonth:"next month",isLastMonth:"last month",isThisYear:"this year",isNextYear:"next year",isLastYear:"last year",isYearToDate:"year to date",isTrue:"true",isFalse:"false",selectAProperty:"Select property",selectAnOperator:"Select operator",caseSensitive:"Case-sensitive",and:"and",dateFormat:"D/M/YY",selectValue:"Select value",selectOneOrMoreValues:"Select value(s)",enterAValue:"Enter value",enterANumber:"Enter number",selectADate:"Select date",selectATime:"Select time"},FieldFilterPickerGroup:{addFilter:"Add filter",applyCond:e=>e?"Skip filter (currently applied)":"Apply filter (currently skipped)"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"emillisecond",plural:"ems",abbrev:"ems"},{single:"second",plural:"seconds",abbrev:"s"},{single:"esecond",plural:"eseconds",abbrev:"es"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"eminute",plural:"eminutes",abbrev:"emin"},{single:"hour",plural:"hours",abbrev:"h"},{single:"ehour",plural:"ehours",abbrev:"eh"},{single:"day",plural:"days",abbrev:"d"},{single:"eday",plural:"edays",abbrev:"ed"},{single:"week",plural:"weeks",abbrev:"w"},{single:"eweek",plural:"eweeks",abbrev:"ew"},{single:"month",plural:"months",abbrev:"mon"},{single:"emonth",plural:"emonths",abbrev:"emon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"equarter",plural:"equarters",abbrev:"eq"},{single:"year",plural:"years",abbrev:"yr"},{single:"eyear",plural:"eyears",abbrev:"eyr"},{single:"decade",plural:"decades",abbrev:"dec"},{single:"edecade",plural:"edecades",abbrev:"edec"}],unitAbbreviations:[["mil"],["emil"],["s","sec"],["es","esec"],["m","min"],["em","emin"],["h","hr"],["eh","ehr"],["d"],["ed"],["w","wk"],["ew","ewk"],["mo","mon","mnt","M"],["emo","emon","emnt"],["q","quar","qrt"],["eq","equar","eqrt"],["y","yr"],["ey","eyr"],["dec"],["edec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t},decade:e=>{const t="number"==typeof e?e:e.getFullYear();return t-t%10+"s"}}});const{toString:Fr}=Object.prototype,Ir=Fr.call(new Date),Ar=new Date,Lr=36e5,Pr=(e,t)=>isNaN(e)||null==e?t:e,Or=/([ES]){([^}]+)}/g,$r=e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t},_r=(e,t,n,r=gi)=>(r[e]=r[e]||{[e]:1},r[t]=r[t]||{[t]:1},r[e][t]=n,r[t][e]=1/n,r),Hr=(e,t,n)=>(Zr[e]||(Zr[e]=new Intl.DateTimeFormat(Yr,t))).format(n),Vr=(e,t,n,r=!1)=>{let i=Hr(e,t,n);return/am|pm/i.test(i)&&(i=i.replace(/^0/,""),r&&(i=i.replace(/:00/,""))),i},Nr=e=>e>=0?e:e+7,Br=/([^\w])(S+)/gm,zr=(e,t)=>t+"SSS",jr=/[:.\-/\s]/,Wr=/^(?:יום |ال)/;let Ur,Gr,Yr="en-US",qr=$r,Kr={},Xr={},Zr={},Jr={},Qr={},ei="AM",ti="PM",ni=Lr;const ri=e=>{const t=ii[e];if(!t)throw new Error("Only international formats should be used here");if(void 0!==Xr[e])return Xr[e];const n=new Intl.DateTimeFormat(Yr,t).formatToParts(new Date(2001,1,2,3,4,5,6)).map((e=>{const n=e.type,r=t[n];return"literal"===n?e.value.replace(/,/g,""):"day"===n?"numeric"===r?"D":"DD":"month"===n?"short"===r?"MMM":"long"===r?"MMMM":"numeric"===r?"M":"MM":"year"===n?"numeric"===r?"YYYY":"YY":void 0})).join("");return Xr[e]=n},ii={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"short",day:"numeric"}},si={M:e=>e.getMonth()+1,Mo:e=>qr(si.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>Hr("MMM",{month:"short"},e),MMMM:e=>Hr("MMMM",{month:"long"},e),DC:e=>xi.localize("L{decade}",e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>qr(si.Q(e).toString()),D:e=>e.getDate(),Do:e=>qr(si.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/gi.day.millisecond),DDDo:e=>qr(si.DDD(e).toString()),DDDD:e=>si.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>qr(e.getDay().toString()),d1:e=>Hr("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>si.ddd(e).substring(0,2),ddd:e=>{var t;return Ur=Hr("ddd",{weekday:"short"},e),Gr=null===(t=Ur.match(Wr))||void 0===t?void 0:t[0],Ur.substring(Gr?Gr.length:0)},dddd:e=>{var t;return Ur=Hr("dddd",{weekday:"long"},e),Gr=null===(t=Ur.match(Wr))||void 0===t?void 0:t[0],Ur.substring(Gr?Gr.length:0)},u:e=>{const t=(Zr.u||(Zr.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}))).formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}Z`},uu:e=>{const t=(Zr.uu||(Zr.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))).formatToParts(e);return`${t[4].value}${t[2].value}${t[0].value}T${t[6].value}${t[8].value}${t[10].value}Z`},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>xi.getWeekNumber(e)[1],Wo:e=>qr(si.W(e).toString()),WW:e=>si.W(e).toString().padStart(2,"0"),Wp:e=>`${xi.localize("L{Week}")} ${si.W(e)}`,WWp:e=>`${xi.localize("L{Week}")} ${si.WW(e)}`,Wp0:e=>`${xi.localize("L{Week}")[0]}${si.W(e)}`,WWp0:e=>`${xi.localize("L{Week}")[0]}${si.WW(e)}`,Y:e=>e.getFullYear(),YY:e=>(e.getFullYear()%100).toString().padStart(2,"0"),YYYY:e=>e.getFullYear(),A:e=>(e.getHours()<12?ei:ti).toLocaleUpperCase(),a:e=>(e.getHours()<12?ei:ti).toLocaleLowerCase(),H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>si.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>si.k(e).toString().padStart(2,"0"),K:e=>Vr("K",{hour:"numeric"},e),KK:e=>Vr("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>si.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>si.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>Hr("z",{timeZoneName:"short"},e),zz:e=>Hr("zz",{timeZoneName:"long"},e),Z:e=>Ri.getGMTOffset(e),LT:e=>Vr("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>Vr("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>Vr("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>Hr("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>Hr("l",ii.l,e),LL:e=>Hr("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>Hr("ll",ii.ll,e),LLL:e=>Hr("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>Hr("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>Hr("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>Hr("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},oi=`^(?:${Object.keys(si).sort(((e,t)=>t.length-e.length)).join("|")})`,ai=()=>({}),li=e=>(e=>wi.test(e))(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},di={YYYY:e=>{const t=parseInt(e);return{year:t>=1e3&&t<=9999?t:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const t=(e||"").toLowerCase();for(const[e,n]of Object.entries(xi._monthShortNamesIndex))if(t.startsWith(e))return{month:n.value}},MMMM:e=>{const t=(e||"").toLowerCase();for(const[e,n]of Object.entries(xi._monthNamesIndex))if(t.startsWith(e))return{month:n.value}},DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:ai,DDDo:ai,DDDD:ai,d:ai,do:ai,d1:ai,dd:ai,ddd:ai,dddd:ai,Q:ai,Qo:ai,W:ai,Wo:ai,WW:ai,e:ai,E:ai,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:li,SS:li,SSS:li,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>ri("l")},ll:{type:"dynamic",parser:()=>ri("ll")},Z:e=>{if(!e||!Si.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const n=Si.exec(e);if(n){t=("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},ci=Object.keys(di).sort(((e,t)=>t.length-e.length)),ui=new RegExp(`(${ci.join("|")})`),hi=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),gi={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:87648,minute:5258880,second:315532800,millisecond:3155328e5},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/87648,year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/5258880,year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/315532800,year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/3155328e5,year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},mi={ms:"millisecond",milliseconds:"millisecond",ems:"emillisecond",emilliseconds:"emillisecond",s:"second",seconds:"second",es:"esecond",eseconds:"esecond",m:"minute",mi:"minute",min:"minute",minutes:"minute",em:"eminute",emi:"eminute",emin:"eminute",eminutes:"eminute",h:"hour",hours:"hour",eh:"ehour",ehours:"ehour",d:"day",days:"day",ed:"eday",edays:"eday",w:"week",weeks:"week",ew:"eweek",eweeks:"eweek",M:"month",mo:"month",mon:"month",months:"month",EM:"emonth",eM:"emonth",emo:"emonth",emon:"emonth",emonths:"emonth",q:"quarter",quarters:"quarter",eq:"equarter",equarters:"equarter",y:"year",years:"year",ey:"eyear",eyears:"eyear",dec:"decade",decades:"decade",edec:"edecade",edecades:"edecade"},pi=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,fi=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,vi=["millisecond","emillisecond","second","esecond","minute","eminute","hour","ehour","day","eday","week","eweek","month","emonth","quarter","equarter","year","eyear","decade","edecade"],yi=[["ms","mil"],["ems","emil"],["s","sec"],["es","esec"],["m","min"],["em","emin"],["h","hr"],["eh","ehr"],["d"],["ed"],["w","wk"],["ew","ewk"],["mo","mon","mnt","M"],["emo","emon","emnt"],["q","quar","qrt"],["eq","equar","eqrt"],["y","yr"],["ey","eyr"],["dec"],["edec"]],bi=["decade","year","month","week","day","hour","minute","second","millisecond"],Ci=["milliseconds","seconds","minutes","hours","date","month","year"],wi=/^[0-9]+$/,Si=/([+-])(\d\d):*(\d\d)*$/,Di={millisecond:{magnitude:0,smaller:void 0,greater:"second"},second:{magnitude:2,smaller:"millisecond",greater:"minute"},minute:{magnitude:4,smaller:"second",greater:"hour"},hour:{magnitude:6,smaller:"minute",greater:"day"},day:{magnitude:8,smaller:"hour",greater:"week"},week:{magnitude:10,smaller:"day",greater:"month"},month:{magnitude:12,smaller:"week",greater:"quarter"},quarter:{magnitude:14,smaller:"month",greater:"year"},year:{magnitude:16,smaller:"quarter",greater:"decade"},decade:{magnitude:18,smaller:"year"},emillisecond:{magnitude:1,smaller:void 0,greater:"esecond"},esecond:{magnitude:3,smaller:"emillisecond",greater:"eminute"},eminute:{magnitude:5,smaller:"esecond",greater:"ehour"},ehour:{magnitude:7,smaller:"eminute",greater:"eday"},eday:{magnitude:9,smaller:"ehour",greater:"eweek"},eweek:{magnitude:11,smaller:"eday",greater:"emonth"},emonth:{magnitude:12,smaller:"eweek",greater:"equarter"},equarter:{magnitude:14,smaller:"emonth",greater:"eyear"},eyear:{magnitude:16,smaller:"equarter",greater:"edecade"},edecade:{magnitude:18,smaller:"eyear"}},Ei={round:(e,t=1)=>Math.round(e/t)*t,floor:(e,t=1)=>Math.floor(e/t)*t,ceil:(e,t=1)=>Math.ceil(e/t)*t};_r("edecade","millisecond",31104e7),_r("eyear","millisecond",31104e6),_r("equarter","millisecond",7776e6),_r("emonth","millisecond",2592e6),_r("eweek","millisecond",6048e5),_r("eday","millisecond",864e5),_r("ehour","millisecond",36e5),_r("eminute","millisecond",6e4),_r("esecond","millisecond",1e3),_r("emillisecond","millisecond",1e3);class xi extends(Tr()){static MS_PER_DAY=864e5;static $name="DateHelper";static set defaultFormat(e){Ri._defaultFormat=e}static get defaultFormat(){return Ri._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static get today(){return xi.clearTime(new Date,!1)}static get tomorrow(){return xi.add(xi.today,1,"day")}static get yesterday(){return xi.add(xi.today,-1,"day")}static buildParser(e){const t=e.split(ui),n=[];return 1===t.length||hi.test(e)?[]:(t.reduce(((t,r,i,s)=>{if(0!==i||""!==r)if(ui.test(r)){const o=(this.localize("L{parsers}")||{})[r]||di[r];if("Z"===r&&i<s.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);const a="function"==typeof o||"string"==typeof o?o:o.parser();if("string"==typeof a){const e=Ri.buildParser(a),r=e.pop();delete r.last,n.push(...e),t=r}else t.pattern=r,t.fn=a}else t.splitter=r,n.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&n.push(t);return t}),{}),n[n.length-1].last=!0,n)}static makeKey(e){if(10===e.length)return e;e.getTime&&(e=e.getTime());const t=Qr[Math.trunc(e/ni)];if(t)return t;Ar.setTime(e);const n=Ar.getMonth()+1,r=Ar.getDate();return Qr[Math.trunc(e/ni)]=`${Ar.getFullYear()}-${n<10?"0"+n:n}-${r<10?"0"+r:r}`}static parseKey(e){const t="-"===(null==e?void 0:e[0]),n=Ri.parse(t?e.slice(1):e,"YYYY-MM-DD");return t&&n.setFullYear(-n.getFullYear()),n}static parse(e,t=Ri.defaultParseFormat,n=!1){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const r={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(Br,zr);let i=Jr[t],s=null;if(i||(i=Jr[t]=Ri.buildParser(t)),e.includes(" ")&&(e=e.replace(/\s/g," ")),i.reduce(((e,t)=>{if(!t.last){let s,o,a;if("T"===t.splitter&&-1===e.indexOf("T"))s=e.indexOf(" ");else{var i;const r=e.indexOf("+");let{splitter:o}=t;!n&&jr.test(o)&&(o=jr),s=""!==t.splitter?e.search("string"==typeof o?N.escapeRegExp(o):o):(null===(i=t.pattern)||void 0===i?void 0:i.length)||-1,r>-1&&s>r&&(s=-1)}if(-1===s||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(o=e,a=""):(o=t[0],a=`${t[1]}${t[2]}`)}else o=e.substring(0,s)||e,a=e.substring(s+t.splitter.length);if(t.fn){const e=t.fn(o);e?Object.assign(r,e):a=o+a}return a}Object.assign(r,t.fn(e))}),e),r.year&&!r.date&&(r.date=1),r.date>31||r.month>12)return null;const o=Ri.create(r,n);return o?s=o:!n&&e.length>3&&(s=new Date(e),s.getFullYear()<1900&&(s=null)),s}static create(e,t=!1){const n={...e};let r=isNaN(n.year)||t&&(isNaN(n.month)||isNaN(n.date)),i=!1;if(!r){let e=!0;Ci.forEach((t=>{t in n&&!isNaN(n[t])||(n[t]=0),e=e&&null===n[t]})),r=e}if(r)return null;if("am"===n.amPm?n.hours=n.hours%12:"pm"===n.amPm&&(n.hours=n.hours%12+12),"timeZone"in n&&(i=!0,n.minutes-=n.timeZone),t&&(null==n.year||null==n.month||null==n.date))return null;const s=[Pr(n.year,2020),Pr(n.month,0),Pr(n.date,1),n.hours,n.minutes,n.seconds,n.milliseconds];return i?new Date(Date.UTC(...s)):new Date(...s)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=Ri.defaultFormat){if(!e||isNaN(e))return null;if("function"==typeof t)return t(e);let n=Kr[t],r="";if(!n){n=Kr[t]=[];for(let e=0;e<t.length;e++){const r=t.slice(e).match(oi),i=null==r?void 0:r[0];if(i){const t=(this.localize("L{formats}")||{})[i]||si[i];n.push(t),e+=i.length-1}else if("{"===t[e]){const r=t.indexOf("}",e+1);-1===r?(n.push(t.substr(e+1)),e=t.length):(n.push(t.substring(e+1,r)),e=r)}else n.push(t[e])}}return n.forEach((t=>{r+="string"==typeof t?t:t(e)})),r}static formatRange(e,t){return t.replace(Or,((t,n,r)=>xi.format(e["S"===n?0:1],r)))}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),Ri.as("millisecond",e,t)}static asMonths(e){const t=Ri.as("ms",Ri.daysInMonth(e),"day"),n=(e.valueOf()-Ri.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+n}static monthsToDate(e){const t=Math.floor(e),n=e-t,r=new Date(0,t),i=Ri.as("ms",Ri.daysInMonth(r),"days");return r.setTime(r.getTime()+n*i),r}static formatDelta(e,t){let n,r,i=", ";"boolean"==typeof t?n=t:t&&(n=t.abbrev,i=t.unitSeparator||i);const s=this.getDelta(e,t),o=[],a=(null==t?void 0:t.separator)||(n?"":" ");for(r in s)o.push(`${s[r]}${a}${r}`);return!1===(null==t?void 0:t.asString)?o:o.join(i)}static getDelta(e,t){let n,r,i,s,o,a,l;"boolean"==typeof t?n=t:t&&(n=t.abbrev,s=Ri.normalizeUnit(t.precision),a=t.maxUnit,l=!n&&t.ignoreLocale);const d={},c=n?Ri.getShortNameOfUnit:Ri.getLocalizedNameOfUnit,u=a?bi.slice(bi.indexOf(a)):bi;for(o of u)if(r=Ri.as(o,e),i=s===o,r=Math[i?"round":"floor"](r),(r||i&&!d.length)&&(d[l?o:c.call(Ri,o,1!==r)]=r,e-=Ri.as("ms",r,o)),i||!e)break;return d}static as(e,t,n="ms"){return"string"==typeof t&&(t=Ri.parseDuration(t)),"object"==typeof t&&(n=t.unit,t=t.magnitude),e!==n&&n&&e?(e=Ri.normalizeUnit(e))===(n=Ri.normalizeUnit(n))?t:Di[n].magnitude>Di[e].magnitude?t*Math.abs(gi[n][e]):t/Math.abs(gi[e][n]):t}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return Ri.format(Ri.getTime(13,0,0),e).includes("13")}static add(e,t,n="ms",r=!0){let i;if(i="string"==typeof e?Ri.parse(e):r?new Date(e.getTime()):e,"string"==typeof t){const e=xi.parseDuration(t);t=e.magnitude,n=e.unit}else t&&"object"==typeof t&&(n=t.unit,t=t.magnitude);if(!n||0===t)return i;switch(n=Ri.normalizeUnit(n)){case"millisecond":i.setTime(i.getTime()+t);break;case"second":i.setTime(i.getTime()+1e3*t);break;case"minute":i.setTime(i.getTime()+6e4*t);break;case"hour":i.setTime(i.getTime()+36e5*t);break;case"day":t%1==0?(i.setDate(i.getDate()+t),23===i.getHours()&&0===e.getHours()&&i.setHours(i.getHours()+1)):i.setTime(i.getTime()+864e5*t);break;case"week":i.setDate(i.getDate()+7*t);break;case"month":{let e=i.getDate();e>28&&(e=Math.min(e,Ri.getLastDateOfMonth(Ri.add(Ri.getFirstDateOfMonth(i),t,"month")).getDate())),i.setDate(e),i.setMonth(i.getMonth()+t);break}case"quarter":Ri.add(i,3*t,"month",!1);break;case"year":Ri.add(i,12*t,"month",!1);break;case"decade":i.setFullYear(i.getFullYear()+10*t)}return i}static diff(e,t,n="ms",r=!0){if(n=Ri.normalizeUnit(n),!e||!t)return 0;let i;switch(n){case"year":i=Ri.diff(e,t,"month")/12;break;case"quarter":i=Ri.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth()),0===i&&r&&(i=Ri.diff(e,t,"day",r)/Ri.daysInMonth(e));break;case"week":i=Ri.diff(e,t,"day")/7;break;case"day":{const n=e.getTimezoneOffset()-t.getTimezoneOffset();i=(t-e+60*n*1e3)/864e5;break}case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return r?i:Math.round(i)}static startOf(e,t="day",n=!0,r=Ri.weekStartDay){if(!e)return null;switch(t=Ri.normalizeUnit(t),n&&(e=Ri.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth(3*(Ri.get(e,"quarter")-1),1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{let t=e.getDay()-r;return t<0&&(t+=7),e.setDate(e.getDate()-t),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return e?(t&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,t){let n=Ri.clearTime(e);return t&&n<e&&(n=Ri.add(n,1,"d")),n}static isMidnight(e){return Ri.midnight(e).getTime()===e.getTime()}static getTimeOfDay(e,t="ms"){const n=e.getHours()*gi.hour.millisecond+e.getMinutes()*gi.minute.millisecond+e.getSeconds()*gi.second.millisecond+e.getMilliseconds();return"ms"===t?n:Ri.as(t,n,"ms")}static set(e,t,n){if(!t)return e;if("string"==typeof t)switch(Ri.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort(((e,t)=>{const n=e[0],r=t[0],i=Di["date"===r?"day":r];return Di["date"===n?"day":n].magnitude-i.magnitude})).forEach((([t,n])=>{Ri.set(e,t,n)}));return e}static setDateToMidday(e,t=!0){return Ri.set(Ri.clearTime(e,t),"hour",12)}static constrain(e,t,n){return null!=t&&(e=Ri.max(e,t)),null==n?e:Ri.min(e,n)}static getTime(e,t=0,n=0,r=0){return e instanceof Date&&(r=e.getMilliseconds(),n=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,n,r)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static combineDateAndTime(e,t){return xi.copyTimeValues(new Date(e),t)}static get isDSTEnabled(){const e=(new Date).getFullYear(),t=new Date(e,0,1),n=new Date(e,6,1);return t.getTimezoneOffset()!==n.getTimezoneOffset()}static isDST(e){const t=e.getFullYear(),n=new Date(t,0,1),r=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(n.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,n=null){return null===n?e&&t&&e.getTime()===t.getTime():Ri.startOf(e,n)-Ri.startOf(t,n)==0}static compare(e,t,n=null){return n&&(e=Ri.startOf(e,n),t=Ri.startOf(t,n)),e<t?-1:e>t?1:0}static clamp(e,t,n){if(!isNaN(e))return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),new Date(e)}static isSameDate(e,t){return 0===Ri.compare(e,t,"d")}static isSameTime(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()&&e.getMilliseconds()===t.getMilliseconds()}static isStartOf(e,t){return Ri.isEqual(e,Ri.startOf(e,t))}static betweenLesser(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}static betweenLesserEqual(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}static intersectSpans(e,t,n,r){return Ri.betweenLesser(e,n,r)||Ri.betweenLesser(n,e,t)}static compareUnits(e,t){const n=Di[Ri.normalizeUnit(e)],r=Di[Ri.normalizeUnit(t)];return Math.sign(((null==n?void 0:n.magnitude)||0)-((null==r?void 0:r.magnitude)||0))}static timeSpanContains(e,t,n,r){return n-e>=0&&t-r>=0}static get amIndicator(){return ei}static get pmIndicator(){return ti}static get weekStartDay(){return null==Ri._weekStartDay&&(Ri._weekStartDay=this.localize("L{weekStartDay}")||0),Ri._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,t){switch(Ri.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return si.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const t=e.getFullYear(),n=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",n)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),i=new Date(t,n,r+1)-new Date(t,n,r);return this.as("hour",i)}static getNormalizedUnitDuration(e,t){let n;switch(t){case"month":n=Ri.asMilliseconds(Ri.daysInMonth(e),"day");break;case"year":n=Ri.asMilliseconds(Ri.daysInYear(e),"day");break;case"day":n=Ri.asMilliseconds(Ri.hoursInDay(e),"hour");break;default:n=Ri.asMilliseconds(t)}return n}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,n=1,r=Ri.weekStartDay){if("week"===t){const t=Ri.clone(e),i=t.getDay();return Ri.startOf(t,"day",!1),Ri.add(t,r-i+7*(n-(r<=i?0:1)),"day",!1),t.getDay()!==r&&Ri.add(t,1,"hour"),t}return Ri.startOf(Ri.add(e,n,t),t,!1)}static isValidDate(e){return Ri.isDate(e)&&!isNaN(e)}static isDate(e){return e&&Fr.call(e)===Ir}static getStartOfNextDay(e,t=!1,n=!1){let r=Ri.add(n?e:Ri.clearTime(e,t),1,"day");if(r.getDate()===e.getDate()){const n=Ri.add(Ri.clearTime(e,t),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();r=Ri.add(r,i-n,"minute")}return r}static getEndOfPreviousDay(e,t=!1){const n=t?e:Ri.clearTime(e,!0);return n-e?n:Ri.add(n,-1,"day")}static getWeekDescription(e,t=e){const n=e.getMonth()===t.getMonth()?xi.format(e,"MMMM"):`${xi.format(e,"MMM")} - ${xi.format(t,"MMM")}`,r=xi.getWeekNumber(e);return`${r[1]}, ${n} ${r[0]}`}static getWeekNumber(e,t=xi.weekStartDay){const n=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),11,31),i=Nr(n.getDay()-t),s=Nr(r.getDay()-t),o=(a=e,l=n,Math.floor((a.getTime()-l.getTime()-(a.getTimezoneOffset()-l.getTimezoneOffset())*gi.minute.millisecond)/gi.day.millisecond)+1);var a,l;let d;if(d=i<4?Math.floor((o+i-1)/7)+1:Math.floor((o+i-1)/7),d){let t=e.getFullYear();return 53===d&&s<3&&(t++,d=1),[t,d]}const c=xi.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,c]}static getDateFromISOWeek(e,t,n=1){const r=new Date(e,0,1+7*(t-1)),i=r.getDay(),s=n-(0===i?7:i);return r.setDate(r.getDate()+s),r}static formatCount(e,t){return t=Ri.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,n=!1){return(e=Ri.normalizeUnit(e))===(t=Ri.normalizeUnit(t))?1:gi[e]&&gi[e][t]&&(n||gi[e][t]>0)?1/Ri.as(t,1,e):gi[t]&&gi[t][e]&&(n||gi[t][e]>0)?Ri.as(e,1,t):-1}static getShortNameOfUnit(e){return e=Ri.parseTimeUnit(e),Ri.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const n=e.charAt(0)===e.charAt(0).toUpperCase();return e=Ri.normalizeUnit(e),e=Ri.parseTimeUnit(e),e=Ri.unitLookup[e][t?"plural":"single"],n&&(e=N.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return"date"===t||vi.includes(t)?t:mi[e]||mi[t]}static getUnitByName(e){return Ri.normalizeUnit(e)||Ri.normalizeUnit(Ri.parseTimeUnit(e))}static getDurationInUnit(e,t,n,r){return Ri.diff(e,t,n,r)}static doesUnitsAlign(e,t){return!(e!==t&&"week"===t)}static getSmallerUnit(e){var t,n;e=Ri.normalizeUnit(e);const r=null===(t=Di[e])||void 0===t?void 0:t.smaller;return vi[null===(n=Di[r])||void 0===n?void 0:n.magnitude]||null}static getLargerUnit(e){var t,n;e=Ri.normalizeUnit(e);const r=null===(t=Di[e])||void 0===t?void 0:t.greater;return vi[null===(n=Di[r])||void 0===n?void 0:n.magnitude]||null}static round(e,t,n,r){return Ri.snap("round",e,t,n,r)}static floor(e,t,n,r){return Ri.snap("floor",e,t,n,r)}static ceil(e,t,n,r){return Ri.snap("ceil",e,t,n,r)}static snap(e,t,n,r,i=Ri.weekStartDay){const s=Ei[e];if("string"==typeof n&&(n=Ri.parseDuration(n)),C.isObject(n)){const o=n.magnitude||n.increment;switch(n.unit){case"week":if(!r){const e=t.getDay();r=Ri.add(Ri.clearTime(t),e>=i?i-e:-(e-i+7),"day")}return Ri[e](t,7*o+" days",r);case"month":{let e;return t=Ri.asMonths(t),e=r?(r=Ri.asMonths(r))+s(t-r,o):s(t,o),Ri.monthsToDate(e)}case"quarter":return Ri[e](t,3*o+" months",r);case"year":return Ri[e](t,12*o+" months",r);case"decade":return Ri[e](t,10*o+" years",r)}n=Ri.as("ms",o,n.unit)}const o=1e3*t.getTimezoneOffset()*60;if(r){const e=1e3*r.getTimezoneOffset()*60,i=t-r+e-o,a=new Date(r.getTime()+s(i,n)),l=e-1e3*a.getTimezoneOffset()*60;return l&&Ri.add(a,-l,"ms",!1),new Date(a)}return new Date(s(t.valueOf()-o,n)+o)}static parseDuration(e,t=!0,n){var r;const i=(t?pi:fi).exec(e);if(null==e||!i)return null;const s=(e=>{const t=parseFloat(e);return isNaN(t)?null:t})(null===(r=i[1])||void 0===r?void 0:r.replace(",",".")),o=Ri.parseTimeUnit(i[2])||n;return o?{magnitude:s,unit:o}:null}static parseTimeUnit(e){const t=null==e?null:Ri.durationRegEx.exec(e)||Ri.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<vi.length;e++)if(t[e+1])return vi[e]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=Ri._dayNames||[],n=Ri._dayShortNames||[];t.length=0,n.length=0;for(let r=2;r<9;r++)e.setDate(r),t.push(Ri.format(e,"dddd")),n.push(Ri.format(e,"ddd"));Ri._dayNames=t,Ri._dayShortNames=n}static getDayNames(){return Ri._dayNames}static getDayName(e){return Ri._dayNames[e]}static getDayShortNames(){return Ri._dayShortNames}static getDayShortName(e){return Ri._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=Ri._monthNames||[],n=Ri._monthShortNames||[],r={},i={};t.length=0,n.length=0;for(let s=0;s<12;s++){e.setMonth(s);const o=Ri.format(e,"MMMM");t.push(o);const a=Ri.format(e,"MMM");n.push(a),r[o.toLowerCase()]={name:o,value:s},i[a.toLowerCase()]={name:a,value:s}}Ri._monthNames=t,Ri._monthShortNames=n,Ri._monthNamesIndex=r,Ri._monthShortNamesIndex=i}static getMonthShortNames(){return Ri._monthShortNames}static getMonthShortName(e){return Ri._monthShortNames[e]}static getMonthNames(){return Ri._monthNames}static getMonthName(e){return Ri._monthNames[e]}static set locale(e){Yr=e,Zr={},Kr={},Xr={}}static get locale(){return Yr}static setupDurationRegEx(e=[],t=[]){const n=this,r={};let i="";for(let s=0;s<t.length;s++){const o=t[s],a=e[s];a.canonicalUnitName=vi[s],r[a.single]=r[a.single.toUpperCase()]=r[a.canonicalUnitName]=r[a.canonicalUnitName.toUpperCase()]=a,i+=(s?"|":"")+"(";for(let e=0;e<o.length;e++)i+=`${o[e]}|`;if(Yr=n.localize("L{locale}")||"en-US","en-US"!==Yr){const e=yi[s];for(let t=0;t<e.length;t++)i+=`${e[t]}|`}i+=`${a.single}|${a.plural}|${a.canonicalUnitName}|${a.canonicalUnitName}s)`}n.unitLookup=r,n.durationRegEx=new RegExp(`^(?:${i})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],n=e.unitNames=e.localize("L{unitNames}"),r=new Date(2020,6,15,6),i=Math.abs(r.getTimezoneOffset()%60);if("unitNames"===n)return;Yr=e.localize("L{locale}")||"en-US";const s=Zr.a||(Zr.a=new Intl.DateTimeFormat(Yr,{hour:"numeric",hourCycle:"h12"}));ei=s.formatToParts(r)[2].value,ti=s.formatToParts(new Date(2020,6,15,18))[2].value,qr="en-US"===Yr?$r:e.localize("L{ordinalSuffix}")||qr,Kr={},Xr={},Jr={},Zr={},Qr={},ni=6e4*(!i||i>30?60-i:i),Ri._weekStartDay=null,Ri.setupDurationRegEx(n,t),Ri.fillDayNames(),Ri.fillMonthNames()}}l.register(xi);const Ri=xi;Ri.useIntlFormat=Hr,Cr.ion({locale:"applyLocale",prio:1e3,thisObj:Ri}),Cr.locale&&Ri.applyLocale();class Ti extends Set{get isDateSet(){return!0}add(e){return e=xi.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=xi.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(xi.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new Ti(e)),e.size===this.size&&[...this].every((t=>e.has(t)))}get dates(){return[...this].sort().map((e=>xi.parseKey(e)))}}xi.DateSet=Ti,xi._$name="DateHelper";const{defineProperty:Mi}=Reflect;let ki;ki=c.isBrowserEnv?globalThis.performance:{now:()=>(new Date).getTime()};let Fi=null;if(G.isTestEnv){const e=globalThis.bryntum||(globalThis.bryntum={});Fi=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty:(e=!1)=>Fi.timeouts.size+Fi.animationFrames.size+Fi.idleCallbacks.size+(e?Fi.intervals.size:0)===0,getFiltered({ignoreTimeouts:e=[],maxDelay:t=5e3,includeIntervals:n=!1}){const r=[],i=["timeouts","animationFrames","idleCallbacks"];n&&i.push("intervals");for(const n of i){const i=Fi[n];for(const[,n]of i.entries())e.includes(n.name)||Number.isInteger(n.delay)&&!(n.delay<t)||r.push(n)}return r}}}const Ii=Promise.resolve(),Ai=Object.freeze([]),Li=()=>{},Pi=Object.freeze({}),Oi=globalThis.queueMicrotask,$i=(e,t,n,r)=>{const i="string"==typeof t,s=(null==r?void 0:r.appendArgs)||Ai,o=()=>{n.timerId=null,n.lastCallTime=ki.now();const r=n.args;n.args=null,i?e[t](...r,...s):t.call(e,...r,...s),n.called=!0,++n.calls};return e=(null==r?void 0:r.thisObj)||e,n.lastCallTime=-9e9,n.calls=0,n.suspended=null==r?void 0:r.suspended,n.invoker=o,o.wrapFn=n,o.fn=t,o.this=e,o},_i=(e,t,n="clearTimeout")=>(t.cancel=()=>{t.isPending&&(e[n](t.timerId),t.args=t.timerId=null)},t.flush=()=>{t.isPending&&(e[n](t.timerId),t.timerId=null,t.invoker())},t.now=(...e)=>{t.cancel(),t.args=e,t.invoker()},t.resume=e=>{const n=t.suspended;t.suspended=e||n<1?0:n-1},t.suspend=()=>{++t.suspended},t.immediate=!1,t.suspended=t.suspended?1:0,t.timerId=null,Mi(t,"isPending",{get:()=>null!==t.timerId}),t);var Hi=e=>class extends(e||Qe){static $name="Delayable";static get declarable(){return["delayable"]}doDestroy(){super.doDestroy(),this.clearDelayables()}clearDelayables(){const e=this,[t,n,r,i,s,o]=[e.idleCallbackIds,e.animationFrameIds,e.intervalIds,e.timeoutMap,e.timeoutIds,e.microtasksPending];e.idleCallbackIds=e.animationFrameIds=e.intervalIds=e.timeoutMap=e.timeoutIds=e.microtasksPending=null,null==s||s.forEach(((e,t)=>{var n;"function"==typeof e&&e(),clearTimeout(t),null===(n=Fi)||void 0===n||n.timeouts.delete(t)})),null==i||i.forEach(((e,t)=>clearTimeout(t))),null==r||r.forEach((e=>{var t;clearInterval(e),null===(t=Fi)||void 0===t||t.intervals.delete(e)})),null==n||n.forEach((e=>{var t;cancelAnimationFrame(e),null===(t=Fi)||void 0===t||t.animationFrames.delete(e)})),null==t||t.forEach((e=>{var t;cancelIdleCallback(e),null===(t=Fi)||void 0===t||t.idleCallbacks.delete(e)})),null==o||o.forEach((e=>e.cancel()))}hasTimeout(e){var t;return Boolean(null===(t=this.timeoutMap)||void 0===t?void 0:t.has(e))}asap(e,t){const n=this,r=(...e)=>{r.suspended||(r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=n.queueMicrotask(i)))},i=$i(n,e,r,t);return _i(n,r,"cancelMicrotask")}queueMicrotask(e,t,n){let r,i;n||!t||Array.isArray(t)||(n=t,t=null),n=n||Pi,t=t||n.args||Ai;const s=this,o="string"==typeof e,a=o?e:e.name,l=s.microtasksPending||(s.microtasksPending=new Map),d=()=>l.delete(r),c=()=>{i===l.get(r)&&(l.delete(r),o?!s.isDestroyed&&s[e](...t):e.apply(s,t))};return s.isDestroying&&!n.runOnDestroy?Li:(r=n.cancelOutstanding?a||e:d,i={key:r,name:a,fn:e,args:t,options:n,cancel:d,wrapFn:c},d.taskDef=i,Oi?Oi(c):Ii.then(c),l.set(r,i),d)}cancelMicrotask(e){null==e||e()}setTimeout({fn:e,delay:t,name:n,runOnDestroy:r,cancelOutstanding:i,args:s}){var o;(arguments.length>1||"function"==typeof arguments[0])&&([e,t,n,r,i]=arguments),"string"==typeof e?n=e:n||(n=e.name||e),i&&this.clearTimeout(n);const a=this,l=a.timeoutIds||(a.timeoutIds=new Map),d=a.timeoutMap||(a.timeoutMap=new Map),c=setTimeout((()=>{var t;"string"==typeof e&&(e=a[n]),null==l||l.delete(c),null==d||d.delete(n),null===(t=Fi)||void 0===t||t.timeouts.delete(c),e.apply(a,s)}),t);return l.set(c,!r||e),null===(o=Fi)||void 0===o||o.timeouts.set(c,{fn:e,delay:t,name:n}),n&&d.set(n,c),c}clearTimeout(e){var t,n;let r=e;if("string"==typeof r){if(!this.timeoutMap)return;r=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(r),null===(t=this.timeoutIds)||void 0===t||t.delete(r),null===(n=Fi)||void 0===n||n.timeouts.delete(r)}clearInterval(e){var t,n;clearInterval(e),null===(t=this.intervalIds)||void 0===t||t.delete(e),null===(n=Fi)||void 0===n||n.intervals.delete(e)}setInterval(e,t,n){var r;const i=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(i),null===(r=Fi)||void 0===r||r.intervals.set(i,{fn:e,delay:t,name:n}),i}requestAnimationFrame(e,t=[],n=this){var r;const i=this.animationFrameIds||(this.animationFrameIds=new Set),s=requestAnimationFrame((()=>{var r;null===(r=Fi)||void 0===r||r.animationFrames.delete(s),i.delete(s)&&e.apply(n,t)}));return i.add(s),null===(r=Fi)||void 0===r||r.animationFrames.set(s,{fn:e,extraArgs:t,thisObj:n}),s}requestIdleCallback(e,t=[],n=this){var r;const i=this.idleCallbackIds||(this.idleCallbackIds=new Set),s=requestIdleCallback((()=>{var r;null===(r=Fi)||void 0===r||r.idleCallbacks.delete(s),i.delete(s)&&e.apply(n,t)}));return i.add(s),null===(r=Fi)||void 0===r||r.idleCallbacks.set(s,{fn:e,extraArgs:t,thisObj:n}),s}createOnFrame(e,t=[],n=this,r){let i;const s=(...s)=>{null!=i&&r&&(this.cancelAnimationFrame(i),i=null),null==i&&(i=this.requestAnimationFrame((()=>{"string"==typeof e&&(e=n[e]),i=null,s.push(...t),e.apply(n,s)})))};return s.cancel=()=>this.cancelAnimationFrame(i),s}cancelAnimationFrame(e){var t,n;cancelAnimationFrame(e),null===(t=this.animationFrameIds)||void 0===t||t.delete(e),null===(n=Fi)||void 0===n||n.animationFrames.delete(e)}cancelIdleCallback(e){var t,n;cancelIdleCallback(e),null===(t=this.idleCallbackIds)||void 0===t||t.delete(e),null===(n=Fi)||void 0===n||n.idleCallbacks.delete(e)}async nextAnimationFrame(){return new Promise((e=>this.requestAnimationFrame(e)))}buffer(e,t){let n=t;t&&"number"!=typeof t?n=t.delay:t=null;const r=(...e)=>{if(r.suspended)return;const{delay:t}=r;r.cancel(),r.called=!1,r.args=e,r.immediate||!t?i():r.timerId=this.setTimeout(i,t)},i=$i(this,e,r,t);return r.delay=n,_i(this,r)}raf(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||((r.cancelOutstanding||r.immediate)&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestAnimationFrame(i)))},i=$i(this,e,r,t);return r.cancelOutstanding=n,r.raf=!0,_i(this,r,"cancelAnimationFrame")}idle(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||((r.cancelOutstanding||r.immediate)&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestIdleCallback(i)))},i=$i(this,e,r,t);return r.cancelOutstanding=n,this.setTimeout((()=>this.idleCallbackIds.delete(r.timerId)&&r.now()),100),_i(this,r,"cancelIdleCallback")}throttle(e,t){let n,r=t;t&&"number"!=typeof t?(r=t.delay,n=t.throttled):t=null;const i=this,s=(...e)=>{if(s.suspended)return;const{delay:t}=s,r=ki.now()-s.lastCallTime;s.args=e,s.immediate||r>=t?(i.clearTimeout(s.timerId),o()):(s.isPending||(s.timerId=i.setTimeout(o,t-r),s.called=!1),n&&(n.wrapFn.args=e,n()))},o=$i(i,e,s,t);return s.delay=r,n&&(n=$i(i,n,(()=>{}),t)),_i(i,s)}static setupDelayable(e){e.setupDelayableMethods(e.delayable)}static setupDelayableMethods(e,t=null){const n=e.static,r=t||this.prototype;n&&delete e.static;for(const t in e){let n=e[t];const i=t+"Now",s=typeof n;r[i]||(r[i]=r[t]),"number"===s?n={type:"buffer",delay:n}:"string"===s&&(n={type:n}),Mi(r,t,{get(){const e=this,r=(...t)=>e[i](...t),s=e[n.type](r,n);return Mi(e,t,{value:s,configurable:!0,writable:!0}),r.methodName=t,s}})}}get widgetClass(){}};class Vi{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,t){}}Vi._$name="StateStorage";const Ni=()=>Object.create(null),Bi=(e,t=0)=>{const n=[],r=localStorage.length;for(let i,s=0;s<r;++s)i=localStorage.key(s),i.startsWith(e)&&n.push(i.slice(t));return n},zi=new Vi,ji={local:class extends Vi{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=Ni(),t=this.keys;for(const n of t)e[n]=this.getItem(n);return e}get keys(){return Bi(this.prefix,this.prefix.length)}clear(){const e=Bi(this.prefix);for(const t of e)localStorage.removeItem(t)}getItem(e){const t=localStorage.getItem(this.prefix+e);return null===t?t:JSON.parse(t)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,t){return localStorage.setItem(this.prefix+e,JSON.stringify(t))}},memory:class extends Vi{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return W.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=Ni()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,t){this._data[e]=t}}};class Wi extends(Qe.mixin(Hi,lt)){static $name="StateProvider";static get configurable(){return{prefix:"bryntum-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){null==e?e=Ui:(("string"==typeof e||W.isClass(e)||e instanceof Vi)&&(e={storage:e}),W.isObject(e)&&(e=new Wi(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(e)for(const t in e)this.setValue(t,e[t]);else this.clear()}clear(){return this.storage.clear(),this}changeStorage(e){if(null==e)e=zi;else{if("string"==typeof e){if(!ji[e])throw new Error(`Invalid storage type "${e}" (expected one of: "${Object.keys(ji).join('", "')}")`);e=ji[e]}W.isClass(e)&&(e=new e(this))}return e}saveStateful(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:t}=e,n=null==t?void 0:t.length,r=[],i=[];if(e.pendingSaves=null,n){for(let e,s,o,a=0;a<n;++a)[s,e]=t[a],!s.isDestroying&&s.isSaveStatePending&&(o=s.saveState({...e,immediate:!0}),o&&(r.push(o),i.push(s)));r.length&&e.trigger("save",{stateIds:r,saved:i})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,t){const n=this,{storage:r}=n,i=n.getValue(e);return null!=t?(r.setItem(e,t),n.trigger("set",{key:e,value:t,was:i})):null!==i&&(r.removeItem(e),n.trigger("remove",{key:e,was:i})),n}}const Ui=new Wi({storage:zi});Wi._instance=Ui,Wi._$name="StateProvider";const Gi=/boolean|number|string/;var Yi=e=>class extends((e||Qe).mixin(lt)){static $name="State";static configurable={stateful:{value:null,$config:{merge:"classList"}},statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null};static prototypeProperties={statefulLoaded:!1,statefulSuspended:0};afterConstruct(){super.afterConstruct(),this.stateProvider&&this.loadState()}finalizeInit(){this.stateProvider&&this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(e){this._state=e,e&&!1!==this.trigger("beforeStateApply",{state:e})&&this.applyState(e)}updateStatefulEvents(e){const t=this,n={name:"statefulEvents",thisObj:t};if(t.detachListeners(n.name),e&&("string"==typeof e?e=N.split(e):Array.isArray(e)||(e=W.getTruthyKeys(e)),e.length)){var r;for(const t of e)n[t]="onStatefulEvent";null===(r=t.ion)||void 0===r||r.call(t,n)}}get statefulId(){const e=this,{responsiveState:t}=e;let n=e.stateId;return null==n&&!1===e.hasGeneratedId&&!1!==e.stateful&&(n=e.id),n&&t&&(n=`${n}[${t}]`),n}get statefulness(){const{stateful:e}=this;return Array.isArray(e)?W.createTruthyKeys(e):e}get stateProvider(){return this._stateProvider??(this._stateId&&Wi.instance)}applyState(e){(e=this.pruneState(e))&&this.setConfig(e)}getState(){const e=this,{initialConfig:t,statefulness:n,isConstructing:r}=e,{configs:i}=e.$meta,s=r?Object.assign(Object.create(e.$meta.config),t):e;let o,a,l=null;if(n)for(o in l={},n)if(n[o]){var d;if(a=s[o],null!==(d=a)&&void 0!==d&&d.isStateful)a=a.state;else if(!r&&(W.isDate(a)&&(a=xi.format(a,"YYYY-MM-DDTHH:mm:ssZ")),i[o].equal(a,null==t?void 0:t[o])||!Gi.test(typeof a)))continue;l[o]=a}return l}loadState(e,t){"boolean"==typeof e&&(t=e,e=null);const n=this,{statefulLoaded:r}=n;if(n.isStatefulActive&&(t||!r)){const t=n.loadStatefulData(e||(e=n.statefulId));!r&&e&&(n.defaultState=n.state,n.statefulLoaded=!0),t&&(n.state=t)}}loadStatefulData(e){var t;return(e=this.isStatefulActive?e||this.statefulId:null)&&(null===(t=this.stateProvider)||void 0===t?void 0:t.getValue(e))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(e=!1){this.statefulSuspended=e?0:Math.max(this.statefulSuspended-1,0)}saveState(e){e="string"==typeof e?{id:e}:e||{};const t=this,{stateProvider:n}=t,r=e.id||t.isStatefulActive&&t.statefulId;if(r&&n){if(e.immediate){t.isSaveStatePending=!1;const{state:e}=t;!1!==t.trigger("beforeStateSave",{state:e})&&n.setValue(r,e)}else t.isSaveStatePending||(t.isSaveStatePending=!0,n.saveStateful(t,e));return r}}suspendStateful(){++this.statefulSuspended}onConfigChange({name:e,value:t,was:n,config:r}){if(super.onConfigChange({name:e,value:t,was:n,config:r}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:t}=this;(Array.isArray(t)?t.includes(e):null==t?void 0:t[e])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(e){const{statefulness:t}=this;if(t){const n={};for(const r in e)t[r]&&(n[r]=e[r]);e=n}return e}get widgetClass(){}};const qi=W.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null)),Ki={string:1,number:1};var Xi=e=>class extends(e||Qe){static $name="Identifiable";static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(e,t){const{identifiable:n}=e;n.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get:()=>n})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(e){return(this.hasGeneratedId=!e)?this.generateAutoId():e}updateId(e,t){const n=this,r=n.constructor;t&&r.unregisterInstance(n,t),n.hasGeneratedId&&!1===r.identifiable.registerGeneratedId||r.registerInstance(n,e)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(e="generatedId"){return e+(qi[e]=(qi[e]||0)+1)}static registerInstance(e,t=e.id){const{idMap:n}=this.identifiable;if(t in n&&!this.disableThrow)throw new Error("Id "+t+" already in use");n[t]=e}static unregisterInstance(e,t=e.id){const{idMap:n}=this.identifiable;Ki[typeof e]?delete n[e]:n[t]===e&&delete n[t]}static getById(e){const t=this.identifiable.idMap;if(t)return t[e]}static get registeredInstances(){const e=this.identifiable.idMap;return e?Object.values(e):[]}};const Zi=Symbol("STM_PROP"),Ji={parentIndex:1,orderedParentIndex:1};var Qi=e=>class extends(e||Qe){static $name="ModelStm";static get defaultConfig(){return{stm:null}}joinStore(e){this.stm||(this.stm=e.stm)}unjoinStore(e,t=!1){var n;this.stm===e.stm&&(this.stm=null),null===(n=super.unjoinStore)||void 0===n||n.call(this,e,t)}get stm(){return this[Zi]}set stm(e){this[Zi]=e}beforeChronoFieldSet(e,t){var n;const r=this;return r.inSetting||null===(n=r.stm)||void 0===n||!n.enabled||Ji[e]||r.constructor.nonPersistableFields[e]||!r.getFieldDefinition(e)?null:{[e]:{value:t,oldValue:r.graph.activeTransaction.readCurrentOrProposedOrPrevious(r.$[e])}}}afterChronoFieldSet(e,t,n){n&&this.afterSet(e,t,!1,!1,n,!0)}shouldRecordFieldChange(e,t,n){const r=this.firstStore;return!(this.constructor.nonPersistableFields[e]||null==t&&null==n||t===n||t instanceof Date&&n instanceof Date&&t.getTime()===n.getTime()||"id"===e||"$PhantomId"===e||"parentId"===e&&r&&r.oldIdMap[t]===r.getById(n))}afterSet(e,t,n,r,i,s){const{stm:o}=this,a=this.constructor.nonPersistableFields;if(null!=o&&o.isBase&&o.shouldRecordAction&&!Ji[e]&&!a[e]&&i){let e;const[t,n]=Object.keys(i).reduce(((t,n)=>{const{value:r,oldValue:s}=i[n];return this.shouldRecordFieldChange(n,s,r)&&(e=!0,t[0][n]=r,t[1][n]=s),t}),[{},{}]);e&&o.onModelUpdate(this,t,n,s)}}beforeInsertChild(e){var t;const n=(null===(t=super.beforeInsertChild)||void 0===t?void 0:t.call(this,e))||[],{stm:r}=this;return null!=r&&r.enabled&&n.push(e.reduce(((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e)),new Map)),n}afterInsertChild(e,t,n,r,i){var s;const{stm:o}=this;if(null!=o&&o.shouldRecordAction){const t=n.pop();r&&o.onModelInsertChild(this,e,r,t,i)}null===(s=super.afterInsertChild)||void 0===s||s.call(this,e,t,n,r)}beforeRemoveChild(e,t){const n=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],{stm:r}=this;return null!=r&&r.shouldRecordAction&&!t&&n.push(e.reduce(((e,t)=>(e.set(t,{parentIndex:t.parentIndex,orderedParentIndex:t.orderedParentIndex}),e)),new Map)),n}afterRemoveChild(e,t,n){var r;const{stm:i}=this;if(null!=i&&i.shouldRecordAction&&!n){const n=t.pop();e&&e.length&&i.onModelRemoveChild(this,e,n)}null===(r=super.afterRemoveChild)||void 0===r||r.call(this,e,t,n)}};const es={includeFilteredOutRecords:!1},ts=e=>("boolean"==typeof(e=e||!1)&&(e={includeFilteredOutRecords:e}),e||es);var ns=e=>class extends(e||Qe){static $name="TreeNode";static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}constructor(...e){super(...e),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:n,constructor:r}=this,i=null==t?void 0:t[0];if(!0===e)return!!n||[];if(e){let t=nt.asArray(e);if(!t.length)return[];const n=t.length,s=[];t=(null==i?void 0:i.cloneImmutable(t))??t;for(let e,o=0;o<n;o++)e=t[o],e=e.isModel?e:(null==i?void 0:i.createRecord(e,!1,!0))??new r(e,null,null,!0),e=(null==i?void 0:i.processRecord(e))??e,s.push(e);if(!0===this.children&&i){const e=i.createSorterFn(i.sorters);s.sort(e)}return s}}processChildren(e=this.stores){const t=this,{meta:n}=t;t.inProcessChildren=!0;const r=t.ingestChildren(t.data[t.constructor.childrenField],e);if(r){const{convertEmptyParentToLeaf:e}=t.constructor;if(!0===e||e.onLoad?r.length:Array.isArray(r)){if(n.isLeaf=!1,!0===t.children)t.children=[];else if(0===r.length)return void(t.children=r);t.insertChild(r)}else!0===r?(n.isLeaf=!1,t.children=!0):t.remoteChildCount>0?n.isLeaf=!1:t.isRoot||(n.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)}t.inProcessChildren=!1}ancestorsExpanded(e=this.firstStore){const{parent:t}=this;return null==e||!e.isTree||(!t||t.isExpanded(e)&&t.ancestorsExpanded(e))}isExpanded(e=this.firstStore){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){let e=this,t=-1;for(;e&&!e.isRoot;)++t,e=e.parent;return t}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get hierarchyModificationDataToWrite(){const{parentIdField:e}=this.constructor,t=[e,"parentIndex","orderedParentIndex"].reduce(((t,n)=>{if(n in this.meta.modified){const r=this.constructor.getFieldDefinition(n);n===e?t[(null==r?void 0:r.dataSource)??e]=this.getFieldPersistentValue(n):r.persist&&(t[r.dataSource]=this.getFieldPersistentValue(n))}return t}),{});return Object.keys(t).length>0?t:null}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore,n=!1){let{children:r}=this;return n&&this.unfilteredChildren&&(r=this.unfilteredChildren),!r||!Array.isArray(r)||e&&!this.isExpanded(t)?0:r.reduce(((r,i)=>r+i.getDescendantCount(e,t,n)),r.length)}get allChildren(){return this.getAllChildren(!1)}get allUnfilteredChildren(){return this.getAllChildren(!0)}getAllChildren(e=!1){const t=e&&this.unfilteredChildren||this.children;return t&&!0!==t?t.reduce(((t,n)=>(t.push(n),t.push.apply(t,e?n.allUnfilteredChildren:n.allChildren),t)),[]):[]}get firstChild(){const{children:e}=this;return(null==e?void 0:e.length)&&e[0]||null}get lastChild(){const{children:e}=this;return(null==e?void 0:e.length)&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get previousOrderedSibling(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.orderedChildren[this.orderedParentIndex-1])??null}get nextOrderedSibling(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.orderedChildren[this.orderedParentIndex+1])??null}get root(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){this.setParentId(e)}setParentId(e){const t=this,{firstStore:n}=t;if(n){const{parent:r}=t,i=null===e?n.rootNode:n.getById(e);i!==r&&(r||i)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:i?i.appendChild(t):r.removeChild(t))}else t.setData(t.constructor.parentIdField,e)}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(e){let t;return t=e.includeFilteredOutRecords?this.unfilteredChildren||this.children:e.useOrderedTree?this.orderedChildren:this.children,t}traverse(e,t,n){n=ts(n);const r=this,i=r.getChildren(n);t||e.call(r,r);for(let t=0,r=null==i?void 0:i.length;t<r;t++)i[t].traverse(e,!1,n)}traverseBefore(e,t,n){n=ts(n);const r=this,i=r.getChildren(n);for(let t=0,r=null==i?void 0:i.length;t<r;t++)i[t].traverse(e,!1,n);t||e.call(r,r)}traverseWhile(e,t,n){n=ts(n);const r=this;let i=t||!1!==e.call(r,r);if(i){const t=r.getChildren(n);null!=t&&t.length&&(i=t.every((t=>t.traverseWhile(e,!1,n))))}return i}bubble(e,t=!1){let n=this;for(t||e.call(n,n);n.parent;)n=n.parent,e.call(n,n)}bubbleWhile(e,t=!1){let n=this,r=!0;for(t||(r=e.call(n,n));r&&n.parent;)n=n.parent,r=e.call(n,n);return r}contains(e,t=!1,n=void 0){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile((t=>t.id!=e),t,n)}getTopParent(e){let t;return e?(t=[],this.bubbleWhile((e=>(t.push(e),e.parent&&!e.parent.isRoot)))):(t=null,this.bubbleWhile((e=>(t=e,e.parent&&!e.parent.isRoot)))),t}appendChild(e,t=!1,n={}){return this.insertChild(e,null,t,n)}insertChild(e,t=null,n=!1,r={}){var i,s,o,a,l;const d=this,c=Array.isArray(e);var u,h;"number"==typeof t&&(t=(null===(u=d.children)||void 0===u?void 0:u[t])??null);if(d.isLinked&&!d.meta.isFillingFromMaster)return d.$original.insertChild(e,null===(h=t)||void 0===h?void 0:h.$original,n,r);if(e=nt.asArray(e),!n&&!1===(null===(i=d.stores)||void 0===i?void 0:i.every((t=>!1!==t.trigger("beforeAdd",{records:e,parent:d})))))return null;e=d.ingestChildren(e);const g=(null===(s=t)||void 0===s?void 0:s.parentIndex)??(null===(o=d.children)||void 0===o?void 0:o.length)??0,m=null===(a=d.beforeInsertChild)||void 0===a?void 0:a.call(d,e),p=d.internalAppendInsert(e,t,n,r);return p.length&&d.convertToParent(n),null===(l=d.afterInsertChild)||void 0===l||l.call(d,g,e,m,p,r.orderedBeforeNode),c||!p?p:p[0]}convertToParent(e=!1){const t=this,n=t.isLeaf;t.meta.isLeaf=!1,t.children||(t.children=[]),!n||t.root.isLoading||e||t.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(e,t=this.stores){null==t||t.forEach((t=>{t.trigger("update",{record:this,records:[this],changes:e}),t.trigger("change",{action:"update",record:this,records:[this],changes:e})}))}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,n,r){const i=this,{stores:s,root:o,children:a}=i,{firstStore:l}=o,{parentIdField:d}=i.constructor,c=i.id;let u,h,g,m,p,f={};if(!o.isLoading&&l)for(p=[],g=0;g<e.length;g++){const t=e[g];f[t.id]=t.root===o,p[g]=t.parentIndex}if(t&&t.parent!==i&&(t=null),a){const n=t?t.parentIndex:a.length;if(a[h=n]===e[0]||a[h=n-1]===e[0])for(u=!0,g=0;u&&g<e.length;g++)e[g]!==a[h+g]&&(u=!1)}if(u)return e;for(g=0;g<e.length;g++){const t=e[g],s=t.parent;l&&!o.isLoading&&t.traverse((e=>{e.root===o&&(f[e.id]=!0)}));const a=Boolean(f[t.id]),u=s===i&&a;if(!1===(null==s?void 0:s.removeChild(t,a,n,{isInserting:!0,skipIndexUpdate:u,...r})))m||(e=e.slice(),m=!0),e.splice(g--,1);else{t.parent=i,t.setData("parentId",c);const{meta:e}=t;e.modified[d]!==c||s||(e.oldParentId=c),s&&(e.oldParentId=s.id)}}if(e.length){Array.isArray(a)||(i.children=[]),Array.isArray(i.orderedChildren)||(i.orderedChildren=[]);const o=i.addToChildren(t,e,r);null==s||s.forEach((t=>{t.isChained&&!t.isChainedTree||(e.forEach((e=>e.joinStore(t))),t.onNodeAddChild(i,e,o,f,n),e.forEach(((e,r)=>{if(null!=e.meta.oldParentId&&(!i.inProcessChildren&&!i.isLoading||f[e.id])){const s={[d]:c,[i.getDataSource("parentIndex")]:e.parentIndex},o={},{modified:a,oldParentId:l}=e.meta,u=p[r];if(delete e.meta.oldParentId,i.id!==l&&(o[d]={value:c,oldValue:l}),e.parentIndex!==u&&(o.parentIndex={value:e.parentIndex,oldValue:u}),a[d]===i.id?Reflect.deleteProperty(a,d):d in a||(a[d]=l),f[e.id]){const e=t.getById(l);e.isLeaf&&!n&&e.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[t])}e.afterChange(s,o)}e.traverse((e=>{e.ignoreBag||e.isLinked||t.updateModifiedBagForRecord(e)}))})))}))}return e}removeChild(e,t=!1,n=!1,r={}){var i,s,o;const a=this,l=[],d=a.isLeaf,{children:c,stores:u}=a;if(e=(e=nt.asArray(e)).filter((e=>e.parent===a)),null!==(i=a.firstStore)&&void 0!==i&&i.isChainedTree)return a.$original.removeChild(e.map((e=>e.$original)),t,n,r);if(!n&&u)for(const n of u)if(!n.isChained&&!1===n.trigger("beforeRemove",{parent:a,records:e,isMove:t}))return!1;const h=null===(s=a.beforeRemoveChild)||void 0===s?void 0:s.call(a,e,t);for(const i of e){const{parentIdField:e}=i.constructor,{modified:s}=i.meta,o=i.parent?i.parent.id:null;e in s||i.isLinked||(s[e]=o);const d=a.removeFromChildren(i,r);null==u||u.forEach((e=>{if(!e.isChained){const{isRemoving:s}=e;e.isRemoving=!0,l.push(...e.onNodeRemoveChild(a,[i],d,{isMove:t,silent:n,...r})),e.isRemoving=s}})),t||(i.parent=i.parentIndex=i.unfilteredIndex=i.nextSibling=i.previousSibling=null,i.data[e]=null)}return 0===(a.unfilteredChildren||c).length&&a.constructor.convertEmptyParentToLeaf.onRemove&&!a.isRoot&&(a.meta.isLeaf=!0),a.isLeaf===d||n||t||a.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),null===(o=a.afterRemoveChild)||void 0===o||o.call(a,e,h,t),l}clearParentId(){const e=this,{parentIdField:t}=e.constructor;Reflect.deleteProperty(e.data,t),Reflect.deleteProperty(e.originalData,t),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,t)}replaceChildren(e){return this.clearChildren(),this.data[this.constructor.childrenField]=e,this.processChildren(),this.children}clearChildren(e=!1){const t=this,{stores:n}=t,r=t.unfilteredChildren||t.children;t.children=[],t.orderedChildren=[],r&&!0!==r&&n&&n.forEach((n=>{n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]);const{convertEmptyParentToLeaf:i}=t.constructor;(!0===i||i.onRemove)&&(t.meta.isLeaf=!0)}clear(){var e;const t=this,{stores:n}=t,r=null===(e=t.unfilteredChildren||t.children)||void 0===e?void 0:e.slice();if(t.isRoot&&r){for(const e of n)if(!e.isChained&&!1===e.trigger("beforeRemove",{parent:t,records:r,isMove:!1,removingAll:!0}))return!1;t.children.length=t.orderedChildren.length=0,t.unfilteredChildren&&(t.unfilteredChildren.length=0),n.forEach((e=>{r.forEach((t=>{t.stores.includes(e)&&t.unjoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}updateChildrenIndices(e,t,n=!1){let r=null;for(let o=0;o<e.length;o++){const a=e[o],l=a[t];if("parentIndex"===t||"orderedParentIndex"===t){if(void 0===l||n)a.setData(t,o);else if(l!==o){var i,s;null===(i=a.stores)||void 0===i||i.forEach((e=>{e.suspendSortOnUpdate(),e.suspendFilterOnUpdate()})),a.set(t,o,!0),null===(s=a.stores)||void 0===s||s.forEach((e=>{e.resumeSortOnUpdate(!1),e.resumeFilterOnUpdate(!1)}))}}else a[t]=o;"parentIndex"===t&&(a.previousSibling=r,r&&(r.nextSibling=a),o===e.length-1&&(a.nextSibling=null),r=a)}}addToChildren(e,t,n={}){const r=this,i=[[r.children,"parentIndex",e],[r.unfilteredChildren,"unfilteredIndex",e],[r.orderedChildren,"orderedParentIndex",void 0===(null==n?void 0:n.orderedBeforeNode)?void 0!==(null==n?void 0:n.orderedParentIndex)?r.orderedChildren[n.orderedParentIndex.index??n.orderedParentIndex]:e:null==n?void 0:n.orderedBeforeNode]];for(const e of i){const[i,o,a]=e;if(i){var s;let l;a?(l=i.indexOf(a),-1===l&&(l=i.length)):l=i.length,e.push(l),i.splice(l,0,...t),null!=n&&n.skipIndexUpdate||null!=n&&null!==(s=n[o])&&void 0!==s&&s.skip||r.updateChildrenIndices(i,o)}}return i[0][3]}removeFromChildren(e,t){const n=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const i of n){const[n,s]=i;if(n){const o=n.indexOf(e);var r;if(i.push(o),o>-1)n.splice(o,1),null!=t&&t.skipIndexUpdate||null!=t&&null!==(r=t[s])&&void 0!==r&&r.skip||this.updateChildrenIndices(n,s)}}return n[0][2]}sortOrderedChildren(e=!0,t=!1){const n=[];return this.isLeaf||(this.orderedChildren.sort(((e,r)=>{if(t){const t=(e.meta.modified.orderedParentIndex??e.orderedParentIndex)-(r.meta.modified.orderedParentIndex??r.orderedParentIndex);return 0!==t&&(n.push(e),n.push(r)),t}return e.orderedParentIndex-r.orderedParentIndex})),e&&this.orderedChildren.forEach((r=>{n.push(...r.sortOrderedChildren(e,t))})),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(n)}sortVisibleChildren(e=!0,t){const n=this;n.isLeaf||(n.children.sort(t),e&&n.orderedChildren.forEach((n=>n.sortVisibleChildren(e,t))),n.updateChildrenIndices(n.children,"parentIndex",!0))}sortUnfilteredChildren(e=!0,t){const n=this;!n.isLeaf&&n.unfilteredChildren&&(n.unfilteredChildren.sort(t),e&&n.orderedChildren.forEach((n=>n.sortUnfilteredChildren(e,t))),n.updateChildrenIndices(n.unfilteredChildren,"unfilteredIndex",!0))}unjoinStore(e,t=!1){var n;const r=this;r.unfilteredChildren&&(r.children=r.unfilteredChildren.slice(),r.unfilteredChildren=null),null===(n=super.unjoinStore)||void 0===n||n.call(this,e,t)}};const rs={id:1,internalId:1,stores:1,unjoinedStores:1,parentIndex:1,parent:1,unfilteredChildren:1,children:1,orderedChildren:1,parentId:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},is={get(e,t){switch(t){case"proxyMeta":return this.proxyMeta;case"constructor":return e.constructor;case"setData":return this.setDataOverride;case"set":return this.setOverride;case"instanceMeta":return this.instanceMetaOverride}return rs[t]?this.proxyMeta.data[t]:Reflect.get(e,t,this.proxyRecord)},set(e,t,n,r){return"parentId"===t?r.setParentId(n):rs[t]?this.proxyMeta.data[t]=n:e[t]=n,!0},instanceMetaOverride(e){const{proxyMeta:t}=this,n=e.id||e,r=t.map||(t.map=W.clone(t.originalRecord.instanceMeta(n)));return r[n]||(r[n]={})},setDataOverride(e,t){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:"parentId"===e?this.proxyMeta.data.parentId=t:this.proxyMeta.originalRecord.setData(e,t)},setOverride(e,t,...n){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.set(e,t,...n)}};var ss=e=>class extends(e||Qe){static $name="ModelLink";static isModel=!0;link(){if(this.isLinked)return this.$original.link();const e=this,t={...is,proxyMeta:{originalRecord:e,data:{id:`${e.id}_link_${e.constructor._internalIdCounter}`,internalId:e.constructor._internalIdCounter++,stores:[],unjoinedStores:[],...e.children?{unfilteredChildren:[],children:[],orderedChildren:[]}:{}}}},n=new Proxy(e,t);return t.proxyRecord=n,(e.meta.linkedRecords||(e.meta.linkedRecords=[])).push(n),n}get isLinked(){var e;return Boolean(null===(e=this.proxyMeta)||void 0===e?void 0:e.originalRecord)}get hasLinks(){return Boolean(!this.proxyMeta&&this.$links.length)}removeLink(e,t=null,n=!1){if(e.hasLinks)for(const r of e.$links.slice())t?nt.include(t,r):r.remove(n);else e.isLinked&&nt.remove(e.$original.$links,e)}beforeRemove(e){this.removeLink(this,e)}removeChild(e,t,n,r){if(null==r||!r.isInserting){e=nt.asArray(e);for(const t of e)this.removeLink(t,null,n)}return super.removeChild(e,t,n,r)}get $originalId(){return this.$original.id}get $links(){return this.meta.linkedRecords??[]}};const{defineProperty:os}=Reflect,as=Symbol("owner"),ls=/[\s,]+/;var ds=e=>class extends(e||Qe){static $name="Factoryable";static get declarable(){return["factoryable","alias","type"]}static register(e,t,n=globalThis.__BRYNTUM_EXAMPLE||(e=>null===(e=globalThis.DocsBrowser)||void 0===e?void 0:e.isDocsBrowser)()){const{factoryable:r}=this.initClass(),{caseless:i,registry:s}=r,o=N.split(e,ls);for(let e,a,l=0;l<o.length;++l){if(a=o[l],e=i?a.toLowerCase():a,!n&&e in s)throw new Error(`Type "${a}" already registered with ${r.class.name} factory`);s[a]=s[e]=t.initClass()}}static isA(e,t){return this.isType(e,t,!0)}static isType(e,t,n){const{factoryable:r}=this,{caseless:i,registry:s}=r,o=s[i?t.toLowerCase():t];return!!o&&(n?e instanceof o:e.constructor===o)}static setupAlias(e){e.register(e.alias,e)}static setupFactoryable(e,t){const n=t.super.class;let{factoryable:r}=e;r={caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type",...r},r.class=e,r.registry=Object.create(null),r.extends&&!Array.isArray(r.extends)&&(r.extends=[r.extends]),os(e,"factoryable",{get:()=>r})}static setupType(e,t){const{type:n}=e;e.register(n,e,t.replaceType),os(e.prototype,"type",{get:()=>n,set:e=>{if(e!==n)throw new Error("Can not mutate `type` config to different value")}})}static create(e,t){return this.reconfigure(null,e,t)}static reconfigure(e,t,n){const r=this,{factoryable:i}=r,{typeKey:s}=i;let o,a,l,d,c,u,h,g,m,p=n;if(n&&!W.isClass(n)&&(p=null,h=typeof n,"function"===h?u=n:"string"===h?p=n:W.isObject(n)?(o=n.cleanup,a=n.defaults,d=n.owner,u=n.setup,p=n.type,g=n.transform):d=n),g&&(t="string"==typeof g?d[g](t):g(t)),m=t,"string"==typeof m)t={};else if(t){if(!0===t&&(t={}),!W.isObject(t)){var f;if(d&&t!==e&&(null==e?void 0:e[as])===d)"string"==typeof o?d[o](e):null===(f=o)||void 0===f||f(e),e.destroy();return t}m=t[s]}if(m=m&&r.resolveType(m),e){if(t&&(!m||e.constructor===m))return s in t&&delete(t=W.assign({},t))[s],e.setConfig(t),e;var v;if(d&&e[as]===d)"string"==typeof o?d[o](e):null===(v=o)||void 0===v||v(e),e.destroy()}if(t){if(a){if(!(l=m)){if(!(l=a[s]||p||i.defaultType))throw new Error(`No default mergeType defined for ${i.class.name} factory`);l=r.resolveType(l)}l&&(t=l.mergeConfigs(a,t))}if(u){if(c="string"==typeof u?d[u](t,m,a):u(t,m,a),null===c)return c;t=c||t}if(!m){if(!(m=t[s]||p||i.defaultType))throw new Error(`No default type defined for ${i.class.name} factory`);m=r.resolveType(m)}a&&!l&&(t=m.mergeConfigs(a,t)),s in t&&delete(t=W.assign({},t))[s],t=new m(t),d&&(t[as]=d)}return t||null}static resolveType(e,t){if("string"!=typeof e)return e;const{factoryable:n}=this,r=n.extends;let i,s=n.registry[n.caseless?e.toLowerCase():e];for(i=0;!s&&r&&i<r.length;++i)s=r[i].resolveType(e,!0);if(!s&&!t)throw new Error(`Invalid type name "${e}" passed to ${n.class.name} factory`);return s}};const cs=/^([A-Z]+)(?:F|f)ormula/,us=/^(.*)$/,hs={this:1,data:1},gs=e=>{var t;return null===(t=e.fields)||void 0===t?void 0:t.reduce(((t,n)=>{if(n.persist){e.get(n.name)&&(t[n.name]=String(e.get(n.name)))}return t}),{})};class ms extends(Qe.mixin(ds,lt)){static $name="FormulaProvider";static type="formula";static configurable={callOnFunctions:!0,record:null,store:null,inputField:{$config:"nullify",value:null},handleFormulaInput:null,handleFormulaChange:null,url:null,method:"POST",fetchOptions:null,paramName:"prompt",responseField:"content",headers:{Accept:"application/json","Content-Type":"application/json"},generateContent:null,prefix:null};static factoryable={defaultType:"formula"};fieldMatchRE=/\$([a-zA-Z\-_]+)/g;fieldDelimiterRE=/[^a-zA-Z\-$_]/;changeHeaders(e){return W.clone(e)}updateInputField(e,t){var n;return null===(n=this.inputListenerRemover)||void 0===n||n.call(this),e&&(this.inputListenerRemover=e.ion({thisObj:this,input:"onFieldInput",change:"onFieldChange"})),this.owner=e}onFieldInput(){var e;const t=this,{inputField:n}=t,r=(null===(e=t.store)||void 0===e?void 0:e.modelClass)||(t.record||n.record).constructor,i=t.fieldNames||(t.fieldNames=Object.keys(hs).concat(Object.keys(r.fieldMap)));if(n.formulaProvider===t){var s,o,a;const e=null===(s=n.getCurrentToken(t.fieldDelimiterRE))||void 0===s?void 0:s.token,l=null!=e&&e.startsWith("$")?e.substring(1):null,d=null===(o=n.value.matchAll(t.fieldMatchRE))||void 0===o||null===(a=o.reduce)||void 0===a?void 0:a.call(o,((e,[,t])=>(t===l?i.some((e=>e.startsWith(t)))||e.push(t):hs[t]||r.fieldMap[t]||e.push(t),e)),[]);null!=d&&d.length?n.setError(`Undefined data field(s) ${d.join(",")}`,!1,!0):n.clearError();const c=t.resolveCallback(t.handleFormulaInput,t,!1);null==c||c.handler.call(c.thisObj,n,this)}}onFieldChange(){var e;const t=this,{inputField:n}=t,{value:r}=n,i=t.formulaRE?null===(e=r.trim().match(t.formulaRE||t.constructor.formulaRE||us))||void 0===e?void 0:e[1]:r,s=t.resolveCallback(t.handleFormulaChange,t,!1);if(i&&s){const e=t.createFormula(i,t.record||n.record,t.store);null==s||s.handler.call(s.thisObj,t,e,n)}}async calculate(e){return this.callback(this.generateContent,this,[e])}updatePrefix(e){this.formulaRE=new RegExp(`^=${e}\\((.+)\\)$`)}updateUrl(e){this.generateContent=e?this.getRemoteContent:null}async getRemoteContent(e){let t;try{const n=this,{method:r,headers:i}=n,s={...n.body};W.setPath(s,n.paramName,e);const o=await vr.fetch(n.url,W.assign({credentials:void 0,method:r,headers:i,body:JSON.stringify(s)},n.fetchOptions));if(!o.ok)return n.trigger("formulaNetworkError",{response:o,bubbles:!0}),"";t=await o.json()}catch(e){console.error("Error:",e)}return W.getPath(t,this.responseField)}createFormula(e,t,n){const r={formula:e.replaceAll(this.fieldMatchRE,((e,r)=>{switch(r){case"this":return JSON.stringify(gs(t));case"data":return JSON.stringify(n.allRecords.map((e=>gs(e))));default:return t.get(r)??""}}))};return this.trigger("formulaChange",r),r.formula}get store(){var e;return this._store||(null===(e=this.record)||void 0===e?void 0:e.firstStore)}static get(e,t){var n;let r=null===(n=this.map)||void 0===n?void 0:n.get(e);return r&&t&&(r=new r(t)),r}static initClass(){var e;const t=ms,n=this,r=n===t?"FORMULA":(null===(e=n.$name)||void 0===e||null===(e=e.match(cs))||void 0===e?void 0:e[1])||n.formulaPrefix;if(r){n.formulaPrefix||(n.formulaPrefix=r),n.inputPrefixRE=new RegExp(`^=${r}\\(.*`),n.formulaRE=new RegExp(`^=${r}\\((.+)\\)`),(t.map||(t.map=new Map)).set(r,n);const e=[...t.map.keys()].map((e=>e)).join("|");t.inputPrefixRE=new RegExp(`^=(${e})\\(.*`)}return super.initClass()}}ms.initClass(),ms._$name="FormulaProvider";const{getOwnPropertyDescriptor:ps}=Reflect;class fs extends(Qe.mixin(ds)){static $name="DataField";static type="auto";static factoryable={defaultType:"auto"};static prototypeProperties={compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1,calculated:!1,calculate:null,useProp:null,bypassEqualityOnSyncDataset:!1,complexMapping:null};static configurable={formulaProviders:null};construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(e,n)=>t.compare(null==e?void 0:e[t.name],null==n?void 0:n[t.name]))}changeFormulaProviders(e){const t=this;return new Proxy({...e},{set(e,n,r){const i=Reflect.set(e,n,r);return t.updateFormulaProviders(e),i}})}updateFormulaProviders(e){this.inputPrefixRE=e?new RegExp(`^=(${Object.keys(e).join("|")})\\(.*`):null}getFormulaProvider(e){const t=this.formulaProviders[e];if(t){if(t.isFormulaProvider)return t;let{instance:n}=t;if(!n){const r={...t,prefix:e};n=t.instance=ms.get(e,r)||ms.create(r)}return n}}get label(){return this._label||N.separate(this.name)}set label(e){this._label=e}defineAccessor(e,t){const{name:n,dataSource:r}=this;!t&&n in e&&e.$meta.hierarchy.some((e=>{var t;return!1===(null===(t=ps(e.prototype,n))||void 0===t?void 0:t.enumerable)}))||(this.formulaProviders&&e.$meta.class.addField(`#${n}`),Reflect.defineProperty(e,n,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(n,r)}:function(){return this.batching&&n in this.meta.batchChanges?this.meta.batchChanges[n]:this.data[r]},set(e){const t=this.$meta.fields.map[n];t&&t.readOnly||this.set(n,e)}}))}isEqual(e,t){return W.isEqual(e,t)}print(e){return null==e?this.nullText:this.printValue(e)}printValue(e){return String(e)}getCurrentConfig(){const e={};for(const t in this.constructor.prototypeProperties)e[t]=this[t];return delete e.isConstructing,e}get calculated(){return Boolean(this.calculate||this._calculated)}set calculated(e){this._calculated=e}get calculate(){return this._calculate}set calculate(e){"function"==typeof e&&(e={fn:e}),this._calculate=e}}fs._$name="DataField";class vs extends fs{static $name="ArrayDataField";static type="array";static dataConstructor=Array;isEqual(e,t){return e===t}getAt(e,t){return e.get(this.name)[t]}}vs.initClass(),vs._$name="ArrayDataField";class ys extends fs{static $name="BooleanDataField";static type="boolean";static dataConstructor=Boolean;static alias="bool";static get prototypeProperties(){return{nullValue:!1}}isEqual(e,t){return null==e&&null==t||super.isEqual(e,t)}convert(e){var t;return null==e?this.nullable?e:this.nullValue:"false"!==(null===(t=e.toLowerCase)||void 0===t?void 0:t.call(e))&&Boolean(e)}}ys.initClass(),ys._$name="BooleanDataField";class bs extends fs{static $name="DateDataField";static type="date";static dataConstructor=Date;static get prototypeProperties(){return{format:null}}convert(e){if(null==e)this.nullable||(e=this.nullValue);else if("now"===e)e=new Date;else if(!(e instanceof Date)){const t=e;(e=xi.parse(e,this.format||xi.defaultParseFormat))&&!isNaN(e)||(e=void 0,""!==t&&console.warn(`Date parsing failed for "${this.name}" field, input: ${JSON.stringify(t)}. ${this.format?`Expected format: ${this.format}.`:'You should configure your Model field with a "format" to specify how dates should be parsed. See docs for DateDataField here: https://bryntum.com/products/scheduler/docs/api/Core/data/field/DateDataField, and see https://bryntum.com/products/scheduler/docs/api/Core/helper/DateHelper for the different formats.'}"`))}return e}serialize(e){return e instanceof Date&&(e=xi.format(e,this.format||xi.defaultFormat)),e}printValue(e){return xi.format(e,this.format||xi.defaultFormat)}}bs.initClass(),bs._$name="DateDataField";class Cs extends fs{static $name="StringDataField";static type="string";static dataConstructor=String;static get prototypeProperties(){return{nullValue:""}}convert(e){return null==e?this.nullable?e:this.nullValue:String(e)}}Cs.initClass(),Cs._$name="StringDataField";class ws extends Cs{static $name="DurationUnitDataField";static type="durationunit";isEqual(e,t){return 0===xi.compareUnits(e,t)}}ws.initClass(),ws._$name="DurationUnitDataField";class Ss extends fs{static $name="IntegerDataField";static type="integer";static alias="int";static dataConstructor=Number;static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}Ss.initClass(),Ss._$name="IntegerDataField";class Ds extends fs{static $name="ModelDataField";static type="model";static configurable={modelClass:null};static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,t){return e&&t&&t instanceof e.constructor&&t.id==e.id}}Ds.initClass(),Ds._$name="ModelDataField";class Es extends fs{static $name="NumberDataField";static type="number";static alias="float";static dataConstructor=Number;static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,t){return isNaN(Number(e))&&isNaN(Number(t))||super.isEqual(e,t)}convert(e){if(null==e)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}}Es.initClass(),Es._$name="NumberDataField";class xs extends fs{static $name="ObjectDataField";static type="object";static dataConstructor=Object;static get prototypeProperties(){return{complexMapping:!0}}}xs.initClass(),xs._$name="ObjectDataField";const Rs=e=>"string"==typeof e&&e.startsWith("_generated");class Ts extends fs{static $name="StoreDataField";static type="store";init(e,t,n){var r;const i=this,s=`${i.name}Store`,o={skipStack:!0,syncDataOnLoad:!0,useRawData:!1};if(i.store&&W.assign(o,i.store),i.modelClass&&(o.modelClass=i.modelClass),null===(r=t[`init${N.capitalize(s)}`])||void 0===r||r.call(t,o),!o.storeClass&&!i.storeClass)throw new Error(`Field '${i.name}' with type 'store' must have a storeClass configured`);const a=t.meta[s]=new(o.storeClass||i.storeClass)(o);i.complexMapping?W.setPath(e,i.dataSource,a):e[i.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=i.usesId||!a.count||!a.every((e=>e.hasGeneratedId)),a.$currentValue=i.getValue(a,t),a.ion({change:({action:e})=>{const n=i.getValue(a,t);if(!a.$isSettingStoreFieldData){const r=a.$preserveCurrentDataset;a.$preserveCurrentDataset=i.subStore&&("update"===e||"remove"===e||"add"===e),i.$isUpdatingRecord=!0,t.set(i.name,n),i.$isUpdatingRecord=!1,a.$preserveCurrentDataset=r}a.$currentValue=n}}),i.$chrono&&n(i,a)}set(e,t,n){var r,i;const s=this,o=`${s.name}Store`,{[o]:a}=n.meta;if(null!==(r=e)&&void 0!==r&&r.isStore&&(e=e.$currentValue),!a)return n.meta.initableValues.set(s,e),!1;a.$isSettingStoreFieldData||(a.$isSettingStoreFieldData=!0,e=(null===(i=n[`process${N.capitalize(o)}Data`])||void 0===i?void 0:i.call(n,e,n))??e,a.$preserveCurrentDataset||(a.data=e),a.$isSettingStoreFieldData=!1,a.usesId=s.usesId||!a.count||!a.every((e=>e.hasGeneratedId)))}serialize(e,t){const n=t.meta[`${this.name}Store`];return this.$isUpdatingRecord?this.getValue(n,t):n.$currentValue}getValue(e,t){const n=`get${N.capitalize(this.name)}StoreValue`;return t[n]?t[n](e):e.allRecords.map((t=>{const n=t.persistableData;return e.usesId||delete n.id,n}))}isEqual(e,t){if(null==e&&null==t)return!0;if(null==e&&null!=t||null!=e&&null==t)return!1;if(e.isStore&&t.isStore)return W.isDeeplyEqual(e.$currentValue,t.$currentValue);if(e.isStore&&t.isStore||!e.isStore&&!t.isStore)return W.isEqual(e,t,!0);{const n=(e.isStore?e:t).modelClass,r=n.$meta.fields.defs,i=e.isStore?e.$currentValue:t.$currentValue,s=e.isStore?t:e;if(i.length!==s.length)return!1;for(let e=0;e<r.length;e++){const t=r[e];if(t.persist)for(let e=0;e<i.length;e++){const r=i[e][t.dataSource],o=s[e][t.dataSource];if(void 0!==r&&void 0===o){if(t.dataSource===n.idField&&Rs(r))continue;if(void 0!==t.defaultValue&&W.isEqual(t.defaultValue,r,!0))continue}if(!W.isEqual(r,o,!0))return!1}}return!0}}getOldValue(e){const t=e.meta[`${this.name}Store`];return t?W.clone(t.$currentValue):null}getAt(e,t){const n=e.meta[`${this.name}Store`];return null==n?void 0:n.getAt(t)}}Ts.initClass(),Ts._$name="StoreDataField";const Ms=/^(.*?)\.(.*)/,ks=/(.*)\[(.*)]\.?(.*)/,{defineProperty:Fs}=Reflect,{hasOwn:Is}=W,As=void 0,Ls={children:1,data:1,meta:1},Ps=["name","title","text","label","description"],Os={boolean:1,number:1,date:1,object:1},$s={parentId:1,$PhantomId:2,id:3};class _s extends(Qe.mixin(Qi,ns,ss)){static $name="Model";static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static relations=null;static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}get id(){return this._id??this.getData("id")}set id(e){this.set("id",e)}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(null==e?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let t=this,n=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[n--]=t.parentIndex+1;return e}construct(e={},t=null,n=null,r=!1,i=!1,s=!1){var o;const a=this,{constructor:l,fieldMap:d}=a;if(a.meta={modified:{},...l.metaConfig,...n},l.applyConfigs){const t={};a.useRawData&&a.useRawData.enabled||(e={...e});const n=a.getDefaultConfiguration();if(l.autoExposeFields)for(const r in n)r in e&&(void 0!==e[r]&&(t[r]=e[r]),delete e[r]);else for(const r in e)r in l.fieldMap||(void 0===e[r]?t[r]=n[r]:t[r]=e[r],delete e[r]);super.construct(t)}if(r||l.exposeProperties(e,s),!Is(l,"idFieldProcessed")){let e=a.meta.idField;e||l._assignedIdField&&(e=l.idField),e&&e!==d.id.dataSource&&l.addField({name:"id",dataSource:e,internal:!0}),l._idField=d.id.dataSource,l.idFieldProcessed=!0}a._internalId=_s._internalIdCounter++,a.originalData||(a.originalData=e);const c=l.processData(e,!1,t,a,i);a._id=d.id.complexMapping?W.getPath(c,l._idField):c[l._idField],(null===(o=a.meta.initableValues)||void 0===o?void 0:o.size)&&a.assignInitables(),null!=a._id||l.allowNullId&&null===a._id||a.setData("id",a.generateId(t)),c[l.childrenField]&&a.processChildren(nt.asArray(t)??[]),a.generation=0}set isCreating(e){const t=this;var n;Boolean(t.meta.isCreating)!==e&&(t.meta.isCreating=e,null===(n=t.stores)||void 0===n||n.forEach((n=>n.onIsCreatingToggle(t,e))))}get isCreating(){return Boolean(this.meta.isCreating)}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,n=0,{length:r}=t;n<r;n++){const r=t[n],{name:i}=r;if("id"!==i&&!r.isEqual(this.getValue(i),e.getValue(i)))return!1}return!0}return!1}static processData(e,t=!1,n,r,i){const s=this,{map:o,defaults:a,chronoProps:l}=s.$meta.fields,{useRawData:d={enabled:!1}}=n||{},c=i||d.enabled?e:W.clone(e),u=Boolean(r.$entity);let h,g;if(r.isConstructing&&(r.data=c),u&&!t){g={};for(const e of l)g[e.name]=r.createFieldIdentifier(e);Object.defineProperty(r,"$",{value:g,enumerable:!0,configurable:!0})}const m=t||d.disableDefaultValue||i;if(!m||!d.disableTypeConversion&&!i||u)for(h in o){const n=o[h],{name:s,dataSource:l}=n,u=l!==s,p=n.complexMapping,f=p?W.getPath(c,l):c[l],v=void 0===f?p?W.getPath(c,s):c[s]:void 0,y=void 0!==f,b=void 0!==v,C=!y&&b,w=y||b,S=!d.disableTypeConversion&&n.convert;let D=C?v:f;if(!m&&l in a&&!w&&!n.fromData){let e=a[l];Array.isArray(e)?e=e.slice():e instanceof Date?e=new Date(e):e&&"object"==typeof e&&(e=W.clone(e)),p?W.setPath(c,l,e):c[l]=e,D=e}if((C||S)&&(!m||w)&&!i&&!n.calculate){const t=S?n.convert(D,e,r):D;(void 0!==t||void 0!==D||y)&&(p?W.setPath(c,l,t):c[l]=t,u&&delete c[s],D=t)}if(!t&&n.$chrono){(g[s]=r.createFieldIdentifier(n.$chrono)).DATA=D}}return s.$meta.fields.calculated.forEach((e=>{const{calculate:t}=e;if(!e._cachedDependencies&&!t.dependsOn){e._cachedDependencies=!0;const n=new Set,i=new Proxy(c,{get:(e,t)=>(n.add(t),c[t])});let o;try{t.fn(i,r),t.dependsOn=Array.from(n),s.setupDependentCalcFields(e),o=0===n.size}catch(e){o=!0}o&&console.warn(`Failed to auto-detect dependent fields for "${e.name}" field. Add "dependentOn" in your calculate config.`)}c[e.name]=r.refreshCalculatedField(e)})),s.$meta.fields.initable.length&&s.initInitables(r,c,((e,t)=>{(g[e.name]=r.createFieldIdentifier(e.$chrono)).DATA=t})),c}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var n;const r=Is(e,"fields")&&e.fields,i=t.super.fields,s=t.fields={defs:(null==i?void 0:i.defs.slice())??[],calculated:(null==i?void 0:i.calculated.slice())??[],exposedData:!1,defaults:i?{...i.defaults}:{},exposed:Object.create((null==i?void 0:i.exposed)??null),ordinals:Object.create((null==i?void 0:i.ordinals)??null),map:i?{...i.map}:{},sources:i?{...i.sources}:{},chronoProps:[],subModels:[]};if(e!==_s){let n=t;do{n=n.super,n.fields.subModels.push(e)}while(n.class!==_s)}if(Is(e,"defaults")&&Object.assign(s.defaults,e.defaults),Is(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),s.exposed[e.idField]=!0),null!=r&&r.length&&r.map(e.addField,e),s.initable=s.defs.filter((e=>e.init)),null!==(n=e.$entity)&&void 0!==n&&n.allFields.size)for(const t of e.$entity.allFields.values())s.map[t.name]||s.chronoProps.push(t);e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,t=!0){const n=this,r=n.$meta.fields,i=t?"exposed":"map";if(e&&n.autoExposeFields&&!r.exposedData){let t,s,o;for(t in e)r[i][t]||t===n.childrenField||(o=W.typeOf(e[t]),s={name:t,dataSource:t,fromData:!0},Os[o]&&(s.type=o),n.addField(s));r.exposedData=!0}n.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this.initClass(),n=t.$meta.fields,{ordinals:r,calculated:i,subModels:s}=n,o=n.exposed,{name:a}=e,l=n.map[a],d=e.dataSource||(e.dataSource=a);let c,u;var h;if(!l||e.type&&e.type!==l.type)e.model=t,c=fs.create(e),e.model=null,c.definedBy=l?l.definedBy:t,c.ordinal=l?l.ordinal:r[a]=n.defs.length,null!==(h=c.calculate)&&void 0!==h&&h.dependsOn&&t.setupDependentCalcFields(c);else for(u in c=Object.create(l),e)"type"!==u&&(c[u]=e[u]);c.owner=t,n.defs[c.ordinal]=c,n.map[a]=c,n.sources[d]=c;for(const e of s)e.$meta.fields.map[a]=c;return!1!==c.complexMapping&&d.includes(".")&&(c.complexMapping=!0),c.complexMapping?o[d.split(".")[0]]=!0:o[d]=!0,"defaultValue"in c&&(n.defaults[d]=c.defaultValue),Ls[a]||c.defineAccessor(t.prototype),c.calculate&&i.push(c),t._nonPersistableFields=null,t._alwaysWriteFields=null,c}static setupDependentCalcFields(e){const t=this.$meta.fields;e.calculate.dependsOn.forEach((n=>{if(!t.map[n])throw new Error(`No "${n}" field defined in ${this.$name} class`);t.map[n].dependentFields=t.map[n].dependentFields||[],t.map[n].dependentFields.push(e.name)}))}static removeField(e){const t=this.initClass(),n=t.$meta.fields,r=n.map[e],{ordinals:i}=n,s=i[e];if(r){n.defs.splice(s,1),delete i[e],delete n.defaults[e],delete n.exposed[e],delete n.map[e],delete n.sources[r.dataSource];for(const e in i)i[e]>s&&--i[e];delete t.prototype[e]}}static exposeRelations(){const e=this;if(!Is(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const t in e.relations){const n=e.relations[t];n.relationName=t,e.exposedRelations.push(n),Reflect.ownKeys(e.prototype).includes(t)||Fs(e.prototype,t,{enumerable:!0,get:function(){return this.getForeign(t)},set:function(e){this.setForeign(t,e,n)}})}}}static initInitables(e,t,n){const r=e.meta.initableValues=new Map;for(const i of this.$meta.fields.initable){const s=W.getPath(t,i.dataSource);void 0!==s&&r.set(i,s),!i.lazy&&i.init(t,e,n)}}assignInitables(){const{initableValues:e}=this.meta;for(const[t,n]of e)!1!==t.set(n,this.data,this)&&e.delete(t)}static get autoExposeFields(){return!0}static fieldSorter(e,t){return($s[e]||100)-($s[t]||100)}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.constructor.getFieldDefinition(e)}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){const t=this.fieldMap[e];if(!t)if(e.includes("[")){const[,t,,r]=e.match(ks),i=t.includes(".")?this.getFieldDefinition(t):this.fieldMap[t];var n;if(null!=i&&i.isStoreDataField)return null===(n=i.modelClass)||void 0===n?void 0:n.getFieldDefinition(r)}else if(e.includes(".")){const[t,n]=e.split(".",2),r=this.fieldMap[t];if(null!=r&&r.isModelDataField&&r.modelClass)return r.modelClass.getFieldDefinition(n)}return t}static getFieldDataSource(e){var t;return(null===(t=this.getFieldDefinition(e))||void 0===t?void 0:t.dataSource)||e}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}static processField(e,t,n){const r=this.fieldMap[e];return null!=r&&r.convert?r.convert(t,this.data,n):t}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach((t=>{var n;t.modelRelations||t.initRelations();const r=[];null===(n=t.modelRelations)||void 0===n||n.forEach((t=>{r.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,r)}))}initRelation(e){const t=this,n=t.get(e.foreignKey),r=n!==As&&"string"!=typeof e.foreignStore&&e.foreignStore.getById(n);return(t.meta.relationCache||(t.meta.relationCache={}))[e.relationName]=r||(null!=n?{id:n,placeHolder:!0}:null),r}removeRelation(e){const{relationName:t,foreignKey:n,nullFieldOnRemove:r}=e;this.meta.relationCache[t]&&(delete this.meta.relationCache[t],r&&this.setData(n,null))}getForeign(e){var t;return null===(t=this.meta.relationCache)||void 0===t?void 0:t[e]}setForeign(e,t,n){const r=_s.asId(t);return this.set(n.foreignKey,r)}getRelationConfig(e){var t;return null===(t=this.firstStore)||void 0===t||null===(t=t.modelRelations)||void 0===t?void 0:t.find((t=>t.foreignKey===e))}flatGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:this.data[t]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:W.getPath(this.data,t)}get(e){if(!e)return;const t=this,{fieldMap:n}=t,r=n[e];if(!r){if(e.includes("[")){const[,r,i,s]=e.match(ks),o=n[r];if(null!=o&&o.getAt){t._thisIsAUsedExpression(t[r]);const e=o.getAt(t,i);return e&&s?e.isModel?e.getValue(s):e[s]:e}return null}if(e.includes(".")){const[r,i]=e.split(".",2),s=n[r];if(null!=s&&s.isStoreDataField){const e=t[r];return i in e.modelClass.fieldMap||!(i in e)?null==e?void 0:e.getDistinctValues(i):e[i]}return W.hasPath(t.data,e)?t.complexGet(e,e):W.getPath(t,e)}}return null!=r&&r.complexMapping?t.complexGet(e,r.dataSource):t.flatGet(e,(null==r?void 0:r.dataSource)||e)}getValue(e){if(e)return e in this&&!e.includes(".")?this[e]:this.get(e)}setValue(e,t){e in this?this[e]=t:this.set(e,t)}setData(e,t){const{data:n,fieldMap:r}=this;if("string"==typeof e){const i=r[e],s=(null==i?void 0:i.dataSource)??e;null!=i&&i.set?i.set(t,this.data,this):null!=i&&i.complexMapping?W.setPath(n,s,t):n[s]=t,"id"===i?this._id=t:"parentId"===e&&(n[this.constructor.parentIdField]=t)}else{const i=Object.keys(e);for(let s=0;s<i.length;s++){const o=i[s],a=r[o],l=(null==a?void 0:a.dataSource)??o;null!=a&&a.set?a.set(t,this.data,this):l&&(null!=a&&a.complexMapping?W.setPath(n,l,e[o]):n[l]=e[o],"id"===o?this._id=t:"parentId"===o&&(n[this.constructor.parentIdField]=t))}}}getData(e){const t=this.fieldMap[e],n=(null==t?void 0:t.dataSource)??e;if(n)return null!=t&&t.complexMapping?W.getPath(this.data,n):this.data[n]}syncId(e){const t=this.id;if(t!==e){this._id=e,this.setData("id",e);const n={id:{value:e,oldValue:t}};this.afterChange(n,n)}}set(e,t,n=!1,r=!1,i=!1,s=!1,o=!0){const a=this;if(!a.isBatchUpdating){var l;const d=a.inSet(e,t,n,r,i,s,o);return null===(l=a.afterSet)||void 0===l||l.call(a,e,t,n,r,d),d}a.inBatchSet(e,t,n||a.$silenceBatch)}updateDependentFieldValues(e){if("object"==typeof e)Object.keys(e).forEach((e=>this.updateDependentFieldValues(e)));else{e.startsWith("#")&&(e=e.substring(0));for(const[t,n]of Object.entries(this.constructor.dependentFields||{}))e in n&&this.set(t,this.get(`#${t}`))}}fieldToKeys(e,t){return"string"!=typeof e?W.assign({},e):{[e]:t}}inBatchSet(e,t,n){const r=this,{meta:i,constructor:s,fieldMap:o}=r,a={};let l,d=!1;if("string"!=typeof e?Object.keys(r.fieldToKeys(e,t)).forEach((n=>{l=o[n]||W,t=s.processField(n,e[n],r),l.isEqual(i.batchChanges[n],t)||(a[n]={value:t,oldValue:r.get(n)},i.batchChanges[n]=t,d=!0)})):(l=o[e]||W,l.isEqual(i.batchChanges[e],t)||(a[e]={value:t,oldValue:r.get(e)},i.batchChanges[e]=t,d=!0)),d&&(r.generation++,!n)){var c;const e={action:"update",record:r,records:[r],changes:a};null===(c=r.stores)||void 0===c||c.forEach((t=>t.trigger("batchedUpdate",{...e}))),r.forEachLinked(((t,n)=>t.trigger("batchedUpdate",{...e,record:n,records:[n]})))}}inSet(e,t,n,r,i=!1,s=!1,o=!0){var a,l;const d=this,{data:c,meta:u,fieldMap:h,constructor:g}=d,{prototype:m,childrenField:p,relations:f}=g,v={},y=d.fieldToKeys(e,t),b=Object.keys(y).sort(g.fieldSorter),C=null===(a=d.stores)||void 0===a?void 0:a.some((e=>e.isSyncingDataOnLoad)),w=null===(l=d.stores)||void 0===l?void 0:l.some((e=>e.modificationsTracking>0));if(!n&&o&&!d.triggerBeforeUpdate(y))return null;let S,D,E,x=!1;if("object"==typeof e&&1===Object.keys(e).length&&(t=Object.values(e)[0],e=Object.keys(e)[0]),"string"==typeof e&&(S=d.getFieldDefinition(e))&&S.formulaProviders){var R,T;const n=null===(R=t)||void 0===R||null===(R=R.match(S.inputPrefixRE))||void 0===R?void 0:R[1];var M,k;if(E=`#${e}`,D=null===(T=S.formulaProviders[n])||void 0===T?void 0:T.instance,!D)D=null===(M=(k=S).getFormulaProvider)||void 0===M?void 0:M.call(k,n);b.push(E),y[E]=t}if(D){var F,I;const{formulaRE:n}=D,r=n?null===(F=(I=t.trim()).match)||void 0===F||null===(F=F.call(I,n))||void 0===F?void 0:F[1]:t;if(r){var A,L;const n=d.constructor,i=n.dependentFields||(n.dependentFields={}),s=D.createFormula(r,d,d.firstStore),o=D.calculate(s);null==r||null===(A=r.matchAll(D.fieldMatchRE))||void 0===A||null===(L=A.forEach)||void 0===L||L.call(A,(([,t])=>{t!==e&&((i[e]||(i[e]={}))[t]=1)})),y[e]=o,u.pendingFormulae=(u.pendingFormulae||0)+1;try{var P;null===(P=o.then)||void 0===P||P.call(o,(n=>{u.pendingFormulae=Math.max(0,u.pendingFormulae-1),d.set({[e]:n,[E]:t})}))}catch(n){u.pendingFormulae=Math.max(0,u.pendingFormulae-1),d.firstStore.trigger("formulaError",{record:d,field:e,error:n,formula:t}),d.set(e,"")}}}d.inSetting=!0;for(let e=0;e<b.length;e++){const t=b[e];if(t===p)continue;if(t.includes("[")){const[,e,n,r]=t.match(ks),i=d.fieldMap[e];if(null!=i&&i.getAt){var O;const s=i.getAt(d,n)??(null===(O=i.onSubRecordMissingInSet)||void 0===O?void 0:O.call(i,d,n));if(null==s)throw new Error(`The store field '${e}' does not contain a record at index ${n} - can not set the data`);s.isModel?s.set(r,y[t]):W.setPath(s,r,y[t]);continue}}const n=t.includes(".");if(f&&n){const[,e,n]=t.match(Ms);if(f[e]){n.includes(".")?d[e].set(n,y[t]):d[e][n]=y[t];continue}}const o=h[t],a=o||W,l=null==o?void 0:o.readOnly,S=(null==o?void 0:o.dataSource)??t,D=!i&&!o&&t in m||(null==o?void 0:o.useProp),E=D?d[S]:null!=o&&o.complexMapping||n?W.getPath(c,S):c[S],R=g.processField(t,y[t],d),T=y[t]={value:R},M=W.isPromise(R),k=d.getRelationConfig(t);var $;if(!l&&(C&&null!=o&&o.bypassEqualityOnSyncDataset||!a.isEqual(E,R))&&(!s||void 0!==R))d.generation++,T.oldValue=(null==o||null===($=o.getOldValue)||void 0===$?void 0:$.call(o,d))??E,x=!0,t in u.modified&&a.isEqual(u.modified[t],R,!1,!0)?(Reflect.deleteProperty(u.modified,t),d.isReverting&&(d.data[S]=R)):d.ignoreBag||w?w&&Reflect.deleteProperty(u.modified,t):(t in u.modified||null==E&&null==R||M||d.storeFieldChange(t,E),T.oldValue===As&&Reflect.deleteProperty(T,"oldValue")),v[t]=T,d.applyValue(D,S,R,i,o),k&&!r&&(d.initRelation(k),d.stores.forEach((e=>e.cacheRelatedRecord(d,R,k.relationName,T.oldValue))))}return x&&d.afterChange(y,v,n,r,i),d.updateDependentFieldValues(e),d.inSetting=!1,x?v:null}applyValue(e,t,n,r,i){var s,o,a;const l=this;var d,c;if(((null===(s=i)||void 0===s?void 0:s.dataSource)||t)===l.constructor.idField&&(l.$isPhantom=!1,l._id=n),((null===(o=i)||void 0===o?void 0:o.dataSource)||t)===l.constructor.parentIdField)null!==(d=l.firstStore)&&void 0!==d&&d.tree&&(null===(c=l.parent)||void 0===c||!c.isRoot||null!=n&&l.firstStore.getById(n))&&(l.firstStore.getById(n)||l.firstStore.rootNode).insertChild(l,null,!1,{orderedParentIndex:{skip:!0}});else if(e){var u;l[(null===(u=i)||void 0===u?void 0:u.name)||t]=n}else if(null!==(a=i)&&void 0!==a&&a.set)i.set(n,l.data,l);else{var h;let e=null===(h=i)||void 0===h?void 0:h.complexMapping;if(!i&&t.includes(".")){var g,m;const n=t.split(".")[0];e=(null===(g=i=l.constructor.fieldMap[n])||void 0===g?void 0:g.complexMapping)||"object"===(null===(m=i)||void 0===m?void 0:m.type)}e?W.setPath(l.data,t,n):l.data[t]=n}}afterChange(e,t,n,r,i){const s=this.updateDependentFields(Object.keys(t));if(s&&Object.assign(t,s),this.stores)for(const s of this.stores)s.onModelChange(this,e,t,n,r,i);this.forEachLinked(((s,o)=>s.onModelChange(o,e,t,n,r,i)))}updateDependentFields(e){const t={};return e.forEach((e=>{var n;null===(n=this.getFieldDefinition(e))||void 0===n||null===(n=n.dependentFields)||void 0===n||n.forEach((e=>{const n=this.fieldMap[e],r=this.refreshCalculatedField(n);t[e]=r}))})),Object.keys(t).length>0?this.set(t,void 0,!0):t}refreshCalculatedField(e){var t;const n=this;"string"==typeof e&&(e=n.getFieldDefinition(e));const r=null===(t=e.calculate)||void 0===t?void 0:t.fn.call(e,n);return W.isPromise(r)&&(n.isConstructing?n.data[e.name]=r:n[e.name]=r,r.then((t=>n[e.name]=t))),r}forEachLinked(e){for(const t of this.$links)for(const n of t.stores)e(n,t)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!W.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getUnmodified(e){return this.isModified?this.meta.modified[e]:this.get(e)}getFieldPersistentValue(e){const t="string"==typeof e?this.getFieldDefinition(e):e,n=(null==t?void 0:t.name)||e;let r;return t&&!t.persist||(r=this.getValue(n),null!=t&&t.serialize&&(r=t.serialize(r,this))),r}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach((r=>{const i=e.getFieldPersistentValue(r);i!==As&&(t[r]=i,n=!0)})),n?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&W.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,n={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach((i=>{var s,o;let a=t[i],l=null===(s=a)||void 0===s?void 0:s.dataSource;if(i.includes(".")){const e=i.match(Ms)[1];a=t[e],l=i}if(null!==(o=a)&&void 0!==o&&o.persist){const t=e.getFieldPersistentValue(i);t!==As&&(W.setPath(n,l,t),r=!0)}})),r?n:null}get modificationDataToWrite(){const e=this,{modificationData:t,constructor:n}=e,r=t??{},i=n.alwaysWriteFields;let s=Boolean(t);return i.forEach((t=>{W.setPath(r,t.dataSource,e.getFieldPersistentValue(t)),s=!0})),s&&!t&&W.setPath(r,n.idField,e.id),s?r:null}get persistableData(){const e=this,t={};return e.fields.forEach((n=>{const r=e.getFieldPersistentValue(n);r!==As&&(null!=n&&n.complexMapping?W.setPath(t,n.dataSource,r):t[n.dataSource]=r)})),t}get dataByFieldName(){const{data:e}=this;return this.fields.reduce(((t,n)=>(W.hasPath(e,n.dataSource)&&(t[n.name]=e[n.dataSource]),t)),{})}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e){var t;this.internalClearChanges(e),null===(t=this.stores)||void 0===t||t.forEach((e=>e.trigger("clearChanges",{record:this})))}internalClearChanges(e=!0,t=!0,n=null,r=!1){const i=this,{meta:s}=i;if(n){const{modified:e}=s;for(const t in n)delete e[t];for(const t in e){var o,a;(null!==(o=e[t])&&void 0!==o&&o.isStore&&!e[t].changes||r&&(null===(a=i.getFieldDefinition(t))||void 0===a||!a.persist))&&delete e[t]}}else s.modified=Object.assign({},s.modifiedMaterialized),s.modifiedMaterialized=null;const l=W.isEmpty(s.modified);var d;(s.committing=!1,t)&&(null===(d=i.stores)||void 0===d||d.forEach((t=>{if(l&&t.modified.remove(i),t.added.remove(i),e){const e=t.collectDescendants(i).all;t.added.remove(e),l&&t.modified.remove(e)}})))}storeFieldChange(e,t){const{meta:n}=this;n.modified[e]=t,this.isBeingMaterialized&&(n.modifiedMaterialized=n.modifiedMaterialized??{},n.modifiedMaterialized[e]=t)}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,As,e),this.isReverting=!1}setByDataSource(e){const{fieldDataSourceMap:t}=this.constructor,n=W.pathifyKeys(e,t),r={};for(const e in n){const i=t[e];r[(null==i?void 0:i.name)??e]=n[e]}return this.set(r)}applyChangeset(e,t="$PhantomId",n=!0){const r=this,i=r.constructor,{idField:s,fieldDataSourceMap:o}=i,a=W.pathifyKeys(e,o),l=W.pathifyKeys(r.modificationData),d={};!(t in e&&!(s in e))&&t in a&&delete a[t];for(const e in a){const t=o[e],r=(null==t?void 0:t.name)??e;(n||l[e]===a[e])&&(d[r]=a[e])}const c=r.set(d);return r.internalClearChanges(!1,!0,d),c?Object.entries(c).reduce(((e,[t,n])=>(e[t]=n.value,e)),{}):{}}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId||Boolean(this.$isPhantom)}get isModel(){return!0}get hasGeneratedId(){return"string"==typeof this.id&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return`_generated${e}_${N.generateUUID()}`}generateId(){return this.constructor.generateId()}static asId(e){return null!=e&&e.isModel?e.id:W.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return N.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:t}=this,n=this.persistableData;return(t||e)&&(n[this.constructor.childrenField]=(t||e).map((e=>e.toJSON()))),n}toString(){const e=this,t=Ps.find((t=>t in e.constructor.fieldMap)),n=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return N.safeJsonStringify(n)}get isBatchUpdating(){return Boolean(this.batching)}hasBatchedChange(e){var t;return null===(t=this.meta)||void 0===t||null===(t=t.batchChanges)||void 0===t?void 0:t[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1,n=!0){const r=this,{parentIdField:i}=r.constructor;if(r.batching&&(r.batching--,r.$silenceBatch&&r.$silenceBatch--,!(r.batching>0||W.isEmpty(r.meta.batchChanges)))){let{batchChanges:s}=r.meta;r.meta.batchChanges=null,s[i]&&(s={...s},r.parentId=s[i],delete s[i]),r.set(s,As,e,!1,t,void 0,n)}}cancelBatch(){if(this.batching){const t=this,{batchChanges:n}=t.meta,r={};if(t.batching=null,t.meta.batchChanges=null,t.generation++,!t.$silenceBatch){var e;Object.entries(n).forEach((([e,n])=>{r[e]={oldValue:n,value:t[e]}}));const i={action:"update",record:t,records:[t],changes:r};null===(e=t.stores)||void 0===e||e.forEach((e=>e.trigger("batchedUpdate",{...i}))),t.forEachLinked(((e,t)=>e.trigger("batchedUpdate",{...i,record:t,records:[t]})))}t.$silenceBatch&&t.$silenceBatch--}}triggerBeforeUpdate(e){var t;return!(null!==(t=this.stores)&&void 0!==t&&t.some((t=>!1===t.trigger("beforeUpdate",{record:this,changes:e}))))}copy(e=null,t){const n=this,r=W.clone(n.data),i=n.constructor.idField,s=W.isObject(t)?t.deep:t;let o;if(e&&"object"==typeof e?(o=e[i],Object.assign(r,e)):o=e,s&&n.children?r.children=n.children.map((n=>n.copy(!1!==e&&void 0,t))):(delete r.children,delete r.expanded),n.$meta.fields.initable.length>0){const e=n.toJSON();for(const t of n.$meta.fields.initable)r[t.name]=e[t.name]}!1!==e&&(r[i]=o||n.generateId(n.firstStore));const a=new n.constructor(r,null,null,!1,!0);return a.originalInternalId=n.internalId,a.copyOf=n,a}copyData(e,t,n){const r={},i=this.skipCopyFields||{};e.allFields.forEach((({name:n})=>{n===e.constructor.idField||n in i||(r[n]=t?e.get(n):e.getValue(n))})),this.set(r,null,n)}remove(e=!1){const t=this,{parent:n,stores:r}=t;if(n)n.removeChild(t,!1,e,{unfiltered:!0});else if(null!=r&&r.length&&!t.isSpecialRow){r.slice().forEach((n=>n.remove(t,e,!1,!0)))}}beforeRemove(e,t){return super.beforeRemove(e,t)}get isValid(){return!0}get firstStore(){var e;return null===(e=this.stores)||void 0===e?void 0:e[0]}joinStore(e){const t=this;var n,r;t.stores&&t.stores.includes(e)||(super.joinStore(e),e.register(t),t.stores?t.stores.push(e):t.stores=[e],t.unjoinedStores&&t.unjoinedStores.includes(e)&&t.unjoinedStores.splice(t.unjoinedStores.indexOf(e),1),(null===(n=t.children)||void 0===n?void 0:n.length)&&t.children.forEach((t=>t.joinStore(e))),t.constructor.exposedRelations&&t.initRelations(),!e.tree||t.isRoot||null!==(r=e.stm)&&void 0!==r&&r.isRestoring||(t.instanceMeta(e.id).collapsed=!t.expanded))}unjoinStore(e,t=!1){const n=this,{stores:r}=n;var i,s,o;null!=r&&r.includes(e)&&(e.isDestroying||(e.unregister(n),n.unjoinedStores?n.unjoinedStores.push(e):n.unjoinedStores=[e]),null===(i=n.unfilteredChildren||n.children)||void 0===i||null===(s=i.forEach)||void 0===s||s.call(i,(n=>n.unjoinStore(e,t))),r.splice(r.indexOf(e),1),null===(o=super.unjoinStore)||void 0===o||o.call(this,e,t),e.uncacheRelatedRecord(n),n.meta.map&&!e.stm&&delete n.meta.map[e.id])}isPartOfStore(e){var t;return e?e.includes(this):(null===(t=this.stores)||void 0===t?void 0:t.length)>0}get isRemoved(){return!this.isPartOfStore()}isEditable(e){const t=this.getFieldDefinition(e);return(null==t||!t.calculated)&&(this.readOnly?"readOnly"===e:!!t||void 0)}instanceMeta(e){var t;const{meta:n}=this,r=e.id||e;return(null===(t=n.map)||void 0===t?void 0:t[r])||this.setInstanceMeta(r,{})}setInstanceMeta(e,t){const{meta:n}=this,r=e.id||e;return n.map||(n.map={}),n.map[r]=t}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return Boolean(null===(e=this.meta)||void 0===e?void 0:e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach((t=>{t.persist&&!t.calculated||(e._nonPersistableFields[t.name]=1)}))),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=e.allFields.filter((e=>e.alwaysWrite))),e._alwaysWriteFields}get domId(){return"string"==typeof this.id?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:t}=this.$meta;return`class ${t[t.length-2]} extends ${t[t.length-3]} { static fields = ${N.toJavaScriptValue(this.fields,e)}; }`}getCurrentConfig(e){const{data:t,children:n}=this,{defaultValues:r,applyConfigs:i}=this.constructor,s=i?super.getCurrentConfig(e):{};if(s){for(const n of this.fields)if(n.persist){const i=W.getPath(t,n.dataSource);null==i||n.isEqual(i,r[n.name])||W.setPath(s,n.dataSource,Qe.processConfigValue(i,e))}if(n)if(Array.isArray(n)){s.children=[];for(const t of n)s.children.push(t.getCurrentConfig(e))}else s.children=n;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}}_s._idField="id",_s._internalIdCounter=1,_s._assignedIdField=!1,_s.exposeProperties(),_s._$name="Model";class Hs{static preWalk(e,t,n){const r=[e];let i,s;for(;r.length;)i=r.pop(),n(i),s=t(i),s&&r.push.apply(r,s.slice().reverse())}static walkWhile(e,t,n){const r=Array.isArray(e)?[...e]:[e];let i,s;for(;r.length;){if(i=r.pop(),!n(i))return!1;s=t(i),Array.isArray(s)&&r.push(...s)}return!0}static preWalkWithParent(e,t,n){const r=[{node:e,parent:null}];for(;r.length;){const{parent:e,node:i}=r.pop();n(e,i);const s=t(i);Array.isArray(s)&&r.push(...s.slice().reverse().map((e=>({node:e,parent:i}))))}}static preWalkUnordered(e,t,n){const r=[e];let i,s;for(;r.length;)i=r.pop(),n(i),s=t(i),s&&r.push.apply(r,s)}static postWalk(e,t,n){const r=new Map,i=[e];let s,o;for(;i.length;)s=i[i.length-1],r.has(s)?(n(s),i.pop()):(o=t(s),o&&i.push(...o.slice().reverse()),r.set(s,s))}static prePostWalk(e,t,n,r){const i=new Map,s=[e];let o,a;for(;s.length;)o=s[s.length-1],i.has(o)?(r(o),s.pop()):(n(o),a=t(o),a&&s.push(...a.slice().reverse()),i.set(o,o))}}Hs._$name="WalkHelper";const Vs=Object.hasOwn||((e,t)=>Object.prototype.hasOwnProperty.call(e,t));let Ns=null;class Bs{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class zs{static standardOptions=Object.freeze([]);static get(e){if(null==e)return this.NULL;if(e instanceof this)return e;const t="string"==typeof e?e:JSON.stringify(e),n=this.cache;let r=n.get(t);return r||(Ns=t,r=new this(e),n.set(t,r)),r}static get cache(){return Vs(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return Vs(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this,{standardOptions:n}=t.constructor;if(t.cacheKey=Ns,Ns=null,t.initialize(),null===e)t.formatter=new Bs(t);else{t.configure(e);for(const[e,r]of Object.entries(t.resolvedOptions()))null!=r&&n.includes(e)&&(t[e]=r)}}get parser(){return e=this,t=new this.constructor.Parser(this),Object.defineProperty(e,"parser",{value:t}),t;var e,t}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}zs._$name="Formatter";const js=N.escapeRegExp,Ws=/[\d+-]/g,Us=(e,t)=>new Intl.NumberFormat(e||void 0,t),Gs=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/;class Ys extends zs{static $name="NumberFormat";static decimalSeparator;static groupSeparator;decimalSeparator;groupSeparator;static standardOptions=["currency","currencyDisplay","locale","maximumFractionDigits","minimumFractionDigits","minimumIntegerDigits","maximumSignificantDigits","minimumSignificantDigits","style","useGrouping"];initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits+(this.is.percent?2:1),t=Math.min(20,e);return this.as({style:"decimal",maximumFractionDigits:t,minimumFractionDigits:t},"truncator")}configure(e){const{decimalSeparator:t,groupSeparator:n}=Ys;Object.assign(this,{...t?{decimalSeparator:t}:{},...n?{groupSeparator:n}:{}}),"string"!=typeof e?Object.assign(this,e):this.template=e;const r=this,i={},s=r.locale?Cr.locales[r.locale]||Object.values(Cr.locales).find((e=>e.localeCode===r.locale)):Cr.locale,o=null==s?void 0:s.NumberFormat,{template:a}=r,{standardOptions:l}=r.constructor;if(o)for(const e in o)null==r[e]&&"function"!=typeof o[e]&&(r[e]=o[e]);if(a){const e=Gs.exec(a),t=e[2],n=e[4];r.useGrouping=Boolean(e[3]),r.style=e[1]?"currency":e[6]?"percent":"decimal",t&&(r.integer=+t),"*"===n?r.fraction=[0,20]:null!=n&&(r.fraction=[e[5].length,n.length])}r._minMax("fraction",!0,!0),r._minMax("integer",!0,!1),r._minMax("significant",!1,!0);for(const e of l)null!=r[e]&&(i[e]=r[e]);if(r.is.from=r.from&&r.from.is,r.is[r.style]=!(r.is.null=!1),r.formatter=Us(r.locale,i),r.decimalSeparator||r.groupSeparator){const{groupSeparator:e,decimalSeparator:t}=r.getLocaleSeparators();r.separatorRegex=new RegExp(`[${e}${t}]`,"g"),r.separatorReplace={[e]:r.groupSeparator??e,[t]:r.decimalSeparator??t}}}as(e,t=null){const n=this.resolvedOptions()||{template:"9.*"},r=this._as;let i=t&&r[t];return i||("string"==typeof e?n.style=e:Object.assign(n,e),n.from=this,i=new Ys(n)),t&&(r[t]=i),i}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}getLocaleSeparators(){const e=this.formatter.formatToParts(1234567.89);let t=".",n=",";for(const r of e)"decimal"===r.type&&(t=r.value),"group"===r.type&&(n=r.value);return{decimalSeparator:t,groupSeparator:n}}format(e){const t=this,{separatorRegex:n,separatorReplace:r}=t;if("string"==typeof e){const n=Number(e);e=isNaN(n)?t.parse(e):n}return e=super.format(e),n&&(e=String(e).replace(n,(e=>r[e]))),e}round(e){return this.parse(this.format(e))}truncate(e){const t=this,n=t.maximumFractionDigits+(t.is.percent?2:0),{truncator:r}=t;let i,s=t.parse(e);return r&&(s=r.format(s),i=s.indexOf(r.parser.decimal),i>-1&&s.length-i-1>n&&(s=s.slice(0,i+n+1)),s=r.parse(s)),s}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)void 0===e[t]&&(e[t]=this[t]);return e}_minMax(e,t,n){const r=this,i=r[e];if(null!=i){const s=N.capitalize(e),o=`maximum${s}Digits`,a=`minimum${s}Digits`;"number"==typeof i?(t&&(r[a]=i),n&&(r[o]=i)):(r[a]=i[0],r[o]=i[1])}}}Ys.Parser=class{constructor(e){const t=this,n=e.locale,r=Us(n,{maximumFractionDigits:3}),i=e.is.currency?t._decodeStyle(n,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(n,{style:"percent"}):null,o=r.format(1.2).replace(Ws,"")[0],a=r.format(1e9).replace(Ws,"")[0]||"";Object.assign(t,{currency:i,decimal:o,formatter:e,grouper:a,percent:s}),t.decimal=o,t.decimalRe=js(o,"g"),t.grouper=a,t.stripRe=new RegExp(`(?:\\s+|${js(a)})`+(i?`|(?:${js(i.text)})`:"")+(s?`|(?:${js(s.text)})`:""),"g")}decimalPlaces(e){const t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace("−","-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const n=Us(e,t),r=Us(e,Object.assign(n.resolvedOptions(),{style:"decimal"})),i=n.format(0),s=r.format(0);return{suffix:i.startsWith(s),text:i.replace(s,"").trim()}}},Object.assign(Ys.prototype,{currency:null,currencyDisplay:"symbol",fraction:null,from:null,integer:null,locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,significant:null,style:"decimal",template:null,useGrouping:!0}),zs.number=(e,t)=>Ys.get(e).format(t),Cr.ion({locale:()=>Ys.cache.clear()}),Ys._$name="NumberFormat";class qs{constructor(e,t){"number"==typeof e||null===e?(this._magnitude=e,this._unit=t):("string"==typeof e&&Object.assign(this,xi.parseDuration(e)),"object"==typeof e&&(this.magnitude=e.magnitude,this.unit=e.unit))}static from(e){return null==e?null:e.isDuration?e:new qs(e)}negate(){return new qs(-this.magnitude,this.unit)}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=xi.parseTimeUnit(e)}get isValid(){return null!=this._magnitude&&Boolean(xi.normalizeUnit(this._unit))}get milliseconds(){return this.isValid?Math.round(xi.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e)&&null!=this._magnitude&&null!=e._magnitude&&this.milliseconds===e.milliseconds}toString(e,t=10){const n=this,r=e?"getShortNameOfUnit":"getLocalizedNameOfUnit",i=e?"":" ";return n.isValid?`${Ys.get("9."+"#".repeat(t)).format(n._magnitude)}${i}${xi[r](n._unit,1!==Math.abs(n._magnitude))}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}add(e){return new qs({unit:this.unit,magnitude:xi.as(this.unit,this.milliseconds+new qs({magnitude:e.magnitude,unit:e.unit||this.unit}).milliseconds)})}diff(e){return new qs({unit:this.unit,magnitude:xi.as(this.unit,this.milliseconds-e.milliseconds)})}}qs._$name="Duration";const Ks=(e,t)=>null==e?void 0:e[t],Xs=/^is(this|next|last)(week|month|year)$/i,Zs=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"];class Js extends(Qe.mixin(Xi)){static $name="CollectionFilter";static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),e.type?"date"===e.type&&null!=e.value?Array.isArray(e.value)?e.value=e.value.map((e=>e instanceof Date?e:new Date(e))):e.value=new Date(e.value):"duration"===e.type&&null!=e.value&&(Array.isArray(e.value)?e.value=e.value.map((e=>e.isDuration?e:new qs(e))):e.value=new qs(e.value)):xi.isDate(e.value)||Array.isArray(e.value)&&e.value.every(xi.isDate)?e.type="date":e.value instanceof qs&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=Js.generateId(`b-internal-${this.property}-filter-`):this._id=this.property&&`${this.property}-${this.operator}`||Js.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var t;const n=this;n.isConfiguring||null===(t=n.owner)||void 0===t||!t.onFilterChanged||n.owner.isConfiguring||n.owner.onFilterChanged(n,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let n;return n=e.isModel?e.getValue(t.property):t._propertyItems.length>1?t._propertyItems.reduce(Ks,e):e[t.property],t[t.operator](t.convert(n))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&"string"==typeof e[0])?t._filterValue=e.map((e=>t.convert(e))):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?t._filterValue=e.map((e=>null==e?void 0:e.toLowerCase())):t.caseSensitive||"string"!=typeof e?t._filterValue=t.convert(e):t._filterValue=e.toLowerCase(),t.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":"string"==typeof e.filterValue?"*":"="}convert(e){const t=this;var n;"sameTime"===t.operator||"notSameTime"===t.operator||"string"==typeof t.filterValue&&e instanceof Date||("sameDay"!==t.operator&&"notSameDay"!==t.operator||(e=xi.clearTime(e)),e=(null===(n=e)||void 0===n?void 0:n.valueOf())??e);return e=t.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return 0===this.filterValue.length||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return 0===this.filterValue.length||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return null!=e&&xi.isSameTime(e,this.filterValue)}notSameTime(e){return!this.sameTime(e)}sameDay(e){return e===this.filterValue}notSameDay(e){return e!==this.filterValue}"="(e){return W.isEqual(e,this.filterValue)}"!="(e){return!W.isEqual(e,this.filterValue)}">"(e){return W.isMoreThan(e,this.filterValue)}">="(e){return W.isMoreThan(e,this.filterValue)||W.isEqual(e,this.filterValue)}"<"(e){return W.isLessThan(e,this.filterValue)}"<="(e){return W.isLessThan(e,this.filterValue)||W.isEqual(e,this.filterValue)}"*"(e){return W.isPartial(e,this.filterValue)}between(e){const[t,n]=this._filterValue;return(W.isMoreThan(e,t)||W.isEqual(e,t))&&(W.isLessThan(e,n)||W.isEqual(e,n))}notBetween(e){return!this.between(e)}betweenLesser(e){const[t,n]=this._filterValue;return e>=t&&e<n}empty(e){return null==e||0===String(e).length}notEmpty(e){return!this.empty(e)}isToday(e){return this.betweenLesser(e)}isTomorrow(e){return this.betweenLesser(e)}isYesterday(e){return this.betweenLesser(e)}isThisWeek(e){return this.betweenLesser(e)}isNextWeek(e){return this.betweenLesser(e)}isLastWeek(e){return this.betweenLesser(e)}isThisMonth(e){return this.betweenLesser(e)}isNextMonth(e){return this.betweenLesser(e)}isLastMonth(e){return this.betweenLesser(e)}isThisYear(e){return this.betweenLesser(e)}isNextYear(e){return this.betweenLesser(e)}isLastYear(e){return this.betweenLesser(e)}isYearToDate(e){return this.between(e)}isTrue(e){return!0===e}isFalse(e){return!1===e}getState(){const{caseSensitive:e,disabled:t,id:n,internal:r,operator:i,property:s,type:o,value:a,columnOwned:l,filterBy:d}=this,c={caseSensitive:e,disabled:t,id:n,internal:r,operator:i,property:s,type:o,value:a,columnOwned:l,filterBy:d};return W.cleanupProperties(c,!0),c.filterBy===this.defaultFilterBy&&delete c.filterBy,c}setRelativeDateValues(){this._filterValue=Js.getRelativeDateRange(this._operator).map((e=>e.valueOf()))}get isNoOp(){var e;return("includes"===this.operator||"isIncludedIn"===this.operator)&&0===(null===(e=this.filterValue)||void 0===e?void 0:e.length)}static getRelativeDateRange(e,t=new Date){let n,r,i,s,o,a,l;switch(e){case"isYearToDate":return[xi.floor(t,"1 year"),t];case"isToday":return n=xi.floor(t,"1 day"),[n,xi.add(n,1,"day")];case"isYesterday":return n=xi.floor(t,"1 day"),[xi.add(n,-1,"day"),n];case"isTomorrow":return r=xi.getStartOfNextDay(t),[r,xi.add(r,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(i=e.toLowerCase().match(Xs),!i)throw new Error(`Unrecognized relative date expression: ${e}`);return[,a,l]=i,s=`1 ${l}`,o=xi.floor(t,s),"next"===a?o=xi.add(o,1,l):"last"===a&&(o=xi.add(o,-1,l)),[o,xi.add(o,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return ee.returnTrue;for(const t of e)"date"===t.type&&Zs.includes(t._operator)&&t.setRelativeDateValues();return function(t){let n=!0;for(const r of e)if(r.disabled||(n=r.filter(t)),!n)break;return n}}}Js._$name="CollectionFilter";const Qs=W.getPathDefault(globalThis,"bryntum.idCounts",Object.create(null));class eo{static generateId(e="generatedId"){return e+(Qs[e]=(Qs[e]||0)+1)}static reset(e){Qs[e]=0}}eo._$name="IdHelper";class to extends Qe{static get defaultConfig(){return{property:null,caseSensitive:!0,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||eo.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:n,property:r,useLocaleSort:i,caseSensitive:s}=this,o="desc"===this.direction.toLowerCase()?-1:1;if(e=e[r],t=t[r],n&&(e=n(e),t=n(t)),s||("string"==typeof e&&(e=e.toLowerCase()),"string"==typeof t&&(t=t.toLowerCase())),i&&null!=e&&null!=t&&"string"==typeof e){if(!0===i)return e.localeCompare(t);if("string"==typeof i)return e.localeCompare(t,i);if("object"==typeof i)return e.localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*o}static generateSortFunction(e,t){const n=e.isCollection?e.values:e,r=n.length;return(e,i)=>{let s,o,a;for(o=0;o<r;++o)if(a=n[o],s=a.sortFn(e,i,a.direction),s)return s;return t?t(e,i):0}}}to._$name="CollectionSorter";const no=()=>0,ro=(e,t)=>t-e,io=Symbol("filteredIndicesProperty"),so=Object.freeze([]),oo=Object.freeze({action:"sort",added:so,removed:so,replaced:so}),ao=Object.freeze({action:"filter",added:so,removed:so,replaced:so}),lo={string:1,number:1};function co(e,t,n,r){if(!1!==t.unique)t.set(n,e),r&&t.count++;else{let r=t.get(n);r||(r=new Set,t.set(n,r)),r.add(e)}}function uo(e,t,n,r,i=!1){for(let s=0;s<e.length;s++){const o=e[s];if(o)for(let e=0;e<r;e++){const r=n[e],s=o[r],a=t[r];void 0!==s&&co(o,a,s,!i&&a.onDuplicate)}}}class ho extends(Qe.mixin(lt)){_sortFunction=null;_addedValues=null;static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),null===(e=t._sorters)||void 0===e||e.destroy()}clear(){const e=this,t=e._values.filter((e=>e));e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}equals(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:n}=this;return t&&(e=e.map(t),n=n.map(t)),nt.delta(e,n).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:t,silent:n=!1,isNewDataset:r=!1}){const i=this;let s,o;if(i.isFiltered&&!r){Boolean(t)?e&&(s=i._values,i._values=e.slice()):(t=e.slice(),e=null),o=i._filteredValues,i._filteredValues=t.slice()}else s=i._values,i._values=e.slice(),t=null,i.isFiltered&&r&&i.autoFilter?(i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction)):i._filteredValues&&(i._filteredValues.length=0);i._indicesInvalid=!0,i._addedValues=void 0,i.generation++,n||i.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:o,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}reduce(e,t=!1,n=[]){return(this.isFiltered&&!t?this._filteredValues:this._values).reduce(e,n)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,t=!0){const n=this,{_values:r}=n,i=[];return n.forEach((s=>{const o=e.get(s.id,!0);if(o){const e=n.indexOf(s,!0),t=r[e];r[e]=o,n.removeFromIndices(t),n.addToIndices(o)}else t&&i.push(s)})),i.length&&n.remove(i),n.isFiltered&&(n._filteredValues=n._values.filter(n.filterFunction)),i}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){for(e=nt.asArray(e);e.length&&e[0]===t;)e.shift();if(!e.length)return;const n=this,{_values:r}=n,i=n.indexOf(e[0],!0);if(1===e.length&&r[i+1]===t)return;n.suspendEvents(),n.remove(e),n.resumeEvents();const s=t?n.indexOf(t,!0):r.length;if(-1===s)throw new Error("Collection move beforeItem parameter must be present in Collection");return r.splice(s,0,...e),n._indicesInvalid=1,n.trigger("change",{action:"move",items:e,from:i,to:s}),s}splice(e=0,t,...n){var r;const i=this,s=i.idProperty,o=i._values,a={},l=[],d=[],c=i.totalCount;let u,h;if(1===(null===(r=n)||void 0===r?void 0:r.length)&&Array.isArray(n[0])&&(n=n[0]),!1!==i.trigger("beforeSplice",{index:e,toRemove:t,toAdd:n})){if(n)if(c&&n.length){const e=i.indices[s];u=[];for(let t=0;t<n.length;t++){const r=n[t],i=r[s],l=e.get(i),c=l?o.indexOf(l):-1;a[i]=!0,-1!==c?o[c]!==r&&(d.push([o[c],r]),o[c]=r):u.push(r)}}else u=n;if(t){if("number"==typeof t){t=Math.min(t,o.length-e);for(let n=e;t;--t){a[o[n][s]]?(e++,n++):(l.push(o[n]),o.splice(n,1),h=!0)}}else{let e,n=0===u.length;const r=(t=nt.asArray(t)).reduce(((t,r)=>{const s="number"==typeof r,o=s?r:i.indexOf(r,!0);return n&&(null!=e&&o!==e+1||s)&&(n=!1),o>=0&&o<c&&t.push(o),e=o,t}),[]).sort(ro);if(n)r.length&&(l.push.apply(l,t),o.splice(r[r.length-1],r.length),h=!0);else for(let e=0;e<r.length;e++){const t=r[e];if(-1!==t){a[o[t][s]]||(l.unshift(o[t]),o.splice(t,1),h=!0)}}}l.length&&!i._indicesInvalid&&l.forEach(i.removeFromIndices,i)}if(u.length){o.splice(Math.min(e,o.length),0,...u),h=!0,i._indicesInvalid||u.forEach(i.addToIndices,i),i._addedValues||(i._addedValues=new Set);for(const e of u)i._addedValues.add(e)}if(l.length&&i._addedValues)for(const e of l)i._addedValues.delete(e);d.length&&!i._indicesInvalid&&d.forEach((e=>{i.removeFromIndices(e[0]),i.addToIndices(e[1])})),h||d.length?(i.isSorted?i.onSortersChanged():i.isFiltered&&(i.autoFilter?i.onFiltersChanged({action:"splice",oldCount:1}):i._filteredValues.splice(Math.min(e,i._filteredValues.length),0,...u)),i.generation++,i.trigger("change",{action:"splice",removed:l,added:u,replaced:d,oldCount:c})):i.trigger("noChange",{index:e,toRemove:t,toAdd:n})}}changeId(e,t){const n=this,{idProperty:r}=n,i=lo[typeof e]?e:e[r],s=n.get(i);if(s){const o=n.get(t);if(o&&s!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);n.removeIndexEntry(e,r,i),n.addIndexEntry(e,r,t),s[r]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,n=!1){return this.findItem(e,t,this.isFiltered&&n)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new ho({values:nt.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof to?e:new to(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean(null===(e=this._sorters)||void 0===e?void 0:e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",oo)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=to.generateSortFunction(this.sorters.values):this._sortFunction=no),this._sortFunction}get filters(){return this._filters||(this._filters=new ho({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof Js?e:new Js(e);return this.filters.add(t),t}removeFilter(e){const{filters:t}=this;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:t,oldCount:n}){const r=this,i=n||"clear"===e&&t.length?r._filteredValues:r._values;r._filterFunction=null,r._filteredValues=r._values.filter(r.filterFunction),r._indicesInvalid=!0;const{toAdd:s,toRemove:o}=nt.delta(r._filteredValues,i,!0);r.trigger("change",{...ao,added:s,removed:o})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=Js.generateFiltersFunction(this.filters.values):this._filterFunction=ee.returnTrue),this._filterFunction}changeExtraKeys(e){return nt.asArray(e).map((e=>"string"==typeof e?{property:e,unique:!0}:e))}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){const t=this;e&&((t._indices||(t._indices={}))[e.property]=new Map,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}findIndex(e,t,n=!1){const r=this.findItem(e,t,n);if(!r)return-1;return(this.isFiltered&&!n?this._filteredValues:this._values).indexOf(r)}findItem(e,t,n=!1){const r=this,{isFiltered:i}=r,s=i&&!n?r.indices[io][e]:r.indices[e];if(s){const e=s.get(t)??("string"==typeof t&&t.length&&!isNaN(t)&&s.get(Number(t))||null);if(null!=e)return e}else{const s=i&&!n?r._filteredValues:r._values,o=s.length;for(let n=0;n<o;n++){const r=s[n];if(r[e]==t)return r}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some((e=>e.dependentOn))}indexOf(e,t=!1){return this.findIndex(this.idProperty,lo[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some((e=>this.includes(e))):Boolean(this.findItem(this.idProperty,lo[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,n=e._indices||(e._indices={}),r=Object.keys(n),i=r.length,s=e._values;let o,a=!1;t&&(o=n[io]={});for(let e=0;e<i;e++){const i=n[r[e]];if(i.clear(),i.onDuplicate&&(i.count=0,a=!0),t){let t=o[r[e]];t?t.clear():(t=o[r[e]]=new Map,t.unique=i.unique)}}if(uo(s,n,r,i),a)for(let e=0;e<i;e++){const t=n[r[e]];if(t.onDuplicate&&t.count>t.size){const n=new Set;for(let i=0;i<s.length;i++){const o=s[i],a=o[r[e]];n.has(a)&&t.onDuplicate(o,a,t),n.add(a)}}}t&&uo(e._filteredValues,o,r,i,!0),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[io][e]),t}addToIndices(e){Object.keys(this.indices).forEach((t=>{this.addIndexEntry(e,t,e[t])}))}removeFromIndices(e){Object.keys(this.indices).forEach((t=>{this.removeIndexEntry(e,t,e[t])}))}removeIndexEntry(e,t,n){this.getIndices(t).forEach((t=>function(e,t,n){!1!==t.unique?t.delete(n):t.has(n)&&(t.get(n).delete(e),t.get(n).size||t.delete(n))}(e,t,n)))}addIndexEntry(e,t,n){this.getIndices(t).forEach((t=>co(e,t,n)))}onItemMutation(e,t){const n=this;!n._indicesInvalid&&Object.keys(n.indices).length>1&&Object.keys(t).forEach((r=>{if(n.indices[r]){const{value:i,oldValue:s}=t[r];n.removeIndexEntry(e,r,s),n.addIndexEntry(e,r,i)}if(n.hasCompositeIndex){const s=Object.values(n.indices).find((e=>{var t;return null===(t=e.dependentOn)||void 0===t?void 0:t[r]}));if(s){const r={};for(const n in s.dependentOn){var i;r[n]=(null===(i=t[n])||void 0===i?void 0:i.oldValue)||e[n]}const o=e.buildIndexKey(r);n.removeIndexEntry(e,s.property,o),n.addIndexEntry(e,s.property,e[s.property])}}}))}}ho._$name="Collection";const go=new WeakMap,mo=e=>{if(e&&"object"==typeof e){let t=go.get(e);void 0===t&&(t=Symbol("bscik"),go.set(e,t)),e=t}return e};class po{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[mo(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:n,idMap:r,idProperty:i}=t,s=e.length;for(let o=0;o<s;o++){const s=e[o],a=lo[typeof s]?s:mo(s[i]),l=r[a];null==l?(r[a]=s,n.add(s),t.generation++):l!==s&&(r[a]=s,n.delete(l),n.add(s))}}at(e){let t,n;for(t of(e<0&&(e+=this.count),this.items))if(!e--){n=t;break}return n}remove(e){e=nt.asArray(e);const{items:t,idMap:n,idProperty:r}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],o=lo[typeof i]?i:mo(i[r]),a=n[o];null!=a&&(t.delete(a),delete n[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let t,n=0;for(t of this.items)e(t)&&++n;return n}changeId(e,t){const n=this,{idMap:r,idProperty:i}=n,s=lo[typeof e]?e:mo(e[i]),o=n.get(s);if(o){const e=n.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);o[i]=t,delete r[s],r[t]=o}}filter(e,t){const{items:n}=this,r=[];let i=0;return n.forEach((s=>{e.call(t,s,i++,n)&&r.push(s)})),r}includes(e){const t=lo[typeof e]?e:mo(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:n}=this,r=new Array(n.size);let i=0;return n.forEach((s=>{r[i]=e.call(t,s,i++,n)})),r}forEach(e,t){return this.items.forEach(e,t)}find(e,t=0){let n,r;for(n of(t<0&&(t+=this.countOf(e)),this.items))if(e(n)&&!t--){r=n;break}return r}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,t){let n,r=-1;for(n of this.items)if((!t||t(n))&&(++r,n===e))return r;return-1}get values(){return[...this.items]}set values(e){e=nt.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}get first(){for(const e of this.items)return e;return null}get last(){let e=null;for(const t of this.items)e=t;return e}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}po._$name="Bag";class fo extends po{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter((e=>e.isPersistable)))}}fo._$name="StoreBag";var vo=e=>class extends(e||Qe){static $name="StoreCRUD";static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(e,t=!1){const n=this,{storage:r}=n;if(0===(e=nt.asArray(e).reduce(((e,t)=>((t=n.getById(t))&&e.push(t),e)),[])).length)return e;if(!n.tree&&!t&&!1===n.trigger("beforeRemove",{records:e}))return[];if(n.isRemoving=!0,n.isGrouped){const t=r.count,i=[],s=new Set;for(const t of e){const{groupParent:e}=t.instanceMeta(n);e.meta.collapsed&&i.push(t),nt.remove(e.groupChildren,t),nt.remove(e.unfilteredGroupChildren,t),e.meta.childCount--,s.add(e)}for(const e of s)e.groupChildren.length>0&&n.onModelChange(e,{},{});i.length&&r.trigger("change",{action:"splice",removed:i,added:[],replaced:[],oldCount:t})}else if(n.tree){const i=[],s=new Set,o=e.length>1,a=e[0],l=o?void 0:r.indexOf(a),d=e.reduce(((e,t)=>{const{parent:n}=t;return n&&(e[n.id]||(e[n.id]=[n,[]]),e[n.id][1].push(t)),e}),{}),c=Array.from(Object.values(d));if(!t&&!1===n.trigger("beforeRemove",{records:e,isMove:!1,parent:o?void 0:a.parent}))return n.isRemoving=!1,[];n.suspendAutoCommit(),c.sort(((e,t)=>t[0].childLevel-e[0].childLevel));for(const[e,t]of c)i.push(...e.removeChild(t,!1,!0,{skipIndexUpdate:!0})),s.add(e);for(const e of s)i.includes(e)||(e.updateChildrenIndices(e.children,"parentIndex"),e.unfilteredChildren&&e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex"),e.orderedChildren&&e.updateChildrenIndices(e.orderedChildren,"orderedParentIndex"));return t||(n.trigger("remove",{parent:o?void 0:a.parent,index:l,isChild:!0,allRecords:i,isMove:!1,records:e}),n.trigger("change",{action:"remove",records:e})),n.resumeAutoCommit(),n.isRemoving=!1,e}if(0===e.length)return n.isRemoving=!1,e;for(const t of e)t.beforeRemove(e);return t&&n.suspendEvents(),r.remove(e),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1,e}clear(e=!1){var t;const n=this,{storage:r}=n;if(n.storage.totalCount||null!==(t=n.rootNode)&&void 0!==t&&null!==(t=t.unfilteredChildren)&&void 0!==t&&t.length){if(!e&&!1===n.trigger("beforeRemove",{records:r.allValues,removingAll:!0}))return null;if(n.rootNode)if(n.isChained&&!n.isChainedTree){const e=n.getAllDataRecords();for(let t,r=e.length-1;r>=0;r--)t=e[r],t&&!t.isDestroyed&&t.unjoinStore(n)}else n.rootNode.clearChildren(e);else if(e){const e=n.registeredRecords;for(let t,r=e.length-1;r>=0;r--)t=e[r],t&&!t.isDestroyed&&t.unjoinStore(n)}e&&(n.removed.clear(),r.suspendEvents()),r.clear(),e&&r.resumeEvents(),n.added.clear(),n.modified.clear()}}removeAll(e=!1){const t=this,n=t.storage;let r;if(t.isRemoving=!0,e){n.suspendEvents();const e=t.registeredRecords;for(let n,r=e.length-1;r>=0;r--)n=e[r],!n||n.isDestroyed||n.isRoot||n.unjoinStore(t)}return r=t.tree?!1!==t.rootNode.clear():null!==t.clear(),e&&n.resumeEvents(),t.isRemoving=!1,r}add(e,t=!1,n={}){var r;const i=this,{storage:s}=i;if(null===(r=e=nt.asArray(e))||void 0===r||!r.length)return;if(i.tree=i.tree||Boolean(i.autoTree&&e[0].children),i.tree){const r=new Map,s=i.modelClass.getFieldDataSource("parentIndex"),o=i.modelClass.getFieldDataSource("orderedParentIndex"),{parentIdField:a}=i.modelClass,l=[];let d;return e.forEach((e=>{d=d||(!(s in e)&&o in e?o:s);const t=e[a];r.has(t)||r.set(t,{append:[],insert:[]});const n=r.get(t);!e.isModel&&d in e?n.insert.push(e):n.append.push(e)})),r.forEach((({append:e,insert:r},s)=>{const o=null==s?i.rootNode:i.getById(s);if(!o)throw new Error(`Parent node with id ${s} not found, cannot add children.`);if(e.length&&l.push(...o.appendChild(e,t,n)),r.length)for(const e of r)"orderedParentIndex"in e&&("orderedParentIndex"in n&&W.isObject(n.orderedParentIndex)?n.orderedParentIndex.index=e.orderedParentIndex:n.orderedParentIndex=e.orderedParentIndex),l.push(o.insertChild(e,e[d],t,n))})),i.isFiltered&&i.reapplyFilterOnAdd&&i.filter({silent:!0}),i.reapplySortersOnAdd&&!i.isSyncingDataOnLoad&&i.sort(),l}if(!t&&!1===i.trigger("beforeAdd",{records:e}))return null;if(i.tree=i.tree||Boolean(i.autoTree&&e[0].children),i.tree)return i.rootNode.appendChild(e);const o=i.processRecords(e);return t&&i.suspendEvents(),i.addingClean=n.clean,s.add(o),i.addingClean=!1,t&&i.resumeEvents(),i.autoCommit&&i.doAutoCommit(),o}cloneImmutable(e){return!this.useRawData.enabled||e[0].isModel||Object.isExtensible(e[0])||(e=W.clone(e)),e}processRecords(e,t){return this.cloneImmutable(e).map((e=>{const n=this.processRecord(e.isModel?e:this.createRecord(e));return null==t||t.call(this,n),n}))}insert(e,t,n=!1){const r=this,i=r.storage,s=i.getAt(e),o=i.values,a=[];if(t=nt.asArray(t),r.tree){var l;const i=r.rootNode;return i.insertChild(t,null===(l=i.children)||void 0===l?void 0:l[e],n)}if(!n&&!1===r.trigger("beforeAdd",{records:t}))return null;let d,c,u;if(o[c=e]===t[0]||o[c=e-1]===t[0])for(d=!0,u=0;d&&u<t.length;u++)t[u]!==o[c+u]&&(d=!1);if(d)return null;const h=r.processRecords(t,(t=>{const n=i.indexOf(t);t.children&&t.children.length&&r.autoTree&&(r.tree=!0),n>-1&&(n<e&&s&&e--,a.push(n)),t.meta.previousIndex=n}));return r.suspendEvents(),r.storage.remove(a),r.resumeEvents(),n&&r.suspendEvents(),i.splice(e,0,...h),n&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),h}move(e,t){this.isTree?t.parent.insertChild(e,t):this.storage.move(e,t)}acceptChanges(){const e=this;e.added.forEach((e=>e.internalClearChanges(!0,!1))),e.modified.forEach((e=>e.internalClearChanges(!0,!1))),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return!(!e&&!1===this.trigger("beforeCommit",{changes:t}))&&(this.acceptChanges(),e||this.trigger("commit",{changes:t}),t)}revertChanges(){const e=this,{changes:t}=e;if(t){const n={action:"clearchanges",changes:t};e.add(e.removed.values,!0),e.remove(e.added.values,!0),e.modified.forEach((e=>e.revertChanges(!0))),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",n),e.trigger("refresh",n)}}get changes(){const e=this,t=e.modified.values.filter((e=>e.rawModifications));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get hasChanges(){return Boolean(this.added.count||this.removed.count||this.modified.values.some((e=>e.rawModifications)))}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.hasChanges&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(e=!0){this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},yo=e=>class extends(e||Qe){static $name="StoreChanges";static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(e){const t=this,{changes:n}=e;n&&(n.added&&t.add(n.added),n.removed&&t.remove(n.removed.map((e=>e.id))),n.modified&&n.modified.forEach((e=>{const n=t.getById(e.id);null==n||n.set(e.modifications)})))}applyChangeset(e,t=null,n="$PhantomId",r=!0,i=!1){const s=this,o=(null==t?void 0:t(e,s))??e,a=o.$input||o,{added:l,updated:d,modified:c,removed:u}=a,h=d??c??[],g=s.modelClass.getFieldDataSource("id"),m=s.modelClass.getFieldDataSource("parentId"),p=i?new Map:null,f=s.tree,v=[],y=[],b=new Set;let C=!1,w=[];if(s.trigger("startApplyChangeset"),s._groupVisibleRecordIds=[],s.isGrouped&&s.forEach((e=>{s._groupVisibleRecordIds.push(e.id)})),(null==l?void 0:l.length)>0){const e=[],t=[];for(const r of l){const i=s.getById(r[n])||s.getById(W.getPath(r,g));if(i)e.push(r),f&&b.add(i.parent);else{s.removed.get(r[n])||s.removed.get(W.getPath(r,g))||t.push(r)}}h.unshift.apply(h,e);const i=s.reapplySortersOnAdd;s.reapplySortersOnAdd=!1;const o=s.add(t,!1,{orderedParentIndex:{skip:!0},clean:r})??[];if(v.push(...o),s.reapplySortersOnAdd=i,f)for(const e of o){const{parent:t}=e;if(t.isRoot){C=!0,w=[t];break}!t.isRoot&&w.every((e=>!e.contains(t)))&&w.push(t),"orderedParentIndex"in e.originalData&&b.add(t)}for(const e of o)null==p||p.set(e.id,e.data),e.internalClearChanges();f&&b.forEach((e=>{e.updateChildrenIndices(e.orderedChildren,"orderedParentIndex",!0)}))}if((null==h?void 0:h.length)>0)for(const e of h){const t=e[n],r=W.getPath(e,g),i=W.getPath(e,m),o=s.removed.get(t)??s.removed.get(r),a=o??s.getById(t)??s.getById(r);if(a){var S;const l=null!=i&&(null===(S=s.getById(i))||void 0===S?void 0:S.isLeaf);this.filterTreeHierarchyChanges(b,a,e);const d=a.applyChangeset(e,n);o&&g in d&&t&&s.onRecordIdChange({record:a,oldValue:t,value:r}),l&&s.toggleCollapse(a.parent,!1),f&&a.parent&&!C&&w.every((e=>!e.contains(a)))&&(a.parent.isRoot?(C=!0,w=[a.parent]):w.push(a.parent)),null==p||p.set(r,d),y.push(a)}}if((null==u?void 0:u.length)>0&&s.applyRemovals(u),"changes"===s.applyChangesetFilterSortTarget){const e=s.filterChangeset(v,y);w.push(...e)}if(s.afterChangesetApplied(w),f&&s.isSorted&&s.reapplySortersOnAdd&&(null!=l&&l.length||null!=h&&h.length)){const e=new Set;w.forEach((t=>{e.has(t)||(e.add(t),t.sortVisibleChildren(!1,s.sorterFn),t.sortUnfilteredChildren(!1,s.sorterFn))})),s.storage.replaceValues({values:s.collectDescendants(s.rootNode).visible,silent:!0}),s.afterPerformSort(!1)}return s._groupVisibleRecordIds=null,s.trigger("endApplyChangeset"),p}afterChangesetApplied(e){const t=new Set;e.forEach((e=>{t.has(e)||e.traverse((e=>{t.has(e)||(t.add(e),e.sortOrderedChildren(!1,!1),e.children&&e.updateChildrenIndices(e.children,"parentIndex",!0),e.unfilteredChildren&&e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0))}))}))}applyRemovals(e){const t=this,{removed:n}=t,r=t.modelClass.idField,i=[];for(const t of e){const e=W.getPath(t,r);if(n.includes(e)){const t=n.get(e);t.internalClearChanges(!1,!0,null),t.$isPhantom=!0,n.remove(e)}else i.push(e)}if(t.tree){const e=i.reduce(((e,n)=>(t.getById(n)&&e.add(t.getById(n).parentNode??t.rootNode),e)),new Set);e.forEach((e=>e.sortOrderedChildren(!1,!1)))}t.remove(i);for(const e of i)n.remove(e)}filterChangeset(e,t){const n=this,{isFiltered:r,tree:i,isGrouped:s,filtersFunction:o}=n,a=n.isSorted?n.createSorterFn(n.sorters):void 0,{allValues:l,addedValues:d,isSorted:c}=n.storage,u=null!=a||c?a??n.storage.sortFunction:null,h=new Set;if(!r)return[];let g,m=!1;if(s&&(g=n.groupers,n.clearGroupers(!0)),i){const r=new Set(t.filter(o));for(const t of e.filter(o))r.add(t);r.forEach((e=>e.bubble((e=>r.add(e))))),r.delete(n.rootNode);const i=nt.groupByIndexed(Array.from(r).filter((e=>{var t;return!(null!==(t=e.parent)&&void 0!==t&&null!==(t=t.children)&&void 0!==t&&t.includes(e))})),(e=>e.parent));for(const[e,t]of i)e.unfilteredChildren&&(e.children.push(...t),h.add(e),n.traverseFilter(e,!1,t))}else if(u&&!s){const{filteredValues:e}=n.storage,r=d?e.findLastIndex((e=>!d.has(e)))+1:e.length,i=e.slice(0,r),s=new Set(t.filter(o));for(const t of e)s.has(t)&&s.delete(t);for(const e of s)i.push(e);i.sort(u),e.splice(0,r,...i),m=!0}else{const e=t.filter((e=>o(e)&&!n.storage.includes(e)));e.length>0&&(n.includeInSubset(l,n.storage.filteredValues,e),m=!0)}const p=new Set(e.filter((e=>!o(e))));if(p.size>0){if(i)for(const e of p)nt.remove(e.parent.children,e),h.add(e.parent);else nt.remove(n.storage.filteredValues,p);m=!0}return g&&(n.group(g[0],null,!1,!0,!0),m=!1,n._idMap=null),i&&h.size>0?n.storage.replaceValues({values:n.collectDescendants(n.rootNode).visible,silent:!0}):m&&(n._idMap=null,n.trigger("refresh")),[...h]}filterTreeHierarchyChanges(e,t,n){this.tree&&e.has(t.parent)&&(delete n.orderedParentIndex,delete n.parentIndex)}includeInSubset(e,t,n){const r=new Set(n);let i=0,s=0,o=0===r.size;for(;s<e.length&&!o;){const n=t[i];let a=e[s];for(;n!==a;)r.has(a)&&(t.splice(i,0,a),i++,r.delete(a),o=0===r.size),a=e[++s];r.has(n)&&r.delete(n),i<t.length&&i++}return t}},bo=e=>class extends(e||Qe){static $name="StoreFilter";static configurable={remoteFilter:!1,filterParamName:null};static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}static properties={filterBatching:0,needsFiltering:!1};updateFilterParamName(e){this.remoteFilter=null!=e}set reapplyFilterOnAdd(e){this.storage.autoFilter=e}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(e){const t=this,n=t.filters;if(n.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?n.add(new Js({filterBy:t[1]})):n.add(new Js("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?n.add(...e.map((e=>e instanceof Js?e:new Js(e)))):e.isCollection?n.add(...e.values):n.add(new Js({filterBy:e}));n.forEach((e=>e.owner=t))}}get filters(){return this._filters||(this._filters=new ho({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:n}=e;if(!e._filtersFunction)if(t.count){const r=Js.generateFiltersFunction(t);e._filtersFunction=e=>n&&e.isSpecialRow?e.groupChildren.some(r):!!e.isCreating||r(e)}else e._filtersFunction=ee.returnTrue;return e._filtersFunction}get isFiltered(){return!!(this._filters||this.isConfiguring&&this.initialConfig.filters)&&this.filters.values.some((e=>!e.disabled))}isFilteredOut(e){return this.isFiltered&&!this.filtersFunction(e)}traverseFilter(e,t=!0,n=void 0){const r=this,{filtersFunction:i}=r,s=!e.isRoot&&i(e),o=e.unfilteredChildren||e.children;return o&&o.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((e=>t?r.traverseFilter(e,t):i(e)||(null==n?void 0:n.has(e)))),r.isSorted&&e.children.sort(r.sorterFn),e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0),e.updateChildrenIndices(e.children,"parentIndex",!0),s||Boolean(e.children.length)):s}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.orderedChildren.slice(),e.unfilteredChildren=null),e.children&&(t.isSorted&&e.children.sort(t.sorterFn),e.children.forEach((e=>t.traverseClearFilter(e))),e.updateChildrenIndices(e.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(e,t=!1){const n=this;if((e=e instanceof Js?e:new Js(e)).owner=n,n.filters.add(e),!t){if(n.remoteFilter)return n.filter().then((()=>e));n.filter()}return e}filter(e){const t=this;let n,r=!1;if(e){let i=typeof e;if("object"===i&&("silent"in e||"replace"in e||e.filters)&&(r=e.silent,e.replace&&t.clearFilters(e.silent||0!==e.filters.length),n=e.internal,i=typeof(e=e.filters)),e){const r=t.isFiltered;if(t.isConfiguring=!0,Array.isArray(e))e.forEach((e=>t.addFilter(e,!0)),t);else if("function"===i){const r=new Js(e);r.internal=n,t.addFilter(r,!0)}else"string"===i?t.addFilter({property:e,value:arguments[1]},!0):t.addFilter(e,!0);if(t.isConfiguring=!1,!t.isFiltered&&!r)return null}}t.filtersFunction=null;const i=t.remoteFilter?t.performRemoteFilter(r):t.performFilter(r);return t._idMap=null,i}suspendFilterOnUpdate(){this.filterBatching++}resumeFilterOnUpdate(e){if(this.filterBatching--,this.filterBatching<0)throw new Error("No matching `startFilterBatching` call");0===this.filterBatching&&this.needsFiltering&&(this.needsFiltering=!1,this.performFilter(e))}performFilter(e){const t=this;if(t.filterBatching>0)return void(t.needsFiltering=!0);const{storage:n,filters:r,rootNode:i}=t,s=t.count;let o,a;if(e||t.trigger("beforeFilter",{filters:r}),t.tree){const e=n.values;t.isFiltered?t.traverseFilter(i):t.traverseClearFilter(i);const r=t.collectDescendants(i).visible;n.replaceValues({values:r,silent:!0});const s=nt.delta(r,e,!0);o=s.toAdd,a=s.toRemove}else n.ion({change({removed:e,added:t}){a=e,o=t},once:!0}),t.isFiltered?(t.isGrouped&&t.includeCollapsed(),n.addFilter({id:"primary-filter",filterBy:t.filtersFunction}),t.isGrouped&&t.excludeCollapsed()):n.filters.clear();t.afterPerformFilter(e||t.isRemoteDataLoading?null:{action:"filter",filters:r,oldCount:s,added:o,removed:a,records:t.storage.values})}async performRemoteFilter(e){var t;const n=this,{filters:r,count:i}=n;if(!1===await(null===(t=n.beforePerformFilter)||void 0===t?void 0:t.call(n,{filters:r,oldCount:i})))return;if(n.currentPage=1,!1===await n.performDataRequest(e))return;const s=e?null:{action:"filter",filters:r,oldCount:i,records:n.storage.values};n.afterPerformFilter(s),n.trigger("refresh",s)}buildRemoteParams(e={},t=!1){var n;null===(n=super.buildRemoteParams)||void 0===n||n.call(this,e,t);const r=this,{filters:i}=r;return r.isFiltered&&(e[r.filterParamName??"filters"]=t?r.encodeFilterParams(i):r.getFilterParams(i)),e}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}getFilterParams(e){return e.values.filter((e=>!e.disabled)).map((({property:e,operator:t,value:n,caseSensitive:r})=>({field:e,operator:t,value:n,caseSensitive:r})))}triggerFilterEvent(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){return this.filter(e)}removeFilter(e,t=!1){const n=this,r=e instanceof Js?e:n.filters.get(e)??n.filters.getBy("property",e);if(r){var i;if(null===(i=n._filters)||void 0===i||i.remove(r),n._filtersFunction=null,!t){if(n.remoteFilter)return n.filter().then((()=>r));n.filter()}return r}}clearFilters(e=!1){if(this.filters.remove(this.filters.values.filter((e=>!e.internal))),!e)return this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}doDestroy(){var e;null===(e=this._filters)||void 0===e||e.destroy(),super.doDestroy()}};const Co={add:1,replace:1},wo="!!novalue!!",So=({_groupValue:e},{_groupValue:t})=>e<t?-1:e>t?1:0;var Do=e=>class extends(e||Qe){static $name="StoreGroup";static configurable={groupers:null,useGroupFooters:!1,startGroupsCollapsed:null};static get properties(){return{collapsedGroups:new Set}}construct(e){super.construct(e),this.ion({change:"onDataChanged",thisObj:this})}get GroupRow(){return this._GroupRowClass||(this._GroupRowClass=class extends this.modelClass{static isSpecialRow=!0;static fields=[{name:"_groupValue"}];get isCollapsed(){return this.meta.collapsed}})}updateGroupers(e){this.setGroupers(e)}setGroupers(e,t=null){const n=this,{storage:r}=n;let i;return n._idMap=null,null!=e&&e.length?n._groupers=e.map((e=>n.createGrouper(e))):n.groupers&&(delete n._groupers,n.includeCollapsed(),r.replaceValues({values:n.removeHeadersAndFooters(r._values),filteredValues:r.isFiltered?n.removeHeadersAndFooters(r._filteredValues):null,silent:!0}),i=n.group(null,null,null,!1,null==t?void 0:t.silent)),i}createGrouper(e,t){if(!e||e.isGrouper)return e;"string"==typeof e&&(e={field:e,["boolean"==typeof t?"ascending":void 0]:t});const{field:n}=e,r=null==n?void 0:n.indexOf("."),i=r>0,s=null==n?void 0:n.split("."),o=i?s[0]:n,a=i?(d=s)[(c=-1)<0?d.length+c:c]:n,l=i?n.slice(r+1):n;var d,c;return{isGrouper:!0,...e,complexMapping:i,rootFieldName:o,leafFieldName:a,fieldPath:l}}get unfilteredGroupRecords(){const e=this;if(e.isGrouped){var t;const{generation:n}=e.storage;(null===(t=e._unfilteredGroupRecords)||void 0===t?void 0:t.generation)!==n&&(e._unfilteredGroupRecords=e.storage.allValues.filter((e=>e.isSpecialRow)),e._unfilteredGroupRecords.generation=n)}return e._unfilteredGroupRecords||[]}getGroupHeaderForRecord(e,t=!1){if(this.isGrouped)return e?"groupRowFor"in e.meta?e:e.instanceMeta(this).groupParent:this.groupRecords.last}includeCollapsed(){for(const e of this.collapsedGroups)this.expand(this.getById(e),!1)}excludeCollapsed(){for(const e of this.collapsedGroups)this.collapse(this.getById(e))}onDataChange({source:e,action:t,removed:n}){var r;const i=this,{groupers:s}=i;s&&(s.length?"splice"!==t&&"move"!==t||e.replaceValues({...i.prepareGroupRecords(),silent:!0}):e.replaceValues({values:i.removeHeadersAndFooters(e._values),filteredValues:e.isFiltered?i.removeHeadersAndFooters(e._filteredValues):null,silent:!0})),null===(r=super.onDataChange)||void 0===r||r.call(this,...arguments)}move(e,t){const n=this;let r;if(n.isGrouped&&!n.tree){var i,s;let o=t;if(null!==(i=t)&&void 0!==i&&i.isSpecialRow&&(o=n.getPrev(t,!1,!1),!o))return;const a=n.getGroupHeaderForRecord(o),l=n.groupers[0].field,{reapplyFilterOnUpdate:d}=n,c="array"===n.modelClass.getFieldDefinition(l).type;let u=a.meta.groupRowFor;if(n.reapplyFilterOnUpdate=!1,n.beginBatch(),e.forEach((e=>{if(c){const t=e.get(l)||[];if(t.includes(u))return;{const n=e.instanceMeta(this).groupParent,i=a._groupValue;nt.remove(t,n),u=t.slice(),i===wo?u=void 0:Array.isArray(i)&&0===i.length?u=[]:u.push(i),r=!0}}e.setValue(l,u)})),n.endBatch(),c&&!r)return;if(n.reapplyFilterOnUpdate=d,n.isFiltered&&null!==(s=t)&&void 0!==s&&s.isSpecialRow){const{unfilteredGroupRecords:e}=n,r=e.indexOf(a);t=e[r+1]}}super.move(e,t),r&&n.group(n.groupers[0])}collapse(e){let t=!1;return e&&(e=nt.asArray(e)).forEach((e=>{e&&!e.meta.collapsed&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,this.collapsedGroups.add(e.id),this.trigger("toggleGroup",{groupRecord:e,collapse:!0}),t=!0)})),t}expand(e,t=!0){let n=!1;return e&&(e=nt.asArray(e)).forEach((e=>{null!=e&&e.meta.collapsed&&(this.includeGroupRecords(e),e.meta.collapsed=!1,t&&this.collapsedGroups.delete(e.id),t&&this.trigger("toggleGroup",{groupRecord:e,collapse:!1}),n=!0)})),n}removeHeadersAndFooters(e){return e.filter((e=>(null!=e&&e.unfilteredGroupChildren&&(e.groupChildren.length=e.unfilteredGroupChildren.length=e.meta.childCount=0),!(null!=e&&e.isSpecialRow||null!=e&&e.isLinked&&e.instanceMeta(this).groupParent)||(this.unregister(e),!1))))}prepareGroupRecords(){var e;const t=this,{GroupRow:n,isFiltered:r,reapplyFilterOnUpdate:i,groupRecords:s}=t,o=t.groupers[0],a=!1!==o.ascending?1:-1,{field:l,fn:d=So,leafFieldName:c}=o,u="function"==typeof l,h=l===t.modelClass.idField,g=new ho,m=t._groupVisibleRecordIds||[],p=e=>{const n=!r||t.filtersFunction(e);return i?n:n||m.includes(e.id)},f=Boolean(t.startGroupsCollapsed&&!(null!=s&&s.count));null==s||s.forEach((e=>{e.isCollapsed&&t.includeGroupRecords(e)}));const v=t.removeHeadersAndFooters(t.storage._values);if(t.sorters.length&&v.sort(t.sorterFn),r&&(t.filtersFunction=null),v.forEach((e=>{const r=e,i=u?l(e):e.getValue(l),o=nt.asArray(null==i?wo:i),a=Array.isArray(o)&&!o.length,d=a?1:o.length;for(let i=0;i<d;i++){const l=a?[]:o[i],d=`group-header-${"number"==typeof l?l:N.createId(l)}`;let u=g.get(d);if(u||(u=(null==s?void 0:s.get(d))||new n({[t.modelClass.idField]:d,[h?"":c]:l,_groupValue:l},t,{collapsed:f,specialRow:!0,groupRowFor:l,groupField:c,emptyArray:a}),g.add(u),u.meta.childCount=0,u.groupChildren=[],u.unfilteredGroupChildren=[],u.stores=[t]),t.register(u),i>0){const n=r.groupLinks||(r.groupLinks={});(e=n[l]||(n[l]=r.link())).stores=[t],t.register(e)}e.instanceMeta(t).groupParent=u,p(e)&&(u.groupChildren.push(e),u.meta.childCount++),u.unfilteredGroupChildren.push(e)}})),g._values.sort(((e,t)=>d(e,t)*a)),t.useGroupFooters)for(let e=0,r=g.count;e<r;e++){const i=g.values[e],s=i.meta.groupRowFor,o=`group-footer-${"number"==typeof s?s:N.createId(s)}`,a=t.getById(o)||new n({[t.modelClass.idField]:o,[h?"":c]:s,_groupValue:s},t,{specialRow:!0,groupFooterFor:s,groupRecord:i});a.stores=[t],t.register(a),a.groupChildren=i.groupChildren,g.splice(++e,0,a),r++,i.groupChildren.push(a),i.unfilteredGroupChildren.push(a),i.meta.childCount++}t._idMap=null;const y={values:g.reduce(((e,t)=>(t.isGroupFooter||(e.push(t),t.meta.collapsed||e.push(...t.unfilteredGroupChildren)),e)),!1,[])};return r&&(y.filteredValues=y.values.filter(p)),null===(e=t.groupRecords)||void 0===e||e.forEach((e=>{g.includes(e)||e.destroy()})),t.groupRecords=g,y}get isGrouped(){var e;return Boolean(null===(e=this.groupers)||void 0===e?void 0:e.length)}group(e,t,n=!1,r=!0,i=!1){const s=this,{sorters:o=[]}=s,a=s.createGrouper(e,t);let l,d=!1;if(n)s.groupers.push(a);else if(e){var c,u;if(null==t&&!("ascending"in a))a.ascending=!a.fn||(null===(c=s.groupInfo)||void 0===c?void 0:c.field)!==a.field||(null===(u=s.groupInfo)||void 0===u?void 0:u.fn)!==a.fn||!s.groupInfo.ascending;s.groupInfo=l=a,s.groupers=[s.groupInfo],o.some((t=>t.field===e))&&(s.sorters=o.filter((t=>t.field!==e)),d=!0)}else null===e&&null===t?(r=!0,d=!0):!d&&o.length&&r&&(d=!0);if(l){const{prototype:t}=s.modelClass;l.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return W.getPath(this,e)}})}if(!1!==r){if(s.remoteSort&&!s.isRemoteDataLoading)return s.sort(null,null,!1,!d).then((()=>s.onAfterGrouping(i,!d)));s.sort(null,null,!1,!d)}s.onAfterGrouping(i,!d)}onAfterGrouping(e,t=!0){if(e)return;const n=this,r=n.groupers||[];n.trigger("group",{isGrouped:n.isGrouped,groupers:r,records:n.storage.values}),t&&n.trigger("refresh",{action:"group",isGrouped:n.isGrouped,groupers:r,records:n.storage.values})}addGrouper(e,t=!0){return this.group(e,t,!0)}removeGrouper(e){const t=this,{groupers:n}=t;if(!n)return;const r=n.findIndex((t=>t.field===e));return r>-1?(n.splice(r,1),n.length?t.group():t.clearGroupers()):void 0}clearGroupers(e=!1){return this.setGroupers(null,{silent:e})}isRecordInGroup(e,t){var n;if(!this.isGrouped)return!1;const r=null===(n=this.groupers[0])||void 0===n?void 0:n.field;return e.getValue(r)===t&&!e.isSpecialRow}isInCollapsedGroup(e){const{groupParent:t}=e.instanceMeta(this);return null==t?void 0:t.meta.collapsed}getGroupRecords(e){return this.isGrouped?this.storage.values.filter((t=>this.isRecordInGroup(t,e))):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}get groupHeaderRecords(){return this.useGroupFooters?this.groupRecords.values.filter((e=>e.isGroupHeader)):this.groupRecords.values}onDataChanged({changes:e,action:t}){this.isGrouped&&(!e&&Co[t]||e&&this.groupers.some((t=>t.rootFieldName in e)))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const n=this,r=n.indexOf(e),i=n.allIndexOf(e),{id:s,storage:o}=n,{_filteredValues:a,_values:l}=o,{meta:d,groupChildren:c,unfilteredGroupChildren:u}=e;-1===i||d.collapsed&&!t||!d.collapsed&&t||(u.forEach((e=>e.instanceMeta(s).hiddenByCollapse=!t)),t?(a&&a.splice(r+1,0,...c.filter((e=>!n.isAvailable(e.id)))),o._values.splice(i+1,0,...u.filter((e=>!n.isAvailable(e.id))))):(a&&a.splice(r+1,c.length),l.splice(i+1,u.length)),o._indicesInvalid=!0,n._idMap=null)}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(e,t=!0){return(e?this.storage.allValues:this.storage.values).reduce(((n,r)=>(r.isSpecialRow&&(t&&!r.isGroupFooter&&n.push(r),r.isGroupHeader&&n.push.apply(n,e?r.unfilteredGroupChildren:r.groupChildren)),n)),[])}};const Eo=Promise.resolve();var xo=e=>class extends(e||Qe){static $name="StorePaging";static configurable={pageSize:50,pageSizeParamName:"pageSize",pageParamName:null,pageStartParamName:null,remotePaging:!1};get currentPage(){return this._currentPage??1}set currentPage(e){this.totalCount&&(e=Math.min(e,this.lastPage)),this._currentPage=e}updatePageParamName(e){if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this.remotePaging=null!=e}updatePageStartParamName(e){if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this.remotePaging=null!=e}get defaultPageParamName(){return this.pageParamName??this.pageStartParamName??"page"}updateRemotePaging(e){if(e&&this.tree)throw new Error("Paging cannot be supported for tree stores")}updatePageSize(e){const t=this;!t.isConfiguring&&e&&(t.currentPage=t.currentPage?Math.min(t.currentPage,Math.floor((t.totalCount+e-1)/e)):1,t.loadPage(t.currentPage))}get isPaged(){return this.remotePaging}set pagedTotal(e){this.remoteTotal=e}get lastPage(){if(this.isPaged)return Math.floor((this.totalCount+this.pageSize-1)/this.pageSize)}async loadPage(e,t={}){if(t=this.getPagingParams({...t,page:e}),!1===await this.trigger("beforeLoadPage",{params:t}))return!1;var n;!1!==await this.performDataRequest(!1,t,(()=>{this.currentPage=e}))&&(null===(n=this.trigger)||void 0===n||n.call(this,"loadPage",t))}async nextPage(e){const t=this;return t.isPaged&&t.currentPage!==t.lastPage?t.loadPage(t.currentPage+1,e):Eo}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):Eo}buildRemoteParams(e={},t=!1){var n;return this.getPagingParams((null===(n=super.buildRemoteParams)||void 0===n?void 0:n.call(this,e,t))??e)}getPagingParams(e){const t=this;if(t.isPaged){let n=e[t.defaultPageParamName]??t.currentPage;this.pageStartParamName&&(n=Math.max(0,n-1)*this.pageSize),e[t.defaultPageParamName]=n,e[t.pageSizeParamName]=t.pageSize}return e}},Ro=e=>class extends(e||Qe){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(e,t){if(t in e)return e[t];if("$store"===t)return e;let n=e.getById(t);return n||isNaN(parseInt(t))||(n=e.getAt(parseInt(t))),n},set:(e,t,n)=>(t in e||e.isDestroying||t.startsWith("_")?e[t]=n:e.add({[e.modelClass.idField]:t,...n}),!0),deleteProperty:(e,t)=>e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length),has(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){const e=N.safeJsonParse(t);t=null==e?void 0:e.id}return e.includes(t)}})}},To=e=>class extends(e||Qe){static $name="StoreRelation";initRelations(e){const t=this,n=t.modelClass.exposedRelations;e&&t.modelRelations&&t.modelRelations.forEach((e=>{var t;return null===(t=e.storeDetacher)||void 0===t?void 0:t.call(e)})),t.modelRelations&&0!==t.modelRelations.length&&!e||t.isChained||(t.modelRelations=[],null==n||n.forEach((n=>{const r={...n},{foreignStore:i,relationName:s,relatedCollectionName:o}=r,a="string"==typeof i?t[i]:i;if(r.dependentStore=t,t.modelRelations.push(r),a){r.foreignStoreProperty=r.foreignStore,r.foreignStore=a;const n=a.dependentStoreConfigs;if(n.has(t)){const i=n.get(t);if(e){const e=i.find((e=>e.relationName===s));e&&nt.remove(i,e)}i.push(r)}else n.set(t,[r]);o&&a.initRelationCollection(r,t),a.count>0&&a.updateDependentStores("dataset",a.records)}})))}initRelationCollection(e,t){const n=this,r=e.relatedCollectionName;(n.collectionStores||(n.collectionStores={}))[r]={store:t,config:e},n[r+"Store"]||(n[r+"Store"]=t),n.allRecords.length&&n.initModelRelationCollection(r,n.allRecords)}initModelRelationCollection(e,t){const n=this;t.forEach((t=>{t.traverse((t=>{const r=e in t?`$related${N.capitalize(e)}`:e;Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,e)},set:function(t){return n.setCollection(this,e,t)}})}))}))}resetRelationCache(){this.relationCache={},this.forEach((e=>e.initRelations()))}updateRecordRelationCache(e,t){null==t||t.forEach((t=>{const{config:n}=t,r=t.related?t.related.id:e.getValue(n.foreignKey);void 0!==r&&this.cacheRelatedRecord(e,r,n.relationName,r)}))}getRelationCollection(e,t){var n;const r=_s.asId(t);return(null===(n=this.relationCache[e])||void 0===n?void 0:n[r])||[]}getCollection(e,t){var n;const{config:r,store:i}=this.collectionStores[t];return(null===(n=i.relationCache[r.relationName])||void 0===n?void 0:n[e.id])||[]}setCollection(e,t,n){const{config:r,store:i}=this.collectionStores[t],s=((i.relationCache[r.relationName]||(i.relationCache[r.relationName]={}))[e.id]||[]).slice(),o=[],a=[];i.suspendEvents(),s.forEach((e=>{n.includes(e)||(e[r.foreignKey]=null,i.remove(e),a.push(e))})),n.forEach((t=>{t.isModel instanceof _s?t.stores.includes(i)||(i.add(t),o.push(t)):([t]=i.add(t),o.push(t)),t[r.foreignKey]=e.id})),i.resumeEvents(),a.length&&(i.trigger("remove",{records:a}),i.trigger("change",{action:"remove",records:a})),o.length&&(i.trigger("add",{records:o}),i.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,n,r=null){const i=this,s=i.relationCache[n]||(i.relationCache[n]={});null!==r&&i.uncacheRelatedRecord(e,n,r),null!=t&&nt.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,n=null){const r=this;function i(t,n){const i=r.relationCache[t],s=null==i?void 0:i[n];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[n]}}null!=n?i(t,n):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((([e,t])=>i(e,null==t?void 0:t.id)))}updateDependentStores(e,t,n){var r;const i=this,s="dataset"===e;var o;(i.dependentStoreConfigs.forEach((r=>{r.forEach((r=>{const{dependentStore:o,relatedCollectionName:a,relationName:l,foreignKey:d,propagateRecordChanges:c}=r,u=o.relationCache[l];if(s)a&&i.initModelRelationCollection(a,t),o.forEach((e=>{const t=e.initRelation(r);t&&o.cacheRelatedRecord(e,t.id,l,t.id)})),c&&o.totalCount&&o.trigger("refresh",{action:"relatedstoredataset",records:o.records});else{if("removeall"===e)return o.forEach((e=>e.removeRelation(r))),void delete o.relationCache[l];"replace"===e&&(t=t.map((e=>e[1])))}"add"!==e&&"replace"!==e||a&&i.initModelRelationCollection(a,t),s||t.forEach((t=>{const s=null==u?void 0:u[t.id];switch(e){case"remove":s&&s.forEach((e=>e.removeRelation(r)));break;case"add":case"replace":o.forEach((e=>{e.getValue(d)==t.id&&(e.initRelation(r),o.cacheRelatedRecord(e,t.id,l))}))}!n&&null!=s&&s.length&&c&&s.forEach((e=>e.stores.forEach((n=>i.notifyRelatedStore(n,e,r.relationName,t)))))}))}))})),null!==(r=t)&&void 0!==r&&r.length)&&(null===(o=i.modelRelations)||void 0===o||o.forEach((e=>{e.propagateRecordChanges&&(s?e.foreignStore.totalCount&&e.foreignStore.trigger("refresh",{action:"relatedstoredataset",records:e.foreignStore.records}):t.forEach((t=>{var n;const r=t[e.relationName];null==r||null===(n=r.stores)||void 0===n||n.forEach((n=>{i.notifyRelatedStore(n,r,e.relatedCollectionName,t)}))})))})))}notifyRelatedStore(e,t,n,{meta:r}){var i;if(this.isChained||e.isChained)return;let{_ignoreRelationUpdate:s}=r,o=!1;null!==(i=s)&&void 0!==i&&i.size||(r._ignoreRelationUpdate=s=new Set,o=!0),s.has(e)||(s.add(this).add(e),t.meta._ignoreRelationUpdate=s,e.onModelChange(t,{[n]:t[n]},{[n]:t[n]},!1,!0),o&&s.clear())}updateDependentRecordIds(e,t){var n;null===(n=this.dependentStoreConfigs)||void 0===n||n.forEach((n=>{n.forEach((n=>{var r;const{dependentStore:i,relationName:s,foreignKey:o}=n,a=i.relationCache[s],l=null==a||null===(r=a[e])||void 0===r?void 0:r.slice();null==l||l.forEach((n=>{i.cacheRelatedRecord(n,t,s,e),n.meta._ignoreRelatedIdUpdate=!0,n.set(o,t,!1,!0),delete n.meta._ignoreRelatedIdUpdate}))}))}))}},Mo=e=>class extends(e||Qe){static $name="StoreSum";sum(e,t=this.storage.values){return t?t.reduce(((t,n)=>{if(n.isSpecialRow)return t;const r=Number(n.getValue(e));return isNaN(r)?t:t+r}),0):0}min(e,t=this.storage.values){return null!=t&&t.length?t.reduce(((t,n)=>{const r=n.getValue(e);return"number"===typeof(null==r?void 0:r.valueOf())&&(r<t||null==t)&&(t=r),t}),t[0].getValue(e)):0}max(e,t=this.storage.values){return null!=t&&t.length?t.reduce(((t,n)=>{const r=n.getValue(e);return"number"===typeof(null==r?void 0:r.valueOf())&&(r>t||null==t)&&(t=r),t}),t[0].getValue(e)):0}average(e,t=this.storage.values){if(null==t||!t.length)return 0;let n=0;const r=t.reduce(((t,r)=>{if(r.isSpecialRow)return t;const i=parseFloat(r.getValue(e));return isNaN(i)?t:(n++,t+i)}),0);return n>0?r/n:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}};const ko=(e,t)=>String(e).toLowerCase().includes(t),Fo={string:ko,number:(e,t)=>e===Number(t),boolean:ko,date:(e,t)=>e instanceof Date&&t instanceof Date?e-t==0:String(e.getMonth()+1).includes(t)||String(e.getDate()).includes(t)||String(e.getFullYear()).includes(t),object:(e,t)=>e===t,undefined:(e,t)=>e===t};var Io=e=>class extends(e||Qe){static $name="StoreSearch";search(e,t=null,n,r){const i=this.isTree&&!r?this.rootNode.allChildren:this.getAllDataRecords(r),s=i.length,o=[];if(null==e)return[];let a,l,d,c,u,h;for("string"==typeof e&&(e=e.toLowerCase()),t||(t=this.modelClass.allFields.map((e=>e.name))),a=0;a<s;a++){d=i[a],l=0;for(const r of t){var g;c=d.getValue(r),u=c instanceof Date?"date":typeof c;const t=null==n?void 0:n[l];t&&(c=t(c),u="string"),h=Fo[u],c&&null!==(g=h)&&void 0!==g&&g(c,e)&&o.push({index:a,data:d,field:r,id:d.id}),l++}}return o}findByField(e,t,n=!1,r=!1){const i=this.getAllDataRecords(r),s=i.length,o=new Set,a=[];let l,d,c;for(null!=t&&(t=String(t).toLowerCase()),l=0;l<s;l++)if(d=i[l],c=d.getValue(e),!n||!o.has(c)){const e=c instanceof Date?"date":typeof c;(null==t&&c===t||""===t&&""===c||t&&(0,Fo[e])(c,t))&&(a.push({id:d.id,index:l,data:d}),n&&o.add(c))}return a}find(e,t=!1){return this.getAllDataRecords(t).find(e)}findRecord(e,t,n=!1){const r=n=>W.isEqual(n[e],t);return this.isTree?this.query(r,n)[0]:this.getAllDataRecords(n).find(r)}query(e,t=!1){return this.getAllDataRecords(t).filter(e)}some(e,t=!1){return this.getAllDataRecords(t).some(e)}},Ao=e=>class extends(e||Qe){static $name="StoreSort";static get defaultConfig(){return{useLocaleSort:null}}static configurable={sorters:[],reapplySortersOnAdd:!1,reapplySortersOnUpdate:!1,remoteSort:!1,sortParamName:null};get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}changeSorters(e){return e.map((e=>this.normalizeSorterConfig(e,!0)))}updateSortParamName(e){this.remoteSort=null!=e}sort(e,t,n=!1,r=!1){const i=this,s=i.allRecords,o=i.sorters?i.sorters.slice():[];let a,l=null;if(e)if(Array.isArray(e))i.sorters=e.map((e=>i.normalizeSorterConfig(e,"string"==typeof e||t)));else{const r=i.normalizeSorterConfig(e,t);n?(a=i.getCurrentSorterByField(r.field),a?(l=a.ascending,a.ascending=r.ascending):i.sorters.push(r)):i.sorters=[r]}return r||!1!==i.trigger("beforeSort",{sorters:i.sorters,records:s,currentSorters:o})?i.remoteSort?i.performRemoteSort(r):i.performSort(r):(i.sorters=o,null!==l&&(a.ascending=l),null)}normalizeSorterConfig(e,t){const n=this,r={ascending:t};if("object"==typeof e?(W.assign(r,e),e.fn&&(delete r.fn,r.sortFn=e.fn),r.ascending=e.ascending??t):"function"==typeof e?r.sortFn=e:r.field=e,null==r.ascending){const e=n.getCurrentSorterByField(r.field);r.ascending=!e||!e.ascending}if(null==r.sortFn){var i;const e=null===(i=n.modelClass)||void 0===i||null===(i=i.$meta.fields.map[r.field])||void 0===i?void 0:i.compareItems;e&&(r.sortFn=e)}return r}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find((t=>t.field===e))||null}addSorter(e,t=!0){return this.sort(e,t,!0)}removeSorter(e){const t=this.sorters.findIndex((t=>t.field===e||t.sortFn===e));if(t>-1)return this.sorters.splice(t,1),this.sort()}clearSorters(e=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,e)}suspendSortOnUpdate(){"_reapplySortersSuspended"in this||(this._reapplySortersSuspended=0),this._reapplySortersSuspended++}resumeSortOnUpdate(e=!0){const t=this;t._reapplySortersSuspended&&(t._reapplySortersSuspended--,!t._reapplySortersSuspended&&t._shouldReapplySorters&&(e&&t.sort(),t._shouldReapplySorters=!1))}createSorterFn(e){const t=this.useLocaleSort;return(n,r)=>{for(let i=0;i<e.length;i++){const s=e[i],{field:o,ascending:a=!0,useLocaleSort:l=t,caseSensitive:d=!0}=s,c=s.fn||s.sortFn,u=a?1:-1;if(c){const e=c.call(s,n,r);if(0===e)continue;if(null!==e)return e*u}let h=n.isModel?n.getValue(o):n[o],g=r.isModel?r.getValue(o):r[o];if(d||("string"==typeof h&&(h=h.toLowerCase()),"string"==typeof g&&(g=g.toLowerCase())),h!==g){if(null==h)return-u;if(null==g)return u;if(l&&"string"==typeof h){if(!0===l)return String(h).localeCompare(g)*u;if("string"==typeof l)return String(h).localeCompare(g,l)*u;if("object"==typeof l)return String(h).localeCompare(g,l.locale,l)*u}if(h>g)return u;if(h<g)return-u}}return 0}}get sorterFn(){return this.createSorterFn(this.remoteSort?[{field:"_remoteSortIndex"}]:this.sorters)}performSort(e){const t=this,{rootNode:n,storage:r,sorterFn:i}=t;t.tree?(!t.isChained&&n.traverse((e=>{e.isLoaded&&e.isParent&&(e.children.sort(i),e.updateChildrenIndices(e.children,"parentIndex",!0))})),r.replaceValues({values:t.collectDescendants(n).visible,silent:!0})):t.isGrouped?r.replaceValues({...t.prepareGroupRecords(),silent:!0}):r.replaceValues({values:r.values.sort(i),silent:!0}),t.afterPerformSort(e||t.isRemoteDataLoading)}async performRemoteSort(e){var t;!1!==await(null===(t=this.beforePerformSort)||void 0===t?void 0:t.call(this))&&!1!==await this.performDataRequest(e)&&this.afterPerformSort(e)}buildRemoteParams(e={},t=!1){var n;let{sorters:r,groupers:i,sortParamName:s="sorters"}=this;return null===(n=super.buildRemoteParams)||void 0===n||n.call(this,e,t),i&&(r=i.concat(r)),r.length&&(e[s]=t?this.encodeSorterParams(r):this.getSorterParams(r)),e}getSorterParams(e){return e.filter((e=>!e.sortFn)).map((({field:e,ascending:t})=>({field:e,ascending:t})))}afterPerformSort(e){if(e)return;const t=this;t._idMap=null;const n={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",n),t.trigger("refresh",n)}};const Lo=()=>!0;var Po=e=>class extends(e||Qe){static $name="StoreChained";static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0,syncSort:!0,ignoreLinkRecords:!1,chainFilters:null,chainSuspended:0}}static get properties(){return{chainedStores:null,isChainedTree:null}}construct(e){super.construct(e);const t=this,{masterStore:n}=t;n&&(t.methodNamesToRelay.forEach((e=>t[e]=(...n)=>t.relayToMaster(e,n))),t.removeAll=(...e)=>{n.remove(t.getRange(),...e)},n.ion({name:"masterStoreListeners",changePreCommit:t.onMasterDataChangedPreCommit,change:t.onMasterDataChanged,prio:1,thisObj:t}),t.syncSort&&n.ion({sort:()=>t.sort(n.sorters),thisObj:t}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(t),t.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||Lo}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter((e=>!t||!this.dontRelayToMaster.includes(e)))||[]}updateChainedStores(){var e;null===(e=this.chainedStores)||void 0===e||e.forEach((e=>e.fillFromMaster()))}fillFromMaster(){const e=this,{masterStore:t,isTree:n}=e,{isFiltered:r}=t;if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(e.isChainSuspended)return;let i,s=null;if(e.chainFilters&&r){const e=t.filters.values.filter((e=>!e.ignoreForChain));e.length&&(s=Js.generateFiltersFunction(e))}if(e.isChainedTree)return e.fillTreeFromMaster(s);if(i=t.allRecords.filter((n=>{if(!n.isSpecialRow&&(!e.ignoreLinkRecords||!n.isLinked)&&e.chainedFilterFn(n)&&(!s||s(n)))return!(e.excludeCollapsedRecords&&!n.ancestorsExpanded(t))})),e.masterStore.sorterFn&&r&&t.isSorted&&!t.remoteSort&&i.sort(t.sorterFn),n)if(e.idRegister={},e.internalIdRegister={},i.forEach((t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords){const t=e.getChildren(e.rootNode);i=e.doIncludeExclude(t,!0)}else i.forEach((t=>t.instanceMeta(e).collapsed=!1));e.isFillingFromMaster=!0,e.data=i,e.isFillingFromMaster=!1}fillTreeFromMaster(e){const t=this,{chainedFilterFn:n}=t,r=t.masterStore.rootNode,i=[],s=t.treeLinkMap||{},o=t.idRegister={},a=t.internalIdRegister={};t.treeLinkMap={},Hs.postWalk({children:r.unfilteredChildren||r.children},(e=>!e.isLeaf&&(e.unfilteredChildren||e.children)),(r=>{var l;if(r.isLeaf&&(!e||e(r))&&n(r)||!r.isLeaf&&null!==(l=r.meta)&&void 0!==l&&null!==(l=l.tempChildren)&&void 0!==l&&l.length){var d;const e=null===(d=r.parent)||void 0===d?void 0:d.meta,n=s[r.id],l=r.isLeaf&&n,c=l||r.link(),u=c.proxyMeta.data;t.treeLinkMap[r.id]=c,l?(u.parent=u.parentIndex=u.unfilteredIndex=u.parentId=u.children=u.orderedChildren=u.unfilteredChildren=null,o[c.id]=r,a[c.internalId]=r):n&&c.removeLink(c),e.tempChildren||(e.tempChildren=[]),e.tempChildren.push(c),r.isParent&&i.unshift(c)}})),t.isFillingFromMaster=!0;for(let e=i.length-1;e>=0;e--){const t=i[e],{meta:n}=t.$original;n.tempChildren&&(t.meta.isFillingFromMaster=!0,t.appendChild(n.tempChildren,!0),t.meta.isFillingFromMaster=!1,n.tempChildren=null)}t.data=r.meta.tempChildren||[],t.isFillingFromMaster=!1,r.meta.tempChildren=null}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChangedPreCommit(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}onMasterDataChanged({action:e,changes:t,isMove:n}){var r;const i=this;i.$masterEventhandled?i.$masterEventhandled=!1:n&&"remove"===e||("update"!==e||"*"===i.chainedFields||null!==(r=i.chainedFields)&&void 0!==r&&r.some((e=>e in t))||"isLeaf"in t||"parentId"in t)&&i.fillFromMaster()}makeChained(e=Lo,t,n){return G.deprecate("core","7.0.0","makeChained() deprecated in favor of chain() and chainTree()"),this.chain(e,t,n)}chain(e=Lo,t,n){if(this.isChained){const t=e;e=e=>t(e)&&this.chainedFilterFn(e)}return new((null==n?void 0:n.storeClass)||this.constructor)({id:`${this.id}-chained-${N.generateUUID()}`,tree:!1,autoTree:!1,...n||{},masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:e,chainedFields:t})}chainTree(e,t,n){if(!this.tree)throw new Error("chainTree only allowed on tree stores");return this.chain(e,t,{tree:!0,isChainedTree:!0,...n})}doDestroy(){var e;this.detachListeners("masterStoreListeners"),null===(e=this.chainedStores)||void 0===e||e.forEach((e=>e.destroy())),super.doDestroy()}suspendChain(){this.chainSuspended++}resumeChain(e=!1){this.chainSuspended&&! --this.chainSuspended&&e&&this.fillFromMaster()}get isChainSuspended(){return this.chainSuspended>0}},Oo=e=>class extends(e||Qe){static $name="StoreState";getState(){const{sorters:e,groupers:t,filters:n}=this,r={};return null!=e&&e.length&&(r.sorters=e.map((e=>{const t=W.cleanupProperties(W.clone(e));return delete t.fn,delete t.sortFn,t}))),null!=t&&t.length&&(r.groupers=t.map((e=>{const t=W.cleanupProperties(W.clone(e));return delete t.fn,t})),r.collapsedGroups=[...this.collapsedGroups]),null!=n&&n.values.length&&(r.filters=n.allValues.map((e=>e.getState()))),r}applyState(e){var t;const n=this,{sorters:r=[],groupers:i=[],filters:s=[]}=e,{sortParamName:o,filterParamName:a}=n;(n.isSorted||0!==r.length||0!==i.length)&&(n.sorters=r.filter((e=>e.field||e.sortFn&&!o)),n.groupers=i.slice(),i.length?n.group():n.sort()),null===(t=e.collapsedGroups)||void 0===t||t.forEach((e=>{const t=n.getById(e);t&&n.collapse(t,!0)})),(n.isFiltered||0!==s.length)&&(n.filters=s.filter((e=>e.property||e.filterBy&&!a)),n.filter())}};const $o=e=>String(e).padStart(6,"0");class _o{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(e??"")}get value(){return this._value}static from(e){return null==e||e instanceof _o?e:new _o(e)}static pad(e){return e instanceof _o?e.valueOf():_o.split(e).map($o).join(".")}static split(e){let t,n;if(e||0===e)switch(typeof e){case"object":e=String(e);case"string":for(n=e.split("."),t=n.length;t-- >0;)n[t]=parseInt(n[t],10);break;case"number":n=[e]}return n||[]}static compare(e,t){return e===t?0:e&&t?(e=_o.pad(e))<(t=_o.pad(t))?-1:t<e?1:0:e?1:t?-1:0}append(e){const t=this.value;return _o.from(t?`${t}.${e}`:e)}isEqual(e){return!_o.compare(this,e)}match(e){let t=!1;if(e){const n=this.value,r="*"===e[0],i=e.endsWith("*"),s=e.length;t=r===i?n.indexOf(r?e.substr(1,s-2):e)>-1:r?n.endsWith(e.substr(1)):n.startsWith(e.substr(0,s-1))}return t}toString(){return this.value}toJSON(){return this.toString()}valueOf(){return this._padded??(this._padded=_o.pad(this.value))}}_o._$name="Wbs";const Ho=Object.freeze([]),Vo=Symbol("StopBranch"),No=N.generateUUID();var Bo=e=>class extends(e||Qe){static $name="StoreTree";static StopBranch=Vo;get StopBranch(){return Vo}static configurable={transformFlatData:null,fireRemoveEventForMoveAction:!1,keepExpandedOnLoad:!1};get isTree(){var e;return this.tree??(null===(e=this.masterStore)||void 0===e?void 0:e.tree)}get leaves(){const e=[];return this.isTree?this.traverse((t=>{t.isLeaf&&e.push(t)})):this.allRecords.forEach((t=>{t.isLeaf&&e.push(t),t.traverse((t=>{t.isLeaf&&e.push(t)}),!0)})),e}async loadChildren(e){}onNodeAddChild(e,t,n,r,i=!1){const s=this,o=e===s.rootNode&&e.isLoading,{storage:a}=s,{previousSibling:l}=t[0];let d;const{visible:c,all:u}=s.collectDescendants(t,void 0,void 0,{inCollapsedBranch:!(e.isExpanded(s)&&e.ancestorsExpanded(s)),applyFilter:s.isFiltered&&s.reapplyFilterOnAdd});if(!o&&u.length)for(const e of u)s.modified.includes(e)||r[e.id]||(s.removed.includes(e)?s.removed.remove(e):e.isLinked||s.added.add(e));var h;if(o&&s.rootVisible&&(c.unshift(e),u.unshift(e)),c.length?(d=0!==n&&l?a.indexOf(l)+l.getDescendantCount(!0,s):a.indexOf(e),a.suspendEvents(),s.storage.splice(++d,0,c),a.resumeEvents(),s._idMap=null):s._allRecords=null,s.updateDependentStores("add",t),o&&c.length){if(s.sorters.length&&s.sort(null,null,!1,!0),null===(h=s.afterLoadData)||void 0===h||h.call(s),!i){const e={action:"dataset",data:s._data,records:c};s.trigger("refresh",e),s.trigger("change",e)}}else if(!i){const n={action:"add",parent:e,isChild:!0,isMove:r,records:t,allRecords:u,index:d};if(s.trigger("add",n),s.trigger("change",n),r&&Object.values(r).some((e=>e))){const n={newParent:e,records:t.filter((e=>r[e.id])),oldParents:t.map((e=>s.getById(e.meta.oldParentId)))};s.trigger("move",n)}}}onNodeRemoveChild(e,t,n,r={isMove:!1,silent:!1,unfiltered:!1}){const i=this,{storage:s}=i,o=[],a=[],{isMove:l,silent:d,unfiltered:c}=r,u=c&&i.isFiltered;if(i.collectDescendants(t,o,a,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i)),unfiltered:u}),!l){for(const e of t)e.unjoinStore(i);for(const e of a)e.stores.includes(i)&&e.unjoinStore(i),i.added.includes(e)?i.added.remove(e):e.isLinked||i.removed.add(e);i.modified.remove(a)}if(o.length?(n=s.indexOf(o[0]))>-1&&(s.suspendEvents(),s.splice(n,o.length),s.resumeEvents(),i._idMap=null):(n=-1,i._allRecords=null),!d&&(i.fireRemoveEventForMoveAction||!l)){const r={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:a,index:n};i.trigger("remove",r),i.trigger("change",r)}return a}collectDescendants(e,t=[],n=[],r={}){const i=this,{inCollapsedBranch:s=!1,unfiltered:o=!1,applyFilter:a=!1}=r,l=Array.isArray(e)?e:i.getChildren(e,o)??[];if(a)return{visible:!s&&l.flatMap((e=>i.collectVisibleNodeDescendantsFiltered(e))),all:l.concat(l.flatMap((e=>e.allChildren)))};for(let e,r=0,a=l.length;r<a;r++)e=l[r],s||t.push(e),n.push(e),i.collectDescendants(e,t,n,{inCollapsedBranch:s||!e.isExpanded(i),unfiltered:o});return{visible:t,all:n}}collectVisibleNodeDescendantsFiltered(e){const t=e.unfilteredChildren||e.children;if(!t||0===t.length||!e.isLeaf&&!e.isExpanded(this))return this.filtersFunction(e)?[e]:[];const n=t.flatMap((e=>this.collectVisibleNodeDescendantsFiltered(e)));return n.length||this.filtersFunction(e)?[e,...n]:[]}getChildren(e,t=!1){const n=this,r=n.isChained&&!n.isChainedTree,i=(t||r)&&e.unfilteredChildren||e.children;return null!=i&&i.length?r?i.filter(n.chainedFilterFn).sort(n.sorterFn):i:Ho}internalToggleTreeSubRecords(e,t){const n=this,{storage:r}=n,i=r.indexOf(e),s=n.doIncludeExclude(n.getChildren(e),t);if(n.isFiltered&&t&&e.unfilteredChildren&&n.updateChildrenHiddenState(e),s.length&&!1!==i){if(r.suspendEvents(),t){r.splice(i+1,0,...s);const t={action:"add",isExpand:!0,parent:e,records:s,index:i+1};n.trigger("add",t),n.trigger("change",t)}else{r.splice(i+1,s.length);const t={action:"remove",isCollapse:!0,parent:e,records:s,index:i+1};n.trigger("remove",t),n.trigger("change",t)}r.resumeEvents(),n._idMap=null}}updateChildrenHiddenState(e){var t;null===(t=e.unfilteredChildren)||void 0===t||t.forEach((e=>{e.instanceMeta(this.id).hidden=!1,e.isLeaf||this.updateChildrenHiddenState(e)}))}doIncludeExclude(e,t,n=[]){const r=this,i=(null==e?void 0:e.length)||0;for(let s=0;s<i;s++){const i=e[s];if(!r.isChained||r.chainedFilterFn(i)){const e=i.instanceMeta(r.id);!t&&e.hidden||n.push(i),e.hidden=!t,i.isExpanded(r)&&r.doIncludeExclude(r.getChildren(i),t,n)}}return n}async toggleCollapse(e,t){const n=this,r=n.getById(e),i=r.instanceMeta(n);if(void 0===t&&(t=!i.collapsed),!i.isLoadingChildren&&!r.isLeaf&&r.isExpanded(n)===t){if(n.trigger("beforeToggleNode",{record:r,collapse:t}),i.collapsed=t,i.collapsed)return n.onNodeCollapse(r),!0;{n.onNodeExpand(r);let e=!0;if(!r.isLoaded){i.isLoadingChildren=!0;try{await n.loadChildren(r)}catch(t){i.collapsed=!0,e=!1,n.trigger("loadChildrenException",{record:r,exception:t})}finally{i.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}transformToTree(e){var t;const{parentIdField:n,idField:r,childrenField:i}=this.modelClass,s=(null===(t=this.modelClass.fieldMap[n])||void 0===t?void 0:t.dataSource)||"parentId",o=new Map,a=new Set,l=[];for(const t of e){const e=null==t?void 0:t[r];null!=e&&o.set(e,t)}const d=e=>{const t=Object.assign({},e);return t[i]=[],o.set(t[r],t),a.add(e[r]),t};for(let t of e)if(t){const e=t[r];t=a.has(e)?o.get(e):d(t);const n=t[s];if(null!=n){let e=o.get(n);e&&(e[i]||(e=d(e)),e[i].push(t))}else t[i]?l.push(t):null!=t[r]?l.push(d(t)):l.push(t)}return o.forEach((e=>{var t,n;null===(t=(n=e[i]).sort)||void 0===t||t.call(n,((e,t)=>e.parentIndex-t.parentIndex))})),l}treeifyData(e,t,n,r=!1,i){const{length:s}=t,o=[],a=[],l={};let d,c;for(d=0;d<s;d++){let e=t[d];e=e.field||e,t[d].call||(t[d]=t=>t[e],t[d].fieldName=e),o[d]=new Map}Hs.preWalkWithParent({isRoot:!0,id:this.rootNode.id,children:e},(e=>e.children),((e,n)=>{if(c=[],n.isLeaf){for(d=0;d<s;d++){const e=t[d],r=i?i(e(n),e.fieldName):e(n),s=o[d],a=""===r?No:r,l=nt.asArray(a)||[No],u=[];if(l[0]===Vo)break;(c.length>0?c:[null]).forEach((t=>{for(let r=0,{length:i}=l;r<i;r++){const i=l[r],o=`${((null==t?void 0:t.path)??"")+(null!=i&&i.isModel?i.id:i)}/`,a=N.makeValidDomId(`generated_${o}`,"_"),d=s.get(a)||s.set(a,{id:a,key:l[r]===No?"":i,path:o,readOnly:!0,children:[],generatedParent:!0,field:e.fieldName,firstGroupChild:n}).get(a);u.push(d),t&&!t.children.includes(d)&&t.children.push(d)}})),c=u}c.length?c.forEach(((e,t)=>e.children.push(t?n.link():n))):a.push(n)}}),!0),(n||r)&&o.forEach((e=>e.forEach(((e,t,i)=>{null==n||n(e),r&&(e=this.createRecord(e),i.set(t,e))})))),l.children=[...o[0].values(),...a];const u=e=>{e.children&&(e.children.sort(((e,n)=>{if(e.isLeaf===n.isLeaf){if(e.isLeaf){let r;for(let i=0;!r&&i<s;i++){const s=t[i](e),o=t[i](n);if(s===Vo||o===Vo)return e.isLeaf<n.isLeaf?-1:e.isLeaf>n.isLeaf?1:0;r=s<o?-1:o<s?1:0}return r}return"string"==typeof e.key&&"string"==typeof n.key?e.key.localeCompare(n.key,void 0,{numeric:!0}):e.key<n.key?-1:e.key>n.key?1:0}return e.isLeaf<n.isLeaf?-1:e.isLeaf>n.isLeaf?1:0})),e.children.forEach(u))};return u(l),l}treeify(e,t,n=!1,r){return this.treeifyData(this.rootNode.children,e,t,!1,r)}treeifyFlatData(e){var t;const{childrenField:n,parentIdField:r}=this.modelClass,i=(null===(t=this.modelClass.fieldMap[r])||void 0===t?void 0:t.dataSource)||"parentId";let s=!1,o=!0;for(const t of e){if(null!=t&&t.isModel||Array.isArray(null==t?void 0:t[n])){o=!1;break}null!=(null==t?void 0:t[i])&&(s=!0)}return o&&s&&(e=this.transformToTree(e)),e}async indent(e){const t=this;if((e=(e=Array.isArray(e)?e:[e]).filter((t=>{let n=Boolean(t.previousSibling);for(;n&&!t.isRoot;)n=!e.includes(t.parent),t=t.parent;return n}))).length&&!1!==t.trigger("beforeIndent",{records:e})){e.sort(((e,t)=>_o.compare(e.wbsCode,t.wbsCode))),t.beginBatch();for(const n of e){const e=n.previousSibling;e.appendChild(n),t.toggleCollapse(e,!1)}t.endBatch(),t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e})}}async outdent(e){const t=this;if((e=(e=Array.isArray(e)?e:[e]).filter((t=>{const{parent:n}=t;let r=n&&!n.isRoot;for(;r&&!t.isRoot;)r=!e.includes(n),t=t.parent;return r}))).length&&!1!==t.trigger("beforeOutdent",{records:e})){e.sort(((e,t)=>_o.compare(e.wbsCode,t.wbsCode))),t.beginBatch();for(const n of e){const{parent:e}=n,r=e.children.slice(e.children.indexOf(n)+1);e.parent.insertChild(n,e.nextSibling),n.appendChild(r),t.toggleCollapse(n,!1)}t.endBatch(),t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e})}}},zo=e=>class extends(e||Qe){static $name="StoreSync";static get configurable(){return{syncDataOnLoad:null,shouldSyncDataset:null,shouldSyncRecord:null,reorderOnSync:!0}}syncDataset(e){var t,n,r,i;const s=this,{storage:o}=s,a=(null===(t=s.shouldSyncDataset)||void 0===t?void 0:t.call(s,{data:e,store:s,records:s.records}))??(null===(n=s.project)||void 0===n||null===(r=n.shouldSyncDataset)||void 0===r?void 0:r.call(n,{data:e,store:s,records:s.records}));if(!1===a)return;s.trigger("startApplyChangeset"),s.isSyncingDataOnLoad=!0;const{toAdd:l,toRemove:d,toMove:c,updated:u,ids:h}=s.tree?s.syncTreeDataset(e,a):s.syncFlatDataset(e,a);let g=null===(i=s.syncDataOnLoad)||void 0===i?void 0:i.threshold,m=!1;if(g&&("string"==typeof g&&(g=parseInt(g,10)/100*s.count),m=l.length+d.length+c.length+u.length>g),s.tree){if(l.length){s.add(l,m).forEach((e=>e.clearParentId()))}if(c.length)for(const{parent:e,node:t,index:n}of c){s.getById(e.id).insertChild(t,n)}s.remove(d,m)}else m&&s.suspendEvents(),s.remove(d),s.add(l),m&&s.resumeEvents();g&&!m&&u.forEach((({record:e,toSet:t,wasSet:n})=>s.onModelChange(e,t,n))),s.$isSettingStoreFieldData||s.acceptChanges();const p={added:l,removed:d,updated:u,thresholdSurpassed:m};if(s.isFiltered&&!s.remoteFilter&&s.filter({silent:s.isRemoteDataLoading}),s.isGrouped)s.group(null,null,!1,!0,s.isRemoteDataLoading);else if(s.isSorted)s.remoteSort?o.replaceValues({values:o.values.sort(s.createSorterFn(s.sorters)),silent:!0}):s.sort();else if(s.reorderOnSync)if(s.tree){let e=!1,t=0;Hs.preWalk(s.rootNode,(t=>Array.isArray(t.children)&&!e?t.children:null),(n=>{n.id!==h[t++]&&(e=!0)})),e&&(s.sort(((e,t)=>h[e.id]-h[t.id]),void 0,void 0,!0),s.clearSorters(!0),!m&&s.afterPerformSort())}else o.values.some(((e,t)=>h[e.id]!==t))&&(o.replaceValues({values:o.values.sort(((e,t)=>h[e.id]-h[t.id])),silent:!0}),!m&&s.afterPerformSort());m&&s.trigger("refresh",{action:"batch",data:e,records:o.values,syncInfo:p}),s.isSyncingDataOnLoad=!1,s.trigger("endApplyChangeset"),s.trigger("loadSync",p)}syncFlatDataset(e,t){if(!e)return{toRemove:this.records};const n=this,{idField:r,allFields:i}=n.modelClass,s=[],o=[],a=[],l={},d={},c=t instanceof Set,{threshold:u,keepMissingValues:h}=n.syncDataOnLoad;let g=0;if(e.forEach(((e,s)=>{const m=(e=e.isModel?e.data:e)[r],p=n.getById(m);if(!c||t.has(m))if(p){if(n.shouldSyncRecord?!1!==n.shouldSyncRecord({record:p,data:e,store:n}):e!==p.data){var f,v;if(null===(f=n.beforeSyncRecord)||void 0===f||f.call(n,{record:p,data:e}),!1===h)for(const t of i)!(t.dataSource in e)&&t.dataSource in p.data&&(e[t.dataSource]=t.defaultValue);const t=p.set(e,null,Boolean(u));t&&a.push({record:p,wasSet:t,toSet:e}),null===(v=n.afterSyncRecord)||void 0===v||v.call(n,{record:p,data:e})}}else o.push(n.processRecord(n.createRecord(e)));p&&g++,l[m]=1,d[m]=s})),g<n.allRecords.filter((e=>!e.isSpecialRow)).length)if(t)for(const e of t)l[e]||s.push(n.getById(e));else n.forEach((e=>{l[e.id]||s.push(e)}),n,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0});return{toAdd:o,toRemove:s,toMove:[],updated:a,ids:d}}syncTreeDataset(e){if(!e)return{toRemove:this.records};const t=this,{idField:n,parentIdField:r,childrenField:i,allFields:s}=t.modelClass,{keepMissingValues:o,threshold:a}=t.syncDataOnLoad??{},l=[],d=[],c=[],u=[],h=new Set,g={};let m=0;return t.transformFlatData&&(e=t.treeifyFlatData(e)),Hs.preWalkWithParent({isRoot:!0,id:t.rootNode.id,children:e},(e=>e.children),((e,l)=>{if(e){const{id:p,node:f}=t.resolveSyncNode(l);if(f){if(t.shouldSyncRecord?!1!==t.shouldSyncRecord({record:f,data:l,store:t}):l!==f.data){let r;const d=f.children;let h;if(f.parent.id!==e[n]&&c.push({node:f,parent:e,index:e[i].indexOf(l)}),f!==l){if(!0!==d&&!0===l[i]&&(f.clearChildren(),f.data[i]=f.children=!0,delete l[i],t.toggleCollapse(f,!0),r=!0),!1===o)for(const e of s)"parentId"!==e.name&&!(e.dataSource in l)&&e.dataSource in f.data&&(l[e.dataSource]=e.defaultValue);"boolean"==typeof l.expanded&&this.toggleCollapse(f,!l.expanded),h=f.set(l,null,Boolean(a))}h?u.push({record:f,wasSet:h,toSet:l}):r&&f.signalNodeChanged({[i]:{value:!0,oldValue:d}})}h.add(f)}else l[r]=e[n],l.isModel?d.push(l):d.push({...l,...Array.isArray(l[i])?{children:[]}:void 0});g[p]=m++}})),t.totalCount!==h.size&&t.traverse((e=>{h.has(e)||l.push(e)})),{toAdd:d,toRemove:l,toMove:c,updated:u,ids:g}}resolveSyncNode(e){const t=e[this.modelClass.idField];return{id:t,node:this.getById(t)}}};class jo extends Error{constructor(...e){super(...e),this.name="RevisionException"}}jo._$name="RevisionException";const Wo=()=>{throw new Error("Abstract method call!")},Uo=()=>{throw new Error("Method cannot be called at this state!")};class Go extends Qe{canUndo(e){Wo()}canRedo(e){Wo()}canCheckoutTo(e){Wo()}onUndo(e){Wo()}onRedo(e){Wo()}onCheckoutTo(e){Wo()}onCheckoutToHead(e){Wo()}onStartRevision(e,t){Wo()}onStartTemporaryRevision(e,t,n){Wo()}onStopRevision(e){Wo()}onStartTransaction(e){Wo()}onStopTransaction(e){Wo()}onStopTransactionDelayed(e){Wo()}onRejectTransaction(e){Wo()}onEnable(e){Wo()}onDisable(e){Wo()}onAutoRecordOn(e){Wo()}onAutoRecordOff(e){Wo()}onResetQueue(e){Wo()}onModelUpdate(e){Wo()}onStoreModelAdd(e){Wo()}onStoreModelInsert(e){Wo()}onStoreModelRemove(e){Wo()}onStoreModelRemoveAll(e){Wo()}onModelInsertChild(e){Wo()}onModelRemoveChild(e){Wo()}}Go._$name="StateBase";const Yo=Symbol("STATE_PROP"),qo=Symbol("STORES_PROP"),Ko=Symbol("QUEUE_PROP"),Xo=Symbol("POS_PROP"),Zo=Symbol("ACTION_QUEUE_PROP"),Jo=Symbol("REVISION_NAMES_PROP"),Qo=Symbol("REVISION_QUEUE_PROP"),ea=Symbol("REVISION_INDEX_PROP"),ta=Symbol("CURRENT_REV_ID_PROP"),na=Symbol("TRANSACTION_PROP"),ra=Symbol("TRANSACTION_TIMER_PROP"),ia=Symbol("AUTO_RECORD_PROP"),sa=Symbol("IS_APPLYING_STASH");Object.freeze([Yo,qo,Ko,Xo,Zo,Jo,Qo,ea,ta,na,ra,ia,sa]);const oa=new Map;var aa=(e,t)=>{oa.set(e,t)},la=e=>("string"==typeof e&&(e=oa.get(e)),e);const da=(e,t)=>{const{undo:n,redo:r,revision:i}=t;let s;return s=n&&!r?{[Ko]:e[Ko].slice(e.position),[Xo]:0}:r&&!n?{[Ko]:e[Ko].slice(0,e.position)}:{[Ko]:[],[Xo]:0},i&&(s=Object.assign(s??{},{[Jo]:["base"],[ea]:0,[Qo]:[]})),[s,()=>{e.notifyStoresAboutQueueReset(t)}]};const ca=new class extends Go{canUndo(){return!1}canRedo(){return!1}canCheckoutTo(){return!1}onUndo(){Uo()}onRedo(){Uo()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){Uo()}onAutoRecordOn(){return{[ia]:!0}}onAutoRecordOff(){return{[ia]:!1}}onStartTransaction(){Uo()}onStopTransaction(){Uo()}onStopTransactionDelayed(){Uo()}onRejectTransaction(){Uo()}onResetQueue(e,t){return da(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};aa("disabledstate",ca);class ua extends Qe{static get defaultConfig(){return{inversed:!1}}get type(){return this.constructor.name}undo(){Wo()}redo(){Wo()}invert(){const e=new this.constructor({...this.initialConfig,isUserInput:this.isUserInput,inversed:!0}),{undo:t,redo:n}=e;return e.undo=n,e.redo=t,e}}const ha="AddAction",ga="InsertAction",ma="InsertChildAction",pa="RemoveAction",fa="RemoveAllAction",va="RemoveChildAction",ya="UpdateAction",ba="EventUpdateAction";ua._$name="ActionBase";const Ca=Symbol("MODEL_PROP"),wa=Symbol("NEW_DATA_PROP"),Sa=Symbol("OLD_DATA_PROP");class Da extends ua{static $name="UpdateAction";static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return ya}get model(){return this[Ca]}set model(e){this[Ca]=e}get newData(){return this[wa]}set newData(e){this[wa]={...e}}get oldData(){return this[Sa]}set oldData(e){this[Sa]={...e}}undo(){const{model:e,oldData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,Boolean(e.$))}redo(){const{model:e,newData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,Boolean(e.$))}}Da._$name="UpdateAction";const Ea=Symbol("PARENT_MODEL_PROP"),xa=Symbol("CHILD_MODELS_PROP"),Ra=Symbol("INSERT_INDEX_PROP"),Ta=Symbol("ORDERED_PROP"),Ma=Symbol("CONTEXT_PROP");class ka extends ua{static $name="InsertChildAction";static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,orderedBeforeNode:void 0,context:void 0,stores:void 0}}get type(){return ma}get parentModel(){return this[Ea]}set parentModel(e){this[Ea]=e}get childModels(){return this[xa]}set childModels(e){this[xa]=e.slice(0)}get insertIndex(){return this[Ra]}set insertIndex(e){this[Ra]=e}get orderedBeforeNode(){return this[Ta]}set orderedBeforeNode(e){this[Ta]=e}get context(){return this[Ma]}set context(e){this[Ma]=e}get stores(){return this[qo]}set stores(e){this[qo]=e}undo(){const{parentModel:e,context:t,childModels:n}=this,r=new Map,i=new Set;for(const s of n){const n=t.get(s);if(n){let t=r.get(n.parent);t||(t={moveRight:[],moveLeft:[],moveFromAnotherParent:[]},r.set(n.parent,t)),n.parent===e?n.index>s.parentIndex?t.moveRight.push({parent:n.parent,model:s,index:n.index+1}):t.moveLeft.push({parent:n.parent,model:s,index:n.index}):t.moveFromAnotherParent.push({parent:n.parent,model:s,index:n.index})}else i.add(s)}i.forEach((e=>e.parent.removeChild(e)));for(const e of r.values()){const{moveRight:t,moveLeft:n,moveFromAnotherParent:r}=e;r.forEach((e=>{e.parent.insertChild(e.model,e.index)})),n.sort(((e,t)=>e.index-t.index)),t.sort(((e,t)=>t.index-e.index))}for(const e of r.values()){const{moveRight:t,moveLeft:n}=e;n.forEach((e=>{e.parent.insertChild(e.model,e.index)})),t.forEach((e=>{e.parent.insertChild(e.model,e.index)}))}}redo(){var e,t;const{parentModel:n,insertIndex:r,childModels:i,orderedBeforeNode:s}=this,o=null===(e=n.children)||void 0===e?void 0:e[r];n.insertChild(i,o,!1,{orderedBeforeNode:s??(null==o||null===(t=o.previousSibling)||void 0===t?void 0:t.nextOrderedSibling)})}}ka._$name="InsertChildAction";const Fa=Symbol("PARENT_MODEL_PROP"),Ia=Symbol("CHILD_MODELS_PROP"),Aa=Symbol("CONTEXT_PROP");class La extends ua{static $name="RemoveChildAction";static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0,stores:void 0}}get type(){return va}get parentModel(){return this[Fa]}set parentModel(e){this[Fa]=e}get childModels(){return this[Ia]}set childModels(e){this[Ia]=e.slice(0)}get context(){return this[Aa]}set context(e){this[Aa]=e}get stores(){return this[qo]}set stores(e){this[qo]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort(((e,n)=>t.get(e).parentIndex-t.get(n).parentIndex)),n.forEach((n=>{const r=t.get(n);e.insertChild(n,r.parentIndex,void 0,{orderedParentIndex:r.orderedParentIndex})}))}redo(){this.parentModel.removeChild(this.childModels)}}La._$name="RemoveChildAction";const Pa=Symbol("STORE_PROP"),Oa=Symbol("MODEL_LIST_PROP");class $a extends ua{static $name="AddAction";static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return ha}get store(){return this[Pa]}set store(e){this[Pa]=e}get modelList(){return this[Oa]}set modelList(e){this[Oa]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}$a._$name="AddAction";const _a=Symbol("STORE_PROP"),Ha=Symbol("MODEL_LIST_PROP"),Va=Symbol("INSERT_INDEX_PROP"),Na=Symbol("CONTEXT_PROP");class Ba extends ua{static $name="InsertAction";static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1,reportUndoneRemoval:!0}}get type(){return ga}get store(){return this[_a]}set store(e){this[_a]=e}get modelList(){return this[Ha]}set modelList(e){this[Ha]=e.slice(0)}get insertIndex(){return this[Va]}set insertIndex(e){this[Va]=e}get context(){return this[Na]}set context(e){this[Na]=e}undo(){const{store:e,modelList:t,context:n,silent:r,reportUndoneRemoval:i}=this;t.sort(((e,t)=>{const r=n.get(e),i=n.get(t);return void 0!==r&&void 0!==i?r-i:0})),t.forEach((t=>{const s=n.get(t);t._undoingInsertion=i,void 0!==s?e.insert(s,t,r):e.remove(t,r),t._undoingInsertion=!1}))}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}Ba._$name="InsertAction";const za=Symbol("STORE_PROP"),ja=Symbol("MODEL_LIST_PROP"),Wa=Symbol("CONTEXT_PROP");class Ua extends ua{static $name="RemoveAction";static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return pa}get store(){return this[za]}set store(e){this[za]=e}get modelList(){return this[ja]}set modelList(e){this[ja]=e.slice(0)}get context(){return this[Wa]}set context(e){this[Wa]=e}undo(){const{store:e,context:t,modelList:n,silent:r}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{const i=t.get(n);e.insert(i,n,r)}))}redo(){this.store.remove(this.modelList,this.silent)}}Ua._$name="RemoveAction";const Ga=Symbol("STORE_PROP"),Ya=Symbol("ALL_RECORDS_PROP");class qa extends ua{static $name="RemoveAllAction";static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return fa}get store(){return this[Ga]}set store(e){this[Ga]=e}get allRecords(){return this[Ya]}set allRecords(e){this[Ya]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:n}=this;e.add(t,n)}redo(){this.store.removeAll(this.silent)}}qa._$name="RemoveAllAction";const Ka=(e,t,n,r)=>new Da({model:e,newData:t,oldData:n,isInitialUserAction:r}),Xa=(e,t,n,r,i,s)=>new ka({parentModel:e,childModels:n,insertIndex:t,orderedBeforeNode:i,context:r,stores:s}),Za=(e,t,n,r)=>new La({parentModel:e,childModels:t,context:n,stores:r}),Ja=(e,t,n)=>new $a({store:e,modelList:t,silent:n}),Qa=(e,t,n,r,i)=>new Ba({store:e,insertIndex:t,modelList:n,context:r,silent:i}),el=(e,t,n,r)=>new Ua({store:e,modelList:t,context:n,silent:r}),tl=(e,t,n)=>new qa({store:e,allRecords:t,silent:n}),nl="DATA_CORRECTION",rl="TEMPORARY",il="CONFLICT_RESOLUTION";class sl extends Qe{static get configurable(){return{title:null,committed:!1,inputGeneration:0}}static from(e,t={}){const n=new this({...this.initialConfig,...t,inputGeneration:e.reduce(((e,t)=>Math.max(e,t.inputGeneration??0)),0),committed:!1});return n[Zo]=e.flatMap((e=>e[Zo].filter((n=>e.inputGeneration>0?t.conflictResolutionFor?n.isUserInput===e.inputGeneration:n.isUserInput:n)))),n}static createTransactionWithOriginalInput(e){const t=new this({...this.initialConfig,title:e.title,committed:!1});return t[Zo]=e[Zo].filter((e=>e.isUserInput?1===e.isUserInput:!e.isUserInput)),t}construct(...e){this[Zo]=[],super.construct(...e)}get queue(){return this[Zo].slice(0)}get length(){return this[Zo].length}get filterUserInput(){return this.inputGeneration>0}addAction(e){this[Zo].push(e)}undo(){const e=this[Zo];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[Zo];for(let t=0,n=e.length;t<n;++t)e[t].redo()}mergeUpdateModelActions(){const e=this[Zo],t=new Map,n=[];for(const s of e){var r;if(s.isUpdateAction&&null!==(r=s.model)&&void 0!==r&&r.isModel){const e=s.isUserInput??0;let r=t.get(s.model);r||(r=[],t.set(s.model,r));const i=r[e];if(i)for(const e in s.oldData)s.newData.hasOwnProperty(e)&&(i.oldData.hasOwnProperty(e)||(i.oldData[e]=s.oldData[e]),i.newData[e]=s.newData[e]);else r[e]=s,n.push(s)}else{var i;if(n.push(s),s.isRemoveAction&&null!==(i=s.modelList)&&void 0!==i&&i.length)for(const e of s.modelList)t.delete(e)}}this[Zo]=n,this.inputGeneration=Math.max(...n.map((e=>e.isUserInput??0)),0)}mergeAddUpdateModelActions(){const e=this[Zo],t=new Set,n=[];for(const r of e)r.isAddAction||r.isInsertAction?r.modelList.forEach((e=>t.add(e))):r.isInsertChildAction&&r.childModels.forEach((e=>t.add(e))),(r.isUpdateAction||r.isEventUpdateAction)&&t.has(r.model)||n.push(r);this[Zo]=n,this.inputGeneration=Math.max(...n.map((e=>e.isUserInput??0)),0)}invert(){const e=new this.constructor({...this.initialConfig,title:this.title});return e[Zo]=this[Zo].map((e=>(e=>e.invert())(e))),e}groupUserInput(){return this[Zo].reduce(((e,t)=>{const n=t.isUserInput??"default";return e.has(n)||e.set(n,[]),e.get(n).push(t),e}),new Map)}getUserInput(e){const t=new Map,n={},r=this.groupUserInput().get(e??(this.inputGeneration||"default")),i=(e,t)=>(t in n?e in n[t]||(n[t][e]=[]):n[t]={[e]:[]},n[t][e]);for(const s of r)switch(s.type){case ha:case ga:if(s.inversed){i("removed",s.store.id).push(...s.modelList)}else{i("added",s.store.id).push(...s.modelList)}break;case pa:case fa:if(s.inversed){i("added",s.store.id).push(...s.modelList||s.allRecords)}else{i("removed",s.store.id).push(...s.modelList||s.allRecords)}break;case ma:{const o=(e,t)=>{var n;t.added.includes(e)?i("added",t.id).push(e):t.removed.includes(e)&&i("removed",t.id).push(e),null===(n=e.children)||void 0===n||n.forEach((e=>o(e,t)))};for(const a of s.stores)s.childModels.forEach((e=>o(e,a))),a.modified.forEach((e=>{const n=e.hierarchyModificationDataToWrite;n&&(t.has(e)?t.set(e,{...t.get(e),...n}):t.set(e,n))}));break}case va:{function l(e,t){e.forEach((e=>{t.push(e),e.children&&l(e.children,t)}))}for(const d of s.stores)if(s.inversed){const c=i("added",d.id);l(s.childModels,c)}else{const u=i("removed",d.id);l(s.childModels,u)}break}case ya:case ba:t.has(s.model)?t.set(s.model,{...t.get(s.model),...s.newData}):t.set(s.model,{...s.newData})}if(t.size>0&&(n.updated=t),Object.keys(n).length>0)return n}markCurrentTransactionContentUserInput(){const e=this.inputGeneration+1,t=this[Zo];let n=!1;t.forEach((t=>{void 0!==t.isUserInput||t.isCalculated||(t.isUserInput=e,n=!0)})),n&&(this.inputGeneration=e)}markCurrentTransactionContentCalculated(){const e=this.inputGeneration;this[Zo].forEach((t=>{void 0!==t.isCalculated||t.isUserInput||(t.isCalculated=e)}))}normalizeUserInputGeneration(){this[Zo].forEach((e=>e.isUserInput=this.inputGeneration))}}sl._$name="Transaction";class ol extends Go{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}canCheckoutTo(e,t){return e.revisionsEnabled?!!e[Jo].includes(t)||(console.warn("Revision is not found"),!1):(console.warn("Revisions are disabled"),!1)}onUndo(e,t){let n=e.position;const r=e[Ko],i=Math.max(0,n-t);return[{[Yo]:"restoringstate",[Xo]:i},()=>{e.notifyStoresAboutStateRestoringStart();const t=[];for(;n!==i;){const e=r[--n];e.undo(),t.push(e)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:t})}]}]}onRedo(e,t){let n=e.position;const r=e[Ko],i=Math.min(r.length,n+t);return[{[Yo]:"restoringstate",[Xo]:i},()=>{e.notifyStoresAboutStateRestoringStart();const t=[];do{const e=r[n++];e.redo(),t.push(e)}while(n!==i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:t})}]}]}onCheckoutTo(e,t){const n=e[Jo].indexOf(t),r=Math.min(n,e[ea]),i=Math.max(n,e[ea]),s=n<e[ea];let o=e[Qo].slice(r,i);if(s){o=o.filter((e=>!e.conflictResolutionFor||e.type===rl)).reverse();e[Qo].filter(((e,t)=>t>=r&&e.dummy)).forEach((t=>{e[Qo].splice(e[Qo].indexOf(t),1),e[Jo].splice(e[Jo].indexOf(t.title),1)}))}return[{[Yo]:"checkoutstate",[ea]:n},()=>{e.notifyStoresAboutCheckoutStart();for(const e of o)e[s?"undo":"redo"]()}]}onCheckoutToHead(e){Uo()}onEnable(){Uo()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[Yo]:"autoreadystate",[ia]:!0}}onAutoRecordOff(){Uo()}onStartTransaction(e,t){const n=new sl({title:t});return[{[Yo]:"recordingstate",[na]:n},()=>{e.notifyStoresAboutStateRecordingStart(n)}]}onStopTransaction(){Uo()}onStopTransactionDelayed(){Uo()}onRejectTransaction(){Uo()}onResetQueue(e,t){return da(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}const al=new ol;aa("readystate",al);class ll extends Go{canUndo(){return!1}canRedo(){return!1}canCheckoutTo(){return!1}onEnable(){}onDisable(e){const t=e[na];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[Yo]:"disabledstate",[na]:null}}onAutoRecordOn(e){return[{[Yo]:"autorecordingstate",[ia]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){Uo()}onStartTransaction(){Uo()}onStopTransaction(e,t){const n=e[na],r=e[Ko];let i=e[Xo];return n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),r[i]=n,r.length=++i),[{[Yo]:"readystate",[Xo]:i,[na]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onRejectTransaction(e){const t=e[na];return[{[Yo]:"restoringstate",[na]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){Uo()}onResetQueue(e,t){return da(e,t)}onModelUpdate(e,t,n,r,i){e[na].addAction(e.makeModelUpdateAction(t,n,r,i))}onModelInsertChild(e,t,n,r,i,s){const o=e[na],a=t.stores.filter((t=>e.stores.includes(t)));o.addAction(e.makeModelInsertChildAction(t,n,r,i,s,a))}onModelRemoveChild(e,t,n,r){const i=e[na],s=t.stores.filter((t=>e.stores.includes(t)));i.addAction(e.makeModelRemoveChildAction(t,n,r,s))}onStoreModelAdd(e,t,n,r){e[na].addAction(e.makeStoreModelAddAction(t,n,r))}onStoreModelInsert(e,t,n,r,i,s){const o=e[na],a=e.makeStoreModelInsertAction(t,n,r,i,s);a.reportUndoneRemoval=!e.revisionsEnabled,o.addAction(a)}onStoreModelRemove(e,t,n,r,i){e[na].addAction(e.makeStoreModelRemoveAction(t,n,r,i))}onStoreRemoveAll(e,t,n,r){e[na].addAction(e.makeStoreRemoveAllAction(t,n,r))}}const dl=new ll;aa("recordingstate",dl);const cl=new class extends Go{static $name="RestoringStateClass";canUndo(){return!1}canRedo(){return!1}canCheckoutTo(){return!1}onUndo(){Uo()}onRedo(){Uo()}onEnable(){Uo()}onDisable(){Uo()}onAutoRecordOn(){return{[ia]:!0}}onAutoRecordOff(){return{[ia]:!1}}onStartTransaction(){Uo()}onStopTransaction(){Uo()}onStopTransactionDelayed(){Uo()}onRejectTransaction(){Uo()}onQueueReset(){Uo()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};aa("restoringstate",cl);const ul=new class extends ol{onAutoRecordOn(){Uo()}onAutoRecordOff(){return{[Yo]:"readystate",[ia]:!1}}onStartTransaction(e,t){const n=new sl({title:t});return[{[Yo]:"autorecordingstate",[na]:n},()=>{e.notifyStoresAboutStateRecordingStart(n),e.stopTransactionDelayed()}]}onModelUpdate(e,t,n,r){e.startTransaction(),e.onModelUpdate(t,n,r)}onModelInsertChild(e,t,n,r,i){e.startTransaction(),e.onModelInsertChild(t,n,r,i)}onModelRemoveChild(e,t,n,r){e.startTransaction(),e.onModelRemoveChild(t,n,r)}onStoreModelAdd(e,t,n,r){e.startTransaction(),e.onStoreModelAdd(t,n,r)}onStoreModelInsert(e,t,n,r,i,s){e.startTransaction(),e.onStoreModelInsert(t,n,r,i,s)}onStoreModelRemove(e,t,n,r,i){e.startTransaction(),e.onStoreModelRemove(t,n,r,i)}onStoreRemoveAll(e,t,n,r){e.startTransaction(),e.onStoreRemoveAll(t,n,r)}};aa("autoreadystate",ul);class hl extends(ll.mixin(Hi)){onDisable(e){const t=e[na],n=e[ra];return n&&this.clearTimeout(n),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[Yo]:"disabledstate",[na]:null,[ra]:null}}onAutoRecordOn(e){Uo()}onAutoRecordOff(e){const t=e[ra];return t&&this.clearTimeout(t),{[Yo]:"recordingstate",[ia]:!1,[ra]:null}}onStopTransaction(e,t){const n=e[na],r=e[ra],i=e[Ko];let s=e[Xo];return r&&this.clearTimeout(r),n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),i[s]=n,i.length=++s),[{[Yo]:"autoreadystate",[Xo]:s,[na]:null,[ra]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[ra];return t&&this.clearTimeout(t),t=this.setTimeout((()=>{e.stopTransaction()}),e.autoRecordTransactionStopTimeout),{[Yo]:gl,[ra]:t}}onResetQueue(e,t){return da(e,t)}onRejectTransaction(e){const t=e[na],n=e[ra];return n&&this.clearTimeout(n),[{[Yo]:"restoringstate",[na]:null,[ra]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const gl=new hl;aa("autorecordingstate",gl);const ml=new class extends ol{canUndo(e){return!1}canRedo(e){return!1}onUndo(e){Uo()}onRedo(e){Uo()}onStartRevision(e,t){const n=new sl({title:t});return[{[Yo]:"revisionrecordingstate",[na]:n},()=>{e.notifyStoresAboutRevRecordingStart()}]}onStartTemporaryRevision(e,t,n){const r=new sl({title:t});return n&&(r[Zo]=n[Zo].slice()),[{[Yo]:"temporaryrevisionrecordingstate",[na]:r},()=>{e.notifyStoresAboutTempRevRecordingStart()}]}onCheckoutToHead(e){return e.notifyStoresAboutCheckoutToHead({revision:e[Jo][e[Jo].length-1]}),e.autoRecord?"autoreadystate":"readystate"}onStartTransaction(e){Uo()}onStopTransaction(e){Uo()}onStopTransactionDelayed(e){Uo()}onRejectTransaction(e){Uo()}onEnable(e){Uo()}onDisable(e){Uo()}onAutoRecordOn(e){Uo()}onAutoRecordOff(e){Uo()}onResetQueue(e){Uo()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};aa("checkoutstate",ml);const pl=new class extends ll{canUndo(e){return!1}canRedo(e){return!1}canCheckoutTo(){return!1}onUndo(e){Uo()}onRedo(e){Uo()}onCheckoutToHead(e){Uo()}onStopRevision(e,t){const n=e[na],r=e[Qo],i=e[Jo],s=e[ea]+1,o=sl.createTransactionWithOriginalInput(n);return i.splice(s,0,o.title),r.splice(s-1,0,o),e.commitRevision(o.title),[{[Yo]:"checkoutstate",[ea]:s,[na]:null},()=>{e.notifyStoresAboutRevRecordingStop(o)}]}onStartTransaction(e){Uo()}onStopTransaction(e){Uo()}onStopTransactionDelayed(e){Uo()}onRejectTransaction(e){Uo()}onEnable(e){Uo()}onDisable(e){Uo()}onAutoRecordOn(e){Uo()}onAutoRecordOff(e){Uo()}onResetQueue(e){Uo()}};aa("revisionrecordingstate",pl);const fl=new class extends ll{canUndo(e){return!1}canRedo(e){return!1}canCheckoutTo(){return!1}onUndo(e){Uo()}onRedo(e){Uo()}onCheckoutToHead(e){Uo()}onStopRevision(e,t){const n=e[na];return[{[Yo]:"checkoutstate",[na]:null},()=>{e.notifyStoresAboutTempRevRecordingStop(n)}]}onStartTransaction(e){Uo()}onStopTransaction(e){Uo()}onStopTransactionDelayed(e){Uo()}onRejectTransaction(e){Uo()}onEnable(e){Uo()}onDisable(e){Uo()}onAutoRecordOn(e){Uo()}onAutoRecordOff(e){Uo()}onResetQueue(e){Uo()}};aa("temporaryrevisionrecordingstate",fl);const vl=(e,t,...n)=>{const r=e.state,i=t.call(e[Yo],e,...n);if("string"==typeof i)e[Yo]=la(i);else if(i instanceof Go)e[Yo]=i;else if(Array.isArray(i)){const[t,r]=i;"string"==typeof t?e[Yo]=la(t):t instanceof Go?e[Yo]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[Yo]=la(e[Yo])),"function"==typeof r&&vl(e,r,...n)}else i&&"object"==typeof i&&((e=Object.assign(e,i))[Yo]=la(e[Yo]));r!==al&&r!==ul&&i!==al&&i!==ul&&e.trigger("ready")};class yl extends(lt(Qe)){static $name="StateTrackingManager";static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,autoRecordMergeUpdateActions:!0,mergeAddUpdateActions:!1,makeModelUpdateAction:Ka,makeModelInsertChildAction:Xa,makeModelRemoveChildAction:Za,makeStoreModelAddAction:Ja,makeStoreModelInsertAction:Qa,makeStoreModelRemoveAction:el,makeStoreRemoveAllAction:tl,getTransactionTitle:null,revisionsEnabled:!1,asyncUndoRedo:!1,revisionLocalPrefix:"local-",revisionQueueMaxLength:20,revisionQueueCommittedMinLength:1}}construct(...e){Object.assign(this,{[Yo]:al,[qo]:[],[Ko]:[],[Xo]:0,[na]:null,[ra]:null,[ia]:!1,[sa]:!1,stashedTransactions:{}}),super.construct(...e)}get state(){return this[Yo]}get position(){return this[Xo]}get length(){return this[Ko].length}get stores(){return Array.from(this[qo])}hasStore(e){return this[qo].includes(e)}addStore(e){this.hasStore(e)||(this[qo].push(e),e.stm=this,e.forEach((e=>e.stm=this)),e.isTree&&(e.rootNode.stm=this))}removeStore(e){this.hasStore(e)&&(this[qo]=this[qo].filter((t=>t!==e)),e.stm=null,e.forEach((e=>e.stm=null)))}forEachStore(e){this[qo].forEach((t=>e(t,t.id)))}get disabled(){return this.state===ca}set disabled(e){const t=this;t.disabled!==e&&(vl(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===al||this.state===ul}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===dl||this.state===gl}get isApplyingStash(){return this[sa]}get shouldRecordAction(){return this.enabled&&(!this.isRestoringState||this.isApplyingStash)&&!this.isCheckingOut}get autoRecord(){return this[ia]}set autoRecord(e){const t=this;t.autoRecord!=e&&vl(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){vl(this,this.state.onStartTransaction,e)}stopTransaction(e=null){const t=this;t.autoRecord&&t.autoRecordMergeUpdateActions&&t.mergeTransactionUpdateActions(),t.mergeAddUpdateActions&&t.mergeTransactionAddUpdateActions(),vl(t,t.state.onStopTransaction,e)}stopTransactionDelayed(){vl(this,this.state.onStopTransactionDelayed)}rejectTransaction(){vl(this,this.state.onRejectTransaction)}get transaction(){return this[na]}get queue(){return this[Ko].map((e=>e.title))}get rawQueue(){return this[Ko]}get isRestoringState(){return this.state===cl}get isRestoring(){return this.state===cl||this.isApplyingStash||this.isNavigatingRevisions}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),vl(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),vl(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0,revision:!0}){vl(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}resetRevisionQueue(){this.resetQueue({revision:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore((t=>{var n;return null===(n=t.onStmRecordingStart)||void 0===n?void 0:n.call(t,this,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){const n=this;n.forEachStore((r=>{var i;return null===(i=r.onStmRecordingStop)||void 0===i?void 0:i.call(r,n,e,t)})),n.trigger("recordingStop",{stm:n,transaction:e,reason:t}),n.revisionsEnabled&&t.stop&&n.increaseRevision(sl.from([e]))}notifyStoresAboutStateRestoringStart(){this.forEachStore((e=>{var t;return null===(t=e.onStmRestoringStart)||void 0===t?void 0:t.call(e,this)})),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:t}){const n=this;if(n.forEachStore((e=>{var t;return null===(t=e.onStmRestoringStop)||void 0===t?void 0:t.call(e,n)})),n.trigger("restoringStop",{stm:n,cause:e,transactions:t}),n.revisionsEnabled)if(n.asyncUndoRedo){const r=()=>{const r=sl.from(t);n.increaseRevision("undo"===e?r.invert():r)};n.trigger("increaseRevisionAsync",{callback:r})}else{const r=sl.from(t);n.increaseRevision("undo"===e?r.invert():r)}}notifyStoresAboutQueueReset(e){this.forEachStore((t=>{var n;return null===(n=t.onStmQueueReset)||void 0===n?void 0:n.call(t,this,e)})),this.trigger("queueReset",{stm:this,options:e})}notifyStoresAboutCheckoutStart(){this.trigger("checkoutStart",{stm:this})}notifyStoresAboutRevRecordingStart(){this.trigger("revisionRecordingStart",{stm:this})}notifyStoresAboutTempRevRecordingStart(){this.trigger("temporaryRevisionRecordingStart",{stm:this})}notifyStoresAboutRevRecordingStop(e){this.trigger("revisionRecordingStop",{stm:this,revision:e.title})}notifyStoresAboutTempRevRecordingStop(e){this.trigger("temporaryRevisionRecordingStop",{stm:this,revision:e.title})}notifyStoresAboutCheckoutToHead({revision:e}){this.trigger("checkoutToHead",{stm:this,revision:e})}onModelUpdate(e,t,n,r){vl(this,this.state.onModelUpdate,e,t,n,r)}onModelInsertChild(e,t,n,r,i){vl(this,this.state.onModelInsertChild,e,t,n,r,i)}onModelRemoveChild(e,t,n){vl(this,this.state.onModelRemoveChild,e,t,n)}onStoreModelAdd(e,t,n){vl(this,this.state.onStoreModelAdd,e,t,n)}onStoreModelInsert(e,t,n,r,i){vl(this,this.state.onStoreModelInsert,e,t,n,r,i)}onStoreModelRemove(e,t,n,r){vl(this,this.state.onStoreModelRemove,e,t,n,r)}onStoreRemoveAll(e,t,n){vl(this,this.state.onStoreRemoveAll,e,t,n)}onUndoKeyPress(e){const t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}stash(){const e=this;if(e.transaction){const t=eo.generateId("_stashedTransactionGeneratedId_");return e.stashedTransactions[t]=e.transaction,e.rejectTransaction(),t}}applyStash(e){const t=this,n=t.stashedTransactions[e];t[sa]=!0,n&&(t.startTransaction(n.title),n.redo(),delete t.stashedTransactions[e]),t[sa]=!1}mergeTransactionUpdateActions(e=this.transaction){e.mergeUpdateModelActions()}mergeTransactionAddUpdateActions(e=this.transaction){e.mergeAddUpdateModelActions()}canCheckoutTo(e){return(this.isReady||this.state===ml)&&this.state.canCheckoutTo(this,e)}get currentRevision(){if(this.revisionsEnabled)return this[Jo][this[ea]]}get lastRevision(){if(this.revisionsEnabled)return this[Jo][this[Jo].length-1]}get currentRevisionTransaction(){if(this.revisionsEnabled)return this[Qo][this[ea]-1]}get lastCommittedRevision(){const e=this[Qo];let t;for(let n=e.length-1;n>=0;n--)if(e[n].committed){t=e[n];break}return t}get lastCommittedRevisionId(){var e;return(null===(e=this.lastCommittedRevision)||void 0===e?void 0:e.title)??this[Jo][0]}get localRevisions(){return this[Qo].slice(this[Qo].findIndex((e=>!e.committed)))}get isCheckingOut(){return this.state===ml}get isRecordingRevision(){return this.state===pl}get isRecordingTemporaryRevision(){return this.state===fl}get isNavigatingRevisions(){return this.state===ml||this.state===pl||this.state===fl}initRevision(e,t=!0){const n=this;n.revisionsEnabled&&(n.autoRecord=t,n[Jo]=[e],n[Qo]=[],n[ea]=0)}increaseRevision(e,t){const n=this;let r;if(!(Jo in n))throw new Error("Revisions should be initialized first with `project.initRevisions(<client id>)` call");if(!n.revisionsEnabled)return;if(n.isNavigatingRevisions&&!e.type)throw new jo("Cannot add new revision when in the checkout state");if(!e[Zo].length&&!e.type)return;const i=eo.generateId(n.revisionLocalPrefix);if(e.title=i,!1===n.trigger("beforeRevisionAdd",{localRevisionId:i}))return;const s=e.conflictResolutionFor&&n[Qo].find((t=>t.type===rl&&t.conflictResolutionFor===e.conflictResolutionFor));if(s?(n[Jo].splice(n[Jo].indexOf(s.title),1,i),n[Qo].splice(n[Qo].indexOf(s),1,e)):(n[Jo].push(i),n[Qo].push(e)),e.conflictResolutionFor||(n[ea]=n[Jo].length-1),e.type===rl)return;e.filterUserInput&&(e.conflictResolutionFor||e.normalizeUserInputGeneration(),r=e.getUserInput()),!t&&n[Qo].length>n.revisionQueueMaxLength&&!e.type&&n.cleanUpRevisions();const o={localRevisionId:i,userInput:r};e.conflictResolutionFor&&(o.conflictResolutionFor=e.conflictResolutionFor,o.revisionChanges=t),n.trigger("revisionAdd",o)}createDataCorrectionTransaction(){const e=new sl({type:nl});this.increaseRevision(e)}createConflictResolutionRevision(e,t,n){const{transaction:r}=this;if(n=W.clone(n),t){const n=this[Qo].find((e=>e.conflictResolutionFor===t));n&&(n.conflictResolutionFor=e)}this.increaseRevision(sl.from([r],{conflictResolutionFor:e??r.title,type:il}),n)}createTemporaryConflictResolutionRevision(e,t){const{transaction:n}=this;this.increaseRevision(sl.from([n],{conflictResolutionFor:e??n.title,type:rl}),t)}checkoutTo(e){if(!this.canCheckoutTo(e))return!1;vl(this,this.state.onCheckoutTo,e)}checkoutToLastCommittedRevision(){this.checkoutTo(this.lastCommittedRevisionId)}checkoutToHead(){this.checkoutTo(this[Jo][this[Jo].length-1]),vl(this,this.state.onCheckoutToHead)}checkoutToNext(){return this[ea]+1<this[Jo].length&&this.checkoutTo(this[Jo][this[ea]+1])}startRevision(e){vl(this,this.state.onStartRevision,e)}stopRevision(){vl(this,this.state.onStopRevision)}startTemporaryRevision(e,t){vl(this,this.state.onStartTemporaryRevision,e,t)}stopTemporaryRevision(){vl(this,this.state.onStopRevision)}commitRevision(e,t){const n=this[Jo],r=this[Qo],i=r.find((t=>t.title===e));for(let e=r.indexOf(i)-1;e>=0;e--)if(!1===r[e].committed&&r[e].type!==rl&&!r[e].conflictResolutionFor)throw new jo(`Cannot commit revision because it is preceded by an uncommitted rev id ${r[e].title}`,r);if(t){if(n.includes(t))throw new jo(`Proposed revision id (${t}) already exists`);i.title=n[n.indexOf(i.title)]=t,r.forEach((n=>{n.type===rl&&n.conflictResolutionFor===e&&(n.conflictResolutionFor=t)}))}i.committed=!0}cleanUpRevisions(e=this.revisionQueueCommittedMinLength){const t=this[Jo],n=this[Qo],r=[];for(let e=0;e<n.length;e++){const t=n[e];if(!t.committed)break;r.push(t)}r.splice(Math.max(0,r.length-1-e),Math.min(r.length,e)),n.splice(0,r.length),t.splice(1,r.length)}markCurrentTransactionContentUserInput(){(this.isRecording||this.isRecordingRevision||this.isRecordingTemporaryRevision)&&this.transaction.markCurrentTransactionContentUserInput()}markCurrentTransactionContentCalculated(){(this.isRecording||this.isRecordingRevision||this.isRecordingTemporaryRevision)&&this.transaction.markCurrentTransactionContentCalculated()}}yl._$name="StateTrackingManager";var bl=e=>class extends(e||Qe){static $name="StoreStm";static configurable={stm:null,ignoreRemoteChangesInSTM:!1};changeStm(e,t){var n;return null!=t&&null!==(n=t.hasStore)&&void 0!==n&&n.call(t,this)&&t.removeStore(this),e&&(e.isStateTrackingManager||(e=new yl(e)),e.hasStore(this)||e.addStore(this)),e}add(e,t=!1,n={}){let r;const{stm:i}=this;var s;!this.tree&&null!=i&&i.shouldRecordAction?(r=super.add(e,t,n),null!==(s=r)&&void 0!==s&&s.length&&i.onStoreModelAdd(this,r,t)):r=super.add(e,t,n);return r}insert(e,t,n=!1){let r;const{stm:i}=this;if(!this.tree&&null!=i&&i.shouldRecordAction){var s;const o=(Array.isArray(t)?t:[t]).reduce(((e,t)=>{const n=t instanceof _s?this.indexOf(t):void 0;return void 0!==n&&-1!==n&&e.set(t,n),e}),new Map);r=super.insert(e,t),null!==(s=r)&&void 0!==s&&s.length&&(e=this.indexOf(r[0]),i.onStoreModelInsert(this,e,r,o,n))}else r=super.insert(e,t,n);return r}remove(e,t=!1,n){let r;const{stm:i}=this;if(!this.tree&&null!=i&&i.shouldRecordAction){var s;const o=(Array.isArray(e)?e:[e]).map((e=>this.getById(e))).filter((e=>Boolean(e))).reduce(((e,t)=>{const n=this.indexOf(t);return void 0!==n&&-1!==n&&e.set(t,n),e}),new Map);r=super.remove(e,t,n),null!==(s=r)&&void 0!==s&&s.length&&i.onStoreModelRemove(this,r,o,t)}else r=super.remove(e,t,n);return r}removeAll(e){const{stm:t}=this;let n;if(null!=t&&t.shouldRecordAction){const{tree:r,rootNode:i,allRecords:s}=this,o=s.length,a=r?i.children.slice():s.slice();n=super.removeAll(e),o&&0===this.count&&t.onStoreRemoveAll(this,a,e)}else n=super.removeAll(e);return n}beforeApplyChangeset(){const{stm:e,crudManager:t}=this;let n=!1,r=null;return null!=t&&t.applyingChangeset||null==e||!e.enabled||e.isNavigatingRevisions||(n=!0,e.isRecording&&(r=e.stash()),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),{shouldResume:n,transactionId:r}}applyChangeset(e,...t){const{shouldResume:n,transactionId:r}=this.beforeApplyChangeset(),i=super.applyChangeset(e,...t);return this.afterApplyChangeset(n,r),i}afterApplyChangeset(e,t){if(e){const{stm:e}=this;this.ignoreRemoteChangesInSTM?e.enable():e.stopTransaction(),e.applyStash(t)}}};class Cl{static new(e){return new this(e)}constructor(e){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),e&&e(this)}catch(e){return this.promise=this.promise.catch(e),this}finally(e){return this.promise=this.promise.finally(e),this}then(...e){return this.promise=this.promise.then(...e),this}}Cl._$name="Promissory";class wl extends(Mr.mixin(Hi)){static $name="StoreLazyLoadPlugin";static get pluginConfig(){return{override:["updateAutoLoad","performDataRequest"],assign:["load","isLoading","lazyGetAt"],after:["afterLoadData"],before:["setStoreData","destroy"]}}static configurable={totalCountProperty:"total",dataProperty:"data",chunkSize:100};static get properties(){return{loadQueue:{}}}get isLoading(){return this.client._isLoading||Object.values(this.loadQueue).some((e=>W.isPromise(e)))}get storage(){return this.client.storage}set totalCount(e){this._totalCount=e}get totalCount(){return this._totalCount}setEstimatedTotalCount(e){this.totalCount=e}afterConstruct(){const e=this,{client:t}=e;t.syncDataOnLoad&&(t.syncDataOnLoad=!1),e.storeListenersDetacher=t.ion({beforeAdd:"internalOnBeforeAdd",beforeRemove:"internalOnBeforeAdd",change:"internalOnChange",commit:"internalOnCommit",endApplyChangeset:"internalOnCommit",appliedCrudChangesToStore:"internalOnCommit",thisObj:e}),t.requestData||(t.requestData=e.requestData),t.autoLoad&&!t.readUrl&&this.requestAnimationFrame(this.doAutoLoad)}updateAutoLoad(e){e&&!this.client.readUrl&&this.doAutoLoad()}internalOnBeforeAdd(){if(this.isLoading)throw new Error("Removing or adding is not allowed when a lazy loaded Store is loading")}internalOnChange(){this.$loadLock||!this.client.added.count&&!this.client.removed.count||(this.$loadLock=new Cl)}internalOnCommit(){!this.client.changes&&this.$loadLock&&(this.$loadLock.resolve(),this.$loadLock=null)}performDataRequest(){return this.load()}afterLoadData(){this.totalCount&&(this.storage.values.length=this.totalCount)}setStoreData(e){null!=e&&e.length||!this.client.records.some(Boolean)||this.clear()}clear(){this.totalCount=null,this.loadQueue={}}async requestData({startIndex:e,count:t}){}lazyGetAt(e){return this.getAt(e)}async getAt(e){var t;const n=this,{loadQueue:r,totalCount:i}=n;if(e<0||null!=i&&e>i)return null;const s=n.getFromStorage(e);return s||(await(null===(t=n.$loadLock)||void 0===t?void 0:t.promise),n.isDestroyed?void 0:(r[e]?await r[e]:await n.doLazyLoad(n.calculateRange(e)),n.getFromStorage(e)))}getFromStorage(e){return this.storage.getAt(e)}calculateRange(e){const{totalCount:t,loadQueue:n,chunkSize:r}=this,i=Math.max(0,e-r),s=(t?Math.min(e+r,t):e+r)-1;let o=e,a=e;for(;o>i&&!n[o-1]&&!this.getFromStorage(o-1);)o-=1;for(;a<s&&!n[a+1]&&!this.getFromStorage(a+1);)a+=1;return{startIndex:o,count:a-o+1}}async doLazyLoad({isReload:e,...t}){this.triggerLazyLoadStart(arguments[0]),e&&this.clear();const n=this,{loadQueue:r,client:i}=n,{startIndex:s,count:o}=t,a=s+o-1,l=i.requestData(i.readUrl?t:i.buildRemoteParams(t));for(let e=s;e<=a;e++)r[e]=l;const d=await l;if(!d)return;const{[n.totalCountProperty]:c,[n.dataProperty]:u}=d;for(let e=s;e<=a;e++)r[e]=null;null!=c?n.totalCount=c:null==n.totalCount&&o>u.length&&n.setEstimatedTotalCount(s+u.length),n.addData(u,s,e),null!=n.totalCount&&(n.storage.values.length=n.totalCount),n.triggerLazyLoadEnd(arguments[0],u)}addData(e,t,n){var r;const{client:i,storage:s}=this;if(null==e||!e.length)return;if((!i.count||n)&&!t)return void(i.data=e);for(let t=e.length-1;t>=0;t--){const n=e[t],r=i.idRegister[n.id];r&&(r.setByDataSource(n,!0),r.internalClearChanges(!1,!0,n),e.splice(t,1))}if(!e.length)return;const{values:o}=s,a=e.map((e=>i.processRecord(i.createRecord(e),!0)));o.length<t&&(o.length=t),null==t&&(t=o.length),o.splice(t,a.length,...a),i.joinRecordsToStore(a),null===(r=this.processAddedRecords)||void 0===r||r.call(this,a),i.updateDependentStores("add",a);for(const e of a)i.idMap[e.id]={index:t,visibleIndex:t,record:e},t+=1,s.addToIndices(e);i.trigger("change",{action:"lazyload",records:a})}checkDuplicates(e){const{storage:t}=this;for(const n of e){const e=t.indexOf(n.id);e>=0&&t.values.splice(e,1)}}triggerLazyLoadStart(e){const t=this;t.isLoading||(t.isConfiguring?t.delay((()=>t.trigger("lazyLoadStarted",{...e})),0):t.client.trigger("lazyLoadStarted",{...e})),t.client.trigger("beforeLazyLoad",{...e})}triggerLazyLoadEnd(e,t){this.isLoading||this.client.trigger("lazyLoadEnded"),this.client.trigger("afterLazyLoad",{...e,data:t})}load(e){return this._loadedOnce=!0,this.doLazyLoad({isReload:Object.keys(this.loadQueue).length,startIndex:0,count:this.chunkSize})}doAutoLoad(){this._loadedOnce||this.load()}destroy(){var e;null===(e=this.storeListenersDetacher)||void 0===e||e.call(this),this.clear(),super.destroy()}}wl._$name="StoreLazyLoadPlugin";const Sl=e=>{var t;return(null===(t=e.children)||void 0===t?void 0:t.reduce(((e,t)=>e+(t.remoteChildCount??0)+1),0))??0},Dl=e=>Sl(e)>=e.remoteChildCount;var El=e=>class extends e{static $name="TreeStoreLazyLoadPlugin";static get pluginConfig(){var e;const t={};for(const e in super.pluginConfig)t[e]=[...super.pluginConfig[e]];t.override=t.override??[],t.override.push("loadChildren","getAt");const n=null===(e=t.assign)||void 0===e?void 0:e.indexOf("lazyGetAt");return n>=0&&t.assign.splice(n,1),t}static configurable={chunkSize:50};constructor(){super(...arguments),this.totalCount=0}load(){return this._loadedOnce=!0,this.doLazyLoad({parent:this.client.rootNode,isReload:Object.keys(this.loadQueue).length>0,startIndex:0})}changeRemoteChildCount(e,t,n){if(null!=e&&e.length){const r=e.map((e=>{var t;return e.parent??this.client.getById(e.parentId??(null===(t=e.originalData)||void 0===t?void 0:t.parentId))}));for(;r.length;){const e=r.shift();e&&(e.isRoot||r.push(e.parent),e.remoteChildCount=(e.remoteChildCount?e.remoteChildCount+t:e.children.length)??0,null==n||n.add(e))}}}internalOnCommit({changes:e}){super.internalOnCommit();const t=new Set;this.changeRemoteChildCount(e.added,1,t),this.changeRemoteChildCount(e.removed,-1,t),t.forEach((e=>{this.loadQueue[e.id]=Dl(e)}))}loadChildren(e){return this.doLazyLoad({parent:e,startIndex:0})}getAt(e){const t=this,{loadQueue:n,client:r}=t,i=r.records[e];if(i){var s;const{parent:e}=i;!(i.expanded&&i.remoteChildCount>0)||null!==(s=i.children)&&void 0!==s&&s.length||n[i.id]||t.doLazyLoad({parent:i,startIndex:0}),i!==e.lastChild||n[e.id]||t.doLazyLoad({startIndex:i.parentIndex+1,parent:e})}return i}async doLazyLoad({parent:e,isReload:t,...n}){t&&this.clear();const r=this,{client:i}=r,{id:s}=e;e.instanceMeta(i).isLoadingChildren=!0,r.triggerLazyLoadStart(arguments[0]);const o=r.loadQueue[s]=i.requestData({...i.readUrl?n:i.buildRemoteParams(n),parentId:e.isRoot?"root":s,count:r.chunkSize}),{[r.totalCountProperty]:a,[r.dataProperty]:l}=await o;if(r.loadQueue[s]===o){var d;if(e.isRoot&&a>=0&&(e.remoteChildCount=a),r.addData(l,e,t),r.totalCount=i.count,r.loadQueue[s]=Dl(e),!r.isLoading)null===(d=i.trigger)||void 0===d||d.call(i,"refresh",{action:"lazyload"});r.triggerLazyLoadEnd(arguments[0],l),e.instanceMeta(i).isLoadingChildren=!1}}addData(e,t,n){const{client:r,loadQueue:i}=this;if(n&&r.clear(!0),r.modelClass.fieldMap.remoteChildCount||r.modelClass.addField("remoteChildCount"),!e.length){const e=Sl(t),n=t.remoteChildCount-e;0!==n&&(t.remoteChildCount=e,this.changeRemoteChildCount([t],n))}Hs.preWalk({children:e},(({children:e})=>null!=e&&e.length?e:null),(e=>{const{id:t,children:n}=e;t&&e.remoteChildCount>0&&(!1!==e.expanded||null!=n&&n.length?null!=n&&n.length&&!i[t]&&Dl(e)?i[t]=!0:n||(e.children=[]):e.children=!0)})),t.appendChild(e,!0),r.added.clear()}};const xl={splice:1,clear:1},Rl={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},Tl=(e,t)=>("boolean"==typeof(t=t||!1)&&(t={includeFilteredOutRecords:t,includeCollapsedGroupRecords:!1}),t||Rl),Ml=Symbol("useRawDataUnset"),kl={enabled:!0,disableDuplicateIdCheck:!0,disableDefaultValue:!1,disableTypeConversion:!1},Fl={enabled:!0,disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1};class Il extends(Qe.mixin(Hi,Xi,lt,kr,Yi,bo,yo,vo,To,Mo,Io,Ao,Do,Po,Oo,Bo,bl,zo,xo,Ro)){crudManager=void 0;static $name="Store";static get properties(){return{relationCache:{},dependentStoreConfigs:new Map,addingClean:!1}}static configurable={id:!0,modelClass:_s,verifyNoGeneratedIds:!0,lazyLoad:null,autoLoad:null,useRawData:Ml,autoTree:!0};static get defaultConfig(){return{fields:null,data:null,tree:null,callOnFunctions:!0,storage:null,allowNoId:!0,preventSubClassingModel:null,storeClass:null}}static get identifiable(){return{registerGeneratedId:!1}}updateAutoLoad(e){!e||this.readUrl||this.lazyLoad||this.requestAnimationFrame(this.performDataRequest)}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){Object.assign(this,{added:new fo,removed:new fo,modified:new fo,idRegister:{},internalIdRegister:{},oldIdMap:{}}),super.construct(e),this.initRelations()}static from(e,t={},n=null){return e&&!e.isStore&&("string"==typeof e?e=Il.getStore(e):(Array.isArray(e)?(n&&(e=e.map((e=>e.isModel?e:n(e)))),e=W.assign({},t,{data:e})):e=W.assign({},t,e),e=new Il(e))),e}equals(e){return e.isStore&&e.$master===this.$master}doDestroy(){var e,t,n;const r=this,i=r.registeredRecords;null===(e=r.stm)||void 0===e||null===(t=e.removeStore)||void 0===t||t.call(e,r);for(let e,t=i.length-1;t>=0;t--){var s;e=i[t],null!==(s=e)&&void 0!==s&&s.isDestroyed||e.unjoinStore(r)}var o;(null===(n=r._storage)||void 0===n||n.destroy(),r.isChained)?r.masterStore.isDestroying||nt.remove(r.masterStore.chainedStores,r):null===(o=r.rootNode)||void 0===o||o.destroy();super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){if(this.resumeEvents()){const{values:e}=this.storage;this.trigger("refresh",{action:"batch",data:e,records:e})}}set storage(e){const t=this;null!=e&&e.isCollection?t._storage=e:t._storage=new ho(e),t._storage.autoFilter=t.reapplyFilterOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.ion({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const t=this;if((null===(e=t._allRecords)||void 0===e?void 0:e.generation)!==t.storage.generation){if(t.isTree){const e=t.collectDescendants(t.rootNode,void 0,void 0,{unfiltered:!0}).all;t.rootVisible&&e.unshift(t.rootNode),t._allRecords=e}else t._allRecords=t.isGrouped?t.collectGroupRecords(!0,!0):t.storage.allValues;t._allRecords.generation=t.storage.generation}return t._allRecords}getAllDataRecords(e){const t=this;return t.tree?e?t.allRecords:t.rootNode.allChildren:t.isGrouped?t.collectGroupRecords(e,!1):(e?t.storage.allValues:t.storage.values).filter((e=>e))}onIsCreatingToggle(e,t){const n=this,r=e.isPersistable&&!t;n.added[r?"add":"remove"](e),r&&(n.trigger("addConfirmed",{record:e}),n.autoCommit&&n.doAutoCommit())}joinRecordsToStore(e){const{totalCount:t}=this;for(let n=0;n<e.length;n++){const r=e[n];r.setData("parentIndex",t+n-e.length),r.joinStore(this)}}onDataChange({source:e,action:t,added:n,removed:r,replaced:i,oldCount:s,items:o,from:a,to:l}){const d=this,c=xl[t],u=c&&(null==n?void 0:n.length),h=c&&(null==r?void 0:r.length),{generation:g}=e,m=d.isFiltered&&!d.remoteFilter;let p,f;if(d._idMap=null,u&&d.joinRecordsToStore(n),null==i||i.forEach((([e,t])=>{e.unjoinStore(d,!0),t.joinStore(d)})),super.onDataChange(...arguments),u&&e.generation!==g&&!m&&d.trigger("refresh",arguments[0]),!d.isTree){if(u){for(const e of n)d.removed.includes(e)?d.removed.remove(e):d.addingClean||e.isLinked||d.added.add(e);p=!d.remoteFilter&&d.isFiltered&&d.reapplyFilterOnAdd,p&&d.filter({silent:!0}),f=!d.remoteSort&&d.isSorted&&d.reapplySortersOnAdd,f&&d.sort(null,null,!1,!0)}if(h){for(const e of r)e.cancelBatch(),e.unjoinStore(d),d.added.includes(e)?(d.added.remove(e),e.isBeingMaterialized&&d.removed.add(e)):e._undoingInsertion||e.isCreating||e.isLinked||d.removed.add(e);d.modified.remove(r),p=m,p&&d.filter({silent:!0})}}switch(t){case"clear":d.relationCache={},d.updateDependentStores("removeall"),d.trigger("removeAll"),d.trigger("change",{action:"removeall"});break;case"splice":if(u){d.updateDependentStores("add",n);const t=n.reduce(((e,t)=>{const{previousIndex:n}=t.meta;return n>-1&&n<e&&(e=n),e}),n[0].meta.previousIndex),r={records:n,index:e.indexOf(n[0],!e.autoFilter)};t>-1&&(r.oldIndex=t),d.trigger("add",r),d.trigger("change",Object.assign({action:"add"},r)),p&&d.triggerFilterEvent({action:"filter",filters:d.filters,oldCount:s,records:d.storage.allValues}),f&&d.trigger("sort",{action:"sort",sorters:d.sorters,records:d.storage.allValues})}r.length&&(d.updateDependentStores("remove",r),d.trigger("remove",{records:r}),d.trigger("change",{action:"remove",records:r})),i.length&&(d.updateDependentStores("replace",i),d.trigger("replace",{records:i,all:d.records.length===i.length}),d.trigger("change",{action:"replace",replaced:i,all:d.records.length===i.length}));break;case"filter":(d.isGrouped||d.isSorted)&&d.performSort(!0);break;case"move":{const e=Math.min(a,l),n=Math.min(d.storage.allValues.length-1,Math.max(a,l));for(let t=d.storage.allValues,r=e;r<=n;r++)t[r].setData("parentIndex",r);d.trigger("move",{records:o,from:a,to:l}),d.isFiltered&&d.performFilter(),d.trigger("change",{action:t,record:o[0],records:o,from:a,to:l});break}}}onDataReplaced(e,t){var n;const r=this,{storage:i}=r,s=i.allValues,o=Boolean(r.sorters.length>0);for(let e=0;e<s.length;e++){var a;null===(a=s[e])||void 0===a||a.joinStore(r)}if(!r.remoteFilter&&r.isFiltered&&r.filter({silent:!0}),r.remoteSort?r.isGrouped&&i.replaceValues({...r.prepareGroupRecords(),silent:!0}):(r.isGrouped&&r.group(null,null,!1,!o,!0),o&&r.sort(null,null,!1,!0)),!r.useRawData.disableDuplicateIdCheck){const{idMap:e}=r;if(Object.keys(e).length<i.values.length){const t=[];throw i.values.forEach((n=>e[n.id]?delete e[n.id]:t.push(n))),new Error(`Id collision on ${t.map((e=>e.id))}`)}}const l={action:e,data:t,records:i.values};r.updateDependentStores(e,l.records),null===(n=r.afterLoadData)||void 0===n||n.call(r),r.isRemoteDataLoading||r.trigger("refresh",l),r.trigger("change",l)}onModelChange(e,t,n,r,i){var s;const o=this,a={record:e,records:[e],changes:n,batch:null!=e.batching,fromRelationUpdate:i};if(o.storage.onItemMutation(e,n),"id"in n){const{oldValue:n,value:r}=t.id;o.updateDependentRecordIds(n,r),o.onRecordIdChange({record:e,oldValue:n,value:r})}else e.meta._ignoreRelatedIdUpdate||o.updateDependentStores("update",[e],r);const l=!e.ignoreBag&&!e.isLinked&&o.updateModifiedBagForRecord(e)&&!(null!==(s=e.meta)&&void 0!==s&&s.pendingFormulae);if(o.onUpdateRecord(e,n),!r){if("id"in n){const{oldValue:n,value:r}=t.id;o.trigger("idChange",{store:o,record:e,oldValue:n,value:r})}o.trigger("update",a),o.trigger("change",Object.assign({action:"update"},a))}o.autoCommit&&l&&o.doAutoCommit()}updateModifiedBagForRecord(e){const t=this,{modified:n,added:r}=t;return e.isModified&&!e.isRoot&&t.idRegister[e.id]?(n.includes(e)||r.includes(e)||(e.isPhantom?r.add(e):n.add(e)),e.isBeingMaterialized&&(t.modifiedMaterialized=t.modifiedMaterialized??new Set,t.modifiedMaterialized.add(e)),!0):(n.remove(e),!1)}get idMap(){const e=this,t=!e._idMap,n=e._idMap||(e._idMap={});if(t){const t=e.storage.values;for(let e,i=0,s=0;i<t.length;i++){var r;e=t[i],e&&(n[e.id]={index:i,visibleIndex:s,record:e}),null!==(r=e)&&void 0!==r&&r.isSpecialRow||s++}if(e.isFiltered)for(let t=0,r=e.storage._values.length;t<r;t++){const r=e.storage._values[t];r&&(r.id in n?n[r.id].unfilteredIndex=t:n[r.id]={index:-1,unfilteredIndex:t,record:r})}}return n}changeModelClass(e){const{fields:t}=this;this.originalModelClass=e;let n=e;if(null!=t&&t.length){class r extends e{static get fields(){return t}}n=r}else if(!this.preventSubClassingModel){class t extends e{}n=t}return n.initClass(),n}get $lazyLoadPluginClass(){return wl}changeLazyLoad(e){const t=this;let n=t.$lazyLoadPluginClass;t.isTree&&!n.isOfTypeName("DateStoreLazyLoadPlugin")&&(t.treeLazyLoadClass||(t.treeLazyLoadClass=class extends(El(n)){}),n=t.treeLazyLoadClass);let r=t.getPlugin(n);if(e){const i=W.isObject(e);return r?i&&W.assign(r,e):r=t.addPlugin(n,i?e:null),r}var i;return null===(i=r)||void 0===i||i.destroy(),!1}changeId(e,t){return super.changeId(!0!==e&&e,t)}updateId(e,t){const n=Il.getById(e);n&&Il.unregisterInstance(n),super.updateId(e,t)}generateAutoId(){return Il.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}get autoTree(){return!1!==this.tree&&this._autoTree}buildRootNode(){return{}}static getStore(e,t){if(e instanceof Il)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let n;const r=e.map((e=>(e instanceof _s?n=e.constructor:"string"==typeof e&&(e={text:e}),e)));if(!n){class e extends _s{}n=e}e={autoCreated:!0,data:r,modelClass:n,allowNoId:!0},t||(t=Il)}return t?new t(e):void 0}static get stores(){return Il.registeredInstances}get rootNode(){return!this.isChainedTree&&this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const n=this,r=n._rootNode;e!==r&&(r&&(n.clear(!0),n.removed.clear()),e instanceof _s?(e.instanceMeta(n).collapsed=!1,n._rootNode=e):n._rootNode=e=new n.modelClass({expanded:!0,[n.modelClass.idField]:`${n.id}-rootNode`,...e},n,{isRoot:!0},!0),n._tree=!0,e.isRoot=!0,e.joinStore(n),(null!==(t=e.children)&&void 0!==t&&t.length||n.rootVisible)&&(e.isLoading=!0,n.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),n.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){this.setStoreData(e)}get data(){return this.getAllDataRecords(!0).map((e=>e.data))}setStoreData(e){var t;const n=this,{idField:r,childrenField:i}=n.modelClass;e&&!Array.isArray(e)&&(e=W.transformNamedObjectToArray(e,r));const s=Hs.walkWhile(e??[],(e=>e[i]),Object.isExtensible);var o;(null!==(t=e)&&void 0!==t&&t.length&&!s&&(n.transformFlatData||n.useRawData.enabled)&&(n.transformFlatData&&(n.useRawData=n.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1}),e=W.clone(e)),n.getConfig("plugins"),n.processConfiguredListeners(),!n.isChained||n.isChainedTree)&&(n.autoTree&&null!==(o=e)&&void 0!==o&&o.some((e=>e[i]))&&(n.tree=!0));if(e&&(n.remoteSort||n.remoteFilter))for(let t=0;t<e.length;t++)e[t]._remoteSortIndex=t;n.syncDataOnLoad&&n._data?n.syncDataset(e):(n._data=e,n.tree?n.loadTreeData(e):n.loadData(e),n.added.clear(),n.removed.clear(),n.modified.clear())}loadTreeData(e){const t=this,n=t.rootNode,r=new Map;if(t.transformFlatData&&(e=t.treeifyFlatData(e)),n.isLoading=!0,t.records.length&&t.keepExpandedOnLoad&&t.traverse((e=>{e.isLeaf||r.set(e.id,e.instanceMeta(t).collapsed)})),e.sort(((e,t)=>e.parentIndex-t.parentIndex)),t.clear(!0),t.suspendEvents(!0),n.appendChild(e),r.forEach(((e,n)=>{const r=t.getById(n);r&&t.toggleCollapse(r,e)})),t.resumeEvents(),t.updateDependentStores("dataset",[n]),n.isLoading=!1,0===e.length){const e={action:"dataset",data:[],records:[]};t.trigger("refresh",e),t.trigger("change",e)}else t.isFiltered&&t.filter()}loadData(e,t="dataset"){const n=this,{storage:r,allowNoId:i}=n,s=n.modelClass.fieldMap.id.dataSource,o=n.find((e=>e.isCreating));o&&r.values.splice(n.records.indexOf(o),1);let a=n.verifyNoGeneratedIds;if(n.removeHeadersAndFooters(n.storage.values),n._idMap=null,n.oldIdMap={},e){const d=!(e[0]instanceof _s),c=e.length,u=new Array(c);d&&n.modelClass.exposeProperties(e[0]);for(let t=0;t<c;t++){let r=e[t];if(d){var l;const e=r[s];if(!i&&null==e)throw new Error(`Id required but not found on row ${t}`);a&&null!=e&&null!==(l=e.startsWith)&&void 0!==l&&l.call(e,"_generated")&&(console.warn(`Generated id found in data: ${e}. Generated ids are temporary and should be replaced with real ids by the backend`),a=!1),r=n.createRecord(r,!0)}n.isFillingFromMaster||(r=n.processRecord(r,!0),r.setData("parentIndex",t)),u[t]=r}n.clear(!0),r.replaceValues({values:u,isNewDataset:!0,silent:!0}),o&&!r.values.includes(o)&&r.values.push(o),n._data=e,n.onDataReplaced(t,e)}else n.clear(!0),n._data=null;n.isSyncingDataOnLoad=!1}getRange(e,t,n=!0){return(n?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1,n=!1){return new this._modelClass(e,this,null,t,!1,n)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:n}){const r=this,i=r._idMap,{idRegister:s,oldIdMap:o}=r;if(r.storage._indicesInvalid=!0,o[t]=e,i&&!i[n]){const e=i[t];delete i[t],i[n]=e}r.added.changeId(t,n),r.removed.changeId(t,n),r.modified.changeId(t,n),delete s[t],s[n]=e,e.index=r.storage.indexOf(e)}onUpdateRecord(e,t){var n,r;const i=this,{internalId:s}=t,{internalIdRegister:o,reapplyFilterOnUpdate:a,reapplySortersOnUpdate:l}=i;s&&(this.storage._indicesInvalid=!0,delete o[s.oldValue],o[s.value]=e),(!0===a||null!==(n=a.fields)&&void 0!==n&&n.some((e=>e in t)))&&i.isFiltered&&(i.filterBatching||i.filter()),(!0===l||null!==(r=l.fields)&&void 0!==r&&r.some((e=>e in t)))&&i.isSorted&&(i._reapplySortersSuspended?i._shouldReapplySorters=!0:i.sort())}get useRawData(){var e;return this._useRawData===Ml?this.readUrl||null!==(e=this.crudManager)&&void 0!==e&&e.loadUrl?Fl:{enabled:!1}:this._useRawData}changeUseRawData(e){return e===Ml?Ml:!0===e?kl:e?Object.assign(e,{enabled:!0}):{enabled:!1}}async performDataRequest(e,t,n){var r,i;const s=this,o=s.buildRemoteParams(t);let a,l;if(!e&&(!1===await s.trigger("beforeRequest",{action:"read",params:o})||!1===await(null===(r=s.trigger)||void 0===r?void 0:r.call(s,"requestData",o))))return!1;if(!s.isDestroyed){if(s.requestData){if(({data:a,total:l}=await s.requestData(o)),s.isDestroyed)return;null==n||n(),s.data=a,null!=l&&(s.remoteTotal=l)}else null==n||n();await(null===(i=s.trigger)||void 0===i?void 0:i.call(s,"afterRequest",{response:{data:a,total:l},params:o,action:"read"}))}}getCount(e=!0){const t=this,{storage:n,groupRecords:r,isFiltered:i,isGrouped:s,isTree:o,rootNode:a}=t;if("boolean"==typeof e)return G.deprecate("core","7.0.0","getCount(true/false) deprecated in favor of getCount(options)"),e?t.count:n.totalCount-((null==r?void 0:r.count)||0);if(e.all)return this.allRecords.length;"visibleData"in e||(e.visibleData=!0);let l=0;const{visibleData:d,headersFooters:c,filteredOut:u,collapsed:h}=e,g=i?(null==r?void 0:r.values.reduce(((e,n)=>e+(t.includes(n)?1:0)),0))??0:(null==r?void 0:r.count)??0,m=n.count-g;if(d&&(l+=m),c&&s&&(l+=i&&u?r.count??0:g),u&&i&&(l+=o?a.getDescendantCount(!1,t,!0)-a.getDescendantCount(!1,t,!1):n.allValues.length-n.values.length),h)if(s){let e=0;for(const n of t.collapsedGroups)e+=r.get(n).groupChildren.length;l+=e}else o&&(l+=a.descendantCount-m);return l}get count(){return this.storage.count}get originalCount(){var e;return G.deprecate("core","7.0.0","originalCount was deprecated in favor of getCount()"),this.storage.totalCount-((null===(e=this.groupRecords)||void 0===e?void 0:e.count)||0)}get allCount(){return G.deprecate("core","7.0.0","allCount was deprecated in favor of totalCount"),this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get totalCount(){return this.isPaged&&"remoteTotal"in this?this.remoteTotal:this.getCount({all:!0})}set totalCount(e){this.isPaged&&(this.remoteTotal=e)}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this;if(!t.useRawData.disableDuplicateIdCheck){const n=t.isTree&&t.idRegister[e.id];if(n&&n!==e)throw new Error(`Id collision on ${e.id}`)}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){var t;const n=this;let r;null!==(t=e)&&void 0!==t&&t.isModel&&(r=e,e=r.id);const i=n.idRegister[e];if(r){var s;if(null!==(s=r)&&void 0!==s&&s.hasLinks&&!i){const{allValues:e}=n.storage;return r.$links.find((t=>e.includes(t)))}return r}return i}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[_s.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1,n=!1){var r;if(null!=e&&e.isModel&&(null===(r=e.stores)||void 0===r||!r.includes(this.$store||this))){const n=e.$links.find((e=>this.storage.allValues.includes(e)));return n?this.indexOf(n,t):-1}if(this.isTree)return(n?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const i=_s.asId(e);if(null==i)return-1;const s=this.idMap[i];return s?s[t?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,t=!1,n=!1){const r=[],i={};let s;return this.forEach((t=>{if(!t.isSpecialRow&&!t.isRoot){s=t.getValue(e);const n=s instanceof Date?s.getTime():s;void 0===i[n]?(r.push(s),i[n]={value:s,count:1}):i[n].count++}}),this,{includeCollapsedGroupRecords:!0,includeFilteredOutRecords:t}),n?Object.values(i):r}getValueCount(e,t){let n=0;return this.forEach((r=>{W.isEqual(r.getValue(e),t)&&n++})),n}set json(e){"string"==typeof e&&(e=N.safeJsonParse(e)),this.data=e}get json(){return N.safeJsonStringify(this)}get formattedJSON(){return N.safeJsonStringify(this,null,4)}toJSON(){const e=this,{persistable:t,dataSource:n}=e.modelClass.getFieldDefinition("expanded");return(e.isTree?e.rootNode.unfilteredChildren||e.rootNode.children||[]:e.allRecords).map((r=>{const i=r.toJSON();return e.tree&&r.isParent&&t&&(i[n]=r.isExpanded(e)),i}))}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){const t=[];var n;this.tree?null===(n=this.rootNode.children)||void 0===n||n.forEach((n=>t.push(n.getCurrentConfig(e)))):this.forEach((n=>t.push(n.getCurrentConfig(e))));return t}getCurrentConfig(e){const t=super.getCurrentConfig(e),{state:n}=this;var r;t&&(t.data&&(t.data=this.getInlineData(e)),delete t.project,delete t.stm,delete t.asyncEvents,(null===(r=t.modelClass)||void 0===r?void 0:r.$meta.hierarchy[t.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete t.modelClass,this.tree||delete t.tree,n&&Object.assign(t,n));return t}forEach(e,t=this,n){const r=this,i=(n,r)=>{if(n&&!n.isRoot&&!n.isSpecialRow)return e.call(t,n,r)};if(n=Tl(0,n),r.isTree)r.isChained&&(n={...n,sorterFn:r.sorterFn}),r.rootNode.traverseWhile(i,!1,n);else{const e=n.includeFilteredOutRecords?r.storage.allValues:r.storage.values;if(r.isGrouped&&n.includeCollapsedGroupRecords)for(let t=0;t<e.length;t++){const r=e[t],s=n.includeFilteredOutRecords?r.unfilteredGroupChildren:r.groupChildren;if(s&&!0===r.meta.collapsed)for(let e=0;e<s.length;e++){if(!1===i(s[e],e))return}else if(!1===i(r,t))return}else for(let t=0;t<e.length;t++)if(!1===i(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}flatMap(e,t=this){return this.storage.values.flatMap(e,t)}every(e,t=this,n){return this.storage[n?"allValues":"values"].every(e,t)}reduce(e,t=[],n=this){return n!==this&&(e=e.bind(n)),this.storage.values.reduce(e,t,n)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,n=t===this.rootNode,r){const i=this;if(r=Tl(0,r),i.isTree){if("boolean"==typeof t&&(n=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverse(e,n,r)}else i.forEach((t=>t.traverse(e,!1,r)),i,r)}traverseWhile(e,t=this.rootNode,n=t===this.rootNode,r){const i=this;if(r=Tl(0,r),i.isTree){if("boolean"==typeof t&&(n=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,n,r)}else for(const t of i.storage)if(!1===t.traverse(e,!1,r))break}getNext(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(s>=i.length-1){if(!t)return null;s=-1}const o=i[s+1];return n&&o&&(o.isSpecialRow||"function"==typeof n&&n(o))?r.getNext(i[s+1],t,n):o}getPrev(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(0===s){if(!t)return null;s=i.length}const o=i[s-1];return s>0&&n&&o&&(o.isSpecialRow||"function"==typeof n&&n(o))?r.getPrev(i[s-1],t,n):o}getAdjacent(e,t=!0,n=!1,r=!1){return t?this.getNext(e,n,r):this.getPrev(e,n,r)}getNextLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(i>=n.length-1){if(!t)return null;i=-1}return n[i+1]}getPrevLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(0===i){if(!t)return null;i=n.length}return n[i-1]}getAdjacentLeaf(e,t=!0,n=!1){return t?this.getNextLeaf(e,n):this.getPrevLeaf(e,n)}}Il.initClass(),Il._$name="Store";class Al extends wl{static $name="AjaxStoreLazyLoadPlugin";static get pluginConfig(){const e={};for(const t in super.pluginConfig)e[t]=[...super.pluginConfig[t]];return e.assign.push("updateResponseTotalProperty","updateResponseDataProperty"),e}updateResponseTotalProperty(e){this.totalCountProperty=e}updateResponseDataProperty(e){this.dataProperty=e}async requestData(e){const{totalCountProperty:t,dataProperty:n}=this.lazyLoad,r=await this.internalLoad(e,"",void 0,!1);return{[t]:r.json[t],[n]:r.data}}async load(e){const{client:t}=this,n=t.params;e&&(t.params={...e,...n}),t.autoLoad&&t.isConstructing&&await new Promise((e=>this.requestAnimationFrame(e))),await super.load(),e&&(t.params=n)}}Al._$name="AjaxStoreLazyLoad";const Ll=(e,t)=>(Array.isArray(t[1])?t[1].forEach((n=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(n)))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),Pl=Promise.resolve(),Ol=e=>String(e).padStart(2,"0");class $l extends Il{static $name="AjaxStore";static configurable={responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",params:null,autoCommitTimeout:10,includeChildrenInRemoveRequest:!0,transformLoadedData:null,transformCreationData:null,transformModificationData:null,transformRemovalData:null,ignoreLoadPropagationChanges:!1,restfulFilter:!1};static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"},paramsInBody:G.checkVersion("core","6.0",">=")}}modificationsTracking=0;suspendModificationsTracking(){this.modificationsTracking++}resumeModificationsTracking(){this.modificationsTracking--}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.readUrl&&this.load().catch((()=>{}))}get $lazyLoadPluginClass(){return Al}get isLoading(){return super.isLoading||this._isLoading?2:!!this.loadTriggerPromise&&1}get isCommitting(){return Boolean(this.commitPromise??this.autoCommitTimeoutPromise)}updateFilterParamName(e){super.updateFilterParamName(e),this.remoteFilter=this.remoteFilter||this.restfulFilter}updateRestfulFilter(e,t){this.remoteFilter=e||Boolean(this.filterParamName)||this.remoteFilter&&!t}buildQueryString(e,...t){const n=e.includes("?"),r=Object.entries(Object.assign({},...t)).reduce(Ll,[]).join("&");return r?(n?"&":"?")+r:""}async performRemoteSort(e){const t=this;if(t.readUrl&&!t.isRemoteDataLoading){var n;if(t.isRemoteDataLoading=!0,!1===await(null===(n=t.beforePerformSort)||void 0===n?void 0:n.call(t)))return;const r=await t.load();return t.afterPerformSort(e),t.isRemoteDataLoading=!1,r}super.performSort(e)}async performRemoteFilter(e){const t=this;if(t.filterBatching>0)t.needsFiltering=!0;else{if(t.readUrl){var n,r;null===(n=t.loadingPromise)||void 0===n||n.abort(),t.isRemoteDataLoading=!0;const i=t.count,{filters:s}=t;if(!1===await(null===(r=t.beforePerformFilter)||void 0===r?void 0:r.call(t,{filters:s,oldCount:i})))return;const o=await t.load(),a=e?null:{action:"filter",filters:s,oldCount:i,records:t.storage.values};return t.afterPerformFilter(a),t.trigger("refresh",a),t.isRemoteDataLoading=!1,o}super.performRemoteFilter(e)}}encodeFilterParams(e){const t=this.getFilterParams(e);return JSON.stringify(t,(function(e,t){return""===e?t:this[e]instanceof Date?(e=>`${e.getFullYear()}-${Ol(e.getMonth()+1)}-${Ol(e.getDate())}T${Ol(e.getHours())}:${Ol(e.getMinutes())}:${Ol(e.getSeconds())}.${e.getMilliseconds()}`)(this[e]):t}))}encodeSorterParams(e){return JSON.stringify(this.getSorterParams(e))}buildReadUrl(){const{readUrl:e}=this;if(this.restfulFilter&&this.filters.count){return(e.endsWith("/")?e:e+"/")+this.filters.first.value}return e}internalLoad(e,t,n,r=0){e=W.assign({},this.params,e);const i=this,s={action:"read"+t,params:e,url:i.buildReadUrl()};if(i.buildRemoteParams(e,!0),!1===i.trigger("beforeLoad"+t,s))throw!1;return i.loadArgs=[s,e,t,n],!1===r?new Promise(((e,t)=>i.sendLoadRequest(e,t))):i.loadTriggerPromise||(i.loadTriggerPromise=new Promise(((e,t)=>{i.setTimeout({delay:r,fn:"sendLoadRequest",args:[e,t],cancelOutstanding:!0})})))}async sendLoadRequest(e,t){const n=this,[r,i,s,o]=n.loadArgs;if(n.loadTriggerPromise=null,r.url){n._isLoading=!0,n.trigger(`load${s}Start`,r),n.trigger("beforeRequest",r);const c={parseJson:!0};n.headers&&(c.headers=W.clone(n.headers)),n.useRestfulMethods&&(c.method=n.httpMethods.read,r.body&&(c.body=JSON.stringify(r.body)));try{var a,l;const u=n.paramsInBody&&("POST"===(null===(a=c.method)||void 0===a?void 0:a.toUpperCase())||"PUT"===(null===(l=c.method)||void 0===l?void 0:l.toUpperCase()))&&null==c.body,h=r.url+(u?"":n.buildQueryString(r.url,i)),g=n.loadingPromise=vr.get(h,W.assign(c,n.fetchOptions,u?{body:JSON.stringify(i)}:null)),m=await g;if(n.isDestroyed)return;const p=n.transformLoadedData?n.transformLoadedData(m.parsedJson):m.parsedJson,f=Array.isArray(p),v=f||p&&!1!==W.getPath(p,n.responseSuccessProperty),y=f?null:W.getPath(p,n.responseTotalProperty);if(n.loadingPromise=null,n._isLoading=!1,r.response=m,r.json=p,v){if(null!=y&&(n.remoteTotal=parseInt(y,10)),n.isPaged&&!n.lazyLoad){if(!(n.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");n.currentPage=n.pageStartParamName?i[n.pageStartParamName]/n.pageSize+1:i[n.defaultPageParamName]}var d;if(r.data=f?p:W.getPath(p,n.responseDataProperty),n.suspendModificationsTracking(),await(null==o?void 0:o(r)),n.resumeModificationsTracking(),n.isPartOfProjectRaw)n.ignoreLoadPropagationChanges&&n.suspendModificationsTracking(),await(null===(d=n.getProject())||void 0===d?void 0:d.commitAsync()),n.ignoreLoadPropagationChanges&&n.resumeModificationsTracking();!n.isDestroyed&&n.trigger("load"+s,r),e(r)}else Object.assign(r,{exception:!0,exceptionType:"server",error:null==p?void 0:p.error}),!n.isDestroyed&&n.trigger("exception",r),t(r);!n.isDestroyed&&n.trigger("afterRequest",r)}catch(e){n._isLoading=!1,r.exception=!0,e instanceof Response?(r.exceptionType=e.ok?"server":"network",r.response=e,r.error=e.error):(r.exceptionType="server",r.error=e),!n.isDestroyed&&n.trigger("exception",r),t(r),!n.isDestroyed&&n.trigger("afterRequest",r)}}}async load(e){const t=this;return t.isPaged?t.loadPage(t.currentPage||1,e):t.internalLoad(e,"",(e=>{t.data=e.data}))}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",(t=>{t.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)}),!1):this.immediatePromise}async loadPage(e,t={}){return this.readUrl?(t[this.defaultPageParamName]=e??1,this.internalLoad(t,"Page",(e=>{this.loadData(e.data,"pageLoad")}))):super.loadPage(e)}async commit(){return this.clearTimeout("autoCommit"),this.autoCommitTimeoutPromise=null,this.queueCommit()}queueCommit(){var e;const t=this;let n;return t.commitPromise?n=t.commitPromise.then((()=>t.performCommit())):(t._commitPromiseQueueLength=0,n=t.performCommit()),t._commitPromiseQueueLength+=1,t.commitPromise=null===(e=n)||void 0===e?void 0:e.finally((()=>{t._commitPromiseQueueLength-=1,0===t._commitPromiseQueueLength&&(t.commitPromise=null)}))}performCommit(){const e=this,{changes:t}=e,n=[];if(!t)return e.modified.count&&(e.modified.forEach((e=>e.internalClearChanges(!0,!1))),e.modified.clear()),Pl;if(!1!==e.trigger("beforeCommit",{changes:t})){[...t.added,...t.modified,...t.removed].forEach((e=>e.meta.committing=!0)),e.trigger("commitStart",{changes:t});const r={action:"commit",exception:!1,changes:t};let i=e.commitRemoved(r);return i&&n.push(i),i=e.commitAdded(r),i&&n.push(i),i=e.commitModified(r),i&&n.push(i),n.length?(i=1===n.length?n[0]:Promise.all(n),new Promise(((n,s)=>{i.then((()=>{r.exception?(e.trigger("exception",r),s(r)):(e.trigger("commit",{changes:t}),n(r))})).catch((()=>{s(r)}))}))):(e.modified.forEach((e=>e.internalClearChanges(!0,!1))),e.modified.clear(),e.added.forEach((e=>e.internalClearChanges(!0,!1))),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),Pl)}return Pl}doAutoCommit(){const e=this;e.suspendCount<=0&&!e.hasTimeout("autoCommit")&&(e.autoCommitTimeoutPromise=new Promise((t=>{e.setTimeout({name:"autoCommit",fn:()=>{e.autoCommitTimeoutPromise=null,e.commit().then().catch((e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e})),t()},delay:e.autoCommitTimeout})})))}buildCommitUrl(e){return e+this.buildQueryString(e,this.params)}commitAdded(e){const t=this,n=[...t.added];return n.length&&t.createUrl?new Promise((r=>{const i=n.map((e=>e.persistableData)),s={action:"create",params:t.params,url:t.buildCommitUrl(t.createUrl)};e.create=s,s.body={data:i},t.trigger("beforeRequest",s);let o=t.transformCreationData?t.transformCreationData(s.body):s.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(o.data)),o=e}const a={parseJson:!0};t.headers&&(a.headers=W.clone(t.headers)),t.useRestfulMethods&&(a.method=t.httpMethods.create),vr.post(s.url,o,W.assign(a,t.fetchOptions)).then((o=>{if(t.isDestroyed)return;const a=o.parsedJson,l=Array.isArray(a)||a&&!1!==a.success;if(e.response=o,s.json=a,s.response=o,l){const o=t.processReturnedData(a,n,i);t.added.remove(o),t.modified.add(o.filter((e=>e.meta.modified&&!W.isEmpty(e.meta.modified)))),t.trigger("commitAdded"),t.trigger("refresh",s),r(e)}else n.forEach((e=>e.meta.committing=!1)),e.exception=s.exception=!0,e.exceptionType=s.exceptionType="server",t.trigger("exception",s),r(e);t.trigger("afterRequest",s)})).catch((i=>{n.forEach((e=>e.meta.committing=!1)),e.exception=s.exception=!0,i instanceof Response?(e.response=i,s.exceptionType=i.ok?"server":"network",s.response=i,s.error=i.error):(s.exceptionType="server",s.error=i),!t.isDestroyed&&t.trigger("exception",s),r(e),!t.isDestroyed&&t.trigger("afterRequest",s)}))})):null}commitModified(e){const t=this,n=[...t.changes.modified],r=n.length&&t.updateUrl?new Promise((r=>{const i={action:"update",params:t.params,url:t.buildCommitUrl(t.updateUrl)},s=n.map((e=>t.writeAllFields?e.persistableData:e.modificationDataToWrite)).filter((e=>!W.isEmpty(e)));if(0===s.length)return t.modified.clear(),n.forEach((e=>e.meta.committing=!1)),void r();e.update=i,i.body={data:s},t.trigger("beforeRequest",i);let o=t.transformModificationData?t.transformModificationData(i.body):i.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(o.data)),o=e}const a={parseJson:!0};t.headers&&(a.headers=W.clone(t.headers)),t.useRestfulMethods&&(a.method=t.httpMethods.update),vr.post(i.url,o,W.assign(a,t.fetchOptions)).then((o=>{if(t.isDestroyed)return;const a=o.parsedJson,l=Array.isArray(a)||a&&!1!==a.success;e.response=o,i.json=a,i.response=o,l?(t.processReturnedData(a,n,s,!0,!0),t.trigger("commitModified"),t.trigger("refresh",i),r(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=i.exception=!0,i.exceptionType="server",t.trigger("exception",i),r(e)),t.trigger("afterRequest",i)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=i.exception=!0,s instanceof Response?(e.response=s,i.exceptionType=s.ok?"server":"network",i.response=s,i.error=s.error):(i.exceptionType="server",i.error=s),!t.isDestroyed&&t.trigger("exception",i),r(e),!t.isDestroyed&&t.trigger("afterRequest",i)}))})):null;return!n.length&&t.modified.count&&t.modified.clear(),r}processReturnedData(e,t,n,r=!1){Array.isArray(e)||(e=W.getPath(e,this.responseDataProperty));const{idField:i}=t[0].constructor,s=!e||e.length===t.length,o=[];return t.forEach(((t,a)=>{var l,d;const c=r?null===(l=e)||void 0===l?void 0:l.find((e=>e[i]===t.id)):null===(d=e)||void 0===d?void 0:d[a];if(s||c){const e=t.modificationDataToWrite,s=r?n.find((e=>e.id===t.id)):n[a],l={};if(t.meta.committing=!1,c&&(t.syncId(c[i]),Object.assign(t.data,this.modelClass.processData(c,r,this,t))),e)for(const n in s)if(e[n]===s[n]){const e=t.getFieldDefinitionFromDataSource(n);null!=e&&e.persist&&(l[e.name]=1)}t.internalClearChanges(!0,!0,l,!0),o.push(t)}})),o}commitRemoved(e){const t=this,{removed:n,includeChildrenInRemoveRequest:r}=t;return n.count&&t.deleteUrl?new Promise((i=>{let s;if(r)s=n.values;else{s=[];for(const e of n.values){var o;const r=e.parentId??(null===(o=e.meta.modified)||void 0===o?void 0:o.parentId);null==r||r!==t.rootNode.id&&n.includes(r)||s.push(e)}}const a={action:"delete",params:t.params,url:t.buildCommitUrl(t.deleteUrl),body:{ids:s.map((e=>e.id))}};e.delete=a,t.trigger("beforeRequest",a);let l=t.transformRemovalData?t.transformRemovalData(a.body):a.body;if(t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(l.ids)),l=e}const d={parseJson:!0};t.headers&&(d.headers=W.clone(t.headers)),t.useRestfulMethods&&(d.method=t.httpMethods.delete),vr.post(a.url,l,W.assign(d,t.fetchOptions)).then((r=>{const s=r.parsedJson,o=Array.isArray(s)||s&&!1!==s.success;e.response=r,a.json=s,a.response=r,o?(n.forEach((e=>e.meta.committing=!1)),n.clear(),t.trigger("commitRemoved"),t.trigger("refresh",a),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=a.exception=!0,a.exceptionType="server",t.trigger("exception",a),i(e)),t.trigger("afterRequest",a)})).catch((r=>{n.forEach((e=>e.meta.committing=!1)),e.exception=a.exception=!0,r instanceof Response?(e.response=r,a.exceptionType=r.ok?"server":"network",a.response=r,a.error=r.error):(a.exceptionType="server",a.error=r),!t.isDestroyed&&t.trigger("exception",a),i(e),!t.isDestroyed&&t.trigger("afterRequest",a)}))})):null}}$l._$name="AjaxStore";class _l extends _s{static $name="ComboModel";static fields=[{name:"value"},{name:"text"}]}_l._$name="ComboModel";const Hl={};class Vl{static get(e,t=Hl){const n=e._domData||(e._domData={});return t===Hl?n:n[t]}static remove(e,t){const{_domData:n}=e,r=null==n?void 0:n[t];return null==n||delete n[t],r}static set(e,t,n=Hl){return n===Hl?e._domData=n=t:(e._domData||(e._domData={}))[t]=n,n}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}Vl._$name="DomDataStore";class Nl{static $name="CSSHelper";static insertRule(e,t=document.head){const n=this.getStyleSheet(t),{cssRules:r}=n,i=r.length,s="string"==typeof e;if((s?[e]:e).forEach(((e,t)=>n.insertRule(e,t))),r.length>i)return s?r[0]:Array.from(r).slice(0,e.length)}static findRule(e){let t;const n="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),(r=>{if(t=Array.prototype.find.call(r.sheet.rules||r.sheet.cssRules,(t=>n?e(t):t.selectorText===e)),t)return!0})),t}static getStyleSheet(e=document.head){return e.$bryntumStylesheet||(e.$bryntumStylesheet=Yn.createElement({tag:"style",type:"text/css",parent:e}).sheet),e.$bryntumStylesheet}static getCSSVersion(){return getComputedStyle(document.documentElement).getPropertyValue("--bryntum-version").replace(/[" ]/gm,"")}}l.register(Nl),Nl._$name="CSSHelper";var Bl=e=>class extends(e||Qe){static $name="DragHelperContainer";initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!e.target.closest(t.ignoreSelector)){const n=Yn.getAncestor(e.target,t.containers,t.outerElement);if(n){const r=n.getBoundingClientRect();t.context={element:n,position:Yn.getStyleValue(n,"position"),valid:!0,action:"container",offsetX:e.pageX-r.left,offsetY:e.pageY-r.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(e){const t=this,{context:n,floatRootOwner:r}=t,{element:i}=n,s=i.cloneNode(!0),o=null==r?void 0:r.element.closest(".b-outer");s.classList.add(t.dragProxyCls,t.draggingCls),((null==r?void 0:r.floatRoot)||Yn.getRootElement(i)).appendChild(s),n.dragProxy=s,n.dragging=i,i.classList.add(t.dropPlaceholderCls),r&&r.element.classList.add("b-dragging-child"),o&&(s.style.zIndex=r.floatRootMaxZIndex+1)}onContainerDragStarted(e){const t=this,{context:n}=t,{element:r,dragProxy:i}=n,s=r.getBoundingClientRect();if(t.autoSizeClonedTarget)i.style.width=s.width+"px",i.style.height=s.height+"px",Yn.setTranslateXY(n.dragProxy,s.left,s.top);else if(t.useCenteredCursor){const t=i.getBoundingClientRect();Object.assign(n,{offsetX:t.width/2,offsetY:t.height/2}),Yn.setTranslateXY(i,e.clientX,e.clientY)}}updateContainerDrag(e){var t;const n=this,{context:r}=n,{targetElement:i}=r;if(!r.started||!i)return;let s=Yn.getAncestor(i,n.containers);const o=null===(t=r.dragging)||void 0===t?void 0:t.contains(Yn.getActiveElement(r.dragging));s&&Yn.isDescendant(r.element,s)||(o&&ir.suspendFocusEvents(),r.valid&&(s||n.containers.some((e=>e.contains(i))))?(s||(s=n.containers.find((e=>e.contains(i))).lastElementChild),n.moveNextTo(s,e)):n.revertPosition(),o&&ir.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,{context:n}=t,{dragging:r,dragProxy:i,valid:s,draggedTo:o,insertBefore:a,originalPosition:l}=n;r&&(n.valid=Boolean(s&&(o||t.externalDropTargetSelector&&e.target.closest(t.externalDropTargetSelector))&&(r!==a||l.parent!==o)),n.finalize=(e=n.valid)=>{!e&&t.context&&t.revertPosition(),r.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async||n.finalize())}abortContainerDrag(e=!1,t=null,n=!1){const r=this,{context:i}=r;i.dragging&&(i.dragging.classList.remove(r.dropPlaceholderCls),i.dragProxy.remove(),r.revertPosition()),n||r.trigger(e?"drop":"abort",{context:i,event:t}),r.reset()}updateContainerProxy(e){var t,n;const r=this,{context:i}=r,s=i.dragProxy;let o,a=e.pageX-i.offsetX,l=e.pageY-i.offsetY;if("number"==typeof r.minX&&(a=Math.max(r.minX,a)),"number"==typeof r.maxX&&(a=Math.min(r.maxX-s.offsetWidth,a)),"number"==typeof r.minY&&(l=Math.max(r.minY,l)),"number"==typeof r.maxY&&(l=Math.min(r.maxY-s.offsetHeight,l)),r.lockX?Yn.setTranslateY(s,l):r.lockY?Yn.setTranslateX(s,a):Yn.setTranslateXY(s,a,l),"touchmove"===e.type){const t=e.changedTouches[0];o=Yn.elementFromPoint(t.clientX,t.clientY)}else o=e.target;i.targetElement=(null===(t=r.resolveTargetElement)||void 0===t?void 0:t.call(r,o))||o,null!==(n=i.targetElement.nextElementSibling)&&void 0!==n&&n.matches(`.${r.dropPlaceholderCls}`)||(i.insertBefore=i.targetElement.nextElementSibling)}moveNextTo(e,t){const{context:n}=this,r=n.dragging,i=e.parentElement;if(e!==r){const s=Ot.from(e).center.x;if(this.isRTL&&t.pageX>s||!this.isRTL&&t.pageX<s){const s=e.previousElementSibling;i.insertBefore(r,e),n.insertBefore=e,s!==r&&this.trigger("itemMove",{context:n,event:t})}else e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,i.insertBefore(r,e.nextElementSibling),this.trigger("itemMove",{context:n,event:t})):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(i.appendChild(r),this.trigger("itemMove",{context:n,event:t}),n.insertBefore=null);n.draggedTo=i}}revertPosition(){const{context:e}=this,{dragging:t,originalPosition:n}=e,{parent:r,next:i}=n;n.parent===t.parent&&n.prev===t.previousElementSibling&&n.next===t.nextElementSibling||(i?r.insertBefore(t,i):r.appendChild(t),this.trigger("itemMove",{context:e})),e.draggedTo=null}};const zl={pageXOffset:0,pageYOffset:0};var jl=e=>class extends(Hi(e||Qe)){static $name="DragHelperTranslate";static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>t.closest(e.targetSelector))}grabTranslateDrag(e){const t=this.getTarget(e);return!!t&&(this.context={valid:!0,element:t,position:Yn.getStyleValue(t,"position"),startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){const{targetSelector:t,target:n}=this;if(t)return e.target.closest(t);const r=n.isWidget?n.element:n;return r.contains(e.target)?r:null}getX(e){return"absolute"===this.positioning?parseFloat(e.style.left,10):"inset"===this.positioning?parseFloat(getComputedStyle(e).insetInlineStart,10):Yn.getTranslateX(e)}getY(e){return"absolute"===this.positioning?parseFloat(e.style.top,10):"inset"===this.positioning?parseFloat(getComputedStyle(e).top,10):Yn.getTranslateY(e)}getXY(e){if("absolute"===this.positioning)return[e.offsetLeft,e.offsetTop];if("inset"===this.positioning){const t=getComputedStyle(e);return[parseFloat(t.insetInlineStart,10),parseFloat(t.top,10)]}return Yn.getTranslateXY(e)}setXY(e,t,n){this.skipUpdatingElement||("absolute"===this.positioning?(e.style.left=t+"px",e.style.top=n+"px"):"inset"===this.positioning?(e.style.insetInlineStart=t+"px",e.style.top=n+"px"):Yn.setTranslateXY(e,t,n))}startTranslateDrag(e){const t=this,{context:n,outerElement:r,proxySelector:i}=t,s=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body;let o=n.dragProxy||n.element;const a=o,l=o.parentElement;if(t.cloneTarget){const r=i?o.querySelector(i):o;let{width:l,height:d,x:c,y:u}=Ot.from(r,Ot.outer(s));t.isRTL&&o.style.insetInlineStart&&(c=Ot.outer(s).right-Ot.from(o).right),o=t.createProxy(o);let h=c,g=u;if(t.autoSizeClonedTarget&&(o.style.width=`${l}px`,o.style.height=`${d}px`),o.classList.add(t.dragProxyCls,t.draggingCls),o.classList.remove("b-hover","b-selected","b-focused"),s.appendChild(o),!t.autoSizeClonedTarget||i){const t=o.getBoundingClientRect(),{x:r,y:i}=s.getBoundingClientRect(),a=e.clientX-r,l=e.clientY-i+(s!==document.body?document.body.getBoundingClientRect().y:0);h=a-t.width/2,g=l-t.height/2,n.startPageX=e.pageX,n.startPageY=e.pageY}t.setXY(o,h,g),a.classList.add("b-drag-original"),t.hideOriginalElement&&a.classList.add("b-hidden")}o.classList.add(t.draggingCls);const d=t.getX(o),c=t.getY(o);Object.assign(n,{element:o,grabbed:a,grabbedParent:l,grabbedNextSibling:o.nextElementSibling,elementStartX:d,elementStartY:c,elementX:"inset"===t.positioning?d:Yn.getOffsetX(o,s||r),elementY:"inset"===t.positioning?c:Yn.getOffsetY(o,s||r),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||s===r}),s&&(n.parentElement=o.parentElement,s!==o.parentElement&&s.appendChild(o),t.updateTranslateProxy(e))}onTranslateDragStarted(){var e;const t=this,{context:n}=t;let{relatedElements:r}=n;if(t.unifiedProxy&&n.element.classList.add("b-drag-main","b-drag-unified-proxy"),(null===(e=r)||void 0===e?void 0:e.length)>0){n.relatedElStartPos=[],n.relatedElDragFromPos=[];const{proxySelector:e}=t;let[i,s]=[n.elementStartX,n.elementStartY];n.originalRelatedElements=r,r=n.relatedElements=r.map(((r,o)=>{const a=e?r.querySelector(e):r,{x:l,y:d,width:c,height:u}=Ot.from(a,t.dragWithin),h=t.cloneTarget?t.createProxy(r):r;return h.classList.add(t.draggingCls),h.classList.remove("b-hover","b-selected","b-focused"),t.cloneTarget&&(t.setXY(h,l,d),t.dragWithin.appendChild(h),h.classList.add(t.dragProxyCls),t.autoSizeClonedTarget&&(h.style.width=`${c}px`,h.style.height=`${u}px`),t.hideOriginalElement&&r.classList.add("b-hidden"),r.classList.add("b-drag-original")),n.relatedElStartPos[o]=n.relatedElDragFromPos[o]=t.getXY(h),t.unifiedProxy&&(h.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),i+=t.unifiedOffset,s+=t.unifiedOffset,t.setXY(h,i,s),n.relatedElDragFromPos[o]=[i,s],h.style.zIndex=100-o),h})),t.unifiedProxy&&r&&r.length>0&&Jt.onTransitionEnd({element:r[0],property:"transform",handler(){r.forEach((e=>e.classList.remove("b-drag-unified-animation")))},thisObj:t,once:!0})}}applyConstraints(e,t,n){const r=this,{constrain:i,dragWithin:s}=r,{pageXOffset:o,pageYOffset:a}=s===document.body?globalThis:zl;if(s&&i){const i=new Ot(t,n,e.offsetWidth,e.offsetHeight),o=Ot.from(s);"fixed"!==r.context.position&&(o.height=s.scrollHeight,o.width=s.scrollWidth,o.moveTo(0,0)),({x:t,y:n}=i.constrainTo(o))}return"number"==typeof r.minX&&(t=Math.max(r.minX+o,t)),"number"==typeof r.maxX&&(t=Math.min(r.maxX+o,t)),"number"==typeof r.minY&&(n=Math.max(r.minY+a,n)),"number"==typeof r.maxY&&(n=Math.min(r.maxY+a,n)),{constrainedX:t,constrainedY:n}}updateTranslateProxy(e,t){const n=this,{lockX:r,lockY:i,context:s}=n,o=s.dragProxy||s.element,{relatedElements:a,relatedElDragFromPos:l}=s,d=n.isRTL&&"inset"===n.positioning?-1:1;s.scrollManagerElementContainsDragProxy&&t&&(s.scrollX=t.getRelativeLeftScroll(o),s.scrollY=t.getRelativeTopScroll(o)),s.pageX=e.pageX,s.pageY=e.pageY,s.clientX=e.clientX,s.clientY=e.clientY;let c=s.elementStartX+(e.pageX-s.startPageX+s.scrollX)*d,u=s.elementStartY+e.pageY-s.startPageY+s.scrollY;if(n.snapCoordinates){const e=n.snapCoordinates({element:o,newX:c,newY:u});c=e.x,u=e.y}const{constrainedX:h,constrainedY:g}=n.applyConstraints(o,c,u);if((s.started||h!==c||g!==u)&&n.setXY(o,r?void 0:h,i?void 0:g),a){const e=r?0:h-s.elementStartX,t=i?0:g-s.elementStartY;a.forEach(((r,i)=>{const[s,o]=l[i];n.setXY(r,s+e,o+t)}))}s.newX=h,s.newY=g}async finishTranslateDrag(e){const t=this,n=t.context,{target:r}=e,i=!t.lockX&&Math.round(n.newX)!==Math.round(n.elementStartX),s=!t.lockY&&Math.round(n.newY)!==Math.round(n.elementStartY),o=n.dragProxy||n.element,{relatedElements:a}=n;if(!t.ignoreSamePositionDrop||i||s)if(!1===n.valid)await t.abortTranslateDrag(!0,e);else{const i=!t.allowDropOutside&&Ot.from(t.dragWithin||t.outerElement);i&&("number"!=typeof t.minX&&!0!==t.minX&&e.pageX<i.left||"number"!=typeof t.maxX&&!0!==t.maxX&&e.pageX>i.right||"number"!=typeof t.minY&&!0!==t.minY&&e.pageY<i.top||"number"!=typeof t.maxY&&!0!==t.maxY&&e.pageY>i.bottom)?await t.abortTranslateDrag(!0,e):(n.finalize=async(i=n.valid)=>{n.finalized?console.warn("DragHelper: Finalizing already finalized drag"):(n.finalized=!0,!i&&t.context&&await t.abortTranslateDrag(!0,null,!0),t.isDestroyed||(t.trigger("dropFinalized",{context:n,event:e,target:r}),t.reset()),t.cloneTarget||o.parentElement===n.grabbedParent||[o,...a||[]].forEach((e=>e.style.transform="")))},n.async=!1,await t.trigger("drop",{context:n,event:e,target:r}),n.async||await n.finalize())}else t.abortTranslateDrag(!1,e)}async abortTranslateDrag(e=!1,t=null,n=!1){var r,i;const s=this,{cloneTarget:o,context:a,proxySelector:l,dragWithin:d,draggingCls:c}=s,{relatedElements:u,relatedElStartPos:h,grabbed:g}=a,m=a.dragProxy||a.element;if(a.valid=!1,null===(r=s.scrollManager)||void 0===r||r.stopMonitoring(),a.aborted)return void console.warn("DragHelper: Aborting already aborted drag");let{elementStartX:p,elementStartY:f}=a;const v=p!==s.getX(m)||f!==s.getY(m);if(m&&a.started){if(!o&&d&&d!==a.grabbedParent&&a.grabbedParent.insertBefore(m,a.grabbedNextSibling),o&&l){const e=g.querySelector(l)||g,{x:t,y:n}=Ot.from(e);p=t,f=n}if(m.classList.add("b-aborting"),s.setXY(m,p,f),null==u||u.forEach(((e,t)=>{e.classList.remove(c),e.classList.add("b-aborting"),s.setXY(e,h[t][0],h[t][1])})),n||s.trigger(e?"drop":"abort",{context:a,event:t}),m.isConnected&&!s.isDestroying&&v){const e="inset"===s.positioning?"inset":"transform";m.getAnimations().length&&await Jt.waitForTransitionEnd({element:m,property:Yn.getPropertyTransitionDuration(m,e)?e:"all",thisObj:s,once:!0,timeout:300,runOnDestroy:!0})}s.isDestroyed||s.trigger("abortFinalized",{context:a,event:t})}null!==(i=s.context)&&void 0!==i&&i.started&&s.reset()}cleanUp(){const{context:e,cloneTarget:t,draggingCls:n,dragProxyCls:r}=this,i=e.dragProxy||e.element,{relatedElements:s,originalRelatedElements:o,grabbed:a}=e,l=t&&(this.removeProxyAfterDrop||!e.valid),d=[n,"b-aborting",r,"b-drag-main","b-drag-unified-proxy"];i.classList.remove(...d),l&&i.remove(),null==s||s.forEach((e=>{l?e.remove():e.classList.remove(...d)})),a.classList.remove("b-drag-original","b-hidden"),null==o||o.forEach((e=>e.classList.remove("b-hidden","b-drag-original")))}};const Wl="onMouseMove",Ul="onMouseUp",Gl="onDocumentClick",Yl="onTouchMove",ql="onTouchEnd",Kl="onKeyDown",Xl="onKeyDownUp";class Zl extends(Qe.mixin(lt,Bl,jl)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,target:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:200,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,externalDropTargetSelector:null,testConfig:{clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null,resolveTargetElement:null,disabled:!1}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,n={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),Jt.on(n)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let n=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"closed"===t.mode&&(n=e.closest(".b-outer")||n),n}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}onPointerDown(e){const t=this;if(0!==e.button||t.context||t.disabled||t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;t.startEvent=e;if(t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){const n=globalThis;t.blurDetacher=Jt.on({element:n,blur:t.onWindowBlur,thisObj:t});const r={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:Kl,keyup:Xl};if("touch"===e.pointerType?(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"),r.touchmove={handler:Yl,passive:!1},r.touchend=r.pointerup=ql):(r.pointermove=Wl,r.pointerup=Ul),t.dragListenersDetacher=Jt.on(r),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const e=Ot.from(t.dragWithin,t.outerElement);t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}async internalMove(e){var t;if(e.scrollInitiated)return;const n=this,{context:r}=n,i=Jt.getDistanceBetween(n.startEvent,e);if(n.touchStartTimer&&i>n.dragThreshold)n.abort(!0);else if(!n.touchStartTimer&&null!=r&&r.element&&(r.started||i>=n.dragThreshold)&&(null===(t=e.target)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!r.started){var s,o,a;const t=Jt.getXY(n.startEvent),i=Jt.getXY(e),l=Math.abs(t[0]-i[0])>=Math.abs(t[1]-i[1])?"horizontal":"vertical";if(!r.beforeDragStartFired&&!1===n.trigger("beforeDragStart",{context:r,event:e,initialDirection:l}))return n.abort();if(r.beforeDragStartFired=!0,Math.abs(Jt.getDistanceBetween(n.startEvent,e,{x:n.lockY,y:n.lockX}))<n.dragThreshold)return;n.isContainerDrag?n.startContainerDrag(e):n.startTranslateDrag(e),null!==(s=r.dragProxy)&&void 0!==s&&null!==(o=s.closest)&&void 0!==o&&o.call(s,".b-float-root")&&(r.dragProxy.style.fontSize=Yn.getStyleValue(r.element,"fontSize")),r.started=Zl.dragging=!0,null===(a=n.scrollManager)||void 0===a||a.startMonitoring(W.merge({scrollables:[{element:n.dragWithin||n.outerElement}],callback:n.onScrollManagerScrollCallback},n.monitoringConfig)),r.outermostEl=Yn.getOutermostElement(e.target),r.outermostEl.classList.add("b-draghelper-active"),n.dropTargetSelector&&n.dropTargetCls&&Yn.getRootElement(n.outerElement).querySelectorAll(n.dropTargetSelector).forEach((e=>e.classList.add(n.dropTargetCls)));const d=n.trigger("dragStart",{context:r,event:e,initialDirection:l});W.isPromise(d)&&await d,n.onKeyDownUp(e),r.moveUnblocked=!0,n.isContainerDrag?n.onContainerDragStarted(e):n.onTranslateDragStarted(e),n.trigger("afterDragStart",{context:r,event:e,initialDirection:l})}r.moveUnblocked?n._cachedMouseEvent?(n.update(e),n.update(n._cachedMouseEvent),delete n._cachedMouseEvent):n.update(e):n._cachedMouseEvent=e}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:n}=this;null!==(t=this.context)&&void 0!==t&&t.element&&n&&(n.isScroll=!0,this.update(n,e))}onTouchMove(e){var t;1===(null===(t=e.changedTouches)||void 0===t?void 0:t.length)&&(this.context&&!this.touchStartTimer&&e.preventDefault(),this.internalMove(e))}onMouseMove(e){this.internalMove(e)}update(e,t){const n=this,r=document.scrollingElement||document.body,{context:i}=n;let s=n.getMouseMoveEventTarget(e);if("touchmove"===e.type){const t=e.changedTouches[0];s=Yn.getRootElement(e.target).getRootNode().elementFromPoint(t.clientX+r.scrollLeft,t.clientY+r.scrollTop)}i.target=s;let o=n.allowDropOutside||!n.dragWithin||n.dragWithin.contains(e.target);var a;o&&n.dropTargetSelector&&(o=o&&Boolean(null===(a=s)||void 0===a?void 0:a.closest(n.dropTargetSelector)));n.isContainerDrag?n.updateContainerProxy(e,t):n.updateTranslateProxy(e,t),i.valid=o,n.trigger("drag",{context:i,event:e}),n.isContainerDrag&&n.updateContainerDrag(e,t),i.valid=i.valid&&o;for(const e of n.draggedElements)e.classList.toggle(n.invalidCls,!i.valid);e&&(n.lastMouseMoveEvent=e)}get draggedElements(){const{context:e}=this;return[e.dragProxy||e.element,...e.relatedElements??[]]}async abort(e=!1){var t,n;const r=this,{context:i}=r;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.removeListeners(),null!=i&&i.started&&!i.aborted?(i.element.getBoundingClientRect(),i.valid=!1,r.isContainerDrag?r.abortContainerDrag(void 0,void 0,e):r.abortTranslateDrag(void 0,void 0,e),i.aborted=!0):r.reset(!0)}removeListeners(){var e,t;null===(e=this.dragListenersDetacher)||void 0===e||e.call(this),null===(t=this.blurDetacher)||void 0===t||t.call(this)}reset(e){const t=this,{context:n}=t;if(null!=n&&n.started){for(const e of t.draggedElements)e.classList.remove(t.invalidCls);var r;if(n.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag)n.dragProxy.remove(),null===(r=t.floatRootOwner)||void 0===r||r.element.classList.remove("b-dragging-child");else t.cleanUp();t.dropTargetSelector&&t.dropTargetCls&&Yn.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach((e=>e.classList.remove(t.dropTargetCls)))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null,Zl.dragging=!1}onTouchEnd(e){Yn.getOutermostElement(e.target).classList.remove("b-no-touch-scroll"),this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,{context:n}=t;var r;(t.removeListeners(),n)&&(null===(r=t.scrollManager)||void 0===r||r.stopMonitoring(),n.started?n.moveUnblocked?(e.stopPropagation(),n.finalizing=!0,t.isContainerDrag?t.finishContainerDrag(e):t.finishTranslateDrag(e),Jt.on({element:document,thisObj:t,click:Gl,capture:!0,expires:t.clickSwallowDuration,once:!0})):t.ion({drag(){t.onMouseUp(e)},once:!0}):t.reset(!0))}onKeyDown(e){var t;null!==(t=this.context)&&void 0!==t&&t.started&&"Escape"===e.key&&(e.stopImmediatePropagation(),this.abort()),this.onKeyDownUp(e)}onKeyDownUp(e){var t;null===(t=this.context)||void 0===t||t.element.classList.toggle("b-drag-copy",e[c.ctrlKey]||e[c.metaKey])}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return"container"===this.mode}async animateProxyTo(e,t={align:"c-c"}){const{context:n,draggedElements:r}=this,{element:i}=n,s=e.isRectangle?e:Ot.from(e);r.forEach((e=>{e.classList.add("b-drag-final-transition"),Yn.alignTo(e,s,t,void 0,void 0,"inset"===this.positioning?"topInset":"translate")})),await Jt.waitForTransitionEnd({element:i,property:"all",thisObj:this,once:!0}),r.forEach((e=>e.classList.remove("b-drag-final-transition")))}get isDragging(){var e;return Boolean(null===(e=this.context)||void 0===e?void 0:e.started)}getMouseMoveEventTarget(e){return e.isScroll?Yn.elementFromPoint(e.clientX,e.clientY):e.target}}Zl._$name="DragHelper";const Jl=Array.prototype.slice,Ql=Object.freeze([]),ed=Object.freeze({}),td=/[&<]/,{getPrototypeOf:nd}=Object,{toString:rd}=Object.prototype,{isEqual:id,isObject:sd}=W,od={parent:1,elementData:1,ns:1,syncOptions:1},ad=()=>({ignore:od,refsFound:new Set}),ld={class:1,className:1,classname:1},dd={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},cd={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1,retainChildren:1};class ud{static checkEquality(e,t,n,r){if(e===t)return!0;if(null==e)return null==t;if(!e||!t)return!1;const i=typeof e;if(i!==typeof t||dd[i])return!1;let s,o,a,l,d,c,u,h=n.equalityCache||(n.equalityCache=new Map),g=Boolean(r);if(h=h.get(e)||h.set(e,new Map).get(e),s=h.get(t),void 0===s){if(s=!0,nd(e)!==nd(t)||e instanceof Node)s=!1;else if(Array.isArray(e)){if(o=e.length,o!==t.length)s=!1;else for(;o-- >0;)if(!ud.checkEquality(e[o],t[o],n,g)){s=!1;break}}else{var m;for(d in c=e.syncOptions,l=null===(m=c)||void 0===m?void 0:m.ignoreRefs,l&&(g=!0,r="children"!==l),a=n.ignore||ed,t)if(!(a[d]||d in e||r&&"reference"===d)){s=!1;break}if(s)if("[object Date]"===rd.call(t))s=e.getTime()===t.getTime();else if(Yn.isReactElement(e)||Yn.isReactElement(t)||Yn.isVueConfig(e)||Yn.isVueConfig(t))s=!1;else for(d in e)if(!(a[d]||r&&"reference"===d)){if(!(d in t)){s=!1;break}if(u=e[d],!ud.checkEquality(u,t[d],n,g)){s=!1;break}}}var p;if(!r&&sd(e)&&e.reference)null===(p=n.refsFound)||void 0===p||p.add(e.reference);h.set(t,s)}return s}static sync(e){const t=e,{refOwner:n}=e,r=null==n?void 0:n.byRef,i=ad();let s,o,a,l,d=e.affected;if("string"==typeof d&&(d=[d]),e={...e,checkEqualityOptions:i},n){if(n.byRef={},d)for(o in r)d.includes(o)||(n.byRef[o]=r[o]);e.refsWas=r}if(t.changed=ud.performSync(e,e.targetElement),n)for(d||(d=Object.keys(r)),s=0;s<d.length;++s){var c,u;if(o=d[s],a=r[o],i.refsFound.has(o)||a.retainElement)n.byRef[o]=a;else l=a.lastDomConfig,null===(c=(u=a).blur)||void 0===c||c.call(u),a.remove(),n.detachRef(o,a,l)}return e.targetElement}static performSync(e,t){const{domConfig:n,callback:r}=e,{lastDomConfig:i}=t;return(e.configEquality||ud.checkEquality)(n,i,e.checkEqualityOptions,e.ignoreRefs)?(null==r||r({action:"none",domConfig:n,targetElement:t}),!1):(n?(n.onlyChildren||(ud.syncAttributes(n,t,e),ud.syncContent(n,t)),n.keepChildren||ud.syncChildren(e,t)):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=null!=n&&n.onlyChildren&&i?{...i,children:n.children}:n,!0)}static syncDataset(e,t){const{lastDomConfig:n}=t,r=e===n,i=Object.keys(e.dataset),s=n&&n.dataset&&Object.keys(n.dataset),o=nt.delta(i,s);let a,l,d,c;for(l=0;l<o.onlyInA.length;l++)a=o.onlyInA[l],c=e.dataset[a],null!=c&&t.setAttribute(`data-${N.hyphenate(a)}`,c);for(l=0;l<o.inBoth.length;l++)a=o.inBoth[l],c=e.dataset[a],(r||c!=n.dataset[a])&&(d=`data-${N.hyphenate(a)}`,null==c?t.removeAttribute(d):t.setAttribute(d,c));for(l=0;l<o.onlyInB.length;l++)t.removeAttribute(`data-${N.hyphenate(o.onlyInB[l])}`)}static addCls(e,t){const{lastDomConfig:n}=t;(e=Vt.normalize(e,"array")).forEach((e=>{t.classList.add(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)||(i.push(e),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)||r.push(e):r.isDomClassList?r.add(e):W.isObject(r)&&(r[e]=1)})(e,n)}))}static removeCls(e,t){const{lastDomConfig:n}=t;(e=Vt.normalize(e,"array")).forEach((e=>{t.classList.remove(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)&&(i.splice(i.indexOf(e),1),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)&&r.splice(r.indexOf(e),1):r.isDomClassList?r.remove(e):W.isObject(r)&&delete r[e]})(e,n)}))}static syncClassList(e,t,n){let r,i,s,o,a,l,d=e.className||e.class,c=!1;if(n){for(i=Vt.normalize(t,"array"),d=Vt.normalize(d,"object"),l=Vt.normalize(n.className||n.class,"object"),a=[],s=0,o=i.length;s<o;++s)r=i[s],d[r]||!(r in l)?(l[r]=1,a.push(r)):c=!0;for(r in d)l[r]||(a.push(r),c=!0);if(!c)return;d=a.join(" ")}else d=Vt.normalize(d);t.setAttribute("class",d)}static getSyncAttributes(e){const t={},n=[];return e&&Object.keys(e).forEach((r=>{if(!cd[r]){const i=r.toLowerCase();t[i]=e[r],n.push(i)}})),{attributes:t,names:n}}static syncAttributes(e,t,n){const{lastDomConfig:r}=t,i=e===r,s=ud.getSyncAttributes(e),{attributes:o,names:a}=s,{attributes:l,names:d}=i?s:ud.getSyncAttributes(r),{onlyInA:c,onlyInB:u,inBoth:h}=i?{onlyInA:Ql,onlyInB:Ql,inBoth:a}:nt.delta(a,d);let g,m,p=!1;for(m=0;m<c.length;m++){g=c[m];const n=o[g];"style"===g&&null!=n?Yn.applyStyle(t,n,!0):"dataset"===g?ud.syncDataset(e,t):ld[g]?(ud.syncClassList(e,t),p=!0):null!=n&&t.setAttribute(g,n)}for(m=0;m<h.length;m++){g=h[m];const r=o[g],s=l[g];null==r?t.removeAttribute(g):"style"===g?n.strict?i?ud.syncStyles(t,r):id(r,s,!0)||ud.syncStyles(t,r,s):!i&&id(r,s,!0)||Yn.applyStyle(t,r,!0):"dataset"===g?ud.syncDataset(e,t):ld[g]?(ud.syncClassList(e,t,n.strict&&t.lastDomConfig),p=!0):(i||r!==s)&&t.setAttribute(g,r)}for(m=0;m<u.length;m++)g=u[m],ld[g]&&p||t.removeAttribute(g)}static syncStyles(e,t,n){let r,i,s;if(n){if(r={},t=Yn.parseStyle(t),n=Yn.parseStyle(n),t)for(i in t)s=t[i],n[i]!==s&&(r[i]=s);for(i in n)i in t||(r[i]="")}else r=t;Yn.applyStyle(e,r)}static syncContent(e,t){const{html:n,text:r}=e,i=r??n;if(t.didSetTextContent=!1,e.elementData&&(t.elementData=e.elementData),i instanceof DocumentFragment)1===t.childNodes.length&&0===Yn.getChildElementCount(t)&&1===i.childNodes.length&&0===Yn.getChildElementCount(i)?Yn.setInnerText(t,i.firstChild.data):(t.innerHTML="",t.appendChild(i));else if(null!=n&&td.test(n))t.innerHTML=String(n);else if(null!=i){var s;const{lastDomConfig:e}=t;(null!=e&&null!==(s=e.children)&&void 0!==s&&s.length||null!=e&&e.html&&td.test(t.lastDomConfig.html))&&(t.innerHTML=""),Yn.setInnerText(t,String(i)),t.didSetTextContent=!0}}static insertTextNode(e,t,n,r,i=null){const s=document.createTextNode(e);t.insertBefore(s,i),r&&(s.$refOwnerId=r.id),null==n||n({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,n,r,i,s,o){var a;const l=o.ns?document.createElementNS(o.ns,e.tag||"svg"):document.createElement(e.tag||"div");e.elementData&&(l.elementData=e.elementData),t.insertBefore(l,n),ud.performSync(o,l),null!=s&&(i[s]=l),"role"in e||e.tabIndex||e["aria-hidden"]||e.alt||Yn.isFocusable(l,!0)||l.htmlFor||l.setAttribute("role","presentation"),r&&(l.$refOwnerId=r.id,s&&(l.$reference=s,r.attachRef(s,l,e))),null===(a=o.callback)||void 0===a||a.call(o,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,t){let n,r,i,{domConfig:s,syncIdField:o,callback:a,releaseThreshold:l,configEquality:d,ns:c,refOwner:u,refsWas:h,strict:g,checkEqualityOptions:m,ignoreRefs:p}=e,f=null;const v=s.syncOptions||{};if(s.html??s.text)return;p=Boolean(v.ignoreRefs??p),p&&(u=h=null),"strict"in v&&(g=v.strict);const y=u?u.byRef:{},b=Jl.call(s.children||[]),C=Jl.call(t.childNodes),w=h||t.syncIdMap||{},S=t.releasedIdMap||{},D=e=>{for(;C.length&&C[0].parentNode!==t;)C.shift();return(e?C.shift():C[0])||null};o=v.syncIdField||o,g=v.strict||g,a=v.callback||a,d=v.configEquality||d,l="releaseThreshold"in v?v.releaseThreshold:l,o&&(t.syncIdMap=y);const E={checkEqualityOptions:m||ad(),ignoreRefs:p,refOwner:u,refsWas:h,strict:g,syncIdField:o,releaseThreshold:l,callback:a,configEquality:d};for(;b.length;){const l=b.shift();if(i=null,!l)continue;if(Yn.isReactElement(l)||Yn.isVueConfig(l)){a({jsx:l,targetElement:t,domConfig:s});continue}if(Array.isArray(l)){this.syncChildren({...e,domConfig:{...e.domConfig,children:l}},t);continue}if(l instanceof Node){r=D(),l!==r&&t.insertBefore(l,r),n=C.indexOf(l),n>-1&&C.splice(n,1);continue}const d="string"==typeof l;if(E.domConfig=l,E.ns=l.ns||c,!d){if(u?i=l.reference:o&&l.dataset&&(i=l.dataset[o]),null!=i&&!l.unmatched){const e=w[i]||S[i];if(e){const{lastDomConfig:n}=e;if(e.retainElement&&"prevent-release"!==e.retainElement);else if(ud.performSync(E,e)){var x;null===(x=a)||void 0===x||x({action:"reuseOwnElement",domConfig:l,targetElement:e,lastDomConfig:n,syncId:i})}l.retainElement&&(e.retainElement=!0),y[i]=e,nt.remove(C,e),delete S[i],e.isReleased=!1,r=D(),(e.parentNode!==t||g&&e.nextSibling!==r)&&t.insertBefore(e,r)}else g?ud.insertElement(l,t,D(),u,y,i,E):(b.push(l),l.unmatched=!0);continue}l.unmatched&&delete l.unmatched}let h,m=null,p=null;for(;!p&&(h=D(!0));){if(u){if(h.$refOwnerId!==u.id)continue;if(h.$reference){if(!g)continue;m=h;break}p=h}else h.retainElement||(p=h);p||(f||(f=[])).push(h)}if(m||!p)d?ud.insertTextNode(l,t,a,u,m):ud.insertElement(l,t,m,u,y,i,E);else if(d||p.nodeType!==Node.ELEMENT_NODE||(l.tag||"div").toLowerCase()!==p.tagName.toLowerCase())if(d&&p.nodeType===Node.TEXT_NODE)p.data=l;else{var R,T;d?ud.insertTextNode(l,t,a,u,p):ud.insertElement(l,t,p,u,y,i,E),null===(R=(T=p).blur)||void 0===R||R.call(T),p.remove()}else{var M,k;const{lastDomConfig:e}=p,t=ud.performSync(E,p);if(o&&null!=(null==e||null===(M=e.dataset)||void 0===M?void 0:M[o])){const t=e.dataset[o];delete S[t],delete w[t]}null!=i&&(y[i]=p),p.isReleased=!1,t&&(null===(k=a)||void 0===k||k({action:"reuseElement",domConfig:l,targetElement:p,lastDomConfig:e,syncId:i}))}}if(!(t.didSetTextContent&&1===C.length&&C[0].nodeType===Node.TEXT_NODE||s.retainChildren)){for(;r=D(!0);)u&&(r.$refOwnerId!==u.id||r.$reference)||(f||(f=[])).push(r);f&&ud.syncChildrenCleanup(t,f,y,a,u,l,o)}}static syncChildrenCleanup(e,t,n,r,i,s,o){let a,l=0;for(const c of t){const{lastDomConfig:t}=c;var d;if(c.nodeType!==Element.TEXT_NODE)if(c.retainElement)o&&t&&(n[c.dataset[o]]=c);else if(!i&&o&&(null==s||l<s))c.isReleased||(c.className="b-released",c.isReleased=!0,null!=t&&t.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[t.dataset[o]]=c),null==r||r({action:"releaseElement",domConfig:t,lastDomConfig:t,targetElement:c}),t&&(t.isReleased=!0,t.className&&(t.className="b-released"),t.class&&(t.class="b-released"),t.style&&(t.style=null))),l++;else null===(d=c.blur)||void 0===d||d.call(c),c.remove(),i&&(a=c.$reference,a&&i.detachRef(a,c,t)),e.releasedIdMap&&o&&null!=t&&t.dataset&&delete e.releasedIdMap[t.dataset[o]],null==r||r({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c});else c.remove()}}static removeChild(e,t){if(e.contains(t)){const n=e.syncIdMap;if(n){const e=Object.values(n).indexOf(t);e>-1&&delete n[Object.keys(n)[e]]}e.removeChild(t)}}static addChild(e,t,n){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[n]=t}static getChild(e,t){const n=String(t).split(".");for(const t of n){var r;if(!(e=null===(r=e)||void 0===r||null===(r=r.syncIdMap)||void 0===r?void 0:r[t]))return null}return e}}ud._$name="DomSync";class hd{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map((e=>{let n=t+N.capitalize(e);return"moz"===t&&(n=n.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(n="mozCancelFullScreen")),n}));this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const n=["fullscreenchange","fullscreenerror"],r=e=>n.map((t=>e+N.capitalize(t)));this.events="fullscreenEnabled"in document&&n||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullscreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}static get enabled(){return Boolean(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(null==e?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return Boolean(this.element)}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}static onInternalFullscreenChange(e){const t=globalThis.bryntum,{element:n}=hd;if(hd.isFullscreen&&t._floatRoot||!hd.isFullscreen&&!t._floatRoot)return;let r,i;if(n){if(!n.closest(".b-floatroot")){r=Yn.getRootElement(n).floatRoot,r&&(t._floatRoot=r,t._oldParent=r.parentElement,i=n)}}else r=t._floatRoot,i=r&&t._oldParent,t._oldParent=t._floatRoot=null;if(i){const e=Array.from(r.querySelectorAll(".b-widget")).map((e=>oc.fromElement(e)));e.forEach((e=>{var t;return null===(t=e.beforeFloatReparent)||void 0===t?void 0:t.call(e)})),i.appendChild(r),e.forEach((e=>{var t;return null===(t=e.afterFloatReparent)||void 0===t?void 0:t.call(e)}))}ir.trigger("fullScreenChange",{event:e})}}hd.init(),hd._$name="Fullscreen";let gd=null;const md=[],pd=e=>{var t;return e.nodeType===e.ELEMENT_NODE&&"absolute"===(null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(e).getPropertyValue("position"))};class fd{static addResizeListener(e,t){const n=this;if(e!==document&&e!==globalThis||(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)n.hasWindowResizeListener||(globalThis.addEventListener("resize",n.onWindowResize),n.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)n.resizeObserver||(n.resizeObserver=new ResizeObserver(n.onElementResize)),n.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[r,i,s]=Yn.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});i.scrollLeft=i.scrollTop=s.scrollLeft=s.scrollTop=1e6,i.addEventListener("scroll",n.onSizeMonitorScroll,!0),s.addEventListener("scroll",n.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((e=>{const t=[],n=[];for(const r of e)"childList"===r.type&&(t.push.apply(t,r.addedNodes),n.push.apply(n,r.removedNodes));const r=[...t.filter((e=>!n.includes(e))),...n.filter((e=>!t.includes(e)))];0!==r.length&&(r.length>0&&r.every(pd)||i.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=r}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==globalThis||(e=document.body);const n=e._bResizemonitor;let r=0;n&&n.handlers&&(nt.remove(n.handlers,t),r=n.handlers.length),r||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,n=e._bResizemonitor,r=t.contentRect||e.getBoundingClientRect();if(Ln(e)&&(!n.rectangle||r.width!==n.rectangle.width||r.height!==n.rectangle.height)){const t=n.rectangle;n.rectangle=r;for(const i of n.handlers)i(e,t,r)}}}static onSizeMonitorScroll(e){var t;if(e.target.isConnected||null!==(t=document.body)&&void 0!==t&&t.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,n=t.parentNode,r=n._bResizemonitor,i=n.getBoundingClientRect();r.rectangle&&i.width===r.rectangle.width&&i.height===r.rectangle.height||(md.push([n,r.rectangle,i]),r.rectangle=i,gd||(gd=requestAnimationFrame(fd.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,n=t._bResizemonitor,r=n.rectangle;n.rectangle=document.documentElement.getBoundingClientRect();for(const e of n.handlers)e(t,r,n.rectangle)}static fireResizeEvents(){for(const e of md)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);gd=null,md.length=0}static removeGlobalListeners(){globalThis.removeEventListener("resize",this.onWindowResize)}}fd._$name="ResizeMonitor";const vd={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:c.supportsOverflowClip?"clip":"hidden"},yd="b-widget-scroller",bd={block:"nearest"},Cd=Promise.resolve(),wd=e=>new Promise((t=>Jt.on({element:e===document.documentElement?globalThis:e,scroll:t,once:!0}))),Sd={x:1},Dd={auto:1,scroll:1},Ed={true:1,auto:1},xd={overflowX:"auto",overflowY:"auto"},Rd={start:"top",end:"bottom"},Td={start:"end",end:"start",top:"bottom",bottom:"top"};class Md extends(Hi(lt(Qe))){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,behavior:null,x:0,y:0,rtlSource:null,propagateSync:null,stickies:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}syncOverflowState(){const e=this,{hasOverflowX:t,hasOverflowY:n,element:r}=e,i=e.hasOverflowX=r.scrollWidth>r.clientWidth,s=e.hasOverflowY=r.scrollHeight>r.clientHeight;if(t!==i||n!==s){const t=new Vt(r.classList,{"b-horizontal-overflow":i,"b-vertical-overflow":s});Yn.syncClassList(r,t),e.isConfiguring||e.trigger("overflowChange",{x:i,y:s})}}hasOverflow(e="y"){const t=this,n=t[`overflow${e.toUpperCase()}`],r=t["overflow"+("y"===e?"x":"y")];if(!Yn.scrollBarWidth||!Ed[n]||"hidden-scroll"===r){const n="y"===e?"Height":"Width";return t[`scroll${n}`]>t[`client${n}`]}return t[`hasOverflow${e.toUpperCase()}`]}hasScrollbar(e="y"){const{element:t}=this;if(t&&Yn.scrollBarWidth){const n="y"===e,r=n?"Width":"Height",i=t[`client${r}`],s=parseInt(Yn.getStyleValue(t,`border${n?"Left":"Top"}Width`))+parseInt(Yn.getStyleValue(t,`border${n?"Right":"Bottom"}Width`)),o=t[`offset${r}`]-s-i;return Math.abs(o-Yn.scrollBarWidth)<2}}addPartner(e,t=Sd){const n=this;"string"==typeof t&&(t={[t]:1}),n.partners||(n.partners={}),n.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=n.x),t.y&&(e.y=n.y),e.isPartneredWith(n)||e.addPartner(n,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){e&&this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var t;return Boolean(null===(t=this.partners)||void 0===t?void 0:t[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach((e=>e.scroller.removePartner(this)))}async scrollIntoView(e,t=bd){const n=this,{isRectangle:r}=e,i=r?e:Ot.from(e),{xDelta:s,yDelta:o}=n.getDeltaTo(e,t),a=n.scrollBy(s,o,t);return(t.highlight||t.focus)&&a.then((()=>{var a;e=r?i.translate(-s,-o):(null===(a=t.elementAfterScroll)||void 0===a?void 0:a.call(t))??e,t.highlight&&(isNaN(t.highlight)?(n.widget||n).callback(t.highlight,null,[e]):Yn.highlight(e,n)),t.focus&&e.focus({preventScroll:!0})})),a}static async scrollIntoView(e,t=bd,n=!1){const r=Ot.from(e),i="object"==typeof t?t.animate:t,s=Md._globalScroller||(Md._globalScroller=new Md),o=[];s.rtlSource={rtl:n};let a,l=0,d=0;t.maxWidth&&(r.width=Math.min(r.width,t.maxWidth),t.maxWidth=null),t.maxHeight&&(r.height=Math.min(r.height,t.maxHeight),t.maxHeight=null);for(let n=e.parentNode;n.nodeType===Node.ELEMENT_NODE;n=n.parentNode){if(n===document.body&&n!==document.scrollingElement)continue;const e=n===document.scrollingElement?xd:n.ownerDocument.defaultView.getComputedStyle(n),i=Vl.get(n,"scroller");if(!1!==t.y&&(null!=i&&i.hasOverflowY||Dd[e.overflowY]&&n.scrollHeight>n.clientHeight)||!1!==t.x&&(null!=i&&i.hasOverflowX||Dd[e.overflowX]&&n.scrollWidth>n.clientWidth)){let e=s;i?e=i:(s.element=n,s.positionDirty=!0);const{xDelta:a,yDelta:c}=e.getDeltaTo(r,t);(a||c)&&(o.push({element:n,x:n.scrollLeft,y:n.scrollTop,xDelta:a,yDelta:c}),r.translate(-a,-c),l+=a,d+=c)}}if(o.length){const e=Math.abs(l),t=Math.abs(d);let r=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(r&&(e>10||t>10))Math.max(e,t)<50&&(r=Math.min(r,500)),a=s.scrollAnimation=ee.animate(r,(e=>{const t=1===e;for(const{element:r,x:i,y:a,xDelta:l,yDelta:d}of o)s.element=r,l&&(s.x=Math[n?"min":"max"](i+(t?l:Math.round(l*e)),0)),d&&(s.y=Math.max(a+(t?d:Math.round(d*e)),0))}),null,i.easing),a.then((()=>{s.scrollAnimation=null}));else if(e>=1||t>=1){for(const{element:e,xDelta:t,yDelta:n}of o)e.scrollTop+=n,e.scrollLeft+=t;a=wd(o[o.length-1].element)}}return(t.highlight||t.focus)&&(await a,t.highlight&&(isNaN(t.highlight)?s.callback(t.highlight,null,[e]):Yn.highlight(e,s)),t.focus&&e.focus({preventScroll:!0})),a}scrollBy(e=0,t=0,n=bd){const r=this,i="object"==typeof n?n.animate:n,s=Math.abs(e),o=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=n.silent);let a=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(a&&(s>10||o>10)){const{x:l,y:d}=r;let c=l,u=d;return Math.max(s,o)<50&&(a=Math.min(a,500)),r.scrollAnimation=ee.animate(a,(i=>{const s=1===i;if(e){var o;if(Math.abs(r.x-c)>1&&!n.force)return null===(o=r.scrollAnimation)||void 0===o?void 0:o.cancel();r.x=Math.max(l+(s?e:Math.round(e*i)),0)}if(t){var a;if(Math.abs(r.y-u)>1&&!n.force)return null===(a=r.scrollAnimation)||void 0===a?void 0:a.cancel();r.y=Math.max(d+(s?t:Math.round(t*i)),0)}c=r.x,u=r.y}),r,i.easing),r.element.classList.add("b-scrolling"),r.scrollAnimation.then((()=>{r.isDestroyed||(r.element.classList.remove("b-scrolling"),r.scrollAnimation=null)})),r.scrollAnimation}if(e||t){const n=r.x,i=r.y;if(Math.round(s)>=1&&(r.x+=e),Math.round(o)>=1&&(r.y+=t),r.x!==n||r.y!==i)return wd(r.element)}return Cd}async scrollTo(e,t,n){const{x:r,y:i}=this,s=null==e?0:e-r,o=null==t?0:t-i;return this.scrollingToCenter=null==n?void 0:n.scrollingToCenter,this.scrollBy(s,o,n)}doDestroy(){var e;const t=this;var n;t._element&&(t._element.removeEventListener("scroll",t.scrollHandler),null===(n=t.wheelListenerRemover)||void 0===n||n.call(t),t._contentElement&&fd.removeResizeListener(t.contentElement,t.resizeHandler),fd.removeResizeListener(t._element,t.resizeHandler));null===(e=t.scrollAnimation)||void 0===e||e.cancel(),Object.values(t.partners||{}).forEach((({scroller:e})=>e.removePartner(t))),super.doDestroy()}onElMutation(e){const t=this,[n,r]=Yn.getTranslateXY(t.element);if(t._x!==-n||t.y!==-r){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onElResize(){const e=this,{widget:t}=e;null!=t&&t.isAnimating?-1===t.findListener("animationend","onElResize",e)&&t.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){var t;const n=this,{element:r}=n;null!==(t=n.widget)&&void 0!==t&&t.isDestroyed||(n.positionDirty=!0,r.classList.contains("b-scrolling")||r.classList.add("b-scrolling"),e.widget=n.widget,e.scrollingToCenter=n.scrollingToCenter,n.silent||n.trigger("scroll",e),n.syncPartners(),n.controllingPartner=null,n.onScrollEnd(e))}syncPartners(e,t=this.propagateSync){const n=this;n.partners&&Object.values(n.partners).forEach((({axes:r,scroller:i})=>{(i!==n.controllingPartner||e)&&i.sync(n,r)&&t&&i.syncPartners(e,t)}))}onScrollEnd(e){const t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.scrollingToCenter=!1,t.controllingPartner=null,t.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const n=this;if(!n.viewport)return{xDelta:0,yDelta:0};const{x:r,y:i,scrollWidth:s,scrollHeight:o,isRTL:a}=n,l=e instanceof Ot?e:Ot.from(e),d=t.block||"nearest",c=n.viewport,u=(e=>{let t,n,r,i;return e?"number"==typeof e?t=n=r=i=e:(t=e.top??0,n=e.bottom??0,r=e.start??0,i=e.end??0):t=n=r=i=0,{top:t,bottom:n,start:r,end:i}})(t.edgeOffset);t.maxWidth&&(l.x<c.x?(l.x=l.right-t.maxWidth,u.start=0):(l.width=Math.min(l.width,t.maxWidth),u.end=0)),t.maxHeight&&(l.y<c.y?(l.y=l.bottom-t.maxHeight,u.top=0):(l.height=Math.min(l.height,t.maxHeight),u.bottom=0));const h="start"===d||"end"===d,g=h?{[d]:u[d],[Td[d]]:0}:c.width>=l.width+(u.start+u.end)?u:{start:0,end:0},m=h?{[Rd[d]]:u[Rd[d]],[Td[Rd[d]]]:0}:c.height>=l.height+(u.top+u.bottom)?u:{top:0,bottom:0},p=new Ot(a?c.right+r-s:c.x-r,c.y-i,s,o),f=l.clone().adjust(-g.start,-m.top,g.end,m.bottom,!0).constrainTo(p),v=f.clone(),y=n.isRTL?-1:1;let b=0,C=0;if("start"===d)v.moveTo(c.x+(n.isRTL?c.width-v.width:0),c.y),b=f.x-v.x,C=f.y-v.y;else if("end"===d)v.moveTo(c.x+(n.isRTL?0:c.width-v.width),c.bottom-v.height),b=f.x-v.x,C=f.y-v.y;else if("center"===d){const e=c.center;v.moveTo(e.x-v.width/2,e.y-v.height/2),b=b||f.x-v.x,C=C||f.y-v.y}else v.width>c.width?b=v.x-c.x:v.right>c.right?b=v.right-c.right:v.x<c.x&&(b=v.x-c.x),v.height>c.height?C=v.y-c.y:v.bottom>c.bottom?C=v.bottom-c.bottom:v.y<c.y&&(C=v.y-c.y);return b=y*Math.round(b),C=Math.round(C),!1!==t.constrainToScrollable&&(b=Math.max(Math.min(b,Math.max(n.maxX-r,0)),-r),C=Math.max(Math.min(C,Math.max(n.maxY-i,0)),-i)),{xDelta:!1===t.x?0:b,yDelta:!1===t.y?0:C}}get viewport(){const e=this.stickies?nt.asArray(this.stickies).flatMap((e=>"string"==typeof e?Array.from(this.element.querySelectorAll(e)):e)):null,t=Ot.client(this.element);return e?t.exclude(e.map((e=>Ot.from(e)))):t}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,t){const n=this;if(n===Md._globalScroller)return n._element=e,void(n.positionDirty=!0);const r=n.scrollHandler||(n.scrollHandler=n.onScroll.bind(n)),i=n.resizeHandler||(n.resizeHandler=n.onElResize.bind(n));if(t){var s;if(Vl.remove(t,"scroller"),n.translate)null===(s=n.mutationObserver)||void 0===s||s.disconnect();else t.removeEventListener("scroll",r),t.classList.remove(yd),t.style.overflowX=t.style.overflowY="";fd.removeResizeListener(t,i)}if(e){if(Vl.set(e,"scroller",n),n.translate){if(n.mutationObserver||(n.mutationObserver=new MutationObserver(n.mutationHandler||(n.mutationHandler=n.onElMutation.bind(n)))),n._x=n._y=0,document.contains(e)){const[t,r]=Yn.getTranslateXY(e);n._x=-t,n._y=-r}n.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",r),e.classList.add(yd);fd.addResizeListener(e,i),n.widget||(n.rtlSource={get rtl(){return"rtl"===Yn.getStyleValue(e,"direction")}}),n.isRTL&&e.classList.add("b-rtl"),n.positionDirty&&(n.updateOverflowX(n.overflowX),n.updateOverflowY(n.overflowY)),n.syncOverflowState(),n.isConfiguring&&(n._x&&n.updateX(n._x),n._y&&n.updateY(n._y))}n.positionDirty=!0}get unsynced(){const e=this,[t,n]=e.xy;return e._x!==t||e._y!==n}get xy(){const{element:e}=this;let t,n;return e&&(this.translate?([t,n]=Yn.getTranslateXY(e),t=-t,n=-n):(t=Math.abs(e.scrollLeft),n=e.scrollTop)),[t,n]}refreshPosition(){const e=this,[t,n]=e.xy;e._x=t,e._y=n,e.positionDirty=!1}fixPositionSync(){const e=this,{element:t,xy:n,_x:r,_y:i}=e;e.positionDirty||r===n[0]&&i===n[1]||(e.translate?(Yn.setTranslateX(t,-r),Yn.setTranslateY(t,-i)):t.scrollTo({behavior:"instant",left:e.isRTL?-r:r,top:i}))}get x(){return this.positionDirty&&this.refreshPosition(),this._x}get scrollLeft(){return this.x*(this.isRTL?-1:1)}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e="string"==typeof e?this.element.querySelector(e):e,fd.addResizeListener(e,this.resizeHandler))}updateX(e){var t;const n=this,{behavior:r,element:i}=n;!i||null!==(t=n.widget)&&void 0!==t&&t.isConfiguring||(e=Math.round(e),n.trigger("scrollStart",{x:e}),n.translate?Yn.setTranslateX(i,-e):r?i.scrollTo({behavior:r,left:n.isRTL?-e:e}):i.scrollLeft=n.isRTL?-e:e),n.positionDirty=!0}sync(e,t){const n=this,{x:r,y:i}=t;let s=!1;return r&&n.x!==e.x&&(n.controllingPartner=e,n.x=e.x,s=!0),i&&n.y!==e.y&&(n.controllingPartner=e,n.y=e.y,s=!0),s}get y(){return this.positionDirty&&this.refreshPosition(),this._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const t=this,{behavior:n,element:r,widget:i}=t;!r||null!=i&&i.isConfiguring||(t.trigger("scrollStart",{y:e}),t.translate?Yn.setTranslateY(r,-e):n?r.scrollTo({behavior:n,top:e}):r.scrollTop=e),t.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,t){const n=this,{element:r,translate:i}=n,{style:s,classList:o}=r;if("hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"===e&&!i){Dd[n.overflowY]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll")}i||(s.overflowX=vd[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}updateOverflowY(e,t){const n=this,{element:r,translate:i}=n,{style:s,classList:o}=r;if("hidden-scroll"===t&&o.remove("b-hide-scroll"),"hidden-scroll"===e&&!i){Dd[n.overflowX]?(e="hidden",n.enableWheel()):o.add("b-hide-scroll")}i||(s.overflowY=vd[e]||e),n.isConfiguring||(n.positionDirty=!0,n.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=Jt.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){const t=this,{overflowX:n,overflowY:r}=t,i=e.deltaX,s=e.deltaY,o=Math.abs(i)-Math.abs(s);"hidden-scroll"===n&&Dd[r]&&o>0?t.x+=i:"hidden-scroll"===r&&Dd[n]&&o<0&&(t.y+=s)}get scrollWidth(){var e;return(null===(e=this.element)||void 0===e?void 0:e.scrollWidth)??0}set scrollWidth(e){const t=this,{element:n,isRTL:r}=t;let i=t.widthStretcher;i&&null==e?(i.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),i||(i=t.widthStretcher=Yn.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",role:null,retainElement:!0})),i.style.transform=`translateX(${(e-1)*(r?-1:1)}px)`,n&&!n.contains(i)&&n.insertBefore(i,n.firstElementChild)),n.style.setProperty("--scroll-width",Yn.setLength(e)),!1!==t.propagate&&t.eachPartner((({scroller:t})=>{t.propagate=!1,t.scrollWidth=e,delete t.propagate})),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){var e;return(null===(e=this.element)||void 0===e?void 0:e.scrollHeight)??0}set scrollHeight(e){const t=this,n=t.stretcher||(t.stretcher=Yn.createElement({className:"b-scroller-stretcher",role:null}));n.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n),t.positionDirty=!0,t.syncOverflowState()}get clientWidth(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientWidth)||0}get clientHeight(){var e;return(null===(e=this.element)||void 0===e?void 0:e.clientHeight)||0}get id(){return this._id||(this._id=eo.generateId(this.widget?`${this.widget.id}-`:"scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}}Md._$name="Scroller";const kd=/\/[^/]+\//,Fd={};var Id=e=>class extends(e||Qe){static $name="KeyMap";static configurable={keyMap:{value:null,$config:{merge:"objects",nullify:!0}}};get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}addKeyBinding(e,t){const n=this.keyMap,r=this.mergeKeyMaps({[e]:null==n?void 0:n[e]},{[e]:t})[e];n?n[e]=r:this.keyMap={[e]:r}}removeKeyBinding(e,t){var n;const r=null===(n=this.keyMap)||void 0===n?void 0:n[e];if(r){let n=0;Array.isArray(r)?(n=r.findIndex((e=>e===t||e.handler===t)),n>-1&&r.splice(n,1)):r!==t&&r.handler!==t||delete this.keyMap[e]}}matchKeyMapEntry(e,t=this.keyMap){const{input:n}=this,{altKey:r,ctrlKey:i,metaKey:s,shiftKey:o,target:a}=e;return!(1!==e.key.length||r||i||s||o||n&&e.composedPath().includes(n)||!Yn.isEditable(a,!0))||(t&&!e.handled&&void 0!==e.key?W.keys(t).find((t=>{const n="+"===t?[]:t.toLowerCase().split("+"),a=t.endsWith("+")?"+":n.pop(),l="space"===a?" ":a,d=n.includes("alt"),c=n.includes("ctrl"),u=n.includes("meta"),h=n.includes("shift"),g=kd.test(l)&&(Fd[l]||(Fd[l]=new RegExp(l.substring(1,l.length-1))));return(g?g.test(e.key.toLowerCase()):l===e.key.toLowerCase())&&(d?r:!r)&&(c?i:!i)&&(u?s:!s)&&(h?o:!o)})):void 0)}async performKeyMapAction(e){const t=this,{keyMap:n}=t;let r,i,s,o,a=!1;if(n&&!e.handled&&void 0!==e.key){const h=t.matchKeyMapEntry(e);if(n[h]){const i=nt.asArray(n[h]);for(r of(e.fromKeyMap=!0,e.widget=this,i)){if(o=!0,W.isObject(r)){if(!r.handler)continue;!1===r.preventDefault&&(o=!1),r=r.handler}if("string"==typeof r){var l;const{thisObj:n,handler:i}=t.resolveKeyMapAction(r);if(!1!==(null===(l=n.isActionAvailable)||void 0===l?void 0:l.call(n,{key:h,action:r,event:e,actionName:r.split(".").pop()}))){let t=i.call(n,e);if(W.isPromise(t)&&(t=await t),!1!==t){a=!0;break}}}else if(!1!==r.call(t,e)){a=!0;break}}a&&(o&&e.preventDefault(),e.handled=!0)}if(!a){if(s=W.getTruthyKeys(n.delegate))for(i of s){var d,c;if(i=W.getPath(t,i),a=null===(d=i)||void 0===d||null===(c=d.performKeyMapAction)||void 0===c?void 0:c.call(d,e),W.isPromise(a)&&(a=await a),a)break}var u;if(!a)null===(u=t.defaultKeyHandler)||void 0===u||u.call(t,e)}}return a}resolveKeyMapAction(e){const t=this,{keyMapSubComponents:n}=t;if(e.startsWith("up.")||e.startsWith("this."))return t.resolveCallback(e);if(n&&e.includes(".")){const[t,r]=e.split(".");if(t&&r)return{thisObj:n[t],handler:n[t][r]}}return{thisObj:t,handler:t[e]}}updateKeyMap(e){var t;const n=this,r=W.keys(e);null===(t=n.keyMapDetacher)||void 0===t||t.call(n),n.keyMapDetacher=r.length?Jt.on({element:n.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:n}):null}keyMapOnKeyDown(e){this.performKeyMapAction(e)}mergeKeyMaps(e,t,n=null){const r={};e&&W.assign(r,e);for(const i in t){if(!t[i])continue;const s=nt.asArray(null==e?void 0:e[i]),o=[];if(null!=s&&s.length&&o.push(...s),null==s||!s.some((e=>{const t=e.handler?e.handler:e;return"string"==typeof t&&t.startsWith(n+".")}))){for(const e of nt.asArray(t[i]))W.isObject(e)&&e.handler?o.push(W.assignIf({handler:(n?n+".":"")+e.handler},e)):"function"==typeof e?o.push(e):o.push((n?n+".":"")+e);o.sort(((e,t)=>{const n=(e.weight||0)-(t.weight||0);return 0===n&&null!=s&&s.length?s.indexOf(e)-s.indexOf(t):n}))}r[i]=o}return r}},Ad=e=>class extends(e||Qe){static $name="RTL";get widgetClass(){}static configurable={rtl:null};get isRTL(){return this.rtl}updateRtl(e){const{element:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}startConfigure(e){var t;if(null===(t=super.startConfigure)||void 0===t||t.call(this,arguments),!e.floating&&null==e.rtl){var n;const t=this,r=e.rootElement||e.forElement||(null===(n=t.parent)||void 0===n?void 0:n.contentElement)||(t.floating?t.floatRoot:t.changeElementRef(t.getRenderContext(e)[0]||e.adopt));if(r)e.rtl=1===r.nodeType&&"rtl"===getComputedStyle(r).getPropertyValue("direction");else{const t=e.owner||e.parent;e.rtl=t?t[t.isConfiguring?"peekConfig":"getConfig"]("rtl"):"rtl"===getComputedStyle(document.body).getPropertyValue("direction")}e.rtl&&(t.configDone.rtl=!1)}}render(...e){var t,n,r;(null===(t=super.render)||void 0===t||t.call(this,...e),(c.isChrome&&c.chromeVersion<87||c.isFirefox&&c.firefoxVersion<66||c.isSafari&&c.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),"rtl"===getComputedStyle(this.element).direction||null!==(n=this.owner)&&void 0!==n&&n.rtl)&&(this.rtl=!0,null===(r=this.childItems)||void 0===r||r.forEach((e=>e.rtl=!0)))}};const Ld=Object.freeze({highlight:!1,onlyName:!1}),Pd=Object.freeze([]),Od=Object.freeze({sync:!1}),$d=[],_d=["clip","display","opacity"],Hd="highlightExternalChange",Vd=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Nd=Symbol("renderConfigObserver"),Bd=/<div|<button|<input|<p|<br|<li/,zd=(e,t,n,r)=>{var i;let s=(null==n?void 0:n.listeners)||(null==n?void 0:n.internalListeners);if(s=(null===(i=s)||void 0===i?void 0:i.on)||s,s){const i=Jt.on(W.assign({element:t,thisObj:e},s));r?(e._refListeners||(e._refListeners=Object.create(null)))[r]=i:n.listeners={on:s,un:i}}},jd=(e,t)=>e&&t&&t[W.keys(e)[0]]?ke.merge(e,t):e,Wd=e=>{e.isVisible&&e.triggerPaint()},Ud=/^:not\((.+)\)$/,Gd=/absolute|fixed/i,Yd=e=>null!=e.scale,{hasOwn:qd}=W,{defineProperty:Kd}=Reflect,Xd=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),Zd=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],Jd={configurable:!0,value:!1},Qd=/(?:L\{([ \w.]+?)\})/,ec=/^([trblc])(\d*)-([trblc])(\d*)$/i,tc=(e,t)=>(ec.test(e)&&(e={align:e}),ec.test(t)&&(t={align:t}),ke.merge(e,t)),nc=/^[\w.]+$/,rc={1:"maxHeight",2:"height",4:"maxWidth",8:"width"},ic=e=>!e.isRipple&&!e.closest((e=>e.isMessageDialog||e.isSharedTooltip)),sc=e=>"contents"===Yn.getStyleValue(e,"display")?sc(e.parentNode):e;class oc extends(Qe.mixin(Tr,lt,Hi,Xi,ds,Id,Ad)){static mergeCls(e,t){return t&&e?e=new Vt(t).assign("string"==typeof e?new Vt(e):e):e&&!e.isDomClassList&&(e=new Vt(e)),e}static $name="Widget";static type="widget";static convertPinchToMousewheel=!0;static get configurable(){return{element:!0,callOnFunctions:!0,hideMode:{$config:null,default:"display"},id:null,html:{$config:"lazy",value:null},content:{$config:"lazy",value:null},cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},floating:null,positionable:null,positioned:null,draggable:{$config:["lazy","nullify"],value:null},align:{$config:{merge:tc},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:{$config:["lazy","nullify"],value:null},scrollAction:null,hideAnimation:{$config:{merge:jd},value:null},showAnimation:{$config:{merge:jd},value:null},top:null,right:null,bottom:null,left:null,x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:Md,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription","dataset.text"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:{lazy:!0,default:null},value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaLive:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50},maximizeOnMobile:null,twinForwardEvents:{$config:{merge:"classList"},value:null},twinSyncConfigs:{$config:{merge:"classList"},value:["disabled"]}}}static get prototypeProperties(){return{hasGeneratedId:!1,hasPainted:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return oc._recomposeAsync}static set recomposeAsync(e){if(oc._recomposeAsync=e,null!=e){const{all:t}=oc;for(let n=0;n<t.length;++n)t[n].isComposable&&(t[n].recomposeAsync=e)}}updateWeight(){var e,t;this.isPainted&&(null===(e=this.parent)||void 0===e||null===(t=e.onChildWeightChange)||void 0===t||t.call(e,this))}isA(e){return this.isType(e,!0)}isType(e,t){return oc.isType(this,e,t)}static setupRenderConfigs(e,t){const n=t.getInherited("renderConfigs"),{renderConfigs:r}=e;if(r){if(Array.isArray(r))for(const e of r)n[e]=!0;else W.assign(n,r);n[Nd]=null}}static weightSortFn({weight:e},{weight:t}){return"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):(e??Number.MAX_SAFE_INTEGER)-(t??Number.MAX_SAFE_INTEGER)}construct(e={},...t){const n=this,{domSyncCallback:r}=n,{recomposeAsync:i}=oc;if(null!=i&&null==n.recomposeAsync&&(n.recomposeAsync=i),!globalThis.bryntum.cssVersion){const e=globalThis.bryntum.cssVersion=Nl.getCSSVersion(),t=G.getVersion("core");e&&e!==t&&console.warn(`CSS version ${e} doesn't match bundle version ${t}!\nMake sure you have imported css from the appropriate product version.`)}n.configureAriaDescription=e.ariaDescription,n._isAnimatingCounter=0,n.alignmentChanges=0,n.byRef=Object.create(null),n.onTargetResize=n.onTargetResize.bind(n),n.onFullscreenChange=n.onFullscreenChange.bind(n),n.domSyncCallback=r.$nullFn?null:r.bind(n),n._isUserAction=!1,super.construct(e,...t),n.finalizeInit()}startConfigure(e){super.startConfigure(e),this.getConfig("element")}finalizeInit(){const e=this,{adopt:t}=e,n=e.insertBefore||e.appendTo||e.insertFirst||t,{classList:r}=e.element;var i;(e.getConfig("html","content"),n)&&(t&&(r.remove("b-hidden"),e._hidden=!1),e.owner||null!==(i=n.nodeType?n:document.getElementById(n))&&void 0!==i&&i.isConnected?e.render():(e.onFirstResizeAfterConnect=e.onFirstResizeAfterConnect.bind(e),fd.addResizeListener(n,e.onFirstResizeAfterConnect)));r.remove("b-initializing")}onFirstResizeAfterConnect(e){fd.removeResizeListener(e,this.onFirstResizeAfterConnect),this.isDestroyed||this.rendered||this.render()}doDestroy(){var e,t;const n=this,{preExistingElements:r,element:i,adopt:s,_refListeners:o,_rootElement:a,eventRoot:l,ownedWidgets:d,parent:c}=n;if(n.updateOwner(null,n.owner),hd.element===i&&hd.exit(),o&&(Object.values(o,(e=>e())),n._refListeners=null),i){var u;const e=!n._tooltip&&a&&(null===(u=oc.Tooltip)||void 0===u?void 0:u.getSharedTooltip(a,l,!0));if((null==e?void 0:e.owner)===n&&(e.owner=null,e.hide()),n.onExitFullscreen(),n.clearTimeout("scrollListenerTimeout"),n.clearTimeout("resizeListenerTimeout"),n.removeTransientListeners(),n.floating||n.positioned||n.positionable?n.isPainted&&n.hide(!1):n.revertFocus(),fd.removeResizeListener(i.parentElement,n.onParentElementResize),fd.removeResizeListener(i,n.onElementResize),s){for(let e=Array.from(i.childNodes),t=0,{length:s}=e;t<s;t++){const i=e[t];r.includes(i)||i===n.floatRoot||i.remove()}i.className=n.adoptedElementClassName,i.style.cssText=n.adoptedElementCssText}}null===(e=n.connectedObserver)||void 0===e||e.disconnect(),(null==c?void 0:c.isContainer)&&!c.isDestroying&&(null===(t=c._items)||void 0===t?void 0:t.includes(n))&&c.remove(n),super.doDestroy(),d&&Object.values(d).forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),l&&Promise.resolve().then((()=>{Object.values(oc.identifiable.idMap).some(ic)||ir.detachFocusListeners(l)})),s||i.remove()}get assignValueDefaults(){return Ld}get valueName(){return this.name||this.ref||this.id}getValueName(e){return(e=e&&"object"==typeof e?e.onlyName:e)?this.name:this.valueName}assignFieldValue(e,t,n){const r=this,i=r.defaultBindProperty;i in r&&(r[i]=n)}assignValue(e,t=Ld){const n=this,r=n[Hd],i=n.getValueName(t);!i||e&&!(i in e)||(!1===t.highlight&&(n[Hd]=!1),n.assignFieldValue(e,i,e?e[i]:null),n[Hd]=r)}gatherValue(e){const t=this,n=t.defaultBindProperty;t.constructor!==oc&&n in t&&(e[t.name||t.ref||t.id]=t[n])}gatherValues(e){this.eachWidget((t=>t.gatherValue(e)),!1)}addToOverflowMenu(e,t,n){const r=this.ensureOverflowTwin(t,n);return e.items.push(r),r}get twinForwardEventPairs(){const e=this._twinForwardEvents;return e?W.entries(e):Pd}configureOverflowTwin(e){const t=this,{twinSyncConfigs:n}=t;let r,i,s=W.clone(t.initialConfig);if(delete s.id,delete s.listeners,delete s.internalListeners,delete s.parent,s.hidden=!1,s.type=t.type,s._overflowTwinOrigin=t,s.owner=t.owner,t.twinForwardEventPairs.forEach((([e])=>{delete s[`on${N.capitalize(e)}`]})),n)for(r in n)i=n[r],i&&(delete s[r],s["string"==typeof i?i:r]=t[r]);return e&&(s="function"==typeof e?e(s)||s:W.assign(s,e)),s}createOverflowTwin(e){const t=this,n=t.configureOverflowTwin(e),r=oc.create(n),{twinSyncConfigs:i}=t;return i&&t.bindConfigs(r,i,Od),t.twinForwardEventPairs.forEach((([e,n])=>{r.ion({[e]:e=>{t.overflowTwin===e.source&&(delete(e=W.assign({},e)).source,t.trigger("string"==typeof n?n:e.eventName,e))}})})),r}ensureOverflowTwin(e,t){let{overflowTwin:n}=this;return n||(this.overflowTwin=n=this.createOverflowTwin(e),null==t||t(n)),n}get isComposable(){return!this.compose.$nullFn}adoptElement(e){const t=this,n="string"==typeof e?document.getElementById(e):e,r=oc.fromElement(n);if(r&&r.adopt&&r!==t){("string"==typeof r.adopt?document.getElementById(r.adopt):r.adopt)===n&&r.destroy()}return t.preExistingElements=Array.from(n.childNodes),t.adoptedElementClassName=n.className,t.adoptedElementCssText=n.style.cssText,n.lastDomConfig=null,n.$refOwnerId=t.id,n.className=n.style.cssText="",n}addRefAccessor(e,t){const{prototype:n}=this.constructor;Kd(n,t,{writable:!0,value:null}),Kd(n,e,{get(){return this.recompose.flush(),this[t]},set(e){this[t]=e}})}attachRef(e,t,n){const r=this,i="_"+e;t.dataset&&(t.dataset.ownerCmp=r.id),r.isComposable&&(i in r||r.addRefAccessor(e,i),zd(r,t,n,e)),r.byRef[e]=t,r[e]=t}detachRef(e,t,n){const r=this,i=r._refListeners;null!=i&&i[e]&&(i[e](),delete i[e]),r[e]=null,delete r.byRef[e]}afterRecompose(){}compose(){const{widgetClassList:e}=this;return{class:{...Vt.normalize(e,"object")}}}doCompose(){const e=this,{$meta:t}=e,n=t.hierarchy,r=t.renderConfigs||t.getInherited("renderConfigs");let i,s,o,a,{composers:l}=t,d=null;if(e.recompose.suspend(),!l){for(t.composers=l=[],o=n.indexOf(oc);o<n.length;++o)a=n[o].prototype,qd(a,"compose")&&l.push(a);qd(r,Nd)||(r[Nd]={get(e){"element"!==e&&(r[e]=!0)}})}for(e.configObserver=r[Nd],o=0;o<l.length;++o)i=l[o].compose.call(e,d),d=d?Yn.merge(d,i):i;return qd(e,"compose")&&Yn.merge(d,e.compose(d)),e.configObserver=null,Yn.normalizeChildren(d,((t,n)=>{n&&(s="_"+t,s in e||e.addRefAccessor(t,s))}))}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const t=this,n=t.isComposable,{adopt:r}=t;return t.id=t.id||(null==r?void 0:r.id)||null,r?e=t.adoptElement(r):n&&(e=t.doCompose()),"string"==typeof e?e=Yn.createElementFromTemplate(e):W.isObject(e)?(e=Yn.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume()):Yn.isReactElement(t.peekConfig("html"))||Yn.isVueConfig(t.peekConfig("html"))?e=document.createElement("div"):1!==e.nodeType&&(e=Yn.createElementFromTemplate(t.template(t))),!e.id&&(e.id=t.id),t.elementAttributes&&Yn.setAttributes(e,t.elementAttributes),e}updateElement(e){const t=this,n=t.isComposable;t.adopt&&(t._hidden=!0,n&&t.recomposeNow()),n&&zd(t,e,e.lastDomConfig);const{className:r}=e,{contentElement:i,contentElementCls:s,isComposable:o}=t,a=i!==e,l=!o&&e.querySelectorAll("[data-reference]"),d=o?[]:t.widgetClassList;let c=(a||!o)&&t.uiClasses;if(r&&d.unshift(r),t._hidden&&d.push("b-hidden",`b-hide-mode-${t.hideMode}`),t._readOnly&&d.push("b-readonly"),d.push("b-initializing"),ee.noThrow(e,"remove"),c?(null!=s&&s.value&&(c=c.slice(),c.push(s.value)),c=c.join(" ")):c=null==s?void 0:s.value,c&&(a?i.className+=" "+c:d.push(c)),!t.parent){const{defaultCls:e}=t,{outerCls:n}=oc;d.push(...e?n.filter((t=>!(t in e)||e[t])):n)}if(e.className=d.join(" "),l)for(let e,n=0;n<l.length;++n)e=l[n],t.attachRef(e.getAttribute("data-reference"),e),e.removeAttribute("data-reference");t.scaleToFitWidth||t.getConfig("monitorResize"),t.getConfig("role","ariaLabel","ariaDescription"),t._html&&t.getConfig("htmlMutationObserver"),t.owner&&!t._owner&&t.updateOwner(t.owner),Yn.isVueConfig(t._html)&&Yn.handleVueContent(t,t.html),t.trigger("elementCreated",{element:e})}localizeText(e){return e.match(Qd)?this.L(e,this):e}updateAriaDescription(e){const t=this,{ariaElement:n}=t,r=`${t.id}-aria-desc-el`;if(e){(t._ariaDescEl||(t._ariaDescEl=Yn.createElement({className:"b-aria-desc-element",id:r,parent:n}))).innerText=t.localizeText(e),Yn.addAttributeValue(n,"aria-describedBy",r)}else Yn.removeAttributeValue(n,"aria-describedBy",r)}updateAriaLabel(e=""){const t=this.labelledElement||this.ariaElement;t&&Yn.setAttributes(t,{"aria-label":e?this.localizeText(e):null})}updateAriaHasPopup(e){var t,n;e?null===(t=this.ariaElement)||void 0===t||t.setAttribute("aria-haspopup",e):null===(n=this.ariaElement)||void 0===n||n.removeAttribute("aria-haspopup")}updateAriaLive(e){Yn.setAttributes(this.ariaElement,{"aria-live":e})}updateRole(e){var t,n;e?null===(t=this.ariaElement)||void 0===t||t.setAttribute("role",e):null===(n=this.ariaElement)||void 0===n||n.removeAttribute("role")}get ownersRole(){let{role:e}=this;var t;"presentation"===e&&(e=null===(t=this.query((e=>"presentation"!==e.role)))||void 0===t?void 0:t.role);return e}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:W.getPath(this,e)}isCollapsified({collapsed:e,alt:t}){const{collapsify:n}=this,r=null==n;return t?"overlay"===n||r&&e:!1===n||"hide"===n||r&&!e}async recompose(){return this.recomposeInternal()}async recomposeInternal(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await Yn.transition(W.assign({element:e.element,action(){ud.sync(t)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else ud.sync(t);t.changed&&(e.afterRecompose(),e.trigger("recompose")),e.resumeRecompose()}resumeRecompose(){this.recompose.resume()}changeElementRef(e){if("string"==typeof e){const t=e;if(!(e=document.getElementById(t)))throw new Error(`No element found with id '${t}'`)}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,t){let n=t||e.appendTo,{insertFirst:r,insertBefore:i}=e;return r&&(n=r,i=n.firstChild),i&&(n=i.parentElement),[n,i||void 0]}render(e,t=!0){var n;const r=this,{element:i}=r,[s,o]=r.getRenderContext(r,e);r.emptyCache(),r.syncElement&&r.currentElement?Yn.sync(i,r.currentElement):(null==s||s.insertBefore(i,o),r.currentElement=i),null!==(n=i.parentElement)&&void 0!==n&&n.closest(".b-widget")&&i.classList.remove(...oc.outerCls),super.render(s,t),r.rendered=!0,r.getConfig("role"),t&&(r.getConfig("contentRange"),r.triggerPaint()),r.setupFocusListeners()}template({tag:e,html:t,htmlCls:n,name:r}){var i;const s=this;"string"==typeof t&&nc.test(t)&&s.resolveCallback(t,s,!1)&&(t=s.callback(t,s,[s]));const o=null!==(i=t)&&void 0!==i&&i.call?t.call(s,s):t;return`<${e} class="${o?n:""}" ${r?`data-name="${r}"`:""}>${o||""}</${e}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&null!==(t=this.$meta.renderConfigs)&&void 0!==t&&t[e]&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,t){return"style"===e?this._style:super.getConfigValue(e,t)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return(null==e?void 0:e.depth)>0&&(t.type=this.type),t}get dataset(){var e;return(null===(e=this.element)||void 0===e?void 0:e.dataset)||Pd}changeDataset(e){W.assign(this.dataset,e)}updateParent(e){const{_element:t}=this;t&&t.classList[e?"remove":"add"](...oc.outerCls)}get constrainTo(){var e;let t=this._constrainTo;if(t=void 0===t?globalThis:(null===(e=t)||void 0===e?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?t.host||t.ownerDocument:t,this.positioned){const{offsetParent:e}=this.element;if(e&&"hidden"===Yn.getStyleValue(e,"overflow"))t=Ot.from(e).moveTo(0,0);else if(t&&!t.isRectangle){const n=t===document||t===globalThis;t=Ot.from(t,e),n&&t.translate(globalThis.pageXOffset,globalThis.pageYOffset)}}return t}updateCentered(e){const t=this,{element:n,_anchorElement:r}=t;if(e&&!t.floating&&!t.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(n.classList.add("b-centered"),n.style.transform=n.style.left=n.style.insetInlineStart=n.style.right=n.style.top="",null==r||r.classList.add("b-hide-display"),n.classList.remove("b-anchored")):n.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,t=e._contentRange||(e._contentRange=new Range);return t.collapsed&&(e.initializingHtml&&e.adopt?t.setStart(e.contentElement,0):t.selectNodeContents(e.contentElement)),t}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;for(let{childNodes:r}=e,i=r.length;i-- >0;)this.fixRefOwnerId(r[i],t,n)}}get placement(){const{element:e}=this;let t,n,r;if(null!=e&&e.offsetParent&&!Gd.test(Yn.getStyleValue(e,"position"))){const s=e.nextElementSibling,o=e.previousElementSibling,a=!s&&o;var i;if(n=Yn.getStyleValue(e.parentElement,"flex-direction"),n)n=n.startsWith("row")?"h":"v";else t=null===(i=s||o)||void 0===i?void 0:i.getBoundingClientRect(),r=t&&e.getBoundingClientRect(),n=t&&Math.abs(t.top-r.top)<Math.abs(t.left-r.left)?"h":"v";n+="h"===n?a?"r":"l":a?"b":"t"}return n}updateId(e,t){if(super.updateId(e,t),t){const{byRef:n,element:r}=this;for(const t in n)n[t].dataset&&(n[t].dataset.ownerCmp=e);r.id=e,this.fixRefOwnerId(r,e,t)}}get style(){const{element:e}=this;return(null==e?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&Yn.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var t,n,r;const i=this,{lastAlignSpec:s,element:o}=i,{offsetParent:a,style:l,classList:d}=o;if(s&&(s.monitorIntersection&&i.intersectionObserver.unobserve(s.target),isFinite(s.zone)&&o.classList.remove(Zd[s.zone])),!e)return i.removeTransientListeners(),void(i.anchor=i.lastAlignSpec=null);i.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||"Point"===e.$$name)&&(e={target:e}),i.releaseSizeConstraints();const{scrollable:u,constrainTo:h}=i,g=Yn.measureSize(Yn.getStyleValue(o,"minHeight"),o),m=Yn.measureSize(Yn.getStyleValue(o,"minWidth"),o),p=i.positioned&&"fixed"!==Yn.getStyleValue(o,"position"),f=i.scale||1,v=e.target,y=e.realignEvent||(e=>{if(null!=e&&e.target){const{ownerSVGElement:t}=e.target,n=null==t?void 0:t.getBoundingClientRect();if(t)return{target:e.target.ownerSVGElement,offsetX:e.clientX-n.x,offsetY:e.clientY-n.y};let{offsetX:r,offsetY:i}=e,s=sc(e.target);if("contents"===Yn.getStyleValue(e.target,"display")){const e=s.getBoundingClientRect(s);r-=e.x,i-=e.y}return{target:sc(e.target),offsetX:r,offsetY:i}}})(e.domEvent||e.event||((null==v||null===(t=v.target)||void 0===t?void 0:t.nodeType)===Node.ELEMENT_NODE?v:null)),b=(null==y||null===(n=y.target)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE,C=b?y.target:null!=v&&v.isRectangle?v:(null==v?void 0:v.element)||v,w=(null==C?void 0:C.nodeType)===Element.ELEMENT_NODE;e=e.realignTarget?W.clone(e):W.merge({aligningToEvent:b,aligningToElement:w,constrainTo:h,align:"b-t",axisLock:i.axisLock,anchor:i.anchor},i.align,e),b&&(e.domEvent=y);const S=e.minWidth||m,D=e.minHeight||g;if(i.lastAlignSpec=e,w&&(e.target=e.anchoredTo=C,Ln(C instanceof SVGElement?C.closest("svg"):C))){if((e=Object.create(e)).target=i.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?Ot.from(C,p?a:null,!p):Yn.isInView(b?y:C,!1,i)),!e.target){const e=i.hide();return i.isDestroyed||(i.lastAlignSpec.targetOutOfView=!0),e}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1)}if(e.anchor&&(e.anchorSize=i.anchorSize,o.contains(i.anchorPathElement)||o.appendChild(i.anchorElement)),"string"==typeof e.offset){const t=o.querySelector(e.offset),n=Ot.from(t).getAlignmentPoint(e.align),r=Ot.from(o).getAlignmentPoint(e.align);e.offset=[r[0]-n[0],r[1]-n[1]]}i.isAligning=!0,i.trigger("beforeAlign",e);const E=Ot.from(o,p?a:null,!0),{width:x,height:R}=E;E.isAlignRectangle=!0,S&&(E.minWidth=S*f),D&&(E.minHeight=D*f),i.isAligning=!1,e.rtl=i.rtl,(e.align.includes("s")||e.align.includes("e"))&&(i.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const T=i.lastAlignSpec.result=E.alignTo(e);let{align:M,anchor:k,x:F,y:I,width:A,height:L,overlap:P}=T;if(i.lastAlignSpec.zone=T.zone,L!=R){const e=L<R;i.alignmentChanges=i.alignmentChanges|(e?1:2),l[i.alignedHeightStyle=rc[3&i.alignmentChanges]]=L/f+"px",e&&!i._minHeight&&g&&(l.minHeight=Math.min(L,g)/f+"px"),u&&(u.overflowY=e)}if(A!=x){const e=A<x;i.alignmentChanges=i.alignmentChanges|(e?4:8),l[i.alignedWidthStyle=rc[12&i.alignmentChanges]]=A/f+"px",e&&!i._minWidth&&m&&(l.minWidth=Math.min(A,m)/f+"px"),u&&(u.overflowX=e)}if(M&&i.alignmentChanges){const t=Ot.from(o,p?a:null,!0);e.align=M;const n=i.lastAlignSpec.result=t.alignTo(e);k=n.anchor,F=n.x,I=n.y,A=n.width,L=n.height}if(i.centered||i.setXY(F,I),!T.overlap&&isFinite(T.zone)&&d.add(Zd[T.zone]),null!==(r=k)&&void 0!==r&&r.edge){var O;let{edge:e}=k;const{anchorElement:t,masked:n}=i,{style:r}=t,{style:s}=t.firstChild,a=Ot.from(o),l=[];"top"===e||"bottom"===e?(l[0]=k.x,l[1]="top"===e?1:a.height-1):(l[0]="left"===e?1:a.width-1,l[1]=k.y),r.display="none",n&&(n.element.style.display="none");let c=Yn.childFromPoint(o,...l);if((null!==(O=c)&&void 0!==O&&O.matches(":focus")||c===ir.currentOverElement)&&o.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(c=c.parentNode),c&&c!==document){let e=Yn.getStyleValue(c,"background-color");for(;e.match(Vd)&&"absolute"!==Yn.getStyleValue(c,"position")&&(c=c.parentNode,c!==document);)e=Yn.getStyleValue(c,"background-color");e.match(Vd)?i.anchorPathElement.setAttribute("fill",i.defaultAnchorBackgroundColor):i.anchorPathElement.setAttribute("fill",e)}r.transform=r.display="",n&&(n.element.style.display=""),"left"!==e&&"right"!==e||(e="left"===e?i.rtl?"end":"start":i.rtl?"start":"end"),t.className=`b-anchor b-anchor-${e}`,k.x&&(k.x/=f),k.y&&(k.y/=f),s.left=`${k.x||0}px`,s.translate=`0 ${k.y||0}px`,d.add("b-anchored")}else i._anchorElement&&(i.anchorElement.classList.add("b-hide-display"),d.remove("b-anchored"));if(!w){l.pointerEvents="none";const e=Yn.elementFromPoint(F,I);i.owns(e)||(i.lastAlignSpec.anchoredTo=e),l.pointerEvents=""}if(("realign"===i.scrollAction&&w||"hide"===i.scrollAction)&&!i.documentScrollListener){if(i.clearTimeout("scrollListenerTimeout"),e.monitorTargetMutation&&!i.targetObserver){(i.targetObserver||(i.targetObserver=new MutationObserver(i.onTargetParentMutation.bind(i)))).observe(Yn.getRootElement(C),{childList:!0,attributes:!0,subtree:!0})}i.setTimeout((()=>{const e=w?C:i.lastAlignSpec.anchoredTo,t=e?Yn.getRootElement(e):null;i.documentScrollListener=Jt.addListener({element:document,scroll:"doHideOrRealign",transitionend:"realignOnTransitionEnd",capture:!0,thisObj:i}),null!=t&&t.mode&&(i.targetRootScrollListener=Jt.addListener({element:t,scroll:"doHideOrRealign",transitionend:"realignOnTransitionEnd",capture:!0,thisObj:i}))}),"hide"===i.scrollAction?i.ignoreScrollDuration:0,"scrollListenerTimeout")}if(w&&(e.monitorResize&&!i.observedTargetEl&&(fd.addResizeListener(C,i.onTargetResize),i.observedTargetEl=C),e.monitorIntersection&&!(P||C.contains(o)||C.ownerSVGElement)&&i.intersectionObserver.observe(C)),!c.isAndroid&&!i.observedConstrainEl){const e=null!=h&&h.isRectangle?globalThis:h;i.clearTimeout("resizeListenerTimeout"),i.setTimeout((()=>{i.observedConstrainEl=e||globalThis,fd.addResizeListener(i.observedConstrainEl,i.onAlignConstraintChange)}),i.ignoreScrollDuration,"resizeListenerTimeout")}}onTargetParentMutation(e){const{element:t,lastAlignSpec:n}=this;var r;null!=n&&n.aligningToElement&&(null!==(r=n.target)&&void 0!==r&&r.isConnected?e.some((({target:e})=>e.contains(n.target)&&!t.contains(e)))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionChange.bind(this),{root:c.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionChange(e){if(!this.isDestroyed){const t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:t,height:n}=e.targetRect,{width:r,height:i}=e.target.getBoundingClientRect();r===t&&i===n||this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,t,{height:n}){const{style:r}=this.contentElement,{overflowY:i}=r;this.setTimeout(this.realign,50),t&&n>t.height&&(r.overflowY="hidden",this.requestAnimationFrame((()=>r.overflowY=i)))}realign(){const e=this,{lastAlignSpec:t}=e;if((e.floating||e.positioned)&&t&&e.isVisible){if(t.aligningToElement){const n=t.target.contains(this.element),r=Yn.isInView(t.target,!1,e);if(!(t.allowTargetOut||Ln(t.target)&&r))return e.hide(),void(e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0));t.realignEvent=t.domEvent,t.realignTarget=n||t.aligningToEvent?null:r}Yn.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(t)}}rectangle(e,t,n){return this.rectangleOf("element",e,t,n)}rectangleOf(e,t,n,r){var i;return"string"!=typeof t?(r=n,n=t,t=""):"border"===t&&(t=""),"boolean"==typeof n&&(r=n,n=void 0),"element"!==e&&void 0===n&&(n=this.element),n=null!==(i=n)&&void 0!==i&&i.isWidget?n.element:n,"string"==typeof e&&(e=this[e]),Ot[t||"from"](e,n,r)}releaseSizeConstraints(){const e=this,{scrollable:t,element:n,alignmentChanges:r}=e,{style:i}=n;e.centered||Yn.setTopInsetInlineStart(n,0,0),12&r&&(Yn.setLength(n,e.alignedWidthStyle,e[`_last${N.capitalize(e.alignedWidthStyle)}`]||""),i.minWidth=e._minWidth||"",t&&(t.overflowY=t.config.overflowY)),3&r&&(Yn.setLength(n,e.alignedHeightStyle,e[`_last${N.capitalize(e.alignedHeightStyle)}`]||""),i.minHeight=e._minHeight||"",t&&(t.overflowX=t.config.overflowX)),e.alignmentChanges=0}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null,n=document.createDocumentFragment();if(this.containsFocus){for(let s,o=e.nextSibling;o;o=s){var r,i;s=o.nextSibling,t.contains(o)&&null!==(r=(i=o).matches)&&void 0!==r&&r.call(i,".b-floating,.b-positioned")&&!this.owns(o)&&n.appendChild(o)}n.childElementCount&&t.insertBefore(n,e)}else e.nextElementSibling&&t.appendChild(e)}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return"string"==typeof e?{align:e}:e}changeScrollable(e,t){return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):null==t||t.destroy(),e}get html(){return this.isConfiguring?this.content||this._html:this.contentElement.innerHTML}changeHtml(e){return!e||"object"!=typeof e||Yn.isVueConfig(e)||Yn.isReactElement(e)||Array.isArray(e)||(e=[e]),e}updateHtml(e){const t=this;t.noChildElements="string"==typeof e&&!Bd.test(e),t.initializingElement||t.insertContent(e,!(t.initializingHtml&&t.adopt))}changeHtmlMutationObserver(e,t){const n=this,{contentElement:r}=n;if(null==t||t.disconnect(),e){const t=new MutationObserver((()=>{n.updatingHtml?n.updatingHtml=!1:n._html=r.innerHTML}));return t.observe(r,e),t}}updateContent(e){this.initializingElement||this.insertContent(e)}insertContent(e,t=!1){const n=this,{element:r,contentElement:i,htmlCls:s,contentRange:o,autoClose:a}=n,l=t&&i===r&&n._anchorElement;if(Yn.isReactElement(e))return Yn.handleReactElement(n,e);if(Yn.isVueConfig(e))return Yn.handleVueContent(n,e);if(n.updatingHtml=!0,n.getConfig("htmlMutationObserver"),l&&r.removeChild(l),s&&s.values.forEach((t=>r.classList[e?"add":"remove"](t))),n.autoClose=!1,e){let n,s;"object"==typeof e?(s=document.createDocumentFragment(),Array.isArray(e)?ud.sync({domConfig:{children:e,onlyChildren:!0},targetElement:s}):ud.sync({domConfig:{...e,onlyChildren:!0},targetElement:s})):t?(i.innerHTML=e,n=!0):(o.deleteContents(),o.insertNode(o.createContextualFragment(e)),n=!0),n||(t?(i.innerHTML="",i.appendChild(s)):r.isConnected?o.insertNode(s):i.insertBefore(s,i.firstChild))}else t||!r.isConnected?i.innerHTML="":o.deleteContents();n.autoClose=a,l&&r.appendChild(l),n.contentRangeStartOffset=o.startOffset,n.contentRangeEndOffset=o.endOffset,i.classList.toggle("b-no-child-elements",n.noChildElements),n.isComposable&&n.recompose(),!n.floating&&!n.positioned||n.isAligning||n.realign()}onThemeChange(){var e;this._anchorSize=null,null!==(e=this.anchorElement)&&void 0!==e&&e.offsetParent&&this.realign()}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const n=parseFloat(Yn.getStyleValue(e.element,"border-top-width")),r=Yn.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,{className:s}=i,o=i.firstElementChild,a=e.anchorPathElement=o.lastElementChild,l=e._hidden;i.className="b-anchor b-anchor-top";let d=Yn.getStyleValue(e.contentElement,"background-color");d.match(Vd)&&(d=Yn.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=d,t=o.getBoundingClientRect();const[c,u]=t=e._anchorSize=[t.width,t.height];i.className=s,o.setAttribute("height",u+n),o.setAttribute("width",c),a.setAttribute("d",`M0,${u}L${c/2},0.5L${c},${u}`),n&&(a.setAttribute("stroke-width",n),a.setAttribute("stroke",r)),t[1]-=n,l&&e.syncHiddenCls(),e.themeChangeListener||(e.themeChangeListener=ir.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating||e.positioned,n=`${e.id}-shadow-filter`;e._anchorElement=Yn.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:n,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:`url(#${n})`}]}]})}return e._anchorElement}updateAnchor(e){var t;null===(t=this._anchorElement)||void 0===t||t.classList.toggle("b-hide-display",!e)}changeDraggable(e,t){var n;const r=this;if(null==t||null===(n=t.destroy)||void 0===n||n.call(t),e){const t="object"==typeof e?e:{};r.draggableHandleSelector=t.handleSelector,delete t.handleSelector,e=new Zl(W.merge({name:"widget",target:r,floatRootOwner:r,rtlSource:r,positioning:r.floating?"inset":"",dragWithin:r.floating?void 0:r.element.parentNode,internalListeners:{beforeDragStart:r.onBeforeDragStart,dragStart:r.onWidgetDragStart,thisObj:r}},t))}return e}onBeforeDragStart(){const e=this;if(e.validateDragStartEvent(e.draggable.startEvent)){const{x:t,y:n,element:r}=e;return r.classList.remove("b-centered"),e.alignTo(),e.centered&&Yn.setTopInsetInlineStart(r,n,t),!0}return!1}validateDragStartEvent(e){const t=Yn.elementFromPoint(e.clientX,e.clientY),{draggableHandleSelector:n,draggableBlacklistSelector:r}=this;if(r&&t.closest(r))return!1;if(n){var i;const e=null===(i=Ud.exec(n))||void 0===i?void 0:i[1];if(e&&t.closest(e))return!1;if(!t.closest(`${n}`))return!1}return!0}setStyle(e,t){return Yn.applyStyle(this.element,W.isObject(e)?e:{[e]:t}),this}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositionable(e){this.element.classList.toggle("b-positionable",Boolean(e)),e&&(this.innerItem=!1)}updatePositioned(e){const{element:t}=this;t.classList.toggle("b-positioned",Boolean(e)),e&&(this.innerItem=!1),t[e?"setAttribute":"removeAttribute"]("tabindex",e?"-1":void 0)}getXY(){const{element:e}=this;return[Yn.getPageX(e),Yn.getPageY(e)]}setXY(e,t){const n=this,{element:r}=n;if(n.floating||n.positioned){if(null!=e?n._x=e:e=n._x,null!=t?n._y=t:t=n._y,"fixed"===Yn.getStyleValue(r,"position")){const n=r.getBoundingClientRect(),[i,s]=Yn.getTranslateXY(r),o=e-n.x,a=t-n.y;Yn.setTranslateXY(r,i+o,s+a)}else n.rtl?Yn.setTopInsetInlineStart(r,t,r.offsetParent.offsetWidth-r.offsetWidth-e-1):Yn.setTopInsetInlineStart(r,t,e);n.isConstructing?n.centered=!1:r.classList.remove("b-centered")}}setPos(e,t){const n=this,{positionable:r}=n;[e,t]=Yn.unitize(e,t??""),n.element.style[e]=t,null==n.top&&null==n.right&&null==n.bottom&&null==n.left?"after"!==r&&"before"!==r||(n.positionable=null):r||(n.positionable="before")}updateBottom(e){this.setPos("bottom",e)}updateLeft(e){this.setPos("inset-inline-start",e)}updateRight(e){this.setPos("inset-inline-end",e)}updateTop(e){this.setPos("top",e)}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){const t=this;if(Yn.setLength(t.element,"width",e),t._lastWidth=e,t._flex=null,t.element.style.flex="",!t.monitorResize)return e;t._oldWidth=t._width,t._width=null}clearWidthCache(){this._width=null}get maxWidth(){return Yn.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){this._lastMaxWidth=e,Yn.setLength(this.element,"maxWidth",e)}get minWidth(){return Yn.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){Yn.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),"number"!=typeof e&&isNaN(e)||(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove(`b-text-align-${t}`),this.element.classList.add(`b-text-align-${e}`)}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){Yn.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return Yn.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){this._lastMaxHeight=e,Yn.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return Yn.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){Yn.setLength(this.element,"minHeight",e)}updateDisabled(e=!1,t){const n=this,{element:r,focusElement:i,ariaElement:s}=n;n.trigger("beforeUpdateDisabled",{disabled:e}),e&&(n.revertFocus(),!n._disabled!=!e)||(r&&(r.classList[e?"add":"remove"]("b-disabled"),"inert"===e?r.inert=!0:"inert"===t&&(r.inert=!1),i&&(i.disabled=e),s&&s.setAttribute("aria-disabled",Boolean(e))),n.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=hd.request(e.floating?e.floatRoot:e.element);return hd.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),t}exitFullscreen(){return hd.exit()}onFullscreenChange(){hd.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){hd.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}get tooltip(){const e=this;if(e._tooltip)return e._tooltip;{var t;const n=null===(t=oc.Tooltip)||void 0===t?void 0:t.getSharedTooltip(e.rootElement,e.eventRoot);if(n&&n.activeTarget===e._element&&n.isVisible)return n}}changeTooltip(e,t){const n=this,{element:r}=n;let i;if(e){if(!n.preventTooltipOnTouch||!c.isTouchDevice){const s=(null==t?void 0:t.isTooltip)||e.newInstance||e.items||e.bbar||e.tbar;e.isTooltip||"Object"===e.constructor.name||(e={html:"string"==typeof e?e:n.placeholder,textContent:!0}),s?(e.type="tooltip",e.forElement||(e.forElement=r),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),i=e=oc.reconfigure(t,e,n),n.detachListeners("tooltipValueListener"),n.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:n})):(r.dataset.btip=!0,n.tipConfig=e)}}else if(t){if(null!=e||!t.isTooltip)return void(t.html=null);t.destroy()}else delete r.dataset.btip;return e&&!n.ariaLabel&&n.tooltipText&&r.setAttribute("aria-label",n.localizeText(n.tooltipText)),i}onTooltipValueChange({value:e,source:t}){this.ariaDescription="string"==typeof e?e:t.contentElement.innerText}get tooltipText(){const e=this._tooltip;return e?e.isTooltip?e.contentElement.innerText:"string"==typeof e?e:e.html:this.tipConfig?this.tipConfig.html:void 0}get isVisible(){const e=this;let t;return Boolean(!e._hidden&&(t=this.element)&&!e.isDestroying&&t.isConnected&&(!e.requireSize||Ln(t))&&(!e.parent||e.parent.isVisible))}get isVisibleForValidation(){const e=this,{element:t}=e;let n;return Boolean(t&&(!e._hidden||e.tab&&!e.tab.hidden)&&!e.isDestroying&&t.isConnected&&(!(n=e.containingWidget)||n.isVisibleForValidation))}whenVisible(e,t=this,n,r=e.toString()){const i=this;var s;i.isVisible&&i.isPainted?(null===(s=i.toCallWhenVisible)||void 0===s||s.delete(r),i.callback(e,t,n)):(i.toCallWhenVisible||(i.toCallWhenVisible=new Map)).set(r,{callback:e,thisObj:t,args:n})}focus(){var e;null===(e=this.focusableElement)||void 0===e||e.focus({preventScroll:!0})}get focusability(){return Yn.getFocusability(this.focusElement)}get focusableElement(){const e=this,t=!e.isDestroying&&e.isVisible&&!e.disabled&&e.focusElement;return(t===document.body||(null==t?void 0:t.offsetParent))&&t}get focusElement(){}get isFocusable(){return Boolean(this.focusableElement)}get isTabbable(){return this.focusability.tabbable}set isTabbable(e){const{focusability:t,focusElement:n}=this,[r,i]=t.natural?[!e&&"-1",e]:[e&&"0",!e];n&&!e!=!t.tabbable&&(i&&n.removeAttribute("tabIndex"),r&&n.setAttribute("tabIndex",r))}async show({align:e,animate:t=!0}={}){var n;const r=this,{element:i,floating:s}=r,{style:o}=i,a=t&&r.showAnimation;let l,d,c=!r.isVisible;return c&&(c=r.trigger("beforeShow"),W.isPromise(c)&&(c=await c)),!1!==c&&!1!==(null===(n=r.internalBeforeShow)||void 0===n?void 0:n.call(r))?new Promise((t=>{if(r.cancelHideShowAnimation(),r.updateCentered(r._centered),s){const e=r.floatRoot;e.contains(i)||(r.rendered?e.appendChild(r.element):r.render(e,!1)),o.transform.includes("scale")&&(r.scale=null,o.transform=o.transformOrigin="");const t=r.closest(Yd);if(t){const{scale:e}=t;r.scale=e,o.transform=`scale(${e})`,o.transformOrigin="0 0"}}if(r._hidden=!1,r.syncHiddenCls(),s&&!An(i))return r.hide(!1),t();if(r.onConfigChange({name:"hidden",value:!1,was:!0,config:r.$meta.configs.hidden}),r.afterShow(e,a?null:t),a){l=Object.keys(a)[0],d=a[l];const e=r.currentAnimation={showing:!0,styleProp:l,resolve:t};r.isAnimating=!0,o.transition="none",o[l]=d.from,Yn.getStyleValue(i,l),r.currentAnimation.detacher=Jt.onTransitionEnd({element:i,property:l,duration:Xd(d.duration)+20,handler:()=>r.afterHideShowAnimate(e),thisObj:r}),o.transition=`${l} ${d.duration} ease ${d.delay}`,o[l]=d.to}})):Promise.resolve()}async showBy(e,t,n){const r=this,i=Array.isArray(e);if(i||"number"==typeof e){const r=i?e:[e,t];e=Object.assign({target:new $t(r[0]+1,r[1]+1),matchSize:!1,align:"t0-b0"},i?t:n)}if(r.requireSize=!0,!r.isVisible)return r.show({align:e});Yn.addTemporaryClass(r.element,"b-realigning",300,r),r.alignTo(e)}afterShow(e,t){var n,r;const i=this;i.trigger("show"),i._configuredAnchorState=i.anchor,null===(n=i.owner)||void 0===n||null===(r=n.onChildShow)||void 0===r||r.call(n,i),i.triggerPaint(),(i.floating||i.positioned)&&(e?i.alignTo(e):i.centered?i.alignTo({target:i.constrainTo,align:"c-c"}):i.forElement&&i.alignTo(i.forElement)),null==t||t()}onChildHide(e){const{ariaElement:t}=this,{ownersRole:n}=e;if(e.floating&&t)if("tooltip"===n){const{titleElement:n}=e,r=n&&Yn.getId(n),i=Yn.getId(e.contentElement);r&&Yn.removeAttributeValue(t,"aria-describedby",r),Yn.removeAttributeValue(t,"aria-describedby",i)}else this.ariaHasPopup=null,Yn.removeAttributeValue(t,"aria-controls",Yn.getId(e.ariaElement||e.element))}onChildShow(e){const{ariaElement:t}=this,{ownersRole:n}=e;if(e.floating&&t)if("tooltip"===n){const{titleElement:n}=e,r=n&&Yn.getId(n),i=Yn.getId(e.contentElement);r&&Yn.addAttributeValue(t,"aria-describedby",r),Yn.addAttributeValue(t,"aria-describedby",i)}else this.ariaHasPopup=n,Yn.addAttributeValue(t,"aria-controls",Yn.getId(e.ariaElement||e.element))}triggerPaint(){const e=this,{element:t,toCallWhenVisible:n}=e,r=!e.isPainted;if(e.isVisible){var i;if(r&&(e.getConfig("scrollable",e.floating||e.positioned?"draggable":null),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),fd.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),!e.hideBryntumDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&t.insertBefore(new Comment("POWERED BY BRYNTUM (https://bryntum.com)"),t.firstChild),e.onConnectedCallback&&globalThis.ResizeObserver&&(e.connectedObserver=new ResizeObserver((()=>{e.isElementConnected&&!t.isConnected?(e.onConnectedCallback(!1),e.isElementConnected=!1):!e.isElementConnected&&t.isConnected&&(e.onConnectedCallback(!0,null==e.isElementConnected),e.isElementConnected=!0)})),e.connectedObserver.observe(t))),e.eachWidget(Wd,!1),r&&(e.getConfig("tooltip"),!oc.Ripple&&oc.RippleClass&&(oc.Ripple=new oc.RippleClass({rootElement:e.rootElement})),globalThis.DocsBrowser&&e.floating&&e.closest((e=>{var t;return null===(t=e.element)||void 0===t?void 0:t.closest(".fiddlePanelResult,.b-owned-by-fiddle")}))&&t.classList.add("b-owned-by-fiddle")),e.isPainted=!0,r&&e.triggerConfigs("paint"),e.onInternalPaint({firstPaint:r}),e.trigger("paint",{firstPaint:r}),null===(i=e.afterInternalPaint)||void 0===i||i.call(e,{firstPaint:r}),null!=n&&n.size){for(const{callback:t,thisObj:r,args:i}of n.values())e.callback(t,r,i);n.clear()}r&&e.monitorResize&&!e.scaleToFitWidth&&fd.onElementResize([{target:t}]),e.hasPainted=!0}}onInternalPaint(){}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:n}=e;t&&(e.isAnimating=!1,n.classList.contains("b-hiding")&&(n.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),n.style.transition=n.style[t.styleProp]="",e.currentAnimation=null,e.trigger((t.showing?"show":"hide")+"AnimationEnd"))}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",Jd)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise((t=>{const n=this;if(n._hidden||!1===n.trigger("beforeHide",{animate:e}))t(!1);else{const{element:r,lastAlignSpec:i}=n,{style:s}=r,o=e&&n.hideAnimation;if(n.clearTimeout("scrollListenerTimeout"),n.clearTimeout("resizeListenerTimeout"),n._hidden=!0,i&&(i.targetOutOfView=null,i.monitorIntersection&&(n.intersectionObserver.takeRecords(),n.intersectionObserver.unobserve(i.target))),n.onConfigChange({name:"hidden",value:!0,was:!1,config:n.$meta.configs.hidden}),!r)return void t();if(r.matches(":focus-within")&&n.revertFocus(!0),n.isDestroyed)return void t();if(n.cancelHideShowAnimation(),o){const e=Object.keys(o)[0],i=o[e];if(Number(getComputedStyle(n.element)[e])!==i.to){const o=n.currentAnimation={hiding:!0,styleProp:e,resolve:t};r.classList.add("b-hiding"),n.isAnimating=!0,n.currentAnimation.detacher=Jt.onTransitionEnd({element:r,property:e,duration:Xd(i.duration)+20,handler:()=>n.afterHideShowAnimate(o),thisObj:n}),s[e]=i.from,Yn.getStyleValue(r,e),s.transition=`${e} ${i.duration} ease ${i.delay}`,s[e]=i.to}else n.syncHiddenCls()}else n.syncHiddenCls();n.ownedWidgets&&Object.values(n.ownedWidgets).forEach((t=>{var n;return t.floating&&(null===(n=t.hide)||void 0===n?void 0:n.call(t,e))})),n.afterHide(!o&&t,o)}}))}realignOnTransitionEnd(e){this.doHideOrRealign(e)}doHideOrRealign({target:e,type:t,isTrusted:n}){const r=this,{lastAlignSpec:i,element:s}=r,o=null==i?void 0:i.anchoredTo,a=null==i?void 0:i.target,l=null==i?void 0:i.position,d=Yn.getActiveElement(r);if(!n||!Ln(s)||e&&("scroll"===t&&!Yn.isVisible(e)||s.contains(e)||e.nodeType===Element.ELEMENT_NODE&&r.owns(e)||e.nodeType===Element.DOCUMENT_NODE&&s.contains(d)&&Yn.isTextualInput(d)&&globalThis.innerHeight<document.body.offsetHeight))return;if(i.aligningToElement){const e=Yn.isInView(a,!1,r);if(e&&e.equals(i.targetRect))return}const c="hide"===r.scrollAction&&r.getXY();if(r.scrollRealigning="scroll"===t,r.realign(),r.scrollRealigning=!1,!r.isDestroyed&&An(s)&&"hide"===r.scrollAction){const[t,n]=r.getXY(),s=t!==c[0]||n!==c[1];(null!=i&&i.aligningToEvent||(s||"Point"===(null==a?void 0:a.$$name)||l)&&(!o||!Ln(o)||e&&Yn.isDescendant(e,o)))&&r.hide()}}afterHide(e=null,t=this.hideAnimation){var n,r;const i=this;i._anchor=i._configuredAnchorState,i.removeTransientListeners(),t||i.afterHideAnimation(),i.trigger("hide"),null===(n=i.owner)||void 0===n||null===(r=n.onChildHide)||void 0===r||r.call(n,i),e&&e()}removeTransientListeners(){var e,t;const n=this,{targetObserver:r}=n;n.clearTimeout("resizeListenerTimeout"),n.clearTimeout("scrollListenerTimeout"),r&&(r.disconnect(),delete n.targetObserver),n.documentScrollListener=null===(e=n.documentScrollListener)||void 0===e?void 0:e.call(n),n.targetRootScrollListener=null===(t=n.targetRootScrollListener)||void 0===t?void 0:t.call(n),n.observedTargetEl&&(fd.removeResizeListener(n.observedTargetEl,n.onTargetResize),n.observedTargetEl=!1),n.observedConstrainEl&&(fd.removeResizeListener(n.observedConstrainEl,n.onAlignConstraintChange),n.observedConstrainEl=!1)}afterHideAnimation(){const e=this,{element:t}=e;!e.hasOwnProperty("_hideMode")&&e.floating&&e.floatRoot.contains(t)?t.remove():e.syncHiddenCls(),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let n;return t.isConfiguring?(n=Boolean(e),t.syncHiddenCls(n)):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),n}syncHiddenCls(e=this._hidden){const{element:t,hideMode:n}=this,r={"b-hidden":e};for(const t of _d)r[`b-hide-mode-${t}`]=t===n&&(e||"display"!==t);Yn.assignClasses(t,r)}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}changeOwner(e){if(!this.parent)return e}updateOwner(e,t){const n=this,{id:r}=n;t&&t.ownedWidgets&&delete t.ownedWidgets[r],e&&e!==n.parent&&((e.ownedWidgets||(e.ownedWidgets={}))[r]=n)}get containingWidget(){let e=this.parent;if(!e){var t,n;const r=(null===(t=this.forElement)||void 0===t?void 0:t.nodeType)===Element.ELEMENT_NODE?this.forElement:null===(n=this.element)||void 0===n?void 0:n.parentNode;e=(null==r?void 0:r.closest(".b-widget"))&&oc.fromElement(r)}return e}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){var t;const n=this,{parent:r}=n,i=r?r.childItems:Array.from((null===(t=n.element.parentElement)||void 0===t?void 0:t.querySelectorAll(".b-widget"))??[]);return r?i[i.indexOf(n)+e]:oc.fromElement(i[i.indexOf(n.element)+e])}up(e,t,n){var r;const{owner:i}=this;return e?null==i||null===(r=i.closest)||void 0===r?void 0:r.call(i,e,t,n):i}closest(e,t,n){const r=typeof n,i="number"===r,s="string"===r;for(let r=this,o=1;r;r=r.owner,o++){if(oc.widgetMatches(r,e,t))return r;if(i&&o>=n)return;if(s&&oc.widgetMatches(r,n,t))return;if(r===n)return}}owns(e,t){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=e.getAttribute("owned-by")?oc.getById(e.getAttribute("owned-by")):oc.fromElement(e)}for(;e;){if(e.isHint||e===this||t&&this.ownedWidgets&&Object.values(this.ownedWidgets).some((t=>t.owns(e,!0))))return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(!1===e(t))return!1;t=t.owner}return!0}changeMaximizeOnMobile(e){const t=this;if(t.floating&&c.isMobile){const{initialConfig:n}=t;e?(t.centered=t.modal=!1,t.maximized=!0):(t.centered=n.centered,t.modal=n.modal,t.maximized=n.maximized)}}changeMonitorResize(e,t){const n=!this.scaleToFitWidth&&Boolean(e);if(n!==Boolean(t))return n}updateMonitorResize(e){const t=this;qd(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),fd[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((t=>{t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)}),!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0,n){const r=n?this.childItemsOrderedByRelevance:this.childItems,i=(null==r?void 0:r.length)||0,s={};for(let o=0;o<i;o++){const i=r[o];if(s.down=t,!1===e(i,s))return!1;if(s.down&&i.eachWidget&&!1===i.eachWidget(e,t,n))return!1}return!0}queryAll(e){const t=[];return this.eachWidget((n=>{e(n)&&t.push(n)})),t}query(e,t){let n=null;return this.eachWidget((t=>{if(e(t))return n=t,!1}),!0,t),n}getWidgetByRef(e){var t,n;return e instanceof oc?e:(null==this||null===(t=this.widgetMap)||void 0===t?void 0:t[e])||(null==this||null===(n=this.owner)||void 0===n?void 0:n.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:n}=t;t.containsFocus=!0,t.focusInEvent=e,(t.floating||t.positioned)&&t.toFront(),n.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),n.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=Jt.on({element:n,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}captureFocus(){const e=this,t=Yn.getActiveElement(e),n=e.contains(t)&&e.captureFocusItem(t);return(r,i)=>{if(n&&!e.isDestroying){(Yn.getActiveElement(e)!==t||i)&&n(r)}}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():e.focus({preventScroll:!0}))}}contains(e,t){const{element:n}=this;if(e&&n)return e.isWidget&&(e=e.element),n.contains(e)&&(!t||n!==e)}revertFocus(e){var t,n;const r=this,i=Yn.getActiveElement(r);let s=null===(t=r.focusInEvent)||void 0===t?void 0:t.relatedTarget;(e||r.containsFocus&&(null===(n=s)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE&&r.element.contains(i))&&(s&&Yn.isFocusable(s)||(s=r.getFocusRevertTarget()),r._isRevertingFocus=!0,s&&Yn.isFocusable(s)?(s._isRevertingFocus=!0,s.focus({preventScroll:!0}),s._isRevertingFocus=!1):null==i||i.blur(),r._isRevertingFocus=!1)}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:n}=e,r=n&&n.backwards?1:-1;let i=n&&n.relatedTarget;const s=i&&oc.fromElement(i);if(t&&!t.isDestroyed&&(!i||!Yn.isFocusable(i)||s&&!s.isFocusable)){var o;if(i=null,t.eachWidget){const n=[];if(t.eachWidget((t=>{(t===e||t.isFocusable)&&n.push(t)}),!1),n.length>1){const t=n.indexOf(e);i=n[t+r]||n[t-r]}}!i&&t.isFocusable&&(i=t),i=i?i.focusElement:null===(o=t.getFocusRevertTarget)||void 0===o?void 0:o.call(t)}return i}getStaticWidgetClasses(e,t){const n=new Vt,r=this.$meta.hierarchy;let i,s,o,a,l;for(s=r.indexOf(e);s<r.length;++s){var d;i=r[s],l=Reflect.getOwnPropertyDescriptor(i.prototype,"widgetClass"),null!==(d=l)&&void 0!==d&&d.get?a=l.get.call(this):(o=qd(i,"$$name")||qd(i,"$name")||qd(i,"_$name")?i.$$name:i.name,(o.length<3||o.includes("$"))&&console.warn(`Class "${o}" extending "${i.$name}" should have "$name" static getter with no less than 3 chars.`),a=`b-${o.toLowerCase()}`),a&&n.add(t?a+t:a)}return n}get rootUiClass(){return oc}get staticClassList(){const{$meta:e}=this;let t=e.staticClassList;return t||(e.staticClassList=t=this.getStaticWidgetClasses(oc),c.isTouchDevice&&t.add("b-touch")),t}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:t,defaultCls:n,uiClasses:r}=e;let{staticClassList:i}=e;(n||t)&&(i=i.clone(),n&&i.assign(n),t&&i.assign(t));const s=i.values;return r&&s.push(...r),e.floating&&s.push("b-floating"),"hide"===e.collapsify&&s.push("b-collapsify-hide"),s}changeCls(e){return Vt.from(e)}updateCls(e,t){if(!this.isConfiguring&&!this.isComposable){const{element:n}=this;t&&W.getTruthyKeys(t).forEach((e=>n.classList.remove(e))),e.assignTo(n)}}changeContentElementCls(e){return Vt.from(e)}changeHtmlCls(e){return Vt.from(e)}changeDefaultCls(e){return Vt.from(e,!0)}updateHideMode(){this.hasPainted&&this.syncHiddenCls()}changeUi(e){return Vt.from(e)}updateUi(e){var t;let n,r,i=null;if(e){const t=this.getStaticWidgetClasses(this.rootUiClass);for(r in e)if(e[r])for(n in t)t[n]&&((i||(i=new Vt))[`${n}-ui-${r}`]=1)}this._uiClasses=null===(t=i)||void 0===t?void 0:t.values,this._uiClassList=i}fromCache(e,t=!1,n=this.element){var r;if(!n)return null;const i=this;return null!==(r=i.cache)&&void 0!==r&&r[e]?i.cache[e]:(i.cache||(i.cache={}),i.cache[e]=t?Yn.children(n,e):n.querySelector(e))}emptyCache(){this.cache&&(this.cache={})}changeMasked(e,t){var n;if("trial"!==(null===(n=this.masked)||void 0===n?void 0:n.type)){if(!0!==e&&""!==e||(e=" "),t&&!t.isDestroyed)"string"==typeof e?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const t=oc.resolveType("mask");(e=t.mergeConfigs(this.maskDefaults,e)).owner=this,e=t.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,n,r,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,t){const n=this,{element:r}=n,i=n._width??n._oldWidth,s=n._height,o=r.offsetWidth,a=r.offsetHeight;n.floating&&t&&n.onFloatingWidgetResize(...arguments),n.suspendResizeMonitor||i===o&&s===a||(n.onInternalResize(r,o,a,i,s),n.trigger("resize",{width:o,height:a,oldWidth:i,oldHeight:s}))}onFloatingWidgetResize(e,t,n){const r=this,{lastAlignSpec:i,constrainTo:s}=r;if(r.isVisible&&i&&i.target){const e=!t||n.height!==t.height,o=!t||n.width!==t.width,a=s&&!Ot.from(s).contains(Ot.from(r.element,null,!0));(e&&2!==i.zone||o&&1!==i.zone||a)&&r.requestAnimationFrame((()=>r.realign()))}}updateScale(){const e=this,t=e.element,n=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const r=Ot.client(n).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(r,1):r;t.style.transform=`scale(${i})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&r>1&&(e.width=e.configuredWidth*r)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const n=e.split(" "),r=n.length;return 1===r?n[1]=n[2]=n[3]=n[0]:2===r?(n[2]=n[0],n[3]=n[1]):3===r&&(n[3]=n[1]),[isFinite(n[0])?`${n[0]}${t}`:n[0],isFinite(n[1])?`${n[1]}${t}`:n[2],isFinite(n[2])?`${n[2]}${t}`:n[3],isFinite(n[3])?`${n[3]}${t}`:n[4]]}get documentRoot(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.documentRoot)||this.element.getRootNode()}get eventRoot(){var e,t;return null!==(e=this.element)&&void 0!==e&&e.isConnected?Yn.getRootElement(this.element):(null===(t=this.owner)||void 0===t?void 0:t.eventRoot)||this._rootElement}get rootElement(){const e=this;if(!e._rootElement){var t,n;let r=(null===(t=e.owner)||void 0===t?void 0:t.rootElement)||Yn.getRootElement(e.forElement||(null!==(n=e.element)&&void 0!==n&&n.isConnected?e.element:e.getRenderContext()[0]||e.element));r||(r=document.body),e._rootElement=r}return e._rootElement}get floatRoot(){const{rootElement:e}=this;let{floatRoot:t}=e;if(t)e.contains(t)||e.appendChild(t);else{var n;const{outerCls:r}=oc,i=null===(n=Yn.getThemeInfo(null,e))||void 0===n?void 0:n.name;if(!Yn.isValidFloatRootParent(e))throw new Error("Attaching float root to wrong root");i&&r.push(`b-theme-${i.toLowerCase()}`),t=e.floatRoot=Yn.createElement({className:`b-float-root ${r.join(" ")}`,parent:e}),$d.push(t),c.isAndroid&&(t.style.height="100dvh",Jt.on({element:globalThis,orientationchange:()=>t.style.height=`${screen.height}px`,thisObj:this})),ir.ion({theme:({theme:e,prev:n})=>{t.classList.add(`b-theme-${e.toLowerCase()}`),t.classList.remove(`b-theme-${n.toLowerCase()}`)}})}return t.classList.toggle("b-rtl",Boolean(this.rtl)),t}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach((t=>{const n=parseInt(getComputedStyle(t).zIndex||0,10);n>e&&(e=n)})),e}get focusVisible(){return Yn.getActiveElement(this.element).matches(":focus-visible")}static get focusVisible(){return Yn.getActiveElement().matches(":focus-visible")}static get floatRoots(){return $d}static removeFloatRoot(e){$d.splice($d.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:t}=c;return t&&e.push(`b-${t}`),c.isTouchDevice&&e.push("b-touch-events"),c.isMobile&&e.push("b-mobile"),Yn.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),c.isChrome?e.push("b-chrome"):c.isSafari?e.push("b-safari"):c.isFirefox&&e.push("b-firefox"),c.isPhone&&e.push("b-phone"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this,{_isAnimatingCounter:n}=t;t._isAnimatingCounter=Math.max(0,n+(e?1:-1)),0===n&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):1!==n||e||(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationEnd",{checkLog:!1})}async executeAndAwaitAnimations(e,t){const n=e.getAnimations({subtree:!0});await t();const r=e.getAnimations({subtree:!0}),i=nt.delta(n,r).onlyInB.filter((e=>e.effect.getTiming().iterations!==1/0));i.length&&await Promise.allSettled(i.map((e=>e.finished)))}static query(e,t=!1){const{idMap:n}=oc.identifiable;for(const r in n)if(oc.widgetMatches(n[r],e,t))return n[r];return null}static queryAll(e,t=!1){const{idMap:n}=oc.identifiable,r=[];for(const i in n)oc.widgetMatches(n[i],e,t)&&r.push(n[i]);return r}static fromElement(e,t,n){const r=typeof t;e&&!e.nodeType&&(e=e.target),("number"===r||t&&t.nodeType===Element.ELEMENT_NODE)&&(n=t,t=null);let i,s,o,a=e,l=0;for("number"!=typeof n&&(i=n,n=Number.MAX_VALUE),"string"===r&&(t=t.toLowerCase());a&&a.nodeType===Element.ELEMENT_NODE&&l<n&&a!==i;){if(s=a.dataset&&a.dataset.ownerCmp||a.id,s){if(o=oc.getById(s),o){if(!t)return o;if("function"===r){if(t(o))return o}else if(oc.widgetMatches(o,t,!0))return o}l++}a=Hn(a)}return null}static fromSelector(e){const t=document.querySelector(e);return t?oc.fromElement(t):null}triggerFieldChange(e,t=!0){var n;t?this.trigger("change",e):e.source=this,null===(n=this.eachAncestor)||void 0===n||n.call(this,(t=>{var n,r;if(null===(n=t.onFieldChange)||void 0===n||n.call(t,e),null!==(r=t.isolateFieldChange)&&void 0!==r&&r.call(t,this))return!1}))}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){ir.setupFocusListenersOnce(this.eventRoot,Jt)}static widgetMatches(e,t,n){return"*"===t||("function"==typeof t?t(e):oc.isType(e,t,n))}static attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),oc.create(Object.assign({forElement:e},t),"tooltip"),e}static append(e,t={}){return(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),nt.asArray(e).map((e=>oc.create(W.assign({},t,e))))}changeDock(e){return"start"===e?"left":"end"===e?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget((t=>{"rtl"in t.initialConfig||(t.rtl=e)})),this.ownedWidgets&&Object.values(this.ownedWidgets).forEach((t=>{"rtl"in t.initialConfig||(t.rtl=e)}))}get scrollAction(){let{_scrollAction:e}=this;return!e&&this.anchor&&(e="realign"),e}announceAriaLive(e){var t;null!==(t=this.element)&&void 0!==t&&t.isConnected&&(this.ariaLiveEl||(this.ariaLiveEl=Yn.createElement({parent:this.element,class:"b-arialive-el","aria-live":"polite"})),this.ariaLiveEl.textContent=(null==e?void 0:e.text)||e)}}const ac=oc.prototype;["compose","domSyncCallback"].forEach((e=>ac[e].$nullFn=!0)),oc.initClass(),Yn.Widget=oc,ir.Widget=oc,Object.assign(globalThis.bryntum||(globalThis.bryntum={}),{Widget:oc,get:(e=globalThis.$0)=>e.nodeType?oc.fromElement(e):oc.getById(e),query:oc.query,queryAll:oc.queryAll,fromElement:oc.fromElement,fromSelector:oc.fromSelector}),oc._$name="Widget";class lc extends(Qe.mixin(lt,ds)){static type="default";static configurable={owner:null,containerCls:"b-auto-container",itemCls:null};static factoryable={defaultType:"default"};get contentElement(){var e;return null===(e=this.owner)||void 0===e?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:t,itemCls:n}=e,{contentElement:r,items:i}=t,s=t.itemCls,o=null==i?void 0:i.length;if(o){t.textContent=!1;for(let e,a,l=0;l<o;l++){const o=i[l],{element:d,positionable:c}=o,{classList:u}=d;d.dataset.itemIndex=l,u.contains("b-outer")&&u.remove(...oc.outerCls),n&&u.add(n),s&&u.add(s),a=r,c&&(e=t.getPositionableLocation(c),(a=e[0])||(a=e[1].parentElement,o.insertBefore=e[1])),o.render(a,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const t=this,{element:n}=e,{owner:r,itemCls:i}=t,{contentElement:s}=r,o=r.itemCls;s.contains(n)&&n.remove(),delete n.dataset.itemIndex,i&&n.classList.remove(i),o&&n.classList.remove(o),t.fixChildIndices(),t.syncChildCount()}appendChild(e){const{element:t}=e,{owner:n,itemCls:r}=this,{contentElement:i}=n,s=n.itemCls;t.dataset.itemIndex=n.indexOfChild(e),n.textContent=!1,r&&t.classList.add(r),s&&t.classList.add(s),e.render(i,Boolean(n.isPainted)),this.syncChildCount()}insertChild(e,t){const n=this,{element:r}=e,{owner:i,itemCls:s}=n,{contentElement:o}=i,a=Yn.getChild(o,`[data-item-index="${t}"]`),l=i.itemCls;i.textContent=!1,s&&r.classList.add(s),l&&r.classList.add(l);const d=o.contains(r);o.insertBefore(r,a),d||e.render(null,Boolean(i.isPainted)),n.fixChildIndices(),n.syncChildCount()}fixChildIndices(){this.owner.items.forEach(((e,t)=>{e.element.dataset.itemIndex=t}))}syncChildCount(){var e;const{owner:t}=this,{length:n}=t.items;null===(e=t.contentElement)||void 0===e||e.classList[1===n?"add":"remove"]("b-single-child")}syncConfigLater(e){const t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}syncConfigStyle({name:e,style:t,classes:n,map:r}){const i=this,s=`b-box-${e}-`,{contentElement:o}=i,a=i[e];let l=(null==r?void 0:r[a])||a;if(o){if(n){const{classList:e}=o;n.forEach((t=>{t!==l&&e.remove(s+t)})),n.includes(l)&&(e.add(s+l),l="")}o.style[t]=l}else i.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:t}=e;let n;if(t)for(e.pendingConfigs=null;n=t.pop();)e[e.$meta.configs[n].updater](e[n])}}lc.initClass(),lc._$name="Layout";let dc=0;const cc=e=>e.ripple;class uc extends oc{static $name="Ripple";static type="ripple";static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}afterConstruct(){super.afterConstruct(),Jt.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var t;const n=this;n.show();const r=Yn.getStyleValue(n.circleElement,"animationName");n.hide(),null===(t=n.listenerDetacher)||void 0===t||t.call(n),r&&"none"!==r&&(n.listenerDetacher=Jt.on({mousedown:{element:n.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:n.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:n.circleElement,handler:"onAnimationEnd"},thisObj:n}),"mousedown"===e.type&&(n.onMousedown(e),ir.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){dc=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-dc>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=oc.fromElement(e.target,cc);if(t){const n=t.ripple,r=n.delegate?e.target.closest(n.delegate):t.focusElement||t.element;if(r){const i=W.assign({event:e,target:r,radius:this.radius},n);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=Jt.getClientPoint(e),target:n=e.target,clip:r=n,radius:i=this.radius,color:s=this.color}){this.clip=r;const o=this,a=(r=Ot.from(r,null,!0)).getDelta(t),l=o.rippleElement.style,d=o.circleElement,c=Yn.getStyleValue(n,"border-radius");o.hide(),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=`${i}px`,o.element.style.borderRadius=c,d.setAttribute("r",i),d.setAttribute("fill",s),o.showBy({target:r,align:"c-c",matchSize:!0})}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}}oc.RippleClass=uc,uc._$name="Ripple";const hc=e=>e.element.classList.contains("b-visible"),gc=e=>!hc(e)&&e.isVisible;class mc extends oc{static $name="Mask";static type="mask";static configurable={autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,target:{$config:"nullify",value:void 0},text:null,type:null,showDelay:null,useTransition:!1};static delayable={deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}};static counter=0;static get(e){return Vl.get(e,"masks")||Vl.set(e,"masks",[])}static getActive(e){return mc.get(e).find(hc)||null}static getPending(e){return mc.get(e).filter(gc).sort(oc.weightSortFn)}static mask(e,t=document.body){return mc.new({target:t},e)}static mergeConfigs(...e){return e=e.map((e=>"string"==typeof e?{text:e}:e)),super.mergeConfigs(...e)}static sync(e){const t=mc.getActive(e),n=!t&&mc.getPending(e)[0]||null,r=t||n,i=(null==r?void 0:r.mode)||"",s=i.endsWith("blur")?`b-masked-${i}`:"";let o,a,l;for(o of(n&&(a=n.element.classList,n.showDelay&&!e.classList.contains("b-masked")&&(a.add("b-delayed-show"),n.delayedShow()),a.add("b-visible")),e.classList.toggle("b-masked",Boolean(r)),e.children))a=o.classList,a.contains("b-mask")||(l=Array.from(a).filter((e=>e.startsWith("b-masked-")&&s!==e)),l.length&&a.remove(...l),s&&a.add(s))}static unmask(e=document.body){var t;const n=mc.get(e),r=n.length;return r?null===(t=n[r-1])||void 0===t?void 0:t.close():null}static unmaskAll(e=document.body){return mc.get(e).filter((e=>!hc(e))).forEach((e=>e.destroy())),mc.unmask(e)}destroy(){"trial"!==this.type&&super.destroy()}compose(){const{icon:e,maxProgress:t,mode:n,progress:r,showDelay:i,text:s,html:o,useTransition:a}=this;return{class:{"b-mask":1,"b-delayed-show":i,"b-progress":t,"b-prevent-transitions":!a,[`b-mask-${n}`]:1},children:{maskContent:{class:"b-mask-content",children:{progressElement:t?{class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(r/t*100)))}%`}}:null,maskText:{class:"b-mask-text",html:`${e?`<i class="b-mask-icon ${e}"></i>`:""}${s||o||""}`}}}},listeners:{mousedown:"onMaskMouseDown",capture:!0}}}onMaskMouseDown(e){e.preventDefault()}generateAutoId(){const{type:e}=this;return`mask${"string"==typeof e?e.trim():""}-${mc.counter++}`}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,t;null===(e=this.owner)||void 0===e||null===(t=e.syncMaskCover)||void 0===t||t.call(e,this)}set error(e){this.setConfig({...this.errorDefaults,text:e})}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),null==e||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:t}=this;t.delay=e,e||t.flush()}changeTarget(e){return void 0===e?e=document.body:"string"==typeof e&&(e=this.owner[e]),e}updateTarget(e,t){const n=this,{id:r,element:i}=n,s=t&&mc.get(t);t&&(t[r]===n&&delete t[r],nt.remove(s,n),mc.sync(t)),e?(e[r]||(e[r]=n),i.parentNode!==e&&e.appendChild(i),nt.include(mc.get(e),n),mc.sync(e)):i.remove()}deferredClose(){var e;const t=this,{owner:n}=t;t.close().then((()=>{var e;return null==n||null===(e=n.onMaskAutoClose)||void 0===e?void 0:e.call(n,t)})),null==n||null===(e=n.onMaskAutoClosing)||void 0===e||e.call(n,t)}delayedShow(){this.element.classList.remove("b-delayed-show")}updateHidden(e,t){var n;null===(n=super.updateHidden)||void 0===n||n.call(this,e,t),e&&this.element.classList.remove("b-visible"),mc.sync(this.target)}afterShow(...e){var t;null===(t=super.afterShow)||void 0===t||t.call(this,...e),mc.sync(this.target)}afterHide(...e){var t;null===(t=super.afterHide)||void 0===t||t.call(this,...e),this.element.classList.remove("b-visible"),mc.sync(this.target)}async close(){await this.hide(),this.destroy()}}mc.initClass(),mc._$name="Mask";const pc=Object.freeze({}),{isArray:fc}=Array,vc=e=>e.weight,yc=e=>e&&!e.hidden,bc=e=>e.isFocusable,Cc=["display","flex-direction"],wc={default:1,box:1},Sc=Symbol("options");class Dc extends oc{static $name="Container";static type="container";static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},tabBarItems:null,defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:{$config:"lazy",value:null},overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateUserChangesOnly:!0,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const t=e.items||e.lazyItems;(this.hasItems=Boolean(t&&(fc(t)?t:Object.keys(t)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getPositionableItems(e,t){var n;const r=(null===(n=this._items)||void 0===n?void 0:n.filter((t=>e?t.positionable===e:t.positionable)))||[];return t?Object.fromEntries(r.map(((e,t)=>[`$${e.positionable}${t}`,e.element]))):r}getPositionableLocation(e){return[this.contentElement]}getAt(e){return this.ensureItems().at(e)}remove(...e){let t=!0;1===e.length&&(fc(e[0])?e=e[0]:t=!1);const n=this,{_items:r}=n,i=[];for(let t=0;t<e.length;t++){const s=e[t];r.includes(s)&&(r.remove(s),n.layout.removeChild(s),i.push(s),n.onChildRemove(s))}return t?i:i[0]}removeAll(){return this.remove(this.items)}add(...e){const t=this,n=t.ensureItems(),r=[];let i,s,o,a=!0;for(1===e.length&&(fc(e[0])?e=e[0]:a=!1),s=0;s<e.length;s++){var l;i=e[s],i.isWidget?i.parent=t:i=t.createWidget(i),null!=(null===(l=i)||void 0===l?void 0:l.weight)?(o=nt.findInsertionIndex(i,n.values,oc.weightSortFn),r.push(t.insert(i,o))):i&&(n.includes(i)||(n.add(i),t.onChildAdd(i),t.layout.appendChild(i),r.push(i)))}return a?r:r[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,t){const n=this,r=n.ensureItems();e instanceof oc?e.parent=n:e=n.createWidget(e),r.includes(t)&&(t=n.indexOfChild(t)-1),t=Math.min(t,r.count);const i=r.values;if(i.includes(e)){var s;const o=i.indexOf(e);i.splice(o,1),i.splice(t,0,e),r.values=i,n.syncChildCount(),null===(s=n.onChildMove)||void 0===s||s.call(n,e),n.layout.insertChild(e,t<o?t:t+1)}else i.splice(t,0,e),r.values=i,n.onChildAdd(e),n.layout.insertChild(e,t);return e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}onChildWeightChange(e){if(this.items.length>1){var t;const{lastItem:n}=this;this._items.sort(oc.weightSortFn);const{items:r}=this;this.contentElement.insertBefore(e.element,(null===(t=r[r.indexOf(e)+1])||void 0===t?void 0:t.element)||n.element.nextSibling)}}changeItems(e,t){const n=this,r=[],i=new po;return fc(e)?n.processItemsArray(e,r):e&&n.processItemsObject(e,n.namedItems,r),r.some(vc)&&r.sort(oc.weightSortFn),i.add(r),t&&t.forEach((e=>{n.remove(e),i.includes(e)||e._createdBy!==n||e.destroy()})),i}afterConstruct(){const{rtl:e}=this,{classList:t}=this.contentElement;t.toggle("b-rtl",!0===e),t.toggle("b-ltr",!1===e)}updateRtl(e){super.updateRtl(e);const{contentElement:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}updateItems(e,t){let n=0;e.forEach((e=>{this.onChildAdd(e),t&&!t.temporary&&this.layout.insertChild(e,n),++n})),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new po,e._items.temporary=!0}return e._items.values}processItemsArray(e,t){const n=e.length;let r,i;for(r=0;r<n;r++)i=e[r],i instanceof oc?(i.parent=this,i.element.classList.remove(...oc.outerCls)):i=this.createWidget(i),i&&((i.ref||i.id)&&this.addDescendant(i),t.push(i))}processItemsObject(e,t,n=[]){let r,i;for(i in e)r=e[i],r&&(t&&i in t&&(r="object"==typeof r?W.merge(W.clone(t[i]),r):t[i]),r&&(r instanceof oc?r.parent=this:(r instanceof Object&&(r.ref=i),r=this.createWidget(r)),r&&(r.ref=i,this.addDescendant(r),n.push(r))));return n}onChildAdd(e){const t=this;if(e.innerItem&&t.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),t.onChildAddLayout(e),e.ref||e.id)for(let n=t;n;n=n.parent)n.addDescendant(e);t.syncChildCount(!0),!t.onConfigChange.$nullFn&&t.onConfigChange({name:"items",config:t.$meta.configs.items})}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var t;super.onChildHide(e),null!==(t=this._items)&&void 0!==t&&t.includes(e)&&this.syncChildCount(!0)}onChildShow(e){var t;super.onChildShow(e),null!==(t=this._items)&&void 0!==t&&t.includes(e)&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring&&!this.isDestroying){const t=this,{items:n,hasItems:r}=t,i=n.filter(yc),{length:s}=i;if(t.visibleChildCount=s,t.hideWhenEmpty&&e){const e=Boolean(!s);Boolean(t._hidden)!==e&&(t.hidden=e)}n.forEach((e=>e.element.classList.remove("b-last-visible-child","b-first-visible-child"))),s&&(i[0].element.classList.add("b-first-visible-child"),i[s-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(t.childItems.length),t.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),t.isComposable?r!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}syncFlexDirection(){const{contentElement:e,flexColCls:t,flexRowCls:n}=this,r=new Vt(e.className),i=Yn.getStyleValue(e,Cc);r[n]=r[t]=0,"flex"===i.display&&(r["row"===i["flex-direction"]?n:t]=1),Yn.syncClassList(e,r)}addDescendant(e){const t=e.ref||e.id,n=this._widgetMap||(this._widgetMap={});n[t]||(n[t]=e)}cleanupWidgetMap(e){const t=this,n=new Map,r=e.ref||e.id;r&&n.set(r,e),e.eachWidget((e=>{const t=e.ref||e.id;t&&n.set(t,e)}));for(let e=t;e;e=e.parent)for(const[t,r]of n)e.widgetMap[t]===r&&delete e.widgetMap[t]}onChildRemove(e){const t=this;t.cleanupWidgetMap(e),t.layout.onChildRemove(e),t.syncChildCount(!0),!t.onConfigChange.$nullFn&&t.onConfigChange({name:"items",config:t.$meta.configs.items})}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=null==e?pc:null,e}updateRecord(e){var t;const n=this;null===(t=n.recordUpdateDetacher)||void 0===t||t.call(n),n.trigger("beforeSetRecord",{record:e}),n.clearError(),n._hasChanges=!1,n.setValues(e,{onlyName:n.strictRecordMapping,highlight:Boolean(n.$highlight)}),n.autoUpdateFields&&null!=e&&e.firstStore&&(n.recordUpdateDetacher=e.firstStore.ion({update:n.onRecordUpdated,thisObj:n}))}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}shouldUpdateRecordOnAction(e,t){return e&&(t.userAction||!this.autoUpdateUserChangesOnly)}onFieldChange(e){const t=this,{source:n}=e,{hasChanges:r,isSettingValues:i,initialValues:s}=t;if(!i){if(!t.isConfiguring&&t.autoUpdateRecord&&t.shouldUpdateRecordOnAction(t.record,e)){const{strictRecordMapping:e,record:r}=t,{name:i,ref:s,isValid:o=!0,defaultBindProperty:a}=n,l=n[a||"value"],d=e?i:i||s;r&&d&&o&&(r.isModel?r.setValue(d,l):r[d]=l)}if(s){const e=n.getValueName(s[Sc]);e&&((t.changeSet||(t.changeSet={}))[e]=!W.isEqual(n.value,s[e]),t._hasChanges=Boolean(t.changeSet&&Object.values(t.changeSet).some((e=>e))))}t.hasChanges!==r&&t.trigger("dirtyStateChange",{dirty:t.hasChanges})}}get hasChanges(){return Boolean(this._hasChanges)}getValues(e){const t={};return this.eachWidget(((n,r)=>{n.isolateFields?r.down=!1:!("name"in n)||e&&!e(n)||(t[n.name]=n.value)}),!0),t}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return Boolean(this.assigningValues)}get assigningValues(){var e;return this._assigningValues||(null===(e=this.parent)||void 0===e?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,t){super.assignValue(e,t),this.isolateFields||this.setValues(e,t)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,t=this.assignValueDefaults){const n=this;n.assigningValues=t,n.initialValues={optionsProp:t},n.eachWidget((r=>{const i=r.getValueName(t);!i||e&&!(i in e)||(n.initialValues[i]=(null==e?void 0:e[i])||null),r.assignValue(e,t)}),!1),n.assigningValues=!1}get hasNoChildren(){const e=this,{items:t,lazyItems:n}=e.initialConfig,r=t&&(fc(t)?t:W.values(t)),i=n&&(fc(n)?n:W.values(n)),s=e.isConfiguring?i||r:e.items;return!(null!=s&&s.filter(yc).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const t=this;if(!t.isComposable){const n=Boolean(e&&t.hasNoChildren),{classList:r}=t.contentElement;n!==r.contains("b-text-content")&&(r[n?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}}updateLayoutStyle(e){Yn.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:e}=this.contentElement,{containerCls:t}=this.layout;e.add("b-content-element"),t&&e.add(t)}}onInternalPaint(){var e;null===(e=super.onInternalPaint)||void 0===e||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){const t=this,{element:n,contentElement:r}=t;(e=new MutationObserver((e=>t.onContentElMutation(e)))).observe(r,{attributes:!0}),r!==n&&e.observe(n,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(e){wc[this.layout.type]&&!this.textContent&&this.isVisible&&e.some((e=>this.contentElement.contains(e.target)))&&this.syncFlexDirection()}changeLayout(e,t){return lc.reconfigure(t,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}get childItemsOrderedByRelevance(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const n=this;"string"==typeof e?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&("checkbox"===t&&c.isMobile&&oc.resolveType("slidetoggle",!0)&&(t=e.type="slidetoggle"),t=oc.resolveType(t,!0));for(let r=(e=(t||oc).mergeConfigs(n.defaults,e,{parent:n})).parent;r;r=r.parent)if(!1===r.processWidgetConfig(e))return null;return!1===n.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}createWidget(e){const t=oc.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}updateDefaults(e,t){if(!this.isConfiguring&&e){const n=Object.entries(e);this.eachWidget((e=>{n.forEach((([n,r])=>{t&&e[n]!==t[n]||(e[n]=r)}))}),!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const{defaultFocus:e}=this;if("string"==typeof e)return this.element.querySelector(e);let t=e&&this.query(e);return e&&t||(t=this.query(bc,!0)),t?t.focusElement:super.focusElement}doDestroy(){var e;null===(e=this._items)||void 0===e||e.forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget((t=>{"isValid"in t&&t.isVisibleForValidation&&!t.isValid&&(e=!1)}),!0),e}clearError(){this.eachWidget((e=>{var t;return null===(t=e.clearError)||void 0===t?void 0:t.call(e)}))}}Dc.initClass(),Dc._$name="Container";const{assign:Ec}=W,xc=()=>performance.now(),Rc={start:!1},Tc=/^[.\d]+([^\d].*)?$/,Mc=e=>{const t=e.$bryntum||(e.$bryntum={});return t.transitions||(t.transitions=Object.create(null))},kc=(e,t)=>{var n;"string"==typeof e&&(t=null===(n=Tc.exec(e))||void 0===n?void 0:n[1],e=parseFloat(e));return e&&e*("s"===t||!t&&e<10?1e3:1)},Fc=e=>{const t=W.values(Mc(e)).filter((e=>null==e.completed)).map((e=>e.toString()));e.style.transition=t.join(", ")},Ic=e=>class extends e{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...e){super(...e),this.id=++Ac}start(){this.startTime=xc()}get delay(){var e;return kc(this._delay??(null===(e=this.owner)||void 0===e?void 0:e.delay)??0,this.unit)}set delay(e){this._delay=e}get duration(){const{owner:e,unit:t}=this;return kc(this._duration??(e?e.duration:Pc.defaultDuration),t)}set duration(e){this._duration=e}get elapsed(){return xc()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var e;return this._retain??(null===(e=this.owner)||void 0===e?void 0:e.retain)}set retain(e){this._retain=e}get timing(){var e;return this._timing??(null===(e=this.owner)||void 0===e?void 0:e.timing)}set timing(e){this._timing=e}get unit(){var e;return this._unit??(null===(e=this.owner)||void 0===e?void 0:e.unit)}set unit(e){this._unit=e}};let Ac=0;class Lc extends(Qe.mixin(Ic)){static $name="AnimatorTransition";static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:t,transitions:n}=e;let{property:r}=e;[r,e.to]=Yn.unitize(r,e.to),e.from=Yn.unitize(r,e.from)[1],e.promissory=new Cl,e.property=r;const i=n[r];n[r]=e;let{from:s}=e;i&&(e.from=i.to,s=null,i.destroy()),null===s&&(s=e.getCurrentStyleValue(),i||(e.from=s)),t.style[r]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return null===(e=this.promissory)||void 0===e?void 0:e.promise}get transitions(){return Mc(this.element)}clearStyle(){this.setStyle("")}finish(e){const t=this,{transitions:n,promissory:r,property:i}=t;r&&(t.completed=e,t.promissory=null,r.resolve(e),n[i]===t?(delete n[i],e||(Fc(t.element),t.clearStyle())):t.completed=!1)}getCurrentStyleValue(){return Yn.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:t,element:n,from:r,property:i,_retain:s,_timing:o}=this;return new Lc({element:n,property:i,retain:s,timing:o,duration:Math.round(Math.min(e,t)),reverting:this,to:r,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:t,duration:n,element:r,property:i}=e;Jt.onTransitionEnd({element:r,property:i,duration:t+n+20,thisObj:e.owner,handler:()=>{var t;return null===(t=e.finish)||void 0===t?void 0:t.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:t,property:n,timing:r}=this;return`${n} ${t}ms ${r||"ease-in-out"}${e?` ${e}ms`:""}`}}Lc.initClass();class Pc extends(Qe.mixin(Ic)){static $name="Animator";static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,t){W.isObject(e)?W.entries(e).forEach((e=>Pc.register(...e))):(Pc.fx[e]=t,Pc[e]=t=>(Yn.isElement(t)?t={element:t,[e]:{}}:delete(t={element:t.element,[e]:t})[e].element,Pc.run(t)))}static run(e){return new Pc(e).start()}constructor(e){var t;super(null);const n=this,r=[],i={};let s,o,a,l;if(Array.isArray(e))n.items=e;else for(a in e)(Pc.specialPropsRe.test(a)?n:i)[a]=e[a];W.keys(i).forEach((e=>{l=i[e],null!=l&&!1!==l&&l==l&&((o=Pc.fx[e])?(l=Ec(n.defaults,o(l,n,e)),l.owner=n,s=new Pc(l)):(l=Ec(n.defaults,"object"==typeof l?l:{to:l}),l.owner=n,l.property=e,s=new Lc(l)),r.push(s))})),null===(t=n.items)||void 0===t||t.forEach((e=>{W.isInstantiated(e)?e.owner=n:((e=Ec(n.defaults,e)).owner=n,e=new Pc(e)),r.push(e)})),n.items=r,n.promise=(1===r.length?r[0].promise:Promise.all(r.map((e=>e.promise)))).then((e=>{var t;return null===(t=n.finish)||void 0===t||t.call(n,e),n.completed||!1}))}doDestroy(){this.items.forEach((e=>e.destroy())),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:t,owner:n}=this;return e??(!t&&(!n||n.retain))}set retain(e){super.retain=e}done(){return this.promise}finish(e){var t,n;const r=this,{items:i}=r;for(Fc(r.element),r.completed="boolean"==typeof e?e:!e.some((e=>!e)),null===(t=r.prefinalize)||void 0===t||t.call(r,r.completed,r);i.length;)i.pop().destroy();null===(n=r.finalize)||void 0===n||n.call(r,r.completed,r)}revert(e){const t=this,{reverting:n}=t,r=!e||(e.start??!0);let i=t.defaults;return n&&(n.finalize&&(i.finalize=n.finalize),n.prefinalize&&(i.prefinalize=n.prefinalize),i.retain=n._retain),i=Ec(i,e,{items:t.items.map((e=>e.revert(Rc))),reverting:t}),i=new Pc(i),r&&i.start(),i}start(){const{element:e,items:t}=this;return super.start(),t.length&&(Fc(e),t.forEach((e=>e.start()))),this}}Pc.initClass().Transition=Lc,Pc.specialPropsRe=new RegExp(`^(?:${Object.keys(Pc.prototypeProperties).concat(Object.keys(Pc.superclass.prototypeProperties)).map((e=>"_"===e[0]?e.substr(1):e)).join("|")})$`),Pc.defaultDuration=200,Pc.fx={},Pc.register({puff:e=>(!0===e?e={}:"object"!=typeof e?e={transform:`scale(${e})`}:e.scale&&((e=W.clone(e)).transform=`scale(${e.scale})`,delete e.scale),Ec({opacity:0,transform:"scale(8)"},e))}),Pc._$name="Animator";class Oc extends(Qe.mixin(Hi)){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;null===(e=this.mousedownRemover)||void 0===e||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,t,n;const r=this;null===(e=r.activeElement)||void 0===e||e.classList.remove(r.pressedCls),r.activeElement=null,null===(t=r.acceleration)||void 0===t||t.cancel(),r.activeListenerRemover=null===(n=r.activeListenerRemover)||void 0===n?void 0:n.call(r),r.clearTimeout(r.autoRepeatTimer),r.clearTimeout(r.repeatTimer)}updateElement(e){var t;null===(t=this.mousedownRemover)||void 0===t||t.call(this),this.mousedownRemover=Jt.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const t=this,n=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),n&&(t.activeElement=n,t.triggerEvent=e,n.classList.add(t.pressedCls),t.activeListenerRemover=Jt.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:n,handler:"onTargetMouseMove"},mouseleave:{element:n,handler:"onTargetMouseLeave"},mouseenter:{element:n,handler:"onTargetMouseEnter"},thisObj:t}),t.autoRepeatTimer=t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=ee.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}Oc._$name="ClickRepeater";const $c=/^(?:undefined|null|LEFT|RIGHT)$/,_c={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},Hc=e=>{const t=null==e?void 0:e.toUpperCase();return[t,"LEFT"===t||"RIGHT"===t]};var Vc=e=>class extends(e||Qe){static $name="Rotatable";static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:e}=this;return{class:{[`b-rotate-${(e||"").toLowerCase()}`]:e,"b-rotate-vertical":e}}}syncRotationToDock(e){if($c.test(String(this.rotate))){const[t,n]=Hc(e);this.rotate=n?this.invertRotate?_c[t]:t:null}}get widgetClass(){return null}};class Nc extends(oc.mixin(Vc)){static $name="Tool";static type="tool";static configurable={align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null,role:""};compose(){const{align:e,href:t}=this;return{tag:null!=t?"a":"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,t;if(null!==(e=this.parent)&&void 0!==e&&e.isPanel&&null!==(t=this.element)&&void 0!==t&&t.parentNode.matches(".b-panel-header"))return this.parent}changeAlign(e){return e}onInternalClick(e){const t=this,{handler:n,panel:r}=t,i={domEvent:e,tool:t};t.disabled||(t.trigger("click",i),t.isDestroyed||(t.trigger("action",i),t.isDestroyed||!1===(null==r?void 0:r.trigger("toolClick",i))||n&&t.callback(n,r,[e,r,t])))}onInternalKeyDown(e){"Enter"===(e.key.trim()||e.code)&&e.stopPropagation()}updateDisabled(e,t){var n;super.updateDisabled(e,t),e&&(null===(n=this.repeat)||void 0===n||n.cancel())}changeRepeat(e,t){return null==t||t.destroy(),e&&Oc.new({element:this.element},e)}changeTooltip(e,t){const n=this,r=(null==e?void 0:e.html)||e;return n.ariaLabel||n.text||"string"!=typeof r||(n.ariaLabel=n.optionalL(r,n)),super.changeTooltip(e,t)}}Nc.initClass(),Nc._$name="Tool";const Bc=/right/i,zc=e=>(e.collapsed||e.collapsing)&&"top"===e.owner.expandedHeaderDock&&e.owner.collapsible.direction.match(Bc)?"start":"end";class jc extends Nc{static $name="CollapseTool";static type="collapsetool";static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:t}=this;return{"aria-label":this.L(`L{PanelCollapser.${e?"Expand":"Collapse"}}`),class:{[`b-icon-collapse-${t}`]:1,"b-collapsed":e}}}changeAutoAlign(e){return!0===e?zc:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}}jc.initClass(),jc._$name="CollapseTool";const Wc=/^(?:UP|DOWN|LEFT|RIGHT)$/,Uc=/^(left|top)$/i,Gc={},Yc=/^b-dock-(top|left|right|bottom)$/,qc="b-panel-collapse-revealer",Kc=/^(?:left|right)$/i,Xc="b-collapse-unflex",{round:Zc}=Math,Jc=["up","down","left","right"].reduce(((e,t)=>(e[t.toUpperCase()]=e[t]=t,e)),{}),Qc={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},eu={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},tu={h:"w",w:"h"},nu={up:"top",right:"right",down:"bottom",left:"left"},ru={top:!1,right:!0,bottom:!1,left:!0},iu={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},su={top:e=>`translate(0, -${Zc(e.height||0)}px)`,bottom:e=>`translate(0, ${Zc(e.height||0)}px)`,right:e=>`translate(${Zc(e.width||0)}px, 0)`,left:e=>`translate(-${Zc(e.width||0)}px, 0)`};let ou=0;class au extends(Qe.mixin(ds)){static $name="PanelCollapser";static type="inline";static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var t;null===(t=this.collapsible)||void 0===t||t.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return"collapsing"===this.collapsingExpanding}get collapsingExpanding(){var e;const t=null===(e=this.currentOperation)||void 0===e?void 0:e.collapsing;return null==t?null:t?"collapsing":"expanding"}get currentDock(){var e;return(null===(e=this.panel)||void 0===e||null===(e=e.header)||void 0===e||null===(e=e.dock)||void 0===e?void 0:e.toLowerCase())??"top"}get expanding(){return"expanding"===this.collapsingExpanding}get collapseTool(){var e;return null===(e=this.panel)||void 0===e||null===(e=e.tools)||void 0===e?void 0:e.collapse}get collapseDim(){return Kc.test(this.collapseDir)?"width":"height"}getCollapseDir(e){let{direction:t,panel:n}=this;if(!t||Wc.test(t)){const e=null==n?void 0:n.placement;var r;if(e)t=eu[e];else t=iu[(null==n||null===(r=n.header)||void 0===r?void 0:r.dock)||"top"]}return e?Jc[t]:t}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:e}=this,t=e.hasHeader&&e.expandedHeaderDock;let n=nu[this.collapseDir],r=!1;return t&&((r=ru[n]!==ru[t])||(n=t)),[n,r]}get toolsConfig(){const{direction:e,tool:t}=this;return t&&{collapse:W.assign({direction:e.toLowerCase()},t)}}beforeCollapse(e){const{panel:t}=this,{element:n}=t;n.matches(":focus-within")&&t.revertFocus(!0)}changeTool(e){const t=this,{panel:n}=t;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={collapse:e}}collapse(e){var t;const n=this,{panel:r}=n,i={id:++ou,completed:!1,panel:r};let{currentOperation:s}=n;return e=e??!0,W.isObject(e)&&(i.collapsed=!0,W.assign(i,e),e=i.collapsed,delete i.collapsed),i.collapsing=e,i.previous=s??null,e!==n.collapsed?s?s.collapsing!==e&&(i.animation=s.animation.revert({finalize(){var e;null===(e=n.collapseFinalize)||void 0===e||e.call(n,i,!0)}}),i.collapsing=e,s=i):(i.animation=W.clone(("animation"in i?i:n).animation),!1!==n.beforeCollapse(i)&&(i.animation&&(i.animation.finalize=e=>{var t;return null===(t=n.collapseFinalize)||void 0===t?void 0:t.call(n,i,e)}),r.changingCollapse=!0,n[e?"collapseBegin":"expandBegin"](i),i.animation?s=i:(i.completed=!0,n[e?"collapseEnd":"expandEnd"](i)),r.changingCollapse=!1,i.animation||n.onComplete(e?"collapse":"expand"))):s&&s.collapsing!==e&&(n[e?"expandRevert":"collapseRevert"](i),i.animation=s.animation.revert({finalize(){var e;null===(e=n.collapseFinalize)||void 0===e||e.call(n,i,!1)}}),s=i),n.currentOperation=s,(null===(t=s)||void 0===t||null===(t=t.animation)||void 0===t?void 0:t.done())??Promise.resolve(e===n.collapsed)}collapseFinalize(e,t){const n=this,{currentOperation:r,panel:i}=n,s=i.collapsed?"expand":"collapse";r===e&&(n.currentOperation=null,e.completed=t,i.changingCollapse=!0,n[s+"End"](e),i.changingCollapse=!1,t&&n.onComplete(s))}applyHeaderDock(e,t=!0){const{currentDock:n,panel:r}=this,{header:i}=r,s=e?this.collapseDock:r.expandedHeaderDock;s!==n&&r.hasHeader&&(r.header=i?"string"==typeof i?{title:i}:W.clone(r.header):{},r.header.dock=s,t&&r.recompose.flush())}composeHeader(e){const{panel:t}=this,{class:n}=e,r=t.expandedHeaderDock||Object.keys(n).filter((e=>n[e]&&Yc.test(e))).map((e=>Yc.exec(e)[1][0]));return n[qc]=1,n[`b-collapsible-${r[0]}${this.collapseDir[0]}`]=1,e}composeTitle(e){return e.class[qc]=1,e}collapseBegin(e){var t;const n=this,{animation:r}=e,{collapseDim:i,collapseTool:s,panel:o}=n,{element:a,placement:l}=o,[d,c]=n.collapseInfo,u=null==s?void 0:s.element.classList,h=!l||"h"===l[0]&&"width"===i||"v"===l[0]&&"height"===i;n.configuredWidth=o._lastWidth,n.configuredHeight=o._lastHeight,n.transverseCollapse=c,n.applyHeaderDock(!0);const g=o.rectangle(),m=n.lockInnerSize().moveTo(0,0),p=m.clone(),f=Qc[d],v=null===(t=o.headerElement)||void 0===t?void 0:t.getBoundingClientRect(),y=Zc((null==v?void 0:v[i])||0);a.classList.toggle(Xc,h),r?(p[f[0]]=p[f[1]],a.classList.add("b-collapsing"),null==u||u.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),u&&(u.remove("b-collapsed"),o.rectangle(),u.remove("b-collapsing"),u.add("b-collapsed")),r.element=a,r.retain=!0,r[i]={from:Zc(g[i]),to:y},r.items=[{element:n.innerElement,retain:!1,clip:{from:`rect(${m})`,to:`rect(${p})`}}],c&&r.items.push({element:o.headerElement,duration:r.duration,retain:!1,transform:{from:su[d](v),to:"translate(0, 0)"}}),e.animation=Pc.run(r)):(a.style[i]=`${y}px`,s&&(u.add("b-collapsing","b-collapsed"),s.rectangle(),u.remove("b-collapsing")))}collapseEnd(e){const t=this,{collapseTool:n}=t;t.panel.isDestroyed||(t.panel.element.classList.remove("b-collapsing"),n&&(n.collapsing=!1),e.completed?t.collapsed=!0:(t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1)))}collapseRevert(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.remove("b-collapsed")}expandBegin(e){const t=this,{animation:n}=e,{collapseDim:r,collapseTool:i,panel:s}=t,[o,a]=t.collapseInfo,{element:l}=s,d=l.classList,c=d.contains(Xc),u=s.rectangle();d.remove("b-collapsed","b-collapsing"),s.element.style[r]="",t.restoreConfiguredSize(),t.lockInnerSize(!1);const h=s.rectangle(),g=t.lockInnerSize().moveTo(0,0),m=g.clone(),p=Qc[t.collapseDock];null==i||i.element.classList.remove("b-collapsed"),n&&(m[p[0]]=m[p[1]],d.add("b-collapsed","b-expanding"),c&&d.add(Xc),n.element=l,n[r]={from:Zc(u[r]),to:Zc(h[r])},n.items=[{element:t.innerElement,retain:!1,clip:{from:`rect(${m})`,to:`rect(${g})`}}],a&&n.items.push({element:s.headerElement,duration:n.duration,retain:!1,transform:{from:"translate(0, 0)",to:su[o](u)}}),e.animation=Pc.run(n))}expandEnd(e){const t=this;t.panel.element.classList.remove("b-expanding"),e.completed&&(t.collapsed=!1,t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}expandRevert(e){var t;null===(t=this.collapseTool)||void 0===t||t.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const t=!0===e;return(t||null==e)&&(e=this.collapseDim[0],(t||"absolute"===Yn.getStyleValue(this.panel.element,"position"))&&(e+=tu[e])),e||""}lockInnerSize(e=!0){const t=this,{innerElement:n,panel:r}=t,i=e?t.supportAxis:"",s=r.element,o=r.headerElement,a=e&&o&&Ot.from(o,s),l=e&&Ot.from(t.innerSizeElement,s),d=n.style;return o&&(o.style.minWidth=i.includes("w")?`${a.width}px`:"",o.style.minHeight=i.includes("h")?`${a.height}px`:""),d.width=e?`${l.width}px`:"",d.height=e?`${l.height}px`:"",n.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let t=!this.collapsing&&(!!this.expanding||!this.collapsed);e.altKey&&(t={animation:null,collapsed:t}),this.collapse(t)}onComplete(e){var t,n;null===(t=this.panel)||void 0===t||null===(n=t.trigger)||void 0===n||n.call(t,e)}onPanelHeaderClick({event:e}){0===e.button&&this.panel.collapsed&&e.target.classList.contains(qc)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:t}){const n=this,{panel:r}=n;"collapsed"===e?r.isPainted&&(n.collapsed=t):"header"!==e||r.changingCollapse||n.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){const{configuredHeight:t,configuredWidth:n,panel:r}=this;e=e??"wh",r.element.classList.remove(Xc),null!=n&&e.includes("w")&&(r.width=n),null!=t&&e.includes("h")&&(r.height=t)}splitHeaderItems({as:e,dock:t}=Gc){var n;return null===(n=this.panel)||void 0===n?void 0:n.splitHeaderItems({as:e,dock:t,alt:!0})}syncDirection(){const e=this,{direction:t}=e;t&&!Wc.test(t)||(e.direction=e.getCollapseDir())}changeCollapsed(e){return Boolean(e)}updateCollapsed(e){const{collapseTool:t,panel:n}=this;n&&(n.collapsed=e,n.element.classList[e?"add":"remove"]("b-collapsed")),t&&(t.collapsed=e)}updateDirection(e){const{collapseTool:t,panel:n}=this;t&&(t.direction=Jc[e]),null!=n&&n.rendered&&n.recompose()}updatePanel(e){var t;const n=this;n.syncDirection(),null===(t=n.panelChangeDetacher)||void 0===t||t.call(n),n.panelChangeDetacher=e&&ee.after(e,"onConfigChange","onPanelConfigChange",n,{return:!1})}wrapCollapser(e,t){var n;const r=this,[i,s]=r.collapseInfo;if(!s)return[e,t];const{collapseDir:o,panel:a}=r,{expandedHeaderDock:l,header:d,uiClassList:c}=a,u=null===(n=a.tools)||void 0===n?void 0:n.recollapse,[h,g]=r.splitHeaderItems({as:"element",dock:i}),m=a.hasHeader?a.title||(null==d?void 0:d.title)||" ":null,p=m&&{tag:"header",class:new Vt({...c,[`b-dock-${l}`]:1,"b-panel-header":1,"b-panel-collapser-header":1},null==d?void 0:d.cls),style:null==d?void 0:d.style,children:[...h,{reference:"collapserTitleElement",html:m,class:{...c,[`b-align-${(null==d?void 0:d.titleAlign)||"start"}`]:1,"b-header-title":1}},...g]};return u&&(u.direction=o),["collapseWrapElement",{class:{...c,[`b-panel-collapser-header-${l}`]:1,[`b-panel-collapser-${o}`]:1,[`b-${ru[l]?"h":"v"}box`]:1,"b-panel-collapser":1,"b-box-center":1},children:Uc.test(l)?{collapserHeaderElement:p,[e]:t}:{[e]:t,collapserHeaderElement:p}}]}}au.maps={clipByDock:Qc,dockByDirection:nu,dockIsHorz:ru},au.initClass(),au._$name="PanelCollapser";const lu=Symbol("pendingCreate");class du extends Qe{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get:(t,n)=>e.get(n),set:(t,n,r)=>(e.set(n,r),!0),deleteProperty:(t,n)=>(e.set(n,null),!0)})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){const n=this,{transform:r}=n,i=r?r(t,e):t,s=W.isInstantiated(i);n.instances[e]=lu,s||n.setDefaults(e,i),n.defineProp(e,!0),s&&n.set(e,i)}defineProp(e,t){const n=this,{object:r}=n;n.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(r):r,e,{configurable:!t,enumerable:!0,get:()=>n.get(e),set:t=>n.set(e,t)})}flush(){const e=this;try{var t;e.updating=!0;for(const t in e.defaults)e.get(t);e.afterConfigureOwner=null===(t=e.afterConfigureOwner)||void 0===t?void 0:t.call(e)}finally{e.updating=!1}}get(e){const{defaults:t,instances:n}=this;return n[e]===lu&&this.set(e,lu),n[e]||t[e]&&null}set(e,t){const n=this,{cleanup:r,configName:i,defaults:s,factory:o,instances:a,owner:l,setup:d,transform:c,updating:u}=n,h=l&&i&&!u,g=a[e]===lu?null:a[e],m=o.reconfigure(g,t===lu?{}:t||null,{cleanup:r&&(t=>r(t,e)),defaults:s[e]||n.setDefaults(e,{}),owner:n.owner,setup:d&&((t,n,r)=>d(t,e,n,r)),transform:c&&(t=>c(t,e))});if(m!==g){const t=h&&{...a};var p;if(a[e]=m,m)n.defineProp(e),null===(p=n.created)||void 0===p||p.call(n,m,e);else delete n.object[e],delete a[e];h&&l.onConfigChange({name:i,config:l.$meta.configs[i],value:n.target,was:t})}}setDefaults(e,t){const{defaults:n,factory:r,inferType:i,instances:s,owner:o,ownerName:a}=this,{typeKey:l}=r.factoryable;return t=!0===t?{}:W.assign({},t),("name"===i||!0===i&&!t[l])&&(t[l]=e),a&&(t[a]=o),t.beforeConfigure=t=>{s[e]=t},n[e]=t}update(e){const t=this,{owner:n}=t;let r,i;try{if(t.updating=!0,e)for(r in e)i=e[r],t.defaults[r]?t.set(r,i):i&&t.define(r,i);else for(r in t.instances)t.set(r,null)}finally{t.updating=!1}n&&(n.isConfiguring?t.afterConfigureOwner||(t.afterConfigureOwner=ee.before(n,"afterConfigure","flush",t)):t.flush())}}du.initClass(),du._$name="DynamicObject";const cu=[],uu={},hu={align:1,weight:1};var gu=e=>class extends(e||oc){static $name="Toolable";static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(e,t){return(e.weight||0)-(t.weight||0)}byWeightReverseSortFn(e,t){return(t.weight||0)-(e.weight||0)}gatherTools({align:e,alt:t,refs:n}=uu){const{collapsed:r,tools:i}=this,s={collapsed:r,alt:t};let o,a,l,d,c,u=[];for(a in i){var h,g;c=i[a],o=(null===(h=c)||void 0===h||null===(h=h.align)||void 0===h?void 0:h.align)??(null===(g=c)||void 0===g?void 0:g.align)??"end",o===e&&c.isCollapsified(s)&&u.push(c)}if(u.sort(this["end"===e?"byWeightReverseSortFn":"byWeightSortFn"]),n){const e="widget"===n,t={};for(l=0;l<u.length;++l)d=u[l],t[d.ref]=e?d:d.element;u=t}return u}getEndTools({alt:e,refs:t}=uu){return this.gatherTools({align:"end",alt:e,refs:t})}getStartTools({alt:e,refs:t}=uu){return this.gatherTools({align:"start",alt:e,refs:t})}get childItems(){return[...this.getStartTools(),...this._items||cu,...this.getEndTools()]}changeTools(e,t){const n=this,r=n.$tools||(n.$tools=new du({configName:"tools",factory:oc,inferType:!1,owner:n,created(e){var t,i;e.innerItem=!1,null===(t=e.syncRotationToDock)||void 0===t||t.call(e,null===(i=n.header)||void 0===i?void 0:i.dock),ee.after(e,"onConfigChange",((e,{name:t})=>{hu[t]&&n.onConfigChange({name:"tools",value:r.target})})),n.onChildAdd(e)},setup:(e,t)=>((e=W.merge({},n.toolDefaults["*"],n.toolDefaults[t],e)).parent=n,e.ref=t,e)}));if(r.update(e),!t)return r.target}get widgetClass(){}};const mu=["b-hbox","b-vbox"],pu={name:"align",style:"alignItems"},fu={name:"contentAlign",style:"alignContent"},vu={name:"direction",style:"flexDirection"},yu={name:"justify",style:"justifyContent",classes:["stretch"]},bu={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}};class Cu extends lc{static $name="Box";static type="box";static alias="hbox";static configurable={containerCls:"b-box-container",itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null,gap:null};get vertical(){return!1===this.horizontal}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(pu)}updateContentAlign(){this.syncConfigStyle(fu)}updateDirection(){this.syncConfigStyle(vu)}updateHorizontal(){var e;const t=this,n=null===(e=t.contentElement)||void 0===e?void 0:e.classList,r=Number(t.vertical);n?(n.remove(mu[1-r]),n.add(mu[r])):t.syncConfigLater("horizontal"),t.syncDirection()}updateJustify(){this.syncConfigStyle(yu)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(bu)}syncDirection(){const e=this,{reverse:t}=e;e.direction=t?`${e.vertical?"column":"row"}${t?"-reverse":""}`:null}changeGap(e){return"number"==typeof e&&(e=`${e}px`),e}updateGap(e){this.syncConfigStyle({name:"gap",style:"gap"})}}Cu.initClass(),Cu._$name="Box";class wu extends Cu{static $name="VBox";static type="vbox";static configurable={horizontal:!1}}wu.initClass(),wu._$name="VBox";var Su=e=>class extends(e||Qe){static $name="Badge";static get configurable(){return{badge:null}}compose(){const{badge:e}=this;return{dataset:{badge:e},class:{"b-badge":null!=e&&""!==e}}}};const Du=/(?:^|\s)b-icon-/,Eu=/(?:^|\s)b-fa-/,xu=["items","type","widgets","html","listeners"],Ru=Symbol("defaultListener");class Tu extends(oc.mixin(Su,Vc)){static $name="Button";static type="button";static get configurable(){return{icon:null,menuIcon:"b-icon-picker",pressedIcon:null,pressedCls:null,iconAlign:"start",behaviorType:"button",text:{value:null,$config:null,default:""},color:null,toggleable:void 0,pressed:!1,toggleGroup:null,supportsPressedClick:!1,supportsUnpressing:!1,ripple:{radius:75},twinForwardEvents:{item:"action"},twinSyncConfigs:null,localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,tabIndex:null,defaultBindProperty:null,split:null,keyMap:{ArrowDown:"onArrowDown"},role:""}}construct(...e){super.construct(...e),this.ion({hide:"onInternalHide"})}get twinSyncConfigs(){const e={onAction:"onItem",onClick:"onItem"};return this.toggleable&&!this.hasConfig("menu")&&(e.pressed="checked"),e}updateElement(e,t){var n,r;const i=this,{constructor:s}=i,o=super.updateElement(e,t),a=i.peekConfig("menu"),l=!!a&&(a.isWidget?a.role:(null===(n=s.resolveType(a.type))||void 0===n||null===(n=n.configurable)||void 0===n?void 0:n.role)||(null===(r=s.configurable.menuDefaults)||void 0===r?void 0:r.type)||"menu");return i.ariaHasPopup=l,o}compose(){const{color:e,href:t,icon:n,iconAlign:r,pressed:i,pressedIcon:s,target:o,text:a,toggleable:l,toggleGroup:d,menuIcon:c,behaviorType:u,tabIndex:h,pressedCls:g,split:m}=this,p=this.hasConfig("menu"),f=i&&s?s:n,v="object"==typeof a;return{tag:t?"a":"button",href:t,target:o,tabIndex:h,type:u,class:{[`b-icon-align-${r}`]:n,[e]:Boolean(e),"b-pressed":i&&l,"b-text":Boolean(a),"b-has-menu":p,"b-splitbutton":m,...i&&g?Object.fromEntries(g.split(" ").map((e=>[e,1]))):{}},[l&&!p?"aria-pressed":""]:i,dataset:{group:d},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:null!=n&&n.includes("/")?{"aria-hidden":!0,src:n,tag:"img",class:{"b-button-icon":1,"b-button-image":1}}:(n||s)&&{"aria-hidden":!0,tag:"i",class:{...Vt.normalize(f,"object"),"b-button-icon":1,"b-icon":Du.test(f),"b-fa":Eu.test(f)}},label:a&&this.ariaLabel!==a&&{tag:"label",for:this.id,[v?"children":"text"]:v?nt.asArray(a):a,class:{"b-button-custom-content":v}},menuIconElement:p&&c&&{tag:"i",class:{"b-icon":Du.test(c),"b-fa":Eu.test(c),"b-button-menu-icon":1,[c]:1}}}}}onInternalHide(){var e;null===(e=this._menu)||void 0===e||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var t;super.onFocusOut(e),null===(t=this.menu)||void 0===t||t.hide()}get focusElement(){return this.element}changeText(e){return null==e?"":e}changeToggleable(e){return void 0===e&&(e=Boolean(this.toggleGroup||this.config.menu)),e}changeMenu(e,t){const n=this,{element:r}=n;return e?(e.isWidget?(e.forElement=r,e.owner=n,e.constrainTo=n.rootElement):("object"!=typeof e||xu.some((t=>t in e))||(e={lazyItems:e}),e=oc.reconfigure(t,e?W.merge({owner:n,constrainTo:n.rootElement,forElement:r},n.menuDefaults,e):null,n)),e.align.constrainPadding=10,n.detachListeners(Ru),e.ion({name:Ru,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):null==t||t.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){const t=this;t.toggleable&&!t.isConfiguring&&(e&&Yn.forEachSelector(t.rootElement,`button[data-group=${t.toggleGroup}]`,(e=>{e!==t.element&&(oc.getById(e.id).pressed=!1)})),t.toggleMenu(!t.split&&e),t.trigger("toggle",{pressed:e,userAction:Boolean(t.triggeredByEvent)}))}configureOverflowTwin(e){const t=this,n=super.configureOverflowTwin(e),{menu:r}=t;return n.type=oc.resolveType("menuitem"),r?n.menu=t.constructor.mergeConfigs(n.menu,{type:"menu",items:r.items.map((e=>e.ensureOverflowTwin()))}):t.toggleable&&(n.checked=t.pressed),n.text||(n.text=t.text||t.tooltipText),n}onInternalMousedown(e){var t;(c.isSafari||null!==(t=this._menu)&&void 0!==t&&t.containsFocus&&this.pressed)&&e.preventDefault()}changeTooltip(e,t){const n=this,r=(null==e?void 0:e.html)||e;return n.ariaLabel||n.text||"string"!=typeof r||(n.ariaLabel=n.optionalL(r,n)),super.changeTooltip(e,t)}onArrowDown(){if(!this.menu)return!1;this.toggleMenu(!0)}onInternalClick(e){const t=this,n={event:e};if(!t.disabled)if(t.split&&e.target.closest(".b-button-menu-icon")){var r;t.toggleMenu(!(null!==(r=t._menu)&&void 0!==r&&r.isVisible))}else{if(t.triggeredByEvent=e,t.toggleable){const e=t.toggleGroup&&t.pressed&&!t.supportsUnpressing;if(e&&!t.supportsPressedClick)return;if(e||t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",n),t.isDestroyed||t.trigger("action",n),t.href||(e.preventDefault(),e.stopPropagation()),t.triggeredByEvent=null}}toggle(e=!this.pressed){!1!==this.trigger("beforeToggle",{pressed:e,userAction:Boolean(this.triggeredByEvent)})&&(this.pressed=e)}toggleMenu(e){if(e){const{menu:e}=this;e&&(e.owner=this,e.forElement=this.element,e.initialConfig.minWidth||(e.minWidth=this.width),e.align.minHeight=e._minHeight??100,e.align.minWidth=e._minWidth??100,e.show())}else{var t;null===(t=this._menu)||void 0===t||t.hide()}}}Tu.initClass(),Tu._$name="Button";const Mu={refs:"element"},ku=e=>e.element.style.margin="",Fu=e=>e.isToolbar,Iu=e=>e[0]+(e[1].minifiable?0:9e9),Au={hidden:!1,width:""},Lu={...Au,flex:""},Pu={flex:1,hidden:1,maxWidth:1,minWidth:1,width:1,disabled:1},Ou=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],$u={delay:0,startRate:40,endRate:200,accelerateDuration:500},_u={menu:1,pressed:1};class Hu extends(Dc.mixin(gu)){static $name="Toolbar";static type="toolbar";static delayable={syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}};static configurable={role:"toolbar",defaultType:"button",dock:"top",layout:{type:"box"},enableReordering:null,overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"b-icon-menu",menuIcon:null,ariaLabel:"L{Toolbar.showOverflowingItems}",defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,ariaLabel:"L{Toolbar.scrollForMore}",defaultCls:{"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,ariaLabel:"L{Toolbar.scrollForMore}",defaultCls:{"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0};static prototypeProperties={flexRowCls:"b-hbox",flexColCls:"b-vbox"};static getEvictionList(e){const t=e.filter((e=>"none"!==e.overflowable));return t.forEach(((e,n)=>t[n]=[n,e])),t.sort(((e,t)=>Iu(t)-Iu(e))),t}updateEnableReordering(e){const t=this;var n;e?t.dragHelper=new Zl({name:"itemReorder",mode:"container",lockY:!0,dragThreshold:10,targetSelector:".b-widget",floatRootOwner:t,rtlSource:t,outerElement:t.contentElement,containers:[t.contentElement],internalListeners:{beforeDragStart:t.onBeforeDragStart,dragstart:t.onDragStart,itemMove:t.onItemMove,drop:t.onDrop,thisObj:t}}):null===(n=t.dragHelper)||void 0===n||n.destroy()}compose(){const e=this,{axisProps:t,dock:n}=e,r=e.getEndTools(Mu),i=e.getStartTools(Mu);return{class:{[`b-dock-${n}`]:1,[`b-${n}-toolbar`]:1,[`b-${t.box}`]:1},children:{...i,toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}},...r}}}get axisProps(){return Ou[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return null===(e=this.tools)||void 0===e?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return"string"==typeof e?e:null==e?void 0:e.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),null===(t=e.syncRotationToDock)||void 0===t||t.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){ee.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget((e=>this.processAddedLeafItem(e)))}onInternalPaint({firstPaint:e}){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){const t=this,{layout:n}=t,{vertical:r}=n;if(n.vertical=Hc(e)[1],!t.initialItems){r!==n.vertical&&t.updateOverflow(t.overflow);for(const n of t.childItems){var i;null===(i=n.syncRotationToDock)||void 0===i||i.call(n,e)}}}updateOverflow(e,t){var n;const r=this,{axisProps:i,contentElement:s,overflowType:o}=r,{flexDir:a}=i,l=null===(n=r.overflowMenuButton)||void 0===n?void 0:n._menu,d={};var c;if(l&&(e?null==l||l.removeAll():l.eachWidget((e=>{e._overflowTwinOrigin.overflowTwin=null}))),"menu"===t?d.overflowMenuButton=null:"scroll"===t&&(d.overflowScrollStart=d.overflowScrollEnd=null),"menu"===o)null===(c=r.scrollable)||void 0===c||c.destroy(),s.style.overflow=s.style.overflowX=s.style.overflowY="",d.overflowMenuButton={cls:{[`b-${a}-menu`]:1}};else if("scroll"===o){const t="object"==typeof e&&(null==e?void 0:e.repeat)||$u;r.scrollable={[i.overflow]:"hidden-scroll",element:s,internalListeners:{scroll:"onContentScroll",thisObj:r}},d.overflowScrollStart={repeat:t,invertRotate:!0,cls:{[`b-${a}-start-scroller`]:1}},d.overflowScrollEnd={repeat:t,invertRotate:!0,cls:{[`b-${a}-end-scroller`]:1}}}r.tools=d,o?(s.classList.add("b-overflow"),r.monitorResize=!0,r.syncOverflowVisibility()):(s.classList.remove("b-overflow"),r.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:n,isVisible:r}=e,{clientSizeProp:i,edgeProp:s,sizeProp:o}=e.axisProps,{overflowMenuButton:a,overflowScrollStart:l,overflowScrollEnd:d}=e.tools,c=e.rtl&&e.layout.horizontal,u="menu"===t,h=()=>Math.ceil(n[i]+(!l||l.hidden?0:l.rectangle("outer")[o])+(!d||d.hidden?0:d.rectangle("outer")[o])),g=()=>{if(0===x.length)return 0;const e=x[x.length-1].rectangle(n);return Math.floor(c?n[i]-e.left:e[s])};let m,p,f,v,y,b,C,w,S,D,E,x;if(r&&t&&0!==e.items.length){if(e.inSyncOverflowVisibility=!0,null==a||a.hide(),e.eachWidget(((e,t)=>{C=e.minifiable,D=e.overflowable,D=C?D||C:D,e.floating?t.down=!1:(t.down=!D,e.innerItem&&(e._toolbarOverflow&&(e.hidden=e._toolbarOverflow=!1),e._toolbarMinified&&(e.minified=e._toolbarMinified=!1),e.isVisible&&(C&&(w||(w=[])).push(e),D&&(x||(x=[])).push(e))))})),x&&(m=h(),p=g()),x&&p>m)if(u){for(;p>m&&(y=null===(R=w)||void 0===R?void 0:R.pop());){var R;b=p,y._toolbarMinified=!0,y.minified=!0,p=g(),b-=p,(S||(S=[])).push([y,b])}if(p>m){for(f of(a.show(),m=h(),v=Hu.getEvictionList(x),v))p>m&&(y=f[1],y._toolbarOverflowWidth=y.width,y._toolbarOverflow=!0,y.hidden=!0,x.splice(x.indexOf(y),1),(E||(E=[])).push(f),p=g());if(E){for(E.sort(((e,t)=>e[0]-t[0])).forEach(((e,t)=>E[t]=e[1]));null!==(T=S)&&void 0!==T&&T.length;){var T;[y,b]=S.pop(),p+b<=m&&!y._toolbarOverflow&&(p+=b,y.minified=y._toolbarMinified=!1)}e.syncOverflowMenuButton(E)}else a.hide()}}else d.show(),l.show(),e.syncScrollerState();else u||(null==d||d.hide(),null==l||l.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var t;const n=this,{axisProps:r,overflowMenuButton:i}=n,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:r.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};for(const t of e)n.overflowItemFilter(t)&&t.addToOverflowMenu(s,n.horizontal?Lu:Au,ku);if(s.items.forEach((e=>{let t=e._overflowTwinOrigin,r=t.parent.indexOfChild(t);t.parent!==n&&(r=n.indexOfChild(t.parent)+r/1e5),e.weight=r})),null!==(t=i._menu)&&void 0!==t&&t.isMenu){const e=i.menu,{toAdd:t,toRemove:n}=nt.delta(s.items,e.items,!0);e.remove(n),e.add(t)}else i.menu=s}syncScrollerState(){const{axisProps:e,scrollable:t}=this,{overflowScrollStart:n,overflowScrollEnd:r}=this.tools,i=t[e.pos],s=t[e.max];n.disabled=!i,r.disabled=Math.abs(Math.ceil(i))>=Math.abs(s)}overflowItemFilter(e){const{filter:t}=this.overflow;return Boolean(t?t.call(this,e):Yn.getChildElementCount(e.element))}onLeafItemConfigChange(e,{name:t,value:n}){const r=this,i=r.up(Fu),s=i.hasConfig("overflow"),{overflowTwin:o}=r;!s||null!=i&&i.inSyncOverflowVisibility||"hidden"===t&&n===r._toolbarOverflow||!Pu[t]&&(null!=r._width&&!r.monitorResize||r._flex&&!String(r._flex).endsWith("auto"))||(o&&!_u[t]&&(o[t]=n),null!=i&&i.isPainted&&"overflowMenuButton"!==r.ref&&((r.isTextField||r.isSlider||r.isCheckbox)&&"value"===t&&(r.containsFocus||null!=o&&o.containsFocus)||i.syncOverflowVisibility()))}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}onBeforeDragStart({context:e,event:t}){const n=e.item=this.items[e.element.dataset.itemIndex];return e.oldIndex=Number.parseInt(n.element.dataset.itemIndex,10),this.trigger("beforeItemDragStart",{item:n,domEvent:t})}onDragStart({context:e,event:t}){const{item:n}=e;e.dragProxy.style.backgroundColor=globalThis.getComputedStyle(this.element).backgroundColor,this.trigger("itemDragStart",{item:n,domEvent:t})}onItemMove({context:e,event:t}){const{item:n}=e,r=Array.from(n.element.parentElement.children).indexOf(n.element);this.insert(n,r),this.trigger("itemDragMove",{item:n,domEvent:t})}onDrop({context:e,event:t}){const{item:n,valid:r}=e;this.trigger("itemDrop",{item:n,domEvent:t,valid:r})}doDestroy(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),super.doDestroy()}}Hu.initClass(),Hu._$name="Toolbar";const Vu=e=>e.classList.contains("b-focus-trap")||e.classList.contains("b-hidden")||!Yn.getFocusability(e).focusable?Yn.NodeFilter.FILTER_SKIP:Yn.NodeFilter.FILTER_ACCEPT,Nu=[],Bu={},zu=[Nu,Nu],ju=(e,t,n)=>{const{vertical:r}=e;return delete e.vertical,{...e,class:{...t,[`b-${r?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!n}}},Wu=(e,t,n=!1)=>{const r={vertical:n,children:e?[e]:[]};return t&&(r.tag=t),r},Uu=(e,t)=>{null!=e&&e.classList?null==e||e.classList.add(t):null!=e&&e.class&&("string"==typeof e.class&&(e.class={[e.class]:1}),e.class[t]=1)},Gu={dock:1,hidden:1,weight:1},Yu={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},qu={header:1,"pre-header":1},Ku={top:"up",right:"right",bottom:"down",left:"left"};class Xu extends(Dc.mixin(Yi,gu)){static $name="Panel";static type="panel";static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:null,drawer:{$config:"lazy",value:null}}}get bodyWrapRootElement(){return this[this._bodyWrapRootName]}changeFooter(e){return e&&("start"===e.dock?e.dock="left":"end"===e.dock&&(e.dock="right")),e}compose(){var e;const t=this,{collapsible:n,focusable:r,revealed:i,tools:s,role:o,floating:a}=t,l=t.composeHeader(),d=t.getPositionableItems("after",!0),c=t.getPositionableItems("before",!0),u=(null==l?void 0:l.class["b-dock-left"])||(null==l?void 0:l.class["b-dock-right"]),h=null==l||null===(e=l.children)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.id;let g=t.composeBody(),m="bodyWrapElement";n&&([m,g]=n.wrapCollapser(m,g)),t._bodyWrapRootName=m;const p={role:o&&"element"===t._ariaElement?o:a?"dialog":"region",tabIndex:(a||t.peekConfig("positioned"))&&!1!==r?-1:r?0:null,class:{[`b-panel-collapsible-${null==n?void 0:n.type}`]:n,[`b-panel-collapse-${null==n?void 0:n.collapseDir}`]:n,[`b-${u?"h":"v"}box`]:1,"b-panel-collapsible":n,"b-panel-has-header":l,"b-panel-has-tools":s?1:0,"b-panel-overlay-revealed":i},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-top-focus-trap":1}},...c,headerElement:l,[m]:g,...d,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}};return h&&(p["aria-labelledby"]=h),p}updateElement(){this.getConfig("drawer"),super.updateElement(...arguments)}updateDrawer(e){var t;let{side:n="end",inline:r}=e;const i=this,{element:s,rtl:o}=i,a=i.getRenderContext()[0]||(r?document.body:null),l=i.parent||a&&!r?"positioned":"floating";n="start"===n?o?"right":"left":"end"===n?o?"left":"right":n,i.updateConfiguration({forElement:null,closable:!1,align:null,autoShow:!1,monitorResize:!1,centered:!1,anchor:!1,hidden:!1,draggable:!1,appendTo:a||(null===(t=i.owner)||void 0===t?void 0:t.floatRoot)||i.floatRoot,hideMode:"collapse",trapFocus:!0,[l]:!r,collapsed:"object"!=typeof e||!("collapsed"in e)||e.collapsed,collapsible:{...e,type:r?"inline":"overlay",direction:Ku[n||"end"]}}),s.classList.add("b-drawer-panel"),s.classList.remove("b-popup"),s.style.setProperty("--b-drawer-size",Yn.setLength(null==e?void 0:e.size)),i.ion({thisObj:i,reveal:()=>i.trigger("show"),unreveal:()=>i.trigger("hide")})}get isVisible(){return this.drawer?!this.collapsible.collapsed||this.revealed:super.isVisible}hide(){const e=this;if(!e.drawer)return super.hide(...arguments);if(!1!==e.trigger("beforeHide")){const t="inline"===e.collapsible.type?e.collapse():e.collapsible.toggleReveal(!1);return e.trigger("hide"),t}}show(){const e=this;if(!e.drawer)return super.show(...arguments);if(!1!==e.trigger("beforeShow")){const t="inline"===e.collapsible.type?e.expand():e.collapsible.toggleReveal(!0);return e.afterShow(),e.focus(),t}}showBy(){return this.drawer?this.show():super.showBy(...arguments)}composeBody(){var e,t;const n=this,{bodyCls:r,bodyConfig:i,bodyWrapTag:s,footer:o,uiClassList:a}=n,l=W.values(n.strips,((e,t)=>!Yu[null==t?void 0:t.dock])).sort(n.byWeightSortFn),d={top:null,right:null,bottom:null,left:null};let c,u,h,g,m,p,f;for(o&&(h=o.dock||"bottom",l.unshift({dock:h,element:{tag:"footer",reference:"footerElement",html:"string"==typeof o?o:o.html,class:{...a,[`b-dock-${h}`]:1,[`${o.cls||""}`]:1}}})),r&&(i[m="className"]||(m="class"),i[m]=new Vt(i[m]).assign(r)),g=l.length;g-- >0;)c=l[g],[p,u]=Yu[c.dock],f?f.vertical!==p&&(f=Wu(ju(f,a),"",p)):f=Wu(i,s,p),f.children[u?"unshift":"push"](c.element),d[c.dock]=c;Uu(d.top,"b-innermost"),Uu(d.right,"b-innermost"),Uu(d.bottom,"b-innermost"),Uu(d.left,"b-innermost");const v=ju(f||Wu(i,s),a,!0);return v.class[`${null===(e=n.layout)||void 0===e?void 0:e.containerCls}-panel`]=Boolean(null===(t=n.layout)||void 0===t?void 0:t.containerCls),v.class["b-panel-body-wrap"]=1,v.class[`b-${n.$$name.toLowerCase()}-body-wrap`]=1,v}get hasHeader(){if(!1===this.header)return!1;const{header:e,title:t,tools:n,parent:r}=this,i=this.maximizable||Object.values(n||{}).some((e=>!e.hidden));return e||!(null!=r&&r.suppressChildHeaders)&&(t||i)}get rootUiClass(){return Xu}changeHeader(e){return"string"==typeof e?{title:e}:e}composeHeader(e){var t;const n=this;if(!n.hasHeader&&!e)return;const r=n.header||{},i=r.dock||"top",[s,o]=n.splitHeaderItems({as:"element",dock:i}),a=n.$meta.hierarchy,l=n.composeTitle(r),d=new Vt({[`b-dock-${i}`]:1,...n.uiClassList},r.cls);let c,u;for(c=a.indexOf(Xu);c<a.length;++c)u=a[c].$$name,"Grid"!==u&&(d[`b-${u.toLowerCase()}-header`]=1);const h={...r,tag:"header",class:d,children:[...s,l,...o]};return(null===(t=n.collapsible)||void 0===t?void 0:t.composeHeader(h))||h}composeTitle(e){var t;const n=this.title||e.title,r={reference:"titleElement",id:`${this.id}-panel-title`,"aria-live":"polite",class:{[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1,...this.uiClassList}};if(n)if(W.isObject(n))W.merge(r,n);else{const{iconCls:t}=e;t?r.children=[{tag:"i",class:"b-panel-title-icon "+t},n]:r.html=n}return(null===(t=this.collapsible)||void 0===t?void 0:t.composeTitle(r))||r}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const t=this,{headerElement:n}=t;null===(e=t._headerClickDetacher)||void 0===e||e.call(t),t._headerClickDetacher=n&&Jt.on({element:n,click:e=>{var n;return null===(n=t.trigger)||void 0===n?void 0:n.call(t,"panelHeaderClick",{event:e})}})}onPanelHeaderClick(e){var t;null===(t=this.collapsible)||void 0===t||t.onPanelHeaderClick(e)}onInternalPaint(){var e;super.onInternalPaint(...arguments),null===(e=this.collapsible)||void 0===e||e.onPanelPaint(this)}splitHeaderItems({as:e,dock:t,alt:n}=Bu){const r=this,i="element"===e,{collapsed:s}=r,o=r.getEndTools({alt:n}),a=r.getStartTools({alt:n}),l=W.values(r.strips,((e,t)=>!qu[null==t?void 0:t.dock]&&t.isCollapsified({collapsed:s,alt:n})));let d,c,u,h=zu;if(l.length+o.length+a.length){for(h=[c=[...a,...l.filter((e=>"pre-header"===e.dock)).sort(r.byWeightSortFn)],d=[...l.filter((e=>"header"===e.dock)).sort(r.byWeightReverseSortFn),...o]],u=0;u<c.length;++u){var g,m;t&&(null===(g=(m=c[u]).syncRotationToDock)||void 0===g||g.call(m,t)),i&&(c[u]=c[u].element)}for(u=0;u<d.length;++u){var p,f;t&&(null===(p=(f=d[u]).syncRotationToDock)||void 0===p||p.call(f,t)),i&&(d[u]=d[u].element)}}return h}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:t}=e,n=W.merge({reference:"bodyElement",className:{...e.getStaticWidgetClasses(Xu,"-content"),"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren}},e._bodyConfig);return t&&(n.tag=t),n}changeBodyCls(e){return Vt.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const t=this,n=W.values(t.strips,((e,t)=>!Yu[null==t?void 0:t.dock])).sort(t.byWeightSortFn),[r,i]=t.splitHeaderItems(),[s,o]=(null===(e=t.collapsible)||void 0===e?void 0:e.splitHeaderItems())||zu;return[...r,...s,...i,...o,...n.filter((e=>Yu[e.dock][1])),...t.items,...n.filter((e=>!Yu[e.dock][1])).reverse()]}get childItemsOrderedByRelevance(){var e;const t=this,n=W.values(t.strips,((e,t)=>!Yu[null==t?void 0:t.dock])).sort(t.byWeightSortFn),[r,i]=t.splitHeaderItems(),[s,o]=(null===(e=t.collapsible)||void 0===e?void 0:e.splitHeaderItems())||zu;return[...t.items,...n.filter((e=>!Yu[e.dock][1])).reverse(),...r,...s,...i,...o,...n.filter((e=>Yu[e.dock][1]))]}changeStrips(e,t){const n=this,r=n.$strips||(n.$strips=new du({configName:"strips",factory:oc,inferType:!1,owner:n,created(e){var t;const{dock:i}=e;if(!qu[i]&&!Yu[i])throw new Error(`Invalid dock value "${i}"; must be: top, left, right, bottom, header, or pre-header`);ee.after(e,"onConfigChange",((e,{name:t})=>{Gu[t]&&n.onConfigChange({name:"strips",value:r.target})})),e.innerItem=!1,n.onChildAdd(e),e.parent=n,null===(t=e.layout)||void 0===t||t.renderChildren(),e.hasItems&&(n.hasItems=!0)},setup:(e,t)=>((e=W.merge(W.clone(n.stripDefaults["*"]),n.stripDefaults[t],e)).parent=n,e.ref=t,e),transform:e=>(Array.isArray(e)&&(e={items:e}),e||null)}));if(r.update(e),!t)return r.target}get collapsing(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsing}get collapsingExpanding(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.collapsingExpanding}get expanding(){var e;return null===(e=this.collapsible)||void 0===e?void 0:e.expanding}changeCollapsed(e){const t=this,{collapsible:n}=t;if(t.recompose.flush(),e=Boolean(e),!n||t.changingCollapse||!t.isPainted)return e;null==n||n.collapse({animation:null,collapsed:e})}changeCollapsible(e,t){const n=this;return n.getConfig("tools"),e&&(!0===e?e={}:"string"==typeof e&&(e={[Yu[e]?"direction":"type"]:e})),au.reconfigure(t,e,{owner:n,defaults:{panel:n},cleanup(){n.collapsed&&!e&&(t.collapse({animation:null,collapsed:!1}),n._collapsed=1)}})}updateCollapsible(e){const t=this,n=null==e?void 0:e.toolsConfig;t.tools={collapse:(null==n?void 0:n.collapse)||null,recollapse:(null==n?void 0:n.recollapse)||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),1===t.collapsed&&(t.collapsed=!0)}_collapse(e,t){var n;return!0!==t&&void 0!==t&&(!1===t?e.collapsed=!e.collapsed:"number"==typeof t?e.animation={duration:t}:null===t?e.animation=t:!0===t||("animation"in t?W.merge(e,t):e.animation=t)),null===(n=this.collapsible)||void 0===n?void 0:n.collapse(e)}collapse(e){return this.collapsePanel(e)}expand(e){return this.expandPanel(e)}collapsePanel(e){return this._collapse({collapsed:!0},e)}expandPanel(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e,t){return"boolean"==typeof e?e?this.collapse(t):this.expand(t):this.collapsed?this.expand(t):this.collapse(t)}get expandedHeaderDock(){var e;return this._expandedHeaderDock??(null===(e=this.initialConfig.header)||void 0===e?void 0:e.dock)??"top"}set expandedHeaderDock(e){this._expandedHeaderDock=null==e?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=null==e?void 0:e.dock)}updateTrapFocus(e){var t;const n=this,{element:r}=n,{classList:i}=r,s="before"===e,o="after"===e;i.toggle("b-focus-trapped",e&&!s&&!o),i.toggle("b-focus-trapped-before",s),i.toggle("b-focus-trapped-after",o),n.focusTrapListener=null===(t=n.focusTrapListener)||void 0===t?void 0:t.call(n),n[e?"addKeyBinding":"removeKeyBinding"]("shift+Tab","trapTabOut"),e&&(n.focusTrapListener=Jt.on({element:r,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:n}),n.treeWalker||(n.treeWalker=n.setupTreeWalker(r,Yn.NodeFilter.SHOW_ELEMENT,Vu)))}setupTreeWalker(e,t,n){return document.createTreeWalker(e,t,n)}trapTabOut(e){if(e.target!==this.element)return!1;e.preventDefault(),this.bottomFocusTrap.focus()}onFocusTrapped(e){const t=this,{target:n}=e,r=t.treeWalker,i=n===t.bottomFocusTrap,s=n===t.topFocusTrap;!1!==t.trigger("focusTrap",{target:n,bottom:i,top:s})&&(s||i)&&(i||e.relatedTarget===t.element&&e.shiftKey?(r.currentNode=t.topFocusTrap,r.nextNode()):(r.currentNode=t.bottomFocusTrap,r.previousNode()),t.requestAnimationFrame((()=>r.currentNode.focus())))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}getPositionableLocation(e){let t,n;return"before"===e?n=this.headerElement||this.bodyWrapRootElement:"after"===e?n=this.bottomFocusTrap:t=this.contentElement,[t,n]}get widgetClassList(){const e=this,t=super.widgetClassList;var n;e.hasHeader&&t.push("b-panel-has-header",`b-header-dock-${(null===(n=e.header)||void 0===n?void 0:n.dock)||"top"}`);return e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}}Xu.initClass(),Xu._$name="Panel";const Zu={topStart:"top-start",topEnd:"top-end",bottomEnd:"bottom-end",bottomStart:"bottom-start",top:"top",end:"end",bottom:"bottom",start:"start"};class Ju extends(Qe.mixin(lt)){static configurable={element:null,minWidth:50,maxWidth:null,minHeight:50,maxHeight:null,rtl:null,handles:{topStart:!0,top:!0,topEnd:!0,end:!0,bottomEnd:!0,bottom:!0,bottomStart:!0,start:!0}};construct(e){if(super.construct(e),!this.element)throw new Error("ElementResizeHelper: `element` is required.")}updateElement(e){var t;"static"===globalThis.getComputedStyle(e).position&&console.warn("ElementResizeHelper: `element` must be positioned (absolute or relative) for resizing to work."),null===(t=this.pointerDownListeners)||void 0===t||t.call(this),this.pointerDownListeners=Jt.on({element:e,pointerdown:"onResizePointerDown",delegate:".b-resize-grip",thisObj:this})}updateHandles(e){const{element:t}=this;Yn.removeEachSelector(t,".b-resize-grip");for(const n in e)if(!1!==e[n]){const e=document.createElement("div");e.className=`b-resize-grip b-resize-grip-${Zu[n]}`,t.appendChild(e)}}onResizePointerDown(e){var t;const n=this,{element:r}=n;if(n.handleType=e.target.className.replace("b-resize-grip b-resize-grip-","").trim(),0!==e.button||!1===n.trigger("beforeResizeStart",{element:r,handle:n.handleType}))return;e.preventDefault();const i=globalThis.getComputedStyle(r),s=r.getBoundingClientRect(),o=parseFloat(i.top)||0,a=parseFloat(i.insetInlineStart)||0;n.initialX=e.clientX,n.initialY=e.clientY,n.initialTop=o,n.initialStart=a,n.initialWidth=s.width,n.initialHeight=s.height,n.trigger("resizeStart",{element:r,handle:n.handleType}),null===(t=n.removeMoveListeners)||void 0===t||t.call(n),n.removeMoveListeners=Jt.on({element:document.body,pointermove:"onResizePointerMove",thisObj:n}),n.removeDocUpListeners=Jt.on({element:document,pointerup:"onResizePointerUp",capture:!0,thisObj:n,once:!0})}onResizePointerMove(e){const{element:t,handleType:n,rtl:r,minHeight:i,minWidth:s,initialStart:o,initialTop:a,initialWidth:l,initialHeight:d,initialX:c,initialY:u,maxWidth:h,maxHeight:g}=this,m=e.clientX-c,p=e.clientY-u,f=l-(s||1),v=r?-1:1,{shiftKey:y}=e;let b=o,C=a,w=l,S=d;if(n.includes("start")?(b=o+Math.min(m,f)*v,w=l-m*v):n.includes("end")&&(w=l+m*v),n.includes("top")?(C=a+Math.min(p,d-(i||1)),S=d-p):n.includes("bottom")&&(S=d+p),y){const e=l/d;Math.abs(m)>Math.abs(p)?S=w/e:w=S*e}null!==s&&(w=Math.max(w,s)),null!==h&&(w=Math.min(w,h||document.body.offsetWidth)),null!==i&&(S=Math.max(S,i)),null!==g&&(S=Math.min(S,g||document.body.offsetWidth)),(!r||!n.includes("start")||w>s)&&(t.style.insetInlineStart=Math.max(b,0)+"px"),t.style.top=C+"px",t.style.width=w+"px",t.style.height=S+"px"}onResizePointerUp(e){var t,n;null===(t=this.removeDocUpListeners)||void 0===t||t.call(this),null===(n=this.removeMoveListeners)||void 0===n||n.call(this),this.removeMoveListeners=null,this.removeDocUpListeners=null}get isResizing(){return Boolean(this.removeMoveListeners)}doDestroy(){this.onResizePointerUp(),this.pointerDownListeners(),Yn.removeEachSelector(this.element,".b-resize-grip"),super.doDestroy()}}Ju._$name="ElementResizeHelper";var Qu=e=>class extends(e||Qe){static $name="Resizable";static configurable={resizable:null};updateResizable(e){const t=this;if(e){const n="object"==typeof e?e:{};t.resizeHelper=new Ju(W.assign({element:t.element,internalListeners:{resizeStart:t.onResizeStart,thisObj:t}},n))}else{var n;null===(n=t.resizeHelper)||void 0===n||n.destroy()}}onResizeStart(){this.alignTo(null)}doDestroy(){var e;null===(e=this.resizeHelper)||void 0===e||e.destroy(),super.doDestroy()}updateRtl(e){super.updateRtl(e),this.resizeHelper&&(this.resizeHelper.rtl=e)}};class eh extends(Xu.mixin(Qu)){static $name="Popup";static type="popup";static configurable={autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,draggable:!0,draggableBlacklistSelector:"button,.b-field-inner,.b-gridbase,.b-calendarmixin,.b-resize-grip",hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog",closeOnEscape:!0};finalizeInit(){const e=this,{forElement:t}=e;e.anchoredTo=t,e.initialAnchor=e.anchor,t&&!1!==e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),Jt.on({element:t,[2===e.showOnClick?"contextmenu":"click"]:"onElementUserAction",thisObj:e,capture:!0})),super.finalizeInit(),!e.autoShow||t&&!Yn.isVisible(t)||(!0===e.autoShow?e.show():e.setTimeout((()=>e.show()),e.autoShow))}onInternalPaint({firstPaint:e}){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments);const n=this;e&&n.headerElement&&Jt.on({element:n.headerElement,dblclick:n.onHeaderDblClick,thisObj:n})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":Boolean(t&&e)}}}close(){if(!this._hidden){const e=this.trigger("beforeClose");if(W.isPromise(e))return e.then((e=>{!1!==e&&this.doClose()})),e;if(!1===e)return e}this.doClose()}doClose(){const e=this,{closeAction:t}=e;if(!e._hidden||"destroy"===t){var n;e.modal&&"destroy"===t&&e.revertFocus(),e.unmask();const i=e.items.length&&(null===(n=e.items.find((e=>e.errorTip)))||void 0===n?void 0:n.errorTip);var r;if(i)null===(r=i.pointerOverOutDetacher)||void 0===r||r.call(i),i.hide();return e[t]()}}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){e=Boolean(e),this.element.classList.toggle("b-maximized",Boolean(e)),this.draggable&&(this.draggable.disabled=e)}onInternalKeyDown(e){const t=this;"Escape"===e.key&&t.closeOnEscape&&(e.stopImmediatePropagation(),t.floating||t.positioned?t.close(!0):t.collapsible&&(t.revealed?t.collapsible.toggleReveal():t.collapse()))}onDocumentMouseDown({event:e}){const t=this,{owner:n}=t,{target:r}=e;if(t.isVisible){if("touchend"!==e.type&&null!=n&&n.isButton&&n._menu===t&&n.element.contains(r))return e.preventDefault(),!1;if(t.modal&&r===eh.modalMask)e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus();else if(!t.owns(r,!0)&&t.autoClose&&"mousedown"===e.type)if(t.containsFocus){const n=Yn.getActiveElement(t.element);Jt.on({element:document,once:!0,expires:100,[e.type]:e=>{e.defaultPrevented&&Yn.getActiveElement(t.element)===n&&t.close()}})}else t.close()}}get isTopModal(){return!this._isRevertingFocus&&Yn.isVisible(eh.modalMask)&&this.element.previousElementSibling===eh.modalMask}onFocusIn(e){const t=Yn.getActiveElement(this);super.onFocusIn(e),Yn.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1||this.modal||!this.autoClose||this.close(),super.onFocusOut(e)}afterShow(){const e=this;(e.autoClose||e.modal)&&e.addDocumentMouseDownListener(),super.afterShow(...arguments),e.toFront()}toFront(){this.floating&&(super.toFront(),this.syncModalMask()),this.focusOnToFront&&!this.containsFocus&&this.focus()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=ir.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){const t=this;e?(t.element.setAttribute("aria-modal",!0),t.floating=!0,"number"==typeof t._x||"number"==typeof t._y||t.hasConfig("centered")||(t.centered=!0,t.anchor=!1)):t.element.removeAttribute("aria-modal")}syncModalMask(){const e=this,{modal:t,element:n}=e;if(t&&e.isVisible)e.modalMask.classList.remove("b-hide-display"),e.modalMask.classList.toggle("b-modal-transparent",Boolean(t.transparent)),n.classList.add("b-modal"),e.modalMask.setAttribute("owned-by",e.id);else if(e.isPainted){n.classList.remove("b-modal");const t=e.floatRoot.querySelectorAll(".b-modal"),r=t.length?eh.fromElement(t[t.length-1],"popup"):null;r?r.syncModalMask():eh.modalMask.classList.add("b-hide-display")}}afterHide(){var e;const t=this;super.afterHide(...arguments),null===(e=t.mouseDownRemover)||void 0===e||e.call(t),t.mouseDownRemover=null,t.syncModalMask()}onElementUserAction(e){const{showOnClick:t}=this;"number"==typeof t&&t!==e.button||(2===e.button&&e.preventDefault(),this.show())}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=eh;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=Yn.createElement({className:"b-modal-mask b-hide-display"}),Jt.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}}eh.initClass(),eh._$name="Popup";const th=/^b-icon-/,nh=/^b-fa-/;class rh extends oc{static $name="MenuItem";static type="menuitem";static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},menuDefaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,floating:!0,autoShow:!1,cls:{"b-sub-menu":1}},icon:null,text:null,closeParent:null,href:null,radio:null,target:null,localizableProperties:["text"],role:"menuitem",openMenuDelay:120}}updateElement(e,t){const n=this,r=super.updateElement(e,t);return"boolean"==typeof n.checked?n.role="menuitemcheckbox":n.href&&(n.role=null),n.ariaHasPopup=!!n.hasMenu&&"menu",r}compose(){var e;const t=this,{checked:n,href:r,hasMenu:i,radio:s,separator:o,target:a,text:l}=t,d="boolean"==typeof n,c=t.icon||(d?"b-fw-icon":""),u="b-icon-"+(s?"radio-":""),h="object"==typeof l;return{tag:r?"a":"div",tabIndex:-1,href:r,target:a,class:{"b-has-submenu":i,"b-checked":n,"b-separator":o||(null===(e=t.cls)||void 0===e?void 0:e["b-separator"])},dataset:{group:t.toggleGroup},[d?"aria-checked":""]:n,[i?"aria-expanded":""]:!1,children:{iconElement:c&&{"aria-hidden":!0,tag:"i",class:{"b-fa":nh.test(c),"b-icon":th.test(c),"b-menuitem-icon":1,[`${u}checked`]:!0===n,[`${u}unchecked`]:!1===n,...Vt.normalize(c,"object")}},textElement:{tag:"span",[h?void 0:"text"]:h?void 0:l,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?nt.asArray(l):null},subMenuIcon:i&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const t=this,n=this.parent,r={menu:n,item:t,element:t.element,bubbles:!0,domEvent:e};if("boolean"==typeof t.checked){const e=!t.checked;t.toggleGroup&&!e||(t.checked=!t.checked)}else t.href&&e.key&&t.element.click();t.trigger("beforeItem",r),t.trigger("item",r),t.closeParent&&n&&(n.rootMenu.close(),e&&!t.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get radio(){return Boolean(this._radio??this.toggleGroup)}onFocusIn(e){const{menu:t}=this;super.onFocusIn(e),!this.disabled&&t&&(t.clearTimeout(t.closeTimer),this.delay("openMenu",t.closeTimer?0:this.openMenuDelay),t.closeTimer=null)}onFocusOut(e){var t;const n=this;n.clearTimeout("openMenu"),super.onFocusOut(e);const r=n._menu;!r||null!==(t=n.owner)&&void 0!==t&&t.ignoreFocusOut||(Yn.usingKeyboard?n.closeMenu():(r.clearTimeout(r.closeTimer),r.closeTimer=r.setTimeout((()=>n.closeMenu()),r.closeMenuDelay),r.once("hide",(()=>r.clearTimeout(r.closeTimer)))))}openMenu(e){const{menu:t,parent:n}=this;!this.disabled&&t&&(t.focusOnToFront=e,n.isMenu?n.openSubMenu(this.element,this):t.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu.isWidget&&this.menu.close(),this.menu.closeTimer=null}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&"boolean"!=typeof this.checked&&(this.checked=!1),e}changeChecked(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.element.setAttribute("aria-checked",e),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:n,element:r}=e,i=[];return t&&n&&Yn.forEachSelector(e.rootElement,`[data-group=${n}]`,(e=>{if(e!==r){const t=oc.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}changeMenu(e,t){const n=this,{constrainTo:r,scrollAction:i,focusOnHover:s}=n.owner;return!e||"object"!=typeof e||"type"in e&&"menu"!==e.type||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),sh.reconfigure(t,e?sh.mergeConfigs(n.menuDefaults,{owner:n,forElement:n.element,ariaLabel:n.text,[t?"positioned":"_"]:!1,focusOnHover:s,constrainTo:r,scrollAction:i},e):null,n)}}rh.initClass(),rh._$name="MenuItem";const ih={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class sh extends eh{static $name="Menu";static type="menu";static configurable={layout:"vbox",focusable:!0,draggable:!1,showAnimation:null,hideAnimation:{opacity:{from:1,to:0,duration:".15s",delay:"0s"}},align:{align:"t-b"},scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",closeMenuDelay:200,testConfig:{hideAnimation:null,closeMenuDelay:1}};construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),Jt.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(){const{items:e,element:t}=this;e.some((e=>e.hasConfig("menu")))&&t.classList.add("b-menu-with-submenu");e.some((e=>e.icon))&&t.classList.add("b-menu-with-icon"),super.afterShow(...arguments)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=this,n=null===(e=t.parentMenu)||void 0===e?void 0:e.element.contains(Yn.getActiveElement(t.parentMenu)),r=t.items[0];return!n&&!Yn.usingKeyboard&&r instanceof rh?t.element:super.focusElement}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){const t=this,n=super.hide(e);var r,i;t.isVisible||(null===(r=t.currentSubMenu)||void 0===r||null===(i=r.hide)||void 0===i||i.call(r,e),t.parentMenu&&(t.parentMenu.currentSubMenu=null));return n}show(){const e=super.show(...arguments),{parentMenu:t}=this;return this.isVisible&&t&&(t.currentSubMenu=this),e}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&this.triggerElement(t,e)}onMouseOver(e){if(!1!==this.focusOnHover){var t;const n=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(".b-widget"),r=e.target.closest(".b-widget"),i=oc.fromElement(r);!Yn.isTouchEvent&&r&&r!==n&&i.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer);const{parentMenu:e}=this;e&&(e.ignoreFocusOut=!0,e.setTimeout((()=>e.ignoreFocusOut=!1),500),e.clearTimeout(e.hideSubMenuTimer))}onMouseLeave(e){const t=this,{relatedTarget:n}=e,r=n&&t.owns(n);let i=n instanceof HTMLElement&&oc.fromElement(n),s=!r;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!Yn.getAncestor(i.element,[e.target])}!r&&s&&(t.currentSubMenu&&(t.hideSubMenuTimer=t.setTimeout((()=>{var e;return null===(e=t.currentSubMenu)||void 0===e?void 0:e.hide()}),t.closeMenuDelay)),t.element.contains(Yn.getActiveElement(t))&&Yn.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=oc.fromElement(e),n=t&&t!==this&&!(t instanceof rh);if("Escape"===e.key)return void(n?this:this.rootMenu).close();if(super.onInternalKeyDown(e),n)return;ih[e.key]&&e.preventDefault();const r=this.element,i=Yn.getActiveElement(r);this.navigateFrom(i!==r&&r.contains(i)?i:null,e.key,e)}navigateFrom(e,t,n){var r,i;const s=this,{treeWalker:o}=s,a=e&&s.getItem(e),l=s.rtl?"ArrowLeft":"ArrowRight",d=s.rtl?"ArrowRight":"ArrowLeft";let c;switch(t){case"ArrowUp":o.currentNode=e||(e=s.bottomFocusTrap),o.previousNode(),c=o.currentNode,null==a||null===(r=a.menu)||void 0===r||r.hide(!1);break;case"ArrowDown":o.currentNode=e||(e=s.topFocusTrap),o.nextNode(),c=o.currentNode,null==a||null===(i=a.menu)||void 0===i||i.hide(!1);break;case" ":e&&!e.classList.contains("b-disabled")&&(null!=a&&a.menu?s.openSubMenu(e,a):s.triggerElement(e,n));break;case l:if(e&&null!=a&&a.menu&&!e.classList.contains("b-disabled")){const t=s.openSubMenu(e,a);null==t||t.focus()}else o.currentNode=e||(e=s.topFocusTrap),o.nextNode(),c=o.currentNode;break;case d:s.isSubMenu?s.hide():e||(o.currentNode=e||(e=s.topFocusTrap),o.nextNode(),c=o.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&s.triggerElement(e,n)}c&&(c===s.element?s.navigateFrom(s.bottomFocusTrap,"ArrowUp",n):c===e?s.navigateFrom(s.topFocusTrap,"ArrowDown",n):c.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:e.nodeType===Element.ELEMENT_NODE?oc.fromElement(e,"menuitem",this.contentElement):this.items.find((t=>t.id==e))}triggerElement(e,t){const n=this.getItem(e);n&&!n.disabled&&n.doAction(t)}get isSubMenu(){var e;return this===(null===(e=this.owner)||void 0===e?void 0:e.menu)}openSubMenu(e,t){const n=this,r=t.menu;if(r){if(!r.isVisible){var i;const s={item:t,element:e};if(!1===n.trigger("beforeSubMenu",s))return;if(!1===(null===(i=t.onBeforeSubMenu)||void 0===i?void 0:i.call(t,s)))return;r.show(),r.isVisible&&!r.isMenu&&(n.currentSubMenu=r)}return r}}set selectedElement(e){const t=this,n=t._selectedElement;if(n){const e=t.getItem(n),r=null==e?void 0:e.menu;null==r||r.hide(),n.classList.remove("b-active")}if(t._selectedElement=e,e){const n=Yn.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!n,focus:n})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((()=>e.currentNode.focus()))}get parentMenu(){var e;const t=this.owner;return t&&(t.isMenu?t:null===(e=t.up)||void 0===e?void 0:e.call(t,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}let oh;sh.initClass(),sh._$name="Menu";class ah extends Mr{static $name="ContextMenuBase";static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",constrainTo:globalThis,scrollAction:null}},items:{},triggerEvent:null,clickTriggerSelector:null,preventNativeMenu:null,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var t;if(super.construct(...e),null===(t=this.type)||void 0===t||!t.length)throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(e.handled||this.triggerEvent!==e.type)"click"===e.type&&this.clickTriggerSelector&&e.target.matches(this.clickTriggerSelector)&&this.internalShowContextMenu(e,{align:"l-r",target:e.target});else{if(!0===e.ctrlKey&&!c.isMac)return void e.preventDefault();const t=e;if(oh){const{target:n}=oh;e=Jt.fixEvent(new MouseEvent(e.type,e)),Object.defineProperties(e,{target:{value:n},offsetX:{value:t.offsetX},offsetY:{value:t.offsetY}}),e.preventDefault=function(){t.preventDefault(),t.handled=!0}}this.internalShowContextMenu(e)}}showContextMenuByKey(e){if(!Yn.isEditable(e.target)){const{target:t}=e;if(t)return oh=e,Yn.triggerMouseEvent(t,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),oh=null,!0}return!1}internalShowContextMenu(e,t){const n=this;let r;n.disabled||!e.handled&&!e.defaultPrevented&&(r=n.getDataFromEvent(e))&&n.shouldShowMenu(r)&&("contextmenu"===e.type&&c.isSafari&&!e.ctrlKey&&e.metaKey&&Jt.on({element:e.target,capture:!0,once:!0,thisObj:this,click(e){e.preventDefault(),e.stopImmediatePropagation()}}),r.domEvent=e,n.showContextMenu(r,t))}getDataFromEvent(e){return{feature:this,event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}async showContextMenu(e,t){var n,r;const i=this,s=Yn.isDOMEvent(e),o=s?i.getDataFromEvent(e):e,a=s?e:o.domEvent,l=null===(n=Yn.isInView(o.targetElement))||void 0===n?void 0:n.center;if(null===(r=i._menu)||void 0===r||r.hide(),i.disabled||!l)return;i.menuContext=o;const{type:d,client:c,processItems:u}=i;if(C.assign(o,{point:null!=a&&a.clientX?[a.clientX+1,a.clientY+1]:[l.x,l.y],menu:i,items:{},selection:c.selectedRecords}),i.callChainablePopulateMenuMethod(o),C.merge(o.items,i.baseItems),i.preventNativeMenu&&i.preventDefaultEvent(o),(!u||!1!==await i.callback(u,c,[o]))&&i.hasActiveMenuItems(o)&&(i.populateItemsWithData(o),!1!==i.beforeContextMenuShow(o))){const{menu:e}=i,{featureItems:n}=e,{items:r}=o;i.preventDefaultEvent(o);let s=c.trigger(`${d}MenuBeforeShow`,o);if(W.isPromise(s)&&(a.handled=!0,s=await s),!Object.values(r).some((e=>e)))return;var h;if(!1!==s)n&&(e.remove(n),nt.asArray(n).forEach((e=>e.destroy()))),e.featureItems=e.add(...Array.isArray(r)?r:e.processItemsObject(r)),e.showBy(t||{target:o.domEvent,align:"s0-e100"}),null===(h=i.touchMoveDetacher)||void 0===h||h.call(i),i.touchMoveDetacher=Jt.on({element:c.element,touchmove:()=>e.hide(),thisObj:e,once:!0}),a&&(a.preventDefault(),a.handled=!0)}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:t}=e,n=e._baseItems=C.assign({},e.items);for(const e in n){const r=n[e];r&&(t&&e in t?n[e]="object"==typeof r?C.merge(C.clone(t[e]),r):t[e]:!0===r&&delete n[e])}}return this._baseItems}hideContextMenu(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}callChainablePopulateMenuMethod(e){var t,n;null===(t=(n=this.client)[`populate${N.capitalize(this.type)}Menu`])||void 0===t||t.call(n,e)}hasActiveMenuItems(e){return Object.values(e.items).some((e=>e&&!e.hidden))}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;null===(t=e.event)||void 0===t||t.preventDefault()}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}changeMenu(e,t){const n=this,{client:r,type:i}=n;if(e)return sh.reconfigure(t,e?sh.mergeConfigs({owner:r,rootElement:r.rootElement,onItem(e){r.trigger(`${i}MenuItem`,e)},onToggle(e){r.trigger(`${i}MenuToggleItem`,e)},onDestroy(){n.menu=null},onBeforeItem(e){Object.assign(e,n.menuContext)},onShow({source:e}){n.menuContext.menu=e,r.trigger(`${i}MenuShow`,n.menuContext)}},e):null,n);null!=t&&t.isWidget&&t.destroy()}}ah._$name="ContextMenuBase";const lh={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"};class dh extends(lt(Qe)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,constrainToParent:!0,rtlSource:null}}static configurable={skipUpdatingElement:null};construct(e){const t=this;super.construct(e),t.handleSelector||c.isHoverableDevice||(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}getX(e){return"inset"===this.positioning?parseFloat(getComputedStyle(e).insetInlineStart,10):Yn.getTranslateX(e)}getY(e){return"inset"===this.positioning?parseFloat(getComputedStyle(e).insetBlockStart,10):Yn.getTranslateY(e)}setX(e,t){"inset"===this.positioning?e.style.insetInlineStart=t+"px":Yn.setTranslateX(e,t)}setY(e,t){"inset"===this.positioning?e.style.insetBlockStart=t+"px":Yn.setTranslateY(e,t)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:n,event:r}=e.grab;e.startEvent=r;const i=e.getX(n)||n.offsetLeft,s=e.getY(n)||n.offsetTop;e.context={element:n,edge:t,valid:!0,async:!1,elementStartX:i,elementStartY:s,newX:i,newY:s,elementWidth:n.offsetWidth,elementHeight:n.offsetHeight,startX:r.clientX+e.scrollLeft,startY:r.clientY+e.scrollTop,finalize:()=>{var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},n.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:lh.down,touchstart:lh.touchstart,thisObj:e};!e.handleSelector&&c.isHoverableDevice&&(t.mousemove={handler:lh.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),Jt.on(t)}get isRTL(){var e;return Boolean(null===(e=this.rtlSource)||void 0===e?void 0:e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){var t;const n={element:document,keydown:lh.keydown,thisObj:this};e?(n.touchmove=lh.touchmove,n.touchend=n.pointerup=lh.touchend):(n.mousemove=lh.move,n.mouseup=lh.up),this.removeDragListeners=Jt.on(n),null===(t=this.onResizeHandlePointerDown)||void 0===t||t.call(this,this.startEvent)}removeDragListeners(){}reset(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const n=this;n.startEvent=t,n.canResize(t.target,t)&&n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),"touchstart"===t.type&&t.preventDefault(),n.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const n=this,{context:r,direction:i}=n;if(null!=r&&r.element&&(r.started||Jt.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)){var s;if(!r.started)null===(s=n.scrollManager)||void 0===s||s.startMonitoring(W.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:i}],callback:e=>{var t;return(null===(t=n.context)||void 0===t?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:r,event:t}),r.started=!0;n.update(t)}else e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var n;const r=this,i=r.context;var s,o;(null===(n=r.removeDragListeners)||void 0===n||n.call(r),i)?(null===(s=r.scrollManager)||void 0===s||s.stopMonitoring(),i.started&&Jt.on({element:Yn.getRootElement(t.target),thisObj:r,click:lh.docclick,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)):null===(o=r.reset)||void 0===o||o.call(r)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,{context:n,constrainToParent:r}=t,{element:i}=n;if(r){const r=Ot.from(t.outerElement);n.currentX=Math.max(Math.min(e.clientX,r.right),r.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY,r.bottom),r.y)+t.scrollTop}else n.currentX=e.clientX+t.scrollLeft,n.currentY=e.clientY+t.scrollTop;i.classList.add(t.resizingCls),t.updateResize(e)&&(t.trigger("resizing",{context:n,event:e}),i.classList.toggle(t.invalidCls,!1===n.valid)),t.lastMouseMoveEvent=e}abort(e=!1){var t,n;const r=this;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const n=this;if(n.allowResize&&!n.allowResize(t.target,t))return!1;const r=n.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,s=i.clientX,o=i.clientY;let a=n.targetSelector?t.target.closest(n.targetSelector):t.target;if(a){var l;let i;if(r){if(!t.target.matches(r))return!1;i="horizontal"===n.direction?t.pageX<Yn.getPageX(a)+a.offsetWidth/2?n.isRTL?"right":"left":n.isRTL?"left":"right":t.pageY<Yn.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===n.direction?n.overLeftHandle(t,a)?i=n.isRTL?"right":"left":n.overRightHandle(t,a)&&(i=n.isRTL?"left":"right"):n.overTopHandle(t,a)?i="top":n.overBottomHandle(t,a)&&(i="bottom"),!i)return n.context=null,!1;"touchstart"===t.type&&t.preventDefault();const d=null===(l=n.internalBeforeStart)||void 0===l?void 0:l.call(n,{element:a,edge:i});if(d&&(a=d.element,i=d.edge),!1!==n.trigger("beforeResizeStart",{element:a,event:t})){const t=n.getX(a)||a.offsetLeft,r=n.getY(a)||a.offsetTop;return n.context={element:a,edge:i,isTouch:e,valid:!0,async:!1,direction:n.direction,elementStartX:t,elementStartY:r,newX:t,newY:r,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,startX:s+n.scrollLeft,startY:o+n.scrollTop,finalize:()=>{var e;return null===(e=n.reset)||void 0===e?void 0:e.call(n)}},a.classList.add(n.resizingCls),!0}}return!1}checkResizeHandles(e){const t=this,n=t.targetSelector?e.target.closest(t.targetSelector):e.target;let r=!1;return!n||t.allowResize&&!t.allowResize(e.target,e)?t.currentElement&&t.unHighlightHandle():(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&(r="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n),r?t.highlightHandle():t.unHighlightHandle())),r}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:n,allowEdgeSwitch:r,skipTranslate:i,skipUpdatingElement:s}=t;let o;r&&("horizontal"===t.direction?n.edge=n.currentX>n.startX?"right":"left":n.edge=n.currentY>n.startY?"bottom":"top");const{element:a,elementStartX:l,elementStartY:d,elementWidth:c,elementHeight:u,edge:h}=n,{style:g}=a,m=(n.currentX-n.startX)*("inset"===t.positioning&&t.isRTL?-1:1),p=n.currentY-n.startY,f=Yn.getExtremalSizePX(a,"minWidth")||t.minWidth,v=Yn.getExtremalSizePX(a,"maxWidth")||t.maxWidth,y=Yn.getExtremalSizePX(a,"minHeight")||t.minHeight,b=Yn.getExtremalSizePX(a,"maxHeight")||t.maxHeight,C=("right"!==h||t.isRTL&&"inset"!==t.positioning)&&"bottom"!==h?-1:1,w=c+m*C,S=u+p*C;let D=Math.max(f,w),E=Math.max(y,S);if(v>0&&(D=Math.min(D,v)),b>0&&(E=Math.min(E,b)),"horizontal"===t.direction&&c!==D){if(s||(g.flex="",g.width=Math.abs(D)+"px"),n.newWidth=D,"left"===h||D<0){const e=Math.max(Math.min(l+c-t.minWidth,l+m),0);i||t.setX(a,Math.round(e)),n.newX=e}else"right"===h&&r&&!i&&t.setX(a,l);o=!0}else"vertical"===t.direction&&u!==S&&(s||(g.flex="",g.height=Math.abs(E)+"px"),n.newHeight=E,"top"===h||E<0?(n.newY=Math.max(Math.min(d+u-t.minHeight,d+p),0),i||t.setY(a,n.newY)):"bottom"===h&&r&&!i&&t.setY(a,d),o=!0);return o}finishResize(e){const t=this,n=t.context,r={context:n,event:e};if(n.element.classList.remove(t.resizingCls),n.started){let e=!1;e="horizontal"===t.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,t.trigger(e?"resize":"cancel",r),n.async||n.finalize()}else{var i;null===(i=t.reset)||void 0===i||i.call(t)}}abortResize(e=null,t=!1){const n=this,r=n.context;r.element.classList.remove(n.resizingCls),"horizontal"===n.direction?(("left"===r.edge||r.allowEdgeSwitch&&!r.skipTranslate)&&n.setX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(n.setY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&n.trigger("cancel",{context:r,event:e}),n.isDestroyed||n.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}overLeftHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.leftHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=Ot.from(t);return i.width=n.getDynamicHandleSize(n.rightHandle,r),i.width>0&&i.contains(Jt.getPagePoint(e))}return!1}overRightHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.rightHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=Ot.from(t);return i.x=i.right-n.getDynamicHandleSize(n.leftHandle,r),i.width>0&&i.contains(Jt.getPagePoint(e))}return!1}overTopHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.topHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=Ot.from(t);return i.height=n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Jt.getPagePoint(e))}return!1}overBottomHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.bottomHandle&&n.canResize(t,e)&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=Ot.from(t);return i.y=i.bottom-n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Jt.getPagePoint(e))}return!1}}dh._$name="ResizeHelper";const ch=/>[ \t\r\n]+</g,uh=/\s\s+/g;class hh{static tpl(e,...t){let n=0,r=t.map(((t,r)=>{let i=e[r];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),n++,i})).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(ch,"><").replace(uh," ").trim()}static docsTpl(e,...t){let n=0,r=t.map(((t,r)=>{let i=e[r];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),n++,i})).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(ch,"><").trim()}static repeat(e){return function(...t){return hh.tpl(...t).repeat(e)}}static loop(e){}}hh._$name="TemplateHelper";class gh extends Array{constructor(e,t){super(),this.timeZone=e,this.year=t}}class mh{constructor(e,t){this.asString=e,this.timeZone=t,this.asArray=vh(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}}const ph=(e,t)=>{const n=e.toLocaleString("sv-SE",{timeZone:t});return new mh(n,t)},fh=(e,t)=>{const{asTicksUtc:n,asString:r}=ph(new Date(e),t);return{offset:(e-n)/6e4,tzTicksUtc:n,tzString:r}},vh=e=>{const t=e.split(/[\s-:]/).map((e=>1*e));return t[1]-=1,t},yh=-864e5,bh=2592e6,Ch=(e,t)=>{const n=wh.get(e,t);if(n)return n;const r=new gh(e,t),i=new Date(Date.UTC(t,0,1)).getTime();let s,o,a,l,d=i,c=bh,u=0,h=[],g=null;for(;!l;)({offset:a,tzTicksUtc:s,tzString:o}=fh(d,e)),null==g?(g=a,r.push({offset:a})):c>0&&a!==g?c=c===bh?yh:-6e4:c<0&&a===g&&(c===yh?c=36e5:(1===r.length?(r.push(h),g=h.offset):(r[0].startTicks=h.startTicks,r[0].startDateString=h.startDateString,l=!0),c=bh)),h={offset:a,startDateString:o,startTicks:s},c===bh&&(d=i,d+=u*bh,u+=1),d+=c,u>11&&(l=!0);return wh.set(r),r},wh={_cache:{},get(e,t){var n;return null===(n=this._cache[e])||void 0===n?void 0:n[t]},set(e){const{timeZone:t}=e,{_cache:n}=this;n[t]||(n[t]={}),n[t][e.year]=e}};class Sh{static $name="TimeZoneHelper";static toTimeZone(e,t){if("number"==typeof t)return this.toUtcOffset(e,t);const n=ph(e,t);return n.asArray[3]!==n.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),n.asLocalDate}static fromTimeZone(e,t){if("number"==typeof t)return this.fromUtcOffset(e,t);const n=this.dateAsArray(e),r=Ch(t,e.getUTCFullYear());let i=r[0].offset;if(2===r.length){const e=Date.UTC(...n);e>=r[1].startTicks&&e<r[0].startTicks&&(i=r[1].offset)}return n[4]+=i,new Date(Date.UTC(...n))}static toUtcOffset(e,t){const n=e.getTimezoneOffset()+t;return new Date(e.getTime()+60*n*1e3)}static fromUtcOffset(e,t){const n=-e.getTimezoneOffset()-t;return new Date(e.getTime()+60*n*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}}Sh.findOffsetDates=Ch,l.register(Sh),Sh._$name="TimeZoneHelper";class Dh extends oc{static $name="Toast";static type="toast";static get configurable(){return{testConfig:{destroyTimeout:1,timeout:400},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,sideMargin:20,side:"bottom",role:"alert"}}static toasts={"top-start":[],"top-end":[],"bottom-start":[],"bottom-end":[]};changeSide(e){return"top"==e||"bottom"==e?e+="-end":"start"!==e&&"end"!=e||(e="bottom-"+e),e}compose(){const{appendTo:e,color:t,html:n,showProgress:r,style:i,timeout:s,side:o}=this;return{parent:e||this.floatRoot,class:{...Vt.normalize(t,"object"),[`b-side-${o}`]:1,"b-toast-hide":1},"aria-atomic":!1,html:n,style:{...Yn.parseStyle(i),"--side":o.split("-")[0]},children:{progressElement:r&&{style:`animation-duration:${s}ms;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}getNextInset(e){const{sideMargin:t,element:n}=this;return parseInt(n.style[e],10)+n.offsetHeight+t}async show(){var e;await super.show(...arguments);const t=this,{element:n,side:r}=t,i=Dh.toasts[r],s=r.split("-")[0],o=t.timeout*(null!==(e=Yn.getActiveElement())&&void 0!==e&&e.matches(":focus-visible")?3:1);var a;i.includes(t)||(n.style[s]=((null===(a=i[0])||void 0===a?void 0:a.getNextInset(s))??t.sideMargin)+"px",i.unshift(t),n.getBoundingClientRect(),n.classList.remove("b-toast-hide"),o>0&&(t.hideTimeout=t.setTimeout("hide",o)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const e=Dh.toasts[this.side];e.includes(this)&&e.splice(e.indexOf(this),1),Yn.removeAttributeValue(document.body,"aria-describedby",this.id)}static hideAll(){Object.keys(Dh.toasts).forEach((e=>Dh.toasts[e].slice().reverse().forEach((e=>e.hide()))))}static show(e){var t;const n=Dh.new({autoDestroy:!0,rootElement:document.body,autoShow:!1},"string"==typeof e?{html:e}:e);return null!==(t=Yn.getActiveElement())&&void 0!==t&&t.matches(":focus-visible")&&Object.values(this.toasts).flat().length?dt.waitFor((()=>!Object.values(this.toasts).flat().length)).then((()=>setTimeout((()=>n.show()),250))):n.show(),n}}Dh.initClass(),Dh._$name="Toast";class Eh{static getById(e){return G.deprecate("core","7.0.0","Use Widget.getById instead"),oc.getById(e)}static fromElement(e,t,n){return G.deprecate("core","7.0.0","Use Widget.fromElement instead"),oc.fromElement(e,t,n)}static createWidget(e={}){return G.deprecate("core","7.0.0","Use Widget.create instead"),e.isWidget?e:oc.create(e)}static append(e,t){if(G.deprecate("core","7.0.0","Use a Container instead"),e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>oc.create(W.assign({},t||{},e))))}static openPopup(e,t){return G.deprecate("core","7.0.0","Use Popup directly instead"),oc.create(W.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){G.deprecate("core","7.0.0","Use Menu directly instead");const n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:(t.forElement=document.body,Array.isArray(e)&&(e=new $t(...e)),e instanceof $t&&(t.align={position:e})),t.internalListeners={destroy:n.currentContextMenu=null},n.currentContextMenu=oc.create(t,"menu")}static attachTooltip(e,t){return G.deprecate("core","7.0.0","Use Tooltip directly instead"),oc.attachTooltip(e,t)}static hasTooltipAttached(e){return G.deprecate("core","7.0.0","Will be removed"),oc.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return G.deprecate("core","7.0.0","Will be removed"),oc.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(G.deprecate("core","7.0.0","Use Mask directly instead"),e)return e instanceof HTMLElement&&(e={target:e,text:t}),mc.mask(e,e.target)}static unmask(e,t=!0){G.deprecate("core","7.0.0","Use Mask directly instead"),e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return G.deprecate("core","7.0.0","Use Toast directly instead"),Dh.show(e)}}Eh._$name="WidgetHelper";class xh{static convertFromObject(e,t={}){C.assignIf(t,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:n,elementName:r,includeHeader:i,rootElementForArray:s}=t;let{xmlns:o}=t;o=o?` xmlns="${o}"`:"";const a=e=>{const t=[];for(const n in e){const i=e[n];if(Array.isArray(i)){s&&t.push(`<${n}>`);for(const e of i)r.length?t.push(`<${r}>`):t.push(`<${n}>`),t.push(a(e)),r.length?t.push(`</${r}>`):t.push(`</${n}>`);s&&t.push(`</${n}>`)}else C.isObject(i)?t.push(`<${n}>${a(i)}</${n}>`):null==i?t.push(`<${n}/>`):t.push(`<${n}>${N.encodeHtml(i)}</${n}>`)}return t.join("")};return`${i?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':""}<${n}${o}>${a(e)}</${n}>`}}xh._$name="XMLHelper";class Rh{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:t}=this;let n;return t[e]?n=t[e]:(n=this.random100.filter((t=>t<e)),t[e]=n),n[this.rndIndex++%n.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,t){const n=[],r=this.nextRandom(t+1),i={};for(let t=0,s=this.nextRandom(e.length);t<r;t++){for(;i[s];)s=this.nextRandom(e.length);i[s]=!0,n.push(e[s])}return n}}Rh._$name="RandomGenerator";const Th=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"];class Mh{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static rnd=new Rh;static rndTime=new Rh;static rndRating=new Rh;static rndText=new Rh;static get cities(){return["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Montreal"]}static get namesWithAvatars(){return["Adam","Amit","Angelo","Arcady","Arnold","Barbara","Celia","Chang","Dan","Daniel","Dave","David","Don","Doug","Emilia","George","Gloria","Henrik","Hitomi","James","Jane","Jenny","John","Jong","Karen","Kate","Lee","Linda","Lisa","Lola","Macy","Madison","Malik","Mark","Mary","Maxim","Melissa","Mike","Rob","Steve","Team","Theo"]}static get firstNames(){return["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"]}static get surNames(){return["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"]}static get teams(){return["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"]}static get foods(){return["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"]}static get colors(){return["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}static get skills(){return["JavaScript","CSS","TypeScript","React","Vue","Angular","Java","PHP","Python","C#","C++","BASIC","COBOL","FORTRAN","PASCAL","SQL"]}static get tasks(){return["Meetings","Documentation","Email communication","Project management","Budgeting","Marketing and advertising","Customer service","Research and analysis","Data entry","IT support","Employee management","Sales and business development","Event planning","Graphic design","Writing and editing","Presentation","Travel arrangements and expense management","Training and development","Quality assurance","Customer support","Technical writing","Social media management","Translation","Legal research","Data analysis and visualization","Video editing and production","Network admin","Content creation","Market research","Public relations","Teaching and training","Recruiting","Product development"]}static generateName(){const{namesWithAvatars:e,surNames:t}=this;return`${e[Math.round(Math.random()*(e.length-1))]} ${t[Math.round(Math.random()*(t.length-1))]}`}static*generate(e,t=!1,n=1){let r,i;"object"==typeof e&&(t=e.randomHeight,n=e.initialId??1,r=e.addSkills,i=e.rowCallback,e=e.count);const{rnd:s,rndTime:o,rndRating:a,rndText:l,firstNames:d,surNames:c,teams:u,foods:h,colors:g,cities:m,skills:p}=this;for(let v=0;v<e;v++){var f;const y=s.fromArray(d),b=s.fromArray(c),C=`${y} ${String.fromCharCode(65+v%25)} ${b}`,w=s.nextRandom(60)+1,S=new Date(2019,0,w),D=new Date(2019,0,w+s.nextRandom(30)+2),E={id:n>-1?v+n:void 0,title:"Row "+v,name:C,firstName:y,surName:b,city:s.fromArray(m),team:s.fromArray(m)+" "+s.fromArray(u),age:10+s.nextRandom(80),food:s.fromArray(h),color:s.fromArray(g),score:10*s.nextRandom(100),rank:s.nextRandom(100)+1,start:S,finish:D,time:xi.getTime(o.nextRandom(24),5*o.nextRandom(12)),percent:s.nextRandom(100),done:s.nextRandom(100)<50,rating:a.nextRandom(5),active:w>30,relatedTo:Math.min(e-1,v+n+s.nextRandom(10)),notes:Th[l.nextRandom(7)+1]};r&&(E.skills=s.randomArray(p,"number"==typeof r?r:7));const x=null===(f=i)||void 0===f?void 0:f(E);x&&Object.assign(E,x),t&&(E.rowHeight=5*s.nextRandom(!0===t?20:t)+20),yield E}}static generateData(e,t=!1,n=1,r=!0){let i=e;"object"!=typeof e&&(i={count:e,randomHeight:t,initialId:n,reset:r}),!1!==i.reset&&this.reset(),Mh.overrideRowCount&&(i.count=Mh.overrideRowCount);const s=[],o=this.generate(i);for(let e=0;e<i.count;e++)s.push(o.next().value);return s}static generateEvents({viewStartDate:e,viewEndDate:t,nbrResources:n=50,nbrEvents:r=5,dependencies:i,tickUnit:s="days",minDuration:o=2,maxDuration:a=10,gap:l=1,eventCallback:d}){const c=this.generateData(n),u=[];let h,g;i=[];for(let t=0;t<=n;t++)for(let n=0;n<=r;n++){const r=Math.round(Math.random()*(a-1-o))+o,c=u.length+1;h=0===n?xi.add(e,Math.round(3*Math.random())*l,s):xi.add(g,l,s),g=xi.add(h,r,s),u.push({id:c,name:this.tasks[(t+n)%(this.tasks.length-1)],startDate:h,duration:r,endDate:g,resourceId:t}),null==d||d(u[u.length-1]),i&&t>0&&i.push({id:i.length+1,from:c-1,to:c})}return{resources:c,events:u,dependencies:i}}static generateOneEventPerTickAndResource({startDate:e,endDate:t,nbrResources:n=50,tickUnit:r="days"}){const i=this.generateData(n),s=[],o=xi.getDurationInUnit(e,t,r);for(let t=0;t<=n;t++)for(let n=0;n<o;n++)s.push({id:s.length+1,resourceId:t,name:this.tasks[(t+n)%(this.tasks.length-1)],startDate:xi.add(e,n,r),duration:1,durationUnit:r});return{resources:i,events:s}}static generateRow(){return Mh.generateData(1,!1,-1,!1)[0]}}Mh._$name="DataGenerator";const kh=["action","target","to","deltaX","deltaY","x","y","text"];class Fh extends(lt(Hi())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),Jt.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:Yn.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",(e=>{e.isTrusted&&t.abort()}))}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),Jt.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,n){if(!e)return null;let r;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();r=new MouseEvent(t,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},n||{}))}else r=document.createEvent("Event"),r.initEvent(t,!0,!1);return e.dispatchEvent(r),r}handleMouseMove(e,t){const n=this,r=n.mouse;r.classList.add("quick"),n.mouseDown&&r.classList.add("drag");const i=Ot.from(r,n.outerElement),s=i.x,o=i.y;let a=0,l=0;if(e.to)if("string"==typeof e.to){const t=n.outerElement.querySelector(e.to);if(t){const e=Ot.from(t,n.outerElement),r=e.x+e.width/2,i=e.y+e.height/2;a=(r-s)/10,l=(i-o)/10}}else e.to.x?a=(e.to.x-s)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let d=0;n.innerIntervalId=n.setInterval((()=>{if(n.shouldPause)return;9==d++&&(clearInterval(n.innerIntervalId),e.then&&e.then());const t=s+a*d,i=o+l*d;r.style.left=t+"px",r.style.top=i+"px";const c=r.getBoundingClientRect(),u=c.left,h=c.top,g=Yn.elementFromPoint(u,h);g!==n.prevTarget&&(n.prevTarget&&(n.mouseOutElements.push(n.prevTarget),Yn.isDescendant(n.mouseOutElements[0],g)||(n.mouseOutElements.forEach((e=>n.triggerEvent(e,"mouseout"))),n.mouseOutElements.length=0)),n.prevTarget=g,n.triggerEvent(g,"mouseover")),n.triggerEvent(g,e.action,{clientX:u,clientY:h})}),50)}getTarget(e){const t=this,n=e.target;return n?"function"==typeof n?n(e):document.querySelector(n):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!kh.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),n=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,n}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<globalThis.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,n=e.normalizeStep(e.steps[e.currentStep++]),r=e.getTarget(n),i=n.action;if(r&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(n,r);else{if(r!==e.prevTarget){const n=Ot.from(r,e.outerElement);t.style.left=n.x+n.width/2+"px",t.style.top=n.y+n.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((()=>{if(e.prevTarget=r,t.classList.add(i),"type"===i){const e=oc.fromElement(r),t=n.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(r,i)}),"type"===i?100:550)}}}Fh._$name="DemoBot";const{defineProperty:Ih}=Object,Ah=Symbol("fencible"),Lh=[],Ph=e=>Array.from(new Set(e)),Oh=e=>e?Ph(N.split(e)):Lh;var $h=e=>class extends(e||Qe){static $name="Fencible";static declarable=["fenced"];static setupFenced(e,t){const{fenced:n}=e,r=t.getInherited("fenced");let i,s,o,a,l;for(a in n)l=n[a],!0===l&&(l=a),W.isObject(l)||(l={all:l}),i=Oh(l.all),s=Oh(l.any),o=l.lock?Oh(l.lock):Ph(i.concat(s)),s=s.length?s:null,r[a]={any:s,all:i,lock:o}}construct(...e){const t=this,n=Object.getPrototypeOf(t),r=t.$meta.getInherited("fenced"),i=t[Ah]={},s=e=>!i[e];return W.forEach(r,(({any:e,all:r,lock:o},a)=>{Ih(t,a,{configurable:!0,value(...l){if(r.every(s)&&(!e||e.some(s))){let e;try{for(e of o)i[e]=(i[e]||0)+1;return n[a].apply(t,l)}finally{for(e of o)--i[e]}}}})})),super.construct(...e)}get widgetClass(){}};const{floor:_h,max:Hh,min:Vh}=Math,Nh=(e,t,n)=>Vh(Hh(e,t),n);class Bh extends(Qe.mixin($h)){static configurable={owner:null,drift:null,overflow:null,pos:{value:null,default:0,$config:"lazy"},range:{value:null,$config:"lazy"},scrollSize:null};static fenced={sync:!0};get direction(){const{name:e}=this,{events:t,scrollStarted:n}=this.owner;let r,i,s,o=0;for(r=t.length;r-- >0&&(s=t[r][e],null==i||(o=i-s,!o));)i=s;return o||null==i||(o=i-n[e]),o}get drift(){return this._drift||0}get driftRange(){const{range:e}=this;return[e[0],Hh(e[0],e[1]-this.scrollSize)]}get items(){var e;return null===(e=this.owner)||void 0===e?void 0:e.items}get safeZone(){const{drift:e,scrollSize:t}=this,n=_h(this.owner.safetyMargin*t);return[e+n,e+t-n]}get scroller(){var e;return null===(e=this.owner)||void 0===e||null===(e=e.client)||void 0===e?void 0:e.scrollable}get scrollLimit(){var e;return null===(e=this.owner)||void 0===e?void 0:e.scrollLimit}get vast(){const{range:e}=this;return!!e&&e[1]-e[0]>this.scrollSize}changePos(e){const{range:t}=this;return Nh(e||0,t[0],t[1])}updatePos(e){this.sync({pos:e})}updateDrift(e){const t=this,{pos:n,range:r}=t,i=n-e;if(t.scrollPos===i){const e=new CustomEvent("scroll",{detail:"driftChange"});t.owner.scroller.element.dispatchEvent(e)}else r[0]<=n&&n<r[1]&&(t.scrollPos=i)}changeRange(e,t){const[n,r]=Array.isArray(e)?e:[0,e],i=[n||0,null==r?1/0:r];if(!t||i[0]!==t[0]||i[1]!==t[1])return i}updateRange(e){this.scrollSize=e[1]-e[0],this.sync({range:e})}changeScrollSize(e){return Vh(e,this.scrollLimit)}snap(){const e=this,{direction:t,items:n,owner:r,pos:i,range:s}=e;let o,a,l,d,c;for(o of n)if([a,l]=e.getItemSpan(o),a<=i&&i<l){a<i?(c=r.snapThreshold,c<1&&(c*=l-a),c=Hh(1,c),d=t<0?l-i>c?a:l:i-a>c?l:a,d=Nh(d,s[0],s[1]),e.pos=d,r.watchForEnd()):r.scrolling=!1;break}}sync(e){const t=Object.assign(this,e),{_drift:n,range:r,vast:i}=t;if(r&&r[0]!==r[1]){let s,{pos:o}=t;const a=o<r[0]||o>=r[1];if((null==o||a)&&(o=r[1]<0?r[0]:Nh(0,r[0],r[1])),i){const{driftRange:e,safeZone:r,scrollSize:i}=t;s=null==n||o<r[0]||o>r[1]?Nh(_h(o-i/2),e[0],e[1]):n}else s=r[0];t.scroller.positionDirty=!0,t.overflow="hidden-scroll",t.drift=s,s!==n?a?(t.positionDirty=!1,t._pos=null,t.pos=o):t.positionDirty=!0:null!=(null==e?void 0:e.pos)?(t.scrollPos=o-s,t.positionDirty=!0):(t.positionDirty&&(t.positionDirty=!1,t._pos=null),t.pos=t.scrollPos+s),(null!=e&&e.range||s!==n)&&t.owner.syncItems()}else t.overflow="hidden"}toLogical(e){return e+this.drift}toPhysical(e){const t=e-this.drift;return t>=0&&t<this.scrollLimit?t:NaN}}Bh.X=class extends Bh{get name(){return"x"}get other(){var e;return null===(e=this.owner)||void 0===e?void 0:e.y}get scrollPos(){return this.scroller.x}set scrollPos(e){this.scroller.x=e}get scrollSize(){return this.scroller.scrollWidth}set scrollSize(e){super.scrollSize=e}getItemSpan(e){const t=e.$vxy,{x:n}=t;return[n,n+t.width]}updateScrollSize(e){this.scroller.scrollWidth=e}updateOverflow(e){this.scroller.overflowX=e}},Bh.Y=class extends Bh{get name(){return"y"}get other(){var e;return null===(e=this.owner)||void 0===e?void 0:e.x}get scrollPos(){return this.scroller.y}set scrollPos(e){this.scroller.y=e}get scrollSize(){return this.scroller.scrollHeight}set scrollSize(e){super.scrollSize=e}getItemSpan(e){const t=e.$vxy,{y:n}=t;return[n,n+t.height]}updateScrollSize(e){this.scroller.scrollHeight=e}updateOverflow(e){this.scroller.overflowY=e}},Bh._$name="Axis";const zh="b-infinity-scroller",jh=Object.freeze({width:0,height:0}),Wh=(e,t)=>{const n="v"+t;n in e||Object.defineProperty(e,n,{configurable:!0,get(){var e;return null===(e=this.$vxy)||void 0===e?void 0:e[t]},set(e){this.$vxy&&(this.$vxy[t]=e)}})};class Uh extends Qe{static configurable={hidden:null,owner:null,widget:null};static prototypeProperties={_height:0,_width:0,_x:0,_y:0};get height(){return this.getDim("height")}get width(){return this.getDim("width")}get x(){return this._x}set x(e){this.moveTo(e)}get xy(){return[this._x,this._y]}set xy(e){this.moveTo(...e)}get y(){return this._y}set y(e){this.moveTo(null,e)}getDim(e){const t=this,{widget:n}=t,r="_"+e;return n?n.monitorResize?n[e]:t[r]||(t[r]=n[e]):0}moveTo(e,t){null!=e&&(this._x=e),null!=t&&(this._y=t),this.sync()}sync(){const e=this,{owner:t,widget:n}=e,{element:r}=n,i=t.x.toPhysical(e.x),s=t.y.toPhysical(e.y),o=isNaN(i+s);e.hidden=o,o?e.size=jh:r.style.transform=`translate(${i}px, ${s}px)`}updateHidden(e){var t;null===(t=this.widget)||void 0===t||null===(t=t.element)||void 0===t||t.classList.toggle("b-scroll-hidden",e)}updateWidget(e,t){null==t||t.element.classList.remove("b-infinity-scroller-item"),e&&(e.element.classList.add("b-infinity-scroller-item"),Wh(e,"x"),Wh(e,"y"),Wh(e,"xy"))}}class Gh extends(Qe.mixin(lt)){static configurable={animate:"smooth",client:null,safetyMargin:.01,scroller:null,scrollIdle:8,scrolling:null,scrollLimit:{value:0,$config:"lazy"},snap:null,snapThreshold:.1,x:{},y:{}};get element(){var e;return null===(e=this.scroller)||void 0===e?void 0:e.element}get events(){return this._events||(this._events=[])}get items(){var e;return((null===(e=this.client)||void 0===e?void 0:e.items)||[]).filter((e=>e.$vxy))}get lastEvent(){var e;return null===(e=this._events)||void 0===e?void 0:e[this._events.length-1]}get pos(){return[this.x.pos,this.y.pos]}changeScrollLimit(e){return e||Yn.scrollLimit}updateAnimate(e,t){var n;const r=null===(n=this.element)||void 0===n?void 0:n.classList;t&&(null==r||r.remove(`b-infinity-scroller-${t}`)),e&&(null==r||r.add(`b-infinity-scroller-${e}`))}updateClient(e){this.scroller=(null==e?void 0:e.scrollable)||null}updateScroller(e,t){var n;this.detachListeners("scroller"),null==t||null===(n=t.element)||void 0===n||n.classList.remove(zh),e&&(e.element.classList.add(zh),e.ion({thisObj:this,name:"scroller",scroll:"onInternalScroll"}))}changeX(e){return Bh.X.new(e,{owner:this})}changeY(e){return Bh.Y.new(e,{owner:this})}onInternalScroll(e){const t=this,{lastPos:n,scrolling:r}=t;r||(t.scrolling="maybe"),t.sync();const i=[t.x.pos,t.y.pos];n&&n[0]===i[0]&&n[1]===i[1]?t.scrolling=r:(t.lastPos=i,t.pushEvent(e),r||(t.scrolling=!0),t.triggerScroll("scroll",e))}onInternalScrollEnd(){const e=this,{scrolling:t}=e;t&&("snap"===t?e.updateScrolling(t):e.scrolling=!!e.snap&&"snap")}pushEvent(e){const t=this,{events:n}=t,r={event:e,x:t.x.pos,y:t.y.pos},i=n[n.length-1];if(e.type===(null==i?void 0:i.event.type)&&i.x===r.x&&i.y===r.y)i.event=e;else for(i||(t.scrollStarted=r),n.push(r);n.length>3;)n.shift()}scrollTo(e){const t=this,{scrollingTo:n}=t,r=t.x.pos,i=t.y.pos,s=(null==e?void 0:e.x)??(r+(null==e?void 0:e.dx)||0),o=(null==e?void 0:e.y)??(i+(null==e?void 0:e.dy)||0),a=s-r,l=o-i,d=a||l,c=!1!==(null==e?void 0:e.animate)&&null!==(null==e?void 0:e.animate);if(n){if(n.scroll.x===s&&n.scroll.y===o&&n.scroll.animate===c)return n.promise;n.finish()}const u=t.scrollingTo=Cl.new();return u.scroll={x:s,y:o,animate:c},d&&t.unanimated(!c,(()=>{a&&(t.x.pos=s),l&&(t.y.pos=o)})),d&&c?(u.cancel=t.ion({once:!0,scrollEnd(){u.resolve(t.x.pos===s&&t.y.pos===o)}}),u.finish=()=>{u.cancel&&(u.cancel(),u.cancel=null,u.resolve(!1),t.scrollStarted=null)}):u.resolve(!0),u.finally((()=>{t.scrollingTo===u&&(t.scrollingTo=null)})),u.promise}suppressAnim(e){const t=this,n=t._suppressAnim||0,r=t._suppressAnim=Math.max(0,n+(e?1:-1));t.scroller.behavior=r?"instant":null}sync(){this.unanimated((()=>{this.x.sync(),this.y.sync()}))}syncItems(){for(const e of this.items)e.$vxy.sync()}triggerScroll(e,t,n=this.x.pos,r=this.y.pos){this.trigger(e,{widget:this.client,relatedEvent:t,x:n,y:r})}updateScrolling(e,t){const n=this,r="maybe"===t,{lastEvent:i}=n;e?r?(n.watchForEnd(),n.scrollEnded=null,n.triggerScroll("scrollStart",i.event,i.x,i.y),n.element.classList.add("b-scrolling")):"snap"===e&&n[n.snap].snap():!t||"driftChange"!==(null==i?void 0:i.event.detail)&&r||(n.scrollEnded=i,n.events.length=0,n.triggerScroll("scrollEnd",i.event,i.x,i.y),n.element.classList.remove("b-scrolling"))}unanimated(e,t){if("function"==typeof e&&(t=e,e=!0),e){this.suppressAnim(!0);try{t()}finally{this.suppressAnim(!1)}}else t()}virtualize(e){"string"==typeof e&&(e=this.client.widgetMap[e]);let t=e.$vxy;var n;t&&t.owner===this||(null===(n=t)||void 0===n||n.destroy(),e.$vxy=t=new Uh({owner:this,widget:e}));return t}watchForEnd(){const e=this,{client:t,scrollIdle:n,scrollStarted:r}=e;let i,s,o=0;!function a(){if(!e.isDestroyed&&!t.isDestroyed&&r===e.scrollStarted){if(s=e.pos,i&&i[0]===s[0]&&i[1]===s[1]){if(++o>=n&&!ir.hasActiveTouches)return void e.onInternalScrollEnd()}else i=s,o=0;t.requestAnimationFrame(a)}}()}}Gh._$name="InfinityScroller";var Yh=e=>class extends e{static configurable={animate:"smooth",infinityScroller:{value:{},$config:"lazy"},monitorResize:!0,scrollable:{}};static delayable={syncSoon:"raf"};get infinityScrollerDefaults(){return{animate:this.animate}}compose(){return{}}changeInfinityScroller(e,t){return t?t.setConfig(e):t=Gh.new({client:this},this.infinityScrollerDefaults,e),t}onChildAdd(e){var t;return e.innerItem&&(null===(t=this._infinityScroller)||void 0===t||t.virtualize(e)),super.onChildAdd(e)}onInfiniteScroll(){this.syncSoon()}onInfiniteScrollEnd(){this.syncSoon.now()}onInfiniteScrollStart(){}onInternalResize(e,t,n,r,i){super.onInternalResize(e,t,n,r,i),this.hasPainted&&this.syncSoon()}onInternalPaint(e){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,e),e.firstPaint&&(this.syncSoon.now(),this.infinityScroller.ion({thisObj:this,scroll:"onInfiniteScroll",scrollStart:"onInfiniteScrollStart",scrollEnd:"onInfiniteScrollEnd"}))}get scrollingTo(){return this.infinityScroller.scrollingTo}scrollTo(e){return this.infinityScroller.scrollTo(e)}sync(){this.infinityScroller.sync()}syncSoon(){const e=this;e.isPainted&&(e.recompose.flush(),e.infinityScroller.animate=e.animate,e.sync())}unanimated(e,t){return this.infinityScroller.unanimated(e,t)}updateAnimation(){this._infinityScroller&&this.syncSoon()}get widgetClass(){}};class qh extends(Qe.mixin(lt,ds)){static $name="Navigator";static type="navigator";static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,activateOnMouseover:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",columnCount:null,testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${e.itemCls}:not([data-noselect])`),e.itemsFocusable||Yn.setAttributes(this.keyEventTarget,{"aria-activedescendant":`${this.owner.id}-active-descendant`})}set navigationEvent(e){const{owner:t}=this;this._navigationEvent=t.navigationEvent=e,e&&Promise.resolve(1).then((()=>this.navigationEvent=null))}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const t=(e.key||"").trim()||e.code;return`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${t}`}onKeyDown(e){const t=this,{ownerCmp:n,itemSelector:r,activeItem:i,itemsTabbable:s}=t,{target:o}=e,a=t.firstItem,l=(e.key||"").trim()||e.code,d=t.constructor.getComposedKeyName(e),c=o.matches(r)||o===t.keyEventTarget;if(!t.disabled&&t.processEvent&&(e=t.callback(t.processEvent,t.thisObj||n,[e])),e&&!t.disabled&&a&&t.target.offsetParent&&c){if(!s){if(null==t.inlineFlow){const e=t.itemContainer=a.parentNode,n=Yn.getStyleValue(e,"display"),r=Yn.getStyleValue(a,"position"),i=Yn.getStyleValue(a,"display"),s=Yn.getStyleValue(a,"float");t.columnCount||(t.columnCount=Yn.getStyleValue(e,"grid-template-columns").split(" ").length),t.inlineFlow="absolute"===r||"inline"===i||"inline-block"===i||"left"===s||"right"===s||"flex"===n&&"row"===Yn.getStyleValue(e,"flex-direction")||"grid"===n&&t.columnCount>1,t.columnCount>1&&(t.prevRowKey="ArrowUp",t.nextRowKey="ArrowDown")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.navigationEvent=e,i&&!t.disabled)switch(l){case t.prevKey:if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigatePrevious(e);break;case t.nextKey:if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),e.handled=!0,t.navigateNext(e);break;case t.prevRowKey:{if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault();const n=Array.from(t.itemContainer.querySelectorAll(t.itemSelector));t.activeItem=n[Math.max(n.indexOf(i)-t.columnCount,0)],e.handled=!0}break;case t.nextRowKey:{if(e.ctrlKey&&!t.allowCtrlKey||e.shiftKey&&!t.allowShiftKey)return;e.preventDefault();const n=Array.from(t.itemContainer.querySelectorAll(t.itemSelector));t.activeItem=n[Math.min(n.indexOf(i)+t.columnCount,n.length-1)],e.handled=!0}break;default:{var u;const r=null===(u=t.keys)||void 0===u?void 0:u[d];if(r&&!t.disabled){if(!1===t.callback(r,t.thisObj||n,[e,t,i]))return}else n.onInternalKeyDown&&n.onInternalKeyDown(e);if(Yn.getActiveElement(o)!==o&&e.preventDefault(),s)return}}else{if(s)return;l!==t.nextKey&&l!==t.prevKey||(t.activeItem=t.getDefaultNavigationItem(e))}t.activeItem!==i&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:n,prevKey:r,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===r?t.querySelector(`${n}:last-of-type`):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(`${n}`):void 0}navigatePrevious(e){const t=this,n=t.previous;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}navigateNext(e){const t=this,n=t.next;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}get owner(){return this.ownerCmp}get firstItem(){return this.target.querySelector(this.itemSelector)}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const n=this.treeWalker;if(n.currentNode=t,n[e<0?"previousNode":"nextNode"](),n.currentNode!==this.activeItem)return n.currentNode}onTargetFocusIn(e){const t=this,{target:n,relatedTarget:r}=e,{owner:i,itemsTabbable:s,skipScrollIntoView:o,previousActiveItem:a}=t;if(!n.matches(".b-focus-trap"))if(n.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=n,t.skipScrollIntoView=o,t.activeItem&&s&&t.triggerNavigate(e);else if(n===t.target){var l;if((r?n.compareDocumentPosition(r):0)&Node.DOCUMENT_POSITION_CONTAINED_BY)null===(l=i.previousSibling)||void 0===l||l.focus();else t.skipScrollIntoView=!0,t.activeItem=a&&t.target.contains(a)?a:0,t.skipScrollIntoView=o}}onTargetFocusOut(e){const t=this,{relatedTarget:n}=e;null!=n&&n.matches(".b-focus-trap")||n&&t.target.contains(n)&&n.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){const t=this,n=e.target.closest(t.itemSelector);t.navigationEvent=e,t.itemsTabbable?n===t.activeItem&&t.triggerNavigate(e):!1===t.ownerCmp.itemsFocusable?t.onFocusGesture(e):n&&(e.preventDefault(),n.focus({preventScroll:!0}))}onTargetMouseover({target:e}){this.activeItem=e}onTargetClick(e){var t;const n=this,{skipScrollIntoView:r}=n;n.skipNextClick||null!==(t=n.navigationEvent)&&void 0!==t&&t.ignoreNavigation?n.skipNextClick=!1:n.disabled||(n.skipScrollIntoView=n.activateOnMouseover,n.processEvent&&(e=n.callback(n.processEvent,n.thisObj||n.ownerCmp,[e])),e&&(n.activeItem=e.target.closest(n.itemSelector),n.triggerNavigate(e)),n.skipScrollIntoView=r)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?Yn.NodeFilter.FILTER_ACCEPT:Yn.NodeFilter.FILTER_SKIP}changeActiveItem(e){var t;return null!=e&&(this.ownerCmp.getItem?e=this.ownerCmp.getItem(e):"number"==typeof e&&(e=this.target.querySelector(this.itemSelector+`:nth-child(${e+1})`))),null!==(t=e)&&void 0!==t&&t.matches(this.itemSelector)?e:null}updateActiveItem(e,t){const n=this,{ownerCmp:r}=n,i=t&&n.target.contains(t),s=e&&Yn.isFocusable(e)&&e!==Yn.getActiveElement(e),o=e===t&&i;if(o||(i&&(n.previousActiveItem=t),t&&(t.classList.remove(n.focusCls),t.removeAttribute("id"))),null!=e){var a;if(n.skipScrollIntoView)s&&e.focus({preventScroll:!0});else null===(a=r.scrollable)||void 0===a||a.scrollIntoView(e,{block:"nearest",focus:s,silent:n.scrollSilently});if(o)return;e.classList.contains(n.focusCls)||e.classList.add(n.focusCls),e.id=`${n.owner.id}-active-descendant`,n._activeItem=e}else n._activeItem=null,t===Yn.getActiveElement(t)&&r.revertFocus()}updateTarget(e,t){const n=this,r={element:e,thisObj:n,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:n.itemSelector}};n.itemsTabbable||n.itemsFocusable||(r.click="onTargetClick"),n.activateOnMouseover&&(r.mouseover={handler:"onTargetMouseover",delegate:n.itemSelector,delay:30}),Object.prototype.hasOwnProperty.call(n,"acceptNode")||(n.acceptNode=n.acceptNode.bind(n)),Jt.on(r),n.treeWalker=n.setupTreeWalker(e,Yn.NodeFilter.SHOW_ELEMENT,n.acceptNode),n.keyEventTarget||(n.keyEventTarget=e),(n.targetMutationMonitor=new MutationObserver(n.onTargetChildListChange.bind(n))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,n){return document.createTreeWalker(e,t,n)}onTargetChildListChange(){const e=this,{activeItem:t,datasetIdProperty:n}=e;var r;t&&(e.target.contains(t)?t.classList.contains(e.focusCls)||t.classList.add(e.focusCls):e.activeItem=e.target.querySelector(`${e.itemSelector}.${e.focusCls}[data-${N.hyphenate(n)}="${t.dataset[n]}"]`)||(null===(r=e.target.querySelector(`${e.itemSelector}.${e.focusCls}`))||void 0===r?void 0:r[t.dataset.index])||null)}updateKeyEventTarget(e){var t;null===(t=this.keyListenerRemover)||void 0===t||t.call(this),this.keyListenerRemover=Jt.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var n;const r={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",r),null===(n=this.ownerCmp)||void 0===n||n.trigger("navigate",r)}}qh._$name="Navigator";class Kh extends(Qe.mixin(lt)){hasNativeAccess=!0;_content=null;async writeText(e,t){const n=this,{_content:r}=n;if(t&&n.hasNativeAccess)try{await navigator.clipboard.writeText(e)}catch(e){n.hasNativeAccess=!1}r!==e&&(n._content=e,n.triggerContentChange(r,!1,!0))}writeData(e,t){this._dataContent=e,this._contentSource=t}async readText(e){const t=this,{_content:n}=t;if(e&&t.hasNativeAccess)try{const e=await navigator.clipboard.readText();return n!==e&&(t._content=e,t._dataContent=t._contentSource=null,t.triggerContentChange(n,!0)),e}catch(e){t.hasNativeAccess=!1}return n}readData(e){if(!e||nt.asArray(e).includes(this._contentSource))return this._dataContent}triggerPaste(e){this.trigger("paste",{source:e,text:this._content})}triggerContentChange(e,t=!1,n=!1){this.trigger("contentChange",{fromRead:t,fromWrite:n,oldText:e,newText:this._content})}async clear(e){await this.writeText("",e),this.writeData(null)}}var Xh=e=>class extends(e||Qe){static $name="Clipboardable";static configurable={useNativeClipboard:!1,allowedDataSources:null};construct(...e){super.construct(...e),globalThis.bryntum.clipboard||(globalThis.bryntum.clipboard=new Kh),globalThis.bryntum.clipboard.ion({paste:"onClipboardPaste",contentChange:"onClipboardContentChange",thisObj:this})}get clipboard(){return globalThis.bryntum.clipboard}onClipboardPaste({text:e,source:t}){const n=this,{clipboardText:r,isCut:i}=n,s=n.compareClipboardText(r,e);var o;s&&i?(null===(o=n.handleCutData)||void 0===o||o.call(n,{text:e,source:t}),n.isCut=!1,n.cutData=null):s||n.clearClipboard(!1)}onClipboardContentChange({newText:e}){this.compareClipboardText(this.clipboardText,e)||this.clearClipboard(!1)}set cutData(e){var t,n;const r=this;null===(t=r._cutData)||void 0===t||t.forEach((e=>r.setIsCut(e,!1))),r._cutData=nt.asArray(e),null===(n=r._cutData)||void 0===n||n.forEach((e=>r.setIsCut(e,!0)))}get cutData(){return this._cutData}async writeToClipboard(e,t,n={}){if(!1===await this.beforeCopy({data:e,isCut:t,...n}))return;const r=this,i="string"==typeof e,s=i?e:r.stringConverter?r.stringConverter(e):N.safeJsonStringify(e),o=i?s:r.cloneData?r.cloneData({data:e,stringData:s,isPaste:!1}):W.clone(e);return r.clipboardText=s,r.clipboard.writeData(o,r.$$name),await r.clipboard.writeText(s,r.useNativeClipboard),r.clipboardData=o,r.originalData=e,r.isCut=t,r.cutData=t&&!i?e:null,{data:t?e:o,clonedData:o,originalData:e,stringData:s}}async readFromClipboard(e={},t=!1){var n;const r=this,{clipboard:i}=r,s=await i.readText(r.useNativeClipboard),o=r.compareClipboardText(r.clipboardText,s),a=o?r.originalData:[];let l=i.readData(r.allowedDataSources);o||r.clearClipboard(!1);const{isCut:d}=r;if(!d&&l&&l!==s||(l=r.transformClipboardText(s)),l&&!d&&"string"!=typeof l&&r.cloneData&&(l=r.cloneData({data:l,isPaste:!0})),!(null==l||Array.isArray(l)&&0===l.length||!1===await(null===(n=r.beforePaste)||void 0===n?void 0:n.call(r,{data:l,text:s,originalData:a,...e,isCut:d,isOwn:o}))))return t||i.triggerPaste(r),{data:l,text:s,isOwn:o,isCut:d,originalData:a}}async clearClipboard(e=!0){const t=this;t.clipboardData=t.originalData=t.clipboardText=t.cutData=null,t.isCut=!1,e&&await t.clipboard.clear(t.useNativeClipboard)}compareClipboardText(e,t){const n=/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/g;return(null==e?void 0:e.replace(n,"\n"))===(null==t?void 0:t.replace(n,"\n"))}transformClipboardText(e){const t=this;return t.compareClipboardText(t.clipboardText,e)?t.isCut?t.originalData:t.clipboardData:t.stringParser&&e?t.stringParser(e):e}hasClipboardData(){const{clipboard:e}=this,{_content:t}=e;if(!this.useNativeClipboard||!e.hasNativeAccess)return Boolean(t&&this.transformClipboardText(t))}},Zh=e=>class extends(e||Qe){static $name="Finalizable";construct(...e){super.construct(...e),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const e=this;let t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}async _awaitFinalizer(){const e=this;try{await e.finalizer}finally{e.finalizing=null,e.isFinalized=!0,e.doFinalize()}}};const Jh=Symbol("dragAbort"),Qh=Symbol("dragInit"),eg=Symbol("dragDrag"),tg=Symbol("dragDrop"),ng={x:"horizontal",y:"vertical"};class rg extends(Qe.mixin(Zh,Hi,Xi)){static $name="DragContext";static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300,event:null}}static get identifiable(){return{}}construct(...e){super.construct(...e);const t=this,{event:n}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:n.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:Qh,startEvent:n,touchStartTimer:null,_valid:!0}),"touches"in n&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"));const r=globalThis;Jt.on({element:r,blur:"onWindowBlur",thisObj:t,autoDetach:!0})}doDestroy(){const e=this,{source:t,target:n}=e;e.cleanup(),(null==n?void 0:n.dropping)===e&&(n.dropping=null),(null==t?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&!this.completed&&this.abort()}get aborted(){return this.state===Jh}get completed(){return this.isDestroying||this.aborted||null!==this.endEvent}get pending(){return this.state===Qh}get started(){return this.state!==Qh&&!this.aborted}get valid(){return this.started&&null!=this.targetElement&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map((e=>this.get(e))));let t=this.data.get(e);return"function"==typeof t&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((e=>this.peek(e)));let t=this.data.get(e);return"function"==typeof t&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const n=this;n._target=e,n.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=n,e.dropping!==n&&(e=null,n.valid=!1)),n._target=t}return e}updateTarget(e,t){const n=this;t&&n.source.dragLeaveTarget(n,t),e&&(n.valid=!0,e.dragMove(n),n.source.dragEnterTarget(n))}updateTargetElement(e){let t,n,r,i,s;for(s=e;s;s=s.parentElement)if(n=Vl.get(s,"droppables"),n)for(i=0;i<n.length;++i)if(t=n[i],t.dropRootElement.contains(e)&&(r=t.droppableSelector,(!r||e.closest(`#${Yn.getId(t.dropRootElement)} ${r}`))&&(this.target=t,this.target===t)))return}abort(){const e=this,{element:t,source:n}=e;null==t||t.getBoundingClientRect(),e.state!==tg&&(e.state=Jh,e.cleanup()),null==n||n.endDrag(e)}begin(){const e=this,{source:t}=e,n=t.beforeDrag(e);return!1!==n&&(t.dragging=e),n}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:n,target:r}=t,{dragSwallowClickTime:i}=t.source;if(t.event=t.domEvent=t.endEvent=e,t.syncFlags(),t.started){if((null==n?void 0:n.clientX)===e.clientX&&(null==n?void 0:n.clientY)===e.clientY&&(null==n?void 0:n.target)===e.target||t.track(),i){const e=globalThis;Jt.on({element:e,capture:!0,expires:i,once:!0,click(e){e.stopPropagation()}})}t.state=tg,r!==t.source&&(null==r||r.dragDrop(t))}}fakeKey(e,t){const n=this,{lastMoveEvent:r}=n;if(r&&n.element){let i;r.isKey=!0,"Alt"===e.key?n.altKey!==t&&(n.altKey=t,i=!0):"Control"===e.key&&n.ctrlKey!==t&&(n.ctrlKey=t,i=!0),i&&(n.event=n.domEvent=r,n.track())}}keyDown(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return Jt.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return"Control"===e||"Alt"===e}move(e){const t=this,{target:n}=e,r=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)r&&t.abort();else if(n&&n.nodeType===Node.ELEMENT_NODE&&n.isConnected){if(r&&!t.started&&(t.event=t.domEvent=e,!1===t.start()))return void t.abort();e.touches&&(t.startEvent.preventDefault(),e.preventDefault(),e.stopPropagation()),t.started&&!t.completed&&(t.lastMoveEvent=t.event=t.domEvent=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:n,source:r}=e,{draggingBodyCls:i,dragLock:s}=r,o=r.dragRootElement;if(e.state=eg,t){const r=t.startMonitoring(C.merge({scrollables:[{element:o}],direction:ng[s]||s||"both",callback(t){const{lastMoveEvent:n}=e;n&&e.element&&(n.isScroll=!0,e.event=e.domEvent=n,e.scrollerAction=t,e.track(),e.scrollerAction=null)}},n));e.cleaners.push(r)}const a=r.dragRootElement.closest(".b-outer")||document.body;if(a.classList.add(i),e.cleaners.push((()=>a.classList.remove(i))),!1===r.startDrag(e))return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:n,target:r}=e;let i,s=t.target;"touchmove"===t.type&&(i=t.changedTouches[0],s=Yn.elementFromPoint(i.clientX,i.clientY)),e.targetElement=s,r===e.target&&(null==r||r.dragMove(e)),n.trackDrag(e)}}rg.prototype.STATE=rg.STATE=Object.freeze({ABORTED:Jh,INIT:Qh,DRAGGING:eg,DROPPED:tg}),rg._$name="DragContext";class ig extends(Qe.mixin(ds)){static type="default";static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:ig}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}ig.initClass(),ig._$name="DragProxy";var sg=e=>class extends(e||Qe){static $name="Draggable";static configurable={dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}};static properties={draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"};beforeDrag(e){const{dragRootElement:t,dragSelector:n,ignoreSelector:r}=this,i=n&&e.element.closest(n);return!n||Boolean(i&&i===t||t.contains(i)&&(!r||!e.element.matches(r)))}dragStart(e){}dragOver(e){}dragEnterTarget(e){}dragLeaveTarget(e,t){}async dragDrop(e){}dragEnd(e){}get activeDrag(){const{dragging:e}=this;return null!=e&&e.started&&!e.completed?e:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:e,dragRootElement:t}=this;return e?null==t?void 0:t.closest(e):t}beginDrag(e){const{draggingCls:t,draggingClassElement:n}=this;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t))))}async endDrag(e){const t=this,{dragEventer:n,dragProxy:r}=t;e.valid&&await t.dragDrop(e),t.isDestroyed||(e.pending?e.destroy():(t.dragEnd(e),null==r||r.dragEnd(e),null==n||n.trigger(e.valid?"drop":"dragCancel",{drag:e,event:e.event}),t.finalizeDrag(e)))}async finalizeDrag(e){var t;await(null===(t=e.finalize)||void 0===t?void 0:t.call(e))}moveDrag(e){if(!1!==this.dragOver(e)){const{dragEventer:t,dragProxy:n}=this;null==n||n.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}setupDragContext(e){const t=this,{dragItemSelector:n,id:r}=t,{target:i}=e;return{event:e,id:r?`${r}-drag-${t._nextDragId=(t._nextDragId||0)+1}`:null,itemElement:n?i.closest(n):i,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}startDrag(e){const{draggingStartedCls:t,draggingClassElement:n,draggingItemCls:r,dragEventer:i,dragProxy:s}=this,{itemElement:o}=e;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t)))),r&&o&&(o.classList.add(r),e.cleaners.push((()=>o.classList.remove(r)))),null==s||s.dragStart(e);const a=this.dragStart(e);return!1!==a&&(null==i||i.trigger("dragStart",{drag:e,event:e.event})),a}trackDrag(e){var t;const{dropTargetSelector:n}=this;e.valid=!(n&&(null===(t=e.targetElement)||void 0===t||!t.closest(n))),this.moveDrag(e)}configureListeners(e){const t=this,n=W.assign({thisObj:t},t.dragDocumentListeners);return"touches"in e.startEvent?(delete n.mousemove,delete n.mouseup):(delete n.contextmenu,delete n.touchmove,delete n.touchend,delete n.pointerup),n.element=Yn.getRootElement(t.dragRootElement),n}updateDragging(e,t){const n=this;if(e){const t=n.configureListeners(e);e.cleaners.push(Jt.on(t)),n.beginDrag(e)}else t&&t.destroy()}changeDragProxy(e,t){return ig.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateDragRootElement(e,t){var n;const r=this,{draggableCls:i,dragItemSelector:s,onDragItemMouseMove:o}=r;if(null==t||t.classList.remove(i),null===(n=r._dragRootDetacher)||void 0===n||n.call(r),e){const t={thisObj:r,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:e=>{var t,n;return e.pointerId&&(null===(t=(n=e.target).releasePointerCapture)||void 0===t?void 0:t.call(n,e.pointerId))}};o&&(t.mousemove={delegate:s,handler:"onDragItemMouseMove"}),(r.dragItemOverCls||o||r.onDragItemMouseEnter||r.onDragItemMouseLeave)&&Object.assign(t,{mouseover:{delegate:s,handler:"onDragItemMouseOver"},mouseout:{delegate:s,handler:"onDragItemMouseOut"}}),e.classList.add(i),r._dragRootDetacher=Jt.on(t)}}onDragItemMouseOver(e){this.overItem=e}onDragItemMouseOut(e){this.dragging||(this.overItem=e)}changeOverItem(e){var t;return this.enterLeaveEvent=e,"mouseout"===e.type?(null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(this.dragItemSelector))||null:e.target.closest(this.dragItemSelector)}updateOverItem(e,t){const n=this,{dragItemOverCls:r}=n;var i,s;t&&(r&&t.classList.remove(r),null===(i=n.onDragItemMouseLeave)||void 0===i||i.call(n,n.enterLeaveEvent,t));e&&(r&&e.classList.add(r),null===(s=n.onDragItemMouseEnter)||void 0===s||s.call(n,n.enterLeaveEvent,e))}onDragContextMenu(e){e.preventDefault()}onDragKeyDown(e){this.dragging.keyDown(e)}onDragKeyUp(e){this.dragging.keyUp(e)}onDragMouseDown(e){0===e.button&&this.onDragPointerDown(e)}onDragPointerDown(e){let{dragging:t}=this;t?t.isFinalizing||t.abort():(t=this.setupDragContext(e),t&&(t=new rg(t),!1===t.begin()&&t.destroy()))}changeDragging(e,t){return null==t||t.destroy(),e}onDragPointerMove(e){const{changedTouches:t}=e,{dragging:n}=this;!n||n.completed||t&&1!==t.length||null==n||n.move(e)}onDragPointerUp(e){const{dragging:t}=this;t&&!t.completed&&(t.end(e),this.endDrag(t))}onDragTouchStart(e){1===e.touches.length&&this.onDragPointerDown(e)}},og=e=>class extends(e||Qe){static $name="Droppable";static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragEnter",{drag:e,event:e.event})}dragMove(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragMove",{drag:e,event:e.event})}dragDrop(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("drop",{drag:e,event:e.event})}dragLeave(e){var t;return null===(t=this.dropEventer)||void 0===t?void 0:t.trigger("dragLeave",{drag:e,event:e.event})}changeDropping(e,t){if(e!==t){const n=this;t&&(!t.aborted&&t.completed||n.dragLeave(t)),e&&(n._dropping=e,!1===n.dragEnter(e)&&(e=null),n._dropping=t)}return e}updateDropRootElement(e,t){const n=this,{droppableCls:r}=n;let i,s,o;t&&(i=Vl.get(t,"droppables"),o=!0,Array.isArray(i)&&(s=i.indexOf(n))>-1&&(i.length<2?Vl.remove(t,"droppables"):(i.splice(s,1),i.forEach((e=>{r===e.droppableCls&&(o=!1)})))),o&&t.classList.remove(r)),e&&(i=Vl.get(e,"droppables"),i?i.push(n):Vl.set(e,"droppables",[n]),e.classList.add(r))}},ag=e=>class extends(e||Qe){static $name="Featureable";static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const t={ownerName:"client",...e.featureable};t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:()=>t})}doDestroy(){const e=this.features;super.doDestroy();for(const n in e){var t;const r=e[n];null===(t=r.destroy)||void 0===t||t.call(r)}}hasFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}changeFeatures(e,t){if(this.isDestroying)return;const n=this,{featureable:r}=n.constructor,i=n.$features||(n.$features=new du({configName:"features",factory:r.factory,owner:n,ownerName:r.ownerName}));return i.update(e),t?void 0:i.target}get widgetClass(){}getCurrentConfig(e){const t=super.getCurrentConfig(e),{features:n}=t;if(n)for(const e in n)0===Object.keys(n[e]).length&&(n[e]=!0);return t}};const lg="b-hover-edge",dg="b-hover-top",cg="b-hover-right",ug="b-hover-bottom",hg="b-hover-left",gg={[lg]:1,[dg]:1,[cg]:1,[ug]:1,[hg]:1},mg={t:[lg,dg],r:[lg,cg],b:[lg,ug],l:[lg,hg],tr:[lg,dg,cg],bl:[lg,ug,hg],tl:[lg,dg,hg],br:[lg,ug,cg]};var pg=e=>class extends(e.mixin(Hi)){static $name="Hoverable";static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:n,hoverEdgeSize:r,hoverTarget:i}=t;if(i){if(n){const{top:s,left:o,width:a,height:l,right:d,bottom:c}=i.getBoundingClientRect(),{clientX:u,clientY:h}=e,g=o+a/2,m=s+l/2,p=h<(r?s+r:m),f=u>=(r?d-r:g),v=p||h>=(r?c-r:m)?p?"t":"b":"",y=f||u<(r?o+r:g)?f?"r":"l":"";t.hoverZone=(n.includes(v)?v:"")+(n.includes(y)?y:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;var n;t&&(e=null===(n=e)||void 0===n?void 0:n.closest(t));this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:n}=this;n&&(null==t||t.classList.remove(n),null==e||e.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const n=this,{hoverCls:r,hoverAnimationCls:i,hoverRootActiveCls:s,hoverRootElement:o}=n;s&&(null==o||o.classList[e?"add":"remove"](s)),t&&(r&&t.classList.remove(r),i&&t.classList.remove(i),n.hoverLeave(t)),e&&(r&&e.classList.add(r),n.hoverEnter(t),n.hoverTrack&&n.hoverMove(n.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:t,hoverTarget:n}=this;if(n){const{className:r}=n,i=Vt.change(r,e?mg[e]:null,gg);r!==i&&(n.className=i,e&&t&&(n.classList.remove(t),n.getBoundingClientRect(),n.classList.add(t)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,n=t.hoverRootElement,r={element:n,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(r.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=n&&Jt.on(r)}},fg=e=>class extends e{static $name="LoadMaskable";static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"b-icon b-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const e=this,{loadMask:t}=e;return t&&(e.masked=mc.mergeConfigs(e.loadMaskDefaults,t)),e.masked}applyMaskError(e){const{loadMaskError:t,masked:n}=this;return!1===t?n.hide():n&&(W.assign(n.errorDefaults,t),n.error=e),n}get widgetClass(){}};const vg={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1};class yg{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,n,e.prototype),!0}static internalOverrideAll(e,t,n){Reflect.ownKeys(n).forEach((r=>{if(t.includes(r)&&!vg[r]){const t=Object.getOwnPropertyDescriptor(n,r);let i=e,s=null;for(;!s&&i;)s=Object.getOwnPropertyDescriptor(i,r),s||(i=Object.getPrototypeOf(i));s&&this.internalOverride(i,r,t,s)}}))}static internalOverride(e,t,n,r){(e._overridden=e._overridden||{})[t]=e[t],r.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:n.get}):e[t]=n.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!G[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!G[t.product].isOlderThan(t.minVersion))}}yg._$name="Override";const bg=6e4,Cg=36e5,wg=864e5,Sg=/(\d+)?:?(\d*)/;class Dg{static format(e){const t=Math.floor(e/Cg),n=Math.floor(e/bg)%60;return`${t}:${n<10?"0":""}${n}`}static parse(e){const t=typeof e;if("string"===t){const t=Sg.exec(e);e=Number(t[1]||0)*Cg+Number(t[2]||0)*bg}else"number"!==t?e=xi.getTimeOfDay(e):e<=24&&(e*=Cg);return Math.min(Math.max(Math.floor(e),0),wg)}constructor(e){let t,n,r=0;null!=e&&e.isDayView?(r=e.dayStartShift,t=e.dayStartTime,n=e.dayEndTime):"number"==typeof e?r=t=n=e:e&&(r=e.startShift,t=e.timeStart,n=e.timeEnd),this.startShift=r=Dg.parse(r||0),this.timeEnd=(null==n?(r+wg)%wg:Dg.parse(n))||wg,this.timeStart=null==t?r:Dg.parse(t)}get startHour(){return Math.floor(this.timeStart/Cg)}get endHour(){return Math.floor(this.timeEnd/Cg)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?wg-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),xi.makeKey(e)}dayOfDate(e){return this.shiftDate(xi.clearTime(e))}dayOfWeek(e){return(e=this.shiftDate(e,-1)).getDay()}delta(e,t="ms"){const{timeStart:n}=this,r=Dg.parse(e),i=(this.startShift&&r<n?r+wg:r)-n;return"ms"===t?i:xi.as(t,i,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:n}=this,r=t<n?n-t:wg-t+n;return"ms"===e?r:xi.as(e,r,"ms")}equals(e){return this.startShift===(null==e?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const n=this,{timeStart:r,timeEnd:i}=n,[s,o]=n._dateRangeArgs(e,t),[a,l]=n.timeRange(s,o);return r<i?a<l?a<i&&r<l:a<i||r<l:!(a<l)||a<i||r<l}isIntraDay(e,t){const[n,r]=this._dateRangeArgs(e,t),i=this.startOfDay(n),s=wg-xi.diff(i,r,"ms");return!(s<0)&&(s>0||i<n)}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:t,timeStart:n,timeEnd:r}=this,i=Dg.parse(e);return n<r?i<n?i<t?1:-1:i<r?0:i<t?-1:1:i<r||i>=n?0:i<t?1:-1}parseKey(e){return this.dayOfDate(xi.parseKey(e))}shiftDate(e,t=1){const{startShift:n}=this,r=typeof e;return e="number"===r?new Date(e):"string"===r?xi.parse(e):new Date(e.getTime()),t&&n&&e.setMilliseconds(t>0?n:-n),e}sortEvents(e,t){const n=this.startOfDay(e);return null==t?void 0:t.sort(((e,t)=>{e=e.eventRecord||e,t=t.eventRecord||t;let{startDate:r}=e,{startDate:i}=t;return r?i?(r=r<n?n:r,i=i<n?n:i,r-i||t.endDate-i-(e.endDate-r)):1:-1}))}startOfDay(e){return e=this.shiftDate(e,-1),e=xi.clearTime(e),e=this.shiftDate(e)}timeRange(e,t){const[n,r]=this._dateRangeArgs(e,t);return[xi.getTimeOfDay(n),xi.getTimeOfDay(r)]}toString(){const{startShift:e,timeEnd:t,timeStart:n}=this,r=e?`@${Dg.format(e)}`:"",i=Dg.format(n);return n===t?e?r:i:`${i}-${Dg.format(t)}${r}`}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}}Dg.MIDNIGHT=new Dg({startShift:0,timeStart:0,timeEnd:24}),Dg.MILLIS_PER_MINUTE=bg,Dg.MILLIS_PER_HOUR=Cg,Dg.MILLIS_PER_DAY=wg,Dg._$name="DayTime";class Eg extends Qe{static $name="ElementVisitor";static configurable={element:null,selector:null};static elementVisitorMap=new WeakMap;static getVisitor(e,t){const{elementVisitorMap:n}=this,r=n.get(e)||n.set(e,new Map).get(e),i="string"==typeof t?t:t.toString();return r.get(i)||r.set(i,new Eg({element:e,selector:t})).get(i)}updateSelector(e){this.treeWalker=document.createTreeWalker(this.element,NodeFilter.SHOW_ELEMENT,"string"==typeof e?t=>{var n;return null!==(n=t.matches)&&void 0!==n&&n.call(t,e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}:e)}first(){return this.treeWalker.currentNode=this.element,this.treeWalker.firstChild()}previous(e){return e&&(this.treeWalker.currentNode=e),this.treeWalker.previousNode()}next(e){return e&&(this.treeWalker.currentNode=e),this.treeWalker.nextNode()}last(){return this.treeWalker.currentNode=this.element,this.treeWalker.lastChild()}}Eg._$name="ElementVisitor";class xg extends eh{static $name="Hint";static type="hint";static configurable={ui:"plain",defaultFocus:e=>!e.hidden&&("next"===e.ref||"stop"===e.ref),align:{align:"t-b",allowTargetOut:!0},anchor:!0,autoShow:!1,autoClose:!1,centered:!1,allowOver:!0,closable:!0,minWidth:"max-content",closeAction:"stop",previousAction:null,nextAction:null,keyMap:{P:"previous",N:"next",S:"stop"},buttons:null,maxWait:1e4,highlightTarget:null,highlighter:{$config:["lazy","nullify"],value:{floating:!0,cls:"b-hint-highlighter"}},autoNext:null,target:null};afterShow(){super.afterShow(...arguments),this.addDocumentMouseDownListener()}realign(){super.realign(...arguments),this.syncTargetHighlighting()}get isTopModal(){return!1}owns(){return!!this.masked||super.owns(...arguments)}onDocumentMouseDown({event:e}){e.isTrusted&&(this.owns(e.target)?super.onDocumentMouseDown(...arguments):this.hintFlow.stop())}changeTarget(e){return e&&("string"==typeof e&&(this._target=this._forElement=null),e=this.hintFlow.normalizeTarget(e),W.isPromise(e))?(e.then((e=>!this.isDestroyed&&(this.target=e))),void this.setTimeout("hide",this.maxWait)):e}updateButtons(e){this.bbar={items:e}}updateHighlightTarget(e,t){const n=null==e?void 0:e.inflate;n?(this.initialInflate=this.align.inflate,this.align.inflate=n):this.align.inflate=this.initialInflate}updateTarget(e){e instanceof Element&&(this.forElement=e)}changeHighlighter(e,t){if(e)return oc.reconfigure(t,oc.mergeConfigs({owner:this},e),this);null==t||t.destroy()}async updateForElement(e){const t=this,{autoNext:n,owner:r,index:i}=t;if(t.syncTargetHighlighting(),t.clearTimeout("hide"),t.hidden=!1,t.showBy({target:t.forElement}),!t.element.matches(":focus-within")&&t.focus(),n)switch(typeof n){case"number":t.setTimeout((()=>r.navigate(1)),n);break;case"string":if(await dt.sleep(500),t.index===i){const e=await(t.autoNextPromise=r.normalizeTarget(n,!1));t.autoNextPromise=null,e&&r.navigate(1,!1)}break;case"function":await dt.waitFor(n,1e4),r.navigate(1,!1)}}syncTargetHighlighting(){if(!this.isVisible)return;const e=this,{highlightTarget:t,highlighter:n,forElement:r}=e,{classList:i}=e.element,s={"--b-hint-highlight-color":""},o=null==n?void 0:n.element,a=null==o?void 0:o.classList,l=null==t?void 0:t.inflate;if(null==a||a.remove("b-hint-highlighter-ping","b-hint-highlighter-center"),i[e.scrollRealigning?"add":"remove"]("b-scroll-realigning"),r){const{style:n}=e.floatRoot,i=r.ownerDocument.defaultView.getComputedStyle(r),o=Yn.isInView(r,!1,this),a=null!=t&&t.center?o.center.inflate(10):o;if(l&&a.inflate.apply(a,Array.isArray(l)?l:[l]),t&&(null==t||!t.center))for(const e of["top","bottom"])for(const t of["left","right"]){const n=i.getPropertyValue(`border-${e}-${t}-radius`);s[`border-${e}-${t}-radius`]=parseInt(n)?n:""}"string"==typeof(null==t?void 0:t.center)&&(s["--b-hint-highlight-color"]=t.center),n.setProperty("--b-highlight-top",`${a.top}px`),n.setProperty("--b-highlight-left",`${a.x}px`),n.setProperty("--b-highlight-width",`${a.width}px`),n.setProperty("--b-highlight-height",`${a.height}px`)}t&&(a[e.scrollRealigning?"add":"remove"]("b-realigning"),Yn.applyStyle(o,s),n.show(),t.ping&&Jt.onTransitionEnd({element:o,property:"inset-inline-start",once:!0,thisObj:e,timeout:500,handler:()=>{a.add("b-hint-highlighter-ping")}}),t.center&&a.add("b-hint-highlighter-center")),e.requestAnimationFrame((()=>{i.remove("b-scroll-realigning"),a.remove("b-realigning")}))}next(){this.index<this.owner.hints.length-1&&this.owner.navigate(1)}previous(){this.index&&this.owner.navigate(-1)}stop(){this.owner.stop()}}xg.initClass(),xg._$name="Hint";const Rg=(e,t)=>({previous:{weight:100,text:"L{Object.previous}",cls:"b-raised b-previous",hidden:!e,onClick:"up.onHintButtonClick"},next:{weight:100,text:"L{Object.next}",cls:"b-raised b-blue b-next",hidden:e===t-1,onClick:"up.onHintButtonClick"},stop:{weight:300,text:"L{Object.close}",cls:"b-raised b-red b-stop",hidden:e!==t-1,onClick:"up.onHintButtonClick"}}),Tg=/\[(?:([\w+]+)\+)?(\w+)\]|./g;class Mg extends(Qe.mixin(Tr,lt,Hi)){waitInterval=100;maxWait=1e4;keyStrokeIntervalRandomness=100;static configurable={activeIndex:0,hints:null,defaults:{type:"hint",align:{allowTargetOut:!0},closable:!0,draggable:!1,buttons:{},autoNext:null,nextAction:null,previousAction:null,minWidth:null,trapFocus:!0,title:new String("")}};onHintButtonClick({source:e}){const t=this;switch(e.ref){case"next":t.navigate(1);break;case"previous":t.navigate(-1);break;case"stop":t.stop();break;case"completed":t.trigger("completed"),t.stop()}}async fakeType(e){let{target:t,text:n,initialDelay:r=0,focus:i}=e;"string"==typeof e&&(t=document.activeElement,n=e),!1!==i&&this.activeHint.revertFocus(),t?(t=await this.normalizeTarget(t),!1!==i&&t.focus()):t=Yn.getActiveElement(this.activeHint.element),e.clear&&(t.value=""),await dt.sleep(r);for(let e=Tg.exec(n);e;e=Tg.exec(n)){if(e[2]){var s;const n=((null===(s=e[1])||void 0===s?void 0:s.split("+"))||[]).reduce(((e,t)=>(e[`${t.toLowerCase()}Key`]=!0,e)),{}),r={key:e[2],bubbles:!0,...n};t.dispatchEvent(new KeyboardEvent("keydown",r)),t.dispatchEvent(new KeyboardEvent("keyup",r))}else t.value+=e[0],t.dispatchEvent(new Event("input",{data:e[0]}));await dt.sleep(Math.random()*this.keyStrokeIntervalRandomness+30)}t.dispatchEvent(new Event("change"))}normalizeTarget(e,t=this.maxWait){return Yn.waitForSelector(e,t,this.waitInterval)}navigate(e,t=!0){this.navigationOngoing||(this.navigationOngoing=new Promise((async n=>{const r=this,{activeHint:i}=r,s=r.activeIndex+e,o=ir.ion({mouseup:({event:e})=>r.squashDocumentEvents(e)}),a=Jt.on({element:document,mousedown:"squashDocumentEvents",keydown:"squashDocumentEvents",thisObj:r,capture:!0});try{if(i.masked=!0,r.allowInteraction=!1,t){const t=r.processActions(r.activeHint[1===e?"nextAction":"previousAction"]);if(await dt.animationFrame(),1!==r.normalizeTarget(i.target,-1).nodeType){const e=r.normalizeTarget(r.hints[s].target,-1);1===(null==e?void 0:e.nodeType)?i.target=e:Yn.applyStyle(i.floatRoot,{"--b-highlight-width":"0px","--b-highlight-height":"0px"})}await t}r.activeIndex=s,await r.activeIndexUpdated,r.navigationOngoing=null,i.masked=!1}finally{null==o||o(),null==a||a(),r.navigationOngoing&&(r.navigationOngoing=null,i.element.classList.remove("b-no-title"),i.hide(!1),xg.reconfigure(i,{hidden:!1,masked:!1,centered:!0,title:"Navigation timed out",content:"Navigation could not be completed.",nextAction:null,bbar:{items:Rg(0,1)}})),n()}})))}squashDocumentEvents(e){e.isTrusted&&(!this.activeHint.element.contains(e.target)&&this.allowInteraction||(e.preventDefault(),e.stopImmediatePropagation()))}async processActions(e){const t=this;if(e)if(Array.isArray(e))for(const n of e)await t.processActions(n);else for(const[r,i]of Object.entries(e))switch(r){case"type":await t.fakeType(i);break;case"dblclick":case"click":case"contextmenu":{const e="string"==typeof i,s=await t.normalizeTarget(e?i:i.target),o=!e&&i.focus;if(o){const e=Yn.getActiveElement(s);var n;if(!Yn.triggerMouseEvent(s,"mousedown").defaultPrevented&&Yn.getActiveElement(s)===e)null===(n=Yn.closest(s,Yn.isFocusable))||void 0===n||n.focus()}Yn.triggerMouseEvent(s,r),o&&Yn.triggerMouseEvent(s,"mouseup")}break;case"fn":await t.activeHint.callback(i,t.activeHint);break;case"drag":await t.drag(i);break;case"waitFor":isNaN(i)?await t.normalizeTarget(i):await dt.sleep(i);break;case"allowInteraction":t.allowInteraction=i}}async drag({target:e=this.activeHint.target,by:[t,n],duration:r=500}){const i=await this.normalizeTarget(e),{ownerDocument:s}=i,{activeHint:o}=this,{modalMask:a}=o,{x:l,y:d}=Ot.from(i).center.roundPx(1),c=Yn.createElement({parent:s.body,className:"b-mouse-pointer b-icon b-fa-mouse-pointer",style:{left:`${l}px`,top:`${d}px`}}),u={clientX:l,clientY:d,bubbles:!0},{style:h}=o.floatRoot;let g,m;a&&(a.style.pointerEvents="none",h.setProperty("--b-highlight-width","0px"),h.setProperty("--b-highlight-height","0px")),i.dispatchEvent(new PointerEvent("pointerover",u)),i.dispatchEvent(new MouseEvent("mouseover",u)),i.dispatchEvent(new PointerEvent("pointerdown",u)),i.dispatchEvent(new MouseEvent("mousedown",u)),await dt.animationFrame(),await ee.animate(r,(async e=>{u.clientX=l+t*e,u.clientY=d+n*e,a.style.pointerEvents="none",g=s.elementFromPoint(u.clientX,u.clientY),c.style.cssText=`left:${u.clientX}px;top:${u.clientY}px`,g.dispatchEvent(new PointerEvent("pointermove",u)),g.dispatchEvent(new MouseEvent("mousemove",u)),g!==m&&(g.dispatchEvent(new PointerEvent("pointerenter",u)),g.dispatchEvent(new MouseEvent("mouseenter",u)),g.dispatchEvent(new PointerEvent("pointerover",u)),g.dispatchEvent(new MouseEvent("mouseover",u)),m=g),a.style.pointerEvents=""})),h.setProperty("--b-highlight-top",`${u.clientY}px`),h.setProperty("--b-highlight-left",`${u.clientX}px`),g.dispatchEvent(new PointerEvent("pointerup",u)),g.dispatchEvent(new MouseEvent("mouseup",u)),c.remove()}async updateActiveIndex(e,t){var n;const r=this,{hints:i,activeHint:s}=r,o=i.length,a=i[e];if(null==s||null===(n=s.autoNextPromise)||void 0===n||n.resolve(),a){const n=await r.normalizeTarget(a.target);if(!1===n)return void(r.activeIndex=++e);s?("string"==typeof a.target&&(s._target=s._forElement=null),s.bbar.element.matches(":focus-within")&&s.element.focus()):r.returnFocusTo=Yn.getActiveElement();const i={steps:{type:"widget",content:`${e+1}/${o}`,weight:-1e3},completed:{text:r.L("L{Hint.dontShowAgain}"),cls:"b-transparent",weight:10,onClick:"up.onHintButtonClick"},...W.merge(Rg(e,o),Array.isArray(a.buttons)?W.transformArrayToNamedObject(a.buttons):a.buttons)},d=r.activeHint=xg.reconfigure(s,xg.mergeConfigs(r.defaults,{index:e,hintFlow:r,owner:r,maxWait:r.maxWait,rootElement:document.body},a,{target:n,buttons:i}));var l;if(r.owner=xg.fromElement(n),d.element.classList.toggle("b-no-title",Boolean(!a.title)),await Promise.all([d.highlighter.element.isConnected&&Yn.waitForSelector(d.highlighter.element,-1e3),Yn.waitForSelector(d.element,-1e3)]),d.isVisible)null===(l=d.bbar.widgetMap[e===o-1?"stop":e&&e<t?"previous":"next"])||void 0===l||l.focus()}else r.stop()}async stop(){var e;const t=this;t.activeIndex===t.hints.length-1&&await t.processActions(t.activeHint.nextAction),t.activeHint.owner=null,bryntum.queryAll("hint").forEach((e=>e.hintFlow===t&&e.destroy())),t.activeHint=null,null===(e=t.returnFocusTo)||void 0===e||e.focus()}}Mg._$name="HintFlow";class kg extends(lt(Qe)){static $name="Month";static get configurable(){return{date:{$config:{equal:"date"},value:xi.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?xi.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const n=this,{dayColumnIndex:r,weekCount:i}=n,s=xi.getFirstDateOfMonth(e),o=xi.getLastDateOfMonth(s),a=r[s.getDay()],l=r[o.getDay()],d=!t||e.getFullYear()!==t.getFullYear(),c=!t||e.getMonth()!==t.getMonth(),u=n.eventListeners&&(t?e.getDate()!==t.getDate()|(n.getWeekId(e)!==n.getWeekId(t))<<1|c<<2|d<<3:15);if(n._year=e.getFullYear(),n._month=e.getMonth(),n.startDayOfMonth=1-a,n.endDayOfMonth=o.getDate()+(6-l),n.sixWeeks&&(n.endDayOfMonth+=7*(6-n.weekCount)),n.weekBase&&!d||n.calculateWeekBase(),(c||d)&&n.generation++,u){const r={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&u),m:Boolean(12&u),y:Boolean(8&u),r:n.weekCount!==i}};n.trigger("dateChange",r),2&u&&n.trigger("weekChange",r),12&u&&n.trigger("monthChange",r),8&u&&n.trigger("yearChange",r)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,n=new Date(e.year,0,1),r=new Date(e.year,11,31),i=e.month?e.getOtherMonth(n):e;e.dayColumnIndex[n.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);const s=Math.floor(xi.diff(e.weekBase,r,"day")/7);e.has53weeks=53===s&&t[r.getDay()]>2}getWeekStart(e){if("number"==typeof e)return xi.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[n,r]=e;return n===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(n,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,n=t===Fg?new kg(null):Fg;return n.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),n.date=e,n.updateDate(n.date,n.date),n}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:xi.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||xi.nonWorkingDays}changeNonWorkingDays(e){return W.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}get firstDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,1)}get lastDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month+1,0)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:n}=t;for(let r=t.startDayOfMonth,i=0;i<n;i++){const s=[],o=t.getWeekNumber(new Date(t.year,t.month,r));for(let e=0;e<7;e++,r++)s.push(new Date(t.year,t.month,r));e(o,s,i,i===n-1)}}getWeekNumber(e){const t=this;if((e=xi.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let n=Math.floor(xi.diff(t.weekBase,e,"day")/7),r=e.getFullYear();return n?(53!==n||t.has53weeks?n>53&&(n%=52):(n=1,r++),[r,n]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e,t,n=Dg.MIDNIGHT){const r=this,i=e.getDay(),s=r.visibleDayColumnIndex[i],o=r.nonWorkingDays[i],a=r.hideNonWorkingDays&&o;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:i,dayTime:n,visibleColumnIndex:s,isNonWorking:o,week:r.getOtherMonth(e).getWeekNumber(e),key:xi.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[i],date:new Date(e),dayEnd:n.duration("s"),tomorrow:n.dayOfDate(xi.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!a&&e>=t.startDate&&e<xi.add(t.endDate,1,"day"),isRowStart:0===s,isRowEnd:s===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:n,hideNonWorkingDays:r}=e,i=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],o=e.visibleDayColumnIndex=[];let a=0;for(let e=0;e<7;e++){const l=(t+e)%7;s[e]=l,i[l]=e,r&&n[l]||(o[l]=a++)}e.visibleColumnCount=a,e.weekLength=r?7-W.keys(n).length:7}}const Fg=new kg(null);kg._$name="Month";let Ig=0;const Ag=new WeakMap,Lg=e=>{const t=new Map;return(...n)=>{const r=((...e)=>e.map((e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=Ag.get(e),void 0===t&&(t=++Ig,Ag.set(e,t))):t=String(e),t})).join("-"))(n);let i=t.get(r);return void 0===i&&(i=e(...n),t.set(r,i)),i}},Pg=e=>{const t=new Map,n=e=>e[0],r=e=>e[1],i=(e,t)=>n(e).push(t);return(s,o)=>{const a=(e=>{let n=t.get(e);return void 0===n&&(n=[[],[]],t.set(e,n)),n})(s);(e=>!r(e).length&&!n(e).length)(a)?(i(a,o),e(s,(e=>{((e,t)=>r(e).some((e=>W.isEqual(e,t))))(a,e)||(((e,t)=>{r(e).push(t)})(a,e),n(a).forEach((t=>t(e))))}))):(i(a,o),r(a).forEach((e=>o(e))))}},Og=Symbol("success"),$g=Symbol("failure"),_g=(e,t)=>[Og,e,t],Hg=e=>[$g,e],Vg=e=>e.length&&e[0]===Og,Ng=e=>"function"!=typeof e||e.length?e:e(),Bg=Lg((e=>Pg(((t,n)=>n(_g(e,t)))))),zg=Lg((e=>Pg(((t,n)=>{const r=Math.min(e.length,t.length),i=t.substr(0,r),s=t.substr(r);n(i===e?_g(i,s):Hg(s))})))),jg=(e,t)=>(n,r)=>Ng(e)(n,(e=>{if(Vg(e)){const[,n,i]=e;t(n)(i,r)}else r(e)})),Wg=Lg(((...e)=>{const t=Lg(((e,t)=>Pg(jg(e,(e=>jg(t,(t=>Bg([].concat(e,t)))))))));return e.reduce(t,Bg([]))})),Ug=Lg(((...e)=>Pg(((t,n)=>e.forEach((e=>Ng(e)(t,n))))))),Gg=Lg((e=>(t,n)=>{const r=new RegExp(`^${e}`).exec(t);if(r){const e=r[0],i=t.substr(e.length);n(_g(e,i))}else n(Hg(t))})),Yg=Lg(((e,t)=>jg(e,((...e)=>Bg(t(...[].concat.apply([],e))))))),qg=(e,t)=>{const n=[];return e(t,(e=>{if(Vg(e)){const[,,t]=e;""===t&&n.push(e)}})),n};var Kg={memo:Lg,memoCps:Pg,success:_g,failure:Hg,isSuccess:Vg,resolveParser:Ng,succeed:Bg,string:zg,bind:jg,seq:Wg,alt:Ug,regexp:Gg,red:Yg,runParser:qg,defineParser:e=>(t,n)=>n?Ng(e)(t,n):qg(Ng(e),t)};class Xg extends(Qe.mixin(Hi,lt)){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,t){return null==t||t.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return 0!==Object.keys(this.activeScroll).length}get rtl(){var e;return null===(e=this.owner)||void 0===e?void 0:e.rtl}startMonitoring(e={}){const t=this,{element:n,direction:r}=t,{scrollables:i=[],direction:s=r,callback:o}=e,a=[];return i.length||i.push({element:n}),i.forEach((e=>{const r=e.element;"string"==typeof r?Yn.forEachSelector(n,r,(n=>{t.createMonitor(n,e.direction||s,e.callback||o),a.push(n)})):(t.createMonitor(r,e.direction||s,e.callback||o),a.push(r))})),function(){var e;null===(e=t.stopMonitoring)||void 0===e||e.call(t,a)}}createMonitor(e,t,n){const{monitoring:r}=this;r.has(e)||r.set(e,new Zg({scrollManager:this,element:e,direction:t,callback:n}))}stopMonitoring(e){const t=this,{monitoring:n}=t;if(e=nt.asArray(e),n){if(!e)return void n.forEach((e=>t.stopMonitoring(e.element)));e.forEach((e=>{const t=n.get(e);e.classList.remove("b-scrolling"),t&&(t.destroy(),n.delete(e))}))}}requestScroll(e,t){const{activeScroll:n}=this;return(!(e in n)||n[e]===t)&&(n[e]=t,!0)}releaseScroll(e){const{activeScroll:t={}}=this;Object.keys(t).forEach((n=>{t[n]===e&&delete t[n]}))}getRelativeScroll(e,t="left"){let n=0;return this.monitoring.forEach(((r,i)=>{Yn.isDescendant(i,e)&&(n+="left"===t?r.scrollRelativeLeft:r.scrollRelativeTop)})),n}}class Zg extends Qe{construct(e){const{element:t}=e,n=t.scrollLeft,r=t.scrollTop;Object.assign(e,{startScrollLeft:n,startScrollTop:r}),super.construct(e),Jt.on({element:t,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:this}),Jt.on({element:t,pointerleave:"onPointerLeave",thisObj:this})}doDestroy(){this.stopScroll(!0),super.doDestroy()}startScroll(){const e=this;e.pendingScrollFinalize&&(e.scrollManager.releaseScroll(e),e.pendingScrollFinalize=!1),e.scrolling=!0,e.performScroll()}stopScroll(e=null){const t=this,n=()=>{t.pendingScrollFinalize=!1,t.isDestroyed||(t.scrollManager.releaseScroll(t),t.scrolling=!1)};t.scrollRequested&&(t.scrollManager.cancelAnimationFrame(t.frameId),t.scrollRequested=!1),t.scrollManager.clearTimeout(t.scrollTimeout),t.scrollTimeout=null,e||!t.ongoingScrollTop&&!t.ongoingScrollLeft?(t.ongoingScrollTop=t.ongoingScrollLeft=null,n()):(t.pendingScrollFinalize=!0,Promise.all([t.ongoingScrollTop,t.ongoingScrollLeft].filter(Boolean)).then((()=>t.pendingScrollFinalize&&n())))}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const t=this,{scrollManager:n}=t,r=t.element.getBoundingClientRect(),i=n.zoneWidth,s=n.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,"vertical"!==t.direction){const{scrollLeft:o,scrollWidth:a,clientWidth:l}=t.element;n.rtl?e.clientX<r.left+i&&a+o-l>=1?t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1:e.clientX>r.right-i&&o<0&&(t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1):e.clientX>r.right-i&&a-o-l>=1?t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1:e.clientX<r.left+i&&o>0&&(t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1)}if("horizontal"!==t.direction){const{scrollTop:n,scrollHeight:o,clientHeight:a}=t.element;e.clientY>r.bottom-i&&o-n-a>=1?t.scrollDeltaY=Math.round((i-(r.bottom-e.clientY))/s)+1:e.clientY<r.top+i&&n>0&&(t.scrollDeltaY=-Math.round((i+(r.top-e.clientY))/s)-1)}0===t.scrollDeltaX||n.requestScroll("horizontal",t)||(t.scrollDeltaX=0),0===t.scrollDeltaY||n.requestScroll("vertical",t)||(t.scrollDeltaY=0),0===t.scrollDeltaX&&0===t.scrollDeltaY?t.scrolling&&t.stopScroll():t.scrollTimeout||(t.scrollTimeout=n.setTimeout((()=>t.startScroll()),n.startScrollDelay))}performScroll(){const e=this,{element:t,scrollManager:n}=e;if(e.scrolling&&!e.scrollRequested){if(0!==e.scrollDeltaX){const r=t.scrollLeft,i=Math.min(r+e.scrollDeltaX,t.scrollWidth-t.clientWidth);t.scrollLeft=i,t.scrollLeft!==r?e.ongoingScrollLeft=new Promise((r=>t.addEventListener("scroll",(t=>{var i;null===(i=n.trigger)||void 0===i||i.call(n,"scroll",{event:t,deltaY:e.scrollDeltaY,deltaX:e.scrollDeltaX}),r()}),{once:!0}))):(e.ongoingScrollLeft=null,e.scrollDeltaX=0)}if(0!==e.scrollDeltaY){const r=t.scrollTop,i=Math.min(r+e.scrollDeltaY,t.scrollHeight-t.clientHeight);t.scrollTop=i,t.scrollTop!==r?e.ongoingScrollTop=new Promise((r=>t.addEventListener("scroll",(t=>{var i;null===(i=n.trigger)||void 0===i||i.call(n,"scroll",{event:t,deltaY:e.scrollDeltaY,deltaX:e.scrollDeltaX}),r()}),{once:!0}))):(e.ongoingScrollTop=null,e.scrollDeltaY=0)}0!==e.scrollDeltaX||0!==e.scrollDeltaY?(e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame((()=>{e.scrollRequested=!1,e.performScroll(e)}))):e.stopScroll()}}onElementScroll(){var e;null===(e=this.config)||void 0===e||null===(e=e.callback)||void 0===e||e.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}}Xg._$name="ScrollManager";const Jg={left:!0,right:!0,top:!0,bottom:!0,transform:!0},Qg={true:1,false:1},em=Promise.resolve();class tm extends eh{static $name="Tooltip";static type="tooltip";static get configurable(){return{autoHide:!0,mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:null,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,draggable:!1,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:{$config:{equal:(e,t)=>null==e&&null==t||e===t},value:null},testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null},role:"tooltip",describedElement:null}}afterConfigure(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!1!==e.showOnHover,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=Jt.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;null===(e=this.pointerOverOutDetacher)||void 0===e||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){var e;return"focus"!==(null===(e=this.triggeredByEvent)||void 0===e?void 0:e.pointerType)&&(super.focusOnToFront&&Yn.usingKeyboard)}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:n}=t;var r;if(n&&Yn.isTouchEvent&&(e.pageX===n.pageX&&e.pageY===n.pageY&&null!==(r=t.activeTarget)&&void 0!==r&&r.contains(e.target)&&performance.now()-n.timeStamp<500))return;t.abortDelayedShow(),super.onDocumentMouseDown({event:e})}internalOnPointerOver(e){const t=this,{target:n,relatedTarget:r}=e,{forElement:i,forSelector:s,activeTarget:o}=t;let a;if(!(t.disabled||t.owner&&!t.owner.showTooltipWhenDisabled&&t.owner.disabled||t.allowOver&&t.element.contains(n))){if(s){const i=e.target.closest("[data-btip]");if(i&&!i.matches(s))return void(o&&t.handleForElementOut());if(a=t.filterTarget(e),!this.hasTimeout("hide")&&null!=o&&o.contains(n)&&o.contains(r)&&a===o)return;if(a&&(null==r?void 0:r.closest(s))===a&&!r.dataset.btip)return}else{if(i.contains(r))return;a=i}a?t.handleForElementOver(e,a):o&&t.handleForElementOut()}}filterTarget({target:e}){return e.closest(this.forSelector)}realignOnTransitionEnd(e){const t=this,{currentOverElement:n}=tm;if(Jg[e.propertyName]){var r;if(t.allowOver&&t.element.contains(n))return;null!==(r=t.activeTarget)&&void 0!==r&&r.contains(n)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const n=this,{activeTarget:r,hideOnDelegateChange:i,anchorToTarget:s}=n,o=t!==r,a=o&&i;if(!1===n.trigger("pointerOver",{event:e,target:t}))n.internalOnPointerOut(e);else{if(n.triggeredByEvent=e,n.hasTimeout("hide")&&(n.abortDelayedHide(),!o))return;if(!i&&n.element.classList.contains("b-hiding")&&n.cancelHideShowAnimation(),!n._hidden&&a&&n.hide(!1),n.activeTarget&&n.hasTimeout("show")&&n.clearTimeout("show"),n.activeTarget=t,n.activeTarget!==t)return void n.internalOnPointerOut(e);if(n.isVisible){n.lastAlignSpec=null;const e=n.updateContent();if(C.isPromise(e)&&!n.loadingMsg&&await e,!1===n.trigger("beforeShow"))return n.hide();n.alignTo({[s?"target":"position"]:s?t:"mouse",overlap:!(s&&n.anchor)}),n.trigger("show"),n.afterShowByTarget()}else n.activeTarget=t,n.delayShow(t)}}async delayShow(e){var t;const n=this;if(null!==(t=n.currentAnimation)&&void 0!==t&&t.showing&&n.cancelHideShowAnimation(),n.isVisible||n.hasTimeout("show"))n.isVisible&&n.showByTarget(e);else if(!n.hoverDelay||n.forSelector&&Date.now()-n.lastHidden<n.quickShowInterval){const t=n.updateContent();C.isPromise(t)&&!n.loadingMsg&&await t,n.showByTarget(e)}else n.addDocumentMouseDownListener(),n.listeningForMouseMove||n.anchorToTarget||(n.mouseMoveRemover=Jt.on({element:n.rootElement,mousemove:"onMouseMove",thisObj:n})),n.setTimeout((async()=>{if(n.activeTarget===e&&e.isConnected){const t=n.updateContent();C.isPromise(t)&&!n.loadingMsg&&await t,n.showByTarget(e)}}),n.triggeredByEvent&&"pointerover"!==n.triggeredByEvent.type?0:n.hoverDelay,"show")}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){const t=this,{element:n}=t;var r;(n.classList.toggle("b-allow-over",Boolean(e)),e)?t.allowOverlisteners=Jt.on({element:n,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:t}):null===(r=t.allowOverlisteners)||void 0===r||r.call(t)}updateContent(){const e=this;if(e.getHtml){const t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}get hasContent(){return Boolean(Yn.isVueConfig(this._html)||Yn.isReactElement(this._html)||""!==this._html&&"string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){const e=this;return(!e.isSharedTooltip||!Zl.dragging)&&((e.updateContentOnMouseMove||e.hasContent)&&!e.disabled)}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    ${N.encodeHtml(e)}\n                </div>\n            `)}showByTarget(e){var t;const n=this,{anchorToTarget:r}=n;n.mouseMoveRemover=null===(t=n.mouseMoveRemover)||void 0===t?void 0:t.call(n),n.showBy({[r?"target":"position"]:r?e:"mouse",overlap:!(r&&n.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:t,activeTarget:n}=e,r=Yn.getActiveElement(e.activeTarget);e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.element.parentNode&&e.toFront(),e.mouseMoveRemover||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=Jt.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.describedElement=null!=n&&n.contains(r)?r:null,e.inAfterShow=!0,e.allowOver=e.allowOver||0!=e.configuredAllowOver&&e.childItems.some((e=>e.isVisible&&!e.disabled&&e.focusElement)),e.inAfterShow=!1}changeActiveTarget(e,t){const n=this;if(e){if(!n.isConfiguring&&!1===n.trigger("overTarget",{newTarget:e,lastTarget:t}))return}else n.trigger("targetOut",{lastTarget:t});return e}updateDescribedElement(e,t){const{titleElement:n}=this,r=n&&Yn.getId(n),i=Yn.getId(this.contentElement);e&&e.getAttribute("aria-label")!==this.html&&(r&&Yn.addAttributeValue(e,"aria-describedby",r),Yn.addAttributeValue(e,"aria-describedby",i)),t&&(r&&Yn.removeAttributeValue(t,"aria-describedby",r),Yn.removeAttributeValue(t,"aria-describedby",i))}internalOnPointerOut(e){var t;const n=this,r="pointerover"===e.type?e.target:e.relatedTarget;n.allowOver&&(n.element.contains(r)||n.owns(r,!0))||n.element.contains(r)&&null!==(t=n.activeTarget)&&void 0!==t&&t.contains(r)||n.activeTarget&&!n.activeTarget.contains(r)&&n.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;if(!1===e.trigger("pointerOut"))return e.activeTarget=null,!0;e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}show(e){const t=this;!e&&t.forElement&&t.anchorToTarget&&!t.forSelector?t.showByTarget(t.forElement):super.show(...arguments),t.isVisible?t.afterShowByTarget():t.activeTarget=null}get hoverDelay(){var e;return"focus"===(null===(e=this.triggeredByEvent)||void 0===e?void 0:e.pointerType)?0:this._hoverDelay}get hideDelay(){var e;return"focus"===(null===(e=this.triggeredByEvent)||void 0===e?void 0:e.pointerType)?0:!!this.autoHide&&this._hideDelay}hide(){const e=this;if(e.abortDelayedShow(),e._hidden)return em;{var t,n;e.abortDelayedHide();const r=super.hide(...arguments);return e.lastHidden=Date.now(),e.activeTarget=null,null===(t=e.mouseMoveRemover)||void 0===t||t.call(e),e.mouseMoveRemover=null,null===(n=e.transitionEndDetacher)||void 0===n||n.call(e),e.transitionEndDetacher=null,e.describedElement=null,r}}abortDelayedShow(){const e=this;var t,n,r;e.hasTimeout("show")&&(null===(t=e.mouseDownRemover)||void 0===t||t.call(e),e.mouseDownRemover=null,e.clearTimeout("show"),null===(n=e.mouseMoveRemover)||void 0===n||n.call(e),e.mouseMoveRemover=null,null===(r=e.transitionEndDetacher)||void 0===r||r.call(e),e.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,t=e.lastAlignSpec;e.isConfiguring||e.isVisible||null==t||!t.targetOutOfView||(t.allowTargetOut||Yn.isInView(t.target,!1,e))&&(e.show(),t.targetOutOfView=!1),super.realign()}alignTo(e){const t=this,n=(t.mouseOffsetX||1)*(t.rtl?-1:1),r=t.mouseOffsetY||1,i=Math.max(Math.min(n,5),0),s=Math.max(Math.min(r,5),0);if(!t.isVisible)return;let o;t.anchorToTarget||"mouse"!==e.position||(o=new $t(t.triggeredByEvent.pageX-globalThis.scrollX,t.triggeredByEvent.pageY-globalThis.scrollY),e.position=new $t(o.x+(n||1)-(n<0?t.width:0),o.y+(r||1)-(r<0?t.height:0))),!e||t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target)||e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e),o&&t.lastAlignSpec.result.inflate(s,i).contains(o)&&(t.lastAlignSpec.position="mouse",t.mouseOffsetY=-r,t.mouseOffsetX=-n,t.realign(),t.mouseOffsetY=r,t.mouseOffsetX=n)}set html(e){super.html=e,this.isVisible&&this.realign()}get html(){return super.html}changeHtml(e){const t=this;return C.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((n=>{e.target===t.activeTarget&&(t.html=n)}))):("object"!=typeof e&&(e=null!=e?t.optionalL(String(e)):""),e)}updateHtml(e,t){const n=this;let r=""===e;r&&!Yn.isVueConfig(e)||(super.updateHtml(e,t),n.hasContent?C.isPromise(e)||n.trigger("innerHtmlUpdate",{value:e}):r=!0),r&&n.hide()}onMouseMove(e){const t=this,{forElement:n,activeTarget:r}=t,i=t.hasTimeout("hide"),s=e.target;if(t.triggeredByEvent=e,!t._hidden){let o;const a=!(null==r?void 0:r.contains(s))&&t.forSelector&&r&&!i&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(s)),l=null!=n&&n.document?n.document.documentElement:n,d=l&&(l.contains?l.contains(s):16&l.compareDocumentPosition(s));if(a&&(o=t.handleForElementOut()),o||!i||d){if(t.dismissDelay&&!i&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:r,activeTarget:r,event:e}]),!t.html))return void t.hide();t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}onElementUserAction(e){const{showOnClick:t}=this;"number"==typeof t&&t!==e.button||(2===e.button&&e.preventDefault(),this.internalOnPointerOver(e))}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t,n){var r;let i=null===(r=t.bryntum)||void 0===r||null===(r=r.tooltip)||void 0===r?void 0:r.get(tm);if(!i&&!n){var s;null!==(s=t.bryntum)&&void 0!==s&&s.tooltip||W.setPath(t,"bryntum.tooltip",new Map);const n=t.bryntum.tooltip;n.set(tm,!0),i=new tm({forElement:t,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isSharedTooltip:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({target:e}){if(i.isOverflowDetail)return;for(const e in i.resetCfg)"listeners"===e?i.un(i.resetCfg[e].set):"html"!==e&&(i[e]=i.resetCfg[e].was);i.resetCfg={};const t=oc.getById(e.id),n=(null==t?void 0:t.tipConfig)||i.gatherDataConfigs(e);if(t&&t.element!==e||!t&&e.matches(".b-widget")||null!=t&&t.disabled&&!t.showTooltipWhenDisabled)return!1;i._owner=t,i.element.classList.toggle("b-target-disabled",Boolean(null==t?void 0:t.disabled));for(const e in n)i.resetCfg[e]={set:n[e],was:i[e]},"listeners"===e?i.ion(n[e]):i[e]=n[e]},hide({source:e}){e.owner=null}},gatherDataConfigs(e){const{dataset:t}=e,n={};for(const e in t)if(e.startsWith("btip"))if(e.length>4){const r=N.uncapitalize(e.substr(4));if(r in i.getDefaultConfiguration()){const i=t[e];n[r]=Qg[i]?"true"===i:isNaN(i)?i:parseInt(i,10)}}else n.html=t[e];return e.hasAttribute("aria-label")&&!n.html?n.html=N.encodeHtml(i.optionalL(e.getAttribute("aria-label"))):e.hasAttribute("aria-labelledby")&&(n.html=N.encodeHtml(i.optionalL(document.getElementById(e.getAttribute("aria-labelledby").textContent)))),n},filterTarget({target:e}){i.isOverflowDetail=!1;const t=e.closest(i.forSelector);if(t)return t;if(tm.showOverflow&&e.closest(".b-widget"))for(;(null===(n=e)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE;){var n;if("ellipsis"===Yn.getStyleValue(e,"text-overflow")&&e.clientWidth<e.scrollWidth)return i.html=N.encodeHtml(e.textContent),i.isOverflowDetail=!0,e;e=e.parentNode}}}),Jt.on({element:t,mouseenter:e=>tm.currentOverElement=e.target,keydown:e=>tm.currentOverElement=e.target,capture:!0,thisObj:i}),n.set(tm,i)}return i}static encodeConfig(e){const t={};if("string"==typeof e)t.btip=e;else for(const n in e)t[`btip${"html"===n?"":N.capitalize(n)}`]=e[n];return t}}tm.initClass(),Object.defineProperty(oc,"tooltip",{get:()=>tm.getSharedTooltip(document.body,document.body)}),oc.Tooltip=tm,tm._$name="Tooltip";class nm extends ig{static type="tip";static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}dragMove(e){const{offset:t,tooltip:n}=this,{event:r}=e;n&&(n.isVisible||n.show(),n.alignTo({align:this.align,target:new Ot(r.clientX-t,r.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return oc.reconfigure(t,e,this)}}nm.initClass(),nm._$name="DragTipProxy";var rm=e=>class extends(e||Qe){static $name="Labelable";static configurable={label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}};get hasLabel(){return Boolean(this.label)}compose(){const{hasLabel:e,labelPosition:t}=this;return{class:{[`b-label-${t}`]:e,"b-has-label":e}}}changeLabel(e){return e||""}setupLabel(e){return W.assign({tag:"label",for:`${this.id}-input`,class:`b-label b-align-${e.align||"start"}`},e)}updateLabelWidth(e){this.labelElement&&(this.labelElement.style.flex=`0 0 ${Yn.setLength(e)}`,this.inputWrap&&(this.inputWrap.style.flexBasis=null==e?"":"auto"))}get widgetClass(){}},im=(e=Qe)=>class extends(e.mixin(Tr)){static $name="Validatable";get widgetClass(){}doDestroy(){const e=this,t=e._rootElement&&e.constructor.getSharedErrorTooltip(e._rootElement,{doNotCreate:!0,cachePath:e.errorTooltipCachePath});super.doDestroy(),(null==t?void 0:t.field)===e&&t.hide()}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement,{cachePath:this.errorTooltipCachePath,tooltipConfig:this.errorTooltipConfig})}static get errorTip(){return this.getSharedErrorTooltip(document.body)}static getSharedErrorTooltip(e,t={}){var n;const{doNotCreate:r,cachePath:i="errorTooltip",tooltipConfig:s}=t;let o=null===(n=e.bryntum)||void 0===n?void 0:n[i];return o||r||(e.bryntum=e.bryntum||{},o=tm.new({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},axisLock:"flexible",scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const e=this,t=oc.fromElement(e.activeTarget);if(t){const n=t.getErrors();if(n)return e.html=n.join("<br>"),e.field=t,!0}return!1}},s),e.bryntum[i]=o),o}setError(e,t,n){const r=this,i=Object.keys(r.errors||{}).length;(r.errors||(r.errors={}))[e]=r.optionalL(e);const s=Object.keys(r.errors).length;if(s!==i&&r.trigger("validityChange",{valid:0===s,bubbles:!0}),t||r.syncInvalid(),n){const t=()=>{r.clearError(e),n()},n=r.ion({keydown:t,focusOut:t})}}clearError(e,t){const n=this;n.errors&&Object.keys(n.errors).length>0&&(e?delete n.errors[e]:n.errors={},n.trigger("validityChange",{valid:0===Object.keys(n.errors).length,bubbles:!0})),t||n.syncInvalid()}getErrors(){const e=this;if(!e.isValid){var t,n;const r=e.validity,i=W.keys(r).find((e=>"valid"!==e&&"customError"!==e&&r[e])),s=e.errors&&Object.values(e.errors),o=(null===(t=e.formatter)||void 0===t?void 0:t.is.percent)??!1;let a;if(a=null!=s&&s.length?s:r.customError?[e.input.validationMessage]:i?[e.L(i,{min:o?100*e.min+"%":e.min,max:o?100*e.max+"%":e.max})]:[e.L(e.invalidValueError)],(null===(n=a)||void 0===n?void 0:n.length)>0)return a}}syncInvalid(){const e=this,{isPainted:t}=e;if(e.updatingInvalid=!0,t){const{isValid:t,element:n,inputWrap:r}=e;if(n.classList[t?"remove":"add"]("b-invalid"),t){const t=e.constructor.getSharedErrorTooltip(e.rootElement,{doNotCreate:!0,cachePath:this.errorTooltipCachePath});null!=t&&t.isVisible&&t.field===e&&t.hide()}else if(r){const t=e.errorTip;t&&(e.containsFocus||e.isVisible&&Yn.isDescendant(r,tm.currentOverElement))&&(t.activeTarget===r&&t.isVisible?t.onBeforeShow():(t.activeTarget=r,t.showBy(r)))}}e.updatingInvalid=!1}};class sm extends Dc{static $name="FieldContainer";static type="fieldcontainer";static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){return this.owner.inline??1===this.ensureItems().count}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(Boolean(e))}updateCollapsed(e){var t;this.collapser=null===(t=this.collapser)||void 0===t?void 0:t.destroy(),this.setCollapsedCls(e)}updateCollapser(e,t){t&&null==t.completed&&(t.reverting&&e||t.destroy()),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return null!=e&&e.collapsed}get collapsingExpanding(){return null!=this.collapser}get expanding(){const{collapser:e}=this;return null!=e&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,t){var n;null===(n=this.owner)||void 0===n||null===(n=n.element)||void 0===n||n.classList[t?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:t,syncableConfigs:n}=e;if(n){let r,i;for(r in n)i=n[r](t),e.eachWidget((e=>{e[r]=i}),!1)}t.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:t}=this;this.autoLayout&&(t.horizontal=e,t.justify=e?"center":"stretch")}toggleCollapse(e,t){const n=this,{animation:r,collapser:i,inline:s}=n,{containerWrapElement:o}=n.owner,a=t=>{t&&(n.element.style.height="",n.togglingCollapse=!0,n.collapsed=e,n.collapser=null)};if(null==e&&(e=!n.collapsed),!1!==t&&null!==t&&(o&&n.isVisible?(!0===t?t={}:"number"==typeof t&&(t={duration:t}),t=r||t?W.merge({},r,t):null):t=null),t){if(i&&e!==i.collapsed)n.collapser=i.revert({finalize:a}),n.collapser.collapsed=e;else if(!i&&e!==n.collapsed){!e&&n.setCollapsedCls(!1);const{element:r}=n,{height:i}=r.getBoundingClientRect(),l=s?1:i;!e&&n.setCollapsedCls(!0),r.style.height=`${i}px`,n.collapser=Pc.run(W.merge({finalize:a,element:o,[s?"opacity":"height"]:{from:e?l:0,to:e?0:l}},t)),n.collapser.collapsed=e}}else n.togglingCollapse=!0,n.collapsed=e}}sm.initClass(),sm._$name="FieldContainer";const om=(e,t)=>(e.weight||0)-(t.weight||0),am=(e,t)=>(t.weight||0)-(e.weight||0),lm=[],dm={align:!0,weight:!0};class cm extends(oc.mixin(Su,rm,im)){static $name="Field";static type="field";static configurable={role:null,defaultBindProperty:"value",skipValidation:null,placeholder:null,value:"",name:null,labels:null,required:null,showRequiredIndicator:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",stepTriggers:null,triggers:null,highlightExternalChange:!1,localizableProperties:["label","title","placeholder","labelWidth","hint"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","ariaLabel","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{},twinSyncConfigs:["value"],inputTag:{$config:null,value:"input",default:"input"}};static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t,n;const r=this,{triggers:i}=r;if(null===(e=r.inputListenerRemover)||void 0===e||e.call(r),null===(t=r.keyListenerRemover)||void 0===t||t.call(r),null===(n=r.container)||void 0===n||n.destroy(),super.doDestroy(),i)for(const e of Object.values(i))e.destroy()}get childItems(){const{container:e,triggers:t}=this,n=t?Object.values(t):[];return e?[...n,...e.childItems]:n}get invalidValueError(){return"L{invalidValue}"}construct(e={}){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay)),!t.ariaLabel&&t.placeholder&&t.updateAriaLabel(t.placeholder)}changeKeyMap(e){const t=this;let n={};e&&(t._fieldKeyMap?W.assign(n,t._fieldKeyMap):(t._fieldKeyMap=e,W.assign(n,e)));for(const e in t.triggers){var r;null!==(r=t.triggers[e])&&void 0!==r&&r.keyMap&&(n=t.mergeKeyMaps(n,t.triggers[e].keyMap,e))}return n}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const t=this;t.valueOnFocus=W.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e),t.focusing=!0,t.syncInvalid(),t.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return cm}compose(){this.getConfig("clearable");const e=this,{container:t,innerElements:n,label:r,labels:i,labelCls:s,readOnly:o,stepTriggers:a,triggers:l,required:d,showRequiredIndicator:c}=e,u=W.values(l,((e,t)=>!t)),h=u.filter((e=>"start"===e.align)).sort(om),g=u.filter((e=>"start"!==e.align)).sort(am),m=e.setupLabel.bind(e),p=[...h.map((e=>e.element)),...n,...g.map((e=>e.element))];return{class:{"b-has-step-triggers":a,"b-has-start-trigger":h.length,"b-no-input":!n.length,"b-readonly":o,"b-field-container":Boolean(t),"b-field-container-inline":null==t?void 0:t.inline,"b-required":Boolean(d&&c)},children:[...(i||lm).filter((e=>e&&"end"!==e.align)).map(m),r?m({reference:"labelElement",class:`b-label b-align-start ${s||""}`,html:r}):null,p.length?{class:"b-field-inner",reference:"inputWrap",children:p}:null,...(i||lm).filter((e=>"end"===(null==e?void 0:e.align))).map(m),...t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:lm]}}updateElement(e,t){var n;const r=this,i=r.initialConfig.value,{input:s}=r;super.updateElement(e,t),null!=i&&(r.value=i),r.syncEmpty(),r.updateInputReadOnly(r.inputReadOnly),r.syncInvalid();const o=s||r.focusElement;null===(n=r.keyListenerRemover)||void 0===n||n.call(r),r.keyListenerRemover=o&&Jt.on({element:o,thisObj:r,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:n,inputCls:r,inputType:i,name:s,inputTag:o}=this,a=W.merge({reference:"input",tag:o,type:i,name:s||n,id:`${n}-input`,retainElement:"prevent-release",dataset:this.isPasswordField?null:{opIgnore:!0}},t);r&&(a.class=r);for(let t,n,r=e.length;r-- >0;)t=e[r],n=this[t],null!=n&&(a[N.hyphenateAttributeName(t)]=n);return a}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){const e=this.input;let t;try{t=[e.selectionStart,e.selectionEnd,e.selectionDirection]}catch(r){var n;t=(null===(n=e.value)||void 0===n?void 0:n.length)||0,t=[t,t]}return t}set textSelection(e){"number"==typeof e?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,n]=this.textSelection,r=this.input.value;return`${r.substr(0,t)}${e}${r.substr(n||t)}`}select(e,t){const n=this.focusElement;if(n.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;n.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}get caretAtEnd(){return this.textSelection[1]===this.input.value.length}get caretAtStart(){return!this.textSelection[1]}get selectedAll(){const{textSelection:e}=this;return!e[0]&&e[1]===this.input.value.length}syncEmpty(){var e;const{isEmptyInput:t,isEmpty:n,element:r}=this,i=null===(e=this.triggers)||void 0===e?void 0:e.clear,s=t&&n;r&&(i&&i[s?"hide":"show"](),r.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:n,hintHtml:r}=e,i=null==t?void 0:t.parentElement;if(t){let s=r||n;const o=e.hintElement||s&&(e.hintElement=Yn.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));o&&("function"==typeof s&&(s=s({source:e,value:e.value})),o.firstChild[r?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}updateInputTag(e){e&&e!==this.getDefaultConfiguration().inputTag&&(this.dontCache=!0)}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}updateInputReadOnly(e){const t=this,{input:n,inputListenerRemover:r}=t;n&&(n.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==r?void 0:r():r||(t.inputListenerRemover=Jt.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){this.syncInputReadOnly()}updateRequired(e){this.syncRequired()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&W.assign({cls:"b-icon-remove",weight:1e3,handler:t.clear},e)||null}}changeTriggers(e,t){const n=this,r=n.$triggers||(n.$triggers=new du({configName:"triggers",factory:cm.Trigger,inferType:!1,owner:n,created(e){ee.after(e,"onConfigChange",((e,{name:t})=>{dm[t]&&n.onConfigChange({name:"triggers",value:r.target})}))},setup(e,t){e.reference=e.ref=t,e.parent=n}}));if(e&&!n.stepTriggers&&(e.back||e.forward)&&(delete(e=W.assign({},e)).back,delete e.forward),r.update(e),n.element&&(n.keyMap=n.keyMap),!t)return r.target}updateInputWidth(e){this.input.style.width=Yn.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled&&!e.skipValidation){if(e.syncRequired(),e.checkValidity&&e.callback(e.checkValidity,e,[e]),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isClear(){return this.isEmpty&&this.isEmptyInput}get isEmpty(){const{value:e}=this;return null==e||""===e||e===this.nullValue}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get validity(){const e=this.input;return null==e?void 0:e.validity}async setValue(e){this.value=e}changeValue(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}updateValue(e,t){const n=this;n.isConfiguring||(n.syncRequired(),n.inputting||n.triggerChange()),n.inputting||(n._lastValue=e),n.syncInputFieldValue()}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:n,parent:r,inputValueAttr:i,inputValue:s}=t;if(n&&!t.inputting&&n[i]!==s&&(n[i]=s,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(n.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),r){const{assigningValues:t}=r;!0!==t&&!1!==(null==t?void 0:t.highlight)||(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&Yn.isTextualInput(e)}updatePlaceholder(e){this.ariaLabel||this.updateAriaLabel(e),this.input&&(null==e?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const n=this,{value:r,_lastValue:i,isValid:s}=n;n.syncHint(),n.triggerFieldChange({value:r,oldValue:i,event:e,userAction:t,valid:s}),"change"===n.defaultAction&&n.trigger("action",{value:r,oldValue:i,event:e,userAction:t,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var t;const n=this;n.validateOnInput||n.errorTip.hide(),n.inputting=!0,n.fetchInputValue(),n.inputting=!1,n.trigger("input",{value:n.value,event:e}),null===(t=n.changeOnKeyStroke)||void 0===t||t.call(n,e)}get needsInputSync(){return this.input[this.inputValueAttr]!==String(this.inputValue??"")}internalOnKeyEvent(e){const t=this,{value:n}=t;let r=!1;if(t._isUserAction=!0,"keydown"===e.type&&"Escape"===e.key&&!t.readOnly&&!t.disabled){const i=t.isValid,s="initialValue"in t?t.initialValue:t.valueOnFocus,o=t.hasChanged(s,n),{needsInputSync:a}=t;t.revertOnEscape&&(!i||o||a)?(o&&(t.value=s),a&&t.syncInputFieldValue(!0),t.clearError(),r=(o||a)&&t.isValid||i!==t.validOnFocus):!t.isEmpty&&t.clearable&&t.revertOnEscape&&(t.clear(),e.stopPropagation())}t.isDestroyed||(r&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e})),t._isUserAction=!1}clear(e){const t=this;t.isClear||(t.value=t.nullValue,t.clearError(),t.syncInvalid(),t.input&&Yn.isTextualInput(t.input)&&(t.input.value=""),t.trigger("clear",{event:e}),null==e||e.stopImmediatePropagation())}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;t.isConfiguring||t.focusing&&!t.focusVisible||!t.required||!t.isEmpty||null!==(e=t.parent)&&void 0!==e&&e.isSettingValues?t.clearError("L{fieldRequired}",t.updatingInvalid):t.setError("L{fieldRequired}",t.updatingInvalid)}get containerCollapsed(){var e;return null===(e=this.container)||void 0===e?void 0:e.collapsed}set containerCollapsed(e){const{container:t}=this;t&&(t.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,t){e&&(Array.isArray(e)||!("type"in e)&&!("items"in e))&&(e={items:e});const n=this,r=e&&W.merge({owner:n,layout:"box"},n.containerDefaults),i=oc.reconfigure(t,e,{owner:n,defaults:r});if(!i||(i.autoLayout="box"===(null==r?void 0:r.layout),i!==t))return i;i.syncContainer()}onConfigChange(e){var t;super.onConfigChange(e),null!==(t=this.container)&&void 0!==t&&null!==(t=t.syncConfigTriggers)&&void 0!==t&&t[e.name]&&this.container.syncChildConfigs()}assignValue(e,t){const n=this,{container:r,containValues:i}=n,s=n.getValueName(t),o=e&&s in e;n.assigningValue=!0,r&&!1!==i?e&&"nested"===i?o&&(e=W.clone(e[s]),super.assignValue({[s]:e&&!("value"in e)||e.value},t),e&&delete e.value,r.assignValue(e,t)):(super.assignValue(e,t),r.assignValue(e,t)):super.assignValue(e,t),n.assigningValue=!1}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,t){const n=this,{container:r,containValues:i,valueName:s}=n,o=typeof i;t=t??s in e,r&&!1!==i&&("nested"===i?t&&(e[s]={value:e[s],...r.values}):(!0===i||null==i&&t||"string"===o&&n[i]||"function"===o&&i(n))&&r.gatherValues(e))}updateContainer(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}}cm.Trigger=class extends oc{static $name="FieldTrigger";static get factoryable(){return{defaultType:cm.Trigger,extends:null}}static type="trigger";static configurable={align:null,weight:null,role:null};get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(e){return e}onClick(e){const t=this,{field:n}=t;n.disabled||n.readOnly||(e.key&&e.preventDefault(),!1!==n.trigger("trigger",{trigger:t})&&t.handler&&(n._isUserAction=!0,n.callback(t.handler,n,[e,t]),n._isUserAction=!1))}onMousedown(e){const t=this.field;!("key"in e)&&Yn.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((()=>t.editable=!0),500)),e.preventDefault(),Yn.getActiveElement(t.input)!==t.input&&t.focus()}},cm.SpinTrigger=class extends cm.Trigger{static $name="SpinTrigger";static type="spintrigger";static configurable={repeat:{$config:["nullify"],value:!0}};compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(e){var t;null===(t=this.clickRepeater)||void 0===t||t.destroy(),this.clickRepeater=e?Oc.new({element:this.element},e):null}onClick(e){const t=this,{field:n}=t;n._isUserAction=!0,n.disabled||n.readOnly||(e.target===t.upButton?n.doSpinUp(e.shiftKey):e.target===t.downButton&&n.doSpinDown(e.shiftKey)),n._isUserAction=!1}get isFocusable(){return!this.disabled&&super.isFocusable}},cm.Trigger.initClass(),cm.SpinTrigger.initClass(),oc.register(cm.Trigger,"trigger"),oc.register(cm.SpinTrigger,"spintrigger"),cm._$name="Field";class um extends lc{static $name="Fit";static type="fit";static configurable={containerCls:"b-fit-container",itemCls:"b-fit-item"}}um.initClass(),um._$name="Fit";const hm=document.createRange();class gm extends oc{static $name="List";static type="list";static configurable={itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",tag:"ul",items:null,displayField:"text",store:{value:{},$config:"lazy"},navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,collapsibleGroups:!1,selectAllItem:!1,itemTpl(e){let t=N.encodeHtml(e.getValue(this.displayField));return null!=t&&""!==t||(t="&nbsp;"),t},tooltipTemplate:null,getItemStyle:null,getItemCls:null,groupHeaderTpl(e,t){let n=N.encodeHtml(t);return null!=n&&""!==n||(n="&nbsp;"),`${(this.allowGroupSelect||e.isParent)&&this.isSelectable(e)?this.itemIconTpl(e):""}${n}`},allowGroupSelect:!0,clearSelectionOnEmptySpaceClick:!1,selected:{$config:["nullify","lazy"],value:[]},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"},title:null,virtualize:null,listItemHeight:10,isSelectable:()=>!0,emptyText:null};construct(e,...t){var n;const r=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:i}=r,{classList:s}=i;r.multiSelect&&s.add("b-multiselect"),null!==(n=r.store)&&void 0!==n&&n.count?r.refresh():s.add("b-empty"),Jt.on({element:i,click:"onClick",thisObj:r})}doDestroy(){var e;this.detachListeners("store"),null===(e=this.navigator)||void 0===e||e.destroy(),super.doDestroy()}changeScrollable(e){return(e=super.changeScrollable(e))&&this.title&&(e.stickies=".b-list-title"),e}onFocusIn(e){var t;this.restoreActiveItem(null===(t=e._target)||void 0===t?void 0:t.closest(this.itemSelector)),super.onFocusIn(e)}get isVirtualized(){return"number"==typeof this.virtualize?this.store.count>this.virtualize:Boolean(this.virtualize)}outOfViewTpl(e,t){return`<li class="b-list-item b-out-of-view" data-index="${t}" aria-posinset="${t+1}" aria-setsize="${this.store.count}" data-id="${N.encodeHtml(e.id)}"></li>`}onItemIntersection(e,t){if(t){const t=this,n=parseInt(e.dataset.index),r=t.store.getAt(n);r&&Yn.sync(t.callback(t.itemWrapperTpl,t,[r,n,t]),e),t.itemIntersectionObserver.unobserve(e)}}contentTpl(){const e=this,t=Math.ceil(e.height/e.listItemHeight),n=e.store.records.map(((n,r)=>!e.isVirtualized||r<t?e.callback(e.itemWrapperTpl,e,[n,r,e]):e.outOfViewTpl(n,r)));if(e.multiSelect&&!1!==e.selectAllItem&&n.unshift(e.selectAllItemTpl()),e.title){const t=`${e.id}-title`;n.unshift(`<li id="${t}" class="b-list-item b-list-title" data-noselect>${N.encodeHtml(e.title)}</li>`),e.element.setAttribute("aria-labelledby",t)}else e.element.removeAttribute("aria-labelledby");return e.emptyText&&0===e.store.count&&n.push(`<li class="b-list-item b-empty-text">${e.L(e.emptyText)}</li>`),hh.tpl`${n}`}itemWrapperTpl(e,t,n){const{selected:r,getItemStyle:i,store:s,tooltipTemplate:o}=n,a=(null==o?void 0:o(e))||"",l=[...s.excludeCollapsedRecords?[`--tree-level:${e.childLevel||0}`]:[],...i?[n.callback(i,n,[e])]:[]].join(";"),d=l.length?`style="${l}"`:"",c=n.callback(n.isSelectable,n,[e]);return s.isGrouped&&!e.isGroupHeader&&e.instanceMeta(s).groupParent.meta.collapsed?"":e.ancestorsExpanded(s)?hh.tpl`<li ${d} aria-posinset="${t+1}" aria-setsize="${this.store.count}" class="${n.getItemClasses(e,t)}" role="option" ${a?`data-btip="${N.encodeHtml(a)}"`:""} aria-selected="${r.includes(e)}" data-index="${t}" ${c?"":"data-noselect"} data-id="${N.encodeHtml(e.id)}" ${n.itemsFocusable?'tabindex="-1"':""}>${n.itemContentTpl(e,t)}</li>`:""}itemContentTpl(e,t){const n=this;if(e.isGroupHeader||e.isParent&&!1!==n.store.excludeCollapsedRecords){let t=n.groupHeaderTpl(e,e.isParent?n.callback(n.itemTpl,n,[e]):N.capitalize(e.meta.groupRowFor));if(n.collapsibleGroups||e.isParent){const r=e.isParent?e.instanceMeta(n.store).collapsed:e.meta.collapsed,i=r?"right":"down";t+=`<button aria-label="${n.L("L{PanelCollapser."+(r?"Expand":"Collapse")+"}")}" class="b-button b-tool b-icon b-icon-collapse-${i} b-list-expander-icon" data-noselect></button>`}return t}return`${n.itemIconTpl(e,t)}${n.callback(n.itemTpl,n,[e])}`}itemIconTpl(e,t){return this.multiSelect&&this.callback(this.isSelectable,this,[e])?`<i aria-hidden="true" role="presentation" class="b-selected-icon b-icon ${this.selectIconCls}"></i>`:""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return`<li class="${this.itemCls} b-select-all-item ${e}" data-select-all data-id="select-all" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemIconTpl({})}<div>${this.L("L{selectAll}")}</div></li>`}getItemClasses(e){var t,n;const r=this,{getItemCls:i,store:s}=r,o=null===(t=r._navigator)||void 0===t?void 0:t.activeItem,a=(null==o?void 0:o.dataset.id)==e.id,l="groupRowFor"in e.meta?"b-list-item-group-header":s.excludeCollapsedRecords&&e.isParent?"b-list-item-tree-parent":"",d=r.selected.includes(e)||(null===(n=e.groupChildren)||void 0===n?void 0:n.every((e=>r.selected.includes(e)))),c=i?this.callback(i,this,[e]):"";return`${r.itemCls} ${e.cls||""} ${c} ${d?r.selectedCls:""} ${a?r.navigator.focusCls:""} ${l}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:n,record:r,changes:i,isCollapse:s}){const o=this,{selected:a}=o;switch(t){case"dataset":a.match(e.storage,!o._externallyOwnedSelection);break;case"remove":s||a.remove(n);break;case"clear":o.deselectAll();break;case"update":{const{id:e}=i;return e&&Yn.setAttributes(o.contentElement.querySelector(N.encodeAttributeSelector("data-id",e.oldValue)),{"data-id":e.value}),void o.refreshItem(r)}}o.refresh()}onStoreRefresh(){this._selected?this.refresh():this.getConfig("selected")}refresh(){const e=this;if(e.isVisible&&e.store){var t;const r=null===(t=e.navigator)||void 0===t?void 0:t.activeItem;e.itemIntersectionObserver&&(e.itemIntersectionObserver.disconnect(),e.itemIntersectionObserver=null),e.paintListener=null;const i=Yn.createElementFromTemplate(e.contentTpl(),{fragment:!0});if(e.clearItems().insertNode(i),e.element.classList.toggle("b-virtualized",e.isVirtualized),e.isVirtualized){var n;e.itemIntersectionObserver=new IntersectionObserver((t=>{for(const n of t)e.onItemIntersection(n.target,n.isIntersecting,n)}));for(const t of e.element.querySelectorAll(e.itemSelector))e.itemIntersectionObserver.observe(t);e.listItemHeight=null===(n=e.element.children[0])||void 0===n?void 0:n.clientHeight}r&&e.restoreActiveItem(r),e.refreshCount=(e.refreshCount||0)+1,e.element.classList.toggle("b-empty",0===e.store.count),e.updateSelectAllState()}else e.paintListener||(e.paintListener=e.once("paint","refresh"))}clearItems(){const e=this,{contentElement:t}=e,n=t.querySelector(e.itemSelector),r=t.lastChild;if(n){const r=t.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);hm.setStartBefore(n),hm.setEndAfter(r[r.length-1]),hm.deleteContents()}else r?(hm.setStartAfter(r),hm.setEndAfter(r)):(hm.setStart(t,0),hm.setEnd(t,0));return hm}refreshItem(...e){for(const t of e){const e=this,n=e.getItem(t);if(n){const r=e.store.indexOf(t),i=Yn.createElementFromTemplate(e.callback(e.itemWrapperTpl,e,[t,r,e]));Yn.sync(i,n)}}}getItem(e){var t;if(null!=e)return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e<0?this.store.count+e:e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),null!=(null===(t=e)||void 0===t?void 0:t.id)&&(e=e.id),this.contentElement.querySelector(N.encodeAttributeSelector("data-id",e)))}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){this.store.data=nt.asArray(e??[]).map((e=>"string"==typeof e?{[this.displayField]:e}:e))}updateDisabled(e,t){super.updateDisabled(e,t),this.navigator&&(this.navigator.disabled=e)}updateLocalization(){super.updateLocalization(),this.refresh()}updateTitle(){this.refresh()}changeSelected(e,t){const n=this,r={change:"onInternalSelectionChange",thisObj:n};if(e){if(e.isCollection)n._externallyOwnedSelection=!0,e.ion(r);else if(n._externallyOwnedSelection=!1,e=nt.asArray(e).reduce(((e,t)=>((t=t.isModel?t:n.store.getById(t))&&n.callback(n.isSelectable,n,[t])&&e.push(t),e)),[]),t)t.splice(0,t.count,e),e=t,n.refresh();else{const t=e;(e=n._selected=new ho({internalListeners:r})).add(t)}e!==t&&(null==t||t.un(r))}else null==t||t.destroy();return e}updateSelected(e){e&&this.refresh()}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}updateMultiSelect(e,t){const{_selected:n}=this;!e&&t&&(null==n?void 0:n.count)>1&&(n.suspendEvents(),this.deselect(n.allValues.slice(1)),n.resumeEvents()),this.isConfiguring||this.refresh()}get store(){return this.getConfig("items"),this._store}changeStore(e){const t=this;if(e instanceof Il||(Array.isArray(e)&&(e={data:e}),e=new Il(e)),t.detachListeners("store"),e){const n={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(n.beforeLoad="onBeforeStoreLoad",n.afterRequest="onAfterStoreRequest"),e.isGrouped&&(t.element.classList.add("b-grouped"),n.groupchange="onStoreRefresh"),e.ion(n),e.tree&&e.traverse((t=>{t.isParent&&!t.expanded&&e.onNodeExpand(t)}))}return e}updateStore(e){null!=e&&e.records.length&&this.getConfig("selected"),this.refresh()}changeNavigator(e,t){const n=this,{element:r}=n;var i;r&&((null===(i=e=qh.reconfigure(t,e?qh.mergeConfigs({ownerCmp:n,disabled:n.disabled,target:r,keyEventTarget:r,activateOnMouseover:n.activateOnMouseover},e):null,n))||void 0===i?void 0:i.keyEventTarget)!==r||n.itemsTabbable||(r.tabIndex=0));return e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return e?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const e=this,{refreshCount:t,navigator:n}=e,{previousActiveItem:r}=n;super.minHeight=e._minHeight;const i=super.show(...arguments);return e.refreshCount===t&&e.containsFocus&&e.restoreActiveItem(r,!0),i}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const n=this,{navigator:r,lastAlignSpec:i}=n;if(null!=e){if("string"!=typeof t){const e=i?i.zone:1;t=1&e?"nearest":e?"start":"end"}(e=n.getItem(e))&&!n.disabled&&(n.scrollable.scrollIntoView(e,{block:t}),r.activeItem=e)}}onClick(e){const t=e.target.closest(this.itemSelector);t?this.onItemClick(t,e):this.clearSelectionOnEmptySpaceClick&&this.deselectAll()}onSpaceKey(e){const t=e.target.nodeName.toUpperCase();("INPUT"!==t&&"TEXTAREA"!==t||e.target.readOnly)&&this.onEnterKey(e)}onEnterKey(e){const t=this.navigator.activeItem;t&&!this.disabled&&(e.target=t,this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}onInternalKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":t.collapseItem();break;case"ArrowRight":t.expandItem();break;case" ":t.onSpaceKey(e);break;case"Enter":t.onEnterKey(e)}}collapseItem(){const{activeItem:e}=this.navigator;e&&this.toggleCollapse(this.getRecordFromElement(e),!0)}expandItem(){const{activeItem:e}=this.navigator;e&&this.toggleCollapse(this.getRecordFromElement(e),!1)}onItemClick(e,t){const n=this,{allowGroupSelect:r}=n,i=parseInt(e.dataset.index),s=n.store.getAt(i),o=null==s?void 0:s.isSpecialRow,a=e.contains(t.target.closest("[data-noselect]"));if(!n.disabled&&!1!==n.trigger("beforeItem",{item:e,record:s,index:i,event:t,userAction:!0})){if(n._isUserAction=!0,e.contains(t.target.closest("[data-select-all]")))n.onSelectAllClick(e,t);else{if(t.target.matches(".b-list-expander-icon"))return void n.toggleCollapse(s);if(s&&!a&&(!o||r)){const{selected:i}=n,{groupParent:a}=s.instanceMeta(n.store);if(n.multiSelect){let l=i.includes(s),d=s;if(n.toggleAllIfCtrlPressed&&t.ctrlKey?d=n.store.records:r&&o&&(l=!s.groupChildren.some((e=>!i.includes(e))),e.classList.toggle("b-selected",!l),d=s.groupChildren),i[l?"remove":"add"](d),!o&&a&&r){n.getItem(a).classList.toggle("b-selected",a.groupChildren.every((e=>i.includes(e))))}}else i.splice(0,i.count,s)}}n.isDestroyed||(n.lastClicked=s,n.trigger("item",{item:e,record:s,index:i,event:t,userAction:!0}),n._isUserAction=!1)}}onInternalSelectionChange({action:e,removed:t,added:n,replaced:r}){const i=this,{selectedCls:s,unselectedCls:o}=i;let a,l;if("clear"===e)for(l of i.element.querySelectorAll(`.${s}`))l.classList.remove(s),l.setAttribute("aria-selected",!1),o&&l.classList.remove(o);else if("replaceValues"!==e){for(a of t)l=i.getItem(a),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(a of n)l=i.getItem(a),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}i.selectAllItem&&i.updateSelectAllState(),i.trigger("selectionChange",{selected:i.selected.values})}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;null===(e=this.element.querySelector(".b-select-all-item"))||void 0===e||e.classList.toggle(this.selectedCls,this.allSelected)}updateAllowGroupSelect(){this.refresh()}get allSelected(){const{selected:e,store:t}=this;return e.count&&(t.isFiltered?t.records.every((t=>e.includes(t))):t.count===e.count)}selectAll(e){const t=this;!t.multiSelect&&e||(t.selected.add(t.store.records),e&&!t.navigator.activeItem&&(t.navigator.activeItem=t.getItem(-1)))}deselectAll(){this.selected.clear()}select(e,t=!1){const{store:n,selected:r}=this,{modelClass:i}=n;e=nt.asArray(e).reduce(((e,t)=>((t=n.getById(i.asId(t)))&&e.push(t),e)),[]),t&&r.count?r.splice(0,r.count,e):r.add(e)}deselect(e){const{modelClass:t}=this.store;e=nt.asArray(e).reduce(((e,n)=>((n=this.selected.get(t.asId(n)))&&e.push(n),e)),[]),this.selected.remove(e)}toggleCollapse(e,t){const{store:n}=this;e.isGroupHeader?(n[(t=void 0===t?!e.meta.collapsed:t)?"collapse":"expand"](e),this.refresh(),this.trigger("toggleGroup",{groupRecord:e,collapse:t})):e.isParent&&(t=void 0===t?!e.instanceMeta(n).collapsed:t,e.instanceMeta(n).collapsed=t,this.refresh(),this.trigger("toggleNode",{record:e,collapse:t}))}updateCollapsibleGroups(e,t){if(t&&!e){const{store:e}=this;e.groupRecords.forEach((t=>e.expand(t)))}this.refresh()}}gm.initClass(),gm.prototype.navigatorClass=qh,gm._$name="List";const mm=()=>!0,pm=(e,t)=>e.text.localeCompare(t.text);var fm=e=>class extends e{static $name="FormulaField";static configurable={dataField:null,formulaPrefix:null};onFocusIn(){var e;(super.onFocusIn(...arguments),this.formulaProvider)&&(null===(e=this.fieldsList)||void 0===e||e.show())}onFocusOut(){var e;null===(e=this.fieldsList)||void 0===e||e.hide(),super.onFocusOut(...arguments)}internalOnKeyEvent(e){const t=this,{key:n}=e,{fieldsList:r}=t;if("keydown"===e.type){if("Enter"!==e.key&&(t.lastKey=e.key),"Escape"===n&&null!=r&&r.isVisible)return e.stopImmediatePropagation(),void r.hide();t.formulaPrefix&&"ArrowDown"===n&&(e.preventDefault(),null!=r&&r.isVisible||t.showFieldsList())}super.internalOnKeyEvent(...arguments)}internalOnInput(){super.internalOnInput(...arguments),this.checkForFormula()}updateValue(){super.updateValue(...arguments),this.checkForFormula()}checkForFormula(){var e,t;this.formulaPrefix=null!==(e=this.dataField)&&void 0!==e&&e.inputPrefixRE?null===(t=this.value.match(this.dataField.inputPrefixRE))||void 0===t?void 0:t[1]:null}updateFormulaPrefix(e,t){var n,r;const i=this;var s;(i.formulaProvider=e&&(null===(n=i.dataField)||void 0===n||null===(r=n.getFormulaProvider)||void 0===r?void 0:r.call(n,e)),t&&i.input.classList.toggle(`b-${t.toLowerCase()}-input`,!1),i.formulaProvider)?(i.input.classList.toggle(`b-${e.toLowerCase()}-input`,!0),i.formulaProvider.setConfig({inputField:i,store:i.formulaStore}),i.whenVisible("showFieldsList")):null===(s=i.fieldsList)||void 0===s||s.hide()}get formula(){const{formulaProvider:e,value:t}=this;if(e){const{formulaRE:n}=e;return n?t.match(n):t}return""}showFieldsList(){var e;const t=this,{input:n}=t,r=null===(e=t.name)||void 0===e?void 0:e.replace(/^#/,""),i=t.up("gridbase",!0);let s=t.fieldsList;if(s)s.owner=t,s.widgetMap.fields.navigator.keyEventTarget=n;else{var o;t.fieldFilter=r&&new Js((({id:e})=>e!==r));const{fieldNames:e}=t;s=t.fieldsList=new Xu({title:"Fields",cls:"b-formula-fieldlist",floating:!0,forElement:t.inputWrap,scrollAction:"realign",owner:t,autoShow:!1,align:{matchSize:"min",align:"t0-b0",axisLock:!0,minHeight:40*Math.min(3,e.length)},layoutStyle:{padding:0},layout:"fit",items:{fields:{type:"list",items:e,itemsFocusable:!1,scrollable:{overflowY:!0},navigator:{keyEventTarget:n,activateOnMouseover:!0},getItemCls(e){if("this"===e.id||"data"===e.id)return"b-special-field"},onItem({event:e,record:n}){"click"===e.type&&(t.lastKey=null),e.key&&("Enter"!==e.key||"ArrowDown"!==t.lastKey&&"ArrowUp"!==t.lastKey)?e.stopImmediatePropagation=()=>delete e.stopImmediatePropagation:t.selectField(n.id)}}}}),null!==(o=t.owner)&&void 0!==o&&o.cellEditorContext?(i.ion({cellMousedown:"onCellMousedown",cellClick:"onCellClick",thisObj:t,prio:99999}),t.record=t.owner.cellEditorContext.record):t.record||(t.record=t.formulaProvider.record)}s.show(),s.activeItem=null}onCellMousedown({event:e}){this.fieldsList.isVisible&&(e.preventDefault(),e.stopImmediatePropagation())}onCellClick({event:e,column:{field:t}}){if(this.fieldsList.isVisible)return e.stopImmediatePropagation(),this.selectField(t),!1}selectField(e){var t;const n=this,{input:r}=n,i=r.value.trim(),{selectionStart:s}=r,o=s>=i.length,a=i.endsWith(")")?i.length:i.length+2;if(s>((null===(t=n.formulaProvider.prefix)||void 0===t?void 0:t.length)||0)+1&&s<a){var l,d;const t=`${o||null!==(l=i[s-1])&&void 0!==l&&l.match(/\s|\(/)?"":" "}$${e}${o||null!==(d=i[s])&&void 0!==d&&d.match(/\s|\)$/)?"":" "}`;r.setRangeText(t,s,s),r.selectionStart=s+t.length,n.inputting=!0,n.fetchInputValue(),n.inputting=!1}}get fieldNames(){const e=this;if(!e._fields){var t;const n=(null===(t=e.formulaStore)||void 0===t?void 0:t.modelClass)||e.record.constructor,{fieldMap:r}=n,{fieldFilter:i}=e;(e._fields=n.fields.map((e=>{const t="string"==typeof e?e:e.name;return{id:t,text:r[t].label}})).filter(i?Js.generateFiltersFunction([i]):mm).sort(pm)).push({text:"Record",id:"this"},{text:"Store",id:"data"})}return e._fields}};class vm extends(cm.mixin(fm)){static $name="TextField";static type="textfield";static alias="text";static configurable={nullValue:""};construct(e){"hidden"===(null==e?void 0:e.inputType)&&(e.hidden=!0),super.construct(...arguments)}getCurrentToken(e=/\s/){const{value:t,selectionStart:n}=this.input;let r=n,i=n+1;if(!t.length||null==n)return null;for(;r>0&&!t[r-1].match(e);)r--;for(;i<t.length&&!t[i].match(e);)i++;return{token:t.substring(r,i),cursor:n,start:r,end:i}}}vm.initClass(),vm._$name="TextField";class ym extends vm{static $name="PickerField";static type="pickerfield";static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;null===(e=this.globalTapListener)||void 0===e||e.call(this),super.doDestroy()}changeEditable(e){return c.isMobile&&!0!==this.initialConfig.editable&&(e=!1),e}updateEditable(e){var t,n;const r=this,{element:i,ariaElement:s,nonEditableClickTarget:o}=r,{expand:a}=r.triggers,l=globalThis.matchMedia("(max-width: 410px)").matches;super.updateEditable(...arguments),i.classList.toggle("b-not-editable",!e),null===(t=r.globalTapListener)||void 0===t||t.call(r),null===(n=r.nonEditableClickTargetListener)||void 0===n||n.call(r),!1===e?(c.isMobile&&l&&(null==a||a.hide()),null==s||s.removeAttribute("aria-autocomplete"),o&&(r.nonEditableClickTargetListener=Jt.on({element:o,click:e=>{const t=o.getRootNode().elementFromPoint(e.clientX,e.clientY);e.originalTarget===o&&t===o&&r.onTriggerClick(e)},thisObj:r}))):(null==a||a.show(),null==s||s.setAttribute("aria-autocomplete","list"),r.globalTapListener=ir.ion({globaltap:"showKeyboard",thisObj:r}))}get nonEditableClickTarget(){return this.input}get pickerAlignElement(){const{_pickerAlignElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:W.getPath(this,e)}changePicker(e,t){const n=this;return ym.reconfigure(t,e?C.merge({id:n.id+"-picker",owner:n,forElement:n.pickerAlignElement,align:{matchSize:null==e.width,anchor:n.overlayAnchor,target:n.pickerAlignElement}},e):null,n)}updatePicker(e){const t=this;t.detachListeners("pickerField.picker"),e&&(e.ion({name:"pickerField.picker",thisObj:t,show:"onPickerShow",hide:"onPickerHide"}),Yn.setAttributes(t.ariaElement,{role:t.role,"aria-haspopup":e.ownersRole,"aria-controls":e.id,"aria-expanded":e.isVisible}))}updateRole(e){this.isConfiguring&&"textbox"!==e||this.ariaElement.setAttribute("role",e)}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.hidePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let n=!0;var r;if("keydown"===e.type&&!t.disabled&&!e.shiftKey&&!e.ctrlKey)if(t.pickerVisible){const{picker:r}=t;"Escape"===e.key?(e.preventDefault(),e.stopImmediatePropagation(),t.hidePicker(),n=!1):r.onInternalKeyDown?r.onInternalKeyDown(e):"ArrowDown"===e.key&&r.focusable&&r.focus()}else"ArrowDown"!==e.key||!t.picker||null!==(r=t.triggers)&&void 0!==r&&null!==(r=r.expand)&&void 0!==r&&r.keyMap||t.onTriggerKeyDown(e);n&&super.internalOnKeyEvent(e)}onFocusIn(e){var t;const n=this,r=null===(t=ir.currentPointerDown)||void 0===t?void 0:t.target;super.onFocusIn(e),!n.autoExpand||null!=r&&r.matches(".b-fieldtrigger")||(n.minChars=0,n.onTriggerClick(e))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}onTriggerKeyDown(e){!1!==this.trigger("triggerKey",{event:e})&&(e.stopImmediatePropagation(),e.preventDefault(),this.onTriggerClick(e))}showKeyboard({event:e}){const t=this.input;Yn.isTouchEvent&&Yn.getActiveElement(t)===t&&e.target===t&&(ir.suspendFocusEvents(),t.blur(),t.focus(),ir.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,{picker:n}=t;var r;n&&(n.show(),null===(r=t.ariaElement)||void 0===r||r.setAttribute("aria-expanded",!0),n.isVisible&&e&&t.focusPicker())}onPickerShow(){const e=this;e.pickerActiveDescendant&&e.ariaElement.setAttribute("aria-activedescendant",e.pickerActiveDescendant),e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=ir.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=Jt.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,t;const n=this,{ariaElement:r}=n;n.pickerActiveDescendant=null==r?void 0:r.getAttribute("aria-activedescendant"),null==r||r.removeAttribute("aria-activedescendant"),null==r||r.setAttribute("aria-expanded",!1),n.pickerVisible=!1,n.element.classList.remove("b-open"),n.trigger("togglePicker",{show:!1}),null===(e=n.pickerTapOutRemover)||void 0===e||e.call(n),null===(t=n.pickerKeyDownRemover)||void 0===t||t.call(n)}onPickerTapOut({event:e}){this.containsFocus||this.owns(e.target)||this.hidePicker()}onPickerKeyDown(e){if("Tab"===e.key&&!this.picker.trapFocus){const t=Yn.getActiveElement(this.input),n=new KeyboardEvent("keydown",e);this.input.dispatchEvent(n),n.defaultPrevented&&e.preventDefault(),Yn.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;Yn.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((()=>e.readOnly=!1),500)),super.focus()}}ym._$name="PickerField";class bm extends gm{static $name="ChipView";static type="chipview";static configurable={itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null};itemContentTpl(e,t){const n=this;return hh.tpl`${n.iconTpl?this.iconTpl(e):""}
            ${n.itemTpl(e,t)}
            ${n.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const t=this,{selected:n}=t,{generation:r}=n;t.closable&&n.count&&("Delete"===e.key||"Backspace"===e.key)?(t.closeHandler?t.callback(t.closeHandler,t.owner,[n.values,{isKeyEvent:!0}]):t.store.remove(n.values),n.generation!==r&&e.stopImmediatePropagation()):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.isConfiguring||this.refresh()}onClick(e){const t=this,n=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(n.dataset.index));t.closeHandler?t.callback(t.closeHandler,t.owner,[[e]]):t.store.remove(e)}else super.onClick(e)}}bm.initClass(),bm._$name="ChipView";const Cm="L{fieldRequired}",wm="L{validateFilter}",Sm=/[\w\s]/;class Dm extends ym{static $name="Combo";static type="combo";static alias="combobox,dropdown";static delayable={filterOnInput:0};static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",clearWhenInputEmpty:null,pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map((e=>e.value)),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:"L{Combo.noResults}",value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,clearTextOnSelection:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0,nonEditableFilterTimeout:200},localizeDisplayFields:!1,buildItems:null,sortItemsOnLocaleChange:!1,nonEditableFilterTimeout:2e3}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=null===e.valueField,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;W.hasOwn(e,"_value")||(e._value=e.nullValue,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e}=this,t=super.childItems;return e&&t.push(e),t}get innerElements(){var e;const t=null===(e=this._chipView)||void 0===e?void 0:e.element,{input:n,inputElement:r}=this;return t&&ud.sync({targetElement:n,domConfig:r}),[t||r]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return!e||e instanceof Il||(e=new Il(Il.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){null==t||t.destroy()}changeChipView(e,t){const n=this;if(n.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:r}=n;return n.chipStore||(n.chipStore={}),Em.reconfigure(t,e,{defaults:{parent:n,insertBefore:r,store:n.chipStore,closable:!n.readOnly,label:n.label,ariaLabel:n.ariaLabel,navigator:{type:"combochipnavigator",disabled:n.readOnly,keyEventTarget:r}}})}null==t||t.destroy()}updateChipView(e){var t;const n=this;n._chipViewEventDetacher=null===(t=n._chipViewEventDetacher)||void 0===t?void 0:t.call(n),n.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(n.input),n._chipViewEventDetacher=Jt.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:n}))}updateMultiSelect(e,t){const n=this,{input:r,element:i}=n,s=!n.isConfiguring;let{value:o}=n;if(i.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:e}=n,{parentNode:t}=r,a=null==e?void 0:e.element;a&&a!==t&&(t.insertBefore(a,r),a.appendChild(r),n.chipView.refresh(),i.classList.add("b-uses-chipview")),r.value="",s&&(o=nt.asArray(o))}else{const e=n._chipView,{parentNode:t}=r,l=null==e?void 0:e.element;var a;if(l===t&&(l.parentNode.insertBefore(r,l),l.remove(),i.classList.remove("b-uses-chipview")),s&&"string"!=typeof o)o=null!==(a=o)&&void 0!==a&&a.length?o[0]:null}s&&(n.value=o),n.isConfiguring||n.updateEditable(n.editable,null)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){this.filterOnInput.delay=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e,t){super.updateDisabled(e,t),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){return this._minChars??(this.remoteFilter?4:1)}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){var t;const n=this;if(null==e){if(n.store&&!n.store.isItemStore)return;e=[]}if(!n.buildItems||null!==(t=e)&&void 0!==t&&t.length||(e=n.buildItems()),e instanceof Il)return void(n.store=e);const r=!("valueField"in n.initialConfig),i=n.displayField;let s,o,a=n.valueField;Array.isArray(e)?o=e.map((e=>{let t=e;return e instanceof _s?(s=e.constructor,r&&!a&&(n.valueField=a=s.idField)):"string"==typeof e||"number"==typeof e?(r&&!a&&(n.valueField=a=n.displayField),t={[a]:e,[i]:e}):(r&&!a&&(n.valueField=a="value"),Array.isArray(e)&&(t={[a]:e[0],[i]:e[1]})),e.selected&&(n.value=t),t})):(r&&!a&&(n.valueField=a="value"),o=[],Object.entries(e).forEach((([e,t])=>{o.push({[a]:e,[i]:t})})));const l=a===i?{name:"value",dataSource:i}:a;if(!s){class e extends _s{static get idField(){return n.valueField}static set idField(e){super.idField=e}static get fields(){const e=[l,i];return n.localizeDisplayFields&&e.push("localeClass"),e}}s=e}n.store?n.store.setConfig({modelClass:s,data:o}):n.store=new Il({isItemStore:!0,data:o,idField:a,verifyNoGeneratedIds:!1,modelClass:s,useRawData:!1})}get value(){const e=this,{valueCollection:t,valueField:n}=e;if(null==n)return e.multiSelect?t.values.slice():t.first;let r;return r=e.multiSelect?t.count?t.map((e=>e[n])):e._unmatchedValue||[]:t.count?t.first[n]:e._unmatchedValue||e.nullValue,r}set value(e){super.value=e}get needsInputSync(){return!this.usesChipView&&!this.editable}changeValue(e,t){const n=this,{multiSelect:r}=n;if(n._unmatchedValue=null,e===t)return void n.syncInputFieldValue(!0);if(!r&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");var i;(n.triggerConfig("items"),n.inputting)||(null===(i=n._chipView)||void 0===i||i.selected.clear());n.store||(n.items=[]);const{valueField:s,displayField:o,nullValue:a,store:l,valueCollection:d,_picker:c}=n,{storage:u}=l,h=n.hidePickerOnSelect??!r,g=n._isUserAction||(null==c?void 0:c._isUserAction)||h&&n.pickerVisible||!1;if(e!=a&&null!=e){let r;if(!n.remoteFilter&&l.isAjaxStore&&!l.count)return l.ion({load:()=>n.value=e,once:!0,thisObj:n}),void(n._unmatchedValue=e);const i=Array.isArray(e),a=i?e.slice():[e];if(n.remoteFilter){if(W.isObject(e)||e.isModel)l.getById(e.id)?n.valueCollection.splice(0,n.valueCollection.count,l.getById(e.id)):(l.data=[e],n.valueCollection.splice(0,n.valueCollection.count,l.first));else{const t=n.isConfiguring;n.primaryFilter.setConfig({value:e,disabled:!1}),l.performRemoteFilter(!0).then((()=>{if(n.isDestroyed)return;const{isConfiguring:e}=n;n.isConfiguring=t,d.splice(0,d.count,l.allRecords),n.isConfiguring=e}))}return}l.isFiltered?(l.isChained&&l.fillFromMaster(),n.primaryFilter.disabled=!0,l.filter()):l.isChained&&l.fillFromMaster();for(let e=0,t=a.length;e<t;e++){let n=a[e];if(n instanceof _s)u.includes(n,!0)||l.add(n);else{const i=W.isObject(n);i&&s&&(n=n[l.modelClass.fieldMap[s].dataSource]),r=u.getBy(o,n)||u.getBy(s,n)||d.getBy(o,n)||d.getBy(s,n),r instanceof Set&&(r=[...r][0]),r?(i&&r.set(a[e]),a[e]=r):(a.splice(e,1),t--,e--)}}const c=!a.length,h=d.generation;d.splice(0,d.count,a),c&&(n._value=i&&0===e.length?null:e,n._unmatchedValue=n._value),(c||d.generation===h)&&n.syncInputFieldValue(),n.syncEmpty(),c&&!n.isConfiguring&&n.triggerFieldChange({value:e,oldValue:t,userAction:g,valid:n.isValid})}else if(d.count)d.clear();else{const t=n._value;n._value=null,n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||n.triggerFieldChange({value:e,oldValue:t,userAction:g,valid:n.isValid})}n.remoteFilter||(n._lastValue=n._value)}hasChanged(e,t){return this.multiSelect?!W.isEqual(e,t):super.hasChanged(...arguments)}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){var t;this.usesChipView?null===(t=this.chipView)||void 0===t||t.refresh():super.syncInputFieldValue(e)}get usesChipView(){return Boolean(this.multiSelect&&this._chipView)}get isEmpty(){return 0===this.valueCollection.count&&!this._unmatchedValue}get inputValue(){const e=this;let t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}get nonEditableClickTarget(){var e;return this.multiSelect&&(null===(e=this.chipView)||void 0===e?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,t){if(null==t||t.destroy(),e)return e.isCollection||(e=new ho({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):("function"==typeof e&&(e={filterBy:e}),e=new Js({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...e})),e}changeStore(e){const t=this,n=[],{valueCollection:r,keyStrokeFilterDelay:i,filterParamName:s}=t;if(Array.isArray(e))return void(t.items=e);let o;if(e){if(e.isStore){const r=e.filters.get("primary");t.remoteFilter&&(e.filterParamName=s),o=e.remoteFilter,r?t.primaryFilter=r:n.push(t.primaryFilter)}else"string"==typeof e?e=Il.getStore(e):(e=new(e.readUrl?$l:Il)(e),t.destroyStore=!0),o=t.remoteFilter||e.restfulFilter,o&&s&&(e.filterParamName=s,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),n.push(t.primaryFilter);if(t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),t.filterSelected){const i=e=>!t.containsFocus||!r.includes(e);o?(e.storage.autoFilter=!0,e.storage.addFilter({id:`${t.id}-selected-filter`,filterBy:i})):(n.push(i),e.reapplyFilterOnAdd=!0)}r.addIndex({property:t.displayField,unique:!1}),r.addIndex({property:t.valueField,unique:!0}),n.forEach((t=>e.addFilter(t,!0))),t.keyStrokeFilterDelay=o?Math.max(300,i||0):i??10}return t.valueField!==t.displayField||t.peekConfig("multiSelect")||(t.nullValue=""),e}updateStore(e,t){const n=this,{_picker:r}=n;let i;n.destroyStore&&t&&t.destroy(),r&&(r.store=e),e.storage.addIndex({property:n.displayField,unique:!1}),e.storage.addIndex({property:n.valueField,unique:!0}),i={filter:"onStoreFilter"},n.displayValueRenderer&&((i||(i={})).change="onComboStoreChange"),n.detachListeners("store"),(null==e?void 0:e.storage)&&n.valueCollection.match(e.storage),n.syncInputFieldValue(),i&&(i.name="store",i.thisObj=n,e.ion(i))}get remoteFilter(){var e;return Boolean(this.filterParamName||(null===(e=this._store)||void 0===e?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort(((t,n)=>e.indexOf(t)-e.indexOf(n)))[0]:this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(wm),e.syncInputFieldValue()),e.required&&!t&&e.setError(Cm)}onTriggerClick(e){const t=this,n="key"in e;if(!t.remoteFilter||!t.filterOnEnter)if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled){var r;switch(null===(r=t.triggerAction)||void 0===r?void 0:r.toLowerCase()){case"all":t.doFilter(null,n);break;case"last":t.doFilter(t.lastQuery,n);break;default:t.doFilter(t.input.value,n)}}}internalOnInput(e){const t=this;t.clearWhenInputEmpty&&""===t.input.value&&t.clear(),t.syncEmpty(),t.syncInputWidth(),t.filterOnInput(e),t.trigger("input",{value:t.input.value,event:e})}filterOnInput(e){const t=this,{value:n}="input"===e.type?e.target:t.input,r=n.length;t.inputting=!0,t.inlinePicker||r>=t.minChars&&(!t.filterOnEnter||"Enter"===e.key)?t.doFilter(n):(t.validateFilter&&!t.remoteFilter&&t[r?"setError":"clearError"](wm),t.hidePicker()),t.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const t=e.input,n=e._inputPadding||(e._inputPadding=Yn.getEdgeSize(t,"padding","lr")),r=t.value||"",i=Yn.measureText(r+"W",t,!1,e.element)+n.width;t.style.flex=`1 1 ${Math.ceil(i)}px`}}doFilter(e,t){var n;const r=this,{store:i,picker:s}=r,o=null==e||""===e;r.lastQuery=e,r.primaryFilter.setConfig({value:e,disabled:o}),r.remoteFilter&&i.clear(!0);const a=()=>{const{navigator:e,isVisible:t}=s;i.count?!o&&e&&(e.activeItem=0):r.remoteFilter||o||(e&&(e.activeItem=null),r.editable&&r.validateFilter&&r.setError(wm)),t&&s.realign()};null===(n=r.filterPromise=i.filter())||void 0===n||n.then((()=>{r.filterPromise=null,a()})),r.inlinePicker||(null!=s&&s.isVisible?0===s.lastAlignSpec.zone&&s.realign():r.showPicker(t)),r.filterPromise||a()}onStoreFilter({source:e}){const t=this,n=t._picker,r=null==n?void 0:n.element.dataset,{count:i}=e;t.remoteFilter&&(i?n&&(n.navigator.activeItem=0):t.validateFilter&&t.setError(wm),t.filterSelected&&t.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),n&&n.refresh())),r&&(t.createOnUnmatched&&!i&&null!=t.primaryFilter.value?r.addNewValue=t.L("L{addNewValue}")(t.primaryFilter.value):null==r||delete r.addNewValue)}onValueCollectionChange({source:e}){const t=this,{multiSelect:n,_picker:r,nullValue:i}=t,s=t.hidePickerOnSelect??!n,o=n?e.values.slice():e.first,a=e.values.slice(),l=t._isUserAction||(null==r?void 0:r._isUserAction)||s&&t.pickerVisible||!1,d=t._value;if(s&&t.hidePicker(),n&&t.clearTextOnSelection&&(t.input.value=""),!e.count&&t.required?t.setError(Cm):(t.clearError(Cm),t.clearError(wm)),t.validateFilter&&o&&t.clearError(wm),t.filterSelected){var c;const e=null==r?void 0:r.navigator,n=Number(null==e||null===(c=e.activeItem)||void 0===c||null===(c=c.dataset)||void 0===c?void 0:c.index);t.remoteFilter?(t.store.storage.onFiltersChanged({action:"splice",oldCount:1}),t._picker&&t._picker.refresh()):t.store.filter(),isNaN(n)||(e.activeItem=Math.min(r.store.count,n))}t._value=i,t._lastValue=i;const u=t.cacheCurrentValue(t.value);var h;(t.syncInputFieldValue(),t.syncEmpty(),t.isConfiguring)||(u===d||t.onConfigChange.$nullFn||t.onConfigChange({name:"value",value:u,was:d,config:t.$meta.configs.value}),t.triggerFieldChange({value:u,oldValue:d,userAction:l,valid:t.isValid}),null===(h=t.trigger)||void 0===h||h.call(t,"select",{record:o,records:a,userAction:l}),"select"===t.defaultAction&&t.trigger("action",{value:u,record:o,records:a,userAction:l}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&(this.picker.hide(),this.syncInputFieldValue())}showPicker(){const e=this,{picker:t}=e;if(!e.readOnly&&!e.inlinePicker){var n;if(t.multiSelect=e.multiSelect,super.showPicker(...arguments),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),t.restoreActiveItem)if(e.multiSelect)t.restoreActiveItem((null===(n=t.navigator)||void 0===n?void 0:n.previousActiveItem)||e.selected||0,!0);else t.restoreActiveItem(e.selected||0,!0);e.input.focus()}}changePicker(e,t){if(e){var n;const r=this,i=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width),s=gm.mergeConfigs({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,displayField:r.displayField,forElement:r.pickerAlignElement,emptyText:r.emptyText,align:{matchSize:null==i&&"min",anchor:r.overlayAnchor,target:r.pickerAlignElement,minHeight:r.inlinePicker?null:40*Math.min(3,r.store.count)},[r.listItemTpl?"itemTpl":void 0]:r.listItemTpl,width:i,navigator:{keyEventTarget:r.input,activateOnMouseover:!r.inlinePicker}},e);r.inlinePicker&&Object.assign(s,{floating:!1,align:null,maxHeight:null,appendTo:r.element}),(e=gm.reconfigure(t,e?s:null,r)).element.classList.add("b-combo-picker"),e.ion({navigate:"onPickerNavigate",thisObj:r}),Jt.on({element:e.element,pointerdown:e=>r.onPickerNavigate({event:e}),thisObj:r})}else null==t||t.destroy();return e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&!e.errors&&(e.input.value="")}async internalOnKeyEvent(e){const t=this,n=t.input[t.inputValueAttr],r=n.length,{key:i,type:s}=e,{primaryFilter:o,store:a,multiSelect:l,minChars:d,_picker:c,_chipView:u}=t;let h;if("keydown"===s&&null!=c&&c.isVisible&&c.navigator){const{activeItem:r}=c.navigator;if(r&&l&&i===t.multiValueSeparator)return t.input.value="",c.onItemClick(r,e),o.setConfig({value:"",disabled:!0}),a.filter(),c.hide(),void e.preventDefault();if(!r&&t.createOnUnmatched&&(l&&i===t.multiValueSeparator||"Enter"===i))return e.preventDefault(),void await t.addNewRecord(n)}var g;t.editable?!u||u.selected.count||"keydown"!==s||"Backspace"!==i||r||(u.navigator.activeItem=t.valueCollection.count-1,e.stopImmediatePropagation()):"keydown"===s&&"Backspace"===i&&null!==(g=t.nonEditableFilterValue)&&void 0!==g&&g.length?(t.nonEditableFilterValue=t.nonEditableFilterValue.substring(0,t.nonEditableFilterValue.length-1),t.doFilter(t.nonEditableFilterValue),t.lastFilterKeypressTime=e.timeStamp):"keypress"===s&&1===i.length&&i.match(Sm)&&((!t.lastFilterKeypressTime||e.timeStamp-t.lastFilterKeypressTime>t.nonEditableFilterTimeout)&&(t.nonEditableFilterValue=""),t.nonEditableFilterValue=(t.nonEditableFilterValue||"")+i,t.doFilter(t.nonEditableFilterValue),t.lastFilterKeypressTime=e.timeStamp);t.pickerVisible&&"Enter"===i&&t.primaryFilter.value===t.input.value&&(h=!0),super.internalOnKeyEvent(...arguments),"keydown"===e.type&&"Enter"===i&&!h&&t.remoteFilter&&(r>=d?(e.stopPropagation(),t.filterOnInput.now(e)):r>0&&(e.stopPropagation(),t.setError(`L{Field.tooShort} (${d})`,!1,!0)))}async addNewRecord(e){const t=this,{store:n,_picker:r,valueCollection:i,multiSelect:s,primaryFilter:o}=t,a=n.remoteFilter&&n.autoCommit;t.filterPromise&&await t.filterPromise,a||(o.setConfig({value:"",disabled:!0}),n.filter()),t._isUserAction=!0;const[l]=n.add(t.callback(t.createOnUnmatched,t,[e,t]));if(n.isCommitting){let e;try{await n.autoCommitTimeoutPromise,await n.commitPromise}catch(t){var d;e=null===(d=t.response)||void 0===d||null===(d=d.parsedJson)||void 0===d?void 0:d.error}l.isPhantom&&(t.clearError(),t.setError(e||"L{recordNotCommitted}",!1,!0),n.remove(l),n.removed.remove(l))}a&&(o.setConfig({value:"",disabled:!0}),n.filter()),t.input.value="",n.includes(l)&&i.splice(s?i.count:0,s?0:i.count,l),null==r||r.hide(),t._isUserAction=!1}changeCreateOnUnmatched(e){return!0===e&&(e=this.defaultRecordCreator),e}defaultRecordCreator(e){return this.store.createRecord({[this.displayField]:e})}updateLocalizeDisplayFields(e){e?this.localizableProperties.push("store"):nt.remove(this.localizableProperties,"store")}localizeProperty(e){return"store"===e?this.localizeStore():super.localizeProperty(e)}localizeStore(){const e=this,{displayField:t}=e;let{localizedDisplayFieldsMap:n}=e;n||(e.localizedDisplayFieldsMap=n=new Map),!e.store&&e.buildItems&&(e.items=e.buildItems());for(const i of e.items)if(i.id){var r;let s=n.get(i.id);!s&&null!==(r=i[t])&&void 0!==r&&r.startsWith("L{")&&(s=i[t],n.set(i.id,s)),s&&(i[t]=(i.localeClass||e).L(s))}e.sortItemsOnLocaleChange&&e.store.sort(),e.syncInputFieldValue()}createOverflowTwin(e){return super.createOverflowTwin({store:this.store,...e})}}class Em extends bm{static $name="ComboChipView";static type="combochipview";static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return N.encodeHtml(e.getValue(this.owner.displayField))},scrollable:{overflowY:"auto"}}}}Dm.initClass(),Em.initClass(),class extends qh{static $name="ComboChipNavigator";static type="combochipnavigator";static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const t=this,n=e.target.closest(t.itemSelector);n&&!e.target.classList.contains("b-close-icon")&&(e.shiftKey||n.contains(e.target.closest("[data-noselect]"))||t.ownerCmp.selected.clear(),t.inClickHandler=!0,t.activeItem=n,t.inClickHandler=!1)}onKeyDown(e){"Enter"===e.key||e.target.selectionStart||e.target.selectionEnd||super.onKeyDown(e)}updateActiveItem(e,t){const n=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&n.selected.add(n.getRecordFromElement(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}.initClass(),Dm._$name="Combo";class xm extends Dm{static $name="BooleanCombo";static type="booleancombo";static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const n=this;return super.changeStore(new Il({data:[{id:n.positiveValue,text:n.positiveText||n.L("L{Object.Yes}")},{id:n.negativeValue,text:n.negativeText||n.L("L{Object.No}")}]}),t)}}xm.initClass(),xm._$name="BooleanCombo";const Rm=({$toggleOrder:e},{$toggleOrder:t})=>(t||0)-(e||0),Tm={click:"resetValueCache",beforeToggle:"onItemBeforeToggle",toggle:"onItemToggle"};class Mm extends(Dc.mixin(Vc,im)){static $name="ButtonGroup";static type="buttongroup";static configurable={defaultType:"button",cls:null,items:null,color:null,useGap:!1,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value",errorTooltipCachePath:"buttonGroupErrorTooltip",errorTooltipConfig:{forSelector:".b-buttongroup.b-invalid"},overflowable:!0,toggleable:null};afterConstruct(){super.afterConstruct(),this.ion({change:"internalOnChange"})}get inputWrap(){return this.element}get isValid(){let e=super.isValid;const t=this,{toggleable:n}=t;return t.clearError("L{Field.fieldRequired}",!0),e&&!t.disabled&&(t.required&&!t.value||n&&t.pressed.length<n[0])&&(e=!1,t.setError("L{Field.fieldRequired}",!0)),t.checkValidity&&!1===t.callback(t.checkValidity,t,[t])&&(e=!1),e&&t.errors&&Object.keys(t.errors).length&&(e=!1),e}get pressed(){return this.items.filter((e=>e.pressed)).sort(Rm)}internalOnChange(){this.syncInvalid()}onChildAdd(e){super.onChildAdd(e),e.ion({thisObj:this,...Tm,prio:1e4})}onChildRemove(e){e.un({thisObj:this,...Tm}),super.onChildRemove(e)}onItemBeforeToggle({pressed:e}){const{toggleable:t}=this;return e||!t||this.pressed.length>t[0]}onItemToggle(e){const t=this,n=(t.toggleCount||0)+1,{toggleable:r}=t;t.resetValueCache(),t.isSettingValue||t.toggleGroup&&!e.pressed||(r&&(e.source.$toggleOrder=n,t.toggleCount=n,t.isSettingValue=!0,t.pressed.slice(r[1]).forEach((e=>e.pressed=!1)),t.isSettingValue=!1),t.triggerFieldChange({value:t.value,userAction:!0,event:e}))}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),!e.toggleGroup&&t.toggleGroup&&(e.toggleGroup=t.toggleGroup),t.toggleable&&(e.toggleable=!0)),t.columns&&(e.width=100/t.columns+"%"),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}changeToggleable(e){return!0===e?e=[0,1/0]:"number"==typeof e&&(e=[1,e]),e||null}updateToggleable(e){e&&!this.isConstructing&&this.pressed.slice(e[1]).forEach((e=>e.pressed=!1))}changeToggleGroup(e,t){return!0===e?t||Mm.generateId("toggleGroup"):e}updateRotate(e){this.eachWidget((t=>{!1!==t.rotate&&(t.rotate=e)}))}get valueAsArray(){const e=[];return this.items.forEach((t=>{t.pressed&&void 0!==t.value&&e.push(t.value)})),e}get value(){const e=this;return e._value||(e._value=e.valueAsArray.join(e.valueSeparator)),e._value}set value(e){const t=this,n=t.value;null==e?e=[]:"string"==typeof e?e=e.split(t.valueSeparator):Array.isArray(e)||(e=[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach((t=>{void 0!==t.value&&(t.pressed=e.includes(t.value))})),t.isSettingValue=!1,t.isConfiguring||n===t.value||t.triggerFieldChange({value:t.value,userAction:Boolean(t._isUserAction)})}get validity(){return{}}onDisabled(e){this.syncInvalid(),this.items.forEach((t=>t.disabled=e||!t.ignoreParentReadOnly&&this.readOnly))}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}addToOverflowMenu(e,t,n){const{toggleable:r,toggleGroup:i}=this;(i||1===(null==r?void 0:r[0])&&1===r[1])&&(t={...t,radio:!0}),this.items.forEach((r=>r.addToOverflowMenu(e,t,n)))}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}updateUseGap(e){e||this.element.classList.add("b-no-gap")}}Mm.initClass(),Mm._$name="ButtonGroup";const km={0:1,6:1};class Fm extends Xu{static $name="CalendarPanel";static type="calendarpanel";static get configurable(){return{layout:"vbox",textContent:!1,date:{$config:"date"},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,disableNonWorkingDays:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onInternalPaint({firstPaint:e}){var t;null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;null===(e=this.tip)||void 0===e||e.destroy(),super.doDestroy()}updateMinRowHeight(e){this.element.style.setProperty("--min-row-height",Yn.setLength(e)),this.scrollable={overflowY:!!e&&"auto"}}updateMinColumnWidth(e){this.element.style.setProperty("--min-column-width",Yn.setLength(e)),this.scrollable={overflowX:!!e&&"auto"},this.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return xi.parseKey(t.dataset.date)}changeTip(e,t){const n=this;return tm.reconfigure(t,e,{owner:n,defaults:{type:"tooltip",owner:n,id:`${n.id}-cell-tip`,forElement:n.bodyElement,forSelector:`.${n.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),null==e||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const n=this;super.updateElement(e,t),n.updateHideNonWorkingDays(n.hideNonWorkingDays),n.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),n.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),n.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),n.cellElements=[];for(let e=0,{length:t}=n.weekDayElements;e<t;e++)n.cellElements.push(n.weekDayElements[e].previousSibling,...n.weekDayElements[e].children)}changeDate(e){if(e="string"==typeof e?xi.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return xi.clearTime(e)}updateDate(e){this.month.date=e,this.element.dataset.month=xi.format(e,"YYYY-MM")}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(xi.format(e,this.dayNameFormat))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:xi.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),null===(t=this.scrollable)||void 0===t||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=xi.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=xi.weekends)}changeNonWorkingDays(e){return W.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return xi.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return xi.add(e,1,"day")}changeMonth(e,t){const n=this;if(!(e instanceof kg)){if("number"==typeof e){if(t)return void(t.month=e);const r=n.date||xi.clearTime(new Date);r.setMonth(e),e={date:r}}e=kg.new({weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:n}),e}onMonthDateChange({source:e,newDate:t,oldDate:n,changes:r}){const i=this;if(i.year=e.year,!i.isConfiguring){if(!i.getCell(t)||r.m||r.y){const{isVisible:e}=i;i.refresh(),i.animateTimeShift&&e&&Yn.slideIn(i.contentElement,t>n?1:-1)}i.trigger("dateChange",{changes:r,value:t,oldValue:n})}}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.doRefresh()}doRefresh(){var e;this.getConfig("element");const t=this,n=null!=t.timeZone?t.timeZone:null===(e=t.project)||void 0===e?void 0:e.timeZone,r=null!=n?Sh.toTimeZone(new Date,n):new Date,{weekElements:i,weekDayElements:s,date:o,month:a,dayCellCls:l,dayHeaderCls:d,disabledCls:c,otherMonthCls:u,weekendCls:h,todayCls:g,nonWorkingDayCls:m,nonWorkingDays:p,canonicalDayNumbers:f,sixWeeks:v}=t;if(r.setHours(0,0,0,0),!o)return void(t.date=r);t.element.style.setProperty("--visible-week-count",a.weekCount),t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(let e=0;e<7;e++){const n=t.weekdayCells[e],r=t.canonicalDayNumbers[e],i={[d]:1,[h]:km[r],[m]:p[r]};if(t.headerRenderer){n.innerHTML="";const i=t.callback(t.headerRenderer,t,[n,e,r]);i&&("string"==typeof i?Yn.setInnerText(n,i):Yn.createElement({...i,parent:n}))}else Yn.setInnerText(n,t.shortDayNames[r]);Yn.syncClassList(n,i),n.dataset.columnIndex=e,n.dataset.cellDay=r}let y=0,b=0,C=6;for(let e=6;e>=0;e--)if(!p[f[e]]){C=e;break}i[4].classList.toggle("b-hide-display",a.weekCount<5&&!v),i[5].classList.toggle("b-hide-display",a.weekCount<6&&!v),a.eachWeek(((e,n)=>{const o=s[y],d=[o.previousSibling,...o.children],f=d[0];if(i[y].dataset.week=`${e[0]},${e[1]}`,i[y].setAttribute("aria-label",`${t.L("L{Week}")} ${e[1]}, ${e[0]}`),""===f.innerHTML&&(f.innerText=e[1]),t.weekRenderer){const n=t.callback(t.weekRenderer,t,[f,e]);n&&("string"==typeof n?Yn.setInnerText(f,n):(f.innerHTML="",Yn.createElement({...n,parent:f})))}else f.innerText=e[1];for(let s=0;s<7;s++){const o=n[s],f=o.getDay(),v=xi.makeKey(o),w=p[f],S=d[s+1],D={[l]:1,[c]:t.isDisabledDate(o),[u]:o.getMonth()!==a.month,[h]:km[f],[g]:o.getTime()===r.getTime(),[m]:w,"b-last-working-day":s===C,"b-first-visible-cell":!(o-(t.firstVisibleDate||-1)),"b-last-visible-cell":!(o-(t.lastVisibleDate||-1)),[`b-day-of-week-${f}`]:1};Yn.syncClassList(S,D),S.role="gridcell",S.dataset.date=v,S.dataset.cellIndex=b,S.dataset.columnIndex=s,S.lastDomConfig&&(delete S.lastDomConfig.class,delete S.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:S,date:o,day:f,rowIndex:y,cellIndex:b,columnIndex:s,key:v,week:e,row:i[y],source:t,visibleColumnIndex:t.visibleDayColumnIndex[f]}]):S.innerHTML=o.getDate(),b++}y++})),t.visibleWeekCount=y,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}isDisabledDate(e){const t=this,n=e.getDay(),{disabledDates:r}=t;return!(!t.disableWeekends||!km[n])||(!(!t.disableNonWorkingDays||!t.nonWorkingDays[n])||(r?Array.isArray(r)?(e=xi.clearTime(e,!0),r.some((t=>(t="string"==typeof t?xi.parse(t):t,!(xi.clearTime(t,!0)-e))))):t.callback(r,t,[e]):void 0))}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays","aria-hidden":!0,reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...nt.fill(7,{class:this.dayHeaderCls}),Yn.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t,role:"grid"}];for(let e=0;e<6;e++){const n={role:"row",className:"b-calendar-row b-calendar-week",dataset:{rowIndex:e},children:[{className:"b-week-number-cell",role:"rowheader"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(n)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=xi.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,n=e;;n.setDate(n.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[n.getDay()])return n}getCell(e,t){"string"!=typeof e&&(e=xi.makeKey(e));const n=this.weeksElement.querySelector(`[data-date="${e}"]`);if(n&&(!t||!n.classList.contains(this.otherMonthCls)))return n}onTipOverCell({source:e,target:t}){e.date=xi.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}Fm.initClass(),Fm._$name="CalendarPanel";const{abs:Im,ceil:Am,floor:Lm,max:Pm,min:Om}=Math,$m="b-carousel-item",_m=[0,0],Hm=Symbol("carouselIndex"),Vm=Symbol("carouselSyncGen"),Nm="b-carousel-reserve",Bm=`${Nm}-before`,zm=`${Nm}-after`,jm=(e,t)=>e[Hm]-t[Hm],Wm="b-carousel-visible",Um=["x","y"],Gm=["y","x"],Ym={h:{minSize:"minWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",size:"width",vxy:["vx","vy"],xy:Um},v:{minSize:"minHeight",offsetSize:"offsetHeight",size:"height",vxy:["vy","vx"],xy:Gm}};Ym.h.other=Ym.v,Ym.v.other=Ym.h;class qm extends(Xu.mixin($h,Yh)){static $name="Carousel";static type="carousel";static configurable={atMax:null,atMin:null,configureSlot:(e,t,n)=>({}),disableReserveSlots:null,empty:null,emptyHtml:null,emptyText:"No items to display",firstVisibleSlot:null,lastVisibleSlot:null,range:[null,null],reserveSlots:1,scrollOnTab:null,shrinkWrap:"auto",slots:null,snap:!0,vertical:null};static delayable={triggerSlotVisibility:"raf"};static fenced={resync:!0};compose(){const{carouselClasses:e}=this;return{class:{...e}}}afterFloatReparent(){this.syncSoon()}get allSlots(){return this.ensureItems().values.filter((e=>e.innerItem)).sort(jm)}get bodyConfig(){const{carouselClasses:e,emptyHtml:t,emptyText:n}=this,r=super.bodyConfig;return W.merge(r,{className:{"b-vbox":1,...e},children:{innerCt:{class:{"b-carousel-inner-ct":1,"b-box-center":1}},emptyElement:{class:{"b-carousel-empty-text":1,"b-box-center":1},html:t||N.xss`${n}`}}})}get carouselClasses(){const{empty:e,vertical:t}=this;return{"b-carousel-empty":e,"b-carousel-vertical":t}}get contentElement(){return this.innerCt}get currentIndex(){return this.indexFromPos(this.scrollPos)}set currentIndex(e){this.goto(e)}get focusedSlot(){const{innerCt:e}=this;let t,n,r=null;for(t=Yn.getActiveElement();t;t=n)if(n=t.parentElement,n===e){r=oc.fromElement(t);break}return r}get infinityScrollerDefaults(){const e=this,[t,n]=e.vertical?Gm:Um;return W.merge(super.infinityScrollerDefaults,{snap:e.snap&&t,[t]:{overflow:"hidden-scroll",range:e.scrollRange,pos:0},[n]:{overflow:"hidden"}})}get propNames(){return Ym[this.vertical?"v":"h"]}get scrollAxis(){return this.infinityScroller[this.vertical?"y":"x"]}get scrolling(){return this.infinityScroller.scrolling}get scrollPos(){return this.scrollAxis.pos}set scrollPos(e){this.scrollAxis.pos=e}get scrollRange(){const{range:e,slotSize:t}=this;return t?[e[0]*t,e[1]*t]:[0,1/0]}get shrinkWrap(){const e=this._shrinkWrap;return"auto"===e?"absolute"===Yn.getStyleValue(this.element,"position"):e}get lastVisibleIndex(){var e;return null===(e=this.lastVisibleSlot)||void 0===e?void 0:e[Hm]}get visibleSlots(){return this.allSlots.filter((e=>e.element.classList.contains(Wm)))}updateAtMax(e){this.element.classList.toggle("b-carousel-at-max",e)}updateAtMin(e){this.element.classList.toggle("b-carousel-at-min",e)}changeConfigureSlot(e){if("string"==typeof e){const t=`_${e}Fn`;return this[t]||(this[t]=(...t)=>this[e](...t))}return e}triggerSlotVisibility(){const{firstVisibleSlot:e,lastVisibleSlot:t}=this;this.trigger("slotVisibility",{firstVisibleSlot:e,lastVisibleSlot:t})}updateFirstVisibleSlot(e){this.triggerSlotVisibility()}updateLastVisibleSlot(){this.triggerSlotVisibility()}changeRange(e){if((e=e?[e[0]??-1/0,e[1]??1/0]:[0,0])[0]!==e[1]){let t;if(e[1]<e[0]&&(t="denormalized"),t)throw new Error(`Invalid carousel range [${e[0]}, ${e[1]}): ${t}`)}return e}updateRange(e){this.empty=!(e[0]<e[1]),this.syncSoon()}updateShrinkWrap(){this.isPainted&&this.syncSoon()}updateVertical(){this.isPainted&&this.syncSoon()}convertIndexPos(e,t){const n=this,{allSlots:r,propNames:i}=n,[s,o]=n.range,a=Math.floor((s+o)/2),l=r.length,d=r[l-1],c=i.vxy[0],u=s<=0&&0<o;if(!(t||s<=e&&e<o))return null;let h,g,m,p,f,v,y,b,C=n.slotSize||100;if(l){for(b of(C=0,r)){if(m=b[Hm],h=b[c],C=C||b.$vxy[i.size],b===r[0]&&(p=m,y=h,e<(t?h:m)))break;if(t){if(e===h)return m;if(e<h)return m-1}else if(e===m)return h;if(b===d){if(g=h+b.$vxy[i.size],t&&e<g)return m;f=m+1,v=g}}C=C||n.slotSize||100}else{if(t&&0<=e&&e<C)return u?0:a;y=0,v=C,p=u?0:a,f=p+1}return t?e<y?Pm(p-Am((y-e)/C),s):Om(f+Lm((e-v)/C),o):e<p?y-(p-e)*C:v+(e-f)*C}ensurePlan(e){return e}ensureVisible(e){const t=this;if(null==t.lastScrollPos)t._afterSync=()=>t.ensureVisible({...e,animate:!1});else{if(!t.scrolling||!t.hasPainted){const{index:n,animate:r}=t.ensurePlan(e),{currentIndex:i,lastVisibleIndex:s}=t;let o;return n<i?o=n-i:s<n&&(o=n-s),o&&t.go(o,r)}t._afterScroll=()=>t.ensureVisible(e)}}getSlotIndex(e){return null==e?void 0:e[Hm]}indexFromPos(e){return this.convertIndexPos(e,!0)}posFromIndex(e){return this.convertIndexPos(e,!1)}slotFromIndex(e){for(const t of this.allSlots)if(t[Hm]===e)return t;return null}backward(e){return this.go(-1,e)}forward(e){return this.go(1,e)}go(e,t){return this.goto(this.currentIndex+e,t)}goto(e,t){const n=this;if(null==n.lastScrollPos)n._afterSync=()=>{const{scrollPos:t}=n;n.goto(e,!1),n.hasPainted||t===n.scrollPos||n.sync()};else{if(!n.scrolling||!n.hasPainted){const{range:r,slots:i}=n,s=r[1]-("number"==typeof i?i-1:0),o=Om(s-1,Pm(r[0],e)),a=Im(n.currentIndex-o),l=n.posFromIndex(o);return a>=n.allSlots.length&&(t=!1),n.scrollTo({animate:t,[n.scrollAxis.name]:l})}n._afterScroll=()=>n.goto(e,t)}}onChildAdd(e){return e.innerItem&&e.element.classList.add($m),super.onChildAdd(e)}onChildRemove(e){return e.innerItem&&e.element.classList.remove($m),super.onChildRemove(e)}onInfiniteScrollEnd(e){super.onInfiniteScrollEnd(e);const{_afterScroll:t}=this;this._afterScroll=null,null==t||t()}onSlotFocusTrap({source:e,top:t}){const n=this,r=t?-1:1,i=e[Hm],s=n.slotFromIndex(i+r);return s.element.classList.contains(Nm)?n.scrollOnTab&&n.go(r).then((e=>{var t;e&&(null===(t=s.element)||void 0===t||t.focus())})):s.element.focus(),!1}resync(){this.sync()}sync(){if(this.syncCount=(this.syncCount||0)+1,!this.empty){var e;const t=this,{allSlots:n,disableReserveSlots:r,innerCt:i,scrollAxis:s,propNames:o,reserveSlots:a,scrolling:l,slots:d}=t,[c,u]=t.range,h=s.pos,g=oc.resolveType((null===(e=t.defaults)||void 0===e?void 0:e.type)||t.defaultType),m=t.indexFromPos(h),p=t.posFromIndex(m),f=h-p,v=[a,a],y=t.syncGen=(t.syncGen||0)+1;l&&h>(t.lastScrollPos||0)&&f&&(--v[0],++v[1]),t.lastScrollPos=h,i.style.setProperty("--carousel-item-offset",`${Math.abs(f)}px`),t.shrinkWrapped||(i.style[o.minSize]="");let b,C,w,S,D=i[o.offsetSize],E=!1,x=!1,R=null,T=null;t.unanimated((()=>{const{_afterSync:e}=t,a=d&&"auto"!==d?t.syncFixed(m,o,n,g,v,d,c,u):t.syncDynamic(m,o,n,g,v,d,D,c,u),p=[],f=n.filter((e=>e[Vm]!==y));for(S of(f.length&&(f.forEach((e=>t.detachListeners(`${e.id}-listeners`))),t.remove(f)),i.style[o.other.minSize]=`${a[o.other.size]}px`,D=i[o.offsetSize],n))if(!f.includes(S)){const e=s.getItemSpan(S),t=h+D,n=e[1]<=h,r=t<=e[0],i=!n&&!r,o=i&&e[0]<=h,a=i&&e[1]>=t;i&&(S[Hm]===c&&(x=!0),S[Hm]===u-1&&(E=!0)),o&&(R=S),a&&(T=S),p.push([S,S.element.classList,{[Nm]:n||r,[Bm]:n,"b-carousel-first":o,[Wm]:i,"b-carousel-last":a,[zm]:r}])}for([S,b,w]of p)for(C in r&&(S.disabled=!w[Wm]&&r),w)b.toggle(C,w[C]);t.atMax=E,t.atMin=x,t.firstVisibleSlot=R,t.lastVisibleSlot=T,s.other.range=_m,t.syncDomOrder(f.length?t.allSlots:n),!l&&t.scrollable.fixPositionSync(),s.sync({range:t.scrollRange}),s.pos!==h?t.resync():e&&(t._afterSync=null,e())}))}}syncDomOrder(e){var t;const n=Yn.getActiveElement();let r,i,s;for(s=e.length;s-- >1;)i=e[s].element,r||i.classList.add("b-last-visible-child"),r=e[s-1].element,r.classList.remove("b-last-visible-child"),i.classList.remove("b-first-visible-child"),r.nextSibling!==i&&r.parentElement.insertBefore(r,i);null===(t=r)||void 0===t||t.classList.add("b-first-visible-child"),this.element.contains(n)&&n!==Yn.getActiveElement()&&n.focus()}syncDynamic(e,t,n,r,i,s,o,a,l){const d=this,{offsetSize:c}=t,u="auto"===s,h=u?"":null;let g,m,p,[f,v]=i,y=1,b=0;for(p=e;a<=p&&p<l;p+=y){if(m=d.syncSlot(n,r,p,h),g=g||m,b<o){if(b+=m.element[c],u)return d.syncFixed(e,t,n,r,i,Am(o/b));if(y>0){if(p+1<l&&(b<o||v))continue;f+=v,v=0}}if(--v<1){if(y<0||!f)break;y=-1,p=e,v=f}}return g}syncFixed(e,t,n,r,i,s,o,a){const l=this,{shrinkWrap:d,shrinkWrapped:c}=l,u=100/s+"%",h=e+s;let g,m,p,f,v,y=e-i[0],b=h+i[1],C=0;for(;b>a;)--y,--b;for(;y<o;)++y,++b;for(v=y;v<b;++v)m=l.syncSlot(n,r,v,d&&!c?"":u),v===e&&(g=m),d?(p||(p=[])).push(m):m[t.size]=u;if(d){for(f=Om(h,b-i[1]),v=f-s;v<f;++v)C+=p[v-y][t.size];for(m of p)m[t.size]=u;C&&(l.innerCt.style[t.minSize]=`${C}px`,l.shrinkWrapped=!0)}return g}syncSlot(e,t,n,r){const i=this,{propNames:s,syncGen:o}=i,a=null!==r;let l,d,c,u,h,g=null;for(u of e)if(u[Vm]!==o){if(d=u[Hm],d===n){c=u,a&&(c[s.size]=r);break}(!g||d>g[Hm])&&(g=u)}return c||(l=i.configureSlot(n,i,g),g?(c=g,a&&(c[s.size]=r),delete l.type,c.setConfig(l)):(h=l.type?oc.resolveType(l.type):t,l=h.mergeConfigs(i.defaults,l),a&&(l[s.size]=r),c=i.add(l),e.push(c),c.ion({thisObj:i,name:`${c.id}-listeners`,focusTrap:"onSlotFocusTrap"})),c[Hm]=n,i.slotSize||(i.slotSize=c[s.size]),c[s.vxy[0]]=n*i.slotSize),c[Vm]=o,c}}qm.initClass(),qm._$name="Carousel";const Km=e=>!e.value;class Xm extends cm{static $name="Checkbox";static type="checkbox";static alias="check";static get configurable(){return{inputType:"checkbox",autoCollapse:null,toggleGroupRootElement:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:!1,toggleGroup:null,localizableProperties:["label","text"],twinSyncConfigs:{value:"checked"}}}construct(e){"checked"in e&&((e=W.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}updateClearable(){}updateEditable(){}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:`${this.id}-input`,reference:"textLabel",html:this.text||"","aria-hidden":!this.text}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){var e;this.element.classList[this.text?"add":"remove"]("b-text"),null===(e=this.textLabel)||void 0===e||e.setAttribute("aria-hidden",!this.text)}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=!0===t?Km:t,e.collapsed=t(this))}assignFieldValue(e,t,n){this.value=n===this.checkedValue||n!==this.uncheckedValue&&null}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const n=this,r=n.value?n.checkedValue:n.uncheckedValue,i=void 0!==r,{valueName:s}=n;i&&(e[s]=r),n.gatherValues(e,i),!0===r&&(null===(t=e[s])||void 0===t?void 0:t.value)===r&&delete e[s].value}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){var t;const n=this,r=n.input.checked!==e;n.input.checked=e,null===(t=n.container)||void 0===t||t.syncChildConfigs(),!r||n.inputting||n.isConfiguring||(n.uncheckToggleGroupMembers(),n.triggerChange(!1,null))}get inputValueAttr(){return"checked"}updateColor(e,t){const n=this.element.classList;t&&n.remove(t),e&&n.add(e)}getToggleGroupRootElement(){const e=this.toggleGroupRootElement;let t;return e&&"string"==typeof e&&this.element&&(t=this.element.closest(e)),t||this.rootElement}getToggleGroupMembers(){const e=this,{toggleGroup:t,input:n,type:r}=e,i=[];return t&&Yn.forEachSelector(e.getToggleGroupRootElement(),`input[type=${r}][data-group=${t}]`,(e=>{if(e!==n){const t=oc.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(e){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>{e._propagatingUserActionFrom=this,e.checked=!1,e._propagatingUserActionFrom=null}))}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;t.readOnly&&t.value!==t.input.checked?t.input.checked=t.value:(t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0,e),t.inputting=!1))}updateInputReadOnly(e){}triggerChange(e,t){const n=this,{checked:r}=n.input,i={checked:r,value:r,oldValue:!r,userAction:e,valid:!0,event:t};n._propagatingUserActionFrom&&(i.propagatingUserActionFrom=n._propagatingUserActionFrom);if(!(!r&&e&&n.toggleGroup&&n.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!1===n.trigger("beforeChange",i)))return n.triggerFieldChange(i,!1),e&&n.uncheckToggleGroupMembers(e),n.trigger("action",i),n.trigger("change",i),!0;n.input.checked=n._value=!r}configureOverflowTwin(e){const t=this,n=super.configureOverflowTwin(e);return n.type=oc.resolveType("menuitem"),n.text||(n.text=t.label||t.text||t.tooltipText),n}}Xm.initClass(),Xm._$name="Checkbox";class Zm extends(Xu.mixin(rm)){static $name="FieldSet";static type="fieldset";static configurable={bodyTag:"fieldset",focusable:!1,localizableProperties:["label"],inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}};static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:t}=e,{inlineInternal:n,hasLabel:r,title:i}=this;return delete e.html,t["b-inline"]=n,t["b-fieldset-has-label"]=r,i&&(e.children={legendElement:{tag:"legend",text:i,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:t,labelCls:n,labelWidth:r}=this;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":t?{tag:"label",html:t,class:{"b-label":1,"b-align-start":1,[n]:n},style:{width:Yn.unitize("width",r)[1]}}:null}}}syncInlineInternal(){this.inlineInternal=this.inline??(null!=this.label&&"before"===this.labelPosition)}updateDisabled(e,t){super.updateDisabled(e,t),this.eachWidget((t=>{t.disabled=e}),!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}}Zm.initClass(),Zm._$name="FieldSet";class Jm extends Xm{static $name="Radio";static type="radio";static alias="radiobutton";static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){!1!==super.internalOnClick(e)&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}}Jm.initClass(),Jm._$name="Radio";class Qm extends Zm{static $name="RadioGroup";static type="radiogroup";static configurable={defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"};triggerPaint(){const e=this,t=!e.isPainted,n=e.__value;super.triggerPaint(...arguments),c.isFirefox&&e.isVisible&&t&&void 0!==n&&n!==e.value&&(e.value=void 0,e.value=n)}get existingOptions(){const{name:e}=this;return this.ensureItems().filter((t=>t.name===e))}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter((e=>e.input.checked))[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach((t=>{t.isConfiguring=this.isConfiguring,t.checked=t.checkedValue===e,t.isConfiguring=!1})),c.isFirefox&&!this.isConnected&&(this.__value=e)}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,t){if(!(e&&t&&W.isDeeplyEqual(t,e)))return e}convertOption(e,t,n){const r=this,{name:i}=r,s={name:i,type:r.defaultType,value:r.peekConfig("value"),ref:`${r.refPrefix}${e}`,disabled:r.disabled,checkedValue:e};return"string"==typeof t?s.text=t:W.assign(s,t),n?oc.reconfigure(n,s):s}isOurRadio(e){return(e.isRadio||e.isCheckbox)&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onItemBeforeChange",change:"onItemChange",click:"onItemClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onItemClick(e){const{source:t}=e;t.checked&&this.clearable&&null==t.clearable&&(t.checked=!1)}onItemBeforeChange(e){if(e.checked){const t=this,{lastValue:n}=t;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=n&&n!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=n,t.lastValue=n,t.reverting=!1,!1}}onItemChange(e){const t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:t,refPrefix:n}=e,r=e.existingOptions.reduce(((e,t)=>(e[t.ref.substring(n.length)]=t,e)),{});let i,s,o=0;if(t)for(i in t)s=e.convertOption(i,t[i],r[i]),delete r[i],e.insert(s,o++);const a=Object.values(r);null!=a&&a.length&&(e.remove(a),a.forEach((e=>e.destroy())))}}Qm.initClass(),Qm._$name="RadioGroup";class ep extends(Qm.mixin(im)){static $name="CheckboxGroup";static type="checkboxgroup";static configurable={defaultType:"checkbox",defaults:{color:"b-blue"},separator:",",requiredSelectedOptions:null,minSelectedOptions:null,maxSelectedOptions:null,errorTooltipCachePath:"checkboxGroupErrorTooltip",errorTooltipConfig:{forSelector:".b-checkboxgroup.b-invalid .b-checkbox-label",align:"t-b"}};onItemBeforeChange(e){const t=this,{lastValue:n}=t;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=n&&n!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=n,t.lastValue=n,t.reverting=!1,!1}onItemChange(e){const t=this;t.reverting||(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value),t.syncInvalid()}get selected(){return this.existingOptions.filter((e=>e.input.checked))||null}get value(){const{selected:e}=this;return e.map((e=>e.checkedValue))}set value(e){"string"==typeof(e=e||[])&&(e=e.split(this.separator)),this.existingOptions.forEach((t=>{t.isConfiguring=this.isConfiguring,t.checked=e.includes(t.checkedValue),t.isConfiguring=!1})),c.isFirefox&&!this.isConnected&&(this.__value=e)}internalOnChange(){this.syncInvalid()}get inputWrap(){return this.element}get isValid(){let e=!0;const t=this,{selected:n,requiredSelectedOptions:r,minSelectedOptions:i,maxSelectedOptions:s}=t;if(t.clearError(void 0,!0),!t.disabled){const o=isNaN(t.minSelectedOptions)||n.length>=i,a=isNaN(t.maxSelectedOptions)||n.length<=s;r&&n.length!==r?(e=!1,t.setError(t.L("L{wrongNbrOfOptionsSelected}",r),!0)):o?a||(e=!1,t.setError(t.L("L{tooManyOptionsSelected}",s),!0)):(e=!1,t.setError(t.L("L{tooFewOptionsSelected}",i),!0))}return e&&t.errors&&Object.keys(t.errors).length&&(e=!1),e}updateMinSelectedOptions(){this.isConfiguring||this.syncInvalid()}updateMaxSelectedOptions(){this.isConfiguring||this.syncInvalid()}updateRequiredSelectedOptions(){this.isConfiguring||this.syncInvalid()}}let tp;ep.initClass(),ep._$name="CheckboxGroup";class np extends Xu{static $name="CodeEditor";static type="codeeditor";static configurable={textContent:!1,scrollable:null,codePath:null,editor:{$config:["lazy","nullify"],value:{automaticLayout:!0,scrollBeyondLastLine:!1}},header:{cls:"demo-header"},bbar:{overflow:null,items:{readOnly:{hidden:!0,type:"widget",cls:"b-icon b-icon-locked"},status:{type:"widget",html:" "},cursorPos:{type:"widget",html:" ",setPosition({lineNumber:e,column:t}){this.element.innerHTML=`Ln ${e}, Col ${t}`}}}},readOnly:null,text:{$config:["lazy","nullify"],value:null},language:null,theme:null,status:null};construct(e={}){const t=this;t.editorReady=new Promise(((e,n)=>{t.resolveEditorReady=e,t.rejectEditorReady=n})),super.construct(...arguments),t.editorReady.then((()=>{ir.ion({theme:({theme:e})=>t.editor.updateOptions({theme:e.toLowerCase().includes("dark")?"vs-dark":"vs-light"}),thisObj:t}),t.element.style.setProperty("--vscode-menu-background",getComputedStyle(t.element.querySelector(".monaco-editor")).getPropertyValue("--vscode-menu-background"))}))}get monacoInstance(){return globalThis.monaco}focus(){this.editor.focus()}static set monacoLoadPromise(e){tp=e}static get monacoLoadPromise(){return tp}async updateCodePath(e,t){const n=this;var r;t&&(null===(r=n.loaderScript)||void 0===r||r.remove());tp||(tp=new Promise((t=>{const r=()=>{const o=globalThis.require;o.config({paths:{vs:`${e}/min/vs`}}),o(["vs/editor/editor.main"],(function(){n.isDestroyed||t(globalThis.monaco)})),s.removeEventListener("error",i),s.removeEventListener("load",r)},i=()=>{const t=`Code editor path to Monaco editor ${e} is incorrect`;s.removeEventListener("error",i),s.removeEventListener("load",r),Dh.show(t),n.rejectEditorReady(t)},s=n.loaderScript=Yn.createElement({tag:"script",parent:document.head,src:`${e}/min/vs/loader.js`});s.addEventListener("error",i),s.addEventListener("load",r)}))),globalThis.monaco=await tp,n.getConfig("editor"),n.getConfig("text")}updateReadOnly(e){const{readOnly:t}=this.widgetMap;t&&(t.hidden=!e),this.editor.updateOptions({readOnly:e})}updateStatus(e){const{status:t}=this.widgetMap;t&&(t.html=e)}changeEditor(e,t){var n;const r=this;var i;(null==t||null===(n=t.dispose)||void 0===n||n.call(t),e)&&(e=r.monacoInstance.editor.create(r.contentElement,ke.merge({theme:r.theme||null!==(i=Yn.themeInfo)&&void 0!==i&&i.name.toLowerCase().includes("dark")?"vs-dark":"vs-light",padding:{top:14}},e)),r.monacoInstance.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0}),e.onDidChangeCursorPosition(r.onCursorMove.bind(r)),e.onDidChangeConfiguration(r.onEditorConfigChange.bind(r)),e.onDidDispose(r.onEditorDestroy.bind(r)),r.resolveEditorReady(e));return e}get text(){var e;return(null===(e=this.codeModel)||void 0===e?void 0:e.getValue())||this._text}changeText(e){var t;return this._text=null===(t=this.codeModel)||void 0===t?void 0:t.getValue(),e}updateText(e){const{codeModel:t}=this;var n,r;null!=e?t?t.setValue(e):this.loadText(e):null===(n=this.codeModel)||void 0===n||null===(r=n.dispose)||void 0===r||r.call(n)}async loadText(e=this.text,t=this.language){var n;const r=this;r._text=e,r._language=t,null===(n=r.codeModel)||void 0===n||n.dispose(),await r.editorReady;const i=r.codeModel=r.monacoInstance.editor.createModel(e,t);return r.editor.setModel(i),r.trigger("load",{model:i,text:e}),i}onEditorDestroy(){var e,t;null===(e=this.codeModel)||void 0===e||null===(t=e.dispose)||void 0===t||t.call(e),this.codeModel=null}onEditorConfigChange(){const e=this;e.editor&&(e.readOnly=e.editor.getOptions().get(e.monacoInstance.editor.EditorOptions.readOnly.id))}onCursorMove({position:e}){var t;null===(t=this.widgetMap.cursorPos)||void 0===t||t.setPosition(e)}}np.initClass(),np._$name="CodeEditor";class rp extends gm{static $name="ColorPicker";static type="colorpicker";static configurable={itemsFocusable:!1,navigator:{focusCls:"b-color-active"},itemWrapperTpl(e,t){const{selected:n}=this,{color:r,text:i}=e,s=this.getColorClassName(r);return hh.tpl`
                    <li
                        class="${this.getItemClasses(e,t)} ${s}"
                        role="option"
                        aria-selected="${n.includes(e)}"
                        data-index="${t}"
                        data-id="${N.encodeHtml(r)}"
                        data-btip="${i}"
                        ${this.itemsFocusable?'tabindex="-1"':""}
                        style="${s?"":"background-color: "+r}"
                    ></li>`},colorClasses:null,colorClassPrefix:null,colors:["#45171D","#F03861","#FF847C","#FECEA8","#A5F2E7","#AA83F3","#8983F3","#A10054","#073059","#2866AB","#5FBDC5","#D8D95C","#FFDEDE","#F7F3CE","#C5ECBE","#3E3E3E","#405559","#68868C","#EDEDED","#D3D6DB","#3A4750","#303841","#BE3144"],addNoColorItem:!0,columns:6,colorSelected:null,store:{useRawData:!1}};configure(e){super.configure(e),this.setItems(),this.ion({item:"onColorSelect"})}setItems(){const e=this,{colors:t,colorClasses:n}=e;let r=t||n;e.addNoColorItem&&(e.store.modelClass.allowNullId=!0,r=[...r,null]),e.items=r.map((t=>t&&"string"!=typeof t?t:{color:t,text:(n?N.capitalize(t):t)||e.L("L{noColor}")}))}afterConfigure(){super.afterConfigure(...arguments),(this.addNoColorItem||this.value)&&this.select(this.value??null)}updateColors(){this.isConfiguring||this.setItems()}updateAddNoColorItem(){this.isConfiguring||this.setItems()}onColorSelect({record:e}){var t;this.refresh();const n={color:e.color,record:e,bubbles:!0};null===(t=this.colorSelected)||void 0===t||t.call(this,n),this.trigger("colorSelected",n)}select(e){e&&"string"!=typeof e||(e=this.store.findRecord("color",e??null)),e&&super.select(e)}updateColumns(e){this.style=`grid-template-columns:repeat(${e}, 1fr);`}getColorClassName(e){var t,n;return null!==(t=this.colorClasses)&&void 0!==t&&t.includes(e)||null!==(n=this.colorClasses)&&void 0!==n&&n.find((t=>t&&t.color===e))?this.colorClassPrefix+e:e?"":"b-no-color"}}rp.initClass(),rp._$name="ColorPicker";class ip extends Dm{static $name="ColorField";static type="colorfield";static configurable={displayField:"text",valueField:"color",editable:!1,picker:{type:"colorpicker",align:{align:"t100-b100",matchSize:!1}},showBoxForNoColor:!0,colors:null,addNoColorItem:!0};configure(e){const t=e.picker??{};e.colors&&(t.colors=e.colors),"addNoColorItem"in e&&(t.addNoColorItem=e.addNoColorItem),e.picker=t,super.configure(e)}updatePicker(e,t){super.updatePicker(e,t),e&&(this.items=e.store.records)}updateColors(e){this.isConfiguring||(this.picker.colors=e)}updateAddNoColorItem(e){this.isConfiguring||(this.picker.addNoColorItem=e)}set value(e){this.store||(this.items=[],this.store=this.picker.store),e||(e=this.store.findRecord("color",null)),super.value=e}showPicker(){this.picker.refresh(),super.showPicker(...arguments)}get value(){return super.value}syncInputFieldValue(...e){var t;const n=this,{value:r}=n;let i=null===(t=n.picker)||void 0===t?void 0:t.getColorClassName(r);i||(n.colorBox.style.color=r),i="b-colorbox "+i,n.colorBox.className=i,n.showBoxForNoColor||n.element.classList.toggle("b-colorless",!r),super.syncInputFieldValue(...e)}get innerElements(){return[{reference:"colorBox",className:"b-colorbox"},...super.innerElements]}}ip.initClass(),ip._$name="ColorField";const sp=["ok","cancel","yes","no"].reduce(((e,t,n,r)=>(e[t]=Object.freeze({...Object.fromEntries(r.map((e=>[e,!1]))),name:t,approve:"ok,yes".includes(t),[t]:!0}),e)),Object.create(null)),op=["b-raised","b-blue"],ap=["b-gray"],lp=c.isWindows,dp=/(?:\s+,?|,)\s*/,cp=/^(icon|menu|text)$/;class up extends Hu{static $name="ConfirmationBar";static type="confirmationbar";static configurable={defaultButton:"ok",defaultType:"button",items:"ok,cancel",keyMap:{Enter:"doDefault",NumpadEnter:"doDefault",Escape:"doCancel"},namedItems:{yes:{cls:"b-yes-button",text:"L{Object.Yes}",onClick:"up.onButtonClick",weight:lp?100:130},no:{cls:"b-no-button",text:"L{Object.No}",onClick:"up.onButtonClick",weight:lp?110:120},ok:{cls:"b-ok-button",text:"L{Object.Ok}",onClick:"up.onButtonClick",weight:lp?120:110},cancel:{cls:"b-cancel-button",text:"L{Object.Cancel}",onClick:"up.onButtonClick",weight:lp?130:100}},syncWidthButtons:null};static delayable={syncButtons:{type:"raf",suspended:!0}};get buttons(){return this.items.filter((e=>e.isButton))}get cancelButton(){return this.widgetMap.cancel||null}get noButton(){return this.widgetMap.no||null}get okButton(){return this.widgetMap.ok||null}get yesButton(){return this.widgetMap.yes||null}changeItems(e,t){return"string"==typeof e&&(e=Object.fromEntries(e.split(dp).map((e=>[e,!0])))),super.changeItems(e,t)}clickButton(e,t){var n;const{widgetMap:r,defaultButton:i}=this;let s,o,a=t?r.cancel||r.no:r[i];if(!a)for([o,s]of Object.entries(r))if(o!==i){a=s;break}null===(n=a)||void 0===n||n.onInternalClick(e)}doCancel(e){this.clickButton(e,!0)}doDefault(e){this.clickButton(e)}onButtonClick(e){this.trigger("choice",{...e,choice:sp[e.source.ref],source:this,userAction:!0})}onChildAdd(e){super.onChildAdd(e),ee.before(e,"onConfigChange","onChildConfigChange",this),this.syncButtons()}onChildConfigChange({name:e}){cp.test(e)&&this.syncButtons()}onChildRemove(e){super.onChildRemove(e),this.syncButtons()}onInternalPaint(e){super.onInternalPaint(e),e.firstPaint&&this.syncButtons.resume(),this.syncButtons.now()}syncButtons(){const e=this,t=e.isDestroying?[]:e.buttons,{defaultButton:n}=e;let r,i;!1!==e.syncWidthButtons&&t.forEach((e=>{(i=e.text)&&(r=Math.max(r||0,i.length+Boolean(e.icon)+Boolean(e.menu)))})),t.forEach((e=>{const{classList:t}=e.element,i=e.ref===n;t.add(...i?op:ap),t.remove(...i?ap:op),t.toggle("b-default-button",i),e.minWidth=r&&e.text?`${r}em`:null}))}updateAutoWidthButtons(){this.syncButtons()}updateDefaultButton(){this.syncButtons()}}up.initClass(),up._$name="ConfirmationBar";class hp extends Xu{static $name="MonthPicker";static type="monthpicker";static configurable={textContent:!1,tbar:{overflow:null,items:{title:{type:"button",cls:"b-monthpicker-title",onAction:"up.handleTitleClick"}}},itemCls:"b-month-container",month:null};construct(e){super.construct({month:(new Date).getMonth(),...e}),Jt.on({element:this.contentElement,click:"onMonthClick",delegate:".b-monthpicker-month",thisObj:this})}get focusElement(){return this.getMonthButton(this.month)}getMonthButton(e){return this.contentElement.querySelector(`.b-monthpicker-month[data-month="${e}"]`)}onMonthClick({target:e}){const t=parseInt(e.getAttribute("data-month"));this.month===t?this.trigger("select",{oldValue:t,value:t}):this.month=t}handleTitleClick(e){this.trigger("titleClick",e)}changeMonth(e){if(!isNaN(e))return W.isDate(e)?e.getMonth():e>=0&&e<=11?e:void 0}updateMonth(e,t){this.isConfiguring||this.trigger("select",{oldValue:t,value:e})}composeBody(){this.getConfig("month");const e=super.composeBody(),t=e.children[this.tbar?1:0].children=[];this.widgetMap.title.text=xi.getMonthName(this.month);for(let e=0;e<=11;e++)t.push({tag:"button",dataset:{month:e},class:{"b-monthpicker-month":1,"b-selected":e===this.month},text:xi.getMonthShortName(e)});return e}async updateLocalization(){this.isConfiguring||await this.recompose(),super.updateLocalization()}}hp.initClass(),hp._$name="MonthPicker";class gp extends Xu{static $name="YearPicker";static type="yearpicker";static configurable={textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"b-icon b-icon-previous",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"b-icon b-icon-next",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null};construct(e){super.construct({year:(new Date).getFullYear(),...e}),Jt.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector(`.b-yearpicker-year[data-year="${e}"]`)}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return W.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const n=this;!n.startYear||e>n.endYear?n.startYear=e:e<n.startYear&&(n.startYear=e-(n.yearButtonCount-1)),n.isConfiguring||n.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&Yn.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),n=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=`${`000${e}`.slice(-4)} - ${`000${this.endYear}`.slice(-4)}`;for(let t=0,r=e;t<this.yearButtonCount;t++,r++)n.push({tag:"button",dataset:{year:r},class:{"b-yearpicker-year":1,"b-selected":r===this.year},text:`000${r}`.slice(-4)});return t}}gp.initClass(),gp._$name="YearPicker";class mp extends vm{static $name="DisplayField";static type="displayfield";static alias="display";static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:`${this.id}-input`,reference:"displayElement",html:this.template?this.template(this.value):N.encodeHtml(this.value)}}}mp.initClass(),mp._$name="DisplayField";const pp=(e,t)=>e.valueOf()-t.valueOf(),{DateSet:fp}=xi,vp=Object.freeze([]),yp=e=>e.every(((t,n)=>!(n&&xi.add(e[n-1],1,"d")-t)));class bp extends Fm{static $name="DatePicker";static type="datepicker";static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{$config:"date",value:"today"},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"b-icon b-icon-first b-datepicker-nav-button",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}",weight:100},prevMonth:{cls:"b-icon b-icon-previous b-datepicker-nav-button",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}",weight:200},fields:{type:"container",cls:"b-datepicker-title",items:{monthButton:{type:"button",cls:"b-datepicker-monthbutton",internalListeners:{click:"up.onMonthPickerRequested"}},yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}}},weight:300},nextMonth:{cls:"b-icon b-icon-next b-datepicker-nav-button",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}",weight:400},nextYear:{cls:"b-icon b-icon-last b-datepicker-nav-button",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}",weight:500}}},monthPicker:{value:{type:"MonthPicker",trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onMonthPickerTitleClick",select:"up.onMonthPicked",Escape:"up.onMonthPickerTitleClick"}},$config:"lazy"},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{$config:"date",value:null},maxDate:{$config:"date",value:null},focusDisabledDates:null,multiSelect:null,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:{$config:"lazy",value:null},includeYear:{$config:"lazy",value:null},dayNameFormat:"dd",trapFocus:!0,ariaElement:"weeksElement",focusDescendant:!0,alwaysRefreshOnMonthChange:null,highlightSelectedWeek:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}static _monthNames=xi.getMonthNames();construct(e){const t=this;super.construct(e);const{widgetMap:n}=t;t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.removeAttribute("tabindex"),t.ariaElement.setAttribute("aria-activedescendant",`${t.id}-active-day`),n.fields&&!t.ariaLabel&&t.element.setAttribute("aria-labelledby",n.fields.id),Jt.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`},mousedown:{handler:"onCellMousedown",delegate:`.${t.dayCellCls}`},thisObj:t}),t.getConfig("editMonth"),t.getConfig("includeYear"),t.refresh.flush()}get labelledElement(){return this.element}afterHide(){var e,t;null===(e=this._monthPicker)||void 0===e||e.hide(),null===(t=this._yearPicker)||void 0===t||t.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;null===(e=this.yearButton)||void 0===e||e.destroy(),null===(t=this.monthButton)||void 0===t||t.destroy(),super.doDestroy()}get activeDayCell(){return this.weeksElement.querySelector(`#${this.id}-active-day`)}get focusElement(){return!this.disabled&&this.activeDayCell||this.element}onMonthDateChange(e){const t=super.onMonthDateChange(e);return this.ariaElement.setAttribute("aria-label",xi.format(this.date,"MMMM YYYY")),this.refresh.flush(),t}updateEditMonth(e){const{monthButton:t,yearButton:n}=this.widgetMap,r=!1===e;t&&(t.readOnly=r),n&&(n.disabled=r)}updateIncludeYear(e){const{yearButton:t}=this.widgetMap;t&&(t.hidden=!1===e)}updateReadOnly(e){e?this.element.setAttribute("inert",!0):this.element.removeAttribute("inert")}doRefresh(...e){const t=this,{date:n,widgetMap:r}=t,i=t.activeDayCell,s=xi.betweenLesser(t.activeDate,t.month.startDate,t.month.endDate)?t.activeDate:t._activeDate=n;t.getConfig("tbar"),super.doRefresh(...e),r.monthButton&&(r.monthButton.text=t.constructor._monthNames[n.getMonth()]),r.yearButton&&(r.yearButton.text=n.getFullYear());const o=xi.parseKey(null==i?void 0:i.dataset.date);s-o&&t.syncActiveDate(s,o)}internalCellRenderer({cell:e,date:t}){const n=this,{externalCellRenderer:r}=n,i=n.isSelectedDate(t),s=n.getCellClassList(...arguments);if(i&&n.multiSelect){const e=!n.isSelectedDate(xi.add(t,-1,"d")),r=!n.isSelectedDate(xi.add(t,1,"d"));s["b-range-start"]=e,s["b-range-end"]=r,s["b-in-range"]=!e&&!r}Yn.updateClassList(e,s),e.innerHTML=`<div class="b-datepicker-cell-inner">${t.getDate()}</div>`,e.setAttribute("role","gridcell"),e.setAttribute("aria-label",xi.format(t,"dddd MMMM Do, YYYY")),Yn.toggleAttribute(e,"aria-selected",i),n.isActiveDate(t)?e.id=`${n.id}-active-day`:e.removeAttribute("id"),r&&(arguments[0].cell=e.firstChild,n.callback(r,this,arguments))}getCellClassList({date:e}){const t=this,{activeCls:n,selectedCls:r}=t;return{[n]:n&&t.isActiveDate(e),[r]:t.isSelectedDate(e),[t.outOfRangeCls]:t.minDate&&e<t.minDate||t.maxDate&&e>t.maxDate}}onCellMousedown(e){const t=e.target.closest("[data-date]");this.focusable?(t.focus(),Yn.getActiveElement(t)===t&&e.preventDefault()):e.preventDefault(),this.activeDate=xi.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(xi.parseKey(t.dataset.date),e)}onUIDateSelect(e,t){const n=this,{lastClickedDate:r,multiSelect:i}=n;n.isDisabledDate(e)||!1!==n.trigger("beforeDateSelect",{date:e,event:t})&&(n.lastClickedDate=e,n.activatingEvent=t,i?n.handleMultiSelect(r,e,t):(n.date=n.selection=e,n.floating&&n.hide()),n.activatingEvent=null)}handleMultiSelect(e,t,n){const r=this,{multiSelect:i}=r,s=r._selection||(r._selection=new fp),o=s.dates,a="range"===i||"simple"===i,l="simple"===i||Yn.isTouchEvent,{size:d,generation:c}=s,u=d&&{[xi.makeKey(xi.add(o[0],-1,"d"))]:1,[xi.makeKey(o[0])]:1,[xi.makeKey(o[o.length-1])]:1,[xi.makeKey(xi.add(o[o.length-1],1,"d"))]:1},h=s.has(t)?"delete":"add",g=a&&(null==u?void 0:u[xi.makeKey(t)]);if(l&&d>1)s.clear(),s.add(t);else if(n.ctrlKey)!0!==i&&d&&!g||(s[h](t),a&&!s.has(r.rangeStartDate)&&r.rangeStartDate.setDate(r.rangeStartDate.getDate()+(t<o[1]?1:-1)));else if((l||n.shiftKey)&&d){const[n,i]=[new Date(a?r.rangeStartDate||(r.rangeStartDate=o[0]):e),t].sort(pp);a&&s.clear();for(const e=n;e<=i;e.setDate(e.getDate()+1))s.add(e)}else s.has(t)&&1===s.size||(s.clear(),s.add(t));const m=s.size;1===m?r.rangeStartDate=t:m||(r.rangeStartDate=null),s.generation!==c&&r.updateSelection(s)}updateHighlightSelectedWeek(e){this.element.classList.toggle("b-highlight-selected-week",Boolean(e))}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",Boolean(e)),e||(this.selection=[...this.selection][0])}get selection(){const{_selection:e}=this,t=e?e.dates:vp;return"range"===this.multiSelect&&t.length?[t[0],t[t.length-1]]:t}getRange(e){if(this.multiSelect){const{selection:t}=this,n=t[0],r=t[t.length-1];if(t.length>1&&xi.add(r,1,"d").getDate()===n.getDate())return{unit:"month",magnitude:xi.diff(n,xi.add(r,1,"d"),"month"),wholeMonth:1===n.getDate()&&r.getDate()===xi.getLastDateOfMonth(r).getDate()&&yp(t),startDate:n,endDate:r};if(n.getDay()==xi.weekStartDay&&r.getDay()===(xi.weekStartDay+6)%7)return{unit:"week",magnitude:xi.diff(n,xi.add(r,1,"d"),"week"),startDate:n,endDate:r};if(e){const e=Math.max(Math.ceil(xi.diff(n,xi.add(r,1,"d"),"w")),1),t=(n.getDay()-xi.weekStartDay+7)%7,i=xi.add(n,-t,"d");return{unit:"week",magnitude:e,startDate:i,endDate:xi.add(i,7*e-1,"d")}}return{unit:"day",magnitude:xi.diff(n,r,"d")+1,startDate:n,endDate:r}}}get snappedRange(){}changeSelection(e,t){const n=this;let r,i;if(e)if(e.isDateSet){if(t===e||null!=t&&t.equals(e))return t;i=W.first(e),r=e}else if(e.forEach||(e=[e]),e.forEach(((t,r)=>e[r]=n.changeDate(t))),i=e[0],e.sort(pp),"range"===n.multiSelect&&2===e.length){r=new fp;for(const t=new Date(e[0]);t<=e[1];t.setDate(t.getDate()+1))r.add(t)}else i=e[0],r=new fp(e);else r=new fp;return i&&(n.rangeStartDate=xi.clearTime(i)),r}updateSelection(e,t){const n=this,{multiSelect:r}=n,{dates:i}=e,s="range"===r?[i[0],i[i.length-1]]:i;if(!n.isConfiguring){r||!i.length||n.peekConfig("date")||i[0].getMonth()!==n.month.month||(n.date=i[0]),n.refresh.now();const e={selection:s,userAction:Boolean(n.activatingEvent)};if(t){const{dates:n}=t;e.oldSelection="range"===r?[n[0],n[n.length-1]]:n}n.trigger("selectionChange",e)}}isSelected(e){return this.selection.some((t=>xi.isSameDate(t,e)))}onInternalKeyDown(e){const t=this,n=e.key.trim()||e.code,r=t.activeDate;let i=new Date(r);if("Escape"===n){if(t.monthPicker.isVisible)return t.monthPicker.hide();if(t.yearPicker.isVisible)return t.yearPicker.hide();if(t.floating)return t.hide()}if(r&&t.weeksElement.contains(e.target)){do{switch(n){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i=t.gotoPrevMonth():i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i=t.gotoNextMonth():i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}changeMinDate(e){return e&&Fm.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearPicker&&(this._yearPicker.minYear=null==e?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&Fm.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearPicker&&(this._yearPicker.maxYear=null==e?void 0:e.getFullYear()),this.refresh()}changeDate(e){return xi.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e,t){const n=this,{month:r}=n;if(n.isConfiguring&&!n.initializingActiveDate&&("selection"in n.initialConfig||(n.selection=e),"activeDate"in n.initialConfig||(n.activeDate=e)),!r.date||e.getMonth()===r.month||!n.getCell(e)||n.alwaysRefreshOnMonthChange||n.isNavigating)super.updateDate(e);else{const i=r.getOtherMonth(e),s=n.eventListeners&&(t?e.getDate()!==t.getDate()|(i.getWeekId(e)!==r.getWeekId(t))<<1|(e.getMonth()!==(null==t?void 0:t.getMonth()))<<2|(e.getFullYear()!==(null==t?void 0:t.getFullYear()))<<3:15);n.trigger("dateChange",{changes:{d:!0,w:Boolean(2&s),m:Boolean(12&s),y:Boolean(8&s),r:i.weekCount!==r.weekCount},value:e,oldValue:t})}}changeActiveDate(e,t){const n=this;if("today"===e&&(e=new Date),!1!==n.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})){if(e=e?n.changeDate(e):n.date||(n.date=xi.clearTime(new Date)),isNaN(e))throw new Error("DatePicker activeDate must be passed a Date, or a YYYY-MM-DD date string");return xi.clamp(e,n.minDate,n.maxDate)}}updateActiveDate(e,t){const n=this,{isConfiguring:r}=n;!r&&n.getCell(e)||(n.initializingActiveDate=r,n.date=e,n.initializingActiveDate=!1),r||n.refresh.isPending||n.syncActiveDate(e,t)}syncActiveDate(e,t){const n=this,{activeCls:r}=n,i=n.getCell(e),s=t&&n.getCell(t),o=Yn.getActiveElement(n.element);i&&(n.focusable&&i.setAttribute("tabIndex","0"),r&&i.classList.add(r),i.id=`${n.id}-active-day`,n.weeksElement.contains(o)&&i.focus()),s&&s!==i&&(n.focusable&&s.removeAttribute("tabIndex"),r&&s.classList.remove(r),s.removeAttribute("id"))}set value(e){const t=this,{selection:n,duration:r}=t;if(t.isNavigating=!0,e){if(e=t.changeDate(e,t.value),"range"===t.multiSelect&&2===(null==n?void 0:n.length))return xi.betweenLesserEqual(e,...n)||(e<n[0]?t.selection=[e,xi.add(e,r-1,"d")]:t.selection=[xi.add(e,-(r-1),"d"),e]),void(t.date=t.activeDate=e);void 0!==e&&(t.selection=e,t.date=t.activeDate=e)}else t.date=t.activeDate=new Date,t.selection=null;t.isNavigating=!1}get value(){const{selection:e}=this,t=(null==e?void 0:e.length)||null;return t&&e[t-1]}get duration(){return"range"===this.multiSelect?xi.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const n=this,{activeDate:r}=n,i=r&&n.getCell(r);let s;return s="month"===t&&i&&(null==r?void 0:r.getMonth())===n.month.month+e?r:xi.add(i?r:n.date,e,t),n.gotoDate(s,e,i)}gotoDate(e,t,n=this.activeDate&&this.getCell(this.activeDate)){const r=this,i=new Date(e);i.setDate(1);const s=xi.add(xi.add(i,1,"month"),-1,"day");if(r.minDate&&t<0&&s<r.minDate||r.maxDate&&t>0&&i>r.maxDate)return;r.isNavigating=!0;const o=r.date=e;return r.widgetMap.monthButton.text=r.constructor._monthNames[e.getMonth()],n&&(r.activeDate=e),r.isNavigating=!1,o}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return null===(t=this._selection)||void 0===t?void 0:t.has(e)}onFocusIn(e){var t;(super.onFocusIn(e),e.toWidget!==this||e._target!==this.element||this.disabled)||(null===(t=this.focusElement)||void 0===t||t.focus())}onMonthPickerRequested(){const{monthPicker:e}=this;e.isVisible?e.hide():(e.month=this.activeDate.getMonth(),e.show(),e.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onMonthPickerTitleClick(){this.monthPicker.hide()}onYearPickerTitleClick(){this.yearPicker.hide()}onMonthPicked({value:e,source:t}){var n;const r=this;r.gotoDate(xi.add(r.activeDate,e-r.activeDate.getMonth(),"month")),r.widgetMap.monthButton.text=r.constructor._monthNames[r.activeDate.getMonth()],null===(n=r.focusElement)||void 0===n||n.focus({preventScroll:!0}),t.hide()}onYearPicked({value:e,source:t}){var n;const r=new Date(this.activeDate);r.setFullYear(e),this.activeDate=r,null===(n=this.focusElement)||void 0===n||n.focus({preventScroll:!0}),t.hide()}changeMonthPicker(e,t){return hp.reconfigure(t,e?hp.mergeConfigs({owner:this,appendTo:this.element},e):null,this)}changeYearPicker(e,t){var n,r;return gp.reconfigure(t,e?gp.mergeConfigs({owner:this,appendTo:this.element,minYear:null===(n=this.minDate)||void 0===n?void 0:n.getFullYear(),maxYear:null===(r=this.maxDate)||void 0===r?void 0:r.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e,_monthPicker:t}=this,n=super.childItems;return e&&n.push(e),t&&n.push(t),n}updateLocalization(){const e=this,{monthButton:t}=e.widgetMap,n=e.constructor._monthNames=xi.getMonthNames();t&&!e.isConfiguring&&(t.text=n[e.monthPicker.month??e.date.getMonth()]),super.updateLocalization()}changeMultiSelect(e){return"range"===e&&c.isTouchDevice&&(e="simple"),e}}bp.initClass(),bp._$name="DatePicker";const Cp=new Date;class wp extends ym{static $name="DateField";static type="datefield";static alias="date";static configurable={format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger b-step-trigger-back",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger b-step-trigger-forward",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:{$config:null,default:!0},weekStartDay:null,picker:{type:"datepicker",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null,role:"combobox"};changePicker(e,t){var n;if(null!=e&&e.isDatePicker)return e;const r=this,i=bp.mergeConfigs({owner:r,forElement:r.pickerAlignElement,minDate:r.min,maxDate:r.max,weekStartDay:r._weekStartDay,align:{anchor:r.overlayAnchor,target:r.pickerAlignElement},internalListeners:{selectionChange:"onPickerSelectionChange",thisObj:r}},e);r.calendarContainerCls&&(i.cls=r.calendarContainerCls),r.value?i[r.isValid?"value":"activeDate"]=r.value:i.activeDate||(i.activeDate=new Date);const s=bp.reconfigure(t,e?i:null,r);return null==s||null===(n=s.refresh)||void 0===n||n.flush(),s}onPickerSelectionChange({selection:e,source:t}){if(t.isVisible){const n=this,r=e.length?n.value?xi.copyTimeValues(new Date(e[0]),n.value):new Date(e[0]):null;n._isUserAction=n._isPickerInput=!0,n.value=r,n._isPickerInput=n._isUserAction=!1,t.hide()}}getStepDate(e){const{step:t}=this;return xi.add(this.value,(e||1)*t.magnitude,t.unit)}stepDate(e,t=!0){const n=this;if(!n.readOnly&&n.value){const r=n.getStepDate(e);n.checkMinMax(r)||(t?(n._isUserAction=!0,n.value=r,n.autoSelect&&n.select(),n._isUserAction=!1):n.value=r)}}onBackClick(){this.stepDate(-1)}onForwardClick(){this.stepDate(1)}showPicker(e){if(this.readOnly)return;const t=this,{_picker:n}=t;if(n){const e={minDate:t.min,maxDate:t.max};t.value?e[t.isValid?"value":"activeDate"]=t.value:n.activeDate||(e.activeDate=new Date),n.setConfig(e)}super.showPicker(e)}focusPicker(){var e;null===(e=this.picker)||void 0===e||e.focus()}checkMinMax(e){const{min:t,max:n}=this;return t&&e<t?-1:n&&e>n?1:0}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let{value:t}=e;if(t){let{min:n,max:r,validateDateOnly:i}=e;if(i&&(t=xi.clearTime(t,!1),n&&(n=xi.clearTime(n,!1)),r&&(r=xi.clearTime(r,!1))),n&&t<n)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&t>r)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e,t=!0){const n=this;return null!=e&&(xi.isDate(e)||(e="string"==typeof e?xi.parse(e,n.format,n.strictParsing)||xi.parse(e,n.fallbackFormat,n.strictParsing):new Date(e)),xi.isValidDate(e))?t&&(!n.min||e-n.min>-xi.MS_PER_DAY)&&(!n.max||e<=n.max)?n.transformTimeValue(e):e:null}isTimeValue(e){return e&&!0!==e&&"entered"!==e}transformTimeValue(e){const t=this,{keepTime:n}=t;if(e=xi.clone(e),n)if(t.isTimeValue(n)){const r=xi.parse(n,t.timeFormat);xi.copyTimeValues(e,r)}else!0===n&&(t._isPickerInput||t.inputting)&&xi.isValidDate(t.value)&&xi.copyTimeValues(e,t.value);else xi.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e,!1)}updateMin(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),n&&(n.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e,!1)}updateMax(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),n&&(n.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:xi.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const n=this,r=n.transformDateValue(e),i=n.L("L{invalidDate}")(xi.format(Cp,n.format));if(!e||r){if(n.clearError(i),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue()}else n.inputting&&!n.validateOnInput||n.setError(i)}updateValue(e,t){const n=this._picker;n&&(n.value=e,this.inputting||(n.activeDate=e)),super.updateValue(e,t)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===n&&(e=xi.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime&&(!this.keepTime||this.isTimeValue(this.keepTime))?!xi.isEqual(xi.clearTime(e),xi.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?xi.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){var t;if(super.internalOnKeyEvent(e),"keydown"===e.type){const n=this;let r;switch(e.virtualKey){case"Enter":n.isValid&&(null===(t=n.picker)||void 0===t||t.hide());break;case"ArrowLeft":(n.caretAtStart||n.selectedAll)&&(r=-1);break;case"ArrowRight":(n.caretAtEnd||n.selectedAll)&&(r=1);break;case"NumpadAdd":r=1;break;case"NumpadSubtract":r=-1}r&&n.step&&(n.stepDate(r),n.selectAll(),e.preventDefault())}}}wp.initClass(),wp._$name="DateField";const Sp=Array.from(Array(24)).map(((e,t)=>({id:t,text:String(t+100).slice(1)}))),Dp=Array.from(Array(60)).map(((e,t)=>({id:t,text:String(t+100).slice(1)})));class Ep extends Xu{static $name="TimePicker";static type="timepicker";static configurable={floating:!0,layout:"hbox",defaults:{type:"list",displayField:"id",itemTpl(e){const t=e.id,n="hour"!==this.ref||this.owner.is24Hour||t?t:12;return String(n+100).slice(1)},itemCls:"b-timepicker-item",itemsFocusable:!1,scrollable:{overflowY:"hidden-scroll"},onSelectionChange:"up.onSelectionChange",navigator:{activateOnMouseover:!0}},items:{hour:{items:Sp},minute:{items:[]},second:{hidden:!0,items:Dp}},step:{magnitude:5,unit:"m"},autoShow:!1,trapFocus:!0,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,is24Hour:{$config:"lazy",value:null},initialValue:null};alignTo(){const{widgetMap:e}=this,{minute:t,second:n}=this.owner.input;return this.getConfig("is24Hour"),this.minimizeHeight&&(e.hour.maxHeight=e.second.maxHeight=e.minute.height),e.minute[t?"show":"hide"](),e.second[n?"show":"hide"](),super.alignTo(...arguments)}updateIs24Hour(e){this.widgetMap.hour.store.filter((t=>!!e||t.id<12))}updateStep(e){e=xi.as("m",e.magnitude,e.unit);const t=[];for(let n=0;n<60;n+=e)t.push({id:n,text:String(100+n).slice(1)});this.widgetMap.minute.store.data=t}onSelectionChange({source:e,selected:[t]}){const n=this;n._isUserAction=e._isUserAction,e.navigator.activeItem=t,n.updatingValue||n.owner.input.setSubFieldValue(e.ref,t.id),n._isUserAction=!1}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e="string"==typeof e?xi.parse(e,this.format):e),e??xi.getTime(0)}updateValue(e){const t=this,{hour:n,minute:r,second:i}=t.widgetMap,s=e.getHours(),o=t.is24Hour?s:s%12,a=e.getMinutes(),l=e.getSeconds();t.updatingValue=!0,n.navigator.activeItem=new Number(o),n.select(o,!0),r.navigator.activeItem=new Number(a),r.select(a,!0),i.navigator.activeItem=new Number(l),i.select(l,!0),t.updatingValue=!1,r.store.filter(),i.store.filter(),t.isVisible&&t.triggerTimeChange(e)}changeMin(e){return"string"==typeof e?xi.parse(e,this.format):e}updateMin(e){const{hour:t,minute:n,second:r}=this.widgetMap,{owner:i,is24Hour:s}=this;if(e){const o=e.getHours(),a=e.getMinutes(),l=e.getSeconds();t.store.filter({id:"min-filter",filterBy:({id:e})=>(!s&&i.value.getHours()>=12&&(e+=12),e>=o)}),n.store.filter({id:"min-filter",filterBy:({id:e})=>i.value.getHours()!==o||e>=a}),r.store.filter({id:"min-filter",filterBy:({id:e})=>i.value.getMinutes()!==a||e>=l})}else t.store.removeFilter("min-filter"),n.store.removeFilter("min-filter"),r.store.removeFilter("min-filter")}changeMax(e){return"string"==typeof e?xi.parse(e,this.format):e}updateMax(e){const{hour:t,minute:n,second:r}=this.widgetMap;if(e){const i=e.getHours(),s=e.getMinutes(),o=e.getSeconds();t.store.filter({id:"max-filter",filterBy:({id:e})=>e<=i}),n.store.filter({id:"max-filter",filterBy:({id:e})=>e<=s}),r.store.filter({id:"max-filter",filterBy:({id:e})=>e<=o})}else t.store.removeFilter("max-filter"),n.store.removeFilter("max-filter"),r.store.removeFilter("max-filter")}}Ep.initClass(),Ep._$name="TimePicker";const xp=/\d+/,Rp=/\d+(\D)\d+/,Tp=["hour","minute","second"],Mp=[3600,60,1],kp=["getHours","getMinutes","getSeconds"];class Fp extends HTMLElement{static formAssociated=!0;static observedAttributes=["min","max","disabled","tabindex"];constructor(){var e;super();const t=this,n=t._root=t.attachShadow({mode:"open",delegatesFocus:!0});t.internals_=null===(e=t.attachInternals)||void 0===e?void 0:e.call(t),t.byRef=Object.create(null),n.addEventListener("keydown",t.onKeyDown.bind(t)),n.addEventListener("focusin",t.onFocusIn.bind(t)),n.addEventListener("click",t.onClick.bind(t)),n.addEventListener("input",t.onInput.bind(t)),n.addEventListener("focusout",t.onFocusOut.bind(t))}connectedCallback(){var e;const t=this;t.silentChangeValue=!0,t.owner=null===(e=t.elementData)||void 0===e?void 0:e.owner,t.createStructure(t.owner.format),t.updateValue(t._value),t.silentChangeValue=!1}ingestDate(e){let t=new Date(e);return isNaN(t)&&(t=xi.parse(e,this.owner.format)),t}get is24Hour(){return this.owner.is24Hour}attributeChangedCallback(e,t,n){var r;const i=this;switch(e){case"min":i.updateMin(n);break;case"max":i.updateMax(n);break;case"label":i._label=n,null===(r=i.inputs)||void 0===r||r.forEach((e=>e.setAttribute("aria-label",n)));break;case"disabled":i.disabled=n;break;case"tabindex":i.tabIndex=Number(n)}}updateMin(e){const t=null==e?null:xi.getTime(this.ingestDate(e));this.minValue=t,this.minHour=(null==t?void 0:t.getHours())||0}updateMax(e){const t=null==e?null:xi.getTime(this.ingestDate(e));this.maxValue=t,this.maxHour=(null==t?void 0:t.getHours())||(this.is24Hour?23:11)}onFocusIn(e){const t=this,{target:n}=e,r=t.getAriaLabel();var i;"INPUT"===n.tagName&&(n.value=`00${n.value}`.slice(-2),null===(i=n.setSelectionRange)||void 0===i||i.call(n,0,2));t.setAttribute("aria-label",r),t._root.activeElement.setAttribute("aria-label",r),t._root.contains(e.relatedTarget)||ir.isMouseDown()||t.focusField(0),e.stopImmediatePropagation()}onClick(e){const{target:t}=e,{owner:n}=this;t===this.ampmButton&&(n.readOnly||(t.innerText=t.innerText===xi.amIndicator?xi.pmIndicator:xi.amIndicator,this.onValueMutated(),e.stopPropagation()))}onFocusOut({target:e}){this.onValueMutated(),this.isCleared||e===this.ampmButton||(e.value=`0${parseInt(e.value)}`.slice(-2))}onKeyDown(e){var t,n,r,i;const s=this,{subfieldIndex:o}=s,{editable:a,readOnly:l}=s.owner,{amIndicator:d,pmIndicator:c}=xi,{target:u,key:h}=e;if(!(e.ctrlKey||e.cmdKey||e.metaKey||e.shiftKey&&"Tab"!==h&&1!==h.length))switch(h){case"Tab":s.inputs[e.shiftKey?0:s.inputs.length-1].focus();break;case" ":(u===s.ampmButton||l)&&e.stopImmediatePropagation();break;case"ArrowLeft":e.preventDefault(),e.stopPropagation(),o>0&&!e.altKe&&s.focusField(o-1);break;case":":if(u===s.ampmButton){e.preventDefault();break}case"ArrowRight":e.preventDefault(),e.stopPropagation(),o<s.inputs.length-1&&s.focusField(o+1);break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),l||s[s.owner.pickerVisible?"decrementSubfield":"incrementSubfield"](u);break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),l||s[s.owner.pickerVisible?"incrementSubfield":"decrementSubfield"](u);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"Backspace":case"Delete":a&&!l||e.preventDefault();break;case"Escape":break;case null==d||null===(t=d[0])||void 0===t?void 0:t.toLocaleLowerCase():case null==d||null===(n=d[0])||void 0===n?void 0:n.toLocaleUpperCase():if(!l&&!s.is24Hour){e.preventDefault(),s.ampmButton.innerText=d,s.onValueMutated();break}case null==c||null===(r=c[0])||void 0===r?void 0:r.toLocaleLowerCase():case null==c||null===(i=c[0])||void 0===i?void 0:i.toLocaleUpperCase():if(e.preventDefault(),!l&&!s.is24Hour){e.preventDefault(),s.ampmButton.innerText=c,s.onValueMutated();break}default:e.preventDefault()}}onInput({target:e}){const t=this,{value:n}=e;if(1===n.length||2===n.length&&1===e.selectionStart&&1===e.selectionEnd)e.setSelectionRange(1,2);else{if(n){if(2===e.selectionEnd){const{subfieldIndex:e}=this;e<t.inputs.length-1&&t.focusField(e+1)}}else e.value="00",e.setSelectionRange(0,2);e!==t.hour||"00"!==n||t.is24Hour||(t.ampmButton.innerText=xi.amIndicator),t.activeElement=e,t.onValueMutated(),t.activeElement=null}}decrementSubfield(e){var t;const{subfieldIndex:n,step:r,isPM:i}=this;if(e===this.ampmButton)e.innerText=i?xi.amIndicator:xi.pmIndicator;else{const t=this.getSubFieldValue(n),i=r<Mp[n-1]&&r>Mp[n+1]?r/Mp[n]:1,s=Math.floor(t/i)*i-i;0!==n||this.is24Hour||12!==t||(this.ampmButton.innerText=xi.amIndicator),e.value=s}this.onValueMutated(),null===(t=e.setSelectionRange)||void 0===t||t.call(e,0,2)}incrementSubfield(e){var t;const{subfieldIndex:n,step:r,is24Hour:i,isPM:s}=this;if(e===this.ampmButton)e.innerText=s?xi.amIndicator:xi.pmIndicator;else{const e=this.inputs[n],t=this.getSubFieldValue(n),o=r<Mp[n-1]&&r>Mp[n+1]?r/Mp[n]:1,a=Math.floor(t/o)*o+o;if(0!==n||this.is24Hour||11!==t||(this.ampmButton.innerText=xi.pmIndicator),0===n){if((s&&!i?t+12:t)===(this.maxHour||23))return}e.value=a}this.onValueMutated(),null===(t=e.setSelectionRange)||void 0===t||t.call(e,0,2)}createStructure(e=this.owner.format){var t;const n=this,{_root:r,tabIndex:i,is24Hour:s,silentChangeValue:o}=n,{amIndicator:a}=xi,l=new Date(1970,0,1,1,2,3),d=xi.format(l,e).trim(),c=n.delimiter=null===(t=d.match(Rp))||void 0===t?void 0:t[1],u=[...d.matchAll(new RegExp(`\\d+${c?`|\\${c}`:""}|${a}|[^\\${c}\\d]+`,"g"))].map((e=>e[0])),h=[];n.names=[],n.labelElId=`${n.owner.id}-label-element`,n.silentChangeValue=!0,null!=i&&n.setAttribute("tabIndex",i);let g,m=0;for(let e=0,t=0,{length:r}=u;e<r;e++){const r=u[e],i=e?59:s?23:11;r.trim()===a?(g=!0,n.names.push(`${xi.amIndicator}/${xi.pmIndicator}`),h.push({tag:"button","aria-label":n.getAriaLabel(m),reference:"ampmButton",id:"am-pm",type:"button",text:a,dataset:{subfieldIndex:m++}})):r.match(xp)?(n.names.push(xi.getLocalizedNameOfUnit(Tp[t])),h.push({tag:"input","aria-label":n.getAriaLabel(m),id:Tp[t],reference:Tp[t++],size:2,maxlength:2,minlength:2,dataset:{subfieldIndex:m++,max:i}})):r===c?h.push({tag:"span",text:c,reference:"delimiter"}):h.push({reference:"junk",tag:"span",text:r.replaceAll(" "," ")})}"delimiter"===h[h.length-1].reference&&h.length--,s||g||(n.names.push(`${xi.amIndicator}/${xi.pmIndicator}`),h.push({tag:"button",reference:"ampmButton",id:"am-pm",type:"button",text:a,dataset:{subfieldIndex:m++}})),n.silentChangeValue=o,h.push({tag:"style",text:"\n        :host {\n            display:flex\n        }\n        * {\n            font-size:inherit;\n            font-family:inherit;\n            color:inherit;\n            background-color:inherit\n        }\n        input,button {\n            padding:0;\n            margin:0;\n            border:0 none;\n            outline:0 none;\n            background-color:var(--timefield-input-background-color);\n            text-align:center\n        }\n        input {\n            width:2ch;\n        }\n        #am-pm {\n            margin-inline:5px\n        }\n        #am-pm:focus-visible {\n            outline:none;\n            background-color:var(--timefield-button-background-color)\n        }"}),ud.sync({targetElement:r,refOwner:n,domConfig:{onlyChildren:!0,children:h}}),n.inputs=[...r.querySelectorAll("input")],n.minute||(n.owner.step="1 h"),s?n.ampmButton=null:n.inputs.push(n.ampmButton)}attachRef(e,t){this.byRef[e]=this[e]=t}detachRef(e){this[e]=null,delete this.byRef[e]}getAriaLabel(e=this.subfieldIndex){const{owner:t}=this;return`${t.ariaLabel||t.label||""} ${this.innerText}${null!=e?` - ${this.names[e]}`:""}.`}getSubFieldValue(e){const{date:t}=this;return t?t[kp[e]]():0}setSubFieldValue(e,t,n){(e="number"==typeof e?this.inputs[e]:"string"==typeof e?this[e]:e)&&(t<10&&(e!==this.activeElement||2===e.value.length)&&(t=`0${t}`),e.value!=t&&(e.value=t,n||this.onValueMutated()))}set value(e){const{_value:t}=this;e=this._value=e?this.ingestDate(e):null,this.isConnected&&e-t&&this.updateValue(e,t)}updateValue(e,t=null){if(Number(e)!=Number(t)){var n;const r=this,{ampmButton:i}=r,s=r.getAriaLabel();if(e){const{hour:t,minute:n,second:s}=r,o=e.getHours();r.is24Hour?r.setSubFieldValue(t,o,!0):(i.innerText=o>11?xi.pmIndicator:xi.amIndicator,r.setSubFieldValue(t,o>12?o%12:o,!0)),n&&r.setSubFieldValue(n,e.getMinutes(),!0),s&&r.setSubFieldValue(s,e.getSeconds(),!0)}else r._value=xi.clearTime(t),r.inputs.forEach((e=>e.value="")),i&&(i.innerText=xi.amIndicator);r.setAttribute("value",xi.format(e,r.owner.format)),null===(n=r._root.activeElement)||void 0===n||n.setAttribute("aria-label",s),r.setAttribute("aria-label",s),r.silentChangeValue||r.owner.sycingInputFieldValue||r.dispatchEvent(new InputEvent("change"))}}onValueMutated(){const{date:e,minValue:t,maxValue:n}=this,r=e?new Date(e):null;e&&(t&&xi.getTime(r)<xi.getTime(t)?(r.setHours(t.getHours(),t.getMinutes(),t.getSeconds()),this._value=null):n&&xi.getTime(r)>xi.getTime(n)&&(r.setHours(n.getHours(),n.getMinutes(),n.getSeconds()),this._value=null)),this.value=r}set disabled(e){e=Boolean(e),this._disabled!==e&&(this._disabled=e,e?this.setAttribute("disabled",!0):this.removeAttribute("disabled"))}set tabIndex(e){this._tabIndex=e}get tabIndex(){return this._tabIndex}get subfieldIndex(){const{activeElement:e}=this.shadowRoot;return e&&parseInt(e.dataset.subfieldIndex)}get isPM(){var e;return this.is24Hour?parseInt(this.hour.value||0)>11:(null===(e=this.ampmButton.firstChild)||void 0===e?void 0:e.data)===xi.pmIndicator}get value(){return this.date}get innerText(){return xi.format(this.silentChangeValue?this._value:this.date,this.owner.format)||""}get date(){var e,t,n;const r=this,{_value:i}=r;if(!r.isConnected)return i||null;if(r.isCleared)return null;const s=new Date(r._value),o=parseInt((null===(e=r.hour)||void 0===e?void 0:e.value)||0),a=parseInt((null===(t=r.minute)||void 0===t?void 0:t.value)||0),l=parseInt((null===(n=r.second)||void 0===n?void 0:n.value)||0);let d=o;if(!r.is24Hour){var c;const e=(null===(c=r.ampmButton.firstChild)||void 0===c?void 0:c.data)===xi.pmIndicator;12!==o||r.isPM?o<12&&e&&(d+=12):d=0}return s.setHours(d,a,l),s}get rawDate(){var e,t,n;const r=new Date(this._value);return r.setHours(parseInt((null===(e=this.hour)||void 0===e?void 0:e.value)||0),parseInt((null===(t=this.minute)||void 0===t?void 0:t.value)||0),parseInt((null===(n=this.second)||void 0===n?void 0:n.value)||0)),r}get isCleared(){var e;return Boolean(!(null!==(e=this.inputs)&&void 0!==e&&e.map((e=>e.value.trim())).join("")))}focusField(e){const t=this.inputs[e];var n;t&&(t.focus(),null===(n=t.setSelectionRange)||void 0===n||n.call(t,0,2))}}"undefined"==typeof customElements||customElements.get("bry-time")||customElements.define("bry-time",Fp);class Ip extends ym{static $name="TimeField";static type="timefield";static alias="time";static configurable={inputElementTag:"bry-time",picker:{type:"timepicker",scrollAction:"realign",align:{align:"t0-b0",minHeight:200,axisLock:!0,matchSize:"min"}},role:"textbox",format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",key:" ",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:{$config:null,default:!0},value:{$config:{equal:"date"},value:null},keepDate:!0};static delayable={syncInvalid:{type:"buffer",delay:300}};get inputElement(){const e=super.inputElement;return e.tag="bry-time",e.label=this.label,e.elementData={owner:this},e}changePicker(e,t){const n=this,r=n.pickerWidth||(null==e?void 0:e.width);return Ep.reconfigure(t,e,{owner:n,defaults:{step:n.step,value:n.value,forElement:n.pickerAlignElement,owner:n,is24Hour:n.is24Hour,align:{matchSize:null==r,anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},width:r,onTimeChange({source:e,time:t}){n._isUserAction=!0,e._isUserAction&&e.hide(),n.value=t,n.min&&!n.is24Hour&&n._picker.widgetMap.hour.store.filter(),n._isUserAction=!1}}})}selectAll(){}syncInputFieldValue(){const e=this;e.sycingInputFieldValue=!0,super.syncInputFieldValue(...arguments),e.sycingInputFieldValue=!1,e.syncInvalid(),e.pickerVisible&&(e.picker.value=e.value)}get inputValue(){return this._value}get needsInputSync(){return String(this.input[this.inputValueAttr])!==String(this.inputValue??"")}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=xi.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e.value=n)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=xi.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e.value=n)}}get isValid(){const e=this;e.clearError("L{minimumValueViolation}",!0),e.clearError("L{maximumValueViolation}",!0);let t=e.input.date;if(t){if(t=xi.getTime(t),e._min&&xi.getTime(e._min)>t)return e.setError("L{minimumValueViolation}",!0),!1;if(e._max&&xi.getTime(e._max)<t)return e.setError("L{maximumValueViolation}",!0),!1}return super.isValid}internalOnChange(e){const t=this;t.inputting=!0,t._value=t.input.date,t.pickerVisible&&(t.picker.value=t.input.date),super.internalOnChange(...arguments),t.inputting=!1}internalOnKeyEvent(e){if(this.pickerVisible&&("Escape"===e.key&&(this.value=this.pickerValueOnShow),"Enter"===e.key))return this.hidePicker(),void e.preventDefault();super.internalOnKeyEvent(e)}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime?this.keepDate?e-t!=0:!xi.isSameTime(e,t):super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:n}=e;e.readOnly||(t.value=null,t.format=e.format,t.max=e.max,t.min=e.min,super.showPicker(),t.value=e.pickerValueOnShow=n,n||(e.value=t.value))}transformTimeValue(e){null!=e&&("string"==typeof e?(e=xi.parse(e,this.format),this.keepDate&&e&&this.value&&(e=xi.copyTimeValues(new Date(this.value),e))):e=new Date(e),xi.isValidDate(e)?this.keepDate||(e=xi.getTime(e)):e=null);const t={value:e};return this.trigger("transformTimeValue",t),e=t.value}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(null==e?t.removeAttribute("min"):t.setAttribute("min",e)),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(null==e?t.removeAttribute("max"):t.setAttribute("max",e)),this.syncInvalid()}changeValue(e,t){const n=this,r=n.transformTimeValue(e);if(e&&!r||n.isRequired&&""===e)n.setError("L{invalidTime}");else{if(n.clearError("L{invalidTime}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:n}=this.triggers;this.syncInputFieldValue(!0),n&&e&&(n.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){var n,r;const i=typeof e;return e?("number"===i?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===i&&(e=xi.parseDuration(e)),null!==(n=e)&&void 0!==n&&n.unit&&null!==(r=e)&&void 0!==r&&r.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):{magnitude:5,unit:"minute"}}updateStep(e){const{_picker:t}=this;this.input.step=e&&xi.as("s",e.magnitude,e.unit),t&&xi.as("m",e)<30&&(t.step=e),this.syncInvalid()}get is24Hour(){return xi.is24HourFormat(this.format)}updateFormat(e,t){const n=this;if(!n.isConfiguring){n._format=t;const{input:r}=n,{value:i}=r;n._format=e,n.sycingInputFieldValue=!0,r.createStructure(e),r.updateValue(i,NaN),n.syncInputFieldValue(!0),n.sycingInputFieldValue=!1}}updateLocalization(){super.updateLocalization(),this.input.isConnected&&this.input.createStructure(),this.syncInputFieldValue(!0)}}Ip.initClass(),Ip._$name="TimeField";var Ap=e=>class extends(e.mixin($h)){static configurable={altFormats:["YYYY-MM-DD"],dateFieldDefaults:{type:"datefield",autoSelect:!0,picker:null,step:"1d",internalListeners:{change:"up.onDateFieldChange"},triggers:{expand:null,back:{align:"end",weight:101}}},fieldEndDate:{ref:"fieldEndDate",cls:"b-end-date",weight:40},fieldStartDate:{ref:"fieldStartDate",cls:"b-start-date",weight:30,internalListeners:{focusIn:"up.onStartDateFocusIn",focusOut:"up.onStartDateFocusOut"}},dateStepTriggers:null,format:"ddd, MMM D",keyMap:{ArrowDown:"stepDown",ArrowUp:"stepUp","Ctrl+ArrowDown":"stepDownLarge","Ctrl+ArrowUp":"stepUpLarge"},pickingStartDate:null,stepLarge:"1 month",stepSmall:"7 days",validateDateOnly:!0,value:{$config:{type:"date[]",formats:["format","altFormats"]}}};static fenced={syncValue:!0};static prototypeProperties={_lastValue:null};get dateFieldDefaults(){return W.merge({format:this.format},this._dateFieldDefaults)}configureDateField(e,t,n){const r=this,{dateStepTriggers:i}=r;return wp.reconfigure(t,e,{owner:r,defaults:W.assign({stepTriggers:!0===i||"both"===i||i===n},r.dateFieldDefaults)})}changeFieldEndDate(e,t){return this.configureDateField(e,t,"end")}updateFieldEndDate(e){var t;e&&(null===(t=this.dateFieldContainer)||void 0===t||t.add(e))}changeFieldStartDate(e,t){return this.configureDateField(e,t,"start")}updateFieldStartDate(e){var t;e&&(null===(t=this.dateFieldContainer)||void 0===t||t.add(e))}updateFormat(e){this.isConstructing||(this.fieldEndDate.format=e,this.fieldStartDate.format=e)}updatePickingStartDate(e){this.element.classList.toggle("b-picking-start-date",Boolean(e))}updateValue(e,t){var n;null===(n=super.updateValue)||void 0===n||n.call(this,e,t),this.syncValue("value",e)}stepDown(e){this.adjustByKey(e,this.stepSmall)}stepUp(e){this.adjustByKey(e,"-"+this.stepSmall)}stepDownLarge(e){this.adjustByKey(e,this.stepLarge)}stepUpLarge(e){this.adjustByKey(e,"-"+this.stepLarge)}adjustByKey(e,t){const n=this,{_isUserAction:r}=n,{target:i}=e,s=[n.fieldStartDate,n.fieldEndDate],o=((i===s[0].input?1:i===s[1].input&&2)||0)-1,a=s[o],l=[s[0].value,s[1].value],d=null==l[0]||null==l[1];l[o]=xi.add(l[o]??n.defaultDate(o,l),t),l[1-o]=l[1-o]??l[o],l[1]<l[0]&&(l[1-o]=l[o]),n.checkValid(l)&&(n._isUserAction=!0,d?n.value=l:(s[0].value=l[0],s[1].value=l[1]),n._isUserAction=r),a.selectAll(),e.preventDefault()}checkMinMax(e=this.value){const{maxDate:t,minDate:n,validateDateOnly:r}=this;let i,s,o=0;if(e&&(n||t))for(i of(s=Array.isArray(e)?e:[e],s))if(i=r?xi.clearTime(i):i,o=n&&i<n?-1:t&&i>t?1:0,o)break;return o}checkValid(e=this.value){return!this.checkMinMax(e)}defaultDate(e,t){const{minDate:n,maxDate:r}=this,i=xi.clearTime(new Date);return i<n||i>r?n:i}hasChanged(e,t){return!W.isEqual(e,t)}onDateFieldChange({source:e,userAction:t}){const n=this,{fieldEndDate:r,fieldStartDate:i,_isUserAction:s}=n;n._isUserAction=t||s,n.syncValue(e.ref,[i.value,r.value]),n._isUserAction=s}onStartDateFocusIn(){this.pickingStartDate=!0}onStartDateFocusOut(e){this.pickingStartDate=!1}syncValue(e,t=this.value){const n=this;"fieldEndDate"!==e&&(n.fieldEndDate.value=t&&t[1]),"fieldStartDate"!==e&&(n.fieldStartDate.value=t&&t[0]),"value"!==e&&(n.value=t),!n.isConstructing&&n.hasChanged(n._lastValue,t)&&n.checkValid(t)&&n.triggerChange(),n._lastValue=t}get widgetClass(){}};const{isArray:Lp}=Array,Pp=e=>12*e.getFullYear()+e.getMonth(),Op=/material/i;class $p extends(qm.mixin($h)){static $name="MultiDatePicker";static type="multidatepicker";static configurable={configureSlot:"configureDatePicker",disableReserveSlots:"inert",slots:2,baseDate:{$config:"day",value:"today"},cellRenderer:null,headerRenderer:null,weekRenderer:null,weekStartDay:null,date:{$config:"day",value:"today"},minDate:{$config:"day"},maxDate:{$config:"day"},datePickerDefaults:{type:"datepicker",activeDate:null,animateTimeShift:!1,dayNameFormat:"d1",multiSelect:"range",trapFocus:!1,internalListeners:{selectionChange:"up.onDatePickerSelectionChange"},tbar:{items:{prevMonth:{onAction:"up.onPrevMonthClick"},nextMonth:{onAction:"up.onNextMonthClick"},fields:{items:{monthField:{disabled:!0},yearButton:{disabled:!0}}}}},yearPicker:{internalListeners:{select:"up.onYearPickedMulti"}}},includeYear:e=>!e.getMonth(),items:{prevButton:{type:"button",positionable:"before",cls:"b-multidatepicker-nav-button b-multidatepicker-prev-button b-icon b-icon-previous",onAction:"up.onPrevMonthClick",hideMode:"opacity"},nextButton:{type:"button",positionable:"after",cls:"b-multidatepicker-nav-button b-multidatepicker-next-button b-icon b-icon-next",onAction:"up.onNextMonthClick",hideMode:"opacity"}},multiSelect:null,navButtons:!0,selection:{$config:"day[]"}};static fenced={syncSelection:!0};get datePickers(){return this.items.filter((e=>e.isDatePicker))}compose(){var e;const{navButtons:t}=this;return{class:{"b-multidatepicker-nav-buttons":t,[`b-multidatepicker-nav-${!0===t?Op.test((null===(e=Yn.getThemeInfo())||void 0===e?void 0:e.name)||"")?"floating":"inline":t}`]:t}}}onInternalPaint(e){if(e.firstPaint){const e=this,{date:t}=e;t&&e.unanimated((()=>{e.scrollPos=e.posFromIndex(e.indexFromDate(t))}))}super.onInternalPaint(e)}applyDate(e,t,n){var r;const i=this,s=null==t?void 0:t.containsFocus,{_isUserAction:o}=i;let{selection:a}=i,l=s?n:t;!a||s&&e>=a[1]?(l=n,a=[e,e]):s?a=[e,a[1]||e]:e<a[0]?(l=n,a=[e,a[1]||e]):a=[a[0]||e,e],null===(r=l)||void 0===r||r.focus(),i._isUserAction=!0,i.selection=a,i._isUserAction=o}changeIncludeYear(e){return"number"==typeof e&&(e=[e]),Lp(e)?t=>e.includes(t.getMonth()+1):e}configureDatePicker(e,t,n){const{includeYear:r}=t,i=xi.add(t.baseDate,e,"month");let s={date:i,activeDate:null,includeYear:r(i),multiSelect:t.multiSelect,selection:t.selection,weekStartDay:t.weekStartDay};return n||(s=bp.mergeConfigs(t.datePickerDefaults,s,{cellRenderer:t.cellRenderer,headerRenderer:t.headerRenderer,weekRenderer:t.weekRenderer})),s}ensurePlan(e){return xi.isDate(e)&&(e={date:e}),e.date&&delete(e={...e,index:this.indexFromDate(e.date)}).date,e}getCell(e){return"string"!=typeof e&&(e=xi.makeKey(e)),this.element.querySelector(`[data-date="${e}"]:not(.b-other-month)`)}indexFromDate(e){return e?Pp(e)-Pp(this.baseDate):e}onDatePickerSelectionChange({selection:e,userAction:t}){if(t){const t=this,{_isUserAction:n}=t;t._isUserAction=!0,t.syncSelection("picker",e),t._isUserAction=n}}onNextMonthClick(){this.forward()}onPrevMonthClick(){this.backward()}onYearPickedMulti({source:e,value:t}){const n=e.up("datepicker"),{focusableElement:r}=n;null==r||r.focus({preventScroll:!0}),e.hide(),t-=n.activeDate.getFullYear(),this.go(12*t)}updateAtMax(e,t){const{nextButton:n,prevButton:r}=this.widgetMap;super.updateAtMax(e,t),n&&(n.containsFocus&&(null==r||r.focus()),n.isTabbable=!e,n.hidden=e)}updateAtMin(e,t){const{nextButton:n,prevButton:r}=this.widgetMap;super.updateAtMin(e,t),r&&(r.containsFocus&&(null==n||n.focus()),r.isTabbable=!e,r.hidden=e)}changeDate(e){return e&&xi.clamp(e,this.minDate,this.maxDate)}updateDate(e){null!=e&&(this.currentIndex=this.indexFromDate(e))}updateMaxDate(){this.syncDateRange()}updateMinDate(){this.syncDateRange()}syncDateRange(){this.range=[this.minDate,this.maxDate]}updateNavButtons(e){this.detachListeners("navButtons"),!0===e&&ir.ion({theme:()=>this.recompose(),name:"navButtons",thisObj:this})}changeRange(e,t){if(Lp(e)){let t,[n,r]=e;xi.isDate(n)&&(n=this.indexFromDate(n),t=!0),xi.isDate(r)&&(r=this.indexFromDate(r),t=!0),t&&(e=[n,r])}return super.changeRange(e,t)}changeSelection(e,t){return e&&W.isEqual(e,t)&&(e=t),e}updateSelection(e){const t=this;t.syncSelection("selection",e),t.isConfiguring?e&&(t.date=e[0]):t.trigger("selectionChange",{selection:e,userAction:t._isUserAction})}syncSelection(e,t=this.selection){const{datePickers:n}=this;"selection"!==e&&(this.selection=t),"picker"!==e&&n.forEach((e=>e.selection=t))}}$p.initClass(),$p._$name="MultiDatePicker";class _p extends($p.mixin(Ap)){static $name="DateRangePicker";static type="daterangepicker";static configurable={confirmable:null,datePickerDefaults:{focusable:!1,internalListeners:{beforeDateSelect:"up.onDatePickerBeforeDateSelect"}},keyMap:{delegate:"confirmable"},multiSelect:"range",selection:["today","today"],stripDefaults:{bbar:{type:"confirmationbar"}},tbar:{items:{spacer:{type:"widget",flex:1,weight:0}}}};get dateFieldContainer(){return this.tbar}changeConfirmable(e){return this.bbar=e,this.bbar}updateConfirmable(e){this.detachListeners("confirmable"),null==e||e.ion({name:"confirmable",thisObj:this,choice:"doConfirm"})}get isValid(){return this.checkValid()}configureDatePicker(e,t,n){const r=super.configureDatePicker(e,t,n);return r.selection=this.selection,r}onDatePickerBeforeDateSelect({date:e}){return this.applyDate(e,this.fieldStartDate,this.fieldEndDate),!1}doConfirm({choice:e,event:t,userAction:n}){this.trigger("confirm",{choice:e,event:t,userAction:n})}internalOnKeyDown(e){const{confirmable:t}=this;let n=null==t?void 0:t.hotKeys[e.virtualKey];n?("default"===n&&(n=t.defaultButton),n&&this.doConfirm({event:e,choice:{[n]:!0,name:n}})):super.internalOnKeyDown(e)}syncSelection(e,t=this.selection){super.syncSelection(e,t),"value"!==e&&this.syncValue("selection",t)}syncValue(e,t=this.value){var n,r;const i=this,s=(null===(n=t)||void 0===n?void 0:n[1])<(null===(r=t)||void 0===r?void 0:r[0]);let o;"fieldEndDate"===e?(o=2,s&&(t=[t[1],t[1]])):"fieldStartDate"===e&&(o=1,s&&(t=[t[0],t[0]])),o&&t&&!i.isConstructing&&i.ensureVisible(t[o-1]),"selection"!==e&&i.syncSelection("value",t),super.syncValue(e,t)}triggerChange(e,t=Boolean(this._isUserAction)){const{value:n,_lastValue:r,isValid:i}=this;this.triggerFieldChange({value:n,oldValue:r,event:e,userAction:t,valid:i})}}_p.initClass(),_p._$name="DateRangePicker";const Hp=new Date;class Vp extends(ym.mixin(Ap)){static $name="DateRangeField";static type="daterangefield";static alias="daterange";static configurable={inline:!0,confirmable:null,container:{},confirmableDefaults:{type:"daterangepicker",navButtons:"floating",trapFocus:!0,align:{align:"t100-t100",offset:'[data-ref="fieldEndDate"]',overlap:!0},fieldStartDate:{triggers:{expand:{align:"start",disabled:!0}}}},fieldEndDate:{internalListeners:{triggerKey:"up.onTriggerKey"},triggers:{expand:null}},fieldEndTime:null,fieldEndTimeDefaults:{ref:"fieldEndTime",cls:"b-end-time",weight:20},fieldStartDate:{internalListeners:{triggerKey:"up.onTriggerKey"},triggers:{expand:{handler:"up.onExpandPicker",align:"start"}}},fieldStartTime:null,fieldStartTimeDefaults:{ref:"fieldStartTime",cls:"b-start-time",weight:10},keepTime:null,keyMap:{ArrowDown:"onTriggerKeyDown",ArrowUp:"onKeyArrowUp",Enter:"onKeyEnter",Escape:"onKeyEscape","Shift+Backspace":"onKeyClear"},max:{$config:{type:"date",formats:["format","altFormats"],strict:!0}},min:{$config:{type:"date",formats:["format","altFormats"],strict:!0}},nonConfirmableDefaults:{type:"multidatepicker",align:{align:"t100-r100"},datePickerDefaults:{focusable:!1,internalListeners:{beforeDateSelect:"up.onDatePickerBeforeDateSelect"}}},picker:{cls:"b-daterangefield-picker",floating:!0,hideMode:"clip",multiSelect:"range",scrollAction:"realign",align:{axisLock:!0}},pickerAlignElement:"container.element",pickerCls:null,pickTime:null,stepSmall:"7 days",timeFormat:"HH:mm:ss:SSS",triggers:{expand:null},weekStartDay:null,timeFieldDefaults:{type:"timefield",autoSelect:!0,picker:{align:{align:"b0-t0"}},triggers:{expand:null}}};get dateFieldContainer(){return this.container}get innerElements(){return[]}get maxDate(){return this.max}get minDate(){return this.min}compose(){const{pickTime:e}=this;return{class:{"b-pick-time":Boolean(e)}}}updateClearable(e){const{fieldEndDate:t}=this;t.clearable=e,e&&(t.triggers.clear.handler=()=>this.clear())}updateConfirmable(){this.isConstructing||(this.picker=this._pickerConfig)}changeEndTimeField(e,t){return Ip.reconfigure(t,e,{owner:this,defaults:Ip.mergeConfigs(this.timeFieldDefaults,this.fieldEndTimeDefaults)})}updateEndTimeField(e){e&&this.container.add(e)}changeStartTimeField(e,t){return Ip.reconfigure(t,e,{owner:this,defaults:Ip.mergeConfigs(this.timeFieldDefaults,this.fieldStartTimeDefaults)})}updateStartTimeField(e){e&&this.container.add(e)}updateKeepTime(e){e=!this.pickTime&&e,this.fieldEndDate.keepTime=e,this.fieldStartDate.keepTime=e}updateMax(e){const{fieldEndDate:t,fieldStartDate:n,_picker:r}=this;t.max=e,n.max=e,r&&(r.maxDate=e),this.syncInvalid()}updateMin(e){const{fieldEndDate:t,fieldStartDate:n,_picker:r}=this;t.min=e,n.min=e,r&&(r.minDate=e),this.syncInvalid()}changePicker(e,t){const n=this,{confirmable:r,pickerAlignElement:i}=n,s=r?n.confirmableDefaults:n.nonConfirmableDefaults,o=oc.resolveType(s.type),a=o.mergeConfigs({owner:n,forElement:i,minDate:n.min,maxDate:n.max,selection:n.value,weekStartDay:n._weekStartDay,align:{anchor:n.overlayAnchor,target:i}},s,r&&{confirmable:r});return n._pickerConfig=e,W.isObject(e)&&(e=W.merge({type:a.type},e)),o.reconfigure(t,e,{owner:n,defaults:a})}updatePicker(e,t){super.updatePicker(e,t),this.detachListeners("dateRangeField.picker"),null==e||e.ion({name:"dateRangeField.picker",thisObj:this,selectionChange:"onPickerSelectionChange",confirm:"onPickerConfirm",focusIn:"onPickerFocusIn"})}updatePickerCls(e,t){var n;const r=null===(n=this.picker)||void 0===n||null===(n=n.element)||void 0===n?void 0:n.classList;t&&(null==r||r.remove(t)),e&&(null==r||r.add(e))}updatePickTime(e){let t=null,n=null;!0===e?t=n={}:e&&(e.fieldStartTime||e.fieldEndTime?(n=e.fieldStartTime,t=e.fieldEndTime):n=t=e),this.fieldEndTime=t,this.fieldStartTime=n}changeValue(e){const t=this,n=t.L("L{DateField.invalidDate}")(xi.format(Hp,t.format));if(!e||xi.isDate(e[0])&&xi.isDate(e[1]))return t.clearError(n),e;t.setError(n)}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:xi.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}maybeHidePicker(){if(!this.picker.isVisible||this.confirmable)return!1;this.hidePicker()}onDatePickerBeforeDateSelect({date:e}){return this.picker.applyDate(e,this.fieldStartDate,this.fieldEndDate),!1}onDateFieldChange({source:e}){const t=this,{ref:n}=e,r="fieldStartDate"===n?0:1,{pickTime:i}=t;let s,o,a,l,d;t.isConstructing||(s=e.value,o=1-r,l=t.value,s&&(i?(a=r?t.fieldStartTime:t.fieldEndTime,s=xi.combineDateAndTime(s,a.value)):s=xi.clearTime(s),d=[s,s],l&&(d[o]=l[o],d[1]<d[0]&&(d[o]=xi.combineDateAndTime(s,d[o]),d[1]<d[0]&&(d[o]=s))),t.syncValue(n,d)))}onKeyArrowUp(e){const t=this,{picker:n}=t;if(n.isVisible)return!t.confirmable&&t.stepUp(e);t.showPicker()}onKeyClear(){this.clearable&&this.clear()}onKeyEnter(){this.maybeHidePicker()}onKeyEscape(){this.maybeHidePicker()}onExpandPicker(){this.confirmable?this.showPicker():this.togglePicker()}onPickerSelectionChange({selection:e,userAction:t}){if(!this.confirmable){const n=this,{_isUserAction:r}=n;n._isUserAction=t||r,n.syncValue("picker",e),n._isUserAction=r}}onPickerConfirm({choice:e,source:t,userAction:n}){const r=this,{_isUserAction:i}=r,s=t.containsFocus&&(t.pickingStartDate?r.fieldStartDate:r.fieldEndDate);e.ok&&(r._isUserAction=n||i,r.syncValue("picker",t.value),r._isUserAction=i),r.hidePicker(),null==s||s.focus()}onPickerFocusIn({relatedTarget:e}){const{fieldEndDate:t,fieldStartDate:n}=this.container.widgetMap,r=e===n?n:t;!this.confirmable&&r.focus()}onTriggerKeyDown(e){return this.picker.isVisible&&!this.confirmable?this.stepDown(e):super.onTriggerKeyDown(e)}focusPicker(){const{picker:e}=this,{fieldEndDate:t,fieldStartDate:n}=this.container.widgetMap,{tbar:r}=e,{fieldEndDate:i,fieldStartDate:s}=(null==r?void 0:r.widgetMap)||{},o=r?t.containsFocus&&i||s:t.containsFocus&&t||n;o.focus(),o!==e&&(e.ensureVisible({animate:!1,date:o.value}),o.selectAll())}showPicker(e){const t=this,{_picker:n}=t;t.readOnly||(n&&n.setConfig({range:[t.min,t.max],selection:t.value}),e=e||Boolean(t.confirmable),super.showPicker(e))}get isValid(){const e=this,t=e.checkMinMax();return e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0),t?(e.setError(t<0?"L{Field.minimumValueViolation}":"L{Field.maximumValueViolation}",!0),!1):super.isValid}setupLabel(e){return super.setupLabel(W.assign({for:this.fieldStartDate.input.id},e))}syncInputFieldValue(){}syncValue(e,t=this.value){var n,r;const i=this,{_picker:s}=i,o=(null===(n=t)||void 0===n?void 0:n[1])<(null===(r=t)||void 0===r?void 0:r[0]);if(null!=s&&s.isVisible&&!i.confirmable){let n;"fieldEndDate"===e?(n=2,o&&(t=[t[1],t[1]])):"fieldStartDate"===e&&(n=1,o&&(t=[t[0],t[0]])),n&&t&&!i.isConstructing&&s.ensureVisible(t[n-1])}"picker"!==e&&s&&(s.selection=t),super.syncValue(e,t)}}Vp.initClass(),Vp._$name="DateRangeField";const Np=new Date(2e3,0,1);class Bp extends cm{static $name="DateTimeField";static type="datetimefield";static alias="datetime";static configurable={timeField:{type:"timefield"},dateField:{type:"datefield",keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"};doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get childItems(){return[this.dateField,this.timeField]}get fieldDefaults(){const{revertOnEscape:e,tabIndex:t}=this;return null==t?{revertOnEscape:e}:{revertOnEscape:e,tabIndex:t}}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e,t){return Ip.reconfigure(t,e,{owner:this,defaults:this.fieldDefaults})}updateTimeField(e){const t=this;Jt.on({element:e.element,keydown:"onTimeFieldKeyDown",thisObj:t}),ee.after(e,"syncInvalid",(()=>{t.timeField&&!t.updatingInvalid&&t.syncInvalid()})),e.ion({thisObj:t,change({userAction:e,value:n}){if(e&&!t.$settingValue){const e=t.dateField.value;t._isUserAction=!0,t.value=e?xi.copyTimeValues(new Date(e),n||Np):null,t._isUserAction=!1}}}),t.readOnly&&(e.readOnly=!0)}changeDateField(e,t){return wp.reconfigure(t,e,{owner:this,defaults:this.fieldDefaults})}updateDateField(e){const t=this;Jt.on({element:e.element,keydown:"onDateFieldKeyDown",thisObj:t}),ee.after(e,"syncInvalid",(()=>{t.dateField&&!t.updatingInvalid&&t.syncInvalid()})),e.ion({thisObj:t,change({userAction:e,value:n}){e&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value=n,t.value=n,t._isUserAction=!1)},keydown({event:e}){var n;"Tab"===e.key&&!e.shiftKey&&null!==(n=t.timeField)&&void 0!==n&&n.isVisible&&e.stopPropagation()}}),t.readOnly&&(e.readOnly=!0)}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t;return"number"==typeof e?e:(null===(t=this.dateField)||void 0===t?void 0:t.weekStartDay)??xi.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const t=this,{dateField:n,timeField:r}=t,i=n.highlightExternalChange,s=r.highlightExternalChange;e||t.highlightExternalChange||(e=!0),t.$isInternalChange=!0,n.highlightExternalChange=!1,n.highlightExternalChange=i,e&&(r.highlightExternalChange=n.highlightExternalChange=!1),r.value=n.value=t.inputValue,n.highlightExternalChange=i,r.highlightExternalChange=s,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if(!t.readOnly&&("Enter"===e.key||"Tab"===e.key)){const e=t.dateField.value;t._isUserAction=!0,t.value=e?xi.copyTimeValues(new Date(e),t.timeField.value||Np):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;"Tab"!==e.key||e.shiftKey?t.readOnly||"Enter"!==e.key||(t.value=t.dateField.value):(e.stopPropagation(),e.preventDefault(),t.timeField.focus())}updateRequired(e){super.updateRequired(e),this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){var n,r;return null!=e&&e.getTime&&null!=t&&t.getTime?!xi.isEqual(e,t):super.hasChanged(null==e||null===(n=e.getTime)||void 0===n?void 0:n.call(e),null==t||null===(r=t.getTime)||void 0===r?void 0:r.call(t))}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach((n=>n.setError(e,t)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach((n=>n.clearError(e,t)))}updateInvalid(){this.updatingInvalid=!0,this.dateField.updateInvalid(),this.timeField.updateInvalid(),this.updatingInvalid=!1}}Bp.initClass(),Bp._$name="DateTimeField";const{dockIsHorz:zp}=au.maps,jp={top:0,down:0,left:1,bottom:2,up:2,right:3},Wp={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}};class Up extends(au.mixin(Hi)){static $name="PanelCollapserOverlay";static type="overlay";static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;null===(e=this.collapsible)||void 0===e||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:t}=this;(t.suspended=null==e||e<0)||(t.delay=e,t.immediate=!e)}changeRecollapseTool(e){const t=this,{panel:n}=t;if(t.isConfiguring||t.isDestroying||!n||n.isDestroying)return e;n.tools={recollapse:e}}beforeCollapse(e){if(!1===super.beforeCollapse(e))return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,t=!0){var n;null===(n=this.panel)||void 0===n||n.recompose(),super.applyHeaderDock(e,t)}collapseBegin(e){const t=this,{collapseDir:n,innerElement:r}=t,{animation:i}=e,{collapseTool:s,panel:o}=t;t.configuredWidth=o._lastWidth,t.configuredHeight=o._lastHeight,t.applyHeaderDock(!0),t.lockInnerSize(),null==s||s.element.classList.add("b-collapsed"),i&&(o.element.classList.add("b-collapsing"),i.element=r,i.transform=Wp[n],e.animation=Pc.run(i))}onComplete(e){var t,n;super.onComplete(e);const r=this,{panel:i}=r,{element:s}=i;r.autoCloseLeaveDetacher=null===(t=r.autoCloseLeaveDetacher)||void 0===t?void 0:t.call(r),r.autoCloseClickDetacher=null===(n=r.autoCloseClickDetacher)||void 0===n?void 0:n.call(r),r.doAutoClose.cancel(),"reveal"===e&&r.autoClose&&(i.containsFocus&&(r.autoCloseLeaveDetacher=Jt.on({element:s,mouseenter:e=>{r.doAutoClose.cancel()},mouseleave:e=>{r.doAutoClose()}})),r.autoCloseClickDetacher=Jt.on({element:document.body,thisObj:i,mousedown:e=>{var t;i.owns(e)||null!==(t=r.revealer)&&void 0!==t&&t.contains(e.target)||null==r.autoCloseDelay||r.doAutoClose.now()}})),r.hasPainted||"collapse"!==e||r.innerElement.offsetHeight}expandBegin(e){const t=this,{animation:n}=e,{collapseDir:r,collapseTool:i,innerElement:s,panel:o}=t,{element:a}=o;a.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1),t.lockInnerSize(),null==i||i.element.classList.remove("b-collapsed"),n&&(a.classList.add("b-collapsed","b-expanding"),n.element=s,n.transform={from:Wp[r].to,to:Wp[r].from},e.animation=Pc.run(n))}expandEnd(e){super.expandEnd(e);const{panel:t}=this;e.completed&&(t.revealed=!1),t.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const{direction:e}=this,t=super.toolsConfig,n=this.recollapseTool;return n?{...t,recollapse:n&&W.assign({direction:e.toLowerCase()},n)}:t}lockInnerSize(e=!0){const t=this,{panel:n}=t,r=e&&n.rectangle(),i=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(i[jp[t.collapseDir]]=`-${r[t.collapseDim]+10}px`),n.element.style.clipPath=e?`inset(${i.join(" ")})`:"",s}onOverlayTransitionDone(e){const t=this,{panel:n}=t;e.srcElement===n.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(n.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}toggleReveal(e){const{panel:t}=this,{element:n}=t;t.collapsed&&(this.revealer=Yn.getActiveElement(n),null==e&&(e=!t.revealed),t.revealed!==e&&!1!==t.trigger("beforeToggleReveal",{reveal:e})&&(!e&&n.matches(":focus-within")&&t.revertFocus(!0),this.revealing=!0,t.revealed=e,n.getBoundingClientRect()))}updateRevealing(e){const t=this,{panel:n}=t,r=/left|right/i.test(t.collapseDir)?"height":"width";n&&(t.innerElement.style[r]="0px",t.innerElement.style[`min-${r}`]="100%",n.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,t){var n;const r=this,{collapseDir:i,panel:s}=r,{expandedHeaderDock:o,header:a,uiClassList:l}=s,d=null===(n=s.tools)||void 0===n?void 0:n.recollapse,[c,u]=r.splitHeaderItems({as:"element",dock:r.collapseDock}),h=zp[o],g=s.hasHeader?s.title||(null==a?void 0:a.title)||" ":null;return d&&(d.direction=i),["overlayElement",{class:{...l,[`b-panel-overlay-header-${o}`]:1,[`b-panel-overlay-${i}`]:1,[`b-${h?"h":"v"}box`]:1,"b-panel-overlay":1,"b-box-center":1},listeners:{transitionend:e=>r.onOverlayTransitionDone(e),transitioncancel:e=>r.onOverlayTransitionDone(e)},children:{overlayHeaderElement:g&&{tag:"header",class:new Vt({...l,[`b-dock-${o}`]:1,"b-panel-header":1,"b-panel-overlay-header":1},null==a?void 0:a.cls),children:[...c,{reference:"overlayTitleElement",html:g,class:{...l,[`b-align-${(null==a?void 0:a.titleAlign)||"start"}`]:1,"b-header-title":1}},...u]},[e]:t}}]}}Up.initClass(),Up._$name="PanelCollapserOverlay";const Gp={lineNumber:0,column:0},Yp={lineNumber:Number.MAX_SAFE_INTEGER,column:Number.MAX_SAFE_INTEGER},qp=c.isBryntumOnline(["online"]),{pathname:Kp}=globalThis.location,Xp=Kp.endsWith("umd.html"),Zp=document.querySelector("script[type=module]"),Jp=Kp.endsWith("module.html")||(null==Zp?void 0:Zp.src.includes("app.module.js"))||Kp.endsWith("index.html")&&qp;class Qp extends np{static $name="DemoCodeEditor";static type="democodeeditor";static configurable={mode:"vanilla",appFolder:"",collapsible:{type:Up.type,direction:"right",autoClose:!1},collapsed:!0,preferredSources:null,monitorResize:!1,editor:{lineNumbers:"off",foldingImportsByDefault:!0,minimap:{enabled:!1},ariaLabel:"Live code editor"},tbar:{overflow:null,items:{filesCombo:{type:Dm.type,flex:"1 1 100%",monitorResize:!1,editable:!1,fields:[{name:"text"}],listItemTpl:({text:e})=>{let t="b-fa-file";switch(e.split(".").pop()){case"js":case"mjs":case"jsx":case"ts":case"mts":case"tsx":case"vue":t="b-fa-file-lines";break;case"css":case"scss":t="b-fa-palette";break;case"htm":case"html":case"json":t="b-fa-file-code"}const n=e.lastIndexOf("/")+1;return`<span class="b-editor-file-type b-fw-icon ${t}" ></span> <span class="b-editor-folder">${e.substring(0,n)}</span>${e.substring(n)}`},picker:{maxHeight:"calc(100vh * 3 / 4)"}}}},codeCache:{}};construct(e={}){super.construct(...arguments);const t=this,{rtl:n}=t;n&&(t.collapsible.direction="left"),new dh({targetSelector:".b-codeeditor",rightHandle:Boolean(n),leftHandle:!n,skipTranslate:!0,minWidth:190})}static get isModule(){return Jp}get isVanilla(){return"vanilla"===this.mode}get isFramework(){return"framework"===this.mode}updateMode(){this.title='<span class="title-container"><span class="title">'+(this.isVanilla?"L{CodeEditor.editor}":"L{CodeEditor.viewer}")+"</span></span>"}static loadMonacoEditor=async e=>{if(!np.monacoLoadPromise){const t=Yn.createElement({tag:"script",parent:document.head,src:`${e}monaco-editor/min/vs/loader.js`});await new Promise((e=>t.addEventListener("load",e))),await(np.monacoLoadPromise=new Promise((t=>{const n=globalThis.require;n.config({paths:{vs:`${e}monaco-editor/min/vs`}}),n(["vs/editor/editor.main"],(function(){t(globalThis.monaco)}))})))}};onCloseClick(){this.collapse()}async onFilesComboChange({value:e}){await this.loadCode(e)}async collapseBoilerplate(e){const{monacoInstance:t,editor:n}=this,{Selection:r}=t,i=[],s=e.findMatches("^import .*$",!0,!0);let o,a=!0;["baselines","children","segments","intervals","events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges","rows"].forEach((t=>{const n=`${t}\\s*(?:=|:)\\s*\\[`;for(o=e.findForwards(n,Gp,!0);o&&a;o=e.findForwards(n,a.range.getEndPosition(),!0))if(a=e.findForwards("\\](?:;|,)?\\s*$",o.range.getEndPosition(),!0),a){for(;a&&i.some((e=>e.containsRange(a.range)));)a=e.findForwards("\\](?:;|,)?\\s*$",a.range.getEndPosition(),!0);a&&i.push(new r(o.range.startLineNumber,1,a.range.endLineNumber+1,1))}}));let l,d=Gp;for(;l=e.findForwards("^\\s*//\\s*hide",d,!0);){const t=e.findForwards("^\\s*//\\s*end(?:-|(?:\\s*))?hide",{lineNumber:l.range.endLineNumber,column:0},!0);t&&i.push(new r(l.range.startLineNumber,1,t.range.endLineNumber+1,1)),d=(null==t?void 0:t.range.getEndPosition())||Yp}for(d=Gp;l=e.findForwards("^\\s*//\\s*region",d,!0);){const t=e.findForwards("^\\s*//\\s*end(?:-|(?:\\s*))?region",{lineNumber:l.range.endLineNumber,column:0},!0);t&&i.push(new r(l.range.startLineNumber,1,t.range.endLineNumber+1,1)),d=(null==t?void 0:t.range.getEndPosition())||Yp}s.length&&i.push(new r(1,1,s[s.length-1].range.startLineNumber+1,1));for(const e of i)n.setSelections([...n.getSelections(),e]),await n.getAction("editor.createFoldingRangeFromSelection").run()}set status(e){this.widgetMap.status.html=e}get isReadOnly(){return this.isFramework||"html"===this.fileExt||"js"===this.fileExt&&(this.hasImports||Xp)}toggleReadOnly(){const e=this,{contentElement:t,isReadOnly:n}=e;t.classList.toggle("readonly",n),e.status=n?"Read only"+(c.isCSP?" (Restricted by Content Security Policy)":c.isChrome||c.isFirefox?"":" (try it on Chrome or Firefox)"):"Idle",e.editor.updateOptions({readOnly:n})}async loadCode(e){e=`${this.appFolder}${e}`;const t=this,{isVanilla:n}=t;let r=t.codeCache[e],i=null;if(t.filename=e,!r)try{const n=await vr.get(location.href.replace(/[^/]*$/,"")+e);r=t.codeCache[e]=await n.text()}catch(e){r="",i=e}t.loadedCode=r,t.fileExt=e.split(".").pop();let s="plaintext";switch(t.fileExt){case"js":case"mjs":case"jsx":s="javascript";break;case"ts":case"mts":case"tsx":case"vue":s="typescript";break;case"css":s="css";break;case"scss":s="scss";break;case"htm":case"html":s="html";break;case"json":s="json"}t.language=s;const o=t.model=await t.loadText(r,s);o.findForwards=function(e,t){const n=o.findNextMatch(...arguments);if(n&&!n.range.getStartPosition().isBefore(t))return n},n&&"js"===t.fileExt&&await t.collapseBoilerplate(o),t.status=`${i?i.message:"Idle"}`,t.toggleReadOnly()}sortFileNamesWithHierarchy(e){const t=e=>{const n={};return Object.keys(e).sort(((t,n)=>{const r=null!==e[t],i=null!==e[n];return r&&!i?-1:!r&&i?1:t.localeCompare(n)})).forEach((r=>{n[r]=null!==e[r]?t(e[r]):e[r]})),n},n=(e,t="")=>{let r=[];return Object.keys(e).forEach((i=>{const s=`${t}${""!==t?"/":""}${i}`;null===e[i]?r.push(s):r=r.concat(n(e[i],s))})),r};return n(t((e=>{const t={};return e.forEach((e=>{const n=e.split("/");let r=t;n.forEach(((e,t)=>{r[e]||(r[e]=t===n.length-1?null:{}),r=r[e]}))})),t})(e)))}async initialLoadCode(){const e=this,{widgetMap:t,preferredSources:n}=e,{filesCombo:r}=t,i=r.store,s=`${e.appFolder}app.config.json`,o=(await vr.get(s,{parseJson:!0})).parsedJson,a=[],l=c.isBryntumOnline("online");if(e.isVanilla){var d,u;const t=null===(d=o.index)||void 0===d||null===(d=d.bundles)||void 0===d?void 0:d.includes("es6");a.push(!Jp||l||t?Xp?"index.umd.html":"index.html":"index.module.html",!Jp&&!l||t?Xp?"app.umd.js":"app.js":"app.module.js"),Jp||Xp||null===(u=o.merge)||void 0===u||!u.length||(e.hasImports=!0,a.push(...o.merge)),document.head.querySelector('[href*="app.css"]')&&a.push("resources/app.css")}else o.source.length?a.push(...o.source):console.warn(`No source files loaded from ${s}`);r.items=e.sortFileNamesWithHierarchy(a).map((e=>({text:e,value:e})));const h=(n||[]).map((e=>i.find((t=>e.test(t.value))))).find(Boolean)||i.first;r.value=h.value,await e.loadCode(h.value),r.onChange="up.onFilesComboChange",e.toggleReadOnly(),r.readOnly=1===i.count}static get monacoCodePath(){const e=/(.*?\/)examples/.exec(document.location.href);return e?`${e[1]}examples/_shared/browser/lib/monaco-editor`:void 0}static async toggleCodeEditor(e,t,n){return!e&&(e=new Qp({mode:"framework",appendTo:document.body,codePath:Qp.monacoCodePath,appFolder:"../",...n}),oc.disableThrow=!0,t.icon="b-icon-spinner",await e.initialLoadCode(),t.icon="b-icon-code"),e.collapsed?(await e.expandPanel(),e.focus()):await e.collapsePanel(),e}}function ef(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tf;Qp.initClass(),Qp._$name="DemoCodeEditor";class nf extends Dc{static $name="DemoHeader";static type="demoheader";static#e=ef(this,"configurable",{insertFirst:"container",appFolder:"../",cls:"demo-header",items:[{type:"container",id:"title-container",items:[{type:"container",tag:"a",id:"title",elementAttributes:{href:this.titleLink},items:[{html:(document.title??"Demo").split("-").pop().trim(),tag:"h1",tooltip:(null===(tf=document.querySelector('meta[name="description"]'))||void 0===tf?void 0:tf.content)??""}]}]},{type:Hu.type,id:"tools",style:{border:"none",height:"2.8em"},defaults:{style:{margin:0},cls:"b-raised b-blue"},items:["->",{ref:"trialButton",type:"button",text:"Download Trial",cls:"b-green b-raised",href:"#",hidden:!0},{ref:"codeButton",type:"button",tooltip:"Click to show the code viewer",icon:"b-icon-code",onClick:"up.toggleCodeEditor",hidden:!0},{ref:"downloadButton",type:"button",tooltip:"Download this demo zip archive",icon:"b-icon-download",href:"#",hidden:!0},{ref:"fullscreenButton",type:"button",tooltip:"Full screen",icon:"b-icon-fullscreen",onClick(){hd.enabled&&(hd.isFullscreen?hd.exit():hd.request(document.body))}}]}]});construct(...e){super.construct(...e),this.setupToolbar()}static get titleLink(){const e=/(.*?\/)(examples.*?\/frameworks\/.*?)\/(build|out|dist)/.exec(document.location.href);return e?`${e[1]}examples/#example-${e[2].replace(/\//gm,"-").replace("examples-frameworks","frameworks")}`:"#"}async toggleCodeEditor(){this.codeEditor=await Qp.toggleCodeEditor(this.codeEditor,this.widgetMap.tools.widgetMap.codeButton,{appFolder:this.appFolder,preferredSources:[/App\.[jt]sx?/,/\w+Config\.[jt]sx?/,/index\.[jt]sx?/]})}async setupToolbar(){const{location:e}=document,t=e.search.includes("test");if(e.href.match(/examples\/frameworks/)||t){var n,r;const i=(null===(n=e.href.match(/\/(\w+)(-trial)?\/[-\w]*examples\//))||void 0===n?void 0:n[1].toLowerCase())||"grid",{widgetMap:s}=this.widgetMap.tools,{downloadButton:o,trialButton:a}=s;Object.values(s).forEach((e=>e.hidden=!1)),a.href=`https://bryntum.com/download/?product=${i}`;const l=null===(r=await vr.get(`${this.appFolder}/app.config.json`,{parseJson:!0}).catch((()=>{})))||void 0===r?void 0:r.parsedJson;null!=l&&l.zip||t?o.href=`${this.appFolder}${l.zip}`:o.hidden=!0,Nl.insertRule("body { flex-direction : row !important }"),Nl.insertRule("#container { flex: 1 !important; overflow : hidden !important }")}}}nf._$name="DemoHeader";class rf extends vm{static $name="DurationField";static type="durationfield";static alias="duration";static get defaultConfig(){return{value:null,defaultUnit:"day",useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null,step:1,unit:null,magnitude:null}}changeMin(e){return"string"==typeof e?new qs(e):e}changeMax(e){return"string"==typeof e?new qs(e):e}changeAllowedUnits(e){return"string"==typeof e&&(e=e.split(",")),e.length>0&&!e.includes(this.defaultUnit)&&(this.defaultUnit=e[0]),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`^(${e.join("|")})$`,"i")}get inputValue(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation,this.decimalPrecision)}updateUnit(){this.clearError("L{invalidUnit}"),super.value=this.calcValue()}updateMagnitude(){this.clearError("L{invalidUnit}"),super.value=this.calcValue()}get unitWithDefault(){return this.unit||this.defaultUnit}roundMagnitude(e){return e&&null!=this.decimalPrecision?W.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=e.input.value,n=xi.parseDuration(t,e.allowDecimals,t.match(/[\p{Letter}\p{Mark}]+/giu)?void 0:e.unitWithDefault),r=!t||n&&null==n.magnitude;return e.skipValidation||super.isValid&&(r&&!e.required||!r&&(e.allowNegative||(null==n?void 0:n.magnitude)>=0))}internalOnChange(e){const t=this,n=t.value,r=t._lastValue;t.hasChanged(r,n)&&(t._lastValue=n,t.triggerFieldChange({value:n,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t;return this.syncInputFieldValue(!0),null===(t=this.triggers)||void 0===t||null===(t=t.spin)||void 0===t||null===(t=t.clickRepeater)||void 0===t||t.cancel(),super.onFocusOut(e)}set value(e){const t=this;let n,r;if(t.getConfig("allowedUnits"),t.clearError("L{invalidUnit}"),"number"==typeof e||"string"==typeof e&&e.length>0&&!isNaN(e))n=Number(e),r=t.unitWithDefault;else if("string"==typeof e)if(/^\s*$/.test(e))n=null;else{const i=xi.parseDuration(e,t.allowDecimals,t.unitWithDefault);i&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(i.unit)?(r=i.unit,n=i.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,n=e.magnitude):(r=null,n=null);t.magnitude===n&&t.unit==r||(t._magnitude=n,r&&(t.unit=r),super.value=t.calcValue())}okMax(e){return"number"==typeof e&&(e=new qs({unit:this.unitWithDefault,magnitude:e})),null==this.max||e<=this.max}okMin(e){return"number"==typeof e&&(e=new qs({unit:this.unitWithDefault,magnitude:e})),null==this.min||e>=this.min}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this,{magnitude:n}=t;return t.unit&&null!=n||!t.clearable?new qs(e?t.roundMagnitude(n):n,t.unitWithDefault):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!(e.unit===t.unit&&e.isEqual(t))}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){const t=this,{_isUserAction:n}=t;t._isUserAction=!0,"ArrowUp"===e.key?t.doSpinUp():"ArrowDown"===e.key&&t.doSpinDown(),t._isUserAction=n}doSpinUp(){const e=this;let{value:t}=e;if(e.readOnly)return;W.isEmpty(t)&&(t=new qs({magnitude:0,unit:this.defaultUnit}));let n=t.add(this._step);e.okMin(n)||(n=e.min),e.okMax(n)&&(e.value=n)}doSpinDown(){const e=this;let{value:t}=e;if(e.readOnly)return;W.isEmpty(t)&&(t=new qs({magnitude:0,unit:this.defaultUnit}));let n=t.add({magnitude:-this._step.magnitude,unit:this._step.unit});e.okMax(n)||(n=e.max),e.okMin(n)&&(e.allowNegative||(e.magnitude||0)>0)&&(e.value=n)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:void 0}:"string"===n&&(e=xi.parseDuration(e)),e&&e.unit&&e.magnitude&&e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):null}updateStep(e){this.element.classList.toggle("b-no-steppers",Boolean(e)),this.syncInvalid()}}rf.initClass(),rf._$name="DurationField";class sf extends Dc{static $name="Editor";static type="editor";static configurable={positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,appendToTargetParent:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0,instantUpdate:!1,floating:!1};afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),Jt.on({element:e.element,keydown:"onEditorKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide"}),Cr.ion({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}render(e){const t=this.element.parentNode,[n]=this.getRenderContext(this,e);n.classList.add("b-editing"),super.render(...arguments),null!=t&&t.classList&&n!==t&&t.classList.remove("b-editing")}async startEdit(e){const t=this;if(e=W.assignIf(e,{align:t.align,hideTarget:t.hideTarget,matchSize:t.matchSize,matchFont:t.matchFont,fitTargetContent:t.fitTargetContent,focus:!0}),t.isVisible&&await t.completeEdit(),!1!==t.trigger("beforeStart",e)){var n,r,i;const{target:s,hideTarget:o,matchSize:a,matchFont:l,fitTargetContent:d,record:c,field:u=t.inputField.name,focus:h}=e,{inputField:g,appendToTargetParent:m}=t,{input:p}=g,f=Yn.getStyleValue(s,"font-size"),v=Yn.getStyleValue(s,"font-family");let{value:y,align:b}=e;if(c&&u&&(t.record=c,t.dataField=u,g.assignFieldValue!==oc.prototype.assignFieldValue?y=g.value:void 0===y&&(y=c.getValue(u))),m&&s.nodeType===Node.ELEMENT_NODE&&s.parentElement.appendChild(t.element),a&&(s instanceof HTMLElement&&t.updateSize(s,a),s instanceof HTMLElement&&fd.addResizeListener(s,t.onTargetSizeChange)),p&&(l?(p.style.fontSize=f,p.style.fontFamily=v):p.style.fontSize=p.style.fontFamily=""),t.assigningValues=!0,null===(n=g.clearError)||void 0===n||n.call(g),"setValue"in g?await g.setValue(y):g.value=y,t.assigningValues=!1,"string"==typeof b&&(b={align:b}),await t.showBy({target:s,allowTargetOut:!0,...b}),d){const e=p.scrollWidth-p.clientWidth;e>0&&(t.width+=e+Yn.scrollBarWidth)}h&&(null===(r=g.focus)||void 0===r||r.call(g)),s.nodeType===Element.ELEMENT_NODE&&o&&s.classList.add("b-hide-visibility"),t.editing=!0;const C=g.value;return t.trigger("start",{value:C}),Array.isArray(C)&&g.editingRecords&&null!==(i=C[0])&&void 0!==i&&i.isModel?t.oldValue=C.map((e=>e.copy(e.id))):(t.oldValue=C,Array.isArray(t.oldValue)&&(t.oldValue=t.oldValue.slice())),g.initialValue=t.oldValue,!0}return!1}async refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:n,owner:r}=this;if(e&&(((null==r?void 0:r.readOnly)||e.readOnly)&&this.cancelEdit(),t)){const r=e.getValue(t);W.isEqual(n.value,r)||await n.setValue(r)}}}finishEdit(){const{target:e,aligningToElement:t}=this.lastAlignSpec;t&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("afterEdit",{record:this.record})}onEditorKeyDown(e){var t;const n=this;switch(e.key){case n.completeKey:e.preventDefault(),e.stopImmediatePropagation(),n.completeEdit(null,e);break;case n.cancelKey:n.cancelEdit(e),e.stopImmediatePropagation()}null===(t=n.trigger)||void 0===t||t.call(n,"keyDown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const t=this;if(!t.isFinishing&&t.editing)switch(t.blurAction){case"cancel":t.cancelEdit(e);break;case"complete":t.completeEdit(null,e)}}async completeEdit(e,t){const n=this,{inputField:r,oldValue:i,record:s}=n,o=r.invalidAction||(!1===r.allowInvalid?"block":n.invalidAction),{value:a}=r;if(n.isVisible){if(r.isValid||"allow"===o){if(W.isEqual(a,i))return!1!==n.cancelEdit(t);{(null==t?void 0:t.key)&&t.stopPropagation();const u={inputField:r,record:s,value:a,oldValue:i};if(!1!==await n.trigger("beforeComplete",u)){var l;if(!e)e=u.finalize||(null===(l=u.editorContext)||void 0===l?void 0:l.finalize);if(e){let t=await e(u);if(!0===t)n.onEditComplete();else{if(r.setError){const e=t||r.invalidValueError,n=()=>{i(),r.clearError(e)},i=r.ion({change:n,input:n});r.setError(e)}var d;if("block"===o)null===(d=r.focus)||void 0===d||d.call(r);else"revert"===o&&(await r.setValue(i),t=!0);t=!1}return t}return n.onEditComplete(),!0}var c;null===(c=r.focus)||void 0===c||c.call(r)}}else{var u;if((null==t?void 0:t.key)&&t.preventDefault(),"block"===o)return null===(u=r.focus)||void 0===u||u.call(r),!1;if("revert"===o)return!1!==n.cancelEdit(t)}return!1}}cancelEdit(e){const t=this,{inputField:n,oldValue:r}=t,{value:i}=n;if(!t.editing||t.isFinishing||!1===t.trigger("beforeCancel",{value:i,oldValue:r,event:e}))return null==e||e.preventDefault(),!1;var s;null===(s=n.clearError)||void 0===s||s.call(n),t.isFinishing=!0,t.hide(),"Escape"===(null==e?void 0:e.key)&&e.stopImmediatePropagation(),t.trigger("cancel",{value:i,oldValue:r,event:e}),t.finishEdit(),t.isFinishing=!1}onEditComplete(){const e=this,{record:t,dataField:n,inputField:r,oldValue:i}=e;let{value:s}=r;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t&&(!e.instantUpdate||r._outstandingUpdate)){const e=`set${N.capitalize(n)}`;!t.isFieldModified(n)||null!=t.getUnmodified(n)||null!=s&&""!==s||(s=t.meta.modified[n]),t[e]?t[e](s):t.setValue(n,s)}e.trigger("complete",{value:s,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||oc.fromElement(this.element.parentNode)}changeInputField(e,t){const n=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof oc||(e.type||(e.type="textfield"),e=oc.create(e),n.createdInputField=!0),n.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:n}),e.parent=n,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,n){t&&n&&this.updateSize(e)}updateSize(e,t=this.lastMatchSize){const n=this,r=Ot.inner(e);n.width=!1===t.width?"auto":r.width-n.align.offset[0],n.height=!1===t.height?"auto":r.height,n.lastMatchSize=t}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){var e;this.positioned&&this.element.remove(),fd.removeResizeListener(null===(e=this.lastAlignSpec)||void 0===e?void 0:e.target,this.onTargetSizeChange)}}sf.initClass(),sf._$name="Editor";class of{static $name="NumberHelper";static getLocalizedFormatter(e){return"currency"!==(null==e?void 0:e.style)||e.currency||(e.currency=Cr.locale.NumberFormat.currency),"string"==typeof e?Ys.get({locale:Cr.localeCode,template:e}):null!=(null==e?void 0:e.locale)?Ys.get(e):Ys.get(Object.assign({},e,{locale:Cr.localeCode}))}}of._$name="NumberHelper";const af=e=>e.ctrlKey&&e.preventDefault();class lf extends cm{static $name="NumberField";static type="numberfield";static alias="number";static get configurable(){return{wrapAround:null,min:null,max:null,step:1,largeStep:0,value:null,format:"",triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let n=!isNaN(e);if(n&&!this.hasTextSelection){n=!1;const e=this.input.value,r=parseFloat(e);e!==t&&(n=!this.acceptValue(r,e))}return n}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,n=e.key;let r;if("ArrowUp"===n)t.doSpinUp(e.shiftKey),r=!0;else if("ArrowDown"===n)t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&n&&1===n.length){const e=t.getAfterValue(n),i=t.formatter.parseStrict(e);r=!(i===t.value||"-"===e&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(i,e)}"Enter"===n&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this,n=t.formatter.is.percent?100:1,r=(e?t.largeStep:t.step)/n;if(t.readOnly)return;let i=(t.value||0)+r;t.okMin(i)||(i=t.min),t.okMax(i)?t.applySpinChange(i):t.wrapAround&&(i=t.min,t.applySpinChange(i))}doSpinDown(e=!1){const t=this,n=t.formatter.is.percent?100:1,r=(e?t.largeStep:t.step)/n;if(t.readOnly)return;let i=(t.value||0)-r;t.okMax(i)||(i=t.max),t.okMin(i)?t.applySpinChange(i):t.wrapAround&&(i=t.max-t.max%r,t.applySpinChange(i))}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t;super.onFocusOut(...arguments);const n=this,{input:r}=n,i=r.value,s=n.formatter.truncate(i),o=isNaN(s)?i:n.formatValue(s);null===(t=n.triggers)||void 0===t||null===(t=t.spin)||void 0===t||null===(t=t.clickRepeater)||void 0===t||t.cancel(),n.lastTouchmove=null,i!==o&&(r.value=o),n._changedBySilentSpin&&(n.triggerChange(e,!0),n._changedBySilentSpin=!1)}internalOnInput(e){var t;const n=this,{formatter:r,input:i}=n,{parser:s,maximumFractionDigits:o}=r,a=i.value;if(null!==(t=e.data)&&void 0!==t&&t.length&&!isFinite(s.parse(a))&&"-"!==a){const e=n._lastValue||n.valueOnFocus;n.queueMicrotask((()=>{n._value=NaN,n.value=e}))}else{const t=s.decimalPlaces(a);if(r.truncator&&t>o){let e,l=a;const d=r.truncate(a);if(!isNaN(d)&&(l=n.formatValue(d),e=s.decimalPlaces(l),e<o&&(l+="0".repeat(o-e),e=o),e<t)){const e=a.length-n.caretPos;i.value=l,n.caretPos=l.length-e+1}}super.internalOnInput(e)}}formatValue(e){return this.formatter.format(e)}get formatter(){return this._formatter??(this._formatter=of.getLocalizedFormatter(this.format))}updateStep(e){const t=this;var n;(t.element.classList.toggle("b-hide-spinner",!e),t._step=e,e&&c.isMobile)?t.touchMoveListener||(t.touchMoveListener=Jt.on({element:t.input,touchmove:"onInputSwipe",thisObj:t,throttled:{buffer:150,alt:af}})):null===(n=t.touchMoveListener)||void 0===n||n.call(t)}onInputSwipe(e){const{lastTouchmove:t}=this;if(t){const n=e.screenX-t.screenX,r=t.screenY-e.screenY;this["doSpin"+((Math.abs(n)>Math.abs(r)?n:r)>0?"Up":"Down")]()}e.preventDefault(),this.lastTouchmove=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const n=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?n.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&n.format&&(e=n.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){return null!=this.value?this.formatValue(this.value):""}updateLocalization(){super.updateLocalization(),this._formatter=void 0,this.syncInputFieldValue()}}lf.initClass(),lf._$name="NumberField";const df={number:!0,boolean:!0,string:!0,date:!0,duration:!0,time:!0,auto:!0},cf={number:!0,boolean:!0,string:!0},uf=e=>{var t;return"duration"===(null==e||null===(t=e.column)||void 0===t?void 0:t.type)},hf="b-fieldfilterpicker",gf={between:!0,notBetween:!0,isIncludedIn:!0,isNotIncludedIn:!0},mf={textfield:!0,datefield:!0,numberfield:!0,durationfield:!0,combo:!0,timefield:!0},pf={value:"empty",text:"L{isEmpty}",argCount:0},ff={value:"notEmpty",text:"L{isNotEmpty}",argCount:0},vf={value:"=",text:"L{equals}"},yf={value:"!=",text:"L{doesNotEqual}"},bf={value:">",text:"L{isGreaterThan}"},Cf={value:"<",text:"L{isLessThan}"},wf={value:">=",text:"L{isGreaterThanOrEqualTo}"},Sf={value:"<=",text:"L{isLessThanOrEqualTo}"},Df={value:"between",text:"L{isBetween}",argCount:2},Ef={value:"notBetween",text:"L{isNotBetween}",argCount:2},xf={value:"isIncludedIn",text:"L{isOneOf}",isArrayValued:!0},Rf={value:"isNotIncludedIn",text:"L{isNotOneOf}",isArrayValued:!0},Tf=e=>{const{value:t}=e;return e.isTimeField&&t?xi.getTime(t):t};class Mf extends Dc{static $name="FieldFilterPicker";static type="fieldfilterpicker";static defaultOperators={string:[pf,ff,vf,yf,{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},xf,Rf],number:[pf,ff,vf,yf,bf,Cf,wf,Sf,Df,Ef,xf,Rf],date:[pf,ff,{value:"sameDay",text:"L{equals}"},{value:"notSameDay",text:"L{doesNotEqual}"},{value:"sameTime",text:"L{timeEquals}"},{value:"notSameTime",text:"L{timeDoesNotEqual}"},{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},Df,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},xf,Rf],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[pf,ff,vf,yf,bf,Cf,wf,Sf,Df,Ef,xf,Rf],time:[pf,ff,vf,yf,bf,Cf,wf,Sf,Df,Ef,xf,Rf],relation:[pf,ff,vf,yf,xf,Rf],auto:[{value:"*",text:"L{contains}"}]};static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",relation:"L{selectValue}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}",time:"L{selectATime}",auto:"L{enterAValue}"}}static#e=(()=>{ef(this,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,triggerChangeOnInput:!0,items:{inputs:{type:"container",layout:"hbox",cls:`${hf}-inputs`,items:{propertyPicker:{type:"combo",items:{},cls:`${hf}-property`,placeholder:"L{FieldFilterPicker.selectAProperty}",highlightExternalChange:!1},operatorPicker:{type:"combo",items:{},cls:`${hf}-operator`,placeholder:"L{FieldFilterPicker.selectAnOperator}",highlightExternalChange:!1},valueFields:{type:"container",cls:`${hf}-values`,items:{}}}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:`${hf}-case-sensitive`}},operators:Mf.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),ef(this,"buildOperatorArgCountLookup",(e=>nt.keyBy(Object.entries(e),(([e])=>e),(([,e])=>nt.keyBy(e,(({value:e})=>e),(({argCount:e})=>void 0===e?1:e))))))})();afterConstruct(){const e=this;if(!e._fields)throw new Error(`${Mf.name} requires 'fields' to be configured.`);if(!e._filter)throw new Error(`${Mf.name} requires 'filter' to be configured.`);super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:n,caseSensitive:r}}=e;t.ion({select:"onPropertySelect",thisObj:e}),n.ion({select:"onOperatorSelect",thisObj:e}),r.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&n.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,n.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:n}=this.widgetMap;return[e,t,...this.valueFields,n]}updateDisabled(e,t){super.updateDisabled(e,t),this.allChildInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){const{propertyPicker:t,operatorPicker:n}=this.widgetMap;this.allChildInputs.forEach((t=>t.readOnly=e)),t.readOnly=t.readOnly||e,n.readOnly=n.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=e??Mf.defaultOperators;return Object.keys(t).reduce(((e,n)=>({...e,[n]:t[n].map((e=>({...e,text:this.L(e.text)})))})),{})}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes(null===(e=this._filter)||void 0===e?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new Vt(`${hf}-property`,null===(e=this.propertyFieldConfig)||void 0===e?void 0:e.cls,{[`${hf}-combo-locked`]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new Vt(`${hf}-operator`,null===(e=this.operatorFieldConfig)||void 0===e?void 0:e.cls,{[`${hf}-combo-locked`]:this.operatorLocked})}getValueFieldConfigs(){var e;const t=this,{valueFieldCls:n,fieldType:r,_filter:{operator:i},onValueChange:s,filterValues:o,isMultiSelectValueField:a,operatorArgCount:l,getValueFieldConfig:d,fieldIsRelation:c,triggerChangeOnInput:u}=t,h=W.merge({},Mf.defaultValueFieldPlaceholders,t.valueFieldPlaceholders);if(!r||!i||0===l)return[];let g={type:"textfield",internalListeners:{change:s,input:u?s:null,thisObj:t},bubbleEvents:{keydown:!0},cls:n,dataset:{type:r},placeholder:t.L(h[a?"list":c?"relation":r]),highlightExternalChange:!1};var m;if(a||c?g={...g,type:"combo",multiSelect:a,createOnUnmatched:!0,items:t.getUniqueDataValues(o),value:o??[]}:"sameTime"===i||"notSameTime"===i?g.type="timefield":["number","date","boolean","duration","time"].includes(r)&&(g.type=`${r}field`),"date"===r&&"timefield"!==g.type)g.format=(null===(m=t.selectedField)||void 0===m?void 0:m.format)??t.dateFormat;else if("number"===r&&null!==(e=t.selectedField)&&void 0!==e&&e.format){var p;g.format=null===(p=t.selectedField)||void 0===p?void 0:p.format}return d&&(g=t.callback(d,t,[t.filter,g])),a?[g]:nt.populate(l,(e=>[{type:"widget",tag:"div",cls:`${hf}-value-separator`,content:t.L("L{FieldFilterPicker.and}")},{...g,value:o[e]}])).flat().slice(1)}getUniqueDataValues(e=[]){var t,n;const r=this,{fieldType:i}=r,s=null===(t=r.selectedField)||void 0===t?void 0:t.format;if(!r.store||null===(n=r._filter)||void 0===n||!n.property)return[];const{relatedDisplayField:o}=r.selectedField;let a,l;if(r.fieldIsRelation){const{foreignStore:e}=r.currentPropertyRelationConfig;o?(a=e.allRecords.reduce(((e,t)=>(null!=t.id&&e.push({text:t.getValue(o),value:t.id}),e)),[]),l=a.sort(((e,t)=>r.sortStrings(e.text,t.text)))):a=e.allRecords.map((e=>e.id))}else a=r.store.allRecords.map((e=>e.getValue(r._filter.property)));if(!l){a.push(...e);const t=nt.unique(a.reduce(((e,t)=>(null!=t&&""!==String(t).trim()&&("date"===i?e.push(t.valueOf()):"duration"===i?e.push(t.toString()):e.push(t)),e)),[]));if(l="string"===i?t.sort(r.sortStrings):"duration"===i?t.map((e=>new qs(e))).filter((e=>e.isValid)).sort(r.sortDurations):t.sort(r.sortNumerics),"date"===i)l=l.map((e=>{const t=new Date(e);return{text:xi.format(t,s??r.dateFormat),value:e}}));else if("number"===i&&s){const e=of.getLocalizedFormatter(s);l=l.map((t=>({text:e.format(t),value:t})))}else"duration"===i&&(l=l.map((e=>e.toString())))}return l}sortStrings(e,t){return(e??"").localeCompare(t??"")}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return null===(e=this.selectedField)||void 0===e?void 0:e.type}get selectedField(){var e,t;return null===(e=this.fields)||void 0===e?void 0:e[null===(t=this._filter)||void 0===t?void 0:t.property]}get propertyOptions(){return Object.entries(this.fields??{}).filter((([,e])=>df[e.type]||uf(e))).map((([e,{title:t}])=>({value:e,text:t??e}))).sort(((e,t)=>e.text.localeCompare(t.text)))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return Boolean(this.currentPropertyRelationConfig)}get currentPropertyRelationConfig(){var e;return null===(e=this.store)||void 0===e||null===(e=e.modelRelations)||void 0===e?void 0:e.find((({foreignKey:e})=>{var t;return e===(null===(t=this._filter)||void 0===t?void 0:t.property)}))}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=Mf.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;null===(t=this._store)||void 0===t||t.un(this),null==e||e.ion({refresh:"onStoreRefresh",thisObj:this}),this.inferFieldTypes()}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFields:t}=e.widgetMap,{valueFields:n,fieldType:r,operatorArgCount:i,_filter:{property:s,operator:o}}=e,a=gf[o],l="sameTime"===o||"notSameTime"===o?"time":r;t.element.className=new Vt({[`${hf}-values`]:!0,[`${hf}-values-multiple`]:a,[`${hf}-values-${l}`]:void 0!==r,"b-hidden":null==s||null==o||0===i});const d=e.getValueFieldConfigs();if(d.length!==n.length||d.some((({type:e},t)=>n[t].type!==e)))t.removeAll(),t.add(d);else{let e=0;for(const t of d)delete t.type,W.assign(n[e++],t)}delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const n=this,{fieldType:r,operatorArgCount:i,isMultiSelectValueField:s}=n,o=null===(e=n._filter)||void 0===e?void 0:e.operator,{caseSensitive:a}=n.widgetMap;a.hidden="string"!==r||!o||s||0===i,a.checked=!1!==(null===(t=n._filter)||void 0===t?void 0:t.caseSensitive)}onPropertySelect(e){var t;const n=this,{_filter:r}=n;r.property=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.fieldType!==n._fieldType&&(r.operator=null,r.value=null),n._fieldType=r.type=n.fieldType,n.refreshOperatorPicker(),n.refreshValueFields(),n.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const n=this,r=n.isMultiSelectValueField,i=this.operatorArgCount;n._filter.operator=(null===(t=e.record)||void 0===t?void 0:t.data.value)||null,n.operatorArgCount!==i&&(n._filter.value=null),n.isMultiSelectValueField&&!r&&(n._filter.value=[]),n.refreshValueFields(),n.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const{isMultiSelectValueField:e,fieldType:t,_filter:n}=this,r=this.valueFields.map(Tf);e&&"date"===t?n.value=r[0].map((e=>new Date(e))):e&&"duration"===t?n.value=r[0].map((e=>new qs(e))):("date"===t&&"between"===n.operator&&xi.isValidDate(r[1])&&r[1].setHours(23,59,59,999),n.value=1===r.length?r[0]:r),this.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:n},operatorOptions:r}=this;e.items=r,e.value=t,e.hidden=null===n}populateUIFromFilter(e=!1){const t=this,{filterValues:n,widgetMap:{propertyPicker:r,operatorPicker:i},_filter:{property:s,operator:o,disabled:a},propertyOptions:l,operatorOptions:d,isMultiSelectValueField:c}=t;r.items=l,i.items=d,i.hidden=null===s;let u=e;r.value!==s&&(r.value=s,t.refreshOperatorPicker(),u=!0),"date"===t.fieldType&&("="===o?t._filter.operator="sameDay":"!="===o&&(t._filter.operator="notSameDay")),i.value!==o&&(null!==o&&i.items.find((({value:e})=>e===o))?i.value=o:i.clear(),u=!0),o||1!==i.items.length||(i.value=t._filter.operator=i.items[0].value),u&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach(((e,r)=>{c&&(e.value.length>0||n.length>0)?"date"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.valueOf())):"duration"===t.fieldType?e.value=n.map((e=>null==e?void 0:e.toString())):e.value=n:r>=n.length?e.clear():e.value=n[r]})),t.allChildInputs.forEach((e=>e.disabled=t.disabled||a))}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFields.queryAll((e=>e.owner===this.widgetMap.valueFields&&mf[e.type])))}get filterValues(){var e;return null==(null===(e=this._filter)||void 0===e?void 0:e.value)?[]:nt.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,n=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(n)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:n}=this;return e&&t?n[e][t]:1}get isValid(){const{filter:e,fieldType:t,filterValues:n,isMultiSelectValueField:r,operatorArgCount:i}=this,{operator:s}=e,o=i>0&&null==(null==e?void 0:e.value);return Boolean(t&&s&&!o&&(r&&n.length>0||n.length===i)&&n.every((e=>null!=e&&("duration"!==t||e.isValid))))}get focusElement(){var e;return(null===(e=this.valueFields.find((e=>e.isEmptyInput))??this.operatorPicker??this.propertyPicker)||void 0===e?void 0:e.input)??super.focusElement}inferFieldTypes(){var e;if((null===(e=this.store)||void 0===e?void 0:e.totalCount)>0&&this.fields)for(const[e,t]of Object.entries(this.fields))"auto"===t.type&&(t.type=Mf.inferFieldType(this.store,e))}static inferFieldType(e,t){var n;const r=null===(n=e.find((e=>null!=e.getValue(t)),!0))||void 0===n?void 0:n.getValue(t);if(void 0!==r){const e=typeof r;if("object"===e&&r instanceof Date)return"date";if(cf[e])return e}return"auto"}static localizeOperator(e,t){const{defaultOperators:n}=Mf,r=Object.keys(n).sort(((e,n)=>e===t?-1:n===t?1:0));for(const t of r)for(const r of n[t])if(r.value===e)return Mf.L(r.text);return e}}Mf.initClass(),Mf._$name="FieldFilterPicker";class kf extends oc{static $name="Label";static type="label";static configurable={text:null,localizableProperties:["text"]};compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}kf.initClass(),kf._$name="Label";class Ff extends Dc{static $name="FieldFilterPickerGroup";static type="fieldfilterpickergroup";static addFilterButtonDefaultText="L{FieldFilterPickerGroup.addFilter}";static#e=(()=>{ef(this,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,triggerChangeOnInput:!0,allowedFieldNames:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:Ff.addFilterButtonDefaultText,cls:`b-${Ff.type}-add-button`,hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),ef(this,"childPickerType","fieldfilterpicker")})();afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup requires either a 'fields' or 'store' config property.")}updateFields(e){this.widgetMap.pickers.childItems.forEach((t=>t.fields=e))}updateFilters(e,t){const n=this;t&&t.filter((t=>!e.find((e=>e.id===t.id)))).forEach((e=>{var t;return null===(t=n.store)||void 0===t?void 0:t.removeFilter(e.id)})),e.forEach((e=>e.id=e.id||n.nextFilterId)),n.widgetMap.pickers.items=(null==e?void 0:e.map((e=>n.getPickerRowConfig(e))))||[]}changeFilters(e){const{canManageFilter:t,limitToProperty:n}=this;let r=e;return t&&(r=r.filter((e=>this.callback(t,this,[e])))),n&&(r=r.filter((e=>null==e.property||e.property===n))),r}updateStore(e){const t=this;if(t.detachListeners("store"),e){let n=!1;t.widgetMap.pickers.childItems.forEach((({widgetMap:{filterPicker:{filter:t,isValid:r}}})=>{r&&!e.filters.includes(t)&&(e.removeFilter(t.id,!0),e.addFilter(t,!0),n=!0)})),n&&e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})}t.widgetMap.pickers.childItems.forEach((t=>t.store=e))}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=e??Ff.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach((t=>{var n;const r=e.canManage(t),{property:i,operator:s,id:o}=t;r&&i&&s&&(null===(n=e.filters)||void 0===n||!n.find((e=>e.id===o)))&&e.appendFilter(t)}))}canManage(e){const t=this;return(!t.allowedFieldNames||t.allowedFieldNames.includes(e.property))&&(!t.canManageFilter||!0===t.callback(t.canManageFilter,t,[e]))}getFilterPickerConfig(e){const t=this,{fields:n,store:r,disabled:i,readOnly:s,valueFieldCls:o,operators:a,limitToProperty:l,dateFormat:d,getFieldFilterPickerConfig:c,triggerChangeOnInput:u,allowedFieldNames:h}=t;return{type:t.constructor.childPickerType,fields:n??t.getFieldsFromStore(r),filter:e,store:r,disabled:i,readOnly:s,propertyLocked:Boolean(l),valueFieldCls:o,operators:a,dateFormat:d,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,triggerChangeOnInput:u,allowedFieldNames:h,...c?t.callback(c,t,[e]):void 0}}getFieldsFromStore(e){var t;return Object.fromEntries((null===(t=e.modelClass)||void 0===t?void 0:t.fields.map((({name:e,type:t})=>[e,{type:t}])))??[])}getPickerRowConfig(e){const t=this,{disabled:n,readOnly:r,canDeleteFilter:i}=t,s=!(i&&!1===t.callback(i,t,[e])),o=!Boolean(e.disabled);return{type:"container",layout:"box",cls:{[`b-${Ff.type}-row`]:!0,[`b-${Ff.type}-row-removable`]:s},dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:n,readOnly:r,checked:o,ariaLabel:t.L("L{FieldFilterPickerGroup.applyCond}",o),internalListeners:{change:"onFilterActiveChange",thisObj:t},cls:`b-${Ff.type}-filter-active`},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:n,readOnly:r,hidden:!s,cls:`b-transparent b-${Ff.type}-remove`,icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll((t=>e.includes(t.type)))}updateDisabled(e,t){super.updateDisabled(e,t),this.allInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){this.allInputs.forEach((t=>t.readOnly=e))}onFilterActiveChange({source:e,checked:t}){const n=this,r=n.getFilterIndex(e),i=n.filters[r],s=n.getFilterPicker(r);e.input.setAttribute("aria-label",n.L("L{FieldFilterPickerGroup.applyCond}",t)),i.disabled=!t,s.onFilterChange(),n.store&&s.isValid&&(n.store.addFilter(i,!0),n.updateStoreFilter()),n.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:n}){const r=this,{store:i}=r,s=r.getFilterIndex(e);i&&(i.removeFilter(t.id,!0),n&&(i.addFilter(t,!0),r.updateStoreFilter())),Object.assign(r.filters[s],t),r.triggerChange()}getFilterIndex(e){return parseInt(e.parent.element.dataset.itemIndex)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,`${this.id}-filter-${this._nextId}`}removeFilter({source:e}){const t=this,n=t.getFilterIndex(e),r=t.filters[n],i=t.getPickerRow(n),s=t.query((e=>e.isFocusable&&"container"!==e.type&&!i.contains(e)));s&&s.focus(),t.removeFilterAt(n),t.store&&(t.store.removeFilter(r.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:r}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:n=null}={}){const r=this,{filters:i}=r,s={property:r.limitToProperty||e,operator:t,value:n,disabled:!1,id:r.nextFilterId,caseSensitive:!1};if(r.trigger("beforeAddFilter",{filter:s})){var o;if(r.appendFilter(s),r.getFilterPicker(i.length-1).isValid)null===(o=r.store)||void 0===o||o.addFilter(s,!0),r.store&&r.updateStoreFilter();r.trigger("add",{filter:s}),r.triggerChange()}}appendFilter(e){const t=this;t.limitToProperty&&e.property!==t.limitToProperty||(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:n}=e,r=n.values.reduce(((e,t)=>({...e,[t.id]:t})),{});for(let e=t.filters.length-1;e>=0;e--){const n=t.filters[e],i=r[n.id],s=t.getPickerRow(e);if(s){const{filterPicker:r,activeCheckbox:o}=s.widgetMap;if(!i&&r.isValid)t.removeFilterAt(e);else if(void 0!==i){const{operator:e,value:t,property:s,disabled:a,caseSensitive:l}=i;n!==i&&Object.assign(n,{operator:e,value:t,property:s,disabled:a,caseSensitive:l}),r.filter=n,r.onFilterChange(),o.checked=!a}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:n}=this;t.remove(t.childItems[e]),n.splice(e,1),this.triggerChange()}updateStoreFilter(){var e;this._isUpdatingStore=!0,null===(e=this.store)||void 0===e||e.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){const{filters:e}=this,t=e.filter(((e,t)=>this.getPickerRow(t).widgetMap.filterPicker.isValid));this.trigger("change",{filters:e,validFilters:t})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:n,store:r}=t;n.forEach(((n,i)=>{if(e===n.disabled){const{filterPicker:s,activeCheckbox:o}=t.getPickerRow(i).widgetMap;n.disabled=!e,s.onFilterChange(),o.checked=e,e&&r&&s.isValid&&r.addFilter(n,!0)}})),t.updateStoreFilter()}get focusElement(){var e;return(null===(e=this.getPickerRow(this._filters.length-1))||void 0===e?void 0:e.widgetMap.filterPicker.focusElement)??super.focusElement}}Ff.initClass(),Ff._$name="FieldFilterPickerGroup";class If extends cm{static $name="FileField";static type="filefield";static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}If.initClass(),If._$name="FileField";class Af extends Dc{static $name="FilePicker";static type="filepicker";static configurable={defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null,showBadge:!0};construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.ion({click:t.onButtonClick,thisObj:t}),t.fileField.ion({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new tm({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const t=this,n=e.files;return!(!n||!n.length)&&(t.html=`${Array.from(n).map((e=>N.encodeHtml(e.name))).join("<br>")}`,!0)}}}))}clear(){const e=this;e.fileField.clear(),e.updateBadge(),e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.updateBadge(),t.triggerFieldChange({files:t.files,valid:e})}updateShowBadge(){this.isConfiguring||this.updateBadge()}updateBadge(){this.button.badge=this.showBadge&&this.files.length||""}}Af.initClass(),Af._$name="FilePicker";class Lf extends vm{static $name="FilterField";static type="filterfield";static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,ignoreParentReadOnly:!0,keyStrokeChangeDelay:100,internalListeners:{change:"onInternalChange"}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onInternalChange({value:e})}onInternalChange({value:e}){const{store:t,field:n,filterFunction:r}=this;if(t){const i=`${n||this.id}-Filter`;if(0===e.length)t.removeFilter(i);else{let s;r?s=t=>r(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=t=>{var r;return null===(r=t.getValue(n))||void 0===r?void 0:r.match(new RegExp(e,"i"))}),t.filter({id:i,filterBy:s})}}}}Lf.initClass(),Lf._$name="FilterField";const Pf=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];c.isWindows&&Pf.reverse();class Of extends eh{static $name="MessageDialog";static type="messagedialog";static get configurable(){return{ui:"plain",centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:" ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:Pf}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return oc.reconfigure(t,e),t.value=null==e?void 0:e.value,this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:n="",cancelButton:r,okButton:i,align:s,modal:o,rootElement:a=document.body}){const l=this;return l.rootElement=a,l.getConfig("lazyItems"),l.title=l.optionalL(n),l.widgetMap.message.html=l.optionalL(t),l.showClass=`b-messagedialog-${e}`,l.modal="boolean"!=typeof o||o,l.centered=!s,i&&(i="string"==typeof i?{text:i}:i),r&&(r="string"==typeof r?{text:r}:r),i=Object.assign({},l.widgetMap.okButton.initialConfig,i),r=Object.assign({},l.widgetMap.cancelButton.initialConfig,r),i.text=l.optionalL(i.text),r.text=l.optionalL(r.text),oc.reconfigure(l.widgetMap.okButton,i),oc.reconfigure(l.widgetMap.cancelButton,r),l.show({align:s}),l.promise=new Promise((e=>{l.resolve=e}))}show(){const e=Yn.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:Of.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:n}=this.element;t&&n.remove(t),e&&n.add(e)}doResolve(e){const t=this,{resolve:n}=t;if(n){const r="b-messagedialog-prompt"===t.showClass;if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,n(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){"Escape"===e.key?(e.stopImmediatePropagation(),this.onCancelClick()):"Enter"!==e.key||e.target.closest(".b-button")||(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve($f.okButton)}onCancelClick(){this.doResolve($f.cancelButton)}}Of.initClass();const $f=new Proxy({},{get(e,t){const n=e.instance||(e.instance=new Of({rootElement:document.body})),r=n[t];return"function"==typeof r?r.bind(n):r}});class _f extends Hu{static $name="PagingToolbar";static type="pagingtoolbar";static configurable={store:null};static get defaultConfig(){return{defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}changeStore(e){var t;return"string"==typeof e?null===(t=this.parent)||void 0===t?void 0:t[e]:e}updateStore(e){const t=this;t.detachListeners("store"),e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t}),e.isLoading&&t.onStoreBeforeRequest())}onStoreBeforeRequest(){this.eachWidget((e=>e.disable()))}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:n}=e.widgetMap;let r=0,i=0,s=0,o=0,a=0;if(e.store){const{store:t}=e,{pageSize:n,currentPage:l}=t;r=t.count,i=t.lastPage,a=t.totalCount,s=Math.max(0,(l-1)*n+1),o=Math.min(a,s+n-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:i}),n&&(n.html=r?e.L("L{summaryTemplate}")({start:s,end:o,allCount:a}):e.L("L{noRecords}"))}onStoreChange(){const e=this,{widgetMap:t,store:n}=e,{count:r,lastPage:i,currentPage:s}=n,{pageNumber:o,pageCount:a,firstPageButton:l,previousPageButton:d,nextPageButton:c,lastPageButton:u,dataSummary:h}=t;e.eachWidget((e=>e.enable())),o.value=s,o.max=i,h&&(h.disabled=!r),o.disabled=a.disabled=!r,l.disabled=d.disabled=s<=1||!r,c.disabled=u.disabled=s>=i||!r,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}_f.initClass(),_f._$name="PagingToolbar";class Hf extends cm{static $name="PasswordField";static type="passwordfield";static alias="password";construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}}Hf.initClass(),Hf._$name="PasswordField";const Vf={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class Nf extends oc{static $name="Slider";static type="slider";static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0,autoClose:!1}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value",twinSyncConfigs:["max","min","step","value"],label:null,labelWidth:null}}compose(){const{id:e,min:t,max:n,showValue:r,step:i,text:s,value:o,unit:a="",disabled:l,readOnly:d,label:c}=this,u=`${e}-input`,h=Boolean(s||r),g=i<1?o.toFixed(2):o;return{class:{"b-has-field-label":c,"b-has-label":h,"b-label-before":h,"b-text":h,"b-disabled":l},children:{inputLabel:c?{tag:"label",for:u,text:c,style:{width:this.labelWidth}}:null,input:{tag:"input",type:"range",id:u,reference:"input",[l?"disabled":""]:l,[d?"readOnly":""]:d,min:t,max:n,step:i,value:o,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},valueLabel:h?{tag:"label",class:"b-slider-value",for:u,text:r?s?`${s} (${g}${a})`:g+a:s}:null}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&Vf[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;e.readOnly?e.input.value=e.value:(e.value=e.step<1?parseFloat(e.input.value):parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e))}onInternalMouseOver(){var e;const t=this,n=t.rtl?100-t.percentProgress:t.percentProgress;null===(e=t.tooltip)||void 0===e||e.showBy({target:Ot.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:`b-t${Math.round(n)}`})}onInternalMouseOut(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}updateMin(e){const t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}changeTooltip(e,t){e&&(e.owner=this);const{value:n}=this,r=this.step<1?n.toFixed(2):n;return this.showTooltip?tm.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:`${r}${this.unit??""}`}}):null}changeValue(e){const{min:t,step:n}=this;return(e=Math.min(Math.max(e,t),this.max))>t?t+W.roundTo(e-t,n):W.roundTo(e,n)}updateValue(e){const t=this,{input:n,_tooltip:r}=t,i=t.step<1?e.toFixed(2):e;n&&n.value!==String(e)&&(n.value=e,t.triggerChange(!1)),t.updateUI(),r&&(r.html=`${i}${t.unit??""}`)}updateUI(){var e,t;const n=this;(null===(e=n._tooltip)||void 0===e?void 0:e.isVisible)&&(null===(t=n._tooltip)||void 0===t||t.alignTo({target:Ot.from(n.input).inflate(n.thumbSize/2,-n.thumbSize/2),align:`b-t${Math.round(n.percentProgress)}`}))}}Nf.initClass(),Nf._$name="Slider";class Bf extends Xm{static $name="SlideToggle";static type="slidetoggle";static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){e.checked&&(e.cls=Vt.from(e.cls)||{},e.cls[this.constructor.properties.toggledCls]=1),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}Bf.initClass(),Bf._$name="SlideToggle";const zf=["b-horizontal","b-vertical"],jf=e=>"flex"===Yn.getStyleValue(e.parentElement,"display")&&(parseInt(Yn.getStyleValue(e,"flex-basis"),10)||parseInt(Yn.getStyleValue(e,"flex-grow"),10)),Wf={horizontal:!1,vertical:!0};class Uf extends oc{static $name="Splitter";static type="splitter";static get configurable(){return{orientation:"auto",showButtons:!1,vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;null===(e=this.mouseDetacher)||void 0===e||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},children:this.showButtons?[c.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-splitter-inner",children:[{className:"b-splitter-buttons",reference:"splitterButtons",children:[{className:"b-splitter-button-collapse",reference:"collapseButton",children:[c.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"i",className:"b-icon b-icon-collapse-left b-splitter-collapse-arrow b-splitter-button-icon"}]},{className:"b-splitter-button-expand",reference:"expandButton",children:[c.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"i",className:"b-icon b-icon-collapse-right b-splitter-expand-arrow b-splitter-button-icon"}]}]}]}]:null,listeners:{pointerdown:"onMouseDown",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousewheel:"onScroll",dblclick:"onDoubleClick",...!c.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}getSibling(e=!0){let t,{element:n}=this;for(;!t&&(n=n[(e?"next":"previous")+"ElementSibling"]);)n.isConnected&&!Yn.isVisible(n)||(t=n);return t}get nextWidget(){let e,{element:t}=this;for(;!e&&(t=t.nextElementSibling);)e=oc.fromElement(t,this.element.parentElement);return e}get previousWidget(){let e,{element:t}=this;for(;!e&&(t=t.previousElementSibling);)e=oc.fromElement(t,this.element.parentElement);return e}get nextSplitter(){let e,{element:t}=this;for(;!e&&(t=null===(n=t)||void 0===n?void 0:n.nextElementSibling);){var n;const r=oc.fromElement(t,this.element.parentElement);"splitter"===(null==r?void 0:r.type)&&(e=r)}return e}get previousSplitter(){let e,{element:t}=this;for(;!e&&(t=null===(n=t)||void 0===n?void 0:n.previousElementSibling);){var n;const r=oc.fromElement(t,this.element.parentElement);"splitter"===(null==r?void 0:r.type)&&(e=r)}return e}updateContainerElement(e){var t;const n=this;n.stateDetector=null===(t=n.stateDetector)||void 0===t?void 0:t.disconnect(),e&&(n.stateDetector=new MutationObserver((()=>n.syncState())),n.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,t){this.detachListeners(t),null==e||e.ion({name:t,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var t;const n=null===(t=this.element)||void 0===t?void 0:t.classList;null==n||n.add(zf[e?1:0]),null==n||n.remove(zf[e?0:1])}syncState(e){var t,n,r,i;const s=this,{element:o,nextWidget:a,previousWidget:l,nextSplitter:d,previousSplitter:c}=s;let u=Wf[s.orientation]??null;var h,g;(s.nextNeighbor=a,s.previousNeighbor=l,s.disabled=!s.showButtons&&(a&&(a.collapsible&&a.collapsed||a.hidden)||l&&(l.collapsible&&l.collapsed||l.hidden)),"collapsed"===(null==d||null===(t=d.collapseState)||void 0===t?void 0:t.status)||"expanded"===(null==c||null===(n=c.collapseState)||void 0===n?void 0:n.status)||"collapsed"===(null===(r=s.collapseState)||void 0===r?void 0:r.status)||"expanded"===(null===(i=s.collapseState)||void 0===i?void 0:i.status)?s.element.classList.add("b-drag-disabled"):s.element.classList.remove("b-drag-disabled"),"expand"===(null==e?void 0:e.type)&&s.showButtons)?(((null==e?void 0:e.source)===l&&"collapsed"===(null===(h=s.collapseState)||void 0===h?void 0:h.status)||(null==e?void 0:e.source)===a&&"expanded"===(null===(g=s.collapseState)||void 0===g?void 0:g.status))&&(s.collapseState=null,o.classList.remove("b-drag-disabled","b-show-buttons")),s.setSplitterButtonPosition(),s.setButtonVisibility()):"collapse"===(null==e?void 0:e.type)&&s.showButtons&&(e.source!==l||s.collapseState?e.source!==a||s.collapseState||(s.collapseState={status:"expanded"}):s.collapseState={status:"collapsed"},o.classList.add("b-drag-disabled","b-show-buttons"),s.setSplitterButtonPosition(),s.setButtonVisibility());if(null!==u&&a&&l)s.containerElement=null;else if(s.containerElement=o.parentElement,s.rendered&&o.offsetParent){const e=Yn.getStyleValue(o.parentElement,"flex-direction");if(e)u=!e.startsWith("column");else{const e=o.previousElementSibling,t=o.nextElementSibling;if(!e||!t)return;const n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=n.top<r.top?n:r,s=i===r?n:r;u=i.top===s.top}}s.vertical=u}setButtonVisibility(){var e,t;const{showButtons:n,collapseState:r,collapseButton:i,expandButton:s,nextWidget:o,previousWidget:a,nextSplitter:l,previousSplitter:d}=this;var c,u,h,g;"start"===n||"end"===n?"collapsed"===(null==r?void 0:r.status)||"expanded"===(null==r?void 0:r.status)?(i.classList.toggle("b-disabled","collapsed"===r.status),s.classList.toggle("b-disabled","expanded"===r.status)):(i.classList.toggle("b-disabled","start"!==n&&!(null!=a&&a.collapsible)||"expanded"===(null==d||null===(c=d.collapseState)||void 0===c?void 0:c.status)),s.classList.toggle("b-disabled","end"!==n&&!(null!=o&&o.collapsible)||"collapsed"===(null==l||null===(u=l.collapseState)||void 0===u?void 0:u.status))):(i.classList.toggle("b-disabled",!n||"collapsed"===(null==r?void 0:r.status)||"expanded"===(null==d||null===(h=d.collapseState)||void 0===h?void 0:h.status)),s.classList.toggle("b-disabled",!n||"expanded"===(null==r?void 0:r.status)||"collapsed"===(null==l||null===(g=l.collapseState)||void 0===g?void 0:g.status)));"expanded"!==(null==r?void 0:r.status)&&"collapsed"===(null==d||null===(e=d.collapseState)||void 0===e?void 0:e.status)?d.setButtonVisibility():"collapsed"!==(null==r?void 0:r.status)&&"expanded"===(null==l||null===(t=l.collapseState)||void 0===t?void 0:t.status)&&l.setButtonVisibility()}setSplitterButtonPosition(e=0){const{vertical:t,splitterButtons:n,element:{parentElement:r}}=this;if(t){const t=r.clientHeight,i=r.scrollTop+e,s=Math.min(Math.max(0,i),r.scrollHeight-t)+t/2;n.style.top=`${s}px`}else{const t=r.clientWidth,i=r.scrollLeft+e,s=Math.min(Math.max(0,i),r.scrollWidth-t)+t/2;n.style.left=`${s}px`}}restoreOriginalState(){const{nextNeighbor:e,previousNeighbor:t,collapseState:n,vertical:r}=this,i=t?t.element:this.getSibling(!1),s=e?e.element:this.getSibling();n&&(r?(n.prevHasFlex?i.style.flexGrow=n.prevFlexGrow:i.style.width=`${n.prevWidth}px`,n.nextHasFlex?s.style.flexGrow=n.nextFlexGrow:s.style.width=`${n.nextWidth}px`):(n.prevHasFlex?i.style.flexGrow=n.prevFlexGrow:i.style.height=`${n.prevHeight}px`,n.nextHasFlex?s.style.flexGrow=n.nextFlexGrow:s.style.height=`${n.nextHeight}px`))}lockFlexedSiblings(){const e=[];for(const n of this.element.parentElement.children){var t;jf(n)&&n!==this.element&&"splitter"!==(null===(t=oc.fromElement(n,this.element.parentElement))||void 0===t?void 0:t.type)&&e.push({child:n,width:n.offsetWidth,height:n.offsetHeight})}for(const t of e)t.child.style.flexGrow=this.vertical?t.width:t.height,t.child.style.flexBasis=0}onDoubleClick({ctrlKey:e}){(e?this.element.parentElement.querySelectorAll(":scope > :not(.b-splitter)"):[this.getSibling(!1),this.getSibling()]).forEach((e=>e&&(e.style.flex="1 1 0px")))}onMouseDown(e){var t,n,r,i;const s=this,{target:o}=e;o.closest(".b-splitter-button-collapse")?s.onCollapseClick(e):o.closest(".b-splitter-button-expand")?s.onExpandClick(e):"collapsed"!==(null===(t=s.collapseState)||void 0===t?void 0:t.status)&&"expanded"!==(null===(n=s.collapseState)||void 0===n?void 0:n.status)&&"collapsed"!==(null===(r=s.nextSplitter)||void 0===r||null===(r=r.collapseState)||void 0===r?void 0:r.status)&&"expanded"!==(null===(i=s.previousSplitter)||void 0===i||null===(i=i.collapseState)||void 0===i?void 0:i.status)&&s.startMove(e)}startMove(e){var t;e.preventDefault(),e.touches&&(e=e.touches[0]);const n=this,{element:r,nextNeighbor:i,previousNeighbor:s}=n,o=s?s.element:n.getSibling(!1),a=i?i.element:n.getSibling(),l=jf(o),d=jf(a),u=[];null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.showButtons&&(n.collapseState=null,n.setButtonVisibility());for(const e of r.parentElement.children){var h;jf(e)&&e!==r&&"splitter"!==(null===(h=oc.fromElement(e,r.parentElement))||void 0===h?void 0:h.type)&&u.push({element:e,width:e.offsetWidth,height:e.offsetHeight})}n.context={startX:e.pageX,startY:e.pageY,prevWidth:o.offsetWidth,prevHeight:o.offsetHeight,nextWidth:a.offsetWidth,nextHeight:a.offsetHeight,prevHasFlex:l,nextHasFlex:d,flexed:u,prev:o,next:a};const g={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:n};c.supportsPointerEvents||(g.mousemove=g.touchmove="onMouseMove",g.mouseup=g.touchend="onMouseUp"),r.classList.add("b-moving"),n.mouseDetacher=Jt.on(g),n.trigger("splitterMouseDown",{event:e})}onMouseEnter(e){const t=this;t.syncState(),t.trigger("splitterMouseEnter",{event:e}),t.showButtons&&(t.setSplitterButtonPosition(),t.setButtonVisibility()),t.element.classList.add("b-hover")}onMouseLeave(e){this.trigger("splitterMouseLeave",{event:e}),this.element.classList.remove("b-hover")}onMouseMove(e){const{context:t,nextWidget:n,previousWidget:r,vertical:i,rtl:s}=this,o=t.prev.style,a=t.next.style,l=(e.pageX-t.startX)*(s?-1:1),d=e.pageY-t.startY;if(e.preventDefault(),Object.assign(t,{deltaX:l,deltaY:d}),t.started||(t.started=!0,this.trigger("dragStart",{context:t,event:e}),t.flexed.forEach((e=>{e.element.style.flexGrow=i?e.width:e.height,e.element.style.flexBasis="0"}))),i){const e=t.prevWidth+l,i=t.nextWidth-l;t.prevHasFlex?o.flexGrow=e:r?r.width=e:o.width=`${e}px`,t.nextHasFlex?a.flexGrow=i:n?n.width=i:a.width=`${i}px`}else{const e=t.prevHeight+d,i=t.nextHeight-d;t.prevHasFlex?o.flexGrow=e:r?r.height=e:o.height=`${e}px`,t.nextHasFlex?a.flexGrow=i:n?n.height=i:a.height=`${i}px`}this.trigger("drag",{context:t,event:e})}onMouseUp(e){var t;const n=this;null===(t=n.mouseDetacher)||void 0===t||t.call(n),n.mouseDetacher=null,n.element.classList.remove("b-moving"),n.context.started&&n.trigger("drop",{context:n.context,event:e}),n.context=null}onScroll(e){const{deltaY:t,shiftKey:n}=e,{vertical:r}=this;(n&&!r||!n&&r)&&this.setSplitterButtonPosition(t)}onCollapseClick(e){var t;const n=this,{nextNeighbor:r,nextWidget:i,previousNeighbor:s,previousWidget:o,collapseState:a,showButtons:l,vertical:d}=n,c=s?s.element:n.getSibling(!1),u=r?r.element:n.getSibling(),h=jf(c),g=jf(u);if("end"===l&&(null==o||!o.collapsible)&&"expanded"!==(null==a?void 0:a.status)||"collapsed"===(null==a?void 0:a.status))return;e.stopPropagation();let m={status:"collapsed"};if(n.element.classList.toggle("b-show-buttons",!a),o&&(null==a||!a.status)&&d&&o.minWidth>0?(m={...m,prevMinWidth:o.minWidth},o.minWidth=0):o&&(null==a||!a.status)&&!d&&o.minHeight>0&&(m={...m,prevMinHeight:o.minHeight},o.minHeight=0),i&&"expanded"===(null==a?void 0:a.status)&&(null!=a&&a.nextMinWidth||null!=a&&a.nextMinHeight)&&(d?i.minWidth=a.nextMinWidth:i.minHeight=a.nextMinHeight),a||null==o||!o.collapsible||null!=o&&o.collapsed)if("expanded"===(null==a?void 0:a.status)&&null!=i&&i.collapsible&&(null!=i&&i.collapsed||null!=i&&null!==(t=i.collapsible)&&void 0!==t&&t.collapsed))i.collapsible.isPanelCollapser?i.collapsible.collapse(!1):i.expand();else if("expanded"===(null==a?void 0:a.status))n.restoreOriginalState();else if(n.lockFlexedSiblings(),m={...m,prevWidth:c.offsetWidth,prevHeight:c.offsetHeight,prevHasFlex:h,prevFlexGrow:h?c.style.flexGrow:null,nextWidth:u.offsetWidth,nextHeight:u.offsetHeight,nextHasFlex:g,nextFlexGrow:g?u.style.flexGrow:null},n.vertical){var p;const e=c.offsetWidth+u.offsetWidth;h?c.style.flexGrow=1:c.style.width="0px","collapsed"!==(null===(p=n.nextSplitter)||void 0===p||null===(p=p.collapseState)||void 0===p?void 0:p.status)?g?u.style.flexGrow=e:u.style.width=`${e}px`:g?u.style.flexGrow=1:u.style.width="0px"}else{var f;const e=c.offsetHeight+u.offsetHeight;h?c.style.flexGrow=1:c.style.height="0px","collapsed"!==(null===(f=n.nextSplitter)||void 0===f||null===(f=f.collapseState)||void 0===f?void 0:f.status)?g?u.style.flexGrow=e:u.style.height=`${e}px`:g?u.style.flexGrow=1:u.style.height="0px"}else o.collapsible.isPanelCollapser?o.collapsible.collapse():o.collapse();n.collapseState=a?null:m,n.element.classList.toggle("b-drag-disabled",!a),n.setButtonVisibility()}onExpandClick(e){var t;const n=this,{nextNeighbor:r,nextWidget:i,previousNeighbor:s,previousWidget:o,collapseState:a,showButtons:l,vertical:d}=n,c=s?s.element:n.getSibling(!1),u=r?r.element:n.getSibling(),h=jf(c),g=jf(u);if("start"===l&&(null==i||!i.collapsible)&&"collapsed"!==(null==a?void 0:a.status)||"expanded"===(null==a?void 0:a.status))return;e.stopPropagation();let m={status:"expanded"};if(n.element.classList.toggle("b-show-buttons",!a),(null==a||!a.status)&&d&&i.minWidth>0?(m={...m,nextMinWidth:i.minWidth},i.minWidth=0):null!=a&&a.status||d||!(i.minHeight>0)||(m={...m,nextMinHeight:i.minHeight},i.minHeight=0),o&&"collapsed"===(null==a?void 0:a.status)&&(null!=a&&a.prevMinWidth||null!=a&&a.prevMinHeight)&&(d?o.minWidth=a.prevMinWidth:o.minHeight=a.prevMinHeight),a||null==i||!i.collapsible||null!=i&&i.collapsed)if("collapsed"===(null==a?void 0:a.status)&&null!=o&&o.collapsible&&(null!=o&&o.collapsed||null!=o&&null!==(t=o.collapsible)&&void 0!==t&&t.collapsed))o.collapsible.isPanelCollapser?o.collapsible.collapse(!1):o.expand();else if("collapsed"===(null==a?void 0:a.status))n.restoreOriginalState();else if(n.lockFlexedSiblings(),m={...m,prevWidth:c.offsetWidth,prevHeight:c.offsetHeight,prevHasFlex:h,prevFlexGrow:h?c.style.flexGrow:null,nextWidth:u.offsetWidth,nextHeight:u.offsetHeight,nextHasFlex:g,nextFlexGrow:g?u.style.flexGrow:null},n.vertical){var p;const e=c.offsetWidth+u.offsetWidth;"expanded"!==(null===(p=n.previousSplitter)||void 0===p||null===(p=p.collapseState)||void 0===p?void 0:p.status)?h?c.style.flexGrow=e:c.style.width=`${e}px`:h?c.style.flexGrow=1:c.style.width="0px",g?u.style.flexGrow=1:u.style.width="0px"}else{var f;const e=c.offsetHeight+u.offsetHeight;"expanded"!==(null===(f=n.previousSplitter)||void 0===f||null===(f=f.collapseState)||void 0===f?void 0:f.status)?h?c.style.flexGrow=e:c.style.height=`${e}px`:h?c.style.flexGrow=1:c.style.height="0px",g?u.style.flexGrow=1:u.style.height="0px"}else i.collapsible.isPanelCollapser?i.collapsible.collapse():i.collapse();n.collapseState=a?null:m,n.element.classList.toggle("b-drag-disabled",!a),n.setButtonVisibility()}render(){super.render(...arguments),this.syncState.now(),null===this.vertical&&this.syncState()}}Uf.initClass(),Uf._$name="Splitter";class Gf extends Tu{static $name="Tab";static type="tab";static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",closable:null,role:"tab"}}compose(e){const{active:t,cls:n,index:r,isFirst:i,isLast:s,closable:o}=this,a=this.owner.visibleChildCount;return o&&(e.children.closeIcon={tag:"i",class:"b-tab-close b-icon b-icon-close"}),{tabindex:0,"aria-selected":t,"aria-setsize":a,"aria-posinset":r+1,class:{"b-tabpanel-tab":1,"b-active":t,"b-tab-first":i,"b-tab-last":s,...n},dataset:{index:r}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var n,r;const i=this;(null==t?void 0:t.tab)===i&&(t.tab=null),e&&(e.tab=i,i[i.titleProperty]=e[i.titleSource],i.itemCls=e.cls,i.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),null===(n=i.itemChangeDetacher)||void 0===n||n.call(i),i.itemChangeDetacher=e&&ee.after(e,"onConfigChange","onItemConfigChange",i,{return:!1}),null===(r=i.itemHideDetacher)||void 0===r||r.call(i),i.itemHideDetacher=null==e?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:i,prio:1e3}),i.syncMinMax()}updateItemCls(e,t){const{element:n}=this,r=n&&Vt.from(null==n?void 0:n.classList,!0);n&&(r.remove(t).add(e),n.className=r.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:n}=e;let{_minWidth:r,_minHeight:i,_maxWidth:s,_maxHeight:o}=e;if(n){const{tabMinWidth:a,tabMaxWidth:l}=n;null!=a&&(t?(r===a&&(r=null),i=a):(i===a&&(i=null),r=a)),null!=l&&(t?(s===l&&(s=null),o=l):(o===l&&(o=null),s=l)),e.minWidth=r,e.minHeight=i,e.maxWidth=s,e.maxHeight=o}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:n}=this;this.hidden=t,t&&e===n.activeItem&&n.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:n}=this;this.disabled=t,e===n.activeItem&&n.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}get closable(){return this._closable&&!(this.isFirst&&this.isLast)}}Gf.initClass(),Gf._$name="Tab";const Yf=e=>e.isTab;class qf extends Hu{static $name="TabBar";static type="tabbar";static configurable={defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0};get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(Yf)}get tabs(){return nt.from(this._items,Yf)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,Yf)}onChildAdd(e){super.onChildAdd(e),null==e.index&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn({_target:e}){const{activeIndex:t}=this.owner;null!=e&&e.matches(".b-tab:focus-visible")&&!isNaN(t)&&this.tabs[t].focus()}syncTabs(){const{tabs:e}=this;for(let t=0,n=e.length;t<n;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===n-1}tabAt(e){return this._items.find(Yf,e)||null}onChildMove(){this.syncTabs()}onDrop({context:e}){const{item:t,valid:n,oldIndex:r}=e,{owner:i}=this;if(super.onDrop(...arguments),n&&i){const{owner:e}=this,n=t.active,i=Array.from(t.element.parentElement.children).indexOf(t.element);e.insert(e.items[r],i),n&&(e.layout.setActiveItem(i,r,{animation:!1,silent:!0}),e.activeTab=t.item)}}}qf.initClass(),qf._$name="TabBar";const Kf=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],Xf={preventScroll:!0};class Zf extends lc{static $name="Card";static type="card";static configurable={containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null};onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:n,owner:r}=t,i=null!=r.activeIndex?r.activeIndex:t.activeIndex||0,s=r.items.indexOf(e),o=null!=n?e===n:s===i;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",show:{fn:"onChildShow",prio:99999},thisObj:t}),o?(t._activeIndex=s,t._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const t=this;t._activeItem===e&&t.activateSiblingOf(e),t._activeIndex=t.owner.items.indexOf(t._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",show:"onChildShow",thisObj:t})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onChildShow({source:e}){this._activeItem=e}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,n=t.items.slice(),r=n.indexOf(e);n.splice(r,1),this.activeIndex=Math.min(r,n.length-1)}setActiveItem(e,t=this.activeIndex,n){const r=this,{owner:i}=r,{items:s}=i,o=e instanceof oc,a=s[t],l=i.items[e=o?s.indexOf(e):parseInt(e,10)],d=!1!==(null==n?void 0:n.animation),c=!(null!=n&&n.silent),u={prevActiveIndex:t,prevActiveItem:a,containedFocus:null==a?void 0:a.element.matches(":focus-within"),ownerContainedFocus:i.element.matches(":focus-within")};if(l&&!l.$isActivating&&l!==a){var h;const s=a&&a.element,o=l&&l.element;if(r.animateDetacher){const e=r.animateDetacher.event;if(e.activeItem===l)return e.promise;r.animateDetacher(),e.prevActiveItem.element.classList.remove(...Kf),e.activeItem.element.classList.remove(...Kf),r.animateDetacher=null}if(u.activeIndex=e,u.activeItem=l,c&&!1===i.trigger("beforeActiveItemChange",u))return null;const g=r._activeIndex!==u.activeIndex;g&&(r._activeIndex=u.activeIndex),c&&(null===(h=i.onBeginActiveItemChange)||void 0===h||h.call(i,u)),g&&(r._activeIndex=u.prevActiveIndex),d&&s&&i.isVisible&&r.animateCardChange?u.promise=r.cardChangeAnimation=new Promise(((d,h)=>{const g=a.monitorResize;a.monitorResize=!1,r.contentElement.style.overflowX="hidden",a._hidden=!0,l.$isActivating=!0,l.show(),i.element.matches(":focus-within")&&l.focus(Xf),l.$isActivating=!1,s.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),o.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),i.isAnimating=!0,r.animateDetacher=Jt.onTransitionEnd({mode:"animation",element:o,thisObj:a,handler(){i.isAnimating=r.cardChangeAnimation=!1,r.animateDetacher?(r.animateDetacher=null,o.classList.remove(...Kf),s&&(s.classList.remove(...Kf),a.$isDeactivating=!0,a._hidden=!1,a.hide(),a.monitorResize=g,a.$isDeactivating=!1),r.contentElement.style.overflowX="",r.onActiveItemChange(u,d,!c)):r.setActiveItem(e,t,n)}}),r.animateDetacher.reject=h,r.animateDetacher.event=u})):(l.$isActivating=!0,l.show(),i.element.matches(":focus-within")&&l.focus(Xf),l.$isActivating=!1,a&&(a.$isDeactivating=!0,a.hide(),a.$isDeactivating=!1),r.onActiveItemChange(u,null,!c))}return u}onActiveItemChange(e,t,n){const r=this,{owner:i}=r,{activeItem:s}=e;r._activeItem=s,r._activeIndex=e.activeIndex,!n&&i.trigger("activeItemChange",e),e.ownerContainedFocus&&!s.element.matches(":focus-within")&&s.focus(Xf),null==t||t(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return Boolean(this.animateDetacher)}insertChild(e){const t=this;if(t.owner.items.includes(e)){const n=t.activeItem,r=e===n;r&&(t._activeItem=null);const i=super.insertChild(...arguments);return r||(t._activeIndex=t.owner.items.indexOf(n)),i}return super.insertChild(...arguments)}}Zf.initClass(),Zf._$name="Card";const Jf=e=>e.maximized;class Qf extends Xu{static $name="TabPanel";static type="tabpanel";static alias="tabs";static configurable={activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null};get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:n,tabBar:r}=this;return n.indexOf(null===(e=r.tabs[t])||void 0===e?void 0:e.item)}get bodyConfig(){return W.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return(null==t?void 0:t.focusElement)||(null==t||null===(e=t.tab)||void 0===e?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:n}=e,{activeIndex:r}=n,{tabs:i}=e.tabBar,s=t>=0&&t<i.length&&e.items.indexOf(i[t].item);if(i.length>0&&(!1===s||s<0))throw new Error(`Invalid activeTab ${t} (${i.length} tabs)`);s!==r&&n.setActiveItem(s,r,{animation:!1,silent:!0}),n.animateCardChange=e.animateTabChange}onChildAdd(e){const t=this;if(super.onChildAdd(e),!t.initialItems){const{tabBar:n}=t,r=t.makeTabConfig(e),i=r&&(null==n?void 0:n.firstTab),s=i&&n._items,o=i&&nt.from(t._items,(t=>t.tab||t===e)),a=i?o.indexOf(e)+s.indexOf(i):0;r&&n&&(i&&null==e.weight&&a<s.count-1?n.insert(r,a):n.add(r))}}onChildRemove(e){const t=this,{tab:n}=e,{items:r}=t;n&&(t.tabBar.remove(n),n.destroy()),e===t.activeItem&&(t._activeTab=null,r.length&&(t.activeTab=r[Math.min(t.activeIndex,r.length-1)])),super.onChildRemove(e),e.tabBarItems&&t.tabBar.remove(e.tabBarItems)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,n=null==t?void 0:t[e];return n&&(n.disabled||n.hidden)}findAvailableTab(e,t=1){const{tabs:n}=this.tabBar,r=n.length,i=Math.max(0,n.indexOf(e.tab));let s;i&&(t=-t);for(let e=1;e<=r&&(s=(i+(t<0?r:0)+e*t)%r,this.isDisabledOrHiddenTab(s));++e);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e,t){const n=this,{tabBar:r,layout:i}=n,{tabCount:s}=r;if(e.isWidget||W.isObject(e)?(-1===n.items.indexOf(e)&&(e=n.add(e)),e=r.indexOfTab(e.tab)):e=parseInt(e,10),!n.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(n.isDisabledOrHiddenTab(e)&&(e=n.findAvailableTab(e)),!i.animateCardChange||!i.cardChangeAnimation)return e;i.cardChangeAnimation.then((r=>{(null==r?void 0:r.activeIndex)!==e&&(n._activeTab=e,n.updateActiveTab(e,t))}))}async updateActiveTab(e,t){const n=this;if(!n.initialItems){const{activeTabItemIndex:e,layout:t}=n;if(e>-1){const i=n.items[e];var r;if(t.activeItem!==i)t.animateCardChange&&await n.tabSelectionPromise,n.tabSelectionPromise=null===(r=t.setActiveItem(i))||void 0===r?void 0:r.promise}n.tabBar.remove(n.tabBar.items.filter((e=>!e.isTab&&e.trueOwner)))}const i=n.items[e];null!=i&&i.tabBarItems&&(i.tabBarItems=n.tabBar.add(i.tabBarItems),i.tabBarItems.forEach((e=>e.trueOwner=i)))}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,n={item:e,type:"tab",active:!e.hidden,tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return!1===t?null:W.isObject(t)?Gf.mergeConfigs(n,t):n}updateAnimateTabChange(e){this.isConfiguring||(this.layout.animateCardChange=e)}updateItems(e,t){const n=this,{activeTab:r,initialItems:i}=n;let s,o=0;super.updateItems(e,t),i&&(s=Array.from(e,(e=>n.makeTabConfig(e))).filter((e=>{if(e)return e.index=o++,!0})),o&&(s[r].active=!0,n.tabBar.add(s),n.activeTab=r))}updateTabMinWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.minWidth=e)}))}updateTabMaxWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.maxWidth=e)}))}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&ir.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this})}applyAutoHeight(){const e=this,{layout:t,activeTab:n,element:r}=e,{animateCardChange:i}=t;if(t.animateCardChange=!1,e.flex="0 0 0%",!e.up(Jf)){const t=e.height=Math.max(...e.items.map((t=>(e.activeTab=t,r.clientHeight))))+1;e.flex=`1 1 ${t}px`}e.activeTab=n,t.animateCardChange=i}internalOnThemeChange(){this.isVisible&&this.applyAutoHeight()}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:n,prevActiveItem:r}=e;this.activeTab=t.indexOf(null==n?void 0:n.tab),null!=r&&r.tab&&(r.tab.active=!1),null!=n&&n.tab&&(n.tab.active=!0,n.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){const{item:t}=e.source;t.tab.closable&&e.event.target.classList.contains("b-tab-close")?this.remove(t):this.activeTab=t}onInternalPaint(){super.onInternalPaint(...arguments),this.autoHeight&&this.applyAutoHeight()}onValidityChange({source:e,valid:t}){const n=e.closest((e=>e.element.classList.contains("b-tabpanel-item"))),{tab:r}=n;r.element.classList.toggle("b-invalid",!t),r.ariaLabel=t?"":this.L("L{TabPanel.containsInvalidFields}")}}Qf.initClass(),Qf._$name="TabPanel";class ev extends cm{static $name="TextAreaField";static type="textareafield";static alias="textarea";static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}}ev.initClass(),ev._$name="TextAreaField";class tv extends ym{static $name="TextAreaPickerField";static type="textareapickerfield";static configurable={picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null,editable:!1};get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get nonEditableClickTarget(){return this.displayElement}get focusElement(){var e;return null!==(e=this._picker)&&void 0!==e&&e.isVisible?this.input:this.displayElement}get needsInputSync(){return this.displayElement[this.inputValueAttr]!==String(this.inputValue??"")}showPicker(){this.picker.width=this.pickerWidth||this.pickerAlignElement.offsetWidth,super.showPicker(!0)}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,n=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const r=super.onPickerKeyDown(e);return t.input=n,r}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return null==e?"":e}changePicker(e,t){var n;const r=this,i=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width);if(e=tv.reconfigure(t,e?C.merge({owner:r,forElement:r.pickerAlignElement,align:{matchSize:null==i,anchor:r.overlayAnchor,target:r.pickerAlignElement},id:r.id+"-input",style:{resize:r.resize},html:r.value??""},e):null,r)){const t=r.input=e.element;r.inputListenerRemover=Jt.on({element:t,thisObj:r,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}tv.initClass(),tv._$name="TextAreaPickerField";class nv extends Dc{static $name="UndoRedoBase";static type="undoredobase";static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}},overflowable:!0}}afterConstruct(){this.updateUndoRedoControls()}updateStm(e){this.detachListeners("undoredo"),null==e||e.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:t,redoBtn:n}=e;return this.color&&(t&&(t.color=this.color),n&&(n.color=this.color)),this.text&&(t&&(t.text="L{UndoRedo.Undo}"),n&&(n.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=[[0,"Original data"],...this.stm.queue.map(((e,t)=>[t+1,e||`Transaction ${t+1}`]))])}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:n,redoBtn:r,transactionsCombo:i}=this.widgetMap;n.badge=e.position||(t?"0":""),r.badge=e.length-e.position||(t?"0":""),n.disabled=!e.canUndo,r.disabled=!e.canRedo,this.fillUndoRedoCombo(),i&&(i.disabled=i.store.count<=1)}transactionsDisplayValueRenderer(e,t){var n;const r=(null===(n=this.stm)||void 0===n?void 0:n.position)||0;return`${r} undo actions / ${t.store.count-r-1} redo actions`}onUndo(){const{stm:e,project:t}=this;e.canUndo&&(e.revisionsEnabled?t.queue((()=>(e.undo(),t.commitAsync()))):e.undo())}onRedo(){const{stm:e,project:t}=this;e.canRedo&&(e.revisionsEnabled?t.queue((()=>(e.redo(),t.commitAsync()))):e.redo())}onTransactionSelected(e){const{stm:t}=this,n=t.position-e.value;n>0?t.canUndo&&t.undo(n):n<0&&t.canRedo&&t.redo(-n)}}nv.initClass(),nv._$name="UndoRedoBase";const rv="http://www.w3.org/2000/svg",iv={bar:1,outline:2,text:3},sv=(e,t)=>parseInt(e.order,10)-parseInt(t.order,10),ov=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),av=e=>e.field,lv=()=>!1,dv=/\s+/;class cv extends oc{static type="histogram";static $name="Histogram";static get configurable(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:rv,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:rv,tag:"g",reference:"scaledSvgGroup"},{ns:rv,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:!1,singleTextForAllBars:!0,monitorResize:!0,getRectClass:void 0,getBarClass:(e,t,n,r)=>"",getOutlineClass:(e,t)=>"",getOutlineDOMConfig:(e,t,n)=>t,getBarTip(e,t,n,r){},getBarText:(e,t,n)=>"",getBarDOMConfig:null,getBarTextDOMConfig:(e,t,n,r)=>e,getBarTextTip(e,t,n,r){}}}static properties={refreshSuspended:0};construct(e){const t=this;super.construct(e),t.scheduleRefresh=t.createOnFrame(t.refresh,[],t,!0),t.refresh()}set tip(e){var t;const n=this;null===(t=n.tip)||void 0===t||t.destroy(),n._tip=e?tm.new({owner:n,forElement:n.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}updateSeries(e){const t=this,n=t._series={};let r=0,i=0;for(const t in e)if(!1!==e[t]){const s=n[t]=C.merge({},e[t]);s.field||(s.field=t),s.type||(s.type="bar"),"order"in s||(s.order=10*iv[s.type]+r),"index"in s||(s.index=r),"bar"===s.type&&(s.index=i++),s.id=t,r++}!t.topValue&&t._data&&(t.topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}getDataTopValue(e,t){const n=Object.values(t||this.series).map(av);let r,i=0;for(let t=0,{length:s}=e;t<s;t++){r=e[t];for(let e=0,{length:t}=n;e<t;e++)i=Math.max(i,r[n[e]])}return i}updateGetRectClass(e){G.deprecate("core","7.0.0","getRectClass is deprecated in favor of getBarClass"),this.getBarClass=e}updateData(e){const t=this;t._data=e,!t.topValue&&t._data&&t._series&&(t.topValue=t.getDataTopValue(e)),t.refreshSuspended||t.scheduleRefresh()}updateTopValue(e){const t=this;t._topValue=e,!e&&t._data&&(t._topValue=t.getDataTopValue(t._data)),t.refreshSuspended||t.scheduleRefresh()}scheduleRefresh(){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(){this.refreshSuspended&&this.refreshSuspended--}refresh(e){const t=this,{series:n,_tip:r,topValue:i,singleTextForAllBars:s}=t,o=(null==e?void 0:e.args)||[],a=[],l=[];if(!n)return;const d=Object.values(n).sort(sv);if(s){for(const e of d){const n=t[`draw${N.capitalize(e.type)}`](e,...o);n&&(Array.isArray(n)?a.push.apply(a,n):a.push(n))}l.push(...t.drawText(null,...o))}else{for(const e of d){const n=t[`draw${N.capitalize(e.type)}`](e,...o);n&&(Array.isArray(n)?a.push.apply(a,n):a.push(n)),"bar"===e.type&&l.push(...t.drawText(e,...o))}l.sort(ov)}a.sort(ov),ud.sync({domConfig:{width:"100%",height:"100%",preserveAspectRatio:"none",dataset:{topValue:i},children:[{ns:rv,tag:"g",reference:"scaledSvgGroup",children:a},{ns:rv,tag:"g",reference:"unscaledSvgGroup",children:l}]},configEquality:lv,targetElement:t.svgElement}),r&&r.isVisible&&t.onBeforeTipShow({source:r})}drawBar(e,...t){const n=this,{topValue:r,data:i,omitZeroHeightBars:s,barStyle:o}=n,{field:a,order:l,stretch:d}=e,{length:c}=i,u=1/c,h=[],g=N.createId(e.id),m=e.index,p=d?1:void 0;let f;for(let d=0,c=0,{length:v}=i;d<v;d++,c+=f){const v=i[d];let y=v.rectConfig={ns:rv,tag:"rect",dataset:{}};const b=v[a],C=b?p||v.height||(b>r?r:b)/r:0,w=1-C,S=n.callback("getBarTip",n,[e,y,v,d,...t]);f=v.width||u,o?y.style=o:delete y.style,Object.assign(y.dataset,{index:d,order:l,series:g});const D={[`b-series-${g}`]:1,[`b-series-index-${m}`]:1},E=n.callback("getBarClass",n,[e,y,v,d,...t]);E&&E.split(dv).forEach((e=>D[e]=1)),Object.assign(y,{x:c,y:w,width:f,height:C,class:D}),S?y.dataset.btip=S:delete y.dataset.btip,n.getBarDOMConfig&&(y=n.getBarDOMConfig(e,y,v,d,...t)),!y||!y.height&&s||h.push(y)}return h}changeGetBarDOMConfig(e){return e?this.bindCallback(e):null}drawOutline(e,...t){const n=this,{topValue:r,data:i}=n,{field:s,order:o,id:a}=e,l=1/i.length,d=["M 0,1"],c={ns:rv,tag:"path",dataset:{order:o,id:a}};let u,h="M",g="L";for(let e=0,t=0,{length:n}=i;e<n;e++){const n=1-i[e][s]/r;u=i[e].width||l,d.push(`${h} ${t},${n} ${g} ${t+=u},${n}`),h=g=""}return c.class=`b-series-${e.id} b-series-index-${e.index} `+n.callback("getOutlineClass",n,[e,i,...t]),c.d=d.join(" "),n.callback("getOutlineDOMConfig",n,[e,c,i,...t])||[]}drawText(e,...t){const n=this,{data:r}=n,i=1/r.length,s=[];for(let o,a=0,l=0,{length:d}=r;a<d;a++,l+=o){o=r[a].width||i;const d=n.callback("getBarText",n,[r[a],a,e,...t]);if(d){const i=n.callback("getBarTextDOMConfig",n,[{ns:rv,tag:"text",className:"b-bar-legend",html:d,left:l,width:o,x:100*(l+o/2)+"%",y:void 0!==r[a].y?r[a].y:"100%",dataset:{index:a,series:e}},r[a],a,e,...t]);if(i){const o=n.callback("getBarTextTip",n,[i,r[a],a,e,...t]);o?i.dataset.btip=o:delete i.dataset.btip,s.push(i)}}}return s}}cv.initClass(),cv._$name="Histogram";const uv="http://www.w3.org/2000/svg";class hv extends oc{static $name="Scale";static type="scale";static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:uv,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:uv,tag:"g",reference:"scaledSvgGroup",children:[{ns:uv,tag:"path",reference:"pathElement"}]},{ns:uv,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){var e;if(!this.scalePoints)return;const t=this,{horizontal:n,width:r,height:i,align:s,scalePoints:o,scaleMaxPadding:a}=t,l=null===(e=o[o.length-1])||void 0===e?void 0:e.value,d=[],c=[],u=1/(l+a*l);t.scaledSvgGroup.setAttribute("transform",`scale(${n?r:1} ${n?1:i})`);for(const e of o){const t=Boolean(e.text),o=u*e.value;if(t){const t={ns:uv,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};n?(t.x=100*o+"%",t.y="top"===s?"1.6em":i-12):(t.x="left"===s?"12":""+(r-12),t.y=100*(1-o)+"%"),c.push(t)}n?"top"===s?d.push(`M${o},0 L${o},${t?10:5}`):d.push(`M${o},${i} L${o},${i-(t?10:5)}`):"left"===s?d.push(`M0,${1-o} L${t?10:5},${1-o}`):d.push(`M${r},${1-o} L${r-(t?10:5)},${1-o}`)}t.pathElement.setAttribute("d",d.join("")),ud.syncChildren({domConfig:{children:c}},t.unscaledSvgGroup)}}hv.initClass(),hv._$name="Scale";var gv=e=>class extends(e||Qe){static $name="Minifiable";static configurable={minifiable:!0,minified:null};compose(){const{minified:e}=this;return{class:{"b-minified":e}}}get widgetClass(){}};const mv=[],pv=e=>"*"!==e[0],fv=(e,t)=>{const n=e[t]||null;return delete e[t],n},vv=e=>e.responsiveRoot,yv={number:e=>({width:t})=>t<=e&&e},bv=e=>(delete e.once,{configs:e,callback:fv(e,"callback"),when:fv(e,"when")}),Cv=(e,t,...n)=>{const r=n.flatMap((e=>(null==e?void 0:e.once)||mv)),i=t.mergeConfigs(...n),s=bv(i);s.once=r.length?bv(t.mergeConfigs(...r)):null;for(const t in i)t in e&&delete i[t];return s};var wv=e=>class extends((e||Qe).mixin(Hi,$h)){static $name="Responsive";static configurable={responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}}};static delayable={responsiveUpdate:"raf"};static fenced={syncResponsiveWidget:!0};static prototypeProperties={responsiveStateChanges:0,responsiveUpdateCount:0};get isResponsivePending(){return 0===this.responsiveUpdateCount&&this.hasConfig("responsive")}get isResponsiveUpdating(){var e;return this._responsiveUpdating||(null===(e=this.responsiveWidget)||void 0===e?void 0:e._responsiveUpdating)}updateResponsive(e){const t=this,n=t.constructor,{initialConfig:r,responsiveDefaults:i}=t,s=Array.from(new Set(W.keys(e).concat(W.keys(i)))).filter(pv);let o,a,l,d,c=null;if(e)for(a of(c={"*":Cv(r,n,i["*"],e["*"])},s)){var u;if(l=e[a],null!==l&&!1!==l)o=o||l&&"when"in l,c[a]=Cv(r,n,i["*"],i[a],e["*"],l),d=c[a].when,c[a].when=(null===(u=yv[typeof d])||void 0===u?void 0:u.call(yv,d))||d}t.$responsiveStates=c,t.$responsiveWhen=o,t.syncResponsiveWidget()}updateResponsiveState(e,t){var n;const r=this,{$responsiveStates:i}=r,s=1==++r.responsiveStateChanges,o=null===(n=r.element)||void 0===n?void 0:n.classList,a=i["*"],l=i[e]||a,d=s&&(l.once||a.once),c=s&&r.isStateful,u=r.responsiveWidget;let h,g=l.configs,m=null==d?void 0:d.configs;m&&(g=g?r.constructor.mergeConfigs(g,m):m),t&&(null==o||o.remove(`b-responsive-${t.toLowerCase()}`)),e&&(null==o||o.add(`b-responsive-${e.toLowerCase()}`)),c&&(m=r.loadStatefulData(),m&&(g=g?r.constructor.mergeConfigs(g,m):m),r.suspendStateful()),r._responsiveUpdating=!0;try{var p,f;for(h of(null===(p=r.trigger)||void 0===p||p.call(r,"beforeResponsiveStateChange",{state:e,oldState:t,target:u}),g&&r.setConfig(g),[l.callback,null==d?void 0:d.callback])){var v;null===(v="string"==typeof h?r[h]:h)||void 0===v||v.call(r,{source:r,state:e,oldState:t,target:u,initial:s})}null===(f=r.trigger)||void 0===f||f.call(r,"responsiveStateChange",{state:e,oldState:t,target:u})}finally{r._responsiveUpdating=!1,c&&r.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(e){var t;const n=this,r=e&&n.responsiveUpdate;null===(t=n.$responsiveWrapper)||void 0===t||t.destroy(),n.$responsiveWrapper=e&&((e,t)=>{let n,r=Proxy.revocable(e,{get:(t,r)=>(n&&(n[r]=!0),e[r])}),i=ee.after(e,"onConfigChange",((e,{name:r})=>{var i;null!==(i=n)&&void 0!==i&&i[r]&&t()})),s=e.ion({resize:()=>{t()}});return e.monitorResize=!0,{widget:e,get object(){var e;return null===(e=r)||void 0===e?void 0:e.proxy},destroy(){r&&(r.revoke(),i(),s(),r=i=s=null)},reset(){n=Object.create(null)}}})(e,r),null==r||r.now()}responsiveUpdate(){const e=this,{$responsiveStates:t,$responsiveWrapper:n}=e,r=null==n?void 0:n.widget;if(t&&n){let i,s,o=null,a=0,l=t;for(s in r&&r!==e&&!e.$responsiveWhen&&(r.getConfig("responsive"),l=r.$responsiveStates||l),n.reset(),t)"*"!==s&&(i=l[s].when(n.object,c),null!=i&&!1!==i&&(!o||i<a)&&(o=s,a=i));++e.responsiveUpdateCount,e.responsiveState=o}}syncResponsiveWidget(){const e=this;let t,n=null;if(!e.isDestroying&&e.responsive){var r;if(t=e.responsiveTarget,n=t){if("string"==typeof t&&(n="@"===t?e:"@"===t[0]?e[t.substring(1)]:e.up(t),!n))throw new Error(`No match for responsiveTarget="${t}"`)}else n=!e.responsiveRoot&&(null===(r=e.up)||void 0===r?void 0:r.call(e,vv))||e;if(!n.isWidget)throw new Error(`${n.constructor.$$name} is not a widget and cannot be a responsiveTarget`)}return e.responsiveWidget=n,n}};class Sv extends Qe{static $name="AvatarRendering";static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;null===(e=this.tooltip)||void 0===e||e.destroy(),super.doDestroy()}updateElement(e){Jt.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return tm.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set)}getResourceAvatar(e){if(Array.isArray(e))return e.map((e=>this.getResourceAvatar(e)));const{initials:t,color:n,iconCls:r,imageUrl:i,defaultImageUrl:s,dataset:o={},resourceRecord:a,alt:l=N.encodeHtml(null==a?void 0:a.name)}=e,d=this.getImageConfig(t,n,i,s,o,l)||this.getIconConfig(r,o,l)||this.getResourceInitialsConfig(t,n,o,l),{size:c}=this;return Object.assign(d.style,{...c?{height:c,width:c}:void 0}),d}getImageConfig(e,t,n,r,i,s){if(n=Sv.failedUrls.has(n)?r:n||r)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},style:{},alt:s,"aria-label":s,elementData:{defaultImageUrl:r,imageUrl:n,initials:e,color:t,dataset:i},src:n,dataset:i}}getIconConfig(e,t,n){if(e)return e&&{tag:"i",style:{},"aria-label":n,class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,n,r){const i=Yn.isNamedColor(t)&&t,s=!i&&t,{size:o}=this;return{tag:"div","aria-label":r,class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${i}`]:i},style:{backgroundColor:s||null,...o?{height:o,width:o}:void 0},text:e,dataset:n}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar")||!e.isConnected)return;const{defaultImageUrl:t,initials:n,color:r,imageUrl:i,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const{parentElement:t}=e,i=Array.from(t.childNodes).indexOf(e),o=this.getResourceInitialsConfig(n,r,s,e.alt),a=Yn.createElement(o);e.$refOwnerId&&(a.$refOwnerId=e.$refOwnerId),a.elementData=e.elementData,a.lastDomConfig=o,t.lastDomConfig&&(t.lastDomConfig.children[i]=o),t.replaceChild(a,e)}Sv.failedUrls.add(i)}}Sv._$name="AvatarRendering",window&&!window.bryntum&&(window.bryntum={});class Dv{static UP=1;static NEXT_CELL=2;static DOWN=3;static PREV_CELL=4;static FIRST_COLUMN=5;static LAST_COLUMN=6;static FIRST_CELL=7;static LAST_CELL=8;static PREV_PAGE=9;static NEXT_PAGE=10;constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=oc.fromElement(e,"gridbase"),n=t&&e.closest(t.focusableSelector);if(n){const{dataset:r}=n.parentNode;this.init({grid:t,rowIndex:t.store.includes(r.id)?t.store.indexOf(r.id):r.index||-1,columnId:n.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var t;const n=this,r=n.grid=e.grid,{store:i,columns:s}=r,{visibleColumns:o}=s;if(e.target&&(n.actionTargets=[n._target=e.target]),e.record)n._id=e.record.id;else if("id"in e)n._id=e.id,null==e.id&&(n._rowIndex=-1);else{var a;const t=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;n._rowIndex=Math.max(Math.min(Number(t),i.count-1),r.hideHeaders?0:-1),n._id=null===(a=i.records[n._rowIndex])||void 0===a?void 0:a.id}if("_rowIndex"in n||(n._rowIndex=i.indexOf(n.id)),n.isSpecialRow=null===(t=n.record)||void 0===t?void 0:t.isSpecialRow,"columnId"in e)n._column=s.getById(e.columnId);else if("field"in e)n._column=s.get(e.field);else{const t=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(t)?n._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(n._columnIndex=Math.min(Number(t),o.length-1),n._column=o[n._columnIndex])}"_columnIndex"in n||(n._columnIndex=o.indexOf(n._column))}get isLocation(){return!0}equals(e,t=!1){const n=this;return(null==e?void 0:e.isLocation)&&e.grid===n.grid&&(t?n.id===e.id&&n._column===e._column:e.record===n.record&&e.column===n.column&&e.target===n.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return-1===t?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){var e;if(null!==(e=this._record)&&void 0!==e&&e.isModel)return this._record;if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.records[this._rowIndex]}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return null!=e&&e.includes(this._column)?this._column:null==e?void 0:e[this.columnIndex]}get columnId(){var e;return null===(e=this.column)||void 0===e?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,(null===(e=this.grid.columns.visibleColumns)||void 0===e?void 0:e.length)-1)}move(e){const t=this,{record:n,column:r,grid:i}=t,{store:s}=i,o=i.columns.visibleColumns,a=new Dv;let l=s.includes(n)?s.indexOf(n):t.rowIndex,d=o.includes(r)?o.indexOf(r):t.columnIndex;const c=i.hideHeaders?0:-1,u=s.count-1,h=o.length-1,g=l===c,m=l===u,p=0===d,f=d===h;switch(e){case Dv.PREV_CELL:p?g||(d=h,l--):d--;break;case Dv.NEXT_CELL:f?m||(d=0,l++):d++;break;case Dv.UP:g||l--;break;case Dv.DOWN:m||(-1===l?l=i.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case Dv.FIRST_COLUMN:d=0;break;case Dv.LAST_COLUMN:d=h;break;case Dv.FIRST_CELL:l=c,d=0;break;case Dv.LAST_CELL:l=u,d=h;break;case Dv.PREV_PAGE:l=Math.max(c,l-Math.floor(i.scrollable.clientHeight/i.rowHeight));break;case Dv.NEXT_PAGE:l=Math.min(u,l+Math.floor(i.scrollable.clientHeight/i.rowHeight))}return a.init({grid:i,rowIndex:l,columnIndex:d}),a}get cell(){const e=this,{grid:t,id:n,_cell:r}=e;if(r)return r;var i;if(null==n)return null===(i=t.columns.getById(e.columnId))||void 0===i?void 0:i.element;{const{row:n}=e;var s;if(n)return n.getCell(e.columnId)||n.getCell(null===(s=t.columns.getAt(e.columnIndex))||void 0===s?void 0:s.id)}}get $cellIndex(){return{rowIndex:this.rowIndex,columnIndex:this.columnIndex}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:n}=this.grid;if(e)return t||(n.currentNode=this.grid.focusableFinderCell=e,n.nextNode()||e)}get containsFocus(){const{cell:e}=this,t=e&&Yn.getActiveElement(e);return t&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY}get isActionable(){const{_target:e}=this;return Boolean(this.containsFocus||e&&e!==this.cell)}get isColumnHeader(){return this.cell&&-1===this.rowIndex}get isCell(){return this.cell&&this.record}}Dv._$name="GridLocation";const Ev=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px")),xv=/=>\s*['"]/;class Rv extends(_s.mixin(lt,Tr)){static $name="Column";static type="column";get type(){return this.constructor.type}static fields=["type","text","field","renderer","afterRenderCell","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{},convert:(e,t,n)=>W.isObject(e)?W.merge({},n.constructor.defaultValues.editor,e):e},"cellEditor","finalizeCellEdit",{name:"managedCellEditing",defaultValue:!0},{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t,n){if(!e)return!1;if(!0===e)return!0;const r={};return"function"==typeof e?(r.originalSortFn=e,r.sortFn=e.bind(n)):"object"==typeof e&&(Object.assign(r,e),r.fn&&(r.sortFn=r.fn,delete r.fn)),r}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e,t,n){if(!e)return!1;if(!0===e)return!0;const r={columnOwned:!0};return"function"==typeof e?r.filterFn=e:"object"==typeof e&&W.merge(r,n.constructor.defaultValues.filterable,e),r}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!0},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{Column.cellLabel}"},"vue","formula"];static autoExposeFields=!1;static setupFields(e,t){_s.setupFields(e,t);const n=t.fields,r=n.map;n.defs.forEach(((e,t)=>{if(e.defaultValue&&n.defaults[e.name]!==e.defaultValue&&"string"==typeof e.defaultValue&&e.defaultValue.match(/^L\{/)){const i={...e,defaultValue:n.defaults[e.name],definedBy:this,model:this,owner:this};n.defs[t]=i,r[e.name]=i}}))}construct(e,t,n,...r){const i=this,s=null==n?void 0:n.isRoot;s||(i.masterStore=t,t&&(i._grid=Array.isArray(t)?t[0].grid:t.grid),i.localizableProperties=ke.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(i.localeClass=e.localeClass)),super.construct(e,t,n,...r);const{grid:o}=i;if(!s){if(i.isLeaf&&!("field"in i.data)&&(i.setData("field","_"+(i.type||"")+ ++Rv.emptyCount),i.noFieldSpecified=!0),i.width||i.flex||i.children||i.setData({width:Rv.defaultWidth,flex:null},null,!0),i.headerWidgets&&i.initHeaderWidgets(i.headerWidgets),i.isParent&&(i.meta.visibleChildren=new Set,i.collapsible&&o.once("paint",(()=>i.collapsible=!0))),i.renderer){const e=i.renderer.toString();i.rendererReturningContent=e.includes("return ")||Boolean(e.match(xv))}!i.formula||i.field&&o.store.modelClass.getFieldDefinition(i.field)||console.warn(`No Model field found for this Column´s field: "${i.field}".`)}}shouldSync(e){return e.isColumn&&e.text===this.text&&(e.field===this.field||String(e.renderer)===String(this.renderer))&&(!e.previousSibling&&!this.previousSibling||e.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var e;return(null===(e=this.children)||void 0===e?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.grid.trigger("columnCollapseToggle",{column:this,collapsed:e})}onCellFocus(e){const t=this;t.location=e,-1!==e.rowIndex&&t.updateCellAriaLabel(t.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){Yn.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,n,r;null!==(t=this.location)&&void 0!==t&&t.isSpecialRow||null===(n=this.location)||void 0===n||!n.cell||(null!==(r=e)&&void 0!==r&&r.length||(e=this.location.column.text),Yn.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,t;null===(e=this.data)||void 0===e||null===(e=e.editor)||void 0===e||null===(t=e.destroy)||void 0===t||t.call(e),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const n of e){const e=oc.create({owner:this,...n});e.element.classList.add("b-grid-headerwidget"),t[e.ref||e.id]=e}}destroyHeaderWidgets(){for(const t of Object.values(this.headerWidgetMap||{})){var e;null===(e=t.destroy)||void 0===e||e.call(t)}}static generateAutoCls(){const e=[];for(let t=this;t!==Rv;t=t.superclass)t.type&&t.type!==t.superclass.type&&e.push(`b-${t.type.toLowerCase()}-cell`);const t=e.join(" ");return(Rv.autoClsMap||(Rv.autoClsMap=new Map)).set(this,t),t}getCellClass(e){var t;const{record:n,column:r}=e,{cellCls:i,internalCellCls:s,grid:o,constructor:a,align:l,field:d}=r,c=n.fieldMap[d],u=(null===(t=Rv.autoClsMap)||void 0===t?void 0:t.get(a))||a.generateAutoCls(),h=e.cell.classList.contains("b-editing"),g={[o.cellCls]:o.cellCls,[u]:u,[i]:i,[s]:s,"b-cell-dirty":o.showDirty&&d&&!(null!=c&&c.calculated)&&n.isFieldModified(d)&&(r.compositeField||!1!==(null==c?void 0:c.persist)),[`b-grid-cell-align-${l}`]:l,"b-selected":o.selectionMode.cell&&o.isCellSelected(e),"b-focused":o.isFocused(e),"b-auto-height":r.autoHeight,"b-editing":h};return n.isSpecialRow&&g["b-checkbox-selection"]&&(g["b-checkbox-selection"]=!1),g}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){const{sortable:e}=this.data;return!(!e||!(!this.noFieldSpecified&&this.field||e.sortFn))&&e}set sortable(e){this.set("sortable",e)}get groupable(){return Boolean(!(this.noFieldSpecified||!this.field)&&this.data.groupable)}set groupable(e){this.set("groupable",e)}get filterable(){return this.isLeaf&&this.data.filterable}get editor(){const e=this,{grid:t,field:n}=e;let{editor:r}=e.data;if(r&&!r.isWidget){const i=t.processCellEditor({editor:r,field:e.field});i?r=i.editor:("string"==typeof r&&(r={type:r}),r=oc.create(W.merge(e.defaultEditor,{owner:t,dataField:t.store.modelClass.getFieldDefinition(n),label:N.encodeHtml(e.text)},r)),r.formulaStore=t.store,nt.remove(r.localizableProperties,"label")),!r.dontCache&&(e.data.editor=r)}return r}set editor(e){this.data.editor=e}afterChange(){var e;if(super.afterChange(...arguments),null!==(e=this.data.editor)&&void 0!==e&&e.isWidget){const{editor:e}=this,t=N.encodeHtml(this.text);e.label!==t&&(e.label=t)}}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||(null===(e=this.parent)||void 0===e?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||(null===(e=this.grid)||void 0===e?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const e=this.region;let t=this.previousSibling;for(;t&&(t.hidden||t.region!==e);)t=t.previousSibling;return t}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||Boolean(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return Yn.getChild(this.element,".b-grid-header-text")}get textElement(){return Yn.down(this.element,".b-grid-header-text-content")}get contentElement(){return Yn.down(this.element,".b-grid-header-children")}get isSorted(){var e;return this.grid.store.sorters.some((e=>e.field===this.field))||(null===(e=this.grid.store.groupers)||void 0===e?void 0:e.some((e=>e.field===this.field)))}get isFocusable(){var e;return this.isLeaf&&!(null!==(e=this.grid)&&void 0!==e&&e.hideHeaders)}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?N.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const n=this,{parent:r}=n;if(!n.hidden){if(n.hidden=!0,r&&!r.isRoot&&!r.isTogglingAll){r.children.some((e=>!0!==e.hidden))||r.hidden||(e=!0,r.hide())}n.isParent?n.children.forEach((e=>e.hide(!0,!0))):r.isRoot||r.meta.visibleChildren[t?"add":"delete"](n),e||n.stores.forEach((e=>e.trigger("columnHide",{column:n})))}}show(e=!1){const t=this,{parent:n}=t;if(t.hidden){var r;if(t.hidden=!1,null!=n&&n.hidden&&n.show(),t.isParent)null===(r=t.meta.visibleChildren)||void 0===r||r.forEach((e=>e.show(!0)));e||t.stores.forEach((e=>e.trigger("columnShow",{column:t})))}}toggle(e){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}toggleChildren(e=this.children,t=void 0){var n,r;const i=this;null===(n=i.grid.columns)||void 0===n||n.beginBatch(),i.isTogglingAll=!0,e.forEach((e=>e.toggle(t))),i.isTogglingAll=!1,null===(r=i.grid.columns)||void 0===r||r.endBatch()}onCollapseChange(e=void 0){const t=this;if("toggleAll"===t.collapseMode)t.toggleChildren();else{var n,r;const{firstChild:i}=t;null!=i.flex&&t.collapsed?(i.oldFlex=i.flex,i.width=i.element.offsetWidth):!t.collapsed&&i.oldFlex&&(i.flex=i.oldFlex,i.oldFlex=null),null===(n=t.grid.columns)||void 0===n||n.beginBatch(),t.isTogglingAll=!0,t.children.slice(1).forEach((t=>t.toggle(e))),t.isTogglingAll=!1,null===(r=t.grid.columns)||void 0===r||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:n=[]}=t;if(e)n.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:"b-icon-collapse-"+(t.grid.rtl?"right":"left"),pressedIcon:"b-icon-collapse-"+(t.grid.rtl?"left":"right"),cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:e})=>t.collapsed=e});else{const e=n.findIndex((e=>"collapseExpand"===e.ref));e>-1&&n.splice(e,1)}t.headerWidgets=n,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){var e;const{grid:t}=this,n=[(null===(e=this.field)||void 0===e?void 0:e.replace(/\./g,"-"))??"col"];return t?(n.unshift(t.stateId??t.id),t.generatedIdIndex||(t.generatedIdIndex=0),n.push(t.generatedIdIndex+=1)):(Rv.generatedIdIndex||(Rv.generatedIdIndex=0),n.push(Rv.generatedIdIndex+=1)),this.meta.generatedId=n.join("-")}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return Yn.measureSize(e,null===(t=this.subGrid)||void 0===t?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return Ev(e)&&Ev(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),n=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,n,r)}resizeToFitContent(e,t,n=!1){var r;const i=this,{grid:s,element:o,fitMode:a}=i,{rowManager:l}=s,{records:d}=s.$store,c=d.length;if(c<=0||"none"===i.fitMode||!i.fitMode||Yn.isVueConfig(i.data))return;const[u]=l.rows,{rowElement:h,cellElement:g}=s.beginGridMeasuring(),m=new Dv({grid:s,column:i,id:null});let p,f,v,y,b,C,w=0,S={length:0,record:null};if(g._domData={columnId:i.id,row:u,rowElement:h},m._cell=g,m.updatingSingleRow=!0,m.isMeasuring=!0,g.innerHTML="",s.resizeToFitIncludesHeader&&!s.hideHeaders){if(!s.$headerPadding){const e=globalThis.getComputedStyle(o);s.$headerPadding=parseInt(e.paddingLeft)}const e=o.querySelector(".b-grid-header-text-content");e.style.cssText="flex: none; width: auto",w=e.offsetWidth+(s.cellEllipsis?1:0)+2*s.$headerPadding+2,e.style.cssText=""}for(c>1e3?(p=Math.max(Math.min(l.topIndex+Math.round(l.rowCount/2)-500,c-1e3),0),f=p+1e3):(p=0,f=c),v=p;v<f;v++){if(y=d[v],b=i.getRawValue(y),"value"===a)C=String(b).length;else if(m._record=y,m._id=y.id,m._rowIndex=v,u.renderCell(m),"textContent"===a)C=g.textContent.length;else{const e=g.offsetWidth+(s.cellEllipsis?1:0);e>w&&(w=e)}C>S.length&&(S={record:y,length:C,rowIndex:v})}if(null!==(r=s.features.summary)&&void 0!==r&&r.enabled){var D;const e=null===(D=s.getFooterElement(i))||void 0===D?void 0:D.querySelector(".b-grid-summary-value");if(e){const t=e.scrollWidth+2*s.$headerPadding+2;t>w&&(w=t)}}return S.length>0&&("value"===a||"textContent"===a)&&(m._record=S.record,m._id=S.record.id,m._rowIndex=S.rowIndex,u.renderCell(m),w=Math.max(w,g.offsetWidth)),Array.isArray(e)&&([e,t]=e),w=Math.max(w,e||0),w=Math.min(w,t||1e6),n||s.endGridMeasuring(),i.width=i.maxWidth?w=Math.min(w,i.maxWidth):w,w}getState(){const e=this,{parentId:t}=e,n={id:e.id,type:e.type,hidden:e.hidden,region:e.region,locked:e.locked,text:e.text};return e.noFieldSpecified||(n.field=e.field),null!=t&&(n.parentId=t),e.children||(n[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(n.collapsed=e.collapsed),n}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),"text"in e&&(t.text=e.text),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,n=e&&(null==t?void 0:t.focusedCell);(null==n?void 0:n.columnId)===this.id&&(t.owns(Yn.getActiveElement(t))?t.navigateRight():t._focusedCell=new Dv({grid:t,rowIndex:n.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e,t){return e.getValue(t?this.editorField:this.field)}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}refreshCells(){this.grid.refreshColumn(this)}refreshHeader(){this.grid.refreshHeader(this)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){return!this.readOnly&&this.editor&&!1!==e.isEditable(this.editorField)}insertChild(e,t=null,n=!1){return(e=Array.isArray(e)?e:[e]).forEach((e=>{const{parent:t}=e;null!=t&&t.collapsed&&e===t.firstChild&&t.children.length>1&&1===t.children.filter((e=>!e.hidden)).length&&(e.nextSibling.hidden=!1)})),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue({range:e,record:t,cell:n,value:r,enforceType:i}){let s=!this.readOnly&&!1!==t.isEditable(this.field);if(s&&i){var o;const e=t.getFieldDefinition(this.field),n=null==e||null===(o=e.constructor)||void 0===o?void 0:o.dataConstructor;s=null==r||!e||"auto"===(null==e?void 0:e.type)||n&&(r instanceof n||typeof r===n.name.toLowerCase())}return s}calculateFillValue({value:e,record:t,fromCell:n,range:r,horizontal:i}){const s=t.getFieldDefinition(this.field);return!i||1!==r.length||s&&"auto"!==(null==s?void 0:s.type)&&"string"!==(null==s?void 0:s.type)||(e=r[0].cell.innerText.trim()),e}getCurrentConfig(e){var t;const n=super.getCurrentConfig(e);return null!==(t=this.sortable)&&void 0!==t&&t.originalSortFn&&(n.sortable=this.sortable.originalSortFn),n.headerRenderer===this.internalHeaderRenderer&&delete n.headerRenderer,delete n.ariaLabel,delete n.cellAriaLabel,delete n.disableRendererWarning,n}get visible(){return this.isVisible}set visible(e){this.hidden=!e}get readOnly(){const{field:e,grid:t}=this,n=Boolean(this.get("readOnly"));var r;return e&&t&&(null===(r=t.store.modelClass.getFieldDefinition(e))||void 0===r?void 0:r.calculated)||n}set readOnly(e){this.set("readOnly",e)}get renderer(){var e;return(null===(e=this.data)||void 0===e?void 0:e.renderer)||this.defaultRenderer}set renderer(e){this.set("renderer",e)}get hasSummary(){return this.sum||this.summaries}get editorField(){const{field:e}=this,t=e&&this.grid.store.modelClass.getFieldDefinition(e);return null!=t&&t.formulaProviders?`#${e}`:e}}Rv.emptyCount=0,Rv.defaultWidth=100,Rv.exposeProperties(),Rv._$name="Column";const Tv={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},Mv=[{field:"region"}];class kv extends(Tr(Il)){static configurable={modelClass:Rv,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:Mv,reapplySortersOnAdd:!0,useRawData:!1};construct(e){const t=this,{grid:n}=e;n&&(n._columnStore=t,t.id=`${n.id}-columns`,n.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse((t=>e.push(t))),super.doDestroy(),this.isChained||e.forEach((e=>e.destroy()))}chain(e,t,n){return super.chain(e,t,{...n,tree:null})}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((n,r)=>e.call(t,n,r)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some((e=>e.flex))}calculateFixedWidth(e){return e.flex?e.measureSize(Rv.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>e.isVisible&&(!e.subGrid||!e.subGrid.collapsed))).sort(e.sorterFn)),e._visibleColumns}onStoreChange({action:e,changes:t}){("update"!==e||"hidden"in t)&&this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,null===(e=this.masterStore)||void 0===e||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),("update"!==e.action||"hidden"in e.changes||"region"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,n=!1){const r=this.visibleColumns,i=e instanceof Rv?e:this.getById(e);let s=r.indexOf(i)+(t?1:-1);if(!r[s]){if(!n)return null;s=t?0:r.length-1}return r[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}lookupStateColumns(e){const t=this.getById(e.id),{field:n,type:r}=e;return t||!n&&!r?[t]:this.query((e=>!(n&&e.field!==n||r&&e.type!==r)))}lookupStateColumn(e){return this.lookupStateColumns(e)[0]}createRecord(e){var t;const{grid:n={}}=this,{store:r}=n,i=null==r||null===(t=r.modelClass)||void 0===t||null===(t=t.fieldMap)||void 0===t?void 0:t[e.field];let s=this.modelClass;if(null!=i&&i.column&&(e=C.merge({},i.column,e)),e.type&&(s=kv.getColumnClass(e.type),!s))throw new Error(`Column type '${e.type}' not registered. Please make sure you have imported the column class.`);e.locked&&(e.region="locked",delete e.locked);const o=new s(e,this);if(o.data.region||(o.data.region=n.defaultRegion||"normal"),this.autoAddField&&!o.noFieldSpecified&&r&&!i){let e=o.field;o.constructor.fieldType&&(e={name:o.field,type:o.constructor.fieldType}),r.modelClass.addField(e)}return o}indexOf(e){if(null==e)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}removeAll(e=!1){const t=this;return t.some((e=>e.isTimeAxisColumn))?t.remove(t.query((e=>!e.isTimeAxisColumn)),e):super.removeAll(e)}get usesAutoHeight(){return this.some((e=>e.autoHeight))}get usesFlexAutoHeight(){return this.some((e=>e.autoHeight&&null!=e.flex))}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find((t=>t.field===e.field))}:e.type?{id:e.type,node:this.allRecords.find((t=>t.type===e.type))}:{id:null,node:null}}static registerColumnType(e,t=!1){e.simpleRenderer=t,(kv.columnTypes||(kv.columnTypes={}))[e.type]=e}static getColumnClass(e){return kv.columnTypes&&kv.columnTypes[e]}generateColumnForField(e,t){var n;"string"==typeof e&&this.grid&&(e=null===(n=this.grid.store)||void 0===n?void 0:n.modelClass.fieldMap[e]);let r=e.column||Tv[e.type]||{};return"string"==typeof r&&(r={type:r}),r=Object.assign({text:e.text||N.separate(e.name),field:e.name},t,r),null!=e.precision&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}kv.registerColumnType(Rv,!0),kv._$name="ColumnStore";class Fv extends Rv{static type="action";static $name="ActionColumn";static fields=[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}];static defaults={minWidth:30,filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,readOnly:!0,ariaLabel:"L{ActionColumn.rowActions}"};get groupHeaderReserved(){return!0}construct(e,t){const n=this;e.renderer&&(G.deprecate("grid","7.0.0","Using deprecated `renderer` with ActionColumn, use `afterRenderCell` callback instead."),e.afterRenderCell=e.renderer,delete e.renderer),super.construct(e,t),e.width||e.flex||n.grid.ion({paint:"updateAutoWidth",thisObj:n}),n.disableIfGridReadOnly&&n.grid.element.classList.add("b-actioncolumn-readonly")}defaultRenderer({grid:e,column:t,record:n,isExport:r,callExternalRenderer:i=!0}){var s;const o=n&&"groupRowFor"in n.meta,{subGrid:a}=t,l={className:{"b-action-ct":1},children:null===(s=t.actions)||void 0===s?void 0:s.map(((e,i)=>{var s;if("visible"in e&&("function"==typeof e.visible&&!1===e.visible({record:n})||!1===e.visible))return"";if(o&&!e.showForGroup||!o&&e.showForGroup)return"";const{tooltip:l,renderer:d}=e;let c,u="function"==typeof l||null!=l&&null!==(s=l.startsWith)&&void 0!==s&&s.call(l,"up.")?a.callback(l,a,[{record:n}]):l||"";if("string"==typeof u&&(u=this.optionalL(u,this)),d){const s=a.callback(d,a,[{index:i,record:n,column:t,isExport:r,tooltip:u,action:e}])??"";"string"==typeof s?c={tag:"span",class:"b-action-item b-tool",dataset:{...tm.encodeConfig(u),index:i},html:s}:(c=s,(c.dataset||(c.dataset={})).index=i,(c.className||(c.className={}))["b-action-item"]=1,c.className[e.cls]=e.cls)}else c={tag:"button",dataset:{...tm.encodeConfig(u),index:i},className:{"b-tool":1,"b-action-item":1,[e.cls]:e.cls}};const h=e.ariaLabel||c.dataset.btip;return h&&(c["aria-label"]=N.encodeHtml(h)),c}))};return r?l.children.flatMap((e=>e.html||[])).join(","):l}onCellClick({grid:e,column:t,record:n,target:r}){var i;let s;if(t!==this||!(s=r.closest(".b-action-item[data-index]")))return;const o=s.dataset.index,a=null===(i=t.actions)||void 0===i?void 0:i[o],l=null==a?void 0:a.onClick;l&&this.callback(l,t,[{record:n,action:a,target:r,grid:e,column:t}])}updateAutoWidth(){const e=this,t=[],{actions:n}=e;if(!e.element)return;const r=e.actions=[];null==n||n.forEach((e=>{const n={...e};delete n.visible,n.showForGroup?(delete n.showForGroup,t.push(n)):r.push(n)})),t.length>r.length&&(e._actions=t);const i=Yn.createElement(e.defaultRenderer({column:e,record:new e.grid.store.modelClass,callExternalRenderer:!1})).outerHTML;e.width=Yn.measureText(i,e.element,!0,e.element.parentElement),e.actions=n}}kv.registerColumnType(Fv),Fv.exposeProperties(),Fv._$name="ActionColumn";class Iv extends Rv{static type="number";static fieldType="number";static fields=[{name:"format",defaultValue:""},"min","max","step","largeStep","unit","renderer"];static defaults={filterType:"number",align:"end",exportedType:"number"};get defaultEditor(){const{format:e,name:t,max:n,min:r,step:i,largeStep:s,align:o}=this;return W.cleanupProperties({type:"numberfield",format:e,name:t,max:n,min:r,step:i,largeStep:s,textAlign:o})}get formatter(){const e=this,{format:t}=e;let n=e._formatter;return n&&e._lastFormat===t||(e._formatter=n=of.getLocalizedFormatter(e._lastFormat=t)),n}formatValue(e,t=!0){return null!=e&&(e=this.formatter.format(e),this.unit&&t&&(e=`${e}${this.unit}`)),e??""}defaultRenderer({value:e}){return this.formatValue(e)}updateLocalization(){super.updateLocalization(),this._formatter=null}}kv.registerColumnType(Iv,!0),Iv.exposeProperties(),Iv._$name="NumberColumn";class Av extends Iv{static type="aggregate";static fields=["function","includeParentInChangeSet","enableAggregation","includeFilteredOutRecords"];static get defaults(){return{function:"sum",includeParentInChangeSet:null,enableAggregation:!0,includeFilteredOutRecords:null}}construct(e,t){const n=this;n.configuredAlign="align"in e,n.configuredEditor="editor"in e,super.construct(...arguments);const{grid:r}=t;"sum"===n.function&&(n.function="sumChildren"),r&&(n.store=r.store)}set store(e){const t=this,n={update:"onRecordUpdate",thisObj:t,prio:1e3},r=t._store;if(e!==r){r&&r.un(n),t._store=e;const{modelClass:i}=e,s=i.fieldMap[t.field];s&&"number"===s.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.ion(n)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let t=0;for(let n=0,{length:r}=e;n<r;n++)t+=parseFloat(e[n]||0,10);return t}avg(...e){let t=0;const{length:n}=e;for(let r=0;r<n;r++)t+=parseFloat(e[r]||0,10);return t/n}onRecordUpdate({record:e,changes:t}){const n=this,{rowManager:r}=n.grid;n.field in t&&e.isLeaf&&e.bubble((e=>{const t=r.getRowFor(e);if(t){const e=t.getCell(n.field);e&&t.renderCell(e)}}),!0)}getRawValue(e){let t;const n=this,{field:r,grid:i,enableAggregation:s}=n,o=i.store.isFiltered&&n.includeFilteredOutRecords?e.unfilteredChildren:e.children;if(null!=o&&o.length){const a=n.function,l="string"==typeof a&&"function"==typeof Math[a],{handler:d,thisObj:c}=l?{handler:Math[a],thisObj:Math}:n.resolveCallback(a);t=s?d.apply(c,o.map((e=>n.getRawValue(e)))):void 0,n.includeParentInChangeSet&&!i.isTreeGrouped?e.set(r,t,!0):e.setData(r,t)}else t=e.getValue(r);return t}canFillValue({record:e}){return e.isLeaf&&super.canFillValue(...arguments)}}kv.registerColumnType(Av,!0),Av.exposeProperties(),Av._$name="AggregateColumn";const Lv=({source:e,value:t,userAction:n})=>{n&&e.cellInfo.record.setValue(e.name,t)};class Pv extends Rv{static $name="WidgetColumn";static type="widget";static fields=["widgets","disableRendererWarning"];static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1,ariaLabel:"L{WidgetColumn.rowWidgets}"}}construct(e){e.disableRendererWarning||(e.renderer&&(e.afterRenderCell=e.renderer,delete e.renderer,G.deprecate("grid","7.0.0","Using deprecated `renderer` with WidgetColumn, use `afterRenderCell` callback instead.")),this.renderer&&this.renderer!==this.defaultRenderer&&(e.afterRenderCell=this.renderer,this.renderer=this.defaultRenderer,G.deprecate("grid","7.0.0","Using deprecated `renderer` with WidgetColumn, use `afterRenderCell` callback instead."))),super.construct(...arguments);const t=this,{grid:n}=t;n&&(n.widgetColumnCache?t.widgetColumnCache=n.widgetColumnCache:(t.widgetColumnCache=n.widgetColumnCache=new Map,n.ion({removeRows:"onRemoveGridRows",thisObj:this})))}onRemoveGridRows({rows:e}){e.forEach((({columnWidgets:e})=>{e&&(this.freeWidgets([...e.values()].flat()),e.clear())}))}freeWidgets(e){null==e||e.forEach((e=>{var t;const{widgetColumnCache:n}=this,{column:r}=e.cellInfo,i=`${r.id}-${e.widgetColumnIndex}`;null===(t=r.onAfterWidgetDerendered)||void 0===t||t.call(r,e),e.cellInfo=e.__boundRecordId=e.owner=null,e.element.remove(),(n.get(i)||n.set(i,[]).get(i)).push(e)})),e.length=0}freeColumnWidgets(){const{id:e}=this;this.grid.rowManager.forEach((t=>{var n;const r=null===(n=t.columnWidgets)||void 0===n?void 0:n.get(e);null!=r&&r.length&&this.freeWidgets(r)}))}hide(){this.freeColumnWidgets(),super.hide(...arguments)}getWidget(e,t){var n;const r=this,{grid:i,widgetColumnCache:s}=r,o=`${t.column.id}-${e.widgetColumnIndex}`,a=s.get(o)||s.set(o,[]).get(o);let l,{length:d}=a;return d?(l=a[--d],delete l.onBeforeDestroy,a.length=d,e.owner=i,oc.reconfigure(l,e)):(r.onBeforeWidgetCreate(e,t),e.recomposeAsync=!1,e.owner=i,l=oc.create(e),r.onAfterWidgetCreate(l,t),l.name&&l.ion({change:Lv})),null===(n=r.onBeforeWidgetRender)||void 0===n||n.call(r,l),l}doDestroy(){this.grid.isDestroying?([...this.widgetColumnCache.values()].flat().forEach((e=>e.destroy())),this.widgetColumnCache.clear()):this.freeColumnWidgets(),super.doDestroy()}updateReadOnly(e){this.readOnly||this.grid.rowManager.forEach((t=>{var n;null===(n=t.columnWidgets)||void 0===n||null===(n=n.get(this.id))||void 0===n||n.forEach((t=>{t.cellInfo.record.readOnly||(t.readOnly=e)}))}))}defaultRenderer(e){const t=this,{grid:n}=t,{cellElement:r,column:i,record:s,row:o,isExport:a}=e,{widgets:l}=i;if(!a&&l){const a=o.columnWidgets||(o.columnWidgets=new Map),l=a.get(t.id);[...r.childNodes].forEach((e=>{var t;null!==(t=e.classList)&&void 0!==t&&t.contains("b-widget")||e.remove()})),e.widgets=i.widgets.map(((o,a)=>{var d,c;o.widgetColumnIndex=a;const u=(null==l?void 0:l[a])||t.getWidget(o,e);if(u.cellInfo=e,u.element.isConnected||(u.rendered?r.appendChild(u.element):u.render(r)),t.meta.isSelectionColumn||(u.readOnly=n.readOnly||s.readOnly||t.readOnly),!1!==(null===(d=t.onBeforeWidgetSetValue)||void 0===d?void 0:d.call(t,u,e))){const t=o.valueProperty||"value"in u&&"value"||u.defaultBindProperty;if(t&&(!i.noFieldSpecified&&1===i.widgets.length||u.name)){const n=u.name?s.getValue(u.name):e.value;"object"==typeof n&&u.__boundRecordId!==s.id&&(u[`_${t}`]=NaN),u.suspendEvents(),u[t]=n,u.resumeEvents(),u.__boundRecordId=s.id}}return null===(c=t.onAfterWidgetSetValue)||void 0===c||c.call(t,u,e),u})),a.set(t.id,e.widgets)}if(!l)return""}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}resizeToFitContent(){}}kv.registerColumnType(Pv),Pv.exposeProperties(),Pv._$name="WidgetColumn";class Ov extends Pv{static $name="CheckColumn";static type="check";static fields=["checkCls",{name:"checkAriaLabel",defaultValue:"L{Checkbox.toggleName}"},"showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"];static defaults={align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,minWidth:30,widgets:[{type:"checkbox",valueProperty:"checked"}]};construct(e,t){e.localizableProperties=ke.mergeMethods.distinct(e.localizableProperties,["checkAriaLabel"]),super.construct(...arguments);const n=this;if(n.widgets[0].cls=n.checkCls,Object.assign(n,{externalHeaderRenderer:n.headerRenderer,externalOnBeforeWidgetSetValue:n.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:n.onAfterWidgetSetValue}),n.setData({onBeforeWidgetSetValue:n.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:n.internalOnAfterWidgetSetValue,headerRenderer:n.internalHeaderRenderer}),!n.meta.isSelectionColumn){var r;const t=null===(r=n.grid)||void 0===r?void 0:r.store.modelClass;n.field?!t||"boolean"==typeof n[n.field]||t.fieldMap[n.field]||n.constructor.suppressNoModelFieldWarning||e.suppressNoModelFieldWarning||(console.warn(n.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),t.addField({name:n.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}get groupHeaderReserved(){return this.grid.selectionMode.showCheckAllInGroupRows}doDestroy(){var e;null===(e=this.headerCheckbox)||void 0===e||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let n;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new Xm({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):n=t.headerText,n=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):n,t.showCheckAll?void 0:n}updateCheckAllState(e){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=e,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:n}=t.grid;n.beginBatch(),n.forEach((n=>t.updateRecord(n,t.field,e))),n.endBatch()}t.trigger("toggleAll",{checked:e})}defaultRenderer(e){var t;const{value:n,isExport:r,record:i}=e,{grid:s}=this,o=super.defaultRenderer(e),a=null===(t=e.widgets)||void 0===t?void 0:t[0];return r?null!=o?o:null==n?"":n:(a.readOnly=this.readOnly||(s.readOnly||i.readOnly)&&!this.meta.isSelectionColumn,n?a.input.setAttribute("checked",!0):a.input.removeAttribute("checked"),a.input.setAttribute("aria-label",this.checkAriaLabel),o)}onBeforeWidgetRender(e,t){e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}onAfterWidgetDerendered(e,t){e.un({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e,{cellElement:t}){var n;t.widget=e,e.record=e.cellInfo.record,null===(n=this.externalOnBeforeWidgetSetValue)||void 0===n||n.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;null===(t=this.externalOnAfterWidgetSetValue)||void 0===t||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:n}){const r=this,{grid:i}=r,{record:s}=e.cellInfo;return!(n&&r.field&&(!i.features.cellEdit||i.features.cellEdit.disabled)||!(!r.meta.isSelectionColumn||i.isSelectable(s)||i.selectionMode.showCheckAllInGroupRows&&s.isGroupHeader)&&t)&&r.trigger("beforeToggle",{record:s,checked:t})}onCheckboxChange({source:e,checked:t}){const n=this,{record:r}=e.cellInfo,{field:i}=n;i&&(n.updateRecord(r,i,t),t?n.updateCheckAllState(n.grid.store.every((e=>e[i]),null,!0)):n.updateCheckAllState(!1)),n.trigger("toggle",{record:r,checked:t,checkbox:e})}updateRecord(e,t,n){e.setValue(t,n)}onCellKeyDown({event:e,cellElement:t,record:n}){if(" "===e.key){const{target:r}=e,i=t.widget;r.matches(".b-grid-cell")&&!(null!=n&&n.readOnly||i.disabled||i.readOnly)&&(null==i||i.toggle(),e.preventDefault(),e.handled=!0)}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}}kv.registerColumnType(Ov,!0),Ov._$name="CheckColumn";class $v extends Rv{static $name="ColorColumn";static type="color";static fields=["colors",{name:"addNoColorItem",defaultValue:!0}];static defaults={align:"center",editor:"colorfield"};preventCellEditViaMouse=!0;construct(){super.construct(...arguments);const e=this,{editor:t,colors:n}=e;null!=n&&n.length&&(t.colors=n),t.addNoColorItem=e.addNoColorItem,t.ion({colorSelected:"onColorSelected",thisObj:e})}applyValue(e,t,n){if(!this.isConstructing){const{editor:e}=this;"colors"===t?e.colors=n:"addNoColorItem"===t&&(e.addNoColorItem=n)}super.applyValue(...arguments)}get picker(){return this.editor.picker}defaultRenderer({value:e}){let t="b-empty",n=e;if(e){const r=this.picker.getColorClassName(e);r?(t=r,n=null):t=""}return{className:"b-color-cell-inner "+t,style:{backgroundColor:n},"data-btip":e}}onCellClick({grid:e,record:t,target:n}){var r;if(n.classList.contains("b-color-cell-inner")&&!this.readOnly&&!e.readOnly&&!t.isSpecialRow&&!t.readOnly&&(null===(r=e.features.cellEdit)||void 0===r||!r.finishEditingPromise)){const{picker:e}=this,r=t.get(this.field);this._editingRecord=t,e.deselectAll(),e.select(r),e.refresh(),e.showBy(n)}}onColorSelected({color:e}){var t;null!==(t=this.grid.features.cellEdit)&&void 0!==t&&t.isEditing||!this._editingRecord||this._editingRecord.set(this.field,e)}}kv.registerColumnType($v),$v._$name="ColorColumn";class _v extends Rv{static $name="DateColumn";static type="date";static fieldType="date";static fields=["format","pickerFormat","step","min","max","renderer"];static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}construct(e={},t){if(super.construct(e,t),this.grid){const{field:t}=this,{store:n}=this.grid,{modelClass:r}=n,i=t&&r.getFieldDefinition(t);if(i&&!i.isDateDataField){console.warn(`DateColumn expects the \`type\` of the model field \`${t}\` to be of type \`date\``);const s=r.addField({...i.getCurrentConfig(),type:"date",["format"in e?"format":void 0]:this.format});n.forEach((e=>e.data[i.dataSource]=s.convert(e[t])))}}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=xi.parse(e,this.format||void 0)),xi.format(e,this.format||void 0)}set format(e){const{editor:t}=this.data;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:t,max:n,step:r,format:i}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:i,max:n,min:t,step:r}}}kv.registerColumnType(_v,!0),_v.exposeProperties(),_v._$name="DateColumn";class Hv extends Iv{circleHeightPercentage=.75;static type="percent";static fields=["showValue","lowThreshold","showCircle","mode"];static defaults={min:0,max:100,step:1,align:null,showCircle:!1,mode:"bar",showValue:!1,lowThreshold:0,htmlEncode:!1,searchable:!1,summaryRenderer:({sum:e})=>`${e}%`,fitMode:!1};construct(){super.construct(...arguments),this.showCircle&&(G.deprecate("core","7.0.0","PercentColumn `showCircle` is deprecated, in favor of `mode`"),this.mode="circle")}defaultRenderer({value:e,record:t,isExport:n}){var r;e=e||0;const i=this,s=i.formatValue(e,t)||e,o=`${i.text?`${i.text} : `:""}${s}`;if(n)return s;if("number"===i.mode)return s+"%";const{min:a,max:l}=i;if("circle"===i.mode){var d;const n=Math.round(i.circleHeightPercentage*i.grid.rowHeight)+"px";return{tabIndex:0,role:"progressbar","aria-valuemin":a,"aria-valuemax":l,"aria-valuenow":e,"aria-label":(null===(d=i.formatAriaLabel)||void 0===d?void 0:d.call(i,o,t))||o,className:{"b-percentdone-circle":1,"b-empty":0===e,"b-full":100===e,"b-over":e>100},style:{height:n,width:n,"--grid-percent-circle-angle":e/100+"turn"},dataset:{value:s}}}return{className:"b-percent-bar-outer",role:"progressbar","aria-valuemin":a,"aria-valuemax":l,"aria-valuenow":e,"aria-label":(null===(r=i.formatAriaLabel)||void 0===r?void 0:r.call(i,o,t))||o,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===e,"b-low":e<i.lowThreshold,"b-full":100===e,"b-over":e>100},style:{width:e+"%"},children:[i.showValue?{tag:"span",text:s+"%"}:void 0]}]}}resizeToFitContent(){if("number"===this.mode)return super.resizeToFitContent(...arguments)}get align(){const e=this.get("align"),{mode:t}=this;return e||("number"===t?"end":"circle"===t?"center":"start")}set align(e){this.set("align",e)}get htmlEncode(){return"number"===this.mode}get internalCellCls(){return"bar"===this.mode?"b-percent-bar-cell":""}}Hv.sum="average",kv.registerColumnType(Hv,!0),Hv._$name="PercentColumn";class Vv extends Iv{preventCellEditViaMouse=!0;static $name="RatingColumn";static type="rating";static fieldType="number";static fields=["emptyIcon","filledIcon","editable"];static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,exportedType:"string",filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",align:"start",fitMode:"value"}}defaultRenderer({value:e,isExport:t}){return t?"★".repeat(e):{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:nt.populate(this.max,(t=>{const n=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":n,"b-empty":!n,[n?this.filledIcon:this.emptyIcon]:!0}}}))}}onCellClick({grid:e,column:t,record:n,target:r,event:i}){if(r.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===n.getValue(t.field)&&0===e&&(e=-1),n.set(t.field,e+1)}}}kv.registerColumnType(Vv,!0),Vv.exposeProperties(),Vv._$name="RatingColumn";class Nv extends Rv{static $name="RowNumberColumn";static type="rownumber";static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,mergeable:!1,minWidth:50,width:50,align:"right",text:"#",ariaLabel:"L{RowNumberColumn.rowNumber}",editor:!1,readOnly:!0}}construct(e){super.construct(...arguments);const t=this,{grid:n}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.setData("headerRenderer",t.internalHeaderRenderer),n&&(n.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:n.store,initial:!0}),n.store.count&&!n.rendered&&n.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const n=this;n.detachListeners("grid"),e.ion({name:"grid",[`change${n.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:n}),t||n.resizeToFitContent()||n.measureOnRender()}onStoreChange({action:e,isMove:t}){if("dataset"===e||"add"===e||"remove"===e||"removeall"===e){if("remove"===e&&t)return;const n=this.resizeToFitContent();"dataset"===e&&!n&&this.grid.store.count&&this.measureOnRender()}}measureOnRender(){this.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:this})}defaultRenderer({record:e,grid:t}){var n;let r=e.isSpecialRow?"":t.store.indexOf(e,!0)+1;var i;null!==(n=t.splitFrom)&&void 0!==n&&n.isLockedRows&&(r+=(null===(i=t.splitFrom.features.lockRows)||void 0===i?void 0:i.numberOfLockedRows)??0);return r}resizeToFitContent(){var e;const t=this,n=null===(e=t.grid.features.lockRows)||void 0===e?void 0:e.subViews,r=(null==n?void 0:n[1])===t.grid?n[0]:t.grid,{element:i}=r,{store:s}=r,{count:o}=s;if(o&&!t.hidden){const e=i.querySelector(`.b-grid-cell[data-column-id="${t.id}"]`);if(e){const n=e.isConnected?parseInt(Yn.getStyleValue(e,"padding-left")):t._cachedCellPadding||0,r=Yn.measureText(o,e);return t.width=Math.max(t.minWidth,r+2*n),t._cachedCellPadding=n,!0}}return!1}set flex(e){}internalHeaderRenderer({headerElement:e,column:t}){var n;return e.classList.add("b-rownumber-header"),(null===(n=t.externalHeaderRenderer)||void 0===n?void 0:n.call(this,...arguments))||t.headerText}}kv.registerColumnType(Nv,!0),Nv._$name="RowNumberColumn";class Bv extends Rv{static type="template";static fields=["template"];static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}defaultRenderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:this.field})}}kv.registerColumnType(Bv,!0),Bv.exposeProperties(),Bv._$name="TemplateColumn";class zv extends Rv{static $name="TimeColumn";static type="time";static fieldType="date";static fields=["format"];static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=xi.parse(e,this.format)),xi.format(e,this.format)}set format(e){const{editor:t}=this;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"timefield",format:this.format}}}kv.registerColumnType(zv,!0),zv.exposeProperties(),zv._$name="TimeColumn";class jv extends Rv{static $name="TreeColumn";static type="tree";static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}construct(e,t,...n){super.construct(e,t,...n);const r=this;r.shouldHtmlEncode=r.htmlEncode,r.setData("htmlEncode",!1);const{renderer:i}=r;!i||r.grid.splitFrom||r.grid.initialConfig.splitFrom||(r.originalRenderer=i),r.setData("renderer",r.treeRenderer.bind(r))}treeRenderer(e){var t;const n=this,{grid:r,cellElement:i,row:s,record:o,isExport:a}=e,{features:l}=r;if(!l.tree)throw new Error("TreeColumn requires the Tree feature to be enabled");const d=o.instanceMeta(r.store),c=!o.isLeaf&&d.collapsed,u={className:"b-tree-cell-value"},h=[u],g={className:{"b-tree-cell-inner":1},tag:o.href?"a":"div",href:o.href,target:o.target,children:h},m=l.tree.treeLines,p=r.isTreeGrouped&&!o.isLeaf&&l.treeGroup.parentRenderer;let f,v,{value:y}=e,b=n;if(n.originalRenderer||p){var C;let t;if(p){var w;if(o.field)if(b=r.columns.get(o.field),b)y=b.isWidgetColumn?y:(null===(w=b===n?b.originalRenderer:b.renderer)||void 0===w?void 0:w.call(b,{...e,column:b,value:o.name,isTreeGroup:!0}))??o.name;else y=o.name;t=l.treeGroup.parentRenderer({...e,field:o.field,value:y,column:b,record:o.firstGroupChild,grid:r})}else t=n.originalRenderer(e);const s=null===(C=r.hasFrameworkRenderer)||void 0===C?void 0:C.call(r,{cellContent:t,renderingColumn:b});f="object"==typeof t&&!s,y=s?"":!1===t?i.innerHTML:t,e.rendererHtml=t}if(f||(y=String(y??"")),a)return y;if(o.isLeaf)i.classList.add("b-tree-leaf-cell"),v=e.iconCls||o.iconCls||n.leafIconCls;else{var S;const t=o.isExpanded(r.store),a=t?n.collapseIconCls:n.expandIconCls,l=c?n.expandedFolderIconCls:n.collapsedFolderIconCls;i.classList.add("b-tree-parent-cell"),i.setAttribute("aria-expanded",t),s.toggleCls("b-loading-children",Boolean(d.isLoadingChildren)),h.unshift({tag:"i",className:{"b-tree-expander":1,[a]:1,"b-empty-parent":!(d.isLoadingChildren||!0===o.children||null!==(S=o.children)&&void 0!==S&&S.length)}}),o.meta.hasIcon=v=e.iconCls||o.iconCls||l}if(v&&h.splice(h.length-1,0,{tag:"i","aria-hidden":"true",className:{"b-tree-icon":1,[v]:1}}),s.isRow&&!o.isLeaf)if(s.setAttribute("aria-expanded",!c),c)s.removeAttribute("aria-owns");else for(const e in r.subGrids){var D,E;const t=s.elements[e];Yn.setAttributes(t,{"aria-owns":null!==(D=o.children)&&void 0!==D&&D.length?null===(E=o.children)||void 0===E?void 0:E.map((t=>`${r.id}-${e}-${t.id}`)).join(" "):null})}Array.isArray(y)?u.children=y:f?Object.assign(u,y):null!==(t=b)&&void 0!==t&&t.shouldHtmlEncode||!y.includes("<")?(g.className["b-text-value"]=1,u.text=y):u.html=y;let x=0;var R;o.isLeaf?x+=null!==(R=o.parent)&&void 0!==R&&R.meta.hasIcon?2.2:v?.5:.4:x+=v?-.15:0;const T=[];if(m)for(let e=0;e<o.childLevel;e++)T.push({tag:"span",style:`margin: 0 ${n.indentSize/2-.2-.125}em 0 ${n.indentSize/2+.2}em`,className:`b-tree-line b-tree-line-${e}`});else x+=o.childLevel*n.indentSize;return g.style=`padding-inline-start:${x}em`,m?[...T,g]:g}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.renderer=this.originalRenderer,t}isTreeExpanderIcon(e){return e.matches("."+this.expandIconCls.trim().replace(/\s/g,".")+",."+this.collapseIconCls.trim().replace(/\s/g,"."))}}kv.registerColumnType(jv,!0),jv.exposeProperties(),jv._$name="TreeColumn";class Wv extends _s{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0},{name:"fixed",type:"boolean",internal:!0}]}}Wv.exposeProperties(),Wv._$name="GridRowModel";const Uv={cut:1,copy:1,paste:1};class Gv extends(Mr.mixin(Xh)){static configurable={copyOnly:null,keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!1,toCopyString:null,toPasteValue:null,emptyValueChar:" ",dateFormat:"lll",generateNewName(e,t,n=this.client.store){const{nameField:r}=this;let i=e.getValue(r),s=2;(null==t?void 0:t.meta.generatedName)===i&&(i=t.meta.originalName);let o=i;if(null!=o&&""!==o)for(;n.findRecord(r,o);)o=`${i} - ${s}`,s+=1;return e.meta.generatedName=o,e.meta.originalName=i,o}};get clipboardRecords(){return this.clipboardData||[]}isActionAvailable({event:e,actionName:t}){var n,r;return!!Uv[t]&&!(this.disabled||0!==globalThis.getSelection().toString().length||"copy"!==t&&this.copyOnly||null!==(n=this.client.features.cellEdit)&&void 0!==n&&n.isEditing||null!==(r=this.client.focusedCell)&&void 0!==r&&r.isSpecialRow||Yn.isEditable(e.target,!0))}cellsToString(e){const t=this;let n=0,r=0,i="";e.sort(((e,t)=>e.rowIndex===t.rowIndex?e.columnIndex-t.columnIndex:e.rowIndex-t.rowIndex));for(const l of e){var s,o;const{record:e,_column:d,rowIndex:c,columnIndex:u}=l;c>n?(i.length>0&&(i+="\n".repeat(c-n)),n=c,r=u):u>r&&(i.length>0&&(i+="\t".repeat(u-r)),r=u);let h=null==d||null===(s=d.toClipboardString)||void 0===s?void 0:s.call(d,l);var a;if(void 0===h)if(h=e.getValue(d.field),h instanceof Date)h=xi.format(h,t.dateFormat);else h=null===(a=h)||void 0===a?void 0:a.toString();t.toCopyString&&(h=t.toCopyString({currentValue:h,column:d,record:e})),h=null===(o=h)||void 0===o?void 0:o.replaceAll(/[\n\t]/g," "),i+=h||t.emptyValueChar}return i}setFromStringData(e,t=!1,n=this.client.store,r){const i=this,{client:s}=i,{columns:o,selectedCells:a,_shiftSelectRange:l}=s,d=new Set,c=i.stringAs2dArray(e),u=[],h=[];if(t||(null==l?void 0:l.length)!==a.length)!t&&a.length>1&&1===c.length&&1===c[0].length&&u.push(...a);else{const e=i.cellSelectorsAs2dArray(l);if((null==e?void 0:e.length)%c.length==0&&e.columnCount%c.columnCount==0)for(let t=0;t<e.length;t+=c.length)for(let n=0;n<e.columnCount;n+=c.columnCount)u.push(e[t][n])}u.length||u.push(null==a?void 0:a[0]);for(const e of u)for(let a=0;a<c.length;a++){const l=c[a],u=t?n.createRecord():n.getAt(e.rowIndex+a);if(u&&!u.readOnly){for(let n=0;n<l.length;n++){const a=r?null:o.visibleColumns[t?n:e.columnIndex+n],d=(null==a?void 0:a.field)||(null==r?void 0:r[n]);let c=l[n];if(d&&c&&(null==a||!a.readOnly)){var g;if(c===i.emptyValueChar&&(c=null),null!=a&&a.fromClipboardString&&(c=a.fromClipboardString({string:c,record:u})),i.toPasteValue&&(c=i.toPasteValue({currentValue:c,record:u,column:a,field:d})),"string"==typeof c&&null!==(g=u.getFieldDefinition(d))&&void 0!==g&&g.isDateDataField){const e=xi.parse(c,i.dateFormat);isNaN(e.getTime())||(c=e)}u.set(d,c,!1,!1,!1,!0),a&&h.push(s.normalizeCellContext({column:a,record:u}))}}d.add(u)}}return{modifiedRecords:[...d],targetCells:h}}cellSelectorsAs2dArray(e){const t=[];let n,r=null;for(const i of e)i.id!==r&&(r=i.id,n=[],t.push(n)),n.push(i);return t.columnCount=t[0].length,!t.some((e=>e.length!==t.columnCount))&&t}stringAs2dArray(e){const t=[],n=e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/).filter((e=>e.length));for(const e of n){const n=e.split("\t");if(t.columnCount&&n.length!==t.columnCount)return!1;t.columnCount=n.length,t.push(n)}return t}}Gv._$name="CopyPasteBase";const Yv=new Map,qv=new Map,Kv="Grid",Xv={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},Zv=/\$\d+$/;class Jv{static registerFeature(e,t=!1,n=null,r=null){r=(r=N.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(Zv,""),Array.isArray(n)||(n=[n||Kv]),n.forEach((n=>{const i=Xv[n]||n,s=Yv.get(i)||new Map,o=qv.get(i)||new Map;s.set(r,e),o.set(e,t),Yv.set(i,s),qv.set(i,o)}))}static getTypeNameFeatures(e=Kv){const t=Xv[e]||e,n=Yv.get(t),r={};return n&&n.forEach(((e,t)=>r[t]=e)),r}static getTypeNameDefaultFeatures(e=Kv){const t=Xv[e]||e,n=Yv.get(t),r=qv.get(t),i={};return n&&r&&n.forEach(((e,t)=>{r.get(e)&&(i[t]=e)})),i}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[n,r])=>(this.isDefaultFeatureForTypeName(r,t)?e[n]=r:delete e[n],e)),e)),{})}static isDefaultFeatureForTypeName(e,t=Kv){const n=Xv[t]||t,r=qv.get(n);return r&&r.get(e)||!1}static isDefaultFeatureForInstance(e,t){const n=t.$meta.names.slice().reverse();let r=null;for(let t=0,i=n.length;t<i&&null===r;++t){const i=qv.get(n[t]);i&&i.has(e)&&(r=i.get(e))}return r||!1}static reset(){Yv.clear(),qv.clear()}}class Qv extends Gv{static $name="CellCopyPaste";static get pluginConfig(){return{chain:["populateCellMenu","afterSelectionModeChange"]}}static configurable={useNativeClipboard:!G.isTestEnv,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}",allowedDataSources:"none"};afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}entityName="cell";set copyOnly(e){this._copyOnly=e}get copyOnly(){var e;return null==this._copyOnly?!(null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.enabled):Boolean(this._copyOnly)}get canCopy(){var e;const{client:t}=this;return Boolean(!this.disabled&&t.selectedCells.length&&(!t._selectedRows.length||(null===(e=t.features.rowCopyPaste)||void 0===e?void 0:e.disabled)||t.focusedCell&&t.isCellSelected(t.focusedCell)))}get canCutPaste(){var e;return this.canCopy&&!this.copyOnly&&!(null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.isEditing)&&!this.client.readOnly}isActionAvailable({actionName:e}){return super.isActionAvailable(...arguments)&&this.canCopy&&("copy"===e||this.canCutPaste)}async cut(){await this.copy(!0)}async copy(e=!1){"boolean"!=typeof e&&(e=!1);const t=this,{selectedCells:n}=t.client,r=e?n.filter((e=>{var t;return!(null!==(t=e.record)&&void 0!==t&&t.readOnly)})):n;if(r){if(e?!t.canCutPaste:!t.canCopy)return;const n=t.cellsToString(r);if(void 0===await t.writeToClipboard(n,e,{cells:r}))return;if(!0===e)for(const e of r){const{column:t,record:n}=e;if(!t.readOnly){let r=null;t.fromClipboardString&&(r=t.fromClipboardString({string:r,record:n})),e.record.set(e.column.field,r)}}t.client.trigger("copy",{cells:r,copiedDataString:n,isCut:e,entityName:t.entityName})}}async beforeCopy({data:e,isCut:t,cells:n}){return await this.client.trigger("beforeCopy",{cells:n,data:e,isCut:t,entityName:this.entityName})}async paste(){var e;const t=this,{client:n,entityName:r}=t,i=n.selectedCells[0];if(!t.canCutPaste||!i)return;const s=null===(e=await t.readFromClipboard({},!0))||void 0===e?void 0:e.data;if(!s)return;const{modifiedRecords:o,targetCells:a}=t.setFromStringData(s);1===n.selectedCells.length&&a.length>1&&n.selectCellRange(a[0],a[a.length-1]),n.trigger("paste",{clipboardData:s,targetCell:i,modifiedRecords:[...o],entityName:r})}async beforePaste({data:e,text:t}){return await this.client.trigger("beforePaste",{clipboardData:e,targetCell:this.client.selectedCell,entityName:this.entityName,text:t})}populateCellMenu({record:e,items:t}){const n=this;n.canCopy&&(t.cutCell={text:n.cutText,localeClass:n,icon:"b-icon b-icon-cut",weight:115,disabled:e.readOnly||!n.canCutPaste,onItem:()=>n.cut()},t.pasteCell={text:n.pasteText,localeClass:n,icon:"b-icon b-icon-paste",weight:120,disabled:e.readOnly||!n.canCutPaste||!1===n.hasClipboardData(),onItem:()=>n.paste()},t.copyCell={text:n.copyText,localeClass:n,cls:"b-separator",icon:"b-icon b-icon-copy",weight:110,onItem:()=>n.copy()})}}Qv._$name="CellCopyPaste",Jv.registerFeature(Qv);class ey extends(Hi(Mr)){static#e=ef(this,"name","GridEditBase");static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}static configurable={continueEditingOnCellClick:!0,autoEdit:null,triggerEvent:"celldblclick",ignoreCSSSelector:"button,.b-icon,.b-fa,svg,input,.b-widget"};construct(e,t){super.construct(e,t);const n=this,r={cellClick:"onCellClick",readOnly:"syncEditingReadOnly",thisObj:n};n.grid=e,"cellclick"!==n.triggerEvent&&(r[n.triggerEvent]="onTriggerEditEvent"),e.ion(r),n.bindStore(e.store)}doDestroy(){this.grid.columns.allRecords.forEach((e=>{var t;null===(t=e._cellEditor)||void 0===t||t.destroy()})),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}async onCellClickWhileEditing({event:e,cellSelector:t}){const n=this;e.target.closest(".b-editor")||(Yn.isTouchEvent||e.target.matches(n.ignoreCSSSelector)?await n.finishEditing():n.finishEditingPromise||n.editorContext&&!n.editorContext.editor.owns(e.target)&&(n.getEditingContext(t)?n.isRowEdit?n.continueEditingOnCellClick?await n.startEditing(t):n.cancelEditing():await n.finishEditing()?n.continueEditingOnCellClick&&await n.startEditing(t):(n.grid.focusCell(n.editorContext),n.editor.focus()):await n.finishEditing()))}async onCellClick({cellSelector:e,target:t,event:n,column:r}){const i=this,{focusedCell:s}=i.client;if(t.closest(".b-tree-expander"))return!1;Yn.isTouchEvent&&i._lastCellClicked===(null==s?void 0:s.cell)&&n.timeStamp-i.touchEditDelay>i._lastCellClickedTime?await i.startEditing(e):"cellclick"===this.triggerEvent&&await i.onTriggerEditEvent(...arguments),i._lastCellClicked=null==s?void 0:s.cell,i._lastCellClickedTime=n.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:t,event:n,column:r}){var i;const{editorContext:s,client:o}=this;r.preventCellEditViaMouse||t.closest(".b-tree-expander")||Yn.isTouchEvent&&"dblclick"===n.type||n&&(null===(i=o.features.cellMenu)||void 0===i?void 0:i.triggerEvent)===n.type||(!s||!s.equals(this.grid.normalizeCellContext(e))&&await this.finishEditing())&&await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:n}=this;null!=n&&n.editor.isVisible&&(t!==n.record||!e.readOnly&&n.editor.dataField&&!(n.editor.dataField in e)||n.editor.refreshEdit())}onStoreRemove({changes:e,records:t}){const{editorContext:n}=this;null!=n&&n.editor.isVisible&&t.includes(n.editor.record)&&this.cancelEditing()}}ey._$name="GridEditBase";const ty={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},ny={...ty,startEditing:1,finishAllSelected:1},ry={cancel:"cancelEditing",complete:"finishEditing"};class iy extends ey{static $name="CellEdit";static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",scrollAction:null,addNewAtEnd:null,addToCurrentParent:!1,editNextOnEnterPress:!0,editorClass:sf,touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:{handler:"finishAndEditNextCell",weight:100},"Shift+Tab":{handler:"finishAndEditPrevCell",weight:100}},validateTapOut:null,tabToFocusables:null}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const n=this,r={renderRows:"onGridRefreshed",thisObj:n};n.autoEdit&&!("editNextOnEnterPress"in t)&&(n.editNextOnEnterPress=!1),e.ion(r),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:n})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",remove:"onStoreRemove",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&($f.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await $f.confirm(e),$f.owner=null),t===$f.yesButton}getEditorForCell({id:e,cell:t,column:n,columnId:r,editor:i}){var s;const o=this,{grid:a,editorClass:l}=o;let d=n.cellEditor,c=0;if(n.editTargetSelector){c=t.querySelector(n.editTargetSelector).offsetLeft}var u;(i.autoSelect=o.autoSelect,null!==(s=d)&&void 0!==s&&s.isEditor)||(d=n.data.cellEditor=l.create(l.mergeConfigs({type:l.type,cls:"b-cell-editor",inputField:i,blurAction:"none",invalidAction:n.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[c,0]},internalListeners:o.getEditorListeners(n.managedCellEditing),onInternalKeyDown:o.onEditorKeydown.bind(o),allowMouseEvents:i.allowMouseEvents,instantUpdate:n.instantUpdate},null!==(u=d)&&void 0!==u&&u.floating?{align:{align:"t0-b0",allowTargetOut:!1,minHeight:100},matchSize:!1,scrollAction:"realign"}:{constrainTo:null},d)));d.minHeight=a.rowHeight,d.inputField!==i&&(d.remove(d.items[0]),d.add(i));const h=d.inputField,g=n.instantUpdate&&!i.cellEditValueSetter;return d.instantUpdate=g,d.align.offset[0]=c,g&&(W.wrapProperty(i,"value",null,(e=>{const{editorContext:t}=o;if(t){const{record:n}=t,{editorField:r}=t.column;t.editor.isValid&&!W.isEqual(n.getValue(r),e,!0)&&(null==h||!h.isDateField||null!=h&&h._isPickerInput?(n.setValue(r,e),h._outstandingUpdate=!1):h._outstandingUpdate=!0)}})),i.cellEditValueSetter=!0),Object.assign(d.element.dataset,{rowId:e,columnId:r,field:n.editorField}),d.inputField.revertOnEscape=n.revertOnEscape,o.editor=d}getEditorListeners(e){return{focusOut:e?"onEditorFocusOut":null,focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",afterEdit:"onEditorAfterEdit",thisObj:this}}syncEditingReadOnly({readOnly:e}){this.isEditing&&e&&this.cancelEditing()}onEditorStart({source:e}){const t=this,n=t.editorContext=e.cellEditorContext;if(n){var r,i;const{grid:e}=t;"cellclick"!==t.triggerEvent&&(t.detachListeners("cellClickWhileEditing"),e.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:t})),null===(r=t.removeEditingListeners)||void 0===r||r.call(t),null===(i=t.removeScrollListener)||void 0===i||i.call(t),n.column.managedCellEditing&&(t.removeEditingListeners=ir.addListener({globaltap:"onTapOut",thisObj:t})),t.scrollAction&&(t.removeScrollListener=Jt.on({element:document,scroll:"onScroll",thisObj:t,capture:!0})),e.trigger("startCellEdit",{grid:e,editorContext:n})}}onScroll(){Yn.isInView(this.editor.element)||this[ry[this.scrollAction]]()}onEditorBeforeComplete(e){const{grid:t}=this,n=e.source.cellEditorContext;return e.grid=t,e.editorContext=n,n.oldValue=n.value,n.value=n.editor.inputField.value,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,n=e.cellEditorContext;if(n){if(n.value=e.inputField.value,e.dataField.includes(".")){var r;const n=e.dataField.split(".")[0];null!==(r=e.record.constructor.relations)&&void 0!==r&&r[n]&&t.rowManager.refresh()}t.trigger("finishCellEdit",{grid:t,editorContext:n})}}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:n,grid:r}=this;n||r.trigger("cancelCellEdit",{grid:r,editorContext:t,event:e})}onBeforeEditorHide({source:e}){var t,n;const r=this,{row:i,cell:s}=e.cellEditorContext;null==s||s.classList.remove("b-editing"),null==i||i.removeCls("b-editing"),r.detachListeners("cellClickWhileEditing"),null===(t=r.removeEditingListeners)||void 0===t||t.call(r),null===(n=r.removeScrollListener)||void 0===n||n.call(r)}onEditorAfterEdit({source:e}){var t,n;const{editorContext:r}=this;e.cellEditorContext=this.editorContext=null,null==r||null===(t=r.column)||void 0===t||null===(n=t.onCellEditComplete)||void 0===n||n.call(t,r)}getAdjacentEditableCell(e,t){const{grid:n}=this,{store:r,columns:i}=n,{visibleColumns:s}=i;let o=e.id,{record:a}=e,l=i.getAdjacentVisibleLeafColumn(e.columnId,t);for(;o;){if(l){if(this.tabToFocusables){const e=n.normalizeCellContext({record:a,column:l});if(e.target!==e.cell&&!this.getEditingContext(e))return e}return l.canEdit(a)?{id:o,columnId:l.id}:this.getAdjacentEditableCell(n.normalizeCellContext({id:o,columnId:l.id}),t)}var d;a=r.getAdjacent(e.id,t,!1,!0),o=null===(d=a)||void 0===d?void 0:d.id,a&&(l=t?s[0]:s[s.length-1])}return null}async doAddNewAtEnd(){const e="object"==typeof this.addNewAtEnd?W.clone(this.addNewAtEnd):{},{grid:{store:t},addToCurrentParent:n}=this;let r;return r=t.tree&&n?t.last.parent.appendChild(e):t.add(e)[0],await this.client.scrollRowIntoView(r,{animate:!1,block:"nearest"}),r}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:n}=e,{editor:r}=t;if(null!=t&&t.isVisible&&r&&n&&!n.isSpecialRow&&t.canEdit(n)){const i=n?t.getRawValue(n,!0):n;return Object.assign(e,{value:void 0===i?null:i,editor:r}),e}return!1}startEditingFromKeyMap(){const{focusedCell:e}=this.grid,t=null==e?void 0:e.column;return!this.disabled&&!1!==(null==t?void 0:t.get("editor"))&&this.startEditing(e)}async startEditing(e={}){const t=this;if(!t.disabled){var n,r,i,s,o;const{grid:a}=t;if(null!==(n=e)&&void 0!==n&&n.fromKeyMap&&(e=a.focusedCell),W.isEmpty(e)&&(e.id=a.firstVisibleRow.id),a.store.isTree&&a.features.tree){const t=e.id?a.store.getById(e.id):e.record??a.store.getAt(e.row);if(!t)return!1;await a.expandTo(t)}const l=t.getEditingContext(e);if(!l)return!1;if(t.editorContext){if(l.id===t.editorContext.id&&l.columnId===t.editorContext.columnId)return;if(!1===t.cancelEditing())return!1}if(null!==(r=a.focusedCell)&&void 0!==r&&r.equals(l)||a.focusCell(l),!1===a.trigger("beforeCellEditStart",{grid:a,editorContext:l}))return!1;const d=l.editor=t.getEditorForCell(l),{row:c,cell:u,record:h}=l;return d.inputField.highlightExternalChange=!1,d.cellEditorContext=l,d.render(u),u.classList.add("b-editing"),c.addCls("b-editing"),await d.startEdit({target:u,field:d.inputField.name||l.column.editorField,value:l.value,record:h})||(u.classList.remove("b-editing"),c.removeCls("b-editing")),null===(i=(s=l.column).onCellEditStart)||void 0===i||i.call(s,l),null===(o=t.onCellEditStart)||void 0===o||o.call(t),!0}return!1}cancelEditing(e=!1,t){const n=this,{editor:r}=n;if(!n.isEditing)return;e.fromKeyMap&&(t=e,e=!1),n.muteEvents=e;const i=r.cancelEdit(t);var s;(n.muteEvents=!1,!1===i)?r.inputField.focus():(n.finishEditingPromise=!1,null===(s=n.afterCellEdit)||void 0===s||s.call(n));return i}async finishEditing(e){const t=this,{editorContext:n,grid:r}=t;let i=!1;if(t.finishEditingPromise)return t.finishEditingPromise;if(n){const{column:o}=n;if("Enter"===(null==e?void 0:e.key)&&!n.editor.isEditor)return!1;if(t.finishEditingPromise=n.editor.completeEdit(o.bindCallback(o.finalizeCellEdit),e),i=await t.finishEditingPromise,r.isDestroyed)return;var s;if(r.isSchedulerBase&&await r.waitForAnimations(),t.finishEditingPromise=null,i)await(null===(s=t.afterCellEdit)||void 0===s?void 0:s.call(t))}return i}onStoreBeforeSort(){var e;const t=null===(e=this.editorContext)||void 0===e?void 0:e.editor;if(this.isEditing&&(null==t||!t.isFinishing)&&!t.isValid)return this.cancelEditing()}onGridRefreshed(){const e=this,{grid:t,editorContext:n}=e;if(n&&t.isVisible&&t.focusedCell){const{editor:t,cell:r}=n;r&&Yn.isInView(r)&&!t.isFinishing?(n._cell=r,ir.suspendFocusEvents(),t.render(r),t.showBy(r),t.focus(),ir.resumeFocusEvents()):e.finishEditingPromise||e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:e,event:t}){const n=this;if(ny[e]){if(!n.disabled&&!t.target.closest(".b-grid-header"))if(n.isEditing){if("finishAllSelected"===e)return n.multiEdit&&n.gridSelection.length>1;if(ty[e])return!0}else if("startEditing"===e)return Boolean(n.grid.focusedCell&&!Yn.isEditable(t.target));return!1}}async finishAllSelected(){const e=this,{dataField:t,record:n}=e.editor;if(await e.finishEditing()&&!e.isDestroyed){const r=n.getValue(t);for(const i of e.gridSelection)i.isModel?i!==n&&i.setValue(t,r):i.record.set(i.column.editorField,r)}}async finishAndEditNextRow(e,t=!1){const n=this,{grid:r}=n,{record:i,column:s}=n.editorContext;let o;const a=await n.finishEditing(e);if(a){if(n.isDestroyed)return;if(!n.isEditing){if(t){if(o=r.internalNextPrevRow(!1,!0,!1),!o&&r.splitFrom){const e=r.splitFrom;await e.startEditing({id:e.store.last.id,columnId:s.id})}}else{var l;if(i===r.store.last)if(null!==(l=r.features.lockRows)&&void 0!==l&&l.enabled){const e=r.features.lockRows.subViews[0];e.store.count>0&&await e.startEditing({id:e.store.first.id,columnId:s.id})}else n.addNewAtEnd&&await n.doAddNewAtEnd();n.isDestroyed||(o=r.internalNextPrevRow(!0,!0))}o&&n.editNextOnEnterPress&&await n.startEditing(o)}}return a}finishAndEditPrevRow(e){return this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,t=!1){const n=this,{grid:r}=n,{focusedCell:i}=r;if(i&&!n.finishEditingPromise){var s,o,a;const{columnIndex:d,record:c,actionTargets:u}=i;if(n.tabToFocusables&&n.editorContext&&!n.editorContext.editor.inputField&&Yn.getActiveElement(i.cell)!==(t?u[0]:u.at(-1)))return!1;let h=n.getAdjacentEditableCell(i,!t);if(!h&&!t){var l;if(!0===await n.finishEditing(e))if(null!==(l=r.features.lockRows)&&void 0!==l&&l.enabled){const[e]=r.subViews;if(e.store.count>0){const t=e.store.first,r={record:t,id:t.id,columnId:e.columns.visibleColumns[0].id};e.features.cellEdit.getEditingContext(r)?await e.startEditing(r):await e.startEditing(n.getAdjacentEditableCell(r))}}else n.addNewAtEnd&&await n.doAddNewAtEnd()}let g=!0;if(n.isEditing&&(g=await n.finishEditing(e)),n.isDestroyed)return;if(h=n.getAdjacentEditableCell(new Dv({grid:r,record:c,columnIndex:d}),!t),!h&&t&&null!==(s=r.splitFrom)&&void 0!==s&&s.features.lockRows&&c===r.store.first){const e=r.splitFrom,t=e.store.last,i=e.columns.visibleColumns[e.columns.visibleColumns.length-1],s={record:t,id:t.id,columnId:i.id};e.features.cellEdit.getEditingContext(s)?await e.startEditing(s):await e.startEditing(n.getAdjacentEditableCell(s,!1))}if(h){if(g)if(h.target!==h.cell&&n.tabToFocusables){const e=r.findFocusables(h.cell);h.editor=n.editor=n.getFakeEditor(h.target),e[t?e.length-1:0].focus(),n.editorContext=h}else if(r.focusCell(h,{animate:n.focusCellAnimationDuration}),!await n.startEditing(h))return n.finishAndEditNextCell(e,t)}else!r.isNested||!r.owner||null!==(o=(a=r.owner).catchFocus)&&void 0!==o&&o.call(a,{source:r,navigationDirection:t?"up":"down",editing:!0})||r.onTab(e)}}getFakeEditor(e){const t=this,n=()=>(t.editorContext=t.editor=null,!0);return{element:e,completeEdit:n,cancelEdit:n,isFinishing:!0}}finishAndEditPrevCell(e){return this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const t=this,{grid:n}=t,{focusedCell:r}=n;if(e.handled||!t.autoEdit||t.isEditing||!r||r.isActionable&&Yn.isEditable(e.target)||e.ctrlKey)return;const{key:i}=e,s="Delete"===e.key||"Backspace"===e.key,{gridSelection:o}=s?t:{},a=t.multiEdit&&(null==o?void 0:o.length)>1;if((i.length<=1||s&&!a)&&await t.startEditing(r)){const{inputField:n}=t.editor,{input:r}=n;r&&(n.internalOnKeyEvent(e),e.defaultPrevented||(r.value=s?"":i,n.internalOnInput(e))),e.preventDefault()}else if(a&&!1!==n.trigger("beforeCellRangeDelete",{grid:n,gridSelection:o}))for(const e of o)e.isModel?n.columns.visibleColumns.forEach((t=>{t.canEdit(e)&&e.set(t.editorField,null)})):e.column.canEdit(e.record)&&e.record.set(e.column.editorField,null)}onEditorKeydown(e){if(e.key&&1!==e.key.length&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return e.key.startsWith("Arrow")||"Backspace"===e.key||"End"===e.key||e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const t=this,{grid:n,editor:r,editorContext:i}=t,s=new Dv(e.relatedTarget),o=s.grid===n&&t.getEditingContext(s);i&&!r.isFinishing&&r.owns(e._target)&&("cancel"!==t.blurAction&&n.store.includes(i.record)?t.finishEditingPromise||"cellclick"!==t.triggerEvent&&("cellclick"===t.triggerEvent||o)||await t.finishEditing(e):t.cancelEditing(void 0,e))}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this,{target:n}=e;if(!n._shadowRoot&&!t.editor.owns(n)&&(!t.grid.bodyContainer.contains(n)||e.button)){const n=t.resolveCallback(t.validateTapOut,t,!1),r=(null==n?void 0:n.handler.call(n.thisObj,e,t.editorContext))||t.blurAction;t.editingStoppedByTapOutside=!0,"cancel"===r?t.cancelEditing(void 0,e):await t.finishEditing(e),delete t.editingStoppedByTapOutside}}async onElementClick(e){e.target.matches(".b-grid-body-container, .b-grid-subgrid")&&this.editorContext&&await this.finishEditing(e)}}iy._$name="CellEdit",Jv.registerFeature(iy,!0);class sy extends ah{static $name="CellMenu";static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,event:n}=e;this.client.focusCell(t,{doSelect:!this.client.selectedRecordCollection.includes(t.id),event:n}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return W.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow({record:e,items:t,column:n}){if(!1===n.cellMenuItems)return!1;e&&!e.isSpecialRow||(t.removeRow=!1)}populateCellMenu({items:e,column:t,record:n}){const{client:r}=this;null!=t&&t.cellMenuItems&&W.merge(e,t.cellMenuItems),r.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:n.readOnly,onItem:()=>{var e;const i=(null===(e=r.features.treeGroup)||void 0===e?void 0:e.originalStore)??r.store;r.isCellSelected({record:n,column:t},!0)?i.remove(r.selectedRecords.filter((e=>!e.readOnly)).map((e=>e.$original))):i.remove(n)}})}get showMenu(){return!0}showMenuFor(e,{targetElement:t}={}){e=this.client.normalizeCellContext(e),Yn.triggerMouseEvent(t||this.client.getCell(e),this.triggerEvent)}}sy.featureClass="",sy._$name="CellMenu",Jv.registerFeature(sy,!0,["Grid","Scheduler"]),Jv.registerFeature(sy,!1,["Gantt"]);class oy extends Mr{static $name="CellTooltip";static configurable={tooltipRenderer:null};construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=tm.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.client.ion({startCellEdit:e.tip.hide,thisObj:e.tip}),e.relayEvents(e.tip,["beforeShow","show"])}onPointerOver({target:e}){const t=this.client.getColumnFromElement(e);return!1!==t.tooltipRenderer&&Boolean(t.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){var e;null===(e=this.tip)||void 0===e||e.destroy(),super.doDestroy()}doDisable(e){var t;e?this.tip=null===(t=this.tip)||void 0===t?void 0:t.destroy():this.initTip();super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:n}){const r=this,i=r.client.getRecordFromElement(t),s=r.client.getColumnFromElement(t),o={cellElement:t,record:i,column:s,event:n,tip:e,cellTooltip:r};let a;return r.forSelector||i!==r.lastRecord||i.generation!==r.lastRecordGeneration||s!==r.lastColumn?(r.lastRecord=i,r.lastRecordGeneration=i.generation,r.lastColumn=s,s.tooltipRenderer?a=s.tooltipRenderer(o):r.tooltipRenderer&&!1!==s.tooltipRenderer&&(a=r.tooltipRenderer(o)),C.isPromise(a)&&(r.lastRecord=r.lastRecordGeneration=r.lastColumn=null),a||e.hide(),a):r.tip._html}}oy._$name="CellTooltip",Jv.registerFeature(oy);const ay="store";class ly extends(Hi(Mr)){static $name="ColumnAutoWidth";static configurable={default:null,delay:0};static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{store:t}=this;t&&this.bindStore(t)}doDestroy(){this.unbindStore(),super.doDestroy()}get store(){return this.client.$store}bindStore(e){this.lastSync=null,e.ion({name:ay,[`change${this.client.asyncEventSuffix}`]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(ay)}get columnAutoWidthPending(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if("move"!==e&&this.client.isPainted){const t=this,{cellEdit:n}=t.client.features;++t.storeGeneration,"filter"===e||null!=n&&n.isEditing&&!n.editingStoppedByTapOutside?t.syncAutoWidthColumns():t.client.refreshSuspended?t.client.rowManager.once("renderDone",(()=>t.syncAutoWidthColumns())):t.setTimeout({fn:"syncAutoWidthColumns",delay:t.delay,cancelOutstanding:!0})}}onInternalResize(e,t,n,r){0===r&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){var e;const{client:t}=this;this.disabled||0===t.store.count||0===t.rowManager.rows.length||t.splitFrom&&(null===(e=t.splitFrom.features)||void 0===e||null===(e=e.lockRows)||void 0===e||!e.enabled)||this.doSyncAutoWidthColumns()}doSyncAutoWidthColumns(){const e=this,{client:t,storeGeneration:n}=e;if((!t.splitFrom||t.usesLockRows)&&t.isPainted){if(e.lastSync!==n){let r,i;e.lastSync=n;for(const n of t.columns.visibleColumns)r=n.autoWidth,r&&(!0===r&&(r=e.default),t.resizingColumns=i=!0,n.resizeToFitContent(r));i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}}ly.prototype.storeGeneration=0,ly._$name="ColumnAutoWidth",Jv.registerFeature(ly,!0);class dy extends(Hi(Mr)){static $name="ColumnDragToolbar";static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:n}){const r=t.columns.getById(n.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridHeaderDrop:e.onDrop,thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,n=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),n.forEach((e=>{e.text=e.localeClass.L(e.text);let t=r.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},r.push(t)),t.buttons.push(e)})),t.element=Yn.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=n,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await Jt.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const n=this;if(e.dragProxy.getBoundingClientRect().top-n.grid.element.getBoundingClientRect().top>100?n.element.classList.add("b-closer"):n.element.classList.remove("b-closer"),n.hoveringButton&&(n.hoveringButton.classList.remove("b-hover"),n.hoveringButton=null),null!==(t=e.targetElement)&&void 0!==t&&t.closest(".b-columndragtoolbar")){n.element.classList.add("b-hover");const t=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");t&&(t.classList.add("b-hover"),n.hoveringButton=t)}else n.element.classList.remove("b-hover")}onDrop({context:e}){const t=this,{targetElement:n}=e;if(n&&n.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const e=t.buttons.find((e=>e.ref===n.dataset.ref));e&&(n.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),e.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return hh.tpl`
            <div class="b-columndragtoolbar">
            <div class="b-title"></div>
            ${e.map((e=>hh.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map((e=>hh.tpl`
                        <div class="b-target-button" data-ref="${e.ref}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `))}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `))}
            </div>`}}dy.featureClass="b-hascolumndragtoolbar",dy._$name="ColumnDragToolbar",Jv.registerFeature(dy,c.isTouchDevice);class cy extends Mr{static $name="ColumnPicker";static configurable={groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"};static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:n}=t;let r;if(t.groupByRegion)r=t.grid.regions.map((e=>{const n=t.grid.getSubGrid(e).columns.topColumns;return{text:N.capitalize(e),menu:t.buildColumnMenu(n),disabled:0===n.length,region:e}})),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const i={};e.topColumns.forEach((e=>{e.tags&&Array.isArray(e.tags)&&!1!==e.hideable&&e.tags.forEach((e=>{i[e]||(i[e]=1)}))})),r=Object.keys(i).sort().map((e=>({text:N.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:n})=>{t.refreshTagMenu(e,n)}}))),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(e.topColumns),n&&r.items.push(...W.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:n,store:r}=t,{modelClass:i}=r,{allFields:s}=i,o={};for(let r=0,{length:i}=s;r<i;r++){const i=s[r],a=i.name;n.get(a)||i.internal||(o[a]={text:i.text||N.separate(i.name),checked:!1,onToggle:r=>{const s=n.get(a);s?s[r.checked?"show":"hide"]():(t._suspendRenderContentsOnColumnsChanged=!0,n.add(n.generateColumnForField(i,{region:e.forColumn.region}),!0),t._suspendRenderContentsOnColumnsChanged=!1,t.renderContents()),r.bubbles=!1}})}return o}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const n=e.items.find((e=>e.column===t));n&&(n.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:n}=this,r=e.reduce(((e,r)=>{if(!1!==r.hideable){const i=n.columns.visibleColumns.filter((e=>e.region===r.region)),s=!0!==r.hidden,o={grid:n,column:r,text:r.htmlEncodeHeaderText?r.text:Yn.stripTags(r.text),checked:s,disabled:s&&1===i.length,cls:r.region!==t?"b-separator":"",ariaLabel:this.L(s?"L{ColumnPicker.hideName}":"L{ColumnPicker.showName}",r)};t=r.region,r.children&&!r.isCollapsible&&(o.menu=this.buildColumnMenu(r.children)),e.push(o)}return e}),[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:e,items:t}){const n=this,{columns:r}=n.grid;n.forColumn=e,!1!==e.showColumnPicker&&r.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:n,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:n.getColumnPickerItems(r),onToggle:n.onColumnToggle,disabled:n.disabled}),!1===e.hideable||e.parent.isCollapsible||(t.hideColumn={text:"L{hideColumn}",localeClass:n,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!e.allowDrag||n.disabled,onItem:()=>e.hide()})}onColumnToggle({menu:e,item:t,checked:n}){if(Boolean(t.column.hidden)!==!n){var r,i;t.column[n?"show":"hide"](),t.ariaLabel=this.L(`L{HeaderMenu.${n?"hide":"show"}Name}`,t.column);const{grid:s,column:o}=t,{columns:a,features:l}=s,d=e.items,c=a.visibleColumns.filter((e=>e.region===t.column.region&&!1!==e.showColumnPicker)),u=(null===(r=l.headerMenu)||void 0===r?void 0:r.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(1===c.length){const e=d.find((e=>e.column===c[0]));e&&(e.disabled=!0),u&&o.region===t.column.region&&(u.disabled=!0)}else c.forEach((e=>{const t=d.find((t=>t.column===e));t&&(t.disabled=!1)})),u&&o.region===t.column.region&&(u.disabled=!1);null===(i=t.menu)||void 0===i||i.eachWidget((e=>{e.checked=n}));const h=e.owner;h&&h.column===o.parent&&(h.checked=d.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const n=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&n.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:e})=>e.hide()}),t}}cy._$name="ColumnPicker",Jv.registerFeature(cy,!0);class uy extends Mr{static $name="ColumnRename";static configurable={keyMap:{F2:"startEdit"}};doDestroy(){var e;null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:t}){e.rename={weight:215,icon:"b-fw-icon b-icon-edit",text:this.L("L{rename}"),disabled:t.readOnly,onItem:()=>this.startEdit(t)}}startEdit(e){var t;e instanceof Event&&(e=null===(t=this.client.getHeaderDataFromEvent(e))||void 0===t?void 0:t.column);if(!e||e.readOnly||this.disabled)return!1;const{textWrapper:n}=e;let{editor:r}=this;r||(this.editor=r=new sf({owner:this.client,align:{align:"t0-t0"}})),r.render(n),r.startEdit({target:n,record:e,field:"text"})}}uy._$name="ColumnRename",Jv.registerFeature(uy,!1);class hy extends(Hi(Mr)){static $name="ColumnReorder";ignoreSelectors=[".b-grid-header-resize-handle",".b-field"];static get pluginConfig(){return{after:["onInternalPaint","renderContents"]}}static configurable={stretchedDragProxy:null};init(){const e=this,{grid:t}=e,n=t.element,r=Yn.children(n,".b-grid-headers");r.push(...Yn.children(n,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=r:t.whenVisible((()=>e.createDragHelper()))}createDragHelper(){const e=this,{grid:t}=e,n=t.element,r=Yn.children(n,".b-grid-headers");return r.push(...Yn.children(n,".b-grid-header-children")),e.dragHelper=new Zl({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,externalDropTargetSelector:".b-groupbar, .b-columndragtoolbar",monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:Xg.new({direction:"horizontal",element:t.headerContainer}),containers:r,isElementDraggable(n){if(Boolean(n.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;const r=n.closest(this.targetSelector),i=r&&t.columns.getById(r.dataset.columnId),s=0===(null==i?void 0:i.childLevel)&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",resolveTargetElement(e){const n=e.closest("[data-column-id]");return n?t.columns.getById(n.dataset.columnId).element:e},internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onAbort,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"),e.dragHelper}doDestroy(){var e,t;null===(e=this.dragHelper)||void 0===e||e.scrollManager.destroy(),null===(t=this.dragHelper)||void 0===t||t.destroy(),super.doDestroy()}get grid(){return this.client}onBeforeDragStart({source:e,context:t,event:n}){const r=this,{element:i}=t,s=t.column=r.client.columns.getById(i.dataset.columnId);return e.autoSizeClonedTarget=!r.stretchedDragProxy&&!r.usingGroupBarWidget,e.dropTargetSelector=r.stretchedDragProxy?null:".b-grid-headers, .b-groupbar, .b-columndragtoolbar",s.allowDrag&&r.client.trigger("beforeColumnDragStart",{column:s,event:n})}onDragStart({context:e,event:t}){const n=this,{grid:r,usingGroupBarWidget:i,dragHelper:s}=n,{column:o,dragProxy:a,element:l}=e,d=r.element.querySelector(".b-grid-header-container").getBoundingClientRect();a.style.width=o.element.offsetWidth+"px",s.useCenteredCursor=!n.stretchedDragProxy,r.features.columnDragToolbar||i?a.style.height=d.height+"px":(s.minY=d.top,n.stretchedDragProxy?(a.classList.add("b-column-reorder-stretched"),Yn.setTranslateXY(a,l.left,l.top),s.maxY=r.element.getBoundingClientRect().bottom):s.maxY=d.bottom,a.style.height=r.bodyElement.offsetHeight+"px"),r.element.classList.add("b-dragging-header"),i&&a.classList.add("b-grid-reordering-columns-with-groupbar"),r.features.filterBar&&r.features.filterBar.compactMode&&a.classList.add("b-filter-bar-compact"),r.trigger("columnDragStart",{column:o,event:t})}onDrag({context:e,event:t}){const n=this.client,{column:r,insertBefore:i}=e,s=n.columns.getById(null==i?void 0:i.dataset.columnId),o=oc.fromElement(t.target,"gridheader");null!=o&&o.subGrid.sealedColumns&&(e.valid=!1),n.trigger("columnDrag",{column:r,insertBefore:s,event:t,context:e})}onDrop({context:e,event:t}){var n;if(!e.valid)return this.onInvalidDrop({context:e,event:t});const{grid:r}=this,{column:i}=e,s=e.dragging,o=e.target.closest(".b-grid-header"),a=null===(n=e.draggedTo)||void 0===n?void 0:n.dataset.region,l=a||o;let d,c,u,h,g;if(r.element.classList.remove("b-dragging-header"),l){const t=o?r.columns.getById(o.dataset.columnId):r.subGrids[a].columns.last,n=e.insertBefore;if(h=a||t.region,g=i.parent,u=n?r.columns.getById(n.dataset.columnId):r.subGrids[h].columns.last.nextSibling,u)c=u.parent;else{const e=null==o?void 0:o.parentElement.closest(".b-grid-header");c=e?r.columns.getById(e.dataset.columnId):r.columns.rootNode}d=h===i.region&&g===c&&(t===i.previousSibling||u===i.nextSibling),s.remove()}d=d||!1===r.trigger("beforeColumnDropFinalize",{column:i,newParent:c,insertBefore:u,event:t,region:h}),!d&&l&&(d=!c.insertChild(i,u)),e.valid=!d,!d&&l&&(i.parent.isRoot&&i.region!==h&&(i.region=h),0===g.children.length&&g.parent.removeChild(g)),r.trigger("columnDrop",{column:i,newParent:c,insertBefore:u,valid:e.valid,event:t,region:h})}onAbort({context:e,event:t}){this.onInvalidDrop({context:e,event:t})}onInvalidDrop({context:e,event:t}){const{grid:n}=this,{column:r}=e;n.trigger("columnDrop",{column:r,valid:!1,event:t}),n.element.classList.remove("b-dragging-header")}renderContents(){this.init()}onInternalPaint(){this.init()}get isReordering(){var e;return Boolean(null===(e=this.dragHelper)||void 0===e?void 0:e.isDragging)}}hy.featureClass="b-column-reorder",hy._$name="ColumnReorder",Jv.registerFeature(hy,!0);class gy extends Mr{static $name="ColumnResize";static configurable={liveResize:"auto"};construct(e,t){const n=this;super.construct(e,t),n.resizer=new dh({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,constrainToParent:!1,internalListeners:{beforeresizestart:n.onBeforeResizeStart,resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,cancel:n.onCancel,thisObj:n}})}doDestroy(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),super.doDestroy()}changeLiveResize(e){return"auto"===e?!c.isMobileSafari:e}onBeforeResizeStart({event:e,element:t}){const{client:n}=this;return!this.disabled&&n.trigger("beforeColumnResize",{column:n.columns.getById(t.dataset.columnId),domEvent:e})}onResizeStart({context:e}){const{client:t,resizer:n}=this,r=e.column=t.columns.getById(e.element.dataset.columnId),{allRecords:i}=r.subGrid.columns;n.minWidth=r.minWidth,e.subGridBoundary=r.element.getBoundingClientRect()[t.rtl?"left":"right"],t.element.classList.add("b-column-resizing"),i.slice(0,i.indexOf(r)).forEach((e=>{e.flex&&e.element&&e!==r.parent&&e.set({width:e.element.offsetWidth,flex:""})})),t.trigger("columnResizeStart",{column:r,domEvent:e.event})}onResizing({context:e}){if(e.valid&&this.liveResize){const{column:t}=e,{subGrid:n}=t,{scrollable:r,columns:i}=n,{rtl:s}=this.client;this.client.resizingColumns=!0,t.width=e.newWidth,n.refreshFakeScroll(),t===i.last&&(s?e.currentX<e.subGridBoundary:e.currentX>e.subGridBoundary)&&(r.x=r.maxX)}}onResize({context:e}){const{client:t}=this,{column:n,event:r}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(n)):n.width=e.newWidth,t.trigger("columnResize",{column:n,domEvent:r}))}onCancel({context:e}){const{client:t}=this;t.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,t.resizingColumns=!1}}gy._$name="ColumnResize",Jv.registerFeature(gy,!0);class my extends(Mr.mixin(Hi)){static $name="FillHandle";static configurable={calculateFillValue:null,allowCropping:!1};static get pluginConfig(){return{before:["onStoreRemove"],chain:["afterSelectionChange","onContentChange","fixElementHeights","syncFlexedSubCols","beforeSubGridInternalResize"],override:["getCellDataFromEvent"]}}afterConstruct(){super.afterConstruct();const{client:e}=this;e.selectionMode.cell||(this.disabled=!0),e.ion({startCellEdit:"onStartCellEdit",finishCellEdit:"onFinishCellEdit",cancelCellEdit:"onFinishCellEdit",rowExpand:"onContentChange",rowCollapse:"onContentChange",thisObj:this}),this._fillListeners={}}delayable={handleSelection:"raf"};async onContentChange(){this.removeElements(),await this.client.waitForAnimations(),this.handleSelection(!0)}fixElementHeights(){this.handleSelection()}syncFlexedSubCols(){this.handleSelection()}beforeSubGridInternalResize(){this.removeElements()}onStoreRemove(e){e.isCollapse&&this.handleSelection(!0)}onStartCellEdit(){this.removeElements(!1)}onFinishCellEdit(){this.handleSelection()}getCellDataFromEvent(e,t){return t&&(t=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,t)}get currentRangeForEvents(){if(this.currentRange){let{from:e,to:t,negative:n}=this.currentRange;return n&&([e,t]=[t,e]),{from:e,to:t}}}findPatternsIn2dRange(e,t,n){const r={};for(const n of e){const e=t?n.id:n.columnId;let i=n.record.getValue(n.column.editorField);i&&"string"==typeof i&&!isNaN(i)&&(i=parseFloat(i)),r[e]||(r[e]=[]),r[e].push(i)}for(const e in r)r[e].pattern=this.findPatternsIn1dRange(r[e],n);return r}findPatternsIn1dRange(e,t){const n=e[t?0:e.length-1],r={next:()=>n,lastValue:n};if(e.every((e=>"number"==typeof e))||e.every((e=>e instanceof Date))){const n=e.map(((t,n)=>t-e[n-1]));n.shift(),1===new Set(n).size&&(r.increaseBy=n[0]*(t?-1:1),r.next=()=>(r.lastValue instanceof Date?r.lastValue=new Date(r.lastValue.getTime()+r.increaseBy):r.lastValue+=r.increaseBy,r.lastValue))}else e.length>1&&(r.stringPattern=[...e],r.next=()=>(void 0===r.currentIndex?r.currentIndex=0:(r.currentIndex+=1,r.currentIndex>=r.stringPattern.length&&(r.currentIndex=0)),r.stringPattern[r.currentIndex]));return r}afterSelectionChange(){const e=this;e.client.readOnly||e.disabled?e.removeElements():ir.isMouseDown()?(e.client.delayUntilMouseUp((()=>e.handleSelection(!0))),e.removeElements()):e.handleSelection(!0)}handleSelection(e=!1){if(this.enabled&&!this._isExtending){e&&(this._cachedSelectedRange=null);const t=this.rangeSelection;t?this.drawFillHandleAndBorder(t[0],t[t.length-1]):this.removeElements()}}onMouseDown(e){const{client:t}=this;this.enabled&&!t.readOnly&&!1!==t.trigger("beforeFillHandleDragStart",{cell:t.focusedCell,domEvent:e})&&(this._fillListeners.mouseDownOver=Jt.on({element:this.rootElement,keydown:"onKeyDown",mouseenter:{handler:"onMouseOver",delegate:".b-grid-cell",element:t.selectionDragMouseEventListenerElement},capture:!0,thisObj:this}),this._fillListeners.mouseUp=Jt.on({element:document,capture:!0,mouseup:"onMouseUp",thisObj:this}),e.preventDefault(),e.stopImmediatePropagation(),e.handled=!0,t.trigger("fillHandleDragStart",{cell:t.focusedCell,domEvent:e}))}async onMouseUp(e){const t=!1!==await this.client.trigger("fillHandleBeforeDragFinalize",{...this.currentRangeForEvents,domEvent:e});this.finalize(t,e)}finalize(e,t=!0){const n=this,{client:r,currentRange:i,currentRangeForEvents:s,_isCropping:o}=n,a=n.rangeSelection,l=a&&i&&r.internalSelectRange(i.from,i.to),d=(null==l?void 0:l.selectedCells)||[],c=o?n.croppingCells:d.filter((e=>!a.some((t=>t.equals(e,!0)))));if(n._isCropping=null,n._isExtending&&(r.disableScrollingCloseToEdges(r.items),n._isExtending=null),null==c||!c.length||!e)return n.currentRange=null,n.handleSelection(),void r.trigger("fillHandleDragAbort",{cell:r.focusedCell});if(r.suspendRefresh(),o)c.forEach((e=>e.record.set(e.column.field,null,!1,!1,!1,!0)));else{const[e]=c,t=a.some((t=>t.record===e.record)),r=t?e.columnIndex<a[0].columnIndex:e.rowIndex<a[0].rowIndex,i=n.findPatternsIn2dRange(a,t,r),s=new Map;r&&c.reverse();for(const e of c){var u;const{column:r,record:o}=e;let l=null===(u=n.calculateFillValue)||void 0===u?void 0:u.call(n,{range:a,column:r,record:o,cell:e});if(void 0===l){l=i[t?e.id:e.columnId].pattern.next()}if(r.canFillValue({range:a,record:o,cell:e,value:l,enforceType:t})){var h;let e=s.get(o);e||(e={},s.set(o,e)),e[r.field]=(null===(h=r.calculateFillValue)||void 0===h?void 0:h.call(r,{value:l,record:o,range:a,horizontal:t}))||l}}for(const[e,t]of s)e.set(t,null,null,null,null,!0)}r.resumeRefresh(!0),r.performSelection(l),n.currentRange=null,n.handleSelection(),r.trigger("fillHandleDragEnd",{...s,domEvent:t})}onMouseOver(e){var t;const n=this,{client:r,rangeSelection:i}=n,s=i[0],o=i[i.length-1],a=r.getCellDataFromEvent(e,!0);let l=a&&r.normalizeCellContext(a.cellSelector);if((null===(t=l)||void 0===t||null===(t=t._column)||void 0===t?void 0:t.region)===s._column.region){const t=i.some((e=>e.equals(l,!0)));let a;n._isExtending||r.enableScrollingCloseToEdges(r.items),n._isCropping=t&&n.allowCropping&&(l.rowIndex<o.rowIndex||l.columnIndex<o.columnIndex),t||(l.rowIndex>=s.rowIndex&&l.rowIndex<=o.rowIndex?(a=s.columnIndex>l.columnIndex,l=new Dv({grid:r,record:a?s.record:o.record,column:l.column})):(a=s.rowIndex>l.rowIndex,l=new Dv({grid:r,record:l.record,column:a?s.column:o.column})));const d=a?l:s,c=a||t&&!n._isCropping?o:l;n.currentRange={from:d,to:c,negative:a},n._isExtending=!0,n.drawFillHandleAndBorder(d,c,!0),r.trigger("fillHandleDrag",{...n.currentRangeForEvents,domEvent:e})}}drawFillHandleAndBorder(e,t,n=!1){var r,i;const s=this,{client:o,_fillListeners:a}=s,l=o.subGrids[e.column.region].element,d=Ot.from(e.cell||e.column.element,l),c=Ot.from(t.cell||t.column.element,l),u=null===(r=o.getRecordCoords(e.record,!0))||void 0===r?void 0:r.y,h=c.bottom;let{borderElement:g,handleElement:m}=s;if(s.removeElements(n),g||(s.borderElement=g=Yn.createElement({className:"b-fill-selection-border"}),s.handleElement=m=Yn.createElement({className:"b-fill-handle"})),o.rtl){const t=Ot.from(o.subGrids[e.column.region].element).width-d.right,n=c.left>d.left?c.right-d.left:d.right-c.left;Yn.setRect(g,{x:t,y:u,width:n,height:h-u}),Yn.setTopInsetInlineStart(m,h,t+n),m.classList.toggle("b-fill-handle-left-edge",c.left<=0)}else Yn.setRect(g,{y:u,x:d.x,width:c.right-d.x,height:h-u}),Yn.setTopInsetInlineStart(m,h,c.right),m.classList.toggle("b-fill-handle-right-edge",c.right>=l.scrollWidth-1);if(l.appendChild(g),l.appendChild(m),s.toggleCroppingCls(!1),s.croppingCells=null,s._isCropping&&null!==(i=s.rangeSelection)&&void 0!==i&&i.length){const n=o.getRange(e,t);s.croppingCells=s.rangeSelection.filter((e=>!n.some((t=>t.equals(e,!0))))),s.toggleCroppingCls()}a.handleClick||(a.handleClick=Jt.on({element:o.element,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:s})),s.hasFillElements=!0}toggleCroppingCls(e=!0){var t;null===(t=this.croppingCells)||void 0===t||t.forEach((t=>{var n;return null===(n=this.client.getCell(t))||void 0===n?void 0:n.classList.toggle("b-indicate-crop",e)}))}removeElements(e=!1){var t,n;const r=this;null===(t=r.handleElement)||void 0===t||t.remove(),null===(n=r.borderElement)||void 0===n||n.remove(),e||r.removeListeners(),r.hasFillElements=!1}removeListeners(){const e=this;for(const t in e._fillListeners)e._fillListeners[t]();e._fillListeners={}}get rangeSelection(){return this._cachedSelectedRange||(this._cachedSelectedRange=this.currentSelectedRange),this._cachedSelectedRange}get currentSelectedRange(){const{client:e}=this,{store:t}=e;let{selectedCells:n}=e;if(!e._selectedRows.length&&n.length&&n.every((({record:e})=>t.indexOf(e)>=0))){if(!(n.length>1))return n;{n=n.sort(((e,t)=>e.rowIndex-t.rowIndex||e.columnIndex-t.columnIndex));const[e]=n,[t]=n.slice(-1),r=e.rowIndex,i=e.columnIndex,s=e.region,o=t.rowIndex,a=t.columnIndex,l=(a-i+1)*(o-r+1);if(n.length===l&&n.every((e=>e.region===s&&e.rowIndex>=r&&e.rowIndex<=o&&e.columnIndex>=i&&e.columnIndex<=a)))return n}}}onKeyDown(e){"Escape"===e.key&&this.abort()}abort(){this.finalize(!1),this.reset()}reset(){this._isExtending=this._isCropping=this.currentRange=this.croppingCells=null}doDisable(e){this.removeElements(),this.reset(),super.doDisable(e)}}my._$name="FillHandle",Jv.registerFeature(my);class py extends Mf{static $name="GridFieldFilterPicker";static type="gridfieldfilterpicker";static configurable={grid:null,allowedFieldNames:null};afterConstruct(){const e=this;if(!e.grid)throw new Error(`${e.constructor.$name} requires 'grid' to be configured.`);e.fields=e.fields??{},super.afterConstruct()}updateGrid(e){var t;if(null===(t=e.store)||void 0===t||!t.modelClass)throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getColumnFields(e,t,n){return Object.fromEntries((null==e?void 0:e.bottomColumns.reduce(((e,{field:r,text:i,filterType:s,filterable:o,format:a})=>{if(!n||n.includes(r)){const n=r&&t.getFieldDefinition(r),l=(e=>df[null==e?void 0:e.type]||uf(e))(n)?n.type:void 0;(l||s||o)&&e.push([r,{title:i||r,type:s??(uf(n)?"duration":l)??"auto",format:a}])}return e}),[]))??[])}changeFields(e){var t;const n=W.merge({},py.getColumnFields(this.grid.columns,null===(t=this.grid.store)||void 0===t?void 0:t.modelClass),e);return this.allowedFieldNames?Object.fromEntries(this.allowedFieldNames.map((e=>[e,n[e]]))):n}}py.initClass(),py._$name="GridFieldFilterPicker";class fy extends Ff{static $name="GridFieldFilterPickerGroup";static type="gridfieldfilterpickergroup";static configurable={grid:null};static childPickerType="gridfieldfilterpicker";validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:n,fields:r}=this;return{...super.getFilterPickerConfig(e),fields:r,grid:t,allowedFieldNames:n}}get store(){return this.grid.$store}set store(e){}}fy.initClass(),fy._$name="GridFieldFilterPickerGroup";const vy=Symbol("valueCount");class yy extends Dm{static $name="ChecklistFilterCombo";static type="checklistfiltercombo";static configurable={multiSelect:!0,listItemTpl:"up.renderListItem",listItemPillTpl:null,showApplyButton:!1,picker:{type:"panel",flex:1,tbar:{items:{searchField:{type:"textfield",placeholder:"L{ChecklistFilterCombo.search}",clearable:!0,weight:100,internalListeners:{input:"up.onSearchInput",clear:"up.onSearchClear"}}}},items:{list:{type:"list",multiSelect:!0,emptyText:"L{ChecklistFilterCombo.noItems}",weight:100,internalListeners:{selectionChange:"up.onListSelectionChange"}}},bbar:{items:{applyButton:{type:"button",text:"L{ChecklistFilterCombo.apply}",cls:"b-transparent",textAlign:"left",weight:100,visible:!1,internalListeners:{click:"up.onApplyClick"}},selectAllButton:{type:"button",text:"L{ChecklistFilterCombo.selectAll}",cls:"b-transparent",textAlign:"left",weight:200,internalListeners:{click:"up.onSelectAllClick"}},removeAllButton:{type:"button",text:"L{ChecklistFilterCombo.removeAll}",cls:"b-transparent",textAlign:"left",weight:300,internalListeners:{click:"up.onRemoveAllClick"}}}}},chipView:null,store:{data:[]},editable:!1,placeholder:"L{placeholder}",searchText:null,searchFilterId:"search",value:[]};changePicker(e,t){const n=e?W.merge({items:{list:{store:this.store,itemTpl:this.listItemTpl}}},e,{selectedRecordCollection:this.valueCollection,cls:new Vt("b-checklistfiltercombo-picker",e.cls)}):e;return super.changePicker(n,t)}updateReadOnly(e){super.updateReadOnly(...arguments),this._picker&&(this.picker.readOnly=e)}updateStore(e){const t=this;t.detachListeners("storeChange"),e&&e.ion({name:"storeChange",change:t.updateListSelection,thisObj:t}),t.picker&&(t.picker.widgetMap.list.store=e),t.updateListSelection()}onListSelectionChange(){this.showApplyButton||this.applyListSelection(),this.picker.widgetMap.list.refresh(),this.syncInputFieldValue()}applyListSelection(){const{selected:e}=this.picker.widgetMap.list;this.value=e.map((e=>e[this.valueField]))}onSearchInput({value:e}){this.searchText=e}onSearchClear(){this.searchText=null}updateSearchText(e){const t=this;(null==e?void 0:e.trim().length)>0?t.store.filter({id:t.searchFilterId,property:t.displayField,operator:t.filterOperator,value:e,caseSensitive:!1}):t.store.removeFilter(t.searchFilterId),t.picker.widgetMap.searchField.value=e}changeChipView(){return null}onSelectAllClick(){this.searchText=null,this.picker.widgetMap.list.selectAll()}onRemoveAllClick(){this.clear(),this.picker.widgetMap.list.deselectAll()}renderListItem(e){var t;const n=null===(t=this.listItemPillTpl)||void 0===t?void 0:t.call(this,e);return`<div class="b-checklistfiltercombo-item-text">${e.getValue(this.displayField)}</div>${n?`<div class="b-checklistfiltercombo-item-pill">${n}</div>`:""}`}syncInputFieldValue(e=!0){const t=this;if(t.picker){const{values:n}=t.picker.widgetMap.list.selected;t.input.value=n.length>0?t.L("L{filtersSet}",n.length,n):"",e||t.highlightChanged()}}updateListSelection(){var e,t;null===(e=this.picker)||void 0===e||e.widgetMap.list.select((null===(t=this.value)||void 0===t?void 0:t.map((e=>this.store.find((t=>t[this.valueField]===e),!0))))??[],!0)}set value(e){super.value=e,this.updateListSelection()}get value(){return super.value}updateShowApplyButton(e){this.picker.widgetMap.selectAllButton.hidden=e,this.picker.widgetMap.applyButton.hidden=!e}onApplyClick(){this.applyListSelection()}showPicker(){super.showPicker(...arguments),this.picker.widgetMap.searchField.focus()}}yy.initClass(),yy._$name="ChecklistFilterCombo";const by={date:"date",int:"number",integer:"number",number:"number",text:"string",string:"string",duration:"duration",time:"time",auto:"auto"},Cy={...df,relation:!0},wy={filterDateIsToday:!0,filterDateIsThisWeek:!0,filterDateIsThisMonth:!0,filterDateIsThisYear:!0};class Sy extends Mr{static $name="Filter";static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},legacyMode:!1,pickerConfig:null,closeEmptyPopup:!1,value:null,property:null,operator:null,defaultOperators:{date:"sameDay",number:"=",string:"includes",duration:"=",relation:null,auto:"*"},allowedOperators:null,defaultEnabled:!0}}construct(e,t){const n=this;if(n.closeFilterEditor=n.closeFilterEditor.bind(n),n.inferredTypes={},super.construct(e,t),n.bindStore(n.store),t&&"object"==typeof t){const r=W.clone(t);delete r.prioritizeColumns,delete r.legacyMode,delete r.pickerConfig,delete r.dateFormat,delete r.closeEmptyPopup,delete r.defaultOperators,delete r.defaultEnabled,delete r.allowedOperators,W.isEmpty(r)||n.store.filter(r,null,e.isConfiguring)}}doDestroy(){var e,t;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(t=this.filterEditorPopup)||void 0===t||t.destroy(),super.doDestroy()}get store(){return this.client.$store}updateAllowedOperators(e){const t=null==e?void 0:e.indexOf("*");t>=0&&(e[t]="includes")}bindStore(){this.detachListeners("store"),this.store.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this}),this.client.isPainted&&this.refreshHeaders(!1)}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,{client:n,store:r}=t,i=n.headerContainer;i&&(Yn.children(i,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),t.filterTip||(t.filterTip=new tm({forElement:i,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText})),r.isFiltered||t.filterTip.hide(),n.columns.visibleColumns.forEach((e=>{if(t.canFilterColumn(e)){const n=r.filters.allValues.filter((({property:t,disabled:n,internal:r,isNoOp:i})=>t===e.field&&!n&&!r&&!i)),i=n.length>0,s=e.element;if(s){const o=e.textWrapper;let a,l=null==o?void 0:o.querySelector(".b-filter-icon");if(i){const i="&#x2022 ";a=`${t.L("L{filter}")}: `+(n.length>1?"<br/><br/>":"")+n.map((s=>{var o;let a=s.value??"";const l=Array.isArray(a),d=null==r||null===(o=r.modelRelations)||void 0===o?void 0:o.find((({foreignKey:e})=>e===s.property));if(s.displayValue)a=s.displayValue;else{if(!t.legacyMode&&d){var c;const{relatedDisplayField:e}=null===(c=t.pickerConfig)||void 0===c||null===(c=c.fields)||void 0===c?void 0:c[s.property];if(e){const t=t=>{var n;return null===(n=d.foreignStore.getById(t))||void 0===n?void 0:n[e]};a=l?a.map(t).sort(((e,t)=>(e??"").localeCompare(t??""))):t(a)}}else e.formatValue&&a&&(a=l?a.map((t=>e.formatValue(t))):e.formatValue(a));l&&(a=`[ ${a.join(", ")} ]`)}const u=Mf.localizeOperator(s.operator,t.getFilterType(e));return(n.length>1?i:"")+("string"==typeof s?s:`${u} ${a}`)})).join("<br/><br/>")}else a=t.L("L{applyFilter}");l?l.dataset.filterText=a:l=Yn.createElement({parent:o,tag:"i",className:"b-icon b-filter-icon",dataset:{filterText:a}}),e.field===r.latestFilterField&&l.classList.add("b-latest"),s.classList.add("b-filterable"),s.classList.toggle("b-filter",i)}e.meta.isFiltered=i}})),e&&n.refreshRows())}applyFilter(e,t){const{store:n}=this;e.$filter=n.addFilter(this.injectColumnFilterConfig(e,t),!0),n.filter()}injectColumnFilterConfig(e,t){const{filterFn:n}=e.filterable;return W.assign(t,{...e.filterable,...t,property:e.field,[n?"filterBy":"_"]:function(t){return n({value:this.value,record:t,operator:this.operator,property:this.property,column:e})}})}removeFilter(e,t){var n;if(this.legacyMode||null!==(n=e.filterable)&&void 0!==n&&n.filterField)this.store.removeFilter(this.store.filters.getBy("property",e.field));else for(const n of this.getCurrentMultiFilters(e))t&&n.operator!==t||this.store.removeFilter(n)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter((t=>t.property===e.field))}getPopupDateItems(e,t,n,r,i,s,o,a){const l=this,d=s;function c(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?c():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n,displayValue:t._value,type:"date"}))}return[W.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"sameDay"===(null==n?void 0:n.operator)?n.value:r,operator:"sameDay",onKeydown:u,onChange:h,onClose:d,onClear:c},a),W.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onClose:d,onClear:c},a),W.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onClose:d,onClear:c},a)]}getPopupNumberItems(e,t,n,r,i,s,o,a){const l=this,d=s;function c(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?c():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n}))}return[W.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:u,onChange:h,onEsc:d,onClear:c},a),W.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:d,onClear:c},a),W.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onEsc:d,onClear:c},a)]}clearSiblingsFields(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,n,r,i,s,o,a){const l=this,d=s,c=()=>l.removeFilter(e);function u({source:t,value:n}){null==n?c():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n}))}return[W.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onChange:u,onEsc:d,onClear:c},a),W.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onChange:u,onEsc:d,onClear:c},a),W.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onChange:u,onEsc:d,onClear:c},a)]}getPopupStringItems(e,t,n,r,i,s,o,a){const l=this;return[W.assign({type:"text",cls:"b-last-row",placeholder:"L{filter}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:n?n.value??n:r,operator:"*",onChange({source:t,value:n}){""===n?o():(l.applyFilter(e,{operator:t.operator,value:n,displayValue:t.displayField&&t.records?t.records.map((e=>e[t.displayField])).join(", "):void 0}),t.multiSelect||s())},onClose:s,onClear:o},a)]}getPopupItems(e,t,n,r,i,s,o,a){const l=this;if(l.useLegacyModeForColumn(e)||a)switch(t){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}return[l.getFieldFilterPickerGroup(e)]}getAllowedOperators(e){var t;let{allowedOperators:n}=this;return null!=e&&null!==(t=e.filterable)&&void 0!==t&&t.allowedOperators&&(n=n??[],n.push(...e.filterable.allowedOperators)),n}getFieldFilterPickerGroup(e){const t=this,n=t.getFilterType(e),r=t.getAllowedOperators(e),i={fields:{[e.field]:{type:n,title:e.text??e.field}},...t.pickerConfig,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:t.client,propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",internalListeners:{beforeAddFilter:({filter:n})=>{t.injectColumnFilterConfig(e,n)},remove:t.onPopupFilterRemove,keydown:t.onPopupKeydown,thisObj:t},triggerChangeOnInput:!1};return r&&(i.operators={[n]:Mf.defaultOperators[n].filter((({value:e})=>r.includes(e)))}),i}onPopupFilterRemove(){this.closeEmptyPopup&&0===this.filterEditorPopup.widgetMap.pickerGroup.filters.length&&this.delay(this.closeFilterEditor,0)}onPopupKeydown({event:e}){"Enter"===e.key&&this.delay(this.closeFilterEditor,0)}showFilterEditor(e,t,n,r=!1){e=this.client.columns.getById(e);const i=this,{store:s}=i,o=e.element,a=s.filters.getBy("property",e.field),l=i.getFilterType(e),d=i.useLegacyModeForColumn(e),{filterable:c}=e;if(!i.canFilterColumn(e))return;i.closeFilterEditor();const u=i.getPopupItems(e,l,null!=a&&a.internal?null:a,t,s,i.closeFilterEditor,(()=>{i.removeFilter(e),i.closeFilterEditor()}),c.filterField);if(u.forEach((e=>e.placeholder=e.placeholder?this.L(e.placeholder):e.placeholder)),i.filterEditorPopup=new eh({forElement:o,owner:i.client,cls:new Vt("b-filter-popup",{"b-filter-popup-legacymode":d}),scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:u,dataset:{column:e.field,fieldType:l}}),!d){if(r||null==s||!s.filters.find((t=>t.property===e.field))){const r=i.getAllowedOperators(e),s=(i.filterEditorPopup.widgetMap.pickerGroup.operators??Mf.configurable.operators)[l];let o=i.defaultOperators[l];var h;if(!s.find((({value:e})=>e===o)))o=null===(h=s[0])||void 0===h?void 0:h.value;r&&!r.includes(o)&&(o=r[0]),i.filterEditorPopup.widgetMap.pickerGroup.addFilter({type:l,property:e.field,operator:n??o,value:t})}i.filterEditorPopup.items[0].focus()}const[g]=i.filterEditorPopup.items;if(c.filterField&&g.isCombo&&c.getFilterableValues){const t=nt.countUnique(s.allRecords.flatMap(c.getFilterableValues));g.store.data=t.map((({value:t,count:n})=>({id:t,[e.field]:t,[vy]:n}))),g.showPicker()}}closeFilterEditor(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){var t;const n=this,{store:r}=n,i=e.field,s=i&&r.modelClass.getFieldDefinition(i),o=e.filterType??by[e.type]??by[null==s?void 0:s.type];return(null==r||null===(t=r.modelRelations)||void 0===t?void 0:t.find((({foreignKey:e})=>e===i)))?"relation":"auto"===o&&r&&!n.useLegacyModeForColumn(e)?(r.totalCount>0&&(n.inferredTypes[i]=Mf.inferFieldType(r,i)),n.inferredTypes[i]??"auto"):o?by[o]:"auto"}populateCellMenuWithDateItems({column:e,record:t,items:n}){const r=e.field;if("date"===this.getFilterType(e)){const i=this,s=t.getValue(r),o=t=>{i.applyFilter(e,{operator:t,value:s,displayValue:e.formatValue?e.formatValue(s):s,type:"date"})};n.filterDateEquals={text:"L{on}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterDateBefore={text:"L{before}",localeClass:i,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterDateAfter={text:"L{after}",localeClass:i,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:n}){const r=e.field;if("number"===this.getFilterType(e)){const i=this,s=t.getValue(r),o=t=>{i.applyFilter(e,{operator:t,value:s})};n.filterNumberEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterNumberLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterNumberMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:n}){if("duration"===this.getFilterType(e)){const r=this,i=e.getFilterableValue(t),s=t=>{r.applyFilter(e,{operator:t,value:i})};n.filterDurationEquals={text:"L{equals}",localeClass:r,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>s("=")},n.filterDurationLess={text:"L{lessThan}",localeClass:r,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:r.disabled,onItem:()=>s("<")},n.filterDurationMore={text:"L{moreThan}",localeClass:r,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:r.disabled,onItem:()=>s(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:n}){const r=this.getFilterType(e);if(!/(date|number|duration)/.test(r)){var i;const r=this,s=e.getFilterableValue(t),o=(null===(i=e.filterable.filterField)||void 0===i?void 0:i.operator)??"*";n.filterStringEquals={text:"L{equals}",localeClass:r,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>r.applyFilter(e,{value:s,operator:o})}}}getMenuItems(e,t){const n=this,r={},i=n.getFilterType(e);if(!1===e.filterable)return{};if(Cy[i]){const s=t?e.getFilterableValue(t):void 0,o=n.getCurrentMultiFilters(e).filter((e=>!e.disabled)).map((({operator:e})=>e)),a=t?1:void 0,l=n.getAllowedOperators(e),d=Mf.defaultOperators[i].filter((({value:e,argCount:t,isArrayValued:n})=>!(t>a||n)&&(!l||l.includes(e))));let c=300;for(const{value:t,text:a,argCount:l}of d){const d=`filter${N.capitalize(i)}${N.capitalize(t)}`;r[d]={text:N.capitalize(Mf.L(a)),weight:c+=10,icon:o.includes(t)?"b-icon b-icon-check":null,disabled:n.disabled,cls:wy[d]?"b-separator":null,onItem:()=>n.onOperatorMenuItem(e,s,t,l)}}}return e.meta.isFiltered&&Object.assign(r,n.getMenuItemsForFilteredColumn(e,void 0!==t)),{filterMenu:{text:"L{filter}",localeClass:n,menu:r,icon:"b-fw-icon b-icon-filter",weight:t?400:100}}}onOperatorMenuItem(e,t,n,r=1){const i=this,s=i.getFilterType(e),o=i.getCurrentMultiFilters(e).find((e=>!e.disabled&&e.operator===n));o?i.removeFilter(e,n):0==r||void 0!==t?i.applyFilter(e,{property:e.field,operator:n,type:s,value:1===r?t:null,caseSensitive:!1,disabled:null==t&&r>0}):i.showFilterEditor(e,null,n,!0)}getMenuItemsForFilteredColumn(e,t){const n=this,r=!n.disabled&&(n.legacyMode||n.columnHasRemovableFilters(e));return{filterEdit:n.legacyMode?void 0:{text:"L{editFilter}",localeClass:n,icon:"b-fw-icon b-icon-edit",cls:"b-separator",weight:500,disabled:!r,onItem:()=>n.showFilterEditor(e)},filterRemove:{text:"L{removeFilter}",localeClass:n,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:510,disabled:!r,onItem:()=>n.removeFilter(e)},filterDisable:{text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon b-icon-filter-disable",weight:520,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:()=>n.disableFilter(e)}}}populateCellMenu({column:e,record:t,items:n,...r}){const i=this;i.canFilterColumn(e)&&!t.isSpecialRow&&(i.useLegacyModeForColumn(e)?(i.populateCellMenuWithDateItems({column:e,record:t,items:n,...r}),i.populateCellMenuWithNumberItems({column:e,record:t,items:n,...r}),i.populateCellMenuWithDurationItems({column:e,record:t,items:n,...r}),i.populateCellMenuWithStringItems({column:e,record:t,items:n,...r}),e.meta.isFiltered&&Object.assign(n,i.getMenuItemsForFilteredColumn(e,!0))):Object.assign(n,i.getMenuItems(e,t)))}columnHasRemovableFilters(e){const t=this;return Boolean(t.getCurrentMultiFilters(e).find((e=>!t.canDeleteFilter||!1!==t.callback(t.canDeleteFilter,t,[e]))))}columnHasEnabledFilters(e){return Boolean(this.getCurrentMultiFilters(e).find((e=>!e.disabled)))}populateHeaderMenu({column:e,items:t}){const n=this;n.useLegacyModeForColumn(e)?e.meta.isFiltered?(t.filterEdit={text:"L{editFilter}",localeClass:n,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)},t.filterRemove={text:"L{removeFilter}",localeClass:n,weight:110,icon:"b-fw-icon b-icon-remove",disabled:n.disabled||!n.legacyMode&&!n.columnHasRemovableFilters(e),onItem:()=>n.removeFilter(e)},t.filterDisable={text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:()=>n.disableFilter(e)}):n.canFilterColumn(e)&&(t.filter={text:"L{filter}",localeClass:n,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)}):Object.assign(t,n.getMenuItems(e))}useLegacyModeForColumn(e){var t;return this.legacyMode||null!=(null===(t=e.filterable)||void 0===t?void 0:t.filterField)}canFilterColumn(e){var t,n;return!1!==e.filterable&&(!0===(null===(t=e.filterable)||void 0===t?void 0:t.filter)||!1!==(null===(n=e.filterable)||void 0===n?void 0:n.filter)&&!1!==this.defaultEnabled)}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client,n=nt.groupBy(e,"property");for(const[r,i]of Object.entries(n)){const n=t.find((e=>this.canFilterColumn(e)&&e.field===r));n&&(n.$filters=i.map(((t,i)=>{var s;if((t.columnOwned||this.prioritizeColumns)&&!t.internal&&null!=n&&null!==(s=n.filterable)&&void 0!==s&&s.filterFn){const s=new Js({id:t.id??`${r}-${i}-${Date.now()}`,columnOwned:!0,property:r,operator:t.operator,value:t.value,displayValue:t.displayValue,disabled:t.disabled,filterBy(e){return n.filterable.filterFn.call(this,{value:this.value,record:e,operator:this.operator,property:this.property,column:n})}});return e.splice(e.indexOf(t),1,s),s}return t})))}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),Boolean(t)}isActionAvailable({event:e,actionName:t}){if("showFilterEditorByKey"===t){const t=e.target.closest(".b-grid-header"),n=t&&this.client.columns.find((e=>e.id===t.dataset.columnId));return Boolean(null==n?void 0:n.filterable)}}}Sy._$name="Filter",Jv.registerFeature(Sy);const Dy={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null};class Ey extends Mr{static $name="FilterBar";static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,hidden:!1,filter:null,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}},defaultEnabled:!0}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){const n=this;n.onColumnFilterFieldChange=n.onColumnFilterFieldChange.bind(n),super.construct(e,Array.isArray(t)?{filter:t}:t),n.bindStore(n.store),n.filter&&n.store.filter(n.filter),n.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:n})}get store(){return this.client.$store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.client;null==t||t.forEach((t=>{const n=this.getColumnFilterField(t);n&&(n.disabled=e)})),super.doDisable(e)}updateHidden(e){this.isConfiguring||(e?this.hideFilterBar():this.showFilterBar())}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const n=this._columnFilters[t];n.placeholder=e?n.placeholder||n.column.headerText:null}}destroyFilterBar(){var e;null===(e=this.client.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.client.columns)||void 0===e||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t._hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(this.clearStoreFiltersOnHide),this.resumeStoreTracking(),this._hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(e){this.client.hideHeaders||(this.client.columns.visibleColumns.forEach((t=>this.renderColumnFilterField(t,e))),this.rendered=!0)}renderColumnFilterField(e,t){const n=this,{client:r,store:i}=n,s=n.getColumnFilterable(e);if(s&&e.isVisible){const{field:o}=e,a=e.element,l=i.filters.get(e.id)||i.filters.getBy("property",o);let d=n.getColumnFilterField(e);if(d)t&&n.onColumnFilterFieldChange({source:d,value:d.value}),d.render(a),d.show();else{const t=`${e.filterType||"text"}field`,{filterField:c}=s,u=null==c?void 0:c.cls;u&&delete s.filterField.cls;const h=(null==c?void 0:c.ariaLabel)??(e.text?n.L(`L{Filter.filter} ${e.text}`):null);d=oc.append(W.assign({type:t,cls:{[n.filterFieldCls]:1,[u]:u},dataset:{column:o},column:e,owner:r,clearable:!0,revertOnEscape:!0,name:o,value:!l||l._filterBy||l.internal?void 0:n.buildFilterValue(l),inputCls:n.filterFieldInputCls,keyStrokeChangeDelay:n.keyStrokeFilterDelay,disabled:n.disabled,placeholder:n.compactMode?e.headerText:null,format:e.format,ariaLabel:h,internalListeners:{change:n.onColumnFilterFieldChange,clear:n.onColumnFilterFieldChange}},c),a)[0],n.compactMode&&(d.placeholder=(null==c?void 0:c.placeholder)||e.headerText),null!=c&&c.hasOwnProperty("min")||Object.defineProperty(d,"min",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.min},set:()=>null}),null!=c&&c.hasOwnProperty("max")||Object.defineProperty(d,"max",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.max},set:()=>null}),null!=c&&c.hasOwnProperty("strictParsing")||Object.defineProperty(d,"strictParsing",{get:()=>{var t;return null===(t=e.editor)||void 0===t?void 0:t.strictParsing},set:()=>null}),d.element.retainElement=!0,n.setColumnFilterField(e,d);const g=(null==c?void 0:c.store)&&(c.store.readUrl||c.store.data||c.store.isChained)||(null==c?void 0:c.items);if(d.isCombo&&!g&&0===d.store.count){const e=d.value,t=()=>{if(!d.store.readUrl&&!d.store.isChained){let e;if(s.getFilterableValues){e=nt.countUnique(i.flatMap(s.getFilterableValues)).map((({value:e,count:t})=>({id:e,[o]:e,[vy]:t})))}else e=i.getDistinctValues(o,!0,!0).map((({value:e,count:t})=>i.createRecord({id:e,[o]:e,[vy]:t})));d.store.data=e}};d.value=null,d.store.isSorted||d.store.sort({field:o,ascending:!0}),d.picker.ion({beforeShow:t}),t(),d.value=e,d.displayField=c.displayField??o,d.valueField=c.valueField??o}!n.filter&&d.value&&!1!==i.autoLoad&&n.onColumnFilterFieldChange({source:d,value:d.value,silent:!0})}a.classList.add(n.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{store:t}=e,{columns:n}=e.client;let r,i;e._updatingFields=!0;for(const s of n.visibleColumns)r=e.getColumnFilterField(s),r&&!s.$isApplyingFilter&&(i=t.filters.get(s.id)||t.filters.getBy("property",s.field),i&&!i.internal?i._filterBy?r.value=i.value:r.value=e.buildFilterValue(i):r.isCombo&&r.multiSelect?r.value=[]:r.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&this.canFilterColumn(e)&&e.field&&e.isLeaf)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const n=this,{store:r}=n,i=e.element,s=n.getColumnFilterField(e);if(s){n.isDestroying||s.hide();const{$filter:o}=e;!r.isDestroyed&&n.clearStoreFiltersOnHide&&o&&r.removeFilter(o,t),null==i||i.classList.remove(n.filterableColumnCls)}}getColumnFilterField(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,n){var r;if(Array.isArray(t)||t instanceof qs||"number"==typeof t)return{value:t};if(W.isDate(t))return{operator:n.isDateField?"sameDay":n.isTimeField?"sameTime":"=",value:t};const i=String(t).match(this.filterParseRegExp),s="number"==typeof t?"=":"*";return{operator:i[1]||(null===(r=e.filterable)||void 0===r?void 0:r.operator)||s,value:i[2]}}buildFilterValue({operator:e,value:t}){return"number"==typeof t||t instanceof Date||Array.isArray(t)||t instanceof qs?t:(e in Dy?"":e)+t}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var n;const i=e.getAt(r),s=(i.columnOwned||this.prioritizeColumns)&&t.find((e=>this.canFilterColumn(e)&&e.field===i.property));null!=s&&null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new Js({columnOwned:!0,property:i.property,id:s.id,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,property:this.property,column:s})}})),s.$filter.value=i.value,e.splice(r,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:e,changes:t,column:n,columns:r}){const i=this;for(const e of i.client.columns.visibleColumns){var s,o,a;if(i.canFilterColumn(e)&&(!0===(null===(s=e.filterable)||void 0===s?void 0:s.filter)||null!==(o=i.client.features.filter)&&void 0!==o&&o.defaultEnabled&&!1!==(null===(a=e.filterable)||void 0===a?void 0:a.filter)))throw new Error(`Columns do not currently support both \`filter\` and \`filterBar\` features enabled on the same column. Please check column with id ${e.id}.`)}if(!i.hidden&&null!=t&&t.hidden){t.hidden.value?i.destroyColumnFilterField(n):i.renderColumnFilterField(n)}"remove"===e&&r.forEach((e=>i.destroyColumnFilterField(e)))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))null==e||e.element.remove()}disableGridNavigation(e){return e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t,silent:n}){var r;const i=this,{column:s}=e,{filterFn:o}=s.filterable,{store:a}=i,l=s.$filter||a.filters.find((e=>(e.id===s.id||e.property===s.field)&&!e.internal));if(i._updatingFields)return;const d=null==t||""===t||Array.isArray(t)&&0===t.length;var c,u,h,g;if(a.removeFilter(l,!0),s.$filter=null,s.$isApplyingFilter=!0,d){if(!l)return void(s.$isApplyingFilter=!1)}else s.$filter=a.addFilter({property:e.name,...i.parseFilterValue(s,t,e),["boolean"==typeof(null===(c=s.filterable)||void 0===c?void 0:c.caseSensitive)?"caseSensitive":void 0]:null===(u=s.filterable)||void 0===u?void 0:u.caseSensitive,[o?"filterBy":"_"]:function(e){return o({value:this.value,record:e,operator:this.operator,property:this.property,column:s})}},!0);(a.filter({silent:n}),s.$isApplyingFilter=!1,null!==(r=e.picker)&&void 0!==r&&r.isVisible)&&(null===(h=e.picker)||void 0===h||null===(g=h.realign)||void 0===g||g.call(h))}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}canFilterColumn(e){var t,n;return!1!==e.filterable&&(!0===(null===(t=e.filterable)||void 0===t?void 0:t.filterBar)||!1!==(null===(n=e.filterable)||void 0===n?void 0:n.filterBar)&&!1!==this.defaultEnabled)}}Ey.featureClass="b-filter-bar",Ey._$name="FilterBar",Jv.registerFeature(Ey);class xy extends Mr{static $name="Group";static get configurable(){return{field:null,expandIconCls:"b-icon-group-expand",collapseIconCls:"b-icon-group-collapse",ascending:!0,headerHeight:null,showCount:!0,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(e,t){var n;const r=this;e.features.tree||(r._thisIsAUsedExpression(e.features.groupSummary),t=r.processConfig(t),r.grid=e,super.construct(e,t),e.ion({lockRows:"onLockRows",beforeUnlockRows:"onUnlockRows",thisObj:r}),null!==(n=e.features.lockRows)&&void 0!==n&&n.enabled&&!e.splitFrom||r.init(e))}init(e){this.grid=e,this.bindStore(e.store),this.detachListeners("rowManager"),e.rowManager.ion({name:"rowManager",beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:this}),e.isConfiguring||e.renderRows()}processConfig(e){return"string"==typeof e?{field:e}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){const t=this,{client:n}=t;n.isSchedulerBase&&n.isVertical&&e&&(e=n.resourceStore),t.detachListeners("store"),n.isLockedRows||(e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",toggleGroup:"onStoreToggleGroup",thisObj:t}),!t.field&&!e.isGrouped||n.isConfiguring?t.onStoreGroup({groupers:e.groupers}):e.group({field:t.field,ascending:t.ascending,fn:t.groupSortFn}))}updateRenderer(e){this.groupRenderer=e}updateField(e){var t,n;const r=this;null!==(t=r.client.features.lockRows)&&void 0!==t&&t.enabled&&!r.client.splitFrom||r.isConfiguring&&null!==(n=r.store.groupers)&&void 0!==n&&n.some((t=>t.field===e))||r.store.group({field:e,ascending:r.ascending,fn:r.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}updateAscending(e){const t=this;t.isConfiguring||t.store.group({field:t.field,ascending:e,fn:t.groupSortFn})}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),this.currentGroupers=t.groupers,t.clearGroupers(),t.sort(e)}else!e&&this.currentGroupers&&(t.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(e)}get store(){const{grid:e}=this;return e.isSchedulerBase&&e.isVertical?e.resourceStore:e.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}refreshGrid(e){const{store:t,rowManager:n}=this.grid;n.rowCount>t.count||!n.getRowFor(e)?n.renderFromRow():n.renderFromRecord(e)}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,n=!1,r,i=!1){const s=this,{store:o,grid:a}=s;let l=Number.MAX_VALUE;const d=nt.asArray(e).map((e=>{if((e=o.getById(e)).isGroupHeader||(e=o.getGroupHeaderForRecord(e)),l=Math.min(l,o.indexOf(e),0),e.isGroupHeader)return e}));t=void 0===t?!d[0].meta.collapsed:t,!1!==a.trigger("beforeToggleGroup",{groupRecord:d[0],groupRecords:d,collapse:t,domEvent:r})&&(s.isToggling=!0,t?o.collapse(d):o.expand(d),s.isToggling=!1,n||s.refreshGrid(o.getAt(l)),a.trigger("toggleGroup",{groupRecord:d[0],groupRecords:d,collapse:t,allRecords:i}),a.afterToggleGroup())}collapseAll(){const e=this,{store:t,grid:n}=e;t.isGrouped&&!e.disabled&&(e.internalToggleCollapse(t.groupHeaderRecords,!0,!0,void 0,!0),n.trigger("collapseAllGroups"),n.refreshRows(null,!0))}expandAll(){const e=this,{store:t,grid:n}=e;t.isGrouped&&!e.disabled&&(e.internalToggleCollapse(t.groupHeaderRecords,!1,!0,void 0,!0),n.trigger("expandAllGroups"),n.refreshRows())}onLockRows({clone:e}){this.grid=e}onUnlockRows({source:e}){const{client:t}=this;t.isDestroying||this.init(t)}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(null==t?void 0:t.isGroupHeader)}renderCell(e){const t=this,{cellElement:n,row:r,column:i,grid:s}=e,{meta:o}=e.record,a={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in o){if(i.groupHeaderReserved)return;i.clearCell(n),a["b-grid-group-collapsed"]=o.collapsed,a["b-group-row"]=1,s.buildGroupHeader?s.buildGroupHeader(e):t.buildGroupHeader(e),i===t.groupHeaderColumn&&(Yn.createElement({parent:n,tag:"i",className:{"b-group-state-icon":1,"b-fw-icon":1,[t.expandIconCls]:o.collapsed,[t.collapseIconCls]:!o.collapsed},nextSibling:n.firstChild}),n.classList.add("b-group-title"),n.$groupHeader=n._hasHtml=!0)}else if(n.$groupHeader){var l;null===(l=n.querySelector(".b-group-state-icon"))||void 0===l||l.remove(),n.classList.remove("b-group-title"),n.$groupHeader=!1}r.assignCls(a)}buildGroupHeader(e){const t=this,{record:n,cellElement:r,column:i,persist:s,isExporting:o=!1}=e,{grid:a}=t,l=n.meta,d=l.emptyArray?a.L("L{Object.None}"):l.groupRowFor,{groupSummary:c}=a.features,u=l.childCount-(c&&"header"!==c.target?1:0);let h=null,g=!0;if(s||i){var m;const s=a.columns.get(l.groupField),c=e.isFirstColumn=i===t.findGroupHeaderColumn(o);null!=s&&s.groupRenderer?c&&(h=s.groupRenderer({...e,groupRowFor:d,groupRecords:n.groupChildren,groupColumn:s,count:u}),g=!1):t.groupRenderer&&(h=t.groupRenderer({...e,groupRowFor:d,groupRecords:n.groupChildren,groupColumn:s,count:u,isFirstColumn:c})),null!==(m=e.size)&&void 0!==m&&m.height||!t.headerHeight||(e.size.height=t.headerHeight),c&&null==h&&g&&0===Yn.getChildElementCount(r)&&(h=N.encodeHtml(`${"__novalue__"===d?"":d}`+(t.showCount?` (${u})`:"")))}else t.groupRenderer&&(h=t.groupRenderer(e));return"string"==typeof h?r.innerHTML=h:"object"==typeof h&&ud.sync({targetElement:r,domConfig:{onlyChildren:!0,children:nt.asArray(h)}}),Yn.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find((e=>!e.groupHeaderReserved))}findGroupHeaderColumn(e=!1){return this.grid.columns.visibleColumns.find((t=>!(t.groupHeaderReserved||e&&!1===t.exportable)))}renderHeader(e=this.grid.headerContainer){const{store:t,grid:n}=this;if(e&&t.isGrouped)for(const e of t.groupers){var r;const t=n.columns.get(e.field),i=t&&n.getHeaderElement(t.id);if(null==i||i.classList.add("b-group",e.ascending?"b-asc":"b-desc"),i&&(null===(r=n.features.sort)||void 0===r||!r.enabled||!1===t.sortable)){const e=t.textWrapper;null!=e&&e.querySelector(".b-sort-icon")||Yn.createElement({parent:e,className:"b-icon b-sort-icon"})}}}populateHeaderMenu({column:e,items:t}){const n=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:n,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:n.disabled,onItem:()=>n.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:n,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:n.disabled,onItem:()=>n.store.group(e.field,!1)}),n.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:n,icon:"b-fw-icon b-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:n.disabled,onItem:()=>n.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var n;const r=this,{store:i,disabled:s}=r;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!1)});const o=(null===(n=i.groupers)||void 0===n?void 0:n.some((t=>t.field===e.field)))&&!s;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!o,weight:110,onDrop:({column:e})=>i.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:n}=t,r=n&&Yn.children(n,".b-grid-header.b-group");if(n){for(const e of r)e.classList.remove("b-group","b-asc","b-desc");e&&this.renderHeader()}}onStoreChange({action:e,records:t}){const{client:n}=this,{rowManager:r,store:i}=n;if(i.isGrouped&&"move"===e){const{field:e}=i.groupers[0],n=Math.min(...t.reduce(((t,n)=>{if(t.push(i.indexOf(n.instanceMeta(i).groupParent)),e in n.meta.modified){const r=i.groupRecords.find((t=>t.meta.groupRowFor===n.meta.modified[e]));r&&t.push(i.indexOf(r))}return t}),[]));r.renderFromRow(r.getRow(n))}}onStoreToggleGroup({groupRecord:e}){this.isToggling||this.refreshGrid(e)}onElementTouchStart(e){const t=this,{target:n}=e,r=n.closest(".b-grid-header"),i=r&&t.grid.getColumnFromElement(r);e.touches.length>1&&i&&!1!==i.groupable&&!t.disabled&&t.store.group(i.field)}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,i=r.closest(".b-group-row"),s=r.closest(".b-grid-header"),o=null==s?void 0:s.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item")||r.closest(".b-checkbox")||e.handled)){if(s&&o){var a;const r=null===(a=n.groupers)||void 0===a?void 0:a.find((e=>e.field===o));if(r&&!e.shiftKey)return r.ascending=!r.ascending,n.group(),!1;if(e.shiftKey){!1!==t.grid.columns.get(o).groupable&&(e.altKey?n.removeGrouper(o):n.group(o))}}return i&&(t.toggleOnRowClick||e.target.classList.contains("b-group-state-icon"))?(t.internalToggleCollapse(Vl.get(i).id,void 0,void 0,e),!1):void 0}}toggleGroup(){var e;const{grid:t}=this,{focusedCell:n}=t;return!(this.disabled||n.isActionable||null===(e=n.record)||void 0===e||!e.isGroupHeader)&&(this.internalToggleCollapse(n.id),!0)}updateHeaderHeight(){this.isConfiguring||this.client.refreshRows()}updateShowCount(){this.isConfiguring||this.client.refreshRows()}}xy._$name="Group",Jv.registerFeature(xy,!0,["Grid","Scheduler"]),Jv.registerFeature(xy,!1,["TreeGrid"]);var Ry=e=>class extends(e||Qe){static $name="SummaryFormatter";generateHtml(e,t,n){const{store:r}=this.client,i=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let s=`<div class="b-summary-wrap ${n}">`;return i.forEach((n=>{let i=n.sum,o=null;switch(!0===i&&(i="sum"),i){case"sum":case"add":o=r.sum(e.field,t);break;case"max":o=r.max(e.field,t);break;case"min":o=r.min(e.field,t);break;case"average":case"avg":o=r.average(e.field,t);break;case"count":o=t.length;break;case"countNotEmpty":o=t.reduce(((t,n)=>t+(null!=n.getValue(e.field)?1:0)),0)}if("function"==typeof i&&(o=t.reduce(i,"seed"in n?n.seed:0)),null!==o){var a;const r="b-grid-summary-value",i=n.label?`<div class="b-grid-summary-label">${n.label}</div>`:"";let l,d=n.renderer?n.renderer({config:n,sum:o}):(null===(a=e.formatValue)||void 0===a?void 0:a.call(e,o,t[0]))??o;null==d&&(d=""),l=String(d).includes("<div>")?d:i?`${i}<div class="${r}">${d}</div>`:`<div class="${r} b-nolabel">${d}</div>`,s+=l}})),`${s}</div>`}};class Ty extends(Ry(Mr)){static $name="GroupSummary";static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,t){if(super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.client.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return W.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&"footer"===e,this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return W.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:t,row:n,record:r,size:i,isFirstColumn:s}){const o=this,{meta:a}=r,{rowHeight:l}=o.client,d="groupRowFor"in a,c="groupFooterFor"in a,u="header"===o.target,h={"b-group-footer":0,"b-header-summary":0},g=d&&(u||o.collapseToHeader&&a.collapsed)&&!s||c&&!u;if((d||c)&&(i.height=d&&i.height||l),o.store.isGrouped&&g&&!o.disabled){e.clearCell(t);const s=d?r:a.groupRecord;n.isGroupFooter=c,n.isGroupHeader=d,c?h["b-group-footer"]=1:h["b-header-summary"]=1;const g=o.updateSummaryHtml(t,e,s),m="number"==typeof g?g:g.count;m>1&&(i.height+=a.collapsed&&!u?0:m*l*.1),g.height&&(i.height+=g.height)}n.assignCls(h)}updateSummaryHtml(e,t,n){const r=n.groupChildren.slice();r[r.length-1].isGroupFooter&&r.pop();const i=this.generateHtml(t,r,"b-grid-group-summary",n,n.meta.groupField,n.meta.groupRowFor);return e.children.length?Yn.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find((e=>e.field in t)))return;Object.keys(t).some((e=>{const t=this.client.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))&&(this.client.forceFullRefresh=!0)}}refresh(){this.client.columns.visibleColumns.forEach((e=>{e.hasSummary&&this.client.refreshColumn(e)}))}hasSummary(e){return e.sum||e.summaries}updateSummaries(){this.isConfiguring||this.refresh()}}Ty.featureClass="b-group-summary",Ty._$name="GroupSummary",Jv.registerFeature(Ty);const My=Object.freeze({animate:!1,block:"start"}),ky=Object.freeze({animate:!1,block:"end"}),Fy={split:1,unsplit:1};class Iy extends Mr{static $name="Split";static featureClass="";static configurable={subViews:[],relayProperties:{value:{readOnly:1,rowHeight:1},$config:{merge:"merge"}}};static get pluginConfig(){return{chain:["populateCellMenu","afterConfigChange","afterAddListener","afterRemoveListener",{fn:"onInternalPaint",prio:-1e3}],assign:["split","unsplit","subViews","syncSplits"]}}#t=!1;restorers=[];doDestroy(){this.unsplit(!0),super.doDestroy()}doDisable(e){const t=this;t.isConfiguring||(e?(t._disabledSplitOptions=t._splitOptions,t.unsplit()):t._disabledSplitOptions&&(t.split(t._disabledSplitOptions),t._disabledSplitOptions=null))}onInternalPaint(){}get isSplit(){var e;return Boolean(null===(e=this.widgets)||void 0===e?void 0:e.length)}getClientConfig(e,t,n,r={}){const{client:i}=this,{subGrids:s,regions:o}=i,a=i.columns.records.slice(),l=W.assign({},i.subGridConfigs);if(i.eachSubGrid((e=>{const t=l[e.region];e.flex?t.flex=e.flex:t.width=e.element.style.width})),n.atColumn&&o.length>1&&t>0){const e=o.indexOf(n.atColumn.region);for(let t=0;t<e;t++){const e=s[o[t]];nt.remove(a,...e.columns.records),delete l[o[t]]}}const d=W.merge({},i.initialConfig,{appendTo:e,insertFirst:null,insertBefore:null,splitFrom:i,owner:i.owner,tbar:i.initialConfig.tbar&&1===t?{height:i.tbar.height,items:[" "]}:null,store:i.store,selectedRecordCollection:i.selectedRecordCollection,subGridConfigs:l,columns:this.cloneColumns(a),minHeight:0,minWidth:0},r);for(const e of W.keys(this.relayProperties))d[e]=i[e];const c={};for(const e in i.listeners)if(!Fy[e]){const t=i.listeners[e].filter((e=>!e.$internal));t.length&&(c[e]=t)}return d.listeners=c,("horizontal"===n.direction||"both"===n.direction&&1!==t)&&("hideHeaders"in d||(d.hideHeaders=!0),d.features.headerMenu=!1),delete d.data,delete d.adopt,d}cloneColumns(e){return e.flatMap((e=>{if(e.meta.isSelectionColumn||"expanderActionColumn"===e.field)return[];const t={...e.data};return e.children&&(t.children=e.children.map((e=>({...e.data})))),delete t.headerRenderer,delete t.parentId,delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,t}))}cloneClient(e,t,n,r){const i=this.getClientConfig(e,t,n,r),s=new this.client.constructor(i);return s.element.classList.add("b-split-clone"),s}processOptions(e){const{client:t}=this,{atRecord:n,atColumn:r,direction:i}=e;if(i){if("vertical"!==i&&!n&&t.store.count){const n=t._bodyRectangle.height/2+t.scrollable.y,r=t.rowManager.getRowAt(n,!0)??t.rowManager.rows[Math.ceil(t.rowManager.rows.length/2)];e.atRecord=t.store.getById(r.id)}if("horizontal"!==i&&!r){const n=Ot.from(t.element);let r=n.center.x-n.x,i=t.subGrids[t.regions[0]],s=0,o=null;for(;r>i.width;)r-=i.width,i=t.subGrids[t.regions[++s]];r+=i.scrollable.x;const{visibleColumns:a}=i.columns;let l=0,d=0;for(;l<r&&d<a.length;)o=a[d++],l+=o.element.offsetWidth;e.atColumn=o}}else e.direction=n&&r?"both":r?"vertical":"horizontal";return e}createSplitContainer({direction:e}){const{client:t}=this,{element:n}=t;return this.splitContainer=Yn.createElement({parent:n.parentElement,nextSibling:n.nextSibling,className:{"b-split-container":1,[`b-split-${e}`]:1,"b-rtl":t.rtl},style:{width:n.style.width,flex:n.style.flex,height:n.style.height},children:["both"!==e&&n,"both"===e&&{className:"b-split-top",children:[n]},"both"===e&&{className:"b-split-bottom"}]})}syncHeaderHeights(){let e=0;for(const t of this.subViews)t.eachSubGrid((t=>{t.header.height>e&&(e=t.header.height)}));for(const t of this.subViews)t.eachSubGrid((t=>{t.header.height=e}))}toggleOriginalSubGrids(e){const t=this,{client:n}=t,{regions:r}=n;if(e.atColumn&&r.length>1){const i=r.indexOf(e.atColumn.region),s=[n];"both"===e.direction&&s.push(t.subViews[2]);for(const e of s)if(i+1<r.length){const s=e===n,o=e.subGrids[r[i]];o.hideSplitter(),s&&t.restorers.push((()=>o.showSplitter())),o.flex||(n.inForEachOther=!0,o.flex=1,n.inForEachOther=!1,s&&t.restorers.push((()=>{o.flex=null,o.width=o._initialWidth})));for(let n=i+1;n<r.length;n++){const i=e.subGrids[r[n]];i.hide(),s&&t.restorers.push((()=>{i.show()}))}2===r.length&&(e._initialWidth=e.element.style.width,e._initialFlex=e.flex,e.width=o._initialWidth,s&&t.restorers.push((()=>{null!==e._initialFlex?e.flex=e._initialFlex:null!==e._initialWidth&&(e.width=e._initialWidth)})))}}}async split(e={}){const t=this,{client:n}=t;if(n.splitFrom)return;t.isSplit&&await t.unsplit(!0);const{rtl:r}=n,{atRecord:i,atColumn:s,direction:o}=t.processOptions(e);let{splitX:a,remainingWidth:l}=e,d=null,c=null;if(i){await n.scrollRowIntoView(i);const e=n.getRowFor(i);if(!e)throw new Error(`Could not find row for record ${i.id}`);d=Ot.from(e.cells[0],n.element).bottom,c=Ot.from(n.element).height-d}if(s&&!a&&(a=Ot.from(s.element,n.element).getEnd(r),l=Ot.from(n.element).width-a-Yn.scrollBarWidth,r)){const e=a;a=l+Yn.scrollBarWidth,l=e-Yn.scrollBarWidth}const u=[],h=t.createSplitContainer(e),{visibleColumns:g}=n.columns,m=s?g[g.indexOf(s)+1]:null,p=i?n.store.getNext(i):null;if(n.eachSubGrid((e=>e._initialWidth=e.width)),n.columns.commit(),"both"!==o){const r={flex:`0 0 ${(null!=d?c:l)-7}px`,height:null},[,i]=t.widgets=[new Uf({appendTo:h}),t.cloneClient(h,"vertical"===o?1:0,e,r)];null!=a&&(n.renderRows(),e.atDate||(u.push(n.scrollColumnIntoView(s,ky)),m&&u.push(i.scrollColumnIntoView(m,My)))),null!=d&&u.push(i.scrollRowIntoView(p,My)),n.element.classList.add("b-split-start"),i.element.classList.add("b-split-end"),n.scrollable.addPartner(i.scrollable,{x:"horizontal"===o,y:"horizontal"!==o})}else{const r={flex:`0 0 ${l-7}px`};h.lastElementChild.style.flex=`0 0 ${c-7}px`,t.widgets=[new Uf({insertBefore:h.lastElementChild}),t.topSplitter=new Uf({appendTo:h.firstElementChild}),t.cloneClient(h.firstElementChild,1,e,r),t.cloneClient(h.lastElementChild,0,e),t.bottomSplitter=new Uf({appendTo:h.lastElementChild}),t.cloneClient(h.lastElementChild,2,e,r)];const i=n,o=t.widgets[2],g=t.widgets[3],f=t.widgets[5];i.element.classList.add("b-split-top-start"),o.element.classList.add("b-split-top-end"),g.element.classList.add("b-split-bottom-start"),f.element.classList.add("b-split-bottom-end"),null!=a&&(i.renderRows(),g.renderRows(),s&&!e.atDate&&(u.push(n.scrollColumnIntoView(s,ky)),m&&u.push(o.scrollColumnIntoView(m,My)))),null!=d&&u.push(g.scrollRowIntoView(p,My),f.scrollRowIntoView(p,My)),i.scrollable.addPartner(o.scrollable,"y"),i.scrollable.addPartner(g.scrollable,"x"),o.scrollable.addPartner(f.scrollable,"x"),g.scrollable.addPartner(f.scrollable,"y"),t.topSplitter.ion({splitterMouseDown:"onSplitterMouseDown",splitterMouseEnter:"onSplitterMouseEnter",splitterMouseLeave:"onSplitterMouseLeave",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:t}),t.bottomSplitter.ion({splitterMouseDown:"onSplitterMouseDown",splitterMouseEnter:"onSplitterMouseEnter",splitterMouseLeave:"onSplitterMouseLeave",drag:"onSplitterDrag",drop:"onSplitterDrop",thisObj:t})}t.subViews=[n,...t.widgets.filter((e=>e.isGridBase))],t.toggleOriginalSubGrids(e),t.syncHeaderHeights(),t._splitOptions=e,await Promise.all(u);const f=Ot.from(n.element);return n.onInternalResize(n.element,f.width,f.height),n.eachSubGrid((e=>{const t=Ot.from(e.element);e.onInternalResize(e.element,t.width,t.height)})),n.splitDirection=o,n.scrollable.x+=.5,n.scrollable.y+=.5,t.startSyncingColumns(),n.trigger("split",{subViews:t.subViews,options:e}),t.subViews}async unsplit(e=!1){const t=this,{client:n,splitContainer:r}=t,{element:i}=n;var s;if(t.isSplit&&(t.stopSyncingColumns(),delete n.splitDirection,null===(s=t.widgets)||void 0===s||s.forEach((e=>e.destroy())),t.widgets=null,n.eachSubGrid((e=>e.scrollable.x)),n.scrollable.y,r.parentElement.appendChild(i),r.remove(),t.splitContainer=null,i.style.flexBasis=i.style.flexGrow="",i.classList.remove("b-split-top-start","b-split-start"),t.subViews.length=0,!t.isDestroying)){n.renderRows(),t.unsplitCleanup();for(const e of t.restorers)e();if(t.restorers.length=0,await dt.animationFrame(),await dt.animationFrame(),t.isDestroyed)return;!e&&n.trigger("unsplit"),t._splitOptions=null}}unsplitCleanup(){}populateCellMenu({record:e,column:t,items:n}){const r=this,{isSplit:i}=r,{splitFrom:s}=r.client;r.disabled||(n.splitGrid={text:"L{split}",localeClass:r,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:i||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:r,weight:100,onItem(){r.split({atRecord:e})}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:r,weight:200,onItem(){r.split({atColumn:t})}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:r,weight:300,onItem(){r.split({atColumn:t,atRecord:e})}}}},n.unsplitGrid={text:"L{unsplit}",localeClass:r,icon:"b-icon b-icon-clear",hidden:!(i||s),weight:400,separator:!0,onItem(){(s||r).unsplit()}})}startSyncingColumns(){this.detachListeners("columns");for(const e of this.subViews)e.columns.ion({name:"columns",change:"onColumnsChange",thisObj:this})}stopSyncingColumns(){this.detachListeners("columns")}onColumnsChange({source:e,isMove:t,action:n,parent:r,records:i,changes:s}){const o=this;if(!o.#t){o.#t=!0;for(const a of o.subViews){const{columns:l}=a;if(e!==l){if("update"===n&&s.region&&1===Object.keys(s).length&&!o.isLockRows){if(l.getById(i[0].id))l.remove(i[0].id);else{const[e]=i,t=l.getById(o.$before.parent.id)??l.rootNode,n=null!==o.$before.id&&l.getById(o.$before.id);t.insertChild(e.data,n)}o.$before=null}else if(null!=t&&t[i[0].id]||!0===t){if("add"===n){const e=i[0],t=e.nextSibling,n=l.getById(e.id);if(!n){o.$before={id:null==t?void 0:t.id,parent:r},o.#t=!1;continue}if(e.meta.isSelectionColumn){o.#t=!1;continue}const s=l.getById(r.id)??l.rootNode,a=t&&l.getById(t.id);s.insertChild(n,a)}}else if("add"===n){const e=i.filter((e=>a.getSubGridFromColumn(e)));l.add(o.cloneColumns(e))}else l.applyChangesFromStore(e);l.commit()}}e.commit(),o.#t=!1}}getOtherSplitter(e){return e===this.topSplitter?this.bottomSplitter:this.topSplitter}onSplitterMouseDown({source:e,event:t}){t.handled||(t.handled=!0,this.getOtherSplitter(e).onMouseDown(t))}onSplitterMouseEnter({source:e,event:t}){this.getOtherSplitter(e).element.classList.add("b-hover")}onSplitterMouseLeave({source:e,event:t}){this.getOtherSplitter(e).element.classList.remove("b-hover")}onSplitterDrag({source:e,event:t}){t.handled||(t.handled=!0,this.getOtherSplitter(e).onMouseMove(t))}onSplitterDrop({source:e,event:t}){t.handled||(t.handled=!0,this.getOtherSplitter(e).onMouseUp(t))}afterConfigChange({name:e,value:t}){this.isSplit&&this.relayProperties[e]&&this.syncSplits((n=>{n[e]=t}))}afterAddListener(e,t){!this.isSplit||t.$internal||Fy[e]||this.syncSplits((n=>n.on(e,t)))}afterRemoveListener(e,t){t.$internal||this.syncSplits((n=>n.un(e,t)))}forEachOther(e){var t;const n=this.client.splitFrom||this.client,r=N.uncapitalize(this.constructor.$name);if(null!==(t=n.features[r])&&void 0!==t&&t.enabled&&!n.inForEachOther){n.inForEachOther=!0;for(const t of n.subViews)t!==this.client&&e(t);n.inForEachOther=!1}}syncSplits(e){this.forEachOther(e)}}Iy._$name="Split",Jv.registerFeature(Iy,!1);class Ay extends Iy{static $name="LockRows";static configurable={fieldName:"fixed",filterFn:null,bottomGridConfig:null};static get pluginConfig(){const e={};for(const t in super.pluginConfig)e[t]=[...super.pluginConfig[t]];return e.chain.push("selectAll","deselectAll","afterRenderRow","afterPluginConfigChange"),e.override||(e.override=[]),e.override.push("isAllRecordsSelected"),e}construct(){super.construct(...arguments),this.enabled&&(this.refreshSuspended=!0,this.client.suspendRefresh())}onInternalPaint({firstPaint:e}){e&&(this.refreshSuspended&&this.client.resumeRefresh(),this.lockRows())}async lockRows(e={fieldName:this.fieldName,filterFn:this.filterFn}){var t;const n=this,{client:r}=n;if(r.splitFrom||n.disabled||n.$isLocking)return;n.$isLocking=!0,n.isSplit&&await n.unsplit(!0),e=n.processOptions(e);const{store:i,scrollable:s}=r,{fieldName:o}=e,a=`${r.id}-sticky-record-filter`,l=W.copyProperties({},r,["flex","minHeight","maxHeight","autoHeight","hideHorizontalScrollbar"]),d=n.createSplitContainer(e);let{filterFn:c}=e;0===l.maxHeight&&(l.maxHeight=null),l.height=r._lastHeight||null,n.restorers.push((()=>{r.setConfig(l),i.removeFilter(a),r.element.classList.remove("b-locked-rows"),r.store=r.store.$master,r.isLockedRows=r.originalStore=null,r.isLockedRowsView=null})),o&&!i.modelClass.fieldMap[o]&&i.modelClass.addField({name:o,type:"boolean"}),r.setConfig({height:null,flex:"0 0 auto",minHeight:0,maxHeight:e.maxHeight||"50%",autoHeight:!0,hideHorizontalScrollbar:!0,hideFooters:!0,footer:!1,bbar:null}),r.element.classList.add("b-locked-rows");const u=o?[o]:"*";c=c||(e=>e[o]);const[h]=n.widgets=[n.cloneClient(d,0,e,W.merge({flex:"1 1 0%",hideHeaders:!0,header:!1,usesLockRows:!0},n.bottomGridConfig))];h.element.classList.add("b-locked-rows-clone"),n.subViews=[h,r],r.originalStore=i,r.isLockedRows=!0,r.isLockedRowsView=h.isLockedRowsView=!0,r.store=i.chain((e=>c(e)),u,{chainFilters:!0}),h.store=i.chain((e=>!c(e)),u,{chainFilters:!0}),Yn.scrollBarWidth&&s.hasOverflowY&&(s.overflowY="scroll"),!r.scrollable.isPartneredWith(h.scrollable)&&r.scrollable.addPartner(h.scrollable,{x:!0}),h.columns.leaves.forEach((e=>{e.isRowNumberColumn&&h.refreshColumn(e)})),n._splitOptions=e;const g=Ot.from(r.element);return r.onInternalResize(r.element,g.width,g.height),r.eachSubGrid((e=>{const t=Ot.from(e.element);e.onInternalResize(e.element,t.width,t.height)})),null!==(t=r.features.columnAutoWidth)&&void 0!==t&&t.enabled&&r.features.columnAutoWidth.syncAutoWidthColumns(),r.scrollable.x+=.5,r.scrollable.y+=.5,n.startSyncingColumns(),n.$isLocking=!1,r.trigger("lockRows",{clone:h}),n.subViews}processOptions(e){const{fieldName:t}=e;if(e.direction="horizontal",!e.filterFn&&!t)throw new Error("LockRows needs `fieldName` or `filterFn`");return"string"==typeof e.filterFn&&(e.filterFn=this.resolveCallback(e.filterFn)),e}get numberOfLockedRows(){return this.isSplit?this.subViews[1].store.count:0}afterPluginConfigChange({plugin:e,applied:t,origPassedValue:n,name:r}){var i;const s=this;if(s.enabled&&null!==(i=s.subViews)&&void 0!==i&&i[0]&&e!==s&&t){const t=N.uncapitalize(e.$$name),i=s.subViews[0].features[t];null!=i&&i.enabled&&(typeof n in{string:1,boolean:1,number:1}||n instanceof Date)&&(i[r]=n)}}isAllRecordsSelected(){const e=this.isSplit&&this.subViews[0];return this.overridden.isAllRecordsSelected()&&(!e||e.isAllRecordsSelected())}selectAll(e){this.isSplit&&this.subViews[0].selectAll(e)}deselectAll(e,t){this.isSplit&&this.subViews[0].deselectAll(e,t)}afterRenderRow({row:e,recordIndex:t}){this.isSplit&&e.toggleCls("b-last",t===this.client.store.count-1)}populateCellMenu({record:e,items:t}){var n,r;const i=this,s=(null===(n=i.client.splitFrom)||void 0===n?void 0:n.features.lockRows)||i,o=null===(r=s._splitOptions)||void 0===r?void 0:r.fieldName;i.disabled||!o||s.filterFn||i.client.readOnly||e.isSpecialRow||(t.toggleLocked={text:e[o]?"L{unlockRow}":"L{lockRow}",localeClass:i,icon:"b-icon "+(e[o]?"b-icon-unlock-row":"b-icon-lock-row"),weight:500,separator:!0,closeParent:!0,onItem:()=>{e[o]=!e[o]}})}async unsplit(e=!1){const t=this,n=t.subViews[0];t.client.trigger("beforeUnlockRows",{clone:n}),await super.unsplit(e),!t.isDestroyed&&t.client.trigger("unlockRows",{clone:n})}doDisable(e){this.isConfiguring||(e?this.unsplit():this.lockRows())}}Ay._$name="LockRows",Jv.registerFeature(Ay,!1);class Ly extends ah{static $name="HeaderMenu";static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return W.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const n=this;if(t){if(t.headerMenuItems&&W.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:r}=t,i=r?n.client.rtl?"left":"right":n.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${i}`,text:n.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!r}}if(n.moveColumns){const r=n.getColumnToMoveBefore(t),i=n.getColumnToMoveAfter(t);r&&(e.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:n.L("L{moveBefore}",N.encodeHtml(r.text)),onItem:()=>{const{parent:e}=t;var n;r.parent.insertChild(t,r)&&(t.region=r.region,null!==(n=e.children)&&void 0!==n&&n.length||e.remove())}}),i&&(e.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:n.L("L{moveAfter}",N.encodeHtml(i.text)),onItem:()=>{const{parent:e}=t;var n;i.parent.insertChild(t,i.nextSibling)&&(t.region=i.region,null!==(n=e.children)&&void 0!==n&&n.length||e.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:n}=e;return t?t.children&&!e.children?t.children[t.children.length-1]:t:n.isRoot?void 0:n}getColumnToMoveAfter(e){const{nextSibling:t,parent:n}=e;return t||(n.isRoot?void 0:n)}}Ly.featureClass="",Ly._$name="HeaderMenu",Jv.registerFeature(Ly,!0);const Py={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"};class Oy extends Mr{static $name="MergeCells";static configurable={passthrough:!0,sortedOnly:!0,shouldMerge:null};mergedRanges=[];mergedMap={};static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize","refresh"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:t}=e;t.eachSubGrid((t=>e.setupSubGrid(t))),t.rowManager.ion({renderDone:"onRenderDone",offsetRows:"onOffsetRowsUpdated",thisObj:e}),e.bindStore(t.store)}setupSubGrid(e){e.$mergedCellsElement=Yn.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}}),e.ion({beforeInternalResize:"refreshBounds",thisObj:this})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}updateSortedOnly(e){this.isConfiguring||this.reset(!0,e)}updateShouldMerge(e){this.isConfiguring||this.reset(!0,e)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}refresh(){this.reset(!1)}beforeRenderCell(e){const t=this,{column:n,record:r,cellElement:i}=e,s=t.client.subGrids[n.region];if(!t.disabled&&n.mergeCells&&(n.isSorted||!t.sortedOnly)&&!r.isSpecialRow&&!s.collapsed){const s=t.getMergeRange(r,n);null!=s&&s.use&&(i.classList.add("b-merged-cell"),i.innerHTML="",e.cellElement=s.cellElement)}}afterRenderRow({row:e,oldId:t,oldHeight:n}){t===e.id&&n!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:t,column:n}){if(!this.disabled)if("update"!==e||!t.mergeCells||n.mergeCells)this.refreshBounds();else{for(const e of this.mergedRanges.slice())e.column===n&&this.removeRange(e);this.syncDom()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:e}=this,t=e.selectedRecords.map((t=>e.store.indexOf(t)));let n=!1;for(const e of this.mergedRanges){let r=!0;for(let n=e.fromIndex;n<=e.toIndex&&r;n++)r=t.includes(n);e.isSelected!==r&&(e.isSelected=r,n=!0)}n&&this.syncDom()}}getRecordFromElement(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var t;return null!==(t=e.elementData)&&void 0!==t&&t.range?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:t}){!1!==e.mergeable&&(t.mergeCells={text:"L{MergeCells.mergeCells}",icon:"b-fw-icon "+(e.mergeCells?"b-icon-checked":"b-icon-unchecked"),tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){if(!this.passthrough){const t=e.target.closest(".b-grid-merged-cells");if(t){const{client:n}=this,{range:r}=t.elementData,{cellEdit:i}=n.features,{column:s}=r,o=N.capitalize(Py[e.type]??e.type),a={grid:n,records:[],column:s,cellElement:t.firstElementChild,target:e.target,event:e};for(let e=r.fromIndex;e<=r.toIndex;e++)a.records.push(n.store.getAt(e));if(n.trigger(`mergedCell${o}`,a),(null==i?void 0:i.triggerEvent.toLowerCase())===`cell${o}`.toLowerCase()){const t=n.rowManager.getRowAt(e.clientY);await i.startEditing({id:t.id,columnId:s.id})}else"click"===e.type&&this.onRangeClick({range:r})}}}onRangeClick({range:e}){const t=[];for(let n=e.fromIndex;n<=e.toIndex;n++)t.push(this.client.store.getAt(n));this.client.selectedRecords=t}onStoreChange({action:e,removed:t,added:n}){!this.disabled&&this.reset()}onStoreRefresh({source:e,action:t}){"filter"===t||"dataset"===t||this.disabled||this.reset(Boolean(e.isResourceStore))}createRangeElement(e){var t,n;const r=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,i=`${e.fromIndex}-@-${e.column.id}`;let s=(null===(t=r.syncIdMap)||void 0===t?void 0:t[i])??(null===(n=r.releasedIdMap)||void 0===n?void 0:n[i]);return r.releasedIdMap&&delete r.releasedIdMap[i],s||(s=Yn.createElement(this.createRangeDomConfig(e))),ud.addChild(r,s,i),e.element=s,e.cellElement=s.firstElementChild,s}createRangeDomConfig(e){var t;const{column:n,fromIndex:r,toIndex:i,top:s,left:o,right:a,width:l,height:d}=e,{type:c}=n,u=this.client.store.getAt(r),h={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:o,right:a,height:d,width:l},dataset:{syncId:`${r}-@-${n.id}`,fromIndex:r,toIndex:i,column:n.field,columnId:n.id},children:[{className:new Vt(this.client.cellCls).assign({[`b-${null==c?void 0:c.toLowerCase()}-cell`]:c,[n.cellCls]:n.cellCls,[n.internalCellCls]:n.internalCellCls}).assign(n.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:n.field,columnId:n.id},style:{height:this.client.rowManager.rowHeight}}]};return null===(t=n.mergedRenderer)||void 0===t||t.call(n,{domConfig:h,value:n.getRawValue(u),record:u,column:n,fromIndex:r,toIndex:i}),h}buildMergedCellsConfig(e,t,n){var r,i;const s=this,{client:o}=s,{rowManager:a}=o;e=e??(null===(r=a.topRow)||void 0===r?void 0:r.dataIndex),t=t??(null===(i=a.bottomRow)||void 0===i?void 0:i.dataIndex);const l=o.regions.reduce(((e,t)=>(e[t]={className:{"b-grid-merged-cells-container":1},children:[]},e)),{});for(const r of s.mergedRanges)r.use&&r.fromIndex<=t&&r.toIndex>=e&&(s.updateRange(r,s.heightChanged,n),l[r.column.region].children.push(s.createRangeDomConfig(r)));return l}syncDom(e=!1){const t=this,{client:n}=t,{rowManager:r}=n;if(!e&&!r.topRow||t.disabled&&!t.isDisabling)return;const i=this.buildMergedCellsConfig();n.eachSubGrid((e=>{ud.sync({targetElement:e.$mergedCellsElement,syncIdField:"syncId",domConfig:i[e.region]})})),t.heightChanged=!1}onRenderDone(){this.syncDom()}onOffsetRowsUpdated(){this.reset(!0)}removeRange(e){nt.remove(this.mergedRanges,e);for(let t=e.fromIndex;t<=e.toIndex;t++)delete this.mergedMap[`${t}-@-${e.column.id}`]}reset(e=!0,t=!1){const n=this,r=n.client.columns.visibleColumns.filter((e=>e.mergeCells&&(e.isSorted||!n.sortedOnly||t)),!0),i=n.mergedRanges.length;if(n.mergedRanges=[],n.mergedMap={},e&&!n.client.refreshSuspended){for(const e of n.client.rowManager.rows)for(const t of r)e.renderCell(e.getCell(t.id));n.syncDom(i&&!n.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,t=this.client.rowManager.topRow,n=new Map,r=this.client.rtl;for(const i of e.slice()){const{column:e}=i,s=t.getCell(e.id);if(s){let{rowWidth:t,bounds:o}=n.get(e)??{};o||(t=s.parentElement.offsetWidth,o=Ot.from(s,s.parentElement),n.set(e,{rowWidth:t,bounds:o})),r?i.right=t-o.right:i.left=o.left,i.width=o.width}else this.removeRange(i)}this.syncDom()}updateRange(e,t,n=null){const{store:r,rowManager:i}=this.client,{topRendered:s,bottomRendered:o}=e,{rowOffsetHeight:a}=i;let l,d,{fromIndex:c,toIndex:u}=e;if((t=n?n.length>0:t)||!s||!o){if(!s||t){if(n){const e=n.findIndex((e=>e.dataIndex>=c));l=n[e],c=l.dataIndex}else do{l=i.getRowById(r.getAt(c))}while(!l&&c++<u);e.topRendered=c===e.fromIndex;const t=c-e.fromIndex;e.top=l.top-t*(n?l.offsetHeight:a)}if(!o||t){if(n){const e=n.findIndex((e=>e.dataIndex===u));d=n[-1===e?n.length-1:e],c=d.dataIndex}else do{d=i.getRowById(r.getAt(u))}while(!d&&u-- >c);e.bottomRendered=u===e.toIndex;const t=e.toIndex-u;e.bottom=d.bottom+t*(n?d.offsetHeight:a)}e.height=e.bottom-e.top}}getMergeRange(e,t){var n;if(e.isSpecialRow)return;const r=this,{mergedMap:i}=r,{store:s}=r.client,o=r.client.rowManager.topRow,a=t.id,l=s.indexOf(e),d=`${l}-@-${a}`,c=this.client.rtl,u=t.getRawValue(e);let h=i[d];if(!h){h=i[d]={column:t},r.mergedRanges.push(h);let e,n,g=l-1;do{e=s.getAt(g),n=e&&t.getRawValue(e),i[`${g}-@-${a}`]&&(e=null),g--}while(e&&!e.isSpecialRow&&n===u);let m,p,f=l+1;do{m=s.getAt(f),p=m&&t.getRawValue(m),i[`${f}-@-${a}`]&&(m=null),f++}while(m&&!m.isSpecialRow&&p===u);if(h.fromIndex=g+2,h.toIndex=f-2,r.shouldMerge&&h.toIndex-h.fromIndex>0)for(let e=h.fromIndex+1;e<=h.toIndex;e++){const n=s.getAt(e),i=s.getAt(e-1);if(!1===r.shouldMerge({column:t,record:n,previousRecord:i,value:u})){h.toIndex=e-1;break}}if(h.toIndex-h.fromIndex>0){for(let e=h.fromIndex;e<=h.toIndex;e++)i[`${e}-@-${a}`]=h;const e=o.getCell(a),t=e.parentElement.offsetWidth,n=Ot.from(e,e.parentElement);c?h.right=t-n.right:h.left=n.left,h.width=n.width,h.use=!0}}return null!==(n=h)&&void 0!==n&&n.use&&!h.element&&r.createRangeElement(h),h}}Oy._$name="MergeCells",Jv.registerFeature(Oy);const $y={goToNextHit:1,goToPrevHit:1,showFilterEditor:1,clearSearch:1};class _y extends Mr{static $name="QuickFind";static configurable={mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}};static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,Yn.NodeFilter.SHOW_TEXT,(()=>Yn.NodeFilter.FILTER_ACCEPT))})}isActionAvailable({actionName:e}){if($y[e]){const{focusedCell:e}=this.grid;return!this.disabled&&(null==e?void 0:e.record)&&!e.isActionable&&this.find.length>0}}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,{grid:t}=e,n=t.getHeaderElement(e.columnId);if(n){if(!e.headerField){const[r,i,s]=Yn.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});"header"===e.mode?n.appendChild(r):(r.className+=" b-quick-hit-mode-grid",t.element.appendChild(r)),e.headerField={header:r,field:i,badge:s,colHeader:n}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,n.classList.add("b-quick-find-header")}!n&&!t.hideHeaders||e.renderListenerInitialized||(t.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}hideQuickFind(){const e=this,{grid:t,headerField:n}=e;for(const n of e.prevFound||e.found){const r=t.getRowById(n.id);if(r){r.forceInnerHTML=!0;const t=r.getCell(e.columnId);t._content=null,r.renderCell(t),r.forceInnerHTML=!1}}var r;n&&(null===(r=n.header.parentNode)||void 0===r||r.removeChild(n.header),n.colHeader.classList.remove("b-quick-find-header"),e.headerField=null);e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId,n=!1){var r;const i=this,{grid:s}=i,o=s.columns.getById(t)||s.columns.get(t),a=i.store.findByField(o.field,e,o.mergeCells&&o.isSorted);let l=1;Object.assign(i,{foundMap:{},prevFound:i.found,found:a,find:e,columnId:o.id,findRe:new RegExp(`(\\s+)?(${N.escapeRegExp(String(e))})(\\s+)?`,"ig")}),e?i.showQuickFind():i.hideQuickFind();for(const e of Yn.children(s.element,`.${i.hitCls}`))e.classList.remove(i.hitCls,i.hitCellCls),e._originalContent&&(e.innerHTML=e._originalContent,e._originalContent=null);if(a){a.length>0&&!n&&i.gotoClosestHit(s.focusedCell,a);for(const e of a){i.foundMap[e.id]=l++;const t=s.getRowById(e.data.id);if(null==t||t.renderCell(t.getCell(o.id)),l>1e3)break}null===(r=s.syncSplits)||void 0===r||r.call(s,(n=>n.features.quickFind.search(e,t,!0))),s.trigger("quickFind",{find:e,found:a})}}clear(){var e;(this.find||null!==(e=this.found)&&void 0!==e&&e.length)&&this.search("")}get foundCount(){var e;return(null===(e=this.found)||void 0===e?void 0:e.length)??0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id},{doSelect:!0}),Boolean(t)}gotoClosestHit(e,t){const n=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort(((e,t)=>Math.abs(e.index-n)-Math.abs(t.index-n)));this.gotoHit(t.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,t,n;const r=this;if(null===(e=r.found)||void 0===e||!e.length)return;const{grid:i}=r,s=(null===(t=i._focusedCell)||void 0===t?void 0:t.id)??(null===(n=i.lastFocusedCell)||void 0===n?void 0:n.id),o=i.store.indexOf(s)||0,a=r.found.find((e=>e.index>o));a?i.focusCell({columnId:r.columnId,id:a.id},{doSelect:!0}):r.gotoFirstHit()}gotoPrevHit(){var e,t,n;const r=this;if(null===(e=r.found)||void 0===e||!e.length)return;const{grid:i,found:s}=r,o=(null===(t=i._focusedCell)||void 0===t?void 0:t.id)??(null===(n=i.lastFocusedCell)||void 0===n?void 0:n.id),a=i.store.indexOf(o)||0;let l;if(s.length){for(let e=s.length-1;e--;e>=0)if(s[e].index<a){l=s[e];break}l?i.focusCell({columnId:r.columnId,id:l.id},{doSelect:!0}):r.gotoLastHit()}}renderCell({cellElement:e,column:t,record:n}){var r;const i=this,{classList:s}=e,{treeWalker:o,findRe:a,hitTextCls:l}=i,d=i.columnId===t.id&&(null===(r=i.foundMap)||void 0===r?void 0:r[n.id]);if(d){s.add(i.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const t=o.currentNode=Yn.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let e=o.nextNode();e&&t.contains(e);){const t=e,n=e.nodeValue,r=["<span>"];e=o.nextNode();let i=a.lastIndex;for(let e=a.exec(n);e;e=a.exec(n)){const t=n.substring(i,e.index),s=e[1]?" ":"",o=e[2],d=e[3]?" ":"";r.push(`${N.encodeHtml(t)}${s}<span class="${l}">${o}</span>${d}`),i=a.lastIndex}r.push(N.encodeHtml(n.substring(i)),"</span>"),t.parentNode.insertBefore(Yn.createElementFromTemplate(r.join(""),{fragment:!0}),t),t.remove()}Yn.createElement({parent:e,className:i.hitCellBadgeCls,text:d})}}onBackspace(e){const t=this;return!!t.find&&(t.find=t.find.substr(0,t.find.length-1),t.search(t.find),!0)}clearSearch(){return!!this.find&&(this.find="",this.search(this.find),!0)}showFilterEditor(){const e=this,{filter:t}=e.client.features;t&&e.columnId&&e.foundCount&&(e.clear(),t.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var t;const n=this,{grid:r}=n,{focusedCell:i}=r;if(!e.handled&&!n.disabled&&null!=i&&i.record&&!i.isActionable&&1===(null===(t=e.key)||void 0===t?void 0:t.length)){const t=r.columns.getById(r._focusedCell.columnId);t&&!1!==t.searchable&&(n.columnId=r._focusedCell.columnId,n.find+=e.key,n.search(n.find))}}onCellNavigate(e,t,n){const r=this;!r.find||n&&n.columnId===r.columnId||r.clear()}}_y._$name="QuickFind",Jv.registerFeature(_y);class Hy extends Mr{static $name="RegionResize";static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}static configurable={showSplitterButtons:!0,animateCollapseExpand:!0,enableDragging:!0};updateShowSplitterButtons(e){this.client.element.classList.toggle("b-hide-splitter-buttons",!e)}onElementDblClick(e){const t=this,{client:n}=t,r=e.target.closest(".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let e=r.dataset.region,i=n.getSubGrid(e);i.collapsed||(e=n.getLastRegions()[1],i=n.getSubGrid(e)),i.expand().then((()=>t.expanding=!1))}}startMove(e,t){const n=this,{clientX:r}=t,{client:i}=n,s=e.dataset.region,o=i.element,a=i.regions[i.regions.indexOf(s)+1],l=i.getSubGrid(a),d=i.getSubGrid(s);if(e.classList.contains("b-grid-splitter-collapsed"))return;let c=d,u=1;null!=c.flex&&null==l.flex&&(c=l,u=-1),i.rtl&&(u*=-1);const h=Object.values(i.subGrids).reduce(((e,t)=>t.width+e),0);i.trigger("splitterDragStart",{subGrid:c,domEvent:t}),n.dragContext={element:e,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:d,originalWidth:c.element.offsetWidth,originalX:r,minWidth:c.minWidth||0,maxWidth:Math.min(h,c.maxWidth||h),flip:u},o.classList.add("b-moving-splitter"),d.toggleSplitterCls("b-moving"),n.pointerDetacher=Jt.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:n})}endMove(e){const t=this,{dragContext:n,client:r}=t;if(n){const{subGrid:i}=n;e.preventDefault(),t.pointerDetacher(),r.element.classList.remove("b-moving-splitter"),n.splitterSubGrid.toggleSplitterCls("b-moving",!1),t.dragContext=null,r.trigger("splitterDragEnd",{subGrid:i,domEvent:e})}}onCollapseClick(e,t,n){const r=this,{client:i}=r,s=t.dataset.region,o=i.getLastRegions();if(!1!==i.trigger("splitterCollapseClick",{subGrid:e,domEvent:n})){if(o[0]===s){const e=i.getSubGrid(o[1]);if(e.collapsed)return void e.expand(r.animateCollapseExpand)}e.collapse(r.animateCollapseExpand)}}onExpandClick(e,t,n){const r=this,{client:i}=r,s=t.dataset.region,o=i.getLastRegions();if(!1!==i.trigger("splitterExpandClick",{subGrid:e,domEvent:n}))if(o[0]!==s||e.collapsed)e.expand(r.animateCollapseExpand);else{i.getSubGrid(o[1]).collapse(r.animateCollapseExpand)}}updateMove(e){const{dragContext:t}=this;if(t){const n=e-t.originalX,r=Math.max(Math.min(t.maxWidth,t.originalWidth+n*t.flip),0);t.subGrid.width=Math.max(r,t.minWidth)}}onElementPointerDown(e){var t;const n=this,{target:r}=e,i=0===e.button&&r.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),s=i&&n.client.getSubGrid(i.dataset.region);let o;i&&(r.closest(".b-grid-splitter-button-collapse")?n.onCollapseClick(s,i,e):r.closest(".b-grid-splitter-button-expand")?n.onExpandClick(s,i,e):n.enableDragging&&(n.startMove(i,e),o=i)),("touch"===e.pointerType||null!==(t=n.touchedSplitter)&&void 0!==t&&t.classList.contains("b-touching"))&&n.toggleTouchSplitter(o)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.enableDragging&&this.endMove(e)}onSubGridCollapse({subGrid:e}){const t=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const t=this,{touchedSplitter:n}=t;e&&n&&e.dataset.region!==n.dataset.region&&t.toggleTouchSplitter();const r=t.client.getSubGrid(e?e.dataset.region:null==n?void 0:n.dataset.region);r&&(r.toggleSplitterCls("b-touching",Boolean(e)),e?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),t.touchedSplitter=e}render(){const{regions:e,subGrids:t}=this.client;if(2===e.length){const n=t[e[0]];n.maxWidth&&n.width>=n.maxWidth&&n.splitterElement.classList.add("b-left-only")}else e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}updateEnableDragging(e){this.client.element.classList.toggle("b-grid-splitter-no-drag",!e)}}Hy.featureClass="b-split",Hy._$name="RegionResize",Jv.registerFeature(Hy);const Vy=e=>e instanceof KeyboardEvent||"keydown"===(null==e?void 0:e.type)&&(null==e?void 0:e.target);class Ny extends Gv{static $name="RowCopyPaste";static type="rowCopyPaste";static get pluginConfig(){return{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}}static configurable={nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1,cutOnly:null,allowedDataSources:["RowCopyPaste"],columnTypesToIgnore:["rownumber","sequenceNumber"]};construct(e,t){super.construct(e,t),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}entityName="row";onBeforeRenderRow({row:e,record:t}){var n;e.cls["b-cut-row"]=this.isCut&&(null===(n=this.cutData)||void 0===n?void 0:n.includes(t))}isActionAvailable({actionName:e,event:t}){var n;if(!super.isActionAvailable(...arguments))return!1;const{grid:r}=this,{target:i}=t;return("cut"!==e&&"paste"!==e||!r.isLockedRows)&&(("paste"===e||(null===(n=r.selectedRecords)||void 0===n?void 0:n.length)>0)&&(!i||Boolean(i.closest(".b-grid-body-container"))))}async copy(e){await this.copyRows(!1,e)}async cut(e){await this.copyRows(!0,e)}paste(e){var t;return Vy(e)&&(e=this.client.getRecordFromElement(e.target)),this.pasteRows(null!==(t=e)&&void 0!==t&&t.isModel?e:null)}async copyRows(e=!1,t){const n=this,{client:r,entityName:i}=n,{selectionMode:s}=r;n.cutOnly&&(e=!0);let o=n.selectedRecords.filter((t=>!t.readOnly||!e));if(t){let e=t;var a;if(Vy(t))e=(null===(a=r.resolveRowRecord)||void 0===a?void 0:a.call(r,t.target))??r.getRecordFromElement(t.target);s.multiSelect&&s.cell&&!r.features.cellCopyPaste||r.isSelected(e)||(o=[e])}const l=await n.writeToClipboard(o,e);void 0!==l&&(r.trigger("copy",{records:l.data,originalRecords:o,isCut:e,entityName:i}),n.monitorCellCopyPaste())}setIsCut(e,t){var n;null===(n=this.grid.rowManager.getRowById(e))||void 0===n||n.toggleCls("b-cut-row",t),e.meta.isCut=t}handleCutData({source:e}){var t;e!==this&&null!==(t=this.cutData)&&void 0!==t&&t.length&&this.grid.store.remove(this.cutData)}monitorCellCopyPaste(){const e=this,{cellCopyPaste:t}=e.client.features;t&&!e._cellCopyPasteListener&&(e._cellCopyPasteListener=e.client.ion({beforePaste({entityName:n,text:r,targetCell:i}){if(n===t.entityName&&e.compareClipboardText(e.clipboardText,r))return e.paste(i.record),!1},thisObj:e}))}stringConverter(e){const{rowManager:t}=this.grid,{columnTypesToIgnore:n}=this,r=e.flatMap((e=>{var n;return null===(n=t.getRowById(e))||void 0===n?void 0:n.cells.map((e=>new Dv(e)))}));return this.cellsToString(r.filter((e=>{var t;return e&&!n.includes(null===(t=e.column)||void 0===t?void 0:t.type)})))}cloneData({data:e,isPaste:t}){var n;return null!==(n=e)&&void 0!==n&&n.length&&!this.cutOnly&&(this.sortByIndex(e),e=this.extractParents([...e],{},t)),e}async beforeCopy({data:e,isCut:t}){return await this.client.trigger("beforeCopy",{records:e,isCut:t,entityName:this.entityName})}async pasteRows(e){var t,n;const r=this,{client:i,entityName:s}=r,o=e||i.selectedRecord,{tree:a}=i.store;if(i.readOnly||i.isTreeGrouped)return[];const l=await r.readFromClipboard({referenceRecord:o},!0),d=null==l?void 0:l.isCut;let c=null==l?void 0:l.data;return!l||!Array.isArray(c)||null===(t=c)||void 0===t||!t.length||a&&d&&c.some((e=>e.contains(o,!0)))?[]:(d&&a&&(c=r.extractParents(c,{})),await r.insertCopiedRecords(c,o),i.isDestroying?void 0:(d?await r.clearClipboard():i.selectedRecords=c,i.trigger("paste",{records:c,originalRecords:l.originalData,referenceRecord:o,isCut:d,entityName:s}),r.clipboard.triggerPaste(r),null===(n=i.getRowFor(c[c.length-1]))||void 0===n||null===(n=n.cells)||void 0===n||null===(n=n[0])||void 0===n||n.focus(),c))}async beforePaste({referenceRecord:e,data:t,originalData:n,text:r,isCut:i}){const s=t!==r?t:[];return await this.client.trigger("beforePaste",{records:s,referenceRecord:e,isCut:i,entityName:this.entityName,data:t,originalRecords:n})}stringParser(e){return this.setFromStringData(e,!0).modifiedRecords}insertCopiedRecords(e,t){const n=this.client.store.$master,r=t?n.indexOf(t)+1:n.count;return n.isTree?((null==t?void 0:t.parent)||n.rootNode).insertChild(e,null==t?void 0:t.nextSibling,!1,{orderedBeforeNode:null==t?void 0:t.nextOrderedSibling}):n.insert(r,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach((t=>{e.includes(t.record)||e.push(t.record)})),e}getMenuItemText(e,t=!1){const n=this;let r=n[e+"RecordText"];return t&&(r+=` (${n.selectedRecords.length>1?n.rowSpecifierTextPlural:n.rowSpecifierText})`),r}populateCellMenu({record:e,items:t,cellSelector:n}){var r;const i=this,{client:s,rowOptionsOnCellContextMenu:o}=i,a=!0===(null===(r=s.features.cellCopyPaste)||void 0===r?void 0:r.enabled),l=a&&s.isCellSelected(n);s.isTreeGrouped||!1!==(null==e?void 0:e.isSpecialRow)||!(a?s.selectedRows.length:s.selectedRecords.length)||l&&!i.rowOptionsOnCellContextMenu||(i.copyOnly||(t.cut={text:i.getMenuItemText("cut",l&&o),localeClass:i,icon:"b-icon b-icon-cut",weight:135,disabled:e.readOnly||s.isLockedRows||s.readOnly,onItem:()=>i.cut(e)},t.paste={text:i.getMenuItemText("paste",l&&o),localeClass:i,icon:"b-icon b-icon-paste",weight:140,onItem:()=>i.paste(e),disabled:s.readOnly||!1===i.hasClipboardData()||s.isLockedRows}),i.cutOnly||(t.copy={text:i.getMenuItemText("copy",l&&o),localeClass:i,cls:"b-separator",icon:"b-icon b-icon-copy",weight:120,onItem:()=>i.copy(e)}))}sortByIndex(e){const{store:t}=this.client;return e.sort(((n,r)=>{const i=n.indexPath,s=r.indexPath;if(!e.includes(n.parent)&&!e.includes(r.parent))return t.indexOf(n)-t.indexOf(r);if(i.length===s.length){for(let e=0;e<i.length;e++){if(i[e]<s[e])return-1;if(i[e]>s[e])return 1}return 0}return i.length-s.length}))}extractParents(e,t,n=!0){const r=this,{store:i}=r.client;i.tree&&e.forEach((t=>{t.traverse((t=>{const n=t.getTopParent(!0);e.includes(t)||r.isCut&&e.some((e=>n.includes(e)))||e.push(t)}))}));const s=e.reduce(((e,s)=>{let o;const a=s.parentId||s.meta.modified;return r.isCut?(o=s,o.meta.isCut=!1):(o=s.copy(),n&&(o[r.nameField]=r.generateNewName(o,s)),o.data.expanded=s.isExpanded(r.client.store)),t[s.id]=o,s.parent===i.rootNode?e.push(o):a in t?t[a].appendChild(o,!0):e.push(o),e}),[]);return s.forEach((e=>{e.sortOrderedChildren(!0,!0)})),s}}Ny.featureClass="b-row-copypaste",Ny._$name="RowCopyPaste",Jv.registerFeature(Ny,!0,"Grid"),Jv.registerFeature(Ny,!1,"Gantt"),Jv.registerFeature(Ny,!1,"SchedulerPro"),Jv.registerFeature(Ny,!1,"ResourceHistogram");class By extends ey{static $name="RowEdit";static configurable={editor:{$config:"lazy",value:{type:"panel",cls:{"b-row-editor":1},drawer:{type:"overlay",autoClose:!1,tool:null},keyMap:{Escape:"up.cancelEditing",Enter(e){if(e.target.matches("button"))return!1;this.callback("up.finishEditing")}},bbar:{items:{save:{text:"L{save}",cls:{"b-raised":1},color:"b-blue",onClick:"up.finishEditing"},cancel:{text:"L{cancel}",onClick:"up.cancelEditing"}}},focus(){(this.isValid?this.focusableElement:this.items.find((e=>!e.isValid)).focusableElement).focus({preventScroll:!0})}}},focusContextualField:!0,instantUpdate:null,editorSize:null,labelWidth:null,local:null,revertButton:null,side:{$config:"lazy",value:"end"},keyMap:{Enter:"startEditing",F2:"startEditing"},titleField:"name",titleRenderer:null};bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",remove:"onStoreRemove",thisObj:this})}changeTitleField(e){"string"==typeof e&&(this.titleRenderer=t=>this.L("L{Object.editing}",N.encodeHtml(t[e])))}getEditingContext(e){if(!(e=e.target?new Dv(e.target):this.grid.normalizeCellContext(e)).record.isSpecialRow)return e}async startEditing(e={id:this.grid.firstVisibleRow.id},t){if(this.isEditing){var n;if(!1===this.cancelEditing(!0))return!1;null===(n=this.editorContext)||void 0===n||null===(n=n.row)||void 0===n||n.removeCls("b-editing")}if(e=this.editorContext=this.getEditingContext(e)){var r;const n=this,{grid:i}=n,s=n.editor||(n.editor=n._editorConfig)&&n.editor,{cancel:o}=s.bbar.widgetMap;if(e.editor=s,s.title=n.callback(n.titleRenderer,n,[e.record]),s.record=e.record,s.rowEditorContext=e,s.readOnly=i.readOnly||s.record.readOnly,o&&(o.text=n.L(s.readOnly?"L{close}":"L{cancel}")),!1===i.trigger("beforeStartRowEdit",{grid:i,editorContext:e}))return!1;n.revertButton&&(s.bbar.widgetMap.revert.hidden=!n.editorContext.record.isModified),await s.collapsible.toggleReveal(!0);const a=s.widgetMap[null===(r=e.column)||void 0===r?void 0:r.field],l=a&&(t||n.focusContextualField)?a:s;t&&!s.readOnly&&(null==a||a.clear()),l.focus(),e.row.addCls("b-editing"),i.trigger("startRowEdit",{grid:i,editorContext:e})}}onEditorStart(){"cellclick"!==this.triggerEvent&&(this.detachListeners("cellClickWhileEditing"),this.grid.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:this}))}syncEditingReadOnly({readOnly:e}){if(this.isEditing){const{editor:t}=this,{record:n}=this.editorContext,{cancel:r}=t.bbar.widgetMap;t.readOnly=e||n.readOnly,r&&(r.text=this.L(t.readOnly?"L{close}":"L{cancel}"))}}onEditorHide(){var e;null===(e=this.editorContext)||void 0===e||null===(e=e.row)||void 0===e||e.removeCls("b-editing"),this.detachListeners("cellClickWhileEditing"),this.editorContext=this.editor.record=null}async finishEditing(){const e=this,{grid:t,editor:n,editorContext:r}=this;if(n.isValid){let i=t.trigger("beforeFinishRowEdit",r);return W.isPromise(i)&&(e.finishEditingPromise=i,i=await i,e.finishEditingPromise=null),!1===i?(n.focus(),!1):(n.collapsible.toggleReveal(!1),e.updateRecordFromFields(),t.trigger("finishRowEdit",r),!0)}var i;return null===(i=n.items.find((e=>!e.isValid)))||void 0===i||i.focus(),!1}cancelEditing(e=!1){const t=this,{editor:n}=t;if(!1===t.grid.trigger("beforeCancelRowEdit",t.editorContext))return n.focus(),!1;!0!==e&&(t.instantUpdate&&(t.isCanceling=!0,n.setValues(n.initialValues),t.updateRecordFromFields(),t.isCanceling=!1),n.collapsible.toggleReveal(!1))}async onElementClick(e){e.target.matches(".b-grid-body-container, .b-grid-subgrid")&&this.editorContext&&await this.finishEditing(e)}async onElementKeyDown(e){const t=this,{grid:n}=t,{focusedCell:r}=n;e.handled||!t.autoEdit||t.isEditing||!r||r.isActionable&&Yn.isEditable(e.target)||e.ctrlKey||e.key.length<=1&&t.startEditing(r,!0)}updateSide(){this.editor=null}changeEditor(e,t){if(e){var n;const r=this,{grid:i,labelWidth:s}=r,o=Xu.mergeConfigs({owner:i,cls:{"b-editor-instant-update":r.instantUpdate},drawer:{side:r.side,size:r.editorSize},autoUpdateRecord:r.instantUpdate,items:r.collectEditorFields(),style:{[s?"--b-label-width":""]:Yn.setLength(s)},refreshEdit:r.refreshEdit.bind(r)},e);r._editorConfig||(r._editorConfig=e),r.local&&(o.appendTo=i.element),r.revertButton&&(o.bbar.items.revert={text:"L{revert}",onClick:r.revertChanges.bind(r)}),null===(n=e=Xu.reconfigure(t,e?o:null,r))||void 0===n||n.ion({thisObj:r,show:"onEditorStart",hide:"onEditorHide"})}else null==t||t.removeAll(),null==t||t.destroy();return e}revertChanges(){const e=this,{editor:t,record:n}=e.editorContext;e.isCanceling=!0,n.revertChanges(),t.title=e.callback(e.titleRenderer,e,[n]),t.setValues(n,{onlyName:t.strictRecordMapping,highlight:Boolean(t.$highlight)}),e.isCanceling}refreshEdit(){const{editor:e}=this;e.isVisible&&(this.syncEditingReadOnly({readOnly:this.grid.readOnly}),this.instantUpdate||this.isCanceling||e.setValues(this.editorContext.record,{onlyName:e.strictRecordMapping,highlight:Boolean(e.$highlight)}))}updateRecordFromFields(){const{editor:e}=this,{record:t}=e;e.items.forEach((n=>{const r=n.getValueName({onlyName:e.strictRecordMapping});r&&r in t&&t.setValue(r,n.value)}),!0)}updateInstantUpdate(e){const{_editor:t}=this;t&&(t.autoUpdateRecord=e,t.element.classList.toggle("b-editor-instant-update",Boolean(e)))}collectEditorFields(){let e=0;return this.grid.columns.reduce(((t,n)=>{const{editor:r}=n,{modelClass:i}=this.grid.store;return null!=r&&r.isField&&(r.readOnly=n.readOnly,e=r.weight||(r.weight=e+100),r.label||(r.label=n.text||i.getFieldDefinition(n.field).label),r.revertOnEscape=n.revertOnEscape,t[n.field]=r),t}),{})}}By._$name="RowEdit",Jv.registerFeature(By);const zy={onTab:1,onShiftTab:1},jy={remove:1,filter:1,dataset:1,replace:1};class Wy extends(Mr.mixin(Hi)){static $name="RowExpander";static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",shadowRootContainerClass:"b-rowexpander-shadowroot-container",recordStateMap:new Map,collapsingStateMap:new Map}}static configurable={renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0,widget:null,dataField:null,keyMap:{Tab:{handler:"onTab",weight:50},"Shift+Tab":{handler:"onShiftTab",weight:50}},autoScroll:!1,spanRegions:!1,callOnFunctions:!0};static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore","navigateUp"],override:["onGridBodyFocusIn","navigateDown","catchFocus","keyMapOnKeyDown"],assign:["expandRow","collapseRow"]}}static deprecatedEvents={beforeExpand:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `beforeExpand` was replaced by the `beforeRowExpand` event on the Grid itself"},expand:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `expand` was replaced by the `rowExpand` event on the Grid itself"},beforeCollapse:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `beforeCollapse` was replaced by the `beforeRowCollapse` event on the Grid itself"},collapse:{product:"grid",invalidAsOfVersion:"7.0.0",message:"RowExpander `collapse` was replaced by the `rowCollapse` event on the Grid itself"}};afterConstruct(){const e=this,{client:t}=e;if(!e.renderer&&!e.widget)return e.disabled=!0,void console.warn("RowExpander requires either a widget config or implementing the renderer function.");t.isGanttBase&&!1!==t.fixedRowHeight&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to `false`."),e.widget&&ir.ion({theme:e.onThemeChange,thisObj:e}),e.bindStore(t.store),e.triggerEvent&&t.ion({[e.triggerEvent]:"onTriggerEvent",thisObj:e}),e.addColumn()}bindStore(e){const t=this;t.recordStateMap.clear(),t.collapsingStateMap.clear(),t.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:t.onStoreChange,thisObj:t})}doDisable(e){const{client:t}=this;e&&(this.recordStateMap.clear(),this.collapsingStateMap.clear()),t.isConfiguring||t.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e?this.L(e):e}onGridBodyFocusIn(e){var t;const n=this;(n.hasWidget?e.target.matches(`.${n.expanderBodyClass}, .${n.shadowRootContainerClass}`):null!==(t=n.client.lastMousedownEvent)&&void 0!==t&&null!==(t=t.target)&&void 0!==t&&t.closest("."+n.expanderBodyClass))||n.overridden.onGridBodyFocusIn(e)}keyMapOnKeyDown({target:e}){var t;this.hasWidget&&null!==(t=e.classList)&&void 0!==t&&t.contains(this.shadowRootContainerClass)||this.overridden.keyMapOnKeyDown(...arguments)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:t}=this,n=t.isAnimating;t.isAnimating=e,t.isAnimating!==n&&t.element.classList.toggle("b-rowexpander-animating")}changeWidget(e){return e&&this.isWidgetConfig(e)?{[this.client.regions[0]]:e}:e}afterColumnsChange(){this.addColumn()}changeColumn(e){const t=this,{client:n}=t;if(null==e)return e;let r="first"===t.columnPosition?"left":"right";return n.isRTL&&(r="first"===t.columnPosition?"right":"left"),W.assign({type:"action",draggable:!1,resizable:!1,showColumnPicker:!1,ariaLabel:t.L("L{RowExpander.columnDescription}"),actions:[{cls:`b-icon b-icon-collapse-${r}`,tooltip:({record:e})=>t.L(t.recordStateMap.has(e)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:e})=>t.toggleExpand(e)}],width:40,hideable:!1,align:"center",region:n.regions[0],field:"expanderActionColumn"},e)}addColumn(){const e=this,{column:t}=e,{columns:n}=e.client;e._isAddingExpanderColumn||!t||e._expander&&n.includes(e._expander)||(e._isAddingExpanderColumn=!0,"last"===e.columnPosition?([e._expander]=n.add(t),e.client.fillLastColumn=!1):[e._expander]=n.insert(0,t),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||null!=e&&e.closest(".b-action-cell")||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onExpanderBodyResize(e){for(const n of e){var t;const e=this.client.store.getById(null===(t=n.target.dataset)||void 0===t?void 0:t.id),r=e&&this.recordStateMap.get(e);if(r&&!r.ignoreResize&&!r.isAnimating){const t=r.expanderBodyHeight;r.expanderBodyHeight=null,this.processRowHeight(e,0)!==t&&this.renderRowsWithAnimation(e)}}}get shouldSpanRegions(){return this.spanRegions&&this.client.regions.length>1}onStoreChange({action:e,source:t,records:n,changes:r}){var i;const s=this,{recordStateMap:o,collapsingStateMap:a}=s,l=r&&Object.keys(r);if((1!==(null==l?void 0:l.length)||"store"!==(null===(i=t.modelClass.fieldMap[l[0]])||void 0===i?void 0:i.type))&&!s.disabled)if("removeAll"===e)o.clear(),a.clear();else if(jy[e])for(const[e,n]of o)t.includes(e)||(s.destroyWidgets(n),o.delete(e),a.delete(e));else if(s.refreshOnRecordChange&&null!=n&&n.length&&"update"===e){var d;const e=null===(d=ir.currentPointerDown)||void 0===d?void 0:d.target,t=[];let r=!1;n.forEach((n=>{const i=o.get(n);null!=i&&i.isCreated&&(i.isCreated=!1,!r&&e&&s.client.regions.some((t=>{var n,r;return(null===(n=i.expandedBodyElements)||void 0===n||null===(n=n[t])||void 0===n?void 0:n.contains(e))||(null===(r=i.widgets)||void 0===r||null===(r=r[t])||void 0===r||null===(r=r.element)||void 0===r?void 0:r.contains(e))}))&&(r=!0),t.push(n))})),null!=t&&t.length&&(r?s.client.delayUntilMouseUp((()=>{t.forEach((e=>s.bufferedRenderer(e)))})):s.client.rowManager.renderFromRecord(t[0]))}}processRowHeight(e,t){var n;const r=this,{shouldSpanRegions:i}=r;let s=r.recordStateMap.get(e),o=!1;if(s&&!s.expanderBodyHeight)for(const e of r.client.regions){var a;const t=null===(a=s.expandedBodyElements[e])||void 0===a?void 0:a.offsetHeight;t>s.expanderBodyHeight&&(s.expanderBodyHeight=t,o=!0)}else!s&&(s=r.collapsingStateMap.get(e))&&s.expanderBodyHeight&&(s.expanderBodyHeight=0,o=!0);return o&&r.enableAnimations&&i&&r.animateSpannedExpander(s),((null===(n=s)||void 0===n?void 0:n.expanderBodyHeight)??0)+t}animateSpannedExpander(e){const t=this,n=e.expandedBodyElements[t.client.regions[0]],r=t.client.rowManager.getRowById(e.record).element;e.isAnimating=t.isAnimating=!0,e.ignoreResize=!0,n.style.height=r.offsetHeight-e.cellHeight+"px",n.offsetHeight,n.style.height=e.expanderBodyHeight+"px",t.waitForTransition(n,(()=>{n.style.height="",e.expanderBodyHeight||n.remove(),e.isAnimating=t.isAnimating=!1}))}beforeRenderRow({row:e,record:t}){const n=this,{regions:r}=n.client,{expandedRowClass:i,collapsingStateMap:s,shouldSpanRegions:o}=n,a=n.recordStateMap.get(t);if(e.cls.toggle("b-rowexpander-disabled",n.disabled),e.cls[i]){let r=s.get(t);if(r){const i=()=>{r=s.get(t),r&&(s.delete(t),n.removeExpander(e),n.destroyWidgets(r))};n.enableAnimations&&n.isAnimating?n.waitForTransition(e,i):i()}else a||n.removeExpander(e)}else s.delete(t);!n.disabled&&a&&(a.isCreated||(a.ignoreResize=!0,n.renderExpander(t,e,a)),e.cls.add(i),r.forEach(((t,r)=>{const i=e.getElement(t);if(a.isCreated&&(!o||0===r)){const r=a.expandedBodyElements[t],s=o?n.client.verticalScroller:i;r.parentElement!==s&&(o||Yn.removeEachSelector(i,"."+n.expanderBodyClass),s.appendChild(r),n.observeResize(r)),o&&(r.style.top=e.top+a.cellHeight+"px",e._spannedExpandedBodyElement=r),a.ignoreResize=!1,a.renderPromiseResolver&&!a.isRenderingAsync&&(n.delay(a.renderPromiseResolver),a.renderPromiseResolver=null)}n.lockCellHeight(i,a.cellHeight,!1)})),n._shouldScrollIntoView&&n.autoScroll&&(n._shouldScrollIntoView=!1,Yn.isInView(a.expandedBodyElements[r[0]],!0)||n.client.rowManager.ion({once:!0,thisObj:n,renderDone:()=>n.scrollRowIntoView(e,t)})))}scrollRowIntoView(e,t){this.isAnimating?this.waitForTransition(e,(()=>this.client.scrollRowIntoView(t))):this.client.scrollRowIntoView(t)}waitForTransition(e,t){const n=Yn.isElement(e)?e:e.element;Jt.onTransitionEnd({element:n,property:"height",handler:t,thisObj:this,duration:Yn.getPropertyTransitionDuration(n,"height")??1})}removeExpander(e){const t=this;e.cls.remove(t.expandedRowClass);for(const i of t.client.regions){const s=e.getElement(i);for(const e of s.querySelectorAll("."+t.expanderBodyClass))t.unobserveResize(e),e.remove();var n,r;if(s.classList.remove(t.expandedRowClass),t.lockCellHeight(s,null,!1),t.shouldSpanRegions)null===(n=e._spannedExpandedBodyElement)||void 0===n||null===(r=n.remove)||void 0===r||r.call(n),e._spannedExpandedBodyElement=null}}destroyWidgets(e){for(const r of this.client.regions){var t,n;null===(t=e.widgets)||void 0===t||null===(t=t[r])||void 0===t||null===(n=t.destroy)||void 0===n||n.call(t)}}isWidgetConfig(e){return e.type&&!e.tag}renderExpander(e,t,n){var r;const i=this,{client:s,widget:o,shouldSpanRegions:a}=i,l=null===(r=t.cells[0])||void 0===r?void 0:r.offsetHeight,{expandedBodyElements:d={}}=n,c=[],u=(e,t,n)=>{if(null!=e)if("string"==typeof e){const n=[...t.childNodes].map((e=>t.removeChild(e)));t.innerHTML=e,n.reverse().forEach((e=>t.insertBefore(e,t.firstChild)))}else i.isWidgetConfig(e)?h(e,t,n):(e=Yn.createElement(e),t.appendChild(e))},h=(r,o,a)=>{if(!o.attachShadow)return void console.warn("Rendering a Widget in the RowExpander requires access to the Shadow DOM. If your app lives in a sandboxed environment with restrictions on Shadow DOM manipulation, this is not supported. If you use SalesForce LWC, consider enabling Lightning Web Security.");const l=Yn.createElement({parent:o,className:i.shadowRootContainerClass,style:"flex : 1"}),d=l._shadowRoot=l.attachShadow({mode:"closed"});c.push(Yn.cloneStylesIntoShadowRoot(d).then((()=>{var l;const c=null===(l=Yn.getThemeInfo())||void 0===l?void 0:l.name;if(s.isDestroyed)return;const u=r.dataField??i.dataField;if(u){const n=e.getValue(u);if(null!=n&&n.isStore)r.store=n;else if(s.store[`${u}Store`]){const t=s.store[`${u}Store`];r.store=t.chain((t=>e.getValue(u).includes(t)))}else r.store={data:n,internalListeners:{change:()=>!t.isDestroyed&&t.render(),thisObj:i}}}if(c){const{cls:e}=r,t=`b-theme-${c.toLowerCase()}`;r.cls=e?e+" "+t:t}n.widgets||(n.widgets={}),n.widgets[a]=o.widget=oc.create(W.assign({appendTo:d,owner:s,flex:1,minHeight:"5em",isNested:!0,expandedRecord:e},r))})).catch((e=>{throw new Error("Could not load stylesheet "+e)})))};if(!n.isRenderingAsync){t.addCls(i.expandedRowClass),Object.assign(n,{cellHeight:l,expandedBodyElements:d,expanderBodyHeight:0,loadingIndicators:[]});for(const[n,r]of s.regions.entries()){if(a&&n>0)break;const m=t.getElement(r);let p,f=d[r];var g;if(f?(i.unobserveResize(f),f.innerHTML=""):f=Yn.createElement({parent:a?s.verticalScroller:m,tabIndex:-1,className:i.expanderBodyClass,style:{top:a?t.top+l:l+"px"},dataset:{id:e.id}}),i.observeResize(f),null!=o&&o[r])h(o[r],f,r);else p=null===(g=i.renderer)||void 0===g?void 0:g.call(i,{record:e,expanderElement:f,rowElement:m,region:r,grid:s});C.isPromise(p)?c.push(p.then((e=>u(e,f,r)))):u(p,f,r),d[r]=f}c.length&&(n.isRenderingAsync=!0,i.showLoadingIndicators(n),Promise.all(c).then((()=>{Promise.all(c).then((()=>{var t,r;if(!s.isDestroyed){null===(t=n.loadingIndicators)||void 0===t||t.forEach((e=>e.remove())),n.loadingIndicators.length=0,n.ignoreResize=!1,n.isRenderingAsync=!1;for(const[,e]of i.recordStateMap)if(e.isRenderingAsync)return;null===(r=i.renderRowsWithAnimation)||void 0===r||r.call(i,e,!0)}}))}))),n.isCreated=!0}}showLoadingIndicators(e){for(const t in e.expandedBodyElements)e.loadingIndicators.push(Yn.createElement({parent:e.expandedBodyElements[t],className:"b-rowexpander-loading",style:{height:this.loadingIndicatorHeight+"px"},children:[{tag:"i",className:"b-icon b-icon-spinner"},this.loadingIndicatorText]}))}renderRowsWithAnimation(e){const t=this;if(t.enableAnimations){const n=t.client.rowManager.getRowById(e);n&&(t.isAnimating=!0,t.collapsingStateMap.has(e)&&n.addCls("b-row-is-collapsing"),t.waitForTransition(n,(()=>{var e;(t.isAnimating=!1,n.isDestroyed)||(null===(e=n.removeCls)||void 0===e||e.call(n,"b-row-is-collapsing"))})))}return t.bufferedRenderer(e)}bufferedRenderer(e){return(this._bufferedRecords??(this._bufferedRecords=[])).push(e),this._rafPromise||(this._rafPromise=new Promise((e=>{requestAnimationFrame((()=>{var t;null===(t=this.internalRender)||void 0===t||t.call(this,e),this._rafPromise=null}))}))),this._rafPromise}internalRender(e){const t=this,{_bufferedRecords:n}=t,{store:r}=t.client;t.recordStateMap.forEach(((e,t)=>{e.renderPromiseResolver&&e.isCreated&&!n.includes(t)&&n.push(t)}));const[i]=n.sort(((e,t)=>r.indexOf(e)-r.indexOf(t)));t.client.rowManager.renderFromRecord(i),n.length=0,t.delay(e)}lockCellHeight(e,t,n){for(let r=0;r<e.children.length;r++){const i=e.children[r];i.classList.contains(this.expanderBodyClass)||(i.style.height=n?"":t+"px")}}async expandRow(...e){return this.expand(...e)}async collapseRow(...e){return this.collapse(...e)}async expand(e,t=!1){const n=this,{client:r}=n;if(n.disabled||n.recordStateMap.has(e)||!1===await n.trigger("beforeExpand",{record:e})||!1===await r.trigger("beforeRowExpand",{record:e}))return;let i;return new Promise((s=>{var o;(i={isCreated:!1,renderPromiseResolver:s,record:e},n.recordStateMap.set(e,i),n.collapsingStateMap.delete(e),n._shouldScrollIntoView=!0,n.renderRowsWithAnimation(e),t)||(null===(o=r.syncSplits)||void 0===o||o.call(r,(t=>t.features.rowExpander.expand(e,!0))))})).then((()=>{var t,s,o,a;null===(t=n.trigger)||void 0===t||t.call(n,"expand",{record:e,expandedElements:i.expandedBodyElements,widget:null===(s=i.widgets)||void 0===s?void 0:s[n.client.regions[0]],widgets:i.widgets}),null===(o=r.trigger)||void 0===o||o.call(r,"rowExpand",{record:e,expandedElements:i.expandedBodyElements,widget:null===(a=i.widgets)||void 0===a?void 0:a[n.client.regions[0]],widgets:i.widgets})}))}async collapse(e,t=!1){const n=this,{client:r}=n,i=n.recordStateMap.get(e);if(!n.disabled&&!1!==await n.trigger("beforeCollapse",{record:e})&&!1!==await r.trigger("beforeRowCollapse",{record:e})){if(null!=i&&i.expandedBodyElements)for(const e in i.expandedBodyElements)n.unobserveResize(i.expandedBodyElements[e]);var s;if(n.recordStateMap.delete(e),n.collapsingStateMap.set(e,i),await n.renderRowsWithAnimation(e),n.trigger("collapse",{record:e}),r.trigger("rowCollapse",{record:e}),!t)null===(s=r.syncSplits)||void 0===s||s.call(r,(t=>t.features.rowExpander.collapse(e,!0)))}}async refreshRow(e){const t=this.recordStateMap.get(e);if(null!=t&&t.isCreated)return t.isCreated=!1,this.bufferedRenderer(e)}get hasWidget(){return Boolean(this.widget)||[...this.recordStateMap.values()].some((e=>e.widgets))}navigateDown(){if(!this.onKeyboardIn())return this.overridden.navigateDown(...arguments)}navigateUp(){this.onKeyboardIn(!0)}catchFocus({navigationDirection:e,source:t,editing:n}){const{client:r}=this,{focusedCell:i,regions:s}=r;for(let[a,l]of this.recordStateMap.entries())for(const d in l.expandedBodyElements)if(l.expandedBodyElements[d].widget===t){if(n){const t=s[s.indexOf(d)+("down"===e?1:-1)];var o;if(t)return this.startEditInWidget(null===(o=l.widgets)||void 0===o?void 0:o[t],"down"===e)}let t;"down"===e&&(a=r.store.getNext(a,void 0,!0)),t=n||!i||i._isDefaultFocus?this.getNavigateableColumn(r,!0,n&&"up"===e):i.column,r._focusedCell=null;const c=r.normalizeCellContext({record:a,column:t});return r.focusCell(c),n&&r.startEditing(c),!0}}onKeyboardIn(e){var t,n;const{focusedCell:r}=this.client,i=r&&this.recordStateMap.get(r.record),s=null==i||null===(t=i.expandedBodyElements)||void 0===t||null===(t=t[null==r||null===(n=r.column)||void 0===n?void 0:n.region])||void 0===t?void 0:t.widget;if(null!=s&&s.isGrid){let t;return t=s.focusedCell&&!s.focusedCell._isDefaultFocus?s.focusedCell.column:this.getNavigateableColumn(s),s._focusedCell=null,s.focusCell(s.normalizeCellContext({record:s[(e?"last":"first")+"VisibleRow"],column:t})),!0}return!1}getNavigateableColumn(e,t=!0,n=!1){const r=n?[...e.columns.visibleColumns].reverse():e.columns.visibleColumns;return r.find((n=>{var r;return n!==e.checkboxSelectionColumn&&n!==(null===(r=e.features.rowExpander)||void 0===r?void 0:r._expander)&&(!t||n.editor)}))??r[0]}isActionAvailable({actionName:e}){var t;if(zy[e])return!this.isDisabled&&(null===(t=this.client.features.cellEdit)||void 0===t?void 0:t.isEditing)}onTab(e){const{client:t}=this,{cellEdit:n}=t.features;if(null!=n&&n.enabled){var r;const{columns:i,regions:s}=t,{activeRecord:o}=n,a=!0!==e,l=n.getAdjacentEditableCell(t.focusedCell,a),d=a?o:l?t.store.getById(l.id):null,c=d&&(null===(r=this.recordStateMap.get(d))||void 0===r?void 0:r.widgets);if(c&&(null==o?void 0:o.id)!==(null==l?void 0:l.id)){let e=(l?i.getById(l.columnId):i.visibleColumns[0]).region;for(;e;){const t=c[e];if(this.startEditInWidget(t,a))return!0;e=s[s.indexOf(e)+(a?1:-1)]}}}return!1}startEditInWidget(e,t=!0){var n;const{cellEdit:r}=this.client.features;if(null!=r&&r.enabled&&null!=e&&null!==(n=e.features)&&void 0!==n&&null!==(n=n.cellEdit)&&void 0!==n&&n.enabled)return r.finishEditing().then((()=>{const n=e[(t?"first":"last")+"VisibleRow"],r=this.getNavigateableColumn(e,!0,!t);e.startEditing(e.normalizeCellContext({record:n,column:r}))})),!0}onShiftTab(){return this.onTab(!0)}observeResize(e){const t=this;t.resizeObserver||(t.resizeObserver=new ResizeObserver((e=>t.onExpanderBodyResize(e)))),t.resizeObserver.observe(e)}unobserveResize(e){var t;null===(t=this.resizeObserver)||void 0===t||t.unobserve(e)}doDestroy(){var e;null===(e=this.resizeObserver)||void 0===e||e.disconnect(),delete this.resizeObserver;for(const[,e]of this.recordStateMap)this.destroyWidgets(e);super.doDestroy()}onThemeChange({prev:e,theme:t}){for(const[,n]of this.recordStateMap)Object.values(n.expandedBodyElements).forEach((n=>{const r=n.querySelector("."+this.shadowRootContainerClass);var i,s;null!=r&&r._shadowRoot&&(Yn.cloneStylesIntoShadowRoot(null==r?void 0:r._shadowRoot,!0),null===(i=n.widget)||void 0===i||null===(i=i.element)||void 0===i||i.classList.remove(`b-theme-${e}`),null===(s=n.widget)||void 0===s||null===(s=s.element)||void 0===s||s.classList.add(`b-theme-${t}`))}))}getExpandedRecord(e){for(const[n,{widgets:r,expandedBodyElements:i}]of this.recordStateMap.entries())if(r&&e.isWidget){var t;for(const t in r)if(r[t]===e)return n;if(null!==(t=e.expandedRecord)&&void 0!==t&&t.isModel)return e.expandedRecord}else for(const t in i){const r=i[t];if(r===e||r.contains(e))return n}return null}getExpandedWidgets(e){var t;return null===(t=this.recordStateMap.get(e))||void 0===t?void 0:t.widgets}}Wy._$name="RowExpander",Jv.registerFeature(Wy);class Uy extends(Hi(Mr)){static $name="RowReorder";static configurable={showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:null,copyIconCls:"b-icon b-icon-add",allowCrossGridDrag:!1,dragHelperConfig:null,preserveSorters:null,animateDrop:!0,targetGrid:null};construct(e,t){this.grid=e,e.isGanttBase&&!("dropOnLeaf"in t)&&(t.dropOnLeaf=!0),super.construct(...arguments)}doDestroy(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t,allowCrossGridDrag:n}=e;e.dragHelper=Zl.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!n,allowDropOutside:!0,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),dragWithin:n?t.floatRoot:t.bodyContainer,scrollManager:t.scrollManager,positioning:"inset",monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},setXY(e,r,i){const{context:s}=this;if(!s.started){const e=Ot.from(s.element,this.dragWithin),n=s.startPageY-globalThis.pageYOffset-s.element.getBoundingClientRect().top;this._elementHeight=e.height,i=e.top+n+this.proxyTopOffset,this._startScrollY=t.scrollable.y}const o=n?i:Math.min(t.scrollable.element.scrollHeight-this._elementHeight-1,i+t.scrollable.y-this._startScrollY);Yn.setTopInsetInlineStart(e,o,r)},ignoreSamePositionDrop:!1,createProxy(n){const r=document.createElement("div"),i=document.createElement("i");if(r.classList.add("b-row-reorder-proxy"),i.className="b-row-proxy-copy "+e.copyIconCls,r.appendChild(i),t.selectedRecords.slice().sort(((e,n)=>t.store.indexOf(e)-t.store.indexOf(n))).forEach((e=>{var i;const s=null===(i=t.rowManager.getRowFor(e))||void 0===i||null===(i=i.elements[t.regions[0]])||void 0===i?void 0:i.cloneNode(!0);s&&(s.style.transform=s.style.insetInlineStart=s.style.top="",s.style.width=n.offsetWidth+"px",s.removeAttribute("id"),r.appendChild(s))})),t.selectedRecords.length>1){const e=document.createElement("div");e.classList.add("b-badge","b-row-drag-count-indicator"),e.dataset.badge=t.selectedRecords.length,r.appendChild(e)}return Yn.removeClsGlobally(r,"b-selected","b-hover","b-focused"),r},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onAbort",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),t.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag"],"gridRow",!0),e.dropIndicator=Yn.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}static get pluginConfig(){return{chain:["beforeRenderCell","onInternalPaint"]}}get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}beforeRenderCell({cellElement:e,column:t,record:n,cellCls:r}){const{grid:i}=this;r["b-row-reorder-grip"]=this.showGrip&&this.enabled&&!n.isSpecialRow&&t===i.columns.visibleColumns[0]}isElementDraggable(e,t){var n;if(!(null===(n=this.client.features.rowResize)||void 0===n?void 0:n.isEventOverResizeHandle(t))&&!e.closest(".b-grid-cell .b-widget")){if(!this.gripOnly)return!0;{const n=e.closest(".b-grid-cell:first-child");if(n){const e=getComputedStyle(n,":before"),r=(this.grid.rtl?n.getBoundingClientRect().width-t.borderOffsetX:t.borderOffsetX)<=parseFloat(e.width);return r&&(this.client.preventDragSelect=!0),r}}}}onBeforeDragStart({event:e,source:t,context:n}){const r=this,{grid:i}=r,s=r.targetSubGridElement,o=n.startRecord=i.getRecordFromElement(n.element);if(e.target.classList.contains("b-rowexpander-shadowroot-container")||r.disabled||i.readOnly||i.isTreeGrouped&&o.isParent||!s.contains(n.element))return!1;if(o.readOnly||o.isSpecialRow)return!1;n.originalRowTop=i.rowManager.getRowFor(o).top,i.selectionMode.checkboxOnly||("touch"===t.startEvent.pointerType?i.isSelected(o)||i.selectRow({record:o,addToSelection:!1}):i.isSelected(o)||e.shiftKey||e.ctrlKey||i.selectRow({record:o}));const a=i.selectedRecords.filter((e=>!e.readOnly));return n.records=[o],a.includes(o)&&(n.records.push(...a.filter((e=>e!==o))),n.records.sort(((e,t)=>i.store.indexOf(e)-i.store.indexOf(t)))),!0}onDragStart({context:e}){var t,n;const r=this,{grid:i}=r,{cellEdit:s,cellMenu:o,headerMenu:a}=i.features;r.targetGrid=i,s&&(r.cellEditDisabledState=s.disabled,s.disabled=!0),null==o||null===(t=o.hideContextMenu)||void 0===t||t.call(o,!1),null==a||null===(n=a.hideContextMenu)||void 0===n||n.call(a,!1);const l=e.element.querySelector(".b-focused");null==l||l.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover")}resolveGrid(e,t){let{target:n}=e;if(/^touch/.test(e.type)){const e=Ot.from(t.element,null,!0).center;n=Yn.elementFromPoint(e.x,e.y)}return this.client.constructor.fromElement(n,(e=>e.isGridBase))}onDrag({context:e,event:t}){const n=this,{clientY:r}=t;let i=n.grid;if(n.allowCrossGridDrag&&(i=n.resolveGrid(t,e),n.targetGrid=i,!i))return void(e.valid=!1);const{store:s,rowManager:o}=i;let a,l,d,c,u,h=!0,g=o.getRowAt(r);if(g){const e=g.top+i.scrollable.element.getBoundingClientRect().top-i.scrollable.y,o=g.height/4,u=e+o,h=e+g.height/2,m=e+3*o;l=g.dataIndex,a=s.storage.getAt(l),s.isTree?c=(a.isParent||n.dropOnLeaf)&&r>u&&r<m:s.isGrouped&&(c=a.isGroupHeader&&a.meta.collapsed),d=!c&&t.clientY>=h}else t.pageY<i._bodyRectangle.y?(l=0,a=s.first,d=!1):(l=s.count-1,a=s.last,d=!0),g=o.getRow(l);if(a!==n.overRecord||n.after!==d||n.over!==c){var m,p;if(n.overRecord!==a)null===(m=o.getRowById(n.overRecord))||void 0===m||m.removeCls(n.dropOverTargetCls);if(n.overRecord=a,n.after=d,n.over=c,(n.targetGrid.readOnly||a===e.startRecord||!d&&!c&&0===l&&s.isGrouped||d&&a&&a.isGroupHeader&&a.meta.collapsed&&s.indexOf(a)===s.count-1)&&(h=!1),s.isTree?a?(u=d?a.nextSibling:a,e.records.some((e=>e.contains(a)))&&(h=!1),e.parent=h&&c?a:a.parent,n.clearTimeout(n.hoverTimer),a&&a.isParent&&!a.isExpanded(s)&&(n.hoverTimer=n.setTimeout((()=>i.expand(a)),n.hoverExpandTimeout))):e.parent=i.store.rootNode:u=d?s.storage.getAt(l+1):a,g)Yn.setTranslateY(n.dropIndicator,Math.max(g.top+(d?g.element.getBoundingClientRect().height:0),1)),null===(p=g)||void 0===p||p.toggleCls(n.dropOverTargetCls,h&&c);else 0===i.store.count&&Yn.setTranslateY(n.dropIndicator,0);!c&&l===s.indexOf(e.startRecord)+(d?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(h=!1),n.dropIndicator.style.visibility=c?"hidden":"visible",n.dropIndicator.classList.toggle("b-drag-invalid",!h),e.insertBefore=u,e.valid=n.reorderValid=h}else e.valid=!0}async onDrop(e){const t=this,{grid:n,targetGrid:r}=t,{context:i}=e,{ctrlKeyDown:s}=ir;i.valid=i.valid&&t.reorderValid,e.source=n,i.valid&&(i.async=!0,r.store.isTree&&(i.oldPositionContext=i.records.map((e=>{var t;return{record:e,parentId:null===(t=e.parent)||void 0===t?void 0:t.id,parentIndex:e.parentIndex}}))),!1===await n.trigger("gridRowBeforeDropFinalize",e)&&(i.valid=!1),t.animateDrop&&await t.dragHelper.animateProxyTo(t.dropIndicator,{align:"l0-l0"}),await t.finalizeReorder(i,s)),t.clearTimeout(t.hoverTimer),n.trigger("gridRowDrop",e),t.overRecord=t.after=t.over=t.targetGrid=null}onAbort(e){e.source=this.client,this.client.trigger("gridRowDragAbort",e),this.targetGrid=null}async finalizeReorder(e,t){var n;const r=this,{client:i,allowCrossGridDrag:s}=r,o=e.targetGrid||i,{store:a,focusedCell:l}=o,{parent:d}=e,c=a===i.store,u=null==l?void 0:l.record,h=(null==u||null===(n=u.proxyMeta)||void 0===n?void 0:n.originalRecord)||u;let{records:g,insertBefore:m}=e;if(!s&&e.valid&&(e.valid=!g.some((e=>!a.includes(e)))),e.valid){const n=r.preserveSorters&&a.isSorted&&a.sorterFn;let s;if(t&&(g=g.map((e=>e.copy()))),n&&g.sort(n),!c&&r.allowCrossGridDrag.transferData)await r.allowCrossGridDrag.transferData({sourceGrid:i,targetGrid:o,records:g,insertBefore:m,parent:d}),o.focusCell({grid:o,record:g[0]});else if(a.isTree){var p,f;if(g=g.filter((e=>!e.parent||e.bubbleWhile((e=>!g.includes(e)),!0))),o.isTreeGrouped)d!==u.parent?d.bubble((e=>{g.forEach((t=>{t[e.field]=e.key}))})):e.valid=!1;else s=await d.tryInsertChild(g,r.over?null===(f=d.children)||void 0===f?void 0:f[0]:m);o.rowManager.forEach((e=>e.removeCls(r.dropOverTargetCls))),!d.isExpanded(a)&&null!==(p=d.children)&&void 0!==p&&p.length&&o.expand(d),e.valid=!1!==s}else if(a.isGrouped&&r.over)t?a.insert(a.indexOf(m),g):a.move(g,a.getNext(m));else{if(g.length>1)for(;m&&g.includes(m);)m=a.getNext(m,!1,!0);c?t?a.insert(a.indexOf(m),g):a.move(g,m):(t||i.store.remove(g),a.insert(m?a.indexOf(m):a.count,g))}(null==l?void 0:l._rowIndex)>=0&&o===i&&(o._focusedCell=null,o.focusCell({grid:i,record:h,columnId:l.columnId}));let v=!0;if(e.valid&&n){const e=g[0],t=g[g.length-1],r=e.previousSibling,i=t.nextSibling;(!r||n(r,e)<=0)&&(!i||n(t,i)<=0)&&(v=!1)}e.valid&&v&&a.clearSorters()}e.finalize(e.valid),o.element.classList.remove("b-row-reordering")}onReset(){const e=this,{targetGrid:t,grid:n}=e,r=n.features.cellEdit;n.element.classList.remove("b-row-reordering"),r&&(r.disabled=e.cellEditDisabledState),Yn.removeClsGlobally(n.element,...e.dropOverTargetCls),n.scrollManager.stopMonitoring(),t&&n!==t&&(t.element.classList.remove("b-row-reordering"),t.scrollManager.stopMonitoring(),Yn.removeClsGlobally(t.element,...e.dropOverTargetCls))}onInternalPaint({firstPaint:e}){!this._initialized&&this.grid.regions.length>0&&(this._initialized=!0,this.init())}updateShowGrip(e){this.enabled&&this.grid.columns.visibleColumns[0].refreshCells()}updateDisabled(e,t){super.updateDisabled(e,t),this.dragHelper&&(this.dragHelper.disabled=e),this.showGrip&&this.grid.columns.visibleColumns[0].refreshCells()}updateTargetGrid(e,t){t&&(t.element.classList.remove("b-row-reordering"),t.scrollManager.stopMonitoring()),this.dragHelper.isDragging&&(this.dragHelper.context.targetGrid=e),e?(e.element.classList.add("b-row-reordering"),e.bodyContainer.appendChild(this.dropIndicator),e.scrollManager.startMonitoring({scrollables:[{element:e.scrollable.element,direction:"vertical"}]})):this.dropIndicator.remove()}get isDragging(){return this.dragHelper.isDragging}}Uy.featureClass="",Uy._$name="RowReorder",Jv.registerFeature(Uy,!1);class Gy extends Mr{static $name="RowResize";static configurable={applyToAllRows:null,cellSelector:".b-grid-cell",minHeight:20,maxHeight:0};construct(e,t){const n=this;super.construct(...arguments),n.resizer=new dh({name:"rowResize",targetSelector:".b-grid-row:not(.b-group-header)",handleContainerSelector:".b-grid-row",outerElement:e.element,direction:"vertical",dragThreshold:1,handleSize:Math.min(5,.1*e.rowHeight),internalListeners:{beforeresizestart:n.onBeforeResizeStart,resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,cancel:n.onCancel,thisObj:n},allowResize(t,r){var i;return null===(i=e.hoveredCell)||void 0===i?void 0:i.matches(n.cellSelector)},overTopHandle(e,t){if(this.canResize(t,e)&&"0"!==t.dataset.index){const n=Ot.from(t);return n.height=this.handleSize,n.height>0&&Math.abs(n.top-Jt.getPagePoint(e).top)<this.handleSize}return!1},internalBeforeStart(e){const{edge:t,element:n}=e;if("top"===t)return{edge:"bottom",element:n.previousElementSibling}},onResizeHandlePointerDown(t){e.selectionDisabled=!0,e.features.rowReorder&&(n._oldReorderDisabled=e.features.rowReorder.dragHelper.disabled,e.features.rowReorder.dragHelper.disabled=!0),e.setTimeout((()=>{e.selectionDisabled=!1}),10)}})}doDestroy(){var e;null===(e=this.resizer)||void 0===e||e.destroy(),super.doDestroy()}onBeforeResizeStart(){return!this.disabled}onResizeStart({source:e,context:t}){const{client:n}=this,r=this.applyToAllRows||n.fixedRowHeight;t.record=n.store.getById(t.element.dataset.id),t.oldHeight=t.record.rowHeight,n.store.suspendAutoCommit(),Object.assign(e,{minHeight:this.minHeight,maxHeight:this.maxHeight,skipUpdatingElement:!r}),n.element.classList.add("b-row-resizing")}onResizing({context:e}){this.applyToAllRows||this.client.fixedRowHeight||!e.valid||(e.record.rowHeight=e.newHeight)}onResize({context:e}){const{client:t}=this;this.applyToAllRows||t.fixedRowHeight?t.rowHeight=e.newHeight:t.selectionMode.multiSelect&&t.selectedRecords.includes(e.record)&&t.selectedRecords.forEach((t=>t.rowHeight=e.newHeight)),this.cleanup()}onCancel({context:e}){this.applyToAllRows||this.client.fixedRowHeight||(e.record.rowHeight=e.oldHeight),this.cleanup()}cleanup(){const{client:e}=this;e.element.classList.remove("b-row-resizing"),e.store.resumeAutoCommit(),"boolean"==typeof this._oldReorderDisabled&&(e.features.rowReorder.dragHelper.disabled=this._oldReorderDisabled)}isEventOverResizeHandle(e){return this.enabled&&this.resizer.checkResizeHandles(e)}}Gy._$name="RowResize",Jv.registerFeature(Gy,!1);const Yy={goToNextHit:1,goToPrevHit:1};class qy extends(Hi(Mr)){static $name="Search";static configurable={limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}};static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,Yn.NodeFilter.SHOW_TEXT,(()=>Yn.NodeFilter.FILTER_ACCEPT))}),e.ion({expandNode:"onTreeNodeExpand",thisObj:this})}isActionAvailable({actionName:e}){if(Yy[e])return Boolean(this.text)}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0,void 0,void 0,!1])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(e,t=!0,n=!1,r,i=!1,s=this.client.store.isTree){var o;const a=this;if(!e)return a.clear();if(!n&&e===a.text||a.disabled)return;const{grid:l,store:d}=a,c=l.columns.visibleColumns.filter((e=>!1!==e.searchable)),u=[];r=r||c.map((e=>{var t;return u.push(null===(t=e.formatValue)||void 0===t?void 0:t.bind(e)),e.field}));const h=d.search(e,r,u);s&&h.length&&await l.expandTo(h.map((e=>e.id)));for(const e of c)if(e.mergeCells&&e.isSorted){let t=null,n=null;for(const r of h)if(r.field===e.field){const e=r.data[r.field];e===t&&(r.belongsTo=n),t=e,n=`${r.field}-${r.id}`}}let g=1;if(Object.assign(a,{foundMap:{},prevFound:a.found,found:h,text:e,findRe:new RegExp(`(\\s+)?(${N.escapeRegExp(String(e))})(\\s+)?`,"ig")}),a.clearHits(),h){for(const e of h)if(a.foundMap[`${e.field}-${e.id}`]=e.belongsTo?a.foundMap[e.belongsTo]:g++,g>a.limit)break;return a.listenersInitialized||(l.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:a}),d.ion({name:"storeRefresh",[`refresh${l.asyncEventSuffix}`]:"onStoreRefresh",thisObj:a}),a.listenersInitialized=!0),l.refreshRows(),l.trigger("search",{grid:l,find:e,found:h}),!t||a.isHitFocused||i||a.gotoNextHit(!0),null===(o=l.syncSplits)||void 0===o||o.call(l,(i=>i.features.search.search(e,t,n,r,!0))),h}}clearHits(){if(!this.isDestroying)for(const e of Yn.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const t=Vl.get(e).row;t&&(t.forceInnerHTML=!0,t.renderCell(e),t.forceInnerHTML=!1)}}clear(e=!1){const t=this,{grid:n}=t;var r;(t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(t.detachListeners("renderCell"),t.detachListeners("storeRefresh"),t.listenersInitialized=!1),e)||(n.trigger("clearSearch",{grid:n}),null===(r=n.syncSplits)||void 0===r||r.call(n,(e=>e.features.search.clear())))}get foundCount(){var e;return(null===(e=this.found)||void 0===e?void 0:e.length)??0}get isHitFocused(){var e;const t=this,{grid:n}=t,{focusedCell:r}=n;if(null!=r&&null!==(e=r.cell)&&void 0!==e&&e.contains(Yn.getActiveElement(n.element))){const{rowIndex:e,column:n}=r;return-1!==e&&t.found.some((t=>t.index===e&&n&&t.field===n.field))}}gotoNextHit(e=!1){var t;const n=this;if(null===(t=n.found)||void 0===t||!t.length)return;const{grid:r,store:i}=n,s=r.focusedCell||r.lastFocusedCell,o=s&&!0!==e?i.indexOf(s.record,void 0,!0):-1,a=n.found.findIndex((e=>e.index>o));-1!==a&&n.gotoHit(a)}gotoPrevHit(){var e;const t=this,{store:n}=t;if(null===(e=t.found)||void 0===e||!e.length)return;const{grid:r,found:i}=t,s=r.focusedCell||r.lastFocusedCell,o=s?n.indexOf(s.record,void 0,!0):0;for(let e=i.length-1;e--;e>=0){if(i[e].index<o){t.gotoHit(e);break}}}gotoHit(e){const{grid:t}=this,n=this.found[e];return n&&t.focusCell({field:n.field,id:n.id}),Boolean(n)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:n,value:r}){var i;const s=this,{treeWalker:o,findRe:a,hitTextCls:l,showHitIndex:d}=s,c=null===(i=s.foundMap)||void 0===i?void 0:i[t.field+"-"+n.id];if(c){var u;e.classList.add(s.hitCls),d&&(null===(u=e.querySelector(`.${s.hitCellBadgeCls}`))||void 0===u||u.remove());const t=Yn.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(r).toLowerCase()===String(s.text).toLowerCase())t.innerHTML=`<span class="${s.hitTextCls}">${t.innerHTML}</span>${d?`<div class="${s.hitCellBadgeCls}">${c}</div>`:""}`;else{o.currentNode=t;for(let e=o.nextNode();e&&t.contains(e);){const t=e,n=e.nodeValue,r=["<span>"];e=o.nextNode();let i=a.lastIndex;for(let e=a.exec(n);e;e=a.exec(n)){const t=n.substring(i,e.index),s=e[1]?" ":"",o=e[2],d=e[3]?" ":"";r.push(`${N.encodeHtml(t)}${s}<span class="${l}">${N.encodeHtml(o)}</span>${d}`),i=a.lastIndex}r.push(N.encodeHtml(n.substring(i)),"<span>"),t.parentNode.insertBefore(Yn.createElementFromTemplate(r.join(""),{fragment:!0}),t),t.remove()}d&&Yn.createElement({parent:e,className:s.hitCellBadgeCls,text:c})}s.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:n,cellElement:r}){const i=this;e.searchable&&(n.search={text:"L{searchForValue}",localeClass:i,icon:"b-fw-icon b-icon-search",cls:"b-separator",weight:200,disabled:i.disabled,onItem:()=>{let e=globalThis.getSelection().toString();e||(e=r.innerText),i.search(e)}})}onStoreRefresh(){this.search(this.text,!1,!0)}}qy.featureClass="b-search",qy._$name="Search",Jv.registerFeature(qy);const Ky=Object.freeze([]);class Xy extends Mr{static $name="Sort";static configurable={multiSort:!0,prioritizeColumns:!1,showIconOnColumnHover:!0,toggleOnHeaderClick:!0};static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon","b-widget"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),super.construct(e,t),this.bindStore(this.store)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this}),this.client.isPainted&&this.syncHeaderSortState()}set field(e){var t;const n=this.client.columns.get(e);n&&"object"==typeof n.sortable&&(n.sortable.field=n.sortable.property||e,e=n.sortable),null!==(t=this.store.sorters)&&void 0!==t&&t.some((t=>t.field===e))||this.store.sort(e,this.ascending)}get store(){return this.client[this.client.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onInternalPaint","bindStore"]}}syncHeaderSortState(){const e=this,{client:t}=e;if(!t.hideHeaders&&t.isPainted){const r=e.store.sorters??Ky,i=r.length,s=new Vt;let o;for(const a of t.columns.visibleColumns){if(!a.sortable)continue;const t=a.element,l=a.textWrapper,d=null==l?void 0:l.dataset;let c="none";var n;if((null==d?void 0:d.sortIndex)&&delete d.sortIndex,s.value=t.classList,!1===a.sortable)s.remove(e.sortableCls),null==l||null===(n=l.querySelector(".b-sort-icon"))||void 0===n||n.remove();else null!=l&&l.querySelector(".b-sort-icon")||Yn.createElement({tag:"i",parent:l,className:"b-icon b-sort-icon"}),s.add(e.sortableCls),o=r.find((e=>e.field===a.field||e.sortFn&&e.sortFn===a.sortable.sortFn)),o?(i>1&&d&&(d.sortIndex=r.indexOf(o)+1),s.add(e.sortedCls),o.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls),c="ascending"):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls),c="descending")):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)));Yn.syncClassList(t,s),Yn.setAttributes(t,{"aria-sort":c})}}}updateShowIconOnColumnHover(e){this.client.element.classList.toggle("b-sort-hover-icon",Boolean(e))}populateHeaderMenu({column:e,items:t}){var n;const r=this,{store:i}=r,s={...e.sortable,field:e.field,columnOwned:!0},o=null===(n=i.groupers)||void 0===n?void 0:n.find((t=>t.field===e.field));if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:o||r.disabled,onItem:()=>i.sort(s,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:o||r.disabled,onItem:()=>i.sort(s,!1)},r.multiSort&&r.client.columns.records.some((e=>e.sortable)))){const n=i.sorters.find((t=>t.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===t.sortFn));t.multiSort={text:"L{multiSort}",localeClass:r,icon:"b-fw-icon b-icon-sort",weight:320,disabled:o||r.disabled,menu:{addSortAsc:{text:n?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:r,icon:"b-fw-icon b-icon-sort-asc",disabled:n&&(null==n?void 0:n.ascending),weight:330,onItem:()=>i.addSorter(s,!0)},addSortDesc:{text:n?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:r,icon:"b-fw-icon b-icon-sort-desc",disabled:n&&!n.ascending,weight:340,onItem:()=>i.addSorter(s,!1)},removeSorter:{text:"L{removeSorter}",localeClass:r,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!n,onItem:()=>{i.removeSorter(s.field)}}}}}}getColumnDragToolbarItems(e,t){const n=this,{store:r,disabled:i}=n;if(!1!==e.sortable){const s=r.sorters.find((t=>t.field===e.field));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:i||s&&s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:i||s&&!s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:i||!s,onDrop:({column:e})=>r.removeSorter(e.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let r=0;r<e.length;r++){var n;const i=e[r],s=(i.columnOwned||this.prioritizeColumns)&&t.get(i.field);null!=s&&null!==(n=s.sortable)&&void 0!==n&&n.sortFn&&(e[r]={...i,...s.sortable,columnOwned:!0})}}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,i=r.closest(".b-grid-header.b-sortable"),s=null==i?void 0:i.dataset.column;if(!(t.ignoreRe.test(r.className)||r.closest(".b-grid-headerwidget")||t.disabled||e.handled)&&i&&s&&(t.toggleOnHeaderClick||r.closest(".b-sort-icon"))){const r=t.client.columns.getById(i.dataset.columnId);if(n.isGrouped&&n.groupers.find((e=>e.field===s))&&!e.shiftKey)return;if(r.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)n.removeSorter(r.field);else{const i={columnOwned:!0,field:r.field};"object"==typeof r.sortable&&W.assign(i,r.sortable),n.sort(i,null,e.ctrlKey&&t.multiSort)}}}renderHeader(){this.syncHeaderSortState()}onInternalPaint(){this.syncHeaderSortState()}}Xy.featureClass="b-sort",Xy._$name="Sort",Jv.registerFeature(Xy,!0);class Zy extends Mr{static $name="StickyCells";static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,t){super.construct(e,t),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,Yn.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:t,element:n,contentElement:r}=e,i=Ot.client(t.bodyContainer).roundPx(),s=t.rowManager.getRowAt(i.y),o=s!==e.currentTopRow;if(s){o&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),r.innerHTML="",r.appendChild(e.updateStickyContent()));const t=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[t?"add":"remove"]("b-hide-visibility"),e.currentTopRow[t?"addCls":"removeCls"]("b-not-enough-height"),i.y+=e.stickyContentTop,Yn.alignTo(n,e.stickyEls[0],{align:"t0-t0",constrainTo:i},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:t,removeClasses:n}=e,r={"b-grid-sticky-row":1},i={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),o=e.stickyEls||(e.stickyEls=[]);for(o.forEach((e=>{e.classList.remove("b-sticky-content-el")})),o.length=0,t.eachElement((t=>{o.push(...t.querySelectorAll(e.contentSelector))}));s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,o.map((t=>{t.closest(".b-grid-cell").classList.forEach((e=>i[e]=1)),t.closest(".b-grid-row").classList.forEach((e=>r[e]=1)),Object.assign(i,n),Object.assign(r,n);const o=t.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,o),t.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-t.offsetTop+o),t.style.alignSelf="";const a=t.cloneNode(!0);return t.classList.add("b-sticky-content-el"),s.appendChild(a),a})),i["b-focused"]=!1,Yn.syncClassList(e.contentElement,i),Yn.syncClassList(e.element,r),s}}Zy._$name="StickyCells",Jv.registerFeature(Zy,!1);class Jy extends Mr{static $name="Stripe";static get pluginConfig(){return{chain:["beforeRenderRow"]}}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}beforeRenderRow({row:e,record:t}){var n;const{enabled:r}=this,{isGroupHeader:i}=t,s=this.client.store.isGrouped&&t.instanceMeta(this.client.store).groupParent,o=((null==s||null===(n=s.groupChildren)||void 0===n?void 0:n.indexOf(t))??e.dataIndex)%2==0;e.assignCls({"b-even":r&&!i&&o,"b-odd":r&&!i&&!o})}}Jy._$name="Stripe",Jv.registerFeature(Jy);class Qy extends(Ry(Mr)){static get configurable(){return{selectedOnly:null,refreshOnlyAffectedSummaries:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static $name="Summary";construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this}),this.isConfiguring||this.refreshSummaries()}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:t}=this;e?t.element.classList.add("b-summary-disabled"):(this.refreshSummaries(),t.element.classList.remove("b-summary-disabled"),t.eachSubGrid((e=>e.scrollable.syncPartners())))}renderRows(){this.refreshSummaries()}refreshSummaries(e){const t=this,{grid:n,store:r}=t,i=e?null:Yn.children(n.element,".b-grid-footer"),s=t.selectedOnly&&n.selectedRecords.length>0,o=(r.isFiltered?r.storage.values:r.allRecords).filter((e=>!e.isSpecialRow&&(!s||n.isSelected(e))));(e?e.map((e=>n.columns.get(e))):n.columns.visibleColumns).forEach(((r,s)=>{var a;null===(a=r.summaries)||void 0===a||a.forEach((e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}));const l=e?n.element.querySelector(`.b-grid-footer[data-column-id=${r.id}]`):i[s];if(null==l||!l.dataset.column)return;const d=t.generateHtml(r,o,"b-grid-footer-summary");(r.summaries?r.summaries.length:!!r.sum)&&(l.children.length?Yn.sync(d,l.firstElementChild):l.innerHTML=d)}))}onStoreChange({action:e,changes:t}){let n=!0;this.disabled||("update"===e&&(n=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))),n&&this.refreshSummaries("update"===e&&this.refreshOnlyAffectedSummaries?Object.keys(t):void 0))}updateSelectedOnly(e){const t=this;t.detachListeners("selectionChange"),e&&t.grid.ion({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}refresh(){this.refreshSummaries()}}Qy.featureClass="b-summary",Qy._$name="Summary",Jv.registerFeature(Qy);const eb=Promise.resolve();class tb extends(Mr.mixin(Hi)){static $name="Tree";static configurable={expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"},treeLines:!1};static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementClick","bindStore","beforeRenderRow"]}}construct(e,t){var n;super.construct(e,t),!this.treeColumn&&(null===(n=e.initialConfig.columns)||void 0===n?void 0:n.length)>0&&console.info("To use the tree feature, one column should be configured with `type: 'tree'`"),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:t}=e.client;return e._treeColumn&&t.includes(e._treeColumn)||(e._treeColumn=t.find((e=>e.isTreeColumn))),e._treeColumn}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",beforeLazyLoad:"onBeforeLoadChildren",afterLazyLoad:"onLoadChildren",thisObj:this})}async toggleCollapse(e,t){if(null==e)throw new Error("Tree#toggleCollapse must be passed a record");const n=this,{store:r,client:i}=n,{rowManager:s}=i,o=r.getById(e),a=o.instanceMeta(r);let l=s.getRowFor(o);if(o.generation++,await r.toggleCollapse(o,t)){if(n.isDestroyed)return;l=s.getRowFor(o),l&&o.ancestorsExpanded()&&l.render(null,null,!1),n.isTogglingNode||(i.element.classList.add("b-toggling-node"),n.isTogglingNode=!0,n.requestAnimationFrame((()=>{i.element.classList.remove("b-toggling-node"),n.isTogglingNode=!1}))),i.trigger(a.collapsed?"collapseNode":"expandNode",{record:o}),i.trigger("toggleNode",{record:o,collapse:a.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.client.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t,parent:n=e.getById(t[e.modelClass.idField])}){var r;null===(r=this.client.rowManager.getRowFor(n))||void 0===r||r.addCls("b-loading-children")}onLoadChildren({source:e,params:t,parent:n=e.getById(t[e.modelClass.idField])}){var r;null===(r=this.client.rowManager.getRowFor(n))||void 0===r||r.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.client.rowManager.getRowFor(e);null==t||t.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,t=this.store.rootNode){const{client:n,store:r}=this,{animateTreeNodeToggle:i}=n,s=[],o=[];return n.trigger("beforeToggleAllNodes",{collapse:e}),n.animateTreeNodeToggle=!1,r.suspendEvents(),r.traverse((t=>{const n=t.instanceMeta(r);t.isLeaf||(e&&!n.collapsed?(this.toggleCollapse(t,!0),o.push(...t.children)):!e&&n.collapsed&&(Array.isArray(t.children)&&o.push(...t.children),s.push(this.toggleCollapse(t,!1))))}),t,t===r.rootNode),r.resumeEvents(),(e?eb:Promise.all(s)).then((()=>{o.length&&(e?r.trigger("remove",{records:o,isCollapse:!0,isCollapseAll:!0}):r.trigger("add",{records:o,isExpand:!0,isExpandAll:!0})),n.refreshRows(null,e),n.trigger("toggleAllNodes",{collapse:e}),n.animateTreeNodeToggle=i}))}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e,t=!0){const n=this,{store:r,client:i}=n,{animateTreeNodeToggle:s}=i;if(Array.isArray(e)){if(e.length>0){i.suspendRefresh();for(let t=e.length-1;t>=0;t--){var o;const s=r.getById(e[t]);var a;if(0===t)null===(a=i.resumeRefresh)||void 0===a||a.call(i,!1),i.rowManager.refresh();await(null===(o=n.expandTo)||void 0===o?void 0:o.call(n,s,0===t))}}return}const l=r.getById(e);if(!1!==l.instanceMeta(n.store).hiddenByCollapse){if(i.animateTreeNodeToggle=!1,!l.ancestorsExpanded()){var d,c;const e=[];for(let t=l.parent;t&&!t.isRoot;t=t.parent)t.isExpanded(r)||e.unshift(t);i.suspendRefresh();for(const t of e)n.isDestroyed||await n.toggleCollapse(t,!1);null===(d=i.resumeRefresh)||void 0===d||d.call(i,!1),null===(c=i.refreshRows)||void 0===c||c.call(i)}i.animateTreeNodeToggle=s,!n.isDestroyed&&t&&await i.scrollRowIntoView(l)}}async expandToLevel(e,t=!1){const{store:n,client:r}=this,{animateTreeNodeToggle:i}=r,s=t=>{t.children.forEach((t=>{t.isLeaf||(t.instanceMeta(n).collapsed&&this.toggleCollapse(t,!1),t.childLevel<e&&s(t))}))};n.suspendEvents(),r.suspendRefresh(),t&&await this.collapseAll(),r.isDestroyed||(r.animateTreeNodeToggle=!1,s(n.rootNode),n.resumeEvents(),r.resumeRefresh(!0),r.animateTreeNodeToggle=i)}onElementClick(e){const t=this,n=e.target,r=t.client.getCellDataFromEvent(e),i=n.closest(".b-tree-expander");i&&e.preventDefault(),(i||t.expandOnCellClick&&null!=r&&r.record.isParent)&&t.toggleCollapse(r.record)}toggleCollapseByKey(){var e;const{focusedCell:t}=this.client;return!(!((null==t?void 0:t.rowIndex)>-1)||null!==(e=this.client.features.cellEdit)&&void 0!==e&&e.isEditing||!t.record.isParent||!document.activeElement.closest(".b-grid-cell"))&&(this.toggleCollapse(t.id),!0)}beforeRenderRow({record:e,cls:t}){if(e.isLeaf)t["b-tree-parent-row"]=0,t["b-tree-collapsed"]=0,t["b-tree-expanded"]=0,t["b-loading-children"]=0;else{const{store:n}=this.client,r=!e.isExpanded(n);t["b-tree-parent-row"]=1,t["b-tree-collapsed"]=r,t["b-tree-expanded"]=!r,t["b-loading-children"]=e.instanceMeta(n).isLoadingChildren}}expandIfSingleColumn(){return 1===this.client.columns.count&&this.expandByKey()}expandByKey(){const e=this,{client:t}=e,{focusedCell:n}=t,r=null==n?void 0:n.record;return!!(r&&null!=n&&n.column.tree&&r.isParent&&r.instanceMeta(t.store).collapsed)&&(e.expand(r),!0)}collapseIfSingleColumn(){return 1===this.client.columns.count&&this.collapseByKey()}collapseByKey(){const e=this,{client:t}=e,{focusedCell:n}=t,r=null==n?void 0:n.record;if(null!=n&&n.column.tree&&r){if(r.isParent&&!r.instanceMeta(t.store).collapsed)return e.collapse(r),!0;if(r.parent&&!r.parent.isRoot)return t.deselectAll(),t.focusCell({record:r.parent,column:n.column}),!0}return!1}updateTreeLines(){this.isConfiguring||this.client.refreshRows()}}tb.featureClass="b-tree",tb._$name="Tree",Jv.registerFeature(tb,!1,"Grid"),Jv.registerFeature(tb,!0,"TreeGrid");class nb extends(Ry(Mr)){static $name="TreeGroup";static configurable={levels:[],parentCls:"b-generated-parent",parentRenderer:null,hideGroupedColumns:null,refreshGroupsTimeout:100,expandParents:!0,store:{},originalStore:null};static get pluginConfig(){return{chain:["populateHeaderMenu"],assign:["group","clearGroups","refreshGroups"]}}static properties={isApplying:0};construct(e,t){if(this.treeColumn=e.columns.find((e=>e.isTreeColumn)),super.construct(e,t),this._levels=this._levels||[],!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled");e.rowManager.ion({renderCell:"renderCell",prio:1e3,thisObj:this})}applyPluginConfig(){return this.scheduleRefreshGroups=ee.createBuffered(this.refreshGroups,this.refreshGroupsTimeout,this),super.applyPluginConfig(...arguments)}processParentData(e){const t=this;t.parentCls&&(e.cls=t.parentCls)}processTransformedData(e){}async waitForLoad(){const e=this;if(e.originalStore.isLoading&&(await e.originalStore.await("load",!1),e.isDestroyed))return;const{crudManager:t}=this.client;if(t){var n;if((t.isLoadingOrSyncing||t._autoLoadPromise)&&await t.await("requestDone"),e.isDestroyed)return;await(null===(n=e.client.project)||void 0===n?void 0:n.commitAsync())}}async waitForReadiness(){await this.waitForLoad(),this.scheduleRefreshGroups.isPending&&await this.client.await("treeGroupChange",!1)}updateOriginalStore(e){const t=this;t.store=t.initialConfig.store,t.detachListeners("originalStore"),null==e||e.ion({name:"originalStore",refresh:t.onOriginalStoreRefresh,add:t.onOriginalStoreChanged,update:t.onOriginalStoreUpdate,remove:t.onOriginalStoreChanged,removeAll:t.onOriginalStoreChanged,thisObj:t})}changeStore(e){const{originalStore:t}=this;var n;t&&(e=new t.constructor({reapplyFilterOnAdd:!0,reapplyFilterOnUpdate:!0,tree:!0,modelClass:t.modelClass,load:null===(n=t.load)||void 0===n?void 0:n.bind(t),commit:t.commit.bind(t),remove:(n,r)=>{n=nt.asArray(n);const i=[],s=[];if(e.isApplyingLevels)s.push(...n);else for(const e of n)e.isLinked?i.push(e.$original):s.push(e);s.length&&t.remove.call(e,s,r),i.length&&t.remove(i,r)},removeAll:t.removeAll.bind(t)},e));return e}async applyLevels(e){const t=this,{client:n,treeColumn:r,expandParents:i}=t;let s,{store:o}=n,a=null;const{modelClass:l}=o;if(null!=r&&r.field&&l.getFieldDefinition(r.field)&&(s=l.getFieldDataSource(r.field)),!(0===(e=e||[]).length&&t.isConfiguring||(t._levels=e,t.isApplying++,t.originalStore||(t.originalStore=o,n.suspendRefresh(),n.store=o=t.store,n.resumeRefresh(!1)),await t.waitForLoad(),t.isDestroyed))){if(n.suspendRefresh(),e.length>0){const r=new Map;for(const e of o.getAllDataRecords(!1))e.isLeaf&&e.isLinked&&r.set(e.$original,e);const l=t.originalStore.getAllDataRecords(!1).flatMap((e=>e.isLeaf?r.has(e)?r.get(e):e.link():[]));for(const e of l){const t=e.instanceMeta(o.id);t.collapsed=!1,t.hidden=!1}a=o.treeifyData(l,e,(e=>{s&&W.setPath(e,s,e.key);const n=o.getById(e.id);!i||n&&o.syncDataOnLoad||(e.expanded=!0),t.processParentData(e)}),!1,((e,t)=>{const r=t&&n.columns.get(t);return null!=r&&r.formatValue?e=r.formatValue(e):null!=r&&r.isCheckColumn&&(e=Boolean(e)),e})),t.processTransformedData(a),await t.trigger("beforeDataLoad",{store:o,data:a.children}),o.isApplyingLevels=!0,o.data=a.children,o.isApplyingLevels=!1}else n.store=t.originalStore,t.detachListeners("originalStore"),t.originalStore=null;t.isApplying--,n.element.classList.toggle("b-grid-treegrouped",e.length>0),n.resumeRefresh(!1),t.refresh(),n.trigger("treeGroupChange",{levels:e})}}refresh(){this.client.isPainted&&this.client.renderRows(!1)}doDisable(e){e&&this.clearGroups(),super.doDisable(e)}onOriginalStoreUpdate({records:e,changes:t}){this.levels.some((e=>(e.fieldName||e)in t))?this.scheduleRefreshGroups():Object.keys(t).forEach((e=>{const t=this.client.columns.get(e);null!=t&&t.isVisible&&t.hasSummary&&t.refreshCells()}))}onOriginalStoreChanged(){this.scheduleRefreshGroups()}onOriginalStoreRefresh({action:e}){"dataset"!==e&&"filter"!==e||this.scheduleRefreshGroups()}updateLevels(e,t){const n=this,{client:r}=n;n.hideGroupedColumns&&(null==t||t.forEach((t=>{t=t.fieldName||t,e.some((e=>(e.fieldName||e)===t))||r.columns.get(t).show()})),null==e||e.forEach((e=>{e=e.fieldName||e,t&&t.some((t=>t.fieldName===e))||(r._suspendRenderContentsOnColumnsChanged=!0,r.columns.get(e).hide(),r._suspendRenderContentsOnColumnsChanged=!1)}))),!e&&n.isConfiguring||(n.updatePromise=n.applyLevels(e),r.renderContents())}get groupFields(){return this.levels.map((e=>e.fieldName||e))}async group(e){W.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&(this.levels=[],await this.updatePromise)}refreshGroups(){var e;return null===(e=this.applyLevels)||void 0===e?void 0:e.call(this,this._levels)}get isGrouped(){return!this.disabled&&this._levels.length>0}populateHeaderMenu({column:e,items:t}){const n=this;let r=!1;!1!==e.groupable&&!e.isTreeColumn&&!n.isGroupedByField(e.field)&&(t.groupAsc={text:"L{group}",localeClass:n,icon:"b-fw-icon b-icon-group-asc",separator:!0,weight:400,disabled:n.disabled,onItem:()=>n.addGrouper(e)},r=!0),n.isGrouped&&(n.isGroupedByField(e.field)&&(t.groupRemove={text:"L{stopGroupingThisColumn}",localeClass:n,icon:"b-fw-icon b-icon-clear",separator:!r,weight:420,disabled:n.disabled,onItem:()=>n.removeGrouper(e)},r=!0),t.groupRemoveAll={text:"L{stopGrouping}",localeClass:n,icon:"b-fw-icon b-icon-clear",separator:!r,weight:420,disabled:n.disabled,onItem:()=>n.clearGroups()})}addGrouper(e){this.levels=this.levels.concat(e.field)}isGroupedByField(e){return this.levels.find((t=>t.fieldName===e))}removeGrouper(e){this.levels.splice(this.levels.findIndex((t=>t.fieldName===e.field)),1),this.levels=this.levels.slice()}renderCell({column:e,cellElement:t,row:n,record:r,size:i,isFirstColumn:s}){if(this.isGrouped&&!this.disabled&&r.generatedParent&&e.hasSummary){const n=this.generateHtml(e,r.allChildren,"b-grid-treegroup-summary");t.children.length?Yn.sync(n,t.firstElementChild):t.innerHTML=n}}}nb._$name="TreeGroup",Jv.registerFeature(nb);const rb={all:"all",visible:"visible"},ib={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69,portraitWidth:8.3,portraitHeight:11.7,landscapeWidth:11.7,landscapeHeight:8.26},A3:{width:11.69,height:16.49,portraitWidth:11.7,portraitHeight:16.49,landscapeWidth:16.54,landscapeHeight:11.68},A2:{width:16.54,height:23.39,portraitWidth:16.54,portraitHeight:23.39,landscapeWidth:23.39,landscapeHeight:16.51},A1:{width:23.39,height:33.11,portraitWidth:23.39,portraitHeight:33.08,landscapeWidth:33.11,landscapeHeight:23.39},Legal:{width:8.5,height:14,portraitWidth:8.5,portraitHeight:14,landscapeWidth:14,landscapeHeight:8.15},Letter:{width:8.5,height:11,portraitWidth:8.5,portraitHeight:10.95,landscapeWidth:11,landscapeHeight:8.3}};function sb(){return c.isFirefox?{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.26}:c.isSafari?{portraitWidth:0,portraitHeight:.1,landscapeWidth:0,landscapeHeight:.5}:{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.25}}const ob={portrait:"portrait",landscape:"landscape"},ab={pdf:"pdf",png:"png"},lb={pdf:"application/pdf",png:"image/png"},db=["a5","a4","a3","b5","b4","jis-b5","jis-b4","letter","legal","ledger"],cb=e=>db.includes(e.toLowerCase());class ub extends Dm{static $name="ExportRowsCombo";static type="exportrowscombo";static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:rb.all,text:this.L("L{all}")},{id:rb.visible,text:this.L("L{visible}")}]}}ub.initClass(),ub._$name="ExportRowsCombo";class hb extends Dm{static $name="ExportOrientationCombo";static type="exportorientationcombo";static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:ob.portrait,text:this.L("L{portrait}")},{id:ob.landscape,text:this.L("L{landscape}")}]}}function gb(e,t=(e=>e)){return Object.keys(e).map((e=>({id:e,text:t(e)})))}hb.initClass(),hb._$name="ExportOrientationCombo";class mb extends eh{static $name="ExportDialog";static type="exportdialog";static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,useBrowserPrint:!1,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",name:"columns",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",name:"rowsRange",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",name:"exporterType",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map((t=>({id:t.type,text:e.optionalL(t.title,this)})))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden=e.match(/singlepage/)||e.match(/^vertical/),this.owner.widgetMap.repeatHeaderField.hidden=!e.match(/multipagevertical/)},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",name:"alignRows",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",name:"repeatHeader",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",name:"fileFormat",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:t}){const n=this.parent;if(n.hidePNGMultipageOption){const r=n.widgetMap.exporterTypeField,i=r.store.find((e=>"singlepage"===e.id));e===ab.png&&i?(this._previousDisabled=r.disabled,r.disabled=!0,this._previousValue=r.value,r.value="singlepage"):t===ab.png&&this._previousValue&&(r.disabled=this._previousDisabled,r.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",name:"paperFormat",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",name:"orientation",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}},internalListeners:{beforeShow:"onInternalBeforeShow"}}}construct(e={}){const t=this,{client:n}=e;if(!n)throw new Error("`client` config is required");t.columnsStore=n.columns.chain((e=>e.isLeaf&&e.exportable),null,{excludeCollapsedRecords:!1}),t.applyInitialValues(e),super.construct(e),Cr.ion({locale:"onLocaleChange",prio:-1,thisObj:t})}updateUseBrowserPrint(e){const t=this;t.whenVisible((()=>{const{exportButton:n,fileFormatField:r}=t.widgetMap,i=n.initialConfig.text,s=!("title"in t.initialConfig);(!i||"L{ExportDialog.export}"===i&&e)&&(n.text=e?t.L("L{ExportDialog.print}"):t.L("L{ExportDialog.export}")),s&&(t.title=e?t.L("L{printSettings}"):t.L("L{exportSettings}")),r.hidden=e||Boolean(r.initialConfig.hidden)}))}applyInitialValues(e){const t=this,n=e.items=e.items||{};e.width=e.width||t.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||t.L("L{ExportDialog.labelWidth}"),n.columnsField=n.columnsField||{},n.fileFormatField=n.fileFormatField||{},n.paperFormatField=n.paperFormatField||{},n.fileFormatField.items=gb(ab,(e=>e.toUpperCase())),n.paperFormatField.items=gb(ib),n.columnsField.store=t.columnsStore}onInternalBeforeShow(){const{columnsField:e,alignRowsField:t,exporterTypeField:n,repeatHeaderField:r}=this.widgetMap;this.autoSelectVisibleColumns&&(e.value=this.columnsStore.query((e=>!e.hidden)));const i=n.value;t.hidden=i.match(/singlepage/)||i.match(/^vertical/),r.hidden=!i.match("multipagevertical")}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((t=>{t instanceof cm&&(t.labelWidth=e)}))}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}}mb.initClass(),mb._$name="ExportDialog";class pb extends(Hi(lt(Tr(Qe)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}static inchToPx(e){return 96*e}pageTpl(e){const{title:t,header:n,footer:r,styles:i,htmlClasses:s,bodyClasses:o=[],paperHeight:a,paperWidth:l,html:d,currentPage:u}=e;let{htmlStyle:h="",bodyStyle:g=""}=e;return o.push(`b-${this.constructor.type}`),Yn.scrollBarWidth?o.push("b-visible-scrollbar"):o.push("b-overlay-scrollbar"),c.isChrome?o.push("b-chrome"):c.isSafari?o.push("b-safari"):c.isFirefox&&o.push("b-firefox"),g=`${g}; width: ${l}in; height: ${a}in;`,hh.tpl`
            <!DOCTYPE html>
            <html class="${s} b-print-root" style="${h}">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${i.join("")}
                </head>
                <body class="b-export b-print ${o.join(" ")}" style="${g}">
                <div class="b-page-wrap">
                    <div class="b-export-content b-page-${u}">
                        ${n&&`<div class="b-export-header" style="width: 100%">${n}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${d}</div></div>
                        ${r&&`<div class="b-export-footer" style="width: 100%">${r}</div>`}
                    </div>
                </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,n=globalThis.origin,r=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),i=[];return r.forEach((r=>{if(r=r.cloneNode(!0),t&&r.href){let e;e=!0===t?r.href:this.keepPathName?r.href.replace(n,t):new URL(r.getAttribute("href"),t),r.setAttribute("href",e)}let s=r.outerHTML;if(t&&/style/i.test(r.tagName)){const n=e.getStyleTagURLConverter(t);s=s.replace(/url\(['"]?(.+?)['"]?\)/g,n)}i.push(s)})),e._stylesheets=e.filterStyles(i)}set stylesheets(e){this._stylesheets=e?this.filterStyles(e):e}getStyleTagURLConverter(e){return function(t,n){let r;try{let i;/^#/.test(n)?r=t:(i=!0===e?globalThis.location.href:this.keepPathName?globalThis.location.href.replace(globalThis.location.origin,e):e,r=`url('${new URL(n,i).href}')`)}catch(e){r=t}return r}.bind(this)}saveState({client:e}){const{disableGridColumnIdWarning:t}=e;e.disableGridColumnIdWarning=!0,this.state=e.state,e.disableGridColumnIdWarning=t}async restoreState({client:e}){const t=[],n=new Set;n.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid((({header:e,scrollable:r})=>{n.add(r.ion({scroll(){t.push(r.await("scrollEnd"))}})),n.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}}))})),e.state=this.state,await Promise.all(t),n.forEach((e=>e()))}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0));const r=t.querySelector(".b-gridbase > .b-mask");null==r||r.remove()}createPlaceholder(e,t=!0,n={}){return t&&(e.innerHTML=""),Yn.createElement(Object.assign({parent:e,id:eo.generateId("export")},n))}prepareElement({client:e}){const{tbar:t,bbar:n}=e;t&&this.element.querySelector(`#${t.id}`).remove(),n&&this.element.querySelector(`#${n.id}`).remove()}measureElement(e="",t=""){e instanceof HTMLElement&&(e=e.outerHTML);const n=Yn.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},className:t,html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),r=n.offsetHeight-2;return n.remove(),r}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=Yn.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),n=t.querySelectorAll("img");for(let e=0,t=n.length;e<t;e++)n[e].setAttribute("src",n[e].src);const r=t.innerHTML;return t.remove(),r}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid((e=>{e.overflowingHorizontally&&(t=Yn.scrollBarWidth)})),0===t?t:t+1}getPaperWidth(e,t){if("portraitWidth"in e){const n=t?"portraitWidth":"landscapeWidth";return e[n]-(this.exportMeta.isPrinting?sb()[n]:0)}return t?e.width:e.height}getPaperHeight(e,t){if("portraitHeight"in e){const n=t?"portraitHeight":"landscapeHeight";return e[n]-(this.exportMeta.isPrinting?sb()[n]:0)}return t?e.height:e.width}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}async export(e){const t=this;let n;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{n=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await dt.animationFrame(),await t.restoreState(e)}return n}async getPages(e){const t=this.pagesExtractor(e),n=[];let r;for(;(r=await t.next())&&!r.done;)n.push(r.value);return n}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach((({width:t,id:n,headerId:r,footerId:i})=>{[n,r,i].forEach((n=>{if(n){const r=e.querySelector(`[id="${n}"]`);r&&(r.style.width=`${t}px`,r.style.flex="")}}))})),e.innerHTML}async prepareComponent(e){const t=this,{client:n,columns:r,keepRegionSizes:i,useRenderedColumnWidth:s}=e,{rowManager:o}=n,a=t.exportMeta={totalWidth:0,totalHeight:0,subGrids:{},isPrinting:e.useBrowserPrint,title:e.title||n.description},l=ib[e.paperFormat],d=e.orientation===ob.portrait,c=t.getPaperWidth(l,d),u=t.getPaperHeight(l,d),h=t.inchToPx(c),g=t.inchToPx(u);Object.assign(a,{paperWidth:c,paperHeight:u,realPaperWidth:t.getPaperWidth(l,d),realPaperHeight:t.getPaperHeight(l,d),pageWidth:h,pageHeight:g}),n.columns.forEach((e=>{r.includes(e.id)?e.show():e.hide()})),await dt.animationFrame();const{element:m}=t;t.cloneElement(n.element),t.prepareElement(e),n.eachSubGrid((e=>{var r,l,d;const c=t.createPlaceholder(m.querySelector(`[id="${e.id}"]`),!1);let u;if(null!=i&&i[e.region])u=e.element.offsetWidth;else{const{visibleColumns:r}=e.columns;u=1!==r.length||r[0].isTimeAxisColumn||0!==t.state.columns.filter((t=>t.region===e.region&&!t.hidden&&t.id!==r[0].id)).length?e.columns.visibleColumns.reduce(((e,t)=>(s||"number"!=typeof t.width?e+=(n.hideHeaders?o.rows[0].getCell(t.id):t.element).offsetWidth:e+=t.width,e)),0):e.element.offsetWidth}a.totalWidth+=u;const h=(null===(r=e.splitterElement)||void 0===r?void 0:r.offsetWidth)||0;a.totalWidth+=h,a.subGrids[e.region]={id:e.id,headerId:(null===(l=e.header)||void 0===l?void 0:l.id)||null,footerId:(null===(d=e.footer)||void 0===d?void 0:d.id)||null,rows:[],splitterWidth:h,placeHolder:c,width:u}}))}async restoreComponent(e){}collectRow(e){const t=this.exportMeta.subGrids,n=/data-owner-cmp=".+?"/,r=e.grid.features.rowExpander;Object.entries(e.elements).forEach((([e,i])=>{i.classList.remove("b-export-row");let{outerHTML:s}=i;if(r){const e=i.querySelector(`.${r.shadowRootContainerClass}`);if(e){const t=[];e._shadowRoot.childNodes.forEach((e=>{"LINK"!==e.tagName&&"STYLE"!==e.tagName&&t.push(e.outerHTML)})),s=s.replace(e.outerHTML,e.outerHTML.replace(/></,`>${t.join("")}<`))}}t[e].rows.push(s.replace(n,"")),i.classList.add("b-export-row")}))}}pb.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},pb._$name="ExporterBase";class fb extends pb{cloneElement(e,t=this.element,n=!0){super.cloneElement(e,t,n),Yn.removeEachSelector(t,".b-grid-row,.b-grid-merged-cells-container")}getVisibleRowsCount(e){const t=e.rowManager,n=t.rows.indexOf(t.firstVisibleRow),r=t.rows.indexOf(t.lastVisibleRow);let i;return i=-1!==n?-1===r?e.store.count-n:r-n+1:e.store.count,i}async prepareComponent(e){const{client:t}=e,{rowManager:n}=t;await super.prepareComponent(e);const r=this.exportMeta.fakeRow=n.rowClass.new({cls:{[t.rowCls]:1,"b-export-row":1},rowManager:n,grid:t,index:-10,dataIndex:-10,isFakeRow:!0});this.exportMeta.rowsMap=new Map,t.eachSubGrid((e=>{e.onAddRow({rows:[r]}),r.element.dataset.ownerCmp=t.id}))}async restoreComponent(e){await super.restoreComponent(e),this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}renderMergedCells(e,t,n,r){const{client:i}=e,{subGrids:s}=this.exportMeta,o=i.features.mergeCells.buildMergedCellsConfig(t,n,r);for(const e in s){const t=s[e],n=document.createElement("div");ud.sync({targetElement:n,domConfig:{children:o[e].children}}),n.childNodes.length&&(n.childNodes.forEach((e=>{const{syncId:t}=e.dataset,n=i.features.mergeCells.mergedRanges.find((e=>{var n;return(null===(n=e.cellElement)||void 0===n?void 0:n.parentNode.dataset.syncId)===t}));n&&(e.innerHTML=n.cellElement.outerHTML)})),t.mergedCellsHtml=[n.innerHTML])}}}fb._$name="Exporter";class vb extends fb{static $name="MultiPageExporter";static type="multipage";static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:t}){const{exportMeta:n}=this;++n.currentPage,++n.verticalPosition,n.lastRowIndex>=n.finishRowIndex?(n.verticalPages=n.verticalPosition,n.totalPages=n.verticalPages*n.horizontalPages):n.verticalPages=Math.max(n.verticalPages,n.verticalPosition+1),n.verticalPosition>=n.verticalPages&&n.horizontalPosition<n.horizontalPages-1&&Object.assign(n,{verticalPosition:0,horizontalPosition:n.horizontalPosition+1,lastTop:0,lastRowIndex:t===rb.visible?e.rowManager.firstVisibleRow.dataIndex:0,lastRowExported:!1})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a}=e,l=ib[e.paperFormat],d=e.orientation===ob.portrait,c=t.getPaperWidth(l,d),u=t.getPaperHeight(l,d),h=t.inchToPx(c),g=t.inchToPx(u),m=a===rb.visible,p=Math.ceil(n.totalWidth/h);let f=g;i&&(f-=t.measureElement(i({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1}),"b-export-header")),s&&(f-=t.measureElement(s({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1}),"b-export-footer"));let v,y,b=r.store.count;if(m?(b=t.getVisibleRowsCount(r),v=n.totalHeight+r.headerHeight+r.footerHeight+r.bodyHeight,n.finishRowIndex=r.rowManager.lastVisibleRow.dataIndex):(v=n.totalHeight+r.headerHeight+r.footerHeight+r.scrollable.scrollHeight,n.finishRowIndex=r.store.count-1),o&&!m){const e=r.rowManager.rowOffsetHeight,t=Math.floor((f-r.headerHeight)/e),n=Math.floor(f/e),i=b-t;y=1+Math.ceil(i/n)}else y=Math.ceil(v/f);Object.assign(n,{paperWidth:c,paperHeight:u,pageWidth:h,pageHeight:g,horizontalPages:p,verticalPages:y,totalHeight:v,contentHeight:f,totalRows:b,totalPages:p*y,currentPage:0,verticalPosition:0,horizontalPosition:0,lastTop:0,lastRowIndex:m?r.rowManager.firstVisibleRow.dataIndex:0,lastRowExported:!1})}async renderRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,repeatHeader:s}=e,{verticalPosition:o,contentHeight:a,lastRowIndex:l,fakeRow:d,rowsMap:c}=n,u=[],h=s?0:r.headerHeight,{store:g}=r,m=r.hasActiveFeature("mergeCells");let p,f=l+(i&&0!==o?1:0),v=0,y=a;for(0===o&&(y-=h);y>0;){const e=g.getAt(f);if(d.render(f,e,!0,!1,!0),i&&y<d.offsetHeight)break;{p=v,v=d.translate(v),n.lastRowIndex=d.dataIndex,y-=d.offsetHeight,t.collectRow(d),f++;const r={top:d.top,bottom:d.bottom,offsetHeight:d.offsetHeight,dataIndex:d.dataIndex};if(u.push(r),c.set(e.id,r),d.dataIndex===n.finishRowIndex&&y>=0){n.lastRowExported=!0;break}}}m&&t.renderMergedCells(e,l,f,u),n.lastTop=i?v:p,n.exactGridHeight=d.bottom+r.footerContainer.offsetHeight+(0===o||s?h:0),await t.onRowsCollected(u,e)}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s}=e,{totalWidth:o,totalPages:a,currentPage:l,subGrids:d}=n;let c,u;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===rb.all&&(n.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-t.getVirtualScrollerHeight(r)),i&&(c=t.prepareHTML(i({totalWidth:o,totalPages:a,currentPage:l}))),s&&(u=t.prepareHTML(s({totalWidth:o,totalPages:a,currentPage:l}))),await t.renderRows(e);return{html:t.buildPageHtml(e),header:c,footer:u}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=n.join("");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),t=t.replace(i,s)})),t}}vb.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,totalPages:s,paperWidth:o,paperHeight:a,realPaperWidth:l,realPaperHeight:d,title:c}=n;let u;for(;!n.lastRowExported;){u=n.currentPage,t.trigger("exportStep",{text:t.L(vb.exportingPageText,{currentPage:u,totalPages:s}),progress:Math.round((u+1)/s*90)});const{html:h,header:g,footer:m}=await t.buildPage(e),p=[...r,`\n                <style>\n                    .b-page-wrap {\n                        width: ${o}in;\n                        height: ${a}in;\n                    }\n                    .b-page-${u} #${e.client.id} {\n                        height: ${n.exactGridHeight}px !important;\n                        width: ${i}px !important;\n                    }\n                    .b-page-${u} .b-export-body .b-export-viewport {\n                        transform: translate(${-o*n.horizontalPosition}in, 0);\n                    }\n                    ${0===n.verticalPosition?"":`.b-page-${u} .b-grid-header-container {\n                        display: none;\n                    }`}\n                </style>\n            `];await t.stateNextPage(e),yield{html:t.pageTpl({html:h,title:c,header:g,footer:m,styles:p,paperWidth:o,paperHeight:a,realPaperWidth:l,realPaperHeight:d,currentPage:u})}}},vb._$name="MultiPageExporter";class yb extends fb{static $name="MultiPageVerticalExporter";static type="multipagevertical";static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage(){const{exportMeta:e}=this,{totalRows:t,processedRows:n,totalPages:r}=e;++e.currentPage,++e.verticalPosition,e.currentPage===r&&n.size!==t&&(++e.totalPages,++e.verticalPages)}calculateScale(){const e=this,{exportMeta:t}=e,{pageWidth:n,totalWidth:r}=t,i=e.getScaleValue(n,r);return e.exportMeta.scale=i,i}estimateTotalPages(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,repeatHeader:l}=e,{pageWidth:d,pageHeight:c,totalWidth:u}=n,h=t.calculateScale(d,u);let g,m=r.store.count,p=m?0-t.getVirtualScrollerHeight(r)+r.height-r.bodyElement.offsetHeight+r.scrollable.scrollHeight:0,f=c/h,v=p;if(i&&(f-=t.measureElement(i({totalWidth:u,totalPages:-1,currentPage:-1}),"b-export-header")),s&&(f-=t.measureElement(s({totalWidth:u,totalPages:-1,currentPage:-1}),"b-export-footer")),l&&(f-=r.headerHeight+r.footerHeight,p-=r.headerHeight+r.footerHeight),a===rb.visible){const e=r.rowManager,i=e.firstVisibleRow,s=e.lastVisibleRow;m=t.getVisibleRowsCount(r),v=s.bottom-i.top,p=r.headerHeight+r.footerHeight+v,n.lastRowIndex=i.dataIndex,n.finishRowIndex=s.dataIndex}else n.finishRowIndex=r.store.count-1;if(o&&!l&&a!==rb.visible){const e=r.rowManager.rowOffsetHeight,t=Math.floor((f-r.headerHeight)/e),n=Math.floor(f/e),i=m-t;g=1+Math.ceil(i/n)}else g=Math.ceil(v/f);Object.assign(n,{scale:h,contentHeight:f,totalRows:m,totalHeight:p,verticalPages:g,initialScroll:0,horizontalPages:1,totalPages:g,lastRowExported:!1})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,r=ib[e.paperFormat],i=e.orientation===ob.portrait,s=t.getPaperWidth(r,i),o=t.getPaperHeight(r,i),a=t.inchToPx(s),l=t.inchToPx(o);Object.assign(n,{paperWidth:s,paperHeight:o,realPaperWidth:t.getPaperWidth(r,i),realPaperHeight:t.getPaperHeight(r,i),pageWidth:a,pageHeight:l,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,lastTop:0,lastRowIndex:-1,processedRows:new Set}),t.estimateTotalPages(e)}async renderRows(e){const t=this,{exportMeta:n}=t,{client:r,alignRows:i,repeatHeader:s}=e,{verticalPosition:o,contentHeight:a,lastRowIndex:l,fakeRow:d,rowsMap:c,nextPageTop:u=0}=n,h=[],g=s||o>0?0:r.headerHeight,{store:m}=r,p=r.hasActiveFeature("mergeCells");let f,v=Math.max(0,l)+(u>0||!i||0===o?0:1),y=a+u,b=-u,C=!1;for(n.nextPageTop=0,0===o&&(C=!0,y-=g);y>0;){const e=m.getAt(v);d.render(v,e,!0,!1,!0);const{offsetHeight:r}=d;if(i&&r<a&&y<r)break;{b=d.translate(b),y-=r,f=d.bottom,f>a&&r>a&&(n.nextPageTop=a-d.top-(C?g:0),y=a-f),n.lastRowIndex=d.dataIndex,t.collectRow(d);const i={top:d.top,bottom:f,dataIndex:d.dataIndex,offsetHeight:r};if(h.push(i),c.set(e.id,i),y>0&&n.processedRows.add(v),v++,d.dataIndex===n.finishRowIndex){if(y>=0){n.lastRowExported=!0;break}n.verticalPages=n.verticalPosition,n.totalPages=n.verticalPages&n.horizontalPages,t.calculateScale()}}}p&&t.renderMergedCells(e,l,v,h),n.exactGridHeight=f+r.footerContainer.offsetHeight+(0===o||s?r.headerHeight:0),await t.onRowsCollected(h,e)}async buildPage(e){const t=this,{exportMeta:n}=t,{headerTpl:r,footerTpl:i}=e,{totalWidth:s,totalPages:o,currentPage:a,subGrids:l}=n;let d,c;Object.values(l).forEach((e=>e.rows=[])),r&&(d=t.prepareHTML(r({totalWidth:s,totalPages:o,currentPage:a}))),i&&(c=t.prepareHTML(i({totalWidth:s,totalPages:o,currentPage:a}))),await t.renderRows(e);return{html:t.buildPageHtml(e),header:d,footer:c}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=n.join("");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),t=t.replace(i,s)})),t}}yb.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,paperWidth:s,paperHeight:o,realPaperWidth:a,realPaperHeight:l,title:d}=n,c=e.lockPaperSize&&cb(e.paperFormat)?`@page { size: ${e.paperFormat} ${e.orientation} }`:"";let u,h,{totalPages:g}=n;for(;!n.lastRowExported;){u=n.currentPage,t.trigger("exportStep",{text:t.L(yb.exportingPageText,{currentPage:u,totalPages:g}),progress:Math.round((u+1)/g*90)});const{html:m,header:p,footer:f}=await t.buildPage(e),{scale:v}=t.exportMeta;h=`\n            ${c}\n            .b-page-wrap {\n                width: ${a}in;\n                height: ${l}in;\n            }\n            .b-print .b-export-content {\n                scale: ${v};\n                transform-origin: top left;\n                height: calc(100% / ${v});\n                width: calc(100% / ${v});\n            }\n        `,h=e.repeatHeader?`\n                ${h}\n                .b-page-${u} #${e.client.id} {\n                    height: ${n.exactGridHeight}px !important;\n                    width: ${i}px !important;\n                }\n                .b-export-body {\n                    height: 100%;\n                    display: flex;\n                }\n                .b-export-viewport {\n                    height: 100%;\n                }\n            `:`\n                ${h}\n                .b-page-${u} #${e.client.id} {\n                    height: ${n.exactGridHeight}px !important;\n                    width: ${i}px !important;\n                }\n                ${0===u?"":`.b-page-${u} .b-grid-header-container {\n                    display: none;\n                }`}\n                .b-export-body {\n                    overflow: hidden;\n                }\n            `;const y=[...r,`<style>${h}</style>`];await t.stateNextPage(),({totalPages:g}=n),yield{html:t.pageTpl({html:m,title:d,header:p,footer:f,styles:y,paperWidth:s,paperHeight:o,realPaperWidth:a,realPaperHeight:l,currentPage:u})}}},yb._$name="MultiPageVerticalExporter";class bb extends fb{static $name="SinglePageExporter";static type="singlepage";static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}async renderRows(e){const t=this,{client:n,rowsRange:r}=e,{rowManager:i,store:s}=n,o=n.hasActiveFeature("mergeCells"),a=r===rb.visible;let{totalHeight:l}=t.exportMeta;if(s.count){const{fakeRow:n,rowsMap:r}=t.exportMeta,{firstVisibleRow:d}=i,c=a?d.dataIndex:0,u=a?i.lastVisibleRow.dataIndex:s.count-1,h=[];let g=0;if(n.cells.length){for(let e=c;e<=u;e++){const i=s.getAt(e);n.render(e,i,!0,!1,!0),g=n.translate(g),t.collectRow(n);const o={top:n.top,bottom:n.bottom,offsetHeight:n.offsetHeight,dataIndex:n.dataIndex};h.push(o),r.set(i.id,o)}await t.onRowsCollected(h,e)}l+=g,o&&t.renderMergedCells(e,c,u,h)}return t.exportMeta.exactGridHeight=l,l}buildPageHtml(e){const{subGrids:t}=this.exportMeta;let n=this.prepareExportElement();return Object.values(t).forEach((({placeHolder:e,rows:t,mergedCellsHtml:r})=>{const i=e.outerHTML;let s=t.join("");null!=r&&r.length&&(s+=`<div class="b-grid-merged-cells-container">${r.join("")}</div>`),n=n.replace(i,s)})),n}}bb.prototype.pagesExtractor=async function*(e){const t=this,{client:n}=e,{totalWidth:r}=t.exportMeta,i=t.stylesheets,s=e.orientation===ob.portrait,o=ib[e.paperFormat],a=t.getPaperWidth(o,s),l=t.getPaperHeight(o,s),d=t.getPaperWidth(o,s),c=t.getPaperHeight(o,s),u=e.lockPaperSize&&cb(e.paperFormat)?`@page { size: ${e.paperFormat} ${e.orientation} }`:"";let h,g,m;h=await t.renderRows(e)+n.headerHeight+n.footerHeight;const p=t.buildPageHtml(e),f=h;if(e.headerTpl){g=t.prepareHTML(e.headerTpl({totalWidth:r}));h+=t.measureElement(g,"b-export-header")}if(e.footerTpl){m=t.prepareHTML(e.footerTpl({totalWidth:r}));h+=t.measureElement(m,"b-export-footer")}const v=Math.min(1,t.getScaleValue(t.inchToPx(a),r)),y=Math.min(1,t.getScaleValue(t.inchToPx(l),h)),b=Math.min(v,y);i.push(`<style>\n            ${u}\n            #${n.id} {\n                height: ${f}px !important;\n                width: ${r}px !important;\n            }\n            .b-page-wrap {\n                width: ${d}in;\n                height: ${c}in;\n            }\n            .b-print .b-export-content {\n                height: 100%;\n            }\n            ${t.centerContentHorizontally?".b-export-viewport > .b-widget { transform: translateX(-50%); left: 50%; }":""}\n            .b-print .b-export-viewport {\n                scale: ${b};\n                transform-origin: top left;\n                height: calc(100% / ${b});\n                width: calc(100% / ${b});\n            }\n        </style>`),yield{html:t.pageTpl({html:p,header:g,footer:m,styles:i,paperWidth:a,paperHeight:l,realPaperHeight:c,realPaperWidth:d,currentPage:0})}},bb._$name="SinglePageExporter";class Cb extends Mr{static $name="PdfExport";static configurable={dialogClass:mb,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[bb,vb,yb],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,useRenderedColumnWidth:!1,useBrowserPrint:!1,lockPaperSize:!1,testConfig:{openAfterExport:!1}};doDestroy(){var e;null===(e=this.exportDialog)||void 0===e||e.destroy(),this.exportersMap.forEach((e=>e.destroy())),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:n}=t,{type:r}=e;let i;if(n.has(r))i=n.get(r),Object.assign(i,e);else{const s=this.exporters.find((e=>e.type===r));if(!s)throw new Error(`Exporter type ${r} is not found. Make sure you've configured it`);delete(e=W.clone(e)).type,i=new s(e),i.relayAll(t),n.set(r,i)}return i}buildExportConfig(e={}){const{client:t,exportServer:n,clientURL:r,fileFormat:i,fileName:s,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:d,keepRegionSizes:c,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:f,filterStyles:v,useRenderedColumnWidth:y,useBrowserPrint:b,lockPaperSize:C}=this;e.columns||(e.columns=t.columns.visibleColumns.filter((e=>e.exportable)).map((e=>e.id)));const w=W.assign({client:t,exportServer:n,clientURL:r,fileFormat:i,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:d,keepRegionSizes:c,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:m,headerTpl:p,footerTpl:f,useRenderedColumnWidth:y,useBrowserPrint:b,lockPaperSize:C,exporterType:this.exporterType,fileName:s||t.$$name},e);return w.columns=e.columns.slice(),"multipagevertical"!==w.exporterType&&"verticalmultipagevertical"!==w.exporterType&&(w.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(w.alignRows=!0),w.exporterConfig=W.assign({type:w.exporterType,translateURLsToAbsolute:w.translateURLsToAbsolute,keepPathName:w.keepPathName,filterStyles:v},w.exporterConfig||{}),delete w.exporterType,delete w.translateURLsToAbsolute,delete w.keepPathName,w}async export(e={}){const t=this,{client:n,pagesPerRequest:r}=t;let i;if(e=t.buildExportConfig(e),!1!==n.trigger("beforePdfExport",{config:e})){n.isExporting=!0,n.mask(t.exportMask);try{const o=t.getExporter(e.exporterConfig);if(0===r){var s;const r=await o.export(e);if(t.isDestroying)return;if(null===(s=t.exportDialog)||void 0===s||s.close(),n.unmask(),t.trigger("exportStep",{progress:90,text:t.exportProgressMask,contentGenerated:!0}),e.useBrowserPrint)await t.doPrint(r,e),i={};else{const n=t.receiveExportContent(r,e);t.toast=t.showLoadingToast(n);const s=await n;i={response:s},await t.processExportContent(s,e)}}}catch(e){throw i=e instanceof Response?{response:e}:{error:e},e}finally{var o;if(t.toast&&!t.toast.isDestroying&&t.toast.hide(),!t.isDestroying)null===(o=t.exportDialog)||void 0===o||o.close(),n.unmask(),t.showErrorToast&&(i.error?"AbortError"!==i.error.name&&Dh.show({html:t.L("L{Export failed}"),rootElement:t.rootElement}):i.response&&!i.response.ok&&Dh.show({html:t.L("L{Server error}"),rootElement:t.rootElement})),n.trigger("pdfExport",i),n.isExporting=!1}}return i}receiveExportContent(e,t){return vr.fetch(t.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary})},this.fetchOptions))}async processExportContent(e,t){const n=this;if(e.ok&&n.openAfterExport){const r=(e=e.clone()).headers.get("content-type");if(r.match(/application\/octet-stream/)){const r=lb[t.fileFormat],i=await n.responseBlobToObjectURL(e,r);n.getDownloadLink(t.fileName,i).click()}else if(r.match(/application\/json/)){const r=await e.json();if(r.success){n.getDownloadLink(t.fileName,r.url).click()}else Dh.show({html:r.msg,rootElement:this.rootElement})}}}doPrint(e){}async responseBlobToObjectURL(e,t){const n=await e.blob();return URL.createObjectURL(n.slice(0,n.size,t))}getDownloadLink(e,t){const n=document.createElement("a");return n.download=e,n.href=t,this.openInNewTab&&(n.target="_blank"),n}get defaultExportDialogConfig(){const e=this;return{client:e.client,exporters:e.exporters,useBrowserPrint:e.useBrowserPrint,items:{rowsRangeField:{value:e.rowsRange},exporterTypeField:{value:e.exporterType},orientationField:{value:e.orientation},paperFormatField:{value:e.paperFormat},repeatHeaderField:{value:e.repeatHeader},fileFormatField:{value:e.fileFormat},alignRowsField:{checked:e.alignRows}}}}changeExportDialog(e,t){const n=this;if(null==t||t.destroy(),e){const t=n.dialogClass.mergeConfigs({rootElement:n.rootElement,client:n.client,modal:{transparent:!0},items:{rowsRangeField:{value:n.rowsRange},exporterTypeField:{value:n.exporterType},orientationField:{value:n.orientation},paperFormatField:{value:n.paperFormat},repeatHeaderField:{value:n.repeatHeader},fileFormatField:{value:n.fileFormat},alignRowsField:{checked:n.alignRows}}},n.defaultExportDialogConfig,e);(e=n.dialogClass.new(t)).ion({export:n.onExportButtonClick,thisObj:n})}return e}async showExportDialog(){return this.exportDialog.show()}get isExporting(){return Boolean(this.client.isExporting)}onExportButtonClick({values:e}){const t=this,n=t.exportDialog.mask({progress:0,maxProgress:100,text:t.exportMask}),r=t.ion({exportstep({progress:e,text:i,contentGenerated:s}){s?(t.exportDialog.unmask(),r()):(n.progress=e,null!=i&&(n.text=i))}});t.currentExportPromise=t.export(e),t.currentExportPromise.catch((()=>{})).finally((()=>{var e;r(),null===(e=t.exportDialog)||void 0===e||e.unmask(),t.currentExportPromise=null}))}showLoadingToast(e){const t=Dh.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`\n    <span class="b-mask-icon b-icon b-icon-spinner"></span>\n    <span>${this.exportProgressMask}</span>\n    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return Jt.on({element:t.element,click(){var t;null===(t=e.abort)||void 0===t||t.call(e)}}),t}}Cb._$name="PdfExport",Jv.registerFeature(Cb,!1,"Grid");var wb=e=>class extends e{static $name="PrintMixin";static get configurable(){return{useBrowserPrint:!0,exporterType:"multipagevertical",test:!1}}static get pluginConfig(){return{assign:["print","showPrintDialog"]}}showPrintDialog(){return this.showExportDialog()}print(e){return this.export(e)}async onPrintIFrameLoad(e){}async showBrowserPrintDialog(e,t){if(await this.onPrintIFrameLoad(e),!1!==await this.client.trigger("beforeShowPrintDialog",{iframe:e})){if(!this.test){const{contentWindow:n}=e;n.onafterprint=()=>{e.remove(),t()},n.print()}}else e.remove(),t()}addStylesToDocument(e,t,n){t.head.querySelectorAll('link[rel="stylesheet"],link[as="style"]').forEach((t=>{const n=e.adoptNode(t);e.head.appendChild(n)}))}addInlineStylesToDocument(e,t){t.head.querySelectorAll("style").forEach((t=>{const n=e.adoptNode(t);e.head.appendChild(n)}))}doPrint(e){const t=this;return new Promise(((n,r)=>{const i=document.createElement("iframe");i.className="b-print-wrapper",i.style.visibility="hidden",i.style.height="0",i.onload=()=>{var s;const o=i.contentWindow.document,{body:a}=o,l=new DOMParser;let d,c;e.forEach((({html:e},n)=>{const r=l.parseFromString(e,"text/html"),i=o.adoptNode(r.body.firstChild);0===n&&(t.addStylesToDocument(o,r,e),d=parseFloat(r.body.style.height),c=parseFloat(r.body.style.width)),t.addInlineStylesToDocument(o,r),a.appendChild(i)}));const{html:u}=e[0];a.className=(null===(s=u.match(/<body class="(.+?)"/))||void 0===s?void 0:s[1])||"",a.parentElement.classList.add("b-print-root"),a.style.height=d*e.length+"in",a.style.width=`${c}in`,Promise.all(Array.from(o.head.querySelectorAll('link[rel="stylesheet"]')).map((e=>new Promise(((t,n)=>{e.onload=t,e.onerror=n}))))).then((()=>o.fonts.ready)).then((()=>t.showBrowserPrintDialog(i,n))).catch((e=>{console.warn("Failed to load stylesheets "+(e.message?`: ${e.message}`:"")),r(t.L("L{PdfExport.Export failed}"))}))},t.client.element.parentElement.appendChild(i)}))}};class Sb extends(wb(Cb)){static $name="Print"}Sb._$name="Print",Jv.registerFeature(Sb,!1,"Grid");class Db extends Qe{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"    "}}export(e={}){const t=this;return e=W.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){var t,n;const r=e.columns||(e.exportAllColumns?null===(t=this.target.columns)||void 0===t?void 0:t.records:null===(n=this.target.columns)||void 0===n?void 0:n.visibleColumns).filter((e=>!1!==e.exportable));e.columns=r.map((e=>"string"==typeof e?this.target.columns.find((t=>t.field===e))||{field:e}:e))}generateColumns(e){return e.columns.map((t=>this.processColumn(t,e)))}generateRows(e){var t;const{columns:n,rows:r}=e;if(0===n.length||0===(null==r?void 0:r.length))return[];const i=this,{target:s}=i,o=(r||s.store).map((t=>i.processRecord(t,n,e))).filter((e=>null==e?void 0:e.length));if(null!==(t=s.features.summary)&&void 0!==t&&t.enabled){const e=document.createElement("div"),t=n.map((t=>(e.innerHTML=s.features.summary.generateHtml(t,r||s.store.records),e.innerText)));o.push(t)}return o}getColumnType(e,t=this.target.store){let n=e.exportedType||"object";if(void 0===e.exportedType&&e.field){const r=t.modelClass.getFieldDefinition(e.field);r&&"auto"!==r.type&&(n=r.type)}return n}processColumn(e,t){const{target:n}=this,{defaultColumnWidth:r}=t;let{field:i,text:s,width:o,minWidth:a}=e;if(n.store&&!(i in n.store.modelClass.fieldMap)&&(i=""),!s||!o){const e=n.columns.find((e=>e.field===i));s||(s=e&&(e.text||e.headerRenderer&&e.textElement.innerText)||i),null==o&&(o=e&&e.width||r)}return o=Math.max(o||r,a||r),{field:i,value:s,width:o,type:this.getColumnType(e)}}processRecord(e,t,n){const{target:r}=this,{showGroupHeader:i,indent:s,indentationSymbol:o}=n;let a;if(e)if(e.isSpecialRow){if(i&&"groupRowFor"in e.meta&&(a=t.map((t=>r.features.group.buildGroupHeader({cellElement:Yn.createElement(),grid:r,isExporting:!0,record:e,column:t,isExport:!0})))),e.meta.groupFooterFor&&!r.isTimelineBase){const n=document.createElement("div"),i=e.groupChildren.slice();i.pop(),a=t.map((t=>(n.innerHTML=r.features.groupSummary.generateHtml(t,i,e,r.features.group.field,e._groupValue),n.innerText)))}}else a=t.map((t=>{let i=e.getValue(t.field);const a=t.renderer;return!a||i&&t.isDateColumn&&n.exportDateAsInstance||(i=a.call(t,{value:i,record:e,column:t,grid:r,isExport:!0})??i),s&&t.tree&&(i=`${o.repeat(e.childLevel)}${i}`),i}));else a=t.map((()=>""));return a}}Db._$name="TableExporter";class Eb{static write(e){throw new Error("XlsProviderBase#write must be implemented in a subclass")}}Eb._$name="XlsProviderBase";const xb={string:String,number:Number,date:Date,boolean:Boolean,bool:Boolean};class Rb extends Eb{static write({filename:e,columns:t,rows:n}){n.forEach((e=>{e.forEach((e=>{e.type=xb[e.type]||String,e.type===String&&"string"!=typeof e.value&&(e.value=`${e.value}`)}))})),t.map((e=>{delete e.type,delete e.field,e.fontWeight="bold",e.align="center"})),globalThis.writeXlsxFile([t,...n],{dateFormat:"yyyy-mm-dd",fileName:e,columns:t.map((e=>({width:Math.round((e.width||100)/10)})))})}}Rb._$name="WriteExcelFileProvider";class Tb extends Mr{static $name="ExcelExporter";static configurable={filename:null,dateFormat:G.checkVersion("core","7.0",">=")?null:"YYYY-MM-DD",exporterClass:Db,exporterConfig:null,xlsProvider:G.checkVersion("core","7.0",">=")?Rb:null,csvMimeType:"text/csv",zipcelx:null,convertEmptyValueToEmptyString:!0,exportAllColumns:!1};processValue(e){return null==e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:n,columns:r}=t.exporter.export(e.exporterConfig);return{rows:n.map((n=>n.map(((n,i)=>{var s;let o=(null===(s=r[i])||void 0===s?void 0:s.type)||"string";return"object"!==o&&"auto"!==o||(o="string"),n instanceof Date?e.dateFormat?(n=xi.format(n,e.dateFormat),o="string"):(n=Sh.fromTimeZone(n,0),o="date"):"number"===o&&"string"==typeof n&&(n=parseFloat(n.replace(/^\D*/,""))),t.convertEmptyValueToEmptyString?n=t.processValue(n):"string"===o&&"string"!=typeof n&&(n=`${n}`),{value:n,type:o}})))),columns:r}}async export(e={}){var t;const n=this,{client:r}=n,i=(null===(t=n.xlsProvider)||void 0===t?void 0:t.write)||n.zipcelx||globalThis.zipcelx;if(!i)throw new Error('ExcelExporter: "xlsProvider" or "zipcelx" library is required');if(n.disabled)return;(e=W.assign({},n.config,e)).filename||(e.filename=r.$$name);const{filename:s}=e,{rows:o,columns:a}=n.generateExportData(e);if(e.csv){const t=e.csv.columnDelimiter||",",i=e.csv.lineDelimiter||"\n";if(!1!==r.trigger("beforeCSVExport",{config:e,rows:o,columns:a,lineDelimiter:i,columnDelimiter:t})){const e=a.map((e=>this.processCsvValue(e.value))).join(t)+i,r=o.map((e=>e.map((e=>this.processCsvValue(e.value))).join(`${t}`))).join(i),l=new Uint8Array([239,187,191]),d=new Blob([l,e+r],{type:n.csvMimeType});c.downloadBlob(d,s)}return Promise.resolve()}if(!1!==r.trigger("beforeExcelExport",{config:e,rows:o,columns:a})){const e={filename:s,columns:a,rows:o};return G.checkVersion("core","7.0","<")&&(e.sheet={},e.sheet.data=[...o.map((e=>e.map(((e,t)=>{var n;return{...e,type:"number"===(null===(n=a[t])||void 0===n?void 0:n.type)&&"string"!=typeof value?"number":"string"}}))))],e.sheet.cols=a.map((e=>({...e,type:"string"}))),e.sheet.data.unshift(e.sheet.cols)),i(e)}return Promise.resolve()}processCsvValue(e=""){return`"${String(e).replace(/"/g,'""')}"`}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}Tb._$name="ExcelExporter",Jv.registerFeature(Tb,!1,"Grid");class Mb extends Mr{static $name="FileDrop";construct(e,t){const n=this;super.construct(e,t),Jt.on({element:e.element,thisObj:n,drop:n.onFileDrop,dragover:n.onFileDragOver,dragenter:n.onFileDragEnter,dragleave:n.onFileDragLeave})}onFileLoad(e){this.client.trigger("fileDrop",{file:this.file,domEvent:e})}onFileDragEnter(){this.client.element.classList.add("b-dragging-file")}onFileDragOver(e){e.preventDefault()}onFileDragLeave(e){const{element:t}=this.client;e.relatedTarget&&!t.contains(e.relatedTarget)&&this.client.element.classList.remove("b-dragging-file")}onFileDrop(e){e.preventDefault();const t=e.dataTransfer.items[0].getAsFile();this.client.trigger("fileDrop",{file:t,domEvent:e}),this.onFileDragLeave(e)}}Mb._$name="FileDrop",Jv.registerFeature(Mb,!1,"Grid");const kb=document.createRange();class Fb extends Qe{static $name="Row";static configurable={cls:{$config:{equal:(e,t)=>(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)}}};construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new Dv({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),"position"===this.grid.positionMode&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2})))}get id(){return this._id}set id(e){const t=this,n={id:e},r=t.rowManager.idMap;t._id===e&&r[e]===t||(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement((t=>{Vl.assign(t,n),t.dataset.id=e})),t.eachCell((e=>Vl.assign(e,n))))}addElement(e,t){const n=this,{dataIndex:r}=n;let i=t.firstElementChild;for(n._elements[e]=t,n._elementsArray.push(t),n._regions.push(e),Vl.assign(t,{index:n.index}),n._cells[e]=[];i;){const{column:t,columnId:r}=i.dataset;n._cells[e].push(i),n._allCells.push(i),Vl.set(i,{column:t,columnId:r,rowElement:i.parentNode,row:n}),i=i.nextElementSibling}t.dataset.index=r,t.ariaRowIndex=n.grid.hideHeaders?r+1:r+2,n.lastTop=null,null!==n.top&&n.translateElements(!0)}getElement(e){return this._elements[e]}getRectangle(e){return Ot.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e,t=!1){return this._allCells.find((n=>{const r=Vl.get(n);return r.columnId==e||!t&&r.column==e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this.cls["b-rowexpander-row-expanded"]||this.setProperty("--b-grid-row-height",e===this.grid.rowHeight?"":Yn.setLength(e)),this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement((e=>e.style.height=`${t.offsetHeight}px`)),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return new Vt(e)}updateCls(e){this.eachElement((t=>Yn.syncClassList(t,e)))}setAttribute(e,t){this.eachElement((n=>n.setAttribute(e,t)))}removeAttribute(e){this.eachElement((t=>t.removeAttribute(e)))}setProperty(e,t){this.eachElement((n=>n.style.setProperty(e,t)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,{top:n,_elementsArray:r}=t;if(t.lastTop!==n){for(let e=0,{length:t}=r;e<t;e++)r[e].style.transform=`translate(0,${n}px)`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=n}}positionElements(e){const t=this,{top:n,_elementsArray:r}=t;if(t.lastTop!==n){for(let e=0,{length:t}=r;e<t;e++)r[e].style.top=`${n}px`;!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=n}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}renderPlaceholder(e,t,n,r,i){const s=this,{rowManager:o}=s,{rowHeight:a}=o;s.addCls("b-row-placeholder"),s.height!==a&&(s.height=a,s.updateElementsHeight(!0),o.bufferedTranslateFromRow(s)),s.dataIndex=e,t.then((t=>{t&&s.dataIndex===e&&s.grid.store.indexOf(t)===e&&s.render(e,t,n,r,i,!0)}))}render(e,t,n=!0,r=!1,i=!1,s=!1){var o,a;const l=this,{cellContext:d,cls:c,elements:u,grid:h,rowManager:g,height:m,_id:p}=l,f=Vl.get(l._elementsArray[0]),v=g._rowHeight,{store:y}=h,b=h.features.tree&&y.isTree;let C,w=0;if(!t&&!1!==t){var S;if(null!=e)if((t=null===(S=y.lazyLoad)||void 0===S?void 0:S.getAt(e))&&!t.isModel)return l.renderPlaceholder(e,t,n,r,i);t||(t=y.getById(f.id),e=y.indexOf(t))}if(!t)return;l.removeCls("b-row-placeholder");const D=null===(o=t)||void 0===o?void 0:o.cls,E=D?D.isDomClassList?D:new Vt(D):null;c.assign({"b-grid-row-updating":n&&h.transitionDuration&&!i,"b-selected":h.isSelected(null===(a=t)||void 0===a?void 0:a.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),l.lastRecordCls&&c.remove(l.lastRecordCls),E?(c.add(E),l.lastRecordCls=Object.assign({},E)):l.lastRecordCls=null,g.trigger("beforeRenderRow",{row:l,record:t,recordIndex:e,oldId:p}),h.beforeRenderRow({row:l,record:t,recordIndex:e,oldId:p,cls:c}),l.updateCls(c),n&&h.transitionDuration&&!i&&h.setTimeout((()=>{l.isDestroyed||(c.remove("b-grid-row-updating"),l.updateCls(c))}),h.transitionDuration+50),l.id=t.id,l.dataIndex=e;const x=!h.fixedRowHeight&&h.getRowHeight(t)||v;let R=l.maxRequestedHeight=null;if(b)for(const e in u){const n=u[e];var T,M;if(n.id=`${h.id}-${e}-${l.id}`,Yn.setAttributes(n,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(y))Yn.setAttributes(n,{"aria-expanded":!0,"aria-owns":null!==(T=t.children)&&void 0!==T&&T.length?null===(M=t.children)||void 0===M?void 0:M.map((t=>`${h.id}-${e}-${t.id}`)).join(" "):null});else t.isLeaf?n.removeAttribute("aria-expanded"):n.setAttribute("aria-expanded",!1),n.removeAttribute("aria-owns")}for(d._record=t,d._id=t.id,d._rowIndex=e,w=0;w<h.columns.visibleColumns.length;w++){const e=h.columns.visibleColumns[w];d._columnId=e.id,d._column=e,d._columnIndex=w,d._cell=l.getCell(e.id,!0),d.height=x,d.maxRequestedHeight=R,d.updatingSingleRow=n,C=l.renderCell(d),g.fixedRowHeight||null!=C.height&&(R=Math.max(R,C.height),C.transient||(l.maxRequestedHeight=R))}const k=R??x;l.height=h.processRowHeight(t,k)??k,l.updateElementsHeight(i),s&&m!==l.height&&g.bufferedTranslateFromRow(l,r),n&&!i&&(m!==l.height&&g.translateFromRow(l,r),g.trigger("updateRow",{row:l,record:t,recordIndex:e,oldId:p}),g.trigger("renderDone")),h.afterRenderRow({row:l,record:t,recordIndex:e,oldId:p,oldHeight:m,isExport:i}),g.trigger("renderRow",{row:l,record:t,recordIndex:e,oldId:p,isExport:i}),m&&l.height!==m&&g.trigger("rowRowHeight",{row:l,record:t,height:l.height,oldHeight:m}),l.forceInnerHTML=!1}renderCell(e){var t;e.isLocation||(e=new Dv(e));let{cell:n,record:r}=e;const{grid:i,column:s,height:o,maxRequestedHeight:a,updatingSingleRow:l=!0,isMeasuring:d=!1}=e,c=null===(t=i.features)||void 0===t?void 0:t.cellEdit,u=Vl.get(n),h=u.rowElement,g=Vl.get(h);if(!r&&(r=e._record=i.store.getById(g.id),!r))return;let m=s.getRawValue(r);const p=r.fieldMap[s.field],f={configuredHeight:o,height:null,maxRequestedHeight:a},v=s.getCellClass(e),y={cellElement:n,cellCls:v,dataField:p,rowElement:h,value:m,record:r,column:s,size:f,grid:i,row:u.row,updatingSingleRow:l,isMeasuring:d,isExport:!1},b=s.renderer;s.readOnly||r.readOnly||i.readOnly?n.setAttribute("aria-readonly",!0):n.removeAttribute("aria-readonly"),i.beforeRenderCell(y),y.cellElement!==n&&(n=y.cellElement),Yn.syncClassList(n,v);let w=!0;C.isPromise(m)||(b?(m=s.callback(b,s,[y]),void 0===m&&(r.generatedParent&&s.rendererReturningContent?m="":!1===s.alwaysClearCell&&(w=!1))):p&&(m=p.print(m)));const S={cellContent:m,size:f,grid:i,isMeasuring:d,cellContext:e,cellElementData:u,rendererData:y,shouldSetContent:w,cellEdit:c,record:r,column:s,cellElement:n};return C.isPromise(m)?(n.classList.add("b-loading-cell"),m.then((e=>{this.isDestroyed||(n.classList.remove("b-loading-cell"),i.getRecordFromElement(n)===r&&this.updateCellContent({...S,cellContent:e}))})),f):this.updateCellContent(S)}updateCellContent({cellContent:e,size:t,grid:n,isMeasuring:r,cellContext:i,cellElementData:s,rendererData:o,shouldSetContent:a,cellEdit:l,record:d,column:c,cellElement:u}){var h;const g=null===(h=n.hasFrameworkRenderer)||void 0===h?void 0:h.call(n,{cellContent:e,column:c});g&&d.isSpecialRow&&(e="");const m=g&&!c.data.tree&&!d.isSpecialRow;if(a&&!m){var p;let t=u;(null==l||null===(p=l.editorContext)||void 0===p?void 0:p.column)!==c||l.editor.isFinishing||(null!=l&&l.editorContext.equals(i)?t=this.moveContentFromCell(u,l.editor.element):t.classList.remove("b-editing"));const n=null!=e&&"object"==typeof e,r="string"==typeof e,s=n||null==e?"":String(e);if(this.forceInnerHTML&&(t.innerHTML="",delete t._content,u.lastDomConfig=null),n||!c.htmlEncode||c.disableHtmlEncode?!c.autoSyncHtml||r&&!Yn.getChildElementCount(t)?n?(ud.sync({targetElement:t,domConfig:{onlyChildren:!0,children:nt.asArray(e)}}),delete t._content):t._content!==s&&(t.innerHTML=t._content=s):r?Yn.sync(s,t.firstElementChild):n&&(ud.sync({domConfig:e,targetElement:t}),delete t._content):(u._hasHtml?(t.innerText=s,u._hasHtml=!1):Yn.setInnerText(t,s),delete t._content),t!==u){const{firstChild:e}=u;for(const n of[...t.childNodes])u.insertBefore(n,e);u.classList.add("b-editing","b-focused")}}var f;d.isSpecialRow||(null===(f=n.processCellContent)||void 0===f||f.call(n,{cellElementData:s,rendererData:o,rendererHtml:o.rendererHtml||e}));return c.autoHeight&&null==t.height&&(u.classList.add("b-measuring-auto-height"),t.height=Math.max(u.offsetHeight,n.rowHeight),u.classList.remove("b-measuring-auto-height")),r||this.rowManager.trigger("renderCell",o),c.afterRenderCell&&c.callback(c.afterRenderCell,c,[o]),t}moveContentFromCell(e,t){t.parentNode||e.appendChild(t),kb.setStart(e,0),kb.setEndBefore(t);const n=document.createElement("div");return n.appendChild(kb.extractContents()),n.classList.add("b-editing"),n}}Fb.initClass(),Fb._$name="Row";class Ib extends oc{static $name="Bar";static type="gridbar";static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"},role:null}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:t}=e.columns;let n;e.columns.traverse((t=>{const r=e.getBarCellElement(t.id),i=Yn.setLength(t.width),s=Yn.setLength(t.minWidth),o=Yn.setLength(t.maxWidth);if(r){if(n=i,r.style.maxWidth=o,t.isParent&&null==t.width&&null==t.flex){const e=t.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);r.style.flex=e>0?`${e} 0 auto`:"",r.style.minWidth=null,e>0&&t.traverse((e=>e.data.minWidth=null))}else if(parseInt(t.minWidth)>=0&&(r.style.minWidth=s),r.style.flex=r.style.flexBasis=r.style.width="",t.flex)!isNaN(parseInt(t.flex))&&t.children?r.style.flex=`${t.flex} 0 auto`:r.style.flex=t.flex;else if(parseInt(t.width)>=0){const s=t.parent;!e.isHeader||s.isRoot||s.width?r.style.flexBasis=n:r.style.width=i}t.height>=0&&(r.style.height=Yn.setLength(t.height))}})),e.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}Ib.initClass(),Ib._$name="Bar";class Ab extends Ib{static $name="Footer";static type="gridfooter";get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onInternalPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return hh.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>hh.tpl`
                <div
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    role="gridcell">
                    ${e.footerText||""}
                </div>`)).join("")}fixFooterWidths(){this.fixCellWidths()}}Ab.initClass(),Ab._$name="Footer";const Lb=e=>{const t=e.parentElement,n=e.cloneNode(!0);return n.classList.add("b-removing"),t.insertBefore(n,e),n};let Pb,Ob;class $b extends(Mr.mixin(Hi)){static get pluginConfig(){return{chain:["destroy"],assign:["topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{rowClass:Fb,prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}static delayable={bufferedTranslateFromRow:"raf"};construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this.removeAllRows(),super.doDestroy()}initWithHeight(e,t=!1){const n=this;return n.autoHeight&&(e=n.store.count*n.preciseRowOffsetHeight),n.viewHeight=e,n.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.storeCount&&(e=!0),e&&(t.topIndex=t.lastScrollTop=0),t.scrollTargetRecordId=null;const{topRow:n}=t;n&&(n.dataIndex=t.topIndex,n.setTop(t.calculateTop(t.topIndex),!0)),t.estimateTotalHeight(),t.renderFromRow(n)}matchRowCount(e=!1){const t=this,{rows:n,grid:r,rowClass:i}=t,s=n.length,o=s-t.rowCount;if(o)if(o<0){const o=[];for(let e=s,a=s?n[s-1].dataIndex+1:0;e<t.rowCount;e++,a++)o.push(i.new({cls:r.rowCls,rowManager:t,grid:r,index:e,dataIndex:a}));n.push.apply(n,o),t.trigger("addRows",{rows:o}),e||t.renderFromRow(n[Math.max(0,s-1)])}else{var a;const i=null===(a=Yn.getActiveElement(r))||void 0===a?void 0:a.closest(".b-grid-cell"),l=n.splice(s-o,o);s!==o&&l.some((e=>e.cells.includes(i)))&&n[n.length-1].cells[r.focusedCell.columnIndex].focus(),t.trigger("removeRows",{rows:l}),l.forEach((e=>e.destroy())),!e&&n.length&&t.fillBelow(t.lastScrollTop)}}calculateRowCount(e=!1,t=!0,n=!1){var r;const i=this,{storeCount:s}=i,o=Math.ceil(i.viewHeight/i.minRowOffsetHeight),a=o+i.prependRowBuffer+i.appendRowBuffer;if(null===(r=i.grid.columns)||void 0===r||!r.count||isNaN(o))return i.rowCount=0,0;if(a<i.rowCount&&!t)return i.rowCount;if(i.visibleRowCount=o,i.rowCount=Math.min(s,a),!e){var l;if(i.rows&&i.rowCount!==i.rows.length){if(i.matchRowCount(n),(null===(l=i.bottomRow)||void 0===l?void 0:l.dataIndex)>=s&&0!==i.topRow.dataIndex){const e=i.bottomRow.dataIndex-s+1;for(const t of i.rows)t.dataIndex-=e;i.topIndex-=e}}else i.rowCount||i.trigger("changeTotalHeight",{totalHeight:i.totalHeight});i.grid.toggleEmptyText()}return i.rowCount}insert(e,t){var n,r;null===(n=Pb)||void 0===n||n();const i=this,{rows:s,rowCount:o,rowClass:a,grid:l}=i,{element:d}=l,{rowCls:c}=l,u=(null===(r=s[e-1])||void 0===r?void 0:r.dataIndex)+1||0,h=[],g=xi.as("ms",Yn.getStyleValue(l.element,"--row-splice-duration")),m=i.lastVisibleRow.index+1-e;let p;if(t<0){var f;t=Math.abs(t);const n=u>=l.store.count?t:Math.min(t,m),r=s.slice(e,e+n),c=n?r[r.length-1].bottom-r[0].top:0,h=[],g=[],y=[];for(let e=0,{length:t}=r;e<t;e++){const t=r[e]._elementsArray.map(Lb);g.push(a.new({rowManager:i,_elementsArray:t,grid:l})),h.push(...t)}for(let t=e;t<o;t++)y.push(s[t]),s[t].addCls("b-repositioning"),s[t].setTop(s[t].top+c);p=s.length>l.store.count,null===(f=h[0])||void 0===f||f.getBoundingClientRect(),d.classList.add("b-splicing-rows");for(let t=0,{length:n}=r;t<n;t++){var v;g[t].setTop((null===(v=s[e-1])||void 0===v?void 0:v.bottom)||0,!0)}Pb=()=>{Ob&&!i.isDestroyed&&(Ob=Ob(),Pb=null,d.classList.remove("b-splicing-rows"),h.forEach((e=>e.remove())),y.forEach((e=>{var t;return null===(t=e.removeCls)||void 0===t?void 0:t.call(e,"b-repositioning")})))}}else if(t>0){var y;const n=[];t=i.grid.hasVerticalOverflow?Math.min(t,i.lastVisibleRow.index+1-e):Math.min(t,Math.ceil((i.grid.scrollable.clientHeight-((null===(y=s[e-1])||void 0===y?void 0:y.bottom)||0))/i.rowHeight));let r=e,o=u;for(let n=0;n<t;n++,r++,o++){var b;h.push(a.new({cls:`${c} b-adding`,rowManager:i,_top:(null===(b=s[e-1])||void 0===b?void 0:b.bottom)||0,grid:l,index:r,dataIndex:o}))}for(let t=e;t<i.rowCount;t++,r++,o++)n.push(s[t]),s[t].addCls("b-repositioning"),s[t].index=r,s[t].dataIndex=o;p=h.length,Pb=()=>{Ob&&!i.isDestroyed&&(Ob=Ob(),Pb=null,d.classList.remove("b-splicing-rows"),h.forEach((e=>!e.isDestroyed&&e.removeCls("b-adding"))),n.forEach((e=>{var t;return null===(t=e.removeCls)||void 0===t?void 0:t.call(e,"b-repositioning")})))},s.splice(e,0,...h),t>0&&(i.rowCount+=t,i.trigger("addRows",{rows:h})),d.classList.add("b-splicing-rows")}return Ob=Jt.on({element:l.element,animationcancel:Pb,transitioncancel:Pb,once:!0,expires:{delay:g,alt:Pb}}),i.renderFromRow(s[e],!0),p&&i.calculateRowCount(!1,!0,!0),i.estimateTotalHeight(),h}removeAllRows(){const e=this,{topRow:t}=e,n=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},n}setPosition(e){const{topRow:t}=this,{topRowIndex:n,topRowTop:r}=e;t&&(t.setTop(r),t.dataIndex=n)}get store(){return this.client.store}get storeCount(){let{count:e,lazyLoad:t}=this.store;return e&&t&&null==t.totalCount&&(e+=t.chunkSize),e}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=Ot.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=Yn.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.storeCount);return this.rows[e-1]}get firstVisibleRow(){const e=Math.ceil(this.grid.scrollable.y);return this.rows.find((t=>t.bottom>e))}get firstFullyVisibleRow(){const e=Math.ceil(this.grid.scrollable.y);return this.rows.find((t=>t.top>=e))||this.rows.find((t=>t.top<e&&t.bottom>e))}get lastVisibleRow(){const{grid:e}=this;return nt.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}get lastFullyVisibleRow(){const{grid:e}=this;return nt.findLast(this.rows,(t=>t.bottom<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:n}=t;for(let r=0;r<n;r++)t[r].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:n,fixedRowHeight:r}=t,i=t.rowHeight;if(i!==e){if(W.assertNumber(e,"rowHeight",!0),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){const s=n.scrollable.y,o=t.getRowAt(s,!0),a=o?o.top-s:0;let l,d;r?(l=e,d=i):(d=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+n._rowBorderHeight),!0),t.refresh();s*(l/d)!==s&&n.scrollRowIntoView(o.id,{...n.defaultScrollOptions,block:"start",edgeOffset:a})}t.trigger("rowHeight",{height:e,oldHeight:i})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.storeCount}storeKnownHeight(e,t){const n=this,{heightMap:r}=n;n.fixedRowHeight||(r.has(e)&&(n.totalKnownHeight-=r.get(e)),r.set(e,t),n.totalKnownHeight+=t,t<n.minRowHeight&&(n.minRowHeight=t),n.averageRowHeight=n.totalKnownHeight/r.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:n}=t;(e=nt.asArray(e)).forEach((e=>{e&&n.has(e.id)&&(t.totalKnownHeight-=n.get(e.id),n.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/n.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{storage:t}=this.store;let n=0;for(let r=0;r<e;r++){const e=t.getAt(r);n+=this.getOffsetHeight(e)}return Math.floor(n)}getRecordCoords(e,t=!1,n=!1){const r=this,i=r.getRowById(e);let s=r.client._bodyRectangle;if(t||(s=r.client.refreshBodyRectangle()),i)return new Ot(s.x,t?Math.round(i.top):Math.round(i.top+s.y-r.client.scrollable.y),Math.max(s.width,0),i.offsetHeight);const o=r.store.indexOf(e);return-1!==o?r.getRecordCoordsByIndex(o,t,n):null}getRecordCoordsByIndex(e,t=!1,n=!1){const r=this,{topRow:i,bottomRow:s}=r,o=r.client._bodyRectangle,{id:a}=r.store.getAt(e),l=r.preciseRowOffsetHeight,d=i.dataIndex,c=s.dataIndex,u=Math.floor(r.heightMap.get(a)??l);let h;if(r.allHeightsKnown&&!n){const n=r.calculateTop(e);h=t?n:n+o.y-r.client.scrollable.y}else{const n=e>c?{index:e-c-1,y:s.bottom,from:"bottomRow"}:e>d/2?{index:e-d,y:i.top,from:"topRow"}:{index:e,y:0,from:"top"},a=Math.floor(n.y+n.index*l);h=t?"topRow"===n.from?a+l-u:a:a+o.y-r.client.scrollable.y}const g=new Ot(o.x,h,o.width,u);return g.virtual=!0,g.block=g.bottom<o.y?"start":g.y>o.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const n=new Dv({grid:this.grid,record:e,columnId:t});return Boolean(n.cell&&n.row.renderCell(n))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null,t){const n=this,{rows:r,store:i,topIndex:s,topRow:o,storeCount:a}=n;let l=e?r.indexOf(e):0;if(0===n.calculateRowCount(!1,a<r.length&&!t,!0)||l>=r.length)return void n.estimateTotalHeight(!0);n.topIndex<s?(n.topRow.setTop(n.calculateTop(n.topIndex),!0),l=0,e=n.topRow):e&&r.indexOf(e)<0&&(e=r[l]||o);let d=e?e.dataIndex:r[0].dataIndex;const c=a-d-1,u=Math.min(r.length-1,l+c);let h,g=r.length-u-1,m=l>0?r[l-1].bottom:r[l].top;const p=[];for(let e=l;e<=u;e++)h=r[e],h.dataIndex=d,t?p[e]=m:h.setTop(m,!0),h.render(d,i.getAt(d++),!1),m+=h.offsetHeight;if(t){r[l].element.getBoundingClientRect();for(let e=l;e<=u;e++)r[e].setTop(p[e],!0)}for(;g-- >0;)n.displayRecordAtTop();n.bottomRow.bottom<n.viewHeight+n.lastScrollTop&&n.calculateRowCount(),n.estimateTotalHeight(!0),n.trigger("renderDone")}renderRows(e){let t,n=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const r of e)t=r.height,r.render(null,null,!1),n|=r.height!==t;n&&this.translateFromRow(e[0]),this.trigger("renderDone")}bufferedTranslateFromRow(){this.translateFromRow(this.topRow)}translateFromRow(e,t=!1){const n=this;let r,i,s=e.bottom;for(i=e.dataIndex+1,r=n.getRow(i);r;r=n.getRow(++i))s=r.translate(s);t||n.estimateTotalHeight(!0)}refresh(e=!1){const t=this,{topRow:n}=t;!n&&!e||t.grid.refreshSuspended||(t.idMap={},t.renderFromRow(n),t.trigger("refresh"))}jumpToPosition(e,t){const n=this,{store:r,heightMap:i,storeCount:s}=n;if(n.allHeightsKnown&&!n.fixedRowHeight){const t=e-n.prependBufferHeight,o=n.grid._rowBorderHeight;let a=0,l=0;for(;a<t;){const e=r.records[l];a+=i.get(e.id)+o,l++}const d=Math.max(Math.min(l,s-n.rowCount),0);n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=d,n.topRow.setTop(n.calculateTop(d),!1),n.refresh()}else{const r=n.preciseRowOffsetHeight,i=null==t?Math.floor(e/r)-n.prependRowBuffer:t-Math.floor(n.rowCount/2),o=Math.max(Math.min(i,s-n.rowCount),0),a=n.client.scrollable.y,l=Math.min(n.client._bodyRectangle.height+a+n.appendBufferHeight,n.totalHeight);if(n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=o,n.topRow.setTop(Math.floor(o*r),!1),n.refresh(),n.bottomRow.bottom<l)for(n.calculateRowCount(!1,!1,!1);n.bottomRow.bottom<l&&n._rows[n.prependRowBuffer].top<a&&n.bottomRow.dataIndex<s-1;)n.displayRecordAtBottom();n.estimateTotalHeight()}if(null!=t){const{scrollable:r}=n.grid,i=n.getRow(t),s=i&&Ot.from(i._elementsArray[0]).center.y,o=r.viewport.center.y;i&&(r.y=e=Math.floor(r.y+(s-o)))}return e}warpIfNeeded(e){const t=this,n={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(n.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),n.newScrollTop=t.jumpToPosition(e,r),n.deltaTop=0}return n}updateRenderedRows(e,t,n=!1){const r=this;if(0===r.rowCount)return 0;let i=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+r.viewHeight){const t=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=t.newScrollTop,t.deltaTop>0?r.fillBelow(t.newScrollTop):t.deltaTop<0&&r.fillAbove(t.newScrollTop),r.fixedRowHeight||n||r.correctError(t,e),i=r.estimateTotalHeight()}return i}correctError(e,t){const n=this;let r=0;(n.allHeightsKnown||e.deltaTop<0&&t<2*n.viewHeight||e.deltaTop>0&&t>n.totalHeight-2*n.viewHeight-3)&&(r=n.topRow.top-n.calculateTop(n.topRow.dataIndex)),r&&(n.offsetRows(-r),n.grid.scrollable.y=n.lastScrollTop=n.grid.scrollable.y-r)}fillAbove(e){const t=this,{rows:n}=t,r=Math.min(t.prependRowBuffer,n.length-1);for(;n[r].top>e&&t.topIndex>0;)t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,{rows:n,storeCount:r}=t,{length:i}=n,s=Math.min(i-Math.min(t.appendRowBuffer,i-1),i-1),o=e+t.viewHeight;for(;n[s].top<o&&t.bottomRow.dataIndex<r-1;)t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const{bottomRow:n,storeCount:r}=t,i=r-t.heightMap.size;let s;if(t.fixedRowHeight)s=r*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+i*t.preciseRowOffsetHeight,n&&i){const e=n.bottom;(e>s||t.topIndex+t.rowCount>=r&&s>e&&e>0)&&(s=e,n.dataIndex<r-1&&(s+=(r-1-n.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})&&(t._totalHeight=s),s}displayRecordAtTop(){var e;const t=this,{grid:n}=t,r=t.topIndex-1,i=t.store.getAt(r),s=t.bottomRow,o=s.top;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),s._top=t.topRow.top-t.getOffsetHeight(i),s.estimatedTop=!t.fixedRowHeight,s.render(r,i,!1),s._top=o,s.setBottom(t.topRow.top),s.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),t.fixIndices(),s.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:n}=t,r=t.topIndex+t.rowCount,i=t.store.getAt(r),s=t.topRow;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null===(e=n.focusedCell)||void 0===e?void 0:e.rowIndex)&&n.onFocusedRowDerender(),s.dataIndex=r,s.setTop(t.bottomRow.bottom),s.render(r,i,!1),t.topIndex++,t._rows.push(t._rows.shift()),t.fixIndices(),s.offsetHeight}fixIndices(){for(let e=0,{rows:t}=this,{length:n}=t;e<n;e++)t[e].index=e}}$b.featureClass="",$b._$name="RowManager";const _b={x:1},Hb=e=>e.isSubGrid;class Vb extends Md{static $name="GridScroller";addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=_b,n=!0){if("string"==typeof t&&(t={[t]:1}),t.x){e.owner.initScroll();const t=this.widget.items.filter(Hb),n=e.widget.items.filter(Hb);for(let e=0,{length:r}=t;e<r;e++)t[e].scrollable.addPartner(n[e].scrollable,"x")}n&&Yn.scrollBarWidth&&e.isGridScroller&&(e.ion({overflowChange:"onPartnerOverflowChange",thisObj:this}),this.onPartnerOverflowChange({source:e,y:e.hasOverflowY})),super.addPartner(e,{...t,x:!1})}onPartnerOverflowChange({source:e,y:t}){const n=this,r=n.hasOverflowY,i=t;r&&!i&&(e.overflowY="scroll"),!r&&i?n.overflowY="scroll":r||i||(n.overflowY=e.overflowY=!0),n.owner.refreshVirtualScrollbars()}removePartner(e){Yn.scrollBarWidth&&e.isGridScroller&&e.un({overflowChange:"onPartnerOverflowChange",thisObj:this}),this.xScrollers.forEach(((t,n)=>{t.isDestroyed||t.removePartner(e.xScrollers[n])})),super.removePartner(e)}updateOverflowX(e){var t;const n=!1===e;null===(t=this.xScrollers)||void 0===t||t.forEach((e=>e.overflowX=n?"hidden":"hidden-scroll")),this.widget.virtualScrollers.classList.toggle("b-hide-display",n)}scrollIntoView(e,t){if(e.nodeType!==Element.ELEMENT_NODE||!this.element.contains(e))return super.scrollIntoView(e,t);for(const n of this.xScrollers)if(n.element.contains(e))return n.scrollIntoView(e,t)}hasOverflow(e="y"){return"y"===e&&this.scrollHeight>this.clientHeight}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}Vb._$name="GridScroller";class Nb extends Ib{static $name="Header";static type="gridheader";get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return null===(e=this.subGrid)||void 0===e?void 0:e.region}changeElement(e,t){const{region:n}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${n}`]:n},role:null,children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${n}`]:n},dataset:{region:n,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:n,resizable:r,isLeaf:i,isParent:s,isLastInSubGrid:o,cls:a,childLevel:l,field:d,tooltip:c,children:u,isFocusable:h,grid:g}=e,m=null==g?void 0:g.focusedCell,p=-1===(null==m?void 0:m.rowIndex)&&(null==m?void 0:m.column)===e,f={};var v;if(e.isVisible)return e.flex?f.flex=e.flex:e.width&&(f.width=Yn.setLength(e.width)),{style:f,className:{"b-grid-header":1,"b-grid-header-parent":s,[`b-level-${l}`]:1,[`b-depth-${e.meta.depth??0}`]:1,[`b-grid-header-align-${n}`]:n,"b-grid-header-resizable":r&&i,[a]:a,"b-collapsible":e.collapsible,"b-last-parent":s&&o,"b-last-leaf":i&&o,"b-header-widgets":null===(v=e.headerWidgets)||void 0===v?void 0:v.length},role:h?"columnheader":null,"aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:p?0:-1,dataset:{...tm.encodeConfig(c),columnId:t,[d?"column":""]:d},children:[{className:"b-grid-header-text",role:null,children:[{[g&&h?"id":""]:`${null==g?void 0:g.id}-column-${e.id}`,className:{"b-grid-header-text-content":1,"b-has-text":Boolean(e.text)}}]},u?{className:"b-grid-header-children",children:u.map((e=>this.getColumnConfig(e))),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>e.refreshColumn(t))),e.fixHeaderWidths()}refreshColumn(e){const t=this,n=t.getBarCellElement(e.id);if(n){let r=e.headerText;if(e.headerRenderer&&(r=e.headerRenderer.call(e.thisObj||t,{column:e,headerElement:n}),Yn.isReactElement(r)))return Yn.handleReactHeaderElement(e,n,r);e.headerWidgetMap&&Object.values(e.headerWidgetMap).forEach((t=>{t.render(e.textWrapper)})),e.icon&&(r=`<i class="${N.encodeHtml(e.icon)}"></i>`+(r||""));const i=n.querySelector(".b-grid-header-text-content");i&&(i.innerHTML=r||"")}}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const n=this;let r=0;null!=t&&t.meta&&t.meta.depth++;for(const i of e){const{meta:e}=i;e.depth=0,i.children&&(n.initDepths(i.children.filter(n.columns.chainedFilterFn),i),e.depth&&t&&(t.meta.depth+=e.depth)),e.depth>r&&(r=e.depth)}return t||(n.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;ud.sync({domConfig:{children:e.columns.topColumns.map((t=>e.getColumnConfig(t))),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}onInternalPaint({firstPaint:e}){e&&this.refreshContent()}}Nb.initClass(),Nb._$name="Header";const Bb={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},zb=["pageX","pageY","clientX","clientY","screenX","screenY"],jb={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1,Backspace:1,Delete:1};function Wb(e,t=!0){null==e||e.classList.toggle("b-hover",t)}function Ub(e,t,n=!0){t&&e&&Wb(t.getCell(e),n)}var Gb=e=>class extends(e||Qe){static $name="GridElementEvents";static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,hoverCls:"b-hover",keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const e=Object.keys(Bb),t=e.length,n={element:this.bodyElement,thisObj:this};for(let r=0;r<t;r++){const t=e[r];n[t]={handler:"handleEvent"},t.startsWith("touch")&&(n[t].passive=!1)}Jt.on(n),Jt.on({mouseenter:"onGridBodyMouseEnterOrLeave",mouseleave:"onGridBodyMouseEnterOrLeave",focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(e,t=!1){const n=this,{target:r}=e,i=r.classList.contains("b-grid-row");let s=r.closest(".b-grid-cell");if(s||!t||i||r.classList.contains("b-grid-subgrid")){if(i){var o;s=null===(o=Yn.childFromPoint(r,e.offsetX,e.offsetY-r.offsetHeight/2))||void 0===o?void 0:o.closest(".b-grid-cell")}}else{const{columns:t}=n,{top:i,left:o,right:l,bottom:d}=n.bodyContainer.getBoundingClientRect();let c,{x:u,y:h}=e;var a;if(u>=o&&u<=l?h=c=Math.ceil(n[(h<i?"first":"last")+"FullyVisibleRow"].element.getBoundingClientRect().y):h>=i&&h<=d&&(u=c=Math.ceil(t.visibleColumns[u<o?0:t.visibleColumns.length-1].element.getBoundingClientRect().x)),void 0!==c)s=null===(a=Yn.childFromPoint(r,e.offsetX,e.offsetY))||void 0===a?void 0:a.closest(".b-grid-cell")}if(s)return n.getCellDataFromElement(s)}getCellDataFromElement(e){const t=this;if(e=e.closest(".b-grid-cell")){const n=Vl.get(e),{id:r,columnId:i}=n,s=t.store.getById(r),o=t.columns.getById(i);return s?{cellElement:e,cellData:n,columnId:i,id:r,record:s,column:o,cellSelector:{id:r,columnId:i}}:null}}getHeaderDataFromEvent(e){const t=e.target.closest(".b-grid-header");if(t){const e=W.assign({},t.dataset),{columnId:n}=e,r=this.columns.getById(n);return r?{headerElement:t,headerData:e,columnId:n,column:r}:null}}handleEvent(e){!this.disabled&&Bb[e.type]&&"focus"!==e.pointerType&&this[Bb[e.type]](e)}onElementTouchStart(e){const t=this;Yn.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime))}onElementTouchMove(e){const t=this,{lastTouchTarget:n}=t,r=e.changedTouches[0],{pageX:i,pageY:s}=r,o=e.target.getRootNode().elementFromPoint(i,s);if(t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null),o!==n&&n){const t=new MouseEvent("mouseout",W.copyProperties({relatedTarget:o,pointerType:"touch",bubbles:!0},r,zb));t.preventDefault=()=>e.preventDefault(),null==o||o.dispatchEvent(t);const i=new MouseEvent("mouseover",W.copyProperties({relatedTarget:n,pointerType:"touch",bubbles:!0},r,zb));i.preventDefault=()=>e.preventDefault(),null==n||n.dispatchEvent(i)}t.lastTouchTarget=o}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t,n=this.getCellDataFromEvent(t),r="cell"){const i=this;if(n){const o=i.columns.getById(n.columnId),a={grid:i,record:n.record,column:o,cellSelector:n.cellSelector,cellElement:n.cellElement,target:t.target,event:t};var s;if(i.trigger(r+N.capitalize(e),a),"cell"===r&&"click"===e)null===(s=o.onCellClick)||void 0===s||s.call(o,a)}}onElementMouseDown(e){const t=this,n=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e,n),n&&!e.defaultPrevented&&t.onFocusGesture(e))}isScrollbarOrRowBorderOrSplitterClick({target:e,x:t,y:n}){if(e.closest(".b-grid-splitter")||e.matches(".b-grid-row, .b-virtual-width"))return!0;if(e.matches(".b-vertical-overflow")){return t>e.getBoundingClientRect().right-Yn.scrollBarWidth}if(e.matches(".b-horizontal-overflow")){return n>e.getBoundingClientRect().bottom-Yn.scrollBarWidth-1}}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onElementPointerDown(e){}onElementPointerUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,n=t.getCellDataFromEvent(e);if(n)return t.triggerCellMouseEvent("click",e,n);{var r;const n=null===(r=e.target)||void 0===r?void 0:r.closest(".b-grid-header"),i=n&&t.columns.getById(n.dataset.columnId);if(i)return t.trigger("headerClick",{domEvent:e,column:i})}}onFocusGesture(e){var t,n;const r=this,{navigationEvent:i}=r,{target:s}=e,o=2===e.button,a=!o&&(null===(t=r.features.tree)||void 0===t||null===(t=t.treeColumn)||void 0===t||null===(n=t.isTreeExpanderIcon)||void 0===n?void 0:n.call(t,s)),l=!document.hasFocus()&&c.isMac&&o;if(a||l)e.preventDefault();else{var d;r.navigationEvent=e;const t=new Dv(s);if(o||null!==(d=r.focusedCell)&&void 0!==d&&d.equals(t)){const n={scroll:!1};globalThis.TouchEvent&&e instanceof MouseEvent&&i instanceof TouchEvent&&s===i.target&&(n.doSelect=!1),r.focusCell(t,n)}}}onElementDblClick(e){const{target:t}=e;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){const n=t.closest(".b-grid-header"),r=this.columns.getById(n.dataset.columnId);r.resizeToFitContent()&&this.trigger("columnResize",{column:r,domEvent:e})}}shouldHover(e){return(Zl.dragging||"number"!=typeof e.buttons||0===e.buttons)&&"touch"!==e.pointerType}onElementMouseOver(e){if(!this.scrolling){const n=this,{hoveredCell:r}=n,i=this.shouldHover(e);let s=e.target.closest(".b-grid-cell");var t;if(n._lastMouseOverOutEvent=e,!s&&e.target.classList.contains("b-grid-row"))s=null===(t=Yn.childFromPoint(e.target,e.offsetX,e.offsetY-2))||void 0===t?void 0:t.closest(".b-grid-cell");s&&(i&&(n.hoveredCell=s),r!==n.hoveredCell&&n.triggerCellMouseEvent("mouseOver",e)),n.trigger("mouseOver",{event:e})}}onElementMouseOut(e){var t;const n=this,{target:r,relatedTarget:i}=e,s=("number"!=typeof e.buttons||0===e.buttons)&&"touch"!==e.pointerType;n._lastMouseOverOutEvent=e,s&&i&&r.matches(".b-grid-cell")&&!r.contains(i)?i.matches(".b-grid-row")||(n.hoveredCell=i.closest(".b-grid-cell")):null!=i&&i.matches(".b-grid-row,.b-grid-cell")||null!==(t=n.hoveredCell)&&void 0!==t&&t.contains(i)||(n.hoveredCell=null),n.scrolling||((null==i?void 0:i.closest(".b-grid-cell"))!==(null==r?void 0:r.closest(".b-grid-cell"))&&null!=r&&r.closest(".b-grid-cell")&&n.triggerCellMouseEvent("mouseOut",e),n.trigger("mouseOut",{event:e}))}updateHoveredCell(e,t){var n,r;const i=this,{selectionMode:s}=i,o=s.rowNumber&&(null===(n=i.columns.find((e=>"rownumber"==e.type)))||void 0===n?void 0:n.id),a=s.checkbox&&(null===(r=i.checkboxSelectionColumn)||void 0===r?void 0:r.id);let l,d;if(t){Wb(t,!1);const e=Vl.get(t);var c;if(l=e.row,l&&!l.isDestroyed&&(Ub(o,l,!1),Ub(a,l,!1)),null!=e&&e.columnId)Wb(null===(c=i.columns.getById(e.columnId))||void 0===c?void 0:c.element,!1)}if(i._hoveredRow&&!i._hoveredRow.isDestroyed&&i.toggleRowHover(i._hoveredRow,!1),i._hoveredRow=null,e&&!i.scrolling){const t=Vl.get(e);if(d=t.row,d)if(s.cell&&t.columnId!==o&&t.columnId!==a){const n=i.columns.getById(t.columnId);Wb(e),Ub(a,d),Ub(o,d),null!=n&&n.element&&!1!==n.headerHoverable&&Wb(n.element)}else i._hoveredRow=d,i.toggleRowHover(d,!0);else i.hoveredCell=null}if(d!==l){const{_lastMouseOverOutEvent:e}=i;if(l&&!l.isDestroyed&&i.trigger("rowMouseLeave",{event:e,record:l.cellContext.record,cellElement:t}),d){const t=i.getCellDataFromEvent(e);i.triggerCellMouseEvent("mouseEnter",e,t,"row")}}}toggleRowHover(e,t){this.hoverCls&&e.toggleCls(this.hoverCls,t)}keyMapOnKeyDown(e){const t=this,{target:n}=e.browserEvent;if(t.element.contains(n)){var r;const i=e.key.startsWith("Arrow"),s="Escape"===e.key||"F2"===e.key||"Tab"===e.key||"Enter"===e.key;if(t.onElementKeyDown(e),(jb[e.key]&&Yn.isEditable(n,!0)||null!==(r=t.focusedCell)&&void 0!==r&&r.containsFocus&&!s&&!i&&!t.matchKeyMapEntry(e))&&!n.getAttribute("readOnly")&&t.matchKeyMapEntry(e))return i||"Backspace"!==!e.key||e.preventDefault(),e.handled=!0,e.stopPropagation(),!1;super.keyMapOnKeyDown(e)}}onElementKeyDown(e){if(e.handled||!this.element.contains(e.target))return;const t=this,n=t.focusedCell;if(null!=n&&n.isCell&&!n.isActionable){var r,i;const s=e.target.closest(".b-grid-cell")?t.getCellDataFromEvent(e):t.getCellDataFromElement(n.cell);null==s||null===(r=(i=s.column).onCellKeyDown)||void 0===r||r.call(i,{...s,event:e})}}undoRedoKeyPress(e){var t;const{stm:n}=this.store;return!(!n||!this.enableUndoRedoKeys||null!==(t=this.features.cellEdit)&&void 0!==t&&t.isEditing)&&(n.onUndoKeyPress(e),!0)}clickCellByKey(e){const t=this,n=t.focusedCell,r=null==n?void 0:n.cell,i=t.columns.getById(r.dataset.columnId);return!(null==n||!n.isCell||n.isActionable||!i.onCellClick)&&(i.onCellClick({grid:t,column:i,record:t.store.getById(n.id),cellElement:r,target:e.target,event:e}),!0)}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,n=t.getCellDataFromEvent(e);n&&(t.triggerCellMouseEvent("contextMenu",e,n),Yn.isTouchEvent&&t.onFocusGesture(e))}onGridBodyMouseEnterOrLeave(e){const t=e.target.classList.contains("b-grid-cell")&&this.getCellDataFromEvent(e);t&&this.triggerCellMouseEvent(e.type,e,t)}onInternalResize(e,t,n,r,i){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==globalThis.devicePixelRatio&&Yn.resetScrollBarWidth(),s._devicePixelRatio=globalThis.devicePixelRatio,s._bodyRectangle=Ot.client(s.bodyContainer),super.onInternalResize(...arguments),n!==i&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.isPainted&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),t!==r&&s.setTimeout((()=>{s.isDestroyed||s.updateResponsive(t,r)}),0)}get widgetClass(){}};const Yb={string:1,object:1,function:1};var qb=e=>class extends(e||Qe){static $name="GridFeatures";set features(e){const t=this,n=Jv.getInstanceDefaultFeatures(this);e=t._features=W.merge({},this.constructor.configurable.features,W.isObject(e)?e:{}),n&&Object.keys(n).forEach((t=>{t in e||(e[t]=!0)}));const r=Jv.getInstanceFeatures(this);for(const n of Object.keys(e)){const i=e[n];if(i){const s=!globalThis.__bryntum_code_editor_changed;if(N.uncapitalize(n)!==n){const e=`Invalid feature name '${n}', must start with a lowercase letter`;if(s)throw new Error(e);console.error(e),t._errorDuringConfiguration=e}const o=r[n];if(!o){const e=`Feature '${n}' not available, make sure you have imported it`;if(s)throw new Error(e);return console.error(e),void(t._errorDuringConfiguration=e)}Reflect.defineProperty(e,n,t.createFeatureInitializer(e,n,o,i))}}}get features(){return this._features}createFeatureInitializer(e,t,n,r){const i=[this],s=n.prototype.construct;return!0===r&&(r={}),Yb[typeof r]&&(i[1]=r),{configurable:!0,get:()=>(delete e[t],n.prototype.construct=function(...r){e[t]=this,s.apply(this,r),n.prototype.construct=s},new n(...i))}}hasFeature(e){const{features:t}=this;if(t){const t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}hasActiveFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t||null===(t=t[e])||void 0===t?void 0:t.enabled)}getConfigValue(e,t){if("features"===e){const e={};for(const i in this.features){var n,r;const s=null===(n=this.features[i])||void 0===n||null===(r=n.getCurrentConfig)||void 0===r?void 0:r.call(n,t);s?W.isEmpty(s)?Jv.isDefaultFeatureForInstance(this.features[i].constructor,this)||(e[i]=!0):e[i]=s:e[i]=!1}return e}return super.getConfigValue(e,t)}get widgetClass(){}};const Kb=Object.freeze({}),Xb=function(e){return this.focusableFinderCell.contains(e)?Yn.isFocusable(e)&&!e.disabled?Yn.NodeFilter.FILTER_ACCEPT:Yn.NodeFilter.FILTER_SKIP:Yn.NodeFilter.FILTER_REJECT};var Zb=e=>class extends(e||Qe){static $name="GridNavigation";static configurable={focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0[tabIndex]",isNested:!1,keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateCell",F2:"toggleCellActivate",Escape:{handler:"deactivateCell",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1,weight:200},Tab:{handler:"onTab",preventDefault:!1,weight:200}," ":{handler:"onSpace",preventDefault:!1}},cellIsVisibleWidthThreshold:.6,cellIsVisibleHeightThreshold:.6};onStoreRecordIdChange(e){var t;null===(t=super.onStoreRecordIdChange)||void 0===t||t.call(this,e);const{focusedCell:n}=this,{oldValue:r,value:i}=e;n&&n.id===r&&(n._id=i)}onFocusedRowDerender(){const e=this,{focusedCell:t}=e;if(null!=(null==t?void 0:t.id)&&t.cell){const n=Yn.isDescendant(t.cell,Yn.getActiveElement(e));if(e.hideHeaders)n&&e.revertFocus();else{const r=e.normalizeCellContext({rowIndex:-1,columnIndex:n?t.columnIndex:0});n?e.focusCell(r):r.cell.tabIndex=0}t.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(Dv.FIRST_CELL)}navigateFirstColumn(){this.focusCell(Dv.FIRST_COLUMN)}navigateLastCell(){this.focusCell(Dv.LAST_CELL)}navigateLastColumn(){this.focusCell(Dv.LAST_COLUMN)}navigatePrevPage(){this.focusCell(Dv.PREV_PAGE)}navigateNextPage(){this.focusCell(Dv.NEXT_PAGE)}activateCell(e){var t;const{focusedCell:n}=this;if(n.isColumnHeader){if(e.target.classList.contains("b-grid-header")){var r;const{column:t}=this.focusedCell;null===(r=t.onKeyDown)||void 0===r||r.call(t,e),this.getHeaderElement(t.id).click()}}else!n.isActionable&&null!==(t=n.actionTargets)&&void 0!==t&&t.length&&(e.preventDefault(),n.actionTargets[0].focus());return!1}toggleCellActivate(e){var t;const{focusedCell:n}=this;null!=n&&null!==(t=n.actionTargets)&&void 0!==t&&t.length&&(n.isActionable?this.deactivateCell(e):n.actionTargets[0].focus())}deactivateCell(e){var t,n;const r=this,{focusedCell:i}=r;!e.target.closest(".b-dragging")&&null!=i&&i.isActionable?(e.stopImmediatePropagation(),r._focusedCell=null,r.focusCell({rowIndex:i.rowIndex,column:i.column},{disableActionable:!0})):!r.isNested||!r.owner||null!==(t=(n=r.owner).catchFocus)&&void 0!==t&&t.call(n,{source:r})||r.revertFocus(!0)}onTab(e){const{target:t}=e,{focusedCell:n,bodyElement:r}=this,{isActionable:i,actionTargets:s=[]}=n;if(i&&Yn.isEditable(t)&&!t.readOnly&&t===s[s.length-1])e.preventDefault(),this.navigateRight(e);else if(!i||t===s[s.length-1])return r.style.display="none",this.requestAnimationFrame((()=>r.style.display="")),!1}onShiftTab(e){const t=this,{target:n}=e,{focusedCell:r,bodyElement:i}=t,{cell:s,isActionable:o,actionTargets:a}=r,l=o&&Yn.isEditable(n)&&!n.readOnly,d=0===r.columnIndex&&r.rowIndex===(t.hideHeaders?0:-1);if(!d&&l&&n===a[0])e.preventDefault(),t.navigateLeft(e);else if(!o||n===a[0]){const e=!d&&!t.hideHeaders&&t.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return e?(e.cell.tabIndex=-1,s.tabIndex=0,t._focusedCell=r):(i.style.display="none",t.requestAnimationFrame((()=>i.style.display=""))),!1}}onSpace(e){return this.focusedCell.isActionable||e.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.isActionable}set focusedCell(e){this.focusCell(e)}get focusedRecord(){var e;return null===(e=this._focusedCell)||void 0===e?void 0:e.record}get cellCSSSelector(){const e=this._focusedCell;return e?`[data-index=${e.rowIndex}] [data-column-id=${e.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(e){var t;return Boolean(null===(t=this._focusedCell)||void 0===t?void 0:t.equals(this.normalizeCellContext(e)))}get focusElement(){if(!this.isDestroying){let t;if(this.store.count&&this._focusedCell)t=this._focusedCell.target;else if(!this.hideHeaders){var e;t=this.normalizeCellContext({rowIndex:-1,columnIndex:(null===(e=this._focusedCell)||void 0===e?void 0:e.columnIndex)||0}).target}const n=super.focusElement;return!n||t&&t.compareDocumentPosition(n)!==Node.DOCUMENT_POSITION_PRECEDING?t:n}}afterInternalPaint({firstPaint:e}){var t,n;const r=this;null===(t=super.afterInternalPaint)||void 0===t||t.call(this,...arguments);const i=this.normalizeCellContext({rowIndex:r.hideHeaders?0:-1,column:r.hideHeaders?0:r.columns.find((e=>!e.hidden&&e.isFocusable))});if(null!==(n=i.cell)&&void 0!==n&&n.getAttribute("tabIndex")){i._isDefaultFocus=!0,r._focusedCell=i;const{target:e}=i;e===i.cell&&(i.cell.tabIndex=0)}}onGridBodyFocusIn(e){const t=this,{bodyElement:n}=t,r=t.focusedCell,i=(null==r?void 0:r.initialTarget)||(null==r?void 0:r.target),{relatedTarget:s}=e,o=e.browserEvent.target,a=o.closest(t.focusableSelector),l=o.closest(".b-grid-row");if(a&&(!ir.currentMouseDown||ir.isMouseDown(0)||ir.isMouseDown(2))){var d;const g=new Dv(o),{cell:m}=g,p=null==r?void 0:r.cell,f=g.actionTargets=t.findFocusables(a),v=(!t._fromFocusCell||t.selectOnFocus)&&(o===m||!a.contains(o.closest('button, input, textarea, a, [contenteditable="true"], select, option'))||t._selectActionCell)&&!(null!=o&&o._isRevertingFocus);if(l&&-1===g.rowIndex)return void m.focus({preventScroll:!0});if(o.matches(t.focusableSelector)){if(t.disableActionable)g._target=m;else if(f.length){var c;const n=null===(c=ir.currentMouseDown)||void 0===c?void 0:c.target;var u;if(!f.some((e=>e.contains(n))))null===(u=t.onCellNavigate)||void 0===u||u.call(t,t,r,g,v),t.trigger("navigate",{lastFocusedCell:r,focusedCell:g,event:e});return t._selectActionCell=n===o,f[0].focus(),void delete t._selectActionCell}}else{var h;if(null!=r&&r.target&&s&&(!ir.isMouseDown()||!n.contains(null===(h=ir.currentMouseDown)||void 0===h?void 0:h.target))&&!n.contains(s)&&!g.equals(r))return void i.focus();g._target=o}if(p&&(p.classList.remove("b-focused"),p.tabIndex=-1),m&&(m.classList.add("b-focused"),g.column.onCellFocus(g),m===o&&(m.tabIndex=0),m.contains(e.relatedTarget)&&i===o))return;t._focusedCell=g,null===(d=t.onCellNavigate)||void 0===d||d.call(t,t,r,g,v),t.trigger("navigate",{lastFocusedCell:r,focusedCell:g,event:e})}else o.closest(".b-rowexpander-body")||null==i||i.focus({preventScroll:!0})}findFocusables(e){const{focusableFinder:t}=this,n=[];t.currentNode=this.focusableFinderCell=e;for(let e=t.nextNode();e;e=t.nextNode())n.push(e);return n}get focusableFinder(){const e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,Yn.NodeFilter.SHOW_ELEMENT,{acceptNode:Xb.bind(e)})),e._focusableFinder}restoreActiveItem(e=this._focusedCell){if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}focusCell(e,t=Kb){var n,r;const i=this,{_focusedCell:s}=i,{scroll:o,disableActionable:a}=t,l=e===Dv.DOWN,d=e===Dv.UP,c=e===Dv.PREV_CELL||e===Dv.NEXT_CELL,{cellEdit:u}=i.features;if(-1===(null===(n=e)||void 0===n?void 0:n.rowIndex)&&i.hideHeaders)return void i.revertFocus();if("number"==typeof e&&(null==s||!s.isLocation))return;e="number"==typeof e&&null!=s&&s.isLocation?s.move(e):i.normalizeCellContext(e);const h="doSelect"in t?t.doSelect:!e.isActionable||e.initialTarget===e.cell;if(e.equals(s)){var g,m,p;if(i.isNested&&(l||d))null!==(g=i.owner)&&void 0!==g&&null!==(m=g.catchFocus)&&void 0!==m&&m.call(g,{source:i,navigationDirection:l?"down":"up"})||i.revertFocus(!0);else null===(p=i.onCellNavigate)||void 0===p||p.call(i,i,s,e,h);return s}if(null!=u&&u.isEditing&&!e.equals(u.editorContext)&&u.getEditingContext(e))return u.startEditing(e),e;const f=i.getSubGridFromColumn(e.columnId),{cell:v}=e,y=v||i.getCell({rowIndex:i.rowManager.topIndex,columnId:e.columnId}),b=Ot.from(f.element),C=Ot.from(i.bodyElement),w=Ot.from(y).moveTo(null,b.y);if(!1!==o)if(-1===e.rowIndex)c&&i.scrollColumnIntoView(e.column);else{t=Object.assign({},t,o);const{cellIsVisibleWidthThreshold:n,cellIsVisibleHeightThreshold:r}=i,s=n*b.width,a=r*C.height,l=b.intersect(w),d=Math.min(C.bottom,w.bottom)-Math.max(C.y,w.y);(w.width>b.width||w.height>C.height)&&(w.width>b.width&&l.width>=s&&(t.x=!1),w.height>C.height&&d>=a&&(t.y=!1)),t.column=e.columnId,i.scrollRowIntoView(e.id,t)}return(i._hoveredRow||i.hoveredCell)&&(i.hoveredCell=null),i.disableActionable=a,i.selectOnFocus=h,i._fromFocusCell=!0,null===(r=e[a?"cell":"target"])||void 0===r||r.focus({preventScroll:!0}),i.disableActionable=i.selectOnFocus=!1,delete i._fromFocusCell,e}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(e){const t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}catchFocus(){}internalNextPrevCell(e=!0){const t=this,n=t._focusedCell;return n?t.focusCell({id:n.id,columnId:t.columns.getAdjacentVisibleLeafColumn(n.column,e,!0).id}):null}navigateRight(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?Dv.PREV_CELL:Dv.NEXT_CELL):this.internalNextPrevCell(!this.rtl)}navigateLeft(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(this.rtl?Dv.NEXT_CELL:Dv.PREV_CELL):this.internalNextPrevCell(Boolean(this.rtl))}internalNextPrevRow(e,t=!0,n=!0){const r=this,i=r._focusedCell;if(!i)return!1;const s=r.store["get"+(e?"Next":"Prev")](i.id,!1,t);return s?r.focusCell({id:s.id,columnId:i.columnId,scroll:{x:!1}}):(e||!n||i.isColumnHeader||(this.clearFocus(),this.getHeaderElement(i.columnId).focus()),!1)}navigateDown(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(Dv.DOWN):this.internalNextPrevRow(!0,!1)}navigateUp(){var e;return null!==(e=arguments[0])&&void 0!==e&&e.fromKeyMap?this.focusCell(Dv.UP):this.internalNextPrevRow(!1,!1)}get widgetClass(){}},Jb=e=>class extends(e||Qe){static $name="GridResponsive";static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const t=this,n=Object.keys(W.assign({},t.responsiveLevels));let r=null,i=99995,s=null;return n.forEach((n=>{let o=t.responsiveLevels[n];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)s=n;else if(e<o){const t=o-e;t<i&&(i=t,r=n)}})),r||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const n=this,r=n.getClosestBiggerLevel(t),i=n.getClosestBiggerLevel(e);if(0===t||r!==i){const s=n.responsiveLevels[i];["number","string"].includes(typeof s)||n.applyState(s),n.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),n.element.classList.remove("b-responsive-"+r),n.element.classList.add("b-responsive-"+i),n.trigger("responsive",{level:i,width:e,oldLevel:r,oldWidth:t})}}get widgetClass(){}};const Qb={string:1,number:1},eC={dataset:1,batch:1};var tC=e=>class extends(e||Qe){static $name="GridSelection";static configurable={selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{},selectionDisabled:!1};construct(e){this._selectedCells=[],this._selectedRows=[],super.construct(e),null!=e&&e.selectedRecords&&(this.selectedRecords=e.selectedRecords)}getDefaultGridSelection(e){return"GridSelection"===e.$name?e.configurable.selectionMode:e.superclass?this.getDefaultGridSelection(e.superclass):void 0}changeSelectionMode(e){const t=this;return t.selectionMode?(W.assign(t.selectionMode,e),t.selectionMode):(t.$defaultGridSelection=t.getDefaultGridSelection(t.constructor),new Proxy(e,{set(e,n,r){const i=W.assign({},e);return e[n]=r,t.updateSelectionMode(e,i),!0}}))}updateSelectionMode(e,t=this.$defaultGridSelection){var n;const r=this,{columns:i,checkboxSelectionColumn:s}=r,o={},{rowReorder:a}=r.features;for(const n in e)e[n]!=t[n]&&(o[n]=e[n]);if(o.column&&(e.cell=!0,e.multiSelect=!0),o.cell&&(e.checkboxOnly=!1),!1===o.cell&&(e.column=!1),o.alwaysMultiSelect&&(e.multiSelect=!0,e.deselectOnClick=!0),o.checkboxOnly&&(e.checkbox||(e.checkbox=!0),e.cell=!1),!1===o.checkbox&&(o.checkboxOnly=!1,o.showCheckAll=!1),o.showCheckAll&&(e.checkbox=e.checkbox||!0,e.multiSelect=!0),(o.includeChildren||o.includeParents||o.showCheckAllInGroupRows)&&(e.multiSelect=!0,r.features.group&&(e.includeParents=e.showCheckAllInGroupRows)),e.checkbox&&null!==(n=r.features.group)&&void 0!==n&&n.enabled&&"boolean"==typeof o.showCheckAllInGroupRows&&r.renderRows(),!1===o.multiSelect&&(e.column=e.showCheckAll=e.dragSelect=e.includeChildren=e.includeParents=e.alwaysMultiSelect=e.showCheckAllInGroupRows=!1),!1===o.deselectOnClick&&(e.alwaysMultiSelect=!1),o.dragSelect&&(null!=a&&a.enabled&&!0!==a.gripOnly&&(a.showGrip=a.gripOnly=!0),e.multiSelect=!0,r._selectionListenersDetachers={}),!1===o.dragSelect&&r._selectionListenersDetachers&&r.removeDragListeners(),r.isConfiguring||!t||void 0===o.cell&&void 0===o.deselectFilteredOutRecords&&void 0===o.multiSelect||r.deselectAll(),o.rowNumber){if(!i.findRecord("type","rownumber")){const t=r.isGanttBase?{type:"sequence",text:""}:{type:"rownumber"};i.insert(0,{...t,..."object"==typeof e.rowNumber?e.rowNumber:{}}),r._selectionAddedRowNumberColumn=!0}}else!1===o.rowNumber&&r._selectionAddedRowNumberColumn&&(i.remove(i.findRecord("type","rownumber")),delete r._selectionAddedRowNumberColumn);(e.checkbox!==(null==t?void 0:t.checkbox)||e.checkbox&&e.showCheckAll!==(null==t?void 0:t.showCheckAll))&&(r.isConfiguring?r.shouldInitCheckboxSelection=!0:(t&&r.deselectAll(),r.initCheckboxSelection())),t&&e.checkbox&&t.checkbox&&e.checkboxIndex!==t.checkboxIndex&&s&&s.parent.insertChild(s,i.getAt(r.checkboxSelectionColumnInsertIndex)),r.trigger("selectionModeChange",W.clone(e)),r.afterSelectionModeChange(e)}afterConfigure(){const e=this;e.shouldInitCheckboxSelection&&(e.shouldInitCheckboxSelection=!1,e.initCheckboxSelection()),e.scrollManager.ion({scroll:({event:t,deltaY:n})=>{0!==n&&e.onSelectionDrag(t)}}),super.afterConfigure()}initCheckboxSelection(){const e=this,{selectionMode:t,columns:n,checkboxSelectionColumn:r}=e,{checkbox:i}=t;if(r&&(e.checkboxSelectionColumn=null,n.remove(r),r.destroy()),i){var s,o;const r=kv.getColumnClass("check"),a=!0===i?null:i;if(!r)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const l=e.checkboxSelectionColumn=new r(W.assign({id:`${e.id}-selection-column`,width:null!==(s=e.features.rowReorder)&&void 0!==s&&s.showGrip?"5em":"4em",field:null,sortable:!1,filterable:!1,groupable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:null===(o=e.items)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.region,showCheckAll:t.showCheckAll,draggable:!1,resizable:!1,ariaLabel:e.L("L{Checkbox.toggleSelection}"),widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},a),n,{isSelectionColumn:!0});l.meta.depth=0,l._grid=e;const d=l.renderer;l.setData("renderer",(t=>{t.value=e.isSelected(t.record),d.call(l,t)})),l.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e}),n.insert(e.checkboxSelectionColumnInsertIndex,l),n.acceptChanges()}}get checkboxSelectionColumnInsertIndex(){const{columns:e}=this;let{checkboxIndex:t}=this.selectionMode;return t?"string"==typeof t&&(t=e.indexOf(e.getById(t))):t=e.indexOf(e.findRecord("type","rownumber"))+1,t}beforeColumnsChange(){0===this.columns.count&&this.deselectAll(!1,!0)}afterColumnsChange({type:e,action:t,changes:n,columns:r,column:i}){const{_selectedCells:s}=this;if(null!=s&&s.length&&(!r&&i&&(r=[i]),"move"===e||null!=n&&n.hidden||null!=n&&n.region||"add"===t||"remove"===t)){var o,a;let e=s.map((e=>({id:e.id,columnId:e._column.id})));("remove"===t||null!=n&&null!==(o=n.hidden)&&void 0!==o&&o.value)&&null!==(a=r)&&void 0!==a&&a.length&&(e=e.filter((e=>!r.some((t=>e.columnId===t.id))))),this.deselectAll(!1,!0),this.selectCells({cells:e,scrollIntoView:!1})}}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(e){return null!=e&&e.isCollection?(e.owner||(e.owner=this),e):ho.new(e,{owner:this})}updateSelectedRecordCollection(e){e.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:e=[],removed:t}){this.selectedRecordCollection._fromSelection!==this&&(e=e.filter((e=>this.isSelectable(e))),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:e,deselectedRecords:t}))}changeSelectedRecordCollectionSilent(e){this.selectedRecordCollection._fromSelection=this;const t=e(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,t}bindStore(e){var t;this.detachListeners("selectionStoreFilter"),e.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null===(t=super.bindStore)||void 0===t||t.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({source:e}){const t=this,n=t.selectedRows.filter((t=>!(e.indexOf(t,!1,!0)>-1))),r=t.prepareSelection(t.selectionMode.deselectFilteredOutRecords?n:[]);if(t.isCellSelectionMode){const{deselectedCells:n}=t.prepareSelection(t._selectedCells.filter((t=>!e.records.includes(t.record))));null!=n&&n.length&&(r.deselectedCells=(r.deselectedCells||[]).concat(n))}(r.deselectedCells.length||r.deselectedRecords.length)&&(t.performSelection(r,!1),t.updateCheckboxHeader())}onStoreRecordIdChange({record:e,oldValue:t}){var n;null===(n=super.onStoreRecordIdChange)||void 0===n||n.call(this,...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove({action:e,records:t,isCollapse:n}){var r;if(null===(r=super.onStoreRemove)||void 0===r||r.call(this,...arguments),!n&&"filter"!==e){const e=this,n=t.filter((t=>e.isSelected(t))),r=e.prepareSelection(n);if(e.isCellSelectionMode){const{deselectedCells:n}=e.prepareSelection(e.getSelectedCellsForRecords(t));null!=n&&n.length&&(r.deselectedCells=(r.deselectedCells||[]).concat(n))}(n.length||r.deselectedCells.length)&&e.performSelection(r)}}onStoreDataChange({action:e,source:t}){var n;const r=this,{selectionMode:i}=r;let s;if(null===(n=super.onStoreDataChange)||void 0===n||n.call(this,...arguments),"pageLoad"===e)i.preserveSelectionOnPageChange||(s=r.prepareSelection(null,null,!0)),r.updateCheckboxHeader();else if(eC[e]){const e=[];if(!1===i.preserveSelectionOnDatasetChange)s=r.prepareSelection(null,null,!0);else{e.push(...r.changeSelectedRecordCollectionSilent((e=>e.match(t.storage))));for(const n of r._selectedCells)t.getById(n.id)||e.push(n);s=r.prepareSelection(e)}}s&&(s.deselectAll||s.deselectedCells.length||s.deselectedRecords.length||s.selectedCells.length||s.selectedRecords.length)&&(r.performSelection(s,!1),r.updateCheckboxHeader())}onStoreRemoveAll(){var e;null===(e=super.onStoreRemoveAll)||void 0===e||e.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:e,record:t,checkbox:n}){const r=this,{multiSelect:i}=r.selectionMode,s=!i&&e,o=s||e?null:[t],a=e?[t]:null;r._isCheckboxSelecting=!0,t.isGroupHeader&&r.selectionMode.showCheckAllInGroupRows&&(e?a:o).splice(0,1,...t.groupChildren),e&&!ir.shiftKeyDown&&(r._lastSelectionChecked=t),e&&i&&r._lastSelectionChecked&&ir.shiftKeyDown?r.performSelection(r.internalSelectRange(r._lastSelectionChecked,t,!0)):!1===r.performSelection(r.prepareSelection(o,a,s,!0))&&(n.checked=!n.checked),r._isCheckboxSelecting=!1}updateCheckboxHeader(){const e=this,{selectionMode:t,checkboxSelectionColumn:n,store:r}=e;if(t.checkbox&&n){var i;if(!e.hideHeaders&&!e._isCheckAllSelecting&&t.showCheckAll&&n.headerCheckbox){const t=e.isAllRecordsSelected();n.headerCheckbox.checked!==t&&(n.suspendEvents(),n.headerCheckbox.checked=t,n.resumeEvents())}if(t.showCheckAllInGroupRows&&null!==(i=r.groupRecords)&&void 0!==i&&i.count){const t=[...new Set(e.selectedRecords.map((e=>e.instanceMeta(r).groupParent)))].filter((t=>{var n;return null==t||null===(n=t.groupChildren)||void 0===n?void 0:n.every((t=>e.isSelected(t)))}));n.suspendEvents();for(const i of r.groupRecords){const r=e.getCell({record:i,column:n});r&&(r.widget.checked=t.includes(i))}n.resumeEvents()}}}isAllRecordsSelected(){return this.store.count&&!this.store.some((e=>this.isSelectable(e)&&!this.isSelected(e)))}onCheckAllChange({checked:e}){const t=this;t._isCheckboxSelecting=t._isCheckAllSelecting=!0,t[e?"selectAll":"deselectAll"](t.store.isPaged&&t.selectionMode.preserveSelectionOnPageChange),t._isCheckboxSelecting=t._isCheckAllSelecting=!1}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(e){const t=this,n="scroll"===e.type,{_selectionStartCell:r,lastPointerMoveEvent:i}=t;if(n&&!t._isSelectionDragging)return;if(ir.isMouseDown()||t.onSelectionEnd(),!r)return;const{items:s,_lastSelectionDragRegion:o}=t;let a,l,d;if(n&&i){const e=document.elementFromPoint(i.clientX,i.clientY),n=null==e?void 0:e.closest(".b-grid-cell");n&&(l=t._lastSelectionDragRegion,d=t.normalizeCellContext({columnId:n.dataset.columnId,record:t.store.getById(n.parentElement.dataset.id)}))}else{var c,u;a=t.getCellDataFromEvent(e,!0),l=null===(c=a)||void 0===c?void 0:c.column.region,d=(null===(u=a)||void 0===u?void 0:u.cellSelector)&&t.normalizeCellContext(a.cellSelector),a&&(t.lastPointerMoveEvent=e)}if(d&&!d.equals(t._lastSelectionDragCell,!0)){if(t._isSelectionDragging||t.enableScrollingCloseToEdges(s),t._clearSelectionOnSelectionDrag&&!r.equals(d,!0)&&(t.deselectAll(),delete t._clearSelectionOnSelectionDrag),o&&l!==o){var h;const e=t.subGrids[o],n=t.subGrids[l],r=e.scrollable,i=n.scrollable,a=s.indexOf(e)-s.indexOf(n)<0;if(i.x=a?0:i.maxX,a?r.x<r.maxX-1:r.x>1)return;const d=null===(h=t.scrollManager._activeScroll)||void 0===h?void 0:h.horizontal;d&&d.element!==i.element&&d.stopScroll(!0)}t._lastSelectionDragRegion=l,t._lastSelectionDragCell=d,t._isSelectionDragging=!0;const e=t._lastSelectionDragChange=t.internalSelectRange(r,d,t.isRowNumberSelecting(d)||t.isRowNumberSelecting(r));e.deselectedCells=e.deselectedCells.filter((e=>!t.isCellSelected(e))),e.deselectedRecords=e.deselectedRecords.filter((e=>!t.isSelected(e))),t.hoveredCell=null,t.refreshGridSelectionUI(e),t.trigger("dragSelecting",e)}}onSelectionEnd(){const e=this,t=e._lastSelectionDragChange;e._isSelectionDragging&&!e._selectionStartCell.equals(e._lastSelectionDragCell,!0)&&t&&e.performSelection(t,!1),e.disableScrollingCloseToEdges(e.items),e._isSelectionDragging=!1,e._lastSelectionDragChange=e._lastSelectionDragCell=e._lastSelectionDragRegion=null,e.removeDragListeners()}removeDragListeners(){const{_selectionListenersDetachers:e}=this;var t;e&&(null===(t=e.selectiondrag)||void 0===t||t.call(e),delete this._selectionListenersDetachers.selectiondrag)}onHandleElementClick(e){const t=this;t.selectionMode.rowNumber&&e.target.closest(".b-rownumber-header")?(e.handled=!0,t.store.count&&t.store.some((e=>!t.isSelected(e)))?t.selectAll():t.deselectAll()):t.selectionMode.column&&e.target.matches(".b-grid-header-text-content,.b-grid-header-text")&&(e.handled=!0,t.selectColumn(e,e.ctrlKey)),super.onHandleElementClick(e)}selectColumn(e,t=!1){const n=this,{store:r}=n,{columnId:i}=n.getHeaderDataFromEvent(e);if(0===r.count)return;n._shiftSelectRange=null,e.shiftKey||(n._shiftSelectColumn=i);const s=e.shiftKey&&n._shiftSelectColumn||i,o=n.internalSelectRange(n.normalizeCellContext({id:r.first.id,columnId:s}),n.normalizeCellContext({id:r.last.id,columnId:i}));t&&!o.selectedCells.some((e=>!n.isCellSelected(e)))&&(o.deselectedCells=o.selectedCells,o.selectedCells=[]),t||(o.deselectedCells=n._selectedCells),n.cleanSelectionChange(o),n.performSelection(o)}isSelected(e){var t,n;return this.selectionMode.showCheckAllInGroupRows&&null!==(t=e)&&void 0!==t&&t.isGroupHeader?e.groupChildren.every((e=>this.isSelected(e))):(null!==(n=e)&&void 0!==n&&n.id&&(e=e.id),!!Qb[typeof e]&&this.selectedRows.some((t=>t.id===e)))}isCellSelected(e,t){return e=this.normalizeCellContext(e),this.isCellSelectionMode&&this._selectedCells.some((t=>e.equals(t,!0)))||t&&this.isSelected(e)}isSelectable(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}get selectedRows(){return[...this._selectedRows]}set selectedRows(e){this.selectRows(e)}spliceSelectedRecords(e,t,n){const r=this;if("number"==typeof t){const i=[...r.selectedRecords];i.splice(e,t,...nt.asArray(n)),r.performSelection(r.prepareSelection(null,i,!0,!0))}else r.performSelection(r.prepareSelection(t,n,!1,!0))}selectRow(e){"number"!=typeof e&&"string"!=typeof e&&!e.isModel&&"record"in e||(e={records:[e]}),W.assignIf(e,{scrollIntoView:!0}),this.selectRows(e)}selectRows(e){(!e||Array.isArray(e)||e.isModel||"number"==typeof e||!("records"in e)&&!("record"in e))&&(e={records:nt.asArray(e)||[]});const t=this,{store:n}=t,r=[],{records:i=(e.record?[e.record]:[]),column:s=t.columns.visibleColumns[0],scrollIntoView:o,addToSelection:a=arguments[1]}=e;for(let e of i)e=n.getById(e),e&&r.push(e);if(a||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(null,r,!a,!0)),r.length&&o)return t.scrollRowIntoView(r[0].id,{...o,column:s})}selectAll(e=!1){const{store:t}=this,n=(t.isGrouped?t.getAllDataRecords():t.records).filter((e=>!e.isSpecialRow));this.performSelection(this.prepareSelection(null,n,!1,!0),!0,e)}deselectAll(e=!1,t=!1){const{store:n}=this,r=e?(n.isGrouped?n.getAllDataRecords():n.records).filter((e=>!e.isSpecialRow)):null;this.performSelection(this.prepareSelection(r,null,!e),!0,t)}deselectRow(e){this.deselectRows(e)}deselectRows(e){const{store:t}=this,n=nt.asArray(e).map((e=>t.getById(e))).filter((e=>e));this.performSelection(this.prepareSelection(n))}selectRange(e,t,n=!1){const r=this,{store:i}=r,s=r.internalSelectRange(i.getById(e),i.getById(t),!0);r._shiftSelectRange=null,r.performSelection(s)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(e){this.selectCells([e])}get selectedCells(){return[...this._selectedCells]}set selectedCells(e){this.selectCells(e)}get selectedCellCSSSelector(){const e=this.selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectCell(e){var t;return("id"in e||"row"in e||"record"in e||"rowIndex"in e)&&(e={cell:e},e=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},e)),null===(t=this.selectCells(e))||void 0===t?void 0:t[0]}selectCells(e){Array.isArray(e)&&(e={cells:e});const t=this,{cells:n=(e.cell?[e.cell]:[]),scrollIntoView:r=!0,addToSelection:i=!1,silent:s=!1}=e,o=t.prepareSelection(null,n,!i);return i||(t._shiftSelectRange=null),t.performSelection(o,!0,s),r&&t.scrollRowIntoView(n[0].id,{...r,column:n[0].columnId}),t.isCellSelectionMode?o.selectedCells:o.selectedRecords}deselectCell(e){var t;return null===(t=this.deselectCells([e]))||void 0===t?void 0:t[0]}deselectCells(e){const t=this.prepareSelection(e);return this.performSelection(t),this.isCellSelectionMode?t.deselectedCells:t.deselectedRecords}toggleSelection(e){const t=this,{_focusedCell:n,selectionMode:r}=t,i=t.isRowNumberSelecting(n),s=t.isCellSelected(n,!0);if(!0===r.selectOnKeyboardNavigation||n.isActionable)return!1;t.performSelection(t.prepareSelection(s?n:null,s?null:n,!r.multiSelect,i)),e.preventDefault()}selectCellRange(e,t){this.performSelection(this.internalSelectRange(e,t))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(e){var t,n;const{deselectedRecords:r,deselectedCells:i,selectedCells:s,deselectedCellRecords:o}=e,a=null===(t=e.selectedRecords)||void 0===t?void 0:t.map((e=>e.id)),l=null===(n=e.selectedCellRecords)||void 0===n?void 0:n.map((e=>e.id));return null!=r&&r.length&&null!=a&&a.length&&(e.deselectedRecords=r.filter((e=>!a.includes(e.id)))),null!=i&&i.length&&null!=s&&s.length&&(e.deselectedCells=i.filter((e=>!s.some((t=>e.equals(t,!0)))))),o.length&&(l.length||null!=a&&a.length)&&(e.deselectedCellRecords=o.filter((e=>!l.includes(e.id)&&!a.includes(e.id)))),e}getSelectedCellsForRecords(e){return this._selectedCells.filter((t=>t.id&&e.some((e=>e.id===t.id))))}delayUntilMouseUp(e){const t=Jt.on({element:this.selectionDragMouseEventListenerElement,blur:n=>e(n,t),mouseup:n=>e(n,t),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return!0===this.selectionMode.cell}isRowNumberSelecting(...e){return this.selectionMode.rowNumber&&!e.some((({column:{type:e}})=>"rownumber"!==e&&"sequence"!==e))}selectionShouldIncludeChildren(e){var t;const{includeChildren:n,multiSelect:r}=this.selectionMode;return("always"===n||!0===n&&this._isCheckboxSelecting)&&r&&!e.isLeaf&&(null===(t=e.allChildren)||void 0===t?void 0:t.length)}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(e){this._isKeyboardRangeSelecting=!0,this["navigate"+e](),this._isKeyboardRangeSelecting=!1}onCellNavigate(e,t,n,r){var i;const{selectionMode:s,_selectionListenersDetachers:o}=e,{multiSelect:a,alwaysMultiSelect:l,deselectOnClick:d,dragSelect:c}=s,{ctrlKeyDown:u,shiftKeyDown:h}=ir,g=ir.isMouseDown(),m=ir.isMouseDown(2),p=ir.currentMouseDown||ir.currentKeyDown;if(n=e.normalizeCellContext(n),e.selectionDisabled||!r||-1===n.rowIndex||null!==(i=n.record)&&void 0!==i&&i.isGroupHeader||null!=p&&p.fromKeyMap&&!s.selectOnKeyboardNavigation||e.columns.getById(n.columnId)===e.checkboxSelectionColumn||s.checkboxOnly||!0===(null==p?void 0:p.handled)&&!e._fromFocusCell)return;h||(e._isAddingToSelection=(u||l)&&a,e._selectionStartCell=n),a&&c&&g&&!o.selectiondrag&&!e.preventDragSelect&&(o.selectiondrag=Jt.on({name:"selectiondrag",element:e.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:e})),e.preventDragSelect=!1;const f=e._selectionStartCell,v=e._isAddingToSelection;if((h&&g||e._isKeyboardRangeSelecting)&&f&&a)e.performSelection(e.internalSelectRange(f,n,e.isRowNumberSelecting(f,n)));else{var y;let t,r=!1,i=!0;if(e.isCellSelected(n,!0)){if(m)return;if(v||d)t=[n],i=!1;else if(e.selectedRecords.length+(e.isCellSelectionMode?e._selectedCells.length:0)<=1)return;r=d||a}t||v||(t=null,c&&r&&o.selectiondrag&&(e._clearSelectionOnSelectionDrag=!0));const s=(r,s)=>{var o;if(null==s||s(),!Zl.dragging){if((null==r||null===(o=r.target)||void 0===o?void 0:o.nodeType)===Node.ELEMENT_NODE){const e=new Dv(r.target);if(null!=e&&e.grid&&!e.equals(n,!0))return}h||(e._shiftSelectRange=null),e.performSelection(e.prepareSelection(t,i&&[n],null===t,i&&e.isRowNumberSelecting(n)))}};if(null!==(y=e.features.rowReorder)&&void 0!==y&&y.isDragging)return;r?e.delayUntilMouseUp(s):s()}}prepareSelection(e,t,n=!1,r=!1){const i=this,{_isSelectionDragging:s,store:o}=i,{includeParents:a,selectRecordOnCell:l}=i.selectionMode,d=[],c=n?i._selectedCells:[],u=[],h=n?i._selectedRows:[],g=nt.keyBy(h,"id",(()=>1)),m=n?i.selectedRecords.filter((e=>!g[e.id])):[];let p=[];if(!n&&e)for(const t of nt.asArray(e)){const e=i.normalizeCellContext(t),n=(null==e?void 0:e.record)||(t.isModel?t:o.getById(e.id));if(!e.isSpecialRow&&(c.push(e),n&&!g[n.id]&&(s||i.isSelected(n)?(h.push(n),g[n.id]=1):l&&i.selectedRecordCollection.get(n.id)&&!m.some((e=>e.id===n.id))&&m.push(n),i.selectionShouldIncludeChildren(n))))for(const e of n.allChildren)g[e.id]||!s&&!i.isSelected(e)||(h.push(e),g[e.id]=1)}if(t){const e={};for(const n of nt.asArray(t)){const t=i.normalizeCellContext(n),s=(null==t?void 0:t.record)||(n.isModel?n:o.getById(t.id));if(!t.isSpecialRow&&(i.isCellSelectionMode&&!r&&d.push(t),(i.isRowSelectionMode||r)&&!e[s.id]&&(u.push(s),e[s.id]=1,i.selectionShouldIncludeChildren(s))))for(const t of s.allChildren)e[t.id]||(u.push(t),e[t.id]=1)}l&&d.length&&(p=nt.unique(d.map((e=>e.record))).filter((t=>!e[t.id])))}if(a&&(h.length||u.length)){const e=[...h,...u];nt.unique(e.filter((t=>t.parent&&!t.allChildren.some((t=>e.includes(t))))).map((e=>e.parent))).forEach((e=>i.toggleParentSelection(e,u,h)))}return i.cleanSelectionChange({selectedCells:d,selectedRecords:u,deselectedCells:c,deselectedRecords:h,deselectAll:n,action:null!=u&&u.length||null!=d&&d.length?"select":"deselect",selectedCellRecords:p,deselectedCellRecords:m})}toggleParentSelection(e,t,n){if(!e||e.isRoot)return;const r=this.isSelected(e),i=t.includes(e),s=n.includes(e),o=e=>this.isSelected(e)&&!n.includes(e)||t.includes(e);"some"===this.selectionMode.includeParents?e.allChildren.some(o)?r&&!s||i||t.push(e):r&&!s&&n.push(e):r?s||i||!e.allChildren.some((e=>n.includes(e)))||n.push(e):i||e.allChildren.every(o)&&t.push(e),e.parent&&this.toggleParentSelection(e.parent,t,n)}internalSelectRange(e,t,n=!1){const r=this,i=r.isRowSelectionMode||n,s=r.prepareSelection(r._shiftSelectRange,r.getRange(e,t,i),!1,n);return r._shiftSelectRange=s["selected"+(i?"Records":"Cells")],s}getRange(e,t,n=!1){const r=this,{store:i}=r,s=r.normalizeCellContext(e),o=r.normalizeCellContext(t),a=Math.min(s.rowIndex,o.rowIndex),l=Math.max(s.rowIndex,o.rowIndex),d=[],c=Math.min(s.columnIndex,o.columnIndex),u=Math.max(s.columnIndex,o.columnIndex);if(-1===a||-1===l)throw new Error("Record not found in selectRange");if(n){const e=i.getRange(a,l+1,!1);o.rowIndex<s.rowIndex&&e.reverse(),d.push(...e)}else for(let e=a;e<=l;e++)for(let t=c;t<=u;t++)d.push({rowIndex:e,columnIndex:t});return d.map((e=>r.normalizeCellContext(e)))}performSelection(e,t=!0,n=!1){const r=this,{selectedRecords:i=[],selectedCells:s=[],selectedCellRecords:o=[],deselectedRecords:a=[],deselectedCells:l=[],deselectedCellRecords:d=[],action:c}=e,u=[...i,...o],h=[...a,...d],g=r.isRowSelectionMode;if(!1===r.trigger("beforeSelectionChange",{mode:g?"row":"cell",action:c,selected:u,deselected:h,selection:r.selectedRecords,selectedCells:s,deselectedCells:l,cellSelection:r.selectedCells}))return r.removeDragListeners(),!1;if(r._selectedCells===l)r._selectedCells=[];else{const e=[];for(const t of r._selectedCells)l.some((e=>t.equals(e,!0)))||s.some((e=>t.equals(e,!0)))||e.push(t);r._selectedCells=e}if(e.deselectedRecords=[...a],a===r._selectedRows)r._selectedRows.length=0,r.changeSelectedRecordCollectionSilent((e=>e.clear()));else{const e=[],t=[],n=nt.keyBy(h,"id",(()=>1));for(const i of r.selectedRecords)n[i.id]||(r.isSelected(i)?e.push(i):t.push(i));r._selectedRows=e,r.changeSelectedRecordCollectionSilent((n=>n.values=[...e,...t]))}if(s.length)for(const e of s)r._selectedCells.some((t=>t.equals(e,!0)))||r._selectedCells.push(e);i.length&&(r._selectedRows.push(...i.filter((e=>!r._selectedRows.some((t=>t.id===e.id))))),r.changeSelectedRecordCollectionSilent((e=>e.add(...i)))),o.length&&r.changeSelectedRecordCollectionSilent((e=>e.add(...o))),t&&r.refreshGridSelectionUI(e),r.afterSelectionChange(e),n||r.triggerSelectionChangeEvent(e)}refreshGridSelectionUI({selectedRecords:e,selectedCells:t,deselectedRecords:n,deselectedCells:r}){const i=this,{checkboxSelectionColumn:s}=i;null==s||s.suspendEvents(),i.updateGridSelectionRecords(e,!0),i.updateGridSelectionRecords(n,!1),i.updateCheckboxHeader(),null==s||s.resumeEvents(),i.isCellSelectionMode&&(i.updateGridSelectionCells(t,!0),i.selectionMode.column&&i.updateGridSelectionColumns(t)),i.updateGridSelectionCells(r,!1)}updateGridSelectionRecords(e,t){const{checkboxSelectionColumn:n}=this;if(null!=e&&e.length)for(let r=0;r<e.length;r++){const i=this.getRowFor(e[r]);i&&(i.toggleCls("b-selected",t),i.setAttribute("aria-selected",t),!n||n.hidden||e[r].isSpecialRow||(i.getCell(n.id).widget.checked=t))}}updateGridSelectionCells(e,t){if(null!=e&&e.length)for(let n=0;n<e.length;n++){const r=this.getCell(e[n]);r&&(r.setAttribute("aria-selected",t),r.classList.toggle("b-selected",t))}}updateGridSelectionColumns(e){const{count:t}=this.store;for(const r of this.columns.visibleColumns){var n;null===(n=r.element)||void 0===n||n.classList.toggle("b-selected",(null==e?void 0:e.filter((e=>e.columnId===r.id)).length)===t)}}triggerSelectionChangeEvent(e){const{selectedRecords:t=[],selectedCells:n=[],selectedCellRecords:r=[],deselectedRecords:i=[],deselectedCells:s=[],deselectedCellRecords:o=[]}=e,a=[...t,...r],l=[...i,...o],d=this.isRowSelectionMode;this.trigger("selectionChange",{mode:d?"row":"cell",action:e.action,selected:a,deselected:l,selection:this.selectedRecords,selectedCells:n,deselectedCells:s,cellSelection:this.selectedCells})}doDestroy(){var e;(null===(e=this.selectedRecordCollection)||void 0===e?void 0:e.owner)===this&&this.selectedRecordCollection.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const e in this._selectionListenersDetachers)this._selectionListenersDetachers[e]();super.doDestroy()}get widgetClass(){}};const nC=e=>e.columns.suspendEvents(),rC=e=>e.columns.resumeEvents(),iC=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},sC=(e,t)=>e.stateSortIndex-t.stateSortIndex;var oC=e=>class extends(e||Qe){static $name="GridState";static configurable={statefulEvents:["subGridCollapse","subGridExpand","horizontalScrollEnd","verticalScrollEnd","stateChange","selectionChange","collapseAllGroups","expandAllGroups","treeGroupChange"],stateSettings:{restoreUnconfiguredColumns:!0}};updateStore(e,t){var n;null===(n=super.updateStore)||void 0===n||n.call(this,e,t),this.detachListeners("stateStoreListeners"),null==e||e.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(e,t){var n;null===(n=super.updateColumns)||void 0===n||n.call(this,e,t),this.detachListeners("stateColumnListeners"),e.ion({name:"stateColumnListeners",change:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateRowManager(e,t){var n;null===(n=super.updateRowManager)||void 0===n||n.call(this,e,t),this.detachListeners("stateRowManagerListeners"),e.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",toggleGroup:({allRecords:e})=>!e&&this.triggerUpdate(),thisObj:this})}getState(){var e;const t=this,n=t.element.style.cssText,r={rowHeight:t.rowHeight};if(n&&(r.style=n),t.selectedCell){const{id:e,columnId:n}=t.selectedCell;r.selectedCell={id:e,columnId:n}}!t.disableGridColumnIdWarning&&t.columns.find((e=>e.meta.generatedId===e.id))&&console.warn("Column(s) without id detected. When saving and restoring state, columns without a configured id can be restored incorrectly."),r.selectedRecords=t.selectedRecords.map((e=>e.id)),r.columns=t.columns.allRecords.map((e=>e.getState())),r.store=t.store.state,r.scroll=t.storeScroll();const i=null===(e=t.features.treeGroup)||void 0===e?void 0:e.levels;(null==i?void 0:i.length)>0&&!i.some((e=>!e.fieldName))&&(r.treeGroupLevels=t.features.treeGroup.levels.map((e=>e.fieldName))),r.subGrids={},t.eachSubGrid((e=>{const t=r.subGrids[e.region]=r.subGrids[e.region]||{};e.isPainted?null==e.flex&&(t.width=e.width):null!=e.config.width?t.width=e.config.width:t.flex=e.config.flex,t.collapsed=e.collapsed??!1,t.collapsed&&(t._beforeCollapseState=e._beforeCollapseState)}));for(const[e,t]of Object.entries(this.features)){const n=t.state;n&&(r.features=r.features||{},r.features[e]=n)}return r}applyState(e){const t=this,{columns:n}=t;if(e=Object.assign({},e),t.suspendRefresh(),"columns"in e){let r=!1,i=!1;n.suspendEvents(),t.eachSubGrid(nC);const s=new Set,o=new Map;e.columns.forEach(((e,a)=>{var l;const d=n.lookupStateColumns(e).filter((e=>!s.has(e)))[0]??((null===(l=t.stateSettings)||void 0===l?void 0:l.restoreUnconfiguredColumns)&&n.add({id:e.id,type:e.type,field:e.field})[0]);if(d){s.add(d),o.set(e,d);const n=d.generation;"region"in e&&!(e.region in t.subGrids)&&(delete e.region,delete e.locked),d.applyState(e),r=r||d.generation!==n,d.stateSortIndex=a,d.allIndex!==a&&(i=r=!0)}})),e.columns.forEach((t=>{if("parentId"in t){const n=e.columns.find((e=>e.id===t.parentId)),r=o.get(n),i=o.get(t);r&&i&&i.parent!==r&&r.insertChild(i)}})),r&&t.eachSubGrid(iC),i&&(t.eachSubGrid((e=>{e.columns.records.sort(sC),e.columns.allRecords.sort(sC)})),n.sort({fn:sC,ascending:!0})),t.isPainted&&r&&t.renderContents(),n.resumeEvents(),t.eachSubGrid(rC),delete e.columns}"subGrids"in e&&(t.eachSubGrid((t=>{if(t.region in e.subGrids){const n=e.subGrids[t.region];"width"in n?t.width=n.width:"flex"in n&&(t.flex=n.flex),"collapsed"in n&&(t.collapsed=n.collapsed,t._beforeCollapseState=n._beforeCollapseState)}t.clearWidthCache()})),delete e.subGrids),"store"in e&&(t.store.state=e.store,delete e.store);const r=e.scroll;if(delete e.scroll,"features"in e){for(const t in e.features){var i,s;null===(i=this.features[t])||void 0===i||null===(s=i.setConfig)||void 0===s||s.call(i,e.features[t])}delete e.features}W.assign(t,e),"treeGroupLevels"in e&&t.features.treeGroup&&(t.features.treeGroup.levels=e.treeGroupLevels),t.resumeRefresh(!0),t.whenVisible((()=>t.applyScrollState(r)))}applyScrollState(e){const t=this;t.eachSubGrid((e=>e.refreshFakeScroll())),e&&(t.restoreScroll(e),e.scrollTop&&t.element.querySelectorAll(".b-resize-monitored").forEach((e=>{const t=oc.fromElement(e);t&&t.onElementResize(e)})))}get widgetClass(){}};const aC=Promise.resolve(),lC={block:"nearest"};class dC extends Md{static configurable={propagate:!1,overflowX:"hidden-scroll",yScroller:null};updateYScroller(e){null==e||e.addScroller(this)}scrollIntoView(e,t=lC){const{xDelta:n,yDelta:r}=this.getDeltaTo(e,t);let i=n||r?this.scrollBy(n,r,t):aC;if(t.highlight||t.focus){const s=i;i=i.then((()=>{var i;s.cancelled||(e=e instanceof Ot?e:(null===(i=t.elementAfterScroll)||void 0===i?void 0:i.call(t))??e,t.highlight&&(e instanceof Ot?e.translate(-n,-r).highlight():Yn.highlight(e)),t.focus&&e.focus({preventScroll:!0}))})),i.cancel=()=>{var e;return null===(e=s.cancel)||void 0===e?void 0:e.call(s)}}return i}scrollBy(e,t,n){const r=t&&this.yScroller.scrollBy(0,t,n),i=e&&super.scrollBy(e,0,n),s=Promise.all([i,r]);return s.cancel=()=>{var e,t;null==i||null===(e=i.cancel)||void 0===e||e.call(i),null==r||null===(t=r.cancel)||void 0===t||t.call(r),s.cancelled=!0},null!=i&&i.cancel&&null!=r&&r.cancel&&(n.force=!0),s}scrollTo(e,t,n){const r=null!=t&&this.yScroller.scrollTo(null,t,n),i=null!=e&&super.scrollTo(e,null,n);n&&n.animate||this.syncPartners();const s=Promise.all([i,r]);return s.cancel=()=>{var e,t;null==i||null===(e=i.cancel)||void 0===e||e.call(i),null==r||null===(t=r.cancel)||void 0===t||t.call(r),s.cancelled=!0},null!=i&&i.cancel&&null!=r&&r.cancel&&(n.force=!0),s}get viewport(){const e=Ot.from(this.element);return(this.yScroller?e.intersect(Ot.from(this.yScroller.element)):e)||new Ot(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}suspendEvents(){var e;super.suspendEvents(),null===(e=this.yScroller)||void 0===e||e.suspendEvents()}resumeEvents(){var e;super.resumeEvents(),null===(e=this.yScroller)||void 0===e||e.resumeEvents()}}dC._$name="SubGridScroller";const cC=(e,t)=>e+t.getBoundingClientRect().width;class uC extends oc{static $name="SubGrid";static type="subgrid";static defaultConfig={insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,defaultBindProperty:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:dC,hasCalculatedWidth:null,sealedColumns:null};static configurable={element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,collapsed:!1,resizable:null,role:"rowgroup"};static delayable={hideOverlayScroller:1e3};construct(e){super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),G.isTestEnv&&(this.hideOverlayScroller.delay=50)}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null===(e=t.fakeScroller)||void 0===e||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach((e=>e.remove())),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:n}=e.element.style,r={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return n?r.flex=n:t&&(r.width=t),r}changeHeader(e){return new this.headerClass(W.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(W.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0,n=!0){this.splitterElements.forEach((n=>null==n?void 0:n.classList[t?"add":"remove"](e))),n&&this.scrollable.eachPartner((({scroller:n})=>{var r,i;n.owner!==this&&(null===(r=(i=n.owner).toggleSplitterCls)||void 0===r||r.call(i,"b-hover"===e?"b-partner-splitter-hover":"b-hover",t,!1))}))}hideSplitter(){this.splitterElements.forEach((e=>e.classList.add("b-hide-display"))),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach((e=>e.classList.remove("b-hide-display"))),this.$showingSplitter=!0}changeElement(e,t){const{region:n}=this;return super.changeElement({tabIndex:-1,"aria-label":`${n} subgrid`,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${n}`]:n,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:n}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map(((t,n)=>({role:"gridcell","aria-colindex":n+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}})))}}changeVirtualScrollerElement(){const e=Yn.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=Yn.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[c.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[c.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[c.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[c.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return Yn.createElement(this.splitterConfig)}changeScrollerSplitter(){return Yn.createElement(this.splitterConfig)}changeFooterSplitter(){return Yn.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach((e=>Jt.on({element:e,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t}))),t._collapsed&&t.collapse())}toggleHeaders(e){const t=this;if(e)t.headerSplitter.remove(),t.header.element.remove(),t.scrollable.removePartner(t.header.scrollable,"x");else{const{grid:e}=t;if(!t.isConfiguring){const n=2*e.items.indexOf(t);Yn.insertAt(e.headerContainer,t.headerSplitter,n),Yn.insertAt(e.headerContainer,t.header.element,n),t.refreshHeader()}t.scrollable.addPartner(t.header.scrollable,"x")}}refreshHeader(){this.header.refreshContent()}refreshColumnHeader(e){this.header.refreshColumn(e)}refreshFooter(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}get childItems(){return[this.header,this.footer]}fixCellWidths(e){const{visibleColumns:t}=this.columns;let n=e.firstElementChild,r=0;for(;n;){const e=t[r],{element:i}=e;e.minWidth&&(n.style.minWidth=Yn.setLength(e.minWidth)),e.maxWidth&&(n.style.maxWidth=Yn.setLength(e.maxWidth)),e.flex?e.childLevel&&i?(n.style.flex=`0 0 ${i.getBoundingClientRect().width}px`,n.style.width=""):(n.style.flex=e.flex,n.style.width=""):e.width?n.style.width=Yn.setLength(e.width):n.style.flex=n.style.width=n.style.minWidth="",n=n.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}get headerScrollWidth(){return[...this.header.contentElement.children].reduce(cC,0)||this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:n,footer:r}=e;if(!e.collapsed){if(e.flex)n.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);e.clearWidthCache();let i=e.width;if(!i&&e.hasCalculatedWidth){i=0;for(const t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=`${i}px`,n.width=i,r&&(r.width=i)}e.handleHorizontalScroll(!1)}}fixRowWidthsInSafariEdge(){if(c.isSafari){const e=this,{region:t,header:n}=e,r=n.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const n=e.getElement(t);n&&(n.style.width=`${r}px`)})),n.headersElement.style.width=`${r}px`}}set width(e){const t=this;var n,r;(t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize(),t.isExpanding||t.isCollapsing||t.isConfiguring)||(null===(n=(r=t.grid).syncSplits)||void 0===n||n.call(r,(n=>n.subGrids[t.region]&&(n.subGrids[t.region].width=e))))}get width(){return super.width}set flex(e){const t=this;var n,r;(t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize(),t.isExpanding||t.isCollapsing||t.isConfiguring)||(null===(n=(r=t.grid).syncSplits)||void 0===n||n.call(r,(n=>n.subGrids[t.region]&&(n.subGrids[t.region].flex=e))))}get flex(){return super.flex}onInternalResize(e,t,n,r,i){const s=this,{grid:o}=s;if(super.onInternalResize(...arguments),null!=o&&o.isPainted){var a;if(s.syncSplitterButtonPosition(),t!==r)s.trigger("beforeInternalResize",s),null===(a=o.beforeSubGridInternalResize)||void 0===a||a.call(o,s),o.trigger("horizontalScroll",{grid:o,subGrid:s,scrollLeft:s.scrollable.scrollLeft,scrollX:s.scrollable.x}),o.trigger("horizontalScrollEnd",{subGrid:s,scrollLeft:s.scrollable.scrollLeft}),s.fakeScroller&&s.refreshFakeScroll(),o.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge();n!==i&&o.onHeightChange(),s.trigger("afterInternalResize",s)}}syncParallelSplitters(e){const t=this,{grid:n}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const r=n.getSubGrid(n.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=`${e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:e}=this;return new Ot(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach((t=>Yn.toggleClasses(t,["b-disabled"],!e)))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((e=>{e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&(this.grid.hideHeaders?this.scrollable.hasOverflow("x"):this.header.scrollable.hasOverflow("x"))}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:n,virtualScrollerWidth:r,header:i,footer:s,scrollable:o}=e,a=[...i.contentElement.children].reduce(cC,0);o.scrollWidth=a,t.style.setProperty("--total-column-width",`${e.headerScrollWidth}px`),n.style.width=t.style.width,n.style.flex=t.style.flex,n.style.minWidth=t.style.minWidth,n.style.maxWidth=t.style.maxWidth,i.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(r.style.width=`${o.scrollWidth||0}px`,e.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:n,grid:r}=e;e.fakeScroller=new Md({element:n,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),r.hideHorizontalScrollbar||(t.addPartner(e.fakeScroller,"x"),e.refreshFakeScroll()),r.hideHeaders||t.addPartner(e.header.scrollable,"x"),r.hideFooters||t.addPartner(e.footer.scrollable,"x")}onSubGridScrollEnd(e){const t=this,{grid:n}=t;t.scrollingToCenter=null==e?void 0:e.scrollingToCenter,t.scrolling=!1,t.handleHorizontalScroll(!1),Yn.scrollBarWidth||(n.virtualScrollers.classList.remove("b-scrolling"),t.hideOverlayScroller()),n.trigger("horizontalScrollEnd",{subGrid:t})}onSubGridScroll(e){this.scrollingToCenter=null==e?void 0:e.scrollingToCenter,this.handleHorizontalScroll()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}handleHorizontalScroll(e=!0){const t=this,{grid:n}=t;!t.scrolling&&e&&(t.scrolling=!0,Yn.scrollBarWidth||(n.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),n.trigger("horizontalScroll",{subGrid:t,grid:n,scrollLeft:t.scrollable.scrollLeft,scrollX:t.scrollable.x,scrollingToCenter:null==t?void 0:t.scrollingToCenter})}scrollColumnIntoView(e,t){const{columns:n,header:r}=this,i=r.scrollable;if(e=e instanceof Rv?e:n.get(e)||n.getById(e)||n.getAt(e)){const n=r.getHeader(e.id);if(n)return i.scrollIntoView(Ot.from(n,null,!0),t)}}onAddRow({source:e=this.grid.rowManager,rows:t}){var n;const r=this,{region:i}=r,s=r.rowElementConfig,o=document.createDocumentFragment(),a=null===(n=e.rows[t[t.length-1].index+1])||void 0===n?void 0:n.elements[i];t.forEach((e=>{const t=Yn.createElement(s);Yn.syncClassList(t,e.cls),o.appendChild(t),e.addElement(i,t),r.fixCellWidths(t)})),r.fixRowWidthsInSafariEdge(),r.element.insertBefore(o,a||r.insertRowsBefore)}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=Yn.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return null===(e=this.grid)||void 0===e?void 0:e.rowManager}changeCollapsed(e){return Boolean(e)}updateCollapsed(e,t){this.isConfiguring||(this._fromPropertyUpdate=!0,e?this.collapse():this.expand(),this._fromPropertyUpdate=!1)}async collapse(e,t=!1){const n=this,{grid:r}=n,{partners:i}=r;if(e=e&&Object.keys(r.subGrids).length<=2,!r.rendered||!0!==n._collapsed||n._fromPropertyUpdate){if(r.partners&&!t)return r.isSyncingFromPartner=!0,i.forEach((e=>e.isSyncingFromPartner=!0)),await Promise.all([n.collapse(e,!0),...i.map((t=>{var r;return null===(r=t.subGrids[n.region])||void 0===r?void 0:r.collapse(e,!0)}))]),i.forEach((e=>e.isSyncingFromPartner=!1)),void(r.isSyncingFromPartner=!1);if(e){if(r.element.classList.add("b-subgrid-width-transition"),await r.runWithTransition((()=>n._collapseInternal(!0)),!0),n.isDestroyed)return;r.element.classList.remove("b-subgrid-width-transition")}else n._collapseInternal(!1);r.trigger("subGridCollapse",{subGrid:n}),r.afterToggleSubGrid({subGrid:n,collapsed:!0}),n.isCollapsing=!1,r.trigger("afterInternalResize")}}async _collapseInternal(e=!1){var t;const n=this,{grid:r,element:i}=n,s=r.getSubGrid(r.getNextRegion(n.region)),o=n.splitterElement?n:n.previousSibling;let{_beforeCollapseState:a}=n,l=0;if(n.isCollapsing=!0,r.eachSubGrid((e=>{e!==n&&!e._collapsed&&++l})),null===(t=r.syncSplits)||void 0===t||t.call(r,(t=>{var r;return null===(r=t.subGrids[n.region])||void 0===r?void 0:r.collapse(e)})),0===l){if(!s)return;await s.expand()}let d=!1;var c;(a||(a=n._beforeCollapseState={},n.width&&(d=!0),a.width=n.width,a.elementWidth=i.style.width,""!==i.style.flex&&(a.flex=i.style.flex,n.header.element.style.flex=i.style.flex=""),""===s.element.style.flex&&(a.nextRegionWidth=s.width,s.width="",s.flex=`1 1 ${a.nextRegionWidth}px`),i.classList.add("b-grid-subgrid-collapsed"),n.virtualScrollerElement.classList.add("b-collapsed"),n.header.element.classList.add("b-collapsed"),n.footer.element.classList.add("b-collapsed"),n._collapsed=!0,n.width="",d||n.syncParallelSplitters(!0)),n.isDestroyed)||d&&(r.refreshVirtualScrollbars(),n.syncParallelSplitters(!0),null===(c=o.startSplitterButtonSyncing)||void 0===c||c.call(o))}async expand(e,t=!1){const n=this,{grid:r}=n,{partners:i}=r;if(e=e&&Object.keys(r.subGrids).length<=2,!r.rendered||!0===n._collapsed||n._fromPropertyUpdate){if(i&&!t)return r.isSyncingFromPartner=!0,i.forEach((e=>e.isSyncingFromPartner=!0)),await Promise.all([n.expand(e,!0),...i.map((t=>{var r;return null===(r=t.subGrids[n.region])||void 0===r?void 0:r.expand(e,!0)}))]),i.forEach((e=>e.isSyncingFromPartner=!1)),void(r.isSyncingFromPartner=!1);if(e){if(r.element.classList.add("b-subgrid-width-transition"),await r.runWithTransition((()=>n._expandInternal(!0)),!0),n.isDestroyed)return;r.element.classList.remove("b-subgrid-width-transition")}else n._expandInternal(!1);n.columns.clearCaches(),r.trigger("subGridExpand",{subGrid:n}),r.afterToggleSubGrid({subGrid:n,collapsed:!1}),n.isExpanding=!1,r.trigger("afterInternalResize")}}async _expandInternal(e=!1){var t;const n=this,{grid:r,_beforeCollapseState:i}=n,s=r.getSubGrid(r.getNextRegion(n.region)),o=n.splitterElement?n:n.previousSibling;if(n.isExpanding=!0,null===(t=r.syncSplits)||void 0===t||t.call(r,(t=>{var r;return null===(r=t.subGrids[n.region])||void 0===r?void 0:r.expand(e)})),null!=i){let e=!1;n.width!==i.elementWidth&&(e=!0),i.nextRegionWidth&&(s.width=i.nextRegionWidth,s.flex=null),n.element.classList.remove("b-grid-subgrid-collapsed"),n._collapsed=!1,n.virtualScrollerElement.classList.remove("b-collapsed"),n.header.element.classList.remove("b-collapsed"),n.footer.element.classList.remove("b-collapsed"),i.flex?(n.width=i.width,n.header.flex=n.flex=i.flex,n.footer.flex=i.flex,n._width=null):n.width=i.elementWidth,e&&(o.stopSplitterButtonSyncing(),n.syncParallelSplitters(!1)),delete n._beforeCollapseState}}hide(){var e,t;return null===(e=this.header)||void 0===e||e.hide(),null===(t=this.footer)||void 0===t||t.hide(),this.hideSplitter(),super.hide()}show(){var e,t;const n=this;return null===(e=n.header)||void 0===e||e.show(),null===(t=n.footer)||void 0===t||t.show(),n.region!==n.grid.regions[n.grid.regions.length-1]&&n.showSplitter(),super.show()}}uC.initClass(),uC._$name="SubGrid";var hC=e=>class extends(e||Qe){static $name="GridSubGrids";static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){var t;const n=this,r=new Set;for(const t of n.columns){const{region:n}=t;n&&(e[n]||(e[n]={}),r.add(n))}e.normal&&W.isEmpty(e.normal)&&(e.normal={flex:1}),null!==(t=e.normal)&&void 0!==t&&t.width&&delete e.normal.flex;for(const t of r)n.createSubGrid(t,e[t]);return n.items=n.subGrids,e}createSubGrid(e,t=null){const n=this,r=n.columns.chain((t=>t.region===e),["region"]),i=uC.mergeConfigs({type:"subgrid",id:`${n.id}-${e}Subgrid`,parent:n,grid:n,region:e,headerClass:n.headerClass,footerClass:n.footerClass,columns:r,weight:e,scrollable:{yScroller:n.scrollable}},t||n.subGridConfigs[e]);let s=!1;i.flex||i.width||0===i.flex||0===i.width||(i.width=r.totalFixedWidth,s=!0);const o=n.subGrids[e]=uC.create(i);return o.element.style.setProperty("--total-column-width",r.totalFixedWidth),o.hasCalculatedWidth=s,e===n.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(e){if(e.isSubGrid){const t=this,{items:n,headerContainer:r,virtualScrollers:i,footerContainer:s}=t,o=2*n.indexOf(e);t.hideHeaders&&!t.columns.some((e=>e.flex))||(Yn.insertAt(r,e.headerSplitter,o),Yn.insertAt(r,e.header.element,o)),Yn.insertAt(i,e.scrollerSplitter,o),Yn.insertAt(i,e.virtualScrollerElement,o),Yn.insertAt(s,e.footerSplitter,o),Yn.insertAt(s,e.footer.element,o),n.forEach(((e,t)=>{t<n.length-1&&e.showSplitter()})),0===o&&t.emptyTextEl&&e.element.appendChild(t.emptyTextEl)}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:t}=this;delete this.subGrids[e.region],nt.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((n,r)=>{n.isSubGrid&&e.call(t||n,n,r++)}))}callEachSubGrid(e,...t){let n=null;return this.items.forEach(((r,i)=>{if(r.isSubGrid&&r[e]){const s=r[e](...t);0===i&&(n=s)}})),n}get regions(){return this.items.map((e=>e.region))}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Rv?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let n=e instanceof uC?e.region:e;return t[1]===n&&(n=t[0]),this.subGrids[n].splitterElement}get widgetClass(){}};const gC={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,ChecklistFilterCombo:{search:"Search",selectAll:"Select All",removeAll:"Remove All",filtersSet:e=>1===e?"1 filter set":`${e} filters set`,noItems:"No results found",placeholder:"Filter...",apply:"Apply"},ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns",showName:e=>"Show column"+(e.text?` ${e.text}`:""),hideName:e=>"Hide column"+(e.text?` ${e.text}`:"")},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:e=>`Move before "${e}"`,moveAfter:e=>`Move after "${e}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Split:{split:"Split",unsplit:"Unsplit",horizontally:"Horizontally",vertically:"Vertically",both:"Both"},LockRows:{lockRow:"Lock row",unlockRow:"Unlock row"},ActionColumn:{rowActions:"Row actions"},Column:{columnLabel:e=>`${e.text?`${e.text} column. `:""}SPACE for context menu${e.sortable?", ENTER to sort":""}`,cellLabel:new String},WidgetColumn:{rowWidgets:"Row widgets"},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset",toggleName:e=>`Toggle ${e.text||"value"}`},RatingColumn:{cellLabel:e=>{var t;return`${e.text?e.text:""} ${null!==(t=e.location)&&void 0!==t&&t.record?`rating : ${e.location.record.get(e.field)||0}`:""}`}},RowNumberColumn:{rowNumber:"Row number"},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",printSettings:"Print settings",print:"Print",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},RowExpander:{loading:"Loading",expand:"Expand row details",collapse:"Collapse row details",columnDescription:"Toggle row details"},TreeGroup:{group:"Group by",stopGrouping:"Stop grouping",stopGroupingThisColumn:"Ungroup column"}};yr.publishLocale(gC);const mC=new Promise((e=>e())),pC="GridBase:store",fC={block:"nearest",inline:"nearest"},vC={dataset:1,pageLoad:1,filter:1},yC={hidden:1,mergeCells:1,region:1},bC=Object.freeze([]),CC=(e,t)=>e-t;class wC extends(Xu.mixin(kr,Yi,Gb,qb,Zb,Jb,tC,oC,hC,fg)){static $name="GridBase";static type="gridbase";static get delayable(){return{bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,disableAutoHeightWarning:null,disableNoIDWarning:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideHeaders:null,hideFooters:!0,cellEllipsis:!0,hideHorizontalScrollbar:null,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"$store",rowHeight:null,preserveScroll:!1,animateTreeNodeToggle:!G.isTestEnv,columnLines:!0,rowLines:!0,fixedRowHeight:null,formulaProviders:null}}static get defaultConfig(){return{defaultRowHeight:45,fullRowRefresh:!0,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},resizeToFitIncludesHeader:!0,animateRemovingRows:!0,animateFilterRemovals:null,disableGridRowModelWarning:null,disableGridColumnIdWarning:null,headerClass:Nb,footerClass:Ab,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:Vb,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}static bindStoreChangeset=!0;finishConfigure(e){const t=this,{initScroll:n}=t;t.initScroll=()=>!t.scrollInitialized&&n.call(t),G.isTestEnv&&(t.bufferedAfterColumnsResized.delay=50,t.bufferedElementResize.delay=50),super.finishConfigure(e),Cr.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),Cr.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),ir.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"internalOnSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",t.fixElementHeightsBuffer,t),t.setGridClassList(t.element.classList),t.verticalScroller.classList.remove("b-content-element","b-auto-container"),t.bodyWrapElement.classList.remove("b-auto-container-panel"),CSS.supports("selector(:has(*))")&&t.element.classList.add("b-supports-has")}internalOnSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return null==t||t.destroy(),e?Xg.new({element:this.element,owner:this},e):null}doDestroy(){var e;const t=this;t.detachListeners(pC),null===(e=t.scrollManager)||void 0===e||e.destroy();for(const e of Object.values(t.features)){var n;null===(n=e.destroy)||void 0===n||n.call(e)}t._focusedCell=null,t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach((t=>{if(t.disabled||!1===t)return;let n;n=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:`b-${t instanceof Qe?t.$$name:t.constructor.name}`,n&&e.add(n.toLowerCase())}))}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:n,fillLastColumn:r,positionMode:i,showDirty:s}=this;return{class:{[`b-grid-${i}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!n,"b-autoheight":e,"b-fill-last-column":r,"b-show-dirty":s,"b-show-dirty-during-edit":null==s?void 0:s.duringEdit}}}async recomposeInternal(){let e;const{isConstructing:t}=this;if(t||(e=this.storeScroll()),await super.recomposeInternal(),!t){const t=[...Object.keys(e.scrollLeft).map((t=>e.scrollLeft[t])),e.scrollTop];if(Math.max(...t)){const t=this.storeScroll();var n;if(!Math.max([...Object.keys(t.scrollLeft).map((e=>t.scrollLeft[e])),t.scrollTop]))null===(n=this.restoreScroll)||void 0===n||n.call(this,e)}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:n}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"aria-labelledby":""]:`${this.id}-panel-title`,children:{headerContainer:{"aria-hidden":n,role:n?null:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":n}},bodyContainer:{className:"b-grid-body-container",role:"presentation",children:{verticalScroller:{role:"presentation",className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",role:null},footerContainer:{"aria-hidden":t,role:t?null:"row",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateCellEllipsis(e){this.element.classList.toggle("b-use-ellipsis",e)}updateHideHeaders(e){var t;e=Boolean(e),null===(t=this.headerContainer)||void 0===t||t.classList.toggle("b-hidden",e),this.eachSubGrid((t=>t.toggleHeaders(e)))}updateHideFooters(e){var t;e=Boolean(e),null===(t=this.footerContainer)||void 0===t||t.classList.toggle("b-hidden",e),this.eachSubGrid((t=>{t.scrollable[e?"removePartner":"addPartner"](t.footer.scrollable,"x")}))}updateHideHorizontalScrollbar(e){e=Boolean(e),this.eachSubGrid((t=>{t.virtualScrollerElement.classList.toggle("b-hide-display",e),this.isConfiguring||(t.scrollable[e?"removePartner":"addPartner"](t.fakeScroller,"x"),e||t.refreshFakeScroll())}))}changeColumns(e,t){const n=this;if(!e&&t)return n.isDestroying?t.owner===n&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===n&&t.destroy(),e.grid=n,e;if(Array.isArray(e)){if(t){const n=t.allRecords.slice();t.data=e;for(const e of n)t.includes(e)||e.destroy();return t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return kv.new({grid:n,owner:n},e)}updateColumns(e,t){var n,r;const i=this,{formulaProviders:s}=i;var o,a;if(null===(n=super.updateColumns)||void 0===n||n.call(this,e,t),e.ion({refresh:i.onColumnsChanged,sort:i.onColumnsChanged,change:i.onColumnsChanged,move:i.onColumnsChanged,thisObj:i}),e.ion((o=i.onColumnsResized,a=i,{update:({store:e,record:t,changes:n})=>{let r=!0;return("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&(r=o.call(a,{store:e,record:t,changes:n})),r}})),c.isTouchDevice&&(i.touch=!0,e.forEach((e=>{const{touchConfig:t}=e;t&&e.applyState(t)}))),null===(r=i.bodyElement)||void 0===r||r.setAttribute("aria-colcount",e.visibleColumns.length),s){const{modelClass:t}=i.store;e.forEach((e=>{e.data.formula&&e.field&&t.fieldMap[e.field]&&(t.fieldMap[e.field].formulaProviders=s)}))}}onColumnsChanged({type:e,action:t,changes:n,record:r,records:i,isMove:s}){const o=this,{columns:a,checkboxSelectionColumn:l}=o,d=n&&Object.keys(n),c=1===(null==d?void 0:d.length);if(s=!0===s||s&&Object.values(s).some((e=>e)),o.beforeColumnsChange({type:e,action:t,changes:n,column:r,columns:i}),s||"refresh"===e&&"batch"!==t&&"sort"!==t||"update"===t&&c&&"parentIndex"in n||"sort"===t&&a.isSyncingDataOnLoad)return;const u="add"===t&&i.some((e=>e.region&&!o.subGrids[e.region]));if(!o.isConfiguring&&(u||o.isPainted&&(!s||"remove"!==t))){if("add"===t)for(const e of i){const{region:t}=e;var h;if(!o.subGrids[t])o.add(o.createSubGrid(t,null===(h=o.subGridConfigs)||void 0===h?void 0:h[t]))}else if("update"===t){const i=d[0];if(("width"in n||"minWidth"in n||"maxWidth"in n||"flex"in n)&&!("region"in n)){const{region:i}=r;return a.visibleColumns.forEach((e=>{e.region===i&&e.repaintOnResize&&o.refreshColumn(e)})),void o.afterColumnsChange({type:e,action:t,changes:n,column:r})}if("text"in n&&c)return void r.subGrid.refreshHeader();if("hidden"in n){const e=o.getSubGridFromColumn(r.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}else if(c&&!(i in yC)&&!r.hidden&&!r.subGrid.collapsed)return r.subGrid.refreshHeader(),void o.refreshColumn(r)}else"remove"===t&&i.forEach((e=>{var t;return null===(t=e.freeColumnWidgets)||void 0===t?void 0:t.call(e)}));if("dataset"===t||"batch"===t||"update"===t&&"region"in n){const e=a.getDistinctValues("region",!0),{toRemove:t,toAdd:n}=nt.delta(e,o.regions,!0);o.remove(t.map((e=>o.getSubGrid(e)))),o.add(n.map((e=>o.createSubGrid(e,o.subGridConfigs[e]))))}if(l&&!a.includes(l)){const e=a.indexOf(a.findRecord("type","rownumber"))+1;a.insert(e,l,!0)}o._suspendRenderContentsOnColumnsChanged||o.renderContents(),o.syncFlexedSubCols(),o.bodyElement.setAttribute("aria-colcount",a.visibleColumns.length),o.afterColumnsChange({type:e,action:t,changes:n,column:r,columns:i})}}onColumnsResized({changes:e,record:t}){const n=this;if(n.isConfiguring)return;const r=Yn.setLength(t.width),i=Yn.setLength(t.minWidth),s=Yn.setLength(t.maxWidth),o=n.getSubGridFromColumn(t.id);if(o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),!t.flex||!t.childLevel){n.cellEls&&t===n.lastColumnResized||(n.cellEls=Yn.children(n.element,`.b-grid-cell[data-column-id="${t.id}"]`),n.lastColumnResized=t);for(const o of n.cellEls)"width"in e&&(o.style.width=r),"minWidth"in e&&(o.style.minWidth=i),"maxWidth"in e&&(o.style.maxWidth=s),"flex"in e&&(o.style.flex=t.flex??null)}n.resizingColumns||n.afterColumnsResized(t),n.syncFlexedSubCols()}afterColumnsResized(e){const t=this;t.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||(t.fixWidths(),t.fixRowWidthsInSafariEdge())})),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query((e=>e.flex&&e.childLevel&&e.element));if(e)for(const t of e){const e=t.element.getBoundingClientRect().width,n=Yn.children(this.element,`.b-grid-cell[data-column-id="${t.id}"]`);for(const t of n)t.style.flex=`0 0 ${e}px`}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||t.refreshFakeScroll()}))}bufferedElementResize(){this.refreshRows()}onInternalResize(e,t,n,r,i){Yn.scrollBarWidth&&t<r&&this.eachSubGrid((e=>{e.flex&&e.onElementResize(e.element)})),super.onInternalResize(...arguments),this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const n=this;if(n._isRowMeasured||n.measureRowHeight(),null==t||t.destroy(),e){const t=$b.new({grid:n,rowHeight:n.rowHeight,rowScrollMode:n.rowScrollMode||"move",autoHeight:n.autoHeight,fixedRowHeight:n.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:n}},e);return n.relayEvents(t,["beforeRenderRow","renderRow","removeRows"]),n._rowManager=null,t}}updateRowHeight(e){!this.isConfiguring&&this.rowManager&&(this.rowManager.rowHeight=e),this.element.style.setProperty("--b-grid-row-height",Yn.setLength(e))}updateFixedRowHeight(e){var t,n;e&&null!==(t=this.columns||this.peekConfig("columns"))&&void 0!==t&&null!==(n=t.some)&&void 0!==n&&n.call(t,(e=>e.autoHeight))&&console.warn("One or more columns have `autoHeight` set, which is incompatible with `fixedRowHeight`.")}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}getAsyncEventSuffixForStore(e){return this.asyncEventSuffix}bindStore(e){const t=this.getAsyncEventSuffixForStore(e),{masterStore:n}=e;e.ion({name:pC,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",clearChanges:"onStoreRecordClearChanges",startApplyChangeset:"internalOnStoreStartApplyChangeset",endApplyChangeset:"internalOnStoreEndApplyChangeset",lazyLoadStarted:"onStoreBeforeRequest",lazyLoadEnded:"onStoreAfterRequest",thisObj:this}),null==n||n.ion({name:pC,beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",lazyLoadEnded:"onStoreAfterRequest",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(pC),this.destroyStore&&e.destroy()}get $store(){return this.originalStore||this.store}changeStore(e){if(null==e)return null;var t;("string"==typeof e&&(e=Il.getStore(e)),e.isStore)||((e=W.assign({data:this.data,tree:Boolean(null===(t=this.initialConfig.features)||void 0===t?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=Wv),e=new(e.readUrl?$l:Il)(e));return e}updateStore(e,t){var n;const r=this;var i;(null===(n=super.updateStore)||void 0===n||n.call(this,e,t),t&&r.unbindStore(t),e&&(t&&r.deselectAll(),r.onStoreLoadOverride(),r.bindStore(e)),r.trigger("bindStore",{store:e,oldStore:t}),r.isDestroying||!r.isPainted||r.refreshSuspended)||(null===(i=r._rowManager)||void 0===i||i.reinitialize())}onStoreUpdateRecord({source:e,record:t,changes:n}){const r=this;if(!r.refreshSuspended)if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let i;if(t.isFieldModified("id")&&(i=r.getRowFor(t.meta.modified.id)),i=i||r.getRowFor(t),!i)return;if(r.fullRowRefresh||t.isSpecialRow){const n=e.indexOf(t);-1!==n&&i.render(n,t)}else r.columns.visibleColumns.forEach((e=>{const t=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||n[t]){const e=i.getCell(t);e&&i.renderCell(e)}}))}}refreshFromRowOnStoreAdd(e,t){const n=this,{rowManager:r}=n;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),1===n.store.count&&n.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:n,oldIndex:r,isChild:i,oldParent:s,parent:o,isMove:a,isExpand:l,isExpandAll:d}){const c=this,{rowManager:u}=c;if(!c.isPainted||d||c.refreshSuspended)return;if(l&&c.animateTreeNodeToggle)return u.insert(u.getRowFor(o).index+1,t.length);const h=a&&t.some((t=>{if(a[t.id]){const n=e.getById(t.meta.modified.parentId);return(null==n?void 0:n.isExpanded(e))&&(null==n?void 0:n.ancestorsExpanded(e))}}));if(i&&!t[0].ancestorsExpanded(e)&&!h){if(!o.isLeaf){const e=u.getRowById(o);e&&u.renderRows([e])}return}u.calculateRowCount(!1,!0,!0),e.isFiltered&&(n=e.indexOf(t[0]));const{topIndex:g,rows:m,rowCount:p}=u,f=u.topIndex+u.rowCount-1,v=n,y=n+t.length-1,b=f>=e.count-t.length-1;s||r>-1||i&&a&&Object.values(a).some((e=>e))?u.refresh():v>=g&&v<g+p?c.refreshFromRowOnStoreAdd(m[v-g],...arguments):y>=g&&y<g+p?u.refresh():(b&&n>f?u.fillBelow(c._scrollTop||0):n<g&&u.refresh(),u.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:n,exceptionType:r,error:i}){var s;const o=this;let a;switch(t){case"server":a=n.message||o.L("L{unspecifiedFailure}");break;case"exception":a="network"===r?o.L("L{networkFailure}"):(null==i?void 0:i.message)||(null==n||null===(s=n.parsedJson)||void 0===s?void 0:s.message)||o.L("L{parseFailure}")}o.applyMaskError(`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${o.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>\n                ${null!=n&&n.url?`<div class="b-grid-load-fail">${n.url}</div>`:""}\n                <div class="b-grid-load-fail">${o.L("L{serverResponse}")}</div>\n                <div class="b-grid-load-fail">${a}</div>\n            </div>`)}onStoreDataChange({action:e,changes:t,source:n,removed:r,added:i}){var s;null===(s=super.onStoreDataChange)||void 0===s||s.call(this,...arguments);const o=this,{rowManager:a}=o,{rowCount:l}=a,d=(null==r?void 0:r.length)||0;if(o.refreshSuspended||!a)return;if("filter"===e&&d&&(null==i||!i.length)&&l&&d<l&&r.every((e=>a.getRowById(e.id)))){const t=r.map((e=>a.getRowFor(e).index)).sort(CC),{length:i}=t;if(i&&t[i-1]===t[0]+i-1){const{animateRemovingRows:t}=o;o.animateRemovingRows=!o.features.cellEdit.isEditing&&o.animateFilterRemovals;const i=o.onStoreRemove({action:e,source:n,records:r});return o.animateRemovingRows=t,i}}if("dataset"===e&&(a.clearKnownHeights(),n.isTree&&n.isFiltered))return;const c=n.isGrouped&&t&&n.groupers.some((e=>e.rootFieldName in t));o.isPainted&&!c&&o.renderRows(Boolean(!(e in vC)||o.preserveScrollOnDatasetChange||n.isChained&&n.isFillingFromMaster)),o.toggleEmptyText()}onStoreRecordIdChange(){var e;null===(e=super.onStoreRecordIdChange)||void 0===e||e.call(this,...arguments)}onStoreBeforeRequest(e){this.isLockedRows||this.store.count&&this.store.lazyLoad&&(null==e||!e.isReload)||this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){var t;const{store:n}=this;return(null===(t=this.features)||void 0===t||null===(t=t.group)||void 0===t?void 0:t.enabled)&&n.isGrouped||n.tree&&!e&&n.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:e,records:t,isCollapse:n,isChild:r,isMove:i,isCollapseAll:s}){var o;if(!this.isPainted||i||s)return;null===(o=super.onStoreRemove)||void 0===o||o.call(this,...arguments);const a=this,{rowManager:l}=a;if(l.invalidateKnownHeight(t),!a.refreshSuspended)if(!a.animateRemovingRows||n||r)if(n&&a.animateTreeNodeToggle){const e=t.flatMap((e=>{const t=l.getRowFor(e);return t?t.index:bC})).sort(CC),{length:n}=e;if(n&&e[n-1]===e[0]+n-1)return l.insert(e[0],-e.length)}else if(a.needsFullRefreshOnStoreRemove(...arguments))l.refresh(),a.afterRemove(arguments[0]);else{const{rows:e}=l,r=t.reduce(((t,n)=>{const r=l.getRowById(n.id);return r&&(t=Math.min(t,e.indexOf(r))),t}),e.length);e[r]?!a.refreshSuspended&&l.renderFromRow(e[r]):l.trigger("changeTotalHeight",{totalHeight:l.totalHeight}),a.trigger("rowRemove",{isCollapse:n}),a.afterRemove(arguments[0])}else{const e=t.reduce(((e,t)=>{const n=l.getRowById(t.id);return n&&e.push(n),e}),[]);if(e.length){const t=e[0];a.isAnimating=!0,Jt.onTransitionEnd({element:t._elementsArray[0],property:"left",duration:a.transitionDuration+50,thisObj:a,handler:()=>{a.isAnimating=!1,e.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),l.refresh(),a.trigger("rowRemove"),a.afterRemove(arguments[0])}}),e.forEach((e=>e.addCls("b-removing")))}}}onFlatStoreMove({from:e,to:t}){const{rowManager:n,store:r}=this,{topIndex:i,rowCount:s}=n,[o,a]=[e,t].sort(((e,t)=>e-t)),l=r.indexOf(r.getAt(o,!0)),d=r.indexOf(r.getAt(a,!0));l>=i&&l<i+s?n.renderFromRow(n.rows[l-i]):d>=i&&d<i+s&&n.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:n}=this;if(t)n.clearKnownHeights(),n.refresh();else{const t=e.reduce(((e,[,t])=>{const n=this.getRowFor(t);return n&&e.push(n),e}),[]);n.invalidateKnownHeight(e),n.renderRows(t)}}relayStoreDataChange(e){var t;if(null===(t=this.ariaElement)||void 0===t||t.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...e,store:e.source,source:this})}onStoreRemoveAll(){var e;null===(e=super.onStoreRemoveAll)||void 0===e||e.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const n=this.rowManager.getRowFor(e);n&&t.push(n)})),this.rowManager.renderRows(t)}}onStoreRecordClearChanges({record:e}){const t=this.rowManager.getRowFor(e);t&&this.rowManager.renderRows([t])}internalOnStoreStartApplyChangeset(){this.suspendRefresh(),this.constructor.bindStoreChangeset&&this.captureScrollTargetRow()}internalOnStoreEndApplyChangeset(){this.resumeRefresh(!0),this.constructor.bindStoreChangeset&&this.restoreScrollTargetRow()}captureScrollTargetRow(){const e=this;if(e.preserveScroll){const{firstFullyVisibleRow:t,lastVisibleRow:n}=e.rowManager;if(t){e.lastVisibleRowIds=[t.id];for(let r=t.dataIndex+1;r<=n.dataIndex;r++)e.lastVisibleRowIds.push(e.rowManager.getRow(r).id);e.lastTopRowOffset=e.scrollable.getDeltaTo(t.element,{block:"start",x:!1,constrainToScrollable:!1})}}}restoreScrollTargetRow(){const e=this;let t=!1;if(e.preserveScroll){if(e.lastVisibleRowIds){e.rowManager.refresh(),e.scrollable.scrollHeight>=e.lastOverscrollHeight&&e.scrollable.y===e.lastOverscrollY?e.rowManager.fillBelow(e.scrollable.y):(e.lastOverscrollHeight=null,e.lastOverscrollY=null);const n=e.lastVisibleRowIds.find((t=>e.store.getById(t)));if(null!=n&&n!==e.rowManager.firstFullyVisibleRow.id){if(e.preserveScroll.overscroll){const r=e.scrollable.getDeltaTo(e.getRecordCoords(n),{block:"start",x:!1,constrainToScrollable:!1,edgeOffset:e.lastTopRowOffset.yDelta}).yDelta;r>e.scrollable.maxY-e.scrollable.y&&(e.scrollable.scrollHeight+=r,t=!0)}e.scrollRowIntoView(n,{block:"start",edgeOffset:e.lastTopRowOffset.yDelta,x:!1})}}e.lastVisibleRowIds=void 0,e.lastTopRowOffset=void 0,t&&(e.lastOverscrollHeight=e.scrollable.scrollHeight,e.lastOverscrollY=e.scrollable.y)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const n=this,{subGrids:r,regions:i}=n,{parent:s}=e;let o=!0;Object.entries(r).forEach((([a,l])=>{if(!l.sealedColumns&&e.draggable&&a!==e.region&&(!s&&r[e.region].columns.count>1||s&&s.children.length>1)){const s=l.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,d=n.rtl?!s:s,c=i.length>2?n.L("L{moveColumnTo}",n.optionalL(a)):n.L(d?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${a}Region`]={targetSubGrid:a,text:c,icon:"b-fw-icon b-icon-column-move-"+(d?"right":"left"),separator:o,disabled:!e.allowDrag,onItem:({item:t})=>{const i=n.columns.indexOf(r[t.targetSubGrid].columns.last);e.traverse((e=>e.region=a)),n.columns.insert(i+1,e),n.scrollColumnIntoView(e)}},o=!1}}))}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:n}=t;return e.isLocation?e:e.isModel?new Dv({grid:t,id:e.id,columnId:n.visibleColumns[0].id}):new Dv(W.assign({grid:t},e))}getCell(e){const{store:t,columns:n}=this,{visibleColumns:r}=this.columns,i=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?r.indexOf(e.column||n.getById(e.columnId)||n.get(e.field)||r[0]):e.columnIndex:e.column;return i>-1&&i<t.count&&s>-1&&s<r.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getFooterElement(e){return e.isModel&&(e=e.id),this.fromCache(`.b-grid-footer[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return Boolean(null===(e=this.features.treeGroup)||void 0===e?void 0:e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.$store.getById(t.dataset.id):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const n=Vl.get(t);return this.columns.getById(n.columnId)}updateAutoHeight(e){W.assertBoolean(e,"autoHeight")}updateColumnLines(e){W.assertBoolean(e,"columnLines"),Yn.toggleClasses(this.element,"b-no-column-lines",!e)}updateRowLines(e){Yn.toggleClasses(this.element,"b-no-row-lines",!e)}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:n}=e;t<n;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const n=this;if(n.renderingRows||!n.isVisible)return!1;const r=n.scrollable,i=Math.abs(n.virtualScrollHeight-e),s=n._bodyRectangle.height;if(i){const o=e-s-n._scrollTop<2*s||n._verticalScrollHeight&&n._verticalScrollHeight-s<n._scrollTop;r.scrollHeight=n.virtualScrollHeight=e,n.isPainted&&(n.scrolling&&!o||i<100)&&!t?n.bufferedFixElementHeights():(n.virtualScrollHeightDirty&&n.virtualScrollHeightDirty(),n.bufferedFixElementHeights.cancel(),n.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,n=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=n,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e._height=null,e.bodyContainer.style.height=n,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=Ot.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...nt.asArray(e||[]).map((e=>({element:("string"==typeof e?this.subGrids[e]:e).scrollable.element})))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...nt.asArray(e||[]).map((e=>("string"==typeof e?this.subGrids[e]:e).element))])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),c.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:n}=e;n!==t._scrollTop&&(t._scrollTop=n,t.scrolling||(t.scrolling=!0,t.eachSubGrid((e=>e.suspendResizeMonitor=!0))),t.rowManager.updateRenderedRows(n),t.afterScroll({scrollTop:n}),t.trigger("scroll",{scrollTop:n}))}onGridVerticalScrollEnd(e){this.scrolling=!1,this.eachSubGrid((e=>e.suspendResizeMonitor=!1)),this.trigger("verticalScrollEnd",e)}async scrollRowIntoView(e,t=fC){const n=this,r=t.block||"nearest",{rowManager:i}=n,s=n.store.getById(e);if(s){let e;if(n.isLockedRows&&n.syncSplits((e=>e.scrollRowIntoView(...arguments))),-1===n.store.indexOf(s))return mC;n.rowManager.topRow||await n.await("renderRows");let a=n.scrollable,l=n.getRecordCoords(s);const d=Ot.from(a.element);if(l.virtual){const c=l.block,u="nearest"!==r?t:{block:c};if(e=a.scrollIntoView(l,{block:"center"}),i.scrollTargetRecordId=s,i.updateRenderedRows(a.y,!0),l=n.getRecordCoords(s),i.lastScrollTop=a.y,l.virtual)return mC;var o;if(t.animate)a.suspendEvents(),"end"===r||"nearest"===r&&"end"===c?a.y-=d.bottom-l.bottom:("start"===r||"nearest"===r&&"start"===c)&&(a.y+=l.y-d.y),i.updateRenderedRows(a.y,!1,!0),"end"===c?a.y-=i.appendRowBuffer*i.rowHeight-1:a.y+=i.prependRowBuffer*i.rowHeight-1,a.resumeEvents(),await a.scrollIntoView(n.getRecordCoords(s),Object.assign({},t,u));else t.recursive||await e,await(null===(o=n.scrollRowIntoView)||void 0===o?void 0:o.call(n,s,Object.assign({recursive:!0},t,u)))}else{let{column:e}=t;if(e){if(e.isModel||(e=n.columns.getById(e)||n.columns.get(e)),e){a=n.getSubGridFromColumn(e).scrollable;const t=Ot.from(i.getRowFor(s).getCell(e.id));l.x=t.x,l.width=t.width}}else t=W.assign({},t,{x:!1});await a.scrollIntoView(l,t)}}}scrollColumnIntoView(e,t){e=e instanceof Rv?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e);const n=this.getSubGridFromColumn(e);return n.columns.visibleColumns.length>1?n.scrollColumnIntoView(e,t):Promise.resolve()}scrollCellIntoView(e,t){const n=this.normalizeCellContext(e);return this.scrollRowIntoView(n.id,{column:n.columnId,..."boolean"==typeof t?{animate:t}:t})}scrollToBottom(e){return this.scrollRowIntoView(this.isLockedRows?this.originalStore.last:this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this.storedScrollState={scrollTop:this.scrollable.y,scrollLeft:{}};return this.eachSubGrid((t=>{e.scrollLeft[t.region]=t.scrollable.x})),e}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{const n=e.scrollLeft[t.region];var r;null!=n&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),null===(r=t.fakeScroller)||void 0===r||r.updateX(n))})),this.restoreVerticalScroll(e)}restoreVerticalScroll(e=this.storedScrollState){const{rowManager:t}=this;t.rowCount?this.scrollable.updateY(e.scrollTop):t.ion({changeTotalHeight:()=>this.restoreVerticalScroll(e),once:!0})}beginGridMeasuring(){const e=this;if(e.element.classList.add("b-grid-measuring"),e.$measureCellElements||(e.$measureCellElements=Yn.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:c.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,n=Yn.getRootElement("string"==typeof t?document.getElementById(t):t)||document.body;e.adopt&&n.contains(e.element)||(n.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){const e=this;e.element.classList.remove("b-grid-measuring"),e.$removeAfterMeasuring&&(e.element.remove(),e.$removeAfterMeasuring=!1),e.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),n=parseFloat(Yn.getStyleValue(document.body,"zoom"))||1,r=Yn.getStyleValue(t,["height","border-top-width","border-bottom-width"]),i=parseInt(r.height),{devicePixelRatio:s}=Yn,o=n*(c.isFirefox?s/Math.max(Math.trunc(s),1):1),a=r["border-top-width"]?Math.round(o*parseFloat(r["border-top-width"])):0,l=r["border-bottom-width"]?Math.round(o*parseFloat(r["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(i)&&i?i:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=a+l,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRow(e){this.refreshRows([e])}refreshRows(e=null,t=!1){if(this.refreshSuspended)return;const{element:n,rowManager:r}=this;if(e){const t=e.flatMap((e=>r.getRowById(e)??[]));r.renderRows(t)}else n.classList.add("b-notransition"),t?r.returnToTop():r.refresh(!0),n.classList.remove("b-notransition")}refreshColumn(e,t=!0){e.isVisible&&this.runWithTransition((()=>{e.isLeaf?this.rowManager.forEach((t=>t.renderCell(t.getCell(e.id)))):e.children.forEach((e=>this.refreshColumn(e)))}),t)}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:n,virtualScrollers:r,scrollable:i,hasVerticalOverflow:s}=e,{classList:o}=r,a=!o.contains("b-hide-display"),l=Object.values(e.subGrids).some((e=>e.overflowingHorizontally)),d=l!==a;if(d&&r.classList.toggle("b-hide-display",!l),Yn.scrollBarWidth){const o=s||"scroll"===i.overflowY;t.classList.toggle("b-show-yscroll-padding",o),n.classList.toggle("b-show-yscroll-padding",o),r.classList.toggle("b-show-yscroll-padding",o),!d&&e.$virtualScrollbarsRefreshed||(e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(e.autoHeight),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e=!0){this.refreshSuspended&&! --this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,n=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(n),t.autoHeight&&t.store.count>200&&!t.autoHeightWarning&&!t.disableAutoHeightWarning&&(console.warn("Warning: 'autoHeight' is enabled for a large number of rows (200+). While 'autoHeight' provides flexibility, it should be used cautiously as it disables virtualization, leading to significant performance degradation with large datasets. Consider alternatives to maintain optimal performance."),t.autoHeightWarning=!0),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:n,footerContainer:r,rowManager:i}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader"),e.callEachSubGrid("refreshFooter"),e.renderHeader(n,t),e.renderFooter(r,t),e.fixSizes();const s=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.setPosition(s),e.renderRows()}}refreshHeaders(){this.callEachSubGrid("refreshHeader")}refreshHeader(e){e.subGrid.refreshHeader()}onPaintOverride(){}onStoreLoadOverride(){}onInternalPaint({firstPaint:e}){var t;const n=this;if(n.ariaElement.setAttribute("aria-rowcount",n.store.count+1),null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),n.onPaintOverride()||!e)return;const{rowManager:r,store:i,element:s,headerContainer:o,bodyContainer:a,footerContainer:l}=n,d=Yn.scrollBarPadElement;let c,u=0;n.role=null!=i&&i.isTree?"treegrid":"grid",n.columns.ion({change:()=>c=!0,once:!0}),n.updateResponsive(n.width,0),c&&(n.callEachSubGrid("refreshHeader",o),n.callEachSubGrid("refreshFooter",l)),n.renderHeader(o,s),n.renderFooter(l,s),Yn.append(o,d),Yn.append(l,d),Yn.append(n.virtualScrollers,d),n.refreshBodyRectangle();const h=n.bodyContainer.offsetHeight;if(n.autoHeight?(n._bodyHeight=r.initWithHeight(s.offsetHeight-o.offsetHeight-l.offsetHeight,!0),a.style.height=n.bodyHeight+"px"):(n._bodyHeight=h,r.initWithHeight(n._bodyHeight,!0)),n.eachSubGrid((e=>{e.header.maxDepth>u&&(u=e.header.maxDepth)})),o.dataset.maxDepth=u,n.fixSizes(),!i.count&&i.isLoading||n.renderRows(),n.columns.usesAutoHeight){const{fonts:e}=document;"loaded"!==(null==e?void 0:e.status)&&e.ready.then((()=>!n.isDestroyed&&n.refreshRows()))}n.initScroll(),n.initInternalEvents()}render(){const e=this;var t;(e.requireSize=Boolean(e.owner),super.render(...arguments),e.setupFocusListeners(),e.autoHeight)||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),e.splitFrom||null!==(t=e.features.split)&&void 0!==t&&t.owner||"minHeight"in e.initialConfig||"height"in e.initialConfig||parseInt(globalThis.getComputedStyle(e.element).minHeight)!==e.height||console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){super.afterColumnsChange(...arguments)}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}onConfigChange(e){super.onConfigChange(e),this.isConfiguring||this.afterConfigChange(e)}afterPluginConfigChange(){}afterConfigChange(e){}afterAddListener(e,t){}afterRemoveListener(e,t){}syncMaskCover(e=this.masked){if(e){const t="body"===e.cover&&this.rectangleOf("bodyContainer"),n=t&&Yn.scrollBarWidth&&this.rectangleOf("virtualScrollers"),{style:r}=e.element;r.marginTop=t?`${t.y}px`:"",r.height=t?`${t.height+((null==n?void 0:n.height)||0)}px`:""}}changeMasked(e,t){if(e){const t=this;"string"==typeof e&&(e={text:e}),t.isLockedRows||t.splitFrom?(e.cover=null,e.target=t.element.parentElement):(e.cover="body",e.target=t.element)}return super.changeMasked(e,t)}maskBody(e){let t;return this.bodyContainer&&(this.masked=mc.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var t,n,r;null===(t=this.emptyTextEl)||void 0===t||t.remove();const i="object"==typeof e;i&&(e=nt.asArray(e)),this.emptyTextEl=Yn.createElement({parent:null===(n=this.firstItem)||void 0===n?void 0:n.element,className:"b-empty-text",[i?"children":null!==(r=e)&&void 0!==r&&r.includes("<")?"html":"text"]:e})}toggleEmptyText(){const e=this,t=e.isLockedRowsView?e.store.$master:e.store,n=!(t.count>0||t.isLoading||t.isCommitting);e.element.classList.toggle("b-grid-empty",n),e.announceAriaLive(n?e.emptyText:"")}updateReadOnly(e,t){if(super.updateReadOnly(e,t),!this.isConfiguring)for(const t of this.columns.bottomColumns){var n;null===(n=t.updateReadOnly)||void 0===n||n.call(t,e)}}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:n}=this,r=n.getInlineData(e),i=n.getCurrentConfig(e)||t.store;return r.length&&(t.data=r),i&&n.originalModelClass===Wv&&delete i.modelClass,W.isEmpty(i)||(t.store=i),t.store&&delete t.store.data,t}_animationSuspendedCounter=0;suspendAnimations(){this._animationSuspendedCounter++}resumeAnimations(){this._animationSuspendedCounter--}async runWithTransition(e,t){const n=this;if(!t||!n.isVisible||0!==n._animationSuspendedCounter||!1===n.enableEventAnimations)return e();n.isAnimating=!0,await n.executeAndAwaitAnimations(n.element,e),n.isAnimating=!1,n.isDestroyed||n.isAnimating||n.trigger("transitionEnd")}async waitForReadiness(){var e,t;await(null===(e=this.features.treeGroup)||void 0===e||null===(t=e.waitForReadiness)||void 0===t?void 0:t.call(e))}}wC.initClass(),G.setVersion("grid","6.2.2"),wC._$name="GridBase";class SC extends wC{static $name="Grid";static type="grid"}SC.initClass(),SC._$name="Grid";class DC extends SC{static $name="TreeGrid";static type="treegrid";static get configurable(){return{store:{tree:!0}}}updateStore(e,t){if(e&&!e.tree&&!e.isTree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,t)}}DC.initClass(),DC._$name="TreeGrid";class EC extends bm{static type="groupbar";static $name="GroupBar";static configurable={selectedCls:"not-used",ariaLabel:"L{TreeGroup.group}",itemTpl(e){return N.encodeHtml(N.capitalize(e.getValue(this.displayField)))}};construct(){super.construct(...arguments);const e=this.grid=this.up("gridbase",!0);if(!e)throw new Error("GroupBar must be used inside a Grid component");e.ion({paint:this.onGridPaint,once:!0,thisObj:this})}onGridPaint(){const e=this,{grid:t}=e,{treeGroup:n,group:r,columnReorder:i,tree:s}=t.features;if(!n&&!r)throw new Error("GroupBar widget requires the TreeGroup or Group feature to be present");i.usingGroupBarWidget=!0,e.store=new Il({fields:["cls","ascending"],internalListeners:{add:e.onStoreChanged,remove:e.onStoreChanged,thisObj:e}}),t.ion({[s?"treeGroupChange":void 0]:e.onTreeGroupChanged,beforeColumnDropFinalize:e.onBeforeColumnDropFinalize,columnDrag:e.onColumnDrag,columnDragStart:e.onColumnDragStart,columnDrop:e.onColumnDrop,thisObj:e}),s?e.onTreeGroupChanged({levels:n.levels}):(t.store.ion({group:e.onGroupChanged,thisObj:e}),e.onGroupChanged())}onStoreChanged({records:e}){var t;const n=this,{grid:r}=n;r.isConstructing||"b-drop-target"===(null==e||null===(t=e[0])||void 0===t?void 0:t.cls)||(n.ignoreGroupChange=!0,r.features.treeGroup?r.features.treeGroup.levels=n.store.map((({field:e})=>e)):n.store.count>0?r.store.group(n.store.records[0].field):r.store.clearGroupers(),n.ignoreGroupChange=!1)}onGroupChanged(){const{groupers:e}=this.grid.store;this.store.data=e?e.map((e=>this.grid.columns.get(e.field))):[]}onTreeGroupChanged({levels:e}){if(!this.ignoreGroupChange){if(e.some((e=>e instanceof Function&&!e.fieldName)))throw new Error("GroupBar only supports column grouping");this.store.data=(e||[]).map((e=>(e=e.fieldName||e,this.grid.columns.get(e))))}}onColumnDragStart({column:e}){this.store.add({id:"placeholder",cls:"b-drop-target",text:this.grid.features.treeGroup?void 0:e.text})}onColumnDrag({context:e,column:t,event:n}){n.target.closest(".b-groupbar")&&(e.valid=t.groupable)}onBeforeColumnDropFinalize({column:e,event:t}){const n=this.grid.features.tree;t.target.closest(".b-groupbar")&&e.groupable&&(n&&e.isTreeColumn||(this.store.getById("placeholder").remove(),n||this.store.removeAll(!0),this.store.add(e)))}onColumnDrop(){var e;null===(e=this.store.getById("placeholder"))||void 0===e||e.remove()}}EC.initClass(),EC._$name="GroupBar";class xC extends Dm{static $name="TreeCombo";static type="treecombo";static configurable={multiSelect:!0,picker:{type:"treegrid",minWidth:"35em",disableGridRowModelWarning:!0,selectionMode:{row:!0,checkbox:!0}},chipView:{itemTpl:e=>N.xss`${e.name}`,scrollable:{overflowX:"hidden-scroll"}}};changePicker(e,t){return this.isDestroying||e.columns||(console.warn("No `columns` provided for the TreeCombo `picker` config"),e.columns=[{type:"tree"}]),super.changePicker(e?{...e,selectedRecordCollection:this.valueCollection}:e,t)}updateMultiSelect(e){super.updateMultiSelect(...arguments),this.picker.selectionMode.multiSelect=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._picker&&(this.picker.readOnly=e)}}xC.initClass(),xC._$name="TreeCombo";class RC extends Iv{compositeField=!0;static $name="DurationColumn";static type="duration";static isGanttColumn=!0;static fields=[{name:"decimalPrecision"},"abbreviatedUnit"];static defaults={abbreviatedUnit:null,min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,t){return e.getValue(this.field)-t.getValue(this.field)}};construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:n,largeStep:r,decimalPrecision:i=this.grid.durationDisplayPrecision}=this;return W.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:n,decimalPrecision:i,largeStep:r})}get durationUnitField(){return`${this.field}Unit`}get formatter(){const e=this,{format:t,_formatter:n,decimalPrecision:r}=e;return n&&e._lastFormat===t||(e._formatter=of.getLocalizedFormatter(r?{maximumFractionDigits:r}:e._lastFormat=t)),e._formatter}roundValue(e){const t=Math.pow(10,this.decimalPrecision??this.grid.durationDisplayPrecision??1);return Math.round(e*t)/t}formatValue(e,t){e instanceof qs&&(t=e.unit,e=e.magnitude),e=this.roundValue(e);const n=this.abbreviatedUnit?"getShortNameOfUnit":"getLocalizedNameOfUnit";return super.formatValue(e)+(this.abbreviatedUnit?"":" ")+xi[n](t,1!==e)}defaultRenderer({value:e,record:t,isExport:n,dataField:r}){const i=typeof e,s="number"===i?e:null==e?void 0:e.magnitude,o="number"===i?t.getValue(this.durationUnitField):null==e?void 0:e.unit;return"number"!=typeof s?n?"":null:(!this.fieldWarningShown&&r instanceof Es&&"totalslack"!==this.type&&(console.warn(`Warning: Setting 'duration' as the 'field' value for the '${this.type}' column is not allowed since the field needs both a duration magnitude and unit, as supplied by for example the 'fullDuration' field. Additionally, a custom implemented field for the duration column should return a duration object to work correctly.`),this.fieldWarningShown=!0),this.formatValue(s,o))}toClipboardString({record:e}){var t;return null===(t=e.getValue(this.field))||void 0===t?void 0:t.toString()}fromClipboardString({string:e,record:t}){const n=xi.parseDuration(e,!0,this.durationUnit);return n&&"magnitude"in n?n:t.fullDuration}calculateFillValue({value:e,record:t}){return this.fromClipboardString({string:e,record:t})}}kv.registerColumnType(RC),RC._$name="DurationColumn";const TC={startDate:1,endDate:1,constraintDate:1,deadlineDate:1};var MC=e=>class extends e{static $name="TimeZonedDatesMixin";static fields=[{name:"timeZone",persist:!1}];get timeZone(){return this.getData("timeZone")}set timeZone(e){this.setData("timeZone",e)}setLocalDate(e,t){const n=this;null!=n.timeZone&&(t=Sh.toTimeZone(t,n.timeZone)),n.set(e,t,!0),n["_"+e]=t}getLocalDate(e){return null!=this.timeZone&&this[e]&&!isNaN(this[e])?Sh.fromTimeZone(this[e],this.timeZone):this[e]}applyChangeset(e){if(null!=this.timeZone){delete e.timeZone;for(const t in TC)e[t]&&(this.setLocalDate(t,new Date(e[t])),e[t]=this["_"+t])}return super.applyChangeset(...arguments)}getFieldPersistentValue(e){if(null!=this.timeZone){const t=(null==e?void 0:e.field)??(null==e?void 0:e.name)??e;if(TC[t]){const n=this.getLocalDate(t);return e.serialize?e.serialize(n):n}}return super.getFieldPersistentValue(e)}convertToTimeZone(e,t){const n=this,r={...n.meta.modified},i={...TC},s=n.timeZone,{isProEventModel:o}=n.constructor;n.isTask&&!n.manuallyScheduled&&(delete i.startDate,delete i.endDate),null==t||t.forEach((e=>{delete i[e]}));for(const e in i)null!=n[e]?(o&&(n["_"+e]=null),i[e]=n[e],null!=s&&(i[e]=n.getLocalDate(e),r[e]&&(r[e]=Sh.fromTimeZone(r[e],s)))):delete i[e];n.timeZone=e;for(const t in i)n.setLocalDate(t,i[t]),i[t]=1,null!=e&&r[t]&&(r[t]=Sh.toTimeZone(r[t],e));var a;(n.internalClearChanges(!0,!0,i),W.isEmpty(r))||(n.meta.modified=r,null===(a=n.stores)||void 0===a||a.forEach((e=>e.modified.add(n))))}};class kC extends(_s.mixin(MC)){static $name="TimeSpan";static fields=[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}];construct(e,...t){const n=this;if(null!=e&&e.fullDuration){const{magnitude:t,unit:n}=e.fullDuration;e.duration=t,e.unit=n,delete e.fullDuration}super.construct(e,...t),n.normalize(),n.startDateMS&&n.endDateMS&&n.startDateMS>n.endDateMS&&console.error(`startDate > endDate for ${n.constructor.$name} record with id: ${n.id}`)}internalCalculateStartDate(e,t,n){return xi.add(e,-t,n)}internalCalculateEndDate(e,t,n){return xi.add(e,t,n)}internalCalculateDuration(e,t,n){return xi.as(n,xi.diff(e,t,"h"),"h")}internalNormalize(e,t,n,r){const i=this,s=null!=n;e&&t&&!s?i.setData("duration",i.internalCalculateDuration(e,t,r)):e&&!t&&s?i.setData("endDate",i.internalCalculateEndDate(e,n,r)):!e&&t&&s&&i.setData("startDate",i.internalCalculateStartDate(t,n,r))}normalize(){this.internalNormalize(this.startDate,this.endDate,this.duration,this.durationUnit||this.constructor.defaultValues.durationUnit)}get eventStore(){const e=this;if(e.isOccurrence)return e.recurringTimeSpan.eventStore;var t;e._eventStore||(e._eventStore=null===(t=e.stores)||void 0===t?void 0:t.find((e=>e.isEventStore)));return e._eventStore}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new Vt(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return null!=e&&e.isDomClassList?e:(this.updateInternalCls(e),this.setData("cls",this._cls.value),this._cls)}get cls(){return this._cls||(this._cls=new Vt(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:t,startDate:n}=e;return t||xi.add(n,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:t,...this.updateDatesFromDuration(e,t)})}updateDatesFromDuration(e,t,n=this.startDate,r=this.endDate){const i={};return n?i.endDate=this.internalCalculateEndDate(n,e,t):r&&(i.startDate=this.internalCalculateStartDate(r,e,t)),i}getDurationInUnit(e,t){const n=this;return n.startDate&&n.endDate?xi.getDurationInUnit(n.startDate,n.endDate,e,t):xi.as(e,n.duration,n.durationUnit)}get fullDuration(){return new qs({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){null!=e?("string"==typeof e&&(e=xi.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)):this.set({duration:e})}setStartDate(e,t=!0){const n=this,r={startDate:e};if(e){let i;if(t)i=null!=n.duration;else if(n.endDate){if(r.duration=n.internalCalculateDuration(e,n.endDate,n.durationUnit),r.duration<0)throw new Error("Negative duration")}else i=null!=n.duration;i&&(r.endDate=n.internalCalculateEndDate(e,n.duration,n.durationUnit))}else r.duration=null;n.set(r)}setEndDate(e,t=!1){const n=this,r={endDate:e};if(e){let i;if(!0===t)i=null!=n.duration;else if(n.startDate){if(r.duration=n.internalCalculateDuration(n.startDate,e,n.durationUnit),r.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(r.startDate=n.internalCalculateStartDate(e,n.duration,n.durationUnit))}n.set(r)}setStartEndDate(e,t,n){if(e>t)throw new Error("Start date must be less or equal to end date");this.set({startDate:e,endDate:t},null,n)}get dates(){const e=[],t=xi.startOf(this.startDate,"day"),n=this.endDate;for(let r=t;r<n;r=xi.add(r,1,"day"))e.push(r);return e}get startDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)||void 0===e?void 0:e.getTime()}get endDateMS(){var e;return null===(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)||void 0===e?void 0:e.getTime()}get durationMS(){return this.rawDurationMS}get rawDurationMS(){const{endDateMS:e,startDateMS:t}=this;return e&&t?e-t:xi.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return 0===this.duration}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:n,duration:r,durationUnit:i=this.durationUnit}=e;"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof n&&(n=this.getFieldDefinition("endDate").convert(n)),"duration"in e?(t&&!n&&(n=this.internalCalculateEndDate(t,r,i)),!t&&n&&(t=this.internalCalculateStartDate(n,r,i))):t&&n&&(r=this.internalCalculateDuration(t,n,i));const s=Object.isFrozen(e)?W.clone(e):e;return t&&(s.startDate=t),n&&(s.endDate=n),null!=r&&(s.duration=r),s}}fieldToKeys(e,t){const n=this,r=super.fieldToKeys(e,t);if(r.fullDuration){const{magnitude:e,unit:t}=r.fullDuration;r.duration=e,r.durationUnit=t}return n.isEventModel||n.isTaskModel||!("duration"in r)&&!r.durationUnit||r.startDate&&r.endDate||Object.assign(r,n.updateDatesFromDuration(r.duration??n.duration,r.durationUnit??n.durationUnit,r.startDate,r.endDate)),r}inSet(e,t,n,r,i,s,o){var a;const l=this;i||(e=l.inSetNormalize(e)||e);const d=super.inSet(e,t,n,r,i,s,o);if((null===(a=l.project)||void 0===a||!a.isWritingData)&&e.startDate&&e.endDate){let t;e.startDate instanceof Date&&e.endDate instanceof Date?t=e.startDate>e.endDate:l.fieldMap.startDate.convert(e.startDate)>l.fieldMap.endDate.convert(e.endDate)&&(t=!0),t&&console.error(`startDate > endDate for ${l.constructor.$name} record with id: ${l.id}`)}return d}applyValue(e,t,n,r,i){"cls"===t&&this.updateInternalCls(n),super.applyValue(e,t,n,r,i)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const{startDateMS:e,endDateMS:t}=this;return t-e>=0}get isValid(){const{startDate:e,endDate:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){return this.setStartDate(xi.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const n=this.startDate,r=this.endDate;return n&&r&&xi.intersectSpans(n,r,e,t)}split(e=.5){const t=this,n=t.copy(),{fullDuration:r,eventStore:i,assignmentStore:s}=t,o=new qs(r),a=new qs(r);let l,d;return"string"==typeof e?(l=new qs(e),l.unit===o.unit?a.magnitude-=l.magnitude:(a.magnitude=xi.as(l.unit,o)-l.magnitude,a.unit=l.unit,d=!0)):(l=new qs(e>1?e:t.duration*e,t.durationUnit),a.magnitude-=l.magnitude),n.startDate=xi.add(t.startDate,l.magnitude,l.unit),d?(n.fullDuration=a,t.fullDuration=l):(n.duration=a.magnitude,t.duration=l.magnitude),i&&(i.add(n),s&&!i.usesSingleAssignment&&s.add(t.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:n.id,event:null,resource:null});return delete t.id,t})))),n}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:t,endDate:n}=this,r=e.DTSTAMP||xi.format(new Date,"uu");delete e.DTSTAMP;let i={};i=this.allDay?{"DTSTART;VALUE=DATE":xi.format(t,"u"),"DTEND;VALUE=DATE":xi.format(n,"u")}:{DTSTART:xi.format(t,"uu"),DTEND:xi.format(n,"uu")};const s={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${G.scheduler&&G.getVersion("scheduler")||G.calendar&&G.getVersion("calendar")||""} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:r,...i,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},a=Object.keys(s).map((e=>`${e}:${s[e]}`)),l=Object.keys(o).map((e=>`${e}:${o[e]}`));return a.splice(a.length-1,0,...l),a.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});c.downloadBlob(t,(this.name||"Event")+".ics")}}isFieldModified(e){return"fullDuration"===e?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}}kC._$name="TimeSpan";class FC extends _s{static $name="ViewPreset";static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight"},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:n}=t,r=[];let i=Object.getPrototypeOf(t.data).id;if(!i){for(let{length:e}=n,t=e-1;t>=0;t--){const{unit:e,increment:i}=n[t],s=i>1;r.push(`${s?i:""}${t?e:N.capitalize(e)}${s?"s":""}`)}i=r.join("And")}return e.count&&e.includes(i)&&(i+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(i)&&(i+=`-${t.bottomHeader.increment}`,e.includes(i)&&(i=eo.generateId(`${i}-`)))),i}normalizeUnits(){const e=this,{timeResolution:t,headers:n,shiftUnit:r}=e;if(n)for(let e=0,{length:t}=n;e<t;e++){const t=n[e];t.unit=xi.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=xi.normalizeUnit(t.splitUnit)),"increment"in t||(n[e]=Object.assign({increment:1},t))}t&&(t.unit=xi.normalizeUnit(t.unit)),r&&(e.shiftUnit=xi.normalizeUnit(r))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:n,mainHeaderLevel:r}=e,i=e.headers=[];if(t.top&&("top"===n&&(e.columnLinesFor=0),"top"===r&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===n&&(e.columnLinesFor=i.length),"middle"===r&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==n?e.columnLinesFor=i.length-1:"bottom"===n&&(e.columnLinesFor=i.length),null==r&&(e.mainHeaderLevel=i.length-1),"bottom"===r&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}set(){}inSet(){}set options(e){this.data.options=e}get options(){return this.data.options}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:n}=t;switch(n){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(xi.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const n of e.headers)t=t&&Boolean(xi.normalizeUnit(n.unit));return e.timeResolution&&(t=t&&xi.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&xi.normalizeUnit(e.shiftUnit)),t}}FC._$name="ViewPreset";yr.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,Object:{newEvent:"New event",information:"Information",showDetails:"Show details"},ResourceInfoColumn:{eventCountText:e=>e+" event"+(1!==e?"s":"")},ResourceCollapseColumn:{toggleResourceLayout:"Toggle resource layout column. SPACE for context menu."},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",startTime:"Start time",End:"End",endTime:"End time",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete","Unassign event":"Unassign",color:"Color",eventAriaLabel:(e,t)=>`${e.name}, starts at ${t} ${e.duration>0?`for ${e.fullDuration.toString(!1)}`:""}`},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},TimeAxisColumn:{ariaLabel:(e,t)=>`Time axis showing ${e} to ${t}`},EventCopyPaste:{copyEvent:"Copy",cutEvent:"Cut",pasteEvent:"Paste"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-only-this-message":"Do you want to delete this occurrence of this event?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-only-this-message":"Do you want to change this occurrence of this event?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>`Weekly on ${e}`,"Monthly on {1}":({days:e})=>`Monthly on ${e}`,"Yearly on {1} of {2}":({days:e,months:t})=>`Yearly on ${e} of ${t}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:t})=>`Every ${e} weeks on ${t}`,"Every {0} months on {1}":({interval:e,days:t})=>`Every ${e} months on ${t}`,"Every {0} years on {1} of {2}":({interval:e,days:t,months:n})=>`Every ${e} years on ${t} of ${n}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>`${e} ${t}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each",on:"On",the:"The","On the":"On the","End repeat":"End repeat","time(s)":"time(s)",Days:"Days",Months:"Months"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>`Summary for ${e}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}});class IC extends(Tr(Il)){static $name="PresetStore";static get defaultConfig(){return{useRawData:!0,modelClass:FC,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const n=e.bottomHeader,r=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||xi.compareUnits(n.unit,r.unit)||n.increment-r.increment)*this.zoomOrder}))}get storage(){return super.storage}changeModelClass(e){return e}getById(e){return super.getById(e)||!this.isPresetManager&&globalThis.bryntum.PresetManager.getById(e)}createRecord(e,...t){let n;if(e.isViewPreset)return e;if("string"==typeof e)n=this.getById(e);else{if("number"!=typeof e)return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...t);n=this.getAt(e)}if(!n)throw new Error(`ViewPreset ${e} does not exist`);return n}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let n=e.optionalL(`L{PresetManager.${t.id}}`,null,!0);"string"==typeof n&&t.baseId&&(n=e.optionalL(`L{PresetManager.${t.baseId}}`,null,!0)),n&&"object"==typeof n&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&n.topDateFormat&&(n.middleDateFormat=n.middleDateFormat||n.topDateFormat),t.setData("displayDateFormat",n.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const r=t.headerConfig[e],i=n[e+"DateFormat"];if(r){!r.originalDateFormat&&r.dateFormat&&(r.originalDateFormat=r.dateFormat),i&&r.renderer&&(r.renderer=null);const e=i||r.originalDateFormat;e&&(r.dateFormat=e)}})),n.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",n.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))}))}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist.`);return t=W.clone(t.data),delete t.id,e.name&&delete t.name,W.merge(t,e)}add(e){return(e=Array.isArray(e)?e:[e]).forEach((e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))})),super.add(...arguments)}}IC._$name="PresetStore";const AC=new class extends IC{static $name="PresetManager";static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${xi.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${xi.format(e,"mm")}</span></div>\n                                `}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${xi.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${xi.format(e,"mm")}</span>\n                                    </div>\n                                `}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(e){if(1===xi.weekStartDay){const[t,n]=xi.getWeekNumber(e),r=xi.getDateFromISOWeek(t,n,4),i=xi.format(r,"MMM");return`${xi.getShortNameOfUnit("week")}.${String(n).padStart(2,"0")} ${i} ${t}`}return xi.getShortNameOfUnit("week")+"."+xi.format(e,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,mainHeaderLevel:0,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,n)=>xi.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,t)=>e.getFullYear()+" - "+t.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};this.getConfig("modelClass");for(const n in e)e[n].id=n,t[n]=this.createRecord(e[n])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:n}=e;t<n;t++){const n=e[t],r="string"==typeof n,i=r?n:n.base;let s;if(r)s=this.basePresets[i];else{const e=Object.assign(Object.create({id:i}),W.clone(this.basePresets[i].data)),{timeResolution:t}=e,r=e.headers[e.headers.length-1];e.id=void 0,"width"in n&&(e.tickWidth=n.width),"height"in n&&(e.tickHeight=n.height),"increment"in n&&(r.increment=n.increment),"resolution"in n&&(t.increment=n.resolution),"resolutionUnit"in n&&(t.unit=xi.getUnitByName(n.resolutionUnit)),s=this.createRecord(e),s.baseId=i}this.add(s)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const n=this.createRecord(Object.assign({id:e},t)),r=this.find((e=>e.equals(n)));if(r)return r;if(!n.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(n),n}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof FC||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof FC))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=W.merge(W.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(W.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}};globalThis.bryntum.PresetManager=AC;class LC extends kC{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}}class PC extends Il{static get defaultConfig(){return{modelClass:LC,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0},maxAllowedTickCount:1e4}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const t=this;if(super.construct(e),t.originalContinuous=t.continuous,t.ion({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,n=!1){const r=this,{owner:i}=r,s={};let o=r.getAdjustedDates(e.startDate,e.endDate),a=!1;if(null!=i&&i.isBeforeMinDate(o.startDate)&&(e.startDate=null==i?void 0:i.minDate,a=!0),null!=i&&i.isAfterMaxDate(o.endDate)&&(e.endDate=null==i?void 0:i.maxDate,a=!0),a&&(o=r.getAdjustedDates(e.startDate,e.endDate)),!1!==r.trigger("beforeReconfigure",{startDate:o.startDate,endDate:o.endDate,config:e})){r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate;for(const t in e)s[t]=r[t];const i=e.viewPreset&&e.viewPreset!==r.viewPreset;if(i&&(n=r.isFiltered,r.filters.forEach((e=>e.disabled=!1))),Object.assign(r,e),!1===r.internalOnReconfigure(n,i))return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:s})}}internalOnReconfigure(e=!1,t){const n=this;n.isConfigured=!0;const r=n.getAdjustedDates(n.startDate,n.endDate,!0),i=n.getAdjustedDates(n.startDate,n.endDate),s=i.startDate,o=i.endDate;if(s>=o)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${o}.`);const{unit:a,increment:l=1}=n,d=n.generateTicks(s,o,a,l)||n.constructor.prototype.generateTicks.call(n,s,o,a,l);n.suspendEvents(),n.maintainFilter=e,n.data=d,n.maintainFilter=!1;const{count:c}=n;if(0===c){if(e)return t&&n.disableFilters(),n.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}n.startDate=n.first.startDate,n.endDate=n.last.endDate,n.resumeEvents(),n.isContinuous?(n.adjustedStart=r.startDate,n.adjustedEnd=xi.getNext(c>1?d[c-1].startDate:r.startDate,a,l,n.weekStartDay)):(n.adjustedStart=n.startDate,n.adjustedEnd=n.endDate),n.updateVisibleTickBoundaries(),n.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:t,unit:n,startDate:r,endDate:i,weekStartDay:s,increment:o=1}=e,a=xi.getNormalizedUnitDuration(r,n)*o,l=xi.getNormalizedUnitDuration(i,n)*o;do{e.visibleTickStart=(r-e.adjustedStart)/a,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=xi.getNext(e.adjustedStart,n,o,s))}while(e.visibleTickStart>=1);do{e.visibleTickEnd=t-(e.adjustedEnd-i)/l,t-e.visibleTickEnd>=1&&(e.adjustedEnd=xi.getNext(e.adjustedEnd,n,-1,s))}while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!(e=AC.getPreset(e)).isViewPreset)throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){return this._weekStartDay??xi.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,t,n=!1){t&&e-t==0&&(t=null);const r=this,{startDate:i,endDate:s}=r.getAdjustedDates(e,t);if(r.startDate-i!=0||r.endDate-s!=0)return r.reconfigure({startDate:i,endDate:s},!1,n)}shift(e,t=this.shiftUnit){const n=this;let{startDate:r,endDate:i}=n;n.isFiltered&&(r=n.allRecords[0].startDate,i=n.allRecords[n.totalCount-1].endDate);let s=0;do{r=xi.add(r,e,t),i=xi.add(i,e,t)}while(s++<n.maxTraverseTries&&!1===n.setTimeSpan(r,i,{preventThrow:!0}))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){this.filters.clear(),super.filterBy(((n,r)=>e.call(t,n.data,r)))}filter(){var e;const t=this;t.viewportCenterDate=null===(e=t.owner)||void 0===e?void 0:e.viewportCenterDate;const n=super.filter(...arguments);return t.maintainFilter||0!==t.count||(t.resumeEvents(),t.trigger("invalidFilter"),t.disableFilters()),n}disableFilters(){this.filters.forEach((e=>e.disabled=!0)),this.filter()}triggerFilterEvent(e){const t=this,{owner:n}=t;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),null!=n&&n.infiniteScroll&&!t.continuous&&n.timeAxisViewModel.ion({update:()=>{n.shiftToDate(t.viewportCenterDate,{visibleDate:t.viewportCenterDate,block:"center"})},once:!0}),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.isFiltered}getAdjustedDates(e,t,n=!1){const r=this,{owner:i}=r;t&&e-t==0&&(t=null),e=e||r.startDate,t=t||xi.add(e,r.defaultSpan,r.mainUnit);const s=r.floorDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1),o=r.ceilDate(t,!1,r.autoAdjust?r.mainUnit:r.unit,1),a=o-s,l=(null==i?void 0:i.getMinDateOrDate(s))??s;let d=(null==i?void 0:i.getMaxDateOrDate(o))??o;return d<=l&&(d=null==i?void 0:i.getMaxDateOrDate(xi.add(l,a))),r.autoAdjust||n?{startDate:l,endDate:d}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=xi.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=xi.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,n,r){const i=this,s=(t=!1!==t)?xi.clone(i.startDate):null,o=r||i.resolutionIncrement,a=n||(t?i.resolutionUnit:i.mainUnit);if(t)return xi.floor(e,{unit:a,magnitude:o},s);const l=xi.clone(e);if("week"===a){const e=l.getDay()||7,t=i.weekStartDay||7;xi.add(xi.startOf(l,"day",!1),e>=t?t-e:-(7-t+e),"day",!1),l.getDay()!==t&&23===l.getHours()&&xi.add(l,1,"hour",!1)}else{xi.startOf(l,a,!1);const e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,n=((e,t)=>Math.floor(e/t)*t)(xi.get(l,t)-e,o)+e;xi.set(l,t,n)}return l}roundDate(e,t,n=this.resolutionUnit,r=this.resolutionIncrement||1){const i=this,s=xi.clone(e);switch(t=xi.clone(t||i.startDate),n){case"week":{xi.startOf(s,"day",!1);let e,t=s.getDay()-i.weekStartDay;return t<0&&(t=7+t),e=1===Math.round(t/7)?7-t:-t,xi.add(s,e,"day",!1)}case"month":{const e=xi.diff(t,s,"month")+xi.as("month",s.getDay()/xi.daysInMonth(s)),n=Math.round(e/r)*r;return xi.add(t,n,"month",!1)}case"quarter":return xi.startOf(s,"month",!1),xi.add(s,3-s.getMonth()%3,"month",!1);default:{const e=xi.as(n,xi.diff(t,s)),i="year"===n?0:xi.as(n,t.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),o=Math.round((e+i)/r)*r;return xi.add(t,o-i,n,!1)}}}ceilDate(e,t,n,r){const i=this;t=!1!==t,r=r||(t?i.resolutionIncrement:1);const s=n||(t?i.resolutionUnit:i.mainUnit),o=xi.clone(e);let a=!1;switch(s){case"minute":a=!xi.isStartOf(o,"minute");break;case"hour":a=!xi.isStartOf(o,"hour");break;case"day":case"date":a=!xi.isStartOf(o,"day");break;case"week":xi.startOf(o,"day",!1),a=o.getDay()!==i.weekStartDay||!xi.isEqual(o,e);break;case"month":xi.startOf(o,"day",!1),a=1!==o.getDate()||!xi.isEqual(o,e);break;case"quarter":xi.startOf(o,"day",!1),a=o.getMonth()%3!=0||1!==o.getDate()||!xi.isEqual(o,e);break;case"year":xi.startOf(o,"day",!1),a=0!==o.getMonth()||1!==o.getDate()||!xi.isEqual(o,e)}return a?xi.getNext(o,s,r,i.weekStartDay):o}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,n){const{include:r}=this;return!!r&&Object.entries(r).some((([r,i])=>{if(!i)return!1;const{from:s,to:o}=i;if(xi.compareUnits("day",n)>=0&&xi.getLargerUnit(r)===n&&(s&&xi.set(e,r,s),o)){let e=n;"day"===n&&(e="date"),xi.set(t,{[e]:xi.get(t,e)-1,[r]:o})}if(xi.compareUnits(r,n)>=0){const t="day"===r?e.getDay():xi.get(e,r);if(s&&t<s||o&&t>=o)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:n,to:r}=t;t.lengthFactor=xi.getUnitToBaseUnitRatio(e,xi.getLargerUnit(e))/(r-n),t.lengthFactorExcl=xi.getUnitToBaseUnitRatio(e,xi.getLargerUnit(e))/(r-n-1),t.center=n+n/(t.lengthFactor-1)}}))}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,t,n=this.unit,r=this.increment){const i=this,s=[],o=Boolean(i.include);i.validateTickCount();let a,l,d,c=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t),g=!1;for(i.tickCache={},o&&i.initExclusion();u<h;){if(a=xi.getNext(u,n,r,i.weekStartDay),!i.autoAdjust&&a>h&&!g&&(a=new Date(h.getTime())),"hour"===n&&r>1&&s.length>0&&0===c){const e=s[s.length-1];c=(e.startDate.getHours()+r)%24-e.endDate.getHours(),0!==c&&(a=xi.add(a,c,"hour"))}if(d=!1,o){if(l=new Date(a.getTime()),d=i.processExclusion(u,a,n),g){if(!i.autoAdjust&&a>h){u=l;continue}}else if(a<u){g=!0;continue}}else l=a;d||(s.push({id:s.length+1,startDate:u,endDate:a}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var t;const n=this,r=n.records,i=(null===(t=e.getTime)||void 0===t?void 0:t.call(e))??e;let s,o,a,l,d=0,c=r.length-1;if(!r.length||i<r[0].startDateMS||i>r[c].endDateMS)return-1;if(n.isContinuous){for(;d<c;)s=d+c+1>>1,i>r[s].endDateMS?d=s+1:i<r[s].startDateMS?c=s-1:d=s;return o=r[d],a=o.startDateMS,i>a&&(l=o.endDateMS,d+=(i-a)/(l-a)),Math.min(Math.max(d,n.visibleTickStart),n.visibleTickEnd)}for(let e=0;e<=c;e++)if(l=r[e].endDateMS,i<=l)return a=r[e].startDateMS,o=e+(i>a?(i-a)/(l-a):0),o}getSnappedTickFromDate(e){const t=Math.floor(this.getTickFromDate(e));return this.getAt(t)}getDateFromTick(e,t){const n=this;if(e===n.visibleTickEnd)return n.endDate;const r=Math.floor(e),i=e-r,s=n.getAt(r);if(!s)return null;const o=0===r&&n.isContinuous?n.adjustedStart:s.startDate,a=r===n.count-1&&n.isContinuous?n.adjustedEnd:s.endDate;let l=xi.add(o,i*(a-o),"millisecond");return t&&(l=n[t+"Date"](l)),l}get maxAllowedEndDate(){const e=this.maxAllowedTickCount*xi.asMilliseconds(this.increment,this.unit);return xi.add(xi.parse(this.startDate),e)}validateTickCount(){this.endDate>this.maxAllowedEndDate&&console.error("Configured date range will result in a too long time axis. If you required in long timeline, please use InfiniteScroll feature.")}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,n)=>t.tickCache[e.startDate.getTime()]=n)))}dateInAxis(e,t=!1){const n=this,r=n.startDate,i=n.endDate;if(n.isContinuous)return t?xi.betweenLesserEqual(e,r,i):xi.betweenLesser(e,r,i);{const r=n.count;let i,s,o;for(let a=0;a<r;a++)if(o=n.getAt(a),i=o.startDate,s=o.endDate,t&&e<=s||!t&&e<s)return e>=i}return!1}timeSpanInAxis(e,t){const n=this;return t&&t.getTime()!==e.getTime()?n.isContinuous?xi.intersectSpans(e,t,n.startDate,n.endDate):e<n.startDate&&t>n.endDate||n.getTickFromDate(e)!==n.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:n,endMS:r}=t,{startDateMS:i}=e,s=e.endDateMS??e.meta.endDateCached;if(!i||!s)return!1;if(s===i)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>n&&i<r;const o=t.getTickFromDate(i),a=t.getTickFromDate(s);return!(o===t.count&&xi.isEqual(e.startDate,t.last.endDate)||0===a&&xi.isEqual(e.endDate,t.first.startDate))&&(i<n&&s>r||o!==a)}forEachAuxInterval(e,t=1,n,r=this){const i=this.endDate;let s,o=this.startDate,a=0;if(o>i)throw new Error("Invalid time axis configuration");for(;o<i;)s=xi.min(xi.getNext(o,e,t,this.weekStartDay),i),n.call(r,o,s,a,s>=i),o=s,a++}}PC._$name="TimeAxis";class OC extends(lt()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const n=t.timeAxis.viewPreset||t.viewPreset;if(n)if(n instanceof FC)t.consumeViewPreset(n);else{const e=AC.getPreset(n);e&&t.consumeViewPreset(e)}t.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:t}),t.configured=!0}doDestroy(){var e,t;null===(e=(t=this.timeAxis).un)||void 0===e||e.call(t,"reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),!t&&e.count>0&&this.update()}update(e,t=!1,n=!1){var r;const i=this,{timeAxis:s,headers:o}=i,a=0!==e;if(i.isConfiguring||a&&i._availableSpace===e)return void(n&&i.trigger("update"));if(i._availableSpace=Math.max(e||i.availableSpace||0,0),"number"!=typeof i.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");i.columnConfig=[];const l=i._tickSize=i.calculateTickSize(i.originalTickSize);if("number"!=typeof l||l<0)throw new Error("Invalid timeAxis tick size");i.unitToPixelsCache={},i._totalSize=null;const d=xi.weekStartDay;"number"==typeof(null===(r=i.owner)||void 0===r?void 0:r.weekStartDay)&&(xi._weekStartDay=s.weekStartDay);for(let e=0,{length:t}=o;e<t;e++){const t=o[e];if(t.cellGenerator){const n=t.cellGenerator.call(i,s.startDate,s.endDate);i.columnConfig[e]=i.createHeaderRow(e,t,n)}else i.columnConfig[e]=i.createHeaderRow(e,t)}i.owner&&(xi._weekStartDay=d),t||i.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const n=this.getScaledTick(e,t);return-1===n?-1:this.tickSize*(n-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:n,isEnd:r,min:i,max:s}){const{timeAxis:o}=this,{include:a,unit:l}=o;let d=o.getTickFromDate(e);if(-1!==d&&t&&a){let t=!1;if(a.hour&&xi.compareUnits(l,"hour")>0&&"day"!==l){const{from:r,to:i,lengthFactor:s,center:o}=a.hour,l=e.getHours(),d=Math.min(Math.max(l,r),i);if(!n&&d!==l)return-1;const c=o-(o-(d+e.getMinutes()/60))*s;e=xi.add(e,c-l,"h"),t=!0}if(a.day&&xi.compareUnits(l,"day")>0){const{from:l,to:d,lengthFactor:c,center:u}=a.day;let h=e.getDay();r&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<l||h>=d){if(!n)return-1;if(g=r?(d-h-8)%7:(l-h+7)%7,e=xi.add(e,g,"d"),e=xi.startOf(e,"d",!1,o.weekStartDay),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const{weekStartDay:m}=o,p=0===e.getDay()?0:u,f=e.getDay()+e.getHours()/24,v=p-(p-f)*c;e=xi.add(e,v-f+m,"d"),t=!0}t&&(e=xi.constrain(e,o.startDate,o.endDate),d=o.getTickFromDate(e))}return d}getDateFromPosition(e,t,n=!1){const r=this,{timeAxis:i}=r,s=r.getScaledPosition(e)/r.tickSize+i.visibleTickStart;if(s<0||s>i.count){if(n){let e;return e=s<0?xi.add(i.startDate,s,i.unit):xi.add(i.endDate,s-i.count,i.unit),t&&(e=i[t+"Date"](e)),e}return null}return i.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:n,weekStartDay:r}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&xi.compareUnits(n,"day")>0){const{from:n,lengthFactor:s}=t.day,o=e%(7*i);e=o/s+(n-r)*i+(e-o)}if(t.hour&&xi.compareUnits(n,"hour")>0&&"day"!==n){const{from:n,lengthFactorExcl:r}=t.hour,s=e%i;e=s/r+n*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=xi.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:n,timeAxis:r,suppressFit:i}=t,s=r.unit;let o=0,a=1;if(t.snap){const e=r.resolution;a=xi.getUnitToBaseUnitRatio(s,e.unit)*e.increment}if(i)o=e;else{const i=t.availableSpace/r.visibleTickTimeSpan;o=n||e<i?i:e,a>0&&(!n||a<1)&&(o=Math.max(1,a*o)/a)}return o}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this,n=t._availableSpace;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&(e!==t.tickSize||0===n)&&t.update()}}getDates(e=this.columnLinesFor,t=!1,n=!1){const r=this,i=[],s=t?r.lowestHeader:e,o=r.majorHeaderLevel,a=r.headers&&r.headers[e].unit,l=null!=o&&r.headers&&r.headers[o].unit,d=null!=o&&xi.doesUnitsAlign(l,a);if(Boolean(r.headers&&r.headers[s].cellGenerator)){const e=r.columnConfig[s];for(let t=1,n=e.length;t<n;t++)i.push({date:e[t].startDate})}else r.forEachInterval(s,((t,s)=>{i.push({date:n?s:t,isMajor:o!==e&&d&&r.isMajorTick(n?s:t)})}));return i}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,n){const r=this,i=[],{align:s,headerCellCls:o=""}=t,a=xi.clearTime(new Date),{timeAxis:l}=r,d=r.headers.length-1,c=(n,c,h,g,m)=>{let p=xi.format(n,t.dateFormat);const f=h>0&&!g,v={align:s,start:n,end:c,value:m?m.header:p,headerCellCls:o,width:d===e&&r.owner&&(l.fullTicks||f)?r.owner.tickSize:r.getDistanceBetweenDates(n,c),index:h};0!==v.width&&(v.coord=u-1,u+=v.width,r.headersDatesCache[e][n.getTime()]=1,t.renderer&&(p=t.renderer.call(t.thisObj||r,n,c,v,h,r.owner),v.value=null==p?"":p),"day"!==t.unit||t.increment&&1!==t.increment||(v.headerCellCls+=" b-sch-dayheadercell-"+n.getDay(),xi.clearTime(n,!0)-a==0&&(v.headerCellCls+=" b-sch-dayheadercell-today")),i.push(v))};let u=0;return r.headersDatesCache[e]={},n?n.forEach(((e,t)=>c(e.start,e.end,t,t===n.length-1,e))):r.forEachInterval(e,c),i}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,n=this){const{headers:r,timeAxis:i}=this;if(r)if(e===r.length-1)i.forEach(((e,r)=>t.call(n,e.startDate,e.endDate,r,r===i.count-1)));else{const s=r[e];i.forEachAuxInterval(s.unit,s.increment,t,n)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}OC._$name="TimeAxisViewModel";const $C=new Date;var _C=e=>class extends(e||Qe){static $name="TimelineDateMapper";static configurable={snap:!1};getRtlX(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}getDateFromCoordinate(e,t,n=!0,r=!1,i=!1){return n||(e=this.currentOrientation.translateToScheduleCoordinate(e)),i||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,t,r)}getDateFromCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}getDateFromVirtualCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,!0)}getDateFromXY(e,t,n=!0,r=!1){return this.currentOrientation.getDateFromXY(e,t,n,r)}getDateFromDomEvent(e,t,n=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,n)}getStartEndDatesFromRectangle(e,t,n,r=!1,i=!0){const s=this,{isHorizontal:o}=s,a=o?e.x:e.top,l=o?e.right:e.bottom;let d,c;return a>=0&&l<s.timeAxisViewModel.totalSize?(d=s.getDateFromCoordinate(a,t,i),c=s.getDateFromCoordinate(l,t,i)):a<0?(c=s.getDateFromCoordinate(l,t,i,r),d=c&&xi.add(c,-n,"ms")):(d=s.getDateFromCoordinate(a,t,i,r),c=d&&xi.add(d,n,"ms")),{start:d,end:c}}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||xi.formatContainsHourInfo(this.displayDateFormat)||(e=xi.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){var n;if(!e)throw new Error("Invalid date passed to getCoordinateFromDate");const r=this,{timeAxisViewModel:i}=r,{isContinuous:s,startMS:o,endMS:a,startDate:l,endDate:d,unit:c}=r.timeAxis,u=e.valueOf();let h;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||($C.setTime(e),e=$C),s&&e.getTimezoneOffset()===l.getTimezoneOffset()&&l.getTimezoneOffset()===d.getTimezoneOffset()&&-1!==xi.getUnitToBaseUnitRatio(c,"day")){if(u<o||u>a)return-1;h=(u-o)/(a-o)*i.totalSize}else h=i.getPositionFromDate(e,t);return!r.rtl||!r.isHorizontal||null!==(n=t)&&void 0!==n&&n.ignoreRTL||(h=i.totalSize-h),t.local||(h=r.currentOrientation.translateToPageCoordinate(h)),h}getVirtualCoordFromDate(e,t){return this.getCoordinateFromDate(e,{...t,ignoreRTL:!0})}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){if(this.isVisible){const{timeAxis:e,timelineScroller:t}=this;if(e.isContinuous){const n=(t.position+t.clientSize/2)/t.scrollSize;return new Date(e.startMS+(e.endMS-e.startMS)*n)}return this.getDateFromCoordinate(t.position+t.clientSize/2)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}get snap(){var e;return(null===(e=this._timeAxisViewModel)||void 0===e?void 0:e.snap)??this._snap}updateSnap(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}onSchedulerHorizontalScroll(e,t,n,r){r||(this.cachedCenterDate=null)}get widgetClass(){}};const{eventNameMap:HC}=Jt;var VC=e=>class extends(e||Qe){static $name="TimelineDomEvents";static configurable={timelineContext:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))&&(null==e?void 0:e.eventRecord)===(null==t?void 0:t.eventRecord)}},updateTimelineContextOnScroll:!1,ignoreDomEventsWhileScrolling:null};static properties={schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}};static delayable={onScheduleScroll:"raf"};hoveredEvents=new Set;initDomEvents(){const e=this,{schedulerEvents:t}=e;t.element=e.timeAxisSubGridElement,t.thisObj=e,Jt.on(t),Jt.on({element:e.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:e}),e.updateTimelineContextOnScroll&&c.supportsPointerEventConstructor&&Jt.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e})}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduleEvent(e){const t=this;if(t.ignoreDomEventsWhileScrolling&&(t.scrolling||t.timeAxisSubGrid.scrolling))return;const n=t.getTimelineEventContext(e);t.lastPointerEvent=e,n&&t.trigger(`${n.eventElement?t.scheduledEventName:"schedule"}${HC[n.domEvent.type]||N.capitalize(n.domEvent.type)}`,n),t.timelineContext=n}handleScheduleLeaveEvent(e){e.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(e)}onScheduleScroll({target:e}){var t;const n=this;if(e&&n.updateTimelineContextOnScroll&&(null===(t=n.features.pan)||void 0===t||!t.isActive)&&!n.partners.some((e=>{var t;return null===(t=e.features.pan)||void 0===t?void 0:t.isActive}))&&(e.contains(n.element)||n.bodyElement.contains(e))){const{timelineContext:e,lastPointerEvent:t}=n;if(e){var r,i;const n=Yn.elementFromPoint(e.domEvent.clientX,e.domEvent.clientY),s=new c.PointerEventConstructor("pointermove",t),o=new MouseEvent("mousemove",t);Object.defineProperty(s,"pointerId",{value:(null===(r=ir.currentPointerDown)||void 0===r?void 0:r.pointerId)??(null===(i=ir.currentTouch)||void 0===i?void 0:i.identifier)??1}),s.scrollInitiated=o.scrollInitiated=!0,null==n||n.dispatchEvent(s),null==n||n.dispatchEvent(o)}}}updateTimelineContext(e,t){this.trigger("timelineContextChange",{oldContext:t,context:e}),e&&!t?this.trigger("scheduleMouseEnter",e):e||this.trigger("scheduleMouseLeave",{event:t.event})}getTimelineEventContext(e){const t=this,{scheduleContext:n}=t.features;if(n){var r;const{context:s}=n,{type:o}=e,a=o.endsWith("leave")||o.endsWith("out")?e.relatedTarget:e.target;var i;if(s&&(null!==(r=n.widget)&&void 0!==r&&r.owns(a)||n.element.contains(a)))return n.element.style.pointerEvents="none",s.eventElement=null===(i=document.elementFromPoint(e.clientX,e.clientY))||void 0===i?void 0:i.closest(t.eventSelector),s.eventRecord=t.resolveEventRecord(s.eventElement),n.element.style.pointerEvents="",t._timelineContext=null,s}const s=e.target.closest(t.eventInnerSelector),o=t.getCellElementFromDomEvent(e);if(o){const n=t.getDateFromDomEvent(e);if(!n)return;const r=t.timeAxis.floorDate(n),i=Vl.get(o),a=s?t.getTimeSpanMouseEventParams(s,e):t.getScheduleMouseEventParams(i,e);if(!a)return;const l=t.isVertical?t.resourceStore.indexOf(a.resourceRecord):i.row.dataIndex,d=t.timeAxis.getTickFromDate(r),c=t.timeAxis.getAt(Math.floor(d));if(c)return{scheduler:t,isTimelineContext:!0,domEvent:e,eventElement:s,cellElement:o,index:l,tick:c,tickIndex:d,date:r,time:n,tickStartDate:c.startDate,tickEndDate:c.endDate,tickParentIndex:c.parentIndex,row:i.row,event:e,...a}}}getCellElementFromDomEvent({target:e,clientY:t,type:n}){const r=this,{isVertical:i,foregroundCanvas:s}=r,o=e.closest(r.eventSelector);if(i)return r.timeAxisSubGridElement.querySelector(r.timeCellSelector);if(o)return r.getCell({record:r.resolveRowRecord(o)||r.store.getAt(r.rowManager.getRowAt(t,!1).dataIndex),column:r.timeAxisColumn});var a;if(s.contains(e)&&(e===s||e.closest(".b-sch-resourcetimerange")||"mousemove"===n))return null===(a=r.rowManager.getRowAt(t,!1))||void 0===a?void 0:a.getCell(r.timeAxisColumn.id);return e.matches(".b-grid-row")?e.firstElementChild:e.closest(r.timeCellSelector)}matchScheduleCell(e){return e.closest(this.timeCellSelector)}onElementMouseButtonEvent(e){const t=e.target.closest(".b-sch-header-timeaxis-cell");if(t){const n=this,r=t.parentElement.dataset.headerPosition,i=n.timeAxisViewModel.columnConfig[r],s=n.timeAxis.isFiltered?i.findIndex((e=>e.index==t.dataset.tickIndex)):t.dataset.tickIndex,o=i[s],a=n.features.contextMenu;a&&e.type===a.triggerEvent||this.trigger(`timeAxisHeader${N.capitalize(e.type)}`,{startDate:o.start,endDate:o.end,event:e})}}onElementMouseDown(e){this.onElementMouseButtonEvent(e),super.onElementMouseDown(e)}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){var t;const n=this;if(n.ignoreDomEventsWhileScrolling&&(n.scrolling||n.timeAxisSubGrid.scrolling))return;super.onElementMouseOver(e);const{target:r}=e,{hoveredEvents:i}=n;if(!r.closest(n.eventInnerSelector)&&!r.matches(".b-sch-terminal-hover-area")||null!==(t=n.features.eventDrag)&&void 0!==t&&t.isDragging)i.size&&n.unhoverAll(e);else{const t=r.closest(n.eventSelector);if(!i.has(t)&&!n.preventOverCls){i.add(t),t.classList.add(n.overScheduledEventClass);const r=n.getTimeSpanMouseEventParams(t,e);r&&n.trigger(`${n.scheduledEventName}MouseEnter`,r)}}}onElementMouseOut(e){var t;const n=this,{features:r}=n,{target:i,relatedTarget:s}=e;null!=s&&s.closest(".b-sch-canvas *")||super.onElementMouseOut(e);const o=i.closest(n.eventSelector),a=null==o?void 0:o.querySelector(n.eventInnerSelector),l=o&&n.resolveTimeSpanRecord(o);a&&l&&n.hoveredEvents.has(o)&&(null===(t=r.eventDrag)||void 0===t||!t.isDragging)&&s&&(Yn.isDescendant(a,s)||s.matches(".b-sch-terminal-hover-area"))||o&&n.hoveredEvents.size&&n.unhover(o,e)}unhover(e,t){const n=this;e.classList.remove(n.overScheduledEventClass);n.getTimeSpanMouseEventParams(e,t)&&n.trigger(`${n.scheduledEventName}MouseLeave`,n.getTimeSpanMouseEventParams(e,t)),n.hoveredEvents.delete(e)}unhoverAll(e){for(const t of this.hoveredEvents)!t.isReleased&&!t.classList.contains("b-released")&&this.unhover(t,e);this.hoveredEvents.clear()}get widgetClass(){}},NC=e=>class extends(e||Qe){static $name="TimelineViewPresets";static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this,data:!0===e?AC.data:[]};if(!0!==e)if(Array.isArray(e))for(const n of e)if("string"==typeof n){const e=AC.getById(n);e&&t.data.push(e.data)}else t.data.push(n);else W.assign(t,e);return new IC(t)}changeViewPreset(e,t){const n=this,{presets:r}=n;e?(e=r.createRecord(e),r.includes(e)||r.add(e)):e=r.first;const i=n.lastViewPresetOptions||{},s=e.options||(e.options={}),o={...s,from:t,to:e,preset:e},a=!n._viewPreset||!n._viewPreset.equals(e);if(delete i.event,(a||!W.isEqual(s,i))&&(s.event=o,a||(n._viewPreset=null),n.isConfiguring||!1!==n.trigger("beforePresetChange",o)))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(e){this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return xi.format(e,this.displayDateFormat)}updateViewPreset(e){var t;const n=this,{options:r}=e,{event:i,startDate:s,endDate:o}=r,{hasTimelineBoundaries:a,isHorizontal:l,_timeAxis:d,_timeAxisViewModel:c}=n,u=l&&n.rtl;let{centerDate:h,zoomDate:g,zoomPosition:m}=r,p=!1;if(null===(t=n.syncSplits)||void 0===t||t.call(n,(t=>t.viewPreset=e)),delete e.options,n._viewPresetChanging=!0,d&&!n.isConfiguring){const{timelineScroller:t}=n;if(n.lastViewPresetOptions=r,d.isConfigured){n.suspendRefresh();const t=W.copyProperties({},n,["weekStartDay","startTime","endTime"]);n.range&&n.calendar&&!n.isConfiguring?(t.startDate=n.startDate,t.endDate=n.endDate):n.infiniteScroll?Object.assign(t,n.calculateInfiniteScrollingDateRange(h||(s&&o?new Date((s.getTime()+o.getTime())/2):n.viewportCenterDateCached),!0,e)):s?(t.startDate=s,t.endDate=o,!h&&o&&(h=new Date((s.getTime()+o.getTime())/2))):(t.startDate=d.startDate,t.endDate=o||d.endDate,h||(h=n.viewportCenterDate)),d.isConfigured=!1,t.viewPreset=e,d.reconfigure(t,!0),c.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:r.tickSize||(l?e.tickWidth:e.tickHeight||e.tickWidth||60)}),r.tickSize&&(n.tickSize=r.tickSize),n.resumeRefresh(!1)}if(n.refresh(),!r.notScroll&&n.isPainted)if("scrollPosition"in r)p=t.position===r.scrollPosition,t.scrollTo(r.scrollPosition);else if(r.visibleDate)n.visibleDate=r.visibleDate;else if(g&&m){let e=15,s="minute";xi.compareUnits(d.resolutionUnit,"hour")>0&&(e=1,s="hour");const o=xi.asMilliseconds(e,s),l=new Date(Math.round(g/o)*o);i.zoomDate=g,i.zoomPosition=m,i.zoomLevel=r.zoomLevel,a&&0==t.position&&n.currentOrientation.updateFromHorizontalScroll(0,!0,!0),t.position=u?t.scrollWidth-(n.getCoordinateFromDate(l)+m):n.getCoordinateFromDate(l)-m}else if(h){n.cachedCenterDate=h,i.centerDate=h;const e=n.timelineScroller.clientSize,t=u?n.timeAxisViewModel.totalSize-n.getCoordinateFromDate(h,!0):n.getCoordinateFromDate(h,!0),r=Math.max(t-e/2,0);r===(n.isHorizontal?n.scrollLeft:n.scrollTop)?p=!0:n.isHorizontal?n.scrollHorizontallyTo(r,{scrollingToCenter:!0}):n.scrollVerticallyTo(r,{scrollingToCenter:!0})}else 0===(n.isHorizontal?n.scrollLeft:n.scrollTop)?p=!0:n.timelineScroller.scrollTo(0)}n.dataset.presetId=e.id,e.rowHeight&&!n.initialConfig.rowHeight&&(n.rowHeight=e.rowHeight),n.trigger("presetChange",i),n._viewPresetChanging=!1,p&&(n.isHorizontal?n.currentOrientation.updateFromHorizontalScroll(n.scrollLeft,!0):n.currentOrientation.updateFromVerticalScroll(n.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},BC=e=>class extends(e||Qe){static $name="TimelineZoomable";static defaultConfig={zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null};lastWheelTime=-1;lastZoomPosition=-1;construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&Jt.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:e=>(e.ctrlKey||e.metaKey)&&e.preventDefault()},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.ion({timeaxisheaderdblclick:({startDate:e,endDate:n})=>{t.forceFit||t.zoomToSpan({startDate:e,endDate:n})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:n}=e,r=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((xi.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(t?r:e.actualWidth||r))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){const n=this;if(n.forceFit)return console.warn("Warning: The forceFit setting and zooming cannot be combined"),null;"number"==typeof e&&(e=Math.min(Math.max(e,n.minZoomLevel),n.maxZoomLevel));const{presets:r}=n,i=n.isVertical?"tickHeight":"tickWidth",s=r.createRecord(e),o=s[i],a=t.startDate?new Date(t.startDate):null,l=t.endDate?new Date(t.endDate):null;r.add(s);let d=a&&l?{startDate:a,endDate:l}:null,c=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;const u=t.centerDate?new Date(t.centerDate):d?new Date((a.getTime()+l.getTime())/2):n.viewportCenterDateCached;if(0===c){const{_beforeCollapseState:e}=n.timeAxisSubGrid;if(!(n.isHorizontal&&n.timeAxisSubGrid.collapsed&&null!=e&&e.width))return null;c=e.width}return d||(d=n.calculateOptimalDateRange(u,c,s)),"width"in t&&s.setData(i,t.width),n.isZooming=!0,s.options={...t,startDate:d.startDate||n.startDate,endDate:d.endDate||n.endDate,centerDate:u},n.viewPreset=s,s.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,s.setData(i,o),n.zoomLevel}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e={leftMargin:0,rightMargin:0,...e,...t}).startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}zoomToSpan(e={}){const t=this,{availableSpace:n}=t.timeAxisViewModel,r=e.endDate-e.startDate;if(n<=0)return;if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");e.startDate=t.getMinDateOrDate(e.startDate),e.endDate=t.getMaxDateOrDate(e.endDate),e.endDate<=e.startDate&&(e.endDate=t.getMaxDateOrDate(xi.add(e.startDate,r)));const{timeAxis:i}=t,s=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:o,endDate:a}=e;if(s&&(o=xi.add(o,-e.adjustStart,i.mainUnit),a=xi.add(a,e.adjustEnd,i.mainUnit)),o<=a){const r=t.presets.allRecords,l=a-o||1;let d,c,u=t.zoomLevel;-1===u&&(u=0);let h,g=t.getMilliSecondsPerPixelForZoomLevel(r[u]),m=u+(d=l/g+e.leftMargin+e.rightMargin>n?-1:1),p=null;for(;m>=0&&m<=r.length-1;){h=r[m],g=t.getMilliSecondsPerPixelForZoomLevel(h);const i=l/g+e.leftMargin+e.rightMargin;if(-1===d){if(i<=n){p=m;break}}else{if(!(i<=n))break;u!==m-d&&(p=m)}m+=d}p=p??m-d,h=r[p];const f=h.bottomHeader.unit;g=t.getMilliSecondsPerPixelForZoomLevel(h),(e.leftMargin||e.rightMargin)&&(o=new Date(o.getTime()-g*e.leftMargin),a=new Date(a.getTime()+g*e.rightMargin));const v=xi.getDurationInUnit(o,a,f,!0)/h.bottomHeader.increment;if(0===v)return null;const y=Math.floor(n/v),b=e.centerDate||new Date((o.getTime()+a.getTime())/2);c=s?{startDate:o,endDate:a}:t.calculateOptimalDateRange(b,n,h);let C=t.zoomLevel;return t.zoomLevel===p?i.reconfigure(c):C=t.zoomToLevel(p,Object.assign(c,{width:y,centerDate:b})),this.trigger("zoomToSpan",{zoomLevel:p,startDate:o,endDate:a,centerDate:b}),C}return null}zoomIn(e=1,t){"object"==typeof e&&(t=e,e=1);const n=this.zoomLevel;return n>=this.maxZoomLevel?null:this.zoomToLevel(n+e,t)}zoomOut(e=1,t){"object"==typeof e&&(t=e,e=1);const n=this.zoomLevel;return n<=this.minZoomLevel?null:this.zoomToLevel(n-e,t)}zoomInFull(e){return this.zoomToLevel(this.maxZoomLevel,e)}zoomOutFull(e){return this.zoomToLevel(this.minZoomLevel,e)}calculateOptimalDateRange(e,t,n){const r=this,{timeAxis:i,minDate:s,maxDate:o}=r,{bottomHeader:a}=n,l=r.isHorizontal?n.tickWidth:n.tickHeight;if(r._originalConfiguredDateRange=r._originalConfiguredDateRange||{startDate:r.startDate,endDate:r.endDate},r.zoomKeepsOriginalTimespan)return r.getAllowedDateRange(e,n);const d=a.unit,c=Math.ceil(t/l*a.increment*r.visibleZoomFactor/2);let u=xi.add(e,-c,d),h=xi.add(e,c,d);return r.isBeforeMinDate(u)?(u=s,h=xi.add(u,2*c,d)):r.isAfterMaxDate(h)&&(h=o,u=xi.add(h,-2*c,d)),{startDate:i.floorDate(u,!1,d,a.increment),endDate:i.ceilDate(h,!1,d,a.increment)}}getAllowedDateRange(e,t){const n=this;e=e||new Date((n.startDate.getTime()+n.endDate.getTime())/2),t=t||n.viewPreset;const{timeAxis:r}=n,{bottomHeader:i}=t,{maxAllowedTickCount:s}=r,o=Math.ceil(s*xi.asMilliseconds(i.increment,i.unit)/2),a=xi.add(e,o);if(this.endDate>a){console.warn("Warn: start/end dates exceeds max allowed date range for current viewPreset, it was recalculated automatically.");return{startDate:xi.add(e,-o),endDate:xi.add(e,o)}}{const{startDate:e,endDate:t}=n._originalConfiguredDateRange||n;if(t<a)return{startDate:e,endDate:t}}return{startDate:r.startDate,endDate:r.endDate}}onElementMouseMove(e){const{isHorizontal:t,zoomContext:n}=this;super.onElementMouseMove(e),e.isTrusted&&n&&Math.abs(e["client"+(t?"X":"Y")]-n.coordinate)>10&&(this.zoomContext=null)}onWheel(e){if((e.ctrlKey||e.metaKey)&&!this.forceFit){e.preventDefault();const t=this,{zoomContext:n,isHorizontal:r,timelineScroller:i,zoomLevel:s}=t,o=performance.now(),a=e["client"+(r?"X":"Y")];let l=a-i.viewport[""+(r?"x":"y")];r&&t.rtl&&(l=i.viewport.width+i.viewport.x-a),o-t.lastWheelTime>200||!n||Math.abs(a-t.zoomContext.coordinate)>20?t.zoomContext={zoomLevel:s,coordinate:a,zoomPosition:l,zoomDate:t.getDateFromDomEvent(e)}:(s>n.zoomLevel&&(n.zoomDate=t.getDateFromDomEvent(e),n.zoomLevel=s),n.zoomPosition=l),t.lastWheelTime=o,t["zoom"+(e.deltaY>0?"Out":"In")](void 0,t.zoomContext)}}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}};const zC=e=>{var t;return null===(t=e.enableRecurringEvents)||void 0===t?void 0:t.defaultAction};class jC extends eh{static $name="RecurrenceConfirmationPopup";static type="recurrenceconfirmation";static#e=ef(this,"configurable",{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}});get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){var e;null===(e=this.cancelFn)||void 0===e||e.call(this.thisObj),this.hide()}onRecurrenceClose(){var e;null===(e=this.cancelFn)||void 0===e||e.call(this.thisObj),this.hide()}confirm(e={}){var t;const n=this,r=n.closest(zC),i=null==r||null===(t=r.enableRecurringEvents)||void 0===t?void 0:t.defaultAction;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach((t=>{t in e&&(n[t]=e[t])})),"single"===i?(n.processSingleRecord(),!0):"future"===i?(n.processMultipleRecords(),!0):(n.confirmed=!1,n.updatePopupContent(),super.show(e),new Promise((e=>n.resolve=e)))}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:n}=e.widgetMap,{eventRecord:r,actionType:i="update"}=e,s=null==r?void 0:r.isRecurring;t&&n?(s?(t.initialConfig.text||(t.text=e.L("L{Object.Yes}")),e.html=e.L(`${i}-all-message`)):(t.initialConfig.text||(t.text=e.L(`${i}-further-btn-text`)),e.html=e.L(`${i}-further-message`)),n.initialConfig.text||(n.text=e.L(`${i}-only-this-btn-text`))):((t||n).text=e.L("L{Object.Yes}"),e.html=s||t?e.L(`${i}-all-message`):e.L(`${i}-only-this-message`)),e.width=e.L("L{width}"),e.title=e.L(`${i}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:n,finalizerFn:r}=this;e.beginBatch(),t&&this.callback(t,n,[e]),e.endBatch(),r&&this.callback(r,n,[e]),this.confirmed=!0}processSingleRecord(){const{eventRecord:e,changerFn:t,thisObj:n,finalizerFn:r}=this;if(e.beginBatch(),e.isRecurring){var i;let t;e.recurrence.forEachOccurrence(e.startDate,null,((e,n,r)=>{if(r>1)return t=e,!1})),null===(i=t)||void 0===i||i.convertToRealEvent()}e.recurrence=null,t&&this.callback(t,n,[e]),e.recurrenceRule=null,e.endBatch(),r&&this.callback(r,n,[e]),this.confirmed=!0}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}hide(){var e;super.hide(),null===(e=this.resolve)||void 0===e||e.call(this,this.confirmed),this.resolve=null}}jC.initClass(),jC._$name="RecurrenceConfirmationPopup";var WC=e=>class extends(e||Qe){static $name="RecurringEvents";static configurable={enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}};construct(e){super.construct(e),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(e,t){if(e)return jC.reconfigure(t,jC.mergeConfigs({owner:this},e),this)}findRecurringEventToConfirmDelete(e){return e.find((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)))}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:t}){const n=e.map((e=>e.event)),r=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&r)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:t}=e,n=t.filter((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)));n.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:t}=e;t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:t,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onAssignmentChange({action:e,records:t,changes:n}){if(("update"!==e||!n.event||!n.resource||2!==Object.keys(n).length)&&"dataset"!==e&&Array.isArray(t))for(const e of t){var r;null!==(r=e.event)&&void 0!==r&&r.isRecurring&&!e.event.isBatchUpdating&&e.event.removeOccurrences(this.eventStore)}}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(e,t=null,n=this){const r=this;if(!r.readOnly&&e.length){const i={finalize(n=!0){if(t&&t(n),!1!==n)if(e.some((e=>{var t;return e.isOccurrence||(null===(t=e.event)||void 0===t?void 0:t.isOccurrence)})))e.forEach((e=>e.isOccurrenceAssignment?e.event.remove():e.remove()));else{(e[0].isAssignment?r.assignmentStore:r.eventStore).remove(e)}}};let s;if(s=e[0].isAssignment?await r.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:i}):await r.trigger("beforeEventDelete",{eventRecords:e,context:i}),!1!==s){const t=e.find((e=>e.isRecurring||e.isOccurrence));return t?(r.recurrenceConfirmationPopup.owner=n,await r.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}})):(i.finalize(!0),!0)}}return!1}get widgetClass(){}},UC=e=>class extends(e||Qe){static $name="TimelineEventRendering";static get defaultConfig(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}static configurable={barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null};updateFillTicks(e){const t=this;if(!t.isConfiguring){const{timeAxis:n}=t;n.forceFullTicks=e&&t.snap,e&&(t.timeResolution={unit:n.mainUnit,increment:1}),t.refreshWithTransition(),t.trigger("stateChange")}}changeBarMargin(e){return W.assertNumber(e,"barMargin",!0),null==this._resourceMargin&&this.changeResourceMargin(e),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}changeResourceMargin(e){var t,n;const r=this;return null==e&&(e=this.resourceMargin),"number"==typeof e?(r.isHorizontal&&r.rowHeight&&(e=Math.min(Math.floor(r.rowHeight/2),e)),r.resourceMarginObject={start:e,end:e,total:2*e},e):(null!==(t=e)&&void 0!==t&&t.start||(e.start=0),null!==(n=e)&&void 0!==n&&n.end||(e.end=0),r.isHorizontal&&r.rowHeight&&(e.start=r.rowHeight<e.start+e.end?Math.ceil(r.rowHeight/2):e.start,e.end=r.rowHeight<e.start+e.end?Math.ceil(r.rowHeight/2):e.end),r.resourceMarginObject=W.assign({total:e.start+e.end},e),e)}updateResourceMargin(){const e=this;e.rendered&&(e.currentOrientation.onBeforeRowHeightChange(),e.refreshWithTransition())}changeTickSize(e){return W.assertNumber(e,"tickSize",!0),e}updateTickSize(e){var t;const n=this,{timeAxisViewModel:r}=n;let i,s=null,o=0;if(!n.isConfiguring&&n.isHorizontal){s=n.timelineScroller;const t=s.viewport.width/2+s.scrollLeft*(n.rtl?-1:1),a=n.getDateFromCoordinate(t);i=e-r.tickSize,o=n.timeAxis.getTickFromDate(a)}r.tickSize=e,null===(t=s)||void 0===t||t.scrollBy(o*i,0),n.trigger("tickSizeChange",{tickSize:e})}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","magenta","purple","violet","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","gantt-green","lime","yellow","orange","amber","deep-orange","light-gray","gray","black"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}updateEventStyle(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}updateEventColor(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}get widgetClass(){}};const GC=new Date(-864e13),YC=new Date(864e13);var qC=e=>class extends(e||Qe){static $name="TimelineEarlyPositioning";applyViewStartEndDates(e,t){const n=this,{visibleDate:r={}}=n,i=null==r?void 0:r.date,s=i?xi.min(e,i):e??new Date,o=i?t?xi.max(t,i):xi.add(s,n.visibleDateRange.endDate-n.visibleDateRange.startDate):t;return s&&o?(n.setTimeSpan(s,o,{...r,visibleDate:i}),!0):!!s&&(n.startDate=s,!0)}onEventStoreDataRefresh(e){"pending"===this._initialStartDateFilled&&this.tryToApplyPreCommitStartEndDates(e.source)}tryToApplyPreCommitStartEndDates(e){const t=this,n=t.project,r=n.get("startDate")??(n.replica?null:n.startDate);if(r)t.applyViewStartEndDates(r,n.get("endDate")??(n.replica?null:n.endDate)),t._initialStartDateFilled="applied";else if(e.count>0){let n=YC,r=GC;e.forEach((e=>{const t=e.get("startDate"),i=e.get("endDate");t&&t<n&&(n=t),i&&i>r&&(r=i)})),t.applyViewStartEndDates(n.getTime()!==YC.getTime()?n:null,r.getTime()!==GC.getTime()?r:null),t._initialStartDateFilled="applied"}}bindEventStoreForEarlyPositioning(e){var t;const n=this,r=n.initialConfig;void 0!==n._initialStartDateFilled||r.startDate||r.date||null!==(t=r.timeAxis)&&void 0!==t&&t.startDate||r.visibleDate||r.partner||(n._initialStartDateFilled="pending",n.tryToApplyPreCommitStartEndDates(e)),n.detachListeners("eventStoreDataRefresh"),e.ion({name:"eventStoreDataRefresh",refreshPreCommit:"onEventStoreDataRefresh",once:!0,thisObj:n})}get widgetClass(){}};const KC={maintainVisibleStart:!0},XC={block:"nearest"};var ZC=e=>class extends((e||Qe).mixin(BC)){static $name="TimelineScroll";static configurable={bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1};onZoomToSpan({startDate:e}){this.infiniteScroll&&this.scrollToDate(e,{block:"start"})}calculateOptimalDateRange(e,t,n){if(this.infiniteScroll){if(this.zoomKeepsOriginalTimespan){const{startDate:e,endDate:t}=this.timeAxis;return{startDate:e,endDate:t}}return this.calculateInfiniteScrollingDateRange(e,!0)}return super.calculateOptimalDateRange(...arguments)}initScroll(){const e=this,{isHorizontal:t,visibleDate:n}=e;super.initScroll();const{scrollable:r}=t?e.timeAxisSubGrid:e;var i;if(r.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll)if(null!==(i=e.partneredWith)&&void 0!==i&&i.values.some((e=>e.infiniteScroll))){const t=r.element.getBoundingClientRect()[e.isHorizontal?"width":"height"];e.timeAxisViewModel.update(t,!1,!0)}else{const t=n?{...n,visibleDate:n.date}:{visibleDate:e.viewportCenterDate,block:"center"},{startDate:r,endDate:i}=e.calculateInfiniteScrollingDateRange(t.visibleDate,"center"===t.block);e.setTimeSpan(r,i,t)}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new JC({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}calculateInfiniteScrollingDateRange(e,t,n=this.timeAxisViewModel.viewPreset){const r=this,{timeAxisViewModel:i,bufferCoef:s}=r,{timeAxis:o,availableSpace:a}=i,l=Math.ceil(o.totalCount/o.count),{leafUnit:d,leafIncrement:c,topUnit:u,topIncrement:h,tickSize:g}=n,m=d===u&&Math.round(h)===h&&Math.round(c)===c,p=m?h:c,f=m?u:d;if(t){const t=Math.ceil((a*s+a/2)/g)*l,n=o.floorDate(xi.add(e,-t*c,d),!1,f,p),i=o.ceilDate(xi.add(e,t*c,d),!1,f,p),u=i-n,h=r.getMinDateOrDate(n);let m=r.getMaxDateOrDate(i);return m<=h&&(m=r.getMaxDateOrDate(xi.add(h,u))),{startDate:h,endDate:m}}{const t=Math.ceil(a*s/g)*l,n=xi.add(e,-t*c,d),i=xi.add(e,Math.ceil((a/g+t)*c),d),u=i-n,h=r.getMinDateOrDate(n);let m=r.getMaxDateOrDate(i);return m<=h&&(m=r.getMaxDateOrDate(xi.add(h,u))),{startDate:o.floorDate(h,!1,f,p),endDate:o.ceilDate(m,!1,f,p)}}}doDestroy(){var e;null===(e=this._timelineScroller)||void 0===e||e.destroy(),super.doDestroy()}onTimelineScroll(){this.infiniteScroll&&this.checkTimeAxisScroll()}checkTimeAxisScroll(){const e=this,{minDate:t,maxDate:n}=e,{startDate:r,endDate:i}=e.timeAxis,s=e.timelineScroller,{position:o,clientSize:a}=s,l=a*e.bufferCoef*e.bufferThreshold,d=s.maxPosition,{style:c}=e.timeAxisSubGrid.virtualScrollerElement,u=o<l&&(!t||xi.isAfter(r,t)),h=d-o<l&&(!n||xi.isBefore(i,n));if(u||h){let t;c.overflow="hidden",c.pointerEvents="none",c.paddingBottom=`${Yn.scrollBarWidth}px`,e.setTimeout((()=>{c.overflow="",c.paddingBottom="",c.pointerEvents=""}),100),t=u&&h?s.position+a/2:s.position,e.shiftToDate(e.getDateFromCoordinate(t,"floor",!0,!1,!0),u&&h)}}shiftToDate(e,t){const n=this.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(n.startDate,n.endDate,t?!0===t?{visibleDate:this.viewportCenterDate,block:"center"}:t:KC)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll()}async scrollToDate(e,t={}){const n=this;if(0===n.timeAxisSubGrid.width)return;const{timeAxis:r,visibleDateRange:i,infiniteScroll:s,minDate:o,maxDate:a}=n,{unit:l,increment:d}=r,c=t.edgeOffset||0,u=xi.ceil(i.endDate,d+" "+l)-xi.floor(i.startDate,d+" "+l),h=e>n.viewportCenterDate?1:-1,g=(s?u*n.bufferCoef*n.bufferThreshold:"center"===t.block?u/2:c?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*c:0)*h,m=new Date(e.getTime()+g),p=m>r.endDate?1:m<r.startDate?-1:0;if(n.isBeforeMinDate(e)||n.isAfterMaxDate(e))return e=o&&e<o?o:a,n.scrollToDate(e,t);p&&n.infiniteScroll&&(await n.nextAnimationFrame(),n.shiftToDate(new Date(e-g),null,!0),await n.nextAnimationFrame());const f=n.timelineScroller.viewport,v=n.getCoordinateFromDate(e,!0),y=Math.min(n.timeAxisViewModel.tickSize,n.timeAxisViewModel.availableSpace),b=n.isHorizontal?new Ot(n.getCoordinateFromDate(e,!1)-(n.rtl?y:0),f.y,y,f.height):new Ot(f.x,n.getCoordinateFromDate(e,!1),f.width,n.timeAxisViewModel.tickSize);await n.scrollToCoordinate(v,b,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,n,r={}){const i=this,{startDate:s,endDate:o,hasTimelineBoundaries:a,minDate:l,maxDate:d}=i,{isContinuous:c,unit:u,increment:h}=i.timeAxis;if(e<0||c&&(n<s||n>o)){const e=o-s;let t=xi.floor(new Date(n.getTime()-e/2),h+" "+u),c=xi.add(t,e);if(a){if(i.isBeforeMinDate(n)||i.isAfterMaxDate(n))return n=l&&n<l?l:d,i.scrollToDate(n,r);i.isBeforeMinDate(t)?(t=l,c=xi.add(t,e)):i.isAfterMaxDate(c)&&(c=d,t=xi.add(c,-e))}return t-s!=0&&c-o!=0?(await i.setTimeSpan(t,c),i.scrollToDate(n,r)):void 0}return await i.timelineScroller.scrollIntoView(t,r),!i.isDestroyed&&i.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class JC extends Md{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable["client"+(this.isHorizontal?"Width":"Height")]}get scrollSize(){return this.scrollable["scroll"+(this.isHorizontal?"Width":"Height")]}get maxPosition(){return this.scrollable["max"+(this.isHorizontal?"X":"Y")]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,n=XC){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,n):this.scrollable.scrollBy(0,t||e,n)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}const QC=["barMargin"];var ew=e=>class extends(e||Qe){static $name="TimelineState";getState(){const e=this,t=W.copyProperties(super.getState(),e,QC);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:void 0,width:e.tickSize},t}applyState(e){const t=this;e=Object.assign({},e),t.suspendRefresh(),null!=e.zoomLevel&&(delete e.startDate,delete e.endDate,t.timeAxis.suspendEvents());const{zoomLevel:n,zoomLevelOptions:r}=e;var i;(delete e.zoomLevel,delete e.zoomLevelOptions,super.applyState(e),null!=n)&&(t.timeAxis.resumeEvents(),t.infiniteScroll&&null!==(i=e)&&void 0!==i&&null!==(i=i.scroll)&&void 0!==i&&i.scrollLeft&&(e.scroll.scrollLeft={}),t.whenVisible((()=>t.zoomToLevel(n,r))));t.resumeRefresh(!0,!1)}get widgetClass(){}};class tw extends Nb{static $name="SchedulerHeader";refreshContent(){var e;null!==(e=this.headersElement)&&void 0!==e&&e.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}}tw._$name="Header";class nw extends uC{static $name="TimeAxisSubGrid";static type="timeaxissubgrid";static get configurable(){return{sealedColumns:!0,headerClass:tw}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass,"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){var e;return(null===(e=this.element)||void 0===e?void 0:e.scrollWidth)??0},set(){e.positionDirty=!0,e.grid.updateCanvasSize()}}),t}handleHorizontalScroll(e=!0){this.grid._viewPresetChanging||super.handleHorizontalScroll(e)}onInternalResize(e,t,n,r,i){const s=this;if(super.onInternalResize(...arguments),s.isPainted&&t!==r){const e=s.grid,n=e._bodyRectangle.height,i=s.monitorResize&&Yn.scrollBarWidth&&t<r;i&&(s.monitorResize=!1),e.onSchedulerViewportResize(t,n,r,n),i&&s.queueMicrotask((()=>s.monitorResize=!0))}}get headerScrollWidth(){return this.grid.isVertical?super.headerScrollWidth:this.grid.timeAxisViewModel.totalSize}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(e=!1,t=!1){const{owner:n}=this;await super.expand(e,t),n.isPainted&&n.timeAxisViewModel.update(this.width,!1,!0)}}nw.initClass(),nw._$name="TimeAxisSubGrid";const rw=(e,t,n)=>null==t?null==n||e<n:null==n?e>=t:t<n?t<=e&&e<n:e<n||t<=e,iw={};class sw extends(wC.mixin(_C,VC,UC,qC,BC,ZC,ew,NC,WC)){static $name="TimelineBase";static type="timelinebase";static configurable={animateTreeNodeToggle:!1,partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset","infiniteScroll"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},minDate:null,maxDate:null,partner:null,stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null,hideRowHover:{$config:"lazy",value:!0}};static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}timeCellSelector=null;updateTimeZone(e){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e)}get timeZone(){var e;return null===(e=this.project)||void 0===e?void 0:e.timeZone}get hasTimelineBoundaries(){return Boolean(this.minDate||this.maxDate)}populateEventMenu(){}populateScheduleMenu(){}internalOnVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:n}=t;(!n||n.startDate-e.startDate||n.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:n,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}onVisibleResourceColumnChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const n=this,{stickyHeaders:r}=n;return e===(n.schedulerRegion||"normal")?t.type="timeaxissubgrid":"locked"===e&&r&&n.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},"resizable"in t||(t.resizable=!1),n.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:n}=e;if(null==n||n.destroy(),e._bodyContainer&&fd.removeResizeListener(e._bodyContainer,e.onBodyResize),t){for(let n=t.count-1;n>-1;--n){const r=t.getAt(n);e.removePartner(r)}t.destroy()}else e.timeAxisViewModel.destroy(),e.timeAxis.destroy();super.doDestroy()}startConfigure(e){const t=this;super.startConfigure(e),t.onBodyResize=t.onBodyResize.bind(t),t._bodyContainer&&fd.addResizeListener(t._bodyContainer,t.onBodyResize),t.getConfig("partner")}onInternalPaint({firstPaint:e}){if(e){const e=this,r=(e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable).element.getBoundingClientRect()[e.isHorizontal?"width":"height"];var t,n;if(e.timeAxisViewModel.update(r,e.infiniteScroll,!0),e.infiniteScroll)null===(t=(n=e.currentOrientation).doUpdateTimeView)||void 0===t||t.call(n);e.getConfig("hideRowHover")}super.onInternalPaint(...arguments)}onSchedulerHorizontalScroll(e,t,n,r){this.currentOrientation.updateFromHorizontalScroll(n),super.onSchedulerHorizontalScroll(e,t,n,r)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:n,scrollLeft:r,scrollX:i,scrollingToCenter:s})=>{!e.isPainted||n!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(n,r,i,s),t++}}),"horizontal"===e.testPerformance&&e.setTimeout((()=>{const n=performance.now();let r=5,i=1;const s=e.setInterval((()=>{if(r+=5,e.scrollX+=(10+Math.floor(r))*i,1===i&&e.scrollX>5500&&(i=-1,r=5),-1===i&&e.scrollX<=0){const r=(performance.now()-n)/t,i=Math.round(1e3/r*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,i+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...n){const r=this,i=r.viewportCenterDate,s=e.apply(t,n),o=r.timelineScroller,{clientSize:a}=o,l=Math.max(Math.floor(r.getCoordinateFromDate(i,!0)-a/2),0);return o.scrollTo(l,{scrollingToCenter:!0}),s}setTimeSpan(e,t,n=iw){const r=this,{timeAxis:i}=r,{preventThrow:s=!1,maintainVisibleStart:o=!1,visibleDate:a}=n,{startDate:l,endDate:d}=i.getAdjustedDates(e,t),c=i.startDate-l!=0,u=i.endDate-d!=0;if(c||u){if(o){const{timeAxisViewModel:e}=r,{totalSize:t}=e,n=e.tickSize,i=r.timelineScroller,s=i.position,o=e.getDateFromPosition(s);o>=l&&o<d&&e.ion({update(){const a=e.tickSize!==n;r.updateCanvasSize(),!c||u||a?i.position=c||a?e.getPositionFromDate(o):s:i.position+=e.totalSize-t,i.syncPartners(!0)},prio:1e4,once:!0})}r.lastViewPresetOptions&&(r.lastViewPresetOptions={startDate:l,endDate:d});const e=i.reconfigure({startDate:l,endDate:d},!1,s);return a?r.scrollToDate(a,n).then((()=>e)):e}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=N.capitalize(this.scheduledEventName)),this._capitalizedEventName}updatePartner(e){e&&this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){null==t._partner&&(t._partner=e);(t.partneredWith||(t.partneredWith=new ho)).add(e),(e.partneredWith||(e.partneredWith=new ho)).add(t),t.getConfig("viewPreset"),t.getConfig("infiniteScroll"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t});const n=t.partnerSharedConfigs.reduce(((t,n)=>(t[n]=e[n],t)),{});n.viewPreset.options={scrollPosition:e.timelineScroller.position,tickSize:e.tickSize},t._ownTimeAxis=t.timeAxis,t._ownTimeAxisViewModel=t.timeAxisViewModel,t.setConfig(n),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.isPainted?(e.scrollable.addPartner(t.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=ee.createSequence(t.initScroll,(()=>{e.scrollable.addPartner(t.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()}),t)}}removePartner(e){const t=this,{partneredWith:n,timeAxis:r}=t;if(t.isPartneredWith(e)){t._partner===e&&(t._partner=null),n.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e});const{scrollLeft:i,scrollTop:s}=e;if(e.removePartner(t,!0),r.owner!==t&&!t.isDestroying){t.timeAxis={...e.timeAxis.getCurrentConfig({skip:{owner:1}}),owner:t};const n=e.timeAxisViewModel.getCurrentConfig({skip:{owner:1,timeAxis:1,internalListeners:1}});t.timeAxisViewModel={...n,owner:t,timeAxis:t.timeAxis},t.scrollLeft=i,t.scrollTop=s,t.timeAxisViewModel.update(t.timeAxisSubGridElement.getBoundingClientRect()[t.isHorizontal?"width":"height"])}}}isPartneredWith(e){var t;return Boolean(null===(t=this.partneredWith)||void 0===t?void 0:t.includes(e))}onPartnerPresetChange({preset:e,startDate:t,endDate:n,centerDate:r,zoomDate:i,zoomPosition:s,zoomLevel:o}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:n,centerDate:r,zoomDate:i,zoomPosition:s,zoomLevel:o},this.viewPreset=e)}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),[...new Set(e)]}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}async show(){await super.show(...arguments),this.partner&&this.partner.eachSubGrid((e=>e.scrollable.syncPartners()))}changeColumns(e,t){const n=this;let r,{timeAxisColumnConfig:i}=n;if(e){const t=Array.isArray(e);let s=e;t||(s=e.data),r=s&&s.length,s.some(((e,t)=>"timeAxis"===e.type&&(r=t,i=W.assign(e,n.timeAxisColumn),!0))),n.isVertical?(s=[W.assign({type:"verticalTimeAxis"},n.verticalTimeAxisColumn),s[r]],r=1):s=s.slice(),s[r]=this._timeAxisColumn||W.assign({type:"timeAxis",cellCls:n.timeCellCls,mode:n.mode},i),t||e.isStore&&e.owner!==this?e=s:e.data=s}return super.changeColumns(e,t)}updateColumns(e,t){if(super.updateColumns(e,t),e){const e=this,t=e._timeAxisColumn=e.columns.find((e=>e.isTimeAxisColumn));e.isVertical&&(e.verticalTimeAxisColumn=e.columns.find((e=>e.isVerticalTimeAxisColumn)),e.verticalTimeAxisColumn.relayAll(e)),t.relayAll(e)}}onColumnsChanged({action:e,changes:t,record:n,records:r}){var i;const{timeAxisColumn:s,columns:o}=this;"dataset"!==e&&"batch"!==e||o.includes(s)?n===s&&"width"in t&&this.updateCanvasSize():o.add(s,!0),n&&(null===(i=this.partneredWith)||void 0===i||i.forEach((e=>{const r=e.columns.getAt(n.allIndex);if(null!=r&&r.shouldSync(n)){const e={};for(const n in t)e[n]=t[n].value;r.set(e)}}))),super.onColumnsChanged(...arguments)}get timeView(){var e,t;const n=this;return n.columns&&n.isVertical?null===(e=n.verticalTimeAxisColumn)||void 0===e?void 0:e.view:null===(t=n.timeAxisColumn)||void 0===t?void 0:t.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector=`.${e}-wrap`),t.eventInnerSelector||(t.eventInnerSelector=`.${e}`)}set timeAxisViewModel(e){var t,n;const r=this,i=r._timeAxisViewModel,s={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:r};r.isConfiguring&&r.initialConfig.partner&&(e=r.initialConfig.partner.timeAxisViewModel),i&&i===e||((null==i?void 0:i.owner)===r&&i.destroy(),r.detachListeners("timeAxisViewModel"),null!==(t=e)&&void 0!==t&&t.isTimeAxisViewModel?e.ion(s):e=OC.new({mode:r._mode,snap:r.snap,forceFit:r.forceFit,timeAxis:r.timeAxis,suppressFit:r.suppressFit,internalListeners:s,owner:r},e),r._timeAxisViewModel=e,r.isHorizontal&&r.timeAxisColumn?r.timeAxisColumn.timeAxisViewModel=e:r.isVertical&&null!==(n=r.verticalTimeAxisColumn)&&void 0!==n&&n.view&&(r.verticalTimeAxisColumn.view.model=e),r.relayEvents(e,["update"],"timeAxisViewModel"),i&&e&&r.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e;return(null===(e=this._timeAxisViewModel)||void 0===e?void 0:e.suppressFit)??this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){var t;const n=this,r=n._timeAxis,i={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:n};n._partner&&!e||r&&r===e||(r&&r.owner===n&&r.destroy(),n.detachListeners("timeAxis"),null!==(t=e)&&void 0!==t&&t.isTimeAxis||(e=W.assign({owner:n,viewPreset:n.viewPreset,autoAdjust:n.autoAdjustTimeAxis,weekStartDay:n.weekStartDay,forceFullTicks:n.fillTicks&&n.snap},e),n.startDate&&(e.startDate=n.startDate),n.endDate&&(e.endDate=n.endDate),n.workingTime&&n.applyWorkingTime(e),e=new PC(e)),e.ion(i),n._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){if(e){(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}})}this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,n=t._workingTime;if(n){let t=null;n.fromHour>=0&&n.fromHour<24&&n.toHour>n.fromHour&&n.toHour<=24&&n.toHour-n.fromHour<24&&(t={from:n.fromHour,to:n.toHour});let r=null;n.fromDay>=0&&n.fromDay<7&&n.toDay>n.fromDay&&n.toDay<=7&&n.toDay-n.fromDay<7&&(r={from:n.fromDay,to:n.toDay}),e.include=t||r?{hour:t,day:r}:null}else e.include=null;var r;t.isPainted&&(t.timeAxisColumn.refreshHeader(),null===(r=t.features.columnLines)||void 0===r||r.refresh(),t.refreshWithTransition())}changeMinDate(e){return"string"==typeof e?e=xi.parse(e):xi.isDate(e)||(e=null),e}updateMinDate(e){e&&xi.isBefore(this.startDate,e)&&this.setStartDate(e,!1)}isBeforeMinDate(e){return this.minDate&&xi.isBefore(e,this.minDate)}getMinDateOrDate(e){return this.minDate?xi.max(this.minDate,e):e}changeMaxDate(e){return"string"==typeof e?e=xi.parse(e):xi.isDate(e)?this.isBeforeMinDate(e)&&(e=null):e=null,e}updateMaxDate(e){e&&xi.isBefore(e,this.endDate)&&this.setEndDate(e,!1)}isAfterMaxDate(e){return this.maxDate&&xi.isBefore(this.maxDate,e)}getMaxDateOrDate(e){return this.maxDate?xi.min(this.maxDate,e):e}changeStartDate(e){return"string"==typeof e&&(e=xi.parse(e)),e}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||iw;if("string"==typeof e&&(e=xi.parse(e)),e=n.getMinDateOrDate(e),r&&s){if(e){let r=s;if(t&&i){const t=xi.diff(i,s,o,!0);r=xi.add(e,t,o)}n.setTimeSpan(e,r)}}else n._tempStartDate=e}get startDate(){var e;const t=this,{range:n,workingTime:r}=t;let i=(null===(e=t._timeAxis)||void 0===e?void 0:e.startDate)||t._tempStartDate;if(!i){if(i=xi.floor(t.peekConfig("date")||new Date,n),t.calendar&&(t._tempEndDate=xi.add(i,n)),r)for(;o=r,!rw((s=i).getDay(),o.fromDay,o.toDay)||!rw(s.getHours(),o.fromHour,o.toHour);)i.setHours(i.getHours()+1);t._tempStartDate=i}var s,o;return i}changeEndDate(e){this.setEndDate(e)}setEndDate(e,t=!1){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||iw;if("string"==typeof e&&(e=xi.parse(e)),e=n.getMaxDateOrDate(e),r&&i){if(e){let r=i;if(t&&s){const t=xi.diff(i,s,o,!0);r=xi.add(e,-t,o)}n.setTimeSpan(r,e)}}else n._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||xi.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){return"string"==typeof e?this.changeVisibleDate({date:e}):e instanceof Date?{date:e,block:this.isConfiguring?"start":"nearest"}:e instanceof Object?{...e,date:"string"==typeof e.date?xi.parse(e.date):e.date,block:e.block||(this.isConfiguring?"start":"nearest")}:void 0}updateVisibleDate(e){const t=this;t.infiniteScroll&&t.isConfiguring||(t.isPainted?t.scrollToDate(e.date,e):t.visibleDateProcessed||(t.whenVisible((()=>t.updateVisibleDate(t.visibleDate))),t.visibleDateProcessed=!0))}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:n,height:r}){this.isVertical&&t&&n!==t.width&&delete this.timeAxisSubGrid._width;const i=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&r!==t.height&&this.onSchedulerViewportResize(i,r,i,t.height)}onSchedulerViewportResize(e,t,n,r){if(this.isPainted){const i=this,{isHorizontal:s,partneredWith:o}=i;i.currentOrientation.onViewportResize(e,t,n,r),i.updateViewModelAvailableSpace(s?e:Math.floor(t)),o&&!i.isSyncingFromPartner&&i.syncPartnerSubGrids(),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:n,oldHeight:r})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){this._viewPresetChanging||!this.timeAxisSubGrid||this.timeAxisSubGrid.collapsed||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid((t=>{const n=e.subGrids[t.region];if(n.width!==t.width)if(t.flex)t.flex!==n.flex&&(n.flex=t.flex);else if(n.hasCalculatedWidth&&t.hasCalculatedWidth){const e=Math.max(n.totalFixedWidth,t.totalFixedWidth);n.width=t.width=e,n.hasCalculatedWidth=t.hasCalculatedWidth=!0}else n.width=t.width})),e.isSyncingFromPartner=!1)}))}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",eo.generateId("svg")),t.classList.add("b-sch-canvas","b-sch-dependencies-canvas"),t.retainElement=!0,e.timeAxisSubGridElement.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){var e;this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=null===(e=this.timeAxisColumn)||void 0===e?void 0:e.subGridElement);return this._timeAxisSubGridElement}updateCanvasSize(){const e=this;let t=!1;if(e.isVertical){const{totalSize:n}=e.timeAxisViewModel;e.isPainted&&e.refreshTotalHeight(n+e._rowBorderHeight,!0),e.suppressFit&&Yn.setLength(e.foregroundCanvas,"height",n),t=!0}return t}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;var n;t.isVisible?("dataset"===e&&null!==(n=t.project)&&void 0!==n&&n.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.isVertical||t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?!t.project||t.isEngineReady?t.refreshRows(null,!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,{total:t}=e.resourceMarginObject,n=e.timeAxisSubGridElement,r=e._foregroundCanvas=Yn.createElement({className:"b-sch-canvas b-sch-foreground-canvas",style:`font-size:${e.rowHeight-t}px`,parent:n});e.canvases={event:r},e.timeAxisSubGrid.insertRowsBefore=r,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=null,t=!1,n=!0){this.isConfiguring||(this.currentOrientation.refreshRows(e,n),super.refreshRows(e,t))}updateHideHeaders(e){const t=this,n=t.isPainted?t.scrollLeft:0;super.updateHideHeaders(e),t.isPainted&&(e||t.timeAxisColumn.refreshHeader(null,!0),t.nextAnimationFrame().then((()=>t.scrollLeft=n)))}updateHideRowHover(e){this.timeAxisSubGridElement.classList.toggle("b-hide-row-hover",e)}getCellDataFromEvent(e,t){if(!e.target.closest(".b-verticaltimeaxis-cell"))return t&&(t=!Boolean(e.target.closest(".b-sch-foreground-canvas"))),super.getCellDataFromEvent(e,t)}onCellNavigate(e,t,n){var r,i;const s=n.target;null===(r=n.cell)||void 0===r||!r.classList.contains("b-timeaxis-cell")||null!==(i=ir.currentMouseDown)&&void 0!==i&&i.target.classList.contains("b-grid-cell")||(this.preventDragSelect=!0),null!=s&&s.matches(this.eventSelector)&&!1===this.selectResourceOnEventNavigate||null!=s&&s.matches(".b-timeaxis-cell")&&!1===this.selectResourceOnScheduleClick||super.onCellNavigate(...arguments)}async waitForAnimations(){!this.isEngineReady&&this.project&&await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t=!0){const n=this;!n.refreshSuspended&&n.isPainted&&(n.rowManager.topRow?n.runWithTransition((()=>n.refresh(e)),t):n.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some((e=>{var t;return e.column?e.column.isTimeAxisColumn:null===(t=e.cell)||void 0===t?void 0:t.closest(".b-timeaxis-cell")}))}formatDuration(e,t=this.durationDisplayPrecision){const n=Math.pow(10,t);return Math.round(e*n)/n}beginListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,null===(e=this.syncSplits)||void 0===e||e.call(this,(e=>e.beginListeningForBatchedUpdates()))}endListeningForBatchedUpdates(){var e;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),null===(e=this.syncSplits)||void 0===e||e.call(this,(e=>e.endListeningForBatchedUpdates()))}onConnectedCallback(e,t){e&&!t&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(e){const t=this,{isConfiguring:n}=t;let r;n||(r=t.visibleDateRange),super.updateRtl(e),n||(t.currentOrientation.clearAll(),t.infiniteScroll?(t.shiftToDate(r.startDate),t.scrollToDate(r.startDate,{block:"start"})):t.timelineScroller.position+=.5)}applyStartEndParameters(e){const t=this,n=t.eventStore.modelClass.fieldMap.startDate;t.passStartEndParameters&&(e[t.startParamName]=n.print(t.startDate),e[t.endParamName]=n.print(t.endDate))}intersectsVisibleTimeSpan(e){return this.timeAxis.isTimeSpanInAxis(e)}highlightEvents({events:e,scroll:t=!0,unhighlightOnClick:n=!0,unhighlightOthers:r=!1}){var i;const s=this,{viewportCenterDate:o,rowManager:a}=s,l=s._highlightedAssignments??(s._highlightedAssignments=[]),d=s.internalGetAssignmentsToHighlight(e);let c,u,h;if(t&&d.length>1){var g;const e=s.getMilliSecondsPerPixelForZoomLevel(s.viewPreset),{y:t,height:n}=s._bodyRectangle,r=t+n/2,i=null===(g=a.getRowAt(r)??a.bottomRow)||void 0===g?void 0:g.top;h=t=>{const n=t.isTask?t:t.event,r=t.isTask?t:t.resource,l=(o>n.endDate?o-n.endDate:n.startDate-o)/e,d="vertical"===s.mode?s.variableColumnWidths?r.instanceMeta(s).insetStart:s.currentOrientation.allResourceRecords.indexOf(r)*s.resourceColumnWidth:a.getRecordCoords(r).y,c=Math.abs(i-d);return Math.sqrt(l*l+c*c)}}r&&l.length&&s.unhighlightEvents({events:[...l]}),d.forEach((e=>{let n;l.includes(e)||(l.push(e),s.currentOrientation.toggleCls(e,"b-highlighted",!0),e.instanceMeta(s).isHighlighted=!0),t&&s.store.includes(e.isTask?e:e.resource)&&(h?((n=h(e))<u||null==u)&&(u=n,c=e):c=e)})),s.timeAxisSubGridElement.classList.toggle("b-is-highlighting",!0),c&&s[`scroll${s.isGantt?"Task":"Assignment"}IntoView`](c,!0!==t?t:void 0),n&&!s._highlightEventsListener&&(s._highlightEventsListener=Jt.on({element:globalThis,autoDetach:!0,thisObj:s,pointerdown:s.unhighlightEvents})),null===(i=this.syncSplits)||void 0===i||i.call(this,(e=>e.highlightEvents({...arguments[0],unhighlightOnClick:!1})))}unhighlightEvents(e){var t;const n=this,{_highlightedAssignments:r}=n;let i=null==e?void 0:e.events;if(e instanceof Event){const{target:t}=e;if(t.closest(".b-virtual-scroller")||n.bodyContainer===t&&n.scrollable.hasOverflowY&&(e.offsetX>t.clientWidth||!Yn.scrollBarWidth&&e.offsetX>t.clientWidth-15))return;i=null}if(null!=r&&r.length){const e=i&&n.internalGetAssignmentsToHighlight(i);for(let t=r.length-1;t>=0;t--){const i=r[t];e&&!e.includes(i)||(n.currentOrientation.toggleCls(i,"b-highlighted",!1),i.instanceMeta(n).isHighlighted=!1,r.splice(t,1))}}null!=r&&r.length||n.timeAxisSubGridElement.classList.toggle("b-is-highlighting",!1),n._highlightEventsListener&&(n._highlightEventsListener(),n._highlightEventsListener=null),null===(t=this.syncSplits)||void 0===t||t.call(this,(t=>t.unhighlightEvents(e)))}}sw.initClass(),G.setVersion("scheduler","6.2.2"),sw._$name="TimelineBase";var ow=e=>class extends(e||Qe){static $name="ResourceStoreMixin";get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,id:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:n}){super.onRecordIdChange({record:e,oldValue:t,value:n}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:e,endDate:t}){return this.query((n=>this.eventStore.isDateRangeAvailable(e,t,null,n)))}},aw=e=>class extends(e||Qe){static $name="PartOfProject"},lw=e=>class extends e{static $name="ResourceModelMixin";static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string"},"eventColor","eventStyle","imageUrl","image","resourceMargin",{name:"barMargin",type:"number"},"eventLayout",{name:"allowOverlap",type:"boolean"},{name:"showAvatar",type:"boolean"}]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){this.assignmentStore.remove(this.assignments),e.forEach((e=>{e.resource=this}))}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const t=e.split(" ");return t[0][0]+(t.length>1?t[t.length-1][0]:"")}isWorkingTime(e){var t,n;const r=this.effectiveCalendar||(null===(t=this.project)||void 0===t?void 0:t.calendar);return!r||(null===(n=r.isWorkingTime)||void 0===n?void 0:n.call(r,e))}getEventStartingAfter(e){let t,n=Number.MAX_VALUE;return this.events.forEach((r=>{r.isScheduled&&r.startDate>=e&&r.startDate<n&&(t=r,n=r.startDate)})),t}getEventEndingBefore(e){let t,n=0;return this.events.forEach((r=>{r.isScheduled&&r.endDate<=e&&r.endDate>n&&(t=r,n=r.endDate)})),t}get eventColor(){var e;return this.get("eventColor")||(null===(e=this.parent)||void 0===e?void 0:e.eventColor)}set eventColor(e){return this.set("eventColor",e)}};function dw(e){const t=[],n=[];let r;return[function*(){for(r||(r=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),r;){const{value:t,done:i}=r.next();if(i){r=null,e=null;break}n.push(t),yield t}}(),function*(){for(r||(r=e[Symbol.iterator]());n.length&&(yield*n,n.length=0),r;){const{value:n,done:i}=r.next();if(i){r=null,e=null;break}t.push(n),yield n}}()]}class cw{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new cw(e)}copy(){const[e,t]=dw(this.iterable);return this.iterable=t,new cw(e)}split(){const[e,t]=dw(this.iterable);return[new cw(e),this.derive(t)]}inBatchesBySize(e){return this.derive(function*(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const n=[];for(const r of e)n.length===t&&(yield n,n.length=0),n.push(r);n.length>0&&(yield n)}(this.iterable,e))}filter(e){return this.derive(function*(e,t){let n=0;for(const r of e)t(r,n++)&&(yield r)}(this.iterable,e))}drop(e){return this.derive(function*(e,t){let n=0;for(const r of e)++n>t&&(yield r)}(this.iterable,e))}map(e){return this.derive(function*(e,t){let n=0;for(const r of e)yield t(r,n++)}(this.iterable,e))}reduce(e,t){return function(e,t,n){let r=0,i=n;for(const n of e)i=t(i,n,r++);return i}(this,e,t)}concat(){return this.derive(function*(e){for(const t of e)yield*t}(this.iterable))}uniqueOnly(){return this.derive(function*(e){const t=new Set;for(const n of e)t.has(n)||(t.add(n),yield n)}(this.iterable))}uniqueOnlyBy(e){return this.derive(function*(e,t){const n=new Set;for(const r of e){const e=t(r);n.has(e)||(n.add(e),yield r)}}(this.iterable,e))}every(e){return function(e,t){let n=0;for(const r of e)if(!t(r,n++))return!1;return!0}(this,e)}some(e){return function(e,t){let n=0;for(const r of e)if(t(r,n++))return!0;return!1}(this,e)}takeWhile(e){return this.derive(function*(e,t){let n=0;for(const r of e){if(!t(r,n++))return;yield r}}(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new hw(this)}}const uw=e=>new cw(e);class hw extends cw{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new cw(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,n=e.length;for(n>0&&(yield*e);;){if(e.length>n){for(let t=n;t<e.length;t++)yield e[t];n=e.length}if(!t)break;const{value:r,done:i}=t.next();i?(t=this.$iterator=null,this.$iterable=null):(e.push(r),n++,yield r)}}else yield*e}}const gw=e=>new hw(e),mw=Symbol("MixinIdentity"),pw=Symbol("MixinStateProperty");class fw{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=gw(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return void 0!==this.$topoLevels?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return void 0!==this.$elementsByTopoLevel?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let n=e.get(t);return n||(n=[],e.set(t,n)),n}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?uw(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,n=uw(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[n,r])=>(n>e&&(e=n),this.getOrCreateLevel(t,n).push(r),t)),new Map);return this.getOrCreateLevel(n,e+1).push([this.sourceEl]),uw(n).map((([e,n])=>[e,uw(n).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*uw(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}}let vw=1;const yw=e=>class extends e{};class bw{}class Cw{constructor(){this.id=vw++,this.requirements=[],this.baseClass=bw,this.identitySymbol=void 0,this.mixinLambda=yw,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=fw.new({sourceEl:t,baseEl:ww(t.baseClass)});const n=t.mixinLambda,r=t.identitySymbol=Symbol(n.name),i=Object.assign((function(e){const t=n(e);return t.prototype[r]=!0,t}),{[mw]:r,[pw]:t});return Object.defineProperty(i,Symbol.hasInstance,{value:Sw}),t.mixinLambda=i,t}get minimalClass(){return void 0!==this.$minimalClass?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,n=t.baseClassesIds.get(e);if(void 0!==n)return n;const r=vw++;return t.baseClassesIds.set(e,r),r}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const n=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,n)=>{const{cls:r,hash:i}=t,s=i+String.fromCharCode(n.id);let o=e.minimalClassesByLinearHash.get(s);return o||(o=n.mixinLambda(r),n.name=o.name,e.minimalClassesByLinearHash.set(s,o)),t.cls=o,t.hash=s,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(n,{[mw]:this.identitySymbol,[pw]:this,mix:this.mixinLambda,derive:e=>Ew([r,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:Sw}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>`${t.name}(${e})`),this.baseClass.name)}}Cw.minimalClassesByLinearHash=new Map,Cw.baseClassesIds=new Map;const ww=e=>Object.getPrototypeOf(e.prototype).constructor[pw],Sw=function(e){return Boolean(e&&e[this[mw]])},Dw=(e,t)=>Boolean(e&&e[t[mw]]),Ew=(e,t)=>{let n;if(e.length>0){const t=e[e.length-1];r=t,Object.getPrototypeOf(r.prototype).constructor.hasOwnProperty(pw)||t===bw||(n=t)}var r;const i=[];e.forEach(((t,r)=>{const s=t[pw];if(void 0!==s){const e=s.baseClass;if(e!==bw)if(n){if(n!==e){const t=e.prototype.isPrototypeOf(n.prototype),r=n.prototype.isPrototypeOf(e.prototype);if(!t&&!r)throw new Error("Base class mismatch");n=r?e:n}}else n=e;i.push(s)}else if(r!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}));return Cw.new({requirements:i,mixinLambda:t,baseClass:n||bw}).minimalClass};class xw extends(Ew([],(e=>{e.prototype;return class extends e{get isPartOfProjectRaw(){return!0}async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){const{project:e}=this;return e||this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}}}))){}class Rw extends(Ew([xw],(e=>{e.prototype;return class extends e{get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}getEventById(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}}}))){}class Tw extends(Ew([xw,Il],(e=>{const t=e.prototype;class n extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,n){const r=this,{asyncEvents:i,project:s}=r,o=null==i?void 0:i[e];return o&&(!0===o||o[n.action])?(t.trigger.call(r,`${e}PreCommit`,{...n}),!s||s.isEngineReady()&&!s.isWritingData?t.trigger.call(r,e,n):!r.eventsSuspended&&s&&(s.dataReadyDetacher||(s.queuedDataReadyEvents=[],s.dataReadyDetacher=s.ion({dataReady(){this.queuedDataReadyEvents.forEach((([e,t,n,r])=>{e.trigger.call(t,n,r)})),s.queuedDataReadyEvents=null,s.dataReadyDetacher(),s.dataReadyDetacher=null},once:!0})),s.queuedDataReadyEvents.push([t,r,e,n])),!0):t.trigger.call(r,e,n)}calculateProject(){return this.project}setStoreData(e){var n;!this.project||this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag||(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(n=this.project)||void 0===n||n.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const n=this.add(e,t);return await this.project.commitAsync(),n}async insertAsync(e,t,n){const r=this.insert(e,t,n);return await this.project.commitAsync(),r}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}}return n.$name="AbstractPartOfProjectStoreMixin",n}))){}class Mw extends(Ew([xw,_s],(e=>{const t=e.prototype;return class extends e{joinStore(e){let n=null;if(Dw(e,Tw)){const t=e.getProject();t&&!this.getProject()&&(this.setProject(t),n=t)}t.joinStore.call(this,e),n&&!n.isRepopulatingStores&&this.joinProject()}unjoinStore(e,n=!1){t.unjoinStore.call(this,e,n);const{project:r}=this,i=Dw(e,Tw)&&!e.isFillingFromMaster&&r===(e.isChained&&e.project?e.masterStore.project:e.project);var s;r&&!r.isDestroying&&!r.isRepopulatingStores&&i&&(null===(s=e.untrackRecordFieldChanges)||void 0===s||s.call(e),this.leaveProject(n),this.setProject(null));i&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){var e;const t=null===(e=this.stores)||void 0===e?void 0:e.find((e=>Dw(e,Tw)&&!!e.getProject()));return null==t?void 0:t.getProject()}async setAsync(e,t,n){var r;const i=this.set(e,t,n);return await(null===(r=this.project)||void 0===r?void 0:r.commitAsync()),i}async getAsync(e){var t;return await(null===(t=this.project)||void 0===t?void 0:t.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(null==e?void 0:e.isRestoringData)||(null==e?void 0:e.stm.isRestoring)||!1}}}))){}class kw extends(Ew([Mw,Rw,_s],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){!this.isRoot&&this.invalidate()}leaveProject(e=!1){var n;this.project.$leaving.add(this),t.leaveProject.call(this,e),null===(n=this.project)||void 0===n||n.bufferedCommitAsync()}invalidate(){var e;!this._preventInvalidation&&(null===(e=this.project)||void 0===e||e.invalidate(this))}getCurrentOrProposed(e){return e in this.$changed&&!0!==this.$changed[e]?this.$changed[e]:this.get(e)??null}hasCurrentOrProposed(e){return e in this.$changed&&1!=this.$changed[e]||null!=this.get(e)}propose(e){var t;if(this.project||null!==(t=this.recurringTimeSpan)&&void 0!==t&&t.project){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.$changed[r]=e[r]}this.invalidate()}else this.set(e)}setChanged(e,t,n=!0,r=!1){const i=this;i.$changed[e]=t,r&&(e in i.$beforeChange||(i.$beforeChange[e]=i.get(e)),i.setData(e,t)),n&&i.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){}class Fw extends(Ew([kw],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this))));t.joinProject.call(this)}leaveProject(e=!1){var n;if(this.assigned&&!e&&(null===(n=this.resourceStore)||void 0===n||!n.isLoadingData)){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,n,r,i,s){"id"===(null==s?void 0:s.name)&&this.assigned.forEach((e=>{e.set("resourceId",r)})),t.applyValue.call(this,e,n,r,i,s)}}}))){}const Iw=Fw;class Aw extends(lw(aw(Iw.derive(Wv)))){static $name="ResourceModel"}Aw.exposeProperties(),Aw._$name="ResourceModel";class Lw extends(Ew([Tw,Rw,Il],(e=>{const t=e.prototype;return class extends e{setProject(e){const n=t.setProject.call(this,e);return e&&this.joinProject(e),n}joinProject(e){}onCommitAsync(){}joinRecordsToProject(e){const t=t=>{t.setProject(e),t.joinProject()};this.rootNode?this.rootNode.traverse(t):this.forEach(t)}unjoinRecordsFromProject(e){const t=t=>{t.leaveProject(),t.setProject(e)},n=this.rootNode;n?n.traverse((e=>{e!==n&&t(e)})):this.forEach(t)}}}))){}const Pw={splice:1,clear:1};class Ow extends(Ew([Tw],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var t;const n=Pw[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterResourceRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterResourceRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterResourceRemoval(),n}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}processRecord(e,t=!1){const n=this.getById(e.id);if(n&&n!==e)for(const t of n.assigned||[])t.resource=e;return e}}}))){}class $w extends(Ew([Ow,Lw],(e=>{const t=e.prototype;return class extends e{static get defaultConfig(){return{modelClass:Fw}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}afterLoadData(){var e,n;null===(e=t.afterLoadData)||void 0===e||e.call(this),null===(n=this.assignmentStore)||void 0===n||n.linkAssignments(this,"resource")}clear(e){var n;t.clear.call(this,e),null===(n=this.assignmentStore)||void 0===n||n.unlinkAssignments("resource")}}}))){}const _w=aw($w.derive($l));class Hw extends(ow(_w)){static $name="ResourceStore";static get defaultConfig(){return{modelClass:Aw}}}Hw._$name="ResourceStore";class Vw{ranges=[];promises=[];addPromise(e){null!=e&&e.then&&(this.promises.push(e),e.then((()=>{this.promises.splice(this.promises.indexOf(e),1)})))}addRange(e,t,n){this.addPromise(n);const r=this.getRange(e);if((null==r?void 0:r.endDate)<t)return void r.endDate.setTime(t.getTime());const i=this.getRange(t);(null==i?void 0:i.startDate)>e?i.startDate.setTime(e.getTime()):(e=new Date(e.getTime()),t=new Date(t.getTime()),this.ranges.push({startDate:e,endDate:t}))}containsRange(e,t){return this.ranges.some((n=>xi.timeSpanContains(n.startDate,n.endDate,e,t)))}getRange(e){return this.ranges.filter((t=>xi.betweenLesserEqual(e,t.startDate,t.endDate)))[0]}}class Nw extends(Al.mixin(Hi)){static $name="DateStoreLazyLoadPlugin";static get pluginConfig(){const e={};for(const t in super.pluginConfig)e[t]=[...super.pluginConfig[t]];e.assign.push("updateProject");const t=e.assign.indexOf("lazyGetAt");return t>=0&&e.assign.splice(t,1),e.before=e.before??[],e.before.push("getEventsAsArray"),e}static configurable={bufferUnit:null,bufferAmount:null,dateFormat:"YYYY-MM-DD",loadFullDateRange:!1,loadFullResourceRange:!1};afterConstruct(){super.afterConstruct(...arguments),this.listenToProject()}get project(){return this.client.project}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}updateProject(){this.listenToProject()}listenToProject(){var e;const{project:t}=this;null===(e=this.$projectListenersDetacher)||void 0===e||e.call(this),null!=t&&t.ion&&(this.$projectListenersDetacher=t.ion({resourceStoreChange:"listenToResourceStore",thisObj:this})),this.listenToResourceStore()}listenToResourceStore(){const{resourceStore:e}=this;var t;null!=e&&e.lazyLoad&&e.isResourceStore&&!e.lazyLoad.$isCrudManager&&(null===(t=this.$resourceStoreListenersDetacher)||void 0===t||t.call(this),this.$resourceStoreListenersDetacher=e.ion({afterLazyLoad:"afterResourceStoreLazyLoad",thisObj:this}))}afterResourceStoreLazyLoad(e){const t=this,{resourceStore:n}=t;if(!t.client.isAssignmentStore&&(e.isReload||t.$delayedReloadLoad)){if(n.tree&&n.isLoading)return void(t.$delayedReloadLoad=!0);t.load(),t.$delayedReloadLoad=!1}}getEventsAsArray({visibleDateRange:e,startDate:t,endDate:n,fromRowHeight:r,resourceRecord:i}){!r&&e&&this.bufferedLazyLoad({startDate:t,endDate:n,visibleStart:e.startDate,visibleEnd:e.endDate,resourceRecord:i})}get isLoading(){return super.isLoading||Object.values(this.loadQueue).some((e=>e.promises.length))}internalOnBeforeAdd(){}internalOnChange(){}internalOnCommit(){}updateAutoLoad(){super.autoLoad=!1}calculateDateRange({startDate:e,endDate:t,visibleStart:n,visibleEnd:r},i){let s=this.getResourceQueue(i);if(n&&r&&!this.loadFullDateRange){var o;const{bufferAmount:l,bufferUnit:d,$bufferedResourceRecords:c,resourceStore:u}=this,h=d&&null!=l?xi.asMilliseconds(l,d):r-n,g=(n,r)=>{const i=xi.clearTime(new Date(n.getTime()+r));return i<e?i.setTime(e.getTime()):i>t&&i.setTime(t.getTime()),i},m=g(n,h/-2),p=g(r,h/2);if(m>p)return!1;if(null!==(o=s)&&void 0!==o&&o.containsRange(m,p)){let e=!1;if((null==c?void 0:c.length)>1)for(let t=1;t<c.length;t++){var a;if(i=u.indexOf(c[t]),s=this.getResourceQueue(i),null===(a=s)||void 0===a||!a.containsRange(m,p)){e=!0;break}}if(!e)return!1}e=g(n,-1*h),t=g(r,h)}else{if(e>t)return!1;e=new Date(e.getTime()),t=new Date(t.getTime())}if(s){const n=s.getRange(e);if(n)e.setTime(n.endDate.getTime());else{const e=s.getRange(t);e&&t.setTime(e.startDate.getTime())}}return!(e-t>=0)&&{startDate:e,endDate:t,resourceIndex:i}}calculateResourceRange({resourceIndex:e,startDate:t,endDate:n}){const{resourceStore:r,$bufferedResourceRecords:i}=this;let s=0,o=r.count-1;if(r.lazyLoad||!this.loadFullResourceRange&&r.count){var a;const t=(null===(a=r.lazyLoad)||void 0===a?void 0:a.chunkSize)??this.chunkSize;if(s=e-t,o=e+t,(null==i?void 0:i.length)>t){const e=r.indexOf(i.pop());e>o&&(o=e+t)}for(s=Math.max(s,0);!r.records[s]&&s<o;)s+=1;for(;!r.records[o]&&s<o;)o-=1}for(;s<e&&null!==(l=this.getResourceQueue(s))&&void 0!==l&&l.containsRange(t,n);){var l;s+=1}for(;o>e&&null!==(d=this.getResourceQueue(o))&&void 0!==d&&d.containsRange(t,n);){var d;o-=1}return{startIndex:s,count:o-s+1}}getResourceQueue(e){if(null!=e){const{resourceStore:n}=this;var t;if(!this.client.isTimeRangeStore&&n.isTree)e=null===(t=n.records[e])||void 0===t?void 0:t.id;return this.loadQueue[e]}}addToQueue({startDate:e,endDate:t,startIndex:n=0,count:r=1,promise:i,resourceIds:s}){const{loadQueue:o}=this,a=n=>(o[n]||(o[n]=new Vw)).addRange(e,t,i);if(s)s.forEach(a);else for(let e=n;e<n+r;e++)a(e)}bufferedLazyLoad({resourceRecord:e}){const t=this;e||t.doLazyLoad(...arguments),t.$bufferedResourceRecords?t.$bufferedResourceRecords.push(e):(t.$bufferedResourceRecords=[e],t.requestAnimationFrame((()=>{t.doLazyLoad(...arguments),t.$bufferedResourceRecords=null})))}async doLazyLoad({isReload:e,...t}){var n;const r=this,{client:i,dateFormat:s}=r,{resourceStore:o}=r.project,a=!i.isTimeRangeStore&&o.isTree,l=t.resourceIndex??(t.resourceRecord?o.indexOf(t.resourceRecord):0);if(e&&r.clear(),t=r.calculateDateRange(t,l),!i.requestData||!1===t||a&&(o.isLoading||!o.count)||t.resourceIndex<0)return void(!o.count&&i.clear());if(!i.isTimeRangeStore){const e=r.calculateResourceRange(t);if(a){const n=o.getRange(e.startIndex,e.startIndex+e.count+1).filter((e=>{var n;return!(e.isPhantom||null!==(n=r.loadQueue[e.id])&&void 0!==n&&n.containsRange(t.startDate,t.endDate))}));if(!n.length)return;t.resourceIds=n.map((e=>e.id))}else{if(Object.assign(t,e),o.remoteFilter&&o.isFiltered)if(i.readUrl){let{filterParamName:e="filters"}=o;i.filterParamName===e&&(e="resource"+e),t[e]=o.encodeFilterParams(o.filters)}else t.resourceFilters=o.getFilterParams(o.filters);if(o.remoteSort&&o.isSorted){const{sorters:e}=o;if(i.readUrl){let{sortParamName:n}=o;i.sortParamName===n&&(n="resource"+n),t[n]=o.encodeSorterParams(e)}else t.resourceFilters=e}}}var d;(delete t.resourceIndex,!i.isEventStore||null!==(n=i.crudManager)&&void 0!==n&&null!==(n=n.transport)&&void 0!==n&&null!==(n=n.load)&&void 0!==n&&n.url)||(r.loadAssignmentStore(t,e),null===(d=r.project)||void 0===d||null===(d=d.timeRangeStore)||void 0===d||null===(d=d.lazyLoad)||void 0===d||d.doLazyLoad(t));r.triggerLazyLoadStart(t);let c=t;i.readUrl&&s?c={...t,startDate:xi.format(t.startDate,s),endDate:xi.format(t.endDate,s)}:i.readUrl||i.buildRemoteParams(c);const u=i.requestData(c);r.addToQueue({...t,promise:u});const{data:h}=await u;r.addData(h,t,e),r.triggerLazyLoadEnd(t,h)}addData(e,{resourceIds:t,startDate:n,endDate:r}={},i){const{client:s}=this;if(null!=e&&e.length&&t){const i=e.filter((e=>!t.includes(e.resourceId)));i.length&&this.addToQueue({startDate:n,endDate:r,resourceIds:i.map((e=>e.resourceId))})}if(s.isTree)return s.rootNode.appendChild(e,!0),void s.added.clear();super.addData(e,null,i)}processAddedRecords(e){const{client:t}=this;if(t.isEventStore&&t.$processResourceIds){var n;const r=t.assignmentStore??(null===(n=t.crudManager)||void 0===n?void 0:n.assignmentStore),{stm:i}=r,s=(null==i?void 0:i.enabled)&&i.autoRecord,o=[];for(const{resourceId:t,resourceIds:n,id:r}of e)null!=t?o.push({resource:t,eventId:r}):null!=n&&n.length&&o.push(...n.map((e=>({resource:e,eventId:r}))));s&&i.disable(),t.project.hasLoadedDataToCommit=!0,r.add(o),r.acceptChanges(),s&&i.enable(),t.$processResourceIds=!1}}async loadAssignmentStore(e,t){const{assignmentStore:n}=this.project,{lazyLoad:r}=n;if(r){r.triggerLazyLoadStart(),t&&r.clear();const i=n.requestData(e);r.addToQueue({...e,promise:i});const{data:s}=await i;r.addData(s,void 0,t),r.triggerLazyLoadEnd()}}load(e={}){var t;return null===(t=this.beforeLoadCall)||void 0===t||t.call(this,e),this.doLazyLoad({isReload:!0,...e})}doDestroy(){var e,t;null===(e=this.$projectListenersDetacher)||void 0===e||e.call(this),null===(t=this.$resourceStoreListenersDetacher)||void 0===t||t.call(this),super.doDestroy()}}Nw._$name="DateStoreLazyLoadPlugin";class Bw extends Nw{static $name="PagedDateStoreLazyLoadPlugin";static configurable={loadFullDateRange:!0};listenToResourceStore(){var e;super.listenToResourceStore();const t=this,{resourceStore:n,client:r}=t;var i;!n||null!==(e=r.lazyLoad)&&void 0!==e&&e.$isCrudManager||r.isTimeRangeStore||(null===(i=t.$pagedResourceStoreListenersDetacher)||void 0===i||i.call(t),t.$pagedResourceStoreListenersDetacher=t.resourceStore.ion({beforeLoadPage:"beforeResourceStoreLoad",thisObj:t}),(n.isLoading||n.count)&&t.requestAnimationFrame(t.beforeResourceStoreLoad))}beforeResourceStoreLoad(e){var t;const n={...(null==e?void 0:e.params)??{},isReload:!0};null===(t=this.beforeLoadCall)||void 0===t||t.call(this,n),this.doLazyLoad(n)}calculateDateRange(e){const t=super.calculateDateRange(...arguments);if(t){const{defaultPageParamName:n,pageSizeParamName:r}=this.client,{resourceStore:i}=this;t[n]=e[n]??i.currentPage??1,t[r]=e[r]??i.pageSize}return t}calculateResourceRange(e){return e}addToQueue(e){e.startIndex=0,e.count=e.pageSize,super.addToQueue(e)}doDestroy(){var e;super.doDestroy(),null===(e=this.$pagedResourceStoreListenersDetacher)||void 0===e||e.call(this)}}Bw._$name="PagedDateStoreLazyLoadPlugin";var zw=e=>class extends(e||Qe){static $name="EventStoreMixin";get $lazyLoadPluginClass(){return this.isPaged?Bw:Nw}static get defaultConfig(){return{loadPriority:100,syncPriority:200,id:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(e){if(super.construct(e),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}getEventCounts(e){const t=this,{filtersFunction:n,added:r}=t,i=t.getEvents({...e,storeFilterFn:t.isFiltered?t.reapplyFilterOnAdd?n:e=>r.includes(e)?t.indexOf(e)>-1:n(e):null,dateMap:e.dateMap||!0});return i.forEach(((e,t)=>i.set(t,e.length))),i}forEachScheduledEvent(e,t=this){this.forEach((n=>{const{startDate:r,endDate:i}=n;if(r&&i)return e.call(t,n,r,i)}))}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach((n=>{n.startDate&&(e=xi.min(n.startDate,e)),n.endDate&&(t=xi.max(n.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return e.isPersistable}filterEventsForResource(e,t,n=this){return e.getEvents(this).filter(t.bind(n))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,n=!1){return this.assignmentStore.assignEventToResource(e,t,void 0,n)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,n){const r=this,i=_s.asId(n),s=r.assignmentStore.getAssignmentForEventAndResource(e,t);s?s.resourceId=i:r.assignmentStore.assignEventToResource(e,n)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}append(e){return this.add(e)}get project(){return super.project}set project(e){var t,n;(super.project=e,null===(t=this.updateProject)||void 0===t||t.call(this,e),this.detachListeners("project"),e)&&(null!==(n=e.assignmentStore)&&void 0!==n&&n.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore),e.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesResourceIds(){var e;return(null===(e=this.modelClass.fieldMap)||void 0===e?void 0:e.resourceIds.persist)??!1}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(e){this._usesSingleAssignment=e,this.setupCheapAssignmentIdGeneration()}setupCheapAssignmentIdGeneration(){const{assignmentStore:e}=this;null!=e&&e.isStore&&!e.hasGenerateIdOverride&&(e.modelClass.generateId=function(){return null==this.singleAssignmentIdCounter&&(this.singleAssignmentIdCounter=0),"a-"+ ++this.singleAssignmentIdCounter},e.hasGenerateIdOverride=!0)}processRecords(e,t,n){var r;const{assignmentStore:i}=this,s=[];return i&&(i.skipInvalidateIndices=!0),e=super.processRecords(e,i&&!(null!==(r=this.stm)&&void 0!==r&&r.isRestoring)&&(e=>{var t;const n=this.usesResourceIds&&null!==(t=e.resourceIds)&&void 0!==t&&t.length?e.resourceIds:[e.resourceId];if(!e.reassignedFromReplace&&null!=(null==n?void 0:n[0]))for(const t of n)i.includesAssignment(e.id,t)||s.push({id:i.modelClass.generateId(""),resourceId:t,eventId:e.id});e.reassignedFromReplace=!1})||void 0),i&&(i.storage.invalidateIndices(),i.skipInvalidateIndices=!1,i.add(s,n)),e}joinRecordsToStore(e){const{assignmentStore:t}=this;t?(t.skipInvalidateIndices=!0,super.joinRecordsToStore(e),t.storage.invalidateIndices(),t.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,t=!1){const n=this,r=(e=super.processRecord(e,t)).get("resourceId"),{resourceIds:i}=e;if(null!=i&&i.length&&n.usesResourceIds)n.$processResourceIds=!0,n.setupCheapAssignmentIdGeneration();else if(null!=r&&!e.meta.skipEnforcingSingleAssignment){const i=n.getById(e.id);if(i&&i!==e&&!t){var s;const t=(n.assignmentStore??(null===(s=n.crudManager)||void 0===s?void 0:s.assignmentStore)).storage.findItem("eventId",e.id);if(null!=t&&t.size){t.values().next().value.resource=r,e.reassignedFromReplace=!0}}else n.$processResourceIds=!0;n.usesSingleAssignment=!0}return e}processResourceIds(){var e,t;const n=this,r=n.assignmentStore??(null===(e=n.crudManager)||void 0===e?void 0:e.assignmentStore);if(n.$processResourceIds&&null!=r&&r.isAssignmentStore&&(null===(t=n.project)||void 0===t||!t.isSharingAssignmentStore||!n.isChained)){const e=[];n.forEach((t=>{const{resourceId:n,resourceIds:i,id:s}=t;null!=n?e.push({id:r.modelClass.generateId(""),resourceId:n,eventId:s}):null!=i&&i.length&&i.forEach((t=>{e.push({id:r.modelClass.generateId(""),resourceId:t,eventId:s})}))}),n,{includeFilteredOutRecords:!0}),r.useRawData={disableDefaultValue:!n.modelClass.isProEventModel,disableDuplicateIdCheck:!0,disableTypeConversion:!0},r.usesSingleAssignment=!1,r.verifyNoGeneratedIds=!1,r.data=e,r.usesSingleAssignment=!0,n.$processResourceIds=!1}}loadTreeData(){super.loadTreeData(...arguments),this.processResourceIds()}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&(null===(t=n.stm)||void 0===t||!t.isRestoring)&&!n.usesSingleAssignment&&!n.assignmentStore.isSyncingDataOnLoad&&!n.resourceStore.isSyncingDataOnLoad){const t=new Set;e.forEach((n=>{const{event:r}=n;r&&!r.isRemoved&&r.assignments.every((t=>e.includes(t)))&&t.add(r)})),t.size&&n.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.ion({name:"assignmentStore",addPreCommit({records:e}){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?e.forEach((e=>{const{event:t}=e;null!=t&&t.isEvent&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)})):t.usesResourceIds?e.forEach((e=>{const{event:t}=e;if(null!=t&&t.isEvent){t.meta.isAssigning=!0;const n=t.resourceIds??[];n.includes(e.resourceId)||(t.resourceIds=[...n,e.resourceId]),t.meta.isAssigning=!1}})):t.updateChainedStores())},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?e.forEach((e=>{var n;null===(n=t.getById(e.eventId))||void 0===n||n.set("resourceId",null)})):t.usesResourceIds?e.forEach((({event:e,resourceId:t})=>{var n;const r=null===(n=e.resourceIds)||void 0===n?void 0:n.slice(),i=null==r?void 0:r.indexOf(t);i>=0&&(r.splice(i,1),e.resourceIds=r)})):t.updateChainedStores())},removeAllPreCommit(){t.isSettingData||t.isAssigning||(t.usesSingleAssignment?t.allRecords.forEach((e=>e.set("resourceId",null))):t.usesResourceIds?t.allRecords.forEach((e=>{e.resourceIds=[]})):t.updateChainedStores())},update({record:e,changes:n}){if("resourceId"in n){const{event:r}=e;if(t.usesSingleAssignment)r.meta.isAssigning=!0,r.set("resourceId",n.resourceId.value),r.meta.isAssigning=!1;else if(t.usesResourceIds){r.meta.isAssigning=!0;const e=r.resourceIds.slice(),t=null==e?void 0:e.indexOf(n.resourceId.oldValue);t>=0&&e.splice(t,1),null!=e&&e.includes(n.resourceId.value)||(e.push(n.resourceId.value),r.resourceIds=e),r.meta.isAssigning=!1}else t.updateChainedStores()}},change({action:e,records:n}){"dataset"===e&&(t.usesResourceIds&&n.forEach((({event:e,resourceId:t})=>{const n=e.resourceIds??[];n.includes(t)||(n.push(t),e.meta.isAssigning=!0,e.setData("resourceIds",n),e.meta.isAssigning=!1)})),t.usesSingleAssignment||t.usesResourceIds||t.updateChainedStores())},thisObj:t}))}set data(e){const t=this;t.isSettingData=!0,!t.usesSingleAssignment||t.syncDataOnLoad||t.isChained||t.assignmentStore.removeAll(!0),super.data=e,t.isSettingData=!1}trigger(e,t){var n;const{changes:r}=t||{};return!r||!("resourceId"in r)||1!==Object.keys(r).length||null!==(n=this.stm)&&void 0!==n&&n.isRestoring||(t.isAssign=!0),super.trigger(...arguments)}remove(e,...t){const n=super.remove(e,...t);if(n.length&&this.usesSingleAssignment)for(const e of n){var r,i;if(!e.isOccurrence)null===(r=this.assignmentStore||(null===(i=this.crudManager)||void 0===i?void 0:i.assignmentStore))||void 0===r||r.remove(e.assignments,!0)}return n}};const jw=()=>!0;var Ww=e=>class extends e{bufferIsUnavailableTime=!1;static $name="GetEventsMixin";getEvents({filter:e,date:t,startDate:n,endDate:r,startOnly:i,includeOccurrences:s,allowPartial:o,onlyAssigned:a=!1,dateMap:l=!1,dayTime:d=null,silent:c,getDateIndex:u,fromRowHeight:h}){const g=this,m=arguments[0],{lastDateRange:p,added:f,filtersFunction:v}=g,y=e;if(a&&(m.filter=y?e=>y(e)&&e.resources.length:e=>e.resources.length),"startDate"in m||(n=m.startDate=t),"includeOccurrences"in m||(s=m.includeOccurrences=!0),"allowPartial"in m||(o=m.allowPartial=!i),m.storeFilterFn=!g.isFiltered||m.ignoreFilters||g.remoteFilter?null:g.reapplyFilterOnAdd?v:e=>f.includes(e)?g.indexOf(e)>-1:v(e),!r)if(n)(r=m.endDate=xi.clearTime(n)).setDate(r.getDate()+1);else{if(s)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");m.dateFilter=jw}m.dateFilter||(m.dateFilter=i?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate;return t&&!(xi.clearTime(t)-n)}:o?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&(!(t-i)?xi.betweenLesserEqual(t,n,r):xi.intersectSpans(t,i,n,r))}:e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=n&&i<=r});const b={startDate:n,endDate:r},w=Boolean(!p||p.startDate-b.startDate||p.endDate-b.endDate);return g.processConfiguredListeners(),c||(g.trigger("loadDateRange",{old:p||{},new:C.clone(b),changed:w}),g.lastDateRange=C.clone(b)),l?g.getEventsAsMap(m):g.getEventsAsArray(m)}getEventsAsArray({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dayTime:a=null,dateFilter:l,storeFilterFn:d,getDateIndex:c}){const u=this,h=[];if(d?u.count:u.totalCount){let e=n?u.getEventsForResource(n):null;if(!n){const t=u.useDayIndex(a),n=new Set,o=s?"startDate":"date";u.recurringEvents.forEach((e=>{t.dayTime.startOfDay(e.startDate)<=r&&n.add(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){const r=t.get(c?c(e):o,e);null==r||r.forEach((e=>n.add(e)))}e=[...n]}d&&(e=e.filter(d));for(let t=0,{length:n}=e;t<n;t++){const n=e[t];o&&n.isRecurring?h.push.apply(h,n.getOccurrencesForDateRange(r,i).filter(l)):l(n)&&h.push(n)}}return e?h.filter(e):h}getEventsAsMap({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dateMap:a,dayTime:l=null,storeFilterFn:d,getDateIndex:c}){var u;const h=this;if(null!==(u=a)&&void 0!==u&&u.clear?a.clear():a=new Map,h.count){const t=h.useDayIndex(l),u=s?"startDate":"date",p=[],f=t=>(!e||e(t))&&(!d||d(t)),v=e=>!e.isRecurring&&f(e);if(l=t.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");var g;null===(g=h.recurringEvents)||void 0===g||g.forEach((e=>{l.startOfDay(e.startDate)<i&&p.push(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){var m;let[n,r]=t.get(c?c(e):u,e,!0);null!==(m=n)&&void 0!==m&&m.size&&(n=[...n].filter(v),n.length&&(a.get(r)||a.set(r,[]).get(r)).push(...n))}for(let e=0,{length:t}=p;e<t;e++){const t=p[e],n=(o?t.getOccurrencesForDateRange(r,i):[t]).filter(f),d=xi.add(i,1,"day");for(let e,t=0,{length:r}=n;t<r;t++){const r=n[t],i=l.startOfDay(r.startDate),o="startDate"!==(c?c(i):s?"startDate":"date")&&r.durationMS?xi.min(r.endDate||xi.add(r.startDate,r.duration,r.durationUnit),d):xi.add(i,1,"day");for(;i<o;i.setDate(i.getDate()+1)){const t=l.dateKey(i);(e=a.get(t))||a.set(t,e=[]),e.push(r)}}}}return a}isDateRangeAvailable(e,t,n,r){let i;return 1===arguments.length&&(t=e.endDate,n=e.excludeEvent,r=e.resourceRecord,i=e.allowOverlap,e=e.startDate),(r=nt.asArray(r)).every((r=>this.isResourceAvailable(e,t,n,r,i)))}isResourceAvailable(e,t,n,r,i){var s;if(r.data.generatedParent)return!1;if(i="boolean"==typeof r.allowOverlap?r.allowOverlap:i)return!0;const o=this.getEventsForResource(r);(null===(s=this.recurringEvents)||void 0===s?void 0:s.size)>0&&o.push(...o.flatMap((e=>e.occurrences)));const a=new Set(o);n&&(n=nt.asArray(n)).forEach((e=>{if(e.isAssignment){e.event.resources.forEach((t=>{t.id!==e.resourceId&&this.getEventsForResource(t).forEach((e=>a.add(e)))}))}const t=e.isAssignment?e.event:e;a.delete(t)}));const l=Array.from(a);if(e.getTime()===t.getTime())return!l.some((n=>n.isScheduled&&(0===n.duration?n.startDate.getTime()===e.getTime():xi.intersectSpans(e,t,n.startDate,n.endDate))));const{bufferIsUnavailableTime:d}=this;return!l.some((n=>{const r=d&&n.outerStartDate||n.startDate,i=d&&n.outerEndDate||n.endDate;return n.isScheduled&&xi.intersectSpans(e,t,r,i)}))}};const Uw={date:"_dateIndex",startDate:"_startDateIndex"},Gw=Object.values(Uw),Yw=Object.freeze([]),{MILLIS_PER_DAY:qw}=Dg;class Kw{constructor(e,t){this.dayTime=t||Dg.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,n){const r=this[Uw[e]],i=this.dayTime.dateKey(t);(r[i]||(r[i]=new Set)).add(n)}addEvent(e){var t;let n,r=null===(t=this.dayTime.startOfDay(e.startDate))||void 0===t?void 0:t.getTime();if(r){var i;n=(null===(i=e.endDate)||void 0===i?void 0:i.getTime())??r,this.add("startDate",r,e);do{this.add("date",r,e),r+=qw}while(r<n)}}clear(){Gw.forEach((e=>this[e]=Object.create(null)))}get(e,t,n){!this.initialized&&this.initialize();let r,i=this[Uw[e]];return t&&(r=this.dayTime.dateKey(t),i=n?[i[r],r]:i[r]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,Gw.forEach((e=>this[e]=null))}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,n){const r=this[Uw[e]][this.dayTime.dateKey(t)];r&&r.delete(n)}removeEvent(e,t,n){var r;let i,s=null===(r=this.dayTime.startOfDay(t))||void 0===r?void 0:r.getTime();if(s){i=(null==n?void 0:n.getTime())??s,this.remove("startDate",s,e);do{this.remove("date",s,e),s+=qw}while(s<i)}}sync(e,t,n,r,i){var s,o;n=n||Yw;const a=this,l=(t=t||Yw).length,d=n.length,c=null==r?void 0:r.length;let u,h,g;if(a.initialized)switch(e){case"clear":a.clear();break;case"splice":if(c)for(t=t.slice(),n=n.slice(),u=0;u<c;u++)n.push(r[u][0]),t.push(r[u][1]);if(d)for(u=0;u<d;u++)g=n[u],a.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=t[u],h.isScheduled&&!h.isParent&&a.addEvent(h);break;case"reschedule":g=t[0],a.removeEvent(g,(null===(s=i.startDate)||void 0===s?void 0:s.oldValue)||g.startDate,(null===(o=i.endDate)||void 0===o?void 0:o.oldValue)||g.endDate),a.sync("splice",t)}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,n=t.indexOf(e);return n>-1&&t.splice(n,1),!t.length}}const Xw=Kw.prototype;Gw.forEach((e=>Xw[e]=null)),Xw.initialized=!1,Kw._$name="EventDayIndex";const{MIDNIGHT:Zw}=Dg;var Jw=e=>class extends e{static $name="DayIndexMixin";construct(e){super.construct(e),this.dayIndices=null}afterLoadData(){var e;this.syncIndices("splice",this.storage.allValues),null===(e=super.afterLoadData)||void 0===e||e.call(this)}onDataChange({action:e,added:t,removed:n,replaced:r}){this.syncIndices(e,t,n,r),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}onModelChange(e,t,n,r,i){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[e],null,null,n),super.onModelChange(...arguments)}invalidateDayIndices(){var e;null===(e=this.dayIndices)||void 0===e||e.forEach((e=>e.invalidate()))}registerDayIndex(e){const t=this,n=t.dayIndices||(t.dayIndices=[]);let r,i;for(i=0;!r&&i<n.length;++i)n[i].matches(e)&&(r=n[i]).register(e);return!r&&n.push(r=new Kw(t,e)),r}syncIndices(...e){var t;null===(t=this.dayIndices)||void 0===t||t.forEach((t=>t.sync(...e)))}unregisterDayIndex(e){const{dayIndices:t}=this;for(let n=null==t?void 0:t.length;n-- >0;)if(t[n].matches(e)){t[n].unregister(e)&&t.splice(n,1);break}}useDayIndex(e){const t=this,{dayIndices:n}=t;e=e||Zw;for(let t=0;n&&t<n.length;++t)if(n[t].matches(e))return n[t];if(e.startShift)throw new Error(`No day index registered for ${e} on ${t.id}`);return t.registerDayIndex(Zw)}};const Qw=Object.freeze([]);var eS=e=>class extends(e||Qe){static $name="RecurringTimeSpansMixin";static configurable={autoAdjustRecurrence:null};construct(...e){const t=this;t.globalOccurrences=new Map,t.recurringEvents=new Set,t.ion({removeAll(){t.globalOccurrences.clear()}}),super.construct(...e)}afterLoadData(){var e;this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),null===(e=super.afterLoadData)||void 0===e||e.call(this)}onDataChange({action:e,added:t,removed:n,replaced:r}){this.refreshRecurringEventsCache(e,t,n,r),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=Qw,n=Qw,r){const{recurringEvents:i}=this,s=null==r?void 0:r.length;switch(e){case"clear":i.clear();break;case"splice":{if(s){t=t.slice(),n=n.slice();for(let e=0;e<s;e++)n.push(r[e][0]),t.push(r[e][1])}const e=t.length,o=n.length;if(o&&i.size)for(let e=0;e<o;e++)i.delete(n[e]);if(e)for(let n=0;n<e;n++){const e=t[n];e.isRecurring&&i.add(e)}break}}}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,n,r,i){const s=!r&&this.isRecurrenceRelatedFieldChange(e,n);if(s&&e.removeOccurrences(),super.onModelChange(...arguments),s){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,n){const r=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,n,(e=>r.push(e))),r}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},tS=e=>class extends(eS(e||Qe)){static $name="RecurringEventsMixin";getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};const nS=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,rS=["SU","MO","TU","WE","TH","FR","SA"];class iS extends Qe{static decodeDay(e){let t,n;return(t=nS.exec(e))&&(n=[rS.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),n.push(t[1]))),n}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+rS[e]}static decode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.decodeDay(e[r]))&&t.push(n);return t}static encode(e){const t=[];let n;if(e)for(let r=0;r<e.length;r++)(n=this.encodeDay(e[r]))&&t.push(n);return t}}iS._$name="RecurrenceDayRuleEncoder";const sS=/ly$/i,oS=e=>{const t=e.replace(sS,"");return"DAI"===t?"DAY":t},aS=(e,t,n,r)=>r.buildOccurrence(e,n),lS=e=>dS=e;let dS;class cS extends Qe{static frequency="NONE";static MAX_OCCURRENCES_COUNT=1e6;static processIterationConfig(e){var t;const{recurrence:n}=e,{frequency:r,interval:i,timeSpan:s,endDate:o,count:a}=n;if(!e.syncingStartDate&&!s.meta.isSyncedWithRule){const t=xi.add(s.startDate,i,oS(r)),o=xi.min(t,e.endDate||t);this.forEachDate({syncingStartDate:!0,startDate:s.startDate,endDate:o,recurrence:n,fn:aS})}const l=s.startDate;let{startDate:d=l,endDate:c=o}=e;d<l&&(d=l),o?(!c||c>o)&&(c=o):a&&d>l&&(this.forEachDate({recurrence:n,fn:lS}),(!c||c>dS)&&(c=new Date(dS.getTime()+1)));const u=d;return e.startOnly||(d=new Date(xi.max(xi.add(d,-i,oS(r)),l))),Object.assign({extraArgs:[],startOnly:!Boolean(s.durationMS)},e,{startDate:d,endDate:c,timeSpan:s,timeSpanStart:l,earliestVisibleDate:u,endDateMS:null===(t=c)||void 0===t?void 0:t.getTime(),timeSpanStartMS:l.getTime(),earliestVisibleDateMS:u.getTime(),durationMS:s.durationMS,spansStart:d<=l&&c>l})}static getOccurrenceIndex(e){if(e.isOccurrence)return xi.diff(e.recurringTimeSpan.startDate,e.startDate,oS(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,n,r){let i,s,o;if(r){r>0?(s=1,o=e):(s=-1,o=t);const a=n-o.getDay();s*a<0&&(r+=s),i=new Date(o),i.setDate(o.getDate()+7*(r-s)+a),(i<e||i>t)&&(i=null)}return i}static buildDate(e,t,n){const r=new Date(e,t,n);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n)return r}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,n,r){const i=e.length,s={};for(let o=0;o<t.length;o++){const a=t[o];if(this.isValidPosition(a)){const t=a>0?e[a-1]:e[i+a];if(t&&!s[t.getTime()]&&(s[t.getTime()]=!0,!1===n.call(r,t)))return!1}}}static isInView(e,t,n,r,i){return(e?t>=n:t.valueOf()+r>n)&&!i.hasException(t)}static isInViewMS(e,t,n,r,i,s){return(e?n>=r:n+i>r)&&!s.hasException(t)}}cS._$name="AbstractRecurrenceIterator";class uS extends cS{static frequency="DAILY";static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,endDateMS:i,timeSpan:s,timeSpanStart:o,earliestVisibleDateMS:a,durationMS:l,spansStart:d,recurrence:c,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:m}=c,p=n-o,f=864e5*m,v=Math.floor(p/f);let{count:y}=c,b=0,C=xi.add(o,v*m,"day"),w=C.getTime();for(r||y||(y=this.MAX_OCCURRENCES_COUNT);!i||w<i;){const e=this.isInViewMS(t,C,w,a,l,s);if(b++,y&&b>y||i&&w>=i||e&&!1===u.apply(g,[C,b,1===b&&d,s,...h]))break;C=xi.add(C,m,"day"),w=C.getTime()}}}uS._$name="DailyRecurrenceIterator";class hS extends cS{static frequency="WEEKLY";static forEachDate(e){var t;const{startOnly:n,startDate:r,endDateMS:i,timeSpan:s,timeSpanStart:o,timeSpanStartMS:a,earliestVisibleDateMS:l,durationMS:d,spansStart:c,recurrence:u,fn:h,extraArgs:g,scope:m=this}=this.processIterationConfig(e),{interval:p,days:f}=u,{weekStartDay:v}=xi,y=o.getHours(),b=o.getMinutes(),C=o.getSeconds(),w=o.getMilliseconds();let S,D,E=0,{count:x}=u,R=iS.decode(f);if(null!==(t=R)&&void 0!==t&&t.length||(R=[[o.getDay()]]),v>0)for(let e=0;e<R.length;e++)v>R[e][0]?R[e][0]=7-v-R[e][0]:R[e][0]-=v;for(R.sort(((e,t)=>e[0]-t[0])),S=xi.getNext(x||p>1?o:r,"week",0),i||x||(x=this.MAX_OCCURRENCES_COUNT);!i||S.getTime()<i;){for(let e=0;e<R.length;e++){D=new Date(S.getFullYear(),S.getMonth(),S.getDate()+R[e][0],y,b,C,w);const t=D.getTime();if(t>=a){const e=this.isInViewMS(n,D,t,l,d,s);if(E++,x&&E>x||i&&t>=i||e&&!1===h.apply(m,[D,E,1===E&&c,s,...g]))return}}S=xi.getNext(S,"week",p)}}}hS._$name="WeeklyRecurrenceIterator";class gS extends cS{static frequency="MONTHLY";static getNthDayOfMonth(e,t){const n=xi.daysInMonth(e);let r=null;return t&&Math.abs(t)<=n&&(r=new Date(e.getFullYear(),e.getMonth(),t<0?n+t+1:t)),r}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:d,fn:c,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=d,v=iS.decode(m),y=f&&f.length,b={};let C,w,S,D,E,x,{monthDays:R}=d,T=0;for(w=xi.startOf(p||g>1?s:n,"month"),S=new Date(xi.getNext(w,"month",1)-1),R&&R.length||v&&v.length||(R=[s.getDate()]),v&&v.length&&v.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!r||r>w)&&(!p||T<p);){if(D=[],null!=v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),x=n;x<=r;x++)(E=this.getNthDayInPeriod(w,S,t,x))&&(E=xi.copyTimeValues(E,s),b[E.getTime()]||(b[E.getTime()]=!0,D.push(E)))})),D.sort(((e,t)=>e-t)),!y)for(x=0;x<D.length;x++)if(E=D[x],E>=s){const e=this.isInView(t,E,o,a,i);if(T++,p&&T>p||r&&E>=r||e&&!1===c.apply(h,[E,T,1===T&&l,i,...u]))return!1}}else{const e=[];for(x=0;x<R.length;x++)(E=this.getNthDayOfMonth(w,R[x]))&&!b[E.getTime()]&&(b[E.getTime()]=!0,e.push(E));for(e.sort(((e,t)=>e-t)),x=0;x<e.length;x++)if(E=xi.copyTimeValues(e[x],s),y)D.push(E);else if(E>=s){const e=this.isInView(t,E,o,a,i);if(T++,p&&T>p||r&&E>=r||e&&!1===c.apply(h,[E,T,1===T&&l,i,...u]))return}}if(y&&D.length&&!1===this.forEachDateAtPositions(D,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,p&&T>p||r&&e>=r||n&&!1===c.apply(h,[e,T,1===T&&l,i,...u]))return!1}})))return!1;w=xi.getNext(w,"month",g),S=new Date(xi.getNext(w,"month",1)-1)}}}gS._$name="MonthlyRecurrenceIterator";class mS extends cS{static frequency="YEARLY";static forEachDate(e){var t,n;const{startOnly:r,startDate:i,endDate:s,timeSpan:o,timeSpanStart:a,earliestVisibleDate:l,durationMS:d,spansStart:c,recurrence:u,fn:h,extraArgs:g,scope:m=this}=this.processIterationConfig(e),{interval:p,days:f,count:v,positions:y}=u,b=iS.decode(f),C=null==y?void 0:y.length,w={};let S,D,E,x,R,T,{months:M}=u,k=0;for(x=xi.startOf(v||p>1?a:i,"year"),R=new Date(xi.getNext(x,"year",1)-1),null===(t=M)||void 0===t||t.sort(((e,t)=>e-t)),null!==(n=M)&&void 0!==n&&n.length||null!=b&&b.length||(M=[a.getMonth()+1]),null==b||b.forEach((e=>{e[1]&&(T=T||{},T[e[0]]=e[1])}));(!s||s>x)&&(!v||k<v);){var F;if(E=[],null!=f&&f.length&&null!==(F=M)&&void 0!==F&&F.length)for(const t of M){x=new Date(x.getFullYear(),t-1),R=new Date(x.getFullYear(),t,-1);const n={...e,fn:(e,t,n,...i)=>{if(e>=a){const t=this.isInView(r,e,l,d,o);if(k++,t)return h.apply(m,[e,k,1===k&&n,...i])}},startDate:x,endDate:R,recurrence:u.constructor.new({timeSpan:u.timeSpan,frequency:"MONTHLY",days:f,positions:y})};gS.forEachDate(n)}else{if(null!=b&&b.length){if(b.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),S=n;S<=r;S++)(D=this.getNthDayInPeriod(x,R,t,S))&&(D=xi.copyTimeValues(D,a),w[D.getTime()]||(w[D.getTime()]=!0,E.push(D)))})),E.sort(((e,t)=>e-t)),!C)for(S=0;S<E.length;S++)if(D=E[S],D>=a){const e=this.isInView(r,D,l,d,o);if(k++,v&&k>v||s&&D>=s||e&&!1===h.apply(m,[D,k,1===k&&c,o,...g]))return}}else for(S=0;S<M.length;S++)if((D=this.buildDate(x.getFullYear(),M[S]-1,a.getDate()))&&(D=xi.copyTimeValues(D,a),!w[D.getTime()]))if(w[D.getTime()]=!0,C)E.push(D);else if(D>=a){const e=r?D>=l:D.valueOf()+d>l&&!o.hasException(D);if(k++,v&&k>v||s&&D>=s||e&&!1===h.apply(m,[D,k,1===k&&c,o,...g]))return}if(C&&E.length&&!1===this.forEachDateAtPositions(E,y,(e=>{if(e>=a){const t=r?e>=l:e.valueOf()+d>l&&!o.hasException(e);if(k++,t&&(!s||e<s)&&(!1===h.apply(m,[e,k,1===k&&c,o,...g])||v&&k>=v))return!1}})))return!1}x=xi.getNext(x,"year",p),R=new Date(xi.getNext(x,"year",1)-1)}}}mS._$name="YearlyRecurrenceIterator";const pS={};[uS,hS,gS,mS].forEach((e=>{pS[e.frequency]=e}));const fS={DAILY:"days",WEEKLY:"weeks",MONTHLY:"months",YEARLY:"years"},vS={MO:"Mon",TU:"Tue",WE:"Wed",TH:"Thu",FR:"Fri",SA:"Sat",SU:"Sun"};function yS(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function bS(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function CS(e,t){return String(e)===String(t)}function wS(e){return this.defaultValue&&void 0===e?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?void 0:e)}class SS extends _s{static $name="RecurrenceModel";static fields=[{name:"date",type:"date"},{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:wS},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:wS},{name:"days",convert:bS,isEqual:CS},{name:"monthDays",convert:yS,isEqual:CS},{name:"months",convert:yS,isEqual:CS},{name:"positions",convert:yS,isEqual:CS},{name:"timeZone",allowNull:!0}];construct(e={}){const t=this,{rule:n,timeSpan:r,laterJsSchedule:i}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,delete e.laterJsSchedule,super.construct(...arguments),n&&(t.suspendTimeSpanNotifying(),t.rule=n,t.resumeTimeSpanNotifying()),t.timeSpan=r,i&&(t.laterJsSchedule=i)}static processData(e,t,n,r,i){const{fieldMap:s}=this,{name:o,dataSource:a}=s.date;let l=e[a||o];return"string"==typeof l&&(l=s.date.convert(l,e,r)),l&&(Object.assign(e,this.getDateValues(l)),e[a||o]=l),super.processData(e,t,n,r,i)}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return pS[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get timeSpanDate(){var e;return null===(e=this.timeSpan)||void 0===e?void 0:e.startDate}static getDateValues(e){if(e)return{days:[iS.encodeDay(e.getDay())],monthDays:[e.getDate()],months:[e.getMonth()+1]}}getDateValues(e){return e=this.date||this.timeSpanDate,this.constructor.getDateValues(e)}getRRule(e=!1){var t,n,r;const i=this,s=i.date||i.timeSpanDate,o=[];if(i.frequency){var a,l,d,c;o.push(`FREQ=${i.frequency}`);let{days:u,monthDays:h,months:g}=i;if(e&&s){const{days:e,monthDays:o,months:a}=i.constructor.getDateValues(s);switch(i.frequency){case"WEEKLY":u||(u=e);break;case"MONTHLY":null!==(t=h)&&void 0!==t&&t.length||(h=o);break;case"YEARLY":null!==(n=h)&&void 0!==n&&n.length||(h=o),null!==(r=g)&&void 0!==r&&r.length||(g=a)}}i.interval>1&&o.push(`INTERVAL=${i.interval}`),null!==(a=u)&&void 0!==a&&a.length&&o.push("BYDAY="+u.join(",")),null!==(l=h)&&void 0!==l&&l.length&&o.push("BYMONTHDAY="+h.join(",")),null!==(d=g)&&void 0!==d&&d.length&&o.push("BYMONTH="+g.join(",")),i.count&&o.push(`COUNT=${i.count}`),i.endDate&&o.push("UNTIL="+xi.format(i.endDate,i.dateFormat)),null!==(c=i.positions)&&void 0!==c&&c.length&&o.push("BYSETPOS="+i.positions.join(",")),null!=i.timeZone&&o.push("TZID="+i.timeZone)}return o.join(";")}get rule(){return this.getRRule()}set rule(e){const t=this,n={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null,timeZone:null};if(t.beginBatch(),e){const r=e.split(";");for(let e=0,i=r.length;e<i;e++){const i=r[e].split("="),s=i[1];switch(i[0]){case"FREQ":n.frequency=s;break;case"INTERVAL":n.interval=s;break;case"COUNT":n.count=s,n.until=null;break;case"UNTIL":n.endDate=s?xi.parse(s,t.dateFormat):null,n.count=null;break;case"BYDAY":n.days=s;break;case"BYMONTHDAY":n.monthDays=s;break;case"BYMONTH":n.months=s;break;case"BYSETPOS":n.positions=s;break;case"TZID":n.timeZone=s}}}t.set(n),e&&t.sanitize(),t.endBatch()}forEachOccurrence(e,t,n){this.timeSpanDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn:(e,t,r,i)=>n(i.buildOccurrence(e,r),r,t,e)})}sanitize(){const e=this,{timeSpanDate:t}=e,n={};switch(e.isSanitizingSuspended=!0,e.frequency){case"DAILY":n.positions=null,n.days=null,n.monthDays=null,n.months=null;break;case"WEEKLY":{n.positions=null,n.monthDays=null,n.months=null;const{days:r}=e;t&&1===(null==r?void 0:r.length)&&r[0]===iS.encodeDay(t.getDay())&&(n.days=null);break}case"MONTHLY":{var r;null!==(r=e.monthDays)&&void 0!==r&&r.length&&(n.positions=null,n.days=null),n.months=null;const{monthDays:i}=e;t&&1===(null==i?void 0:i.length)&&i[0]===t.getDate()&&(n.monthDays=null);break}case"YEARLY":{var i;const{months:r}=e,s=(null===(i=this.days)||void 0===i?void 0:i.length)||0;7===s&&(n.days=null),!t||1!==(null==r?void 0:r.length)||s&&s<7||r[0]!==t.getMonth()+1||(n.months=null);break}}e.set(n),e.isSanitizingSuspended=!1}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,n){const r=super.afterChange(e,t,n),{timeSpan:i}=this;return this.isSanitizingSuspended||this.sanitize(),i&&(i.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||i.onRecurrenceChanged(this,...arguments)),r}setValue(e,t){return"monthDays"===e&&Number.isInteger(t)&&(t=[t]),super.setValue(e,t)}set(e,t,...n){const r="object"==typeof e?e:{[e]:t};return r.count?r.endDate=null:r.endDate&&(r.count=null),super.set(r,void 0,...n)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}reset(){this.allFields.forEach((({name:e})=>this.set(e,null)))}set laterJsSchedule(e){var t;if(!(e=(null===(t=e)||void 0===t||null===(t=t.schedules)||void 0===t?void 0:t[0])||e))return;this.reset();const{s:n,m:r,h:i,t:s,D:o,d:a,M:l}=e,d={interval:1};(n||r||i||s)&&(d.frequency="DAILY"),a&&(d.frequency="WEEKLY",d.days=a.map((e=>iS.encodeDay(e-1)))),o&&(d.frequency="MONTHLY",d.monthDays=o.map((e=>e||-1))),l&&(d.frequency="YEARLY",d.months=l.slice()),Object.assign(this,d)}get laterJsSchedule(){const{frequency:e,interval:t,days:n,monthDays:r,months:i,positions:s}=this;let o=t>1?`every ${t} ${fS[e]} `:"";switch(this.frequency){case"YEARLY":null!=i&&i.length&&(o+=`on the ${i.join(",")} month `);case"MONTHLY":if(null!=r&&r.length){o+=`on the ${r.join(",")} day `;break}case"WEEKLY":null!=n&&n.length&&(o+=`on ${n.map((e=>vS[e])).join(",")} `),null!=s&&s.length&&(o+=`on the ${s.join(",")} day instance `)}return o.trim()}}function DS(e){const t={},{dateFormat:n}=this;return e&&(e="string"==typeof e?e.split(","):nt.asArray(e)).forEach((e=>{"string"==typeof e&&(e=xi.parse(e,n)),isNaN(e)||(t[xi.makeKey(e)]=1)})),t}function ES(e){const t=[],{dateFormat:n}=this;for(const r in e)e[r]&&t.push(xi.format(xi.parseKey(r),n));return t}SS._$name="RecurrenceModel";const xS=[];var RS=e=>class extends(e||kC){static $name="RecurringTimeSpan";get supportsRecurring(){return!0}static fields=[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:DS,serialize:ES,internal:!0}];remove(){if(!this.isOccurrence)return super.remove(...arguments);{const e=this,{recurringTimeSpan:t}=e;e.cancelBatch(),t.beginBatch(),e.detachFromRecurringEvent(),t.endBatch()}}get eventStore(){var e,t;let n=this.isOccurrence&&(null===(e=this.recurringEvent)||void 0===e?void 0:e.eventStore)||super.eventStore;return!n&&null!==(t=this.firstStore)&&void 0!==t&&t.isRecurringTimeSpansMixin&&(n=this.firstStore),n}get recurrenceModel(){return this._recurrenceModel||SS}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,n){const r=this;let i;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),n&&(n instanceof Date?e.endDate=n:e.count=n)),e=new r.recurrenceModel(e)),e.timeSpan=r,i=e.rule),r.recurrence=e,r.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:`${e.id}-recurrence`})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return xS}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e,t=this.eventStore){const n=e.isTimeSpan?e.occurrenceDate:e;null==t||t.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(xi.makeKey(n))}removeOccurrencesFrom(e){this.occurrenceMap.forEach(((t,n)=>{xi.parseKey(n)>=e&&this.removeOccurrence(t)}))}removeOccurrences(e){[this,...this.occurrences].forEach((t=>this.removeOccurrence(t,e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}sanitizeRecurrenceData(e=this.recurrence){if(this.removeOccurrences(),e.endDate){const t=xi.clearTime(e.endDate),{exceptionDates:n}=this;if(n)for(const e in n){xi.parseKey(e)>=t&&delete n[e]}}}get occurrenceDate(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return cS.getOccurrenceIndex(this)}buildOccurrence(e,t){var n;const r=this,{occurrenceMap:i,recurrence:s,meta:o}=r,a=null===(n=r.eventStore)||void 0===n?void 0:n.globalOccurrences,l=xi.makeKey(e),d=r.createRecurrenceKey(e,l),c=!(e-r.startDate),{fieldMap:u}=r.constructor;let h=null==a?void 0:a.get(d),{duration:g}=r;!r.endDate||!r.allDay&&g||(g=xi.as(r.durationUnit,r.endDate.getTime()-r.startDate.getTime()));const m=void 0!==g?xi.add(e,g,r.durationUnit):void 0;if(!h){if(t||c){var p,f;if(h=r,!c&&null==(null===(p=r.recurrence)||void 0===p?void 0:p.timeZone))r.preventRecurrenceSync=!0,r._preventInvalidation=null===(f=r.project)||void 0===f?void 0:f.isWritingData,r.setStartEndDate(e,m,!0),r._preventInvalidation=!1,r.preventRecurrenceSync=!1,s.suspendTimeSpanNotifying(),s.sanitize(),s.resumeTimeSpanNotifying();o.isSyncedWithRule=!0}else h=r.copy({[u.id.dataSource]:d,[u.startDate.dataSource]:e,[u.endDate.dataSource]:m,[u.duration.dataSource]:g,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),h.recurringTimeSpan=r;null==a||a.set(d,h),i.set(l,h)}return h}createRecurrenceKey(e=this.startDate,t=null){return`_generated:${this.id}:${t||xi.makeKey(e)}`}convertToRealEvent(e,t){var n;if(!this.isOccurrence)return;const r=this,{recurringTimeSpan:i,resource:s,occurrenceIndex:o,recurrence:a}=r,l=a&&i.recurrence.count,d=(null==e||null===(n=e.resourceRecords)||void 0===n?void 0:n.value)||r.data.newResource;i.beginBatch(),r.detachFromRecurringEvent(),r.internalClearChanges(),r._id=r.generateId(i.eventStore),r.setData("id",r._id),d&&delete r.data.resourceId,i.eventStore.add(r,t),l&&(r.recurrence.count=l-o),(d||s)&&r.assign(d||s),d&&delete r.data.resourceRecords,e&&delete e.resourceRecords,i.endBatch()}afterChange(e,t,n,...r){const i=this,{eventStore:s}=i;if("recurrenceRule"in t&&(i._recurrence=null,null==s||s.recurringEvents[t.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence)i.convertToRealEvent(t,n);else{if(!i.preventRecurrenceSync&&"startDate"in t&&i.isRecurring&&null!=s&&s.autoAdjustRecurrence){var o,a,l,d,c;const{recurrence:e}=i,{startDate:n}=i,r=t.startDate.oldValue,s=n.getDate(r),u=Math.ceil(s/7),h=n.getDate(),g=n.getDay(),m=iS.encodeDay(g),p=n.getMonth()+1,f=Math.ceil(h/7),v=null===(o=e.days)||void 0===o?void 0:o.slice(),y=null===(a=e.months)||void 0===a?void 0:a.slice(),b=null===(l=e.monthDays)||void 0===l?void 0:l.slice(),C=null===(d=e.positions)||void 0===d?void 0:d.slice();e.beginBatch(),null!==(c=i.getOccurrencesForDateRange(n,xi.add(n,1)).filter((e=>!(e.startDate-n))))&&void 0!==c&&c.length||(null!=v&&v.length&&(nt.remove(v,iS.encodeDay(r.getDay())),v.push(m),e.days=v.sort()),null!=b&&b.length&&(nt.remove(b,r.getDate()),b.push(h),e.monthDays=b.sort()),null!=C&&C.length&&(nt.remove(C,u),C.push(f),e.positions=[...new Set(C)].sort()),null!=y&&y.length&&(nt.remove(y,r.getMonth()+1),y.push(p),e.months=[...new Set(y)].sort())),e.endBatch()}"newExceptionDate"in t&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(t.newExceptionDate.value)),t.recurrenceRule&&!t.recurrenceRule.value&&(i.meta.modified.exceptionDates=!0,i.exceptionDates={})}return super.afterChange(e,t,n,...r)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:t,occurrenceDate:n,startDate:r}=e;e.recurringTimeSpan=null,t.addExceptionDate(n),e.recurrenceRule&&(t.recurrence.endDate=xi.add(r,-1,"minute"))}set newExceptionDate(e){if(e){(this.exceptionDates||(this.exceptionDates={}))[xi.makeKey(e)]=1}}addExceptionDate(e){this.set({newExceptionDate:e})}hasException(e){var t;return Boolean(null===(t=this.exceptionDates)||void 0===t?void 0:t[xi.makeKey(e)])}};var TS=e=>class extends e{static $name="EventModelMixin";static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach((e=>{e.eventId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentEventIds()}setValue(e,t){if("resource"!==e||this.usesSingleAssignment)return super.setValue(e,t);this.resources=nt.asArray(t)??[]}get resources(){return this.assignments.reduce(((e,{resource:t})=>(t&&e.push(t.$original),e)),[])}set resources(e){var t;e=nt.asArray(e);const n=this,r=e.map(n.constructor.asId);if(n.usesSingleAssignment)n.set("resourceId",r[0]);else if(null!==(t=n.fieldMap)&&void 0!==t&&t.resourceIds.persist)n.resourceIds=r;else{const e=n.assignments.map((e=>e.resource.id)),{onlyInA:t,onlyInB:i}=nt.delta(r,e);n.assignmentStore.add(t.map((e=>({resource:e,event:n})))),n.assignmentStore.remove(i.map((e=>n.assignments.find((t=>t.resource.id===e)))))}}forEachResource(e,t=this){for(const n of this.resources)if(!1===e.call(t,n))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){let e;return e=this.isOccurrence?this.get("startDate"):this._startDate??super.startDate,this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){let e;return e=this.isOccurrence?this.get("endDate"):this._endDate??super.endDate,this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get wrapStartDate(){return this.startDate}set wrapStartDate(e){}get wrapEndDate(){return this.endDate}set wrapEndDate(e){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(e,t,n){const r=this,i=r.isPersistable;if(super.endBatch(e,t,n),r.isPersistable&&!i&&!r.ignoreBag&&r.assigned)for(const e of r.assigned)e.stores.forEach((t=>t.updateModifiedBagForRecord(e)))}get isCreating(){return super.isCreating}set isCreating(e){var t,n;super.isCreating=e,null===(t=this.assignmentStore)||void 0===t||t.suspendAutoCommit(),this.assignments.forEach((t=>t.isCreating=e)),null===(n=this.assignmentStore)||void 0===n||n.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...e){const t=super.copy(...e);return this.usesSingleAssignment||(t.resourceId=null),t}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.assignments[0])||void 0===e?void 0:e.resourceId}set resourceId(e){this.applyResourceId(e)}get resourceIds(){var e,t;return null!==(e=this.fieldMap)&&void 0!==e&&e.resourceIds.persist?this.get("resourceIds"):(null===(t=this.resources)||void 0===t?void 0:t.map((e=>e.id)))??[]}set resourceIds(e){this.set("resourceIds",e)}get $linkedResources(){var e;return(null===(e=this.resources)||void 0===e?void 0:e.flatMap((e=>[e,...e.$links])))??[]}applyResourceId(e,t=!1){const n=this,{eventStore:r,assignments:i}=n;if(n.isApplyingResourceId)n.setData("resourceId",e);else{if(n.isApplyingResourceId=!0,r){var s,o;const t=r.assignmentStore||(null===(s=r.crudManager)||void 0===s?void 0:s.assignmentStore);if(null!=e)if(n.meta.skipEnforcingSingleAssignment||(r.usesSingleAssignment=!0),null!=i&&i.length&&e!==i[0].resourceId){const n=Boolean(r.eventsSuspended);n&&t.suspendEvents(),i[0].resource=e,n&&t.resumeEvents()}else t.assignEventToResource(n,e);else(n.usesSingleAssignment||null!==(o=n.resourceIds)&&void 0!==o&&o.length)&&t.remove(i)}else t||n.set({resourceId:e});n.isApplyingResourceId=!1}}applyResourceIds(e,t=!1){const n=this,{eventStore:r,assignments:i}=n;if(!1===n.fieldMap.resourceIds.persist)return!1;if(e=[...new Set(e)],r){var s,o;const t=r.assignmentStore||(null===(s=r.crudManager)||void 0===s?void 0:s.assignmentStore);if(null!==(o=e)&&void 0!==o&&o.length)if(null!=i&&i.length){const s=Boolean(r.eventsSuspended);s&&t.suspendEvents(),i.forEach((t=>{const n=e.find((e=>!i.some((t=>t.resourceId===e))));n&&(t.resource=n)}));const{onlyInA:o,onlyInB:a}=nt.delta(e,i.map((e=>e.resourceId)));t.add(o.map((e=>({resource:e,event:n})))),t.remove(a.map((e=>i.find((t=>t.resource.id===e))))),s&&t.resumeEvents()}else t.add(e.map((e=>({resource:e,event:n}))));else t.remove(i)}else t||n.set({resourceIds:e})}applyValue(e,t,n,r,i){if(i&&!this.meta.isAssigning){const{eventStore:e}=this;switch(i.name){case"resourceId":e&&(e.isAssigning=!0),this.applyResourceId(n,!0);break;case"resourceIds":e&&(e.isAssigning=!0),this.applyResourceIds(n,!0)}e&&(e.isAssigning=!1)}super.applyValue(e,t,n,r,i)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:n}=this;if(n&&!n.usesSingleAssignment)return n.assignEventToResource(this,e,t);this.resourceId=this.constructor.asId(e),n||(this.meta.skipEnforcingSingleAssignment=!0)}unassign(e,t=!1){var n;const r=this;e=r.constructor.asId(e),r.meta.removingResource=t,null===(n=r.eventStore)||void 0===n||n.unassignEventFromResource(r,e),r.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){return[...this.incomingDeps??[]]}get successors(){return[...this.outgoingDeps??[]]}get dependencies(){return[...this.incomingDeps??[],...this.outgoingDeps??[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=864e5||!e&&this.allDay)return!0;const{endDate:t,startDate:n}=this,r=xi.clearTime(n);return n&&t?(r.setDate(r.getDate()+1),(t||xi.add(n,e))>r):void 0}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=xi.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=xi.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),xi.clearTime(e,!0)}static getAllDayDisplayEndDate(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),xi.clearTime(t,!0).valueOf()===t.valueOf()?t=xi.add(t,xi.DAY,-1):e.valueOf()!==t.valueOf()&&(t=xi.clearTime(t,!0))),t}isEditable(e){let t=!0;switch(e){case"endDate":case"duration":case"fullDuration":t=this.isLeaf}return t&&super.isEditable(e)}};class MS extends(Ew([kw],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){return this._startDate??this.get("startDate")??null}get endDate(){return this._endDate??this.get("endDate")??null}get duration(){return this._duration??this.get("duration")??null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,n,r,i,s){const o=this;return!o.project||o.project.isWritingData||"string"==typeof e||s||("startDate"in e&&!("startDate"in o.$changed)&&(o.$changed.startDate=!0,o.invalidate()),"endDate"in e&&!("endDate"in o.$changed)&&(o.$changed.endDate=!0,o.invalidate())),t.inSet.call(o,e,n,r,i,s)}getStartDate(){return this.startDate}proposeStartDate(e,t=!("endDate"in this.$changed)){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.startDate)||void 0===n?void 0:n.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:t}))}async setStartDate(e,t=!0){var n;return this.proposeStartDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){var n;(this.inSetting||(null==e?void 0:e.getTime())!==(null===(n=this.endDate)||void 0===n?void 0:n.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:t}))}async setEndDate(e,t=!1){var n;return this.proposeEndDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,n=!0){this._duration=e,this.propose({duration:e,keepStart:n}),t&&this.propose({durationUnit:t})}async setDuration(e,t,n=!0){var r;return this.proposeDuration(e,t,n),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){const e=this,n=e.$changed,r=e.getCurrentOrProposed("startDate"),i=e.getCurrentOrProposed("endDate"),s=e.getCurrentOrProposed("duration");if(null!=r&&(n.startDate=e._startDate=r),null!=i&&(n.endDate=e._endDate=i),null!=s&&(n.duration=e._duration=s),e.eventStore&&!e.eventStore.isLoadingData){var o;const t=null===(o=e.assignmentStore)||void 0===o?void 0:o.storage.findItem("event",null);if(t){var a;const n=null===(a=e.assignmentStore)||void 0===a?void 0:a.storage.findItem("eventId",e.id);if(n)for(const t of n)t.setChanged("event",e);else for(const n of t)n.getCurrentOrProposed("event")===e.id&&n.setChanged("event",e)}}t.joinProject.call(e)}applyValue(e,n,r,i,s){var o;if((this.project||null!==(o=this.recurringTimeSpan)&&void 0!==o&&o.project)&&s){const{name:t}=s;"startDate"!==t&&"duration"!=t&&"endDate"!==t||(e=!0,this["_"+t]=r),i&&(e=!1)}t.applyValue.call(this,e,n,r,i,s)}afterChange(e,n,r,i,s){this.$isCalculating||s||this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,e,n,r,i,s)}calculateInvalidated(){var e;const t=this,n=t.$changed,r="startDate"in n,i="endDate"in n,s="duration"in n,{startDate:o,endDate:a,duration:l,keepDuration:d,keepStart:c}=n;let u=null;!r||i||s?r||!i||s?r||i||!s?r&&i&&!s?null===o&&null===a?n.duration=null:u="duration":r&&!i&&s?u="endDate":!r&&i&&s?u="startDate":r&&i&&s&&(u=null==l?"duration":null==o?"startDate":"endDate"):null===l?n.endDate=null:!t.hasCurrentOrProposed("startDate")||!c&&t.hasCurrentOrProposed("endDate")?t.hasCurrentOrProposed("endDate")&&(u="startDate"):(c&&n.duration<0&&(n.duration=0),u="endDate"):null===a?n.startDate=null:t.hasCurrentOrProposed("startDate")&&!d&&!0!==a&&a<t.getCurrentOrProposed("startDate")?(n.startDate=a,n.duration=0):!t.hasCurrentOrProposed("duration")||!d&&t.hasCurrentOrProposed("startDate")?t.hasCurrentOrProposed("startDate")&&(u="duration"):u="startDate":null===o?n.endDate=null:t.hasCurrentOrProposed("endDate")&&o>t.getCurrentOrProposed("endDate")&&!d?(n.endDate=o,n.duration=0):!t.hasCurrentOrProposed("duration")||!d&&t.hasCurrentOrProposed("endDate")?t.hasCurrentOrProposed("endDate")&&(u="duration"):u="endDate";const h=t.getCurrentOrProposed("startDate"),g=t.getCurrentOrProposed("endDate"),m=t.getCurrentOrProposed("duration"),p=t.getCurrentOrProposed("durationUnit"),f=(null===(e=t.getProject())||void 0===e?void 0:e.adjustDurationToDST)??!1;switch(u){case"startDate":const e=xi.add(g,-m,p);if(f){const t=g.getTimezoneOffset()-e.getTimezoneOffset();e.setTime(e.getTime()-60*t*1e3)}n.startDate=e;break;case"endDate":const t=xi.add(h,m,p);if(f){const e=h.getTimezoneOffset()-t.getTimezoneOffset();t.setTime(t.getTime()-60*e*1e3)}n.endDate=t;break;case"duration":let r=xi.diff(h,g,"millisecond");if(f){r+=60*(h.getTimezoneOffset()-g.getTimezoneOffset())*1e3}n.duration=xi.as(p,r,"millisecond")}"startDate"in n&&!0!==n.startDate&&(this._startDate=n.startDate),"endDate"in n&&!0!==n.endDate&&(this._endDate=n.endDate),"duration"in n&&!0!==n.duration&&(this._duration=n.duration),!0===n.startDate&&delete n.startDate,!0===n.endDate&&delete n.endDate,delete n.keepDuration,delete n.keepStart}}}))){}class kS extends(Ew([Mw],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){for(const t of this.assigned??[])if(t.resource===e)return t;return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){}class FS extends(Ew([MS,kS],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return(null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getEventsAssignments(this))??this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,n,r,i,s){var o;"id"===n&&(null===(o=this.assigned)||void 0===o||o.forEach((e=>e.set("eventId",r))));t.applyValue.call(this,e,n,r,i,s)}copy(e=null,n=null){const r=t.copy.call(this,e,n);return(W.isObject(n)&&!n.skipFieldIdentifiers||!W.isObject(n))&&(r.$cachedAssignments=this.assigned),r}}}))){}class IS extends(Ew([MS],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){}class AS extends(Ew([MS,FS,IS],(e=>{e.prototype;return class extends e{}}))){}const LS=AS;class PS extends(LS.derive(kC).mixin(RS,aw,TS)){static $name="EventModel"}PS.exposeProperties(),PS._$name="EventModel";const OS={splice:1,clear:1};class $S extends(Ew([Tw],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var t;const n=OS[e.action];super.onDataChange(e),n&&null!==(t=e.removed)&&void 0!==t&&t.length&&this.afterEventRemoval()}remove(e,n){const r=t.remove.call(this,e,n);return this.afterEventRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterEventRemoval(),n}clear(...e){const n=t.clear.apply(this,e);return this.afterEventRemoval(),n}onNodeRemoveChild(e,n,r,i){const s=t.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),s}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!n.assignmentsForRemoval.has(e)));t.length>0&&n.remove(t)}e.clear();const r=this.getDependencyStore();if(r&&!r.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!r.dependenciesForRemoval.has(e)));e.length>0&&r.remove(e)}t.clear()}processRecord(e,t=!1){var n;if(null===(n=this.project)||void 0===n||!n.isRepopulatingStores){const t=this.getById(e.id);if(t&&t!==e&&t.assigned)for(const n of t.assigned)n.event=e}return e}}}))){}class _S extends(Ew([$S,Lw],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:AS}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}}}))){}const HS=aw(_S.derive($l));class VS extends(HS.mixin(tS,zw,Jw,Ww)){static $name="EventStore";static get defaultConfig(){return{modelClass:PS}}}VS._$name="EventStore";const NS=W.getPath,BS=(e,t,n,r)=>{n?W.setPath(e,t,r):e[t]=r},zS=(e,t,n,r)=>{var i;null==r||!r.isModel||null!==(i=NS(e,t))&&void 0!==i&&i.model||BS(e,t,n,r)};var jS=e=>class extends e{static $name="AssignmentModelMixin";static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){var n,r;e=e?Object.isExtensible(e)?e:Object.assign({},e):{};const{fieldMap:i}=this,s=i.eventId.dataSource,o=i.resourceId.dataSource,a=i.event.dataSource,l=i.resource.dataSource,d=i.eventId.complexMapping,c=i.resourceId.complexMapping,u=i.event.complexMapping,h=i.resource.complexMapping,g=d?NS(e,s):e[s],m=c?NS(e,o):e[o],p=null!==(n=e.event)&&void 0!==n&&n.isModel?e.event:u?NS(e,a):e[a],f=null!==(r=e.resource)&&void 0!==r&&r.isModel?e.resource:h?NS(e,l):e[l];if(null!=g)BS(e,a,u,g);else if(null!=p){const t=p.isModel?p.id:p;BS(e,s,d,t)}if(null!=m)BS(e,l,h,m);else if(null!=f){const t=f.isModel?f.id:f;BS(e,o,c,t)}zS(e,a,u,e.event),zS(e,l,h,e.resource),super.construct(e,...t)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(e,t){let n,r;return n=e?e.isModel?e.id:e:this.internalId,r=t?t.isModel?t.id:t:this.internalId,`${n}-${r}`}buildIndexKey({event:e,resource:t}){return this.buildEventResourceKey(e,t)}set(e,t,...n){const r=this.fieldToKeys(e,t);var i,s;"resource"in r?void 0!==(null===(i=r.resource)||void 0===i?void 0:i.id)&&(r.resourceId=r.resource.id):"resourceId"in r&&this.constructor.isProAssignmentModel&&(r.resource=r.resourceId);"event"in r?void 0!==(null===(s=r.event)||void 0===s?void 0:s.id)&&(r.eventId=r.event.id):"eventId"in r&&this.constructor.isProAssignmentModel&&(r.event=r.eventId);return super.set(r,null,...n)}afterChange(e,t,n,r,i){var s,o;const a=this;return!a.constructor.isProAssignmentModel&&null!=t&&t.resourceId&&(null===(s=a.resource)||void 0===s?void 0:s.id)!==t.resourceId.value?a.resource=t.resourceId.value:!(a.constructor.isProAssignmentModel&&null!==(o=a.project)&&void 0!==o&&o.propagatingSyncChanges&&null!=t&&t.eventId)||null!=t&&t.event||e.event.value!==t.eventId.value&&e.event.value.id!==t.eventId.value||(delete t.eventId,delete a.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(e){const{resource:t}=this;null!=t&&t.isModel&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return(null===(e=this.resource)||void 0===e?void 0:e.id)??this.get("resourceId")}set eventId(e){const{event:t}=this;null!=t&&t.isModel&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return(null===(e=this.event)||void 0===e?void 0:e.id)??this.get("eventId")}get eventName(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}get resourceName(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){const{event:e,resource:t,unjoinedStores:n,assignmentStore:r,eventStore:i}=this,s=null==r?void 0:r.crudManager;let o;return(null==i||!i.usesSingleAssignment)&&(o=r?this.isValid&&!(null!=e&&e.isCreating)&&(s||!(null!=e&&e.isPhantom)&&!(null!=t&&t.isPhantom)):!this.isPhantom&&Boolean(n[0]),o&&super.isPersistable&&!(null!=e&&e.isCreating))}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("event"===e||"eventId"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}if("resource"===e||"resourceId"===e){var i;const e=null===(i=this.project)||void 0===i?void 0:i.resourceStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}};function WS(e){return null!=e&&e.isModel?e.id:e}class US extends(Ew([kw],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){const{assignmentStore:i,eventStore:s,resourceStore:o,project:a}=this;let l=!1;if("event"===e){const e=Dw(n,MS)?n:null==s?void 0:s.$master.getById(n);e&&(l=!0),n=e||n}if("resource"===e){const e=Dw(n,Fw)?n:null==o?void 0:o.$master.getById(n);e&&(l=!0),n=e||n}t.setChanged.call(this,e,n,r,!0),!i||!l||a.isPerformingCommit||i.isLoadingData||null!=o&&o.isLoadingData||i.skipInvalidateIndices||i.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){let{event:e=this.event,resource:t=this.resource}=this.$changed;if(null!==e&&!Dw(e,MS)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&this.setChanged("event",t,!1)}if(null!==t&&!Dw(t,Fw)){var r;const e=null===(r=this.resourceStore)||void 0===r?void 0:r.getById(t);e&&this.setChanged("resource",e,!1)}}finalizeInvalidated(e){const n=this.$changed;"resource"in n&&(n.resourceId=WS(n.resource)),"event"in n&&(n.eventId=WS(n.event)),t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e),this.setChanged("eventId",WS(e))}get event(){const e=this.get("event");return null!=(null==e?void 0:e.id)?e:null}set resource(e){this.setChanged("resource",e),this.setChanged("resourceId",WS(e))}get resource(){const e=this.get("resource");return null!=(null==e?void 0:e.id)?e:null}}}))){}const GS=US;class YS extends(jS(aw(GS.derive(_s)))){static $name="AssignmentModel"}YS.exposeProperties(),YS._$name="AssignmentModel";var qS=e=>class extends e{static $name="AssignmentStoreMixin";static get defaultConfig(){return{loadPriority:300,syncPriority:300,id:"assignments"}}get $lazyLoadPluginClass(){return this.isPaged?Bw:Nw}add(e,...t){var n;if(null!==(n=e=nt.asArray(e))&&void 0!==n&&n.length){for(let t=0;t<e.length;t++){var r;let n=e[t];if(n instanceof _s||(e[t]=n=this.createRecord(n)),!this.isSyncingDataOnLoad&&-1!==this.storage.findIndex("eventResourceKey",n.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${n.eventId} to resource: ${n.resourceId}`);null!==(r=n.event)&&void 0!==r&&r.isCreating&&(n.isCreating=!0)}return super.add(e,...t)}}includesAssignment(e,t){return-1!==this.storage.findIndex("eventResourceKey",`${e}-${t}`,!0)}setStoreData(e){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined with EventStore data containing resourceId (single-assignment mode)");super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0},onDuplicate(e){console.warn(`Duplicate assignment of event ${e.eventId} to resource ${e.resourceId}`)}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||null==t||!t.isOccurrence)return e;const n=this;return{id:`${t.id}:a${e.id}`,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return n.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const n=this,r=t.id||t,{id:i}=e;let{occurrenceMeta:s}=n;return s||(s=n.occurrenceMeta={}),s[i]||(s[i]={}),s[i][r]||(s[i][r]={})}mapAssignmentsForEvent(e,t,n){e=this.eventStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}mapAssignmentsForResource(e,t,n){e=this.resourceStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){var t;return null===(t=e=this.resourceStore.getById(e))||void 0===t?void 0:t.events}assignEventToResource(e,t,n=null,r=!1){var i;const s=this,o=r?new Set(e.assignments):null;if(t=nt.asArray(t).map((e=>e.$original??e)),null!==(i=s.eventStore)&&void 0!==i&&i.usesSingleAssignment){var a,l;if(null!==(a=e.assignments)&&void 0!==a&&a.length)return s.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];e.resourceId=null===(l=t[0])||void 0===l?void 0:l.id}let d=[];return s.suspendAutoCommit(),t.forEach((t=>{const i=s.getAssignmentForEventAndResource(e,t);if(i)r&&o.delete(i);else{const r={event:e,resource:t};d.push((null==n?void 0:n(r))??r)}})),d=s.add(d),r&&s.remove(Array.from(o)),s.resumeAutoCommit(),d}unassignEventFromResource(e,t){const n=this,r=[];if(!t)return n.removeAssignmentsForEvent(e);t=nt.asArray(t);for(let i=0;i<t.length;i++)n.isEventAssignedToResource(e,t[i])&&r.push(n.getAssignmentForEventAndResource(e,t[i]));return n.remove(r)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){let n;return(e=this.eventStore.getById(e))&&(n=e.assignments)&&(t=this.resourceStore.$master.getById(t))?this.getOccurrence(n.find((e=>{var n;return(null===(n=e.resource)||void 0===n?void 0:n.$original)===t.$original})),e):null}};const KS=e=>e instanceof Set||e instanceof Array?uw(e):uw([e]),XS=e=>new Promise((t=>setTimeout(t,e)));class ZS extends(Ew([Tw],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,n){this.assignmentsForRemoval=KS(e).toSet();const r=t.remove.call(this,e,n);return this.assignmentsForRemoval.clear(),r}removeAll(e){this.allAssignmentsForRemoval=!0;const n=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,n}}}))){}const JS=new Set;class QS extends(Ew([ZS,Lw],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:US,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e,!0)||JS}getResourcesAssignments(e){return this.storage.findItem("resource",e.$original,!0)||JS}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(e,t){e=e.masterStore||e;const n=this.count&&this.storage.findItem(t,null,!0);if(n){for(const r of n){const n=e.getById(r.getCurrentOrProposed(t));n&&r.setChanged(t,n)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach((t=>{var n;return t.setChanged(e,(null===(n=t[e])||void 0===n?void 0:n.id)??(null==t?void 0:t.getData(e))??t[e+"Id"])})),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}const eD=aw(QS.derive($l));class tD extends(qS(eD)){static $name="AssignmentStore";static get defaultConfig(){return{modelClass:YS}}}tD._$name="AssignmentStore";const nD=["SS","SF","FS","FF"];class rD extends _s{static $name="DependencyBaseModel";static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],n=e[this.fieldMap.to.dataSource],r=this.fieldMap.type.type;if(r&&"int"!==r&&"integer"!==r)throw new Error('Dependency type field must be of type "int"');null!=t&&(e.fromEvent=t),null!=n&&(e.toEvent=n),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||(null===(e=this.unjoinedStores[0])||void 0===e?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,t=this.lagUnit){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=xi.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${xi.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new qs({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:n}=e,r=t[0];let i;if(r){const{fromEvent:t,toEvent:n}=e,s=r.crudManager;i=t&&(s||!t.hasGeneratedId)&&n&&(s||!n.hasGeneratedId)}else i=Boolean(n[0]);return i&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if(null!=e&&e.isScheduled&&null!=t&&t.isScheduled){const n=rD.Type;let r,i;switch(this.type){case n.StartToStart:r=e.startDateMS,i=t.startDateMS;break;case n.StartToEnd:r=e.startDateMS,i=t.endDateMS;break;case n.EndToEnd:r=e.endDateMS,i=t.endDateMS;break;case n.EndToStart:r=e.endDateMS,i=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(r,i),end:Math.max(r,i)}}return null}highlight(e){var t;const n=(null===(t=this.highlighted)||void 0===t?void 0:t.split(" "))??[];n.includes(e)||(this.highlighted=n.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const n=t.split(" "),r=n.indexOf(e);r>=0&&(n.splice(r,1),this.highlighted=n.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=nD[this.type];return e?t:this.type===rD.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:e,toEvent:t,type:n}=this;return"number"==typeof n&&e&&t&&e!==t}get fromEventName(){var e;return(null===(e=this.fromEvent)||void 0===e?void 0:e.name)||""}get toEventName(){var e;return(null===(e=this.toEvent)||void 0===e?void 0:e.name)||""}shouldRecordFieldChange(e,t,n){if(!super.shouldRecordFieldChange(e,t,n))return!1;if("from"===e||"to"===e||"fromEvent"===e||"toEvent"===e){var r;const e=null===(r=this.project)||void 0===r?void 0:r.eventStore;if(e&&e.oldIdMap[t]===e.getById(n))return!1}return!0}get skipCopyFields(){var e,t,n,r;const{fieldMap:i}=this;return{[i.from.dataSource]:!0,[i.to.dataSource]:!0,[null===(e=i.fromEvent)||void 0===e?void 0:e.dataSource]:!0,[null===(t=i.toEvent)||void 0===t?void 0:t.dataSource]:!0,[null===(n=i.fromTask)||void 0===n?void 0:n.dataSource]:!0,[null===(r=i.toTask)||void 0===r?void 0:r.dataSource]:!0}}}rD.exposeProperties(),rD._$name="DependencyBaseModel";class iD extends(Ew([kw],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){var i;let s=!1;if("fromEvent"===e||"toEvent"===e){var o;const e=Dw(n,MS)?n:null===(o=this.eventStore)||void 0===o?void 0:o.getById(n);e&&(s=!0),n=e||n}var a;(t.setChanged.call(this,e,n,r,!0),!s||this.project.isPerformingCommit||null!==(i=this.dependencyStore)&&void 0!==i&&i.isLoadingData)||(null===(a=this.dependencyStore)||void 0===a||a.invalidateIndices())}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){let{fromEvent:e,toEvent:t}=this.$changed;if(null!==e&&!Dw(e,MS)){var n;const t=null===(n=this.eventStore)||void 0===n?void 0:n.getById(e);t&&(this.$changed.fromEvent=t)}if(null!==t&&!Dw(t,MS)){var r;const e=null===(r=this.eventStore)||void 0===r?void 0:r.getById(t);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return null!=(null==e?void 0:e.id)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return null!=(null==e?void 0:e.id)?e:null}}}))){}const sD=iD;class oD extends(aw(sD.derive(rD))){static $name="DependencyModel";getTypeFromSides(e,t,n){const r=rD.Type,i=n?"right":"left",s=n?"left":"right";return e===i?t===i?r.StartToStart:r.StartToEnd:t===s?r.EndToEnd:r.EndToStart}}oD.exposeProperties(),oD._$name="DependencyModel";var aD=e=>class extends e{static $name="DependencyStoreMixin";static get defaultConfig(){return{loadPriority:400,syncPriority:400,id:"dependencies"}}reduceEventDependencies(e,t,n,r=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=nt.asArray(e)).reduce(((e,n)=>{n.children&&!r?n.traverse((n=>{e=i(n).reduce(t,e)})):e=i(n).reduce(t,e)}),n),n}mapEventDependencies(e,t,n,r,i){return this.reduceEventDependencies(e,((e,t)=>(n(t)&&e.push(t),e)),[],r,i)}mapEventPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}mapEventSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=_s.asId(e),t=_s.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}async isValidDependency(e,t,n){let r=e,i=t;return null!=e&&(e.isDependencyModel&&({fromEvent:r,toEvent:i}=e),r=this.eventStore.getById(r),i=this.eventStore.getById(i),r&&i?!(!r.project||!i.project)&&this.project.isValidDependency(r,i,n):e!==t)}isValidDependencyToCreate(e,t,n){return this.isValidDependency(e,t,n)}getHighlightedDependencies(e){return this.records.reduce(((t,n)=>(n.isHighlightedWith(e)&&t.push(n),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};class lD extends(Ew([Tw],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,n){this.dependenciesForRemoval=KS(e).toSet();const r=t.remove.call(this,e,n);return this.dependenciesForRemoval.clear(),r}removeAll(e){this.allDependenciesForRemoval=!0;const n=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,n}}}))){}const dD=new Set;class cD extends(Ew([lD,Lw],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:iD,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||dD}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||dD}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}const uD=aw(cD.derive($l));class hD extends(aD(uD.derive($l))){static get defaultConfig(){return{modelClass:oD}}}hD._$name="DependencyStore";var gD=e=>class extends e{static $name="AbstractCrudManagerValidation";static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(e,t,n){const r=[],{storeId:i}=e,s=this.crudLoadValidationMandatoryStores,o={[i]:{}};return t?t.rows||(r.push(`- "${i}" store section should have a "rows" property with an array of the store records.`),o[i].rows=["..."]):null!=s&&s.includes(i)&&(r.push(`- No "${i}" store section found. It should contain the store data.`),o[i].rows=["..."]),r.length&&Object.assign(n,o),r}getLoadResponseWarnings(e,t){const n=[],r={};return this.skipSuccessProperty||(r.success=!0),this.forEachCrudStore(((i,s,o)=>{var a;null!=t&&null!==(a=t.stores)&&void 0!==a&&a.length&&!t.stores.includes(s)||n.push(...this.getStoreLoadResponseWarnings(o,null==e?void 0:e[s],r))})),n.length&&(n.push("Please adjust your response to look like this:\n"+JSON.stringify(r,null,4).replace(/"\.\.\."/g,"...")),n.push(this.disableValidationNote)),n}validateLoadResponse(e,t){const n=this.getLoadResponseWarnings(e,t);n.length&&console.warn(this.crudLoadValidationWarningPrefix+"\n"+n.join("\n"))}getStoreSyncResponseWarnings(e,t,n,r){const i=[],s=[],o=[],{storeId:a}=e,l={[a]:{}},d=e.phantomIdField||this.phantomIdField,{modelClass:c}=e.store,{idField:u}=c,h=(null==n?void 0:n.rows)||[],g=(null==n?void 0:n.removed)||[];let m=!1;if(null!=t&&t.added&&(s.push(...t.added.filter((e=>!h.find((t=>t[d]==e[d]))&&!g.find((t=>t[d]==e[d]||t[u]==e[d])))).map((e=>({[d]:e[d],[u]:"..."})))),s.length)){const e=s.map((e=>"#"+e[d])).join(", ");i.push(`- "${a}" store "rows" section should mention added record(s) ${e} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!s.length&&n&&(("object"!=typeof n||Array.isArray(n))&&(i.push(`- "${a}" store section should be an Object.`),l[a]["..."]="..."),n.rows&&!Array.isArray(n.rows)&&(i.push(`- "${a}" store "rows" section should be an array`),s.push("...")),n.removed&&!Array.isArray(n.removed)&&(i.push(`- "${a}" store "removed" section should be an array:`),o.push("...")));else{if(null!=t&&t.updated){const e=t.updated.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})));if(s.push(...e),e.length){const t=e.map((e=>"#"+e[u])).join(", ");i.push(`- "${a}" store "rows" section should mention updated record(s) ${t} sent in the request. It should contain the updated record identifiers.`),m=!0}}if(s.length&&s.push("..."),null!=t&&t.removed&&(o.push(...t.removed.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})))),o.length)){const e=o.map((e=>"#"+e[u])).join(", ");i.push(`- "${a}" store "removed" section should mention removed record(s) ${e} sent in the request. It should contain the removed record identifiers.`),l[a].removed=o,o.push("..."),m=!0}}return s.length&&(l[a].rows=s),i.length||delete l[a],Object.assign(r,l),{messages:i,showSupportShortSyncResponseNote:m}}getSyncResponseWarnings(e,t){const n=[],r={},i=t.pack;this.skipSuccessProperty||(r.success=!0);let s=!1;return this.forEachCrudStore(((t,o,a)=>{const l=this.getStoreSyncResponseWarnings(a,null==i?void 0:i[o],e[o],r);s=s||l.showSupportShortSyncResponseNote,n.push(...l.messages)})),n.length&&(n.push("Please adjust your response to look like this:\n"+JSON.stringify(r,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),s&&n.push(this.supportShortSyncResponseNote),n.push(this.disableValidationNote)),n}validateSyncResponse(e,t){const n=this.getSyncResponseWarnings(e,t);n.length&&console.warn(this.crudSyncValidationWarningPrefix+"\n"+n.join("\n"))}};class mD extends Error{}class pD extends mD{constructor(e={}){var t,n;super(e.message||e.request&&N.capitalize(null===(t=e.request)||void 0===t?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=null===(n=this.request)||void 0===n?void 0:n.type}}const fD=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},vD=function(e,t){return fD(e,t,"loadPriority")},yD=function(e,t){return fD(e,t,"syncPriority")};var bD=e=>{e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(lt),e.isDelayable||t.push(Hi),t.push(gD),class extends((e||Qe).mixin(...t)){static $name="AbstractCrudManagerMixin";static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"id",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}static configurable={loadUrl:null,syncUrl:null,forceSync:null,ignoreRemoteChangesInSTM:!1,includeChildrenInRemoveRequest:!0,syncConflictResolution:"local"};static delayable={doAutoLoad:"raf"};get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var e;return null===(e=this.transport)||void 0===e||null===(e=e.load)||void 0===e?void 0:e.url}updateLoadUrl(e){W.setPath(this,"transport.load.url",e)}get syncUrl(){var e;return null===(e=this.transport)||void 0===e||null===(e=e.sync)||void 0===e?void 0:e.url}updateSyncUrl(e){W.setPath(this,"transport.sync.url",e)}get shouldIgnoreRemoteChangesInSTM(){return this.ignoreRemoteChangesInSTM}getStoreDescriptor(e){return e?(e instanceof Il?e=e._crudManagerId||e.id:"object"==typeof e&&(e=e.storeId),this.crudStoresIndex[e]):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:n=this.storeIdProperty,modelClass:r}=t;return e.storeId||(e.storeId=t[n]||t.id),e.idField||(e.idField=r.idField),e.phantomIdField||(e.phantomIdField=r.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=r.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){if(!e)throw new Error("Iterator function must be provided");this.crudStores.every((n=>!1!==e.call(t,n.store,n.storeId,n)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let n;return n=e instanceof Il?{store:e}:"object"==typeof e?e.store?e:{store:new Il(e)}:{store:Il.getStore(e)},t.fillStoreDescriptor(n),(e=n.store).setCrudManager&&e.setCrudManager(t,n),e.crudManager=t,e._crudManagerId=n.storeId,e.isAjaxStore&&(e.pageSize=null),(t.loadUrl||t.syncUrl)&&(e.autoCommit=!1,e.autoLoad=!1,(e.createUrl||e.updateUrl||e.deleteUrl||e.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),t.bindCrudStoreListeners(e),n}addCrudStore(e,t,n){var r,i;if(null===(r=e=nt.asArray(e))||void 0===r||!r.length)return;const s=this,o=e.map(s.internalAddCrudStore,s);void 0===t?s.crudStores.push(...o):(n&&((n instanceof Il||"object"!=typeof n)&&(n=s.getStoreDescriptor(n)),t+=s.crudStores.indexOf(n)),s.crudStores.splice(t,0,...o)),s.orderedCrudStores.push(...o),s.updateCrudStoreIndex(),null===(i=s.afterAddStore)||void 0===i||i.call(s,o)}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||t.addCrudStore(e,nt.findInsertionIndex(e,t.crudStores,vD)),t.hasApplySequenceStore(e)||t.addStoreToApplySequence(e,nt.findInsertionIndex(e,t.syncApplySequence,yD))}hasCrudStore(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,{crudStores:n,orderedCrudStores:r}=t,i=t.getStoreDescriptor(e);if(!i)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(i.store),nt.remove(n,i),nt.remove(r,i),t.removeStoreFromApplySequence(i),delete t.crudStoresIndex[i.storeId]}bindCrudStoreListeners(e){e.ion({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,n){if(!e)return;e=nt.asArray(e);const r=this,i=e.reduce(((e,t)=>{const n=r.getStoreDescriptor(t);return n&&e.push(n),e}),[]);if(void 0===t)r.syncApplySequence.push(...i);else{let e=t;n&&((n instanceof Il||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),e+=r.syncApplySequence.indexOf(n)),r.syncApplySequence.splice(e,0,...i)}const s=r.syncApplySequence.map((({storeId:e})=>e));r.orderedCrudStores=[...r.syncApplySequence],r.crudStores.forEach((e=>{s.includes(e.storeId)||r.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const{syncApplySequence:t}=this,n=this.getStoreDescriptor(e);t&&n&&nt.remove(t,n)}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreDestroy({source:e}){this.removeCrudStore(e)}onCrudStoreChange(e){const t=this,n=null==e?void 0:e.source;if(n){const e=t.getStoreDescriptor(n);e&&!e.idFieldProcessed&&n.modelClass.idFieldProcessed&&(e.idField=n.modelClass.idField,e.idFieldProcessed=!0)}t.crudIgnoreUpdates||(t.crudStoreHasChanges(null==e?void 0:e.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++,this.forEachCrudStore((e=>e.suspendAutoCommit()))}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.forEachCrudStore((t=>t.resumeAutoCommit(e))),t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,e&&t.autoSync&&t.crudStoreHasChanges()&&t.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const e=this;e.hasTimeout("autoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"autoSync",fn:()=>{e.sync().catch((e=>{}))},delay:e.autoSyncTimeout})}async triggerFailedRequestEvents(e,t,n,r,i){const{options:s,type:o}=e;this.trigger("requestFail",{requestType:o,response:t,responseText:n,requestOptions:r,rawResponse:i,responseOptions:r}),this.trigger(o+"Fail",{response:t,requestOptions:r,responseText:n,options:s,rawResponse:i,responseOptions:r})}async internalOnResponse(e,t,n,r){const i=this,s=t?i.decode(t):null,{options:o,type:a}=e;if(t&&!s&&console.error("Failed to parse response: "+t),s&&(i.skipSuccessProperty?!1!==s.success:s.success)){if(!1!==i.trigger("beforeResponseApply",{requestType:a,response:s})&&!1!==i.trigger(`before${N.capitalize(a)}Apply`,{response:s,options:o})){if(i.crudRevision=s.revision,i.afterSyncAttempt(e),await i.applyResponse(e,s,o),i.isDestroyed)return;i.trigger("requestDone",{requestType:a,response:s,requestOptions:n,rawResponse:r,responseOptions:n}),i.trigger(a,{response:s,requestOptions:n,options:o,rawResponse:r,responseOptions:n}),"load"!==a&&i.crudStoreHasChanges()||(i.trigger("noChanges"),"load"===a&&i.emitCrudStoreEvents(e.pack.stores,"afterRequest"))}}else i.triggerFailedRequestEvents(e,s,t,n);return s}afterSyncAttempt(e){for(const n of Object.values(e.pack)){var t;null==n||null===(t=n.added)||void 0===t||t.forEach((e=>e.__record__.isBeingMaterialized=!1))}}suspendChangeTracking(){this.crudIgnoreUpdates++,this.crudStores.forEach((({store:e})=>{e.suspendFilterOnUpdate(),e.suspendSortOnUpdate()}))}resumeChangeTracking(e){this.crudStores.forEach((({store:e})=>{e.resumeFilterOnUpdate(),e.resumeSortOnUpdate()})),!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isChangeTrackingSuspended(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some((e=>this.isCrudStoreDirty(e.store)))}isCrudStoreDirty(e){return e.hasChanges}doAutoLoad(){return this.load().catch((e=>{}))}emitCrudStoreEvents(e,t,n){const r={action:"read"+t,...n};for(const n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,r)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return delete r.request,t.stores=n.map((e=>{var t;const n=null==r?void 0:r[e.storeId],i=e.isPaged||(null===(t=e.store)||void 0===t?void 0:t.isPaged);if(n||i){var s;const t=e.pageSize??(null===(s=e.store)||void 0===s?void 0:s.pageSize),i=Object.assign({storeId:e.storeId,page:1},n);return t&&(i.pageSize=t),e.currentPage=i.page,n&&delete r[e.storeId],i}return e.storeId})),Object.assign(t,r),t}loadCrudStore(e,t,n){const r=null==t?void 0:t.rows;null!=n&&n.append||null!=t&&t.append?e.add(r,!1,{clean:!0}):e.data=r,e.trigger("load",{data:r})}loadDataToCrudStore(e,t,n){const r=e.store,i=null==t?void 0:t.rows;r.__loading=!0,i&&this.loadCrudStore(r,t,n,e),r.__loading=!1}loadCrudManagerData(e,t={}){const n=this;n.trigger("beforeLoadCrudManagerData"),n.suspendChangeTracking(),n.crudStores.forEach((r=>{const i=r.storeId,s=e[i];s&&n.loadDataToCrudStore(r,s,t[i])})),n.resumeChangeTracking(!0),n.trigger("loadCrudManagerData")}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(e){"string"==typeof e&&(e={request:{url:e}});const t=this,n=t.getLoadPackage(e);return t._autoLoadPromise=null,new Promise(((r,i)=>{if(!1!==t.trigger("beforeLoad",{pack:n})){var s;const{load:o}=t.activeRequests;o&&(t.cancelRequest(o.desc,o.reject),t.trigger("loadCanceled",{pack:n}));const a=C.assign({id:n.requestId,data:t.encode(n),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null===(s=e)||void 0===s?void 0:s.request);t.activeRequests.load={type:"load",options:e,pack:n,resolve:r,reject(...e){var t;a.success=a.failure=null,null!==(t=e[0])&&void 0!==t&&t.cancelled||i(...e)},id:n.requestId,desc:t.sendRequest(a)},t.emitCrudStoreEvents(n.stores,"loadStart"),t.trigger("loadStart",{pack:n})}else t.trigger("loadCanceled",{pack:n}),i({cancelled:!0})}))}getActiveCrudManagerRequest(e){let t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}prepareAddedRecordData(e,t){const n=this,{store:r}=t,{isTree:i}=r,s=t.phantomIdField||n.phantomIdField,o=t.phantomParentIdField||n.phantomParentIdField,a=r.modelClass.allFields.filter((e=>e.subStore)),l=e.constructor,d=Object.assign(e.persistableData,{[s]:e.id});if(e.$isPhantom=!0,i){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(d[o]=t.id)}return n.resetIdsBeforeSync&&W.deletePath(d,l.idField),a.forEach((t=>{const r=e.get(t.name);r.totalCount&&(d[t.dataSource]={added:r.getRange().map((e=>n.prepareAddedRecordData(e,{store:r})))})})),Object.defineProperty(d,"__record__",{value:e,enumerable:!1}),d}prepareAdded(e,t){return e.filter((e=>e.isValid)).map((e=>this.prepareAddedRecordData(e,t)))}prepareUpdated(e,t){const{store:n}=t,{isTree:r}=n,i=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,s=t.phantomParentIdField||this.phantomParentIdField,o=n.modelClass.allFields.filter((e=>e.subStore));if(t.store.tree){const n=t.store.rootNode;e=e.filter((e=>e!==n))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let n;if(n=i?t.persistableData:t.modificationDataToWrite,r){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(n[s]=e.id)}return o.forEach((e=>{const r=t.get(e.name);n[e.dataSource]=this.getCrudStoreChanges({store:r})})),W.isEmpty(n)||e.push(n),e}),[])}prepareRemoved(e,{store:t}){let n;if(this.includeChildrenInRemoveRequest)n=e;else{n=[];for(const i of e){var r;const s=i.parentId??(null===(r=i.meta.modified)||void 0===r?void 0:r.parentId);null==s||s!==t.rootNode.id&&e.some((e=>e.id===s))||n.push(i)}}return n.map((e=>W.setPath({},e.constructor.idField,e.id)))}getCrudStoreChanges(e){var t;const{store:n}=e;let r,{added:i=[],modified:s=[],removed:o=[]}=n.changes||{};return i.length&&(i=this.prepareAdded(i,e)),(s.length||null!==(t=n.modifiedMaterialized)&&void 0!==t&&t.size)&&(s=this.prepareUpdated([...s,...n.modifiedMaterialized??[]],e)),o.length&&(o=this.prepareRemoved(o,e)),(i.length||s.length||o.length)&&(r={},i.length&&(r.added=i),s.length&&(r.updated=s),o.length&&(r.removed=o)),r}getChangesetPackage(){const{changes:e}=this;return e||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...e}:null}get changes(){const e={};return this.crudStores.forEach((t=>{const n=this.getCrudStoreChanges(t);n&&(e[t.storeId]=n)})),Object.keys(e).length>0?e:null}isFieldValueEqual(e,t,n){return null!=e&&e.isEqual?e.isEqual(t,n):W.isEqual(t,n)}processRecordResponse(e,t,n,r,i,s){const o=e.syncConflictResolution||this.syncConflictResolution,{fieldDataSourceMap:a}=e.store.modelClass,{idField:l,phantomIdField:d=this.phantomIdField}=e;let c={};if("local"===o)for(const[e,n]of Object.entries(i)){let i=!1;const o=a[e];if(o&&(t||s)){const a=t?t.getFieldPersistentValue(o):s[e];let c=e in r,u=r[e];e===l&&r[d]&&(c=c||d in r,u=r[d]),i=c&&!this.isFieldValueEqual(o,u,a)||e!==l&&this.isFieldValueEqual(o,n,a)}i||W.setPath(c,e,n)}else c=n;return c}getRecordChangesToClear(e,t,n){const{store:r}=e,{fieldDataSourceMap:i}=r.modelClass,s=r.isTree&&r.modelClass.parentIdField;let o,a=!1;if(n){o={};for(const[e,r]of Object.entries(t)){let t=i[e];t||e!==s||(t={name:"parentId"}),t&&e in n&&this.isFieldValueEqual(t,r,n[e])&&(o[t.name]=!0,a=!0)}}return a?o:null}processStoreResponse(e,t,n){const r=this,{supportShortSyncResponse:i}=r,{idField:s,store:o,phantomIdField:a=r.phantomIdField}=e,{addedMap:l,updatedMap:d,removedMap:c}=r.buildStoreSyncRequestMaps(e,n,t),u=new Map,h=new Map,g=[],m=[],p=new Set;for(const n of(null==t?void 0:t.rows)||[]){const t=W.getPath(n,s),i=W.getPath(n,a),c=l.get(i)||d.get(t),h=o.getById(i||t)||o.removed.get(i||t),p=null==h?void 0:h.modificationDataToWrite,f=W.pathifyKeys(c),v=W.pathifyKeys(n),y=r.processRecordResponse(e,h,n,f,v,p);y&&(t&&u.set(t,y),i&&u.set(i,y),h?m.push(y):g.push(y))}for(const t of[...l.values(),...d.values()]){const n=W.getPath(t,a),l=W.getPath(t,s),d=o.getById(n||l)||o.removed.get(n||l);d&&(i||u.has(l)||u.has(n))&&h.set(d,r.getRecordChangesToClear(e,W.pathifyKeys(t),d.modificationDataToWrite))}for(const e of[...(null==t?void 0:t.removed)||[],...r.supportShortSyncResponse?c.values():[]]){const t=W.getPath(e,s);!o.getById(t)&&!o.removed.includes(t)||u.has(t)||p.add(t)}return{added:g,updated:m,removed:[...p].map((e=>({[s]:e}))),clearChanges:h}}buildStoreSyncRequestMaps({idField:e,phantomIdField:t=this.phantomIdField},n){const r=new Map,i=new Map,s=new Map;if(n){for(const e of n.added||[]){const n=W.getPath(e,t);r.set(n,e)}for(const t of n.updated||[]){const n=W.getPath(t,e);i.set(n,t)}for(const t of n.removed||[]){const n=W.getPath(t,e);s.set(n,t)}}return{addedMap:r,updatedMap:i,removedMap:s}}applyChangesToStore(e,t,n){const r=this,i=e.phantomIdField||r.phantomIdField,{store:s}=e,o=s.modelClass.getFieldDataSource("id"),a=s.modelClass.allFields.filter((e=>e.subStore)),{added:l,updated:d,removed:c,clearChanges:u}=r.processStoreResponse(e,t,n),h=[];if(d.length&&a.length)for(const e of d){var g,m;const t=s.getById(e[i]??e[o]),l=(null===(g=n.added)||void 0===g?void 0:g.find((t=>t[i]==e[i])))||(null===(m=n.updated)||void 0===m?void 0:m.find((t=>t[o]==e[o]))),d={};for(const n of a){const{dataSource:i}=n,s=r.fillStoreDescriptor({store:t.get(n.name)});r.applyChangesToStore(s,e[i],null==l?void 0:l[i]),d[i]="foo",delete e[i]}h.push([t,d])}let p;(c.length||l.length||d.length)&&(p=s.applyChangeset({removed:c,added:l,updated:d},null,i,!0,!0)),h.forEach((([e,t])=>Object.assign(p.get(e.id),t)));for(const[e,t]of u)if(t){(e.isModel?e:s.getById(e)).internalClearChanges(!1,!0,t)}return s.trigger("appliedCrudChangesToStore",{crudManager:r}),p}applySyncResponse(e,t){const n=this,{orderedCrudStores:r,supportShortSyncResponse:i}=n;n.applyingChangeset=n.applyingSyncResponse=!0,n.suspendChangeTracking();for(const o of r){const r=e[o.storeId];var s;if(r||i)n.applyChangesToStore(o,r,null==t||null===(s=t.pack)||void 0===s?void 0:s[o.storeId])}n.resumeChangeTracking(!0),n.applyingChangeset=n.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,n){const r=this;switch(r.trackResponseType&&t.type||e.type){case"load":r.validateResponse&&r.validateLoadResponse(t,n),r.applyLoadResponse(t,n);break;case"sync":r.validateResponse&&r.validateSyncResponse(t,e),r.applySyncResponse(t,e)}}applyChangeset(e,t=null,n,r=!1){const i=this,s=r?new Map:void 0;i.applyingChangeset=!0,i.suspendAutoSync(),i.suspendChangeTracking();for(const{store:n,phantomIdField:o}of i.orderedCrudStores)if(e[n.id]){const a=n.applyChangeset(e[n.id],t,o||i.phantomIdField,!0,r);a&&s.set(n.id,a)}return i.applyingChangeset=!1,i.resumeChangeTracking(!0),i.resumeAutoSync(!1),s}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.clearTimeout("autoSync"),e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,n)=>{const r=e.getChangesetPackage();if(!r)return void t(null);this.forEachCrudStore((e=>{var t;return null===(t=e.modifiedMaterialized)||void 0===t?void 0:t.clear()}));for(const e of Object.values(r)){var i;null==e||null===(i=e.added)||void 0===i||i.forEach((e=>e.__record__.isBeingMaterialized=!0))}e.activeRequests.sync={type:"sync",pack:r,resolve:t,reject:n,desc:null,id:r.requestId};const s=e.trigger("beforeSync",{pack:r});Promise.resolve(s).then((t=>{if(!1!==t){var i,s;if(e.trigger("syncStart",{pack:r}),null!==(i=e.eventStore)&&void 0!==i&&i.usesSingleAssignment)null===(s=e.assignmentStore)||void 0===s||s.acceptChanges();e.activeRequests.sync.desc=e.sendRequest({id:r.requestId,data:e.encode(r),type:"sync",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e})}else e.trigger("syncCanceled",{pack:r}),e.activeRequests.sync=null,n({cancelled:!0})})).catch((t=>{e.activeRequests.sync=null,n(t)}))})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onCrudRequestSuccess(e,t,n){var r;const i=this,{type:s,id:o}=n;if(i.isDestroyed)return;let a="";n=i.activeRequests[s];try{a=await e.text()}catch(e){}if(i.isDestroyed)return;if((null===(r=n)||void 0===r?void 0:r.id)!==o)throw new Error(`Interleaved ${s} operation detected`);i.activeRequests[s]=null;const l=await i.internalOnResponse(n,a,t,e);if(!i.isDestroyed){if(!l||(i.skipSuccessProperty?!1===(null==l?void 0:l.success):null==l||!l.success)){const t={rawResponse:e,response:l,request:n};null!=l&&l.message&&(t.message=l.message),n.reject(new pD(t))}i["crud"+N.capitalize(n.type)+"ed"]=!0,n.resolve({response:l,rawResponse:e,responseText:a,request:n})}}async onCrudRequestFailure(e,t,n){var r;const i=this;if(i.isDestroyed)return;n=i.activeRequests[n.type];const s=null==t||null===(r=t.abortController)||void 0===r?void 0:r.signal,o=Boolean(null==s?void 0:s.aborted);if(i.afterSyncAttempt(n),!o){let r,s="";try{s=await e.text(),r=i.decode(s)}catch(e){}if(i.isDestroyed)return;if(i.triggerFailedRequestEvents(n,r,s,t,e),i.isDestroyed)return;n.reject(new pD({rawResponse:e,request:n}))}i.activeRequests[n.type]=null}acceptChanges(){this.crudStores.forEach((({store:e})=>e.acceptChanges())),this.trigger("acceptChanges")}revertChanges(){this.revertCrudStoreChanges(),this.trigger("revertChanges")}revertCrudStoreChanges(){const{usesSingleAssignment:e}=this.eventStore;this.orderedCrudStores.forEach((({store:t})=>(!t.isAssignmentStore||!e)&&t.revertChanges()))}doDestroy(){const e=this,{load:t,sync:n}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),n&&e.cancelRequest(n.desc,n.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}get crudStoresJSON(){var e;const t={};return this.forEachCrudStore(((e,n)=>t[`${n}Data`]=e.toJSON())),null!==(e=this.assignmentStore)&&void 0!==e&&e.usesSingleAssignment&&delete t.assignmentsData,t}set crudStoresJSON(e){this.forEachCrudStore(((t,n)=>{const r=`${n}Data`;e[r]&&(t.data=e[r])}))}}},CD=e=>class t extends(e||Qe){static $name="AjaxTransport";static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){var n;null===(n=e.abort)||void 0===n||n.call(e),this.isDestroying||null==t||t({cancelled:!0})}shouldUseBodyForRequestData(e,t,n){return!("HEAD"===t||"GET"===t||n)}sendRequest(e){const n=this,{data:r}=e,i=n.transport[e.type]||{},s=C.assign({},i);e.url&&(s.url=e.url),s.method=s.method||t.defaultMethod[e.type],s.params=C.assign(s.params||{},e.params);let o,a,{paramName:l}=s;if(n.shouldUseBodyForRequestData(i,s.method,l)?(s.body=r,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(l=l||"data",s.params[l]=r),!s.url)throw new Error("Trying to request without URL specified");function d(){s.queryParams=s.params,delete s.params;let t=!1;const r=C.assign({},s);return o=vr.fetch(s.url,r),o.catch((e=>{var i,s;o.done=!0,null===(i=n.trigger)||void 0===i||i.call(n,"responseReceived",{success:!1});const a=null===(s=r.abortController)||void 0===s?void 0:s.signal;return a&&(t=a.aborted,t||console.warn(e)),{error:e,cancelled:t}})).then((t=>{var i;o.done=!0,null===(i=n.trigger)||void 0===i||i.call(n,"responseReceived",{success:Boolean(null==t?void 0:t.ok)});const s=null!=t&&t.ok?e.success:e.failure;return null==s?void 0:s.call(e.thisObj||n,t,r,e)}))}delete s.paramName;const c=n.trigger("beforeSend",{params:s.params,requestType:e.type,requestConfig:s,config:e});return a=C.isPromise(c)?c.then(d):d(),a.abort=()=>{var e,t;o.done||(null===(e=(t=o).abort)||void 0===e||e.call(t),a.aborted=!0)},a}},wD=e=>class extends(e||Qe){static $name="JsonEncoder";static get defaultConfig(){return{encoder:{}}}encode(e){var t;return e=Object.assign({},null===(t=this.encoder)||void 0===t?void 0:t.requestData,e),N.safeJsonStringify(e)}decode(e){return N.safeJsonParse(e)}},SD=e=>class extends((e||Qe).mixin(bD,CD,wD)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}applyProjectResponse(e){const t=this,{project:n}=t;t.applyingProjectResponse=!0,"$input"in e&&(e=e.$input);const r=n.fieldMap.startDate,i=n.fieldMap.endDate,s=W.getPath(e,r.dataSource),o=W.getPath(e,i.dataSource);"string"==typeof s&&W.setPath(e,r.dataSource,r.convert(s)),"string"==typeof o&&W.setPath(e,i.dataSource,i.convert(o)),n.setByDataSource(e),t._changesToClear.set(t,e),t.applyingProjectResponse=!1}async loadCrudManagerData(e,t={}){const n=this,{project:r}=n;n.suspendChangeTracking(),await super.loadCrudManagerData(...arguments),null!=e&&e.project&&(r.delayEnteringReplica&&r.hasDataInStores?r.ion({recordsUnlinked:()=>{n.suspendChangeTracking(),n.applyProjectResponse(e.project),n.resumeChangeTracking()},once:!0}):n.applyProjectResponse(e.project)),n.resumeChangeTracking(),await(null==r?void 0:r.commitAsync())}async sync(){const{project:e}=this;if(this.suspendAutoSync(),this.suspendChangeTracking(),e&&await e.commitAsync(),!this.isDestroying)return this.resumeChangeTracking(!0),this.resumeAutoSync(!1),super.sync()}async applyResponse(e,t,n){var r,i,s,o;const a=this;if(a.isDestroyed||null!==(r=a.project)&&void 0!==r&&r.isDestroyed)return;a.trigger("beforeApplyResponse"),a.crudStores.forEach((e=>e.store.suspendFilterOnUpdate()));const l=(null==t?void 0:t.project)||a.supportShortSyncResponse&&(null==e||null===(i=e.pack)||void 0===i?void 0:i.project);if(l){const e={};var d;if(l.startDate&&(e.startDate=l.startDate),l.endDate&&(e.endDate=l.endDate),l.calendar)e.calendar=(null===(d=a.project)||void 0===d?void 0:d.getCalendarById(l.calendar))??l.calendar,delete l.calendar;a.applyProjectResponse(e)}if(await super.applyResponse(e,t,n),l){const e=a._changesToClear.get(a);a.applyProjectResponse(l),a._changesToClear.set(a,W.assign({},e,l))}if(a.project){var c,u;let n=e.type;a.trackResponseType&&(n=t.type||n);const r=`propagating${N.capitalize(n)}Changes`;a.suspendAutoSync(),a[r]=!0;const i=a.project.isInitialCommit&&!a.project.silenceInitialCommit;await a.project.commitAsync(),a[r]=!1,null===(c=a.resumeAutoSync)||void 0===c||c.call(a,i),null===(u=a.commitRespondedChanges)||void 0===u||u.call(a)}null===(s=a.crudStores)||void 0===s||s.forEach((e=>e.store.resumeFilterOnUpdate())),null===(o=a.trigger)||void 0===o||o.call(a,"applyResponse",{request:e,response:t,options:n})}applySyncResponse(...e){var t;const n=this,r=null===(t=n.project)||void 0===t?void 0:t.stm.disabled;!1===r&&n.shouldIgnoreRemoteChangesInSTM&&n.project.stm.disable(),n.suspendAutoSync(),super.applySyncResponse(...e),n.resumeAutoSync(!1),!1===r&&n.project.stm.enable()}shouldClearRecordFieldChange(e,t,n){var r;const i=e.getValue(t);return null!==(r=t=e.getFieldDefinition(t))&&void 0!==r&&r.isEqual?t.isEqual(i,n):W.isEqual(i,n)}commitRespondedChanges(){this._changesToClear.forEach(((e,t)=>{Object.entries(e).forEach((([e,n])=>{t===this&&this.project!==this||!this.shouldClearRecordFieldChange(t,e,n)||delete t.meta.modified[e]}))})),this._changesToClear.clear()}applyChangesToStore(e,t,n,...r){const i=super.applyChangesToStore(e,t,n,...r);if(null!=i&&i.size&&this.project)for(const[t,n]of i){const r=e.store.getById(t);r&&this._changesToClear.set(r,n)}return i}};const DD=["events","resourceTimeRanges","assignments","timeRanges"];var ED=e=>class extends(e||Qe){static $name="LazyLoadCrudManager";static configurable={lazyLoad:!1,remotePaging:!1,pageSize:50};updateRemotePaging(e,t){e?this.lazyLoad=!0:t&&(this.lazyLoad=!1)}updatePageSize(){this.isConfiguring||this.load()}updateLazyLoad(e,t){if(!e&&!t)return;const n=this,{internalLoad:r,crudStores:i}=n;i.forEach((({store:e})=>n.storeShouldLazyLoad(e)&&n.setupLazyStore(e))),e?r||(n.internalLoad=n.load,n.load=n.internalLazyLoad):r&&(n.load=r)}afterAddStore(e){e.forEach((({store:e})=>this.storeShouldLazyLoad(e)&&this.setupLazyStore(e)))}setupPagingStore(e){if(this.remotePaging){const{isResourceStore:t}=e;e.remotePaging=!0,e.syncDataOnLoad=!1,t?e._pageSize=this.pageSize:(e.lazyLoad=!0,e.lazyLoad.$isCrudManager=!0),t||e.isEventStore?e.requestData=e=>this.requestData(e,t):e.requestData=null}else e.remotePaging=!1}setupLazyStore(e){var t;if(this.remotePaging)return this.setupPagingStore(e);let{lazyLoad:n}=this;if(n){const{isResourceStore:t}=e;if(!0!==n){const{chunkSize:e,bufferUnit:r,bufferAmount:i}=n;n={},t&&e?n.chunkSize=e:t||(r&&(n.bufferUnit=r),i&&(n.bufferAmount=i))}e.lazyLoad=n,e.lazyLoad.$isCrudManager=!0,e.syncDataOnLoad=!1,t||e.isEventStore?e.requestData=e=>this.requestData(e,t):e.requestData=null}else null!==(t=e.lazyLoad)&&void 0!==t&&t.$isCrudManager&&(e.lazyLoad=!1)}internalLazyLoad(){return this.crudLoaded=!1,this.resourceStore.load()}loadCrudStore(e,t,n){if(!this.lazyLoad||!this.storeShouldLazyLoad(e))return super.loadCrudStore(e,t,n)}getLazyDateStores(e){return this.crudStores.filter((t=>DD.includes(t.storeId)&&(!e||!t.store.isEventStore)))}storeShouldLazyLoad(e){return e.isResourceStore||this.getLazyDateStores().some((t=>t.store===e))}async requestData(e,t){if(!e.startDate||!e.endDate)return;const n=this,r=n.getLazyDateStores(!t),i=t&&n.resourceStore.isTree,s=n._lazyRequestPromises||(n._lazyRequestPromises=[]),o={type:"load",params:e,stores:n.crudStores.filter((e=>!n.crudLoaded||DD.includes(e.storeId)||t&&e.store.isResourceStore)).map((e=>e.storeId))},a=Promise.all(s).then((()=>n.internalLoad(o))),l={...e,promise:a};i&&(l.startIndex=-1,l.count=1),r.forEach((({store:e})=>{!t||!n.remotePaging&&n.resourceStore.count||(e.clear(!0),e.lazyLoad.clear()),e.lazyLoad.addToQueue(l),e.lazyLoad.triggerLazyLoadStart()})),s.push(a);const{response:d}=await a,{rows:c,total:u}=t?d.resources:d.events;if(i){const{idField:e}=n.resourceStore.modelClass;l.resourceIds=c.map((t=>t[e]))}return r.forEach((({store:{lazyLoad:e},storeId:t})=>{var n;i&&(delete e.loadQueue[-1],e.addToQueue(l)),e.addData(null===(n=d[t])||void 0===n?void 0:n.rows,l),e.triggerLazyLoadEnd()})),s.splice(s.indexOf(a),1),{data:c,total:t?u:void 0}}};class xD extends(Qe.mixin(bD)){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){const e=this.crudStoresJSON;return N.safeJsonStringify(e)}set json(e){"string"==typeof e&&(e=N.safeJsonParse(e)),this.crudStoresJSON=e}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){return this.crudStoresJSON}get inlineData(){return this.crudStoresJSON}set inlineData(e){this.crudStoresJSON=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}xD._$name="AbstractCrudManager";var RD=e=>class extends(e||_s){static $name="ProjectModelCommon";static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null,json:null,shouldSyncDataOnLoad:null,toJSONResultFormat:"inlineData",useRawData:null}}static get autoExposeFields(){return!1}attachStore(e){super.attachStore(e),null!=this.useRawData&&(e.useRawData=this.useRawData)}toJSON(){switch(this.toJSONResultFormat){case"inlineData":return this.inlineData;case"model":return super.toJSON()}}get inlineData(){const e=this;let t;return t=e.isAbstractCrudManagerMixin?e.crudStoresJSON:{eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON(),timeRangesData:e.timeRangeStore.toJSON(),resourceTimeRangesData:e.resourceTimeRangeStore.toJSON(),assignmentsData:e.assignmentStore.toJSON()},e.eventStore.usesSingleAssignment&&t.assignmentsData&&delete t.assignmentsData,t.project=super.toJSON(),W.deletePath(t,"project.id"),W.deletePath(t,"project.children"),t}set inlineData(e){this.loadInlineData(e)}get json(){const{toJSONResultFormat:e}=this;this.toJSONResultFormat="inlineData";const t=super.json;return this.toJSONResultFormat=e,t}changeJson(e){return"string"==typeof e&&(e=N.safeJsonParse(e)),e}updateJson(e){e&&this.loadInlineData(e)}get assignments(){return this.assignmentStore.allRecords}updateAssignments(e){this.assignmentStore.data=e}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(e){this.dependencyStore.data=e}get resources(){return this.resourceStore.allRecords}updateResources(e){this.resourceStore.data=e}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(e,t){const n=this.timeRangeStore,r=[];for(const i of n)i.isRecurring?r.push(...i.getOccurrencesForDateRange(e,t)):i.startDate<t&&e<i.endDate&&r.push(i);return r}updateTimeRanges(e){this.timeRangeStore.data=e}getResourceTimeRanges(e,t){const n=this.resourceTimeRangeStore,r=[];for(const i of n)i.isRecurring?r.push(...i.getOccurrencesForDateRange(e,t)):i.startDate<t&&(!i.endDate||e<i.endDate)&&r.push(i);return r}};class TD extends(kC.mixin(RS)){static $name="ResourceTimeRangeModel";static fields=["resourceId","timeRangeColor"];static relations={resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}};static domIdPrefix="resourcetimerange";get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}}TD._$name="ResourceTimeRangeModel";class MD extends($l.mixin(eS)){static $name="ResourceTimeRangeStore";static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:TD,id:"resourceTimeRanges",project:null}}get $lazyLoadPluginClass(){return this.isPaged?Bw:Nw}set project(e){var t;super.project=e,!this.resourceStore&&null!=e&&null!==(t=e.resourceStore)&&void 0!==t&&t.isStore&&(this.resourceStore=e.resourceStore)}get project(){return super.project}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:t,endDate:n}){return e.timeRanges.flatMap((e=>e.isRecurring?e.getOccurrencesForDateRange(t,n):e.intersectsRange(t,n)?e:[])).sort(((e,t)=>e.startDate-t.startDate))}}MD._$name="ResourceTimeRangeStore";class kD extends Mr{static $name="storeTimeZonePlugin";static get pluginConfig(){return{before:["processRecord"],assign:["beforeSyncRecord","afterSyncRecord"],override:["getOccurrencesForTimeSpan"]}}get timeZone(){return this.client.project.timeZone}processRecord(e,t){(t||this.client.isLoadingData||void 0!==e.timeZone)&&this.convertRecordToTimeZone(e)}convertRecordToTimeZone(e,t=this.timeZone){if(e.timeZone!==t){var n;if(null!==(n=e.baselines)&&void 0!==n&&n.count)for(const n of e.baselines)e.timeZone!==n.timeZone&&(n.timeZone=e.timeZone),n.convertToTimeZone(t);e.isRecurring&&e.removeOccurrences(),e.convertToTimeZone(t)}}beforeSyncRecord({record:e,data:t}){if(null!=e.timeZone){let n;e.manuallyScheduled||!e.constraintDate||t.constraintDate||(n=["constraintDate"]),e.$restoreTimeZone=e.timeZone,e.convertToTimeZone(null,n)}}afterSyncRecord({record:e,data:t}){if(e.$restoreTimeZone){let n;e.manuallyScheduled||!e.constraintDate||t.constraintDate||(n=["constraintDate"]),e.convertToTimeZone(e.$restoreTimeZone,n),e.$restoreTimeZone=null}}getOccurrencesForTimeSpan(e,t,n){let r=[];if(e.isRecurring){const{timeZone:i}=e.recurrence,s=e.timeZone;let o;if(null!=i&&s!=i&&(!e.project||s==e.project.timeZone)){o=e.startDate;const t=Sh.toTimeZone(e.getLocalDate("startDate"),i);e.isResourceTimeRange?e.setData("startDate",t):e._startDate=t}r=this.overridden.getOccurrencesForTimeSpan(e,t,n),null!=o&&(e.isResourceTimeRange?e.setData("startDate",o):e._startDate=o,r.forEach((t=>{if(t!==e){let e=Sh.fromTimeZone(t.startDate,i),n=Sh.fromTimeZone(t.endDate,i);null!=s&&(e=Sh.toTimeZone(e,s),n=Sh.toTimeZone(n,s)),t.setData({startDate:e,endDate:n})}})))}return r}}kD._$name="StoreTimeZonePlugin";var FD=e=>class extends(e||_s){static $name="ProjectModelTimeZoneMixin";static configurable={timeZone:{$config:"lazy",value:null}};get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter((e=>e))}plugStore(e){var t;!1===(null===(t=e.hasPlugin)||void 0===t?void 0:t.call(e,kD))&&e.addPlugins(kD)}unplugStore(e){var t;null===(t=e.plugins.storeTimeZonePlugin)||void 0===t||t.destroy()}attachStore(e){super.attachStore(e),e&&this.data&&null!=this.timeZone&&this._storesWithDates.includes(e)&&(this.plugStore(e),this.convertStoresToTimeZone([e]))}detachStore(e){super.detachStore(e),e&&!e.isDestroyed&&null!=this.timeZone&&(this.convertStoresToTimeZone([e],null),this.unplugStore(e))}relayStoreChange({source:e,action:t,records:n,replaced:r}){const i=this;var s;null!=i.timeZone&&i._storesWithDates.includes(e)&&(["add","replace"].includes(t)&&(null!==(s=n)&&void 0!==s&&s.length||null==r||!r.length||(n=r),n.length&&n.forEach((e=>e.timeZone=i.timeZone))))}convertStoresToTimeZone(e,t=this.timeZone){const{stm:n}=this,r=null==n?void 0:n.enabled;r&&(n.disabled=!0);for(const n of e){var i;null==n||null===(i=n.forEach)||void 0===i||i.call(n,(e=>n.plugins.storeTimeZonePlugin.convertRecordToTimeZone(e,t)))}r&&this.commitAsync().then((()=>{n.disabled=!1}))}updateTimeZone(e,t){const n=this,r=n._isConfiguringTimeZone||n.isConfiguring;if(n.trigger("beforeTimeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:r}),n.calendarManagerStore.forEach((e=>e.bumpVersion())),n._storesWithDates.forEach((e=>n.plugStore(e))),n.convertStoresToTimeZone(n._storesWithDates),n.startDate){const r=null!=t?Sh.fromTimeZone(n.startDate,t):n.startDate;n.startDate=null!=e?Sh.toTimeZone(r,e):r}n.ignoreRecordChanges=!0,n.commitAsync().then((()=>{n.isDestroyed||n.trigger("timeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:r}),delete n._isConfiguringTimeZone}))}};class ID extends(kC.mixin(RS)){static $name="TimeRangeModel";afterConstruct(){this.endDate||(this.endDate=this.startDate),super.afterConstruct()}}ID._$name="TimeRangeModel";class AD extends($l.mixin(eS)){static $name="TimeRangeStore";static defaultConfig={loadPriority:500,syncPriority:500,modelClass:ID,id:"timeRanges"};get $lazyLoadPluginClass(){return this.isPaged?Bw:Nw}}AD._$name="TimeRangeStore";var LD=e=>class extends((e||_s).mixin(RD,FD)){static $name="ProjectModelMixin";static get defaultConfig(){return{stm:{},timeRangeModelClass:ID,resourceTimeRangeModelClass:TD,timeRangeStoreClass:AD,resourceTimeRangeStoreClass:MD,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null,resourceTimeRangesData:null}}static configurable={timeRangeStore:{value:{},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null};construct(e={}){super.construct(...arguments),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const e=this;!e.timeRangeStore.stm&&e.stm.addStore(e.timeRangeStore),!e.resourceTimeRangeStore.stm&&e.stm.addStore(e.resourceTimeRangeStore)}attachStore(e){e&&e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(e)}detachStore(e){e&&(this.detachListeners(e.$$name),super.detachStore(e))}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}updateTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e),t&&(t.project=null),e&&(e.project=this)}setTimeRangeStore(e){this.timeRangeStore=e}changeTimeRangeStore(e){return e&&!e.isStore&&(e=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},e)),e}updateResourceTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e),t&&(t.project=null),e&&(e.project=this)}changeResourceTimeRangeStore(e){return e&&!e.isStore&&(e=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},e)),e}setResourceTimeRangeStore(e){this.resourceTimeRangeStore=e}get events(){return this.eventStore.allRecords}updateEvents(e){this.eventStore.data=e}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(e){this.resourceTimeRangeStore.data=e}async loadInlineData(e){return this.isLoadingInlineData=!0,e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),super.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},PD=e=>class extends e{getCurrentConfig(e){const t=this,n=super.getCurrentConfig(e);if(n){for(const r of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const i=t[r];if(i){i.count&&(n[i.id+"Data"]=i.getInlineData(e));const t=i.getCurrentConfig(e);t&&Object.keys(t).length>0?1===Object.keys(t).length&&t.data?delete n[r]:n[r]=Object.assign(n[r]||{},t):n[r]&&0===Object.keys(n[r]).length&&delete n[r]}}return t.taskStore.isTaskStore&&(delete n.eventModelClass,delete n.eventStoreClass,delete n.children),n}}};class OD extends Qe{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const t=e.added||[];let n,r;for(r=t.length-1;r>=0;--r)n=t[r],n.isPersistable||t.splice(t.indexOf(n),1);0===t.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}OD._$name="ModelPersistencyManager";const $D=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+t,e.getMilliseconds()),_D=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,i=0!==n[0],s=0,o=t.length-1;o>-1;--o){if((r=t[o])===e)return r;if(!(r>e||0===r&&i&&n[1]>e))break;s=o}return t[s]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],i=n[1],s=t.length,o=0===t[s-1]&&0!==r?i:0,a=e,l=t.indexOf(e),d=a;a===(t[l]||o);)if(++a>i&&(a=r),++l===s&&(l=0),a===d)return;return a},e.array.prev=function(e,t,n){for(var r,i=t.length,s=0!==n[0],o=i-1,a=0;a<i;a++){if((r=t[a])===e)return r;if(!(r<e||0===r&&s&&n[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],i=n[1],s=t.length,o=0===t[s-1]&&0!==r?i:0,a=e,l=t.indexOf(e),d=a;a===(t[l]||o);)if(--a<r&&(a=i),-1===--l&&(l=s-1),a===d)return;return a},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>i?i:n||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var i=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return i.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):i},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),i=e.dc.extent(r)[1];return n=n>i?i:n||i,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?i:n||i,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),i=e.s.val(t),s=n>59?60-r:n<=r?60-r+n:n-r,o=new Date(t.getTime()+s*e.MIN-i*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(s+120)*e.MIN-i*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),i=n>59?60-r:n<=r?60-r+n:n-r,s=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&s.getTime()<=t.getTime()&&(s=new Date(t.getTime()+(i+7200)*e.SEC)),s},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?i:n||i,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),i=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.start(i);return n=n>s?1:n||s,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.end(i);return n=n>s?s:n||s,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var n,r=[],i=0;for(var s in t){var o=s.split("_"),a=o[0],l=o[1],d=t[s],c=l?e.modifier[l](e[a],d):e[a];r.push({constraint:c,vals:d}),i++}return r.sort((function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0})),n=r[i-1].constraint,{start:function(t,s){for(var o,a=s,l=e.array[t],d=1e3;d--&&!o&&a;){o=!0;for(var c=0;c<i;c++){var u=r[c].constraint,h=u.val(a),g=u.extent(a),m=l(h,r[c].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?n.start(a):n.end(a)),a},end:function(t,n){for(var s,o=e.array[t+"Invalid"],a=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=i-1;l>=0;l--){var d,c=r[l].constraint,u=c.val(n),h=c.extent(n),g=o(u,r[l].vals,h);void 0!==g&&(!(d=c[t](n,g))||s&&!a(s,d)||(s=d))}return s},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)},tickSafe:function(e,t){return"next"===e?$D(n.end(t),1):$D(n.start(t),-1)},tickStart:function(e){return n.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var n=[],r=t.schedules.length,i=[],s=t.exceptions?t.exceptions.length:0,o=0;o<r;o++)n.push(e.compile(t.schedules[o]));for(var a=0;a<s;a++)i.push(e.compile(t.exceptions[a]));function l(t,r,o,a,l){var b,C,w,S=v(t),D=r,E=1e6,x=[],R=[],T=[],M="next"===t,k=M?0:1,F=M?1:0;if(!(o=o?new Date(o):new Date)||!o.getTime())throw new Error("Invalid start date.");for(!function(e,t,n,r){for(var i=0,s=t.length;i<s;i++)n[i]=t[i].start(e,r)}(t,n,x,o),function(t,n,r,i){for(var s=0,o=n.length;s<o;s++){var a=n[s].start(t,i);r[s]=a?[a,n[s].end(t,a)]:e.NEVER}}(t,i,R,o);E--&&D&&(b=y(x,S))&&(!a||!S(b,a));)if(s&&(u(t,i,R,b),C=m(t,R,b)))c(t,n,x,C);else{if(l){var I=p(R,S);C=f(t,n,x,b,I);var A=M?[new Date(Math.max(o,b)),C?new Date(a?Math.min(C,a):C):void 0]:[C?new Date(a?Math.max(a,C.getTime()+e.SEC):C.getTime()+e.SEC):void 0,new Date(Math.min(o,b.getTime()+e.SEC))];if(w&&A[k].getTime()===w[F].getTime()?(w[F]=A[F],D++):(w=A,T.push(w)),!C)break;c(t,n,x,C)}else T.push(M?new Date(Math.max(o,b)):g(n,x,b,a)),h(t,n,x,b);D--}for(var L=0,P=T.length;L<P;L++){var O=T[L];T[L]="[object Array]"===Object.prototype.toString.call(O)?[d(O[0]),d(O[1])]:d(O)}return 0===T.length?e.NEVER:1===r?T[0]:T}function d(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function c(e,t,n,r){for(var i=v(e),s=0,o=t.length;s<o;s++)n[s]&&!i(n[s],r)&&(n[s]=t[s].start(e,r))}function u(t,n,r,i){for(var s=v(t),o=0,a=n.length;o<a;o++)if(r[o]&&!s(r[o][0],i)){var l=n[o].start(t,i);r[o]=l?[l,n[o].end(t,l)]:e.NEVER}}function h(t,n,r,i){for(var s=0,o=n.length;s<o;s++)if(r[s]&&r[s].getTime()===i.getTime()){const o=n[s].start(t,n[s].tick(t,i));o!==e.NEVER&&o.getTime()===r[s].getTime()?r[s]=n[s].start(t,n[s].tickSafe(t,i)):r[s]=o}}function g(e,t,n,r){for(var i,s=0,o=t.length;s<o;s++)if(t[s]&&t[s].getTime()===n.getTime()){var a=e[s].tickStart(n);if(r&&a<r)return r;(!i||a>i)&&(i=a)}return i}function m(e,t,n){for(var r,i=v(e),s=0,o=t.length;s<o;s++){var a=t[s];!a||i(a[0],n)||a[1]&&!i(a[1],n)||r&&!i(a[1],r)||(r=a[1])}return r}function p(e,t){for(var n,r=0,i=e.length;r<i;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function f(e,t,n,r,i){for(var s,o=v(e),a=0,l=t.length;a<l;a++){var d=n[a];if(d&&d.getTime()===r.getTime()){var c=t[a].end(e,d);if(i&&(!c||o(c,i)))return i;s&&!o(c,s)||(s=c)}}return s}function v(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var n=e[0],r=1,i=e.length;r<i;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,n){return l("next",e||1,t,n)},prev:function(e,t,n){return l("prev",e||1,t,n)},nextRange:function(e,t,n){return l("next",e||1,t,n,!0)},prevRange:function(e,t,n){return l("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,n){var r,i=e.schedule(n);return t&&function e(){var n=Date.now(),s=i.next(2,n);if(!s[0])return void(r=void 0);var o=s[0].getTime()-n;o<1e3&&(o=s[1]?s[1].getTime()-n:1e3);r=o<2147483647?setTimeout(t,o):setTimeout(e,2147483647)}(),{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout((function s(){i||(t(),r=e.setTimeout(s,n))}),n),i=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){i=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,i,s){return new Date(e,t,n,r,i,s)}:function(e,t,n,r,i,s){return new Date(Date.UTC(e,t,n,r,i,s))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,n,r,i,s,o){return e.date.build(t,void 0!==n?n-1:0,void 0!==r?r:1,i||0,s||0,o||0)},e.date.nextRollover=function(t,n,r,i){var s=r.val(t),o=r.extent(t)[1];return(n||o)<=s||n>o?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,n,r,i,s,o){var a=arguments.length;return n=a<2?11:n-1,r=a<3?e.D.extent(e.date.next(t,n+1))[1]:r,i=a<4?23:i,s=a<5?59:s,o=a<6?59:o,e.date.build(t,n,r,i,s,o)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function o(e,t,n,r,i){var s=n;for(e[t]||(e[t]=[]);s<=r;)e[t].indexOf(s)<0&&e[t].push(s),s+=i||1;e[t].sort((function(e,t){return e-t}))}function a(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),o(t,"d",n,n),o(t,"dc",r,r)}function l(e,t,r,i,l,d){var c,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=i-1),null!==(c=s(e,d,l))?o(g,r,c,c):null!==(c=s(e.replace("W",""),d,l))?function(e,t,r){var i={},s={};1===r?(o(t,"D",1,3),o(t,"d",n.MON,n.FRI),o(i,"D",2,2),o(i,"d",n.TUE,n.FRI),o(s,"D",3,3),o(s,"d",n.TUE,n.FRI)):(o(t,"D",r-1,r+1),o(t,"d",n.MON,n.FRI),o(i,"D",r-1,r-1),o(i,"d",n.MON,n.THU),o(s,"D",r+1,r+1),o(s,"d",n.TUE,n.FRI)),e.exceptions.push(i),e.exceptions.push(s)}(t,g,c):null!==(c=s(e.replace("L",""),d,l))?a(h,g,c,i-1):2===(u=e.split("#")).length?a(h,g,c=s(u[0],d,l),s(u[1])):function(e,t,n,r,i,a){var l=e.split("/"),d=+l[1],c=l[0];if("*"!==c&&"0"!==c){var u=c.split("-");r=s(u[0],a,i),i=s(u[1],a,i)||i}o(t,n,r,i,d)}(e,g,r,i,l,d)}function d(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function c(e,t){return d(e)&&!d(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var t,n,r,s,o={schedules:[{}],exceptions:[]},a=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((r=a[(n=i[t])[0]])&&"*"!==r&&"?"!==r){var d,u=(s=r.split(",").sort(c)).length;for(d=0;d<u;d++)l(s[d],o,t,n[1],n[2],n[3])}return o}(t?u:"0 "+u)},e.parse.recur=function(){var t,n,r,i,s,o,a,l,d,c=[],u=[],h=c;function g(e,c,u){if(e=s?e+"_"+s:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],i){for(r=[],l=c;l<=u;l+=i)r.push(l);d={n:e,x:i,c:n.length,m:u}}var g=(r=o?[c]:a?[u]:r).length;for(l=0;l<g;l+=1){var m=r[l];n.indexOf(m)<0&&n.push(m)}r=i=s=o=a=0}return{schedules:c,exceptions:u,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return s="a",r=[e],this},before:function(e){return s="b",r=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return g("fd"),this},customModifier:function(t,n){if(!e.modifier[t])throw new Error("Custom modifier "+t+" not recognized!");return s=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return g(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,d.m)},between:function(e,n){return t[d.n]=t[d.n].splice(0,d.c),i=d.x,g(d.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var n,r=e.parse.recur,i=0,s="",o={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\d(t\d\d(:\d\d(:\d\d)?)?)?)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},a={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function d(e){var t,n,r,o,a,d,c=e instanceof Array?e:[e],u=/\s+/;for(c.push(u),a=i;!t||t.type===u;){d=-1,n=s.substring(a),t=l(a,a,s.split(u)[0]);var h,g=c.length;for(h=0;h<g;h++)(r=(o=c[h]).exec(n))&&0===r.index&&r[0].length>d&&(t=l(a,a+(d=r[0].length),n.substring(0,d),o));t.type===u&&(a=t.endPos)}return t}function c(e){var t=d(e);return i=t.endPos,t}function u(e){for(var t=+y(e),n=f(o.through)?+y(e):t,r=[],i=t;i<=n;i++)r.push(i);return r}function h(e){for(var t=u(e);f(o.and);)t.push.apply(t,u(e));return e===o.dayName&&t.sort(((e,t)=>e-t)),t}function g(e){var t,n,r,i;f(o.weekend)?e.on(a.sun,a.sat).dayOfWeek():f(o.weekday)?e.on(a.mon,a.tue,a.wed,a.thu,a.fri).dayOfWeek():(t=y(o.rank),e.every(t),n=p(e),f(o.start)?(t=y(o.rank),e.startingOn(t),v(n.type)):f(o.between)&&(r=y(o.rank),f(o.and)&&(i=y(o.rank),e.between(r,i))))}function m(e){f(o.first)?e.first():f(o.last)?e.last():e.on(h(o.rank)),p(e)}function p(e){var t=v([o.second,o.minute,o.hour,o.dayOfYear,o.dayOfWeek,o.dayInstance,o.day,o.month,o.year,o.weekOfMonth,o.weekOfYear]);switch(t.type){case o.second:e.second();break;case o.minute:e.minute();break;case o.hour:e.hour();break;case o.dayOfYear:e.dayOfYear();break;case o.dayOfWeek:e.dayOfWeek();break;case o.dayInstance:e.dayOfWeekCount();break;case o.day:e.dayOfMonth();break;case o.weekOfMonth:e.weekOfMonth();break;case o.weekOfYear:e.weekOfYear();break;case o.month:e.month();break;case o.year:e.year();break;default:n=i}return t}function f(e){var t=d(e).type===e;return t&&c(e),t}function v(e){var t=c(e);return t.type?t.text=function(e,t){var n=e;switch(t){case o.time:var r=e.split(/(:|am|pm)/),i="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],s=r[2].trim();n=(1===i.length?"0":"")+i+":"+s;break;case o.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case o.monthName:case o.dayName:n=a[e.substring(0,3)];break;case o.fullDate:n=new Date(e.toUpperCase())}return n}(t.text,e):n=i,t}function y(e){return v(e).text}return function(e){i=0,s=e,n=-1;for(var t=r();i<s.length&&n<0;){switch(v([o.every,o.after,o.before,o.onthe,o.on,o.of,o.in,o.at,o.and,o.except,o.also]).type){case o.every:g(t);break;case o.after:void 0!==d(o.time).type?(t.after(y(o.time)),t.time()):void 0!==d(o.fullDate).type?(t.after(y(o.fullDate)),t.fullDate()):(t.after(y(o.rank)),p(t));break;case o.before:void 0!==d(o.time).type?(t.before(y(o.time)),t.time()):void 0!==d(o.fullDate).type?(t.before(y(o.fullDate)),t.fullDate()):(t.before(y(o.rank)),p(t));break;case o.onthe:m(t);break;case o.on:t.on(h(o.dayName)).dayOfWeek();break;case o.of:t.on(h(o.monthName)).month();break;case o.in:t.on(h(o.yearIndex)).year();break;case o.at:for(t.on(y(o.time)).time();f(o.and);)t.on(y(o.time)).time();break;case o.and:break;case o.also:t.and();break;case o.except:t.except();break;default:n=i}}return{schedules:t.schedules,exceptions:t.exceptions,error:n}}(t.toLowerCase())},e}();var HD,VD,ND,BD,zD,jD,WD,UD,GD,YD;_D.date.localTime(),e.TimeUnit=void 0,(HD=e.TimeUnit||(e.TimeUnit={})).Millisecond="millisecond",HD.Second="second",HD.Minute="minute",HD.ElapsedMinute="eminute",HD.Hour="hour",HD.ElapsedHour="ehour",HD.Day="day",HD.ElapsedDay="eday",HD.Week="week",HD.ElapsedWeek="eweek",HD.Month="month",HD.ElapsedMonth="emonth",HD.Quarter="quarter",HD.ElapsedQuarter="equarter",HD.Year="year",HD.ElapsedYear="eyear",e.ProjectConstraintResolution=void 0,(VD=e.ProjectConstraintResolution||(e.ProjectConstraintResolution={})).Honor="honor",VD.Ignore="ignore",VD.Conflict="conflict",e.ConstraintType=void 0,(ND=e.ConstraintType||(e.ConstraintType={})).MustStartOn="muststarton",ND.MustFinishOn="mustfinishon",ND.StartNoEarlierThan="startnoearlierthan",ND.StartNoLaterThan="startnolaterthan",ND.FinishNoEarlierThan="finishnoearlierthan",ND.FinishNoLaterThan="finishnolaterthan",ND.AsSoonAsPossible="assoonaspossible",ND.AsLateAsPossible="aslateaspossible",e.SchedulingMode=void 0,(BD=e.SchedulingMode||(e.SchedulingMode={})).Normal="Normal",BD.FixedDuration="FixedDuration",BD.FixedEffort="FixedEffort",BD.FixedUnits="FixedUnits",e.DependencyValidationResult=void 0,(zD=e.DependencyValidationResult||(e.DependencyValidationResult={}))[zD.NoError=0]="NoError",zD[zD.CyclicDependency=1]="CyclicDependency",zD[zD.DuplicatingDependency=2]="DuplicatingDependency",e.DependencyType=void 0,(jD=e.DependencyType||(e.DependencyType={}))[jD.StartToStart=0]="StartToStart",jD[jD.StartToEnd=1]="StartToEnd",jD[jD.EndToStart=2]="EndToStart",jD[jD.EndToEnd=3]="EndToEnd",e.DependenciesCalendar=void 0,(WD=e.DependenciesCalendar||(e.DependenciesCalendar={})).Project="Project",WD.FromEvent="FromEvent",WD.ToEvent="ToEvent",WD.AllWorking="AllWorking",e.StartedTaskScheduling=void 0,(UD=e.StartedTaskScheduling||(e.StartedTaskScheduling={})).Auto="Auto",UD.Manual="Manual",e.ProjectType=void 0,(GD=e.ProjectType||(e.ProjectType={}))[GD.SchedulerBasic=1]="SchedulerBasic",GD[GD.SchedulerPro=2]="SchedulerPro",GD[GD.Gantt=3]="Gantt",e.Direction=void 0,(YD=e.Direction||(e.Direction={})).Forward="Forward",YD.Backward="Backward",YD.None="None";var qD,KD,XD;function ZD(e){return e?"string"==typeof e&&(e=e.split(",")).map((e=>{const[t,n]=e.split("-");return{startDate:t,endDate:n}})):e=null,e}e.ConstraintIntervalSide=void 0,(qD=e.ConstraintIntervalSide||(e.ConstraintIntervalSide={})).Start="Start",qD.End="End",e.CalendarIntervalType=void 0,(KD=e.CalendarIntervalType||(e.CalendarIntervalType={})).Week="Week",KD.Exception="Exception",e.TreatInconsistentIntervals=void 0,(XD=e.TreatInconsistentIntervals||(e.TreatInconsistentIntervals={})).Skip="Skip",XD.Throw="Throw";class JD extends(Ew([Mw],(t=>class extends t{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","color","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"},{name:"type"},{name:"availability",convert:ZD},{name:"compositeCode"}]}getCalendar(){return this.stores[0].calendar}get compositeIntervalCode(){var e,t;return this.compositeCode||((null===(e=this.startDate)||void 0===e?void 0:e.getTime())||"")+"-"+((null===(t=this.endDate)||void 0===t?void 0:t.getTime())||"")+"-"+(this.type||"")}resetPriority(){this.prioritySortValue=null,this.getCalendar().getDepth()}getPrioritySortValue(){if(null!=this.prioritySortValue)return this.prioritySortValue;let t=1e4,n=this.priority;if(null==n){switch(this.type){case e.CalendarIntervalType.Week:t+=100*this.getCalendar().getDepth(),n=this.isOverride()?30:20;break;case e.CalendarIntervalType.Exception:t+=1e4*this.getCalendar().getDepth(),n=40;break;default:t+=100*this.getCalendar().getDepth(),this.isRecurrent()?(n=20,this.isOverride()&&(n+=10)):n=40}n+=this.parentIndex}return this.prioritySortValue=t+n}isRecurrent(){return Boolean(this.getStartDateSchedule()||this.type===e.CalendarIntervalType.Exception&&this.getAvailabilityStartSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate&&!this.isRecurrent())}isOverride(){return Boolean(this.startDate||this.endDate)}parseDateSchedule(e){let t=e;if(e&&e!==Object(e))try{t=JSON.parse(e)}catch(n){if(t=_D.parse.text(e.trim()),t.error>=0)throw new Error(`Parsing the 'later' schedule has failed: "${e}". Please consult the 'later' documentation for recognizable formats: https://bunkat.github.io/later/parsers.html`)}return t}getStartDateSchedule(){var e;if(!this.recurrentStartDate)return null;if(this.startDateSchedule)return this.startDateSchedule;const t=this.parseDateSchedule(this.recurrentStartDate);if(null!=t&&null!==(e=t.schedules)&&void 0!==e&&e[0]){const e=t.schedules[0];!this.startDate&&e.fd_a&&(this.startDate=new Date(e.fd_a[0]),delete e.fd_a),!this.endDate&&e.fd_b&&(this.endDate=new Date(e.fd_b[0]),delete e.fd_b)}return this.startDateSchedule=_D.schedule(t)}getEndDateSchedule(){var e;if(this.endDateSchedule)return this.endDateSchedule;if(!this.recurrentEndDate||"EOD"===this.recurrentEndDate)return null;const t=this.parseDateSchedule(this.recurrentEndDate);if(null!=t&&null!==(e=t.schedules)&&void 0!==e&&e[0]){var n,r,i,s,o,a,l,d;const e=t.schedules[0];null!==(n=this.startDate)&&void 0!==n&&n.getTime()&&null!==(r=e.fd_a)&&void 0!==r&&r[0]&&(null===(i=this.startDate)||void 0===i?void 0:i.getTime())===(null===(s=e.fd_a)||void 0===s?void 0:s[0])&&delete e.fd_a,null!==(o=this.endDate)&&void 0!==o&&o.getTime()&&null!==(a=e.fd_b)&&void 0!==a&&a[0]&&(null===(l=this.endDate)||void 0===l?void 0:l.getTime())===(null===(d=e.fd_b)||void 0===d?void 0:d[0])&&delete e.fd_b}return this.endDateSchedule=_D.schedule(t)}getAvailabilityStartSchedule(){var e;if(null!==(e=this.availability)&&void 0!==e&&e.length){if(this.availabilityStartSchedule)return this.availabilityStartSchedule;const e="at "+this.availability.map((e=>e.startDate)).sort().join(","),t=this.parseDateSchedule(e);return this.availabilityStartSchedule=_D.schedule(t)}}getAvailabilityEndSchedule(){var e;if(null!==(e=this.availability)&&void 0!==e&&e.length){if(this.availabilityEndSchedule)return this.availabilityEndSchedule;const e="at "+this.availability.map((e=>e.endDate)).sort().join(","),t=this.parseDateSchedule(e);return this.availabilityEndSchedule=_D.schedule(t)}}afterChange(e,t,n,r,i){super.afterChange(e,t,n,r,i),null!=t&&t.recurrentStartDate&&(this.startDateSchedule=void 0),null!=t&&t.recurrentEndDate&&(this.endDateSchedule=void 0),null!=t&&t.availability&&(this.availabilityStartSchedule=void 0,this.availabilityEndSchedule=void 0)}}))){}class QD extends(Ew([Tw],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:JD}}acceptChanges(){if(!this.isSyncingDataOnLoad)return super.acceptChanges(...arguments)}}}))){}const eE=new Date(-864e13),tE=new Date(864e13);var nE,rE;e.EdgeInclusion=void 0,(nE=e.EdgeInclusion||(e.EdgeInclusion={}))[nE.Left=0]="Left",nE[nE.Right=1]="Right",e.CalendarIteratorResult=void 0,(rE=e.CalendarIteratorResult||(e.CalendarIteratorResult={}))[rE.FullRangeIterated=0]="FullRangeIterated",rE[rE.StoppedByIterator=1]="StoppedByIterator",rE[rE.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",rE[rE.MaxRangeReached=3]="MaxRangeReached";class iE{constructor(t){this.cacheFilledStartDate=tE,this.cacheFilledEndDate=eE,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=e.TimeUnit.Day,this.maxCacheExtendCycles=1e3,this.maxRange=15768e7,t&&Object.assign(this,t)}includeWrappingRangeFrom(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}ensureCacheFilledForInterval(e,t){const n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==tE.getTime()){const i=e.getTime(),s=t.getTime();if(n<=i&&s<=r)return;if(s<=n)t=new Date(n-1);else if(i>=r)e=new Date(r);else if(n<=i&&i<=r)e=new Date(r+1);else{if(!(n<=s&&s<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===tE.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===eE.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=tE,this.cacheFilledEndDate=eE,this.intervalCache.clear()}forEachAvailabilityInterval(t,n,r){r=r||this;const i=t.startDate,s=t.endDate,o=i&&i.getTime(),a=s&&s.getTime(),l=t.maxRange??this.maxRange,d=!1!==t.isForward;if(d?!i:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const c=this.intervalCache;let u=d?i:s,h=d?i:s;const g=h.getTime();for(let t=1;t<this.maxCacheExtendCycles;t++){d?this.ensureCacheFilledForInterval(u,s||xi.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(i||xi.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let t=c.getIntervalOf(h,d?e.EdgeInclusion.Left:e.EdgeInclusion.Right);for(;t;){const u=t.startDate,m=t.endDate;if(d&&a&&u.getTime()>=a||!d&&o&&m.getTime()<=o)return e.CalendarIteratorResult.FullRangeIterated;if(d&&u.getTime()-g>=l||!d&&g-m.getTime()>=l)return e.CalendarIteratorResult.MaxRangeReached;if(d&&u.getTime()>=this.cacheFilledEndDate.getTime()||!d&&m.getTime()<=this.cacheFilledStartDate.getTime())break;h=d?m:u;const p=o&&u.getTime()<o?i:u,f=a&&m.getTime()>a?s:m;if(!1===n.call(r,p,f,t.cacheInterval))return e.CalendarIteratorResult.StoppedByIterator;t=d?c.getNextInterval(t):c.getPrevInterval(t)}if(d&&h.getTime()===tE.getTime()||!d&&h.getTime()===eE.getTime())return e.CalendarIteratorResult.FullRangeIterated;u=d?this.cacheFilledEndDate:this.cacheFilledStartDate}return e.CalendarIteratorResult.MaxCacheExtendCyclesReached}}const sE=e=>Array.from(new Set(e)),oE=(e,t)=>{const n=e.getPrioritySortValue();return t.getPrioritySortValue()-n};class aE{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),this.intervals=this.normalizeIntervals(this.intervals),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new aE({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new aE({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){return null!=this.isWorking?this.isWorking:this.isWorking=this.intervals[0].isWorking}normalizeIntervals(e){const t=sE(e);return t.sort(oE),t}}const lE=(e,t,n=((e,t)=>e-t))=>{let r=0,i=t.length;for(;r<i;){const s=(r+i)/2|0,o=n(e,t[s]);if(0===o)return{found:!0,index:s};o<0?i=s:r=s+1}return{found:!1,index:i}};var dE;e.IndexPosition=void 0,(dE=e.IndexPosition||(e.IndexPosition={}))[dE.Exact=0]="Exact",dE[dE.Next=1]="Next";class cE{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const n=lE(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}insertAt(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}setValueAt(e,t){this.values[e]=t}get(e){const t=lE(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=lE(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(t){const n=lE(t,this.keys,this.comparator);return{found:n.found?e.IndexPosition.Exact:e.IndexPosition.Next,index:n.index}}map(e){const t=this.keys,n=this.values,r=[];for(let i=0;i<t.length;i++)r.push(e(n[i],t[i],i));return r}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}}class uE{constructor(e){if(this.points=new cE(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=eE,this.rightInfinityKey=tE,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(t,n=e.EdgeInclusion.Left){let r,{found:i,index:s}=this.indexOf(t);return r=n===e.EdgeInclusion.Left&&i===e.IndexPosition.Exact?s:s-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(t,n,r){const i=this.points,{found:s,index:o}=i.indexOfKey(t);let a,l;if(s==e.IndexPosition.Exact){const e=r(l=i.getValueAt(o));i.setValueAt(o,e),a=o+1}else{const e=r(l=i.getValueAt(o-1));i.insertAt(o,t,e),a=o+1}for(;a<i.size();){if(i.getKeyAt(a).getTime()>=n.getTime())break;const e=r(l=i.getValueAt(a));i.setValueAt(a,e),a++}if(a===i.size())i.insertAt(i.size(),n,this.emptyInterval);else{i.getKeyAt(a).getTime()===n.getTime()||i.insertAt(a,n,l)}}includeWrappingRange(e,t,n){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,(e=>this.combineIntervalsFn(e,r.cacheInterval))),!(r.endDate.getTime()>n.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}const hE=_D.schedule(_D.parse.text("every 1 day"));class gE extends iE{constructor(t){if(super(t),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalUnspecifiedTimeIntervals=new Map,this.weekUnspecifiedTimeIntervalsByKey=new Map,this.treatInconsistentIntervals=(null==t?void 0:t.treatInconsistentIntervals)||e.TreatInconsistentIntervals.Skip,this.intervalCache=new uE({emptyInterval:new aE({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){var n;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const r=this.calendar.ignoreTimeZone?null:null===(n=this.calendar.project)||void 0===n?void 0:n.timeZone;if(e>t)throw new Error("Invalid cache fill interval");for(const n of this.intervalStore)n.isRecurrent()&&this.cacheRecurrentInterval(e,t,r,n)}cacheRecurrentInterval(t,n,r,i){var s,o;const a=i.startDate,l=i.endDate;if(a&&a>=n||l&&l<=t)return;const d=i.getAvailabilityStartSchedule(),c=i.getAvailabilityEndSchedule(),u=i.getStartDateSchedule()||d&&hE,h=i.getEndDateSchedule(),g=!h||"EOD"===h;let m,p=t,f=n,v=u.prev(2,t);if(v&&(p=v[0],p.getTime()===t.getTime()&&v[1]&&(p=v[1])),g){const e=u.next(1,n);e&&(f=xi.getStartOfNextDay(e,!0))}else m=h.next(2,n),m&&(f=m[0],f.getTime()===n.getTime()&&m[1]&&(f=m[1]));let y=u.next(1/0,p,new Date(f.getTime()-1e3));if(null===(s=y)||void 0===s||!s.length)return;let b=g?y.map((e=>xi.getStartOfNextDay(e,!0))):h.next(1/0,p,f);if(null===(o=b)||void 0===o||!o.length)return;for(y[0].getTime()===b[0].getTime()&&b.splice(0,1);a&&y[0]<a;)b[0]>a?y[0]=a:(y.shift(),b.shift());for(;l&&b[b.length-1]>l;)y[b.length-1]<l?b[b.length-1]=l:(y.pop(),b.pop());const C=this.treatInconsistentIntervals;for(let t=0,n=y.length;t<n;t++){const n=y[t],r=b[t];if(!n||!r)break;if(n>r)if(C===e.TreatInconsistentIntervals.Skip)b.splice(t,1);else if(C===e.TreatInconsistentIntervals.Throw)throw new Error("Recurrent interval inconsistency: "+(i.name||i.id)+", caching startDate: "+xi.format(n)+", caching endDate: "+xi.format(r)+", recurrentStartDate: "+i.recurrentStartDate+", recurrentEndDate: "+i.recurrentEndDate)}if(b.length>y.length?b.length=y.length:b.length<y.length&&(y.length=b.length),d){const e=[],t=[],n=this.getUnspecifiedTimeIntervalForException(i,{isWorking:!1});for(let r=0,i=y.length;r<i;r++){const i=y[r],s=b[r];this.intervalCache.addInterval(i,s,(e=>e.includeInterval(n)));let o=d.next(1/0,i,s);if(!o)return;let a=c.next(1/0,new Date(i.getTime()+1e3),s);if(!a)return;a.length>o.length?a.length=o.length:a.length<o.length&&(o.length=a.length),a[0]<o[0]&&(o.unshift(i),a.push(s)),e.push(...o),t.push(...a)}y=e,b=t}for(let e=0,t=y.length;e<t;e++){let t=y[e],n=b[e];null!=r&&(t=Sh.toTimeZone(t,r),n=Sh.toTimeZone(n,r)),this.intervalCache.addInterval(t,n,(e=>e.includeInterval(i)))}}getUnspecifiedTimeIntervalForException(e,t={}){let n=this.intervalUnspecifiedTimeIntervals.get(e);return n||(n=this.unspecifiedTimeInterval.copy(),this.intervalUnspecifiedTimeIntervals.set(e,n),Object.assign(n,{mainInterval:e,calendar:this.unspecifiedTimeInterval.calendar,name:e.name,cls:e.cls,startDate:e.startDate,endDate:e.endDate,prioritySortValue:e.getPrioritySortValue()-1,...t})),n}getUnspecifiedTimeIntervalForWeek(e){let t=this.intervalUnspecifiedTimeIntervals.get(e);if(!t){const n=e.compositeIntervalCode;t=this.weekUnspecifiedTimeIntervalsByKey.get(n),t||(t=this.unspecifiedTimeInterval.copy(),this.intervalUnspecifiedTimeIntervals.set(e,t),this.weekUnspecifiedTimeIntervalsByKey.set(n,t),Object.assign(t,{mainInterval:e,calendar:this.unspecifiedTimeInterval.calendar,name:e.name,cls:e.cls,startDate:e.startDate,endDate:e.endDate,prioritySortValue:e.getPrioritySortValue()-1}))}return t}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){var t;const n=null===(t=this.calendar.project)||void 0===t?void 0:t.timeZone,r=this.intervalCache;for(let t of this.intervalStore){const i=t.isStatic(),s=t.type===e.CalendarIntervalType.Week;if(i||s){s&&(t=this.getUnspecifiedTimeIntervalForWeek(t));let{startDate:e,endDate:i}=t;null!=n&&(e=Sh.toTimeZone(e,n),i=Sh.toTimeZone(i,n)),r.addInterval(e||eE,i||tE,(e=>e.includeInterval(t)))}}}}class mE extends(Ew([JD],(e=>{class t extends e{getCalendar(){return this.calendar}getMainInterval(){return this.mainInterval}getPrioritySortValue(){return null!=this.prioritySortValue?this.prioritySortValue:this.prioritySortValue=this.getCalendar().getDepth()}}return t.$name="UnspecifiedTimeIntervalModel",t}))){}class pE extends(Ew([Mw],(t=>{const n=t.prototype;return class extends t{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls",{name:"treatInconsistentIntervals",persist:!1}]}get intervalStoreClass(){return QD}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this,e.syncDataOnLoad=!0}processIntervalsStoreData(e){this.bumpVersion()}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,n){var r;const i=e.maxRange??(null===(r=this.getProject())||void 0===r?void 0:r.maxCalendarRange);return i&&(e={...e,maxRange:i}),this.calendarCache.forEachAvailabilityInterval(e,t,n)}accumulateWorkingTime(e,t,n){var r;if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let i=e;const s=(null===(r=this.getProject())||void 0===r?void 0:r.adjustDurationToDST)??this.adjustDurationToDST??!1;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,r,o)=>{let a=!0;if(o.getIsWorking()){let o=r.getTime()-e.getTime();if(t<=o){if(s){const i=n?e.getTimezoneOffset()-new Date(e.getTime()+t).getTimezoneOffset():new Date(r.getTime()-t).getTimezoneOffset()-r.getTimezoneOffset();t-=60*i*1e3}i=n?new Date(e.getTime()+t):new Date(r.getTime()-t),t=0,a=!1}else{if(s){o+=60*(e.getTimezoneOffset()-r.getTimezoneOffset())*1e3}i=n?r:e,t-=o}}return a})),{finalDate:new Date(i),remainingDurationInMs:t}}calculateDurationMs(e,t,n=!1){var r;let i=0;const s=e.getTime()<=t.getTime()||!n?1:-1;s<0&&([e,t]=[t,e]);const o=(null===(r=this.getProject())||void 0===r?void 0:r.adjustDurationToDST)??this.adjustDurationToDST??!1;return this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,n)=>{if(n.getIsWorking()&&(i+=t.getTime()-e.getTime(),o)){const n=e.getTimezoneOffset()-t.getTimezoneOffset();i+=60*n*1e3}})),i*s}calculateEndDate(e,t){const n=t>=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}calculateStartDate(e,t){const n=t<=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}skipNonWorkingTime(t,n=!0){let r;const i=this.forEachAvailabilityInterval(n?{startDate:t,isForward:!0}:{endDate:t,isForward:!1},((e,t,i)=>{if(i.getIsWorking())return r=n?e:t,!1}));return i===e.CalendarIteratorResult.MaxRangeReached||i===e.CalendarIteratorResult.FullRangeIterated?"empty_calendar":r?new Date(r):new Date(t)}addInterval(e){return this.addIntervals([e])[0]}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(void 0!==this.$calendarCache)return this.$calendarCache;const e=new mE({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new gE({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,treatInconsistentIntervals:this.treatInconsistentIntervals,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse((e=>{for(const t of e.intervalStore)t.resetPriority()}))}insertChild(e,t,r){let i=n.insertChild.call(this,...arguments);return Array.isArray(i)||(i=[i]),i.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),i}joinProject(){n.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){n.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(t){const n=xi.clearTime(t),r=xi.getNext(t,e.TimeUnit.Day);let i=!1;return this.forEachAvailabilityInterval({startDate:n,endDate:r,isForward:!0},((e,t,n)=>(i=n.getIsWorking(),!i))),!i}getDayIntervals(t){const n=xi.clearTime(t),r=xi.getNext(t,e.TimeUnit.Day);let i=[];return this.forEachAvailabilityInterval({startDate:n,endDate:r,isForward:!0},((e,t,n)=>i.push([e,t,n.intervals[0]]))),i}getDailyHolidaysRanges(t,n){const r=[];for(t=xi.clearTime(t);t<n;)this.isDayHoliday(t)&&r.push({startDate:t,endDate:xi.getStartOfNextDay(t,!0,!0)}),t=xi.getNext(t,e.TimeUnit.Day);return r}getWorkingTimeRanges(e,t,n){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0,maxRange:n},((e,t,n)=>{if(n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,startDate:e,endDate:t})}})),r}getNonWorkingTimeRanges(e,t,n){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0,maxRange:n},((e,t,n)=>{if(!n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,type:i.type,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})}})),r}isWorkingTime(t,n,r){if(r){let r;const i=this.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0},((e,i,s)=>{if(s.getIsWorking()&&e<=t&&i>=n)return r=!0,!1}));return i!==e.CalendarIteratorResult.MaxRangeReached&&i!==e.CalendarIteratorResult.FullRangeIterated&&r}{const e=this.skipNonWorkingTime(t);return!(!e||"empty_calendar"===e)&&(n?e<n:e.getTime()===t.getTime())}}}}))){}class fE extends(Ew([pE,kw],(e=>{e.prototype;return class extends e{}}))){}class vE extends(Ew([Tw],(e=>class extends e{doDestroy(){var e;const t=[];this.isChained||null!==(e=this.rootNode)&&void 0!==e&&e.isDestroyed||this.traverse((e=>t.push(e))),super.doDestroy(),t.forEach((e=>e.destroy()))}}))){}class yE extends(Ew([vE,Lw],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:fE}}}}))){}class bE extends(Ew([],lt)){}class CE extends(Ew([],Hi)){}class wE extends(Ew([bE,CE,_s],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const n=!("silenceInitialCommit"in e)||e.silenceInitialCommit,r="adjustDurationToDST"in e&&e.adjustDurationToDST;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,t.construct.call(this,e),this.silenceInitialCommit=n,this.adjustDurationToDST=r}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,t,n){t(...n)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}}))){}class SE extends(Ew([],Hi)){}class DE extends(Ew([wE,Rw,SE,_s],(e=>{const t=e.prototype;class n extends e{static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"}]}static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:AS,assignmentModelClass:US,resourceModelClass:Fw,dependencyModelClass:iD,calendarModelClass:fE,eventStoreClass:_S,assignmentStoreClass:QS,resourceStoreClass:$w,dependencyStoreClass:cD,calendarManagerStoreClass:yE,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){const n=this;if(n.$invalidated=new Set,n.$leaving=new Set,n.isPerformingCommit=!1,n.silenceInitialCommit=!0,n.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){var r;const t=e.eventStore.masterStore||e.eventStore,i=t.assignmentStore||(null===(r=t.crudManager)||void 0===r?void 0:r.assignmentStore);null!=i&&i.isAssignmentStore&&(e.assignmentStore=i,n.isSharingAssignmentStore=!0)}t.construct.call(n,e),n.defaultCalendar=new n.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:n.unspecifiedTimeIsWorking}),n.defaultCalendar.project=n;const{calendarsData:i,eventsData:s,dependenciesData:o,resourcesData:a,assignmentsData:l}=n;Boolean(i||s||o||a||l)?(n.loadInlineData({calendarsData:i,eventsData:s,dependenciesData:o,resourcesData:a,assignmentsData:l}),delete n.calendarsData,delete n.eventsData,delete n.dependenciesData,delete n.resourcesData,delete n.assignmentsData):n.bufferedCommitAsync()}doDestroy(){var e,n,r,i,s,o;const a=this;null===(e=a.eventStore)||void 0===e||e.destroy(),null===(n=a.dependencyStore)||void 0===n||n.destroy(),null===(r=a.assignmentStore)||void 0===r||r.destroy(),null===(i=a.resourceStore)||void 0===i||i.destroy(),null===(s=a.calendarManagerStore)||void 0===s||s.destroy(),a.defaultCalendar.destroy(),null===(o=a.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}async loadInlineData(e){const t=this;t.isLoadingInlineData=!0,e.calendarsData&&(t.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(t.resourceStore.data=e.resourcesData),e.assignmentsData&&(t.assignmentStore.data=e.assignmentsData),e.eventsData&&(t.eventStore.data=e.eventsData),e.tasksData&&(t.eventStore.data=e.tasksData),e.dependenciesData&&(t.dependencyStore.data=e.dependenciesData),await t.commitLoad(),t.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}resolveStoreAndModelClass(e,t){const n=(null==t?void 0:t.storeClass)||this[`${e}StoreClass`];let r=null==t?void 0:t.modelClass;return r||(r=this.getDefaultConfiguration()[`${e}ModelClass`]!==n.getDefaultConfiguration().modelClass?n.getDefaultConfiguration().modelClass:this[`${e}ModelClass`]),{storeClass:n,modelClass:r}}setEventStore(e){this.eventStore=e}changeEventStore(e,t){const n=this,{stm:r}=n;if(n.detachStore(t),e instanceof Il)e.project=n,r.addStore(e),e.joinRecordsToProject(n);else{const{storeClass:t,modelClass:i}=n.resolveStoreAndModelClass("event",e);e=new t(W.assign({modelClass:i,project:n,stm:r},e))}if(t&&r.hasStore(t)){r.removeStore(t),t.unjoinRecordsFromProject(n);const{assignmentsForRemoval:i}=t;i.forEach((t=>{const n=t.event;if(n){const r=e.getById(n.id);r&&(t.event=r,i.delete(t))}})),t.afterEventRemoval()}return e.setProject(n),e}updateEventStore(e,t){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}setAssignmentStore(e){this.assignmentStore=e}changeAssignmentStore(e,t){const n=this,{stm:r}=n;if(n.detachStore(t),t&&r.hasStore(t)&&(r.removeStore(t),t.unjoinRecordsFromProject(n)),e instanceof Il)e.project=n,r.addStore(e),e.joinRecordsToProject(n);else{const{storeClass:t,modelClass:i}=n.resolveStoreAndModelClass("assignment",e);e=new t(W.assign({modelClass:i,project:n,stm:r},e))}return e.setProject(n),e}updateAssignmentStore(e,t){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}setResourceStore(e){this.resourceStore=e}changeResourceStore(e,t){const n=this,{stm:r}=n;if(n.detachStore(t),e instanceof Il)e.project=n,r.addStore(e),e.joinRecordsToProject(n);else{const{storeClass:t,modelClass:i}=n.resolveStoreAndModelClass("resource",e);e=new t(W.assign({modelClass:i,project:n,stm:r},e))}if(t&&r.hasStore(t)){r.removeStore(t),t.unjoinRecordsFromProject(n);const{assignmentsForRemoval:i}=t;i.forEach((t=>{const n=t.resource;if(n){const r=e.getById(n.id);r&&(t.resource=r,i.delete(t))}})),t.afterResourceRemoval()}return e.setProject(n),e}updateResourceStore(e,t){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}setDependencyStore(e){this.dependencyStore=e}changeDependencyStore(e,t){const n=this;if(n.detachStore(t),e instanceof Il)e.project=n,n.stm.addStore(e),e.joinRecordsToProject(n);else{const{storeClass:t,modelClass:r}=n.resolveStoreAndModelClass("dependency",e);e=new t(W.assign({modelClass:r,project:n,stm:n.stm},e))}return e}updateDependencyStore(e,t){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}setCalendarManagerStore(e){this.calendarManagerStore=e}changeCalendarManagerStore(e,t){const n=this;if(n.detachStore(t),e instanceof Il)n.stm.addStore(e);else{var r,i;const t=(null===(r=e)||void 0===r?void 0:r.storeClass)||n.calendarManagerStoreClass,s=(null===(i=e)||void 0===i?void 0:i.modelClass)||t.getDefaultConfiguration().modelClass||n.calendarModelClass;e=new t(W.assign({modelClass:s,project:n,stm:n.stm},e))}return e.setProject(n),e}updateCalendarManagerStore(e,t){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:()=>{var e;return null===(e=this.commitAsync)||void 0===e?void 0:e.call(this)},name:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:(this.trigger("beforeCommit"),this.ongoing=this.doCommitAsync())}async doCommitAsync(){const e=this;if(e.$invalidated.size||e.$leaving.size||e.hasLoadedDataToCommit||e.isInitialCommit){if(e.$leaving.clear(),e.isPerformingCommit=!0,await XS(0),!e.isDestroyed){e.unScheduleAutoCommit();for(const t of e.$invalidated)t.calculateInvalidated();const{isInitialCommit:t,silenceInitialCommit:n}=e,r=t&&n;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const i=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(i.forEach((e=>{var t,n;null===(t=e.suspendAutoCommit)||void 0===t||t.call(e),null===(n=e.suspendSortOnUpdate)||void 0===n||n.call(e)})),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:t,isCalculated:!0}),r)for(const t of e.$invalidated)t.finalizeInvalidated(!0);else{for(const t of e.$invalidated)t.beginBatch(!0),t.finalizeInvalidated();for(const t of e.$invalidated)t.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),i.forEach((e=>{var t,n;null===(t=e.resumeAutoCommit)||void 0===t||t.call(e),null===(n=e.resumeSortOnUpdate)||void 0===n||n.call(e)})),e.trigger("commitFinalized"),!0}}else e.trigger("commitFinalized")}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new yl(W.assign({disabled:!0},e))).ion({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return n.$name="SchedulerCoreProjectMixin",n.applyConfigs=!0,n}))){}const EE=DE;class xE extends(PD(LD(EE))){static $name="ProjectModel";static get defaultConfig(){return{eventModelClass:PS,dependencyModelClass:oD,resourceModelClass:Aw,assignmentModelClass:YS,eventStoreClass:VS,dependencyStoreClass:hD,resourceStoreClass:Hw,assignmentStoreClass:tD}}construct(...e){super.construct(...e),G.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new OD({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}xE.applyConfigs=!0,xE.initClass(),xE._$name="ProjectModel";class RE extends(xD.mixin(SD,CD,wD,ED)){static $name="CrudManager";static get defaultConfig(){return{projectClass:xE,resourceStoreClass:Hw,eventStoreClass:VS,assignmentStoreClass:tD,dependencyStoreClass:hD,resourceTimeRangeStoreClass:MD,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null,resourceTimeRangeStore:{}}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return W.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const t=this;e!==t._project&&(t.detachListeners("beforeDataReady"),t.detachListeners("afterDataReady"),t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:()=>t.suspendChangeTracking(),prio:100,thisObj:t}),e.ion({name:"afterDataReady",dataReady:()=>t.resumeChangeTracking(),prio:-100,thisObj:t})),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}),t.resourceTimeRangeStore||(t.resourceTimeRangeStore={}))}get project(){return this._project}get timeRangeStore(){var e;return null===(e=this._timeRangeStore)||void 0===e?void 0:e.store}set timeRangeStore(e){var t;this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return null===(e=this._resourceTimeRangeStore)||void 0===e?void 0:e.store}set resourceTimeRangeStore(e){this.setFeaturedStore("_resourceTimeRangeStore",e,this.resourceTimeRangeStoreClass)}get resourceStore(){var e;return null===(e=this._resourceStore)||void 0===e?void 0:e.store}set resourceStore(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}get eventStore(){var e;return null===(e=this._eventStore)||void 0===e?void 0:e.store}set eventStore(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}get assignmentStore(){var e;return null===(e=this._assignmentStore)||void 0===e?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return null===(e=this._dependencyStore)||void 0===e?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,n){var r;const i=this,s=null===(r=i[e])||void 0===r?void 0:r.store;var o;s!==t&&(t=Il.getStore(t,(null===(o=t)||void 0===o?void 0:o.storeClass)||n),s&&i.removeStore(s),i[e]=t&&{store:t}||null,i.addPrioritizedStore(i[e]));return i[e]}getChangesetPackage(){var e;const t=this,n=super.getChangesetPackage();return n&&(t.eventStore.usesSingleAssignment||null!==(e=t.eventStore.modelClass.fieldMap)&&void 0!==e&&null!==(e=e.resourceIds)&&void 0!==e&&e.persist)&&(delete n[t.assignmentStore.id],!t.forceSync&&!t.crudStores.some((e=>n[e.storeId])))?null:n}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}}RE._$name="CrudManager";const TE=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],ME=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"];var kE=e=>class extends e{static $name="CurrentConfig";preProcessCurrentConfigs(e){for(const t of ME)delete e[t];super.preProcessCurrentConfigs(e)}getCurrentConfig(e){var t,n;const r=null===(t=(n=this.project).getCurrentConfig)||void 0===t?void 0:t.call(n,e),i=super.getCurrentConfig(e);if(r){i.project=r;const{crudManager:e}=i;if(e)for(const t of TE)e[t]&&(r[t]=e[t]);0===Object.keys(r).length&&delete i.project}return delete i.data,delete i.store,delete i.eventStore,delete i.resourceStore,delete i.crudManager,i}get widgetClass(){}};const FE=e=>!e||Array.isArray(e)?e:[e],IE=(e,t,n)=>e&&!0!==e[t]?e[t]:n;var AE=e=>class extends(e||Qe){static $name="Describable";static configurable={dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null};get dateBounds(){return[this.date]}get description(){const e=this,{descriptionRenderer:t}=e;return t?e.callback(t,e,[e]):e.formattedDescription}get formattedDescription(){var e;if(1===(null===(e=this.range)||void 0===e?void 0:e.magnitude)&&"day"!==this.range.unit)return this.rangeDescription;{const e=this,{dateBounds:t,dateFormat:n}=e,r=e.descriptionFormat??FE(e.defaultDescriptionFormat),i=IE(r,0,n),s=t.length>1&&(null==r?void 0:r.length)>1&&xi.format(t[0],i)!==xi.format(t[1],i);let o=xi.format(t[0],i);return s&&(o=xi.formatRange(t,IE(r,1,`S${n}${e.dateSeparator}E${n}`))),o}}get rangeDescription(){const e=this,{date:t,startDate:n,endDate:r,range:i}=e,s=e.month||(e.month=new kg({date:t}));let o;switch(i.unit){case"day":o=xi.format(t,"L");break;case"week":{const t=n.getMonth()===r.getMonth()?xi.format(n,"MMMM"):`${xi.format(n,"MMM")} - ${xi.format(r,"MMM")}`,i=s.getWeekNumber(n);o=`${e.L("L{Object.Week}")} ${i[1]}, ${t} ${i[0]}`;break}case"month":o=xi.format(t,"MMMM, YYYY");break;case"year":o=xi.format(t,"YYYY");break;case"decade":o=`${xi.format(n,"DC")}`}return o}changeDescriptionFormat(e){return FE(e)}get widgetClass(){}},LE=e=>class extends(e||Qe){static $name="SchedulerDom";getElementFromAssignmentRecord(e,t=!1,n=!1,r=!1){const i=this;if(i.isPainted&&e){var s,o;const{foregroundCanvas:h}=i;let g=null===(s=h.syncIdMap)||void 0===s?void 0:s[e.id];if(!g){var a,l;const t=r&&((null===(a=i.subViews)||void 0===a?void 0:a[0])||i.splitFrom);if(t&&(g=t.getElementFromAssignmentRecord(e,!0,n)),!g&&null!==(l=e.resource)&&void 0!==l&&l.hasLinks)for(const t of e.resource.$links){var d,c;if(g=null===(d=h.syncIdMap)||void 0===d?void 0:d[`${e.id}_${t.id}`],g)break;if(n&&(g=null===(c=h.releasedIdMap)||void 0===c?void 0:c[`${e.id}_${t.id}`],g))break}}var u;if(!g&&n)g=null===(u=h.releasedIdMap)||void 0===u?void 0:u[e.id];return t?g:null===(o=g)||void 0===o||null===(o=o.syncIdMap)||void 0===o?void 0:o.event}return null}getElementFromEventRecord(e,t=(t=>null===(t=e.resources)||void 0===t?void 0:t[0])(),n=!1,r=!1){if(e.isResourceTimeRange){var i;const t=null===(i=this.foregroundCanvas.syncIdMap)||void 0===i?void 0:i[e.domId];return n?t:null==t?void 0:t.syncIdMap.event}const s=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(s,n,r)}getElementsFromEventRecord(e,t,n=!1,r=!1){return t?[this.getElementFromEventRecord(e,t,n,r)]:e.resources.reduce(((t,i)=>{const s=this.getElementFromEventRecord(e,i,n,r);return s&&t.push(s),t}),[])}resolveResourceRecord(e,t){var n;const r=null===(n=(e instanceof Event?e.target:e).dataset)||void 0===n?void 0:n.resourceId,i=r&&this.resourceStore.getById(r)||this.currentOrientation.resolveRowRecord(e,t);return null!=i&&i.isSpecialRow?null:i}resolveRowRecord(e){return this.resolveResourceRecord(e)}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const n=null===(t=e)||void 0===t?void 0:t.closest(this.eventSelector);if(n){if("eventId"in n.dataset)return this.eventStore.getById(n.dataset.eventId);if("assignmentId"in n.dataset)return this.assignmentStore.getById(n.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e,t=!1){const n=e.closest(t?"[data-assignment-id][data-event-id]":this.eventSelector),r=n&&this.assignmentStore.getById(n.dataset.assignmentId),i=n&&this.eventStore.getById(n.dataset.eventId);return this.assignmentStore.getOccurrence(r,i)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}isEventElement(e){const t=null==e?void 0:e.className;return Boolean(null==t?void 0:t[this.eventCls+"-wrap"])}},PE=e=>class extends(e||Qe){static $name="SchedulerDomEvents";getTimeSpanMouseEventParams(e,t){const n=this.resolveEventRecord(e);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){const n=this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id);return n?{resourceRecord:n}:null}onElementKeyDown(e){const t=super.onElementKeyDown(e),n=this;return n.selectedEvents.length&&e.target.closest(".b-sch-event-wrap")&&n.trigger(n.scheduledEventName+"KeyDown",{eventRecords:n.selectedEvents,assignmentRecords:n.selectedAssignments,event:e}),t}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e})}get widgetClass(){}};class OE extends Qe{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,t){return this.nbrOfBandsByResource[t.id]=this.layoutEventsInBands(e,t)}layoutEventsInBands(e,t){throw new Error("Implement in subclass")}}OE._$name="HorizontalLayout";class $E extends OE{static $name="HorizontalLayoutStack";static get configurable(){return{type:"stack"}}layoutEventsInBands(e,t,n=!1){let r=0;do{let t=0,i=e[0];for(;i;)n||(i.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,r,i.eventRecord,i.resourceRecord)),e.splice(t,1),t=this.findClosestSuccessor(i,e),i=e[t];r++}while(e.length>0);return r}findClosestSuccessor(e,t){var n;const{endMS:r,group:i}=e,s=0===(null===(n=e.eventRecord)||void 0===n?void 0:n.duration);let o,a,l,d,c=1/0;for(let e=0,n=t.length;e<n;e++){var u;if(l=t[e],a=l.startMS-r,d=l.endMS-l.startMS==0&&!(null!==(u=l.eventRecord)&&void 0!==u&&u.meta.isDragCreating),a>=0&&a<c&&(a>0||!d||!s)){if(this.grouped&&i!==l.group)break;o=e,c=a}}return o}}$E._$name="HorizontalLayoutStack";const _E=(e,t,n,r)=>n<=e&&e<r||e<=n&&n<t;var HE=e=>class extends(e||Qe){static $name="PackMixin";static configurable={coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"};isSameGroup(e,t){return!this.grouped||e.group===t.group}packEventsInBands(e,t){const n=this,{coordProp:r,sizeProp:i}=n;let s,o,a,l;for(let d=0,c=e.length;d<c;d++){if(o=e[d],s=n.findStartSlot(e,o),a=n.getCluster(e,d),a.length>1){for(o[r]=s.start,o[i]=s.end-s.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=n.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const c=a.length,u=(s.end-s.start)/c;for(l=0;l<c;l++)t(a[l],l,s,u);d+=c-1}return 1}findStartSlot(e,t){const{inBandSizeProp:n,inBandCoordProp:r,coordProp:i,sizeProp:s}=this,o=this.getPriorOverlappingEvents(e,t);let a;if(0===o.length)return{start:0,end:1};for(a=0;a<o.length;a++){const e=o[a],t=r in e?r:i,l=n in e?n:s;if(0===a&&e[t]>0)return{start:0,end:e[t]};if(e[t]+e[l]<(a<o.length-1?o[a+1][t]:1))return{start:e[t]+e[l],end:a<o.length-1?o[a+1][t]:1}}return!1}getPriorOverlappingEvents(e,t){const{startMS:n,endMS:r}=t,i=[];for(let s=0,o=e.indexOf(t);s<o;s++){const o=e[s];this.isSameGroup(o,t)&&_E(n,r,o.startMS,o.endMS)&&i.push(o)}return i.sort(this.sortOverlappers.bind(this)),i}sortOverlappers(e,t){const{coordProp:n}=this;return e[n]-t[n]}getCluster(e,t){const n=e[t],r=[n];if(t>=e.length-1)return r;let{startMS:i,endMS:s}=n;for(let o=t+1,a=e.length;o<a;o++){const t=e[o];if(!this.isSameGroup(t,n)||!_E(i,s,t.startMS,t.endMS))break;r.push(t),i=Math.max(i,t.startMS),s=Math.min(t.endMS,s)}return r}};class VE extends(OE.mixin(HE)){static $name="HorizontalLayoutPack";static configurable={type:"pack"};layoutEventsInBands(e){const t=this.packEventsInBands(e,((e,t,n,r)=>{e.height=r,e.top=n.start+t*r}));return e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))})),t}}VE._$name="HorizontalLayoutPack";var NE=e=>class extends(e||Qe){static $name="SchedulerResourceRendering";static configurable={resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"};get resourceColumns(){var e;return(null===(e=this.timeAxisColumn)||void 0===e?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var e;return(null===(e=this.resourceColumns)||void 0===e?void 0:e.columnWidth)||null}getResourceMarginObject(e){if(null!=e&&e.resourceMargin){const t=(null==e?void 0:e.resourceMargin)??this.resourceMargin;return"number"==typeof t?{start:t,end:t,total:2*t}:(t.total=t.start+t.end,t)}return this.resourceMarginObject}getBarMargin(e){return(null==e?void 0:e.barMargin)??this.barMargin}getResourceHeight(e){return e.rowHeight??(this.isHorizontal?this.rowHeight:this.getResourceWidth(e))}getResourceWidth(e){return e.instanceMeta(this).columnWidth??this.resourceColumnWidth}getAppliedResourceHeight(e){const t=this.getRowById(e);return(null==t?void 0:t.maxRequestedHeight)??this.getResourceHeight(e)}getResourceLayoutSettings(e,t=null){const n=this.getResourceMarginObject(e,t),r=this.getAppliedResourceHeight(e,t);return{barMargin:this.getBarMargin(e,t),contentHeight:Math.max(r-n.total,1),rowHeight:r,resourceMarginObject:n}}get widgetClass(){}},BE=e=>class extends(NE(e||Qe)){static $name="SchedulerEventRendering";static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",horizontalLayoutPackClass:VE,horizontalLayoutStackClass:$E,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,eventReleaseThreshold:null,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move",testConfig:{useInitialAnimation:!1}}}changeEventLayout(e){return!this.isConfiguring||"vertical"!==this.mode||"stack"!==e&&"stack"!==e.type||(e="pack"),this.internalEventLayout=e,this.internalEventLayout.type}changeInternalEventLayout(e){return this.getEventLayout(e)}updateInternalEventLayout(e,t){const n=this;t&&n.element.classList.remove(`b-eventlayout-${t.type}`),n.element.classList.add(`b-eventlayout-${e.type}`),"layoutFn"===e.type&&n.isVertical&&(n.resourceColumns.fitWidth=n.resourceColumns.fillWidth=!1),n.isConfiguring||(n.refreshWithTransition(),n.trigger("stateChange"))}updateOverlappingEventSorter(e){this.isConfiguring||this.refreshWithTransition()}updateEventReleaseThreshold(){this.isConfiguring||this.refresh()}getEventLayout(e){var t;return null!==(t=e)&&void 0!==t&&t.isModel&&(e=e.eventLayout||this.internalEventLayout),"string"==typeof e&&(e={type:e}),e}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:n,horizontal:r}=t,{type:i}=e;switch(t.layouts||(t.layouts={}),i){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass(W.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass(W.assign({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r},e))),t.layouts.horizontalPack;default:return null}}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach((e=>this.repaintEventsForResource(e)))}getEventStyle(e,t){return e.eventStyle||t.eventStyle||this.eventStyle}getEventColor(e,t){var n,r;return e.eventColor||(null===(n=e.event)||void 0===n?void 0:n.eventColor)||(null===(r=e.parent)||void 0===r?void 0:r.eventColor)||t.eventColor||this.eventColor}generateRenderData(e,t,n={viewport:!0}){const r=this,i=r.currentOrientation.getTimeSpanRenderData(e,t,n),{isEvent:s}=e,{eventResize:o}=r.features,a=!e.meta.isDragCreating&&e.isMilestone,l=s&&e.assignments.find((e=>e.resourceId===t.$originalId)),d={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(i){var c;Object.assign(i,{isWrap:!0,wrapperStyle:"",tabIndex:"0",eventGeneration:e.generation,resourceGeneration:t.generation,assignmentGeneration:null==l?void 0:l.generation});let n=e.isResizable;o&&n&&(i.startsOutsideView&&(!0===n?n="end":"start"===n&&(n=!1)),i.endsOutsideView&&(!0===n?n="start":"end"===n&&(n=!1)),n&&(r.isHorizontal?!r.rtl&&!o.leftHandle||r.rtl&&!o.rightHandle?n="start"!==n&&"end":(!r.rtl&&!o.rightHandle||r.rtl&&!o.leftHandle)&&(n="end"!==n&&"start"):o.topHandle?o.bottomHandle||(n="end"!==n&&"start"):n="start"!==n&&"end"));const h=Boolean(e.hasPersistableChanges||(null==l?void 0:l.hasPersistableChanges)),g={[t.cls]:t.cls,[r.generatedIdCls]:!e.isOccurrence&&e.hasGeneratedId,[r.dirtyCls]:h,[r.committingCls]:e.isCommitting,[r.endsOutsideViewCls]:i.endsOutsideView,[r.startsOutsideViewCls]:i.startsOutsideView,"b-clipped-start":i.clippedStart,"b-clipped-end":i.clippedEnd,"b-iscreating":e.isCreating,"b-rtl":r.rtl},m={[`${r.eventCls}-parent`]:t.isParent,"b-readonly":e.readOnly||(null==l?void 0:l.readOnly),"b-linked-resource":t.isLinked,"b-original-resource":t.hasLinks},p=e.isResourceTimeRange?new Vt:e.internalCls.clone(),f=e.isResourceTimeRange?e.internalCls.clone():new Vt;if(s){const s=l&&r.isAssignmentSelected(l);W.assign(g,{[r.eventCls]:1,"b-milestone":a,"b-sch-event-narrow":!a&&i.width<r.narrowEventWidth,[r.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${n}`]:Boolean(o&&!e.readOnly),[r.eventSelectedCls]:s,[r.eventAssignHighlightCls]:r.eventAssignHighlightCls&&!s&&r.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence,"b-inactive":e.inactive}),i.eventId=e.id;const d=r.getEventStyle(e,t),c=r.getEventColor(e,t),u=r.isFirstRender&&r.useInitialAnimation&&!0!==globalThis.bryntum.noAnimations;if(W.assign(m,{[`${r.eventCls}-wrap`]:1,"b-milestone-wrap":a,[r.navigator.focusCls]:e.assignments.some((e=>e===r.activeAssignment))}),u){const e=(i.row?i.row.index:(i.top-r.scrollTop)/r.tickSize)/20*1e3;i.wrapperStyle=`animation-delay: ${e}ms;`,r.maxDelay=Math.max(r.maxDelay||0,e),r.initialAnimationDetacher||(r.initialAnimationDetacher=Jt.on({element:r.foregroundCanvas,delegate:r.eventSelector,once:!0,animationend:()=>r.setTimeout({fn:"stopInitialAnimation",delay:r.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:r.initialAnimationDuration+r.maxDelay},thisObj:r}))}i.eventColor=c,i.eventStyle=d,i.assignmentRecord=i.assignment=l}if(i.wrapperCls=W.assign(f,m),i.cls=W.assign(p,g),i.iconCls=new Vt(e.getValue(r.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(i.style="",i.wrapperStyle+=e.style||""):i.style=e.style||"",i.resource=i.resourceRecord=t,i.resourceId=i.rowId,s){var u;let n,s=null,o=null;if(r.eventRenderer){const s=r.eventRenderer.call(r.eventRendererThisObj||r,{eventRecord:e,resourceRecord:t,assignmentRecord:i.assignmentRecord,scheduler:r,renderData:i});i.ariaLabel&&(i.ariaLabelFromEventRenderer=!0),"string"==typeof i.cls&&(i.cls=new Vt(i.cls)),"string"==typeof i.wrapperCls&&(i.wrapperCls=new Vt(i.wrapperCls)),"string"==typeof i.iconCls&&(i.iconCls=new Vt(i.iconCls)),n=s}else r.eventBarTextField&&(n=N.encodeHtml(e.getValue(r.eventBarTextField)||""));d.children=[],!a||"default"!==r.milestoneLayoutMode&&"always-outside"!==r.milestoneTextPosition||null==n||""===n||d.children.unshift(o={tag:"label",children:[],dataset:{isMilestone:!0}}),null!==(u=i.iconCls)&&void 0!==u&&u.length&&d.children.unshift({tag:"i",className:i.iconCls}),Array.isArray(n)?(o||d).children.push(...n):N.isHtml(n)?d.children.length?s={tag:"span",class:"b-event-text-wrap",html:n}:(d.children=null,d.html=n):"string"==typeof n||"object"==typeof n?s=n:null!=n&&(s=String(n)),null!=s&&((o||d).children.push(s),i.cls.add("b-has-content")),(null!=d.html||d.children.length)&&i.children.push(d),i.cls.toggle("b-highlighted",Boolean(null==l?void 0:l.instanceMeta(r).isHighlighted))}const{eventStyle:v,eventColor:y,wrapperCls:b}=i;if(b[`b-sch-style-${v||"none"}`]=1,Yn.isNamedColor(y))b[`b-sch-color-${y}`]=y;else if(y){const e=`${v?"color":"background-color"}:${y};`;i.style=e+i.style,b["b-sch-custom-color"]=1,i._customColorStyle=e}else b["b-sch-color-none"]=1;if(i.style&&a&&d&&(d.style=i.style,delete i.style),i.cls["b-sch-event-withicon"]=null===(c=i.iconCls)||void 0===c?void 0:c.length,i.eventContent=d,i.wrapperChildren=[],!i.ariaLabelFromEventRenderer){const t=xi.format(e.startDate,this.displayDateFormat);i.ariaLabel=r.L("L{SchedulerBase.eventAriaLabel}")(e,t)}r.onEventDataGenerated(i)}return i}onEventDataGenerated(e){}changeUseInitialAnimation(e){return!0===e?"fade-in":e}updateUseInitialAnimation(e,t){const{classList:n}=this.element;t&&n.remove(`b-initial-${t}`),e&&(n.add(`b-initial-${e}`),c.isFirefox&&n.add("b-prevent-event-transitions"))}restartInitialAnimation(e){var t;const n=this;null===(t=n.initialAnimationDetacher)||void 0===t||t.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=e,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,c.isFirefox&&e.setTimeout((()=>e.element.classList.remove("b-prevent-event-transitions")),100)}getMilestoneLabelWidth(e,t){const n=this,r=n.milestoneLayoutMode,i=n.getResourceLayoutSettings(t).contentHeight;if("measure"===r){const r=N.encodeHtml(e.name),s=n.getEventColor(e,t),o=n.getEventStyle(e,t),a=n.milestoneMeasureElement||(n.milestoneMeasureElement=Yn.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${s}`]:s,[`b-sch-style-${o}`]:o},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:n.foregroundCanvas}));if(a.retainElement=!0,a.style.fontSize=`${i}px`,"always-outside"===n.milestoneTextPosition){const e=a.firstElementChild.firstElementChild.firstElementChild;e.innerHTML=r;const t=Ot.from(e,e.parentElement);return t.left+t.width+2}return a.firstElementChild.firstElementChild.innerHTML=`<label></label>${r}`,a.firstElementChild.offsetWidth}return"estimate"===r?e.name.length*n.milestoneCharWidth+("always-outside"===n.milestoneTextPosition?i:0):"data"===r?e.milestoneWidth+("always-outside"===n.milestoneTextPosition?i:0):0}updateMilestoneLayoutMode(e){const t=this,n="always-outside"===t.milestoneTextPosition;t.element.classList.toggle("b-sch-layout-milestones","default"!==e&&!n),t.element.classList.toggle("b-sch-layout-milestone-labels","default"!==e&&n),t.isConfiguring||t.refreshWithTransition()}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside","inside"===e),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}};const zE=["assignmentStore","dependencyStore","eventStore","resourceStore"];var jE=e=>class extends(e||Qe){static $name="ProjectConsumer";static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:xE,project:{},destroyStores:null,projectSubscribers:[]}}#n;startConfigure(e){this.getConfig("project"),super.startConfigure(e)}changeProject(e,t){const n=this,{projectDataNames:r}=n.constructor;if(n.projectCallbacks=new Set,e){if(n.buildingProjectConfig=!0,!e.isModel){if(n.isConfiguring){n._project=e;const{crudManager:t}=n;t&&this.updateStoresFromCrudManager(),n.getConfig("projectStores");for(const e of r)n.getConfig(e)}const{eventStore:t}=e;let{_sharedProject:i}=n;if(null==t||!t.autoLoad||t.isEventStoreMixin||t.count||t.lazyLoad||(t.autoLoad=!1,n.delayAutoLoad=!0),i&&zE.some((t=>e[t]&&e[t]!==i[t]))){for(const t of zE)e[t]&&e[t]===i[t]&&(e[t]=e[t].chain());i=null}e=i||new n.projectModelClass(e),delete n._project}n.buildingProjectConfig=!1}return e}updateStoresFromCrudManager(){const{crudManager:e}=this,{isCrudManager:t}=e;for(const n of this.constructor.projectStoreNames)e[n]&&(this[n]=e[n],t||delete e[n])}updateProject(e,t){const n=this,{projectListeners:r,crudManager:i}=n;if(n.detachListeners("projectConsumer"),n.detachListeners("projectDestroy"),delete n._crudManager,e){var s;r.thisObj=n,e.ion(r),e.isCrudManager?n.crudManager=e:i&&(i.project=e,n.crudManager=i),n.projectSubscribers.forEach((n=>{n.detachFromProject(t),n.attachToProject(e)}));for(const t of n.constructor.projectStoreNames)n[t]=e[t];n.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load()),null===(s=e.stm)||void 0===s||s.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:n}),e.ion({name:"projectDestroy",beforeDestroy:"onProjectBeforeDestroy",thisObj:n})}n.trigger("projectChange",{project:e})}changeCrudManager(e){if(!this.buildingProjectConfig)return super.changeCrudManager(e);this._crudManager=e.isCrudManager?e:Object.assign({},e)}updateCrudManager(e){!this.isConfiguring&&e&&this.updateStoresFromCrudManager()}onProjectBeforeDestroy(e){const t=new e.source.constructor;this.project=t}onProjectDataReady(){const e=this;e.whenVisible((()=>{e.projectCallbacks.size&&(e.projectCallbacks.forEach((e=>e())),e.projectCallbacks.clear())}),null,null,"onProjectDataReady")}onProjectRestoringStart({stm:e}){const{rawQueue:t}=e;t.length&&t[t.length-1].length>1&&(this.#n=!0,this.suspendRefresh())}onProjectRestoringStop(){this.#n&&(this.#n=!1,this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:e,oldTimeZone:t}){const n=this;if(n.startDate&&n.timeAxis.timeZone!==e){const r=null!=t?Sh.fromTimeZone(n.startDate,t):n.startDate;n.startDate=null!=e?Sh.toTimeZone(r,e):r,n.timeAxis.timeZone=e}}onStartApplyChangeset(){this.suspendRefresh()}onEndApplyChangeset(){this.resumeRefresh(!0)}whenProjectReady(e){this.isEngineReady?e():this.projectCallbacks.add(e)}get isEngineReady(){var e,t;return Boolean(null===(e=(t=this.project).isEngineReady)||void 0===e?void 0:e.call(t))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:e}=this.constructor;return e.map((e=>this[e]))}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce(((e,t)=>{const{dataName:n}=this.projectStores[t];return n&&e.push(n),e}),[])}static setupProjectStores(e,t){const{projectStores:n}=e;if(n){const e={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset",startApplyingRevision:"onStartApplyChangeset",stopApplyingRevision:"onEndApplyChangeset"},r={projectListeners:e};let i;for(const s in n){const{dataName:o}=n[s];r[s]=r[o]=null,o&&(Object.defineProperty(t.class.prototype,o,{configurable:!0,get(){var e;return null===(e=this.project[s])||void 0===e?void 0:e.records}}),this.createDataUpdater(s,o,i,t)),this.createStoreDescriptor(t,s,n[s],e),i=o}this.setupConfigs(t,r)}}static createDataUpdater(e,t,n,r){r.class.prototype[`update${N.capitalize(t)}`]=function(r){const{project:i}=this;n&&this.getConfig(n),this.buildingProjectConfig?i[`${t}Data`]=r:i[e].data=r}}static createStoreDescriptor(e,t,{listeners:n},r){const{prototype:i}=e.class,s=N.capitalize(t);r[`${t}Change`]=function({store:e}){this[t]=e},i[`change${s}`]=function(e,r){var i;const o=this,{project:a}=o,l=null===(i=e)||void 0===i?void 0:i.project;return o.buildingProjectConfig?(null!=l&&l.isProjectModel&&(o._sharedProject=l),void(a[t]=e)):(o.initializingProject||a[t]!==e&&(a[`set${s}`](e),e=a[t]),e!==r&&(n&&(n.thisObj=o,n.name=`${t}Listeners`,n.startApplyChangeset="onProjectStoreStartApplyChangeset",n.endApplyChangeset="onProjectStoreEndApplyChangeset",o.detachListeners(n.name),e.ion(n)),o[`_${t}`]=e,o.projectSubscribers.forEach((t=>{var n;null===(n=t[`attachTo${s}`])||void 0===n||n.call(t,e)})),o[`_${t}`]=null),e)}}onProjectStoreStartApplyChangeset(){this.suspendRefresh()}onProjectStoreEndApplyChangeset(){this.resumeRefresh(!0)}relayProjectDataChange(e){if(!e.isExpand&&!e.isCollapse||e.records[0].fieldMap.expanded.persist)return this.trigger("dataChange",{project:e.source,...e,source:this})}get widgetClass(){}},WE=e=>class extends(jE(e||Qe)){static $name="SchedulerStores";static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!0,crudManagerClass:null,crudManager:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this}),this.bindEventStoreForEarlyPositioning(e.eventStore)}onProjectRefresh({isInitialCommit:e}){const t=this;t.isVisible?(e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(!1,!e),t.refreshAfterProjectRefresh=!1),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh,{scrollIntoView:!1}),t.navigateToAfterRefresh=null)):t.whenVisible("refresh",t,[!0])}changeCrudManager(e){const t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new Il({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}],filter:()=>!1})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t,records:n}){const r=arguments,i=this;i.runWithTransition((()=>{i.currentOrientation.suspended=!t&&!n.some((e=>e.isLinked)),i.element.classList.add("b-no-transitions"),super.refreshFromRowOnStoreAdd(e,...r),i.element.classList.remove("b-no-transitions"),i.currentOrientation.suspended=!1}),!t)}onStoreAdd(e){super.onStoreAdd(e),this.isPainted&&this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:n}){let r=0;"assigned"in n&&r++,"calendar"in n&&r++,r!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(e){var t,n;null===(t=(n=this.currentOrientation).onEventStoreIdChange)||void 0===t||t.call(n,e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){this.isPainted&&this._mode&&!e.isAssign&&!this.assignmentStore.isRemovingAssignment&&(this.isVisible?this.currentOrientation.onEventStoreChange(e):this.whenVisible(this.onInternalEventStoreChange,this,[e]))}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map((e=>this.eventStore.getResourcesForEvent(e)));t=Array.prototype.concat.apply([],t),new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>e.assignments.forEach((e=>t.toggleCls(e,n,!0)))))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach((e=>this.repaintEvent(e)))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>{t.toggleCls(e,n,!0)}))}onAssignmentException({action:e}){"commit"===e&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const t=[...e.added,...e.modified,...e.removed].map((e=>e.getResource()));new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onAssignmentBeforeRemove({records:e,removingAll:t}){if(t)return;const n=this,{activeAssignment:r}=n,i=e.includes(r);let s;if(!n.isConfiguring&&(n.navigateToAfterRefresh||r&&i)){e.includes(n.navigateToAfterRefresh)&&(n.navigateToAfterRefresh=null);const t=n.getElementFromAssignmentRecord(r,!0);if(i&&t){const e=n.timeAxisSubGrid.rectangle().intersect(n._bodyRectangle),r=Ot.from(t),i=r.center,o=n.isHorizontal?"y":"x",a=({element:e,distance:t,center:n,edgeDistance:r},{element:s,distance:a,center:l,edgeDistance:d})=>{if(e.dataset.resourceId!==s.dataset.resourceId){if(Math.abs(n[o]-i[o])<Math.abs(l[o]-i[o]))return-1;if(Math.abs(n[o]-i[o])>Math.abs(l[o]-i[o]))return 1}return Math.min(r,t)-Math.min(d,a)||l[o]-n[o]},l=Array.from(n.foregroundCanvas.querySelectorAll(n.navigator.itemSelector)).reduce(((s,o)=>{if(o!==t){const t=Ot.from(o).intersect(e),a=t&&n.resolveAssignmentRecord(o);if(a){const{center:e}=t,n=i.getDelta(e),l=e.y<i.y?r.y-t.bottom:e.y>i.y?t.y-r.bottom:0,d=e.x<i.x?r.x-t.right:e.x>i.x?t.x-r.right:0;s.push({element:o,assignment:a,center:e,distance:Math.sqrt(n[0]**2+n[1]**2),edgeDistance:Math.max(l,d)})}}return s}),[]).sort(a)[0];l&&(s=l.assignment)}s?(n.navigateTo(s,{scrollIntoView:!1}),n.navigateToAfterRefresh=s):n.focusElement.focus({preventScroll:!0})}}set timeRanges(e){this.project.timeRanges=e}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(e){this.project.resourceTimeRanges=e}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:e}){this.applyStartEndParameters(e)}getResourcesEventsPerTick(e,t){const{timeAxis:n,resourceStore:r}=this,i=[];return(e=e||r.records).forEach((e=>{e.events.forEach((r=>{if(!n.isTimeSpanInAxis(r)||t&&!t.call(this,{resource:e,event:r}))return;let s=Math.floor(n.getTickFromDate(r.startDate)),o=Math.ceil(n.getTickFromDate(r.endDate));-1==s&&(s=0),-1===o&&(o=n.ticks.length);do{i[s]?i[s].push(r):i[s]=[r]}while(++s<o)}))})),i}get widgetClass(){}};const UE={block:"nearest",edgeOffset:20};var GE=e=>class extends(e||Qe){static $name="SchedulerScroll";static configurable={scrollExtensionThreshold:null};async scrollEventIntoView(e,t=UE){const n=e.resources||[e];if(n.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");n.length?await this.scrollResourceEventIntoView(n[0],e,t):console.warn("You have asked to scroll to an event which is not assigned to a resource")}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}async scrollResourceEventIntoView(e,t,n=UE){var r;const i=this,{store:s,timeAxis:o,visibleDateRange:a,scrollExtensionThreshold:l}=i,d=o.endDate-o.startDate,c=t.startDate,u=t.endDate,h=t.isScheduled&&c.getTime(),g=t.isScheduled&&u.getTime(),m=t.isScheduled&&c<i.timeAxis.startDate|(u>i.timeAxis.endDate)<<1;!s.includes(e)&&e.$links.length&&(e=e.$links.find((e=>s.includes(e)))),await i.waitForReadiness(),i.isLockedRows&&i.syncSplits((e=>e.scrollResourceEventIntoView(...arguments)));let p,f=!1;if(null==n.edgeOffset&&(n.edgeOffset=20),m&&!1!==n.extendTimeAxis)if(3===m)await i.setTimeSpan(new Date(h-d/2),new Date(g+d/2));else if(i.infiniteScroll){const e={start:o.startDate.getTime(),end:o.endDate.getTime()},t=l?new qs(l).milliseconds:d;1===m?e.start-=t:e.end+=t;if(h>=e.start&&g<=e.end)await i.setTimeSpan(new Date(e.start),new Date(e.end),{visibleDate:a.startDate}),f=!0;else{const e=a.endMS-a.startMS,t=1===(1&m?1:-1)?new Date(g+e):new Date(h-e);await i.setTimeSpan(new Date(h-d/2),new Date(h+d/2),{visibleDate:t})}}else{const e=i.presets.allRecords[i.zoomLevel],t=n.edgeOffset*i.getMilliSecondsPerPixelForZoomLevel(e,!1);1&m?await i.setTimeSpan(new Date(h-t),new Date(h-t+d)):await i.setTimeSpan(new Date(g+t-d),new Date(g+t))}if(!i.isDestroyed){var v;if(s.tree)await(null===(v=i.expandTo)||void 0===v?void 0:v.call(i,e));if(s.isGrouped&&await s.expand(s.getGroupHeaderForRecord(e)),null!==(r=i.features.nestedEvents)&&void 0!==r&&r.enabled&&t.parent&&!t.parent.isRoot&&await i.scrollEventIntoView(t.parent),p=i.getElementFromEventRecord(t,e),p){Yn.isFocusable(p)||(p=p.parentNode);const r=i.timeAxisSubGrid.scrollable;if(await r.scrollIntoView(p,n),i.isDestroyed)return;let s;do{if(s=i.getElementFromEventRecord(t,e),s||await dt.animationFrame(),i.isDestroyed)return}while(!s)}else 3===m&&!1===n.extendTimeAxis?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!t.isOccurrence&&i.eventStore.isFilteredOut(t)?console.warn("You have asked to scroll to an event which is not available"):t.isScheduled?await i.scrollUnrenderedEventIntoView(e,t,n):await i.scrollResourceIntoView(e,n);f&&(1===m?await i.setTimeSpan(o.startDate,new Date(o.endDate.getTime()-d),{maintainVisibleStart:!0}):await i.setTimeSpan(new Date(o.startDate.getTime()+d),o.endDate,{maintainVisibleStart:!0}))}}scrollUnrenderedEventIntoView(e,t,n=UE){return new Promise((async r=>{const i=this,s=i.timeAxisSubGrid.scrollable,o=s.viewport,{rowManager:a}=i,l=s.y;if(!o)return void r();const d=Object.assign({},UE);let c,u,h=0;do{if(++h>=50)throw new Error(`Too many preparational scrolls during 'scrollIntoView' for event id = ${t.id}`);const a=i.getResourceEventBox(t,e);if(!a)return void r();a.x=Math.ceil(a.x),a.y=Math.ceil(a.y),i.rtl&&(a._x=-(a.x-o.width)),a.translate(o.x-s.scrollLeft,o.y-s.y),void 0===u&&(u=s.getDeltaTo(a,d));const l=s.scrollIntoView(a,n);if(await l,l.cancelled||i.isDestroyed)return r(),!0;if(await dt.animationFrame(),i.isDestroyed)return r(),!0;c=i.getElementFromEventRecord(t,e)}while(!c);s.suspendEvents(),u.yDelta>=0?s.y=Math.max(a.topRow.top-s.viewport.height,l):s.y=Math.min(a.bottomRow.bottom,l),i.fixElementHeights(),s.resumeEvents();const g=s.scrollIntoView(c,d);if(await g,g.canceled||i.isDestroyed)return r(),!0;await dt.animationFrame(),r()}))}async scrollResourceIntoView(e,t=UE){await this.waitForReadiness(),this.isVertical?await this.currentOrientation.scrollResourceIntoView(e,t):await this.scrollRowIntoView(e,t)}get widgetClass(){}},YE=e=>class extends(e||Qe){static $name="SchedulerRegions";getScheduleRegion(e,t,n=!0,r){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(e,t,n){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,n=!1,r=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(e,t=!1){return e.resources.map((n=>this.getResourceEventBox(e,n,t)))}get widgetClass(){}};const qE=["startDate","endDate","eventLayout","barMargin","mode","tickSize","eventColor","eventStyle","fillTicks"];var KE=e=>class extends(e||Qe){static $name="SchedulerState";static configurable={statefulEvents:["dateRangeChange"]};getState(){return W.copyProperties(super.getState(),this,qE)}applyState(e){var t,n;e=Object.assign({},e),this.suspendRefresh(),"layoutFn"===(null===(t=e)||void 0===t?void 0:t.eventLayout)&&delete e.eventLayout,null!==(n=e)&&void 0!==n&&null!==(n=n.zoomLevelOptions)&&void 0!==n&&n.width&&delete e.tickSize,super.applyState(e),this.resumeRefresh(!0,!1)}get widgetClass(){}},XE=e=>class extends(e||Qe){static $name="EventSelection";static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectResourceOnEventNavigate:!0,selectResourceOnScheduleClick:!0,selectedCollection:{}}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}afterConstruct(){var e;super.afterConstruct(),null===(e=this.navigator)||void 0===e||e.ion({navigate:"onEventNavigate",thisObj:this})}changeSelectedCollection(e){return e.isCollection||(e=new ho(e)),e}updateSelectedCollection(e){const t=this;e.owner||(e.owner=t),e.ion({change:(...e)=>t.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",((...e)=>!t.isDestroying&&t.onSelectedCollectionChange(...e)),e),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:t})}get selectedCollection(){return this._selectedCollection}getActionType(e,t,n,r){return r&&e.length>0&&n.length===e.length&&0===t.length||!r&&0===e.length&&n.length>0?"clear":t.length>0&&n.length>0?"update":t.length>0?"select":"deselect"}getEventsFromAssignments(e){return nt.unique(e.map((e=>e.event)))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){var t;const n=[];null===(t=e=nt.asArray(e))||void 0===t||t.forEach((e=>{!1!==this.isEventSelectable(e)&&(e.isOccurrence?e.assignments.forEach((t=>{n.push(this.assignmentStore.getOccurrence(t,e))})):n.push(...e.assignments))})),this.selectedCollection.splice(0,this.selectedCollection.count,n)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){const{selectedCollection:t}=this;return Boolean(t.count&&t.includes(e.assignments))}isEventSelectable(e){}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||this.selectEvents([e],t)}selectAssignment(e,t=!1,n){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e,t=!1){if(t){const t=e.reduce(((e,t)=>(!1!==this.isEventSelectable(t)&&e.push(...t.assignments),e)),[]);this.selectedCollection.add(t)}else this.selectedEvents=e}deselectEvents(e){this.selectedCollection.remove(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:e,toRemove:t,index:n}){const r=this,i=r._selectedCollection.values,s=e,o=t>0?i.slice(n,t+n):[],a=r.getActionType(i,s,o,!0);if(0!==e.length||0!==t)return!1!==r.trigger("beforeEventSelectionChange",{action:a,selection:r.getEventsFromAssignments(i)||[],selected:r.getEventsFromAssignments(s)||[],deselected:r.getEventsFromAssignments(o)||[]})&&(!1!==r.trigger("beforeAssignmentSelectionChange",{action:a,selection:i,selected:s,deselected:o})&&void 0)}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedAssignments,i=e||[],s=t||[];function o(e,t){const r=e.event;if(r){const i=!1,s=!0,{eventAssignHighlightCls:o}=n;if(n.currentOrientation.toggleCls(e,n.eventSelectedCls,t,i,s),o){const a=n.getElementFromAssignmentRecord(e,i,s);n.getElementsFromEventRecord(r,null,i,s).forEach((e=>{if(e!==a){const r=n.resolveAssignmentRecord(e,s);n.currentOrientation.toggleCls(r,o,t,i,s),t&&!e.parentElement.isReleased&&(e.style.animation="none",e.offsetHeight,e.style.animation=""),e.classList.toggle(o,t)}}))}}}if(s.forEach((e=>o(e,!1))),i.forEach((e=>o(e,!0))),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=r.map((e=>({eventId:e.eventId,resourceId:e.resourceId}))),!n.silent){const e=this.getActionType(r,i,s);n.trigger("assignmentSelectionChange",{action:e,selection:r,selected:i,deselected:s}),n.trigger("eventSelectionChange",{action:e,selection:n.selectedEvents,selected:n.getEventsFromAssignments(i),deselected:n.getEventsFromAssignments(s)})}}onAssignmentChange(e){super.onAssignmentChange(e);const t=this,{action:n,records:r}=e;if(t.silent=!t.triggerSelectionChangeOnRemove,"remove"===n)t.deselectAssignments(r);else if("removeall"!==n||t.eventStore.isSettingData){if("dataset"===n&&t.$selectedAssignments)if(t.maintainSelectionOnDatasetChange){const e=t.$selectedAssignments.map((e=>r.find((t=>t.eventId===e.eventId&&t.resourceId===e.resourceId))));t.selectedAssignments=nt.clean(e)}else t.clearEventSelection()}else t.clearEventSelection();t.silent=!1}onInternalEventStoreChange({source:e,action:t,records:n}){e.isResourceTimeRangeStore||"dataset"!==t||n.length||this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const n=this;n.isAssignmentSelected(t)?(n.deselectOnClick||e.ctrlKey)&&n.deselectAssignment(t,n.multiEventSelect,e):!1!==this.isEventSelectable(t.event)&&n.selectAssignment(t,e.ctrlKey&&n.multiEventSelect,e)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const n=t&&(t.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(t):t);n?this.onAssignmentSelectionClick(e,n):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const t=this;return e?(t.highlighted=t.highlighted||new Set,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const t=this,{highlighted:n,eventStore:r}=t,i=t.features.dependencies;n.forEach((t=>{e.includes(t)||(t.meta.highlight=!1,n.delete(t),r.includes(t)&&t.dependencies.forEach((e=>i.unhighlight(e,"b-highlight"))))})),e.forEach((e=>{const r=[e];for(;r.length;){const e=r.pop();n.add(e),t.highlightSuccessors&&e.outgoingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!n.has(e.toEvent)&&r.push(e.toEvent)})),t.highlightPredecessors&&e.incomingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!n.has(e.fromEvent)&&r.push(e.fromEvent)}))}n.forEach((e=>e.meta.highlight=!0))})),t.element.classList.toggle("b-highlighting",e.length>0),t.refreshWithTransition()}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),super.onEventDataGenerated(e)}updateProject(e,t){this.clearEventSelection(),super.updateProject(e,t)}doDestroy(){var e;super.doDestroy(),(null===(e=this._selectedCollection)||void 0===e?void 0:e.owner)===this&&this._selectedCollection.destroy()}get widgetClass(){}};const ZE=e=>e.preventDefault(),JE={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},QE={animate:100},ex=Object.freeze({}),tx=({event:{startDate:e}},{event:{startDate:t}})=>e-t,nx=({event:{startDate:e}},{event:{startDate:t}})=>t-e;var rx=e=>class extends(Hi(e||Qe)){static $name="EventNavigation";static configurable={navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey"},internalListeners:{navigate:"up.onNavigate"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}};static defaultConfig={focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}};construct(e){const t=this;super.construct(e),t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t)}changeNavigator(e){const t=this,{isVertical:n}=t;return t.getConfig("subGridConfigs"),n&&(e.prevKey="ArrowUp",e.nextKey="ArrowDown",e.keys.ArrowUp=e.keys.ArrowDown=null,e.keys.ArrowLeft=e.keys.ArrowRight="navigateResourceHeaderCells"),new qh(t.constructor.mergeConfigs({ownerCmp:t,target:n?t.bodyElement:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap${n?",.b-resourceheader-cell":""}`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:ZE}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:ZE})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}onElementKeyDown(e){var t,n;const r=this,{navigator:i}=r;if(-1===(null===(t=r.focusedCell)||void 0===t?void 0:t.rowIndex)||(null===(n=r.focusedCell)||void 0===n?void 0:n.column)!==r.timeAxisColumn||e.target.closest(i.itemSelector)||"Enter"!==e.key){var s;null===(s=super.onElementKeyDown)||void 0===s||s.call(this,e)}else{const t=r.getFirstVisibleAssignment();if(t)return r.navigateTo(t,{uiEvent:e}),!1}}getFirstVisibleAssignment(e=this.focusedCell){const{currentOrientation:t,rowManager:n,eventStore:r}=this;if(this.isHorizontal){var i;let d=t.rowMap.get(n.getRow(e.rowIndex));var s,o,a,l;if(null!==(i=d)&&void 0!==i&&i.length)return null===(s=d[0])||void 0===s?void 0:s.elementData.assignmentRecord;if(d=null===(o=t.resourceMap.get(e.id))||void 0===o?void 0:o.eventsData,null!==(a=d)&&void 0!==a&&a.length)return null===(l=d.filter((e=>r.isAvailable(e.eventRecord)))[0])||void 0===l?void 0:l.assignmentRecord}else{const e=[...t.resourceMap.values()][0],n=e&&Object.values(e);if(null!=n&&n.length)return n.filter((e=>r.isAvailable(e.renderData.eventRecord)))[0].renderData.assignmentRecord}}onGridBodyFocusIn(e){const t=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){const r=this,{navigationEvent:i}=r,{target:s}=e,o=s.closest(r.navigator.itemSelector),a=o?r.normalizeCellContext({rowIndex:r.isVertical?0:r.resourceStore.indexOf(r.resolveResourceRecord(s)),column:r.timeAxisColumn,target:s}):new Dv(s);if(o){var n;const{_focusedCell:e}=r;return r._focusedCell=a,void(null===(n=r.onCellNavigate)||void 0===n||n.call(r,r,e,a,i,!0))}if(t&&(!i||JE[i.key])){const t=r.getFirstVisibleAssignment(a);if(t)return void r.navigateTo(t,{scrollIntoView:Boolean(i&&"mousedown"!==i.type),uiEvent:i||e})}}t&&super.onGridBodyFocusIn(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const n=this,{resourceStore:r,visibleDateRange:i}=n,{eventSorter:s}=n.currentOrientation,{startDate:o,endDate:a}=n.timeAxis,l=e.event,d=n.eventStore.getEvents({resourceRecord:e.resource,startDate:o,endDate:a,visibleDateRange:i}).filter(this.isInTimeAxis).sort(s);let c=e.resource,u=d[d.indexOf(l)-1];if(!u)for(let e=r.indexOf(c)-1;(!u||t&&u===l)&&e>=0;e--){c=r.getAt(e);const t=n.eventStore.getEvents({resourceRecord:c,startDate:o,endDate:a}).filter(n.isInTimeAxis).sort(s);u=t.length&&t[t.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(u,c)}navigateResourceHeaderCells(e){const{target:t}=e;if(t.closest(".b-resourceheader-cell")){const n=this.resourceStore["ArrowRight"===e.key?"getNext":"getPrev"](this.resolveResourceRecord(t)),r=t.parentElement.querySelector(`[data-resource-id="${null==n?void 0:n.id}"]`);r&&(e.handled=!0,e.preventDefault(),r.scrollIntoView(),r.focus())}}navigatePrevious(e){const t=this,n=e.target.closest(t.eventSelector)&&t.getPrevious(t.normalizeTarget(e));return n?(e.preventDefault(),e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,{uiEvent:e})):(e.handled=!1,t.doGridNavigation(e))}getNext(e,t){const n=this,{resourceStore:r,visibleDateRange:i}=n,{eventSorter:s}=n.currentOrientation,{startDate:o,endDate:a}=n.timeAxis,l=e.event,d=n.eventStore.getEvents({resourceRecord:e.resource,startDate:o,endDate:a,visibleDateRange:i}).filter(this.isInTimeAxis).sort(s);let c=e.resource,u=d[d.indexOf(l)+1];if(!u)for(let e=r.indexOf(c)+1;(!u||t&&u===l)&&e<r.count;e++){c=r.getAt(e);u=n.eventStore.getEvents({resourceRecord:c,startDate:o,endDate:a}).filter(n.isInTimeAxis).sort(s)[0]}return n.assignmentStore.getAssignmentForEventAndResource(u,c)}navigateNext(e){const t=this,{target:n}=e,r=n.closest(t.eventSelector)&&t.getNext(t.normalizeTarget(e));if(r)return e.preventDefault(),e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,{uiEvent:e});if(t.isVertical&&n.closest(".b-resourceheader-cell")){const r=t.resolveResourceRecord(n),{visibleDateRange:i}=t,{eventSorter:s}=t.currentOrientation,{startDate:o,endDate:a}=t.timeAxis,l=t.eventStore.getEvents({resourceRecord:r,filter:t.isInTimeAxis,startDate:o,endDate:a,visibleDateRange:i}).sort(s)[0],d=l&&t.assignmentStore.getAssignmentForEventAndResource(l,r);return d?t.navigateTo(d,{uiEvent:e}):t.navigateDown()}return e.handled=!1,t.doGridNavigation(e)}doGridNavigation(e){var t;e.handled||0!==e.key.indexOf("Arrow")||(null===(t=this[`navigate${e.key.substring(5)}ByKey`])||void 0===t||t.call(this,e))}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:n={}}=ex){const r=this,{navigator:i}=r,{skipScrollIntoView:s}=i;e&&(t?(i.disabled=!0,await r.scrollAssignmentIntoView(e,{extendTimeAxis:r.infiniteScroll,...QE}),i.disabled=!1):i.skipScrollIntoView=!0,!r.isDestroyed&&this.getElementFromAssignmentRecord(e)&&(r.activeAssignment=e,i.skipScrollIntoView=s,i.trigger("navigate",{event:n,item:r.getElementFromAssignmentRecord(e).closest(i.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e,!0);t&&(this.navigator.activeItem=t)}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,n=e.target.closest(t.eventSelector);return n&&(e.assignmentRecord=t.resolveAssignmentRecord(n),e.eventRecord=t.resolveEventRecord(n),e.resourceRecord=t.resolveResourceRecord(n)),e}onTab(e){e.target.closest(this.eventSelector)&&this.navigateNext(this.processEvent(e)),e.defaultPrevented||super.onTab(...arguments)}onShiftTab(e){e.target.closest(this.eventSelector)&&this.navigatePrevious(this.processEvent(e)),e.defaultPrevented||super.onShiftTab(...arguments)}onDeleteKey(e){const t=this;if(!t.readOnly&&t.enableDeleteKey){const e=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(e.filter((e=>{var t;return!(e.readOnly||null!==(t=e.event)&&void 0!==t&&t.readOnly)})))}}onArrowUpKey(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}onArrowDownKey(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}navigateLeft(e){if(this.isVertical&&this.activeAssignment){const t=this,{activeAssignment:n,eventStore:r,resourceStore:i}=t,{resource:s}=n,{startDate:o,endDate:a}=n.event;let l=r.getAssignmentsForResource(s).filter((({event:{startDate:e,endDate:t}})=>xi.intersectSpans(e,t,o,a)&&e<o));if(!l.length)for(let e=i.indexOf(s)-1;!l.length&&e>=0;e--)l=t.eventStore.getAssignmentsForResource(i.getAt(e));return l.length?t.navigateTo(l.sort(nx)[0],{uiEvent:e}):super.navigateLeft(e)}return super.navigateLeft(e)}navigateRight(e){if(this.isVertical&&this.activeAssignment){const t=this,{activeAssignment:n,eventStore:r,resourceStore:i}=t,{resource:s}=n,{startDate:o,endDate:a}=n.event;let l=r.getAssignmentsForResource(s).filter((e=>e!==n)).filter((({event:{startDate:e,endDate:t}})=>xi.intersectSpans(e,t,o,a)&&e>=o));if(!l.length)for(let e=i.indexOf(s)+1;!l.length&&e<i.count;e++)l=this.eventStore.getAssignmentsForResource(i.getAt(e));return l.length?t.navigateTo(l.sort(tx)[0],{uiEvent:e}):super.navigateRight(e)}return super.navigateRight(e)}onEscapeKey(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn},{disableActionable:!0,scroll:!1}),e.handled=!0)}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}onNavigate({item:e,event:t}){var n;null!=e&&null!==(n=e.elementData)&&void 0!==n&&n.ariaLabel&&e.setAttribute("aria-label",e.elementData.ariaLabel)}get widgetClass(){}},ix=e=>class extends e{static $name="TransactionalFeatureMixin";static configurable={enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}};get widgetClass(){}get transactionalFeaturesEnabled(){return this.enableTransactionalFeatures&&this.project&&Boolean(this.project._queue)}get isTransactionalFeatureActive(){return null!=this._featureTransactionId}get featureTransactionId(){return this._featureTransactionId}construct(...e){super.construct(...e),this.ion({beforeFeatureTransactionStart:({id:e})=>this._featureTransactionId=e,featureTransactionComplete:()=>delete this._featureTransactionId})}afterFeatureTransaction(e){this.transactionalFeaturesEnabled&&(this.isTransactionalFeatureActive?this.once("featureTransactionComplete",e):e.call(this))}},sx=e=>class extends(e.mixin(fg)){static $name="CrudManagerView";static config={clearMaskDelay:null,testConfig:{clearMaskDelay:0}};afterConstruct(){super.afterConstruct();const{crudManager:e,project:t}=this;this.loadMask&&(e||t).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:e}=this;e&&(this.masked=mc.mergeConfigs(this.loadMaskDefaults,e))}bindCrudManager(e){this.detachListeners("crudManager");let t={};this.isTaskBoardBase||(t={beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",beforeLoadCrudManagerData:"onCrudManagerBeforeLoadCrudManagerData",loadCrudManagerData:"onCrudManagerLoadCrudManagerData"}),null==e||e.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",requestDone:"onAjaxTransportResponseDone",...t,thisObj:this})}onCrudManagerBeforeSend({params:e}){var t;null===(t=this.applyStartEndParameters)||void 0===t||t.call(this,e)}onCrudManagerLoadStart(){var e;this.applyLoadMask(),null===(e=this.toggleEmptyText)||void 0===e||e.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){this.suspendRefresh()}onCrudManagerApplyResponse({request:e}){this.resumeRefresh(!0,"sync"===e.type)}onCrudManagerBeforeLoadCrudManagerData(){this.crudManager.applyingLoadResponse||this.suspendRefresh()}async onCrudManagerLoadCrudManagerData(){this.crudManager.applyingLoadResponse||(await this.project.commitAsync(),!this.isDestroyed&&this.resumeRefresh(!0))}onCrudManagerRequestFinalize(e=!0,t,n){const r=this;var i;e?null===(i=r.toggleEmptyText)||void 0===i||i.call(r):(r.masked||r.applyLoadMask(),r.applyMaskError(`<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">${r.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                    ${n&&n.message?`<div class="b-grid-load-fail">${r.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}\n                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}onAjaxTransportResponseDone(){const e=this;null!=e.clearMaskDelay?e.setTimeout((()=>e.masked=null),e.clearMaskDelay):e.masked=null}get widgetClass(){}},ox=e=>class extends e{static $name="LazyLoadView";construct(e){var t;const n=this;if(n.$lazyLoadDetachers=new Map,n.$lazyLoadCount=0,super.construct(e),null!==(t=n.crudManager)&&void 0!==t&&t.lazyLoad){let e=n.resourceStore.lazyLoad,t="doLazyLoad";n.crudManager.remotePaging&&(e=n.resourceStore,t="requestData"),n.$lazyLoadDetachers.set(n,ee.before(e,t,"beforeResourceStoreLoad",n)),n.passStartEndParameters=!1}}beforeResourceStoreLoad(e){const t=this,n={startDate:t.startDate,endDate:t.endDate,visibleStart:t.visibleDateRange.startDate,visibleEnd:t.visibleDateRange.endDate};if(t.crudManager.remotePaging){const r=t.resourceStore.defaultPageParamName,i=t.resourceStore.pageSizeParamName;n[r]=e[r],n[i]=e[i]}const r=t.eventStore.lazyLoad.calculateDateRange(n);Object.assign(e,r)}updateEventStore(e,t){var n;null===(n=super.updateEventStore)||void 0===n||n.call(this,e,t),this.lazyLoadAttachStore(e,t),e.lazyLoad&&(this.passStartEndParameters=!1)}updateResourceTimeRangeStore(e,t){var n;null===(n=super.updateResourceTimeRangeStore)||void 0===n||n.call(this,e,t),this.lazyLoadAttachStore(e,t)}updateAssignmentStore(e,t){var n;null===(n=super.updateAssignmentStore)||void 0===n||n.call(this,e,t),this.lazyLoadAttachStore(e,t)}updateTimeRangeStore(e,t){var n;null===(n=super.updateTimeRangeStore)||void 0===n||n.call(this,e,t),this.lazyLoadAttachStore(e,t)}lazyLoadAttachStore(e,t){var n;const r=this,{$lazyLoadDetachers:i}=r;var s,o;t&&(null===(s=i.get(t))||void 0===s||s(),i.delete(t),t.lazyLoad.beforeLoadCall&&(t.lazyLoad.beforeLoadCall=null));(e&&null!==(n=r.resourceStore)&&void 0!==n&&n.isPaged&&(e.lazyLoad&&!e.isPaged?e.remotePaging=!0:e.isPaged&&!e.lazyLoad&&(e.lazyLoad=!0)),null!=e&&e.lazyLoad)&&(null===(o=i.get(e))||void 0===o||o(),i.set(e,e.ion({lazyLoadStarted:"storeLazyLoadStarted",lazyLoadEnded:"storeLazyLoadEnded",thisObj:r})),e.lazyLoad.isDateStoreLazyLoadPlugin&&(e.lazyLoad.beforeLoadCall=e=>{Object.assign(e,{startDate:r.startDate,endDate:r.endDate,visibleStart:r.visibleDateRange.startDate,visibleEnd:r.visibleDateRange.endDate,resourceRecord:r.resourceStore.first})}))}set $lazyLoadCount(e){0===this.$_lazyLoadCount&&e>0?this.lazyLoadShowLoadingIndicator():this.$_lazyLoadCount>0&&0===e&&this.lazyLoadHideLoadingIndicator(),this.$_lazyLoadCount=e}get $lazyLoadCount(){return this.$_lazyLoadCount}storeLazyLoadStarted(){this.$lazyLoadCount+=1}storeLazyLoadEnded(){this.$lazyLoadCount-=1}lazyLoadShowLoadingIndicator(){const e=this;e.$lazyLoadingIndicatorElement?e.timeAxisSubGrid.header.element.appendChild(e.$lazyLoadingIndicatorElement):e.$lazyLoadingIndicatorElement=Yn.createElement({parent:e.timeAxisSubGrid.header.element,retainElement:!0,className:"b-timeline-loading-indicator-wrap",children:[{className:"b-timeline-loading-indicator"}]}),e.readOnly=!0}lazyLoadHideLoadingIndicator(){var e;null===(e=this.$lazyLoadingIndicatorElement)||void 0===e||e.remove(),this.readOnly=!1}doDestroy(){var e;null===(e=this.$lazyLoadDetachers)||void 0===e||e.forEach((e=>e())),super.doDestroy()}},ax=e=>class extends e{static $name="AttachToProjectMixin";async afterConstruct(){var e;super.afterConstruct();const t=this,n=t.client||t.grid,{project:r}=n;null===(e=n.projectSubscribers)||void 0===e||e.push(t),r&&(t.attachToProject(r),t.attachToResourceStore(r.resourceStore),t.attachToEventStore(r.eventStore),t.attachToAssignmentStore(r.assignmentStore),t.attachToDependencyStore(r.dependencyStore),t.attachToCalendarManagerStore(r.calendarManagerStore))}attachToProject(e){var t;this.detachListeners("project"),this._project=e,null===(t=super.attachToProject)||void 0===t||t.call(this,e)}detachFromProject(e=this._project){var t;this.detachListeners("project"),null===(t=super.detachFromProject)||void 0===t||t.call(this,e)}attachToEventStore(e){var t;this.detachListeners("eventStore"),null===(t=super.attachToEventStore)||void 0===t||t.call(this,e)}attachToResourceStore(e){var t;this.detachListeners("resourceStore"),null===(t=super.attachToResourceStore)||void 0===t||t.call(this,e)}attachToAssignmentStore(e){var t;this.detachListeners("assignmentStore"),null===(t=super.attachToAssignmentStore)||void 0===t||t.call(this,e)}attachToDependencyStore(e){var t;this.detachListeners("dependencyStore"),null===(t=super.attachToDependencyStore)||void 0===t||t.call(this,e)}attachToCalendarManagerStore(e){var t;this.detachListeners("calendarManagerStore"),null===(t=super.attachToCalendarManagerStore)||void 0===t||t.call(this,e)}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}};const lx={releaseElement:1,reuseElement:1},dx={newElement:1,reuseOwnElement:1,reuseElement:1},cx=9999999,ux=new Date(0),hx=new Date(9999,0,1),gx=({startDateMS:e},{startDateMS:t})=>e-t,mx={startDate:1,endDate:1,duration:1};function px(e,t,n,r,i){var s,o;const{timeAxis:a}=e,l=t.isBatchUpdating&&!i?t.get(r):t[r],d=null===(s=t.hasBatchedChange)||void 0===s?void 0:s.call(t,r);if(e.fillTicks&&(!(null!==(o=t.meta)&&void 0!==o&&o.isResizing)||!d)){let e=a.getTickFromDate(l);if(e>=0){n&&e===Math.round(e)&&e>0&&e--;const t=Math.floor(e);return a.getAt(t)[r].getTime()}}return null==l?void 0:l.getTime()}class fx extends(Qe.mixin(ax)){static $name="HorizontalRendering";static get configurable(){return{bufferSize:150,verticalBufferSize:150,maxZIndexStacks:50}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],entityNames:new Set,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),t.scrollBuffer=e.scrollBuffer,e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:t}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,n,r=!1){const{scheduler:i}=this;let s=e[0];return n||(s=this.translateToScheduleCoordinate(s)),s=i.getRtlX(s),i.timeAxisViewModel.getDateFromPosition(s,t,r)}translateToScheduleCoordinate(e){const{scheduler:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e-t.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return t.rtl?r+=n.maxX-Math.abs(t.scrollLeft):r+=t.scrollLeft,r}translateToPageCoordinate(e){const{scheduler:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}getScheduleRegion(e,t,n=!0,r,i=!1){var s,o;const a=this,{scheduler:l}=a,{timeAxisSubGridElement:d,timeAxis:c}=l,{start:u,end:h}=(!i||e)&&l.getResourceMarginObject(e)||{start:0,end:0};let g;if(e){const n=l.getRowById(e.id),r=t&&l.getElementsFromEventRecord(t,e)[0];if(g=n?Ot.from(n.getElement("normal"),d):l.getRecordCoords(e,!0),r){const e=Ot.from(r,d);g.y=e.y,g.bottom=e.bottom}else g.y=g.y+u,g.bottom=g.bottom-h}else g=Ot.from(d).moveTo(null,0),g.width=d.scrollWidth,g.y=g.y+u,g.bottom=g.bottom-h;const m=c.startDate,p=c.endDate;(r=(null===(s=r)||void 0===s?void 0:s.start)&&r||(null===(o=l.getDateConstraints)||void 0===o?void 0:o.call(l,e,t))||{start:m,end:p}).start=r.start||ux,r.end=r.end||hx;const f=r.end<=m||r.start>=p;let v=f?-1:l.getVirtualCoordFromDate(r.start?xi.max(m,r.start):m),y=f?-1:l.getVirtualCoordFromDate(r.end?xi.min(p,r.end):p);return n||(v=a.translateToPageCoordinate(v),y=a.translateToPageCoordinate(y)),g.left=Math.min(v,y),g.right=Math.max(v,y),g}getRowRegion(e,t,n){const{scheduler:r}=this,{timeAxis:i}=r,s=r.getRowById(e.id);if(!s)return null;const o=i.startDate,a=i.endDate,l=t?xi.max(o,t):o,d=n?xi.min(a,n):a,c=r.getCoordinateFromDate(l),u=r.getCoordinateFromDate(d,!0,!0),h=s.top,g=Math.min(c,u),m=h+s.offsetHeight;return new Ot(g,h,Math.max(c,u)-g,m-h)}getResourceEventBox(e,t,n,r=!1){const{scheduler:i}=this,s=this.resourceMap.get(t.id);let o=null,a=!1;if(s&&(o=s.eventsData.find((t=>t.eventRecord===e))),o||(o=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:n}),a=!0),o){const e=o.height??i.getResourceLayoutSettings(t).contentHeight,n=i.rowManager.getRecordCoords(t,!0,r);if(!n)return null;const s=o.top+n.top,l=new Ot(o.left,s,o.width,e);return l.layout=!a,l.rowTop=n.top,l.rowBottom=n.bottom,l.resourceId=t.id,l}return null}resolveRowRecord(e){const t=this,{scheduler:n}=t,r=e.nodeType?e:e.target,i=r.nodeType===Element.TEXT_NODE?r.parentElement:r,s=i.closest("[data-resource-id]");return s?t.resourceStore.getById(s.dataset.resourceId):n.getRecordFromElement(i)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),null==e||e.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:t,project:n}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!t.size&&null!=n.timeZone&&n.ignoreRecordChanges&&n.resourceStore.forEach((e=>t.add(e.id))),t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:t}){const n=this,{scheduler:r,toDrawOnProjectRefresh:i}=n;if(r.isVisible){if(r.isPainted&&!r.isConfiguring&&!r.refreshSuspended){if(n.refreshAllWhenReady||t&&e){r.calculateAllRowHeights(!0);const{rowManager:i}=r;i.topRow?(n.clearAll(),r.refreshAfterProjectRefresh||(i.topRow.dataIndex>=r.store.count?r.renderRows(!1):r.refreshWithTransition(!1,e&&!t))):i.reinitialize(),n.refreshAllWhenReady=!1}else i.size&&n.refreshResources(i);i.clear()}}else r.whenVisible("refresh",r,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:e,action:t,records:n=[],replaced:r,changes:i}){const s=this,{scheduler:o}=s,a=new Set(n.flatMap((e=>{var t;return[e.resourceId,...(null===(t=e.resource)||void 0===t||null===(t=t.$links)||void 0===t?void 0:t.map((e=>e.id)))??[]]})));if(!s.resourceStore.isRemoving&&!s.resourceStore.isChangingId)switch(t){case"dataset":return void(s.eventStore.usesSingleAssignment||(a.size?s.refreshResourcesWhenReady(a):(s.clearAll(),o.refreshWithTransition())));case"add":case"remove":return void s.refreshResourcesWhenReady(a);case"removeall":return void(s.refreshAllWhenReady=!0);case"replace":return r.forEach((([e,t])=>{a.add(e.resourceId),a.add(t.resourceId)})),void s.refreshResourcesWhenReady(a);case"filter":return s.clearAll(),o.calculateAllRowHeights(!0),void o.refreshWithTransition();case"update":("eventId"in i||"resourceId"in i||"id"in i)&&("resourceId"in i&&a.add(i.resourceId.oldValue),e===o.project.assignmentStore?s.refreshResourcesOnDataReady(a):s.refreshResources(a));break;case"clearchanges":{const{added:e,modified:t,removed:n}=i;t.length?o.refreshWithTransition():(e.forEach((e=>a.add(e.resourceId))),n.forEach((e=>a.add(e.resourceId))),s.refreshResourcesOnDataReady(a))}}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:e}){for(const t of this.client.getElementsFromEventRecord(e))t.classList.remove("b-iscreating")}onEventStoreRefresh({action:e}){if("batch"===e){const{scheduler:e}=this;e.isEngineReady&&e.isPainted&&(this.clearAll(),e.refreshWithTransition())}}onEventStoreChange({action:e,records:t=[],record:n,replaced:r,changes:i,source:s}){const o=this,{scheduler:a}=o,l=s.isResourceTimeRangeStore,d=new Set;if(a.isPainted)if(t.forEach((e=>{var t;const n=null===(t=e.$linkedResources)||void 0===t?void 0:t.filter((e=>o.resourceStore.includes(e)));null==n||n.forEach((e=>d.add(e.id)))})),l){switch(e){case"removeall":case"dataset":return o.clearAll(),void a.refreshWithTransition()}o.refreshResources(d,"lazyload"!==e)}else{switch(e){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":return o.clearAll(),void a.refreshWithTransition();case"lazyload":return void(a.isEngineReady?a.refreshRows():o.refreshAllWhenReady=!0);case"dataset":return o.clearAll(),void(a.isEngineReady?a.refreshWithTransition():o.refreshAllWhenReady=!0);case"add":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>d.add(e.id)))}));break;case"removeall":case"filter":return a.isEngineReady?(o.clearAll(),a.calculateAllRowHeights(!0),void a.refreshWithTransition()):void(o.refreshAllWhenReady=!0);case"update":{const e=n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!mx[e]));let t=0;if("startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,"resourceId"in i&&d.add(i.resourceId.oldValue),d.size&&(!e||t&&(!("duration"in i)||1!==t)||"percentDone"in i||"inactive"in i||"constraintDate"in i||"constraintType"in i||"segments"in i)){var c,u;const{eventResize:e,eventDragCreate:t}=a.features,r=null==e?void 0:e.isResizing,i=null==t?void 0:t.isResizing,{store:s}=a,l=n.isBatchUpdating&&[...d].every((e=>{const t=s.getById(e),n=a.getEventLayout(t);return!a.getEventLayoutHandler(n)}));if(n.isBatchUpdating&&(r&&e.lockLayout||i&&t.lockLayout||(r||i)&&l)){const l=r&&"minimal-updates"===e.lockLayout||i&&"minimal-updates"===t.lockLayout;for(const e of d){const t=a.store.getById(e);if(t)if(l){var h,g;const t=null===(h=o.resourceMap.get(e))||void 0===h?void 0:h.eventsData.find((e=>e.eventRecord===n)),r=a.getRowFor(e),i=null===(g=o.rowMap.get(r))||void 0===g?void 0:g.find((e=>e.elementData.eventRecord===n));if(t&&i){const r=a.generateRenderData(n,s.getById(e),!0);Object.assign(t,r);const o=this.renderEvent(t);Object.assign(i,o)}}else o.refreshEventsForResource(t,void 0,!1)}o.onRenderDone()}else null!==(c=o.project)&&void 0!==c&&c.propagatingLoadChanges||null!==(u=o.project)&&void 0!==u&&u.isWritingData?o.refreshResourcesOnDataReady(d):o.refreshResources(d)}return}}o.refreshResourcesWhenReady(d)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:t,records:n,changes:r}){const i=this,s=null==n?void 0:n.flatMap((e=>e.isLinked?[e.id,e.$originalId]:[e.id]));if(i.scheduler.isPainted){switch(e){case"add":return void(t||(n.every((e=>e.isLinked))?i.refreshResources(s):i.refreshResourcesWhenReady(s)));case"update":return void(i.project.isChangeTrackingSuspended||r.isLeaf||i.refreshResources(s));case"filter":case"dataset":return;case"removeall":return void i.clearAll({clearLayoutCache:!0})}s&&i.clearResources(s)}}onTranslateRow({row:e}){null!=e.id&&this.refreshEventsForResource(e,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(e){var t,n,r;const{scheduler:i}=this,s=i.getResourceHeight(e),o=i.getEventLayout(e),a=o.type,l=null===(t=i.features.eventResize)||void 0===t?void 0:t.lockLayout,d=null===(n=i.features.eventDragCreate)||void 0===n?void 0:n.lockLayout;if("stack"===a&&i.isEngineReady&&!e.isSpecialRow&&(null===(r=e.assigned)||void 0===r?void 0:r.size)>1){const{assignmentStore:t,eventStore:n,timeAxis:r}=i,{barMargin:s,resourceMarginObject:{total:a},contentHeight:c}=i.getResourceLayoutSettings(e),u=(n.isFiltered||t.isFiltered)&&(n=>n.assignments.some((n=>n.resource===e.$original&&t.includes(n)))),h=n.getEvents({resourceRecord:e,includeOccurrences:i.enableRecurringEvents,startDate:r.startDate,endDate:r.endDate,filter:u,fromRowHeight:!0}).sort(gx).map((t=>{var n,r;const i=t.isBatchUpdating&&!(l&&null!==(n=t.meta)&&void 0!==n&&n.isResizing)&&!(d&&null!==(r=t.meta)&&void 0!==r&&r.isCreating),s=i?t.get("startDate"):t.startDate,o=i?t.get("endDate"):t.endDate||s;return{eventRecord:t,resourceRecord:e,startMS:s.getTime(),endMS:o.getTime()}})),g=i.getEventLayoutHandler(o),m=g.layoutEventsInBands(h,e,!0);return"layoutFn"===g.type?m:m*c+(m-1)*s+a}return s}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x,!0)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:t}=e;e.clearAll(),t.refreshSuspended&&(e.detachListeners("renderingSuspend"),t.ion({name:"renderingSuspend",resumeRefresh({trigger:n}){t.isEngineReady&&n&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e,t){e?this.clearResources(e):t&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,t,n,r){t>r&&this.onRenderDone()}onDragAbort({context:e,dragData:t}){const{record:n}=t;!n.isEventSegmentModel&&this.resourceStore.indexOf(n.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,n=!0,r=!1,i=!1){const s=this.client.getElementFromAssignmentRecord(e,r,i),o=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),a=null==o?void 0:o.eventsData.find((t=>t.eventId===e.eventId));a&&(a[r?"wrapperCls":"cls"][t]=n),s&&(s.classList.toggle(t,n),s.lastDomConfig.className[t]=n)}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e,t,n){var r,i;const s=this,{scheduler:o,scrollBuffer:a}=s,l=-1===a,{timeAxisSubGrid:d,timeAxis:c}=o,{width:u}=d,{totalSize:h}=o.timeAxisViewModel,g=e,m=Math.abs(d.scrollable.maxX)>1&&Math.abs(d.scrollable.maxX)<=Math.round(g)+5,p=l?c.startDate:o.getDateFromVirtualCoord({coord:Math.max(0,g-a)}),f=m||l?c.endDate:o.getDateFromVirtualCoord({coord:g+u+a})||c.endDate;if(p&&(!o._viewPresetChanging||n)&&(!l||t||p-((null===(r=s._visibleDateRange)||void 0===r?void 0:r.startDate)||0)||f-((null===(i=s._visibleDateRange)||void 0===i?void 0:i.endDate)||0))){s._visibleDateRange={startDate:p,endDate:f,startMS:p.getTime(),endMS:f.getTime()},s.viewportCoords=l?{left:0,right:h}:{left:e-a,right:e+u+a};const t=o.timeView.range={startDate:p,endDate:f};if(o.internalOnVisibleDateRangeChange(t),!o.refreshSuspended&&o.rowManager.rows.length){if(null===o.rowManager.rows[0].id)return;s.fromScroll=!0,o.rowManager.rows.forEach((e=>s.refreshEventsForResource(e,!1,!1))),s.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach((e=>this.toDrawOnDataReady.add(e)))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshResources(e,t=!0){const{scheduler:n}=this;if(this.clearResources(e),!n.refreshSuspended){const r=[],i=[];e.forEach((e=>{const t=n.getRowById(e);t?r.push(t):i.push(t)})),n.runWithTransition((()=>{n.calculateRowHeights(i.map((e=>this.resourceStore.getById(e))),!0),n.rowManager.renderRows(r)}),t)}}layoutEventVerticallyStack(e,t,n){const{barMargin:r,resourceMarginObject:{start:i},contentHeight:s}=this.scheduler.getResourceLayoutSettings(n,t.parent);return 0===e?i:i+e*s+e*r}layoutEventVerticallyPack(e,t,n,r){const{barMargin:i,resourceMarginObject:{start:s},contentHeight:o}=this.scheduler.getResourceLayoutSettings(r,n.parent),a=1/t,l=e*a,d=(o-(a-1)*i)*t;return{top:s+l*d+l*i,height:Math.max(d,0)}}addTemporaryDragElement(e,t=e.resource){const{scheduler:n}=this,r=n.generateRenderData(e,t,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:n.getResourceEventBox(e,t,!0).top;const i=this.renderEvent(r),{dataset:s}=i;delete i.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const o=Yn.createElement(i,{reactCallback({jsx:e,domConfig:t,targetElement:r}){var i;const{reactComponent:s}=n;e&&(null===(i=n.processEventContent)||void 0===i||i.call(n,{jsx:e,action:"add",domConfig:t,targetElement:r,isRelease:!1,reactComponent:s}))}});return o.innerElement=o.firstChild,e.instanceMeta(n).hasTemporaryDragElement=!0,o}eventSorter(e,t){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,t.eventRecord||t);const n=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,r=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}calculateMS(e,t,n,r,i){var s;const{scheduler:o}=this,{timeAxisViewModel:a}=o,{eventResize:l}=o.features;let d=px(o,e,!1,t,r),c=px(o,e,!0,n,r),u=c-d;if("default"!==o.milestoneLayoutMode&&0===u){const t=a.getSingleUnitInPixels("minute"),n=o.getMilestoneLabelWidth(e,i);if(u=60*(n*(1/t))*1e3,"always-outside"===o.milestoneTextPosition){if(d-=o.getResourceLayoutSettings(i,e.parent).contentHeight*(1/t)*60*1e3/2,c=d+u,!1===o.timeAxis.isContinuous){const e=o.getCoordinateFromDate(d);c=o.getDateFromCoordinate(e+n)??c}}else switch(o.milestoneAlign){case"start":case"left":c=d+u;break;case"end":case"right":c=d,d=c-u;break;default:c=d+u/2,d=c-u}}const h=d,g=c,m=u;return null!==(s=e.meta)&&void 0!==s&&s.isResizing&&null!=l&&l.isResizing&&l.lockLayout&&!l.isMultiResizing&&(d=e.startDate.getTime(),c=e.endDate.getTime(),u=g-h),{startMS:d,endMS:c,durationMS:u,elementStartMS:h,elementEndMS:g,elementDurationMS:m}}setupRenderData(e,t){var n;const r=this,{scheduler:i}=r,{timeAxis:s,timeAxisViewModel:o}=i,{preamble:a,postamble:l}=e,d=r.isProHorizontalRendering&&(null===(n=i.features.eventBuffer)||void 0===n?void 0:n.enabled)&&(a||l)&&!e.isMilestone,c=o.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=e,h=d?"wrapStartDate":"startDate",g=d?"wrapEndDate":"endDate",m=u&&!d?e.get(h):e[h],p=u&&!d?e.get(g):e[g]||m,f=s.startMS,v=s.endMS,y=r.calculateMS(e,h,g,d,t),{durationMS:b,elementStartMS:C,elementEndMS:w}=y,S=C<f|(C>v)<<1,D=w>v|(w<=f)<<1,E=D?c*(b/6e4):null,x=i.getRowById(t);return 0===b&&y.startMS--,{eventRecord:e,taskRecord:e,start:m,end:p,rowId:t.id,children:[],startsOutsideView:S,endsOutsideView:D,width:E,row:x,useEventBuffer:d,...y}}fillTimeSpanHorizontalPosition(e){const{elementStartMS:t,elementEndMS:n,elementDurationMS:r}=e,i=null!=t&&null!=n&&this.calculateHorizontalPosition(e,t,n,r);return!!i&&(Object.assign(e,i),!0)}calculateHorizontalPosition(e,t,n,r){const{scheduler:i}=this,{timeAxis:s,timeAxisViewModel:o}=i,{startsOutsideView:a,endsOutsideView:l,eventRecord:d}=e,u=s.startMS,h=o.getSingleUnitInPixels("minute");let g,m=null,p=i.getVirtualCoordFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0}),f=!1,v=!1;if(a?g=(t-u)/6e4*h:(g=i.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==p}),f=-1===g),l){m=o.totalSize-g+h*((n-s.endMS)/6e4),p=c.isSafari&&c.safariVersion<16&&i.features.stickyEvents&&s.endMS&&!a?i.getCoordinateFromDate(s.endMS):g+m}else v=-1===p;return v&&!f&&(p=i.getVirtualCoordFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),m>cx&&(1===a?1===l?(g=-100,p=i.timeAxisColumn.width+100):g=p-cx:1===l&&(p=g+cx)),f&&v&&(g=i.getVirtualCoordFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:n}),p=i.getVirtualCoordFromDate(n,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:t}),g===p)?(d.instanceMeta(i).excluded=!0,null):{left:Math.min(g,p),width:Math.abs(p-g)||(d.isMilestone&&!d.meta.isDragCreating?0:6),clippedStart:f,clippedEnd:v}}fillTimeSpanVerticalPosition(e,t){const{scheduler:n}=this,{start:r,end:i}=e,{resourceMarginObject:{start:s},contentHeight:o}=n.getResourceLayoutSettings(t);n.fillTicks&&(e.dataStartMS=r.getTime(),e.dataEndMS=i.getTime()),e.top=Math.max(0,s),n.managedEventSizing&&(e.height=o)}getTimeSpanRenderData(e,t,n=!1){const r=this.setupRenderData(e,t);return this.fillTimeSpanHorizontalPosition(r)?(this.fillTimeSpanVerticalPosition(r,t),r):null}layoutEvents(e,t,n=!1,r,i){const s=this,{scheduler:o}=s,{timeAxis:a}=o,l=t.reduce(((t,r)=>{if(n||a.isTimeSpanInAxis(r)){const i=o.generateRenderData(r,e,n);i&&t.push(i)}return t}),[]);l.sort(i??s.eventSorter);let d=o.getAppliedResourceHeight(e,r);const c=l.filter((({eventRecord:e})=>e.isEvent&&!e.meta.excludeFromLayout)),u=o.getEventLayout(e,r),h=o.getEventLayoutHandler(u);if(h){const{barMargin:t,resourceMarginObject:{total:n},contentHeight:i}=o.getResourceLayoutSettings(e,r),s=h.applyLayout(c,e,o)||1;d="layoutFn"===h.type?s:s*i+(s-1)*t+n}else if(c.length>0){const e=Math.min(c.length,s.maxZIndexStacks);for(let t=0;t<e;t++){c[t].wrapperStyle+=`;z-index:${t+5}`}}return{rowHeight:d,eventsData:l}}layoutResourceEvents(e,t=!1){const n=this,{scheduler:r}=n,{eventStore:i,assignmentStore:s,timeAxis:o}=r,a=i.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:o.startDate,endDate:o.endDate,visibleDateRange:n.visibleDateRange,filter:(s.isFiltered||i.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e.$original&&s.includes(t))))}),l=r.getEventsToRender(e,a)||[];return n.layoutEvents(e,l,t)}renderEvent(e,t){const{scheduler:n}=this,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=e,o=i?this.assignmentStore.getOccurrence(i,s).id:e.eventId,a={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},l={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,"aria-label":e.wrapperCls["b-active"]?e.ariaLabel:void 0,children:[a,...e.wrapperChildren],style:{insetBlockStart:e.absoluteTop,insetInlineStart:e.left,height:e.fillSize?t:e.height,width:e.width,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:r.id,eventId:e.eventId,syncId:r.isLinked?`${o}_${r.id}`:o},elementData:e,retainElement:(null==i?void 0:i.instanceMeta(n).retainElement)||s.instanceMeta(n).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return s.isMilestone&&"default"!==n.milestoneLayoutMode&&"always-outside"===n.milestoneTextPosition&&"pack"===n.getEventLayout(r).type&&(l.style.insetInlineStart+=(n.getResourceLayoutSettings(r,s.parent).contentHeight-e.height)/2),e.fillSize&&(e.height=t),e.zIndex&&(l.zIndex=e.zIndex),i&&(l.dataset.assignmentId=i.id),e.elementConfig=l,n.afterRenderEvent({renderData:e,rowHeight:t,domConfig:l}),l}refreshEventsForResource(e,t=!0,n=!0){const r=this,{store:i}=r.scheduler,s=e.isRow?i.getAt(e.dataIndex):i.getById(e),o=r.scheduler.rowManager.getRowFor(s);t&&r.clearResources([s]),o&&s&&(r.renderer({row:o,record:s}),t&&n&&r.onRenderDone())}getResourceLayout(e){const t=this;let n=t.resourceMap.get(e.id);if(!n||n.invalid||t.eventStore.lazyLoad){if(t.suspended)return;n=t.layoutResourceEvents(e,!1),t.resourceMap.set(e.id,n)}return n}getEventDOMConfigForCurrentView(e,t,n,r){const i=this,{bufferSize:s,scheduler:o}=i,{labels:a,eventBuffer:l}=o.features,d=(null==l?void 0:l.enabled)||(null==a?void 0:a.enabled)&&(a.left||a.right||a.before||a.after),{eventsData:c}=e,u=i.fromScroll?i.rowMap.get(t):null,h=[];let g,m;for(let o=0;o<c.length;o++){const a=c[o];if(g=n,m=r,(d||0===a.width)&&(g-=s,m+=s),a.left+a.width>=g&&a.left<=m){var p;a.absoluteTop=a.top+t.top;const n=null==u?void 0:u.find((e=>e.elementData.eventId===a.eventId&&e.elementData.resourceId===a.resourceId));n&&(n.style.top=a.absoluteTop),a.hidden=null===(p=t.cls)||void 0===p?void 0:p.contains("b-row-placeholder"),h.push(n??i.renderEvent(a,e.rowHeight))}}return h}renderer({row:e,record:t,size:n={}}){const r=this;if(t.isSpecialRow)return void r.rowMap.delete(e);const{left:i,right:s}=r.viewportCoords,o=r.getResourceLayout(t);if(!o)return;n.height=o.rowHeight,n.transient=!0;const a=r.getEventDOMConfigForCurrentView(o,e,i,s);r.rowMap.set(e,a),r.rendererCalled=!0}onRenderDone(){const{scheduler:e,rowMap:t,verticalBufferSize:n,fromScroll:r}=this;if(e.refreshSuspended)return;const{entityNames:i}=this,s={event:[]},o=e._scrollTop??0,a=o-n,l=o+e._bodyRectangle.height+n,d=n<0,c=!e.managedEventSizing;for(const e of i)s[e]=[];t.forEach(((e,t)=>{if(!t.isDestroyed&&!t.cls.contains("b-row-placeholder")&&(d||t.bottom>a&&t.top<l))for(let t=0;t<e.length;t++){const n=e[t],r=n.elementData,{absoluteTop:o,eventRecord:u,entityName:h="event"}=r;(d||c||u.meta.isDragCreating||u.meta.isResizing||o+r.height>a&&o<l)&&(s[h]||(s[h]=[],i.add(h)),s[h].push(n))}for(let t=0;t<e.length;t++)e[t]={...e[t]}})),this.fromScroll=!1;for(const t in s)ud.sync({domConfig:{onlyChildren:!0,children:s[t]},targetElement:e.canvases[t],syncIdField:"syncId",releaseThreshold:e.eventReleaseThreshold,callback:({action:t,domConfig:n,lastDomConfig:i,targetElement:s,jsx:o})=>vx(e,r,{action:t,domConfig:n,lastDomConfig:i,targetElement:s,jsx:o})})}clearResources(e){(e=nt.asArray(e)).map(_s.asId).forEach((e=>{const t=this.resourceMap.get(e);t&&(t.invalid=!0);const n=this.scheduler.getRowById(e);n&&this.rowMap.delete(n)}))}clearAll({clearDom:e=!1,clearLayoutCache:t=!1}={}){const n=this,{layouts:r,foregroundCanvas:i}=n.scheduler;if(t&&r)for(const e in r)r[e].clearCache();if(i&&e){i.syncIdMap=i.lastDomConfig=i.releasedIdMap=null;for(const e of i.children)e.lastDomConfig=e.elementData=null}n.resourceMap.clear(),n.rowMap.clear()}}function vx(e,t,{action:n,domConfig:r,lastDomConfig:i,targetElement:s,jsx:o}){var a,l;const{reactComponent:d}=e,c=lx[n],u=dx[n];if(!c&&(null===(a=e.processEventContent)||void 0===a||a.call(e,{jsx:o,action:n,domConfig:r,targetElement:s,isRelease:c,reactComponent:d,scrolling:t})),"none"!==n&&null!=r&&null!==(l=r.elementData)&&void 0!==l&&l.isWrap){if(c&&null!=i&&i.elementData){var h;const{eventRecord:t,resourceRecord:n,assignmentRecord:r}=i.elementData,o={renderData:i.elementData,element:s,eventRecord:t,resourceRecord:n,assignmentRecord:r};null===(h=e.processEventContent)||void 0===h||h.call(e,{isRelease:c,domConfig:i,targetElement:s,reactComponent:d}),s===Yn.getActiveElement(s)&&e.focusElement.focus(),e.trigger("releaseEvent",o)}if(u){const{eventRecord:t,resourceRecord:i,assignmentRecord:o}=r.elementData,a={renderData:r.elementData,element:s,isReusingElement:"reuseElement"===n,isRepaint:"reuseOwnElement"===n,eventRecord:t,resourceRecord:i,assignmentRecord:o};"reuseElement"===n&&e.isAnimating&&Yn.addTemporaryClass(s,"b-reusing-own",50,e,`b-reusing-own-${(o||t).id}`),e.trigger("renderEvent",a)}}}fx._$name="HorizontalRendering";class yx extends(HE()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,n){const r=this,i=r.scheduler.getResourceWidth(t,n),{barMargin:s,resourceMarginObject:{start:o,total:a}}=r.scheduler.getResourceLayoutSettings(t,n),l=r.scheduler.getEventLayout(t,n).type;return r.packEventsInBands(e,((e,t,n,d)=>{if("none"===l)e.width=i-a,e.left+=o;else{e.widthFactor=d;const r=e.leftFactor=n.start+t*d,c=Math.round(1/d),u=r/d,h=i-a-s*(c-1);"mixed"===l&&2===c?(e.left+=r*i/5+s,e.width=i-r*i/5-2*s,e.zIndex=5+u):(e.width=d*h,e.appliedMargin=o+s*u,e.left+=r*h+e.appliedMargin)}e.cls["b-sch-event-narrow"]=e.width<r.scheduler.narrowEventWidth}))}}yx._$name="VerticalLayout";const bx={releaseElement:1,reuseElement:1},Cx={newElement:1,reuseOwnElement:1,reuseElement:1},wx={startDate:1,endDate:1,duration:1},Sx=Object.freeze({});class Dx extends(Qe.mixin(Hi,ax)){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new yx({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t,resourceColumns:n}=e;n.resourceStore=e.resourceStore,n.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),n.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const n=this,{scheduler:r}=n,i=e.nodeType?null:e,s=i?i.target:e,o=i?[i.borderOffsetX,i.borderOffsetY]:t,a=(s.nodeType===Element.TEXT_NODE?s.parentElement:s).closest(r.eventSelector);if(a)return r.resourceStore.getById(a.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!o)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser\n                event instead of element to extract element and coordinates from");if(r.variableColumnWidths||r.resourceStore.isGrouped){let e=0;for(const t of n.resourceStore)if(t.isSpecialRow||(e+=r.getResourceWidth(t)),e>=o[0])return t;return null}const l=Math.floor(o[0]/n.resourceColumns.columnWidth);return n.allResourceRecords[l]}toggleCls(e,t,n=!0,r=!1){var i;const s=null===(i=this.eventMap.get(e.eventId))||void 0===i?void 0:i[e.resourceId];if(s){s.renderData[r?"wrapperCls":"cls"][t]=n;const i=this.client.getElementFromAssignmentRecord(e,r);i&&i.classList[n?"add":"remove"](t)}}getDateFromXY(e,t,n,r=!1){let i=e[1];return n||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,r)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(e,t){var n;const r=e.id,i=t.id;let{renderData:s}=(null===(n=this.eventMap.get(r))||void 0===n?void 0:n[i])||Sx;var o;s||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(i)),s=null===(o=this.eventMap.get(r))||void 0===o||null===(o=o[i])||void 0===o?void 0:o.renderData);return s?new Ot(s.left,s.top,s.width,s.bottom-s.top):null}getScheduleRegion(e,t,n){var r;const i=this,{scheduler:s}=i,o=Ot.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(o.left=i.allResourceRecords.indexOf(e)*s.resourceColumnWidth,o.right=o.left+s.resourceColumnWidth);const a=s.timeAxis.startDate,l=s.timeAxis.endDate,d=(null===(r=s.getDateConstraints)||void 0===r?void 0:r.call(s,e,t))||{start:a,end:l},c=s.getCoordinateFromDate(xi.max(a,d.start)),u=s.getCoordinateFromDate(xi.min(l,d.end));return n?(o.top=c,o.bottom=u):(o.top=i.translateToPageCoordinate(c),o.bottom=i.translateToPageCoordinate(u)),o}getRowRegion(e,t,n){const{scheduler:r}=this,i=this.allResourceRecords.indexOf(e)*r.resourceColumnWidth,s=r.timeAxis.startDate,o=r.timeAxis.endDate,a=t?xi.max(s,t):s,l=n?xi.min(o,n):o,d=r.getCoordinateFromDate(a),c=r.getCoordinateFromDate(l,!0,!0),u=Math.min(d,c),h=Math.abs(d-c);return new Ot(i,u,r.resourceColumnWidth,h)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,n=e.scrollable.clientHeight,r=e.getDateFromCoordinate(t)||e.timeAxis.startDate,i=e.getDateFromCoordinate(t+n)||e.timeAxis.endDate;return{startDate:r,endDate:i,startMS:r.getTime(),endMS:i.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:t}){const n=this,{scheduler:r}=n;n.resourceColumns.width=r.timeAxisColumn.width=n.allResourceRecords.length*e,n.clearAll(),n.refresh(Math.abs(e-t)>30),r.onVisibleResourceColumnChange(e,t)}attachToProject(e){super.attachToProject(e),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:n}=e;t.isVisible?t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):n.size&&e.refresh(),n.clear()):t.whenVisible("refresh",t,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:e}){for(const t of this.client.getElementsFromEventRecord(e))t.classList.remove("b-iscreating")}onEventStoreRefresh({action:e}){"batch"===e&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t=[],record:n,replaced:r,changes:i,isAssign:s}){const o=this,a=new Set;switch(t.forEach((e=>{var t;const n=null===(t=e.$linkedResources)||void 0===t?void 0:t.filter((e=>o.resourceStore.includes(e)));null==n||n.forEach((e=>a.add(e.id)))})),e){case"sort":case"group":case"move":case"remove":case"batch":return;case"dataset":return void o.refreshAllResourcesWhenReady();case"add":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>a.add(e.id)))})),o.clearResources(a);break;case"removeall":case"filter":return o.clearAll(),void o.refresh();case"update":{let e=0;return"startDate"in i&&e++,"endDate"in i&&e++,"duration"in i&&e++,void((!(n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!wx[e])))||e||"percentDone"in i||"inactive"in i||"segments"in i)&&(o.shouldWaitForInitializeAndEngineReady?o.refreshResourcesWhenReady(a):(o.clearResources(a),o.refresh())))}}o.refreshResourcesWhenReady(a)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&t.scheduler.isPainted&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:n=[],record:r,replaced:i,changes:s}){const o=this,a=i?i.map((e=>e[1])):n,l=new Set(a.map((e=>e.id)));o.firstResource=o.lastResource=null,e._allResourceRecords=null;const{allResourceRecords:d}=e;if(o.scheduler.isEngineReady){switch(t){case"update":null!=s&&s.id?o.clearResources([s.id.oldValue,s.id.value]):o.clearResources([r.id]);break;case"filter":o.clearAll()}s&&"columnWidth"in s&&(r.instanceMeta(o.scheduler).columnWidth=r.columnWidth,o.clearAll()),o.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":return void o.refreshAllResourcesWhenReady();case"replace":case"add":if(!e.isGrouped){const e=a.reduce(((e,t)=>Math.min(e,d.indexOf(t))),d.length);for(let t=e;t<d.length;t++)l.add(d[t].id)}}o.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;"sort"!==e&&"group"!==e||(t.firstResource=t.lastResource=t.resourceStore._allResourceRecords=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t=[],replaced:n,changes:r}){const i=this,s=new Set(t.map((e=>e.resourceId)));if(i.scheduler.isEngineReady){switch(e){case"add":case"remove":i.clearResources(s);break;case"filter":i.clearAll();break;case"update":if("resourceId"in r&&s.add(r.resourceId.oldValue),!Object.keys(r).filter((e=>"resource"!==e&&"event"!==e)).length)return;i.clearResources(s)}i.refresh(!0)}else{switch(r&&"resourceId"in r&&s.add(r.resourceId.oldValue),e){case"removeall":return void i.refreshAllResourcesWhenReady();case"replace":n.forEach((([e,t])=>{s.add(e.resourceId),s.add(t.resourceId)}))}i.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e,t){t&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){const{resourceColumns:t}=this.scheduler;this.renderResource(e),"layoutFn"===this.scheduler.internalEventLayout.type&&(t.updateWidthCache(),t.refresh())}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.fromScroll=!0,this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.fromScroll=!0,this.renderer()}scrollResourceIntoView(e,t){const{scheduler:n}=this,r=this.allResourceRecords.indexOf(e)*n.resourceColumnWidth;return n.scrollHorizontallyTo(r,t)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(e){this.resourceColumns.availableWidth!==e&&(this.resourceColumns.availableWidth=e,this.scheduler.refreshVirtualScrollbars()),this.renderer()}get resourceColumns(){var e;return null===(e=this.scheduler.timeAxisColumn)||void 0===e?void 0:e.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:t}=this.getResourceRange();return{first:this.allResourceRecords[e],last:this.allResourceRecords[t]}}getResourceRange(e){const{scheduler:t,resourceStore:n}=this,{resourceColumnWidth:r,scrollX:i}=t,{scrollWidth:s}=t.timeAxisSubGrid.scrollable,o=e?this.resourceBufferSize:0,a=i-o,l=i+s+o;if(null==n||!n.count)return{first:-1,last:-1};if(t.variableColumnWidths){let e,n,r=0,i=0;return this.allResourceRecords.forEach(((s,o)=>{if(s.instanceMeta(t).insetStart=n=i,i=n+t.getResourceWidth(s),n>l)return!1;i>a&&null==e?e=o:n<l&&(r=o)})),{first:e,last:r}}return{first:Math.max(Math.floor(i/r)-o,0),last:Math.min(Math.floor((i+t.timeAxisSubGrid.width)/r)+o,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let n=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return n||(n=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:n,bottomDate:t}}getTimeSpanRenderData(e,t,n=!1){var r;const i=this,{scheduler:s}=i,{preamble:o,postamble:a}=e,{variableColumnWidths:l}=s,d=(null===(r=s.features.eventBuffer)||void 0===r?void 0:r.enabled)&&i.isProVerticalRendering&&(o||a)&&!e.isMilestone,c=d?"wrapStartDate":"startDate",u=d?"wrapEndDate":"endDate",h=e.isBatchUpdating&&e.hasBatchedChange(c)&&!d?e.get(c):e[c],g=e.isBatchUpdating&&e.hasBatchedChange(u)&&!d?e.get(u):e[u],{resourceMarginObject:{total:m}}=s.getResourceLayoutSettings(t),p=s.getCoordinateFromDate(h),f=t.instanceMeta(s),v=l?f.insetStart:i.allResourceRecords.indexOf(t)*s.resourceColumnWidth,y=s.getResourceWidth(t),b=y-m,C=h.getTime(),w=g.getTime();let S=s.getCoordinateFromDate(g),D=S-p;return-1===S&&(D=Math.round((w-C)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),S=p+D),{eventRecord:e,resourceRecord:t,left:v,top:p,bottom:S,resourceWidth:y,width:b,height:D,startDate:h,endDate:g,startDateMS:C,endDateMS:w,useEventBuffer:d,children:[],start:h,end:g,startMS:C,endMS:w}}eventSorter(e,t){const n=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}layoutEvents(e,t,n=!1,r,i){const s=this,{scheduler:o}=s,{variableColumnWidths:a}=o,{id:l}=e,d=e.instanceMeta(o),c=r?`${l}-${r.id}`:l,u=s.resourceMap.set(c,{}).get(c),h=s.allResourceRecords.indexOf(e),g=t.reduce(((t,n)=>{if(n.isScheduled){const r=o.generateRenderData(n,e,!1),i={renderData:r};W.getMapPath(s.eventMap,r.eventId,{})[l]=i,u[r.eventId]=i,r.fillSize?(r.left=a?d.insetStart:h*o.resourceColumnWidth,r.width=o.getResourceWidth(e)):t.push(r)}return t}),[]);return g.sort(i??s.eventSorter),s.verticalLayout.applyLayout(g,e,r),u}layoutResourceEvents(e,t,n){const{scheduler:r}=this,{assignmentStore:i,eventStore:s,timeAxis:o}=r;let a=s.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:t??o.startDate,endDate:n??o.endDate,filter:(i.isFiltered||s.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e&&i.includes(t))))});return a=r.getEventsToRender(e,a),this.layoutEvents(e,a)}addTemporaryDragElement(e){const{scheduler:t}=this,n=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});n.top=n.row?n.top+n.row.top:t.getResourceEventBox(e,e.resource,!0).top;const r=this.renderEvent({renderData:n}),{dataset:i}=r;delete r.tabIndex,delete i.eventId,delete i.resourceId,delete i.assignmentId,delete i.syncId,i.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const s=Yn.createElement(r,{reactCallback({jsx:e,domConfig:n,targetElement:r}){var i;const{reactComponent:s}=t;e&&(null===(i=t.processEventContent)||void 0===i||i.call(t,{jsx:e,action:"add",domConfig:n,targetElement:r,isRelease:!1,reactComponent:s}))}});return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:t}=this,n=e.renderData,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=n,o={className:n.wrapperCls,tabIndex:-1,"aria-label":n.wrapperCls["b-active"]?n.ariaLabel:void 0,children:[{role:"presentation",className:n.cls,style:(n.internalStyle||"")+(n.style||""),children:n.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...n.wrapperChildren],style:{top:n.top,[t.rtl?"right":"left"]:n.left,height:s.isMilestone?"1em":n.height,width:n.width,style:n.wrapperStyle||"",fontSize:s.isMilestone?Math.min(n.width,40):null},dataset:{resourceId:r.id,eventId:n.eventId,syncId:i?this.assignmentStore.getOccurrence(i,s).id:n.eventId},elementData:e,retainElement:(i||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return o.className["b-sch-vertical"]=1,n.zIndex&&(o.style.zIndex=n.zIndex),i&&(o.dataset.assignmentId=i.id),n.elementConfig=e.elementConfig=o,t.afterRenderEvent({renderData:n,domConfig:o}),o}renderResource(e,t,n){const r=this,i=(null==t?void 0:t.getTime())??r.topDateMS,s=(null==n?void 0:n.getTime())??r.bottomDateMS,o=[];let a=r.resourceMap.get(e.id);a||(a=r.layoutResourceEvents(e,t,n));for(const e in a){const t=a[e],{endDateMS:n,startDateMS:d,eventRecord:c}=t.renderData;if(n>=i&&d<=s&&!c.instanceMeta(r.scheduler).hasTemporaryDragElement){var l;const e="b-released"!==(null===(l=t.elementConfig)||void 0===l?void 0:l.className)&&t.elementConfig||r.renderEvent(t);o.push(e)}}return o}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const e=this,{scheduler:t}=e,{topDate:n,bottomDate:r}=e.dateRange,i=[],s=[],o={event:[]},{allResourceRecords:a,fromScroll:l}=e;let{first:d,last:c}=e.resourceRange;if(!e.shouldWaitForInitializeAndEngineReady){if(!xi.isEqual(n,e.topDate)||!xi.isEqual(r,e.bottomDate)){e.topDate=n,e.bottomDate=r,e.topDateMS=n.getTime(),e.bottomDateMS=r.getTime();const i=e.timeView.range={startDate:n,endDate:r};t.internalOnVisibleDateRangeChange(i)}if(-1!==d&&-1!==c){if("layoutFn"===t.internalEventLayout.type&&void 0!==d)e.renderResourceCustomLayout(i);else for(let t=d;t<=c;t++)i.push.apply(i,e.renderResource(a[t]));const{resourceRange:n}=e;d=n.first,c=n.last}t.getForegroundDomConfigs(s),i.push.apply(i,s);for(const e of i){const{entityName:t="event"}=e.elementData.renderData;o[t]||(o[t]=[]),o[t].push(e)}for(const e in o)ud.sync({domConfig:{onlyChildren:!0,children:o[e]},targetElement:t.canvases[e],syncIdField:"syncId",releaseThreshold:t.eventReleaseThreshold,callback({action:e,domConfig:n,lastDomConfig:r,targetElement:i,jsx:s}){Ex(t,l,{domConfig:n,jsx:s,action:e,targetElement:i,lastDomConfig:r})}});if(e.firstResource!==d||e.lastResource!==c){const n=e.resourceColumns.visibleResources={firstResource:d,lastResource:c};e.firstResource=d,e.lastResource=c,t.onVisibleResourceRangeChange(n),t.trigger("resourceRangeChange",n)}this.fromScroll=!1}}refresh(e){this.scheduler.runWithTransition((()=>this.renderer()),e)}refreshResources(e){e=e.map((e=>e.id??e)),this.clearResources(e),this.refresh()}refreshEventsForResource(e,t=!0,n=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:t,eventMap:n}=this;e.forEach((e=>{t.has(e)&&(Object.values(t.get(e)).forEach((({renderData:{eventId:t}})=>{delete n.get(t)[e]})),t.delete(e))}))}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}}function Ex(e,t,{domConfig:n,jsx:r,action:i,targetElement:s,lastDomConfig:o}){var a;const{reactComponent:l}=e;if(e.isEventElement(n)||r||null!=n&&null!==(a=n.elementData)&&void 0!==a&&a.jsx){var d;const a=bx[i],u=Cx[i];if(null!==(d=e.processEventContent)&&void 0!==d&&d.call(e,{action:i,domConfig:n,isRelease:!1,targetElement:s,reactComponent:l,jsx:r,scrolling:t}))return;if(a&&e.isEventElement(o)&&!o.isReleased){var c;const t=o.elementData.renderData,n={renderData:t,assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord,element:s};null===(c=e.processEventContent)||void 0===c||c.call(e,{isRelease:a,domConfig:o,targetElement:s,reactComponent:l}),s===Yn.getActiveElement(s)&&e.focusElement.focus(),e.trigger("releaseEvent",n)}if(u){const t=n.elementData.renderData,r={renderData:t,assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord,element:s,isReusingElement:"reuseElement"===i,isRepaint:"reuseOwnElement"===i};r.reusingElement="reuseElement"===i,e.trigger("renderEvent",r)}}}function xx(e,t){return e===t.length-1}function Rx(e,t){return t===e.cells[e.cells.length-1]}Dx._$name="VerticalRendering";class Tx extends oc{static $name="TimeAxisBase";static configurable={compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null};startDate=null;endDate=null;levels=[];size=null;set range({startDate:e,endDate:t}){const n=this;if(n.startDate-e||n.endDate-t){var r;const{client:i}=n;if(n.startDate=e,n.endDate=t,"width"===n.sizeProperty&&null!=i&&i.hideHeaders||"height"===n.sizeProperty&&null!=i&&null!==(r=i.verticalTimeAxisColumn)&&void 0!==r&&r.hidden)return;n.refresh()}}buildCells(e=this.startDate,t=this.endDate){var n;const r=this,{sizeProperty:i}=r,{stickyHeaders:s,isVertical:o}=r.client||{},a=[],{length:l}=r.levels,d=r.levels.map(((n,a)=>{var d;const c=s&&(o||a<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${n.position}`]:1,"b-sch-header-row-main":a===r.model.viewPreset.mainHeaderLevel,"b-lowest":xx(a,r.levels),"b-sticky-header":c},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${a}`,headerPosition:n.position},children:null===(d=n.cells)||void 0===d?void 0:d.filter((n=>n.start<t&&n.end>e)).map(((e,t)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[e.headerCellCls]:e.headerCellCls,[`b-align-${e.align}`]:e.align,"b-last":Rx(n,e)},dataset:{tickIndex:e.index,...globalThis.DEBUG&&{date:e.start.getTime()}},style:{[r.positionProperty]:e.coord,[i]:e.width,[`min-${i}`]:e.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":c},html:e.value}]})))}}));return null===(n=r.client)||void 0===n||n.getHeaderDomConfigs(a),d.push(...a),{onlyChildren:!0,syncOptions:{releaseThreshold:0},children:d}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:n}=t.model,{levels:r}=t,i=r.length;if(e){r.length=0,n.forEach(((e,t)=>r[t]={position:t,cells:e})),t.size=r[0].cells.reduce(((e,t)=>e+t.width),0);const{parentElement:s}=t.element;s&&(r.length!==i||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${i}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}t.startDate&&t.endDate&&(ud.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}Tx._$name="TimeAxisBase";class Mx extends Tx{static $name="HorizontalTimeAxis";static type="horizontaltimeaxis";static configurable={model:null,sizeProperty:"width"};get positionProperty(){return"insetInlineStart"}get width(){return this.size}onModelUpdate(){var e;(null===(e=this.owner)||void 0===e||!e.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}}Mx._$name="HorizontalTimeAxis";class kx extends oc{static $name="ResourceHeader";static type="resourceheader";static configurable={resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null};firstResource=-1;lastResource=-1;construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),null!=t.imagePath&&t.element.classList.add("b-has-images"),Jt.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return null===(t=this.avatarRendering)||void 0===t||t.destroy(),e&&(this.avatarRendering=new Sv({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:n}=t,r=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),r!==t.width&&(Yn.setLength(n,"width",r),t.column.set("width",r,t.column.grid.isConfiguring)),"removeall"===e&&(n.innerHTML=""),("remove"===e||"add"===e||"filter"===e||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach((n=>{const r=n.instanceMeta(t);null==r.columnWidth&&n.columnWidth&&(r.columnWidth=n.columnWidth),r.insetStart=e,r.insetEnd=e+t.getResourceWidth(n),null==r.columnWidth?e+=t.resourceColumnWidth:(e+=r.columnWidth,t.variableColumnWidths=!0)})),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const n=this;n.refreshingWidths||n.refreshWidths(),n.isConfiguring||(n.resourceStore.isGrouped&&n.updateWidthCache(),n.refresh(),n.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return N.joinPaths([this.imagePath||"",e||""])+(null!=e&&e.includes(".")?"":this.imageExtension)}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:n,configuredColumnWidth:r}=t,i=null===(e=t.resourceStore)||void 0===e?void 0:e.count;if(!n||!i||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const s=t.fitWidth||t.fillWidth&&r*i<n?Math.floor(n/i):r,o=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-s)>30;Yn.addTemporaryClass(t.element,"b-animating",o?300:0,t),t.columnWidth=s,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){const e=this,{firstResource:t,scheduler:n,resourceStore:r,lastResource:i}=e,s=r.isGrouped&&r.groupers[0].field;e.element.classList.toggle("b-grouped",Boolean(s));const o=e.renderResourceHeaders(t,i);ud.sync({domConfig:{onlyChildren:!0,children:o},targetElement:e.element,syncIdField:"resourceId",callback:({jsx:e,targetElement:t,domConfig:r})=>{var i;null===(i=n.processResourceHeader)||void 0===i||i.call(n,{jsx:e,targetElement:t,domConfig:r})}})}renderResourceHeaders(e,t){const n=this,{scheduler:r,resourceStore:i}=n,{variableColumnWidths:s}=r,o=i.isGrouped&&i.groupers[0].field,a=[];if(!n.column.grid.isConfiguring&&e>-1&&t>-1&&t<i.count){let u;for(let h=e;h<=t;h++){var l;const e=i.allResourceRecords[h],t=e.instanceMeta(i).groupParent,g=null==t?void 0:t.groupChildren;if(o&&t.id!==(null===(l=u)||void 0===l?void 0:l.dataset.resourceId)){var d;const n=g[0].instanceMeta(r).insetStart,s=g[g.length-1].instanceMeta(r).insetEnd-n,l=null===(d=r.features.group)||void 0===d?void 0:d.renderer;let c=g[0][o],h="text";if(l){const t=e.instanceMeta(i).groupParent,n=t.meta,s=n.groupRowFor,o=n.childCount;c=r.features.group.groupRenderer({groupRowFor:s,groupRecords:t.groupChildren,count:o}),"string"==typeof c&&c.includes("<")?h="html":"object"==typeof c&&(h="children",c=[c])}u={className:"b-resourceheader-group-cell",dataset:{resourceId:t.id},style:{left:n,width:s},children:[{className:"b-resourceheader-group-text-wrap",children:Array.isArray(c)?c:[{tag:"span",[h]:c}]},{className:"b-resourceheader-group-children",children:[]}]},a.push(u)}const m=e.instanceMeta(r),p=m.columnWidth||n.columnWidth,f=o?m.insetStart-u.style.left:s?m.insetStart:h*n.columnWidth,v={tabIndex:0,className:new Vt({"b-resourceheader-cell":1}),dataset:{resourceId:e.id},style:{[r.rtl?"right":"left"]:f,width:p},children:[]};if(n.headerRenderer){const t=n.headerRenderer({elementConfig:v,resourceRecord:e});t&&("string"==typeof t?v.html=t:"object"==typeof t&&(v.children=[t]))}else{let t;if(e.imageUrl)t=e.imageUrl;else if(null!=n.imagePath&&!1!==e.image){var c;const r=e.image||(null===(c=e.name)||void 0===c?void 0:c.toLowerCase());t=r&&n.getImageURL(r)}v.children.push(n.showAvatars&&n.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,defaultImageUrl:n.defaultImageName&&n.getImageURL(n.defaultImageName),imageUrl:t}),{tag:"span",className:"b-resource-name",html:N.encodeHtml(e.name)})}o?u.children[1].children.push(v):a.push(v)}}return a}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),n=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+N.capitalize(e.type),{resourceRecord:n,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}}kx._$name="ResourceHeader";class Fx extends(lt(Pv)){headerHoverable=!1;static $name="TimeAxisColumn";static type="timeAxis";static fields=[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"];static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,ariaLabel:null,mode:null,region:"normal",exportable:!1,htmlEncode:!1,id:"timeaxiscolumn"}}construct(e){const t=this;e.disableRendererWarning=!0,super.construct(...arguments),t.thisObj=t,t.grid._timeAxisColumn=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.ion({paint:"onTimelinePaint",thisObj:t,once:!0}),Cr.ion({locale:t.updateHeaderAriaLabel,thisObj:t})}static get autoExposeFields(){return!0}updateHeaderAriaLabel(){const{grid:e}=this,{visibleDateRange:t}=e,n=xi.format(null==t?void 0:t.startDate,e.displayDateFormat),r=xi.format(null==t?void 0:t.endDate,e.displayDateFormat);return super.updateHeaderAriaLabel(this.L(this.ariaLabel||"L{TimeAxisColumn.ariaLabel}")(n,r))}doDestroy(){var e,t;null===(e=this.resourceColumns)||void 0===e||e.destroy(),null===(t=this.timeAxisView)||void 0===t||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:n}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new Mx({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:n,client:n}):"vertical"===e&&(t.resourceColumns=kx.new({column:t,scheduler:n,resourceStore:n.resourceStore,imagePath:n.resourceImagePath,imageExtension:n.resourceImageExtension,defaultImageName:n.defaultResourceImageName},n.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;t.grid.timeAxisSubGrid.collapsed||0===e.totalSize||("horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):"vertical"===t.mode&&t.grid.refreshRows())}onTimelinePaint({firstPaint:e}){const t=this;var n;t.subGrid.insertRowsBefore&&(e&&(t.updateHeaderAriaLabel(),t.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===t.mode&&(t.refreshHeader(),null===(n=t.grid)||void 0===n||n.onHeightChange())))}onCellFocus(){this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel"))}refreshHeader(e){const t=this,{element:n}=t;n&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(void 0,void 0,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(n.querySelector(".b-grid-header-text").remove(),t.timeAxisView.render(n))):"vertical"===t.mode&&(t.resourceColumns.currentElement?t.resourceColumns.refresh():(n.innerHTML="",t.resourceColumns.render(n))))}defaultRenderer(e){var t;const{grid:n}=this;if(!n.isTimelineHistogramBase)return n.project.isInitialCommitPerformed||n.project.isDelayingCalculation||null!==(t=n.eventStore)&&void 0!==t&&t.lazyLoad?(n.currentOrientation.renderer(e),super.defaultRenderer(e)):""}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const t=this;t.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}}kv.registerColumnType(Fx),Fx._$name="TimeAxisColumn";class Ix extends Tx{static $name="VerticalTimeAxis";static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:t}=e,n=null==t?void 0:t.stickyHeaders,r=[],i=e.levels.reduce(((t,r,i)=>{var s;r.cells&&t.push(...null===(s=r.cells)||void 0===s?void 0:s.filter((t=>t.start<e.endDate&&t.end>e.startDate)).map(((t,r,s)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[t.headerCellCls]:t.headerCellCls,[`b-align-${t.align}`]:t.align,"b-last":r===s.length-1,"b-lowest":i===e.levels.length-1},dataset:{tickIndex:t.index,cellId:`${i}-${t.index}`,headerPosition:i,...globalThis.DEBUG&&{date:t.start.getTime()}},style:{top:t.coord,height:t.width,minHeight:t.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":n},html:t.value}]}))));return t}),[]);return null==t||t.getHeaderDomConfigs(r),i.push(...r),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:i}}get height(){return this.size}}Ix._$name="VerticalTimeAxis";class Ax extends Rv{static $name="VerticalTimeAxisColumn";static type="verticalTimeAxis";static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1,ariaLabel:null}}updateHeaderAriaLabel(){const{grid:e}=this,{visibleDateRange:t}=e,n=xi.format(null==t?void 0:t.startDate,e.displayDateFormat),r=xi.format(null==t?void 0:t.endDate,e.displayDateFormat);return super.updateHeaderAriaLabel(this.L(this.ariaLabel||"L{TimeAxisColumn.ariaLabel}")(n,r))}get isFocusable(){return!0}construct(e){const t=this;super.construct(...arguments),t.view=new Ix({model:t.grid.timeAxisViewModel,client:t.grid}),t.grid.ion({paint:"onTimelinePaint",thisObj:t,once:!0}),Cr.ion({locale:t.updateHeaderAriaLabel,thisObj:t})}defaultRenderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.id,delete t.region,delete t.type,delete t.field,delete t.ariaLabel,delete t.cellAriaLabel,t}onTimelinePaint({firstPaint:e}){e&&this.updateHeaderAriaLabel()}}kv.registerColumnType(Ax),Ax._$name="VerticalTimeAxisColumn";const Lx={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},Px=(e,t)=>e&&t?e.unit===t.unit&&e.magnitude===t.magnitude:e===t,Ox=Object.freeze({});class $x extends(sw.mixin(sx,ox,AE,LE,PE,WE,GE,KE,BE,YE,XE,rx,kE,ix)){static $name="SchedulerBase";static type="schedulerbase";static configurable={localizableProperties:["autoCreate.newName"],date:{value:null,$config:{equal:"date"}},listRangeMenu:{$config:"lazy",value:{type:"rangemenu"}},shiftIncrement:{$config:{lazy:!0,equal:Px},value:null},range:{$config:{equal:Px},value:"week"},getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}"},scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",showEventColorPickers:null,updateTimelineContextOnScroll:!0};static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:RE,liveRedrawWhileMovingSplitterThreshold:100,eventContainerSelector:".b-timeaxissubgrid",testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}timeCellSelector=".b-sch-timeaxis-cell";resourceTimeRangeSelector=".b-sch-resourcetimerange";afterConstruct(){super.afterConstruct(),this.ion({scroll:"onVerticalScroll",splitterDragStart:"internalOnSplitterDragStart",thisObj:this})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const n=this;return n.isVertical?n.currentOrientation.visibleResources:{first:n.store.getById(null===(e=n.firstVisibleRow)||void 0===e?void 0:e.id),last:n.store.getById(null===(t=n.lastVisibleRow)||void 0===t?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}changeCreateEventOnDblClick(e){G.deprecate("scheduler","7.0.0","createEventOnDblClick is deprecated use autoCreate instead"),this.autoCreate=e}changeAutoCreate(e){if(e){const t=typeof e;"object"!==t&&(e={gesture:"string"===t?e:"dblclick"}),(e=ke.merge(e,$x.$meta.config.autoCreate)).duration&&(e.duration=xi.parseDuration(e.duration))}return e}updateAutoCreate(e,t){(null==e?void 0:e.gesture)!==(null==t?void 0:t.gesture)&&(this.detachListeners("scheduleAutoCreateGesture"),this.ion({name:"scheduleAutoCreateGesture",[`schedule${e.gesture}`]:"onScheduleAutoCreateGesture",thisObj:this})),t||this.updateLocalization()}async onScheduleAutoCreateGesture({domEvent:e,time:t,resourceRecord:n}){const r=this,i=r.autoCreate||Ox,s=i.snapType||"floor",{step:o}=i,a=o?xi[s](t,xi.parseDuration(o)):r.timeAxis[`${s}Date`](t);if(!1!==await r.trigger("beforeAutoCreate",{domEvent:e,date:a,resourceRecord:n}))return r.createEvent(a,n,!0)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}internalOnSplitterDragStart(){this.isHorizontal&&this.foregroundCanvas.syncIdMap&&Object.keys(this.foregroundCanvas.syncIdMap).length>this.liveRedrawWhileMovingSplitterThreshold&&(this.suspendRefresh(),this.ion({splitterDragEnd:()=>this.resumeRefresh(!0,!1),once:!0}))}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),"horizontal"===e?(t.horizontal=new fx(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new Dx(t),t.sortFeatureStore="resourceStore",t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}afterRenderEvent(){}get hasEventEditor(){return Boolean(this.eventEditingFeature)}get eventEditingFeature(){const{eventEdit:e,taskEdit:t,simpleEventEdit:n}=this.features;return null!=e&&e.enabled?e:null!=t&&t.enabled?t:null!=n&&n.enabled?n:null}async createEvent(e,t){var n;const r=this,{enableEventAnimations:i,eventStore:s,assignmentStore:o,hasEventEditor:a}=r,l=r.autoCreate||Ox,{newName:d,useEventModelDefaults:c}=l,u=(null==l?void 0:l.duration)||{magnitude:c?s.modelClass.defaultValues.duration??1:1,unit:c?s.modelClass.defaultValues.durationUnit??r.timeAxis.unit:r.timeAxis.unit},h=[t],g=s.createRecord({startDate:e,endDate:xi.add(e,u),duration:u.magnitude,durationUnit:u.unit,name:r.resolveCallback(d,r,!1)?r.callback(d,r,[r,e,t]):d});if(r.readOnly||t.isSpecialRow||t.readOnly||!r.isDateRangeAvailable(g.startDate,g.endDate,null,t))return;null===(n=r.eventEditingFeature)||void 0===n||n.captureStm(!0),g.isCreating=a,r.onEventCreated(g);const m=null==o?void 0:o.assignEventToResource(g,t);var p;if(!1===r.trigger("beforeEventAdd",{eventRecord:g,resourceRecords:h,assignmentRecords:m}))return null==o||o.remove(m),void(null===(p=r.eventEditingFeature)||void 0===p||p.freeStm(!1));r.enableEventAnimations=!1;const f=s.add(g);var v;if(r.project.commitAsync().then((()=>r.enableEventAnimations=i)),!f)return null==o||o.remove(m),void(null===(v=r.eventEditingFeature)||void 0===v||v.freeStm(!1));r.isCreating=!0,r.refreshRows(),r.isCreating=!1,await r.scrollEventIntoView(g),r.isDestroyed||(r.trigger("eventAutoCreated",{eventRecord:g,resourceRecord:t}),a&&r.editEvent(g,t,r.getEventElement(g)))}isDateRangeAvailable(e,t,n,r){return this.eventStore.isDateRangeAvailable({startDate:e,endDate:t,excludeEvent:n,resourceRecord:r,allowOverlap:this.allowOverlap})}async resumeRefresh(e=!0,t=!0){super.resumeRefresh(!1);const n=this;if(!n.refreshSuspended&&e){if(!n.isEngineReady)return n.currentOrientation.refreshAllWhenReady=!0,n.project.commitAsync();n.isDestroyed||(t?n.refreshWithTransition():n.refresh())}}refreshResource(e){this.refreshResources([e])}refreshResources(e){this.currentOrientation.refreshResources(e)}toggleEmptyText(){var e;Yn.toggleClasses(this.element,"b-grid-empty",!(this.resourceStore.count>0||null!==(e=this.crudManager)&&void 0!==e&&e.isLoading))}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){const{store:n}=this;for(const t of e)t&&n.isAvailable(t)&&this.getRowHeight(t);t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:n}=this,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){n.clearKnownHeights();for(let e=0;e<r;e++){const n=t.records[e];n&&this.getRowHeight(n)}e||n.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return"week"===e.range.unit&&t.push(e.lastDate),t}get description(){const e=this,{startDate:t,endDate:n}=e;if(!e.resolveCallback("descriptionRenderer",e,!1)&&"day"===e.range.unit&&n-t&&!xi.isStartOf(t,"d")&&!xi.isStartOf(n,"d")){const e=xi.getMonthName(t.getMonth()),r=xi.getMonthName(n.getMonth()),i=e!==r?`${r} `:"";return`${e} ${t.getDate()} - ${i}${n.getDate()}, ${n.getFullYear()}`}return super.description}get defaultDescriptionFormat(){return Lx[this.range.unit]}get lastDate(){const{endDate:e}=this;if(e)return xi.isStartOf(e,"d")?xi.add(e,-1,"day"):e}getEventRecord(e){return e=Yn.getEventElement(e),this.resolveEventRecord(e)}getResourceRecord(e){return this.resolveResourceRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeListRangeMenu(e){if(e)return sw.mergeConfigs({view:this},e)}changeRange(e){if(e)if("string"==typeof e){const t=xi.parseTimeUnit(e);e=t?{magnitude:1,unit:t}:xi.parseDuration(e)}else if("number"==typeof e)return{magnitude:e,unit:"day"};return e}updateRange(e){if(!this.isConfiguring){const t=this.date,n=this.date=xi.clamp(t,xi.floor(t,e),xi.ceil(t,e));t.getTime()===n.getTime()&&this.updateDate(n,t,!0)}}changeShiftIncrement(e){return this.changeRange(e)}updateShiftIncrement(e,t){this.trigger("shiftIncrementChange",{old:e,new:t})}get shiftIncrement(){return this._shiftIncrement||this.range}get stepUnit(){const{shiftIncrement:e}=this;return 1===e.magnitude?xi.getLocalizedNameOfUnit(e.unit):`${e.magnitude} ${xi.getLocalizedNameOfUnit(e.unit,!0)}`}set stepUnit(e){G.deprecate("scheduler","7.0.0","changeStepUnit is deprectaed use shiftIncrement instead"),this.shiftIncrement=e}async updateDate(e,t,n){var r;const i=this,{timeAxis:s,vertical:o,range:a,workingTime:l}=i,d=xi.clearTime((null===(r=i.visibleDateRange)||void 0===r?void 0:r.startDate)||e),c=n?d:e,{startDate:u}=s,h=xi.floor(u,a),g=xi.add(h,a),m=i.isShifting?i.shiftIncrement:i.range,p=xi.floor(u,m,u),f=xi.add(p,a),v={[o?"x":"y"]:!1,animate:!0,block:e<p?"start":e>=f?"end":"nearest"},y=i.timeAxisColumn.width;if(n||!xi.betweenLesser(e,h,g)){const t=xi.floor(e,a),r=xi.add(t,a);l&&(t.setHours(l.fromHour),r.setHours(l.toHour-24)),Object.assign(v,{animate:!1,block:"start",edgeOffset:n?{start:i.getCoordinateFromDate(d)-i.timelineScroller.position}:0}),i.setTimeSpan(t,r),i.timeAxisColumn.width<y&&await dt.sleep(0)}if(i._date=xi.clamp(e,s.startDate,s.endDate),!i.preventScroll)if(i.isConfiguring)i.visibleDate={date:i._date,block:"start",animate:i.isPainted};else{const e=i.getCoordinateFromDate(c,!1),t=i.getCoordinateFromDate(xi.min(xi.add(c,1,"d"),s.endDate),!1),n=Math.abs((-1===t?i.timelineScroller.scrollSize:t)-e),r=o?new Ot(0,e,1,n):new Ot(i.rtl?t:e,0,Math.abs(n),1);i.timelineScroller.scrollIntoView(r,v)}i.trigger("descriptionChange")}updateScrollBuffer(e){this.isConfiguring||(this.currentOrientation.scrollBuffer=e)}previous(){this.move(-1)}next(){this.move(1)}move(e=1){e=Math.sign(e);const t=this,{shiftIncrement:n}=t;n&&(t.isShifting=!0,t.date=xi.add(t.date,{unit:n.unit,magnitude:e*n.magnitude}),t.isShifting=!1)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:n,element:r}){const i=this;if(i.eventStore.includes(t)||([t]=i.eventStore.add(t)),t.beginBatch(),t.startDate=e,t.assign(n),t.endBatch(),r){const e=Ot.from(r,i.foregroundCanvas);Yn.setTranslateXY(r,0,0),Yn.setTopLeft(r,e.y,e.x),ud.addChild(i.foregroundCanvas,r,t.assignments[0].id)}return await i.project.commitAsync(),t}internalGetAssignmentsToHighlight(e){const{eventStore:t,assignmentStore:n,resourceStore:r}=this,{usesSingleAssignment:i}=t;return nt.asArray(e).reduce(((e,s)=>{var o,a;return null!==(o=s=(i&&!s.isModel||s.isEvent?t:n).getById(s))&&void 0!==o&&o.isEvent?e.push(...s.assignments.filter((e=>e.resource.stores.includes(r)))):null!==(a=s)&&void 0!==a&&a.isAssignment&&s.resource.stores.includes(r)&&e.push(s),e}),[])}}$x.initClass(),$x._$name="SchedulerBase";class _x extends rp{static $name="EventColorPicker";static type="eventcolorpicker";static configurable={colorClasses:$x.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null,records:null};updateRecord(e){e&&(G.deprecate("scheduler","7.0.0","record config is deprecated in favor of records"),this.records=[e])}colorSelected({color:e}){this.records&&this.records.forEach((t=>t.eventColor=e))}}_x.initClass(),_x._$name="EventColorPicker";class Hx extends ip{static $name="EventColorField";static type="eventcolorfield";static configurable={picker:{type:"eventcolorpicker"},name:"eventColor"}}Hx.initClass(),Hx._$name="EventColorField";class Vx extends $v{static $name="EventColorColumn";static type="eventcolor";static defaults={editor:"eventcolorfield",field:"eventColor"}}kv.registerColumnType(Vx),Vx._$name="EventColorColumn";class Nx extends Rv{static $name="ResourceCollapseColumn";static type="resourceCollapse";static fields=[{name:"ariaLabel",defaultValue:"L{ResourceCollapseColumn.toggleResourceLayout}"}];static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e,column:t})=>({tag:"button","aria-label":t.L("L{ResourceCollapseColumn.toggleResourceLayout}"),class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":"none"!==e.eventLayout}})}}onCellClick({record:e,event:t}){!e.isSpecialRow&&t.target.classList.contains("b-icon")&&(t.preventDefault(),e.eventLayout="none"!==e.eventLayout?"none":"stack")}}kv.registerColumnType(Nx),Nx._$name="ResourceCollapseColumn";class Bx extends Rv{static $name="ResourceInfoColumn";static type="resourceInfo";static get fields(){return["showEventCount","showRole","showMeta","showImage","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",width:140,cellCls:"b-resourceinfo-cell",editor:!G.isTestEnv&&"text"}}construct(...e){super.construct(...e),this.avatarRendering=new Sv({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const t=this.grid.resourceImagePath||"",n=t.split("//"),r=n.length>1?n[1]:t,i=N.joinPaths([r||"",e||""]);return n.length>1?n[0]+"//"+i:i}template(e,t){const n=this,{showImage:r,showRole:i,showMeta:s,showEventCount:o,grid:a}=n,{timeAxis:l,resourceImageExtension:d="",defaultResourceImageName:c}=a,u="string"==typeof i?i:"role",h=o&&e.eventStore.getEvents({includeOccurrences:a.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length,g=!1!==e.showAvatar;let m;if(g&&r&&!1!==e.image)if(e.imageUrl)m=e.imageUrl;else{const i="string"==typeof r?r:e.image||t&&n.useNameAsImageName&&t.toLowerCase()+d||c||"";m=i&&n.getImageURL(i),m&&!i.includes(".")&&(m+=d)}return{class:{"b-resource-info":1,"b-no-avatar":!g},children:[r&&g&&n.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:m,defaultImageUrl:c&&this.getImageURL(c)}),i||o||s?{tag:"dl",children:[{tag:"dt",text:t},i?{tag:"dd",class:"b-resource-role",text:e.getValue(u)}:null,o?{tag:"dd",class:"b-resource-events",text:n.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:n.showMeta(e)}:null]}:t]}}defaultRenderer({grid:e,record:t,cellElement:n,value:r,isExport:i}){let s;return t.isSpecialRow?s="":i?s=r:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?n.style.fontSize=e.rowHeight/40+"em":n.style.fontSize="",s=this.template(t,r)),s}}kv.registerColumnType(Bx),Bx._$name="ResourceInfoColumn";class zx extends Rv{static $name="ScaleColumn";static type="scale";static isScaleColumn=!0;static fields=["scalePoints"];static defaults={text:" ",width:40,minWidth:40,field:"scalePoints",cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:null};onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,t,n){return"scalePoints"===t&&(this.scaleWidget[t]=n),super.applyValue(...arguments)}buildScaleWidget(){const e=this,t=new hv({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(t,{width:{get:()=>e.width,set(t){this.element.style.width=`${t}px`,this._width=e.width}},height:{get(){return this._height},set(e){this.element.style.height=`${e}px`,this._height=e}}}),t.width=e.width,t}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}defaultRenderer({cellElement:e,value:t,scaleWidgetConfig:n,scaleWidget:r=this.scaleWidget}){W.assign(r,{scalePoints:t||this.scalePoints,height:this.grid.rowHeight},n),r.refresh();const i=r.element.cloneNode(!0);i.removeAttribute("id"),i.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(i)}}kv.registerColumnType(zx),zx._$name="ScaleColumn";class jx extends kC{static $name="ResourceTickModel";isTickCell=!0;static fields=["resourceId","value"];get indexKey(){return`${this.startDate.getTime()}-${this.resourceId}`}async setValue(e){this.value=e}}jx._$name="ResourceTickModel";class Wx extends $l{static $name="ResourceTickStore";static defaultConfig={loadPriority:500,syncPriority:500,modelClass:jx,id:"resourceTicks"};get $lazyLoadPluginClass(){return this.isPaged?Bw:Nw}}Wx._$name="ResourceTickStore";class Ux extends(Tr()){static $name="RecurrenceLegend";static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>!xi.nonWorkingDays[t])).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>xi.nonWorkingDays[t])).join(",")}static getLegend(e,t){const n=this,{timeSpan:r,interval:i,days:s,monthDays:o,months:a,positions:l}=e,d=t||r.startDate,c={interval:i};let u;switch(e.frequency){case"DAILY":return 1===i?n.L("L{Daily}"):n.L("L{Every {0} days}",c);case"WEEKLY":return s&&s.length?c.days=n.getDaysLegend(s):d&&(c.days=xi.getDayName(d.getDay())),n.L(1===i?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",c);case"MONTHLY":return s&&s.length&&l&&l.length?c.days=n.getDaysLegend(s,l):o&&o.length?(o.sort(((e,t)=>e-t)),c.days=n.arrayToText(o)):d&&(c.days=d.getDate()),n.L(1===i?"L{Monthly on {1}}":"L{Every {0} months on {1}}",c);case"YEARLY":return s&&s.length&&l&&l.length?c.days=n.getDaysLegend(s,l):c.days=d.getDate(),a&&a.length?(a.sort(((e,t)=>e-t)),u=a.length>2?e=>xi.getMonthShortName(e-1):e=>xi.getMonthName(e-1),c.months=n.arrayToText(a,u)):c.months=xi.getMonthName(d.getMonth()),n.L(1===i?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",c)}}static getDaysLegend(e,t){const n=this,r={position:""};let i;if(t&&t.length&&(r.position=n.arrayToText(t,(e=>n.L(`L{position${e}}`)))),e.length)switch(e.sort(((e,t)=>iS.decodeDay(e)[0]-iS.decodeDay(t)[0])),e.join(",")){case n.allDaysValue:r.days=n.L("L{day}");break;case n.workingDaysValue:r.days=n.L("L{weekday}");break;case n.nonWorkingDaysValue:r.days=n.L("L{weekend day}");break;default:i=e.length>2?e=>xi.getDayShortName(iS.decodeDay(e)[0]):e=>xi.getDayName(iS.decodeDay(e)[0]),r.days=n.arrayToText(e,i)}return n.L("L{daysFormat}",r)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}Ux._$name="RecurrenceLegend";class Gx extends Qe{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${e.date?xi.format(e.date,"MMM"):""}</div>\n                        <div class="b-sch-minute-indicator">${e.date?xi.format(e.date,"D"):""}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${N.encodeHtml(e.text||"")}</span>\n                </div>`}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,t){const n=null==e?void 0:e.querySelector(".b-sch-hour-indicator"),r=null==e?void 0:e.querySelector(".b-sch-minute-indicator");t&&n&&r&&c.isBrowserEnv&&("hour"===this.mode?(n.style.transform=`rotate(${t.getHours()%12*30}deg)`,r.style.transform=`rotate(${6*t.getMinutes()}deg)`):(n.style.transform="none",r.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=xi.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=xi.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}Gx._$name="ClockTemplate";class Yx extends Mr{static get defaultConfig(){return{tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip",allowNonWorkingTimeSNET:null}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0,capitalizedEventName:null,eventName:null}}static get pluginConfig(){return{chain:["onInternalPaint"]}}afterConstruct(...e){const t=this,{client:n}=this;t.capitalizedEventName=t.capitalizedEventName||n.capitalizedEventName,t.eventName=t.eventName||n.scheduledEventName,super.afterConstruct(...e)}internalSnapToPosition(e){var t;const{dragData:n}=this;null===(t=this.snapToPosition)||void 0===t||t.call(this,{assignmentRecord:n.assignmentRecord,eventRecord:n.eventRecord,resourceRecord:n.newResource||n.resourceRecord,startDate:n.startDate,endDate:n.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:t,constrainDragToTimeline:n,constrainDragToResource:r,constrainDragToTimeSlot:i,dragHelperConfig:s={}}=e,{timeAxisViewModel:o,isHorizontal:a}=t,l=a?r:i,d=a?i:r;return e.externalDropTargetSelector&&(s.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),C.merge({name:e.constructor.name,positioning:"inset",rtlSource:t,lockX:d,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!n,removeProxyAfterDrop:!1,dragWithin:n?null:t.floatRoot,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",allowDropOutside:!n,dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:n?t.scrollManager:null,createProxy:t=>e.createProxy(t),snapCoordinates:({element:n,newX:i,newY:s})=>{const{dragData:l}=e;if(t&&e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||o.snap)){const{timeAxis:g}=t,m=l.record.event??l.record,{calendar:p}=m,{startDate:f}=l,v=e.getCoordinate(m,n,[i,s]);let y;if(t.fillTicks&&g.isContinuous?y=t.snap?g.roundDate(f):f:(y=o.getDateFromPosition(v,"round"),(t.snapRelativeToEventStartDate||t.snap&&t.fillTicks)&&(y=g.roundDate(y,f))),!p||y&&p.isWorkingTime(y,xi.add(y,m.fullDuration))){const e=y&&o.getPositionFromDate(y);y&&y>=t.startDate&&null!=e&&(a?i=e:s=e)}if(t.snap&&e.snapToResource&&!r){var d,c,u;let n;if(a){var h;const e=null===(h=t.rowManager.getRowAt(l.context.clientY))||void 0===h?void 0:h.id;n=t.resourceStore.getById(e)}else{const e=l.context.clientX-t.timeAxisSubGrid.rectangle().x,{first:r,last:i}=t.visibleResources;n=t.vertical.allResourceRecords.filter((e=>e.id>=r.id&&e.id<=i.id)).find((n=>n.instanceMeta(t).insetStart<=e&&n.instanceMeta(t).insetEnd>e))}const r=n||l.newResource||l.resourceRecord,{start:o}=t.getResourceMarginObject(r),g=a?null===(d=t.getRowFor(r))||void 0===d?void 0:d.height:t.getResourceWidth(r),m=a?null===(c=t.getRowFor(r))||void 0===c?void 0:c.top:null===(u=r.instanceMeta(t))||void 0===u?void 0:u.insetStart;if(void 0!==g&&void 0!==m){let t=m+o,n=e.snapToResource.threshold?Math.min(g,e.snapToResource.threshold):g/4+o,d=a?Math.abs(s-m):Math.abs(i-m);r.id===l.resourceRecord.id&&(t=a?l.context.elementStartY:l.context.elementStartX,d=a?Math.abs(s-t):Math.abs(i-t)),d<=n&&(a?s=t:i=t)}}}const g={x:i,y:s};return e.internalSnapToPosition(g),g},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(t,n)=>(!s||!s.isElementDraggable||s.isElementDraggable(t,n))&&e.isElementDraggable(t,n)})}onInternalPaint({firstPaint:e}){var t;const n=this,{client:r}=n;null===(t=n.drag)||void 0===t||t.destroy(),n.drag=Zl.new(n.buildDragHelperConfig()),e&&r.rowManager.ion({changeTotalHeight:()=>{var e;return n.updateYConstraint(null===(e=n.dragData)||void 0===e?void 0:e[`${r.scheduledEventName}Record`])},thisObj:n}),n.showTooltip&&(n.clockTemplate=new Gx({scheduler:r}))}doDestroy(){var e,t,n;null===(e=this.drag)||void 0===e||e.destroy(),null===(t=this.clockTemplate)||void 0===t||t.destroy(),null===(n=this.tip)||void 0===n||n.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,t){const n=this;if(e){const r=tm.reconfigure(t,tm.mergeConfigs({forElement:n.element,id:n.tipId,getHtml:n.getTipHtml.bind(n),cls:n.tooltipCls,owner:n.client},e),{owner:n.client,defaults:{type:"tooltip"}});return r.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:n}),r}null==t||t.destroy()}createProxy(e){const t=e.cloneNode(!0);return delete t.id,t.classList.add(`b-sch-${this.client.mode}`),t}onBeforeDragStart({context:e,event:t}){const n=this,{client:r}=n,i=n.getMinimalDragData(e,t),s=null==i?void 0:i[`${r.scheduledEventName}Record`],o=i.resourceRecord,a=n.constrainDragToResource&&n.constrainDragToTimeSlot;if(r.readOnly||n.disabled||!s||!1===s.isDraggable||s.readOnly||null!=o&&o.readOnly||a)return!1;e.pointerStartDate=r.getDateFromCoord({coord:r.isVertical?e.startPageY:e.startPageX,local:!1});const l=!1!==n.triggerBeforeEventDrag(`before${n.capitalizedEventName}Drag`,{...i,event:t,context:{...e,...i}});var d;l&&(n.updateYConstraint(s,o),null===(d=r[`before${n.capitalizedEventName}DragStart`])||void 0===d||d.call(r,e,i));return l}onAfterDragStart({context:e,event:t}){}get isDragging(){var e;return null===(e=this.drag)||void 0===e?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:t}){var n,r;const i=this,s=i.findClientFromTarget(t,e)??i.client;i.currentOverClient=s,i.drag.unifiedProxy=i.unifiedDrag,i.onMouseOverNewTimeline(s,!0);const o=i.dragData=i.getDragData(e);if(i.suspendElementRedrawing(e.element),i.showTooltip&&i.tip){const t=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;i.tip.showBy(t)}i.triggerDragStart(o),null===(n=s[`after${i.capitalizedEventName}DragStart`])||void 0===n||n.call(s,e,o);const{eventMenu:a,taskMenu:l}=s.features,d=a||l;null==d||null===(r=d.hideContextMenu)||void 0===r||r.call(d,!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:n,clockTemplate:r}=this,i=n.element.querySelector(".b-sch-tooltip-enddate");r.updateDateIndicator(n.element,e),i&&r.updateDateIndicator(i,t)}findClientFromTarget(e,t){let{target:n}=e;if(/^touch/.test(e.type)){const e=Ot.from(t.element,null,!0).center;n=Yn.elementFromPoint(e.x,e.y)}const r=oc.fromElement(n,"timelinebase");return null!=r&&r.isResourceHistogram?null:r}onDrag({context:e,event:t}){const n=this,r=n.dragData,i=r.startDate;let s;if(s=n.constrainDragToTimeline?n.client:n.findClientFromTarget(t,r.context),n.updateDragContext(e,t),s){if(s!==n.currentOverClient&&n.onMouseOverNewTimeline(s),r.dirty||!n.throttleDragEvent){const e=r.valid;n.triggerEventDrag(r,i),e!==r.valid&&(r.context.valid=r.externalDragValidity=r.valid)}n.showTooltip&&n.tip&&(n.tip.lastAlignSpec.allowTargetOut=!r.valid,n.tip.realign())}}onMouseOverNewTimeline(e,t){const n=this,{drag:{lockX:r,lockY:i}}=n,s=[];n.currentOverClient.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||n.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:n.drag.onScrollManagerScrollCallback}),n.currentOverClient=e}triggerBeforeEventDropFinalize(e,t,n){n.trigger(e,t)}onDrop({context:e,event:t}){var n;const r=this,{currentOverClient:i,dragData:s}=r;let o=!1;if(null==i||i.scrollManager.stopMonitoring(),null===(n=r.tip)||void 0===n||n.hide(),e.valid=e.valid&&r.isValidDrop(s),r.drag.removeProxyAfterDrop=Boolean(s.externalDropTarget),e.valid&&s.startDate&&s.endDate){let n=!1;s.finalize=async t=>{n||s.async?await r.finalize(t):e.valid=e.valid&&t},r.triggerBeforeEventDropFinalize(`before${r.capitalizedEventName}DropFinalize`,{context:s,domEvent:t},i),n=!0,e.async=s.async,e.async||s.externalDropTarget||(o=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)}e.async||r.finalize(s.valid&&e.valid&&o)}onDragAbort({context:e}){var t,n;const r=this;r.isAborting=!0,null===(t=r.currentOverClient)||void 0===t||t.scrollManager.stopMonitoring(),r.client.currentOrientation.onDragAbort({context:e,dragData:r.dragData}),r.resetDraggedElements(),null===(n=r.tip)||void 0===n||n.hide(),r.triggerDragAbort(r.dragData)}onDragAbortFinalized({context:e}){var t,n;const r=this;r.triggerDragAbortFinalized(r.dragData),null===(t=(n=r.client)[`after${r.capitalizedEventName}DragAbortFinalized`])||void 0===t||t.call(n,e,r.dragData),r.isAborting=!1}onDragReset({source:e}){var t;const n=this,r=n.currentOverClient;null!==(t=e.context)&&void 0!==t&&t.started&&(n.resetDraggedElements(),r.trigger(`${n.eventName}DragReset`)),null==r||r.element.classList.remove(`b-dragging-${r.scheduledEventName}`),n.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:t,draggedEntities:n}=e;this.resumeRecordElementRedrawing(e.record),n.forEach(((e,n)=>{this.resumeRecordElementRedrawing(e),t[n]&&(t[n].classList.remove(this.drag.draggingCls),t[n].retainElement=!1)})),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var t;const n=this,{context:r}=n.drag;null===(t=n.tip)||void 0===t||t.hide(),n.triggerAfterDrop(n.dragData,!1),r.valid=!1,e&&n.drag.abort()}async finalize(e){const t=this,{dragData:n,currentOverClient:r}=t,{eventBarEls:i}=n,s=r.features.taskTooltip||r.features.eventTooltip;if(!n||t.finalizing)return;const{context:o,draggedEntities:a,externalDropTarget:l}=n;let d;return t.finalizing=!0,a.forEach(((e,n)=>{t.resumeRecordElementRedrawing(e),i[n]&&(i[n].classList.remove(t.drag.draggingCls),i[n].retainElement=!1)})),o.element.retainElement=!1,l&&n.valid||e?(d=t.updateRecords(n),!l&&C.isPromise(d)&&(o.async=!0,await d),n.valid?(o.async&&o.finalize(),l&&t.client.refreshRows(null,!1),t.triggerAfterDrop(n,!0)):t.onInternalInvalidDrop(!0)):t.onInternalInvalidDrop(o.async||n.async),t.finalizing=!1,null!=s&&s.enabled&&(s.disabled=!0,r.setTimeout((()=>{s.disabled=!1}),200)),d}getEventStartEndDatesFromGraph(e,t,n){let r;const{newResource:i,resourceRecord:s,assignmentRecords:o}=this.dragData,a=n.project,l=a.graph,d=a!==e.project,c=l.branch({autoCommit:!1,onComputationCycle:"throw",project:a});if(d){(e=e.copy()).parentEvent=a.eventStore.rootNode,e.project=a,c.addEntity(e);for(const t of o)c.addEntity(t.copy({eventId:e.id,event:e,resourceId:i.id,resource:i}))}else if(i&&i!==s)for(const e of o)c.write(e.$.resource,i);c.write(e.$.startDate,t);try{t=c.read(e.$.startDate),r=c.read(e.$.endDate)}catch(e){return!1}finally{c.clearBranch()}return{startDate:t,endDate:r}}getEventNewStartEndDates(e,t,n){let r,i=this.adjustStartDate(e.startDate,t);if(!e.graph||this.allowNonWorkingTimeSNET||e.manuallyScheduled&&!e.project.skipNonWorkingTimeWhenSchedulingManually)r=xi.add(i,e.fullDuration);else try{({startDate:i,endDate:r}=this.getEventStartEndDatesFromGraph(e,i,n))}catch(e){return{valid:!1}}return{startDate:i,endDate:r}}updateDragContext(e,t){const n=this,{drag:r}=n,i=n.dragData,s=n.currentOverClient,{isHorizontal:o,timeAxis:a}=s,{record:l}=i,d=l.isAssignment?l.event:l,c=i.startDate,u=n.constrainDragToTimeSlot||(o?r.lockX:r.lockY);if(i.browserEvent=t,Object.assign(i,n.getProductDragContext(i)),u)i.timeDiff=0;else{let t;if(a.isContinuous||i.startsOutsideView&&i.endsOutsideView){const r=s.isHorizontal?e.pageX??e.startPageX:e.pageY??e.startPageY,o=s.getDateFromCoordinate(r,null,!1,!0);t=i.timeDiff=o-e.pointerStartDate,null!==t&&(Object.assign(i,n.getEventNewStartEndDates(d,t,s)),i.valid&&(i.timeDiff=i.startDate-i.origStart))}else{const r=n.resolveStartEndDates(e.element);i.valid=Boolean(r.startDate&&r.endDate),i.valid&&(t=r.startDate-i.origStart),void 0!==t&&(d.graph&&!n.allowNonWorkingTimeSNET?Object.assign(i,n.getEventStartEndDatesFromGraph(d,r.startDate,s)):(i.startDate=r.startDate,i.endDate=r.endDate)),i.timeDiff=t}}const h=i.dirty=i.dirty||c-i.startDate!=0;if(i.valid)if(n.constrainDragToTimeline&&(i.endDate<=a.startDate||i.startDate>=a.endDate))i.valid=!1,i.context.message=n.L("L{EventDrag.noDropOutsideTimeline}");else if(h||i.externalDropTarget){const r=i.externalDragValidity=!t||e.pageX&&n.checkDragValidity(i,t);r&&"boolean"!=typeof r?(i.valid=!1!==r.valid,i.context.message=r.message):(i.valid=!1!==r,i.context.message="")}else{var g;i.valid=!1!==i.externalDragValidity&&!1!==(null===(g=i.externalDragValidity)||void 0===g?void 0:g.valid)}else i.valid=!1;i.context.valid=i.valid}suspendRecordElementRedrawing(e,t=!0){this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,t=!0){e&&(e.retainElement=t)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:n,drag:r}=t,i=t.setupProductDragData(e),{record:s,eventBarEls:o,draggedEntities:a}=i,{startEvent:l}=r,d=s.isAssignment?s.event:s,c=d.startDate,u=d.endDate,h=n.timeAxis,g=c<h.startDate,m=u>h.endDate,p=n.isSchedulerBase?n.multiEventSelect:n.selectionMode.multiSelect,f=t.getCoordinate(d,e.element,[e.elementStartX,e.elementStartY]),v=t.getCoordinate(d,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(s),a.forEach((e=>t.suspendRecordElementRedrawing(e))),n.selectionMode.checkboxOnly||(s.isAssignment?n.selectAssignment(s,l.ctrlKey&&p):n.selectEvent(s,l.ctrlKey&&p));const y={context:e,...i,sourceDate:g?c:n.getDateFromCoordinate(f),screenSourceDate:n.getDateFromCoordinate(v,null,!1),startDate:c,endDate:u,timeDiff:0,origStart:c,origEnd:u,startsOutsideView:g,endsOutsideView:m,duration:u-c,browserEvent:l};return o.length>1&&(e.relatedElements=o.filter((e=>e&&e!==r.context.grabbed))),o.forEach((e=>null==e?void 0:e.classList.remove("b-sch-event-hover","b-active"))),y}setupConstraints(e,t,n,r,i){const s=this,o=!s.showExactDropPosition&&n>1?n:0;r?s.setXConstraint(e.left,e.right-t.width,o):s.setXConstraint(!0,!0,o),i?s.setYConstraint(e.top,e.bottom-t.height,0):s.setYConstraint(0,!0,0)}updateYConstraint(e,t){const n=this,{client:r}=n,{context:i}=n.drag,s=r.timeAxisViewModel.snapPixelAmount;if(i&&!n.drag.lockY){let o;if(!n.constrainDragToTimeline)return void n.setYConstraint(null,null,s);o=r.getScheduleRegion(t,e),n.setYConstraint(o.top,o.bottom-i.element.offsetHeight,s)}else n.setYConstraint(null,null,s)}setXConstraint(e,t,n){const{drag:r}=this;r.minX=e,r.maxX=t}setYConstraint(e,t,n){const{drag:r}=this;r.minY=e,r.maxY=t}adjustStartDate(e,t){const{currentOverClient:n}=this,r=n.timeAxis.roundDate(new Date(e-0+t),!!(n.snapRelativeToEventStartDate||n.snap&&n.fillTicks)&&e);return!n.fillTicks||"day"!==n.timeAxis.mainUnit&&0!==xi.compareUnits(n.timeResolution.unit,"d")||xi.copyTimeValues(r,this.dragData.origStart),this.constrainStartDate(r)}normalizeDraggedElement(e){return Yn.down(e,this.currentOverClient.eventInnerSelector)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:n}=t,r=this.normalizeDraggedElement(e),i=Ot.from(r,t.timeAxisSubGridElement),s=this.dragData,[o]=s.draggedEntities,a=o.isAssignment?o.event:o,l=t.fillTicks&&t.snapRelativeToEventStartDate,d=a.endDate-a.startDate;let{start:c,end:u}=t.getStartEndDatesFromRectangle(i,l?null:"round",d,!0);if(c&&u){if(l){const e=(a.startDate-xi.startOf(a.startDate,n.unit))/(u-c)*i.width;i.deflate(t.isVertical?e:0,0,0,t.isHorizontal?e:0);const r=i.getStart(t.rtl,!t.isVertical);c=t.getDateFromCoordinate(r,null,!0),c=n.roundDate(c,a.startDate)}if(c=this.adjustStartDate(c,0),s.startsOutsideView)s.endsOutsideView||(c=u&&xi.add(u,-d));else{if(!n.dateInAxis(c,!1)){const e=n.getTickFromDate(c);e>=0&&(c=n.getDateFromTick(e))}u=c&&xi.add(c,d)}}return{startDate:c,endDate:u}}getTipHtml(){const e=this,{dragData:t,client:n,tooltipTemplate:r}=e,{startDate:i,endDate:s,draggedEntities:o,newResource:a}=t,l=n.getFormattedDate(i),d=s&&n.getFormattedEndDate(s,i)||"",{valid:c,message:u,element:h,dragProxy:g}=t.context,m=g?g.firstChild:h,p=o[0],f=p.isTask?p:p.event;return e.tip.lastAlignSpec.target=m,r({valid:c,startDate:i,endDate:s,startText:l,endText:d,dragData:t,newResource:a||t.resourceRecord,message:u||"",[n.scheduledEventName+"Record"]:f,startClockHtml:e.clockTemplate.template({date:i,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:f.isMilestone?"":e.clockTemplate.template({date:s,text:d,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){if(this.drag){const t=this.client.isHorizontal?"lockX":"lockY";this.drag[t]=e}}updateConstrainDragToResource(e){const t=this;if(t.drag){const{constrainDragToTimeSlot:n}=t,{isHorizontal:r}=t.client;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=r?e:n,t.drag.lockX=r?n:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,allowDropOutside:!e,dragWithin:e?null:this.client.floatRoot,scrollManager:e?this.client.scrollManager:null})}constrainStartDate(e){const{dragData:t}=this,{dateConstraints:n}=t,r=t.eventRecord||t.taskRecord||t.record;return null!=n&&n.start&&(e=xi.max(n.start,e)),null!=n&&n.end&&(e=xi.min(new Date(n.end-r.rawDurationMS),e)),e}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,n){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}Yx._$name="DragBase";var qx=e=>class extends((e||Qe).mixin(ax)){static $name="TransactionalFeature";detachFromProject(e){this.rejectFeatureTransaction(),super.detachFromProject(e)}getStmCapture(){var e;const t=(null===(e=super.getStmCapture)||void 0===e?void 0:e.call(this))??{};return t._editorPromiseResolve=this._editorPromiseResolve,t}applyStmCapture(e){var t;null===(t=super.applyStmCapture)||void 0===t||t.call(this,e),this._editorPromiseResolve=e._editorPromiseResolve}captureFeatureTransaction(){if(this.client.transactionalFeaturesEnabled)return this._hasFeatureTransactionCapture=!0,{source:this,resolve:this._editorPromiseResolve}}applyCapturedFeatureTransaction(e={}){if(this.client.transactionalFeaturesEnabled){const{source:t,resolve:n}=e;t!==this&&(t._hasFeatureTransactionCapture=!1,t.cleanupTransactionMetadata(),this._hasFeatureTransactionCapture=!0,this._editorPromiseResolve=n)}}releaseFeatureTransaction(){this.client.transactionalFeaturesEnabled&&(this._hasFeatureTransactionCapture=!1)}get canStartFeatureTransaction(){return!this.client.transactionalFeaturesEnabled||!this._hasFeatureTransactionCapture&&!this.client.project.stm.isNavigatingRevisions}async startFeatureTransaction(){if(!this.client.transactionalFeaturesEnabled||this._hasFeatureTransactionCapture)return;const e=this,{project:t}=e.client,{stm:n}=t,r=eo.generateId("featureTransaction");let i;e.client.trigger("beforeFeatureTransactionStart",{id:r}),e.hasStmCapture?n.startTransaction():i=t.queue((async()=>{t.isEngineReady()||await t.commitAsync()})),t.queue((()=>(e.hasStmCapture||(e._stmInitiallyDisabled=n.disabled,e._stmInitiallyAutoRecord=n.autoRecord,n.isRecording?n.stopTransaction():e._stmInitiallyDisabled&&n.enable(),n.autoRecord=!1),n.isRecording||n.startTransaction(),e.client.trigger("featureTransactionStart",{id:r}),new Promise((t=>e._editorPromiseResolve=t))))),await i}rejectFeatureTransaction(){var e;const t=this,{stm:n}=t.client.project,r=t.client.featureTransactionId;r&&!t.finishingFeatureTransaction&&(null===(e=t._editorPromiseResolve)||void 0===e||e.call(t),t._hasFeatureTransactionCapture&&t.releaseFeatureTransaction(),t.cleanupTransactionMetadata(),n.isRecording&&n.rejectTransaction(),t.hasStmCapture||null==t._stmInitiallyDisabled||(n.disabled=t._stmInitiallyDisabled,n.autoRecord=t._stmInitiallyAutoRecord),t.client.trigger("featureTransactionReject",{id:r}),t.client.trigger("featureTransactionComplete",{id:r}))}cleanupTransactionMetadata(){this._editorPromiseResolve=null}async finishFeatureTransaction(){var e;const t=this,{client:n,_stmInitiallyDisabled:r,_stmInitiallyAutoRecord:i}=t,{project:s,featureTransactionId:o}=n,{stm:a}=s;o&&!t._hasFeatureTransactionCapture&&(n.trigger("featureTransactionFinalizeStart",{id:o}),t.finishingFeatureTransaction=!0,await s.commitAsync(),a.isRecording&&a.stopTransaction(),null===(e=t._editorPromiseResolve)||void 0===e||e.call(t),t._editorPromiseResolve=null,t.hasStmCapture||!a||a.isDestroying||null==r||(a.disabled=r,a.autoRecord=i),t.isDestroying||(t.finishingFeatureTransaction=!1,n.trigger("featureTransactionFinalized",{id:o}),n.trigger("featureTransactionComplete",{id:o})))}};const Kx={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"};class Xx extends(Mr.mixin(sg,og,qx)){static $name="EventResize";static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:1,dragThreshold:0,dragTouchStartDelay:300,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event",lockLayout:!0,resizeSelected:!0}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),null===(e=this.dragging)||void 0===e||e.destroy()}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}isEventElementDraggable(e,t,n,r){const i=this,s=null==t?void 0:t.resizable;return!(!i.disabled&&s&&!t.isMilestone)||(!0!==s&&"start"!==s||!i.isOverStartHandle(r,e))&&(!0!==s&&"end"!==s||!i.isOverEndHandle(r,e))}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:n}){var r;null!==(r=this.dragging)&&void 0!==r&&null!==(r=r.context)&&void 0!==r&&r.eventContexts.some((t=>t.eventRecord===e))&&(t["b-active"]=t[this.draggingItemCls]=t["b-over-resize-handle"]=n["b-resize-handle"]=n[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:n,dragging:r}=this,{visibleDateRange:i,isHorizontal:s}=n,o=s&&n.rtl,a=s?"X":"Y",l=globalThis[`page${a}Offset`],d=e[`page${a}`]+((null===(t=r.context)||void 0===t?void 0:t.offset)||0),c=Ot.from(n.timeAxisSubGridElement,null,!0),u=c.getStart(o,s),h=c.getEnd(o,s);let g=n.getDateFromCoord({coord:d,local:!1});o?d-l>u?g=i.startDate:d<h&&(g=i.endDate):d-l<u?g=i.startDate:d-l>h&&(g=i.endDate),r.clientStartCoord=u,r.clientEndCoord=h,r.date=g,super.onDragPointerMove(e)}get isResizing(){return Boolean(this.dragging)}get isMultiResizing(){var e;return this.isResizing&&(null===(e=this.dragging)||void 0===e?void 0:e.context.eventContexts.length)>1}beforeDrag(e){const t=this,{client:n}=t,r=n.resolveTimeSpanRecord(e.itemElement),i=!n.isGanttBase&&n.resolveResourceRecord(n.isVertical?e.startEvent:e.itemElement);return!(t.disabled||n.readOnly||null!=i&&i.readOnly||r&&(r.readOnly||!r.project&&!r.isOccurrence)||!1===super.beforeDrag(e))&&(t.hasStmCapture||t.canStartFeatureTransaction?(e.mousedownDate=e.date=n.getDateFromCoordinate(e.event["page"+(n.isHorizontal?"X":"Y")],null,!1),t.triggerBeforeResize(e)):(n.trigger("eventResizePrevented",{reason:"revision"}),!1))}initEventRecordContext(e,t){const n=e===t.timespanRecord?t.element:this.getSelectedRecordElement(e),r=e.isAssignmentModel?e.event:e,{isBatchUpdating:i,wrapEndDate:s,wrapStartDate:o}=r,a=i?r.get("startDate"):r.startDate,l=i?r.get("endDate"):r.endDate,d=t.draggingEnd?l:a;return{mainContext:t,eventRecord:r,element:n,startDate:a,endDate:l,date:d,wrapEndDate:s,wrapStartDate:o,oldValue:d,originalStartDate:a,originalEndDate:l,timespanRecord:r}}initResizeContext(e){var t,n;const r=this,{client:i}=r,{startEvent:s,itemElement:o}=e,a=i.resolveEventRecord(o),l=a.endDate,d=a.startDate,c=null===(t=i.features.eventBuffer)||void 0===t?void 0:t.enabled,u="x"===r.dragLock,h=u&&i.rtl,g=r.isOverEndHandle(s,o),m=Ot.from(o),p=u?s.clientX:s.clientY,f=g?m.getEnd(h,u):m.getStart(h,u),v=g?l:d,y={owner:r,valid:!0,offset:c?0:f-p,edge:u?g?"right":"left":g?"bottom":"top",finalize:r.finalize,event:e.event,toSet:g?"endDate":"startDate",otherEnd:g?"startDate":"endDate",setMethod:g?"setEndDate":"setStartDate",setOtherMethod:g?"setStartDate":"setEndDate",wrapToSet:c?g?"wrapEndDate":"wrapStartDate":null,oldValue:v,draggingEnd:g,timespanRecord:a,[`${i.scheduledEventName}Record`]:a,element:(null===(n=this.eventContexts)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.element)||o};let b;return r.resizeSelected&&r.isRecordSelected(a)?(b=r.selectedRecords.filter((e=>e.isAssignmentModel?!e.event.readOnly&&e.event.isScheduled:!e.readOnly&&e.isScheduled)),b.sort(((e,t)=>e===a?-1:t===a?1:0))):b=[a],y.eventContexts=b.map((e=>r.initEventRecordContext(e,y))),y}get selectedRecords(){return this.client.selectedAssignments}isRecordSelected(e){var t,n;return null===(t=(n=this.client).isEventSelected)||void 0===t?void 0:t.call(n,e)}getSelectedRecordElement(e){return e.isAssignmentModel?this.client.getElementFromAssignmentRecord(e,!1,!1,this.client.isLockedRowsView):this.client.getElementFromEventRecord(e)}startDrag(...e){const t=super.startDrag(...e);return!1===t||this.hasStmCapture||this.startFeatureTransaction().then(),t}dragStart(e){const t=this,{client:n,tip:r}=t,i=e.context=t.initResizeContext(e);n.element.classList.add(...t.dragActiveCls.split(" ")),n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates();for(const n of i.eventContexts){const{eventRecord:r}=n;r.meta.isResizing=!0,r.isBatchUpdating||t.beginEventRecordBatch(r),n.element&&t.setupProductResizeContext(n,e.startEvent)}t.triggerEventResizeStart(`${n.scheduledEventName}ResizeStart`,t.getTriggerParams(i),i),r&&(r.show(),r.align=Kx[i.edge],r.showBy(t.getTooltipTarget(e)))}getTriggerParams(e){const t=e.eventContexts.map((e=>({...e}))),n=this.client.capitalizedEventName.toLowerCase(),r={...t.find((({element:e,mainContext:t})=>{var r;return null==e||null===(r=e.closest(`.b-sch-${n}-wrap`))||void 0===r?void 0:r.isEqualNode(t.element)}))||t[0],event:e.event,async:e.async,finalize:(...t)=>e.finalize(...t),resizeData:t};return delete r.mainContext,r}triggerBeforeResize(e){const{client:t}=this,n=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}Resize`,{[`${t.scheduledEventName}Record`]:n,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,t,n){var r,i;this.client.trigger(e,t),null===(r=(i=this.client)[`after${N.capitalize(e)}`])||void 0===r||r.call(i,n,t)}triggerEventResizeEnd(e,t){this.client.trigger(e,t)}triggerEventPartialResize(e,t){const n=this.client.scheduledEventName+"Record",r=new Map;for(const e of t){const t=e[n];r.set(t,t.batching),t.batching=0}this.client.trigger(e,{...t[0],resizeData:t});for(const e of t){const t=e[n];t.batching=r.get(t)}}async triggerBeforeEventResizeFinalize(e,t){await this.client.trigger(e,t)}dragEnter(e){var t;return(null===(t=e.context)||void 0===t?void 0:t.owner)===this}resizeEventPartiallyInternal(e,t){var n;const{client:r}=this,{toSet:i}=t.mainContext;if(null!==(n=r.features.eventBuffer)&&void 0!==n&&n.enabled)if("startDate"===i){const n=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+n)}else if("endDate"===i){const n=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+n)}e.set(i,t[i])}applyDateConstraints(e,t,n){var r,i;const s=null===(r=n.dateConstraints)||void 0===r?void 0:r.start,o=null===(i=n.dateConstraints)||void 0===i?void 0:i.end;return(s||o)&&(e=xi.constrain(e,s,o),n.snappedDate=xi.constrain(n.snappedDate,s,o)),e}isDateRangeValid(e){var t;const{client:n}=this,{startDate:r,endDate:i,eventRecord:s}=e,o=null===(t=n.features.eventBuffer)||void 0===t?void 0:t.bufferIsUnavailableTime;return n.isDateRangeAvailable(s.preamble&&o?xi.add(r,-s.preamble.milliseconds,"ms"):r,s.postamble&&o?xi.add(i,s.postamble.milliseconds,"ms"):i,s,e.eventRecord.resources)}hasValidSize(e,t){const{client:n}=this,r="startDate"===t?"endDate":"startDate";return!(!n.timeAxisViewModel.snap&&!this.allowResizeToZero)||e[t]-e[r]!=0}resizeEventRecord(e,t,n){const r=this,{client:i}=r,{timeAxis:s,enableEventAnimations:o}=i,{eventRecord:a,oldValue:l,element:d}=e,{resolutionUnit:c,resolutionIncrement:u}=s,h=a.get("startDate"),g=a.get("endDate"),m=e.mainContext;let p,f,{toSet:v,otherEnd:y}=m;"endDate"===v?n<h&&(p=-1):n>g&&(p=1),p&&r.onDragEndSwitch&&(r.onDragEndSwitch(e,n,p),y=m.otherEnd,v=m.toSet),i.snapRelativeToEventStartDate&&(n=s.roundDate(n,l)),e.snappedDate=xi.round(n,s.resolution,null,s.weekStartDay);const b=xi.diff(n,e[y],c)*(m.draggingEnd?-1:1);if(r.isEventDragCreate&&e.eventRecord===e.mainContext.eventRecord)e.mainContext.tooNarrow=Math.abs(b)<u/2;else if(b<u){if(b<0)return;if(r.allowResizeToZero)e.snappedDate=n=e[y];else{const t="startDate"===y?1:-1;let r=s.ceilDate(xi.add(a.get(y),u*t,c));xi.diff(r,e[y],c)*(m.draggingEnd?-1:1)>u&&(r=s.roundDate(xi.add(r,-t,c))),(r-l)*t<0||(n-l)*t>0?(n=t>0?xi.max(n,r):xi.min(n,r),e.snappedDate=r):(n=t>0?xi.max(n,l):xi.min(n,l),e.snappedDate=l),f=!0}}if(n=r.applyDateConstraints(n,a,e),(!e.date||n-e.date||f)&&(e.date=n,e[v]=r.showExactResizePosition||i.timeAxisViewModel.snap?e.snappedDate:n,e.valid=r.isDateRangeValid(e)&&r.hasValidSize(e,v),a.get(v)-e[v]))return e.valid=r.checkValidity(e,t.event,v),e.message="",e.valid&&"boolean"!=typeof e.valid&&(e.message=e.valid.message,e.valid=e.valid.valid),e.valid=!1!==e.valid,a.isOccurrence&&(a.stores=[i.eventStore]),i.enableEventAnimations=!1,this.resizeEventPartiallyInternal(a,e),i.enableEventAnimations=o,a.isOccurrence&&(a.stores=null),e.tooNarrow&&(e.valid=!1),{[i.scheduledEventName+"Record"]:a,startDate:h,endDate:g,element:d,[v]:e[v]}}moveDrag(e){const t=this,{context:n,event:r}=e,{client:i,tip:s}=t,o="x"===t.dragLock,a=o?"X":"Y",{visibleDateRange:l}=i,d=o&&i.rtl,c=n.offset*(d?-1:1),u=r[`client${a}`]+c,h=Ot.from(i.timeAxisSubGridElement,null,!0),g=h.getStart(d,o),m=h.getEnd(d,o),p=[];let{date:f}=e;n.event=r,r.isScroll&&(e.date=i.getDateFromCoordinate(r[`page${a}`]+c,null,!1)),d?u>g?f=e.date=l.startDate:u<m&&(f=e.date=l.endDate):u<g?f=e.date=l.startDate:u>m&&(f=e.date=l.endDate),n.message="",n.valid=!0;let v=f-n.oldValue;"Task"===t.client.capitalizedEventName&&(v=f-n.eventContexts[0].oldValue);for(const r of n.eventContexts){var y;const i=new Date(r.oldValue.getTime()+v),s=t.resizeEventRecord(r,e,i);s&&p.push(s),r.valid||(n.valid=!1),null!==(y=r.message)&&void 0!==y&&y.length&&(n.message=r.message)}s&&(s.align=Kx[n.edge],s.alignTo(t.getTooltipTarget(e))),p.length&&t.triggerEventPartialResize(`${t.client.scheduledEventName}PartialResize`,p),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||Jt.getPagePoint(e.event).equals(Jt.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){var n;const r=this,{client:i}=r,{toSet:s}=e;let o,a=!0;null===(n=r.tip)||void 0===n||n.hide();for(const t of e.eventContexts){t[s]=t.snappedDate;const{startDate:e,endDate:n}=t;t.valid=e&&n&&(r.allowResizeToZero||n-e>0)&&t[s]-t.oldValue&&!1!==t.valid,t.valid||(a=!1)}if(a){const t=r.getTriggerParams(e),n={...t,context:t};await r.triggerBeforeEventResizeFinalize(`before${i.capitalizedEventName}ResizeFinalize`,n),(n.async||t.async)&&(e.async=!0),o=!0}e.async||await e.finalize(o)}async eventRecordFinalize(e,t){const n=this,{client:r}=n;let i=[],s=!1;if(t)i=e.eventContexts.map((e=>n.internalUpdateRecord(e,e.eventRecord)));else for(const t of e.eventContexts){const{eventRecord:e}=t;n.cancelEventRecordBatch(e),e.isOccurrence&&e.resources.forEach((e=>r.repaintEventsForResource(e)))}if(i.length){if(await Promise.all(i),n.isDestroyed)return;s=i.some((e=>e))}n.cleanup(e,s)}async finalize(e){const t=this.owner,n=this,{snapRelativeToEventStartDate:r,timeAxis:i}=t.client,{toSet:s}=n;n.finalizing||(n.finalizing=!0,e&&(n.eventContexts.forEach((e=>{const{oldValue:n}=e;r&&(e[s]=e.snappedDate=i.roundDate(e.date,n)),t.adjustRecordBeforeUpdating(e,e.eventRecord)})),t.client.endListeningForBatchedUpdates()),await t.eventRecordFinalize(n,e),e?await t.finishFeatureTransaction():t.rejectFeatureTransaction())}cleanup(e,t){var n;const r=this,{client:i}=r;for(const{element:t,eventRecord:n}of e.eventContexts)n.meta.isResizing=!1,r.unHighlightHandle(t);i.endListeningForBatchedUpdates(),null===(n=r.tip)||void 0===n||n.hide(),i.element.classList.remove(...r.dragActiveCls.split(" ")),r.triggerEventResizeEnd(`${i.scheduledEventName}ResizeEnd`,{...r.getTriggerParams(e),changed:t})}adjustRecordBeforeUpdating(e,t){const{startDate:n,endDate:r}=e,{toSet:i,draggingEnd:s,otherEnd:o}=e.mainContext;if(!t.isOccurrence&&t.isEntity&&(!t.manuallyScheduled||t.project.skipNonWorkingTimeWhenSchedulingManually)){const a=t.run("calculateProjectedDuration",n,r);t.set({[i]:t.run("calculateProjectedXDateWithDuration",s?n:r,s,a),[o]:e[o]})}}async internalUpdateRecord(e,t){const{client:n}=this,{generation:r}=t,{startDate:i,endDate:s}=e,{toSet:o,wrapToSet:a,setMethod:l}=e.mainContext;if(t.isOccurrence)t[t.batching>1?"endBatch":"cancelBatch"](),t.set(kC.prototype.inSetNormalize.call(t,{startDate:i,endDate:s}));else{var d;const r=Object.assign({},t.meta.batchChanges);delete r[o],delete r.duration,this.cancelEventRecordBatch(t),null!==(d=n.features.eventBuffer)&&void 0!==d&&d.enabled&&(t[a]=null),t[l](e[o],!1),Object.keys(r).length&&t.set(r)}return await n.project.commitAsync(),t.generation!==r}onDragItemMouseMove(e){"touch"===e.pointerType||this.handleSelector||0!==e.buttons||this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:n}=t;if(n&&!t.client.readOnly&&(!t.allowResize||t.allowResize(n,e))){const r=t.client.resolveTimeSpanRecord(n);if(null!=r&&r.readOnly)return;t.isOverAnyHandle(e,n)?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){var e;const{overItem:t,client:n}=this;((null===(e=t.syncIdMap)||void 0===e?void 0:e[n.scheduledEventName])??t.querySelector(n.eventInnerSelector)).classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){if(e){var t;const n=this,r=(null===(t=e.syncIdMap)||void 0===t?void 0:t[n.client.scheduledEventName])??e.querySelector(n.client.eventInnerSelector);r&&r.classList.remove("b-resize-handle",n.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",n.draggingItemCls)}}isOverAnyHandle(e,t){return Boolean(this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t))}isOverStartHandle(e,t){var n;return Boolean(null===(n=this.getHandleRect("start",e,t))||void 0===n?void 0:n.contains(Jt.getPagePoint(e)))}isOverEndHandle(e,t){var n;return Boolean(null===(n=this.getHandleRect("end",e,t))||void 0===n?void 0:n.contains(Jt.getPagePoint(e)))}getHandleRect(e,t,n){if(this.overItem){if(!(n=t.target.closest(`.${this.client.eventCls}`)||n.querySelector(`.${this.client.eventCls}`)))return;const r=this,i="start"===e,{client:s}=r,o=Boolean(s.rtl),a=r.dragLock,l="x"===a,d=l?"width":"height",c=(l?i?o?"right":"left":o?"left":"right":i?"top":"bottom")+"Handle",u=s.resolveTimeSpanRecord(n),h=null==u?void 0:u.isResizable,g=Ot.from(n),m=g.clone(),p=globalThis.getComputedStyle(n,":before"),f=r.dynamicHandleSize?r.reservedSpace/2:0,v=[0,0,0,0];let y=parseFloat(p[d]);if(!r.disabled&&y&&!isNaN(y)&&r[c]&&r.dynamicHandleSize&&(!0===h||h===e)){const e=!l&&!i||l&&o===i,t=g[d];if(y>.5*t&&(y=Math.max(Math.floor(t/4)-1,1)),e?(m[a]+=t-y,v[l?3:0]=t/2+f):v[l?1:2]=t/2+f,g.deflate(...v),m[d]=y,m.constrainTo(g),m[d])return m}}}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const n=super.setupDragContext(e);return n.scrollManager=t.client.scrollManager,n}}changeTip(e,t){const n=this;if(!n.showTooltip)return null;if(e)e.isTooltip?e.owner=n:e=tm.reconfigure(t,tm.mergeConfigs({id:n.tipId},e,{getHtml:n.getTipHtml.bind(n),owner:n.client},n.tip),{owner:n,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:n}),n.clockTemplate=new Gx({scheduler:n.client});else if(t){var r;t.destroy(),null===(r=n.clockTemplate)||void 0===r||r.destroy()}return e}isElementResizable(e,t){var n;const r=this,{client:i}=r,s=i.resolveTimeSpanRecord(e);if(i.readOnly)return!1;let o=null==s?void 0:s.isResizable;const a=(null===(n=e)||void 0===n?void 0:n.syncIdMap[i.scheduledEventName])??e,l=t.target.closest('[class$="-handle"]');if(!o||l&&l!==a)return!1;if(!(e=t.target.closest(r.dragSelector)))return!1;const d=e.classList.contains("b-sch-event-startsoutside"),c=e.classList.contains("b-sch-event-endsoutside");if(!0===o){if(d&&c)return!1;if(d)o="end";else{if(!c)return r.isOverStartHandle(t,e)||r.isOverEndHandle(t,e);o="start"}}return!(d&&"start"===o||c&&"end"===o)&&!!(r.isOverStartHandle(t,e)&&"start"===o||r.isOverEndHandle(t,e)&&"end"===o)}updateDateIndicator(){const{clockTemplate:e}=this,{context:t}=this.dragging,{eventRecord:n,snappedDate:r}=t.eventContexts[0],{draggingEnd:i}=t,s=i?n.get("startDate"):r,o=i?r:n.get("endDate"),{element:a}=this.tip;e.updateDateIndicator(a.querySelector(".b-sch-tooltip-startdate"),s),e.updateDateIndicator(a.querySelector(".b-sch-tooltip-enddate"),o)}getTooltipTarget({itemElement:e,context:t}){const n=this,{rtl:r}=n.client,i=Ot.from(e,null,!0);return"x"===n.dragLock?(!r&&"right"===t.edge||r&&"left"===t.edge?i.x=i.right-1:i.x-=n.tip.anchorSize[0]/2,i.width=n.tip.anchorSize[0]/2):("bottom"===t.edge&&(i.y=i.bottom-1),i.height=n.tip.anchorSize[1]/2),{target:i}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{context:n}=t.dragging,r=n.eventContexts.find((e=>e.eventRecord===n.timespanRecord)),{startDate:i,endDate:s,snappedDate:o,eventRecord:a}=r,{toSet:l,valid:d,message:c=""}=n;if(!i||!s)return e.html;const u={record:a,valid:d,message:c,startDate:i,endDate:s,[l]:o};return u.startText=t.client.getFormattedDate(u.startDate),u.endText=t.client.getFormattedDate(u.endDate),u.startClockHtml=t.clockTemplate.template({date:u.startDate,text:u.startText,cls:"b-sch-tooltip-startdate"}),u.endClockHtml=t.clockTemplate.template({date:u.endDate,text:u.endText,cls:"b-sch-tooltip-enddate"}),t.tooltipTemplate(u)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}setupProductResizeContext(e,t){var n,r,i;const{client:s}=this,{element:o}=e,a=s.resolveEventRecord(o),l=null===(n=s.resolveResourceRecord)||void 0===n?void 0:n.call(s,o),d=null===(r=s.resolveAssignmentRecord)||void 0===r?void 0:r.call(s,o);Object.assign(e,{eventRecord:a,resourceRecord:l,assignmentRecord:d,dateConstraints:null===(i=s.getDateConstraints)||void 0===i?void 0:i.call(s,l,a)})}checkForEventOverlap({startDate:e,endDate:t,snappedDate:n,eventRecord:r,toSet:i}){var s;const{client:o}=this,a=null===(s=o.features.eventBuffer)||void 0===s?void 0:s.bufferIsUnavailableTime,{resources:l}=r;return r.preamble&&a&&("startDate"===i?n=xi.add(n,-r.preamble.milliseconds,"ms"):e=xi.add(e,-r.preamble.milliseconds,"ms")),r.postamble&&a&&("startDate"===i?t=xi.add(t,r.postamble.milliseconds,"ms"):n=xi.add(n,r.postamble.milliseconds,"ms")),"startDate"===i?!o.isDateRangeAvailable(n,t,r,l):!o.isDateRangeAvailable(e,n,r,l)}checkValidity({startDate:e,endDate:t,eventRecord:n,snappedDate:r,resourceRecord:i},s,o){return this.checkForEventOverlap({startDate:e,endDate:t,snappedDate:r,eventRecord:n,toSet:o})?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}}Xx._$name="EventResize",Jv.registerFeature(Xx,!0,"Scheduler"),Jv.registerFeature(Xx,!1,"ResourceHistogram");var Zx=e=>class extends(e||Qe){static $name="TaskEditStm";getStmCapture(){var e;return Object.assign((null===(e=super.getStmCapture)||void 0===e?void 0:e.call(this))??{},{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1})}applyStmCapture(e){this.stmInitiallyAutoRecord=e.stmInitiallyAutoRecord,this.stmInitiallyDisabled=e.stmInitiallyDisabled,this.hasStmCapture=!0,this.stmCapture=e,e.transferred=!0}captureStm(e=!1){const t=this,n=t.project.getStm();t.hasStmCapture||(t.hasStmCapture=!0,t.stmInitiallyDisabled=n.disabled,t.stmInitiallyAutoRecord=n.autoRecord,t.stmInitiallyDisabled?(n.enable(),n.autoRecord=!1):(t.stmInitiallyAutoRecord&&(n.autoRecord=!1),n.isRecording&&n.stopTransaction()),e&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const e=this,t=e.project.getStm();if(!e.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");t.enabled&&(t.stopTransaction(),e.stmInitiallyDisabled&&t.resetQueue())}async rejectStmTransaction(){const e=this.project.getStm(),{client:t}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");var n;e.enabled&&(null!==(n=e.transaction)&&void 0!==n&&n.length?(t.suspendRefresh(),e.rejectTransaction(),await t.resumeRefresh(!0)):e.isRecording&&e.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}async freeStm(e=null){const t=this,n=t.project.getStm(),{stmInitiallyDisabled:r,stmInitiallyAutoRecord:i}=t;if(!t.hasStmCapture)return;let s;t.rejectingStmTransaction=!0,!0===e?s=t.commitStmTransaction():!1===e&&(s=t.rejectStmTransaction()),t.hasStmCapture=!1,t.stmCapture=null,await s,n.isDestroying||(n.disabled=r,n.autoRecord=i),t.isDestroying||(t.rejectingStmTransaction=!1)}},Jx=e=>class extends(e||Qe){static $name="TaskEditTransactional";captureStm(e){if(this.client.transactionalFeaturesEnabled)return super.captureStm(),this.startStmTransaction(e);super.captureStm(e)}freeStm(e){if(this.hasStmCapture||!this.client.transactionalFeaturesEnabled)return super.freeStm(e)}async startStmTransaction(e){this.client.transactionalFeaturesEnabled?await this.startFeatureTransaction(e):super.startStmTransaction()}commitStmTransaction(){if(this.client.transactionalFeaturesEnabled)return this.finishFeatureTransaction();super.commitStmTransaction()}afterCancel(){this.client.transactionalFeaturesEnabled&&this.rejectFeatureTransaction()}};const Qx=function(e){var t;return(null===(t=this.source)||void 0===t||null===(t=t.client.features.taskEdit)||void 0===t||!t._canceling)&&Jt.getDistanceBetween(this.startEvent,e)};class eR extends(Xx.mixin(Zx,Jx)){static configurable={showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>`\n            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                ${e.startClockHtml}\n                ${e.endClockHtml}\n                <div class="b-sch-tip-message">${e.message}</div>\n            </div>\n        `,dragActiveCls:"b-dragcreating"};static get pluginConfig(){return{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}}construct(e,t){!1===(null==t?void 0:t.showTooltip)&&(t.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:n}=t,{eventRecord:r}=e,{draggingEnd:i}=e.mainContext,s="x"===this.dragLock,{initialDate:o}=this.dragging;t.enableEventAnimations=!1,r.set({startDate:o,endDate:o}),i?(e.endDate=o,Object.assign(e.mainContext,{toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"})):(e.startDate=o,Object.assign(e.mainContext,{toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"})),e.mainContext.draggingEnd=this.draggingEnd=!i,t.enableEventAnimations=n}beforeDrag(e){const t=this,n=super.beforeDrag(e),{pan:r,eventDragSelect:i}=t.client.features;return!(!1===n||t.preventMultiple&&!t.isRowEmpty(e.rowRecord)||t.disabled||r&&!r.disabled||i&&!i.disabled)&&(t.client.preventDragSelect=!0,n)}startDrag(e){const t=super.startDrag(e);if(!1!==t){const[t]=e.context.eventContexts;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){const{client:t}=this;if(t.matchScheduleCell(e.target)){const n=t.resolveResourceRecord(e),r=null==n?void 0:n.$original;if(r&&!r.isSpecialRow){const i=sg().prototype.setupDragContext.call(this,e),s=[];return t.isVertical?s.push({element:t.scrollable.element,direction:"vertical"}):s.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i.scrollManager=t.scrollManager,i.monitoringConfig={scrollables:s},i.resourceRecord=i.rowRecord=r,n!==r&&(i.resourceRecordLink=n),i.getDistance=Qx,i}}}async dragDrop({context:e,event:t}){var n;const{client:r}=this,{toSet:i}=e,[s]=e.eventContexts;s[i]=s.snappedDate;const{startDate:o,endDate:a,eventRecord:l}=s,{generation:d}=l;let c;null===(n=this.tip)||void 0===n||n.hide(),await r.project.commitAsync(),l.generation!==d&&(l[i]=s.oldValue,l[i]=s[i]),e.valid=o&&a&&a-o>0&&s[i]-s.oldValue&&!1!==e.valid,e.valid&&(e.startDate=s.startDate,e.endDate=s.endDate,r.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:s.element,eventElement:s.element,eventRecord:s.eventRecord,resourceRecord:s.resourceRecord}),c=!0),e.async||await e.finalize(c)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:W.assign({id:`${this.client.id}-drag-create-tip`},e),t)}async finalize(e){if(this.finalized)return;this.finalized=!0;const t=this.owner,n=this,[r]=n.eventContexts,i=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:r.element,eventElement:r.element,eventRecord:r.eventRecord,resourceRecord:r.resourceRecord}),t.cleanup(n))};var s;e?(await t.finalizeDragCreate(n),i()):(await t.cancelDragCreate(n),null===(s=t.onAborted)||void 0===s||s.call(t,n),i())}async cancelDragCreate(e){}async finalizeDragCreate(e){const t=this,{client:n}=t,[r]=e.eventContexts,{eventRecord:i,resourceRecord:s}=r;n.snapRelativeToEventStartDate&&(r[e.toSet]=r.snappedDate=n.timeAxis.roundDate(r.date,r.oldValue)),t.adjustRecordBeforeUpdating(r,i),n.endListeningForBatchedUpdates(),await t.internalUpdateRecord(r,i);const o=t.getStmCapture();return!n.isDestroyed&&n.trigger("dragCreateEnd",{eventRecord:i,resourceRecord:s,event:e.event,eventElement:r.element,stmCapture:o}),!n.isDestroyed&&n.trigger("eventAutoCreated",{eventRecord:i,resourceRecord:s}),o.transferred}cleanup(e){var t;const{client:n}=this,[r]=e.eventContexts;r.eventRecord.meta.isResizing=!1,n.endListeningForBatchedUpdates(),null===(t=this.tip)||void 0===t||t.hide(),n.element.classList.remove(...this.dragActiveCls.split(" ")),r.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,n,r=!1){return{...e,async:r,event:t,finalize:n}}onEventDataGenerated(e){var t;(null===(t=this.dragging)||void 0===t||null===(t=t.context)||void 0===t?void 0:t.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}get isDragCreating(){const{dragging:e}=this;return e&&e.state===e.constructor.STATE.DRAGGING}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}eR._$name="DragCreateBase";const tR=xi,nR=["startDate","endDate","resource","recurrenceRule"],rR=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,n]=e[0]instanceof wp?e:e.reverse(),r=tR.parse(t.value);return r&&n.value&&r.setHours(n.value.getHours(),n.value.getMinutes(),n.value.getSeconds(),n.value.getMilliseconds()),r?xi.clone(r):null}return null},iR=(e,t)=>{const n=new Date(e.getTime());return n.setHours(t.getHours(),t.getMinutes()),n},sR=(e,t,n)=>{if(!n.editor.assigningValues&&e&&t&&n.endDateField&&n.endTimeField){const e=tR.add(iR(n.startDateField.value,n.startTimeField.value),n._durationMS,"milliseconds");n.endDateField.value=e,n.endTimeField.value=tR.clone(e)}};class oR extends Mr{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,t){const n=this;e.eventEdit=n,super.construct(e,W.assign({weekStartDay:e.weekStartDay},t)),n.clientListenersDetacher=e.ion({[n.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this._editor)||void 0===e||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:t}=this;return t&&((e=C.clone(e)).items=ke.merge(t,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const t in e){const n=e[t];!0===n?delete e[t]:null!=n&&n.items&&this.cleanItemsConfig(n.items)}}onDatesChange({value:e,source:t}){var n,r,i;const s=this;if(e&&t===s.startDateField&&null!==(n=s.startTimeField)&&void 0!==n&&n.keepDate&&s.startTimeField.value&&(s.startTimeField.value.setFullYear(e.getFullYear()),s.startTimeField.value.setMonth(e.getMonth()),s.startTimeField.value.setDate(e.getDate())),(t===s.endDateField||t===s.endTimeField)&&s.startDateField){var o,a,l,d,c,u;const e=null!==(o=s.endTimeField)&&void 0!==o&&o.value&&null!==(a=s.endDateField)&&void 0!==a&&a.value?iR(s.endDateField.value,s.endTimeField.value):null===(l=s.endDateField)||void 0===l?void 0:l.value,t=null!==(d=s.startTimeField)&&void 0!==d&&d.value&&null!==(c=s.startDateField)&&void 0!==c&&c.value?iR(s.startDateField.value,s.startTimeField.value):null===(u=s.startDateField)||void 0===u?void 0:u.value;e&&t&&(s._durationMS=e-t)}var h,g;(s.startDateField&&s.endDateField&&(s.endDateField.min=s.startDateField.value),s.endTimeField)&&(tR.isEqual(tR.clearTime(null===(h=s.startDateField)||void 0===h?void 0:h.value),tR.clearTime(null===(g=s.endDateField)||void 0===g?void 0:g.value))?s.endTimeField.min=s.startTimeField.value:s.endTimeField.min=null);switch(t.ref){case"startDateField":(null===(r=s.startTimeField)||void 0===r?void 0:r.value)&&sR(e,s.startTimeField.value,s);break;case"startTimeField":(null===(i=s.startDateField)||void 0===i?void 0:i.value)&&sR(s.startDateField.value,e,s)}}async save(){throw new Error("Implement in subclass")}get values(){const e=this,{editor:t}=e,n=[],r=[],{values:i}=t;return nR.forEach((e=>delete i[e])),t.eachWidget((s=>{var o;const{name:a}=s;if(!a||s.hidden||s.up((t=>t===e.recurrenceEditor)))delete i[a];else switch(a){case"startDate":n.push(s);break;case"endDate":r.push(s);break;case"resource":i[a]=s.record;break;case"recurrenceRule":i[a]="none"===(null===(o=t.widgetMap.recurrenceCombo)||void 0===o?void 0:o.value)?"":s.value}}),!0),i.allDay&&!e.eventRecord.allDay&&(n.push(e.startTimeField),r.push(e.endTimeField)),n.length&&(i.startDate=rR(n)),r.length&&(i.endDate=rR(r)),"startDate"in i&&"endDate"in i&&(i.duration=tR.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;return this.assignmentStore&&delete t.resource,this._durationMS=xi.asMilliseconds(t.duration??e.duration,e.durationUnit),e.set(t)}onBeforeEditorShow(){const{eventRecord:e,editor:t}=this.editingContext,{nameField:n}=t.widgetMap;n&&e.isCreating&&(t.assigningValues=!0,n.value="",t.assigningValues=!1,n._configuredPlaceholder=n.placeholder,n.placeholder=e.name)}resetEditingContext(){const e=this;if(!e.editingContext)return;const{client:t}=e,{editor:n,eventRecord:r}=e.editingContext,{eventStore:i}=t,{nameField:s}=n.widgetMap;if(r.isCreating){var o;if(t.isTimelineBase)null===(o=e.editingContext.eventElement)||void 0===o||o.closest("[data-event-id]").classList.add("b-released");i.remove(r),r.isCreating=!1}s&&(s.placeholder=s._configuredPlaceholder),t.element.classList.remove("b-eventeditor-editing"),e.targetEventElement=e.editingContext=n._record=null}onPopupKeyDown({event:e}){const t=this;!t.readOnly&&"Enter"===e.key&&t.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&t.startTimeField&&sR(t.startDateField.value,t.startTimeField.value,t),t.onSaveClick())}async finalizeStmCapture(e){}async onSaveClick(){const e=this;e.editor.focus(),e.isFinalizingEventSave=!0;const t=await e.save();return e.isFinalizingEventSave=!1,t&&(await e.finalizeStmCapture(!1),e.isDestroyed||(e.editor.close(e),e.client.trigger("afterEventEdit",{...e.editingContext,action:"save"}))),t}async onDeleteClick(){const e=this;e.isDeletingEvent=!0;const t=await e.deleteEvent();e.isDeletingEvent=!1,t&&(await e.finalizeStmCapture(!1),e.isDestroyed||(e.editor.close(e),e.client.trigger("afterEventEdit",{...e.editingContext,action:"delete"})))}async onCancelClick(){const e=this;e.isCancelingEdit=!0,e.editor.close(e),e.isCancelingEdit=!1,e.hasStmCapture&&await e.finalizeStmCapture(!0),e.isDestroyed||e.client.trigger("afterEventEdit",{...e.editingContext,action:"cancel"})}}oR._$name="EditBase";class aR extends(Mr.mixin(ax)){static configurable={tabIndex:null,entityName:"resourceTimeRange"};static get pluginConfig(){return{before:["onInternalPaint"],chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some((t=>e.isTimeSpanInAxis(t)))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}onInternalPaint({firstPaint:e}){e&&this.setupCanvas()}setupCanvas(){const{entityName:e,client:t}=this;this.canvas||(this.canvas=t.canvases[e]=Yn.createElement({className:`b-${N.hyphenate(e)}-canvas b-sch-canvas`,parent:t.timeAxisSubGridElement,retainElement:!0}))}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{client:n}=t,{eventRecord:r,iconCls:i}=e;t.shouldInclude(r)&&(n.isVertical?e.width=n.getResourceWidth(e.resourceRecord):e.top=0,e.entityName=t.entityName,e.fillSize=!0,e.wrapperCls["b-sch-resourcetimerange"]=1,t.rangeCls&&(e.wrapperCls[t.rangeCls]=1),e.wrapperCls[`b-sch-color-${r.timeRangeColor}`]=r.timeRangeColor,t.renderContent(r,e),e.children.push(e.eventContent),e.tabIndex=null!=t.tabIndex?String(t.tabIndex):null,(null==i?void 0:i.length)>0&&e.children.unshift({tag:"i",className:i.toString()}),e.eventId=t.generateElementId(r))}renderContent(e,t){t.eventContent.text=e.name}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var t;return null==e||null===(t=e.closest(`.${this.rangeCls}`))||void 0===t?void 0:t.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.canvas.syncIdMap[e.domId]}resolveResourceRecord(e){var t;return this.overridden.resolveResourceRecord(...arguments)||(null===(t=this.resolveResourceTimeRangeRecord(e.target||e))||void 0===t?void 0:t.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){"removeall"!==e.action&&"dataset"!==e.action||(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}matchScheduleCell(e){let t=this.overridden.matchScheduleCell(e);if(!t&&this.enableMouseEvents){const{client:n}=this,r=e.closest(`.${this.rangeCls}`);t=r&&n.getCell({record:n.isHorizontal?r.elementData.resource:n.store.first,column:n.timeAxisColumn})}return t}handleRangeMouseEvent(e){const t=this,n=e.target.closest(`.${t.rangeCls}`);if(n){const r=Jt.eventNameMap[e.type]??N.capitalize(e.type),i=t.resolveResourceTimeRangeRecord(n);t.client.trigger(t.entityName+r,{feature:t,[`${t.entityName}Record`]:i,resourceRecord:t.client.resourceStore.getById(i.resourceId),startDate:i.startDate,endDate:i.endDate,domEvent:e})}}updateEnableMouseEvents(e){var t;const n=this,{client:r}=n;null===(t=n.mouseEventsDetacher)||void 0===t||t.call(n),n.mouseEventsDetacher=null,r.whenVisible((()=>{e&&(n.mouseEventsDetacher=Jt.on({element:r.canvases[n.entityName],delegate:`.${n.rangeCls}`,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:n})),n.canvas.classList.toggle("b-interactive",Boolean(e))}))}}aR.featureClass="",aR._$name="ResourceTimeRangesBase";class lR extends ah{}lR._$name="TimeSpanMenuBase";let dR=0;class cR extends Mr{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onInternalPaint"]}}construct(e,t){const n=this;t=n.processConfig(t),super.construct(e,t),n.forSelector||(n.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy,.b-iscreating)`),n.clockTemplate=new Gx({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var e;null===(e=n.tooltip)||void 0===e||e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onInternalPaint({firstPaint:e}){if(e){var t;const e=this,{client:n}=e,r=`:not(${[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${n.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].join()})`;null===(t=e.tooltip)||void 0===t||t.destroy();const i=e.tooltip=new tm({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip-${dR++}`,cls:e.tipCls,forSelector:`.b-timelinebase${r} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",forElement:n.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:e.getTipHtml.bind(e),disabled:e.disabled,...e.config,internalListeners:e.configuredListeners});i.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:e}),Object.keys(i.$meta.configs).forEach((e=>{Object.defineProperty(this,e,{set:t=>i[e]=t,get:()=>i[e]})}))}}processConfiguredListeners(){}addListener(...e){var t;const n=super.addListener(...e),r=null===(t=this.tooltip)||void 0===t?void 0:t.addListener(...e);if(n||r)return()=>{null==n||n(),null==r||r()}}removeListener(...e){var t;super.removeListener(...e),null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,n=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),n&&e.clockTemplate.updateDateIndicator(n,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}resolveData(e,t){const n=this,{client:r}=n,i=n.recordType||`${r.scheduledEventName}Record`,s=n.resolveTimeSpanRecord(t);if(s&&!s.isCommitting){e.eventRecord=e.record=s;const{startDate:t,endDate:o}=s,a=r.getFormattedDate(t),l=r.getDisplayEndDate(o,t),d=r.getFormattedDate(l);return{tip:e,[`${i}`]:s,startDate:t,endDate:o,startText:a,endText:d,startClockHtml:n.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":n.clockTemplate.template({date:l||"",text:d||"",cls:"b-sch-tooltip-enddate"})}}return null}getTipHtml({tip:e,activeTarget:t}){const n=this.resolveData(e,t);if(n&&this.template)return n.startDate instanceof Date?this.template(n):(e.hide(),"")}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({change:e.onRecordUpdate,buffer:300,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=this.tooltip.record=null,null===(e=this.updateListener)||void 0===e||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){const{tooltip:t}=this;t.isVisible&&(this.client.timeAxisSubGrid.scrolling||this.client.scrolling?t.hide(!1):t.eventRecord=this.resolveTimeSpanRecord(e))}onRecordUpdate({record:e}){const{tooltip:t}=this;null!=t&&t.isVisible&&e===this.record&&(t.updateContent(),t.lastAlignSpec.aligningToElement?t.realign():t.internalOnPointerOver(this.client.lastPointerEvent))}}cR._$name="TooltipBase";class uR extends(Mr.mixin(Hi)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,hoverTooltip:null,tooltipTemplate:null,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${N.encodeHtml(e.name)||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}static configurable={showHeaderElements:!0};static get pluginConfig(){return{chain:["updateFillTicks","onInternalPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}}construct(e,t){const n=this;super.construct(e,t),e.isVertical&&e.ion({renderRows:n.onUIReady,thisObj:n,once:!0}),n.cls=n.cls||`b-sch-${n.constructor.$$name.toLowerCase()}`,n.baseSelector=`.${n.baseCls}.${n.cls}`,n.enableResizing&&(n.showHeaderElements=!0)}doDestroy(){var e,t,n,r;const i=this;i.detachListeners("timeAxisViewModel"),i.detachListeners("timeAxis"),null===(e=i.clockTemplate)||void 0===e||e.destroy(),null===(t=i.tip)||void 0===t||t.destroy(),null===(n=i.drag)||void 0===n||n.destroy(),null===(r=i.resize)||void 0===r||r.destroy(),super.doDestroy()}doDisable(e){this.isConfiguring||this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}onUIReady(){const e=this,{client:t}=e;t.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&Jt.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=Zl.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement.parentElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(n,r)=>!t.readOnly&&e.isElementDraggable(n,r),rtlSource:t,positioning:"inset",scrollManager:t.scrollManager,internalListeners:{dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=dh.new({direction:t.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:(e,t)=>!e.matches(".b-dragging,.b-readonly")&&!t.target.matches(".b-fa"),rtlSource:t,positioning:"inset",internalListeners:{resizeStart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new tm(W.assign({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const n=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:n})},forSelector:`.b-timelinebase:not(.b-dragging-timerange, .b-resizing-timerange) .${e.baseCls}${e.cls?"."+e.cls:""}`},e.hoverTooltip)))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,t){const n=this,r=[],i=[];if(!n.disabled){n._labelRotationMap={};for(const s of n.timeRanges){const o=n.renderRange(s,e,t);o&&(r.push(o.bodyConfig),i.push(o.headerConfig))}}return[r,i]}renderRanges(){const e=this,{client:t}=e;if(t.isPainted&&!t.timeAxisSubGrid.collapsed){const{headerContainerElement:n}=e,r=[],[i,s]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=Yn.createElement({className:`b-timeranges-canvas b-timeranges-body-canvas ${e.cls}-canvas b-sch-canvas`,parent:t.timeAxisSubGridElement,retainElement:!0})),ud.sync({targetElement:e.bodyCanvas,domConfig:{children:i,onlyChildren:!0,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:e,action:t})=>{"reuseElement"!==t&&"newElement"!==t&&"reuseOwnElement"!==t||r.push(e)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=Yn.createElement({className:`b-timeranges-canvas b-timeranges-header-canvas ${e.cls}-canvas`,parent:n,retainElement:!0})),e.headerCanvas&&ud.sync({targetElement:e.headerCanvas,domConfig:{onlyChildren:!0,children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const t of r)e.cacheRotation(t.elementData.timeRange,t);for(const t of r)e.applyRotation(t.elementData.timeRange,t)}}get timeRanges(){return[]}shouldRenderRange(e,t=this.client.visibleDateRange.startDate,n=this.client.visibleDateRange.endDate){const{timeAxis:r}=this.client,{startDate:i,endDate:s,duration:o}=e;return Boolean(i&&(r.isContinuous||r.isTimeSpanInAxis(e))&&xi.intersectSpans(t,n,i,o?s:xi.add(i,this._lineBufferDurationMS)))}getRangeDomConfig(e,t,n,r=0){const i=this,{client:s}=i,{rtl:o,timeAxis:a}=s;let{startDate:l,endDate:d}=e;if(s.fillTicks&&(d&&d-l!=0||e.fillAlign)&&(l=d||"start"===e.fillAlign?a.getSnappedTickFromDate(l).startDate:a.getSnappedTickFromDate(l).endDate,d)){const e=Math.ceil(a.getTickFromDate(d))-1;d=a.getAt(e).endDate}const c=s.getVirtualCoordFromDate(xi.max(l,t),{respectExclusion:!0})-r,u=d?s.getVirtualCoordFromDate(xi.min(d,n),{respectExclusion:!0,isEnd:!0})-r:c,h=Math.abs(u-c),g=h>0;return{className:{[i.baseCls]:1,[i.cls]:i.cls,[i.rangeCls]:g,[i.lineCls]:!g,[e.cls]:e.cls,"b-narrow-range":g&&h<i.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":o},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?`inset-block-start: ${c}px; ${g?`height:${h}px`:""};`:`inset-inline-start: ${c}px; ${g?`width:${h}px`:""};`}}renderRange(e,t,n){const r=this,{client:i}=r,{timeAxis:s}=i;if(i.timeAxisViewModel.availableSpace>0&&s.startDate&&r.shouldRenderRange(e,t,n)){const t=r.getRangeDomConfig(e,s.startDate,s.endDate),n=e.iconCls&&N.xss`<i class="${e.iconCls}"></i>`,i=e.name&&N.encodeHtml(e.name),o=i||n?`${n||""}<label>${i||"&nbsp;"}</label>`:"",a={...t,style:t.style+(e.style||""),html:r.bodyRenderer?r.bodyRenderer({timeRange:e}):r.showHeaderElements&&!r.showLabelInBody?"":o};let l;return r.showHeaderElements&&(l={...t,html:r.headerRenderer?r.headerRenderer({timeRange:e}):r.showLabelInBody?"":o}),{bodyConfig:a,headerConfig:l}}}cacheRotation(e,t){if(!e.iconCls&&!e.name||!e.duration)return;const n=t.firstElementChild;n&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?n.offsetHeight<t.offsetHeight:n.offsetWidth>t.offsetWidth)}applyRotation(e,t){var n,r;const i=this._labelRotationMap[(null===(n=e.recurringTimeSpan)||void 0===n?void 0:n.id)??e.id];null===(r=t.firstElementChild)||void 0===r||r.classList.toggle("b-vertical",Boolean(i))}getBodyElementByRecord(e){const t="string"==typeof e?e:null==e?void 0:e.id;return null!=t&&ud.getChild(this.bodyCanvas,t)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:t,timeAxisColumn:n}=e.client;return e._headerContainerElement||(t?e._headerContainerElement=e.client.subGrids.locked.element:t||(e._headerContainerElement=n.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:t}=this;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:t}){}onInternalPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:e}=this.client;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}onInternalResize(e,t,n,r,i){this.client.isVertical&&i!==n&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(e){const t=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${N.capitalize(e.type)}`,{domEvent:e,timeRangeRecord:t})}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new Gx({scheduler:t.client}),t.tip=tm.reconfigure(t.tip,tm.mergeConfigs({type:"tooltip",id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:t,drag:n}=this;t.isVertical?(n.minY=0,n.maxY=t.timeAxisViewModel.totalSize-e.element.offsetHeight,n.minX=0,n.maxX=Number.MAX_SAFE_INTEGER):(n.minX=0,n.maxX=t.timeAxisViewModel.totalSize-e.element.offsetWidth,n.minY=0,n.maxY=Number.MAX_SAFE_INTEGER),t.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}updateDateIndicator({startDate:e,endDate:t}){const n=this,{tip:r}=n,i=r.element.querySelector(".b-sch-tooltip-enddate");n.clockTemplate.updateDateIndicator(r.element,e),i&&n.clockTemplate.updateDateIndicator(i,t)}onDrag({context:e}){const t=this;if(t.showTooltip){const{client:n}=t,r=Ot.from(e.element),i=r.getStart(n.rtl,n.isHorizontal),s=r.getEnd(n.rtl,n.isHorizontal),o=n.getDateFromCoordinate(i,"round",!1),a=n.getDateFromCoordinate(s,"round",!1);t.updateDateIndicator({startDate:o,endDate:a})}}onDragReset(){}onResizeStart(){var e;this.client.element.classList.add("b-resizing-timerange"),null===(e=this.hoverTooltip)||void 0===e||e.hide()}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){this.client.element.classList.remove("b-resizing-timerange")}getTipHtml(e,t){const n=this,{client:r}=n,i=Ot.from(t),s=i.getStart(r.rtl,r.isHorizontal),o=i.getEnd(r.rtl,r.isHorizontal),a=r.getDateFromCoordinate(s,"round",!1),l=e.endDate&&r.getDateFromCoordinate(o,"round",!1),d=r.getFormattedDate(a),c=l&&r.getFormattedEndDate(l,a);return n.dragTipTemplate({name:e.name||"",startDate:a,endDate:l,startText:d,endText:c,startClockHtml:n.clockTemplate.template({date:a,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&n.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}updateFillTicks(){this.isConfiguring||this.refresh()}}uR._$name="AbstractTimeRanges";const hR=Object.freeze({});class gR extends(Mr.mixin(ax,Hi)){static $name="ColumnLines";static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static configurable={renderer:null};static get pluginConfig(){return{after:["render","updateCanvasSize","internalOnVisibleDateRangeChange","onVisibleResourceRangeChange","onVisibleResourceColumnChange"]}}attachToResourceStore(e){const{client:t}=this;super.attachToResourceStore(e),t.isVertical&&t.resourceStore.ion({name:"resourceStore",group({groupers:e}){0===e.length&&this.refresh()},thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,t,n,r){const i=this,{client:s}=i,{timeAxisViewModel:o,isHorizontal:a,resourceStore:l,variableColumnWidths:d}=s,{columnConfig:c}=o,u=o.columnLinesFor,h=Math.max(u-1,0),g=e.getTime(),m=t.getTime(),p=[],f=new Set,v=a?"insetInlineStart":"insetBlockStart";if(!i.disabled){const e=(e,t)=>{const n=e.start.getTime();if(n>g&&n<m&&!f.has(n)){const r={role:"presentation",className:{"b-column-line-major":t,"b-column-line":!t},style:{[v]:e.coord},dataset:{line:t?`major-${e.index}`:`line-${e.index}`}};f.add(n),p.push(r),i.renderer&&i.callback(i.renderer,i,[e.start,r])}};if(u!==h)for(let t=1;t<=c[h].length-1;t++)e(c[h][t],!0);for(let t=1;t<=c[u].length-1;t++)e(c[u][t],!1);if(!a&&s.columnLines){const{columnWidth:e}=s.resourceColumns;n||r||({first:n,last:r}=s.currentOrientation.getResourceRange(!0));let t=0;if(n>-1)for(let i=n;i<r+1;i++){const n=l.getAt(i);if(n.isGroupHeader){r++,t++;continue}const o=n.instanceMeta(s),a=d?o.insetStart+s.getResourceWidth(n)-1:(i-t+1)*e-1,c=n.instanceMeta(s.resourceStore).groupParent;p.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":l.isGrouped&&(null==c?void 0:c.groupChildren[(null==c?void 0:c.groupChildren.length)-1])===n},style:{insetInlineStart:a},dataset:{line:`resource-${i}`}})}}}return p}refresh(){const e=this,{client:t}=e,{timeAxis:n}=t,{startDate:r,endDate:i}=t.visibleDateRange||hR;if(!n.startDate||!r||e.client.timeAxisSubGrid.collapsed)return;e.element||(e.element=Yn.createElement({parent:t.timeAxisSubGridElement,className:"b-column-lines-canvas b-sch-canvas"}));const s=e.getColumnLinesDOMConfig(r,i);ud.sync({targetElement:e.element,domConfig:{onlyChildren:!0,children:s,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}internalOnVisibleDateRangeChange(){this.refresh.now()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}onVisibleResourceColumnChange(e,t){this.refresh()}updateCanvasSize(){this.refresh()}}gR._$name="ColumnLines",Jv.registerFeature(gR,!0,["Scheduler","Gantt","TimelineHistogram"]);var mR=e=>class extends(e||Qe){static $name="DependencyCreation";static configurable={allowDropOnEventBar:!0,terminalSize:null,terminalOffset:null,terminalShowDelay:0,terminalHideDelay:0,allowCreateOnlyParent:!1};static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const n=this;n.eventName=e.scheduledEventName,e.ion({readOnly:()=>n.updateCreateListeners()}),n.updateCreateListeners(),n.chain(e,"onElementTouchMove","onElementTouchMove")}doDestroy(){var e,t;const n=this;n.detachListeners("view"),n.creationData=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.creationTooltip)||void 0===t||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.client&&(e.detachListeners("view"),e.isCreateAllowed&&e.client.ion({name:"view",[`${e.eventName}MouseEnter`]:"onTimeSpanMouseEnter",[`${e.eventName}MouseLeave`]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.client.readOnly&&!this.disabled}updateAllowCreateOnlyParent(e){this.client.element.classList.toggle("b-dependency-only-parent",e)}updateTerminalOffset(e){this.client.whenVisible((()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-offset",-e+"px")}))}updateTerminalSize(e){"number"==typeof e&&(e=`${e}px`),this.client.whenVisible((()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-size",e?`${e}`:null)}))}onTimeSpanMouseEnter({event:e,source:t,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:r,resourceRecord:i}){if(!n.isCreating&&!n.readOnly){const s=this,{creationData:o,client:a}=s,l=Yn.down(r,t.eventInnerSelector);if(n!==(null==o?void 0:o.source)){const{parent:t}=n;if(n.isEventModel&&t&&!t.isRoot&&a.eventStore.includes(t)){const e=a.getElementFromEventRecord(t,i,!0);e&&s.delayHideTerminals(e)}s.delayShowTerminals(n,r),o&&e.target.closest(a.eventSelector)&&(o.timeSpanElement=l,s.onOverTargetEventBar(e))}}}onTimeSpanMouseLeave(e){var t,n,r,i;const{eventRecord:s,event:o}=e;if(!o)return;const a=this,{creationData:l,client:d}=a,c=null!==(t=o.relatedTarget)&&void 0!==t&&t.matches(".b-sch-terminal-hover-area, .b-sch-terminal")?null:null===(n=o.relatedTarget)||void 0===n?void 0:n.closest(d.eventSelector),u=(null==c||null===(r=c.elementData)||void 0===r?void 0:r.eventRecord)??(null==c||null===(i=c.elementData)||void 0===i?void 0:i.taskRecord),{parent:h}=s??{},g=e[`${a.eventName}Element`];if((o.isTrusted||G.isTestEnv||l)&&a.delayHideTerminals(g),h&&!h.isRoot&&d.eventStore.includes(h)){const e=d.getElementFromEventRecord(h);e&&a.delayShowTerminals(h,e)}l&&a.onOverNewTargetWhileCreating(o.relatedTarget,null!=u&&u.readOnly||null!=u&&u.isOccurence?null:u,o)}onTerminalMouseOver(e){this.clearTimeout(`hide-${e.target.closest(this.client.eventSelector).dataset.syncId}`),this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){var t,n,r;const i=this,{creationData:s,client:o}=i,a=e.target.closest(o.eventSelector),l=null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(o.eventSelector),d=(null==l||null===(n=l.elementData)||void 0===n?void 0:n.eventRecord)??(null==l||null===(r=l.elementData)||void 0===r?void 0:r.taskRecord);l===a||!a||i.hasTimeout(`show-${a.dataset.syncId}`)||s&&a===s.timeSpanElement||(i.delayHideTerminals(a),o.unhover(a,e)),s&&i.onOverNewTargetWhileCreating(e.relatedTarget,null!=d&&d.readOnly||null!=d&&d.isOccurence?null:d,e)}onTerminalPointerDown(e){const t=this;if(0===e.button&&!t.creationData){var n;const{client:r}=t,i=r.timeAxisSubGridElement,s=e.target,o=s.closest(r.eventInnerSelector),a=Ot.from(r.element);e.stopPropagation(),t.creationData={sourceElement:o,source:r.resolveTimeSpanRecord(o).$original,fromSide:s.dataset.side,startPoint:Ot.from(s,i).center,startX:e.pageX-a.x+r.scrollLeft,startY:e.pageY-a.y+r.scrollTop,valid:!1,sourceResource:null===(n=r.resolveResourceRecord)||void 0===n?void 0:n.call(r,e),tooltip:t.creationTooltip},t.pointerUpMoveDetacher=Jt.on({pointerup:{element:Yn.getRootElement(r.element),handler:"onMouseUp",passive:!1},pointermove:{element:i,handler:"onMouseMove",passive:!1},thisObj:t}),t.documentPointerUpDetacher=Jt.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:e})=>{"Escape"===e&&t.abort()}},thisObj:t})}}onElementTouchMove(e){var t;null===(t=super.onElementTouchMove)||void 0===t||t.call(this,e),this.connector&&e.preventDefault()}onMouseMove(e){const t=this,{client:n,creationData:r}=t,i=Ot.from(n.element),s=e.pageX-i.x+n.scrollLeft-r.startX,o=e.pageY-i.y+n.scrollTop-r.startY,a=Math.round(Math.sqrt(s*s+o*o))-3,l=Math.atan2(o,s);let{connector:d}=t;if(!d){if(!1===t.onRequestDragCreate(e))return void t.abort();d=t.connector}d.style.width=`${a}px`,d.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(e){const t=this,{client:n,creationData:r}=t;if(!1===n.trigger("beforeDependencyCreateDrag",{data:r,source:r.source}))return!1;if(n.element.classList.add("b-creating-dependency"),t.createConnector(r.startPoint.x,r.startPoint.y),n.trigger("dependencyCreateDragStart",{data:r,source:r.source}),t.showCreationTooltip){const n=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=n,n.disabled=!1,n.show(),n.onMouseMove(e)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)})}onOverTargetEventBar(e){var t;const n=this,{client:r,creationData:i,allowDropOnEventBar:s}=n,{target:o}=e;let a=r.resolveTimeSpanRecord(o).$original;null!==(t=a)&&void 0!==t&&t.isEventSegment&&(a=a.event),C.isPromise(i.valid)||!s&&!o.classList.contains(n.terminalCls)||a!==i.source&&n.onOverNewTargetWhileCreating(o,a,e)}async onOverNewTargetWhileCreating(e,t,n){const r=this,{client:i,creationData:s,allowDropOnEventBar:o,connector:a}=r;if(!C.isPromise(s.valid)&&!s.finalizing&&a){if(a.classList.remove("b-valid","b-invalid"),s.timeSpanElement&&Yn.removeClsGlobally(s.timeSpanElement,"b-sch-terminal-active"),!t||t===s.source||!o&&!e.classList.contains(r.terminalCls)||r.allowCreateOnlyParent&&!t.isParent)s.target=s.toSide=null,s.valid=!1,a.classList.add("b-invalid");else{var l;const d=s.target=t,{source:c}=s;let u,h=e.dataset.side;o&&!e.classList.contains(r.terminalCls)&&(h=r.getTargetSideFromType(r.dependencyStore.modelClass.fieldMap.type.defaultValue||rD.Type.EndToStart)),i.resolveResourceRecord&&(s.targetResource=i.resolveResourceRecord(n)),s.toSide=h;const g=s.fromSide,m=t=>{r.isDestroyed||(s.valid=t,e.classList.add(t?"b-valid":"b-invalid"),a.classList.add(t?"b-valid":"b-invalid"),i.trigger("dependencyValidationComplete",{data:s,source:c,target:d,dependencyType:u}))};switch(!0){case"start"===g&&"start"===h:u=rD.Type.StartToStart;break;case"start"===g&&"end"===h:u=rD.Type.StartToEnd;break;case"end"===g&&"start"===h:u=rD.Type.EndToStart;break;case"end"===g&&"end"===h:u=rD.Type.EndToEnd}i.trigger("dependencyValidationStart",{data:s,source:c,target:d,dependencyType:u});let p=s.valid=r.dependencyStore.isValidDependency(c,d,u);C.isPromise(p)?(p=await p,m(p)):m(p);const f=p?"b-valid":"b-invalid";a.classList.add(f),null===(l=s.timeSpanElement)||void 0===l||null===(l=l.querySelector(`.${r.terminalCls}[data-side=${h}]`))||void 0===l||l.classList.add("b-sch-terminal-active",f)}r.updateCreationTooltip()}}async onMouseUp(){var e;const t=this,n=t.creationData;if(n.finalizing=!0,null===(e=t.pointerUpMoveDetacher)||void 0===e||e.call(t),n.valid){if(!1===await t.client.trigger("beforeDependencyCreateFinalize",n)?n.valid=!1:C.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let e=await t.createDependency(n);null!==e&&(C.isPromise(e)&&(e=await e),n.dependency=e,t.client.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:e}),await t.doAfterDependencyDrop(n))}else await t.doAfterDependencyDrop(n)}else n.valid=!1,await t.doAfterDependencyDrop(n);t.abort()}doAfterDependencyDrop(e){this.client.trigger("afterDependencyCreateDrop",{data:e,...e})}onDocumentMouseUp({target:e}){this.client.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const n=this,{client:r,creationData:i}=n;if(i){const{source:e,sourceResource:t,target:s,targetResource:o}=i;if(e){const i=r.getElementFromEventRecord(e,t);i&&n.hideTerminals(i)}if(s){const e=r.getElementFromEventRecord(s,o);e&&n.hideTerminals(e)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,null===(e=n.pointerUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.documentPointerUpDetacher)||void 0===t||t.call(n),n.removeConnector()}createConnector(e,t){const n=this,{client:r}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=Yn.createElement({parent:r.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),r.element.classList.add("b-creating-dependency")}createDragTooltip(){const e=this,{client:t}=e;return e.creationTooltip=tm.new({id:`${t.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}removeConnector(){const e=this,{connector:t,client:n}=e;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout((()=>{t.remove(),e.connector=null}),200)),n.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),n.scrollManager.stopMonitoring()}delayShowTerminals(e,t){const n=this,{syncId:r}=t.dataset;n.clearTimeout(`hide-${r}`),n.clearTimeout(`show-${r}`),t.classList.remove("b-hiding-terminals"),n.terminalShowDelay?n.setTimeout({fn:()=>n.showTerminals(e,t),name:`show-${r}`,args:[e,t],delay:n.terminalShowDelay}):n.showTerminals(e,t)}delayHideTerminals(e){const t=this,{syncId:n}=e.dataset;t.clearTimeout(`hide-${n}`),t.clearTimeout(`show-${n}`),e.classList.add("b-hiding-terminals"),t.terminalHideDelay?t.setTimeout({fn:()=>t.hideTerminals(e),name:`hide-${n}`,args:[e],delay:t.terminalHideDelay}):t.hideTerminals(e)}showTerminals(e,t=this.client.getElementFromEventRecord(e)){const n=this;if(!n.isCreateAllowed||!e.project||!t||n.allowCreateOnlyParent&&!e.isParent)return;const{client:r}=n,i=n.terminalCls,s=`${i}s-visible`;if(n.showingTerminalsFor&&n.hideTerminals(n.showingTerminalsFor),!(t=Yn.down(t,n.client.eventInnerSelector)).classList.contains(s)&&!r.element.classList.contains("b-resizing-event")&&!r.readOnly){if(!1===r.trigger("beforeShowTerminals",{source:e}))return;Yn.createElement({parent:t.closest(r.eventSelector),className:"b-sch-terminal-hover-area"}),n.terminalSides.forEach((e=>{e=n.fixSide(e);const r=Yn.createElement({parent:t,className:`${i} ${i}-${e}`,dataset:{side:e,feature:!0}});r.detacher=Jt.on({element:r,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})})),t.classList.add(s),e.internalCls.add(s)}}fixSide(e){return"left"===e?"start":"right"===e?"end":e}hideTerminals(e){var t;const n=this,{client:r}=n,i=r.getTimeSpanMouseEventParams(e),s=null==i?void 0:i[`${n.eventName}Record`],o=`${n.terminalCls}s-visible`;null===(t=e.querySelector(".b-sch-terminal-hover-area"))||void 0===t||t.remove(),Yn.forEachSelector(e,`> ${r.eventInnerSelector} > .${n.terminalCls}`,(e=>{var t;null===(t=e.detacher)||void 0===t||t.call(e),e.remove()})),Yn.down(e,r.eventInnerSelector).classList.remove(o),null==s||s.internalCls.remove(o),e.classList.remove("b-hiding-terminals")}createDependency(e){const{source:t,target:n,fromSide:r,toSide:i}=e,s=("start"===r?0:2)+("end"===i?1:0),o=this.dependencyStore.add({from:t.id,to:n.id,type:s,fromSide:r,toSide:i});return null!==o?o[0]:null}getTargetSideFromType(e){return e===rD.Type.StartToStart||e===rD.Type.EndToStart?"start":"end"}updateCreationTooltip(){const e=this;if(!e.showCreationTooltip)return;const t=e.creationData,{valid:n}=t,r=e.creationTooltip,{classList:i}=r.element;if(C.isPromise(n))return i.remove("b-invalid"),i.add("b-checking"),new Promise((i=>n.then((n=>{t.valid=n,r.isDestroyed||i(e.updateCreationTooltip())}))));r.html=e.creationTooltipTemplate(t)}creationTooltipTemplate(e){var t;const n=this,{tooltip:r,valid:i}=e,{classList:s}=r.element;let o,a;return Object.assign(e,{fromText:e.source.name,toText:(null===(t=e.target)||void 0===t?void 0:t.name)??"",fromSide:e.fromSide,toSide:e.toSide||""}),s.toggle("b-invalid",!i),s.remove("b-checking"),!0===i?(o="valid",a=n.L("L{Dependencies.valid}")):(o="invalid",a=n.L("L{Dependencies.invalid}")),r.title=`<i class="b-icon b-icon-${o}"></i>${a}`,[{dataset:{ref:"fromLabel"},tag:"label",text:n.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${e.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:n.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${e.toSide}`}]}doDisable(e){this.isConfiguring||this.updateCreateListeners(),super.doDisable(e)}};var pR=e=>class extends e{static $name="DependencyGridCache";gridCache=null;getDependenciesToConsider(e,t,n,r){const i=this,{gridCache:s}=i,{timeAxis:o}=i.client;if(s){const a=new Set,l=Math.floor((e-o.startMS)/i.MS_PER_CELL),d=Math.floor((t-o.startMS)/i.MS_PER_CELL),c=Math.floor(n/25),u=Math.floor(r/25);for(let e=l;e<=d;e++){const t=s[e];if(t)for(let e=c;e<=u;e++){const n=t[e];if(n)for(let e=0;e<n.length;e++)a.add(n[e])}}return a}}afterDrawDependency(e,t,n,r,i){const s=this;if(s.constructGridCache){const{MS_PER_CELL:o}=s,{startMS:a,endMS:l}=s.client.timeAxis,d=Math.ceil((l-a)/o),c=Math.floor((r-a)/o),u=Math.floor((i-a)/o),h=Math.floor(t/25),g=Math.floor(n/25),m=Math.min(c,u),p=Math.max(c,u),f=Math.min(h,g),v=Math.max(h,g);if(m<0&&p<0||m>d&&p>d)return;const y=Math.max(m,0),b=Math.min(p,d);for(let t=y;t<=b;t++){const n=s.gridCache[t]??(s.gridCache[t]={});for(let t=f;t<=v;t++){(n[t]??(n[t]=[])).push(e)}}}}beforeDraw(){const e=this;if(!e.gridCache){const{visibleDateRange:t}=e.client;e.constructGridCache=!0,e.MS_PER_CELL=Math.max(t.endMS-t.startMS,1e3),e.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}};const fR=Math.min(1/globalThis.devicePixelRatio,.75),vR=["start","end","top","bottom"],yR=(e,t)=>Math.abs(e-t)<.1;class bR extends Qe{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const n=this,r=e;let i,s,o,a,l,d,c,u,h,g,m,p,f,v,y,b,C,w,S,D,E,x,R,T,M,k,F,I,A;for(t=nt.asArray(t),A=0;e&&!I;){var L;if(i=Object.assign(n.config,e),s=i.startBox,o=i.endBox,a=i.startShift,l=i.endShift,d=i.startSide,c=i.endSide,u=i.startArrowMargin,h=i.endArrowMargin,g=i.horizontalMargin,m=i.verticalMargin,p=i.hasOwnProperty("startHorizontalMargin")?i.startHorizontalMargin:g,f=i.hasOwnProperty("startVerticalMargin")?i.startVerticalMargin:m,v=i.hasOwnProperty("endHorizontalMargin")?i.endHorizontalMargin:g,y=i.hasOwnProperty("endVerticalMargin")?i.endVerticalMargin:m,b=i.hasOwnProperty("otherHorizontalMargin")?i.otherHorizontalMargin:g,C=i.hasOwnProperty("otherVerticalMargin")?i.otherVerticalMargin:m,w=i.otherBoxes,d=n.normalizeSide(d),c=n.normalizeSide(c),S=n.getConnectionCoordinatesFromBoxSideShift(s,d,a),D=n.getConnectionCoordinatesFromBoxSideShift(o,c,l),M=n.calcGridBaseBoxFromBoxAndDrawParams(s,d,u,p,f),k=n.calcGridBaseBoxFromBoxAndDrawParams(o,c,h,v,y),vR.forEach((e=>{Math.abs(M[e]-k[e])<=fR&&(k[e]=M[e])})),n.shouldLookForPath(s,o,M,k))w=null===(L=w)||void 0===L?void 0:L.map((e=>n.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,b,C))),E=n.getConnectionCoordinatesFromBoxSideShift(M,d,a),x=n.getConnectionCoordinatesFromBoxSideShift(k,c,l),F=n.buildPathGrid(M,k,E,x,d,c,w),R=n.convertDecartPointToGridPoint(F,E),T=n.convertDecartPointToGridPoint(F,x),I=n.findPathOnGrid(F,R,T,d,c);for(e=!1;!I&&!e&&t&&A<t.length;A++)e=t[A](i,r)}return I&&(I=n.prependPathWithArrowStaffSegment(I,S,d),I=n.appendPathWithArrowStaffSegment(I,D,c),I=n.optimizePath(I)),I}static calculateRelativePosition(e,t,n=!1){const r=n?"top":"start",i=n?"bottom":"end";let s;return s=e[i]<t[r]?0:e[i]<=t[i]&&e[i]>=t[r]&&e[r]<t[r]?1:e[r]>=t[r]&&e[i]<=t[i]?2:e[r]<t[r]&&e[i]>t[i]?-2:e[r]<=t[i]&&e[i]>t[i]?3:4,s}static boxOverlapChanged(e,t,n,r,i=!1){const s=bR.calculateRelativePosition;return s(e,t,i)!==s(n,r,i)}shouldLookForPath(e,t,n,r){let i=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&2===Math.abs(bR.calculateRelativePosition(e,t,!0))&&(i=!bR.boxOverlapChanged(e,t,n,r)),i}getConnectionCoordinatesFromBoxSideShift(e,t,n){let r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+n};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+n};break;case"top":r={x:(e.start+e.end)/2+n,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+n,y:e.bottom}}return r}calcGridBaseBoxFromBoxAndDrawParams(e,t,n,r,i){let s;switch(this.normalizeSide(t)){case"left":s={start:e.start-Math.max(n,r),end:e.end+r,top:e.top-i,bottom:e.bottom+i};break;case"right":s={start:e.start-r,end:e.end+Math.max(n,r),top:e.top-i,bottom:e.bottom+i};break;case"top":s={start:e.start-r,end:e.end+r,top:e.top-Math.max(n,i),bottom:e.bottom+i};break;case"bottom":s={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+Math.max(n,i)};break;default:s={start:e.start-r,end:e.end+r,top:e.top-i,bottom:e.bottom+i}}return s}normalizeSide(e){const{rtl:t}=this.client;return"start"===e?t?"right":"left":"end"===e?t?"left":"right":e}buildPathGrid(e,t,n,r,i,s,o){let a,l,d,c,u,h,g,m,p,f,v,y,b;const C={},w=[];for(a=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:n.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:r.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:n.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:r.y,t.bottom],o&&o.forEach((e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),a=[...new Set(a.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,m=l.length;h<m;++h)for(C[h]=C[h]||{},d=l[h],u=0,g=a.length;u<g;++u){if(c=a[u],y=(c<=e.start||c>=e.end||d<=e.top||d>=e.bottom)&&(c<=t.start||c>=t.end||d<=t.top||d>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)v=o[p],y=c<=v.start||c>=v.end||d<=v.top||d>=v.bottom||c===n.x&&d===n.y||c===r.x&&d===r.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:y,x:c,y:d,ix:u,iy:h},C[h][u]=b,w.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:w}}convertDecartPointToGridPoint(e,t){const n=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][n]}findPathOnGrid(e,t,n,r,i){const s=this;let o=!1;return t.permitted&&n.permitted&&(e=s.waveForward(e,t,0),o=s.collectPath(e,n,i)),o}getGridPointNeighbors(e,t,n){const r=t.ix,i=t.iy,s=[];let o;return i<e.height-1&&(o=e.points[i+1][r],(!n||n(o))&&s.push(o)),i>0&&(o=e.points[i-1][r],(!n||n(o))&&s.push(o)),r<e.width-1&&(o=e.points[i][r+1],(!n||n(o))&&s.push(o)),r>0&&(o=e.points[i][r-1],(!n||n(o))&&s.push(o)),s}waveForward(e,t,n){const r=this;return Hs.preWalkUnordered([t,n],(([t,n])=>r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>n+1)).map((e=>[e,n+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,n){const r=this,i=[];let s,o,a,l,d=!0;for(;d&&t.distance;)if(s=r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance===t.distance-1)),d=s.length>0,d){switch(s=s.sort(((e,r)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;const o=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;i=r.ix-t.ix,s=r.iy-t.iy;const a=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;return o>a?1:o<a?-1:o===a?e.y>r.y?-1:e.y<r.y?1:0:void 0})),o=s[0],i.push({x1:o.x,y1:o.y,x2:t.x,y2:t.y}),a=o.ix-t.ix,l=o.iy-t.iy,!0){case!l&&a>0:n="left";break;case!l&&a<0:n="right";break;case!a&&l>0:n="top";break;case!a&&l<0:n="bottom"}t=o}return d&&i.reverse()||!1}prependPathWithArrowStaffSegment(e,t,n){if(e.length>0){const r=e[0],i={x2:r.x1,y2:r.y1};switch(n){case"left":case"right":i.x1=t.x,i.y1=r.y1;break;case"top":case"bottom":i.x1=r.x1,i.y1=t.y}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,n){if(e.length>0){const r=e[e.length-1],i={x1:r.x2,y1:r.y2};switch(n){case"left":case"right":i.x2=t.x,i.y2=r.y2;break;case"top":case"bottom":i.x2=r.x2,i.y2=t.y}e.push(i)}return e}optimizePath(e){const t=[];let n,r;if(e.length>0)for(n=e.shift(),t.push(n);e.length>0;)r=e.shift(),yR(n.x1,r.x1)&&yR(n.y1,r.y1)&&yR(n.x2,r.x2)&&yR(n.y2,r.y2)?n=r:yR(n.y1,n.y2)&&yR(r.y1,r.y2)?n.x2=r.x2:yR(n.x1,n.x2)&&yR(r.x1,r.x2)?n.y2=r.y2:(t.push(r),n=r);return t}}function CR(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function wR(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function SR(e,t,n,r,i){let s=e.x1===e.x2?"v":"h",o=r;if(r){const a=wR(e),l=t?Math.abs(wR(t)):Number.MAX_SAFE_INTEGER,d=Math.sign(a);null==i&&(i=r),(Math.abs(a)<2*r||l<2*r)&&(o=Math.min(Math.abs(a),l)/2);const c=a-("single"===n?0:"first"===n?o:"between"===n?i+o:i)*d;s+=Math.sign(c)!==d?0:c,"last"!==n&&"single"!==n&&o>0&&(s+=` ${function(e,t,n){const r=CR(e)+CR(t),i=n*(r.includes("l")?-1:1),s=n*(r.includes("u")?-1:1);return`a${i},${s} 0 0 ${"ur"===r||"lu"===r||"dl"===r||"rd"===r?1:0} ${i},${s}`}(e,t,o)}`)}else s+=wR(e);return{line:s,currentRadius:r!==o?o:null}}function DR(e,t){const{length:n}=t;if(!n)return"";let r=null;return`M${t[0].x1},${t[0].y1} ${t.map(((i,s)=>{const o=1===n?"single":s===n-1?"last":0===s?"first":"between",a=SR(i,t[s+1],o,e,r);return({currentRadius:r}=a),a.line})).join(" ")}`}bR._$name="RectangularPathFinder";var ER=e=>class extends e{static $name="DependencyLineGenerator";lineCache={};onSVGReady(){const e=this;e.pathFinder=new bR({...e.pathFinderConfig,client:e.client}),e.lineDefAdjusters=e.createLineDefAdjusters(),e.createMarker()}changeRadius(e){return null!==e&&W.assertNumber(e,"radius",!0),e}resetAtRuntime(){this.isConfiguring||this.reset()}updateRadius(){this.resetAtRuntime()}updateRenderer(){this.resetAtRuntime()}changeClickWidth(e){return null!==e&&W.assertNumber(e,"clickWidth",!0),e}updateClickWidth(){this.resetAtRuntime()}updateDrawAroundParents(){this.resetAtRuntime()}createMarker(){var e;const t=this,{markerDef:n}=t,r=this.client.svgCanvas,i=n?`${t.client.id}-arrowEnd`:"arrowEnd";null===(e=t.marker)||void 0===e||e.remove(),r.style.setProperty("--scheduler-dependency-marker",`url(#${i})`),t.marker=Yn.createElement({parent:r,id:i,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:t.markerDef??"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||(this.createMarker(),c.isSafari&&(this.client.svgCanvas.innerHTML+=""))}getAssignmentElement(e){var t,n;return(null===(t=this.client.features.eventDrag)||void 0===t||null===(n=t.getProxyElement)||void 0===n?void 0:n.call(t,e))||this.client.getElementFromAssignmentRecord(e)}getDomConfigs(e,t,n,r){const i=this,s=i.getDependencyKey(e,t,n),o=i.lineCache[s];if(i.constructLineCache||!o||r||i.drawingLive&&(i.getAssignmentElement(t)||i.getAssignmentElement(n))){const o=i.prepareLineDef(e,t,n,r),l=o&&i.pathFinder.findPath(o,i.lineDefAdjusters),{client:d,clickWidth:c}=i,{toEvent:u}=e;if(l){var a;const r=i.highlighted.get(e),h={tag:"path",ns:"http://www.w3.org/2000/svg",d:DR(i.radius??0,l),role:"presentation",dataset:{syncId:s,depId:e.id,fromId:t.id,toId:n.id},elementData:{dependency:e,points:l},class:{[i.baseCls]:1,[e.cls]:e.cls,[e.highlighted]:e.highlighted,[r&&[...r].join(" ")]:r,[i.noMarkerCls]:o.hideMarker,"b-inactive":!1===e.active,"b-sch-bidirectional-line":e.bidirectional,"b-readonly":e.readOnly,"b-sch-dependency-ends-outside":!u.milestone&&(d.showUnscheduledTasks&&!u.isScheduled?u._endDate<=d.startDate||d.endDate<=u._startDate:u.endDate<=d.startDate||d.endDate<=u.startDate)||u.milestone&&(u.endDate<d.startDate||d.endDate<u.startDate)}};null===(a=i.renderer)||void 0===a||a.call(i,{domConfig:h,points:l,dependencyRecord:e,fromAssignmentRecord:t,toAssignmentRecord:n,fromBox:o.startBox,toBox:o.endBox,fromSide:o.startSide,toSide:o.endSide});const g=[h];return c>1&&g.push({...h,class:{...h.class,"b-click-area":1},dataset:{...h.dataset,syncId:`${h.dataset.syncId}-click-area`},style:{strokeWidth:c}}),i.lineCache[s]=g}return i.lineCache[s]=null}return o}generateBoundaryBoxes(e,t){return"top"===t?[]:"bottom"===t?[{start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}]:[{start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}]}getAssignmentBounds(e){const{client:t}=this,n=this.getAssignmentElement(e);if(n&&!t.isExporting){const r=Ot.from(n,this.relativeTo);if(r.fromElement=!0,t.isHorizontal){let n=t.getRowById(e.resource.id);if(!n)return t.getAssignmentEventBox(e,!0);if(r.y<n.top||r.bottom>n.bottom){const e=t.rowManager.getRowAt(r.center.y,!0);e&&(n=e)}r.rowTop=n.top,r.rowBottom=n.bottom}return r}return t.isEngineReady&&t.getAssignmentEventBox(e,!0)}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}getDependencyStartSide(e){const{fromEvent:t,type:n,fromSide:r}=e;if(r)return r;switch(!0){case n===oD.Type.StartToEnd:case n===oD.Type.StartToStart:return this.getConnectorStartSide(t);case n===oD.Type.EndToStart:case n===oD.Type.EndToEnd:default:return this.getConnectorEndSide(t)}}getDependencyEndSide(e){const{toEvent:t,type:n,toSide:r}=e;if(r)return r;switch(!0){case n===oD.Type.EndToEnd:case n===oD.Type.StartToEnd:return this.getConnectorEndSide(t);case n===oD.Type.EndToStart:case n===oD.Type.StartToStart:default:return this.getConnectorStartSide(t)}}createLineDefAdjusters(){var e;const{client:t}=this;const n=[function(e){const{barMargin:n}=t;return(e.startArrowMargin>n||e.endArrowMargin>n)&&(e.startArrowMargin=e.endArrowMargin=n,e)},function(e){return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,e)},function(e,t){return e.horizontalMargin>2&&(e.horizontalMargin=1,t.hideMarker=!0,e)}];return null!==(e=t.features.nestedEvents)&&void 0!==e&&e.enabled&&n.unshift((e=>(e.otherBoxes.length&&(e.otherBoxes.length=e.otherBoxes.nestedStart),e))),n}adjustLineDef(e,t){return t}prepareLineDef(e,t,n,r){const i=this,{client:s}=i,o=i.getDependencyStartSide(e),a=i.getDependencyEndSide(e),l=(null==r?void 0:r.from)??i.getAssignmentBounds(t),d=(null==r?void 0:r.to)??i.getAssignmentBounds(n),c=[];if(!l||!d)return null;let{startArrowMargin:u,verticalMargin:h}=i.pathFinder;if(s.isHorizontal){var g;if(s.rtl){const{totalSize:e}=s.timeAxisViewModel;l&&!l.fromElement&&(l._x=e-l.x-l.width),d&&!d.fromElement&&(d._x=e-d.x-d.width)}if(null!=l.rowTop&&l.rowTop!==d.rowTop&&c.push(...i.generateBoundaryBoxes(l,o)),null!==(g=s.features.nestedEvents)&&void 0!==g&&g.enabled&&i.drawAroundParents){const{resourceStore:e}=s,r=t.resource,o=n.resource,a=e.indexOf(r),l=e.indexOf(o),d=Math.min(a,l),h=Math.max(a,l);c.nestedStart=c.length;for(const r of s.assignmentStore){var m;if(r!==t&&r!==n&&null!==(m=r.event)&&void 0!==m&&m.isParent&&t.event.parent!==r.event&&n.event.parent!==r.event){const t=e.indexOf(r.resource);if(t>=d&&t<=h){const e=i.getAssignmentBounds(r).inflate(u);e.isNestedParent=!0,c.push(e)}}}}e.bidirectional||(/(top|bottom)/.test(o)&&(u=s.barMargin/2),h=s.barMargin/2)}return i.adjustLineDef(e,{startBox:l,endBox:d,otherBoxes:c,startArrowMargin:u,verticalMargin:h,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:o,endSide:a})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}};const xR=["start","start","end","end"],RR=["start","end","start","end"];var TR=e=>class extends e{static $name="DependencyTooltip";static configurable={showTooltip:!0,showLagInTooltip:!1,tooltipTemplate(e){const t=this;return[{tag:"label",text:t.L("L{Dependencies.from}")},{text:e.fromEvent.name},{className:`b-sch-box b-${e.fromSide||xR[e.type]}`},{tag:"label",text:t.L("L{Dependencies.to}")},{text:e.toEvent.name},{className:`b-sch-box b-${e.toSide||RR[e.type]}`},t.showLagInTooltip&&{tag:"label",text:t.L("L{DependencyEdit.Lag}")},t.showLagInTooltip&&{text:`${e.lag||0} ${xi.getLocalizedNameOfUnit(e.lagUnit,1!==e.lag)}`}]},tooltip:{$config:["nullify","lazy"],value:{}}};changeTooltip(e,t){const n=this;if(null==t||t.destroy(),!e)return null;const r=tm.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},e);return r.element.classList.add("b-sch-dependency-tooltip"),r}updateShowTooltip(e){const t=this;t.isConfiguring&&!e||(e&&!t._tooltip&&t.tooltip,t._tooltip&&(t._tooltip.disabled=!e))}getHoverTipHtml({activeTarget:e}){return this.tooltipTemplate(this.resolveDependencyRecord(e))}};const MR={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},kR=e=>{var t;const n=[e];return null!==(t=e.resource)&&void 0!==t&&t.hasLinks&&n.push(...e.resource.$links.map((t=>({id:`${t.id}_${e.id}`,resource:t,event:e.event,drawDependencies:e.drawDependencies})))),n};class FR extends(Mr.mixin(ax,Hi,mR,pR,ER,TR)){static $name="Dependencies";static configurable={overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",removeIconCls:"b-icon b-icon-remove-circle",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,enableDelete:!0,drawOnScroll:!0,clickWidth:null,immediateRefresh:null,drawAroundParents:null};static delayable={doRefresh:10,rafRefresh:"raf"};static get pluginConfig(){return{chain:["render","onInternalPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","onElementPointerDown","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}domConfigs=new Map;drawingLive=!1;lastScrollX=null;highlighted=new Map;visibleResources=null;usingLinks=null;visibleDateRange=null;relativeTo=null;generation=0;construct(e,t){super.construct(e,t);const{scheduledEventName:n}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[n+"DragStart"]:"refresh",[n+"DragAbort"]:"refresh",[n+"ResizeStart"]:"refresh",[n+"SegmentDragStart"]:"refresh",[n+"SegmentResizeStart"]:"refresh",timelineViewportResize:"immediateReset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}get eventStore(){return this.client.project.eventStore}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(null==e||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:t})),t.usingLinks=null,t.immediateReset())}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),null==e||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),null==e||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),null==e||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),null==e||e.ion({name:"dependencyStore",change:"reset",refresh:"onDependencyStoreRefresh",thisObj:this})}onDependencyStoreRefresh({action:e}){"dataset"===e&&this.generation++,this.reset()}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onInternalPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,t,n){return this.getElementsForDependency(e,t,n)[0]}getElementsForDependency(e,t,n){let r=`[data-dep-id="${e.id}"]`;return t&&(r+=`[data-from-id="${t.id}"]`),n&&(r+=`[data-to-id="${n.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(r))}resolveDependencyRecord(e){var t;return null===(t=e.elementData)||void 0===t?void 0:t.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementPointerDown({target:e}){const t=this,{client:n}=t;t.enableDelete&&!n.readOnly&&e!==t.removeIconElement&&(t.removeRemoveIcon(),Yn.removeClsGlobally(n.svgCanvas,"b-sch-dependency-selected"))}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const n=MR[e.type];"click"===e.type&&this.onDependencyClick(e.target),this.client.trigger(`dependency${n}`,{dependency:t,event:e})}}onDependencyClick(e){const t=this,{client:n}=t,{svgCanvas:r}=n,{dependency:i}=e.elementData;if(t.enableDelete&&!n.readOnly&&!i.readOnly){const s=e.getPointAtLength(n.isGanttBase?0:e.getTotalLength());n.topCanvas||(n.topCanvas=Yn.createElement({className:"b-sch-canvas b-sch-top-canvas",parent:n.foregroundCanvas.parentElement})),t.removeIconElement=Yn.createElement({className:"b-sch-dependency-remove-icon "+t.removeIconCls,retainElement:!0,style:{insetInlineStart:s.x+"px",top:s.y+"px"},dataset:{depId:i.id},elementData:{dependencyEl:e},parent:n.topCanvas}),t.removeIconElement.addEventListener("click",t.onRemoveIconClick.bind(t));for(const e of t.getElementsForDependency(i))e.classList.add("b-sch-dependency-selected"),r.moveBefore?r.moveBefore(e,null):r.appendChild(e)}}positionRemoveIcon(){var e;const{dependencyEl:t}=(null===(e=this.removeIconElement)||void 0===e?void 0:e.elementData)||{};if(t){const e=t.getPointAtLength(this.client.isGanttBase?0:t.getTotalLength());Object.assign(this.removeIconElement.style,{insetInlineStart:e.x+"px",top:e.y+"px"})}}async removeRemoveIcon(){const{removeIconElement:e}=this;e&&(await this.client.executeAndAwaitAnimations(e,(()=>e.classList.add("b-removing"))),e.remove())}onRemoveIconClick({target:e}){this.client.dependencyStore.remove(e.dataset.depId),this.removeRemoveIcon()}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOver",{dependency:n,event:e}),t.overCls&&t.highlight(n))}onElementMouseOut(e){const t=this,n=t.resolveDependencyRecord(e.target);n&&(t.client.trigger("dependencyMouseOut",{dependency:n,event:e}),t.overCls&&t.unhighlight(n))}isDependencyVisible(e){const{rowStore:t}=this,{fromEvent:n,toEvent:r}=e;if(!n||!r)return!1;const i=n.resource,s=r.resource;return!(!t.isAvailable(i)||!t.isAvailable(s))&&(n.isModel&&!i.instanceMeta(t).hidden&&!s.instanceMeta(t).hidden)}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:e}=t;e.ion({name:"highlightOnHover",[`${e.scheduledEventName}MouseEnter`]:e=>t.highlightEventDependencies(e.eventRecord||e.taskRecord),[`${e.scheduledEventName}MouseLeave`]:e=>t.unhighlightEventDependencies(e.eventRecord||e.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let n=this.highlighted.get(e);n||this.highlighted.set(e,n=new Set),n.add(t);for(const n of this.getElementsForDependency(e))n.classList.add(t)}unhighlight(e,t=this.overCls){var n;const r=null===(n=this.highlighted)||void 0===n?void 0:n.get(e);r&&(r.delete(t),r.size||this.highlighted.delete(e));for(const n of this.getElementsForDependency(e))n.classList.remove(t)}highlightEventDependencies(e,t){e.dependencies.forEach((e=>this.highlight(e,t)))}unhighlightEventDependencies(e,t){e.dependencies.forEach((e=>this.unhighlight(e,t)))}getDependenciesToConsider(e,t,n,r){var i;const{eventStore:s}=this,o=null===(i=super.getDependenciesToConsider)||void 0===i?void 0:i.call(this,e,t,n,r);return null!=o&&o.size?o:this.project.dependencyStore.records.filter((e=>e.isValid&&!s.isFiltered||s.isAvailable(e.fromEvent)&&s.isAvailable(e.toEvent)))}getDependencyKey(e,t,n){return`dep:${e.id};from:${t.id};to:${n.id};gen:${this.generation}`}drawDependency(e,t=!1,n=null){var r,i;const s=this,{domConfigs:o,client:a,rowStore:l,topIndex:d,bottomIndex:c}=s,{useInitialAnimation:u}=a,{idMap:h}=l,{startMS:g,endMS:m}=s.visibleDateRange,{fromEvent:p,toEvent:f}=e;let v=p.assigned,y=f.assigned;if(p.isScheduled&&f.isScheduled&&null!==(r=v)&&void 0!==r&&r.size&&null!==(i=y)&&void 0!==i&&i.size){s.usingLinks&&(v=[...v].flatMap(kR),y=[...y].flatMap(kR));for(const t of v)for(const r of y){var b,C,w,S;const i=null===(b=h[null===(C=t.resource)||void 0===C?void 0:C.id])||void 0===b?void 0:b.index,v=null===(w=h[null===(S=r.resource)||void 0===S?void 0:S.id])||void 0===w?void 0:w.index,y=Math.min(p.startDateMS,f.startDateMS),D=Math.max(p.endDateMS,f.endDateMS);if(a.isExporting||null!=i&&null!=v&&!1!==t.drawDependencies&&!1!==r.drawDependencies&&l.isAvailable(t.resource)&&l.isAvailable(r.resource)&&!(i<d&&v<d||i>c&&v>c||y<g&&D<g||y>m&&D>m)){const a=s.getDependencyKey(e,t,r),l=s.getDomConfigs(e,t,r,n);l?(u&&(l[0].style={animationDelay:Math.max(i,v)/20*1e3+"ms"}),o.set(a,l)):o.delete(a)}s.afterDrawDependency(e,i,v,y,D)}}t||s.domSync()}afterDrawDependency(e,t,n,r,i){var s;null===(s=super.afterDrawDependency)||void 0===s||s.call(this,e,t,n,r,i)}beforeDraw(){var e;null===(e=super.beforeDraw)||void 0===e||e.call(this)}afterDraw(){var e;null===(e=super.afterDraw)||void 0===e||e.call(this)}domSync(e=this.client.svgCanvas,t=!1){ud.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}}),t&&this.clearDomConfigs()}fillDrawingCache(){const e=this,{client:t,rowStore:n}=e;e.relativeTo=Ot.from(t.svgCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=n.indexOf(e.visibleResources.first),e.bottomIndex=n.indexOf(e.visibleResources.last),null==e.usingLinks&&(e.usingLinks=n.isChainedTree||t.resourceStore.some((e=>e.hasLinks)))}clearDomConfigs(){this.domConfigs.clear()}draw(){const e=this,{client:t}=e,{visibleDateRange:n}=t;if(!t.refreshSuspended&&t.foregroundCanvas&&n&&t.isEngineReady&&(!e.disabled||e._isDisabling)&&!t.isExporting){if(e.fillDrawingCache(),e.clearDomConfigs(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&n.endMS-n.startMS>0){var r;const{topIndex:i,bottomIndex:s}=e,o=e.getDependenciesToConsider(n.startMS,n.endMS,i,s);e.beforeDraw();for(const t of o)e.drawDependency(t,!0);e.afterDraw(),null!==(r=e.removeIconElement)&&void 0!==r&&r.isConnected&&t.waitForAnimations().then((()=>e.positionRemoveIcon()))}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,n,r,i;const s=this,{client:o}=s,{scheduledEventName:a,features:l}=o;s.draw(),s.drawingLive=o.dependencyStore.count&&(o.isAnimating||o.useInitialAnimation&&s.eventStore.count||(null===(e=l[`${a}Drag`])||void 0===e?void 0:e.isActivelyDragging)||(null===(t=l[`${a}Drag`])||void 0===t?void 0:t.isAborting)||(null===(n=l[`${a}Resize`])||void 0===n?void 0:n.isResizing)||(null===(r=l[`${a}SegmentDrag`])||void 0===r?void 0:r.isActivelyDragging)||(null===(i=l[`${a}SegmentResize`])||void 0===i?void 0:i.isResizing)),s.drawingLive&&s.refresh(!1,!0)}rafRefresh(){this.doRefresh.now()}refresh(e=this.immediateRefresh,t=!1){const n=this,{client:r}=n;r.refreshSuspended||n.disabled||!r.isPainted||r.timeAxisSubGrid.collapsed||(e?n.doRefresh.now():t?n.rafRefresh():n.doRefresh())}reset(e={},t=!1){var n;null===(n=super.reset)||void 0===n||n.call(this),this.refresh(t)}immediateReset(){this.reset({},!0)}render(){this.client.getConfig("svgCanvas")}}FR._$name="Dependencies",Jv.registerFeature(FR,!1,["Scheduler","ResourceHistogram"]);class IR extends eh{static $name="DependencyEditor";static get defaultConfig(){return{items:[],axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:t}=this;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&super.processWidgetConfig(e))}afterShow(...e){const{deleteButton:t}=this.widgetMap;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}IR._$name="DependencyEditor";class AR extends Mr{static $name="DependencyEdit";static get pluginConfig(){return{chain:["populateDependencyMenu"]}}static configurable={autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(oD.Type).map((t=>({id:oD.Type[t],name:e.L(t),localeKey:t})))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0,highlightExternalChange:!1}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}};construct(e,t){if(e.dependencyEdit=this,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit")}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}changeEditorConfig(e){const{autoClose:t,cls:n,client:r}=this;return W.assign({owner:r,align:"b-t",id:`${r.id}-dependency-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:t,cls:n},e)}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e={};return this.editor.eachWidget((t=>{t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),W.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onHide(){this.isApplyingChanges||this.afterCancel()}async onSaveClick(){const e=this;e.isApplyingChanges=!0,await e.save()?(e.afterSave(),await e.editor.hide(),e.isApplyingChanges=!1):e.isApplyingChanges=!1}async onDeleteClick(){const e=this;e.isApplyingChanges=!0,await e.deleteDependency()&&e.afterDelete(),await e.editor.hide(),e.isApplyingChanges=!1}onCancelClick(){this.editor.hide()}afterSave(){}afterDelete(){}afterCancel(){}internalShowEditor(e){const t=this,{client:n,lastPointerDown:r}=t,{dependencies:i}=n.features,s=t.getEditor(e),o=(null==i?void 0:i.getElementForDependency(e))||(null==r?void 0:r.target)||n.timeAxisSubGridElement,a=Ot.from(o);let l;t.loadRecord(e),n.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:s}),r?(Object.defineProperties(r,{offsetX:{configurable:!0,value:r.clientX-a.x},offsetY:{configurable:!0,value:r.clientY-a.y}}),l={target:r,align:"t50-b0"}):l={target:o,align:"c-c"};const d=s.showBy(l),c=[];let u=0;return s.eachWidget((e=>{const{labelElement:t,element:n}=e;if(t){if(t.getBoundingClientRect().top<n.getBoundingClientRect().top)return!1;e.labelWidth=null,u=Math.max(u,t.offsetWidth),c.push(e)}})),c.forEach((e=>e.labelWidth=u)),d}async editDependency(e){const{client:t}=this;return!t.readOnly&&!e.readOnly&&!1!==await t.trigger("beforeDependencyEdit",{dependencyEdit:this,dependencyRecord:e})&&(await this.internalShowEditor(e),!0)}getEditor(){var e,t,n;const r=this;let{editor:i}=r;return i||(i=r.editor=IR.new({dependencyEditFeature:r,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:r.autoClose,cls:r.cls,rootElement:r.client.rootElement,internalListeners:{keydown:r.onPopupKeyDown,hide:r.onHide,thisObj:r}},r.editorConfig),0===i.items.length&&console.warn("Editor configured without any `items`"),i.eachWidget((e=>{const t=e.ref||e.id;t&&!r[t]&&(r[t]=e)})),null===(e=r.saveButton)||void 0===e||e.ion({click:"onSaveClick",thisObj:r}),null===(t=r.deleteButton)||void 0===t||t.ion({click:"onDeleteClick",thisObj:r}),null===(n=r.cancelButton)||void 0===n||n.ion({click:"onCancelClick",thisObj:r}),r.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new qs(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}async save(){const e=this,{client:t,dependencyRecord:n}=e;if(!n||!e.isValid)return;const{dependencyStore:r,values:i}=e;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:n,values:i})){var s;if(e.onBeforeSave(n),e.updateRecord(n),r&&!n.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:e}))return;r.add(n)}await(null===(s=t.project)||void 0===s?void 0:s.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:n}),e.onAfterSave(n)}return n}async deleteDependency(){const{client:e,editor:t,dependencyRecord:n}=this;var r;return!1!==e.trigger("beforeDependencyDelete",{dependencyRecord:n})&&(t.containsFocus&&t.revertFocus(),e.dependencyStore.remove(n),await(null===(r=e.project)||void 0===r?void 0:r.commitAsync()),!0)}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDown=t,this.editDependency(e))}updateTriggerEvent(e){var t;null===(t=this.clientListenersDetacher)||void 0===t||t.call(this),e&&(this.clientListenersDetacher=this.client.ion({[e]:this.onActivateEditor,thisObj:this}))}populateDependencyMenu({dependencyRecord:e,items:t}){this.client.readOnly||this.disabled||(t.edit={text:"L{DependencyEdit.Edit dependency}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editDependency(e)}})}}AR._$name="DependencyEdit",Jv.registerFeature(AR,!1);class LR extends ah{static $name="DependencyMenu";static configurable={processItems:null,type:"dependency"};static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateDependencyMenu"),e}getDataFromEvent(e){const t=super.getDataFromEvent(e),{dependencies:n}=this.client.features,r=e.target.closest(`.${n.baseCls}`);if(r){const e=n.resolveDependencyRecord(r);return Object.assign(t,{element:r,dependencyRecord:e})}}shouldShowMenu(e){return e.dependencyRecord}populateDependencyMenu({items:e,dependencyRecord:t}){e.delete={disabled:t.readOnly,hidden:this.client.readOnly}}changeItems(e){return C.merge({delete:{text:"L{DependencyEdit.Delete}",icon:"b-icon b-icon-trash",cls:"b-separator",weight:500,onItem({dependencyRecord:e}){e.remove()}}},e)}}LR.featureClass="",LR._$name="DependencyMenu",Jv.registerFeature(LR,G.checkVersion("core","7.0",">="),["Scheduler","Gantt"]);class PR extends(Mr.mixin(Hi)){static $name="ScheduleContext";static configurable={triggerEvent:"click",renderer:null,widget:{$config:["lazy","nullify"],value:null},context:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))&&(null==e?void 0:e.eventRecord)===(null==t?void 0:t.eventRecord)}},activateOnEvent:null,shareWithEvent:null};construct(e,t){super.construct(e,t);const{triggerEvent:n}=this,r={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clear",thisObj:this};"mouseover"===n?r.timelineContextChange="onTimelineContextChange":("click"!==n&&"mousedown"!==n||(r.schedulecontextmenu="onScheduleContextGesture"),r[`schedule${n}`]="onScheduleContextGesture"),e.ion(r),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return"hover"!==e&&"mousemove"!==e||(e="mouseover"),e}changeWidget(e,t){if(e)return oc.reconfigure(t,{...e,owner:this.client,positioned:!0,appendTo:this.client.timeAxisSubGridElement,hidden:!0,showAnimation:!1},this);t.destroy()}get element(){var e;this._element||(this._element=(null===(e=this.widget)||void 0===e?void 0:e.element)||Yn.createElement({parent:this.client.timeAxisSubGridElement}),this.element.classList.add("b-schedule-selected-tick"));return this._element}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var t;e.timeAxis.includes(null===(t=this.context)||void 0===t?void 0:t.tick)?this.syncContextElement():this.clear()}clear(){this.context=null}changeContext(e){var t;if(null===(t=this.widget)||void 0===t||!t.query((e=>e.floating&&e.isVisible)))return!this.shareWithEvent&&this.hasEvent(e)||!this.activateOnEvent&&null!=e&&e.eventElement?null:e||null}updateActivateOnEvent(e){const t=this;if(e){const{triggerEvent:e,client:n}=t;t.shareWithEvent=!0,"mouseover"!==e&&n.ion({name:"scheduleContextTrigger",[`${n.scheduledEventName}${e}`]:"onScheduleContextGesture",thisObj:t})}else t.shareWithEvent=t.config.shareWithEvent,t.detachListeners("scheduleContextTrigger")}hasEvent(e){var t;return Boolean(e&&(null===(t=this.client.eventStore.getEvents({resourceRecord:e.resourceRecord,startDate:e.tickStartDate,endDate:e.tickEndDate}))||void 0===t?void 0:t.length))}cursorTrackingSuspended=0;updateContext(e,t){this.syncContextElement()}syncContextElement(){const{client:e,element:t,widget:n,context:r}=this,{isVertical:i}=e,s=r&&(i?e.rowManager.rows[0]:e.getRowFor(r.resourceRecord));if(r&&s&&this.enabled&&!r.domEvent.buttons){const o=this,{renderer:a}=o,{style:l}=t,{tickStartDate:d,tickEndDate:c,resourceRecord:u}=r,h=e.currentOrientation.getTimeSpanRenderData({startDate:d,endDate:c,startDateMS:d.getTime(),endDateMS:c.getTime()},u);let g,m,p;i?(g=h.top,m=h.resourceWidth,p=h.height):(g=s.top,m=h.width,p=s.height),r.index=s.index,t.classList.add("b-schedule-selected-tick"),t.classList.toggle("b-contains-widget",Boolean(t.querySelector(".b-widget"))),n?(n.hide(!1),r.eventRecord||(n.setConfig({width:m,height:p,timelineContext:r,x:h.left,y:g}),n.show({animate:!1}))):t&&(l.width=`${m}px`,l.height=`${p}px`,Yn.setTranslateXY(t,h.left,g),t.innerHTML="",a&&o.callback(a,o,[r,t]),l.display="")}else(null==n?void 0:n.hide(!1))||(t.style.display="none")}}PR.featureClass="b-scheduler-context",PR._$name="ScheduleContext",Jv.registerFeature(PR,!1,["Scheduler"]);class OR extends(Gv.mixin(ax)){static $name="EventCopyPaste";static get pluginConfig(){return{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}}static configurable={nameField:"name",copyPasteAction:"clone",eventToStringFields:["name","startDate","endDate","duration","durationUnit","allDay"],unifiedPaste:!0,allowedDataSources:["EventCopyPaste","RowCopyPaste","TaskCopyPaste"],allowNoAssignments:!1};construct(e,t){super.construct(e,t),e.ion({eventClick:"onEventClick",scheduleClick:"onScheduleClick",projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this})}entityName="event";get scheduler(){return this.client}attachToEventStore(e){super.attachToEventStore(e),delete this._eventClickedContext}onEventDataGenerated(e){const{assignmentRecord:t}=e;t&&(e.cls["b-cut-item"]=t.meta.isCut)}onEventClick(e){this._cellClickedContext=null,this._eventClickedContext=e}onScheduleClick(e){this._cellClickedContext=e,this._eventClickedContext=null}isActionAvailable({event:e,actionName:t}){return super.isActionAvailable(...arguments)&&Boolean(e.target.closest(this.client.eventContainerSelector))}async copy(){return await this.copyEvents()}async cut(){return await this.copyEvents(void 0,!0)}async paste(){return await this.pasteEvents()}async copyEvents(e=this.scheduler.selectedAssignments,t=!1){var n,r;const i=this,{scheduler:s}=i;if(s.splitFrom)return s.splitFrom.features.eventCopyPaste.copyEvents(e,t);if(null===(n=e)||void 0===n||!n.length)return;const{isEventModel:o}=e[0];e=t?e.filter((e=>o?!e.readOnly:!e.event.readOnly)):e.slice();const a=o?e.flatMap((e=>e.assignments)):e,l=a.length?a.map((e=>e.event)):e;if(!(a.length||i.allowNoAssignments&&l.length))return;const d=null===(r=await i.writeToClipboard({assignmentRecords:a,eventRecords:l},t))||void 0===r?void 0:r.data;d&&(s.trigger("copy",{originalAssignmentRecords:a,originalEventRecords:l,assignmentRecords:d.assignmentRecords,eventRecords:d.eventRecords,isCut:t,entityName:i.entityName}),i.refreshClient(),i._focusedEventOnCopy=i._eventClickedContext)}async beforeCopy({data:{assignmentRecords:e,eventRecords:t},isCut:n}){return await this.scheduler.trigger("beforeCopy",{assignmentRecords:e,eventRecords:t,isCut:n,entityName:this.entityName})}handleCutData({source:e}){var t;const n=this;if(e!==n&&null!==(t=n.cutData)&&void 0!==t&&t.length){const{assignmentRecords:e,eventRecords:t}=n.cutData[0];null!=e&&e.length&&n.scheduler.assignmentStore.remove(e),null!=t&&t.length&&n.scheduler.eventStore.remove(t)}}stringConverter({eventRecords:e}){const t=[];for(const n of e)t.push(this.eventToStringFields.map((e=>{const t=n[e];return t instanceof Date?xi.format(t,this.dateFormat):t})).join("\t"));return t.join("\n")}setIsCut({assignmentRecords:e},t){e.forEach((e=>{e.meta.isCut=t})),this.refreshClient()}cloneData({data:e,isPaste:t}){const n=this,{eventStore:r}=n,i=r.modelClass,s=new Set,o=[],a=[],l=r.usesSingleAssignment||"clone"===n.copyPasteAction,d=(e,i)=>{var s;const o=e.copy(null,!0);return t&&o.traverse((t=>{t.name=n.generateNewName(t,e,r)})),o.meta.originalResourceId=t?e.meta.originalResourceId:(null==i?void 0:i.resourceId)??e.resourceId,null!==(s=o.fieldMap)&&void 0!==s&&s.resourceIds.persist&&(o.resourceIds=[]),o};let{assignmentRecords:c,eventRecords:u}=e;if(t&&!c&&!u)return null!=e&&e.length&&e[0].isModel?(u=e.map((e=>new i({...e.toJSON(),[i.idField]:void 0}))),{eventRecords:u,assignmentRecords:[]}):void 0;if(t&&l)o.push(...u.map((e=>d(e))));else{var h;let e=c;null!==(h=e)&&void 0!==h&&h.length||!n.allowNoAssignments||(e=u);for(const t of e){let e=t.isEventModel?t:r.getById(t.eventId);s.has(e)||(s.add(e),l||t.isEventModel?(e=d(e,null==c?void 0:c.find((t=>t.eventId===e.id))),e.constraintDate&&(e.constraintDate=null),o.push(e)):a.push(t.copy()))}}return{assignmentRecords:a,eventRecords:o}}async pasteEvents(e,t){var n;const r=this,{scheduler:i,copyPasteAction:s,entityName:o,unifiedPaste:a,_cellClickedContext:l,_eventClickedContext:d}=r,{eventStore:c,assignmentStore:u,resourceStore:h}=i;if(0===arguments.length&&(l?(e=l.date,t=l.resourceRecord):r._focusedEventOnCopy!==d&&(e=d.eventRecord.startDate,t=d.resourceRecord)),t&&(t=t.$original),i.splitFrom)return i.splitFrom.features.eventCopyPaste.pasteEvents(e,t);const{data:g,isCut:m,originalData:p}=await r.readFromClipboard({resourceRecord:t,date:e})??{},f=null!=g&&null!==(n=g.assignmentRecords)&&void 0!==n&&n.length?g.assignmentRecords:null==g?void 0:g.eventRecords,v=[],y=[];let b,C,w;if(null!=f&&f.length){for(let n of f){let r;if(n.isEventModel?(r=n,n=null):(r=n.event??c.getById(n.eventId),n.meta.isCut=!1),y.includes(r)||(e&&(a&&C&&(e=new Date(e.getTime()+(r.startDate-C))),C=r.startDate,r.startDate=e,r.constraintDate&&(r.constraintDate=null)),m||(c.add(r),t??=h.getById(r.meta.originalResourceId)),y.push(r)),t){var S;const e=h.getById((null===(S=n)||void 0===S?void 0:S.resourceId)??r.resourceId??r.meta.originalResourceId);if(a&&w&&!i.isCalendar){const n=h.indexOf(e)-h.indexOf(w);t=h.getAt(h.indexOf(t)+n)??h.last}t.readOnly||r.isAssignedTo(t)||(n=r.assign(t),r.traverse((e=>e.assign(t)),!0)),!e||e.readOnly||t===e||c.usesSingleAssignment||!m&&"clone"!==s||r.unassign(e),w=e}else!m&&i.isCalendar&&n&&!r.isAssignedTo(n.resourceId)&&u.add(n);n?(v.push(n),b=n):b=u.last}var D,E;if(!t)t=(null==v||null===(D=v[0])||void 0===D?void 0:D.resource)??(null==y||null===(E=y[0])||void 0===E?void 0:E.resource);if(i.trigger("paste",{eventRecords:y,assignmentRecords:v,pastedEventRecords:y,originalEventRecords:null==p?void 0:p.eventRecords,originalAssignmentRecords:null==p?void 0:p.assignmentRecords,resourceRecord:t,date:e,isCut:m,entityName:o}),i.isSchedulerBase){const e=i.ion({renderEvent({assignmentRecord:t}){t===b&&(i.navigateTo(t,{scrollIntoView:!1}),e())}})}m&&await r.clearClipboard()}}async beforePaste({originalData:e,data:{assignmentRecords:t,eventRecords:n},resourceRecord:r,isCut:i,date:s}){var o;const{scheduler:a}=this,l=null==e?void 0:e.assignmentRecords;var d;r||(r=null==l||null===(d=l[0])||void 0===d?void 0:d.resource);const c={assignmentRecords:t,eventRecords:n,resourceRecord:r,originalAssignmentRecords:l,originalEventRecords:null==e?void 0:e.eventRecords,date:s,isCut:i,entityName:this.entityName};let u;if(null!==(o=r)&&void 0!==o&&o.readOnly&&(u="resourceReadOnly"),!u&&!a.allowOverlap){const e=null!=t&&t.length?t:n;for(const t of e){const e=t.isAssignmentModel?t.event:t;if(!a.isDateRangeAvailable(s??e.startDate,s?xi.add(s,e.duration,e.durationUnit):e.endDate,i?e:null,r??t.resource)){u="overlappingEvents";break}}}return u?(a.trigger("pasteNotAllowed",{...c,reason:u}),!1):await this.scheduler.trigger("beforePaste",c)}stringParser(e){const{eventStore:t,assignmentStore:n}=this.scheduler,{modifiedRecords:r}=this.setFromStringData(e,!0,t,this.eventToStringFields),i=[];for(const e of r){const t=n.createRecord({eventId:e.id});t.event=e,i.push(t)}return{eventRecords:r,assignmentRecords:i}}populateEventMenu({assignmentRecord:e,items:t}){const n=this,{scheduler:r}=n;var i;n.disabled||(t.copyEvent={text:"L{copyEvent}",localeClass:n,icon:"b-icon b-icon-copy",cls:"b-separator",weight:110,onItem:()=>{const t=r.isAssignmentSelected(e)?r.selectedAssignments:[e];n.copyEvents(t)}},r.readOnly||(t.cutEvent={text:"L{cutEvent}",localeClass:n,icon:"b-icon b-icon-cut",weight:120,disabled:e.readOnly||(null===(i=e.event)||void 0===i?void 0:i.readOnly),onItem:()=>{const t=r.isAssignmentSelected(e)?r.selectedAssignments:[e];n.copyEvents(t,!0)}}))}populateScheduleMenu({items:e,resourceRecord:t}){const n=this,{scheduler:r}=n;n.disabled||r.readOnly||!1===n.hasClipboardData()||(e.pasteEvent={text:"L{pasteEvent}",localeClass:n,icon:"b-icon b-icon-paste",disabled:0===r.resourceStore.count&&!n.allowNoAssignments||(null==t?void 0:t.readOnly),weight:110,internalListeners:{item:n.onScheduleMenuPasteClick,thisObj:n}})}onScheduleMenuPasteClick({date:e,resourceRecord:t}){this.pasteEvents(e,t)}refreshClient(){this.scheduler.refreshWithTransition()}}OR.featureClass="b-event-copypaste",OR._$name="EventCopyPaste",Jv.registerFeature(OR,!0,"Scheduler");class $R extends(Yx.mixin(qx)){static $name="EventDrag";static get configurable(){return{singleDirection:null,constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:(e,t)=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,snapToResource:G.checkVersion("core","7.0",">="),copyKey:"CTRL",copyMode:"auto",mode:"move",alwaysCopy:null}}changeMode(e){const{dragData:t,copyMode:n}=this;if(("event"===n||"auto"===n||"assignment"===n&&!this.scheduler.eventStore.usesSingleAssignment)&&(!t||t.eventRecords.every((e=>!e.isRecurring))))return e}updateMode(e){this.dragData&&("copy"===e?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}setCopying(){const{dragData:e}=this;e&&(e.eventBarCopies.some((e=>e.isConnected))?e.eventBarCopies.forEach((e=>{e.classList.remove("b-hidden")})):e.eventBarCopies.forEach((t=>{t.classList.add("b-drag-proxy-copy"),t.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(t),t.retainElement=!0})))}setMoving(){const{dragData:e}=this;e&&e.eventBarCopies.forEach((e=>{e.classList.add("b-hidden")}))}get scheduler(){return this.client}onBeforeDragStart(...e){let t=super.onBeforeDragStart(...e);return t&&(this.canStartFeatureTransaction?this.startFeatureTransaction().then():(this.client.trigger("eventDragPrevented",{reason:"revision"}),t=!1)),t}onDragAbortFinalized(...e){super.onDragAbortFinalized(...e),this.rejectFeatureTransaction()}async finalize(...e){await super.finalize(...e),await this.finishFeatureTransaction()}onAfterDragStart(e){const t=this,{drag:n}=t,{context:{element:r}}=e;t.singleDirection&&(n.lockY="horizontal"===e.initialDirection,n.lockX=!n.lockY),super.onAfterDragStart(e),t.handleKeyDownOrMove(e.event),t.keyEventDetacher=Jt.on({element:Yn.getRootElement(r),keydown:t.handleKeyDownOrMove,keyup:t.handleKeyUp,thisObj:t})}onDragReset(e){var t;super.onDragReset(e),null===(t=this.keyEventDetacher)||void 0===t||t.call(this),this.mode="move"}onDrop(e){var t;return null===(t=this.dragData.eventBarCopies)||void 0===t||t.forEach((e=>e.remove())),super.onDrop(e)}getDraggableElement(e){return null==e?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveEventRecord(e)}isElementDraggable(e,t){var n;const r=this,{client:i}=r,s=r.getDraggableElement(e);if(!s||r.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;const o=r.resolveEventRecord(s,i);if(!o||!o.isDraggable||o.readOnly)return!1;return!(!1===(null===(n=i[`is${r.capitalizedEventName}ElementDraggable`])||void 0===n?void 0:n.call(i,s,o,e,t)))}getTriggerParams(e){const{assignmentRecords:t,eventRecords:n,resourceRecord:r,browserEvent:i}=e;return{context:e,eventRecords:n,resourceRecord:r,assignmentRecords:t,domEvent:i}}getGroupedToStoreResources(e){if(e.resourcesInStore)return e.resourcesInStore;const t=this.client,n=t.isVertical?t.resourceStore:t.store;return e.resourcesInStore=[...new Set(n.getAllDataRecords().map((e=>e.$original)))].filter((e=>e.isLeaf))}getIndexDiff(e){const t=this,n=t.client,r=t.currentOverClient,i=n!==r,{isVertical:s}=r,o=n.isVertical?n.resourceStore:n.store,a=s?r.resourceStore:r.store,{resourceRecord:l,newResource:d}=e;let c;if(i)c=a.indexOf(d)-o.indexOf(l.$original);else if(t.constainDragToResource)c=0;else if(s&&a.isGrouped){const n=t.getGroupedToStoreResources(e);c=n.indexOf(l.$original)-n.indexOf(d)}else c=o.indexOf(l.$original)-o.indexOf(d);return c}getNewResource(e,t,n){const r=this,i=r.client,s=r.currentOverClient,o=i!==s,{isVertical:a}=s,l=i.isVertical?i.resourceStore:i.store,d=a?s.resourceStore:s.store;let{newResource:c}=e;if(o){const e=l.indexOf(t);c=d.getAt(e+n)||c}else if(0!==n){var u;let i;if(a&&d.isGrouped){const s=r.getGroupedToStoreResources(e);i=Math.max(Math.min(s.indexOf(t)-n,s.length-1),0),c=s[i]}else i=Math.max(Math.min(l.indexOf(t)-n,l.count-1),0),c=l.getAt(i),c.isSpecialRow&&(c=l.getNext(c,!1,!0)||l.getPrevious(c,!1,!0));c=null===(u=c)||void 0===u?void 0:u.$original}else c=t;return c}getDropData(e){const t=this.getIndexDiff(e);return{events:e.eventRecords.map((t=>({eventRecord:t,...this.getEventNewStartEndDates(t,e.timeDiff,this.currentOverClient)}))),assignments:e.assignmentRecords.map((n=>({assignmentRecord:n,resourceRecord:this.getNewResource(e,n.resource,t)})))}}triggerBeforeEventDropFinalize(e,t,n){t.context.dropData=this.getDropData(t.context),super.triggerBeforeEventDropFinalize(e,t,n)}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){const n=this;if(n.currentOverClient.trigger("afterEventDrop",Object.assign(n.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:e,eventStore:t}=n.client;n.dragData.initialAssignmentsState.find((({resource:r,assignment:i},s)=>{var o;return!e.includes(i)||!t.includes(i.event)||r.id!==(null===(o=n.dragData.assignmentRecords[s])||void 0===o?void 0:o.resourceId)}))&&n.client.refresh()}n.client.setTimeout((()=>n.client.navigator.skipNextClick=!1),10)}handleKeyDownOrMove(e){var t,n;const r=this;"copy"!==r.mode&&(r.alwaysCopy||r.isCtrlKeyPress(e)||e.key&&Jt.specialKeyFromEventKey(e.key)===(null===(t=r.copyKey)||void 0===t?void 0:t.toLowerCase())||e[`${null===(n=r.copyKey)||void 0===n?void 0:n.toLowerCase()}Key`])&&(r.mode="copy")}handleKeyUp(e){(this.isCtrlKeyPress(e)||Jt.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase())&&(this.mode="move")}isCtrlKeyPress(e){return"CTRL"===this.copyKey&&e.key===("ctrlKey"===c.ctrlKey?"Ctrl":"Meta")}isValidDrop(e){const{newResource:t,resourceRecord:n,browserEvent:r}=e,i=e.draggedEntities[0],{target:s}=r;return t?!t.isSpecialRow&&!t.readOnly&&(n.$original===t||!i.event.resources.includes(t)):!(this.constrainDragToTimeline||!this.externalDropTargetSelector)&&Boolean(s.closest(this.externalDropTargetSelector))}checkDragValidity(e,t){const n=this,r=n.currentOverClient,{newResource:i}=e;let s;if(null!=i&&i.readOnly)return!1;var o;(s=i&&n.hasOverlaps()?{valid:!1,message:n.L("L{eventOverlapsExisting}")}:n.validatorFn.call(n.validatorFnThisObj||n,e,t),!s||s.valid)&&(s=(null===(o=r.checkEventDragValidity)||void 0===o?void 0:o.call(r,e,t))??s);return s}hasOverlaps(){const e=this,{dragData:t,currentOverClient:n}=e,{startDate:r,origStart:i}=t,s=r-i,o=e.getIndexDiff(e.dragData),{bufferIsUnavailableTime:a}=n.features.eventBuffer||{};return t.assignmentRecords.some((n=>{const r=e.getNewResource(t,n.resource,o),i=n.event,l=a&&i.outerStartDate||i.startDate,d=a&&i.outerEndDate||i.endDate,c=xi.add(l,s,"ms"),u=xi.add(d,s,"ms");return!e.currentOverClient.isDateRangeAvailable(c,u,t.assignmentRecords,r)}))}async updateRecords(e){const t=this,n=t.client,r=t.currentOverClient,i="copy"===t.mode,{draggedEntities:s,timeDiff:o,initialAssignmentsState:a}=e,l=a[0].startDate,d=t.adjustStartDate(l,o);let c;return e.externalDropTarget||(r.timeAxis.timeSpanInAxis(d,xi.add(d,s[0].event.rawDurationMS,"ms"))||(e.valid=!1),e.valid&&(n.eventStore.suspendAutoCommit(),r.eventStore.suspendAutoCommit(),c=await t.updateAssignments(n,r,e,i),n.eventStore.resumeAutoCommit(),r.eventStore.resumeAutoCommit())),e.valid&&r.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:i,copyMode:t.copyMode,domEvent:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),c}async updateAssignments(e,t,n,r){const i=this,{copyMode:s}=i,o=e!==t,{isVertical:a}=t,{assignmentStore:l,eventStore:d}=e,{assignmentStore:c,eventStore:u}=t,h=e.isVertical?e.resourceStore:e.store,{eventRecords:g,assignmentRecords:m,timeDiff:p,initialAssignmentsState:f,newResource:v}=n,{unifiedDrag:y}=i,b=u.usesSingleAssignment||!1!==u.usesSingleAssignment&&d.usesSingleAssignment,C="event"===s?"event":"assignment"===s?"assignment":b?"event":"assignment",w=i.adjustStartDate(m[0].event.startDate,p),S=[],D=[],E=[],x=[],R=[],T=new Set;e.suspendRefresh(),t.suspendRefresh();let M=!1,k=!1;const F=i.getIndexDiff(n);a&&g.forEach(((t,r)=>{const i=n.eventBarEls[r];delete t.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const I=n.eventBarEls.slice(),A=[],L={};for(let e=0;e<m.length;e++){const a=m[e];let g,O=a.event;if(r?(g=a.copy(),L[a.id]=g):g=a,!(g.isOccurrenceAssignment||l.includes(a)&&d.includes(O))){I[e].remove(),I.splice(e,1),m.splice(e,1),e--;continue}const $=f[e],_=O,H=$.startDate,V=$.resource,N=this.constrainDragToTimeSlot?H:y?w:i.adjustStartDate(H,p);if(!l.equals(c)){const e=_.assignments.length>1||r;let t;var P;if(r?t=g:(t=g.copy(),L[g.id]=t),t.event&&!b&&(t.event=t.event.id,t.resource=t.resource.id),r||x.push(g),e||D.push(_),r&&("event"===s||"auto"===s&&u.usesSingleAssignment)||!u.getById(_.id))O=u.createRecord({..._.data,children:null===(P=_.children)||void 0===P?void 0:P.map((e=>e.copy())),id:!r||"event"!==s&&"auto"!==s?_.id:void 0,calendar:null}),t.set({eventId:O.id,event:O}),S.push(O);b||E.push(t),g=t}let B=v,z=null;y||(B=i.getNewResource(n,V,F)||v),B=B.$original;const j=g.resourceId!==B.id;if(j){if(z=h.getById(g.resourceId),r&&l.equals(c)){g.setData({resource:null,resourceId:null}),g.resource=B,g.event=u.getById(g.eventId);const e="event"===s||d.usesSingleAssignment&&"auto"===s;e&&(O=O.copy(),O.meta.endDateCached=i.adjustStartDate(O.endDate,p),O.endDate=null,g.event=O,u.usesSingleAssignment&&(O.resource=B,O.resourceId=B.id)),c.find((e=>e.eventId===g.eventId&&e.resourceId===g.resourceId))||E.find((e=>e.eventId===g.eventId&&e.resourceId===g.resourceId))||(e&&S.push(O),E.push(g))}else g.resource=B,b?g.event.resourceId=B.id:g.resourceId=B.id;O.isEvent&&T.add(O),M=!0,O.isOccurrence&&O.set("newResource",B),o&&b&&(O.resourceId=B.id)}else r&&("event"===s||"auto"===s&&d.usesSingleAssignment)&&!S.includes(O)&&(O=O.copy(),O.meta.endDateCached=i.adjustStartDate(O.endDate,p),O.endDate=null,S.push(O),g.event=O,u.usesSingleAssignment&&O.set({resource:B,resourceId:B.id}),E.push(g));if(!R.find((e=>e.draggedEvent===O))&&!xi.isEqual(O.startDate,N)){for(;!O.isOccurrence&&O.isBatchUpdating;)O.endBatch(!0);r&&!o&&!b&&"assignment"===C&&j||(O.startDate=N,R.push({draggedEvent:O,originalStartDate:H})),O.isEvent&&T.add(O),k=!0}t.processEventDrop({eventRecord:O,resourceRecord:B,element:0===e?n.context.element:n.context.relatedElements[e-1],context:n,toScheduler:t,reassignedFrom:z,eventsToAdd:S,addedEvents:A,draggedAssignment:g}),t.trigger("processEventDrop",{originalAssignment:a,draggedAssignment:g,context:n,copyMode:s,isCopy:r})}if(l.remove(x),d.remove(D),c.add(E),r&&l.equals(c)){const{syncIdMap:t}=e.foregroundCanvas;Object.entries(L).forEach((([e,n])=>{const r=t[e];delete t[e],t[n.id]=r}))}if(S.length&&A.push(...u.add(S)),null==A||A.forEach((e=>T.add(e))),(x.length||D.length||E.length||S.length)&&(M=!0),M||k){if(!i.constrainDragToTimeline)for(let e=0;e<m.length;e++){const i=L[m[e].id]||m[e],s=i.event,l=(null==A?void 0:A.find((e=>e.id===s.id)))||s,d=n.eventBarEls[e],c=0===e?n.context.element:n.context.relatedElements[e-1],u=t.isInTimeAxis(l);if(delete l.meta.endDateCached,r||ud.removeChild(d.parentElement,d),l.resource&&(a||t.rowManager.getRowFor(i.resource))&&u){if(!l.parent||l.parent.isRoot){const e=Ot.from(c,t.foregroundCanvas,!0),n=t.rtl?t.timeAxisViewModel.totalSize-e.right:e.x;Yn.setTopInsetInlineStart(c,e.y,n),ud.addChild(t.foregroundCanvas,c,l.assignments[0].id),o&&t.processCrossSchedulerEventDrop({eventRecord:l,toScheduler:t})}c.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),c.retainElement=!1}else c.remove()}b&&T.forEach((e=>e.beginBatch()));const s=u.$master.project??t.project,l=d.$master.project??e.project;await Promise.all([s!==l?s.commitAsync():null,l.commitAsync()]),b&&T.forEach((e=>e.endBatch(!1,!0)))}M||(M=R.some((({draggedEvent:e,originalStartDate:t})=>!xi.isEqual(e.startDate,t)))),t.resumeRefresh(!1),e.resumeRefresh(!1),m.length>0&&(M?(I.forEach((e=>delete e.lastDomConfig)),t.refreshWithTransition(),o&&(e.refreshWithTransition(),t.selectedEvents=A)):n.valid=!1)}getProductDragContext(e){const t=this,{currentOverClient:n}=t,r=e.browserEvent.target,i=e.newResource||e.resourceRecord,s=e.targetEventRecord;let o,a,l=n?t.resolveEventRecord(r,n):null;if(e.eventRecords.includes(l)&&(l=null),t.constrainDragToResource?o=e.resourceRecord:t.constrainDragToTimeline?n&&(o=t.resolveResource()||e.newResource||e.resourceRecord):o=t.resolveResource(),l&&!l.isParent&&!l.parent){const t=r.parentElement.dataset.resourceId;if(o&&t!=o.id){l=n.eventStore.getEvents({startDate:e.startDate,endDate:e.endDate,resourceRecord:o})[0]}}const{assignmentRecords:d,eventRecords:c}=e,u=i!==o;let h=Boolean(o&&!o.isSpecialRow);return!o&&t.externalDropTargetSelector&&(a=r.closest(t.externalDropTargetSelector),h=Boolean(a)),{valid:h,externalDropTarget:a,eventRecords:c,assignmentRecords:d,newResource:o,targetEventRecord:l,dirty:u||l!==s,proxyElements:[e.context.element,...e.context.relatedElements||[]]}}getMinimalDragData(e){const t=this,{scheduler:n}=t,r=t.getElementFromContext(e),i=t.resolveEventRecord(r,n),s=n.resolveResourceRecord(r),o=n.resolveAssignmentRecord(r);let a=o?[o]:[];o&&(n.isAssignmentSelected(a[0])||t.drag.startEvent.ctrlKey&&n.multiEventSelect)&&a.push.apply(a,t.getRelatedRecords(o)),a=a.filter((e=>n.resourceStore.isAvailable(e.resource)));return{eventRecord:i,resourceRecord:s,assignmentRecord:o,eventRecords:[...new Set(a.map((e=>e.event)))],assignmentRecords:a}}setupProductDragData(e){var t;const n=this,{scheduler:r}=n,i=n.getElementFromContext(e),{eventRecord:s,resourceRecord:o,assignmentRecord:a,assignmentRecords:l}=n.getMinimalDragData(e),d=[];if(n.constrainDragToResource&&!o)throw new Error("Resource could not be resolved for event: "+s.id);let c;if(n.constrainDragToTimeline){var u;c=null===(u=n.getDateConstraints)||void 0===u?void 0:u.call(n,o,s);const e=n.constrainRectangle=n.getConstrainingRectangle(c,o,s),t=Ot.from(i,r.timeAxisSubGridElement),a=Boolean(c.start);super.setupConstraints(e,t,r.timeAxisViewModel.snapPixelAmount,a&&r.isHorizontal,a&&r.isVertical)}return l.forEach((e=>{let t=r.getElementFromAssignmentRecord(e,!0,!1,r.isLockedRowsView);t||(t=r.currentOrientation.addTemporaryDragElement(e.event,e.resource)),d.push(t)})),{record:a,draggedEntities:l,dateConstraints:null!==(t=c)&&void 0!==t&&t.start?c:null,eventBarCopies:d.map((e=>n.createProxy(e))),eventBarEls:d}}getDateConstraints(e,t){var n;const{scheduler:r}=this,i=null===(n=r.getDateConstraints)||void 0===n?void 0:n.call(r,e,t);let s,o;return this.constrainDragToTimeSlot?(s=t.startDate,o=t.endDate):i&&(s=i.start||new Date(0),o=i.end||new Date(9999,0,1)),{start:s,end:o}}getConstrainingRectangle(e,t,n){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&t,n,!0,e&&{start:e.start,end:e.end})}getDragData(e){const t=this.getMinimalDragData(e)||{};return{...super.getDragData(e),...t,initialAssignmentsState:t.assignmentRecords.map((e=>({startDate:e.event.startDate,resource:e.resource,assignment:e})))}}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter((t=>t!==e&&!t.resource.readOnly&&t.event.isDraggable))}getCoordinate(e,t,n){const r=this.currentOverClient;if(r.isHorizontal){let i=n[0];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}{let i=n[1];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetHeight/2;break;case"end":i+=t.offsetHeight}return i}}resolveResource(){var e;const t=this,n=t.currentOverClient,{isHorizontal:r}=n,{context:i,browserEvent:s,dragProxy:o}=t.dragData,a=o||i.element,l=Ot.from(a,null,!0),d=n.isVertical||t.unifiedDrag?i.clientY:l.center.y,c=Ot.from(a,n.timeAxisSubGridElement,!0),{x:u,y:h}=c.center;let g,m=null;if(g=s.touches?Ot.from(n.element).contains($t.from(s,!0)):n.element.contains(t.getMouseMoveEventTarget(s)),g)if(r){const e=n.rowManager.getRowAt(d);m=e&&n.store.storage.getAt(e.dataIndex)}else m=n.resolveResourceRecord(n.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[u,h]);return null===(e=m)||void 0===e?void 0:e.$original}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getProxyElement(e){var t;const{dragData:n}=this;if(this.isDragging&&null!=n&&null!==(t=n.proxyElements)&&void 0!==t&&t.length){const t=n.assignmentRecords.indexOf(e);if(t>=0)return n.proxyElements[t]}return null}getMouseMoveEventTarget(e){return e.target}}$R._$name="EventDrag",Jv.registerFeature($R,!0,"Scheduler"),Jv.registerFeature($R,!1,"ResourceHistogram");class _R extends eR{static $name="EventDragCreate";static configurable={validatorFn:()=>!0};get scheduler(){return this.client}get store(){return this.client.eventStore}get project(){return this.client.project}updateLockLayout(e){this.dragActiveCls="b-dragcreating"+(e?" b-dragcreate-lock":"")}handleBeforeDragCreate(e,t,n){var r;const i=this,{scheduler:s}=i,{resourceRecordLink:o,resourceRecord:a}=e;if(i.disabled||a.readOnly||!(s.resourceStore.isAvailable(a)||o&&s.store.isAvailable(o))||!s.isDateRangeAvailable(e.mousedownDate,e.mousedownDate,null,a))return!1;const l=(!s.isSchedulerPro||t.ignoreResourceCalendar||a.isWorkingTime(e.mousedownDate))&&s.trigger("beforeDragCreate",{resourceRecord:a,date:e.mousedownDate,event:n});return i.dateConstraints=null===(r=s.getDateConstraints)||void 0===r?void 0:r.call(s,a,t),l}dragStart(e){var t,n;const r=this,{client:i}=r;if(null!==(t=i.project)&&void 0!==t&&null!==(t=t.stm)&&void 0!==t&&t.isNavigatingRevisions)return i.trigger("eventDragCreatePrevented",{reason:"revision"}),!1;const{eventStore:s,assignmentStore:o,enableEventAnimations:a,enableTransactionalFeatures:l}=i,{resourceRecordLink:d,resourceRecord:c}=e,u=r.createEventRecord(e),h=[c];if(u.set("duration",xi.diff(u.startDate,u.endDate,u.durationUnit,!0)),u.isCreating=!0,u.meta.isDragCreating=!0,i.features.taskEdit&&i.features.taskEdit.doCancel(),!1===r.handleBeforeDragCreate(e,u,e.event))return!1;r.captureStm(!0);let g=[];if(c&&(g=s.usesSingleAssignment||!l?o.assignEventToResource(u,c):[o.createRecord({event:u,resource:c})]),!1===i.trigger("beforeEventAdd",{eventRecord:u,resourceRecords:h,assignmentRecords:g}))return!s.usesSingleAssignment&&l||o.remove(g),!1;r.lockLayout&&(u.meta.excludeFromLayout=!0),null===(n=i.onEventCreated)||void 0===n||n.call(i,u),i.enableEventAnimations=!1;const m=s.add(u);return this.project.commitAsync().then((()=>i.enableEventAnimations=a)),m?(!s.usesSingleAssignment&&l&&o.add(g[0]),i.isCreating=!0,i.isHorizontal?i.rowManager.renderRows([i.getRowFor(d||c)]):i.refreshRows(),i.isCreating=!1,e.itemElement=e.element=i.getElementFromEventRecord(u),Yn.isInView(e.itemElement)||i.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:i.barMargin}),super.dragStart(e)):(!s.usesSingleAssignment&&l||o.remove(g),!1)}checkValidity(e,t){const n=this,{client:r}=n,i=e.resourceRecord=n.dragging.resourceRecord;return r.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,i)?n.createValidatorFn.call(n.validatorFnThisObj||n,e,t):{valid:!1,message:n.L("L{EventDrag.eventOverlapsExisting}")}}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}createEventRecord(e){const t=this,{client:n}=t,r=n.isHorizontal?"X":"Y",{timeAxis:i,eventStore:s,weekStartDay:o}=n,{event:a,mousedownDate:l}=e,d=t.draggingEnd=a[`page${r}`]>e.startEvent[`page${r}`],c={name:s.modelClass.fieldMap.name.defaultValue||t.L("L{Object.newEvent}"),startDate:d?xi.floor(l,i.resolution,null,o):l,endDate:d?l:xi.ceil(l,i.resolution,null,o)};return n.project.isGanttProjectMixin&&W.assign(c,{constraintDate:c.startDate,constraintType:"startnoearlierthan"}),s.createRecord(c)}async internalUpdateRecord(e,t){await super.internalUpdateRecord(e,t),this.client.hasEventEditor||(e.eventRecord.isCreating=!1)}async finalizeDragCreate(e){const{meta:t}=e.eventRecord;t.excludeFromLayout=!1,t.isDragCreating=!1;const n=await super.finalizeDragCreate(e);return n?this.hasStmCapture=!1:await this.freeStm(!0),n}async cancelDragCreate(e){var t;await super.cancelDragCreate(e),await this.freeStm(!1),await(null===(t=this.afterCancel)||void 0===t?void 0:t.call(this))}getTipHtml(...e){const t=super.getTipHtml(...e),{element:n}=this.tip;return n.classList.add("b-sch-dragcreate-tooltip"),n.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),t}onAborted(e){var t,n;const{eventRecord:r,resourceRecord:i}=e.eventContexts[0];null===(t=(n=this.store).unassignEventFromResource)||void 0===t||t.call(n,r,i),this.store.remove(r)}}_R._$name="EventDragCreate",Jv.registerFeature(_R,!0,"Scheduler"),Jv.registerFeature(_R,!1,"ResourceHistogram");class HR extends(Hi(Mr)){static $name="EventDragSelect";targetSelector=".b-sch-timeaxis-cell, .b-timeaxissubgrid";construct(e,t){e.multiEventSelect=!0,super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const t=this,{client:n}=t,{foregroundCanvas:r}=n,{target:i,button:s,touches:o,clientX:a,clientY:l}=e,d=Ot.from(r,!0);o||0!==s||t.disabled||!i.matches(t.targetSelector)||!1===n.trigger("beforeEventDragSelect",{event:e})||(n.preventDragSelect=!0,t.startX=a-d.x,t.startY=l-d.y,t.element||(t.element=Yn.createElement({className:"b-dragselect-rect",retainElement:!0})),n.foregroundCanvas.appendChild(t.element),t.element.style.transform=`translate(${t.startX}px, ${t.startY}px)`,n.navigator.disabled=!0,t.mouseUpDetacher=Jt.on({element:document,mouseup:"onDocumentMouseUp",thisObj:t,capture:!0}))}get eventRectangles(){const{client:e}=this;return Array.from(e.foregroundCanvas.children).filter((t=>t.matches(`${e.eventSelector}, .b-nested-events-container`))).map((t=>{const n=e.resolveAssignmentRecord(t);return{rectangle:Ot.from(t,!0),record:n,selected:e.selectedAssignments.includes(n)}}))}onElementMouseMove(e){const t=this,{client:n}=t;if("number"==typeof t.startX){const r=t.rectangle=Ot.from(t.client.foregroundCanvas,!0),i=Math.min(Math.max(e.clientX-r.x,0),r.width+1),s=Math.min(Math.max(e.clientY-r.y,0),r.height+1),o=new Ot(Math.min(i,t.startX),Math.min(s,t.startY),Math.abs(i-t.startX),Math.abs(s-t.startY));Yn.setTranslateXY(t.element,o.x,o.y),t.element.style.width=`${o.width}px`,t.element.style.height=`${o.height}px`,t.dragging||(n.element.classList.add("b-dragselecting"),e.ctrlKey||e.metaKey||n.clearEventSelection(),t.originalSelection=n.selectedAssignments.slice(),t.subGridElementRect=Ot.from(n.timeAxisSubGridElement,!0),n.navigator.disabled=!0,n.enableScrollingCloseToEdges(n.timeAxisSubGrid),t.dragging=!0),t.updateSelection()}}onDocumentMouseUp(e){const t=this,{client:n}=t,{selectedAssignments:r,navigator:i}=n,s=Ot.from(n.timeAxisSubGridElement);var o;(n.disableScrollingCloseToEdges(n.timeAxisSubGrid),!t.dragging&&n.deselectAllOnScheduleClick&&n.clearEventSelection(),t.element&&(t.element.style="",t.element.remove()),n.element.classList.remove("b-dragselecting"),t.startX=t.startY=null,i.skipNextClick=s.contains($t.from(e,!0)),i.disabled=!1,t.dragging=!1,r.length)&&(i.skipScrollIntoView=!0,n.activeAssignment=r[r.length-1],null===(o=i.activeItem)||void 0===o||o.focus(),i.skipScrollIntoView=!1);t.mouseUpDetacher(),n.trigger("afterEventDragSelect")}updateSelection(){const e=this,t=e.rectangle=Ot.from(e.element,!0),{eventRectangles:n,client:r}=e,i=r.selectedAssignments.reduce(((e,t)=>(r.getElementFromAssignmentRecord(t)||e.push(t),e)),[]);for(const e of n)t.intersect(e.rectangle,!0,!0)&&!1!==r.isEventSelectable(e.record.event)&&(e.selected=!0,i.push(e.record));i.push(...e.originalSelection),r.selectedAssignments=i;const s=r.getStartEndDatesFromRectangle(t,void 0,void 0,void 0,!1);r.trigger("eventDragSelect",{startDate:s.start,endDate:s.end,rectangle:t,selectedAssignments:r.selectedAssignments,selectedEvents:r.selectedEvents})}}HR._$name="EventDragSelect",Jv.registerFeature(HR,!1,"Scheduler");class VR extends eh{static type="eventeditor";static $name="EventEditor";static configurable={items:[],axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null,maximizeOnMobile:!0,internalListeners:{beforeShow:"onInternalBeforeShow"}};revertFocus(){var e;const{owner:t}=this,n=null===(e=this.focusInEvent)||void 0===e?void 0:e.relatedTarget;var r;n&&!Yn.isFocusable(n)&&t.isTimelineBase&&(null===(r=t.focusedCell)||void 0===r||null===(r=r.cell)||void 0===r||r.focus());super.revertFocus()}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain((e=>!e.isSpecialRow),null,{storeClass:Il,excludeCollapsedRecords:!1})}processWidgetConfig(e){var t;if(null!==(t=e.type)&&void 0!==t&&t.includes("date")&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"extraItems"===e.type)return!1;const{eventEditFeature:n}=this,r={};if("resourceField"===e.ref){const{store:t}=e;e.store=this.chainResourceStore(),t&&e.store.setConfig(t),"multiSelect"in e||(e.multiSelect=!n.eventStore.usesSingleAssignment)}return"startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(r.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(r.format=n.timeFormat),Object.assign(e,r),super.processWidgetConfig(e)}setupEditorButtons(){const{record:e}=this,{deleteButton:t}=this.widgetMap;t&&(t.hidden=this.readOnly||e.isCreating)}onInternalBeforeShow(...e){this.setupUIForEditing()}onBeforeToggleReveal({reveal:e}){e&&this.setupUIForEditing()}setupUIForEditing(){const e=this,{record:t,titleRenderer:n}=e;e.setupEditorButtons(),e.ariaLabel=e.L("L{Object.editing}",t.name),n&&(e.title=e.callback(n,e,[t]))}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),"Escape"===e.key?(e.stopImmediatePropagation(),this.eventEditFeature.onCancelClick()):super.onInternalKeyDown(e)}close(e){const{eventEditFeature:t}=this;if(null!=t&&t.editingContext&&e!==t)t.onCancelClick();else if(!this.isClosing){this.isClosing=!0;try{super.close()}finally{this.isClosing=!1}}}updateReadOnly(e){const{deleteButton:t,saveButton:n,cancelButton:r}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),n&&(n.hidden=e),r&&(r.hidden=e)}}VR.initClass(),VR._$name="EventEditor";class NR extends Dm{static $name="RecurrenceFrequencyCombo";static type="recurrencefrequencycombo";static configurable={editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1,picker:{align:{matchSize:"min"}}};buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}}NR.initClass(),NR._$name="RecurrenceFrequencyCombo";class BR extends NR{static $name="RecurrenceCombo";static type="recurrencecombo";static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){return[{value:"none",text:"L{None}"},...super.buildItems(),{value:this.customValue,text:"L{Custom}",cls:this.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:n,monthDays:r,months:i}=e;return Boolean(t>1||n&&n.length||r&&r.length||i&&i.length)}}BR.initClass(),BR._$name="RecurrenceCombo";class zR extends Tu{static $name="RecurrenceLegendButton";static type="recurrencelegendbutton";static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?Ux.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}zR.initClass(),zR._$name="RecurrenceLegendButton";class jR extends Dm{static $name="RecurrenceDaysCombo";static type="recurrencedayscombo";static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter(((e,t)=>!xi.nonWorkingDays[t])).join(","),nonWorkingDaysValue:e.filter(((e,t)=>xi.nonWorkingDays[t])).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=xi.weekStartDay,n=xi.getDayNames().map(((e,t)=>({text:e,value:iS.encodeDay(t)})));e._weekDays=n.slice(t).concat(n.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}jR.initClass(),jR._$name="RecurrenceDaysCombo";class WR extends Mm{static $name="DayButtons";static type="daybuttons";static defaultConfig={value:null,items:!0};static configurable={pressedCls:"b-raised b-blue",dayNameLength:1,separator:",",defaults:{toggleable:!0}};updateItemText(e){const t=iS.decodeDay(e.value)[0],n=xi.getDayName(t);e.text=n.substring(0,this.dayNameLength),e.tooltip=n}changeItems(e){if(!0===e){const t=xi.weekStartDay,n=xi.getDayNames().map(((e,t)=>({text:e.substring(0,this.dayNameLength),tooltip:e,value:iS.encodeDay(t),pressedCls:this.pressedCls,dataset:{dayIndex:t}})));e=n.slice(t).concat(n.slice(0,t)),e=super.changeItems(e)}return e}set value(e){var t;(null===(t=e)||void 0===t?void 0:t.length)>0&&"number"==typeof e[0]&&(e=e.map((e=>iS.encodeDay(e)))),e&&Array.isArray(e)&&(e=e.join(this.separator)),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(this.separator)),e}get valueAsDayNumbers(){return this.value?this.value.split(this.separator).map((e=>iS.decodeDay(e)[0])):[]}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}WR.initClass(),WR._$name="DayButtons";class UR extends WR{static $name="RecurrenceDaysButtonGroup";static type="recurrencedaysbuttongroup"}UR.initClass(),UR._$name="RecurrenceDaysButtonGroup";class GR extends Mm{static $name="RecurrenceMonthDaysButtonGroup";static type="recurrencemonthdaysbuttongroup";static configurable={defaults:{toggleable:!0}};get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.items=this.buildItems(),super.construct(e)}buildItems(){const e=[];for(let t=this.minValue;t<=this.maxValue;t++)e.push({text:t+"",value:t});return e}}GR.initClass(),GR._$name="RecurrenceMonthDaysButtonGroup";class YR extends(Mm.mixin(im)){static $name="RecurrenceMonthsButtonGroup";static type="recurrencemonthsbuttongroup";static configurable={defaults:{toggleable:!0}};construct(e={}){e.items=this.buildItems(),super.construct(e)}buildItems(){return xi.getMonthNames().map(((e,t)=>({text:e.substring(0,3),value:t+1})))}updateItemText(e){e.text=xi.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}YR.initClass(),YR._$name="RecurrenceMonthsButtonGroup";class qR extends Dm{static $name="RecurrenceStopConditionCombo";static type="recurrencestopconditioncombo";static configurable={editable:!1,placeholder:"Never",displayField:"text",valueField:"value"};buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}qR.initClass(),qR._$name="RecurrenceStopConditionCombo";class KR extends Dm{static $name="RecurrencePositionsCombo";static type="recurrencepositionscombo";static get defaultConfig(){return{editable:!1,splitCls:"b-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return Il.new({fields:["value","text","cls"],data:this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])})}buildDayNumbers(){return nt.populate(this.maxPosition,(e=>({value:e+1,text:this.L(`position${e+1}`)})))}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),e&&this.store.findRecord("value",e)||(e=this.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map((e=>parseInt(e,10))):[]}}KR.initClass(),KR._$name="RecurrencePositionsCombo";class XR extends Xu{static $name="RecurrenceEditorPanel";static type="recurrenceeditorpanel";static configurable={focusable:!1,cls:"b-recurrenceeditor",record:!1,addNone:!1,strictRecordMapping:!0,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysLabel:{type:"label",text:"L{RecurrenceEditor.Days}",weight:18,forFrequency:"WEEKLY",cls:"b-button-group-label"},daysButtonField:{type:"daybuttons",cls:"b-recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY",useGap:!0,required:!0},emptyMonthsHiddenField:{type:"field",inputType:"hidden",name:"monthDays",forFrequency:"MONTHLY",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled",change(){this._value=null}}},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange",cls:"b-label-with-checkbox"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY",cls:"b-space-above",required:!0,internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},monthDaysNumberRadioField:{type:"checkbox",weight:53,cls:"b-label-with-checkbox",toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"YEARLY",label:"L{RecurrenceEditor.on}",style:"display:inline-flex;",onChange:"up.onMonthDaysNumberRadioFieldChange"},monthDaysNumberField:{type:"numberfield",weight:56,flex:1,name:"monthDays",forFrequency:"YEARLY",min:1,max:31,required:!0,internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},monthsLabel:{type:"label",text:"L{RecurrenceEditor.Months}",weight:57,forFrequency:"YEARLY",cls:"b-button-group-label"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:58,cls:"b-space-above b-space-below",name:"months",forFrequency:"YEARLY",onChange:"up.onMonthsButtonFieldChange",required:!0},positionAndDayRadioField:{type:"checkbox",weight:60,cls:"b-label-with-checkbox b-space-below",toggleGroup:"radio",toggleGroupRootElement:".b-recurrenceeditorpanel",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY",cls:"b-space-below b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",cls:"b-space-below b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange",cls:"b-no-inner-span"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" ",cls:"b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0,cls:"b-no-span",internalListeners:{beforeUpdateDisabled:"up.onFieldBeforeUpdateDisabled"}}}};changeItems(e,t){const n=super.changeItems(e,t),{positionAndDayRadioField:r,monthDaysNumberRadioField:i,monthDaysNumberField:s}=this.widgetMap;return i?r.label=this.L("L{RecurrenceEditor.the}"):(r.label=this.L("L{RecurrenceEditor.On the}"),s&&n.remove(s)),n}setupWidgetConfig(e){return c.isMobile&&!("editable"in e)&&(e.editable=!1),super.setupWidgetConfig(...arguments)}updateRecord(e){super.updateRecord(e);const t=this,{frequencyField:n,daysButtonField:r,monthDaysButtonField:i,monthDaysNumberField:s,monthsButtonField:o,monthDaysRadioField:a,monthDaysNumberRadioField:l,positionAndDayRadioField:d,stopRecurrenceField:c}=t.widgetMap;if(e){const n=e.getDateValues();var u,h,g;if(n)null!==(u=e.days)&&void 0!==u&&u.length||(r.value=n.days),null!==(h=e.monthDays)&&void 0!==h&&h.length||(i&&(i.value=n.monthDays),s&&(s.value=n.monthDays[0])),null!==(g=e.months)&&void 0!==g&&g.length||!o||(o.value=n.months[0]);r.value&&e.positions?(d.check(),t.isPainted||a.uncheck()):null!=i&&i.value&&(l&&!l.hidden?l.check():a.check(),t.isPainted&&t.element.isConnected||d.uncheck()),c&&(c.recurrence=e)}else n.value="NONE"}get valuesCleanState(){return{frequency:null,interval:null,days:null,months:null,monthDays:null,positions:null,endDate:null,count:null}}processValues(e){"monthDays"in e&&("string"==typeof e.monthDays?e.monthDays=e.monthDays.split(","):e.monthDays=nt.asArray(e.monthDays))}get values(){const e={...this.valuesCleanState,...super.values};return this.processValues(e),e}set values(e){super.values=e}getValues(){const e={...this.valuesCleanState,...super.getValues(...arguments)};return this.processValues(e),e}syncEventRecord(e){if(e=e||this.record){const t=this.getValues((t=>t.name in e&&!t.disabled));e.set(t)}}toggleStopFields(e){var t;const n=null===(t=this.widgetMap.stopRecurrenceField)||void 0===t?void 0:t.value,{countField:r,endDateField:i,frequencyField:s}=this.widgetMap,o="count"===n&&"NONE"!==s.value,a=!o&&"date"===n;r._userAction=i._userAction=e,r.disabled=r.hidden=!o,i.disabled=i.hidden=!a,r._userAction=i._userAction=!1}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.includes(t)}onFieldChange({source:e,userAction:t}){const{record:n}=this;t&&this.autoUpdateRecord&&n&&(n.isSanitizingSuspended=!0),super.onFieldChange(...arguments),t&&this.autoUpdateRecord&&n&&(n.isSanitizingSuspended=!1,this.setTimeout({fn:()=>n.sanitize(),delay:50,cancelOutstanding:!0}))}onFieldBeforeUpdateDisabled({source:e,disabled:t}){!t&&e._userAction&&e.triggerFieldChange({userAction:!0})}onMonthDaysRadioFieldChange({source:e,checked:t,userAction:n,propagatingUserActionFrom:r}){const{monthDaysButtonField:i,emptyMonthsHiddenField:s}=this.widgetMap;i&&(i._userAction=n,i.disabled=!t||!this.isWidgetAvailableForFrequency(i),i._userAction=!1),s&&(s._userAction=n||r,s.disabled=t||!this.isWidgetAvailableForFrequency(s),s._userAction=!1)}onMonthsButtonFieldChange({value:e}){const t=xi.getMonthNames(),{monthDaysNumberField:n}=this.widgetMap;e&&n&&(n.hint=e.split(",").map((e=>t[e-1])).join(", "))}onMonthDaysNumberRadioFieldChange({checked:e,userAction:t}){const{monthDaysNumberField:n}=this.widgetMap;n._userAction=t,n.disabled=!e||!this.isWidgetAvailableForFrequency(n),n._userAction=!1}onPositionAndDayRadioFieldChange({source:e,checked:t,userAction:n}){const{daysCombo:r,positionsCombo:i}=this.widgetMap;r._userAction=i._userAction=n,r.disabled=i.disabled=!t||!this.isWidgetAvailableForFrequency(r),r._userAction=i._userAction=!1}onStopRecurrenceFieldChange({userAction:e}){this.toggleStopFields(e)}onFrequencyFieldChange({value:e,oldValue:t,valid:n,userAction:r}){const i=this,s=i.queryAll((e=>"forFrequency"in e)),{intervalField:o,stopRecurrenceField:a}=i.widgetMap,l="NONE"===e;if(n&&e){for(const t of s)t._userAction=r,t.disabled=t.hidden=!i.isWidgetAvailableForFrequency(t,e),t._userAction=!1;i.widgetMap.countField.hidden="NONE"===e,a&&(a.hidden=l),o&&(o.hidden=l,l||(o.hint=i.L(`L{RecurrenceEditor.${e}intervalUnit}`)),"NONE"===t&&null==o.value&&(o.value=1)),i.toggleFieldsState()}}toggleFieldsState(e){const t=this,{widgetMap:n}=t,{monthDaysRadioField:r}=n;r&&t.onMonthDaysRadioFieldChange({checked:r.checked,userAction:e}),t.onPositionAndDayRadioFieldChange({checked:n.positionAndDayRadioField.checked,userAction:e}),t.onStopRecurrenceFieldChange({userAction:e})}updateLocalization(){const{countField:e,intervalField:t,frequencyField:n}=this.widgetMap;e.hint=this.L("L{RecurrenceEditor.time(s)}"),n.value&&"NONE"!==n.value&&(t.hint=this.L(`L{RecurrenceEditor.${n.value}intervalUnit}`)),super.updateLocalization()}}XR.initClass(),XR._$name="RecurrenceEditorPanel";class ZR extends eh{static $name="RecurrenceEditor";static type="recurrenceeditor";static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",items:{monthDaysNumberRadioField:!1},title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}},scrollable:{overflowY:!0}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(e){this.recurrenceEditorPanel.record=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}}ZR.initClass(),ZR._$name="RecurrenceEditor";var JR=e=>class extends(e||Qe){static $name="RecurringEventEdit";static configurable={recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},recurrenceConfirmation:{$config:"lazy",value:{type:"recurrenceconfirmation"}},showRecurringUI:null,useContextualRecurrenceRules:!0};changeEditorConfig(e){return e.items={...e.items,...this.recurringEventsItems},e=super.changeEditorConfig(e)}doDestroy(){var e,t;null===(e=this._recurrenceConfirmation)||void 0===e||e.destroy(),null===(t=this._recurrenceEditor)||void 0===t||t.destroy(),super.doDestroy()}onEditorConstructed(e){var t;const n=this;e.ion({hide:n.onRecurringEventEditorHide,show:n.onRecurringEventEditorShow,reveal:n.onRecurringEventEditorShow,unreveal:n.onRecurringEventEditorHide,thisObj:n}),n.editRecurrenceButton&&!1!==n.client.enableRecurringEvents&&n.setTimeout((()=>n.editRecurrenceButton.menu=n.recurrenceEditor),100),null===(t=n.recurrenceCombo)||void 0===t||t.ion({change:n.onRecurrenceComboChange,thisObj:n})}updateReadOnly(e){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=e)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){var t,n,r,i;const s=e?"show":"hide";null===(t=this.editRecurrenceButton)||void 0===t||null===(n=t[s])||void 0===n||n.call(t),null===(r=this.recurrenceCombo)||void 0===r||null===(i=r[s])||void 0===i||i.call(r)}onRecurringEventEditorShow({source:e}){var t;if(this.recurrenceCombo&&null!==(t=e.record)&&void 0!==t&&t.startDate&&!e.record.isRecurring&&this.useContextualRecurrenceRules){const t=this,{recurrenceCombo:n}=t,{store:r}=n;r.modelClass.fieldMap.isCustom||r.modelClass.addField({name:"isCustom",defaultValue:!1});const i=e.record.startDate,s=i.getDate(),o=i.getDay(),a=iS.encodeDay(o),l=i.getMonth(),d=Math.ceil(s/7),c=t.L(`L{RecurrenceLegend.position${d}}`),u=[{isCustom:!0,text:t.L("L{RecurrenceLegend.Weekly on {1}}",{days:xi.getDayName(o)}),value:"WEEKLY"},{isCustom:!0,text:t.L("L{RecurrenceLegend.Monthly on {1}}",{days:xi.format(i,"Do")}),value:"MONTHLY"},{isCustom:!0,text:t.L("L{RecurrenceLegend.Monthly on {1}}",{days:`${c} ${xi.getDayName(o)}`}),value:`MONTHLY;BYDAY=${a};BYSETPOS=${d}`},{isCustom:!0,text:t.L("L{RecurrenceLegend.Yearly on {1} of {2}}",{days:xi.format(i,"Do"),months:xi.getMonthName(l)}),value:"YEARLY"},{isCustom:!0,text:t.L("L{RecurrenceLegend.Yearly on {1} of {2}}",{days:`${c} ${xi.getDayName(o)}`,months:xi.getMonthName(l)}),value:`YEARLY;BYDAY=${a};BYMONTH=${l+1};BYSETPOS=${d}`}];t.defaultRules=r.records.slice(),r.add(u),r.filter((e=>e.isCustom||"none"===e.value||"DAILY"===e.value))}}onRecurringEventEditorHide(){if(this.recurrenceCombo){const{store:e}=this.recurrenceCombo;e&&this.defaultRules&&(e.clearFilters(),e.data=this.defaultRules)}}makeRecurrence(e){const t=this.eventRecord,n=t.copy();let r=t.recurrence;return r=!e&&r?r.copy():new t.recurrenceModel(e?{rule:e}:{}),null!=n.timeZone&&(r.timeZone=n.timeZone),r.timeSpan=n,n.setStartDate(this.values.startDate),r.suspendTimeSpanNotifying(),r}onRecurrableEventBeforeSave({eventRecord:e,context:t}){const n=this;n.isEditing&&!e.isCreating&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(n.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0)}changeRecurrenceConfirmation(e,t){if(e)return jC.reconfigure(this.client.recurrenceConfirmationPopup,jC.mergeConfigs({owner:this.editor},e),this)}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$$name||(e._recurrenceEditor=t=oc.create({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,minWidth:"auto",constrainTo:globalThis,anchor:!1,rootElement:e.rootElement,saveHandler:e.recurrenceEditorSaveHandler,thisObj:e,internalListeners:{beforeShow:e.onBeforeShowRecurrenceEditor,thisObj:e},...t}),t.readOnly=e._readOnly),t}onBeforeShowRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:n}=e;t&&null!=n&&n.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this,{editRecurrenceButton:n}=t;t.recurrenceCombo&&!t.processingRecurrenceComboChange&&(t.recurrenceCombo.recurrence=e),n&&(n.recurrence=e,n.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?n.show():n.hide())}onRecurrenceComboChange({source:e,value:t,userAction:n}){if(n){const n=this,{recurrenceEditor:r}=n;t===e.customValue?(n.recurrenceCombo.recurrence=n.makeRecurrence(),r.centered?r.show():r.show((n.editRecurrenceButton||e).element)):(n.processingRecurrenceComboChange=!0,n.loadRecurrenceData(t&&"none"!==t?n.makeRecurrence(`FREQ=${t}`):null),n.processingRecurrenceComboChange=!1)}}recurrenceEditorSaveHandler(e,t){e.recurrenceEditorPanel.syncEventRecord(t);const{store:n}=this.recurrenceCombo;n.clearFilters(),n.remove(n.query((e=>e.isCustom))),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){if(super.onDatesChange(...e),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:e}=this.values;e&&(this.editRecurrenceButton.eventStartDate=e)}}internalLoadRecord(e){null!=e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}updateRecord(e){return e.recurrenceRule&&!this.recurrence&&(e.recurrenceRule=null),super.updateRecord(e)}};class QR extends Dm{static $name="ResourceCombo";static type="resourcecombo";static get configurable(){return{showEventColor:null,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl(e){if(this.owner.showEventColor){const{eventColor:t}=e,n=!Yn.isNamedColor(t);return`<div aria-hidden="true" class="b-icon b-icon-square${!t||n?"":` b-sch-foreground-${t}`}"${t?n?` style="color:${t}"`:"":' style="display:none"'}></div>`}return this.multiSelect?'<div aria-hidden="true" class="b-icon b-icon-square"></div>':""}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){var t;this.element.classList.toggle("b-show-event-color",Boolean(e)),null===(t=this._picker)||void 0===t||t.element.classList.toggle("b-show-event-color",Boolean(e))}changePicker(e,t){var n;return null===(n=e=super.changePicker(e,t))||void 0===n||n.element.classList.toggle("b-show-event-color",Boolean(this.showEventColor)),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e;const t=this,{resourceIcon:n,lastResourceIconCls:r}=t,{classList:i}=n,s=(null===(e=t.selected)||void 0===e?void 0:e.eventColor)??"";super.syncInputFieldValue(),n.style.color="",r&&i.remove(r),t.lastResourceIconCls=null,s?(Yn.isNamedColor(s)?(t.lastResourceIconCls=`b-sch-foreground-${s}`,i.add(t.lastResourceIconCls)):n.style.color=s,i.remove("b-hide-display")):i.add("b-hide-display")}}QR.initClass(),QR._$name="ResourceCombo";const eT=/[^\w\d]/g;class tT extends(oR.mixin(Zx,JR,Hi)){static $name="EventEdit";static configurable={triggerEvent:"eventdblclick",ignoreSelector:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"timefield",clearable:!1,required:!0,ariaLabel:"L{startTime}",name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"timefield",clearable:!1,required:!0,ariaLabel:"L{endTime}",name:"endDate",cls:"b-match-label",weight:600},colorField:{label:"L{SchedulerBase.color}",type:"eventColorField",name:"eventColor",weight:700}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null,minEditSize:100};static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}construct(e,t){this.readOnly=e.readOnly,super.construct(e,t),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get project(){return this.client.project}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e,this._editor&&(this.editor.readOnly=e)}get editor(){var e,t,n,r,i;const s=this,o={beforeHide:"resetEditingContext",beforeShow:"onBeforeEditorShow",keyDown:"onPopupKeyDown",thisObj:s};let{_editor:a}=s;if(a)return a;a=s._editor=oc.create(s.getEditorConfig());const{startDateField:l,startTimeField:d,endDateField:c,endTimeField:u}=a.widgetMap;return!l&&d&&(d.label=s.L("L{Start}"),d.flex="1 0 100%"),!c&&u&&(u.label=s.L("L{End}"),u.flex="1 0 100%"),a.floating||a.positioned||(G.deprecate("scheduler","7.0.0",'"editorConfig" with "appendTo" deprecated in favor of "drawer : true" config'),a.element.parentNode||s.client.add(a),delete o.beforeHide,delete o.beforeShow,o.beforeToggleReveal="onBeforeEditorToggleReveal"),a.readOnly=s.readOnly,0===a.items.length&&console.warn("Event Editor configured without any `items`"),a.ion(o),s.scheduler.relayEvents(a,["beforeSetRecord"],"eventEdit"),Object.values(a.widgetMap).forEach((e=>{const t=e.ref||e.id;if(t&&!s[t])switch(s[t]=e,e.name){case"startDate":case"endDate":e.ion({change:"onDatesChange",thisObj:s})}})),null===(e=s.onEditorConstructed)||void 0===e||e.call(s,a),null===(t=s.eventTypeField)||void 0===t||t.ion({change:"onEventTypeChange",thisObj:s}),null===(n=s.saveButton)||void 0===n||n.ion({click:"onSaveClick",thisObj:s}),null===(r=s.deleteButton)||void 0===r||r.ion({click:"onDeleteClick",thisObj:s}),null===(i=s.cancelButton)||void 0===i||i.ion({click:"onCancelClick",thisObj:s}),a}getEditorConfig(){const e=this,{cls:t,scheduler:n}=e,r=W.assign({owner:n,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${n.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:e.editorConfig.autoUpdateRecord?null:"realign",constrainTo:globalThis,cls:t},e.editorConfig);return oc.prototype.getRenderContext(r)[0]&&(r.floating=!1),!1!==r.floating||r.positioned||(r.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},r.collapsed=!0,r.hidden=r.anchor=!1,r.hide=function(){this.collapsible.toggleReveal(!1)}),!n.showEventColorPickers&&r.items.colorField&&(r.items.colorField.hidden=!0),r.onElementCreated=e.updateCSSVars.bind(this),r}updateCSSVars({element:e}){const t=new Date(2e3,12,31,23,55,55),n=xi.format(t,this.dateFormat).replace(eT,"").length,r=xi.format(t,this.timeFormat).replace(eT,"").length,i=n+r;e.style.setProperty("--date-time-length",`${i}em`),e.style.setProperty("--date-width-difference",(n-r)/2+"em")}async internalShowEditor(e,t,n=null){var r;const i=this,{scheduler:s,editor:o}=i,{useInitialAnimation:a}=s,l=(null===(r=n)||void 0===r||null===(r=r.target)||void 0===r?void 0:r.nodeType)===Element.ELEMENT_NODE?n.target:s.getElementFromEventRecord(e,t),d=e.isPartOfStore(s.eventStore);if((n=n??{target:l,anchor:!0}).target||!d||0===e.resources.length||e.isCreating){var c;s.element.classList.add("b-eventeditor-editing"),i.resourceRecord=t,i.editingContext={eventEdit:i,eventRecord:e,resourceRecord:t,eventElement:l,editor:o,isPartOfStore:d},null===(c=super.internalShowEditor)||void 0===c||c.call(this,e,t,n),i.typeField&&i.toggleEventType(e.getValue(i.typeField)),i.loadRecord(e,t),o.readOnly=i.readOnly||e.readOnly||s.readOnly,o.title=o.readOnly?i.L("L{Object.information}"):o.initialTitle,o.collapsed?(await o.collapsible.toggleReveal(!0),o.focus()):!o.centered&&o.anchor&&o.floating?!l||e.isCreating&&a&&!0!==a&&"fade-in"!==a?(o.show(),o.updateCentered(!0)):(i.targetEventElement=l,o.showBy(n)):o.show();const r=s.timeAxisViewModel.timeResolution;if("hour"===r.unit||"minute"===r.unit){const e=`${r.increment}${r.unit}`;i.startTimeField&&(i.startTimeField.step=e),i.endTimeField&&(i.endTimeField.step=e)}i.detachListeners("changesWhileEditing"),s.eventStore.ion({change:i.onChangeWhileEditing,refresh:i.onChangeWhileEditing,thisObj:i,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;e.editor.autoUpdateRecord||e.isFinalizingEventSave||!e.isEditing||!e.editingContext.isPartOfStore||e.eventRecord.isPartOfStore(e.scheduler.eventStore)||e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",{...this.editingContext})}updateTargetEventElement(e,t){null==e||e.classList.add("b-editing"),null==t||t.classList.remove("b-editing")}editEvent(e,t,n=null,r=null){var i;const s=this,{client:o}=s,{eventStore:a,assignmentStore:l,enableEventAnimations:d}=o,{simpleEventEdit:c}=o.features;e.isModel||(e=a.createRecord(e));const u=!e.isOccurrence&&!a.$master.includes(e);if(u){const n=[];e.isCreating=!0;let r=[];if(t&&!l.includesAssignment(e.id,t.id)&&(n.push(t),r=l.assignEventToResource(e,t)),!1===o.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:n,assignmentRecords:r}))return null==l||l.remove(r),e.isCreating=!1,!1}if(s.isEditing&&s.resetEditingContext(),!(s.disabled||e.isCreating&&null!=c&&c.enabled)){if(!1===o.trigger("beforeEventEdit",{eventEdit:s,eventRecord:e,resourceRecord:t,eventElement:(null===(i=o.getElementFromEventRecord)||void 0===i?void 0:i.call(o,e,t))||n}))return o.element.classList.remove("b-eventeditor-editing"),o.isCalendar&&(e.isCreating=!1),!1;var h;if(r?s.applyStmCapture(r):!1===r||o.isCalendar||s.hasStmCapture||s.captureStm(!0),o.refreshRows)if(u&&(s.enableEventAnimations=!1,a.$master.add(e),o.project.commitAsync().then((()=>o.enableEventAnimations=d)),o.refreshRows()),e.isCreating)null===(h=o.getElementFromEventRecord)||void 0===h||null===(h=h.call(o,e,t,!0))||void 0===h||h.focus({preventScroll:!0});return s.doEditEvent(e,t,n,r).then((e=>{if(!(s.isDestroying||s.isEditing||o.isCalendar||s.rejectingStmTransaction))return!1!==e&&s.hasStmCapture?s.freeStm(!1):s.freeStm()}))}}get isEditing(){const{_editor:e}=this;return Boolean((null==e?void 0:e.isVisible)&&!(e.collapsed&&!e.revealed))}async doEditEvent(e,t,n=null){const r=this,{scheduler:i}=r,s=e.isCreating;if(t||(t=e.resource||r.resourceStore.getById(e.resourceId)),s&&kC.prototype.normalize.call(e),n||s||0===e.resources.length)return r.internalShowEditor(e,t,n?{target:n}:null);{const n=i.isVertical?"maxHeight":"maxWidth";await i.scrollResourceEventIntoView(t,e,{[n]:r.minEditSize,animate:!0,edgeOffset:0,extendTimeAxis:!1}),i.isDestroyed||(await r.internalShowEditor(e,t),i.isDestroyed||i.element.classList.remove("b-eventeditor-editing"))}}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){var e;return null===(e=this._editor)||void 0===e?void 0:e.record}internalLoadRecord(e,t){var n;const r=this,{eventStore:i}=r.client,{editor:s,resourceField:o}=r,{endTimeField:a}=s.widgetMap;if(r.resourceRecord=t,o&&(null===(n=o.store)||void 0===n?void 0:n.masterStore)!==r.resourceStore&&(o.store=s.chainResourceStore()),a&&(a.min=null),s.record=e,o){const n=i.assignmentStore.getResourcesForEvent(e);s.assigningValues=!0,e.isOccurrence||i.storage.includes(e,!0)||!t?r.assignmentStore&&(r.resourceField.value=n.map((e=>e.getValue(r.resourceField.valueField)))):r.resourceField.value=t.getValue(r.resourceField.valueField),s.assigningValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((t=>{var n;(null===(n=t.dataset)||void 0===n?void 0:n.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}async finalizeEventSave(e,t,n,r){const i=this,{scheduler:s,assignmentStore:o}=i;o.suspendAutoCommit(),s.suspendRefresh(),i.onBeforeSave(e),e.beginBatch(),i.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):i.resourceField&&o.assignEventToResource(e,t,null,!0),e.isCreating=!1,await s.project.commitAsync(),o.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),i.onAfterSave(e),n(e)}save(){return new Promise(((e,t)=>{var n;const r=this,{scheduler:i,eventRecord:s}=r;if(!s||!r.editor.isValid)return void e(!1);const{eventStore:o,values:a}=r,l=(null===(n=r.resourceField)||void 0===n?void 0:n.records)||(r.resourceRecord?[r.resourceRecord]:[]);if(o&&i.isDateRangeAvailable){let{startDate:t,endDate:n}=a;n||(n="duration"in a?xi.add(t,a.duration,a.durationUnit||s.durationUnit):"fullDuration"in a?xi.add(t,a.fullDuration):s.endDate);if(!i.isDateRangeAvailable(t,n,s,l)){const{startDateField:t}=this.editor.widgetMap;return t&&(t.setError(r.L("L{EventDrag.eventOverlapsExisting}"),!1,!0),t.focus()),void e(!1)}}const d={finalize(n){try{!1!==n?r.finalizeEventSave(s,l,e,t):e(!1)}catch(e){t(e)}}},c=i.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:a,context:d});function u(t,n,i){!1===t?e(!1):(r.onRecurrableEventBeforeSave({eventRecord:n,context:i}),i.async||i.finalize())}W.isPromise(c)?c.then((e=>u(e,s,d))):u(c,s,d)}))}async deleteEvent(){const{editor:e}=this,{autoClose:t}=e;return this.detachListeners("changesWhileEditing"),await this.scheduler.removeEvents([this.eventRecord],this.client.isScheduler?n=>{n&&e.containsFocus&&(e.autoClose=!1,e.revertFocus(),e.autoClose=t)}:null,e)}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:n,domEvent:r}){var i;const{ignoreSelector:s}=this;s&&null!==(i=r.target)&&void 0!==i&&i.closest(s)||this.editEvent(e,t,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:n,stmCapture:r}){this.editEvent(e,t,n,r)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:n}){const{client:r}=this,i=n[n.matches(r.eventSelector)?"querySelector":"closest"](r.eventInnerSelector);e?this.editEvent(t,e.resource,i):t&&this.editEvent(t,t.resource,i)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:n}){const r=this,i=!(r.readOnly||r.scheduler.readOnly||e.readOnly||r.disabled);n.editEvent={text:"L{EventEdit.Edit event}",localeClass:r,icon:"b-icon b-icon-edit",weight:100,hidden:!i,onItem:()=>r.editEvent(e,t)},n.showDetails={text:"L{Object.showDetails}",localeClass:r,icon:"b-icon b-icon-show-details",weight:100,hidden:i,onItem:()=>r.editEvent(e,t)}}onBeforeEditorToggleReveal({reveal:e}){e&&this.editor.setupEditorButtons(),this[e?"onBeforeEditorShow":"resetEditingContext"]()}async resetEditingContext(){const e=this;e.detachListeners("changesWhileEditing"),super.resetEditingContext(),!e.hasStmCapture||e.isDeletingEvent||e.isCancelingEdit||await e.freeStm(!1),e.resourceRecord=null}finalizeStmCapture(e){return this.freeStm(!e)}updateLocalization(){this._editor&&this.updateCSSVars({element:this._editor.element}),super.updateLocalization(...arguments)}}tT._$name="EventEdit",Jv.registerFeature(tT,!0,"Scheduler"),Jv.registerFeature(tT,!1,["SchedulerPro","ResourceHistogram"]),tT.initClass();class nT extends Mr{static $name="EventFilter";static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const t=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:t.disabled,localeClass:t,weight:100,menu:{localeClass:t,cls:"b-eventfilter-menu",items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:t,width:200,internalListeners:{change:t.onEventFilterChange,thisObj:t}}},onBeforeShow({source:e}){const[n]=e.items,r=t.store.filters.getBy("property","name");n.value=(null==r?void 0:r.value)||""}}}}onEventFilterChange({value:e}){""!==e?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}}nT.featureClass="b-event-filter",nT._$name="EventFilter",Jv.registerFeature(nT,!0,["Scheduler","Gantt"]),Jv.registerFeature(nT,!1,"ResourceHistogram");class rT extends lR{static $name="EventMenu";static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var t;const n=super.getDataFromEvent(e),r=n.targetElement,{client:i}=this,s=i.resolveEventRecord(r),o=s&&(null===(t=i.resolveResourceRecord(r)||this.resourceStore.last)||void 0===t?void 0:t.$original),a=s&&i.resolveAssignmentRecord(r);return Object.assign(n,{date:i.getDateFromXY([e.pageX,e.pageY],null,!1),eventElement:r,eventRecord:s,resourceRecord:o,assignmentRecord:a})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t}={}){this.disabled||(t||(t=this.getElementFromRecord(e)))&&Yn.triggerMouseEvent(t,this.triggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:t,assignmentRecord:n}){const{client:r}=this;e.deleteEvent={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly},e.unassignEvent={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly||r.eventStore.usesSingleAssignment},r.showEventColorPickers||r.showTaskColorPickers?e.eventColor={disabled:t.readOnly,hidden:r.readOnly}:e.eventColor={hidden:!0}}populateItemsWithData({items:e,eventRecord:t}){var n;super.populateItemsWithData(...arguments);const{client:r}=this;(r.showEventColorPickers||r.isSchedulerPro&&r.showTaskColorPickers)&&null!==(n=e.eventColor)&&void 0!==n&&n.menu&&C.merge(e.eventColor.menu.colorMenu,{value:t.eventColor,records:r.selectedRecords??[t]})}changeItems(e){const{client:t}=this;return C.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",cls:"b-separator",weight:500,onItem({menu:e,eventRecord:n}){var r;const i=null===(r=e.focusInEvent)||void 0===r?void 0:r.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),t.removeEvents(t.isEventSelected(n)?t.selectedEvents:[n])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:e,eventRecord:n,resourceRecord:r,assignmentRecord:i}){var s;const o=null===(s=e.focusInEvent)||void 0===s?void 0:s.relatedTarget;o&&(o.focus(),t.navigator.activeItem=o),t.isAssignmentSelected(i)?t.assignmentStore.remove(t.selectedAssignments):n.unassign(r)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},e)}}rT.featureClass="",rT._$name="EventMenu",Jv.registerFeature(rT,!0,"Scheduler"),Jv.registerFeature(rT,!1,"ResourceHistogram");var iT=e=>class extends e{static $name="NonWorkingTimeMixin";static configurable={maxTimeAxisUnit:"week"};getNonWorkingTimeRanges(e,t,n){const r=n.getTime()-t.getTime()+864e5;if(!e.getNonWorkingTimeRanges){const i=[];return e.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0,maxRange:r},((e,t,n)=>{for(const[r,s]of n.intervalGroups)s.getIsWorking()||i.push({name:r.name,iconCls:r.iconCls,cls:r.cls,type:r.type,startDate:e,endDate:t})})),i}return e.getNonWorkingTimeRanges(t,n,r)}getCalendarTimeRanges(e,t=!1){const n=this,{timeAxis:r,fillTicks:i}=n.client,{unit:s,increment:o}=r,a=!n.maxTimeAxisUnit||xi.compareUnits(s,n.maxTimeAxisUnit)<=0;if(e&&a&&r.count){const a=n.getNonWorkingTimeRanges(e,r.startDate,r.endDate).map((e=>new kC({name:"Week"!==e.type?e.name:"",cls:`b-nonworkingtime ${e.cls||""}`,startDate:e.startDate,endDate:e.endDate})));let l=[],d=null;for(const e of a)d&&e.startDate<=d.endDate&&(t||e.name===d.name)&&e.duration>0?d.endDate=e.endDate:(l.push(e),e.setData("id",`nonworking-${l.length}`),d=e);return i&&(l=l.filter((e=>xi.ceil(e.startDate,{magnitude:o,unit:s})<xi.floor(e.endDate,{magnitude:o,unit:s}))),l.forEach((e=>e.setStartEndDate(xi.ceil(e.startDate,{magnitude:o,unit:s}),xi.floor(e.endDate,{magnitude:o,unit:s}))))),l}return[]}setupDefaultCalendar(){const{project:e}=this;this.autoGeneratedWeekends||!e.isSchedulerCoreProjectMixin||e.effectiveCalendar!==e.defaultCalendar||e.defaultCalendar.intervalStore.count||(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const e=this.client.project.effectiveCalendar,t=this.defaultNonWorkingIntervals,n=Boolean(t.length);e.ignoreTimeZone=!0,e.clearIntervals(n),n&&e.addIntervals(t)}}updateLocalization(){var e;null===(e=super.updateLocalization)||void 0===e||e.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return xi.nonWorkingDaysAsArray.map((t=>({recurrentStartDate:`on ${e[t]} at 0:00`,recurrentEndDate:`on ${e[(t+1)%7]} at 0:00`,isWorking:!1})))}};class sT extends(Mr.mixin(ax,iT)){static $name="EventNonWorkingTime";static get pluginConfig(){return{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}}static get properties(){return{calendarRangeCache:new Map}}doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const t=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.client.isScheduler&&t.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,t,n,r){const{client:i}=this,s=i.getVirtualCoordFromDate(xi.max(e.startDate,t))-r,o=e.endDate?i.getVirtualCoordFromDate(xi.min(e.endDate,n))-r:s,a=Math.abs(o-s),l=i.isVertical?"insetBlockStart":"insetInlineStart",d=i.isVertical?"height":"width";return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":i.rtl},dataset:{id:e.id},elementData:{timeRange:e},style:{[l]:s,[d]:a>0?a:null}}}getCalendarTimeRanges(e){let t=this.calendarRangeCache.get(e);return t||(t=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,t)),t}onEventDataGenerated({eventRecord:e,startMS:t,endMS:n,start:r,end:i,left:s,top:o,children:a,bufferBeforeWidth:l}){if(this.enabled){const{isVertical:d}=this.client,c=e.effectiveCalendarsCombination??this.client.project.calendar;let u=d?o:s;l&&(u+=l);for(const e of this.getCalendarTimeRanges(c))if(e.startDateMS<n&&e.endDateMS>t){const t=this.getRangeDomConfig(e,r,i,u);a.push(t)}}}}sT._$name="EventNonWorkingTime",Jv.registerFeature(sT,!1,"Scheduler");const oT=[0,0],aT=[null,[0,10],[10,0]];class lT extends cR{static $name="EventTooltip";static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?N.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,t){super.construct(e,t),"string"==typeof this.align&&(this.align={align:this.align})}resolveData(e,t){const n=this.client,r=super.resolveData(e,t);return r&&{...r,resourceRecord:n.resolveResourceRecord(t),assignmentRecord:n.resolveAssignmentRecord(t)}}onInternalPaint({firstPaint:e}){if(super.onInternalPaint(...arguments),e){const{dependencies:e}=this.client.features;e&&this.tooltip.ion({beforeAlign({source:t,offset:n=oT}){const{edgeAligned:r}=At(t.align.align),i=e.disabled||!e.allowCreate?oT:aT[r];arguments[0].offset=[n[0]+i[0],n[1]+i[1]]}})}}}lT._$name="EventTooltip",Jv.registerFeature(lT,!0,"Scheduler"),Jv.registerFeature(lT,!1,"ResourceHistogram");const dT={update:1,filter:1},cT={add:1,remove:1,update:1,removeAll:1,filter:1};class uT extends Ty{static $name="GroupSummary";static configurable={showTooltip:!0,summaries:null,renderer:null};static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),!n.summaries&&n.renderer&&(n.summaries=[{renderer:n.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:n.onEventStoreChange,thisObj:n}),e.assignmentStore.ion({changePreCommit:n.onAssignmentStoreChange,thisObj:n}),e.ion({timeAxisViewModelUpdate:n.onTimeAxisChange,thisObj:n}),e.project.ion({dataReady:n.onProjectDataReady,thisObj:n}))}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach((e=>{e.isGroupFooter&&e.render()}))}onEventStoreChange({action:e,records:t,changes:n}){if(dT[e]){const e=new Set;t.forEach((t=>t.resources.forEach((t=>e.add(t))))),this.afterChange(e)}}onAssignmentStoreChange({action:e,records:t,changes:n}){if(cT[e]){var r;const e=new Set;if(t.forEach((t=>t.resource&&e.add(t.resource))),null!=(null==n||null===(r=n.resourceId)||void 0===r?void 0:r.oldValue)){const t=this.scheduler.resourceStore.getById(n.resourceId.oldValue);t&&e.add(t)}this.afterChange(e)}}afterChange(e){const{resourceStore:t}=this.scheduler;for(const n of e){let e=n;if("header"===this.target)for(;e&&!e.isGroupHeader;)e=t.getPrev(e);else for(;e&&!e.isGroupFooter;)e=t.getNext(e);const r=this.scheduler.rowManager.getRowFor(e);e&&r&&this.footersToUpdate.add(r)}}onProjectDataReady(){const{footersToUpdate:e,client:t}=this;if(t.isVisible){if(e.size){for(const t of e){var n;null===(n=t.render)||void 0===n||n.call(t)}e.clear()}}else t.whenVisible("refresh",t,[!0])}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,n,r,i,s){if("timeAxis"===e.type){const e=this,{scheduler:n}=e,{eventStore:o}=n,a=n.timeAxisViewModel.columnConfig;let l="";const d=n.getResourcesEventsPerTick(t,(({event:e})=>e.resources.some((e=>t.includes(e)))&&(!o.isFiltered||o.records.includes(e))));return n.timeAxis.forEach(((c,u)=>{const h=d[u]||[],g=e.summaries.map((e=>{var a;return`<div class="b-timeaxis-summary-value">${(null===(a=e.renderer)||void 0===a?void 0:a.call(e,{startDate:c.startDate,endDate:c.endDate,resourceStore:n.resourceStore,events:h,resources:t,eventStore:o,groupRecord:r,groupField:i,groupValue:s}))??""}</div>`})).join("");l+=`<div class="b-timeaxis-tick" style="width: ${a[a.length-1][u].width}px">${g}</div>`})),`<div class="b-timeaxis-group-summary">${l}</div>`}return super.generateHtml(e,t,n)}updateSummaryHtml(e,t,n){const r=super.updateSummaryHtml(e,t,n);if("timeAxis"===t.type){const e={count:0,height:0};return this.summaries.forEach((t=>{t.height?e.height+=t.height:e.count++})),e}return r}getTipHtml({activeTarget:e}){const t=this,{client:n}=t,r=[],i=Array.from(e.parentElement.children).indexOf(e),s=n.timeAxis.getAt(i),o=n.getRecordFromElement(e),a=o.isGroupFooter?o.meta.groupRecord:o,{eventStore:l}=n,d=a.groupChildren,c=n.getResourcesEventsPerTick(d,(({event:e})=>e.resources.some((e=>d.includes(e)))&&(!l.isFiltered||l.includes(e))));let u="",h=!1;return Yn.forEachSelector(e,".b-timeaxis-summary-value",((e,n)=>{const i=t._labels[n],s=e.innerText.trim();r.push({label:i,text:s}),e.innerHTML&&(h=!0)})),u=t.tooltipTemplate({groupSummaryValues:r,startDate:s.startDate,endDate:s.endDate,resourceStore:n.resourceStore,events:c[i]||[],resources:d,eventStore:l,groupRecord:a,groupField:a.meta.groupField,groupValue:a.meta.groupRowFor}),h?u:null}tooltipTemplate({groupSummaryValues:e,startDate:t,endDate:n,events:r,resources:i,eventStore:s,resourceStore:o,groupRecord:a,groupField:l,groupValue:d}){const{client:c}=this;let u=`<header>${this.L("L{Summary.Summary for}",c.getFormattedDate(t))}</header>`;return e.forEach((({label:e="",text:t})=>{u+=`<label>${e}</label><div class="b-timeaxis-summary-value">${t}</div>`})),u}render(){const e=this,{scheduler:t}=e;t.isSchedulerBase&&e.showTooltip&&!e._tip&&(e._tip=new tm({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:e.getTipHtml.bind(e)}))}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");null==t||t.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}updateSummaries(){this._labels=this.summaries.map((e=>e.label||"")),this.isConfiguring||super.updateSummaries(...arguments)}}uT._$name="GroupSummary",Jv.registerFeature(uT,!1,"Scheduler");var hT=e=>class extends(e||Qe){moveThreshold=3;_dragging=!1;static configurable={enableDragSelect:!0};construct(){super.construct(...arguments),this.chain(this.client,"onElementMouseDown","onElementMouseDown"),this.chain(this.client,"onElementMouseMove","onElementMouseMove")}onElementMouseDown(e){const t=this;e.touches||0!==e.button||t.disabled||!t.enableDragSelect||e.target.closest(".b-sch-header-timeaxis-cell")&&(t.startX=e.clientX,Jt.on({element:Yn.getRootElement(e.target),mouseup:"onMouseUp",thisObj:t,once:!0}))}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){if(!t._dragging&&Math.abs(t.startX-e.clientX)>=t.moveThreshold){const e=t.client.subGrids.normal.header.headersElement;t.element=Yn.createElement({parent:e,tag:"div",className:"b-header-drag-selection-rect b-headerzoom-rect"}),t.headerElementRect=Ot.from(e),t._dragging=!0}if(t.isDragging){const n=Math.max(e.clientX,t.headerElementRect.left),r=Math.min(t.startX,n),i=Math.abs(t.startX-n),s=new Ot(r-t.headerElementRect.x+t.client.scrollLeft,0,i,t.headerElementRect.height);Yn.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}}onMouseUp(){const e=this;if(e.startX=null,e.isDragging){var t;const{client:n}=e,r=Ot.from(e.element),i=n.getDateFromCoordinate(r.left,"round",!1),s=n.getDateFromCoordinate(r.right,"round",!1);e.element.remove(),Jt.on({element:Yn.getRootElement(n.element),thisObj:e,click:e=>e.stopPropagation(),capture:!0,expires:50,once:!0}),e._dragging=null,null===(t=e.onTimeSpanDragSelected)||void 0===t||t.call(e,{startDate:i,endDate:s})}}get isDragging(){return this._dragging}};class gT extends(Mr.mixin(hT)){static $name="HeaderZoom";onTimeSpanDragSelected({startDate:e,endDate:t}){this.client.zoomToSpan({startDate:e,endDate:t})}}gT._$name="HeaderZoom",Jv.registerFeature(gT,!1,"Scheduler");const mT=["top","before","after","bottom"],pT=(e,t)=>{switch(e){case"top":return"b-b";case"after":return t.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return t.rtl?"l-l":"r-r";case"left":return"r-r"}},fT={top:1,bottom:1},vT={estimate:1,measure:1},yT={before:1,after:1};class bT extends Mr{static $name="Labels";static configurable={labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7};static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),(n.top||n.bottom||n.before||n.after)&&n.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:n}=this.scheduler.element;n.remove("b-labels-topbottom"),n.remove("b-labels-top"),n.remove("b-labels-bottom"),(e||t)&&(n.add("b-labels-topbottom"),e&&n.add("b-labels-top"),t&&n.add("b-labels-bottom"))}onLabelDblClick(e){var t;const n=this,r=null===(t=e.target)||void 0===t?void 0:t.closest("."+n.labelCls);if(r&&!n.scheduler.readOnly){const{side:t}=r.dataset,i=n[t],{editor:s,field:o}=i;if(s){const a=n.scheduler.resolveEventRecord(e.target);if(a.readOnly)return;return s instanceof sf||(i.editor=new sf({blurAction:n.blurAction,inputField:s,scrollAction:"realign"})),i.editor.render(n.scheduler.element),i.editor.startEdit({target:r,align:pT(t,n.client),matchSize:!1,record:a,field:o}),e.stopImmediatePropagation(),!1}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return null;e=Object.create(e)}const{scheduler:n}=this,{eventStore:r,resourceStore:i,taskStore:s,id:o}=n,{field:a,editor:l}=e;if(fT[t]&&(n.milestoneWidth=null),e.recordType=r&&!s?"event":"task",a){let t;r&&!s&&(t=r.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="event"):Reflect.has(r.modelClass.prototype,a)&&(e.recordType="event")),!t&&s&&(t=s.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="task"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="task")),!t&&i&&(t=i.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="resource"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="resource")),l&&!this.editListenerAdded&&(Jt.on({element:n.timeAxisSubGrid.element,delegate:"."+this.labelCls,dblclick:"onLabelDblClick",thisObj:this}),this.editListenerAdded=!0)}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const t=this,n=[];for(const i of mT)if(t[i]){var r;const{field:s,fieldDef:o,recordType:a,renderer:l,thisObj:d}=t[i],c={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${i}`]:1},dataset:{side:i,taskFeature:`label-${i}`}};let u;const h=`${a}Record`,g=e[h];l?(u=l.call(d||t.thisObj||t,{[h]:g,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c,...t.scheduler.isSchedulerPro?{eventRecord:g}:{}}),"object"==typeof u&&(Object.assign(c,u),u=null)):(u=g.getValue(s),u="date"!==(null==o?void 0:o.type)||l?N.encodeHtml(u):xi.format(u,t.client.displayDateFormat)),null!=u&&!1!==u&&(c.html=u),(null!=c.html||null!==(r=c.children)&&void 0!==r&&r.length||null!=c.text)&&n.push(c)}return n}measureLabels(e,t){const n=this,r=n.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const i of e)if(yT[i.dataset.side]){let{html:e}=i,s=0;if("estimate"===n.labelLayoutMode)e.includes("<")&&(e=Yn.stripTags(e)),s=e.length*n.labelCharWidth+18;else{const e=n.labelMeasureElement||(n.labelMeasureElement=Yn.createElement({className:"b-sch-event-wrap b-measure-label",parent:n.client.foregroundCanvas}));e.retainElement=!0,ud.sync({targetElement:e,domConfig:{onlyChildren:!0,children:[i]}}),s=e.firstElementChild.offsetWidth}const o=s/r;switch(i.dataset.side){case"before":t.startMS-=o;break;case"after":t.endMS+=o}}}onEventDataGenerated(e){var t;if(!(this.disabled||null!==(t=e.eventRecord)&&void 0!==t&&t.isResourceTimeRange)){const t=this.generateLabelConfigs(e);vT[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}}bT.featureClass="b-sch-labels",bT._$name="Labels",Jv.registerFeature(bT,!1,"Scheduler");class CT extends(uR.mixin(ax,iT)){static $name="NonWorkingTime";static get defaultConfig(){return{hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("attachToProject","onConfigChange"),e}doDestroy(){this.attachToCalendar(null),super.doDestroy()}onConfigChange({name:e}){this.isConfiguring||"fillTicks"!==e||this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.graph||this.client.isScheduler||e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const t=this,{project:n,client:r}=t;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>t.setTimeout((()=>t.refresh()),1),thisObj:t})),!r.isEngineReady||r.project.isDelayingCalculation||r.isDestroying?n.isDestroyed||(t.detachListeners("initialProjectListener"),n.ion({name:"initialProjectListener",refresh({isCalculated:e}){!1!==e&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t})):t.refresh()}get calendar(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=xi.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e,t,n){return super.shouldRenderRange(e,t,n)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}}CT._$name="NonWorkingTime",Jv.registerFeature(CT,!1,"Scheduler"),Jv.registerFeature(CT,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class wT extends Mr{static $name="Pan";static configurable={horizontal:!0,vertical:!0,enableInHeader:!0};get targetSelector(){return".b-sch-timeaxis-cell,.b-tasknonworkingtime,.b-sch-resourcetimerange,.b-timeline-subgrid"+(this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":"")}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const t=this,{client:n}=t,{button:r,touches:i,target:s,clientX:o,clientY:a}=e,l=n.features.taskDrag||n.features.eventDrag,d=n.readOnly||!(null!=l&&l.enabled);var c;i||0!==r||t.disabled||!1===n.trigger("beforePan",{event:e})||(s.matches(t.targetSelector)||d&&s.closest(n.eventSelector))&&(t.mouseX=o,t.mouseY=a,t.onHeader=t.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),null===(c=t.mouseDetacher)||void 0===c||c.call(t),t.mouseDetacher=Jt.on({element:Yn.getRootElement(n.element),mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:t}))}onMouseMove(e){const t=this,{client:n}=t,r=n.timeAxisSubGrid.scrollable,i=n.scrollable,s=e.clientX,o=e.clientY;0!==e.buttons?(e.preventDefault(),!t.vertical||!n.isVertical&&t.onHeader||i.scrollBy(0,t.mouseY-o),!t.horizontal||!n.isHorizontal&&t.onHeader||r.scrollBy(t.mouseX-s),n.eventSelectionDisabled||(n.eventSelectionDisabled=!0,t.panControllingEventSelection=!0),t.mouseX=s,t.mouseY=o):t.onMouseUp()}onMouseUp(){var e;const{client:t}=this;null===(e=this.mouseDetacher)||void 0===e||e.call(this),this.mouseDetacher=null,t.setTimeout((()=>{this.panControllingEventSelection&&(t.eventSelectionDisabled=!1,t.panControllingEventSelection=!1)}),50)}get isActive(){return Boolean(this.mouseDetacher)}}wT._$name="Pan",Jv.registerFeature(wT,!1,["Scheduler","Gantt"]);class ST extends ah{static $name="ResourceMenu";static configurable={processItems:null,items:null,type:"resource"};static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateResourceMenu"),e}getDataFromEvent(e){const t=super.getDataFromEvent(...arguments),n=t.cellElement=e.target.closest(".b-resourceheader-cell"),r=null==n?void 0:n.dataset.resourceId;if(r)return t.resourceRecord=this.client.resourceStore.getById(r),t}populateResourceMenu({items:e,resourceRecord:t}){const{client:n}=this;n.readOnly||(e.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:t.readOnly,onItem:()=>n.resourceStore.remove(t)})}get showMenu(){return!0}}ST.featureClass="",ST._$name="ResourceMenu",Jv.registerFeature(ST,!1,["Scheduler"]);class DT extends aR{static $name="ResourceTimeRanges";static configurable={rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"};static get pluginConfig(){return{...super.pluginConfig,assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]}}attachToProject(e){const t=this,{client:n}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=n.resourceTimeRangeStore||new MD({owner:t});const{crudManager:r}=n;r&&!r.resourceTimeRangeStore&&(r.resourceTimeRangeStore=e.resourceTimeRangeStore)}const r=e.resourceTimeRangeStore;t.exposedOnScheduler||(n.resourceTimeRanges&&(r.add(n.resourceTimeRanges),delete n.resourceTimeRanges),Object.defineProperty(n,"resourceTimeRanges",{get:()=>r.records,set:e=>r.data=e}),t.exposedOnScheduler=!0),r.resourceStore||(r.resourceStore=e.resourceStore),t.detachListeners("store"),r.ion({name:"store",change:t.onStoreChange,thisObj:t})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,t){if(!this.disabled){var n;const{timeRanges:r}=e.$original,{startDate:i,endDate:s,visibleDateRange:o}=this.client;null===(n=this.store.lazyLoad)||void 0===n||n.bufferedLazyLoad({startDate:i,endDate:s,resourceRecord:e,visibleStart:o.startDate,visibleEnd:o.endDate}),null!=r&&r.length&&r.forEach((e=>{e.isRecurring?t.push(...e.getOccurrencesForDateRange(i,s)):t.push(e)}))}return t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}renderContent(e,t){const{client:n}=this,{eventContent:r}=t;if(n.resourceTimeRangeRenderer){const i=n.resourceTimeRangeRenderer({resourceTimeRangeRecord:e,resourceRecord:t.resourceRecord,renderData:t});Array.isArray(i)?r.children=i:N.isHtml(i)?(r.children=null,r.html=i):"string"==typeof i||"object"==typeof i?r.children=[i]:null!=i&&(r.text=i)}else super.renderContent(...arguments)}doDestroy(){var e;(null===(e=this.store)||void 0===e?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}}DT.featureClass="",DT._$name="ResourceTimeRanges",Jv.registerFeature(DT,!1,"Scheduler");class ET extends(qx(Uy)){static $name="RowReorder";onDragStart(...e){if(super.onDragStart(...e),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}onDrop(...e){return this.rejectFeatureTransaction(),super.onDrop(...e)}onAbort(...e){return this.rejectFeatureTransaction(),super.onAbort(...e)}}ET._$name="RowReorder",Jv.registerFeature(ET,!1,"Scheduler"),Jv.registerFeature(ET,!0,"Gantt");class xT extends Gy{static $name="RowResize";onResizeStart({context:e}){super.onResizeStart(...arguments);const{client:t}=this,{record:n}=e;var r,i,s;t.isTimelineBase&&(t.suspendAnimations(),null===(r=t.crudManager)||void 0===r||null===(i=r.suspendAutoSync)||void 0===i||i.call(r),t.features.eventDragCreate&&(this._oldDragCreateDisabled=t.features.eventDragCreate.disabled,t.features.eventDragCreate.disabled=!0));t.isSchedulerBase&&("stack"===(null===(s=t.getEventLayout)||void 0===s?void 0:s.call(t,n).type)&&(e.oldEventLayout=n.eventLayout,n.eventLayout="pack",n.rowHeight=e.elementHeight),e.originalBarMargin=t.getBarMargin(n),e.originalResourceMarginObject=t.getResourceMarginObject(n),e.originalRecordResourceMargin=n.resourceMargin)}onResizing({context:e}){const{record:t,newHeight:n,elementHeight:r,originalBarMargin:i,originalResourceMarginObject:s}=e;if(super.onResizing(...arguments),!this.applyToAllRows&&!this.client.fixedRowHeight&&e.valid){if(t.beginBatch(),t.rowHeight=n,n<r){const e=n/r;t.barMargin=i*e,s.start===s.end&&(t.resourceMargin=s.start*e)}t.endBatch()}}onCancel({context:e}){e.record.eventLayout=e.oldEventLayout,e.record.resourceMargin=e.originalRecordResourceMargin,e.record.barMargin=e.originalBarMargin,super.onCancel(...arguments)}cleanup(){const{client:e}=this;var t,n;e.isTimelineBase&&(e.resumeAnimations(),null===(t=e.crudManager)||void 0===t||null===(n=t.resumeAutoSync)||void 0===n||n.call(t),e.features.eventDragCreate&&(e.features.eventDragCreate.disabled=this._oldDragCreateDisabled));super.cleanup()}}xT._$name="RowResize",Jv.registerFeature(xT,!1);class RT extends lR{static $name="ScheduleMenu";static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{targetElement:n,resourceRecord:r}=e,i=t.timeAxisSubGridElement.contains(n);return!n.closest(t.eventSelector)&&i&&!(r&&r.isSpecialRow)}getDataFromEvent(e){if(Yn.isDOMEvent(e)){var t,n;if(e.target.closest(".b-verticaltimeaxis-cell"))return;const{client:r}=this,i=null===(t=r.getCellDataFromEvent)||void 0===t?void 0:t.call(r,e),s=null===(n=r.getDateFromDomEvent)||void 0===n?void 0:n.call(r,e,"floor"),o=r.resolveResourceRecord(e)||r.isVertical&&r.resourceStore.last;return W.assign(super.getDataFromEvent(e),i,{date:s,resourceRecord:o})}return e}populateScheduleMenu({items:e,resourceRecord:t,date:n}){const{client:r}=this;!r.readOnly&&r.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:this.disableAddEvent,weight:100,onItem(){r.createEvent(n,t,r.getRowFor(t))}})}get disableAddEvent(){const{resourceRecord:e,date:t}=this.menuContext;return!e||e.readOnly||!e.isWorkingTime(t)}}RT.featureClass="",RT._$name="ScheduleMenu",Jv.registerFeature(RT,!0,"Scheduler");class TT extends Mr{static $name="ScrollButtons";static configurable={backwardIconCls:"b-icon-before",forwardIconCls:"b-icon-after",labelRenderer:null,scrollOptions:{animate:{duration:600,easing:"easeTo"},y:!1,edgeOffset:50},testConfig:{scrollOptions:{animate:{duration:20,easing:"easeTo"},y:!1,edgeOffset:50}}};static get pluginConfig(){return{chain:["onPaint","onElementClick"]}}doDisable(e){this.client.refresh(),super.doDisable(e)}onPaint({firstPaint:e}){if(e){const{client:e,renderer:t}=this,{timeAxisColumn:n}=e,{defaultRenderer:r}=n;e.timeAxisSubGrid.scrollable.ion({scrollEnd(){e.refreshColumn(n)}}),n.defaultRenderer=(...e)=>(r.apply(n,e),t.apply(this,e))}}renderer({record:e,grid:t}){const{visibleDateRange:n}=t,{labelRenderer:r,forwardIconCls:i,backwardIconCls:s}=this;let o=0,a=0;return e.events.forEach((({isScheduled:e,startDate:t,endDate:r})=>{e&&(r<=n.startDate?a++:t>=n.endDate&&o++)})),{class:"b-scroll-buttons-container",children:[{class:"b-scroll-button-wrap b-scroll-backward "+(a>0?"":"b-scroll-button-hidden"),children:[{tag:"i",class:{"b-icon":1,"b-scroll-button":1,[s]:1}},r&&{tag:"span",class:"b-scroll-button-content",text:r({resourceRecord:e,isBefore:!0,nbrEvents:a})}]},o>0?{class:"b-scroll-button-wrap b-scroll-forward",children:[r&&{tag:"span",class:"b-scroll-button-content",text:r({resourceRecord:e,isBefore:!1,nbrEvents:o})},{tag:"i",class:{"b-icon":1,"b-scroll-button":1,[i]:1}}]}:null]}}onElementClick(e){const{client:t}=this,{target:n}=e,r=n.closest(".b-scroll-button-wrap"),i=r&&t.getRecordFromElement(n);if(r&&!1!==t.trigger("scrollButtonClick",{domEvent:e,resourceRecord:i})){const{visibleDateRange:e}=t;n.closest(".b-scroll-forward")?t.scrollResourceEventIntoView(i,i.getEventStartingAfter(e.endDate),W.assign({block:"end"},this.scrollOptions)):t.scrollResourceEventIntoView(i,i.getEventEndingBefore(e.startDate),W.assign({block:"start"},this.scrollOptions))}}}TT._$name="ScrollButtons",Jv.registerFeature(TT,!1,"Scheduler");class MT extends Mr{static $name="ScheduleTooltip";static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onInternalPaint"]}}onInternalPaint({firstPaint:e}){if(!e)return;const t=this,{client:n}=t;let r;n.isSchedulerPro&&void 0===t.hideForNonWorkingTime&&(t.hideForNonWorkingTime=!0);const i=t.hoverTip=new tm({id:`${n.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:n.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event,.b-dragcreating,.b-creating-dependency) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas,.b-group-footer,.b-group-row) *:not(.b-scroll-button-wrap *,.b-sch-dependency)",getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(e){i.forElement.contains(e.event.target)&&(r=Jt.on({thisObj:t,element:n.timeAxisSubGridElement,mousemove:e=>i.internalOnPointerOver(e),capture:!0}));const s=i.hideAnimation;i.hideAnimation=!1,i.constructor.prototype.onDocumentMouseDown.call(i,e),i.hideAnimation=s},...t.config,internalListeners:t.configuredListeners});i.ion({pointerover({event:e}){const n="buttons"in e?e.buttons>0:e.which>0;if(!n&&r&&r(),t.disabled||n)return i.hide(),!1},innerhtmlupdate({source:e}){t.clockTemplate.updateDateIndicator(e.element,t.lastTime)}}),n.ion({timeAxisViewModelUpdate:"updateTip",thisObj:t}),t.clockTemplate=new Gx({scheduler:n})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const n=this,r=n.client,i=t&&r.getDateFromDomEvent(t,"floor",!0);let s=n.lastHtml;if(i&&t.target){const o=r.resolveResourceRecord(t);if(o&&(i-n.lastTime!=0||o.id!==n.lastResourceId)){if(n.hideForNonWorkingTime){const t=o.isWorkingTime(i);e.element.classList.toggle("b-nonworking-time",!t)}n.lastResourceId=o.id,s=n.lastHtml=n.generateTipContent({date:i,event:t,resourceRecord:o})}}else e.hide(),n.lastTime=null,n.lastResourceId=null;return s}generateTipContent({date:e,event:t,resourceRecord:n}){const r=this,i=r.clockTemplate.generateContent({date:e,text:r.client.getFormattedDate(e)}),s=r.messageTemplate({message:r.getText(e,t,n)||""});return r.lastTime=e,i+s}getText(e,t,n){}}MT.featureClass="b-scheduletip",MT._$name="ScheduleTooltip",Jv.registerFeature(MT,!0,"Scheduler"),Jv.registerFeature(MT,!1,"ResourceUtilization");class kT extends(Mr.mixin(Zx)){static $name="SimpleEventEdit";static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,t){const n=this;n.scheduler=e,e.eventEdit=n,super.construct(e,t),n.clientListenersDetacher=e.ion({[n.triggerEvent]:({eventRecord:e,eventElement:t})=>n.editEvent(e,e.resource,t),dragcreateend:n.onDragCreateEnd,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}get project(){return this.client.project}async editEvent(e,t,n,r){const i=this,{scheduler:s}=i,{eventEdit:o}=i.client.features;if(t||(t=e.resource),n||(n=s.getElementFromEventRecord(e)),s.readOnly||i.disabled||e.readOnly||t.readOnly||o&&!o.disabled&&!e.isCreating)return;let{editor:a}=i;n=Yn.down(n,s.eventInnerSelector)||n,e=e.isAssignment?e.event:e,i.resource=t,i.eventRecord=e,i.element=n,s.element.classList.add("b-eventeditor-editing"),a?a.render(s.timeAxisSubGridElement):(i.editor=a=sf.new({owner:s.timeAxisSubGrid,appendTo:s.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:s.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:i},onInternalKeyDown:e=>e.stopPropagation()},i.editorConfig),a.revertFocus=()=>s.getElementFromEventRecord(i.eventRecord,i.resourceRecord,!0).focus({scrollIntoView:!1}),i.relayEvents(i.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),r?i.applyStmCapture(r):!1===r||i.hasStmCapture||i.captureStm(!0),e.isCreating&&(e.name=""),await a.startEdit({target:n,record:e,field:i.field}),s.isVertical&&e.startDate<s.visibleDateRange.startDate&&a.element.scrollIntoView(),s.navigator.disabled=!0}onEditorComplete(){this.eventRecord.isCreating=!1,this.reset(),this.freeStm(!0)}onEditorCancel(){const{eventRecord:e}=this;this.reset(),this.freeStm(!1),e.isCreating&&e.remove()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.eventRecord=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const n=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),r=(e||t).resource;this.editEvent(t,r,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,eventElement:n,stmCapture:r}){this.element=n,this.editEvent(e,t,n,r)}}kT._$name="SimpleEventEdit",Jv.registerFeature(kT,!1,"Scheduler");const FT=Object.freeze({animate:!1,block:"start"}),IT=Object.freeze({animate:!1,block:"end"});class AT extends Iy{static $name="Split";static configurable={relayProperties:{value:{barMargin:1,eventColor:1,eventStyle:1,eventLayout:1,fillTicks:1,resourceMargin:1,snap:1,tickSize:1},$config:{merge:"merge"}}};static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}getClientConfig(e,t,n,r){var i;const{client:s}=this,o=super.getClientConfig(e,t,n,r);return s.isSchedulerBase||s.isSchedulerProBase||s.isGanttBase?(delete o.store,delete o.events,delete o.resources,delete o.assignments,delete o.dependencies,delete o.resourceTimeRanges,delete o.timeRanges,o.project=s.project,o.assignmentStore=o.project.assignmentStore,o.crudManager=s.crudManager,o.viewPreset=s.viewPreset,o.startDate=s.startDate,o.endDate=s.endDate,o.selectedCollection=s.selectedCollection,o.useInitialAnimation=!1,!1!==(null===(i=o.features)||void 0===i?void 0:i.eventDrag)&&(W.setPath(o,"features.eventDrag.constrainDragToTimeline",!1),s.features.eventDrag.constrainDragToTimeline=!1),o):o}unsplitCleanup(e){this.client.timeAxisSubGrid.onElementResize()}processOptions(e){const{client:t}=this;let{atDate:n,atRecord:r}=e;if("horizontal"!==e.direction&&!e.atColumn&&!e.atRecord&&!n){const r=Ot.from(t.element),i=t.getDateFromCoordinate(r.center.x,"round",!1);i&&(e.atDate=n=i,e.atColumn=t.timeAxisColumn)}return n&&(e.direction||(e.direction=r?"both":"vertical"),e.splitX=t.getVirtualCoordFromDate(n)-t.timeAxisSubGrid.scrollable.x,t.rtl?e.splitX+=t._bodyRectangle.width-Ot.from(t.timeAxisSubGridElement).right+Yn.scrollBarWidth:e.splitX+=Ot.from(t.timeAxisSubGridElement,t.bodyContainer).left,e.remainingWidth=Ot.from(t.element).width-e.splitX),super.processOptions(e)}async split(e={}){const{client:t}=this;if(this.detachListeners("onReconfigure"),t.isVertical)throw new Error("Splitting is not supported in vertical mode");const n=await super.split(e),r=(e,t)=>{e.reconfigure({viewPreset:t.viewPreset,startDate:t.startDate,endDate:t.endDate})};return n&&(e.atDate&&await Promise.all([n[0].scrollToDate(xi.add(e.atDate,-1,t.timeAxis.unit),IT),n[1].scrollToDate(e.atDate,FT)]),t.infiniteScroll&&("horizontal"===e.direction&&r(n[1].timeAxis,n[0].timeAxis),"both"===e.direction&&(r(n[2].timeAxis,n[0].timeAxis),r(n[3].timeAxis,n[1].timeAxis)))),t.timeAxisSubGrid.scrollable.x+=.5,n.forEach((e=>{e.timeAxis.ion({name:"onReconfigure",reconfigure:"onReconfigure",thisObj:this})})),n}populateCellMenu(){}populateScheduleMenu({items:e,date:t,record:n}){const r=this,{isSplit:i}=r,{splitFrom:s}=r.client;!r.disabled&&r.client.isHorizontal&&(e.splitSchedule={text:"L{split}",localeClass:r,icon:"b-icon b-icon-split-vertical",weight:500,separator:!0,hidden:i||s,menu:{splitHorizontally:{text:"L{horizontally}",icon:"b-icon b-icon-split-horizontal",localeClass:r,weight:100,onItem(){r.split({atRecord:n,direction:"horizontal"}).then()}},splitVertically:{text:"L{vertically}",icon:"b-icon b-icon-split-vertical",localeClass:r,weight:200,onItem(){r.split({atDate:t}).then()}},splitBoth:{text:"L{both}",icon:"b-icon b-icon-split-both",localeClass:r,weight:300,onItem(){r.split({atDate:t,atRecord:n,direction:"both"}).then()}}}},e.unsplitSchedule={text:"L{unsplit}",localeClass:r,icon:"b-icon b-icon-clear",hidden:!(i||s),weight:550,onItem(){(s||r).unsplit()}})}onReconfigure({suppressRefresh:e,config:t}){const{client:n}=this;if(t&&!this.isReconfiguring){this.isReconfiguring=!0;const i=n.splitFrom?n.splitFrom:n;var r;if(i.splitDirection&&"vertical"!==i.splitDirection)null===(r=n.syncSplits)||void 0===r||r.call(n,(n=>{var r,s;const{subViews:o}=i,a=o.indexOf(n),l=o.length>2?a+2*(a>1?-1:1):1-a;null===(r=o[a])||void 0===r||r.timeAxis.reconfigure(t,e,!1),null===(s=o[l])||void 0===s||s.timeAxis.reconfigure(t,e,!1)}));this.isReconfiguring=!1}}}AT._$name="Split",Jv.registerFeature(AT,!1,"Scheduler");const LT={width:0,height:0};class PT extends Mr{static $name="StickyEvents";static type="stickyEvents";static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){super.construct(e,t),e.isVertical&&(this.toUpdate=new Set,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=!1===e.eventRecord.stickyContents:(this.syncEventContentPosition(e,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:e}){e===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:t}of this.toUpdate)Yn.applyStyle(e,t);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:t}=e.currentOrientation;for(const e of t.values())for(const{renderData:t,elementConfig:n}of Object.values(e)){const e=[t];n&&t.eventRecord.isResourceTimeRange&&e.push(n.children[0]),this.syncEventContentPosition.apply(this,e)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,t=e.eventContent,n=!1){if(this.disabled||!1===e.eventRecord.stickyContents)return;const{client:r}=this,{eventRecord:i,resourceRecord:s,useEventBuffer:o,bufferAfterWidth:a,bufferBeforeWidth:l,top:d,height:c}=e,u=r.scrollable.y,h=n?null:r.getElementFromEventRecord(i,s,!0),g=h&&ud.getChild(h,"event.content"),m=i.instanceMeta(r),p="string"==typeof t.style?t.style=Yn.parseStyle(t.style):t.style||(t.style={});if(null!=h&&h.classList.contains("b-dragging"))return;let f=d,v=c,y=f+v;if(o&&(f+=l,v=v-l-a,y=f+v),f<u&&y>=u&&!i.isMilestone){const t=null==g?void 0:g.offsetWidth,n="center"===((null==g?void 0:g.parentNode)&&Yn.getStyleValue(g.parentNode,"justifyContent"))?(e.width-t)/2:0,r=f;if((!g||t)&&r<u&&r+v-1>=u){const e=this.getEventContentMargins(g),t=g?v-g.offsetHeight-e.height-n:Number.MAX_SAFE_INTEGER,i=Math.min(u-r,t-2);p.transform=i>0?`translateY(${i}px)`:"",m.stuck=!0}else p.transform="",m.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:p})}else g&&m.stuck&&(p.transform="",m.stuck=!1,this.toUpdate.add({contentEl:g,style:p}))}getEventContentMargins(e){return null!=e&&e.classList.contains("b-sch-event-content")?Yn.getEdgeSize(e,"margin"):LT}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}}PT._$name="StickyEvents",Jv.registerFeature(PT,!0,"Scheduler"),Jv.registerFeature(PT,!1,"ResourceHistogram");class OT extends Ay{static $name="LockRows";onInternalPaint({firstPaint:e}){const t=this,{project:n}=t.client,{resourceStore:r}=n;if(e)if(t.refreshSuspended&&t.client.resumeRefresh(),r.count)t.lockRows();else{const e=n.ion({refresh:()=>{r.count&&(e(),t.lockRows())}})}}getClientConfig(e,t,n,r){const i=this.superGetClientConfig(e,t,n,r);return i.partner=this.client,delete i.crudManager,i}}const $T=OT.prototype,_T=AT.prototype;$T.superGetClientConfig=_T.getClientConfig,OT.configurable.relayProperties=AT.configurable.relayProperties,OT._$name="LockRows",Jv.registerFeature(OT,!1,"Scheduler");class HT extends Qy{static $name="TimelineSummary";static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,t){const n=this;super.construct(e,t),n.summaries||(n.summaries=[{renderer:n.renderer}]),e.isTimelineBase&&(n.updateProject(e.project),e.ion({timeAxisViewModelUpdate:n.renderRows,thisObj:n}))}updateProject(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){var e;this.client.isHorizontal&&(null===(e=this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer"))||void 0===e||e.classList.add("b-sch-summarybar"));super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:t}=e,n=t.isHorizontal?"width":"height",r=t.timeAxisViewModel.columnConfig,i=e.summaryBarElement;i&&(!e._tip&&e.showTooltip&&e.summaries.some((e=>e.label))&&(e._tip=new tm({id:`${t.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),i.innerHTML=r[r.length-1].map((e=>`<div class="b-timeaxis-tick" style="${n}: ${e.width}px"></div>`)).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var t;const{isConfiguring:n}=this.client;super.doDisable(e),null===(t=this.summaryColumn)||void 0===t||t.toggle(!e),n||e||this.render()}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}}HT._$name="TimelineSummary";class VT extends HT{static $name="Summary";static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,t){const n=this;n.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,t.hideFooters=!0,e.add(e.createSubGrid("right")),n.summaryColumn=e.columns.add(W.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:n.disabled},n.verticalSummaryColumnConfig))[0]),super.construct(e,t),e.isSchedulerBase&&(n.updateEventStore(e.eventStore),n.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t}=e,{eventStore:n,timeAxis:r}=t,i=e.summaryBarElement,s=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(i&&t.isEngineReady){const o=t.getResourcesEventsPerTick(s,(({event:e})=>!n.isFiltered||n.records.includes(e)));Array.from(i.children).forEach(((i,s)=>{const a=r.getAt(s),l=o[s]||[];let d="",c=`<header>${e.L("L{Summary for}",t.getFormattedDate(a.startDate))}</header>`;e.summaries.forEach((r=>{const s=r.renderer({startDate:a.startDate,endDate:a.endDate,resourceStore:t.resourceStore,eventStore:n,events:l,element:i}),o=s?`<div class="b-timeaxis-summary-value">${s}</div>`:"";(e.summaries.length>1||s)&&(d+=o),c+=o?`<label>${r.label||""}</label>`+o:""})),i.innerHTML=d,i._tipHtml=d?c:""}))}}updateSummaries(){this.isConfiguring||this.refreshSummaries()}}VT._$name="Summary",Jv.registerFeature(VT,!1,"Scheduler");const NT={maintainVisibleStart:!0};class BT extends Ly{static $name="TimeAxisHeaderMenu";static configurable={menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",align:{monitorResize:!1},scrollAction:null,constrainTo:globalThis}},processItems:null,items:null,type:"timeAxisHeader"};static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t,targetElement:n}=e,{client:r}=this;return r.isHorizontal?!1!==(null==t?void 0:t.enableHeaderContextMenu)&&(null==t?void 0:t.isTimeAxisColumn):n.closest(".b-verticaltimeaxis-cell")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:n}=t,r={magnitude:n.timeAxis.shiftIncrement,unit:n.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!n.presets.count||t.disabled,weight:200,menu:{items:{zoomSlider:{type:"slider",weight:210,minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:e}){const[r]=e.items;r.min=n.minZoomLevel,r.max=n.maxZoomLevel,r.value=n.zoomLevel,t.zoomDetacher=r.ion({change:"onZoomSliderChange",thisObj:t})},onHide(){var e;null===(e=t.zoomDetacher)||void 0===e||e.call(t),t.zoomDetacher=null}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,highlightExternalChange:!1,picker:{internalListeners:{beforeShow:t.updateMinAllowedStartDate,thisObj:t}},internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,highlightExternalChange:!1,picker:{internalListeners:{beforeShow:t.updateMaxAllowedEndDate,thisObj:t}},internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,internalListeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:t.onRightShiftBtnClick,thisObj:t}}},internalListeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){this.client.zoomLevel=e}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}updateMaxAllowedEndDate({source:e}){return e.maxDate=this.client.getAllowedDateRange().endDate,!0}updateMinAllowedStartDate({source:e}){return e.minDate=this.client.getAllowedDateRange().startDate,!0}onRangeDateFieldChange({source:e}){const t=this,n=e===t.startDateField,{client:r}=t,{timeAxis:i}=r,s=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=xi.add(s,i.shiftIncrement,i.shiftUnit)):o=xi.add(o,i.shiftIncrement,i.shiftUnit),r.setTimeSpan(s,o,NT),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=xi.clearTime(new Date);this.client.setTimeSpan(e,xi.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}BT._$name="TimeAxisHeaderMenu",Jv.registerFeature(BT,!0,["Scheduler","TimelineHistogram","Gantt"]);class zT extends(uR.mixin(ax)){static stateProperties=["showCurrentTimeLine"];static $name="TimeRanges";static configurable={currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:{$config:"lazy",value:null}};get timeRanges(){const e=this,{store:t}=e;if(!e._timeRanges){let r=[];var n;if(t)if(r=t.records,null!==(n=t.recurringEvents)&&void 0!==n&&n.size){const{startDate:t,endDate:n}=e.client.timeAxis;r=r.flatMap((e=>e.isRecurring?e.getOccurrencesForDateRange(t,n):e))}e.showCurrentTimeLine&&e.currentTimeLine&&(r=[e.currentTimeLine,...r]),e._timeRanges=r}return e._timeRanges}attachToProject(e){var t;const n=this;var r;(n.attachToTimeRangeStore(e.timeRangeStore),super.attachToProject(e),null===(t=n.projectTimeZoneChangeDetacher)||void 0===t||t.call(n),n.showCurrentTimeLine)&&(n.projectTimeZoneChangeDetacher=null===(r=n.client.project)||void 0===r?void 0:r.ion({timeZoneChange:"updateCurrentTimeLine",thisObj:n}),n.currentTimeLine&&n.updateCurrentTimeLine())}initCurrentTimeLine(){var e,t,n;const r=this;if(r.currentTimeLine||!r.showCurrentTimeLine)return;const i="object"==typeof r.showCurrentTimeLine?r.showCurrentTimeLine:{};r.currentTimeLine=((null===(e=r.store)||void 0===e?void 0:e.modelClass)||kC).new({id:"currentTime",cls:"b-sch-current-time"},i),r.currentTimeInterval=r.setInterval((()=>r.updateCurrentTimeLine()),r.currentTimeLineUpdateInterval),r._timeRanges=null,r.updateCurrentTimeLine(),null===(t=(n=r.client).syncSplits)||void 0===t||t.call(n,(e=>{var t,n;return null===(t=e.features)||void 0===t||null===(t=t.timeRanges)||void 0===t||null===(n=t.initCurrentTimeLine)||void 0===n?void 0:n.call(t)}))}updateCurrentTimeLine(){var e;const t=this,{currentTimeLine:n,client:r}=t;n.timeZone=null===(e=t.project)||void 0===e?void 0:e.timeZone,n.setLocalDate("startDate",new Date),n.endDate=n.startDate,n.originalData.name||(n.name=xi.format(n.startDate,t.currentDateFormat)),t.renderRanges(),r.trigger("currentTimelineUpdate",{date:n.startDate})}hideCurrentTimeLine(){var e,t;const n=this;n.currentTimeLine&&(n.clearInterval(n.currentTimeInterval),n.currentTimeLine=null,n.refresh(),null===(e=(t=n.client).syncSplits)||void 0===e||e.call(t,(e=>{var t,n;return null===(t=e.features)||void 0===t||null===(t=t.timeRanges)||void 0===t||null===(n=t.hideCurrentTimeLine)||void 0===n?void 0:n.call(t)})))}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine(),this.client.trigger("stateChange")}populateTimeAxisHeaderMenu({items:e}){e.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.currentTimeLine,onToggle:({checked:e})=>{this.showCurrentTimeLine?this.updateShowCurrentTimeLine(e):this.showCurrentTimeLine=e}}}attachToStore(e){const t=this;t.storeDetacher&&t.storeDetacher(),t.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:t}),t._timeRanges=null,t.renderRanges()}get store(){var e;return null===(e=this.client.project)||void 0===e?void 0:e.timeRangeStore}attachToTimeRangeStore(e){const{client:t}=this;this.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}resolveTimeRangeRecord(e){const t=e.closest(this.baseSelector).dataset.id;return"currentTime"===t?this.currentTimeLine:this.store.getById(t)}onStoreChange({type:e,action:t}){const n=this;n._timeRanges=null,n.disabled||!n.client.isVisible||n.isConfiguring||"refresh"===e&&"batch"!==t||n.client.runWithTransition((()=>n.renderRanges()),!n.client.refreshSuspended)}onDragStart(e){const t=this,{context:n}=e,r=t.resolveTimeRangeRecord(n.element.closest(t.baseSelector)),i=t.getBodyElementByRecord(r);n.relatedElements=[i],Object.assign(n,{record:r,rangeBodyEl:i,originRangeX:e.source.getX(i),originRangeY:e.source.getY(i)}),n.element.retainElement=!0,i.retainElement=!0,super.onDragStart(e),t.showTip(n)}onDrop(e){const{context:t}=e,{rangeBodyEl:n,element:r}=t;if(r.retainElement=void 0,n.retainElement=void 0,!t.valid)return this.onInvalidDrop({context:t});const i=this,{client:s}=i,{record:o}=t,a=s.isHorizontal?t.newX:t.newY,l=s.getDateFromVirtualCoord({coord:a,roundingMethod:"round"});o.startDate-l!=0?o.setStartDate(l):i.drag.abort(),i.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const t=this,n=t.resolveTimeRangeRecord(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(n);Object.assign(e,{record:n,rangeBodyEl:r}),t.showTip(e),super.onResizeStart(...arguments)}onResizeDrag({source:e,context:t}){const{rangeBodyEl:n}=t,{client:r}=this,{isHorizontal:i}=r,s=i?t.newX:t.newY,o=i?t.newX+t.newWidth:t.newY+t.newHeight,a=r.getDateFromVirtualCoord({coord:s,roundingMethod:"round"}),l=r.getDateFromVirtualCoord({coord:o,roundingMethod:"round"});i?("left"===t.edge&&e.setX(n,t.newX),n.style.width=t.newWidth+"px"):("top"===t.edge&&e.setY(n,t.newY),n.style.height=t.newHeight+"px"),this.updateDateIndicator({startDate:a,endDate:l})}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:n}=t,{record:r}=e,i=n.isHorizontal?e.newX:e.newY,s=n.isHorizontal?e.newX+e.newWidth:e.newY+e.newHeight,o=n.getDateFromVirtualCoord({coord:i,roundingMethod:"round"}),a=n.getDateFromVirtualCoord({coord:s,roundingMethod:"round"}),l="left"===e.edge||"top"===e.edge;(l&&r.startDate-o!=0||a&&r.endDate-a!=0)&&a>o?l?r.setStartDate(o,!1):r.setEndDate(a,!1):t.onInvalidResize({context:e}),t.destroyTip()}onInvalidResize({context:e}){const t=this;t.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=e.element.lastDomConfig=null,t.renderRanges(),t.destroyTip()}get state(){return{showCurrentTimeLine:this.showCurrentTimeLine}}}zT._$name="TimeRanges",Jv.registerFeature(zT,!1,["TimelineBase"]);class jT extends(uR.mixin(hT)){static $name="TimeSelection";static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},enableDragSelect:!1,headerRenderer({timeRange:e}){const{dateFormat:t}=this.client.timeAxisViewModel.bottomHeader;return`<span class="b-selection-start">${xi.format(e.startDate,t)}</span>\n                        <span class="b-selection-end">${xi.format(e.endDate,t)}</span>\n                        <i class='b-icon b-icon-close' data-ref="closeButton" data-btip="L{Popup.close}"></i>`},selectedTimeSpan:{$config:null,value:null,default:null}}}onUIReady(){const e=this;super.onUIReady(),e.hoverTooltip&&(e.hoverTooltip.getHtml=()=>e.tooltipTemplate({...e.selectedTimeSpan})),e.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",timeAxisHeaderClick:"onTimeAxisHeaderClick",thisObj:e})}onTimeAxisHeaderMouseDown({startDate:e,endDate:t}){!this.disabled&&this.enableDragSelect&&(this.selectedTimeSpan=null)}onTimeAxisHeaderClick({startDate:e,endDate:t}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:t})}onTimeRangeClick(e){super.onTimeRangeClick(e);const t=this;!t.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?t.selectedTimeSpan=null:t.client.trigger("timeSelectionElementClick",{...t.selectedTimeSpan,domEvent:e}))}updateFromCoords(e,t,n,r){const{client:i}=this,s=i.isHorizontal?n:r,o=i.isHorizontal?e:t,a=i.getDateFromVirtualCoord({coord:o,roundingMethod:"round"})||i.startDate,l=i.getDateFromVirtualCoord({coord:o+s,roundingMethod:"round"})||i.endDate;this.selectedTimeSpan={startDate:a,endDate:l}}onResizeStart({source:e}){const{timeAxisViewModel:t,timeResolution:n}=this.client,r=xi.asMilliseconds(n.increment,n.unit);this.resize.minWidth=t.getDistanceForDuration(r),super.onResizeStart(...arguments)}onResizeDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.newWidth??e.elementWidth,e.newHeight??e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:t}=e;t.elementWidth=t.element.offsetWidth,t.elementHeight=t.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",{...e??{}})}onTimeSpanDragSelected({startDate:e,endDate:t}){this.selectedTimeSpan={startDate:e,endDate:t}}}jT._$name="TimeSelection",Jv.registerFeature(jT,!1,["TimelineBase"]);class WT extends sf{static $name="TickEditor";static type="tickeditor";static configurable={appendToTargetParent:!0,cls:"b-tick-editor",inputField:{type:"numberfield",autoSelect:!0}};async onEditorKeyDown(e){if("Tab"===e.key||"Enter"===e.key){const t=this,{record:n,owner:r}=t;if(e.preventDefault(),e.stopImmediatePropagation(),"Tab"===e.key){const i=r.getAdjacentDate(n.startDate,!e.shiftKey);i&&(await t.completeEdit(),r.editTickCell({id:n.resourceId},i))}else if("Enter"===e.key){const i=r.getAdjacentResource(n.resourceId,!e.shiftKey);i&&(await t.completeEdit(),r.editTickCell(i,n.startDate))}}else super.onEditorKeyDown(e)}}WT.initClass(),WT._$name="TickEditor";class UT extends aR{static $name="TickCells";static configurable={resourceTickStore:{},entityName:"tickCell",rangeCls:"b-sch-tick-cell",cls:"",resourceTicksData:null,showEditor:!0};changeResourceTickStore(e){return Il.getStore(e,Wx)}updateResourceTickStore(e,t){this.detachStore(t),(e=Il.getStore(e,Wx)).id||(e.id="resourceTicks"),e.storage.addIndex({property:"indexKey"}),this.attachStore(e)}detachStore(e){e&&this.detachListeners(e.$$name)}attachStore(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"internalOnStoreChange",thisObj:this})}updateResourceTicksData(e){this.resourceTickStore.data=e}updateClient(e){e.ion({scheduleDblClick:"onTimeAxisCellDblClick",thisObj:this})}getEventsToRender(e,t){const{client:n}=this,{timeAxis:r}=n;if(!this.disabled){const n=Math.floor(r.getTickFromDate(r.startDate)),i=Math.ceil(r.getTickFromDate(r.endDate));for(let s=n;s<=i;s++){const n=r.getDateFromTick(s),i=this.getResourceTickRecord(e,n);i&&t.push(i)}}return t}shouldInclude({isTickCell:e}){return e}generateElementId(e){return`tick-cell-${e.id}`}getElementFromResourceTimeRangeRecord(e){return this.canvas.syncIdMap[`tick-cell-${e.domId}`]}tickRenderer(e){return e.value}onEventDataGenerated(e){const t=this,{client:n}=t,{eventRecord:r}=e;if(t.shouldInclude(r)){n.isVertical?e.width=n.getResourceWidth(e.resourceRecord):e.top=0,e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls["b-sch-style-none"]=0,e.wrapperCls["b-sch-color-none"]=0,e.cls[t.cls]=1,e.entityName=t.entityName,e.eventId=t.generateElementId(r);const i=t.tickRenderer(r);n.isVertical&&"object"!=typeof i&&(e.eventContent={text:i}),e.children=nt.asArray(i)}}internalOnStoreChange(e){return this.client.refresh(),this.trigger("change",{store:e.source,...e,source:this})}getResourceTickRecord(e,t){return this.resourceTickStore.storage.getBy("indexKey",`${t.getTime()}-${e.id}`)}editTickCell(e,t){const n=this,{client:r}=n;let i=n.getResourceTickRecord(e,t);i||([i]=n.resourceTickStore.add({resourceId:e.id,startDate:t,duration:r.timeAxis.increment,durationUnit:r.timeAxis.unit}));const s=n.getElementFromResourceTimeRangeRecord(i);n.editor=new WT({appendTo:n.canvas,owner:n}),n.editor.startEdit({target:s,record:i,field:"value"})}getNextDate(e){return this.getAdjacentDate(e)}getPrevDate(e){return this.getAdjacentDate(e,!1)}getAdjacentDate(e,t=!0){const{timeAxis:n}=this.client,r=xi.add(e,n.increment*(t?1:-1),n.unit);return r>=n.startDate&&r<n.endDate?r:null}getNextResource(e){return this.getAdjacentResource(e)}getPrevResource(e){return this.getAdjacentResource(e,!1)}getAdjacentResource(e,t=!0){return e=this.client.store.getById(e),this.client.store[t?"getNext":"getPrev"](e)}onTimeAxisCellDblClick({resourceRecord:e,tickStartDate:t}){this.showEditor&&this.editTickCell(e,t)}}UT._$name="TickCells",Jv.registerFeature(UT,!1,["Scheduler","SchedulerPro","Gantt"]);class GT extends UT{static $name="TreeSummary";static configurable={rangeCls:"b-sch-tick-summary-cell",cls:"b-tree-summary-cell",showEditor:!1,renderer:!1,enableMouseEvents:!0};static get pluginConfig(){return{before:["onInternalPaint","internalOnVisibleDateRangeChange"],chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}changeRenderer(e){if(!e)throw new Error("The TreeSummary feature requires defining a `renderer` function");return e}onInternalPaint({firstPaint:e}){super.onInternalPaint(...arguments),e&&this.client.ion({treeGroupChange:()=>this.updateResourceTickCell()})}attachToEventStore(e){e.ion({name:"eventStore",change:"onEventStoreChange",buffer:1,thisObj:this})}attachToResourceStore(e){e.ion({name:"resourceStore",change:"onResourceStoreChange",buffer:1,thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.client.renderRows()}internalOnVisibleDateRangeChange(){this.disabled||this.updateResourceTickCell()}async onEventStoreChange(){await this.client.project.commitAsync(),this.disabled||this.updateResourceTickCell()}async onResourceStoreChange({action:e,records:t}){if(await this.client.project.commitAsync(),!this.disabled)if("remove"===e||void 0===e)this.updateResourceTickCell();else{const e=new Set;t.forEach((t=>{t.bubble((n=>(e.add(n),!t.isParent)))})),this.updateResourceTickCell(e,!1)}}updateDisabled(e){this.isConfiguring||(e?this.resourceTickStore.removeAll():this.updateResourceTickCell())}updateResourceTickCell(e=null,t=!0){const n=this,{client:r,resourceTickStore:i}=n,{timeAxis:s,visibleDateRange:o}=r;if(!n.disabled){const a=Math.floor(s.getTickFromDate(o.startDate)),l=Math.ceil(s.getTickFromDate(o.endDate)),d=[];if((e&&0!==e.size?e:r.store.storage.allValues).forEach((e=>{if(null!=e&&e.isParent)for(let t=a;t<l;t++){const i=s.getDateFromTick(t),o=s.getDateFromTick(t+1),a=n.renderer({startDate:i,endDate:o,resourceRecord:e,eventStore:r.eventStore,resourceStore:r.resourceStore,timeline:r});(a||0===a)&&d.push({id:`${t}-${e.id}`,startDate:i,endDate:o,value:a,resourceId:e.id})}})),t)n.resourceTicksData=d;else{const{allValues:t}=i.storage,n=[];for(const r of e)for(const e of t)e.resourceId===r.id&&n.push(e);r.suspendRefresh(),i.remove(n),i.add(d),r.resumeRefresh(!1),r.refresh()}}}}GT._$name="TreeSummary",Jv.registerFeature(GT,!1,["Scheduler","SchedulerPro","Gantt"]);const YT={completeview:"completeview",currentview:"currentview",daterange:"daterange"};var qT=e=>class extends e{cloneElement(e,t,n){super.cloneElement(e,t,n);const r=this.element.querySelector(".b-schedulerbase");null==r||r.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map((e=>`b-initial-${e}`)))}async prepareComponent(e){const t=this,{client:n}=e,{isVertical:r}=n,i=n.timeAxisSubGrid.width>0;switch(e.scheduleRange){case YT.completeview:e.rangeStart=n.startDate,e.rangeEnd=n.endDate;break;case YT.currentview:{const{startDate:t,endDate:r}=n.visibleDateRange;e.rangeStart=t,e.rangeEnd=r;break}}await n.waitForAnimations(),e.infiniteScroll=n.infiniteScroll,n.infiniteScroll=!1,i&&(e.scheduleRange!==YT.currentview&&n.setTimeSpan(e.rangeStart,e.rangeEnd),e.scheduleRange===YT.daterange&&(e.rangeStart=n.startDate,e.rangeEnd=n.endDate),n.svgCanvas),t._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,await super.prepareComponent(e);const{exportMeta:s,element:o}=t,a=o.querySelector(".b-sch-foreground-canvas"),l=o.querySelector(".b-resource-time-range-canvas"),d=o.querySelector(`.b-${r?"vertical":"horizontal"}timeaxis`),c=s.subGrids.normal;if(Yn.forEachSelector(o,".b-sch-canvas",(e=>{let t="";for(const n of e.classList.values())t+=`.${n}`;const r=n.element.querySelector(t);r&&r.clientWidth&&(e.style.width=`${r.clientWidth}px`)})),s.includeTimeline=i,s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersCollected=!1,s.eventsBoxes=new Map,s.resourceTimeRangesMap=new Map,s.eventsMap=new Map,s.verticalTimeAxisMargin=0,s.isHorizontal=!r,s.client=n,i)if(e.scheduleRange!==YT.completeview)if(r)s.totalHeight=n.headerHeight+n.getTimeSpanDistance(e.rangeStart,e.rangeEnd)+n.footerHeight,s.verticalTimeAxisMargin=-1*n.getCoordinateFromDate(e.rangeStart);else{if(s.totalWidth-=c.width,s.totalWidth+=c.width=n.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd),t.isMultiPageExporter){const e=Math.ceil(s.totalWidth/s.pageWidth),t=e*s.verticalPages;s.horizontalPages=e,s.totalPages=t}c.scrollLeft=n.getCoordinateFromDate(e.rangeStart)}else r&&(s.totalHeight=n.headerHeight+n.timeAxisViewModel.totalSize+n.footerHeight);if(!i)return;Yn.forEachSelector(d,".b-sch-header-row",(e=>{s.timeAxisPlaceholders.push(t.createPlaceholder(e)),s.timeAxisHeaders.push(new Map)})),s.eventsPlaceholder=t.createPlaceholder(a,!1),Yn.removeEachSelector(a,".b-sch-event-wrap"),Yn.removeEachSelector(t.element,".b-released"),l&&(s.resourceTimeRangesPlaceholder=t.createPlaceholder(l,!1),Yn.removeEachSelector(l,".b-sch-resourcetimerange"));const u=o.querySelector(".b-column-lines-canvas"),h=o.querySelector(".b-timeranges-header-canvas"),g=o.querySelector(".b-timeranges-body-canvas");if(n.hasActiveFeature("columnLines")&&u&&(s.columnLinesPlaceholder=t.createPlaceholder(u),s.columnLines=""),g&&Object.values(n.features).some((e=>e instanceof uR))&&(s.timeRanges={},h&&(s.timeRanges.header="",s.timeRangesHeaderPlaceholder=t.createPlaceholder(h)),s.timeRanges.body="",s.timeRangesBodyPlaceholder=t.createPlaceholder(g)),n.hasActiveFeature("dependencies")){n.features.dependencies.fillDrawingCache();const e=o.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);e&&(s.dependenciesPlaceholder=t.createPlaceholder(e,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),Yn.removeEachSelector(e,".b-sch-dependency"))}}async restoreComponent(e){const{client:t}=e;t.infiniteScroll=e.infiniteScroll,t.enableEventAnimations=this._oldEnableEventAnimations,await super.restoreComponent(e)}async onRowsCollected(e,t){const n=this;if(await super.onRowsCollected(e,t),n.exportMeta.includeTimeline){const{pageRangeStart:r,pageRangeEnd:i}=n.getCurrentPageDateRange(t);r&&i&&(n.renderTimeAxisHeaders(t,r,i),n.renderResourceHeaders(t),n.renderLines(t,r,i),n.renderRanges(t,r,i),n.renderEvents(t,e,r,i))}}async stateNextPage(e){var t,n;await(null===(t=super.stateNextPage)||void 0===t?void 0:t.call(this,e));const r=this;r.exportMeta.eventsBoxes.clear(),r.exportMeta.eventsMap.clear(),null===(n=r.exportMeta.rowsMap)||void 0===n||n.clear(),r.exportMeta.resourceTimeRangesMap.clear(),r.exportMeta.timeAxisHeaders.forEach((e=>e.clear())),r.exportMeta.columnLines="",r.exportMeta.timeRanges={}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,client:n}){const{exportMeta:r}=this,{horizontalPages:i,horizontalPosition:s,pageWidth:o,subGrids:a}=r;let l,d;if(i>1){const e=s*o,r=(s+1)*o,i=a.locked.width+a.locked.splitterWidth;if(r<=i)d=l=null;else{const{scrollLeft:s=0}=a.normal;l=n.getDateFromCoordinate(Math.max(e-i+s,0)),d=n.getDateFromCoordinate(r-i+s)||t}}else l=e,d=t;return{pageRangeStart:l,pageRangeEnd:d}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:n,headerId:r,footerId:i,scrollLeft:s}=t.subGrids.normal;return e.querySelector(`[id="${n}"]`).querySelectorAll(".b-sch-canvas").forEach((e=>{e.style.height="",s&&(e.style.marginInlineStart=`-${s}px`)})),s&&[r,i].forEach((t=>{const n=e.querySelector(`[id="${t}"] .b-widget-scroller`);n&&(n.style.marginInlineStart=`-${s}px`)})),super.prepareExportElement()}renderTimeAxisHeaders(e,t,n){const{exportMeta:r}=this,{client:i}=e,{isHorizontal:s,timeAxisHeaders:o}=r,a=(s?i.timeAxisColumn.timeAxisView:i.verticalTimeAxisColumn.view).buildCells(t,n),l=document.createElement("div");ud.sync({targetElement:l,domConfig:a}),Yn.forEachSelector(l,".b-sch-header-row",((e,t)=>{const n=o[t];Yn.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{n.has(e.dataset.tickIndex)||n.set(e.dataset.tickIndex,e.outerHTML)}))}))}renderResourceHeaders(e){const{client:t}=e;if(t.isHorizontal)return;const{exportMeta:n}=this,r=t.timeAxisColumn.resourceColumns.renderResourceHeaders(0,t.resourceStore.allResourceRecords.length-1),i=document.createElement("div");ud.sync({targetElement:i,domConfig:{onlyChildren:!0,children:r}}),n.resourceHeaders=i.innerHTML}renderEvents(e,t,n,r){const{client:i}=e,{isHorizontal:s,eventsMap:o,eventsBoxes:a,resourceTimeRangesMap:l}=this.exportMeta,d=Yn.createElement({parent:document.body,style:"visibility:hidden;",children:[{tag:"div"}]}),c=d.firstChild;if(s)for(const e of t){const t=i.store.getAt(e.dataIndex),s=i.currentOrientation.getResourceLayout(t),d=i.getCoordinateFromDate(n),u=i.getCoordinateFromDate(r),h=i.currentOrientation.getEventDOMConfigForCurrentView(s,e,i.rtl?u:d,i.rtl?d:u);for(const e of h){const{eventId:t}=e.dataset,{insetInlineStart:n,insetBlockStart:r,width:s,height:d}=e.style;ud.sync({targetElement:c,domConfig:e,callback:({action:e,domConfig:t,lastDomConfig:n,targetElement:r,jsx:s})=>vx(i,!1,{action:e,domConfig:t,lastDomConfig:n,targetElement:r,jsx:s})});const u=String(t);"resourceTimeRange"===e.elementData.entityName?l.set(u,c.outerHTML):(a.set(u,new Ot(n,r,s,d)),o.set(u,c.outerHTML))}}else i.resources.forEach((e=>{const t=i.vertical.renderResource(e,n,r);for(const e of t){const{eventId:t}=e.dataset,{left:n,width:r,height:s,fontSize:d}=e.style,u=e.style.top;ud.sync({targetElement:c,domConfig:e,callback:({action:e,domConfig:t,lastDomConfig:n,targetElement:r,jsx:s})=>Ex(i,!1,{action:e,domConfig:t,lastDomConfig:n,targetElement:r,jsx:s})}),"resourceTimeRange"===e.elementData.renderData.entityName?l.set(String(t),c.outerHTML):(o.set(t,c.outerHTML),a.set(String(t),new Ot(n,u,r,"string"==typeof s?d:s)))}}));d.remove()}renderLines(e,t,n){const{client:r}=e,{exportMeta:i}=this,{columnLinesPlaceholder:s}=i;if(s){const e=r.features.columnLines.getColumnLinesDOMConfig(t,n,0,r.resourceStore.allResourceRecords.length-1),s=document.createElement("div");ud.sync({targetElement:s,domConfig:{onlyChildren:!0,children:e}}),i.columnLines=s.innerHTML}}renderRanges(e,t,n){const{client:r}=e,{exportMeta:i}=this,{timeRanges:s}=i;if(s){s.body=s.header="";for(const e of Object.values(r.features).filter((e=>e instanceof uR))){const r=e.getDOMConfig(t,n),i=document.createElement("div");r.forEach(((e,t)=>{ud.sync({targetElement:i,domConfig:{children:e,onlyChildren:!0}}),0===t?s.body+=i.innerHTML:s.header+=i.innerHTML}))}}}buildPageHtml(){const e=this,{subGrids:t,timeAxisHeaders:n,timeAxisPlaceholders:r,eventsMap:i,eventsPlaceholder:s,resourceTimeRangesMap:o,resourceHeaders:a,resourceHeaderPlaceholder:l,columnLines:d,columnLinesPlaceholder:c,timeRanges:u,timeRangesHeaderPlaceholder:h,timeRangesBodyPlaceholder:g,resourceTimeRangesPlaceholder:m,isHorizontal:p}=e.exportMeta;let f=e.prepareExportElement();return p&&Object.values(t).forEach((({placeHolder:e,rows:t,mergedCellsHtml:n})=>{const r=e.outerHTML;let i=t.join("");null!=n&&n.length&&(i+=`<div class="b-grid-merged-cells-container">${n.join("")}</div>`),f=f.replace(r,i)})),s&&(f=f.replace(s.outerHTML,Array.from(i.values()).join(""))),m&&(f=f.replace(m.outerHTML,Array.from(o.values()).join(""))),l&&(f=f.replace(l.outerHTML,a)),n.forEach(((e,t)=>{f=f.replace(r[t].outerHTML,Array.from(e.values()).join(""))})),d&&(f=f.replace(c.outerHTML,d)),u&&g&&(f=f.replace(g.outerHTML,u.body),h&&(f=f.replace(h.outerHTML,u.header))),f=e.buildDependenciesHtml(f),f}getEventBox(e,t){const{client:n,eventsBoxes:r,currentPageFirstRowIndex:i,exactGridHeight:s,totalHeight:o}=this.exportMeta,{resourceColumnWidth:a,rowHeight:l,isHorizontal:d,resourceStore:c}=n;let u=e&&r.get(String(e.id));if(u&&e.isMilestone&&u.translate(-u.width/2,0),!u){const t=e.assignments.reduce(((e,{resource:t})=>e=null===e?c.indexOf(t):Math.max(e,c.indexOf(t))),null);u=d?new Ot(0,t<i?2*-l:s+l,10,l):new Ot(t*a,o+l,a,l)}return u}renderDependencies(){const e=this,{client:t,eventsBoxes:n}=e.exportMeta,{dependencies:r}=t,i=t.features.dependencies,s=Yn.createElement();let o=!1;return r.forEach((t=>{var r,s;if(!n.has(String(null===(r=t.fromEvent)||void 0===r?void 0:r.id))&&!n.has(String(null===(s=t.toEvent)||void 0===s?void 0:s.id))||!i.isDependencyVisible(t))return;const a=e.getEventBox(t.fromEvent,t),l=e.getEventBox(t.toEvent,t);i.drawDependency(t,!0,{from:null==a?void 0:a.clone(),to:null==l?void 0:l.clone()}),o=!0})),o&&i.domSync(s,!0),s.innerHTML}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:n}=this.exportMeta;if(t&&n){const n=t.outerHTML;e=e.replace(n,this.renderDependencies())}return e}};class KT extends(qT(vb)){static isHorizontal=!0;static $name="MultiPageExporter";static type="multipage";async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}}KT._$name="MultiPageExporter";class XT extends(qT(yb)){static isHorizontal=!0;static $name="MultiPageVerticalExporter";static type="multipagevertical";async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==YT.completeview&&this.estimateTotalPages(e)}}XT._$name="MultiPageVerticalExporter";class ZT extends Dm{static $name="ScheduleRangeCombo";static type="schedulerangecombo";static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems:()=>Object.entries(YT).map((([e,t])=>({value:e,text:"L{"+t+"}"})))}}}ZT.initClass(),ZT._$name="ScheduleRangeCombo";class JT extends mb{static $name="SchedulerExportDialog";static type="schedulerexportdialog";static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",name:"scheduleRange",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==YT.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",name:"rangeStart",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=e?xi.add(e,1,"d"):null}},rangeEndField:{type:"datefield",label:"L{Export to}",name:"rangeEnd",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=e?xi.add(e,-1,"d"):null}}}}}}}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.items.forEach((t=>{t instanceof cm?t.labelWidth=e:"rangesContainer"===t.ref&&(t.items[0].width=e)}))}applyInitialValues(e){super.applyInitialValues(e);const{client:t,scheduleRange:n}=e,r=e.items=e.items||{},i=r.scheduleRangeField=r.scheduleRangeField||{},s=r.rangesContainer=r.rangesContainer||{},o=s.items=s.items||{},a=o.filler=o.filler||{},l=o.rangeStartField=o.rangeStartField||{},d=o.rangeEndField=o.rangeEndField||{};a.width=this.L("L{labelWidth}"),i.value=i.value||n,i.value===YT.daterange&&(s.hidden=!1);const c=l.value=l.value||t.startDate;l.max=xi.max(t.startDate,xi.add(t.endDate,-1,"d"));let u=d.value||t.endDate;u<=c&&(u=xi.add(c,1,"d")),d.value=u,d.min=xi.min(t.endDate,xi.add(t.startDate,1,"d"))}}JT._$name="SchedulerExportDialog";class QT extends(qT(bb)){static isHorizontal=!0;static $name="SinglePageExporter";static type="singlepage"}QT._$name="SinglePageExporter";class eM extends pb{static isHorizontal=!1;cloneElement(e,t=this.element,n=!0){super.cloneElement(e,t,n)}async prepareComponent(e){await super.prepareComponent(e);const{exportMeta:t,element:n}=this,{resourceColumns:r}=e.client.timeAxisColumn;t.resourceHeaderPlaceholder=this.createPlaceholder(n.querySelector(`#${r.id}`)),t.resourceHeaders=""}async onRowsCollected(){}}eM._$name="VerticalExporter";class tM extends(qT(eM)){static $name="SinglePageExporterVertical";static type="verticalsinglepage";static get title(){return this.localize("L{SinglePageExporter.singlepage}")}static configurable={centerContentHorizontally:!1};async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async renderPage(e){const{totalHeight:t}=this.exportMeta;return await this.onRowsCollected([],e),this.exportMeta.exactGridHeight=t,t}buildPageHtml(e){const{subGrids:t}=this.exportMeta;let n=super.buildPageHtml(e);return Object.values(t).forEach((({placeHolder:e})=>{const t=e.outerHTML;n=n.replace(t,"")})),n}}tM.prototype.pagesExtractor=async function*(e){const t=this,{client:n}=e,{totalWidth:r,verticalTimeAxisMargin:i}=t.exportMeta,s=t.stylesheets,o=e.orientation===ob.portrait,a=ib[e.paperFormat],l=t.getPaperWidth(a,o),d=t.getPaperHeight(a,o);let c,u,h;if(c=await t.renderPage(e),e.headerTpl){u=t.prepareHTML(e.headerTpl({totalWidth:r}));c+=t.measureElement(u,"b-export-header")}if(e.footerTpl){h=t.prepareHTML(e.footerTpl({totalWidth:r}));c+=t.measureElement(h,"b-export-footer")}const g=t.buildPageHtml(e),m=c,p=Math.min(1,t.getScaleValue(t.inchToPx(l),r)),f=Math.min(1,t.getScaleValue(t.inchToPx(d),c)),v=Math.min(p,f);s.push(`<style>\n                #${n.id} {\n                    height: ${m}px !important;\n                    width: ${r}px !important;\n                }\n                .b-verticaltimeaxiscolumn {\n                    margin-top: ${i}px;\n                }\n                .b-page-wrap {\n                    width: ${l}in;\n                    height: ${d}in;\n                    ${t.centerContentHorizontally?"display: flex; justify-content: center":""}\n                }\n                .b-print .b-export-content {\n                    scale: ${v};\n                    transform-origin: top left;\n                    height: calc(100% / ${v});\n                    width: calc(100% / ${v});\n                }\n            </style>`),yield{html:t.pageTpl({html:g,header:u,footer:h,styles:s,paperWidth:l,paperHeight:d,currentPage:0})}},tM._$name="SinglePageExporterVertical";class nM extends(qT(eM)){static $name="MultiPageVerticalExporterVertical";static type="verticalmultipagevertical";static get title(){return this.localize("L{MultiPageVerticalExporter.multipagevertical}")}calculateScale(){const{exportMeta:e}=this;return e.scale=this.getScaleValue(e.pageWidth,e.totalWidth)}estimateTotalPages(e){var t;const n=this,{exportMeta:r}=n,{client:i,headerTpl:s,footerTpl:o,repeatHeader:a,rangeStart:l,rangeEnd:d}=e,{pageHeight:c}=r,{timeAxisViewModel:u}=i,h=u.getDistanceBetweenDates(l,d),g=(d-l)/h,m=r.totalWidth=i.timeAxisColumn.resourceColumns.totalWidth+i.subGrids.locked.width+(null===(t=i.subGrids.locked.splitterElement)||void 0===t?void 0:t.offsetWidth)||0,p=n.calculateScale();let f=r.totalHeight=h+i.headerHeight+i.footerHeight,v=c/p;s&&(v-=n.measureElement(s({totalWidth:m,totalPages:-1,currentPage:-1}),"b-export-header")),o&&(v-=n.measureElement(o({totalWidth:m,totalPages:-1,currentPage:-1}),"b-export-footer")),a&&(f-=i.headerHeight);let y=Math.ceil(f/v);a&&(f+=i.headerHeight*y,y=Math.ceil(f/v)),Object.assign(r,{scale:p,contentHeight:v,totalWidth:m,totalHeight:f,verticalPages:y,msPerPixel:g,initialScroll:0,horizontalPages:1,totalPages:y,currentPage:0,firstTickTop:0})}async stateNextPage(e){++this.exportMeta.currentPage,++this.exportMeta.verticalPosition,await super.stateNextPage(e)}async prepareComponent(e){await super.prepareComponent(e),this.estimateTotalPages(e),this.exportMeta.pageRangeStart=e.rangeStart,this.exportMeta.exactGridHeight=this.exportMeta.totalHeight}async renderRows(e){const{exportMeta:t}=this,{client:n}=e,{rangeEnd:r,repeatHeader:i}=e,{currentPage:s,contentHeight:o,msPerPixel:a,pageRangeStart:l}=t;let d=o;(0===s||i)&&(d-=n.headerHeight);const c=d*a;if(t.firstTickTop=n.timeAxisViewModel.getPositionFromDate(l),t.pageRangeEnd=xi.min(new Date(l.getTime()+c),r),await this.onRowsCollected([],e),t.pageRangeEnd.getTime()<r.getTime()){const e=Math.floor(n.timeAxis.getTickFromDate(t.pageRangeEnd,!0));t.pageRangeStart=n.timeAxis.getAt(e).startDate}}getCurrentPageDateRange(){return{pageRangeStart:this.exportMeta.pageRangeStart,pageRangeEnd:this.exportMeta.pageRangeEnd}}async buildPage(e){const t=this,{exportMeta:n}=t,{headerTpl:r,footerTpl:i}=e,{totalWidth:s,totalPages:o,currentPage:a,subGrids:l}=n;let d,c;Object.values(l).forEach((e=>e.rows=[])),r&&(d=t.prepareHTML(r({totalWidth:s,totalPages:o,currentPage:a}))),i&&(c=t.prepareHTML(i({totalWidth:s,totalPages:o,currentPage:a}))),await t.renderRows(e);return{html:t.buildPageHtml(e),header:d,footer:c}}}nM.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalPages:i,totalWidth:s,paperWidth:o,paperHeight:a,realPaperWidth:l,realPaperHeight:d,title:c}=n;let u,h;for(;(u=n.currentPage)<i;){t.trigger("exportStep",{text:XT.L(XT.exportingPageText,{currentPage:u,totalPages:i}),progress:Math.round((u+1)/i*90)});const{html:g,header:m,footer:p}=await t.buildPage(e),{scale:f,firstTickTop:v}=t.exportMeta;h=`\n            .b-page-${u} .b-grid-vertical-scroller {\n                margin-top: -${v}px\n            }\n            .b-page-${u} #${e.client.id} {\n                height: ${n.exactGridHeight}px !important;\n                width: ${s}px !important;\n            }\n            .b-page-wrap {\n                width: ${l}in;\n                height: ${d}in;\n            }\n            .b-print .b-export-viewport {\n                scale: ${f};\n                transform-origin: top left;\n                height: calc(100% / ${f});\n                width: calc(100% / ${f});\n            }\n        `,h=e.repeatHeader?`\n                ${h}\n                .b-export-body {\n                    height: 100%;\n                    display: flex;\n                }\n                .b-export-viewport {\n                    height: 100%;\n                }\n            `:`\n                ${h}\n                ${0===u?"":`.b-page-${u} .b-grid-header-container {\n                    display: none;\n                }`}\n                .b-export-body {\n                    overflow: hidden;\n                }\n            `;const y=[...r,`<style>${h}</style>`];await t.stateNextPage(e),yield{html:t.pageTpl({html:g,title:c,header:m,footer:p,styles:y,paperWidth:o,paperHeight:a,realPaperWidth:l,realPaperHeight:d,currentPage:u})}}},nM._$name="MultiPageVerticalExporterVertical";class rM extends Cb{static $name="PdfExport";static get defaultConfig(){return{exporters:[QT,KT,XT,tM,nM],dialogClass:JT,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){const e=W.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"]),{isHorizontal:t}=this.client;return t||(e.items.exporterTypeField.value="verticalsinglepage"),W.merge(e,{items:{columnsField:{hidden:!t},rowsRangeField:{hidden:!t},alignRowsField:{hidden:!t}}}),e.exporters=e.exporters.filter((e=>e.isHorizontal===t)),e}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:n,rangeEnd:r}=this;return e.columns&&!e.columns.find((e=>"timeAxis"===e.type))&&e.columns.push(e.client.timeAxisColumn.id),W.assign({scheduleRange:t,rangeStart:n,rangeEnd:r},e)}}rM._$name="PdfExport",Jv.registerFeature(rM,!1,"Scheduler");class iM extends(wb(rM)){static $name="Print"}iM._$name="Print",Jv.registerFeature(iM,!1,"Scheduler");class sM extends(Tr(Db)){static configurable={includeUnassigned:!0,includeEventsOutsideTimeAxis:null,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140,type:"date"},{text:"Ends",field:"endDate",width:140,type:"date"}],resourceColumns:null,eventSortFn:null};construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(e,t)=>e.internalId-t.internalId)}normalizeColumns(e){e.columns=e.resourceColumns||e.columns,super.normalizeColumns(e),e.columns=e.columns.filter((e=>!e.isVerticalTimeAxisColumn)),e.eventColumns=e.eventColumns.map((e=>"string"==typeof e?{field:e}:e))}generateExportData(e){const t=this,n=t.generateResourceColumns(e),r=t.target.eventStore?t.generateEventColumns(e):[];return{columns:n.concat(r),rows:t.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map((t=>this.processEventColumn(t,e)))}generateResourceColumns(e){const t=this.target;return t instanceof $x&&t.isHorizontal?super.generateColumns(e):e.columns.map((t=>this.processResourceColumn(t,e)))}processEventColumn(e,t){const{width:n,minWidth:r}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}processResourceColumn(e,t){const{width:n,minWidth:r}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),type:this.getColumnType(e,this.target.resourceStore)}}generateRows(e){const t=this,{target:n}=t;let r;if(!n.resourceStore||n.isGanttBase)r=super.generateRows(e);else{if(r=[],n.resourceStore.map((i=>{const s=i.events||[];s.sort(t.eventSortFn),n.isSchedulerBase&&!s.length&&s.push(""),s.forEach((s=>{(""===s||n.eventStore.isAvailable(s)&&(e.includeEventsOutsideTimeAxis||s.isScheduled&&n.intersectsVisibleTimeSpan(s)))&&r.push(t.getRowData(e,i,s))}))})),e.includeUnassigned&&e.eventColumns.length){const i=n.eventStore.query((e=>!e.resources.length));if(i.length){const n=new Array(e.columns.length).fill("");n.push(t.L("L{ExcelExporter.No resource assigned}")),r.push(n),i.forEach((n=>r.push(t.getRowData(e,null,n))))}}r=r.filter((e=>e.length))}return r}getRowData(e,t,n){const{columns:r,eventColumns:i}=e,s=[],o=this.processRecord(t,r,e);if(o&&s.push(...o),!t||!t.isSpecialRow){const t=this.processRecord(n,i,e);t&&s.push(...t)}return s}}sM._$name="ScheduleTableExporter";class oM extends Tb{static $name="ExcelExporter";static configurable={exporterClass:sM,exporterConfig:null}}oM._$name="ExcelExporter",Jv.registerFeature(oM,!1,["Scheduler"]);class aM extends $x{static $name="Scheduler";static type="scheduler"}aM.initClass(),aM._$name="Scheduler";var lM=e=>class extends(e||Qe){static $name="DelayedRecordsRendering";static configurable={scheduledRecordsRefreshTimeout:15};static get properties(){return{recordsToRefresh:new Set}}beforeRenderRow({record:e}){var t;return null!==(t=this.recordIsReadyForRendering)&&void 0!==t&&t.call(this,e)&&this.unscheduleRecordRefresh(e),super.beforeRenderRow(...arguments)}cleanupScheduledRecord(){const{rowManager:e,store:t}=this;for(const n of[...this.recordsToRefresh])n.stores.includes(t)&&e.getRowById(n)||this.recordsToRefresh.delete(n)}renderScheduledRecords(){const e=this;if(e.refreshSuspended)e.scheduleRecordRefresh();else{e.cleanupScheduledRecord();const{rowManager:t}=e,n=[...e.recordsToRefresh],r=n.map((e=>t.getRowById(e)));r.length&&(t.renderRows(r),e.trigger("scheduledRecordsRender",{records:n,rows:r})),e.recordsToRefresh.size&&e.scheduleRecordRefresh()}}unscheduleRecordRefresh(e=!0){const t=this;!0===e?t.recordsToRefresh.clear():e&&nt.asArray(e).forEach((e=>t.recordsToRefresh.delete(e))),t.scheduledRecordsRefreshTimer&&!t.recordsToRefresh.size&&t.clearTimeout(t.scheduledRecordsRefreshTimer)}scheduleRecordRefresh(e){const t=this;e&&nt.asArray(e).forEach((e=>t.recordsToRefresh.add(e))),t.scheduledRecordsRefreshTimer=t.setTimeout({fn:"renderScheduledRecords",delay:t.scheduledRecordsRefreshTimeout,cancelOutstanding:!0})}get widgetClass(){}};class dM extends Qe{static configurable={scrollBuffer:0};construct(e){super.construct(),this.client=e}init(){}onTimeAxisViewModelUpdate(){const{scrollable:e}=this.client.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}updateFromHorizontalScroll(e){const t=this,{client:n,scrollBuffer:r}=t,{timeAxisSubGrid:i,timeAxis:s,rtl:o}=n,{width:a}=i,{totalSize:l}=n.timeAxisViewModel,d=e,c=0!==i.scrollable.maxX&&Math.abs(i.scrollable.maxX)<=Math.round(d)+5,u=n.getDateFromVirtualCoord({coord:Math.max(0,d-r)}),h=c?s.endDate:n.getDateFromVirtualCoord({coord:d+a+r})||s.endDate;if(u&&!n._viewPresetChanging){t._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},t.viewportCoords=o?{left:l-e-a+r,right:l-e-r}:{left:e-r,right:e+a+r};const i=n.timeView.range={startDate:u,endDate:h};if(n.internalOnVisibleDateRangeChange(i),!n.refreshSuspended&&n.rowManager.rows.length){if(null===n.rowManager.rows[0].id)return;(t._timeAxisStartDate-s.startDate||t._timeAxisEndDate-s.endDate)&&(t._timeAxisStartDate=s.startDate,t._timeAxisEndDate=s.endDate,n.rowManager.renderRows(n.rowManager.rows))}}}onViewportResize(){}refreshRows(){}get visibleDateRange(){return this._visibleDateRange}translateToPageCoordinate(e){const{client:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?r-=n.maxX-Math.abs(t.scrollLeft):r-=t.scrollLeft,r}translateToScheduleCoordinate(e){const{client:t}=this,{scrollable:n}=t.timeAxisSubGrid;let r=e-t.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return t.rtl?r+=n.maxX-Math.abs(t.scrollLeft):r+=t.scrollLeft,r}getDateFromXY(e,t,n,r=!1){const{client:i}=this;let s=e[0];return n||(s=this.translateToScheduleCoordinate(s)),s=i.getRtlX(s),i.timeAxisViewModel.getDateFromPosition(s,t,r)}}dM._$name="TimelineHistogramRendering";const cM={series:null,topValue:null},uM=()=>{};class hM extends(sw.mixin(lM)){static $name="TimelineHistogramBase";static type="timelinehistogrambase";static configurable={timeCellCls:"b-sch-timeaxis-cell b-timelinehistogram-cell",mode:"horizontal",rowHeight:50,showBarTip:!1,barTooltip:null,barTooltipClass:tm,series:null,dataModelField:"histogramData",getRecordData:null,hardRefreshOnTimeAxisReconfigure:!0,getBarClass:null,getOutlineClass:e=>"",getOutlineDOMConfig:(e,t,n)=>t,readOnly:!0,barTooltipTemplate:null,getBarText:null,getBarDOMConfig:null,getBarTextDOMConfig:void 0,histogramWidgetClass:cv,histogramWidget:{cls:"b-hide-offscreen b-timelinehistogram-histogram",omitZeroHeightBars:!0,data:[]},fixedRowHeight:!0,timeAxisColumnConfig:{type:"timeAxis",renderer:"up.histogramRenderer"}};static get properties(){return{histogramDataByRecord:new Map,collectingDataFor:new Map,_refreshRequested:0}}updateGetRecordData(e){this._getRecordData=e?this.resolveCallback(e):null}updateHardRefreshOnTimeAxisReconfigure(e){const t="hardRefreshOnTimeAxisReconfigure";e?this.timeAxis.ion({name:t,endReconfigure:"onTimeAxisEndReconfigure",thisObj:this}):this.detachListeners(t)}construct(e){super.construct(e);const t=this;t.scheduleRefreshRows=t.createOnFrame(t.refreshRows,[],t,!0),t.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",thisObj:t})}onDestroy(){var e;this.clearHistogramDataCache(),null===(e=this._histogramWidget)||void 0===e||e.destroy(),this.barTooltip=null}resolveTimeSpanRecord(e){}getScheduleMouseEventParams(e,t){return{record:this.store.getById(e.id)}}get currentOrientation(){return this._currentOrientation||(this._currentOrientation=new dM(this)),this._currentOrientation}updateSeries(e){const t=this;t.histogramWidget.series=e,t._series=t.histogramWidget.series,t.isPainted&&!t.isConfiguring&&t.scheduleRefreshRows()}getAsyncEventSuffixForStore(e){return e.isAbstractPartOfProjectStoreMixin?"PreCommit":""}scheduleRefreshRows(){}refreshRows(...e){return this.refreshSuspended?this._refreshRequested++:this._refreshRequested=0,super.refreshRows(...e)}getRowHeight(){return this.rowHeight}onInternalPaint({firstPaint:e}){super.onInternalPaint({firstPaint:e}),e&&this.showBarTip&&(this.barTooltip={})}changeBarTooltip(e,t){return null==t||t.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}async getTipHtml(e){if(this.showBarTip&&this.barTooltipTemplate){const{activeTarget:t}=e,n=parseInt(t.dataset.index,10),r=this.getRecordFromElement(t),i=await this.getRecordHistogramData(r);return this.barTooltipTemplate({...e,datum:this.extractHistogramDataArray(i,r)[n],record:r,index:n})}}collectTicksWidth(){const{ticks:e}=this.timeAxis,t=e[0].endDate-e[0].startDate,n={0:t};let r=t,i=!0;for(let s=1,{length:o}=e;s<o;s++){const o=e[s],a=o.endDate-o.startDate;t!==a&&(i=!1),r+=a,n[s]=a}if(i)this.ticksWidth=null;else{const t={};for(let i=0,{length:s}=e;i<s;i++)t[i]=n[i]/r;this.ticksWidth=t}}changeHistogramWidget(e){const t=this;var n;e&&!e.isHistogram&&(t.getBarTextDOMConfig&&!e.getBarTextDOMConfig&&(e.getBarTextDOMConfig=t.getBarTextDOMConfig),(e=t.histogramWidgetClass.new({owner:t,appendTo:t.element,height:t.rowHeight,width:(null===(n=t.timeAxisColumn)||void 0===n?void 0:n.width)||0,getBarTip:uM,getBarClass:t.getBarClass||t.getBarClassDefault,getBarText:t.getBarText||t.getBarTextDefault,getBarDOMConfig:t.getBarDOMConfig,getOutlineClass:t.getOutlineClass,getOutlineDOMConfig:t.getOutlineDOMConfig},e)).suspendRefresh(),t.getBarTextDefault=t.getBarTextDefault.bind(e));return e}getBarClassDefault(e,t,n){}getBarTextDefault(e,t){}updateShowBarTip(e){this.barTooltip=e}onHistogramDataCacheSet({record:e,data:t}){this.scheduleRecordRefresh(e)}onTimeAxisEndReconfigure(){this.hardRefreshOnTimeAxisReconfigure&&(this.clearHistogramDataCache(),this.scheduleRefreshRows())}onStoreUpdateRecord({record:e,changes:t}){const n=this;return!n.getRecordData&&n.dataModelField&&t[n.dataModelField]&&n.clearHistogramDataCache(e),super.onStoreUpdateRecord(...arguments)}onStoreRemove({records:e}){super.onStoreRemove(...arguments);for(const t of e)this.clearHistogramDataCache(t)}onBeforeRowHeight({height:e}){if(this._timeAxisColumn){const t=this._histogramWidget;t&&(t.height=e,t.onElementResize(t.element))}}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);const e=this._histogramWidget;e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element)),this.collectTicksWidth()}extractHistogramDataArray(e,t){return e}processRecordRenderData(e){return e}clearHistogramDataCache(e){const t=nt.asArray(e);if(t)for(const e of t)this.histogramDataByRecord.delete(e);else this.histogramDataByRecord.clear()}setHistogramDataCache(e,t){const n={record:e,data:t};this.trigger("beforeHistogramDataCacheSet",n),this.histogramDataByRecord.set(n.record,n.data),this.trigger("histogramDataCacheSet",n)}getHistogramDataCache(e){return e?this.histogramDataByRecord.get(e):this.histogramDataByRecord}hasHistogramDataCache(e){return this.histogramDataByRecord.has(e)}finalizeDataRetrievingInternal(e,t){return this.collectingDataFor.delete(e),this.setHistogramDataCache(e,t),t}finalizeDataRetrieving(e,t){return C.isPromise(t)?(this.collectingDataFor.set(e,t),t.then((t=>{var n;return null===(n=this.finalizeDataRetrievingInternal)||void 0===n?void 0:n.call(this,e,t)}))):this.finalizeDataRetrievingInternal(e,t)}getRecordHistogramData(e){const t=this,{getRecordData:n}=t;let r=t.collectingDataFor.get(e)||t.getHistogramDataCache(e);return r||t.hasHistogramDataCache(e)||(r=n?n.handler.call(n.thisObj,...arguments):e.get(t.dataModelField),r=t.finalizeDataRetrieving(e,r)),r}recordIsReadyForRendering(e){return!this.collectingDataFor.has(e)}beforeRenderRow(e){const t=this,n=t.getRecordHistogramData(e.record);if(!C.isPromise(n)){const r=n?t.extractHistogramDataArray(n,e.record):[];if(!r)return;if(t.ticksWidth)for(let e=0,{length:n}=r;e<n;e++)r[e].width=t.ticksWidth[e];const i=C.merge({topValue:null},t.initialConfig.histogramWidget,{data:r,series:{...t.series}});e={...e,histogramConfig:i,histogramData:n,histogramWidget:t.histogramWidget},t.trigger("beforeRenderHistogramRow",e),delete e.eventName,delete e.source,delete e.type,delete e.oldId,delete e.row,delete e.recordIndex,t._recordRenderData=t.processRecordRenderData(e)}super.beforeRenderRow(...arguments)}applyHistogramWidgetConfig(e=this.histogramWidget,t){Object.assign(e,cM,t)}renderRecordHistogram(e){const t=this,{histogramData:n,cellElement:r}=e;if(!n)return void(r.innerHTML="");t.trigger("beforeRenderRecordHistogram",e),delete e.eventName,delete e.type,delete e.source;const i=e.histogramWidget||t.histogramWidget;t.applyHistogramWidgetConfig(i,e.histogramConfig),i.refresh({args:[e]});const s=i.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),r.innerHTML="",r.appendChild(s)}histogramRenderer(e){const t=this,n=e.histogramData||t.getRecordHistogramData(e.record);return C.isPromise(n)?"":(Object.assign(e,t._recordRenderData),t.renderRecordHistogram(...arguments))}buildGroupHeader(e){return e.column===this.timeAxisColumn?this.histogramRenderer(e):this.features.group.buildGroupHeader(e)}get widgetClass(){}}hM.initClass(),hM._$name="TimelineHistogramBase";var gM=e=>class extends(e||hM){static $name="TimelineHistogramGrouping";static configurable={aggregateHistogramDataForGroups:!0,aggregateDataEntry:null,getDataEntryForAggregating:null,initAggregatedDataEntry:null,aggregateFunctions:{sum:{aliases:["add"],entry:(e,t,n)=>(t[e]=(t[e]||0)+n[e],t)},min:{entry(e,t,n){const r=n[e];return r<(t[e]||Number.MAX_VALUE)&&(t[e]=r),t}},max:{entry(e,t,n){const r=n[e];return r>(t[e]||Number.MIN_VALUE)&&(t[e]=r),t}},count:{init(e,t,n,r){t[e]=r.arrays.length}},avg:{entry:(e,t,n)=>(t[e]=(t[e]||0)+n[e],t),finalize(e,t,n,r,i){const s=i.arrays.length;t.forEach((t=>t[e]/=s))}}}};afterConfigure(){const e=this;e.internalAggregateDataEntry=e.internalAggregateDataEntry.bind(this),e.internalInitAggregatedDataEntry=e.internalInitAggregatedDataEntry.bind(this),super.afterConfigure(),e.features.treeGroup&&e.features.treeGroup.ion({beforeDataLoad:e.onTreeGroupBeforeDataLoad,thisObj:e})}updateAggregateFunctions(e){for(const[t,n]of Object.entries(e))if(n.id=t,n.aliases)for(const t of n.aliases)e[t]=n}updateStore(e){super.updateStore(...arguments),this.detachListeners("store"),e&&e.ion({name:"store",group:this.onStoreGroup,sort:this.onStoreSort,thisObj:this})}changeAggregateDataEntry(e){return this.bindCallback(e)}changeGetDataEntryForAggregating(e){return this.bindCallback(e)}changeInitAggregatedDataEntry(e){return this.bindCallback(e)}onHistogramDataCacheSet({record:e,data:t}){super.onHistogramDataCacheSet(...arguments),this.aggregateHistogramDataForGroups&&this.scheduleRecordParentsRefresh(e)}onTreeGroupBeforeDataLoad(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreGroup(){this.aggregateHistogramDataForGroups&&this.resetGeneratedRecordsHistogramDataCache()}onStoreSort({source:e}){this.aggregateHistogramDataForGroups&&e.isGrouped&&this.resetGeneratedRecordsHistogramDataCache()}getRecordHistogramData(e,t){const n=this;let r;return n.aggregateHistogramDataForGroups&&n.isGroupRecord(e)?(r=n.collectingDataFor.get(e)||n.getHistogramDataCache(e),r||n.hasHistogramDataCache(e)||(r=n.getGroupRecordHistogramData(e,t),r=n.finalizeDataRetrieving(e,r))):r=super.getRecordHistogramData(...arguments),r}internalAggregateDataEntry(e,...t){const{aggregateFunctions:n}=this;for(const{id:r,aggregate:i="sum"}of Object.values(this.series)){let s;!1!==i&&(s=n[i].entry)&&(e=s(r,e,...t))}return this.aggregateDataEntry?this.aggregateDataEntry(e,...t):e}internalInitAggregatedDataEntry(){const e=this.initAggregatedDataEntry?this.initAggregatedDataEntry(...arguments):{},{aggregateFunctions:t}=this;for(const{id:n,aggregate:r="sum"}of Object.values(this.series)){const i=t[r].init;i&&!1!==r&&i(n,e,...arguments)}return e}resetGeneratedRecordsHistogramDataCache(){const{store:e}=this;for(const t of this.getHistogramDataCache().keys())(t.isGroupHeader||t.generatedParent||t.isLinked&&!e.includes(t))&&this.clearHistogramDataCache(t)}setHistogramDataCache(e,t){if(super.setHistogramDataCache(e,t),e.isLinked)super.setHistogramDataCache(e.$original,t);else if(e.$links){const{store:n}=this;for(const r of e.$links)n.includes(r)&&super.setHistogramDataCache(r,t)}}getHistogramDataCache(e){let t=super.getHistogramDataCache(e);return!t&&e.isLinked&&(t=super.getHistogramDataCache(e.$original)),t}getGroupRecordHistogramData(e,t={}){t.parentRecord=e;const n=this.aggregateRecordsHistogramData(this.getGroupChildren(e),t);return C.isPromise(n)?n.then((e=>e)):n}aggregateRecordsHistogramData(e,t={}){const n=this,r=[],{parentRecord:i}=t;let s=!1;for(const i of e){const e=n.getRecordHistogramData(i,t);s=s||C.isPromise(e),e&&r.push(e)}return s?Promise.all(r).then((r=>(t.parentRecord=i,r=r.filter((e=>e)),e.length>0&&!n.isDestroyed?n.aggregateHistogramData(r,e,t):[]))):n.aggregateHistogramData(r,e,t)}isGroupRecord(e){return e.isGroupHeader||this.isTreeGrouped&&e.generatedParent}getGroupChildren(e){return e.groupChildren||e.children}getRecordParent(e){const{groupParent:t}=e.instanceMeta(this.store);return t||this.isTreeGrouped&&e.parent}scheduleRecordParentsRefresh(e,t=!0){const n=this;let r;for(;r=n.getRecordParent(e);)t&&n.clearHistogramDataCache(r),n.scheduleRecordRefresh(r),e=r}aggregateHistogramData(e,t,n={}){const r=this,{aggregateFunctions:i}=r;n.recordsData=e,n.records=t;const s=e.map(((e,n)=>r.extractHistogramDataArray(e,t[n]))),o=nt.aggregate(s,r.getDataEntryForAggregating||(e=>e),r.internalAggregateDataEntry,r.internalInitAggregatedDataEntry,n);for(const{id:e,aggregate:t="sum"}of Object.values(r.series)){const n=i[t].finalize;n&&!1!==t&&n(e,o,...arguments)}return o}get widgetClass(){}},mM=e=>class extends e{static $name="TimelineHistogramScaleColumn";static configurable={scaleColumn:{},scalePoints:null,calculateTopValueByScalePoints:!0};changeScalePoints(e){return null==e||e.sort(((e,t)=>e.value-t.value)),e}updateScalePoints(e){const t=this,n=e[e.length-1];n&&(t.scaleUnit=n.unit,t.calculateTopValueByScalePoints&&(t.histogramWidget.topValue=t.getTopValueByScalePoints(e))),t.scaleColumn&&(t.scaleColumn.scalePoints=e)}changeColumns(e,t){const n=this.getConfig("scaleColumn");if(e&&n){var r;const t=Array.isArray(e);let i=e;t||(i=e.data);let s=null===(r=i)||void 0===r?void 0:r.length,o=n;i.some(((e,t)=>{if("scale"===e.type)return s=t,o=W.assign(e,o),!0})),i=i.slice(),i[s]={type:"scale",...o},t?e=i:e.data=i}return super.changeColumns(e,t)}updateColumns(e,t){super.updateColumns(e,t),e&&(this._scaleColumn=this.columns.find((e=>e.isScaleColumn)))}onColumnsChanged({action:e,changes:t,record:n,records:r}){const{scaleColumn:i,columns:s}=this;!i||"dataset"!==e&&"batch"!==e||s.includes(i)||s.add(i,!0),super.onColumnsChanged(...arguments)}convertUnitsToHistogramValue(e,t){return e}convertHistogramValueToUnits(e,t){return e}extractHistogramDataArray(e,t){return e}getTopValueByScalePoints(e){const t=this,{scaleColumn:n}=t,r=e[e.length-1],{value:i,unit:s}=r;let o=i;return n&&(o*=1+(n.scaleWidget.scaleMaxPadding||0)),t.convertUnitsToHistogramValue(o,s||t.scaleUnit)}processRecordRenderData(e){e=super.processRecordRenderData(...arguments);const{scaleColumn:t}=this;if(t){var n;const r=this,{record:i,histogramData:s,histogramConfig:o={}}=e;let a=null===(n=r.initialConfig.histogramWidget)||void 0===n?void 0:n.topValue,l=r.scalePoints||i.get(t.field);if(!a){if(l&&r.calculateTopValueByScalePoints&&(a=r.getTopValueByScalePoints(l)),!a&&s){const t=e.histogramWidget||r.histogramWidget;W.assign(t,o),a=t.getDataTopValue(s),l=[{value:r.convertHistogramValueToUnits(a,r.scaleUnit),text:r.convertHistogramValueToUnits(a,r.scaleUnit)}],a+=r.scaleColumn.scaleWidget.scaleMaxPadding*a}e.scaleWidgetConfig={scalePoints:l},e.histogramConfig={...o,topValue:a}}}return e}buildGroupHeader(e){return e.column===this.scaleColumn?this.scaleColumn.renderer(e):super.buildGroupHeader(...arguments)}beforeRenderCell(e){return this.scaleColumn&&e.column===this.scaleColumn&&(e.histogramData=this.getRecordHistogramData(e.record),W.isPromise(e.histogramData)||Object.assign(e,this._recordRenderData)),super.beforeRenderCell(...arguments)}renderRecordScale(e,t){if(this.scaleColumn){const t=this.getRowFor(e),n=null==t?void 0:t.getCell(this.scaleColumn.id);n&&t.renderCell(n)}}get widgetClass(){}};class pM extends(hM.mixin(gM,mM)){static $name="TimelineHistogram";static type="timelinehistogram"}pM.initClass(),pM._$name="TimelineHistogram";class fM extends Dm{static $name="ProjectCombo";static type="projectcombo";static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1,internalListeners:{change:"onInternalChange"}}}updateProject(e){var t;null!==(t=e.transport.load)&&void 0!==t&&t.url&&(this.value=e.transport.load.url)}onInternalChange({value:e,userAction:t}){t&&this.project&&(this.project.transport.load.url=e,this.project.load())}}fM.initClass(),fM._$name="ProjectCombo";class vM extends gm{static $name="ResourceFilter";static type="resourcefilter";static get delayable(){return{applyFilters:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,useResourceColor:!0,toggleAllIfCtrlPressed:!0,collapsibleGroups:!0,itemTpl:e=>N.encodeHtml(e.name||""),masterFilter:e=>!0,filterResources:null,allowGroupSelect:!1}}itemIconTpl(e,t){const{eventColor:n}=e,{useResourceColor:r}=this,i=Yn.isNamedColor(n)&&r?` b-sch-color-${n}`:"",s=!i&&n&&r?` style="--checkbox-background-color:${n}"`:"";return this.multiSelect&&this.callback(this.isSelectable,this,[e])?`<div aria-hidden="true" class="b-selected-icon b-icon${i}"${s}></div>`:""}changeStore(e){if(this.eventStore)return super.changeStore(...arguments);this._storeConfig=e}changeEventStore(e){return this.getConfig("store"),e}updateEventStore(e){var t;const n=this,r=n._storeConfig||{},{resourceStore:i}=e,s={...r,syncSort:!0,excludeCollapsedRecords:!1},o={name:"resourceStore",change:"onStoreChange",thisObj:n};i.tree&&(s.sorters=[]),null===(t=n.store)||void 0===t||t.destroy(),n.detachListeners("project","resourceStore");(n.store=i.chain(n.masterFilter,null,s)).un(o),i.ion(o),i.count?n.initFilter():i.project.ion({name:"project",refresh:"initFilter",thisObj:n})}changeMasterFilter(e){const t=this;if(!t.filterResources)return function(n){return t.callback(e,t,[n])}}initFilter(){const e=this;if(e.eventStore.resourceStore.count){const{selected:n}=e;var t;if(!n.count)0===(null===(t=e.initialConfig.selected)||void 0===t?void 0:t.length)?e.onInternalSelectionChange({source:n,added:[],removed:[]}):n.add(e.store.allRecords.filter((e=>!e.isGroupHeader)));e.detachListeners("project")}}onStoreRefresh({source:e,action:t}){if("filter"===t&&this.eventStoreFilter){const{eventStoreFilter:t}=this,{disabled:n}=t,r=!e.isFiltered&&this.allSelected;r!==n&&(t.disabled=r,this.applyFilters())}super.onStoreRefresh(...arguments)}onInternalSelectionChange({source:e,added:t=[],removed:n}){const r=this,i=!r.store.isFiltered&&r.allSelected;super.onInternalSelectionChange(...arguments);let s=!1;if(r.eventStoreFilter||(r.eventStoreFilter=r.eventStore.addFilter({id:`${r.id}-filter-instance`,filterBy:e=>!e.resource||r.selected.includes(e.resources),disabled:i},(null==t?void 0:t.length)===r.store.count),s=!0),r.filterResources&&!r.resourceStoreFilter&&(r.resourceStoreFilter=r.eventStore.resourceStore.addFilter({id:`${r.id}-filter-instance`,filterBy:e=>r.selected.includes(e),disabled:i},(null==t?void 0:t.length)===r.store.count),s=!0),s)return;r.eventStoreFilter.disabled=i,r.resourceStoreFilter&&(r.resourceStoreFilter.disabled=i),r.applyFilters();const o=e.values,a=o.concat(n);nt.remove(a,...t),r.triggerFieldChange({value:o,oldValue:a})}get value(){return this.selected.values}applyFilters(){this.eventStore.filter(),this.filterResources&&this.eventStore.resourceStore.filter()}updateUseResourceColor(e){this.element.classList.toggle("b-plain-color",!e)}doDestroy(){var e;null===(e=this.store)||void 0===e||e.destroy(),super.doDestroy()}}vM.initClass(),vM._$name="ResourceFilter";class yM extends bp{static $name="SchedulerDatePicker";static type="datepicker";static configurable={showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}};changeEventFilter(e){if("string"==typeof e){const{handler:t,thisObj:n}=this.resolveCallback(e);e=t.bind(n)}return e}doRefresh(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),super.doRefresh(...arguments);this.whenVisible("doRefresh")}updateShowEvents(e,t){const n=this,{classList:r}=n.contentElement;let{eventStore:i}=n;if(n.requestAnimationFrame((()=>{var i;n.element.classList.toggle("b-datepicker-with-events",Boolean(e)),null===(i=n.owner)||void 0===i||i.element.classList.toggle("b-datepicker-with-events",Boolean(e)),e&&r.add(`b-show-events-${e}`),r.remove(`b-show-events-${t}`)})),e){if(!i){const e=n.up((e=>e.eventStore));if(!e)throw new Error("DatePicker configured with events but no eventStore");n._eventStore=i=e.eventStore}}else n.cellMap=null;n.isConfiguring||(n.updateEventStore(i),n.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.cellMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.cellMap,filter:e.eventFilter}))}updateEventStore(e){var t;-1===e.findListener("change","refresh",this)&&(null==e||null===(t=e[this.showEvents?"on":"un"])||void 0===t||t.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:t}){var n,r;const{showEvents:i}=this,s=null===(n=this.cellMap)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,xi.makeKey(t)),o=Array.isArray(s)?s.length:s,a="count"===i;delete e.dataset.btip,o&&(!a&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",o)),Yn.createElement({dataset:{count:o},class:{[a?"b-cell-events-badge":"b-icon b-icon-circle"]:"heatmap"!==i,[yM.getEventCountClass(o)]:1},parent:e,[a?"text":""]:o}))}getCellClassList({date:e}){var t,n;const r=null===(t=this.cellMap)||void 0===t||null===(n=t.get)||void 0===n?void 0:n.call(t,xi.makeKey(e)),i=Array.isArray(r)?r.length:r,s=super.getCellClassList(...arguments);return s[yM.getEventCountClass(i)]=i>0,s}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-datepicker-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}yM.initClass(),yM._$name="SchedulerDatePicker";const bM=e=>e.isProjectConsumer;class CM extends nv{static $name="UndoRedo";static type="undoredo";static configurable={scheduler:null,project:null};construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(bM))}changeScheduler(e){return e.isProjectConsumer?e:CM.getById(e)}updateScheduler(e){const t=this,{crudManager:n}=e;e.ion({projectChange:"onProjectChanged",thisObj:t}),n?t.setupLoadListener(n):t.onLoad(),!t.project&&null!=e&&e.project&&(t.project=e.project),t.stm=e.project.stm}setupLoadListener(e){this.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){super.updateProject(...arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}}CM.initClass(),CM._$name="UndoRedo";class wM extends Dm{static $name="ViewPresetCombo";static type="viewpresetcombo";static configurable={presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,useFixedDuration:!0,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"};construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up((e=>e.isTimelineBase))||oc.query((e=>e.isTimelineBase))}changeValue(e,t){return this.getConfig("presets"),super.changeValue(e,t)}updatePresets(e){this.store=this.scheduler.presets.chain((t=>e.includes(t.id))),this.store.sort(((t,n)=>e.indexOf(t.id)-e.indexOf(n.id)))}onClientPresetChange({preset:e}){const t=this;t._isSelecting||(t.isSettingValue=!0,t.store.includes(e.id)?t.value=e:t.clear(),t.isSettingValue=!1)}onSelect({record:e}){if(!this.isSettingValue){const{scheduler:t}=this,{mainUnit:n,start:r,defaultSpan:i}=e,s={};if(n&&i&&this.useFixedDuration){let e=n;r&&"string"==typeof r&&(e=xi.parseTimeUnit(r)??r),s.startDate=xi.startOf(t.viewportCenterDate,e),"number"==typeof r&&(s.startDate=xi.add(s.startDate,r,n)),s.endDate=xi.add(s.startDate,i,n)}t.zoomToLevel(e,s)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}}wM.initClass(),wM._$name="ViewPresetCombo";class SM{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new SM({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,n]of this.getGroups())e.set(t,n[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,n]of this.getGroups())n[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,n]of this.getGroups())n[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach((([n,r])=>{let i=t.get(n);i||(e.push(n),i=[],t.set(n,i)),i.push.apply(i,r.intervals)})),t.forEach(((e,n)=>{const r=sE(e);r.sort(oE),t.set(n,r)})),this.intervalsByCalendar=t}}class DM extends iE{constructor(e){super(e),this.calendarCaches=sE(this.calendarCaches),this.intervalCache=new uE({emptyInterval:new SM,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach((n=>{n.fillCache(e,t),this.includeWrappingRangeFrom(n,e,t)}))}}const EM=new Map;class xM extends Rv{static $name="AgendaColumn";static type="agendacolumn";static get defaults(){return{id:"agenda",text:"Agenda",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!1,alwaysClearCell:!1}}construct(){super.construct(...arguments),this.grid.ion({beforeResponsiveStateChange:"onBeforeGridResponsiveStateChange",thisObj:this})}defaultRenderer({cellElement:e,row:t,record:n,grid:r,size:i}){var s;const o=this,{events:a,date:l}=n,{previousEvents:d}=n.data,c=[];for(let e=0;e<a.length;e++){const t=a[e],i=t.endDate||xi.add(t.startDate,t.duration,t.durationUnit),s=t.startDate<l,o=i>n.tomorrow,d=r.createEventDomConfig({date:n.date,isAllDay:t.allDay||o||s,eventRecord:t});d.className["b-continues-future"]=o,d.className["b-continues-past"]=s,c.push({className:{"b-cal-agenda-event-row":1},dataset:{rowId:t.id},children:[r.callback("eventListEventTimeRenderer",r,[t,l]),d],syncOptions:{syncIdField:"rowId",releaseThreshold:0,strict:!0}})}if(t[d&&d.date.getMonth()!==l.getMonth()?"addCls":"removeCls"]("b-new-month"),null===(s=r._cellRenderer)||void 0===s||s.call(r,...arguments),e.classList[n.isNonWorking?"add":"remove"](r.nonWorkingDayCls),ud.sync({domConfig:{onlyChildren:!0,children:[r.callback("agendaEventDateRenderer",r,[l]),{className:{"b-cal-event-bar-container":1},children:c}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e}),e.setAttribute("aria-label",`${xi.format(l,"dddd MMMM Do, YYYY")}, ${r.L("eventCount",a.length)}`),e.setAttribute("tabIndex",-1),e.dataset.date=n.id,!o.autoHeight){const t=e.querySelector(".b-cal-agenda-date"),s=null!=o._cellTbPadding?o._cellTbPadding:o._cellTbPadding=Yn.getEdgeSize(e,"padding","tb").height,a=null!=o._containerPadding?o._containerPadding:o._containerPadding=Yn.getEdgeSize(e.querySelector(".b-cal-event-bar-container"),"margin","tb").height,l=null!=o._dateBlockHeight?o._dateBlockHeight:o._dateBlockHeight=Ot.outer(t).height;i.height=Math.max(n.events.length*(r.eventHeightInPixels+r.eventRowSpacing)-r.eventRowSpacing+s+a+("small"===r.responsiveState?l:0),86)}}onBeforeGridResponsiveStateChange(){this._cellTbPadding=this._containerPadding=this._dateBlockHeight=this._dateBlockHeight=null}getCellClass(e){const t=super.getCellClass(e);return t["b-sticky-cell"]=t[`b-day-of-week-${e.record.day}`]=1,t}headerRenderer({headerElement:e}){e.innerHTML="",ud.sync({domConfig:{className:{"b-cal-agenda-header":1,"b-grid-header":1,"b-last-leaf":1},children:[{className:{"b-cal-agenda-header-date":1},text:"Date"},{className:{"b-cal-agenda-header-time":1},text:"Time"},{className:{"b-cal-agenda-header-event":1},text:"Event"}]},targetElement:e})}}kv.registerColumnType(xM),xM._$name="AgendaColumn";class RM extends Rv{static $name="EventColumn";static type="calendarevents";static get defaults(){return{id:"calendarevents",text:"Event Details",filterable:!1,sortable:!1,editor:!1,searchable:!1,autoHeight:!0,alwaysClearCell:!1}}renderer({cellElement:e,record:t,grid:n}){var r,i;const s=null===(r=n.calendar)||void 0===r?void 0:r.widgetMap.resourceFilter,o=s?t.resources.filter((e=>s.selected.includes(e))):t.resources;null===(i=n._cellRenderer)||void 0===i||i.call(n,...arguments),n.showResourceAvatars=!0,ud.sync({domConfig:{onlyChildren:!0,children:[{class:"b-cal-event-resource-avatars",children:o.map((e=>({class:"b-cal-event-resource-avatar-row",children:[n.getResourceAvatar(e),{class:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:e.name},{class:"b-event-column-resource-role",text:e.role}]}]})))},{class:"b-cal-event-column-event-desc",children:[{class:"b-cal-event-column-event-name",text:t.name}]},{class:"b-cal-event-column-times",children:[n.eventListEventTimeRenderer(t)]}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:!0}},targetElement:e})}}kv.registerColumnType(RM),RM.exposeProperties(),RM._$name="EventColumn";class TM extends ID{static fields=[{name:"alignment",defaultValue:"start",internal:!0},{name:"color",internal:!0},{name:"footer",internal:!0},{name:"rotation",internal:!0}]}TM._$name="TimeRangeModel";class MM extends AD{static defaultConfig={modelClass:TM}}MM.initClass(),MM._$name="TimeRangeStore";class kM extends xE{static $name="ProjectModel";static configurable={timeRangeStore:{modelClass:TM}};static defaultConfig={timeRangeModelClass:TM,timeRangeStoreClass:MM}}kM.applyConfigs=!0,kM.initClass(),kM._$name="ProjectModel";class FM extends RE{static $name="CrudManager";static configurable={projectClass:kM,timeRangeClass:TM};buildProjectConfig(){const e=super.buildProjectConfig(),{timeRangeStore:t}=this;return t&&(e.timeRangeStore=t),e}get timeRangeStore(){return super.timeRangeStore}set timeRangeStore(e){var t;e&&W.isObject(e)&&(e=W.assign({modelClass:this.timeRangeClass},e)),this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}}FM.initClass(),FM._$name="CrudManager";class IM extends(Mr.mixin(ds)){static get factoryable(){return{}}static configurable={disableOnReadOnly:null,zoneTypes:null};static properties={clientListeners:{paint:"onCalendarPaint"}};getViewZoneType(e){const{zoneTypes:t}=this;let n;return t&&void 0===(n=t[e.type])&&(e.isWeekView&&void 0!==t.week?n=t.week:e.isDayView?n=t.day:e.isMonthView?n=t.month:e.isYearView?n=t.year:e.isResourceView?n=t.resource:e.isAgendaView&&(n=t.agenda)),n}updateDisableOnReadOnly(e){const t=this,{client:n}=t,r="readonlyToggle",i="onClientReadOnlyToggle";e?(t[i]({readOnly:n.readOnly}),n.ion({name:r,readOnly:i,thisObj:t})):t.detachListeners(r)}doDestroy(){this.syncModes(),super.doDestroy()}createZone(e,t){return new e({owner:this,...t})}onClientReadOnlyToggle({readOnly:e}){this.disabled=e}updateDisabled(e,t){super.updateDisabled(e,t),this.client.isPainted&&this.syncModes()}onCalendarPaint({firstPaint:e}){e&&this.syncModes()}syncModes(){const e=this,{client:t,_modeDetacher:n,zones:r}=e;let i,s,o,a,l,d=null;if(e.disabled||e.isDestroying||!e.zoneTypes)null==n||n();else for(s in t.isCalendar?(n||(e._modeDetacher=t.ion({addMode:()=>e.syncModes()})),i=t.modes):i={view:t},i){var c;if(l=null==r?void 0:r[s],o=i[s],a=e.getViewZoneType(o),a)(W.isObject(l)?l.type:null===(c=l)||void 0===c?void 0:c.constructor)===a?delete r[s]:l=o.isPainted?e.createZone(a,{view:o}):e.whenPainted(s,o,a),(d||(d={}))[s]=l}if(e.zones=d,r)for(s in r)r[s].destroy()}whenPainted(e,t,n){const r=this,i={type:n,destroy:t.ion({once:!0,prio:1e4,paint(){r.zones[e]===i&&(r.zones[e]=r.createZone(n,{view:t}))}})};return i}}IM._$name="CalendarFeature";class AM extends Qe{static $name="CalendarZone";static configurable={owner:null,view:{$config:"nullify",value:null},viewListeners:null};updateView(e){const t=this,n=e&&t.viewListeners;t.detachListeners("viewListeners"),n&&(null==e||e.ion(W.merge({thisObj:t,name:"viewListeners"},n)))}}AM.initClass(),AM._$name="CalendarZone";class LM extends bm{static $name="ResourceChipView";static type="resourcechipview";static configurable={navigator:null,itemsFocusable:!1,closable:!1,scrollable:!1,itemTpl(e){var t;return Yn.createElement({className:"b-cal-event-resource-avatar-desc",children:[{class:"b-event-column-resource-name",text:e.name},null!==(t=e.role)&&void 0!==t&&t.length?{class:"b-event-column-resource-role",text:e.role}:null]}).outerHTML}};getItemCls(e){return Yn.isNamedColor(e.eventColor)?` b-sch-${e.eventColor}`:""}getItemStyle(e){return"color:#fff;"+(e.eventColor&&!Yn.isNamedColor(e.eventColor)?`background-color:${e.eventColor}`:"")}iconTpl(e){return Yn.createElement(this.owner.ownerFeature.client.activeView.getResourceAvatar(e)).outerHTML}}LM.initClass(),LM._$name="ResourceChipView";const PM=new String("");var OM=e=>class extends(e||Qe){static $name="EventRenderer";static configurable={eventRenderer:null,eventHeaderRenderer:null,filterEventResources:null,getPrimaryResource({resources:e}){if(this.resource)return this.resource;if(e.length){var t;const n=this.filterEventResources&&(null===(t=this.calendar)||void 0===t||null===(t=t.widgetMap)||void 0===t?void 0:t.resourceFilter);return n?e.find((e=>n.selected.includes(e))):e[0]}}};updateEventRenderer(){this.refreshSoon()}createEventDomConfig(e,t=this.eventRenderer){var n,r,i,s,o,a,l,d;const c=this,{intradayCls:u,alldayCls:h,solidBarCls:g,pastEventCls:m,showTime:p,timeFormat:f,eventHeaderRenderer:v,rtl:y}=c,b=c.up("calendar"),{eventRecord:C,minimal:w}=e,S=w?"auto":c.eventHeight,D=e.eventEndDate||C.endingDate,E=c.callback(c.getPrimaryResource,c,[C.isOccurrence?C.recurringEvent:C]),x=C.isRecurring||C.isOccurrence,R="isAllDay"in e?e.isAllDay:null===(n=c.isAllDayEvent)||void 0===n?void 0:n.call(c,C),T={height:"auto"!==S?Yn.setLength(S):null},M=null==b?void 0:b.eventSelectedCls,k=null==b||null===(r=b.navigator)||void 0===r?void 0:r.focusCls,F=e.dataset={eventId:C.id},I=Object.assign(Yn.parseStyle(null==E?void 0:E.eventStyle),Yn.parseStyle(C.style)),A={className:"b-cal-event",style:T};let L=e.eventColor||C.color||C.eventColor||(null==E?void 0:E.eventColor)||PM;e.wrapperChildren=[A],e.cls=C.cls.clone(),e.solidBar=R||w,e.iconStyle="header"===c.iconTarget&&c.showTime&&!Yn.isNamedColor(L)?{color:L}:{},e.iconCls=new Vt(C.iconCls),e.style=I,e.eventColor=L,e.eventHeight=S,e.cls[c.shortEventCls]=C.rawDurationMS<=c.shortEventDuration,e.bodyStyle={},e.resourceRecord=E,e.view=c,null!=E&&E.cls&&e.cls.add(E.cls);let P=c.internalBodyContentRenderer(C,E,e,!w&&t)??"";const O="string"==typeof P,$=!O||N.isHtml(P);t&&!w&&(e.eventHeight!==S&&(T.height=Yn.setLength(e.eventHeight)),"string"==typeof e.cls&&(e.cls=new Vt(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new Vt(e.iconCls)),"string"==typeof e.style&&(e.style=Yn.parseStyle(e.style)),"string"==typeof e.bodyStyle&&(e.bodyStyle=Yn.parseStyle(e.bodyStyle))),P=[{className:{"b-cal-event-desc":1,"b-cal-event-desc-complex":$},[O?"html":"children"]:P}],Object.assign(e.cls,{"b-cal-event-wrap":1,"b-iscreating":C.isCreating,"b-readonly":C.readOnly,"b-minimal":w,"b-milestone":C.isMilestone&&!R,[h]:h&&R,[g]:g&&e.solidBar,[u]:u&&!R,[m]:m&&D<new Date,[M]:(null==b?void 0:b.isEventSelected(C))||e.asSelected,"b-rtl":y,[k]:(null==b||null===(i=b.navigator.activeItem)||void 0===i?void 0:i.dataset.eventId)===C.id}),L=e.eventColor;const{bodyColor:_}=e;if(null!=_&&_.length&&(e.cls["b-custom-body-color"]=1,e.bodyStyle["--dayview-body-background-color"]=_),null!==(s=L)&&void 0!==s&&s.length&&(I["--cal-event-color"]=Yn.createColorStyle(L)),v){const t=c.callback(v,c,[{view:c,eventRecord:C,resourceRecord:E,renderData:e}]),n=Array.isArray(t);n||"object"!=typeof t?P.unshift({className:"b-event-header",[n?"children":t.includes("<")?"html":"text"]:t}):(t.className=Vt.normalize(t.className,"object"),t.className["b-event-header"]=1,P.unshift(t))}else!p||R&&c.showAllDayHeader||P.unshift({className:"b-event-header",children:[{className:"b-event-time",html:c.renderTimes(C,p,f)}]});const H=Boolean(null===(o=e.iconCls)||void 0===o?void 0:o.length),V=!H&&x,B="showBullet"in e?e.showBullet:!0===c.showBullet||(null===(a=c.showBullet)||void 0===a?void 0:a.bar)&&e.solidBar||(null===(l=c.showBullet)||void 0===l?void 0:l.noBar)&&!e.solidBar,z=!H&&!x&&B,j={tag:"i",className:Object.assign({"b-cal-event-icon":!V,"b-cal-recurrence-icon":V,"b-icon":1,"b-fw-icon":1,"b-icon-circle":z,"b-icon-recurring":V},e.iconCls),style:e.iconStyle},W=[{className:"b-cal-event-body",children:P,style:e.bodyStyle}],U="header"===c.iconTarget&&c.showTime?(null===(d=P[0].children)||void 0===d?void 0:d.length)>0?P[0].children:P:W;(H||V||z)&&("header"===c.iconTarget&&c.showTime?U.push(j):U.unshift(j)),H&&x&&U.push({tag:"i",className:{"b-cal-recurrence-icon":1,"b-icon":1,"b-fw-icon":1,"b-icon-recurring":1},style:e.iconStyle}),w||(A.children=W);const{startText:G,endText:Y}=HF.getStartAndEndDates(c,C),q={role:"button","aria-label":C.name+","+(Y?`${G} ${c.L("L{Object.to}")} ${Y}`:`${C.isMilestone?c.L("L{Object.at}"):c.L("L{Object.on}")} ${G}`)+".",dataset:F,tabIndex:w?null:0,className:e.cls,style:e.style,children:e.wrapperChildren};return null==b||b.onEventDataGenerated(e,q),q}renderTimes(e,{startTime:t,endTime:n},r){const i=!e.isMilestone&&n;return`${t?xi.format(e.startDate,r):""}${t&&i?` ${this.rtl?"←":"→"} `:""}${i?xi.format(e.endDate,r):""}`}internalBodyContentRenderer(e,t,n,r){var i;const s=this,{showResourceAvatars:o}=s,a=r&&s.callback(r,s,[{view:s,eventRecord:e,resourceRecord:t,renderData:n}])||N["auto"===s.eventHeight?"encodeHtmlBR":"encodeHtml"](e.name),l="string"==typeof a,d=Array.isArray(a);if(o&&null!==(i=e.assigned)&&void 0!==i&&i.size){const t=[{class:"b-cal-event-resource-avatars",children:e.resources.map((e=>s.getResourceAvatar(e)))}],n=["last"===o?0:1,0];return"string"==typeof a?n.push({class:"b-cal-event-name",text:a}):n.push[d?"apply":"call"](n,a),t.splice(...n),t}return d||l?a:[a]}};const $M=new String;class _M extends(yM.mixin(OM)){static $name="CalendarDatePicker";static type="datepicker";static configurable={showEvents:null,maxDots:null,eventDots:{marginTop:4,max:4,gap:3,size:5},eventCountTip:null,alwaysRefreshOnMonthChange:!0};construct(e){var t;const n=this.calendar=null===(t=e.owner||e.parent)||void 0===t?void 0:t.up("calendar");n&&!e.eventStore&&(e.eventStore=n.eventStore),super.construct(...arguments)}changeEventDots(e){const t=this;return new Proxy(e,{set(e){const n=Reflect.set(...arguments);return t.updateEventDots(e),n}})}updateEventDots({marginTop:e,gap:t,size:n,stripe:r}){const{style:i,classList:s}=this.weeksElement;i.setProperty("--event-count-margin-top",`${e}px`),i.setProperty("--event-count-dot-size",`${n}px`),i.setProperty("--event-count-dot-gap",`${t}px`),s[r?"add":"remove"]("b-event-count-dots-striped"),this.isConfiguring||this.refresh()}updatemaxDots(e){G.deprecate("calendar","7.0.0","maxDots property is deprecated in favor of eventDots"),this.eventDots.max=e,this.updateEventDots(this.eventDots)}refreshEventsMap(){var e;const t=this,n=t.eventSorter||(null===(e=t.calendar)||void 0===e||null===(e=e.activeView)||void 0===e?void 0:e.eventSorter);if(t.showEvents&&(t.cellMap=t.eventStore["dots"===t.showEvents?"getEvents":"getEventCounts"]({startDate:t.startDate,endDate:t.endDate,dateMap:t.cellMap||(t.cellMap=new Map),filter:t.eventFilter}),"dots"===t.showEvents&&n))for(const e of t.cellMap.values())e.sort(n)}cellRenderer({cell:e,date:t}){var n,r;const i=this,{showEvents:s}=i,o="count"===s,a="dots"===s,l=null===(n=i.cellMap)||void 0===n||null===(r=n.get)||void 0===r?void 0:r.call(n,xi.makeKey(t)),d=a?null==l?void 0:l.length:l,c=o?"b-cell-events-badge":a?"b-cal-minimal-event-container":"b-icon b-icon-circle";if(a&&(e.innerHTML="",Yn.createElement({class:"b-date-cell-inner",text:t.getDate(),parent:e})),e.parentNode.setAttribute("aria-label",`${xi.format(t,"dddd MMMM Do YYYY")}${s?`, ${i.L("L{ResourceInfoColumn.eventCountText}",d||0)}`:""}.`),delete e.parentNode.dataset.btip,d){!o&&i.eventCountTip&&(e.parentNode.dataset.btip=i.L("L{ResourceInfoColumn.eventCountText}",d));const n={dataset:{count:d},class:{[c]:"heatmap"!==s,[yM.getEventCountClass(d)]:1},parent:e,[o?"text":""]:d};if(a){const{max:e}=i.eventDots,r=n.children=[];for(let n=0;n<Math.min((null==l?void 0:l.length)||0,e);n++){const s=i.createEventDomConfig({date:t,eventRecord:l[n],eventColor:e>1?null:$M,minimal:!0});r.push(s)}}Yn.createElement(n)}}static setupClass(e){e.replaceType=!0,super.setupClass(e)}}_M.initClass(),_M._$name="CalendarDatePicker";class HM extends(Xu.mixin(wv)){static $name="Sidebar";static type="sidebar";static configurable={focusable:!1,ignoreParentReadOnly:!0,ariaLabel:"Sidebar",bbar:{cls:"b-cal-nav-item",layout:{justify:"center"},items:{todayButtonSidebar:{text:"L{Calendar.Today}",onClick:"up.shiftToNow",weight:200},prevButtonSidebar:{onClick:"up.shiftPrevious",cls:"b-borderless",icon:"b-icon-previous",weight:300},nextButtonSidebar:{onClick:"up.shiftNext",cls:"b-borderless",icon:"b-icon-next",weight:400}}},items:{datePicker:{type:"datepicker",ariaLabel:"L{Sidebar.selectDate}",weight:100,internalListeners:{selectionChange:"up.onDatePickerSelectionChange"}},eventFilter:{type:"filterfield",field:"name",weight:150,placeholder:"L{Sidebar.matchEvents}",ariaLabel:"L{Sidebar.filterEvents}",localeClass:this},resourceFilter:{ignoreParentReadOnly:!0,ariaLabel:"L{Sidebar.filterResources}"}},date:{$config:{equal:"date"},value:null},eventStore:null,responsive:{},stepUnitText:null,side:"left",collapsible:{tool:null},resourceFilter:{type:"resourcefilter",flex:"1 1 auto",weight:200,minHeight:110,scrollable:{overflowY:"auto"},store:{sorters:[{field:"name",ascending:!0}]},masterFilter(e){return this.eventStore.resourceStore.isAvailable(e)}},highlightMultiSelectSpan:{$config:"lazy",value:null},snapMultiSelectNavigation:!0};setupWidgetConfig(e,t){const n=this;let r=super.setupWidgetConfig(...arguments);var i;("eventFilter"===r.ref&&(r.store=n.initialConfig.eventStore),"resourceFilter"===r.ref&&(r.type&&r.type!==n.resourceFilter.type||(r=HM.mergeConfigs(n.resourceFilter,r))),"datepicker"===r.type)&&(n.element.classList.add("b-has-datepicker"),n.element.classList.toggle("b-datepicker-with-events",Boolean(r.events)),null===(i=n.up("calendar"))||void 0===i||i.ion({rangeChange:"onCalendarViewRangeChange",thisObj:n}));return r}onInternalPaint({firstPaint:e}){var t;const{datePicker:n}=this.widgetMap;var r;e&&(this.getConfig("highlightMultiSelectSpan"),null!=n&&n.multiSelect&&(null===(r=this.owner)||void 0===r||r.eachView((e=>{e.isDateRangeOwner&&!e.fixedDuration&&!0===n.multiSelect&&(e.dateFilter=e.resourceDateFilter=({date:e})=>n.isSelected(e))})),this.onDatePickerSelectionChange({source:n,selection:n.selection},!0)));null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments)}updateHighlightMultiSelectSpan(e){const{datePicker:t}=this.widgetMap;t&&t.element.classList.toggle("b-highlight-selection",Boolean(e))}updateSide(e,t){const{classList:n}=this.element;n.remove(`b-sidebar-${t}`),n.add(`b-sidebar-${e}`),this.collapsible&&(this.collapsible.direction=e)}updateStepUnitText(e){const t=this,{prevButtonSidebar:n,nextButtonSidebar:r}=t.widgetMap;n&&(n.tooltip=e?t.L("L{Calendar.previous}",e):"",n.disabled=!e),r&&(r.tooltip=e?t.L("L{Calendar.next}",e):"",r.disabled=!e)}updateEventStore(e){const{resourceFilter:t,datePicker:n,eventFilter:r}=this.widgetMap;r&&(r.store=e),t&&(t.eventStore=e),n&&(n.eventStore=e)}onCalendarViewRangeChange({source:e,new:{startDate:t,endDate:n}}){const{datePicker:r}=this.widgetMap;e.isEventList&&!e.range&&"range"===(null==r?void 0:r.multiSelect)&&(r.selection=[t,n])}onDatePickerSelectionChange({source:e,selection:t,oldSelection:n,userAction:r},i){const s=this,{multiSelect:o}=e,[a,l]=[t[0],t[t.length-1]];if(s.UIdateChange=r,a){const[t,n]=[new Date(e.month.year,e.month.month,1),new Date(e.month.year,e.month.month+1,0)],r=o?xi.max(xi.min(a,n),t):a,c={};var d;if(o)null===(d=s.owner)||void 0===d||d.eachView((t=>{if(t.isDateRangeOwner&&!t.fixedDuration){const{_hidden:n}=t,d=e.getRange(!0===o);if(t.hasConfig("endDate")?(c.startDate=d.startDate,c.endDate=xi.add(d.endDate,t.isEventList?0:-1,"d")):c.range=d,!t.initialConfig.shiftIncrement&&s.snapMultiSelectNavigation){const t=!0===o?d:e.getRange(!0);c.shiftIncrement={unit:t.unit,magnitude:1}}i||xi.betweenLesser(t.date,a,l)||(c.date=r),t._hidden=!0,t.setConfig(c),t._hidden=n}})),s.isConfiguring||s.owner.eventStore.trigger("change");s.inOnDatePickerSelectionChange=!0,s.date=r,s.inOnDatePickerSelectionChange=!1,s.UIdateChange=!1}}changeDate(e,t){if(e="string"==typeof e?xi.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=xi.clearTime(e),!t||e-t)return e}updateDate(e,t){const n=this,{datePicker:r}=n.widgetMap;if(!n.isConfiguring&&r){const{multiSelect:i,selection:s}=r,o=n.owner.views.find((e=>e.isDateRangeOwner&&!e.fixedDuration&&e.isVisible));if(i&&o){const a=r.getRange(!0===i),l={date:e};let d;if(!n.inOnDatePickerSelectionChange){if(!0===i){const n=e>t,r={unit:"day",magnitude:Math.abs(xi.diff(a.startDate,o.startDate,"d"))};if(d=s.map((e=>xi.add(e,r.magnitude*(n?1:-1),r.unit))),a.wholeMonth){const e=d[d.length-1];let t=xi.getLastDateOfMonth(d[0]).getDate()-d.length;if(t<0)d.length+=t;else if(t)for(let n=xi.add(e,1,"d");t;t--,n=xi.add(n,1,"d"))d.push(n)}}else o.range?d=[e=o.snapDate(e),xi.add(xi.add(e,a),-1,"d")]:e>s[s.length-1]?(a.magnitude*=-1,d=[xi.add(xi.add(e,a),1,"d"),e]):e<s[0]&&(d=[e,xi.add(xi.add(e,a),-1,"d")]);d&&(l.selection=d)}r.setConfig(l)}else r.value=e}n.trigger("dateChange",{date:e,oldDate:t,userAction:Boolean(n.UIdateChange)})}}HM.initClass(),HM._$name="Sidebar";var VM=e=>class extends(jE(e||Qe)){static $name="CalendarStores";static configurable={defaultCalendar:null,crudManagerClass:FM,crudManager:null,timeZone:{$config:"lazy",value:null}};static defaultConfig={projectModelClass:kM};static get projectStores(){return{resourceStore:{dataName:"resources",listeners:{changePreCommit:"onCalendarStoreChange"}},eventStore:{dataName:"events",listeners:{changePreCommit:"onCalendarStoreChange"}},assignmentStore:{dataName:"assignments"},timeRangeStore:{dataName:"timeRanges",modelClass:TM},resourceTimeRangeStore:{dataName:"resourceTimeRanges",modelClass:TD}}}changeCrudManager(e){var t;const n=this;if(e&&!e.isCrudManager){e=(e.type||n.crudManagerClass).new({scheduler:n},e)}return null===(t=n.bindCrudManager)||void 0===t||t.call(n,e),n._crudManager=null,e}updateTimeZone(e){this.project.timeZone=e}get timeZone(){return this.project.timeZone}onBeforeTimeZoneChange({timeZone:e,oldTimeZone:t}){if(this.isConfiguring)return;const n=this,r=n.isCalendar?n.activeView:!n.calendar&&n;if(1===(null==r?void 0:r.duration)){const n=r.events.filter((e=>e.startDate>=r.startDate&&e.endDate&&e.endDate<=r.endDate));if(n.length){const i=n.map((e=>(e.startDate.getTime()+e.endDate.getTime())/2)),s=new Date(Math.floor(i.reduce(((e,t)=>e+t),0)/i.length)),o=null!=t?Sh.fromTimeZone(s,t):s,a=null!=e?Sh.toTimeZone(o,e):o;(a<r.startDate||a>r.endDate)&&((r.calendar||r).date=a)}}}onTimeZoneChange(){}get defaultCalendar(){const{eventStore:e}=this,t=W.hasOwn(this,"_defaultCalendar")?this._defaultCalendar:e.defaultCalendarId;if(null!==t)return null!=t?t.isResourceModel?t:e.resourceStore.getById(t):e.resourceStore.first}get defaultCalendarId(){return this.eventStore.modelClass.asId(this.defaultCalendar)}updateProject(e,t){super.updateProject(e,t);const n=this;n.getConfig("timeZone"),n.detachListeners("CalendarStores"),e&&(e.ion({name:"CalendarStores",dataReady:"onCalendarStoreChange",refresh:"onProjectRefresh",thisObj:n}),n.isConfiguring||(n.eachView((t=>{t.project=e})),n.onCalendarStoreChange({source:e})))}onProjectRefresh({source:e,isInitialCommit:t}){t&&e.eventStore.invalidateDayIndices()}updateEventStore(e){if(e&&!e.isCalendarEventStore){const t=this;Object.defineProperty(e,"defaultCalendar",{get:()=>t.defaultCalendar}),e.isCalendarEventStore=!0,"removeUnassignedEvent"in e.initialConfig||(e.removeUnassignedEvent=!1)}}get widgetClass(){}};const NM=e=>e.isCalendarMixin&&e.eventStore,BM=/(click|touch|mouse|pointer|key|context|dbl)(.*)/,zM=(e,t,n)=>`${N.capitalize(t)}${N.capitalize(n)}`;var jM=e=>class extends(e||Qe){static $name="SchedulerInterface";calendarHitTest(e){const{activeView:t}=this,n=Yn.getEventElement(e);return null!=t&&t.element.contains(n)?t.calendarHitTest(e):null}get timeAxis(){const e=this;return e._timeAxis||(e._timeAxis={get startDate(){return e.activeView.startDate},get endDateDate(){return e.activeView.endDate},isTimeSpanInAxis(e){return xi.intersectSpans(e.startDate,e.endDate,this.startDate,this.endDate)}}),this._timeAxis}get timeAxisViewModel(){const e=this;return e._timeAxisViewModel||(e._timeAxisViewModel={get timeResolution(){return e.activeView.timeResolution||{}}}),this._timeAxisViewModel}resolveEventRecord(e){var t;e instanceof Event&&(e=e.target);const n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(NM);return null==n?void 0:n.getEventRecord(e)}resolveAssignmentRecord(){}resolveResourceRecord(e){var t,n;const r=e.nodeType===Node.ELEMENT_NODE?e:e.target;return this.resourceStore.getById(null===(t=r.closest("[data-resource-id]"))||void 0===t?void 0:t.dataset.resourceId)||(null===(n=this.resolveEventRecord(r))||void 0===n?void 0:n.resource)}handleEvent(e){const t=(e=>e.type.replace(BM,zM))(e);if(super.handleEvent)super.handleEvent(e);else if(!e.handled&&!e.schedulerRedirected){var n;if(!1!==this.trigger(`beforeElement${t}`,{event:e,target:e.target}))null===(n=this[`onElement${t}`])||void 0===n||n.call(this,e);e.schedulerRedirected=!0}}getCellDataFromEvent(e){var t;return null===(t=super.getCellDataFromEvent)||void 0===t?void 0:t.call(this,e)}getDateFromDomEvent(e){var t;const n=null===(t=this.constructor.fromElement(e))||void 0===t?void 0:t.closest(NM);if(n)return n.getDateFromDomEvent(e)}getDateFromXY(e,t,n=!0,r){const i=this.activeSubView;if(i)return i.getDateFromPosition(e[0]-globalThis.scrollX,e[1]-globalThis.scrollY,n)}createEvent(){this.activeView.createEvent(...arguments)}get enableRecurringEvents(){return!0}intersectsVisibleTimeSpan(e){const{activeView:t}=this;return xi.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate)}getRowFor(){}suspendRefresh(){}resumeRefresh(){}get widgetClass(){}};yr.publishLocale({localeName:"En",localeDesc:"English (US)",localeCode:"en-US",localeRtl:!1,EventEdit:{Calendar:"Calendar","All day":"All day",day:"Day",week:"Week",month:"Month",year:"Year",decade:"Decade"},EventMenu:{duplicateEvent:"Duplicate",copy:"copy"},Calendar:{toggleSidebar:"Toggle sidebar visibility",Today:"Today",Tomorrow:"Tomorrow",next:e=>`Next ${e}`,previous:e=>`Previous ${e}`,plusMore:e=>`+${e} more`,moreEvents:e=>`${e} more events`,allDay:"All day",endsOn:e=>`Ends ${e}`,weekOfYear:([e,t])=>`Week ${t}, ${e}`,loadFail:"Calendar data load failed. Please contact your system administrator",gotoDate:"Go to date",timeRange:"Time range"},CalendarDrag:{holdCtrlForRecurrence:"Hold CTRL for a recurring event"},CalendarMixin:{eventCount:e=>`${e||"No"} event${1===e?"":"s"}`},EventTip:{"Edit event":"Edit",timeFormat:"LST"},ModeSelector:{includeWeekends:"Include weekends",weekends:"Weekends"},AgendaView:{Agenda:"Agenda"},MonthView:{Month:"Month",monthUnit:"month"},WeekView:{weekUnit:"week"},YearView:{Year:"Year",yearUnit:"year",noEvents:"No events"},EventList:{List:"List",Start:"Start",Finish:"End",days:e=>`${e>1?`${e} `:""}day${1===e?"":"s"}`},DayView:{Day:"Day",dayUnit:"day",daysUnit:"days",expandAllDayRow:"Expand all-day section",collapseAllDayRow:"Collapse all-day section",timeFormat:"LST",timeAxisTimeFormat:"LST",noMatchingDates:"No matching dates"},DayAgendaView:{dayAgenda:"Day Agenda"},DayResourceView:{dayResourceView:"Day resources"},Sidebar:{selectDate:"Select calendar date",matchEvents:"Match events",filterEvents:"Filter events by event name",filterResources:"Filter events by selected resource"},WeekExpander:{expandTip:"Click to expand row",collapseTip:"Click to collapse row"}});class WM extends Qe{static defaultSorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:n}=e,{startDate:r}=t;return n?r?n-r||t.durationMS-e.durationMS:1:-1}static interDaySorterFn(e,t){e=e.eventRecord||e,t=t.eventRecord||t;const{startDate:n,isInterDay:r}=e,{startDate:i,isInterDay:s}=t;return n?i?r!==s?Number(s)-Number(r):(r||s)&&(t.durationMS-e.durationMS||t.endingDate-e.endingDate)||n-i:1:-1}}WM._$name="EventSorter";const UM=Object.freeze({}),{eventNameMap:GM}=Jt,YM=e=>e.isCalendarMixin&&e.containsFocus;var qM=e=>class t extends((e||Qe).mixin(AE,jM,ag,VM,OM,wv)){static $name="CalendarMixin";static get configurable(){return{localizableProperties:["autoCreate.newName","timeFormat","shortDateFormat","shortDateTimeFormat"],contentElMutationObserver:null,eventStore:null,resourceStore:null,eventSorter:WM.defaultSorterFn,responsive:{},hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",weekStartDay:xi.weekStartDay,nonWorkingDays:{value:xi.nonWorkingDays,$config:{merge:"replace"}},nonWorkingDayCls:"b-nonworking-day",dayCellCls:"b-calendar-cell",weekendCls:"b-weekend",todayCls:"b-today",pastEventCls:"b-past-event",shortEventCls:"b-short-event",shortEventDuration:"30 minutes",eventHeight:25,eventSpacing:2,intradayCls:"b-intraday",alldayCls:"b-allday",solidBarCls:"b-solid-bar",dayNameSelector:".b-day-name",showTime:!1,timeFormat:{value:"LT",$config:{localeKey:"L{timeFormat}"}},showBullet:{bar:!1,noBar:!0},eventColourStyleProperty:"color",handlePointerInteraction:!0,shortDateFormat:{value:"ll",$config:{localeKey:"L{shortDateFormat}"}},title:null,shortDateTimeFormat:{value:"ll LT",$config:{localeKey:"L{shortDateTimeFormat}"}},readOnly:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",snapType:"round",duration:"1 hour",startHour:8},dragUnit:"hour",autoRefresh:{$config:{merge:"classList"},value:null},allowOverlap:!0,syncViewDate:!0,syncCalendarDate:!0,focusable:!1,avatarRendering:{$config:"lazy",value:null},showResourceAvatars:null,resourceImagePath:null,minDate:null,maxDate:null,animateTimeShift:!0,includeTimeRanges:null,defaultScrollOptions:{animate:!0},selectorButton:null,selectorMenuItem:null,testConfig:{animateTimeShift:!1},extendAllDayEndDay:null,activationKey:null,keyMap:{"Ctrl+z":"undoRedoDataChange","Shift+Ctrl+z":"undoRedoDataChange"}}}static get delayable(){return{refreshSoon:{type:"raf",cancelOutstanding:!0}}}static get featureable(){return{factory:IM}}construct(e){var t;const n=this;super.construct(e),n.isYearView||-1===n.element.tabIndex||-1===(null===(t=n.contentElement)||void 0===t?void 0:t.tabIndex)||((n.contentElement||n.element).tabIndex=-1),n.getConfig("avatarRendering"),Jt.on({element:n.element,keydown:"onCalendarKeyDown",thisObj:n}),n.handlePointerInteraction&&(Jt.on({element:n.element,mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:{handler:"onCalendarPointerInteraction",block:300},dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction",thisObj:n}),Jt.on({element:n.element,mouseenter:"onEventMouseEnterLeave",mouseleave:"onEventMouseEnterLeave",capture:!0,thisObj:n}))}focusDate(e=this.date){var t;const n=this,r=n.eventContentElement||n.contentElement;e=n.ingestDate(e);let i=null===(t=n.getDayElement)||void 0===t?void 0:t.call(n,e);i&&!Yn.isFocusable(i)&&(i=i.querySelector('[role="link"]')),i&&Yn.isFocusable(i)||(i=[...r.querySelectorAll("*")].find(Yn.isFocusable)),(i||n).focus({preventScroll:!0,focusVisible:!0})}getTimeRanges(e,t){const{resourceId:n,project:r}=this,i=!n||this.owner.includeTimeRanges,s=null==n||i?null==r?void 0:r.getTimeRanges(e,t):[];if(null!=n){const i=null==r?void 0:r.getResourceTimeRanges(e,t).filter((e=>e.resourceId==n));i.forEach((e=>{e.color||(e.color=this.resource.eventColor)})),s.push(...i)}return s}updateIncludeTimeRanges(){this.isConfiguring||this.refresh()}onConfigChange(e){var t;null!==(t=this.autoRefresh)&&void 0!==t&&t[null==e?void 0:e.name]&&this.refreshSoon(),super.onConfigChange(e)}changeAvatarRendering(e){return Sv.new({element:this.element},e)}updateShowResourceAvatars(e){e&&(this.avatarRendering||(this.avatarRendering=!0)),this.refresh()}getResourceAvatar(e){return this.avatarRendering.getResourceAvatar({resourceRecord:e,imageUrl:!1===e.image?null:e.imageUrl||e.image&&this.resourceImagePath+e.image,color:e.eventColor,initials:e.initials,dataset:{btip:N.encodeHtml(e.name),resourceId:e.id}})}updateEventHeight(e){const{style:t}=this.element;this._eventHeightInPixels=null,t.setProperty("--event-height",Yn.setLength(e)),t.setProperty("--arrow-width","calc(var(--event-height) / 3)"),t.setProperty("--arrow-margin","calc(var(--event-height) / -3)"),this.isConfiguring||this.refreshSoon()}get eventHeightInPixels(){const e=this,{eventHeight:t}=e;let n=e._eventHeightInPixels;return"auto"!==t&&(n||(n=e._eventHeight,"string"==typeof n&&(n=Yn.measureSize(n,e.contentElement.querySelector(`.${e.eventBarContainerCls}`),!1)),e._eventHeightInPixels=n)),n}get visibleCellSelector(){const e=[];return this.hideOtherMonthCells&&e.push(`.${this.otherMonthCls}`),this.hideNonWorkingDays&&e.push(`.${this.nonWorkingDayCls}`),`.${this.dayCellCls}${e.length?`:not(${e.join(",")})`:""}`}get activeView(){return this}get activeSubView(){var e;return(null===(e=this.items)||void 0===e||null===(e=e.filter(YM))||void 0===e?void 0:e[0])||this}eachView(e,t,n=null){this.callback(e,n||this,t||[this])}get focusElement(){const{calendar:e}=this;if(e){const{navigator:t}=e;return t.activeItem||t.previousActiveItem||this.element.querySelector(t.itemSelector)||super.focusElement}}captureFocusItem(e){const t=this.getEventRecord(e),n=super.captureFocusItem(e);return(e=!0)=>{const r=t&&this.getEventElement(t);r?e?r.focus():r.focus({preventScroll:!0}):null==n||n(e)}}refresh(){this.refreshSoon.cancel(),this.month&&this.element.style.setProperty("--week-length",this.month.weekLength),this.whenVisible("refreshNow")}refreshNow(){const e=this.captureFocus();this.doRefresh(),e()}afterRefresh(e,t={delay:100,forceRefresh:!1}){return"object"==typeof e?(t=e,e=null):e&&(e=(e=this.resolveCallback(e,this)).handler.bind(e.thisObj)),"number"==typeof t&&(t={delay:t}),new Promise((n=>{this.ion({name:this.constructor.generateId("refresh-expiry-timer-"),refresh:()=>{var t;null===(t=e)||void 0===t||t(),n(!0)},once:!0,expires:{delay:t.delay||100,alt:()=>{var r;t.forceRefresh&&this.refresh(),null===(r=e)||void 0===r||r(),n(t.forceRefresh)}}})}))}get displayName(){return N.capitalize(this._displayName||this.title||this.type)}get hasNonWorkingDays(){return Boolean(Object.values(this.nonWorkingDays||UM).some((e=>e)))&&!(this.isDayView&&1===this.duration)}get hiddenNonWorkingDays(){return this.hideNonWorkingDays?this.nonWorkingDays||this.month.nonWorkingDays:UM}changeAutoCreate(e){if(e){const n=typeof e;"object"!==n&&(e={gesture:"string"===n?e:"dblclick"}),(e=ke.merge(e,t.$meta.config.autoCreate)).durationUnit=qs.from(e.duration).unit}return e}updateDateSeparator(){this.refreshCalendarDescription()}updateDescriptionFormat(){this.refreshCalendarDescription()}refreshCalendarDescription(){const{calendar:e}=this;null!=e&&e.isPainted&&e.activeView===this&&e.updateViewDescription()}changeShortEventDuration(e){return isNaN(e)?xi.as("ms",e):Number(e)}updateShortEventDuration(){this.isConfiguring||this.setTimeout({fn:"whenVisible",delay:200,cancelOutstanding:!0,args:["refreshNow"]})}updateLocalization(){"weekStartDay"in this.initialConfig||(this.weekStartDay=xi.weekStartDay),"nonWorkingDays"in this.initialConfig||(this.nonWorkingDays=xi.nonWorkingDays),super.updateLocalization(),this.refreshCalendarDescription()}updateAutoCreate(e){this.updateLocalization()}updateWeekStartDay(e){var t;const{refreshCount:n,month:r}=this;null===(t=super.updateWeekStartDay)||void 0===t||t.call(this,e),r&&(r.weekStartDay=e),this.isPainted&&this.refreshCount===n&&this.refresh()}changeNonWorkingDays(e){const t=this,n=new Proxy(W.assign({},e),{set(e){const n=Reflect.set(...arguments);return t.updateNonWorkingDays(e),n},deleteProperty(e){const n=Reflect.deleteProperty(...arguments);return t.updateNonWorkingDays(e),n}});return n}updateNonWorkingDays(e){var t;const{refreshCount:n,month:r}=this;null===(t=super.updateNonWorkingDays)||void 0===t||t.call(this,e),r&&(r.nonWorkingDays=e),this.isPainted&&this.refreshCount===n&&this.refresh()}dayOfDate(e){return xi.clearTime(e)}ingestDate(e){if(e="string"==typeof e?xi.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");return this.dayOfDate(e)}changeDate(e,t){const n=this,{isEventList:r}=n,i=n.ingestDate(e),s=r&&!n.range?"betweenLesserEqual":"betweenLesser";if(e=n.constrainTargetDate(i),1===arguments.length)return e;if((!t||e-t)&&!1!==n.trigger("beforeDateChange",{date:e,oldDate:t})){const t=xi.diff(i,e,"d");if(!t||!xi[s](e,n.startDate,n.endDate))return e;if(r&&n.rowManager.rowCount){const r=n[t<0?"lastFullyVisibleRow":"firstFullyVisibleRow"],i=r&&n.getDateFromElement(r.cells[0]);i&&(e=i)}n._date=e}}constrainTargetDate(e,t){var n,r;const i=this,s=i.minDate||(null===(n=i.calendar)||void 0===n?void 0:n.minDate),o=i.maxDate||(null===(r=i.calendar)||void 0===r?void 0:r.maxDate);if(!(i.isInCoerceTargetDate||isNaN(s)&&isNaN(o))){i.isInCoerceTargetDate=!0;const n=t?i[`change${N.capitalize(t)}Date`](e,null):e;if(i.isInCoerceTargetDate=!1,!isNaN(s)&&n<s)return s;if(!isNaN(o)&&n>o)return o}return e}changeStartDate(e){if(e)return this.ingestDate(e)}changeEndDate(e){if(e)return this.ingestDate(e)}async scrollTo(e,t){const n=this,{scrollable:r}=n;if(await n.scrollPromise,t=W.assign({},n.defaultScrollOptions,"boolean"==typeof t?{animate:t}:t),e.isEvent){const t=e;xi.intersectSpans(n.startDate,n.endDate,e.startDate,e.endDate)||(n.date=e.startDate),(e=n.getEventElement(e))||(n.refresh(),e=n.getEventElement(t))}else e=n.ingestDate(e),xi.betweenLesser(e,n.startDate,n.endDate)&&n.getDayElement(e,!0)||(n.date=e),e=n.getDayElement(e);if(null!=e)return r?n.scrollPromise=r.scrollIntoView(e,t).then((()=>n.scrollPromise=null)):t.highlight&&("boolean"==typeof t.highlight?Yn.highlight(Ot.from(e)):n.callback(t.highlight,n,[e,n])),n.scrollPromise}async checkAutoCreateGesture(e,t,n){var r;const i=this,{autoCreate:s}=i;if(t&&i.isVisible&&!i.readOnly&&e.type===(null==s||null===(r=s.gesture)||void 0===r?void 0:r.toLowerCase())){const r=xi.startOf(t,void 0,void 0,i.weekStartDay),o=isNaN(s.startHour)?xi.getTimeOfDay(xi.parse(s.startHour,"HH:mm:ss")):1e3*s.startHour*60*60;if(!1!==i.trigger("beforeAutoCreate",{view:i,domEvent:e,date:i.isDayView?xi[s.snapType](t,s.step):xi.add(r,o),resourceRecord:n}))return i.createEvent(t,n,!0)}}createEvent(e,t,n){var r;(this.calendar||(null===(r=this.owner)||void 0===r?void 0:r.calendar)||this).doCreateEvent(e,t,this,n)}async doCreateEvent(e,t,n=this,r){var i;t=t??this.defaultCalendar;const s=this,{isDayView:o}=s.viewType||s,a=s.calendar||(null===(i=s.owner)||void 0===i?void 0:i.calendar),l=(null==a?void 0:a.eventStore)||s.eventStore,d=n.autoCreate||n.changeAutoCreate(!0),{modelClass:c}=l,{newName:u}=d;if(null==e||!o&&r){const{dayStartHour:t,dayEndHour:n}=s.activeView,r=Math.min(Math.max(d.startHour,t),n),i=r===n?t:r,o=isNaN(i)?isNaN(d.startHour)?xi.getTimeOfDay(xi.parse(d.startHour,"HH:mm:ss")):36e5*d.startHour:36e5*i;e=xi.add(e||s.date,o)}const h=xi.parseDuration(d.duration),g=new Date(e.getTime()+(s.dayStartShift||0)),m=o?xi[d.snapType](e,d.step):g,p=o&&r?{magnitude:s.dayTime.startShift?Math.min(h.magnitude,xi.diff(m,xi.add(s.dayTime.startOfDay(e),s.dayTime.duration(),"ms"),h.unit)):Math.min(h.magnitude,xi.diff(m,xi.add(xi.startOf(e),s.dayTime.timeEnd),h.unit)),unit:h.unit}:h,f=xi.add(m,p.magnitude,p.unit),v=s.resolveCallback(u,s,!1)?s.callback(u,s,[s,m,t]):u,y={[c.getFieldDataSource("name")]:v,[c.getFieldDataSource("startDate")]:m,[c.getFieldDataSource("endDate")]:f,[c.getFieldDataSource("duration")]:p.magnitude,[c.getFieldDataSource("durationUnit")]:p.unit,allDay:1===xi.diff(m,f,"day")},b=n.isEventList&&!n.range?"betweenLesserEqual":"betweenLesser",C=l.createRecord(y);null!=a&&a.features.eventEdit&&!a.features.eventEdit.disabled&&(C.isCreating=!0),t&&l.assignmentStore.assignEventToResource(C,t),await l.addAsync(C),xi[b](m,n.startDate,n.endDate)&&(n.getEventElement(C,m)?n.editAutoCreatedEvent(C):n.ion({refresh({source:e}){var t;null===(t=e.editAutoCreatedEvent)||void 0===t||t.call(e,C)},once:!0,prio:-1e4,buffer:100,expires:500}))}editAutoCreatedEvent(e){this.trigger("eventAutoCreated",{eventRecord:e})}get duration(){return this.endDate?this.calculateDuration(this.startDate,this.endDate):1}calculateDuration(e,t){return xi.diff(e,t,"day")}next(){this.date=xi.add(this.date,this.duration,"day")}previous(){this.date=xi.add(this.date,-this.duration,"day")}get eventContentElement(){return this.contentElement}get eventCount(){const e=this,{dateFilter:t,hiddenNonWorkingDays:n}=e;return e.views?e.views.reduce(((e,t)=>e+(t.eventCount||0)),0):e.cellMap?[...e.cellMap.values(),...(null===(r=e.allDayEvents)||void 0===r?void 0:r.cellMap.values())||[]].reduce(((r,i)=>(t&&!e.callback(t,e,[i])||n[i.day]||(r+=i.events.length),r)),0):e.eventStore.getEvents({startDate:e.startDate,endDate:e.endDate}).length;var r}get firstVisibleCell(){return this.eventContentElement.querySelector(this.visibleCellSelector)}get lastVisibleCell(){const e=this.contentElement.querySelectorAll(this.visibleCellSelector);return e[e.length-1]}get firstVisibleDate(){const e=this,t=new Date(e.startDate),{month:n}=e.month;let{duration:r}=e;for(;r&&(e.hideOtherMonthCells&&t.getMonth()!==n||e.hiddenNonWorkingDays[t.getDay()]);)t.setDate(t.getDate()+1),r--;return t}get lastVisibleDate(){const e=this,t=xi.add(e.endDate,-1,"d"),{month:n}=e.month;let{duration:r}=e;for(;r&&(e.hideOtherMonthCells&&t.getMonth()!==n||e.hiddenNonWorkingDays[t.getDay()]);)t.setDate(t.getDate()-1),r--;return t}updateHideNonWorkingDays(e){var t,n;const r=this,{month:i,calendar:s}=r;if(null===(t=r.contentElement)||void 0===t||t.classList[e?"add":"remove"](r.hideNonWorkingDaysCls),null==i)return;let o,a,l;var d;!r.isConfiguring&&e&&(a=r.date,l=null===(d=a)||void 0===d?void 0:d.getDay(),a&&r.nonWorkingDays[l]&&r.getDayElement(a)&&(o=i.visibleDayColumnIndex[l]));if(i.hideNonWorkingDays=e,null===(n=super.updateHideNonWorkingDays)||void 0===n||n.call(this,e),"number"==typeof o){const e=i.getWeekStart(i.getWeekNumber(a)),t=Math.min(o,i.visibleColumnCount-1);for(let n=-1;"number"!=typeof i.visibleDayColumnIndex[e.getDay()]||++n!==t;e.setDate(e.getDate()+1));r.date=e,s&&(s.date=a)}}onCalendarStoreChange({source:e,action:t}){const n=this;var r;("dataset"!==t||e.isChained)&&(n.project.isInitialCommitPerformed&&!n.project.isWritingData&&n.project.isEngineReady()&&(null===(r=n._cellMap)||void 0===r||r.clear(),n.isVisible&&null==n.allowTransitionsOnRefresh&&(n.allowTransitionsOnRefresh=!0),n.refreshSoon()))}refreshSoon(){this.refresh()}onEventCreated(e){}getEventRecord(e){var t,n;let r=e instanceof Event?e.target:e;return r=null===(t=r)||void 0===t||null===(n=t.closest)||void 0===n?void 0:n.call(t,"[data-event-id]"),r&&this.eventStore.getById(r.dataset.eventId)}getResourceRecord(e){var t;let n=e instanceof Event?e.target:e;return n=(null===(t=n)||void 0===t?void 0:t.closest("[data-resource-id]"))||null,n&&this.resourceStore.getById(n.dataset.resourceId)}resolveEventRecord(e){return this.getEventRecord(e)}getDateFromElement(e,t=null,n=!1){let r=null==e?void 0:e.closest("[data-date],[data-header-date],[data-month-date]");if(r){const e=r.dataset.date||r.dataset.headerDate||r.dataset.monthDate;return n?e:(t||(this.isDayView?this.dayTime:xi)).parseKey(e)}var i;if(r=null==e?void 0:e.closest("[data-week]"),r)return null===(i=this.month)||void 0===i?void 0:i.getWeekStart(r.dataset.week.split(",").map(Number))}getDateFromDomEvent(e){return this.getDateFromElement(Yn.getEventElement(e))}getDateFromPosition(){return null}dateKey(e){return xi.makeKey(e)}getDayElement(e,t){return"string"!=typeof e&&(e=this.dateKey(e)),this.eventContentElement.querySelector(`[data-date="${e}"]`)}getDayElementFromX(e){const t=this.eventContentElement.querySelectorAll("[data-date]");for(let n,r,i=0,{length:s}=t;i<s;i++)if(n=(r=t[i]).getBoundingClientRect(),e>=n.x&&e<=n.x+n.width)return r;return t[0]}getEventElement(e,t=Math.max(e.startDate,this.firstVisibleDate||this.startDate)){var n;const r=this,i=null===(n=r.calendar)||void 0===n?void 0:n.navigator.activeItem,s=r.getDateFromElement(i),o=r.eventStore.modelClass.asId(e);if(document.contains(i)&&(null==i?void 0:i.dataset.eventId)===String(o)&&s&&!(t-s))return i;if(t){const e=r.getDayElement(t);if(e)return Yn.down(e,`[data-event-id="${o}"]`)}return r.getEventElements(e)[0]}getEventElements(e){const t=this.eventStore.modelClass.asId(e);return this.eventContentElement.querySelectorAll(`[data-event-id="${t}"]`)}onEventMouseOverOut(e){const t=this,{currentOverEventEl:n}=t,r="mouseout"===e.type,i=e[r?"relatedTarget":"target"],s=(null==i?void 0:i.closest(".b-cal-event-wrap"))||null;if(s!==(n||null))return r?(t.currentOverEventEl=null,n&&Object.defineProperty(e,"target",{configurable:!0,get:()=>n}),t.onCalendarPointerInteraction(e)):(t.currentOverEventEl=s,t.onCalendarPointerInteraction(e))}onEventMouseEnterLeave(e){if(e.target.classList.contains("b-cal-event"))return this.onCalendarPointerInteraction(e)}calendarHitTest(e){const t=this,{monthSelector:n}=t,r=t.getDateFromDomEvent(e),i=Yn.getEventElement(e);let s,o,a=null;if((s=i.closest(".b-cal-event-wrap"))&&(o=t.eventStore.getById(s.dataset.eventId)))a={type:"event",eventElement:s,eventRecord:o};else if(s=i.closest(t.dayNameSelector))a={type:"dayNumber",dayNumberElement:s};else if(s=i.closest(".b-week-num,.b-week-number-cell")){const e=i.closest(".b-calendar-week");e&&e.dataset.week&&(a={type:"weekNumber",week:e.dataset.week.split(",").map(Number),weekNumberElement:s,weekElement:e})}else n&&i.closest(n)&&(a={type:"monthName",month:r.getMonth(),date:r});return a||((s=i.closest(".b-cal-cell-overflow"))?a={type:"cellOverflow",cellOverflowElement:s}:r&&(a={type:"schedule"})),a&&(a.resource=t.getResourceRecord(e),a.cell=i.closest(".b-calendar-cell"),a.date=r,a.view=t),a}onCalendarPointerInteraction(e){const t=this,{monthSelector:n}=t,{target:r}=e,i=Boolean(r.closest(".b-overflowpopup")),s=GM[e.type],o=r.closest(".b-cal-event-wrap"),a=o?t.eventStore.getById(o.dataset.eventId):t.getEventRecord(r),l=!i&&t.isDayCellRenderer&&(null==a?void 0:a.isInterDay),d=!e.key&&l?t.getDateFromXY([e.clientX,e.clientY]):t.getDateFromDomEvent(e),c=o||a&&t.getEventElement(a,d),u=r.closest("[data-resource-id]"),h=u&&t.resourceStore.getById(u.dataset.resourceId);let g;if(h&&(g=t.trigger(`resource${s}`,{domEvent:e,date:d,eventElement:c,eventRecord:a,resourceRecord:h,fromOverflowPopup:i})),r.closest(t.dayNameSelector)&&(g=t.trigger(`dayNumber${s}`,{domEvent:e,date:d,cellData:t.cellMap.get(d)||t.createCellData(d),resourceRecord:h,fromOverflowPopup:i}),!1===g))return g;if(i||t.eventContentElement.contains(r)){if(!1!==g&&a){const n=t.trigger(`event${s}`,{domEvent:e,date:d,eventElement:c,eventRecord:a,resourceRecord:h,fromOverflowPopup:i});n&&(g=n)}if(a)return g;if(r.closest(".b-week-num,.b-week-number-cell")){const n=e.target.closest("[data-week]");if(n)return t.trigger(`weekNumber${s}`,{domEvent:e,week:n.dataset.week.split(",").map(Number),date:t.getDateFromElement(n.querySelector(".b-calendar-cell")),fromOverflowPopup:i})}if(n&&r.closest(n))return t.trigger(`monthName${s}`,{domEvent:e,month:d.getMonth(),date:d,fromOverflowPopup:i});if(!r.closest(".b-cal-cell-overflow")||!1===t.trigger(`cellOverflow${s}`,{domEvent:e,date:d,fromOverflowPopup:i,resourceRecord:h}))return d&&t.dayCellCls&&e.target.closest(`.${t.dayCellCls}`)&&(g=t.trigger(`schedule${s}`,{domEvent:e,date:d,fromOverflowPopup:i,resourceRecord:h}),!1===g)||t.checkAutoCreateGesture(e,t.getDateFromDomEvent(e,!0),h||void 0),g}}undoRedoDataChange(e){var t,n;if(null!==(t=this.calendar)&&void 0!==t&&t.enableUndoRedoKeys)return null===(n=this.project)||void 0===n||null===(n=n.stm)||void 0===n?void 0:n.onUndoKeyPress(e)}onCalendarKeyDown(e){this.onCalendarPointerInteraction(e)}isAllDayEvent(e){return e.allDay||(e.isScheduled&&this.dayTime?this.dayTime.isInterDay(e):e.isInterDay)}sortEvents(e){e.sort(this.eventSorter)}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.calendar,delete e.project}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.project,t}};class KM extends Array{firstFreeSlot=0;set(e,t){const n=this;if(null==e)return n.add(t);if(n[e]=t,n.firstFreeSlot===e)for(;n[n.firstFreeSlot];)n.firstFreeSlot++}add(e){const t=this.firstFreeSlot;for(this[t]=e;this[this.firstFreeSlot];)this.firstFreeSlot++;return t}setEvents(e){const t=this.length=this.firstFreeSlot=e.length;for(let n=0;n<t;n++)this[n]=e[n]}}KM._$name="EventSlots";const XM=({key:e},{key:t})=>e<t?-1:t<e?1:0,ZM=e=>e.endDate||xi.add(e.startDate,e.duration,e.durationUnit);var JM=e=>class extends(e||Qe){static $name="DayCellCollecter";static configurable={eventFilter:{$config:"lazy",value:null},stackMultiDayEvents:null};get dayTime(){return Dg.MIDNIGHT}get cellMonth(){return this._cellMonth||(this._cellMonth=new kg({}))}changeEventFilter(e){if("string"==typeof e){const{handler:t,thisObj:n}=this.resolveCallback(e);e=t.bind(n)}return e}updateStackMultiDayEvents(){this.whenVisible("refresh")}createCellMap(e={}){const t=this,{filter:n,skipPropagate:r}=e,{eventFilter:i,cellMonth:s,lastVisibleDate:o}=t,a=e.cellMap||t._cellMap||(t._cellMap=new QM);t.stackMultiDayEvents&&(t.eventSorter=WM.defaultSorterFn),o&&o.setDate(o.getDate()+1);let l=e.startDate||t.firstVisibleDate||t.startDate,d=e.endDate||o||t.endDate;if(s.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:l}),t.eventStore){e=W.assign({dayTime:Dg.MIDNIGHT},e,{filter:n&&i?e=>n(e)&&i(e):n||i,dateMap:a,startDate:l,endDate:d}),t.collectEvents(e),l=e.startDate,d=e.endDate;for(const n of[...a.keys()]){let i=0;const s=e.dayTime,o=s.dayOfDate(xi.parseKey(n)),c=t.createCellData(o),u={events:a.get(n),date:o};t.sortEvents(u.events,o),t.trigger("dayCellPopulated",u);const h=u.events;if(e.rawEvents?(i=Math.min(d,Math.max.apply(Math,h.map(ZM))),c.events=h):c.events=h.map((e=>{const n=e.endingDate,s=n>c.tomorrow,a={isAllDay:t.isAllDayEvent(e),isOverflow:e.startDate<c.date&&o-l,eventRecord:e,eventEndDate:n,overflows:s,date:o};return r||(i=Math.min(d,Math.max(i,n)),s&&(a.propagateEndDate=t.calculatePropagateEndDate(a,d))),a})),!r)for(;o<i;o.setDate(o.getDate()+1)){const e=s.dateKey(o);a.has(e)||a.set(e,t.createCellData(o))}a.set(n,c)}if(a.size){const e=[...a.values()].sort(XM);let n;a.clear(),e.forEach((e=>{a.set(e.key,e),n&&(n.nextEvents=e,e.previousEvents=n),n=e})),r||t.propagateCellEvents(e[0],a)}}return a.populated=!0,t.trigger("cellMapPopulated",{cellMap:a}),a}calculatePropagateEndDate(e,t=this.endDate){const{eventEndDate:n}=e,r=this.dayTime.startOfDay(n);return e.propagateEndDate=new Date(Math.min(n>r?xi.add(r,1,"day"):n,t)),this.trigger("eventPropagate",e),e.propagateEndDate}collectEvents(e){return this.eventStore.getEvents(e)}propagateCellEvents(e,t){const n=this,{events:r,renderedEvents:i,previousEvents:s,nextEvents:o,date:a}=e,{stackMultiDayEvents:l}=n,d=n.getEventsPerCell(a),{length:c}=r;for(let t=0;t<c;t++){const n=r[t],{eventRecord:s,propagateEndDate:a,eventEndDate:d}=n;let c=i.add(n);if(n.overflows){let t,r=e.visible;for(let e=o;e&&e.date<a;e=e.nextEvents)e.columnIndex&&!l||(c=e.renderedEvents.firstFreeSlot),e.renderedEvents.set(c,t={eventRecord:s,eventEndDate:d,propagateEndDate:a,isAllDay:n.isAllDay,isOverflow:r,overflows:!0}),r=r||e.visible;t&&(t.overflows=!1)}}e.maxRow=i.length;const u=i[d-1];if(i.length===d)null!=u&&u.isOverflow&&null!=s&&s.hasOverflow&&(e.maxRow--,e.hasOverflow=!0);else if(i.length>d&&(e.maxRow=d-1,e.hasOverflow=!0,null!=u&&u.isOverflow&&!n.hiddenNonWorkingDays[e.day])){var h;const r=(null===(h=n.getWeekContext)||void 0===h?void 0:h.call(n,a).visibleWeekStart)||n.firstVisibleDate,i=xi.clearTime(u.eventRecord.startDate).valueOf();let s=t.get(xi.makeKey(new Date(Math.max(r,i))));for(;s.key!==e.key;)s.hasOverflow=!0,s.maxRow=d-1,s=s.nextEvents}o&&n.propagateCellEvents(o,t)}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month,this.dayTime),{view:this,events:[],resource:this.resource,renderedEvents:new KM})}};class QM extends Map{populated=!1;get(e,t){return super.get(xi.makeKey(e),t)}set(e,t){return e=xi.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.set(e,t)}delete(e,t){return e=xi.makeKey(e),this.has(e)&&this.generation++,super.delete(e,t)}has(e){return super.has(xi.makeKey(e))}clear(){if(this.populated)return this.populated=!1,this.generation=(this.generation||0)+1,super.clear()}}class ek extends eh{static $name="OverflowPopup";static type="overflowpopup";static configurable={defaultFocus:".b-cal-event-wrap",textContent:!1,autoShow:!1,floating:!1,cls:"b-cal-event-list",closable:!0,draggable:{handleSelector:":not(.b-cal-event-wrap)"},anchor:!0,layout:"vbox",eventRenderer:null,eventSorter:null,eventList:{type:"widget",cls:"b-cal-event-bar-container",weight:500},items:{},tools:{maximize:null},dateFormat:"dddd, MMM DD",activeDate:{$config:{equal:"date"},value:null},scrollAction:"realign",align:{axisLock:"flexible",constrainPadding:20,minHeight:400},scrollable:{overflowY:"auto"},onlyShowOverflow:null};calendarHitTest(e){const t=Yn.getEventElement(e).closest(".b-cal-event-wrap");let n;return t&&(n=this.owner.eventStore.getById(t.dataset.eventId))?{eventRecord:n,type:"event",eventElement:t,view:this}:null}onPanelHeaderClick({event:e}){var t;e.target.closest(".b-header-title")?null===(t=this.owner)||void 0===t||t.trigger("dayNumberClick",{domEvent:e,date:this.activeDate,cellData:this.cellData,source:this.owner,fromOverflowPopup:!0}):super.onPanelHeaderClick(...arguments)}get focusElement(){var e;const t=Yn.getActiveElement(this);return this.element.contains(t)?t:(null===(e=this.eventList)||void 0===e||null===(e=e.element)||void 0===e?void 0:e.firstElementChild)||super.focusElement}getDateFromPosition(){return this.activeDate}getEventElement(e){return this.contentElement.querySelector(`[data-event-id="${e.id}"]`)}showOverflow(e,t){const n=this,r=n.activeDate=t.date;var i;(n.cellData=t,n.targetCell=e,t.resource&&(n.element.dataset.resourceId=t.resource.id),n.refresh(t),n.showBy(e),n.isVisible)&&(null===(i=n.owner)||void 0===i||i.trigger("showOverflowPopup",{cell:e,cellData:t,date:r,overflowPopup:n}))}onCalendarStoreChange(){const e=this;e.isVisible&&(e.cellData=e.owner.cellMap.get(xi.makeKey(e.activeDate)),e.refresh(e.cellData))}refresh(e){var t,n;if(!this.eventList)return;e?this.cellData=e:e=this.cellData;const r=this,{owner:i,eventRenderer:s,eventSorter:o}=r,{element:a}=r.eventList,l=r.onlyShowOverflow?Math.max(i.eventsPerCell-1,0):0,d=null===(t=e)||void 0===t?void 0:t.renderedEvents.slice(l),c=[];if(null==d||!d.length||(null===(n=e)||void 0===n||!n.hasOverflow)&&!i.isYearView)return r.hide();o&&d.sort(o);for(let t=0,n=0,{length:r}=d;t<r;t++,n++){const n=d[t];if(n){const t=i.createEventDomConfig(n,s);Object.assign(t.className,{"b-continues-past":n.eventRecord.startDate<e.date,"b-continues-future":n.eventRecord.endDate>e.tomorrow}),t.style.marginBottom=`${i.eventSpacing}px`,c.push(t)}}ud.sync({domConfig:{children:c},targetElement:a}),a.dataset.date=e.key,a.classList.add(`b-day-of-week-${e.day}`),a.classList.remove(`b-day-of-week-${r.lastRefreshDay}`),r.lastRefreshDay=e.day,r.realign()}changeItems(e){const{eventList:t}=this;t&&(e.eventList=t);const n=super.changeItems(e);return t&&(this.eventList=this.widgetMap.eventList),n}changeActiveDate(e,t){if(e="string"==typeof date?xi.parse(e):new Date(e),isNaN(e))throw new Error("OverflowPopup date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}updateActiveDate(e){this.element.dataset.date=xi.makeKey(e),this.title=`<span tabIndex="0" role="link" aria-label="${xi.format(e,"dddd, D MMMM")}">${xi.format(e,this.dateFormat)}</span>`}onDocumentMouseDown({event:e}){var t;const n=null===(t=this.lastAlignSpec)||void 0===t?void 0:t.target,{target:r}=e;if(null!=n&&n.contains(r)){const t=r.closest(".b-cal-cell-overflow");if(r.closest(".b-cal-event-bar-container")||r.matches(".b-cal-cell-overflow")||1===(null==t?void 0:t.children.length))return e.preventDefault()}super.onDocumentMouseDown(...arguments)}}ek.initClass(),ek._$name="OverflowPopup";const tk=()=>{},{eventNameMap:nk}=Jt;var rk=e=>class extends(e||Qe){static $name="DayCellRenderer";static get configurable(){return{monitorResize:!0,dayCellRenderer:null,dynamicHideNonWorkingdayCls:"b-dynamic-nonworking-day",overflowPopup:{$config:["lazy","nullify"],value:{type:"overflowpopup"}},overflowPopupTrigger:"click",eventBarContainerCls:"b-cal-event-bar-container",overflowButtonRenderer:null,dayCellNameFormat:null,eventSpacing:2,emptyCellCls:"b-cal-empty-cell",emptyCellRenderer:null}}onCalendarStoreChange(){var e;super.onCalendarStoreChange(...arguments),null!==(e=this._overflowPopup)&&void 0!==e&&e.isVisible&&this._overflowPopup.onCalendarStoreChange(...arguments)}onCellOverflowGesture({domEvent:e,date:t}){const n=this,r=n.cellMap.get(xi.makeKey(t));if(r){const{overflowPopup:i}=n,s=n.getCellFromEvent(e);i&&n.trigger("beforeShowOverflowPopup",{cell:s,cellData:r,date:t,overflowPopup:i})&&i.showOverflow(s,r)}}getCellFromEvent(e){return e.target.closest(".b-calendar-cell[data-date]")}changeOverflowPopupTrigger(e){return"mouseover"!==(e=e.toLowerCase())&&"hover"!==e||(e="mouseOver"),e}updateOverflowPopupTrigger(e,t){t&&(this[`onCellOverflow${N.capitalize(t)}`]=tk),this[`onCellOverflow${N.capitalize(e)}`]=this.onCellOverflowGesture}onEventMouseOverOut({target:e,relatedTarget:t,type:n}){if("mouseOver"===this.overflowPopupTrigger&&e.closest(".b-cal-cell-overflow")&&!t.closest(".b-cal-cell-overflow")){if("mouseover"===n)return this.onCalendarPointerInteraction(...arguments);var r;null===(r=this._overflowPopup)||void 0===r||r.hide()}return this.onCalendarPointerInteraction(...arguments)}changeOverflowPopup(e,t){var n;const r=this,i=r.up("calendar")||r.owner||r,s=ek.reconfigure(t,e,{owner:r,defaults:{positioned:!(null!=e&&e.floating),owner:r,align:{constrainTo:(null===(n=r.up("popup"))||void 0===n?void 0:n.contentElement)||globalThis}}});if(s){const{element:e}=s,{eventHeightInPixels:n}=r;s.element.classList.add(`b-${r.type}-overflowpopup`),s.positioned&&s.render(i.isCalendar?i.element:i.contentElement),n&&(e.style.setProperty("--event-height",`${n}px`),e.style.setProperty("--arrow-width",n/3+"px")),s!==t&&i!==r&&(Jt.on({thisObj:r,element:s.bodyElement,delegate:".b-cal-event-wrap",mouseover:"onEventMouseOverOut",mouseout:"onEventMouseOverOut",mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}),s.headerElement&&Jt.on({thisObj:r,element:s.headerElement,mousedown:"onCalendarPointerInteraction",mouseup:"onCalendarPointerInteraction",click:"onCalendarPointerInteraction",dblclick:"onCalendarPointerInteraction",contextmenu:"onCalendarPointerInteraction"}))}return s}onInternalResize(e,t,n,r,i){const{_eventsPerCell:s,_eventContainerTop:o}=this;super.onInternalResize(e,t,n,r,i),this.rendered&&n!==i&&this.performResizeRefresh(s,o)}performResizeRefresh(e,t,n){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null;const r=this,{eventsPerCell:i,_overflowPopup:s}=r;i!==e&&r.trigger("eventsPerCellChange",{value:i,oldValue:e}),r.eventContainerTop===t&&i===e||(n?r.doRefresh():r.refresh(),null!=s&&s.isVisible&&s.refresh(r._cellMap.get(xi.makeKey(s.activeDate))))}updateEventHeight(){super.updateEventHeight(...arguments),this._eventsPerCell=null,this.element.style.setProperty("--event-height-px",`${this.eventHeightInPixels}px`)}updateEventSpacing(e){this._eventsPerCell=null,this.isConfiguring||this.refreshSoon(),this.element.style.setProperty("--event-spacing",`${e}px`)}get weeksElement(){return this.contentElement}get eventContainerHeight(){if(null==this._eventContainerHeight&&this.isVisible&&!this.isConfiguring){const{firstVisibleCell:e}=this;this._eventContainerHeight=e?e.offsetHeight-this.eventContainerTop:NaN}return this._eventContainerHeight}get eventContainerTop(){const e=this;if(null==e._eventContainerTop&&e.isVisible&&!e.isConfiguring){const{firstVisibleCell:t}=e,n=t&&t.querySelector(".b-cal-cell-header"),r=n?n.getBoundingClientRect().height:0;e._eventContainerTop=0===r?null:r,e.element.style.setProperty("--event-top",`${e._eventContainerTop}px`)}return e._eventContainerTop||0}getEventsPerCell(e){return this.eventsPerCell}get eventsPerCell(){const e=this;return null==e._eventsPerCell&&(e._eventsPerCell=Math.floor((e.eventContainerHeight+e.eventSpacing)/(e.eventHeightInPixels+e.eventSpacing))),e._eventsPerCell}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}cellRenderer({cell:e}){const t=this.getCellDomConfig(...arguments);ud.sync({domConfig:t,targetElement:e})}getCellDomConfig({cell:e,columnIndex:t,row:n,date:r,day:i,dayTime:s=Dg.MIDNIGHT,visibleColumnIndex:o,key:a}){var l,d,c,u;let h,g=!this.isConfiguring&&this.cellMap.get(xi.makeKey(r));const m=this,{isMonthView:p,eventHeightInPixels:f,eventSpacing:v,weekLength:y,todayCls:b,emptyCellRenderer:C,dayCellNameFormat:w,resource:S}=m,D={tabIndex:p?0:-1,role:p?"link":"columnheader","aria-label":`${xi.format(r,"dddd Do MMMM")}${S?` ${S.name}`:""}.`,dataset:{headerDate:a}},E=m.dayTime.startOfDay((null===(l=m.calendar)||void 0===l?void 0:l.dateTimeNow)||new Date),x=r.getTime()===E.getTime(),R=r.getDate(),T={className:m.eventBarContainerCls,role:"presentation",children:[],syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}},M={style:{},className:new Vt({"b-cal-cell-header":!0,[b]:x})},k={tabIndex:-1,role:"gridcell","aria-label":`${xi.format(r,"dddd Do MMMM")}${S?` ${S.name}`:""},  ${m.L("eventCount",(null===(d=(null===(c=g)||void 0===c?void 0:c.renderedEvents)||(null===(u=g)||void 0===u?void 0:u.events))||void 0===d?void 0:d.length)||0)}.`,dataset:{},style:{},className:new Vt(null==e?void 0:e.className),children:[M,T]},F=!(r-(m.firstVisibleDate||-1));let I;if(k.className[b]=x,m.addCellHeaderContent?h=m.addCellHeaderContent(M,g||(g=m.createCellData(r))):M.children=[h={className:{"b-day-name":!0}}],p?Object.assign(h,D):Object.assign(M,D),m.dayCellRenderer&&!m.isConfiguring){g||(g=m.createCellData(r)),g.style=k.style,g.cls=k.className,g.headerStyle=M.style,g.headerCls=M.className;const e=g&&g.isNonWorking,t=m.callback(m.dayCellRenderer,m,[g,k]);"string"==typeof g.cls&&(k.className=new Vt(g.cls)),"string"==typeof g.style&&(k.style=Yn.parseStyle(g.style)),"string"==typeof g.headerCls&&(M.className=new Vt(g.headerCls)),"string"==typeof g.headerStyle&&(M.style=Yn.parseStyle(g.headerStyle)),null!=t&&("string"==typeof t?h.html=t:(h.text=null,h.children=nt.asArray(t))),I=!e&&g.isNonWorking}if(h&&(h.text||h.html||(w?h.html=xi.format(r,m.dayCellNameFormat):h.text=R),1===R&&(h.dataset={startOf:xi.format(r,"MMM")}),String(h.text||h.html).endsWith(R)&&(h.className["b-day-num"]=!0)),g.visible){const{hasOverflow:e,renderedEvents:a,maxRow:l}=g,{stackMultiDayEvents:d}=m,c=a,{length:u}=c,h=T.children;k.className[m.nonWorkingDayCls]=g.isNonWorking,k.className[m.dynamicHideNonWorkingdayCls]=I,k.className[m.weekendCls]=xi.weekends[i];let p=0,b=0,w=0;for(;p<l;p++,b++){const e=c[p];if(e){const{eventRecord:t,isOverflow:n,propagateEndDate:i}=e,a=e.eventEndDate||t.endingDate,l=Math.max(1,m.getDaySpan(r,i||a,s)),c=m.getDaySpan(r,a,s,!0),u=y-o,g=!d&&o&&n,p=Yn.percentify(W.round((g||d?1:Math.min(l,u))/y*100,4)),C=m.createEventDomConfig(e);Object.assign(C.style,{width:p,top:`${b*f+b*v+m.eventContainerTop}px`}),Object.assign(C.className,{"b-overflow":g,"b-continues-past":!g&&(!o||d||F)&&t.startDate<r,"b-continues-future":!g&&(c>u||c>l||d&&c>1)}),h.push(C)}}for(;p<u;)c[p++]&&w++;e?(n.classList.add("b-has-overflow"),k.children.push(m.getOverflowButtonDomConfig(w))):t||n.classList.remove("b-has-overflow");if((k.className[m.emptyCellCls]=!c.length)&&C){const e=typeof C,t="function"===e||"string"===e?m.resolveCallback(C,m,!1):null;(null!=t&&t.handler?t.handler.call(t.thisObj,g):C)&&(T.children[0]={tag:"button",class:"b-cal-cell-no-content",children:[null!=t&&t.handler?t.handler.call(t.thisObj,g):C]})}}return k}onCalendarPointerInteraction(e){const t=this,{target:n}=e;return!(n.closest(`.${t.emptyCellCls} .${t.eventBarContainerCls}`)&&(!t.emptyCellRenderer||n.closest(".b-cal-cell-no-content"))&&!1===t.trigger(`emptyCell${nk[e.type]}`,{date:t.getDateFromDomEvent(e),domEvent:e}))&&super.onCalendarPointerInteraction(e)}getDaySpan(e,t,n,r){if(this.hideNonWorkingDays&&!r){let r=0;for(const i=new Date(e),s=n.ceil(t,"1 day");i<s;i.setDate(i.getDate()+1))this.nonWorkingDays[i.getDay()]||r++;return r}return Math.max(xi.diff(e,n.ceil(t,"1 day"),"day"),1)}getOverflowButtonDomConfig(e){const{overflowButtonRenderer:t}=this,n={tag:"button","aria-label":`${this.L("L{Calendar.moreEvents}",e)}.`,className:{"b-cal-cell-overflow":1},text:this.L("L{Calendar.plusMore}",e),style:{},dataset:{eventId:"overflow"}};return t?this.callback(t,this,[n,e]):n}getCell(e){return"string"!=typeof e&&(e=this.dayTime.dateKey(e)),this.contentElement.querySelector(`[data-date="${e}"]`)}getCellOverflowButton(e){var t;return null===(t=this.getCell(e))||void 0===t?void 0:t.querySelector(".b-cal-cell-overflow")}};const ik={day:1,week:1,month:1,year:1,decade:1},sk=(e,t)=>e&&t?e.unit===t.unit&&e.magnitude===t.magnitude:e===t;var ok=e=>class extends(e||Qe){static $name="DateRangeOwner";static configurable={month:!0,date:{$config:{equal:"date"},value:null},range:{$config:{lazy:!0,equal:sk},value:null},shiftIncrement:{$config:{lazy:!0,equal:sk},value:null},startDate:{$config:{equal:"date"}},endDate:{$config:{equal:"date"}}};previous(){this.move(-1)}next(){this.move(1)}move(e=1){e=Math.sign(e);const t=this,{shiftIncrement:n,range:r}=t;r?n&&(t.isShifting=!0,t.date=xi.add(t.date,{unit:n.unit,magnitude:e*n.magnitude}),t.isShifting=!1):t.startDate=xi.add(t.startDate,e*t.duration,"day")}changeDate(e,t){if(e=super.changeDate(e||this.startDate,t),this.isConfiguring||this.isValidRange(this.range,e))return e}updateDate(e){var t;const n=this,r=n.changeStartDate(e),{startDate:i,_month:s}=n,o=null==s?void 0:s.generation;if(!i||r-i)if(n.hasConfig("endDate")||"day"===n.range.unit){const{endDate:t,duration:r}=n,s=n.isEventList&&!n.range?"betweenLesserEqual":"betweenLesser";n.isConfiguring&&i&&xi[s](e,i,t)||(!i||!t||e<i?n.startDate=e:(n.isEventList?e>t:e>=t)&&(n.startDate=xi.add(e,-(r-1),"day")))}else n.startDate=xi.floor(e,n.isShifting?n.shiftIncrement:n.range,n.startDate,n.weekStartDay);s&&s.generation===o?s.date=e:n.isConfiguring||!1===n.scrollToDateOnDateChange||n.whenVisible("scrollTo",n,[e]),null===(t=super.updateDate)||void 0===t||t.call(this,...arguments)}changeStartDate(e,t){const n=this;return e=super.changeStartDate(n.snapDate(n.ingestDate(e)),t),!t||t-e||n.afterStartDateSet(e,t),e}updateStartDate(e,t){var n;const r=this,{_month:i}=r;r.hasConfig("date")||r.date||(r.date=e),i&&(i.date=e),null===(n=super.updateStartDate)||void 0===n||n.call(this,...arguments),r.afterStartDateSet(e,t)}afterStartDateSet(e,t){const n=this,{refreshCount:r,_endDate:i}=n,s=n.peekEndDate(),o=s&&i&&!Boolean(s-i);if(n.hasConfig("endDate")&&(!s||n.isConfiguring)){const r=xi.diff(t||e,n.endDate,"day");n.endDate=xi.add(e,r,"day")}var a;n.isConfiguring||s&&!o||n.refreshCount!==r||(null===(a=n._cellMap)||void 0===a||a.clear(),n.refresh(),n.triggerRangeChange(e,n.endDate))}peekEndDate(){const e=this.peekConfig("endDate");if(e)return this.changeEndDate(e)}updateEndDate(e){var t;const n=this,{duration:r}=n;var i;(null===(t=super.updateEndDate)||void 0===t||t.call(this,...arguments),n.isConfiguring)||(n.element.style.setProperty("--range-magnitude",r),n.element.dataset.duration=r,null===(i=n._cellMap)||void 0===i||i.clear(),n.refresh(),n.triggerRangeChange(n.startDate,e))}triggerRangeChange(e,t){const n=this,{lastRangeAnnounced:r}=n;(!r||r.startDate-e||r.endDate-t)&&(n.peekConfig("date")||(n.date=xi.constrain(n.date,e,xi.add(t,n.isEventList&&!n.range?0:-1,"d"))),n.trigger("rangeChange",{old:r,new:n.lastRangeAnnounced={startDate:e,endDate:t}}))}get range(){return this.hasConfig("endDate")?null:this._range}get shiftIncrement(){if(null!==this._shiftIncrement)return this._shiftIncrement||this.range||{magnitude:this.duration,unit:"day"}}get stepUnit(){const{shiftIncrement:e}=this;if(e)return 1===e.magnitude?xi.getLocalizedNameOfUnit(e.unit):`${e.magnitude} ${xi.getLocalizedNameOfUnit(e.unit,!0)}`}get endDate(){const e=this;return e.hasConfig("endDate")?e._endDate:e.startDate&&xi.add(e.startDate,e.range.magnitude,e.range.unit)}snapDate(e,t){const n=this,r=n._endDate||n.peekEndDate()?null:n.range;return r&&"day"!==r.unit&&e?xi[t?"ceil":"floor"](e,r,void 0,n.weekStartDay):e}parseRange(e){if(e){if("string"==typeof e){const t=xi.parseTimeUnit(e);e=t?{magnitude:1,unit:t}:xi.parseDuration(e)}else{if("number"==typeof e)return{magnitude:e,unit:"day"};e.unit=xi.parseTimeUnit(e.unit)}if(!ik[e.unit])throw new Error("Range must be in days, weeks, months, years or decades")}return e}changeRange(e){if(!e||this.hasConfig("endDate")||(e=this.parseRange(e),!this._date||this.isValidRange(e)))return e}changeShiftIncrement(e){return this.changeRange(e)}updateShiftIncrement(e,t){this.trigger("shiftIncrementChange",{old:e,new:t})}isValidRange(e,t=this.date){var n,r;const i=this.minDate||(null===(n=this.calendar)||void 0===n?void 0:n.minDate),s=this.maxDate||(null===(r=this.calendar)||void 0===r?void 0:r.maxDate);if(e&&!isNaN(i)||!isNaN(s)){const n=this.calculateDateRange(e,t);if(!isNaN(i)&&n.endDate<=i)return!1;if(!isNaN(s)&&n.startDate>s)return!1}return!0}updateRange(e){const t=this,{date:n,_startDate:r}=t,i=()=>{const{duration:e}=t;t.element.style.setProperty("--range-magnitude",e),t.element.dataset.duration=e};e&&n&&!t.hasConfig("endDate")&&(!r||r-n?t.startDate=n:t.updateStartDate(t._startDate=t.snapDate(r),r)),t.isConfiguring?t.whenVisible(i):i()}calculateDateRange(e,t){if(t)return"day"!==e.unit?{startDate:xi.floor(t,e,void 0,this.weekStartDay),endDate:xi.ceil(xi.add(t,1,"day"),e,void 0,this.weekStartDay)}:{startDate:t,endDate:xi.add(t,e.magnitude,"day")}}changeMonth(e){var t;const n=this,{date:r}=n;return super.changeMonth?super.changeMonth(...arguments):(null!==(t=e)&&void 0!==t&&t.isMonth||(e=new kg({date:r,weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays}),null==n.nonWorkingDays&&(n.nonWorkingDays=e.nonWorkingDays),null==n.weekStartDay&&(n.weekStartDay=e.weekStartDay)),e)}get dateBounds(){return[this.startDate,this.lastDate]}getDuration(e=this.startDate){const{range:t}=this;return t?e?xi.diff(e,xi.add(e,t.magnitude,t.unit),"d"):xi.as("d",t.magnitude,t.unit):xi.diff(e,this.peekEndDate()||this._endDate,"day")}get duration(){return this.getDuration()}get lastDate(){const e=this.endDate;return e&&xi.add(e,-1,"day")}};const ak=Object.freeze({}),lk={shrinkwrap:1,expand:1},dk=(e,t,n,r,i)=>{const s=xi.format(n,e);return r?`${s}${i?t.trim():t}${xi.format(r,e).slice(i?-1:0)}`:s};class ck extends(oc.mixin(qM,JM,rk,ok)){static $name="CalendarRow";static type="calendarrow";static get configurable(){return{cls:"b-calendar-days",dragUnit:"day",animate:!0,autoHeight:null,autoRefresh:["dayNameFormat","dayNumberCompress","dayNumberFormat","daySeparator","hideEmptyDays","dateFilter"],descriptionFormat:[!0,!0],dayStartShift:null,dayTime:0,defaultEventRowCount:3,fullWeek:null,minDayWidth:null,scrollable:{overflowX:"hidden",overflowY:"hidden",propagateSync:!0},headerScroller:{$config:["lazy","nullify"],value:{overflowX:"hidden",overflowY:"hidden",propagateSync:!0}},dayNameFormat:"ddd",dayNumberCompress:null,dayNumberFormat:"D",daySeparator:"-",responsive:{small:{dayNameFormat:"d1",dayNumberCompress:!0,daySeparator:"/"},"*":{dayNameFormat:"ddd",dayNumberCompress:!1,daySeparator:"-"}},dayNameSelector:".b-cal-cell-header",monitorResize:!1,gutterHeight:null,expanded:null,overflowClickAction:"popup",dayHeaderRenderer:null,hideEmptyDays:null,dateFilter:null}}static delayable={afterUpdateMinDayWidth:{type:"raf",cancelOutstanding:!0}};heightAnimation=Promise.resolve;compose(){return{children:{headerElement:{className:"b-calendarrow-header",children:{headerCellContainer:{role:"row",className:"b-calendarrow-header-container"},scrollPadElement:{...Yn.scrollBarPadElement}}},bodyElement:{className:"b-calendarrow-body",children:{cellContainer:{role:"row",reference:"cellContainer",className:"b-calendarrow-cell-container"}}}}}}onInternalPaint({firstPaint:e}){if(e){const e=this,{fonts:t}=document,n=()=>{e._eventContainerTop=e._eventContainerHeight=null,e.eventStore.count&&e.performResizeRefresh(null,null,!0)};"loaded"!==(null==t?void 0:t.status)&&t.ready.then((()=>!e.isDestroyed&&n())),n()}}changeDaySeparator(e){return Array.isArray(e)?e:[e,e]}changeElement(){const e=super.changeElement(...arguments);return this.scrollable.addPartner(this.headerScroller,"x"),e}changeHeaderScroller(e,t){return e?e=Md.new({_id:`${this.id}-header-scroller`,element:this.headerCellContainer,widget:this},e):null==t||t.destroy(),e}async scrollTo(e){const t=this,{eventFilter:n}=t;return e.isEvent&&(!n||n(e))&&xi.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate)&&(t.getEventElement(e)||t.expanded||t.autoHeight||t.toggleExpandCollapse()),super.scrollTo(...arguments)}updateDate(e,t){var n,r,i;let s=t&&this.getDayHeader(t);null===(n=s)||void 0===n||n.classList.remove("b-selected-date"),null===(r=super.updateDate)||void 0===r||r.call(this,e,t),s=e&&this.getDayHeader(e),null===(i=s)||void 0===i||i.classList.add("b-selected-date")}getDayHeader(e){return"string"!=typeof e&&(e=this.dateKey(e)),this.headerCellContainer.querySelector(`.b-cal-cell-header[data-header-date="${e}"]`)}get overflowElement(){return this.bodyElement}get maxHeightElement(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.alldayRowElement)||super.maxHeightElement}createCellMap(e={}){const t=this,n=t.hideNonWorkingDays?t.nonWorkingDays:ak,{maxEventCount:r}=t,i=W.assign({dayTime:t.dayTime,getDateIndex:e=>Number(e)===Number(t.firstVisibleDate||t.startDate)?"date":"startDate"},e),s=super.createCellMap(i),{owner:o}=t;let a,l=0;return s.forEach((e=>{n[e.day]||(a=e),l=Math.max(l,e.renderedEvents.length)})),t.maxEventCount=l,l!==r?(s.clear(),t.createCellMap(i)):(a&&(a.isRowEnd=!0),null==o||o.element.classList.toggle("b-has-allday-events",Boolean(s.size)),s)}collectEvents(e){return e=W.assign({dayTime:this.dayTime},e,{getDateIndex:e=>Number(e)===Number(this.firstVisibleDate||this.startDate)?"date":"startDate"}),super.collectEvents(e)}createCellData(e){const t=xi.diff(this.startDate,e,"day"),n=t;return Object.assign(super.createCellData(e),{visibleColumnIndex:n,columnIndex:t,isRowStart:0===n,isRowEnd:!1,renderedEvents:new KM})}get dayStartShift(){var e;return(null===(e=this.dayTime)||void 0===e?void 0:e.startShift)??this._dayStartShift}updateDayStartShift(e){this.element.classList.toggle("b-shifted-day",Boolean(e)),this.dayTime=new Dg(e)}changeDayTime(e){var t;if(e||(e=new Dg(this.dayStartShift)),e.isDayTime||(e=new Dg(e)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}dayOfDate(e){return this.dayTime.dayOfDate(e)}updateMinDayWidth(e){const{style:t}=this.element;t.setProperty("--min-day-width",e?Yn.setLength(e):0),t.setProperty("--cell-container-overflow",e?"visible":"hidden"),this.afterUpdateMinDayWidth()}afterUpdateMinDayWidth(){const{headerScroller:e,minDayWidth:t,scrollable:n}=this,{element:r}=n;t&&r.scrollWidth>r.clientWidth?n.overflowX=e.overflowX="hidden-scroll":n.overflowX=e.overflowX=!1}updateEventHeight(){super.updateEventHeight(...arguments),this.autoHeight||this.isConfiguring||this.expanded||this.setEventContentHeight(this.cellContentHeight)}updateGutterHeight(){this.isConfiguring||this.setEventContentHeight(this.cellContentHeight)}updateNonWorkingDays(){this.onVisibleDateRangeChange()}updateHideNonWorkingDays(){super.updateHideNonWorkingDays(...arguments),this.onVisibleDateRangeChange()}onCellOverflowGesture({date:e}){lk[this.overflowClickAction.toLowerCase()]?this.expanded=!0:super.onCellOverflowGesture(...arguments)}onVisibleDateRangeChange(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}changeAutoHeight(e){const t=this,{eventsPerCell:n}=t;t._autoHeight=e,t.setEventContentHeight(t.cellContentHeight),t.isConfiguring||t.performResizeRefresh(n,t.eventContainerTop,!0)}async setEventContentHeight(e,t){const n=this,{cellContainer:r,parent:i}=n;if(n._eventContentHeight!==e){var s;if(!t&&null!=i&&i.isDayView&&null!==(s=i.parent)&&void 0!==s&&s.isResourceView){const t=i.parent.items.map((e=>e.allDayEvents)).filter((e=>e&&e!==n));e=Math.max(e||0,...t.filter((e=>!e.owner.isResourceDayViewTimeAxis)).map((e=>e.calculateCellContentHeight()||0))),null==t||t.forEach((t=>{t.setEventContentHeight(e,!0)}))}const{height:l}=n;let{animate:d}=n;n.isAnimating=d;const c=Yn.getPropertyTransitionDuration(r,"height");if(c||(n.isAnimating=d=!1),r.style.height=`${e||1}px`,n.bodyElement.classList.toggle("b-zero-height",!Boolean(e)),d&&await(n.heightAnimation=Jt.waitForTransitionEnd({property:"height",element:r,duration:c})),!n.isDestroyed){var o,a;const{height:t}=n;n.isAnimating=!1,n._eventContentHeight=e,null===(o=n.owner)||void 0===o||null===(a=o.syncScrollbarPadding)||void 0===a||a.call(o),t!==l&&n.trigger("heightChange",{height:t,oldHeight:l})}}}get hasOverflow(){return!this.autoHeight&&this.maxEventCount>this.defaultEventRowCount}get eventsPerCell(){const e=this,{maxEventCount:t}=e;return e.expanded||e.autoHeight?t:Math.min(t,e.defaultEventRowCount)}get cellContentHeight(){var e;return!1===(null===(e=this.owner)||void 0===e?void 0:e.showAllDayHeader)?0:this.calculateCellContentHeight()}calculateCellContentHeight(){const e=this,{gutterHeight:t}=e;let n=Math.ceil(e.eventContainerTop+e.eventsPerCell*(e.eventHeightInPixels+e.eventSpacing));return t&&(e.eventsPerCell&&(n-=e.eventSpacing),isNaN(t)?n=`calc(${n}px + ${t})`:n+=Number(t)),n}getDateFromPosition(e,t,n=!1,r){const i=this,{eventContentElement:s}=i,o=s.getBoundingClientRect(),a=i.rtl?o.right-e:e-o.left,l=s.scrollWidth,d=i.getDayElementFromX(e);return a<0||l<a||t<o.top||o.bottom<t?null:i.getDateFromElement(d,r)}async toggleExpandCollapse(){const{expanded:e}=this;await this.updateExpanded(!Boolean(e),e)}async updateExpanded(e,t){const n=this;n._expanded=t;const{eventsPerCell:r}=n;n._expanded=e,n.expanded?n.isVisible&&(n.performResizeRefresh(r,n.eventContainerTop,!0),await n.heightAnimation):(n.scrollable.overflowY="hidden",await n.setEventContentHeight(n.cellContentHeight),t&&!n.isDestroyed&&n.performResizeRefresh(r,n.eventContainerTop,!0))}get visibleDateHeaders(){const e=this;let t,n;if(e.fullWeek){for(t=e.month.getWeekStart(e.month.getWeekNumber(e.startDate));e.hiddenNonWorkingDays[t.getDay()];)t.setDate(t.getDate()+1);for(n=xi.add(t,6,"d");e.hiddenNonWorkingDays[n.getDay()];)n.setDate(n.getDate()-1)}else t=e.firstVisibleDate,n=e.lastVisibleDate;return[t,n]}doRefresh(){var e,t;null===(e=this._cellMap)||void 0===e||e.clear();const n=this,{dayTime:r,fullWeek:i,startDate:s,endDate:o,headerCellContainer:a,cellContainer:l,dayHeaderRenderer:d,hiddenNonWorkingDays:c,hideEmptyDays:u,dateFilter:h,owner:g}=n,[m,p]=n.visibleDateHeaders,f=(s||o)&&n.cellMap,v=n.nonWorkingDays??n.month.nonWorkingDays,y=[],b=[],w=[];if(!f)return;let S,D,E,x=0,R=0;for(const e=m;!(p<e);e.setDate(e.getDate()+1),x++){const t=f.get(r.dateKey(e))||n.createCellData(e),{day:s,key:o}=t,a=u&&(g?g.getEventsForDay(o,n.startDate):t.renderedEvents),l=u&&!(null!=a&&a.length)||h&&!n.callback(h,n,[t]);c[s]||l||(t.columnIndex=t.cellIndex=x++,t.isRowStart=0===R,t.visibleColumnIndex=R,i||R++,y.push(t))}n.weekLength=i?1:R;const T=y.length;for(D=0;D<T;D++){const e=y[D],{day:t,key:r}=e,s=v[t],o=`b-day-of-week-${t}`;S=!(e.date-((null==g?void 0:g.date)||n.date)),e.cell=n.getCell(r),e.row=n.cellContainer;const a=n.getCellDomConfig(e);if(a){const l=C.merge({dataset:{headerDate:r}},a.children[0]);l.className["b-selected-date"]=S,l.className["b-current-date"]=i&&S,l.className[o]=1,d&&n.callback(d,n,[l,e]),a.dataset.date=r,Object.assign(a.className,{"b-dayview-allday":1,[n.nonWorkingDayCls]:s,[n.weekendCls]:xi.weekends[t],[n.dayCellCls]:1,[o]:1}),a.children.shift(),w.push(l),i&&!S||(b.push(a),s||(E=a))}}E&&(E.className["b-last-working-day"]=1),ud.sync({targetElement:a,domConfig:{children:w,onlyChildren:!0,syncOptions:{releaseThreshold:0,strict:!0}}}),ud.sync({targetElement:l,domConfig:{children:b,onlyChildren:!0,syncOptions:{releaseThreshold:0,strict:!0}}}),n.refreshCount=(n.refreshCount||0)+1,n.collapseGutter(),n.setEventContentHeight(!1===(null===(t=this.owner)||void 0===t?void 0:t.showAllDayHeader)?0:n.cellContentHeight),n.trigger("refresh")}get eventContainerTop(){return 0}async expandGutter(){const e=this;e._isTemporarilyExpanded||(e.gutterHeight=(e.gutterHeight||0)+e.eventHeightInPixels+e.eventSpacing,await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!0)}async collapseGutter(){const e=this;e._isTemporarilyExpanded&&(e.gutterHeight=e.gutterHeight-(e.eventHeightInPixels+e.eventSpacing),await e.setEventContentHeight(e.cellContentHeight),e._isTemporarilyExpanded=!1)}onCalendarKeyDown(e){var t,n;const{dayTime:r,element:i,owner:s}=this,{target:o}=e,a=`.${this.dayCellCls}`,l=o.closest(`.b-cal-cell-header,${a}`)||o,d=l.matches(".b-cal-cell-header"),c=l.matches(a),u=c?"date":"header-date",h=1===this.duration&&"ArrowDown"===e.key?r.dateKey(this.date):l.dataset[c?"date":"headerDate"],g=r.parseKey(h),m=d?".b-cal-cell-header":a;let p;switch(e.key){case"ArrowUp":var f;if(c)e.preventDefault(),null===(f=i.querySelector(`.b-cal-cell-header[data-header-date="${h}"]`))||void 0===f||f.focus();break;case"ArrowDown":var v;if(d&&Yn.isInView(p=i.querySelector(`${a}[data-date="${h}"]`)))e.preventDefault(),null===(v=p)||void 0===v||v.focus();else if(s.isDayView){var y;e.preventDefault(),null===(y=s.eventContentElement.querySelector(`.${s.dayCellCls}[data-date="${h}"]`))||void 0===y||y.focus()}break;case"ArrowLeft":e.preventDefault(),null===(t=i.querySelector(`${m}[data-${u}="${r.dateKey(xi.add(g,-1,"d"))}"]`))||void 0===t||t.focus();break;case"ArrowRight":e.preventDefault(),null===(n=i.querySelector(`${m}[data-${u}="${r.dateKey(xi.add(g,1,"d"))}"]`))||void 0===n||n.focus();break;default:return super.onCalendarKeyDown(e)}}addCellHeaderContent(e,t){var n;const r=this,{resource:i}=r,{date:s,day:o,tomorrow:a}=t,{dayNameFormat:l,dayNumberCompress:d,daySeparator:c}=r,u=null==r||null===(n=r.dayTime)||void 0===n?void 0:n.startShift;e.children=[{className:"b-day-name-part b-day-name-day"+(d?" b-day-name-short":""),html:dk(l,c[0],s,u&&a)},{tabIndex:0,role:"link",className:"b-day-name-part b-day-name-date","aria-label":`${xi.format(s,"dddd Do MMMM")}${i?` ${i.name}`:""}.`,html:dk(r.dayNumberFormat,c[1],s,u&&a,d)}],e.className[r.nonWorkingDayCls]=t.isNonWorking,e.className[r.weekendCls]=xi.weekends[o]}updateLocalization(){this.isConfiguring||this.refresh(),super.updateLocalization()}updateFullWeek(){this.isConfiguring||this.refresh()}}ck.initClass(),ck._$name="CalendarRow";class uk extends ck{static $name="DaySelector";static type="dayselector";static configurable={readOnly:!0,autoCreate:!1,flex:"0 0 auto",dock:"top"};afterConfigure(){var e;const t=this,{owner:n}=t;super.afterConfigure(),null===(e=n.scrollable)||void 0===e||e.ion({overflowChange:"onOwnerOverflowChange",thisObj:t}),n.descriptionRenderer=t.descriptionRenderer.bind(t),ee.before(n,"updateDate",this.beforeOwnerDateUpdate,this)}beforeOwnerDateUpdate(e){this.isShifting=!0,this.date=e,this.isShifting=!1}onOwnerOverflowChange({y:e}){this.headerElement.classList.toggle("b-show-yscroll-padding",Boolean(e))}onDayNumberClick({date:e}){return this.owner&&(this.owner.date=e),!1}scrollTo(){}descriptionRenderer(){const{startDate:e,endDate:t,owner:n}=this,r=e.getMonth()===t.getMonth()?xi.format(e,"MMMM"):`${xi.format(e,"MMM")} - ${xi.format(t,"MMM")}`,i=n.month.getWeekNumber(e);return`${this.L("L{Object.Week}")} ${i[1]}, ${r} ${i[0]}`}}uk.initClass(),uk._$name="DaySelector";var hk=e=>class extends(e||Qe){static $name="CalendarMixin";static get configurable(){return{daySelector:null}}changeDaySelector(e,t){const n=this;if(e){n.range="1 day",n.settings=null,n.hideHeaders=!0;const r=n.dayTime.shiftDate(n.month.getWeekStart(n.month.getWeekNumber(n.startDate))),i=uk.reconfigure(t,e,{owner:n,defaults:{type:"dayselector",calendar:n.calendar,parent:n,cls:{[`b-${n.type}-dayselector`]:1},dayStartShift:n.dayStartShift,dayTime:n.dayTime,month:n.month,date:n.date,startDate:r,range:{magnitude:1,unit:"week"},shiftIncrement:{unit:"d",magnitude:n.duration},hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,nonWorkingDayCls:n.nonWorkingDayCls,weekendCls:n.weekendCls,weekStartDay:n.weekStartDay}});return n.element.classList.add(`b-${n.type}-with-dayselector`),n.tbar=i,i}null==t||t.destroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.daySelector,t}};const gk=e=>null==e?void 0:e.eventStore;class mk extends sh{static $name="RangeMenu";static type="rangemenu";static configurable={autoShow:!1,view:null,floating:!1,positioned:!0,anchor:!0,defaults:{checked:!1},items:{listRangeDayItem:{range:"day",text:"L{EventEdit.day}",_unit:"day"},listRangeWeekItem:{range:"week",text:"L{EventEdit.week}",_unit:"week"},listRangeMonthItem:{range:"month",text:"L{EventEdit.month}",_unit:"month"},listRangeYearItem:{range:"year",text:"L{EventEdit.year}",_unit:"year"},listRangeDecadeItem:{range:"decade",text:"L{EventEdit.decade}",_unit:"decade"}}};construct(){super.construct(...arguments),this.ion({beforeShow:"syncRangeOptions",toggle:"syncViewRange",thisObj:this})}syncViewRange(e){if(e.checked){const{view:t}=this,{date:n}=t;t.range||(t._date=t._endDate=null),t.setConfig({range:e.item.range,date:n}),e.bubbles=!1}}syncRangeOptions(){const{view:e}=this,{range:t}=e;if(t){const{unit:e,magnitude:n}=t;for(const t of Object.values(this.items))if(t){const r={};t._unit===e?(r.checked=!0,r.range={unit:e,magnitude:n},r.text=1===n?N.capitalize(xi.getLocalizedNameOfUnit(e)):xi.formatDelta(r.range)):(r.checked=!1,r.text=N.capitalize(xi.getLocalizedNameOfUnit(t._unit)),r.range=t._unit),t.setConfig(r)}}}changeItems(e){const t=this,n=`${(t.view||(t.view=t.up(gk))).id}-range-items`;return Object.values(e).forEach((e=>{e&&(e.toggleGroup=n)})),super.changeItems(e)}updateView(e){null==e||e.scrollable.ion({overflowChange:()=>{var e;return null===(e=this.realign)||void 0===e?void 0:e.call(this)}})}}mk.initClass(),mk._$name="RangeMenu";const pk=(e,t)=>e.startDate.valueOf()-t.startDate.valueOf(),fk=(e,t)=>{if(t){if(e=e.data||e,W.isObject(e)){const n=t.slice();for(const t in e){const r=e[t],i=n.findIndex((e=>e.id===t||e.field===t));if(r){const e=ke.merge(r,n[i]);e.id=t,n[-1===i?n.length:i]=e}else i>-1&&n.splice(i,1)}return n}t=new ho({values:t,idProperty:"field"});for(let n=0,{length:r}=e;n<r;n++){const r=e[n],i=t.get(r.field);i&&(e[n]=ke.merge(r,i),t.remove(i))}return e.push(...t.values),e}return e};class vk extends(SC.mixin(qM,JM,hk,ok)){static $name="EventList";static type="eventlist";static configurable={preserveScrollOnDatasetChange:!0,cls:"b-slide-vertical",eventFilter:null,localizableProperties:["title","text"],title:"L{List}",range:"1 month",month:!0,columns:{$config:{merge:fk},value:[{text:"L{EventEdit.Name}",field:"name",flex:"1 0 12em"},{text:"L{EventList.Start}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"startDate",width:"16.5em",format:"L LT",renderer({record:e,value:t}){return e.allDay?xi.format(t,"L"):this.defaultRenderer(...arguments)}},{text:"L{EventList.Finish}",type:"date",editor:{type:"datetime",dateField:{step:null},timeField:{step:null}},field:"endDate",width:"16.5em",format:"L LT",renderer({record:e,value:t}){return e.allDay?xi.format(t,"L"):this.defaultRenderer(...arguments)}},{type:"widget",text:"Resources",field:"resources",minWidth:250,autoHeight:!0,widgets:[{type:"chipview",valueProperty:"items",displayField:"name",itemsFocusable:!1,navigator:null,closable:!1,style:{flexFlow:"row nowrap",display:"flex",padding:"5px 0 3px 0"},scrollable:{overflowX:"hidden-scroll",overflowY:!1},getItemCls:e=>Yn.isNamedColor(e.eventColor)?` b-sch-${e.eventColor}`:"",getItemStyle:e=>"color:#fff;"+(e.eventColor&&!Yn.isNamedColor(e.eventColor)?`background-color:${e.eventColor}`:"")}],editor:!1}]},features:{group:!1,rowCopyPaste:!1,columnPicker:{createColumnsFromModel:!0}},internalListeners:{beforeCellEditStart({editorContext:e}){var t,n;const{editor:r,record:i}=e;if(i.isRecurring||i.isOccurrence)return Dh.show({html:"Please use EventEdit to edit recurring events"}),!1;null===(t=this.calendar)||void 0===t||null===(t=t.features.eventTooltip)||void 0===t||null===(t=t._tooltip)||void 0===t||t.hide(),null===(n=r.timeField)||void 0===n||n[i.allDay?"hide":"show"]()}},settingsButton:{$config:"lazy",value:null},listRangeMenu:{$config:"lazy",value:{type:"rangemenu"}},eventListTimeFormat:"HH:mm",eventTimeRenderer:null};static delayable={populateStoreSoon:{type:"raf",cancelOutstanding:!0}};construct(...e){const t=W.getPropertyDescriptor(this,"features");Object.defineProperty(this,"features",{get:()=>t.get.call(this)||{},set:e=>{var n;(!0===e&&(e={}),e.print)||(e.print=Boolean(null===(n=this.calendar)||void 0===n?void 0:n.features.print));t.set.call(this,e)},configurable:!0}),super.construct(...e)}doRefresh(){this.refreshRows()}getEventElement(e,t=Math.max(e.startDate,this.firstVisibleDate||this.startDate)){return this.eventContentElement.querySelector(`.b-grid-row[data-event-id="${e.id}"][data-date="${xi.makeKey(t)}"]`)||super.getEventElement(...arguments)}containsDate(e){const t=this.range?"betweenLesser":"betweenLesserEqual";return xi[t](e,this.startDate,this.endDate)}eventListEventTimeRenderer(e,t){const n=this;let r;r=n.eventTimeRenderer?n.callback(n.eventTimeRenderer,n,arguments):n.defaultEventTimeRenderer(e,t);const i="string"==typeof r?"text":"children";return{className:{"b-cal-eventlist-event-time":1},"aria-hidden":!0,[i]:"text"===i?r:nt.asArray(r)}}defaultEventTimeRenderer(e,t){const n=this,{startDate:r,endDate:i,allDay:s}=e,o=xi.clearTime(r),a=xi.clearTime(i),l=a&&(i-a?i:xi.add(a,-1,"d"));let d;return d=!e.isMilestone&&(i-a?a:l)-o?s||t-o?s||t-a?n.L("L{Calendar.endsOn}",xi.format(l,"DD MMM")):n.L("L{Calendar.endsOn}",xi.format(i,n.eventListTimeFormat)):`${xi.format(r,n.eventListTimeFormat)} - ${xi.format(l,"DD MMM")}`:s?n.L("L{Calendar.allDay}"):`${xi.format(e.startDate,n.eventListTimeFormat)} - ${xi.format(i,n.eventListTimeFormat)}`,d}agendaEventDateRenderer(e){return{className:{"b-day-name":1,"b-cal-agenda-date":1,"b-today":!Boolean(xi.clearTime(new Date)-xi.clearTime(e))},"aria-hidden":!0,children:[{className:{"b-cal-agenda-date-date-number":1},text:e.getDate()},{className:{"b-cal-agenda-date-date-text":1},children:[{text:xi.format(e,"dddd")},{text:xi.format(e,"MMM YYYY")}]}]}}destroy(){for(const t of Object.values(this.features)){var e;null===(e=t.destroy)||void 0===e||e.call(t)}super.destroy()}populateHeaderMenu({items:e}){const{listRangeMenu:t}=this;t&&(t.appendTo=this.element,e.listRangeItem={weight:-1e3,icon:"b-icon-calendar-week",text:"L{Calendar.timeRange}",menu:t}),super.populateHeaderMenu(...arguments)}refreshVirtualScrollbars(){super.refreshVirtualScrollbars(),this.bodyElement.classList[Yn.scrollBarWidth&&this.hasVerticalOverflow?"add":"remove"]("b-has-scrollbar")}changeListRangeMenu(e){if(e)return mk.mergeConfigs({view:this,floating:!1},e)}updateRowManager(e){var t;null===(t=super.updateRowManager)||void 0===t||t.call(this,...arguments),e.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this})}onBeforeRenderRow({row:e,record:t}){const{_elementsArray:n}=e,{id:r,startDate:i}=t;if(t.isSpecialRow)e.eachElement((e=>delete e.dataset.eventId));else if(t.isEventModel){var s,o;for(let e=0,{length:t}=n;e<t;e++)n[e].dataset.eventId=r,n[e].dataset.date=xi.makeKey(i);e.cls[`b-day-of-week-${i.getDay()}`]=1,null===(s=this.calendar)||void 0===s||null===(o=s.beforeListRenderRow)||void 0===o||o.call(s,{row:e,record:t})}}onInternalKeyDown(e){}get displayName(){let e=this.title;return"string"!=typeof e&&(e=this.type),N.capitalize(e)}async scrollTo(e,t){const n=this;if(t=W.assign({},n.defaultScrollOptions,"boolean"==typeof t?{animate:t}:t),e instanceof n.store.modelClass)await n.scrollRowIntoView(e,Object.assign({},t,{highlight:!1})),t.highlight&&(e=n.getEventElement(e,e.startDate),"boolean"==typeof t.highlight?Yn.highlight(e,n):(n.widget||n).callback(t.highlight,null,[e]));else if(W.isDate(e=n.ingestDate(e))&&n.store.count){const r=xi.makeKey(e=n.findClosestOccupiedDate(e));n.scrollingToDate=!0,await n.scrollRowIntoView(n.dateIndex[r],t),n.scrollingToDate=!1,n.scrolledToDate=e}}findClosestOccupiedDate(e){const{dayTime:t}=this,n=this.dateIndex;if(!Object.keys(n).length||n[t.dateKey(e)])return e;let r=Number.MAX_SAFE_INTEGER;const i=Object.keys(n);for(let n=0,{length:s}=i;n<s;n++){const s=t.parseKey(i[n]);Math.abs(s-e)<Math.abs(r-e)&&(r=s)}return new Date(r)}updateStartDate(){const{refreshCount:e}=this;this.preventScroll=!0,super.updateStartDate(...arguments),this.preventScroll=!1,this.isConfiguring||this.refreshCount!==e||this.populateStoreSoon()}updateEndDate(){var e;const{refreshCount:t}=this;null===(e=super.updateEndDate)||void 0===e||e.call(this,...arguments),this.isConfiguring||this.refreshCount!==t||this.populateStoreSoon()}get dateBounds(){return[this.startDate,this.endDate]}get descriptionFormat(){return super.descriptionFormat||[this.shortDateFormat,`S{${this.shortDateFormat}} - E{${this.shortDateFormat}}`]}set descriptionFormat(e){super.descriptionFormat=e}descriptionRenderer(){return`${this.formattedDescription}. ${this.L("L{eventCount}",this.eventCount)}`}get count(){return G.deprecate("calendar","7.0.0","count property is deprecated in favor of eventCount"),this.eventCount}get eventCount(){return this.store.getAllDataRecords().length}get store(){return super.store}set store(e){e&&!e.modelClass&&this.project&&(e.modelClass=this.project.eventStore.modelClass),super.store=e}updateEventStore(e){var t;null===(t=super.updateEventStore)||void 0===t||t.call(this,e),this.detachListeners("eventStore"),e.ion({name:"eventStore",refresh:"onCalendarStoreChange",thisObj:this}),this.populateStoreSoon()}changeStore(e){var t;const n=this;return e&&(e=Il.mergeConfigs({useRawData:{ignoreDefaults:!0,disableDefaultValue:!0,disableTypeConversion:!0,enabled:!0},modelClass:n.modelClass},e)),null!==(t=e=super.changeStore(e))&&void 0!==t&&t.modelClass.isEventModel&&(n.nonWorkingDaysFilter=e.addFilter({id:`${n.id}-nonworkingday-filter`,filterBy:e=>!n.dayTime.isIntraDay(e)||!n.hiddenNonWorkingDays[e.startDate.getDay()],disabled:!n.hideNonWorkingDays},!0)),e}updateHideNonWorkingDays(e){const t=this,{store:n}=t;super.updateHideNonWorkingDays(e),n&&(t.nonWorkingDaysFilter.disabled=!e,n.filter()),t.trigger("refresh")}afterRemove({records:e}){this.eventStore.remove(e),super.afterRemove(...arguments)}get modelClass(){return this.eventStore.modelClass}populateStoreSoon(){const e=this,{project:t}=e;e.isVisible?(t.isInitialCommitPerformed&&!t.isWritingData||!t.eventStore.count)&&e.populateStore():e.whenVisible("populateStore")}get duration(){return super.duration+(this.range?0:1)}populateStore(){var e;const t=this,{cellEdit:n}=t.features,r=null==n?void 0:n.editorContext,i=t.eventStore.getEvents({startDate:t.startDate,endDate:xi.add(t.endDate,t.range?0:1,"d"),filter:t.eventFilter}).sort(pk);t.dateIndex=i.reduce(((e,t)=>{const n=xi.makeKey(t.startDate);return e[n]||(e[n]=t),e}),{}),r&&n.cancelEditing(),t.store.data=i,t.trigger("refresh"),r&&n.startEditing(r),null===(e=t.calendar)||void 0===e||e.syncUIWithActiveView(this)}changeMonth(){const e=super.changeMonth(...arguments);return e.ion({dateChange:"onMonthChange",thisObj:this}),e}onMonthChange({newDate:e}){const t=this,{startDate:n}=t,r=t.changeStartDate(e);(!n||r-n&&!t.containsDate(r))&&t.updateRange(t.range),!t.preventScroll&&t.isVisible&&t.store.count&&(t.populateStoreSoon.flush(),t.scrollTo(e))}onCalendarStoreChange({source:e}){this.date||(this.date=e.map((e=>e.startDate)).sort(((e,t)=>e.valueOf()-t.valueOf()))[0]),this.populateStoreSoon()}changeSettingsButton(e,t){return e&&Tu.reconfigure(t,Tu.mergeConfigs({type:"button",positioned:!0,icon:"b-icon-cog",menuIcon:null,cls:"b-blue b-cal-widget-settings-button",insertBefore:this.bodyWrapElement},e),this)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.store,delete t.data,t}}vk.initClass(),vk._$name="EventList";const yk={mouseover:1,mouseout:1},bk={mousedown:1,mouseup:1,click:1,dblclick:1,contextmenu:1},Ck=({date:e},{date:t})=>e-t;class wk extends(vk.mixin(wv)){static $name="AgendaView";static type="agendaview";static configurable={eventSorter:(e,t)=>{const{startDate:n,isInterDay:r}=e,{startDate:i,isInterDay:s}=t;return r!==s?Number(s)-Number(r):r||s?n-i||t.durationMS-e.durationMS||t.endingDate-e.endingDate:n-i},eventRowSpacing:8,title:"L{Agenda}",range:"year",hideEventOverflow:null,offsetStartsBeforeEvents:!0,handlePointerInteraction:!1,hideHeaders:!0,columns:{name:null,startDate:null,endDate:null,resources:null,agenda:{type:"agendacolumn"}},enableSticky:!0,preserveScrollOnDatasetChange:!0,positionMode:"position",settingsButton:{actionKey:"Ctrl+R",ariaLabel:"L{settings}",keyMap:{Escape:"revertFocus"}},cellTabIndex:null,rowCls:{"b-cal-agenda-grid-row":1},cellCls:{"b-calendar-cell":1},eventBarContainerCls:"b-cal-event-bar-container",keyMap:null,store:{modelClass:Wv},listRangeMenu:{align:{align:"t100-b100"}},dateFilter:null,alwaysShowCurrentDate:null,showEmptyDates:null,emptyText:"L{YearView.noEvents}",topDate:{$config:{equal:"date"},value:null}};construct(e){const t=W.getPropertyDescriptor(this,"features");Object.defineProperty(this,"features",{get:()=>t.get.call(this),set:e=>{var n;const r=Jv.getInstanceDefaultFeatures(this);for(const e in r)r[e]=!1;r.print=(null==e?void 0:e.print)||Boolean(null===(n=this.calendar)||void 0===n?void 0:n.features.print),t.set.call(this,r)},configurable:!0}),super.construct(e),this.keyMap=qM().$meta.config.keyMap}onCalendarKeyDown(e){var t,n;const{eventContentElement:r}=this,{target:i}=e,s=`.${this.dayCellCls}`,o=i.closest(s);if(!o)return super.onCalendarKeyDown(e);switch(e.key){case"ArrowUp":e.preventDefault(),null===(t=Eg.getVisitor(r,s).previous(o))||void 0===t||t.focus();break;case"ArrowDown":e.preventDefault(),null===(n=Eg.getVisitor(r,s).next(o))||void 0===n||n.focus();break;default:return super.onCalendarKeyDown(e)}}initScroll(){super.initScroll(...arguments),this.scrollable.ion({scroll:"onAgendaViewScroll",scrollEnd:"onAgendaViewScroll",thisObj:this})}onResponsiveStateChange({state:e,oldState:t}){var n;null===(n=super.onResponsiveStateChange)||void 0===n||n.call(this,...arguments),!t||"small"!==t&&"small"!==e||this.refresh()}onAgendaViewScroll(){if(!this.scrollingToDate){const{firstVisibleRow:e}=this;e&&(this.topDate=this.getDateFromElement(e.cells[0]))}}updateRange(e,t){const n=this,{rowManager:r}=n;if(t&&r.rowCount){const{dayTime:t}=n,i=t.parseKey(r.topRow.id),s=t.parseKey(r.bottomRow.id);if(!xi.betweenLesserEqual(n.date,i,s))return n.scrollToDateOnDateChange=!1,n._startDate=xi.floor(n._startDate,e,null,n.weekStartDay),n.date=n.firstVisibleRow.id,void(n.scrollToDateOnDateChange=!0)}super.updateRange(...arguments)}updateTopDate(e){this.trigger("topDateChange",{date:e})}changeColumns(){var e;const t=super.changeColumns(...arguments);return null==t||null===(e=t.forEach)||void 0===e||e.call(t,(e=>{e.autoHeight=Boolean(!e.isAgendaColumn||e.renderer!==e.defaultRenderer||this.eventRenderer)})),t}onFocusGesture(){}onGridElementFocus(){}onGridBodyFocusIn(){}focusCell(){}setHoveredRow(){}onElementKeyDown(){}onElementMouseDown(){}editAutoCreatedEvent(e,t){this.populateStoreSoon.now(),super.editAutoCreatedEvent(e,t)}handleEvent(e){const{type:t}=e;super.handleEvent(e),yk[e.type]?this.onEventMouseOverOut(e):!1!==this.consumeGridPointerEvents&&bk[t]&&this.onCalendarPointerInteraction(e)}getCellDataFromEvent(e){if(e.target.closest(".b-grid-cell")){const t=super.getCellDataFromEvent(e);return t&&(t.record=this.getEventRecord(e.target)),t}}getDateFromPosition(e,t){const n=this.rowManager.getRowAt(t),r=null==n?void 0:n._cells.normal[0];return r&&this.getDateFromElement(r)}updateOffsetStartsBeforeEvents(e){this.element.classList.toggle("b-offset-continues-past",Boolean(e))}updateEventRowSpacing(e){this.contentElement.style.setProperty("--event-row-spacing",Yn.setLength(e))}updateSuppressLongEvents(){this.fillFromMaster()}onCalendarStoreChange({action:e,oldCount:t,records:n,removed:r,added:i}){const s=this;if(s.isPainted){if(!("filter"!==e||null!=r&&r.length||null!=i&&i.length))return;if("dataset"===e)return;if("remove"===e&&1===n.length&&n[0].isEventModel){const{store:e}=s,t=n[0],r=xi.clearTime(t.startDate),i=xi.clearTime(t.endDate);do{const n=xi.makeKey(r),i=s.cellMap.get(n);i&&(nt.remove(i.events,t),i.events.length?s.onStoreUpdateRecord({source:e,record:s.store.getById(n),changes:{}}):(s.cellMap.delete(n),delete s.dateIndex[n],e.remove(n,!0))),r.setDate(r.getDate()+1)}while(r<i);return}}s.populateStoreSoon()}get cellMap(){var e;const t=this;return null!==(e=t._cellMap)&&void 0!==e&&e.populated?t._cellMap:t.createCellMap({endDate:xi.add(t.endDate,t.range?0:1,"d"),rawEvents:!0,skipPropagate:!0})}onMonthChange(){var e;super.onMonthChange(...arguments),null!==(e=this._cellMap)&&void 0!==e&&e.size||!this.alwaysShowCurrentDate||this.populateStoreSoon()}populateStore(){var e,t;null===(e=this._cellMap)||void 0===e||e.clear();const n=this,{store:r,rowManager:i,dateFilter:s,hiddenNonWorkingDays:o,dayTime:a,scrollable:l,initialScrollDone:d}=n,c=isNaN(n.eventHeight)?25:n.eventHeight,{firstVisibleRow:u}=i,h=null==u?void 0:u.id,g=u?u.top-l.y:0;n._eventCount=0,n.populateStoreSoon.cancel(),n.element.dataset.duration=n.duration,n.date||(n.isConfiguring=!0,n.date=n.eventStore.map((e=>e.startDate)).sort(((e,t)=>e.valueOf()-t.valueOf()))[0],n.isConfiguring=!1);const{cellMap:m,firstVisibleDate:p,eventRowSpacing:f}=n,v=xi.add(n.endDate,n.range?0:1,"d"),y=n.showEmptyDates?n.createRangeCellMapEntries():[...m.values()],b=[],C=n.dateIndex={};for(let e=0,{length:t}=y;e<t;e++){const t=y[e],{date:i}=t;if(i>=p&&i<v&&(!s||n.callback(s,n,[t]))&&!o[i.getDay()]){const e=r.createRecord(t),n=nt.findInsertionIndex(e,b,Ck);b.splice(n,0,e),C[t.id]=e}}if(n.alwaysShowCurrentDate&&!(r.isFiltered?b.filter(r.filtersFunction):b).length){const e=r.createRecord({...n.createCellData(n.date),cls:"b-current-date-placeholder"});b.push(e),C[e.id]=e}r.suspendEvents(),r.loadData(b),r.resumeEvents(),n.onAgendaStoreFilter();const{count:w}=r,S=w?r.records.map((e=>e.events.length)).reduce(((e,t)=>e+t),0)/w:0,D=n.findClosestOccupiedDate(n.date),E=r.getById(d?h:a.dateKey(D));if(i._rowHeight=i.minRowHeight=Math.max(S*(c+f)-f,70),i.calculateRowCount(!1,!0,!0),i.estimateTotalHeight(!0),w){const{topRow:e}=i,t=Math.max(r.indexOf(E)-i.prependRowBuffer,0);i.topIndex=e.dataIndex=t,e.setTop(i.rowHeight*t)}if(i.refresh(),E){const e=i.getRecordCoords(E,!0),t=d?{animate:!1,block:"start",edgeOffset:g}:{animate:!1};l.y+=l.getDeltaTo(e,t).yDelta,i.lastScrollTop=l.y,n.scrollTo(E,t),n.initialScrollDone=!0}n.refreshCount=(n.refreshCount||0)+1,n.trigger("refresh"),null===(t=n.calendar)||void 0===t||t.syncUIWithActiveView(n),n.columns.forEach((e=>{var t,n;return null===(t=(n=e.constructor).exposeProperties)||void 0===t?void 0:t.call(n)})),n.getConfig("settingsButton")}createRangeCellMapEntries(){const e=this,{cellMap:t,startDate:n,endDate:r}=e,i=[];for(const s=new Date(n);s<r;s.setDate(s.getDate()+1))i.push(t.get(xi.makeKey(s))||e.createCellData(s));return i}toggleEmptyText(){var e;const{store:t}=this,n=!((1!==t.count||null!==(e=t.first)&&void 0!==e&&e.events.length?t.count:0)>0||t.isLoading||t.isCommitting);this.element.classList.toggle("b-grid-empty",n)}scrollRowIntoView(e){const{scrollable:t,rowManager:n}=this,r=this.store.getById(e);if(!n.getRowFor(r)){const e=this.columns.find((e=>"agendacolumn"===e.type));if(e.renderer===e.defaultRenderer){const e=this.calculateRowTop(r);t.y=e<n.firstVisibleRow.top?e+n.averageRowHeight:e-t.clientHeight,n.jumpToPosition(t.y)}}super.scrollRowIntoView(...arguments)}calculateRowTop(e){let t=0;if(this.rowManager.rowCount){var n;const r=this,i=isNaN(r.eventHeight)?25:r.eventHeight,{eventRowSpacing:s}=r,o=r.rowManager.topRow.cells[0],a=Yn.getEdgeSize(o,"padding","tb").height,l=((null===(n=o.querySelector(".b-cal-agenda-date"))||void 0===n?void 0:n.offsetHeight)||0)+a;for(let n=0,{count:o}=r.store;n<o;n++){const o=r.store.getAt(n),d=Math.max(o.events.length*(i+s)-s+a,l);if(o===e)break;t+=d}}return t}get eventCount(){return this._eventCount}collectEvents(e){return e.getDateIndex=e=>Number(e)!==Number(this.startDate)&&this.hideEventOverflow?"startDate":"date",super.collectEvents(e)}changeStore(e){return(e=super.changeStore(e))&&(this.nonWorkingDaysFilter=e.addFilter({id:`${this.id}-nonworkingday-filter`,filterBy:e=>!e.isNonWorking,disabled:!this.hideNonWorkingDays},!0),this.detachListeners("agendaStoreFilter"),e.ion({name:"agendaStoreFilter",filter:"onAgendaStoreFilter",thisObj:this}),e.reapplyFilterOnAdd=!0),e}onAgendaStoreFilter(){const e=this;e._eventCount=e.store.reduce(((t,n,r)=>{const{events:i,date:s}=n;for(let n=0,{length:o}=i;n<o;n++){const o=i[n];e.isAllDayEvent(o)&&r&&xi.clearTime(o.startDate).valueOf()!==s.valueOf()||t++}return t}),0)}updateHideEventOverflow(){this.refresh()}updateHideNonWorkingDays(e){this.isConfiguring||(this.nonWorkingDaysFilter.disabled=!e),this.refresh()}doRefresh(){this.populateStore()}createCellData(e){return Object.assign(this.cellMonth.getCellData(e,this.month),{view:this,id:xi.makeKey(e),events:[]})}set cellRenderer(e){this._cellRenderer=e}changeSettingsButton(e){const{listRangeMenu:t}=this;return t&&(t.appendTo=this.element),(e=e&&t&&super.changeSettingsButton(this.constructor.mergeConfigs({menu:t},e)))&&this.addKeyBinding(e.actionKey,(()=>{e.focus,e.element.click()})),e}}wk.initClass(),wk._$name="AgendaView";const Sk=/^[+-]?\d+(?:\.\d+)?(?:%|px)?$/;class Dk{static from(e){return null==e?null:e instanceof Dk?e:(Array.isArray(e)||"string"==typeof e&&isNaN(e)||(e=0===(e=Number(e))?[0,new Number(0)]:e<1?[e,0]:[0,e]),new Dk(...e))}static get(e){return Dk.from(e)||Dk.ZERO}constructor(e,t){this.r=e,this.d=t}add(e){return(e=Dk.from(e))?new Dk(this.r+e.r,this.d+e.d):this}adjust(e,t){return this.r+=e||0,this.d+=t||0,this}freeze(){return Object.freeze(this)}px(e){return this.r*(e||100)+this.d}sub(e){return(e=Dk.from(e))?new Dk(this.r-e.r,this.d-e.d):this}*[Symbol.iterator](){yield"r",yield"d"}stringify(){const e=this.toString();return Sk.test(e)?e:`calc(${e})`}toString(){const{r:e,d:t}=this;let n;return e?(n=Yn.percentify(100*e),t&&(n=`${n} + ${t}px`.replace("+ -","- "))):n=t?`${t}px`:"0",n}}Dk.ZERO=new Dk(0,0).freeze(),Dk._$name="LayoutDim";const Ek=function(e){var t,n;const r=this;return{[e?"right":"left"]:null===(t=r.left)||void 0===t?void 0:t.stringify(),top:r.top.stringify(),width:null===(n=r.width)||void 0===n?void 0:n.stringify(),height:r.height.stringify(),minWidth:r.minWidth}};class xk extends(Qe.mixin(ds)){static factoryable={};static configurable={gutter:!0,gutterWidth:5,inset:40,overlapTolerance:null,owner:null};beforeLayoutEvents(e){return this.owner.trigger("beforeLayoutEvents",{context:e}),e}clusterize(e,t,n,r){const i=e[e.length-1]||null;t.push(n),i&&this.overlaps(i,n)?(n.cluster=i,i.end=Math.max(i.end,n.end),i.items.push(n)):e.push(n.cluster={context:r,start:n.start,end:n.end,items:[n]})}createLayoutContext(e,t){const n=null==e?void 0:e.events;return{cellData:e,dayDomConfig:t,events:(null==n?void 0:n.length)>1?e.dayTime.sortEvents(e.date,n.slice()):n||[],clusters:[],items:[],layout:this}}layoutEvents(e,t){const n=this,r=n.beforeLayoutEvents(n.createLayoutContext(e,t)),{clusters:i,events:s,items:o}=r;let a,l,d,c;for(a of s)d=n.createLayoutItem(a,r),n.clusterize(i,o,d,r);for(l=0,c=i.length;l<c;++l)n.layoutCluster(i[l]);return n.owner.trigger("layoutEvents",{context:r}),r}createLayoutItem(e,t){const{date:n,tomorrow:r,dayEnd:i,dayTime:s}=t.cellData,{allDay:o,startDate:a,endingDate:l}=e,d=o||a<n?0:s.delta(a,"s"),c=qs.from(e.preamble),u=qs.from(e.postamble);let h=o||l>=r?i:s.delta(l,"s");!e.isMilestone||e.isTimeRangeModel||e.allDay||(h=d+this.owner.milestoneDuration/1e3);const g=Math.max(d,0),m=Math.min(h,i),p=Dk.from(g/i);return{eventRecord:e,getStyles:Ek,start:g,end:m,top:p,id:e.id,height:new Dk(m/i,0).sub(p),startsBefore:a<n||d<0,endsAfter:r<l||h>i,preambleSec:c?xi.as("s",c):0,postambleSec:u?xi.as("s",u):0}}overlaps(e,t,n,r){return"string"==typeof n&&(r=n,n=null),r=r||"end",n=n??(60*this.overlapTolerance||0),e.start<t[r]-n&&t.start<e[r]-n}syncGutter(){this.owner.setStyle("--dayview-cell-gutter",String(Dk.get(this.gutter&&this.gutterWidth)))}updateGutter(){this.syncGutter()}updateGutterWidth(){this.syncGutter()}updateInset(e){this.owner.setStyle("--dayview-cell-inset-size",String(Dk.get(e)))}}xk._$name="DayLayout";class Rk extends(HE()){static get defaultConfig(){return{coordProp:"left",sizeProp:"width"}}pack(e){const t=e.map((e=>{const{startDate:t}=e.eventRecord,n=new Date(t);return n.setSeconds(n.getSeconds()+e.maxEnd-e.start),{item:e,start:t,end:n,x:0}}));this.packEventsInBands(t,((e,t,n,r)=>{e.width=r,e.w=r*Tk,e.x+=(e.left=n.start+t*r)*Tk,e.item.x=e.x,e.item.w=e.w}))}}const Tk=1e4,Mk=Object.freeze([]),kk=new Rk;class Fk extends xk{static type="fluid";static configurable={clearanceMinutes:45,complexityLimit:2e3,escapeMinutes:null,indentWidth:10,staggerMaximum:null,staggerMinimum:.4,staggerWidth:!0,stretch:null};createLayoutContext(e,t){const n=this,r=super.createLayoutContext(e,t),{staggerWidth:i}=n;return Object.assign(r,{indentWidth:Dk.get(n.indentWidth),stagger:new Dk,staggerMaximum:Dk.from(n.staggerMaximum),staggerMinimum:n.staggerMinimum,staggerWidth:Dk.from(!0===i?n.gutterWidth:i),stretch:n.stretch})}layoutCluster(e){const{context:t,items:n}=e,{indentWidth:r,stagger:i,staggerMaximum:s,staggerMinimum:o,staggerWidth:a,stretch:l}=t,d=this.treeify(n);this._assignSizes(n,d);for(const e of n){const t=e.depth,n=new Dk,d=new Dk,c=e.majorParent||e;for(const e of i)i[e]=a[e]*(t.height+t.overlap),i[e]=null!=s&&s[e]?Math.min(s[e],i[e]):i[e];n.r=c.x+t.minor*r.r*c.w,n.d=t.minor*r.d,d.r=l?1-n.r:c.w-n.r+c.x,d.d=-n.d,o&&(e.minWidth=`calc(${o} * (${d}))`),d.r-=i.r*c.w,d.d-=i.d,e.left=n,e.width=d}}treeify(e){const t=[];for(let n=0;n<e.length;n++)this._addChild(e[n],n,t);return t}_addChild(e,t,n){const r=this,{clearanceMinutes:i,escapeMinutes:s,stretch:o}=r,a=60*i,l=a+60*s,d=60*(r.overlapTolerance||0),c=e=>10*e.depth.minor+e.depth.major*(o?1:0),u={depth:0,height:0,heightMajor:0,overlap:0,major:0,minor:0};if(e.parent=null,e.maxEnd=e.maxEndMajor=e.end,e.depth=u,e.order=t,!n.length)return n[0]=e,void(e.barriers=Mk);let h,g,m,p,f,v,y=0;for(p of n){if(h=p.lastItem||p,!r.overlaps(e,p,d,"maxEnd")){f=p.parent,g=!0;break}if(b=e,C=h,Math.abs(C.start-b.start)>=a){for(m=!0,g&&(g=!1,f=null);h!==p&&!r.overlaps(h,e,d);h=h.parent);v=c(h),(!f||v<y)&&(f=h,y=v)}else m||(g=!0,f=p)}var b,C;if(g)m=0,g=f?f.depth.major+1:0,p=f=n[g-1]||null;else{for(p=f.majorParent||f;l&&f!==p&&!(r.overlaps(f,e,d)&&e.start-f.start<l);f=f.parent);m=f.depth.minor+1,g=f.depth.major}e.parent=f,u.major=g,u.minor=m,u.depth=f?f.depth.depth+1:0,m?(e.majorParent=p,e.previousItem=p.lastItem,p.lastItem=e):r._addMajor(e,n),r._adjustOverlap(e),r._adjustParents(e)}_addMajor(e,t){const n=this,{stretch:r}=n;if(t[e.depth.major]=e,e.barriers=n._getOverlaps(t,e,1),r||e.barriers.length)for(const i of n._getOverlaps(t,e,-1)){const t=i.barriers.filter((t=>!e.barriers.includes(t)));(r||t.length<i.barriers.length)&&(i.barriers=t,t.push(e))}}_adjustOverlap(e){if(e.depth.minor){let t,n;for(n=e;n.depth.minor>1;n=n.parent);for(t=0;n=n.previousItem;)this.overlaps(n,e)&&(t=Math.max(t,n.depth.height+n.depth.overlap+1));e.depth.overlap=t}}_adjustParents(e){const{depth:t,end:n}=e,r=t.minor+t.overlap;for(let i,s=e;s=s.parent;)if(i=s.depth,i.major===t.major)for(s.maxEnd=Math.max(s.maxEnd,n);i.height<r-i.minor;)++i.height,i.overlap&&--i.overlap;else i.heightMajor=Math.max(i.heightMajor,t.major-i.major)}_assignSizes(e,t){const{complexityLimit:n,stretch:r}=this,i=e.filter((e=>!e.depth.minor));if(n)for(const e of i){const i=e.barriers.map((e=>[e])),{parent:s}=e,o=e.depth.heightMajor+1;e.x=s?s.x+s.w:0;let a,l,d,c,u,h,g,m=(1-e.x)/o;if(i.length){for(a=0;a<i.length;){if(c=i[a],d=d||c,a>n){m=1/t.length;break}if(u=c[c.length-1],u.order<e.order)++a,g=u.x,l=0;else{if(u.barriers.length){i.splice(a,1,...u.barriers.map((e=>c.concat(e)))),d===c&&(d=null);continue}++a,g=1,l=1}h=(g-e.x)/(l+c.length),h<m&&(m=h,d=c)}if(r){for(h=d.reduce(((e,t)=>e+t.depth.height+1),0),a=e.lastItem;a;a=a.previousItem)a.depth.overlap+=h;e.depth.overlap+=h}}e.w=m}else{kk.pack(i);for(const e of i)e.x/=Tk,e.w/=Tk}}_getOverlaps(e,t,n){const{end:r}=t,i=n<0?-1:e.length;let s,o,a,{start:l}=t;for(s=t.depth.major+n;s!==i&&l<r;s+=n)o=e[s],l<o.maxEnd&&o.start<r&&((a||(a=[])).push(o),l=o.maxEnd);return a||Mk}}Fk.initClass(),Fk._$name="FluidDayLayout";const{MILLIS_PER_HOUR:Ik}=Dg,Ak=new Date(2020,11,22,22,59,59),Lk={paint:1,refresh:1,resize:1,eventspercellchange:1,rangechange:1,beforedatechange:1,localized:1},Pk=e=>{e.stopImmediatePropagation()},Ok=e=>e.ctrlKey&&e.preventDefault(),$k={level:0,step:"1 hour"},_k=new Ot(0,0,0,0),Hk=["30 minutes","15 minutes","10 minutes","5 minutes"],Vk=["30 minutes","12 minutes","6 minutes"],Nk=e=>e.eventRecord||e,Bk=Object.freeze([]),zk=e=>"string"==typeof e?{text:e}:e;class jk extends(Xu.mixin(qM,JM,hk,ok)){static $name="DayView";static type="dayview";static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0},adjustCoreHours:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{role:"grid",localizableProperties:["timeFormat","timeAxisTimeFormat","noMatchingDates"],layout:"vbox",textContent:!1,scrollable:{overflowY:!0,propagateSync:!0},title:"L{Day}",eventHeight:"auto",hourHeight:42,minHourHeight:15,range:{magnitude:1,unit:"day"},fixedDuration:null,visibleStartTime:{$config:"lazy",value:7},dayStartShift:null,dayStartTime:null,dayEndTime:null,dayTime:0,increment:"15 min",timeSnapType:"round",intradayCls:null,showTime:!0,showBullet:!1,iconTarget:"header",eventLayout:{type:"fluid"},minDayWidth:null,eventColourStyleProperty:"backgroundColor",monitorResize:Boolean(Yn.scrollBarWidth),eventFilter:null,snapRelativeToEventStartDate:!1,timeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},timeAxisTimeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},allDayEvents:{$config:["lazy","nullify"],value:{type:"calendarrow"}},overflowPopup:null,showAllDayHeader:{value:null,$config:null,default:!0},eventSpacing:1,responsive:{small:{descriptionFormat:"MMMM YYYY"},"*":{descriptionFormat:null}},maxAllDayHeight:null,fitHours:null,dayCellRenderer:null,tickRenderer:null,coreHours:null,zoomOnMouseWheel:!0,allowZoomUnderflow:!1,hourHeightBreakpoints:[70,140,300,500],sixMinuteTicks:null,minEventHeight:"1em",shortEventHeight:32,currentTimeIndicatorRenderer:null,actionButtons:null,hideEmptyDays:null,dateFilter:null,autoRefresh:["hideEmptyDays","dateFilter"],dashedSubticks:null,columnHeaderRenderer:null,showCurrentTime:{$config:"lazy",value:{onTop:!0}},noMatchingDates:"L{noMatchingDates}",interDayResize:null,interDayDrag:null,keyMap:{"+":"zoomIn","Shift++":"zoomIn","-":"zoomOut"}}}construct(e){var t;const n=this;n.configuredHiddenVerticalScroll="hidden-scroll"===(null===(t=e.scrollable)||void 0===t?void 0:t.overflowY),n.cellMapEventFilter=n.cellMapEventFilter.bind(n),super.construct(...arguments),n.startDate||(n.startDate=n.month.date),ir.ion({theme:"onThemeChange",thisObj:n})}startConfigure(e){this.hasConfig("fixedDuration")||this.isDayResourceView||(this.fixedDuration=!(this.initialConfig.range||this.initialConfig.endDate)),super.startConfigure(e)}updateProject(e,t){this.isConfiguring||this.allDayEvents&&(this.allDayEvents.project=e),super.updateProject(e,t)}updateZoomOnMouseWheel(e){var t;e?this.zoomListener=Jt.on({element:this.dayContentElement,wheel:"onDayContentMousewheel",thisObj:this,throttled:{buffer:100,alt:Ok}}):null===(t=this.zoomListener)||void 0===t||t.call(this)}get childItems(){const{allDayEvents:e}=this,t=super.childItems;return e&&t.push(e),t}get dayEndTime(){var e;return(null===(e=this.dayTime)||void 0===e?void 0:e.timeEnd)??this._dayEndTime}get dayStartTime(){var e;return(null===(e=this.dayTime)||void 0===e?void 0:e.timeStart)??this._dayStartTime}get dayStartShift(){var e;return(null===(e=this.dayTime)||void 0===e?void 0:e.startShift)??this._dayStartShift}changeDayEndTime(e){return this.adjustCoreHours(),Math.ceil((this.configuredDayEndTime=Dg.parse(e))/Ik)*Ik}updateDashedSubticks(e){this.dayContainerElement.classList.toggle("b-dashed-subticks",Boolean(e))}updateDayEndTime(e){this._dayTime=null,this.dayTime=new Dg({startShift:this.dayStartShift,timeStart:this.dayStartTime,timeEnd:e})}changeDayStartTime(e){return this.adjustCoreHours(),Math.floor((this.configuredDayStartTime=Dg.parse(e))/Ik)*Ik}adjustCoreHours(){if(null==this.initialConfig.coreHours){const{_dayStartTime:e,_dayEndTime:t,configuredDayStartTime:n,configuredDayEndTime:r}=this;this.coreHours=e<n||t>r?{start:n||0,end:r||24,overlayDay:!0}:null}}updateDate(e,t){const{allDayEvents:n}=this;n&&(n.date=e),super.updateDate(e,t)}updateDayStartTime(e){this._dayTime=null,this.dayTime=new Dg({startShift:this.dayStartShift,timeStart:e,timeEnd:this.dayEndTime})}updateDayStartShift(e){this._dayTime=null,this.dayTime=new Dg({startShift:e,timeStart:this.dayStartTime,timeEnd:this.dayEndTime})}changeDayTime(e){var t;if(e||(e=new Dg(this)),null===(t=this._dayTime)||void 0===t||!t.equals(e))return e}updateDayTime(e,t){const n=this,{eventStore:r}=n;if(r&&(r.registerDayIndex(e),t&&r.unregisterDayIndex(t)),!n.isConfiguring&&(n.syncHours(),e.startShift!==(null==t?void 0:t.startShift))){var i;const t=e.startOfDay(n.startDate),r=e.startOfDay(n.date);n.setConfig({date:r,startDate:t}),null===(i=n.allDayEvents)||void 0===i||i.setConfig({date:r,dayTime:e,startDate:t})}}dateKey(e){return this.dayTime.dateKey(e)}dayOfDate(e){return e&&this.dayTime.dayOfDate(e)}async scrollTo(e,t){const n=this,{allDayEvents:r}=n,i=[],s="number"==typeof e,o=s?xi.add(n.startDate,e,"hour"):"string"==typeof e?xi.parse(e):new Date(e),a=!isNaN(o);if(await n.scrollPromise,await(null==r?void 0:r.heightAnimation),n.isDestroyed)return;let l;if(t=W.assign({},n.defaultScrollOptions,"boolean"==typeof t?{animate:t}:t),i.push(await super.scrollTo(a?o:e,{...t,y:!a,highlight:!1})),a){const{firstVisibleDate:r,lastVisibleDate:s}=n;r.setHours(n.dayStartHour),s.setHours(n.dayEndHour),o.setTime(xi.clamp(o,r,s));let a=-1;for(;!n.getDayElement(o);){if((o<r||o>s)&&(a=-a,a<0))return;o.setDate(o.getDate()+a)}l=n.getDayElement(o),l&&!1!==t.y&&(e=o.getHours()+o.getMinutes()/60,i.push(n.scrollable.scrollTo(null,n.getPositionFromTime(e),t)))}else if(l=n.getEventElement(e),l){const e=Ot.from(l.closest(".b-calendar-cell")),r=Ot.from(l);t.edgeOffset={end:n.rtl?r.x-e.x:e.right-r.right}}return l&&(!a||n.duration>1&&!s)&&i.push(n.horizontalScroller.scrollIntoView(l,t)),n.scrollPromise=Promise.all(i).then((()=>n.scrollPromise=null))}getEventElement(e,t){var n;return super.getEventElement(e,t)||(null===(n=this.allDayEvents)||void 0===n?void 0:n.getEventElement(e,t))}getEventElements(e){var t;return super.getEventElements(e)||(null===(t=this.allDayEvents)||void 0===t?void 0:t.getEventElements(e))}getPositionFromTime(e){return Dg.parse(e)<Dg.parse(this.dayStartTime)-this.dayStartShift?0:this.dayTime.delta(e,"h")*this.hourHeight}updateShowAllDayHeader(e){var t;const n=this,{_allDayEvents:r}=n;var i;(null===(t=n._cellMap)||void 0===t||t.clear(),n.element.classList.toggle("b-hide-allday-header",!e),r)&&(null===(i=r._cellMap)||void 0===i||i.clear(),r.element.classList.toggle("b-hide-allday-header",!e),r.refresh());n.isConfiguring||n.refresh()}changeAllDayEvents(e,t){var n;if(!e)return null==t?void 0:t.destroy();this.getConfig("date"),e.maxHeight&&(this.maxAllDayHeight=e.maxHeight,e.maxHeight=null);const r=this,{autoCreate:i,dayHeaderRenderer:s,overflowButtonRenderer:o,overflowClickAction:a,overflowPopup:l,avatarRendering:d,range:c,shiftIncrement:u}=r,h=r.isConfiguring?r.peekConfig("showAllDayHeader"):r.showAllDayHeader,g=ck.reconfigure(t,e,{owner:r,defaults:{calendar:r.calendar,parent:r,rtl:r.rtl,cls:{"b-dayview-schedule-container":1,"b-dayview-initializing":1,"b-hide-allday-header":!h},[void 0!==l?"overflowPopup":"_"]:l,[o?"overflowButtonRenderer":"_"]:o,[a?"overflowClickAction":"_"]:a,[s?"dayHeaderRenderer":"_"]:s,[d?"avatarRendering":"_"]:d,[u?"shiftIncrement":"_"]:u,autoCreate:!1!==i&&{newName:i.newName,gesture:i.gesture,startHour:0,duration:null!==(n=r.initialConfig.autoCreate)&&void 0!==n&&n.duration?`${xi.as(i.durationUnit,"1 day")} ${i.durationUnit}`:"1 day"},[r.initialConfig.dragUnit?"dragUnit":"_"]:r.dragUnit,dayNameSelector:".b-day-name-date",eventFilter:e=>r.showAllDayHeader&&r.isAllDayEvent(e)&&(!r.eventFilter||r.eventFilter(e)),dayStartTime:r.dayStartTime,dayEndTime:r.dayEndTime,dayStartShift:r.dayStartShift,eventRenderer:r.eventRenderer,eventStore:r.eventStore,month:r.month,fullWeek:1===r.duration&&r.fixedDuration&&!r.dayTime.startShift,filterEventResources:r.filterEventResources,startDate:r.startDate,[c?"range":"_"]:c,[c?"_":"endDate"]:r.endDate,nonWorkingDays:r.nonWorkingDays,dateFilter:r.dateFilter,nonWorkingDayCls:r.nonWorkingDayCls,weekendCls:r.weekendCls,weekStartDay:r.weekStartDay,defaultCalendar:r.defaultCalendar,emptyCellRenderer:r.emptyCellRenderer,hideEmptyDays:r.hideEmptyDays,syncCalendarDate:r.syncCalendarDate,internalListeners:{heightChange:"updateElementLayout",refresh:"updateElementLayout",catchall:"relayAllDayEvents",showoverflowpopup:"onAllDayOverflowPopupShown",thisObj:r},editAutoCreatedEvent(e){(r.showAllDayHeader?this:r).trigger("eventAutoCreated",{eventRecord:e})},createCellMap(){return r.showAllDayHeader?this.constructor.prototype.createCellMap.call(this,...arguments):r.emptyMap||(r.emptyMap=new Map)},actionButtons:r.actionButtons},setup(e){e.hideNonWorkingDays=!(1===r.duration&&!e.fullWeek)&&r._hideNonWorkingDays}});return g&&(g.height=g.flex=null,r.originalAllDayEventsScrollTo=g.scrollTo,g.scrollTo=r.allDayEventsScrollTo.bind(r)),g}onAllDayOverflowPopupShown({overflowPopup:e}){this._overflowPopup=e}allDayEventsScrollTo(e){const t=this,n=e.isEvent?e.startDate:t.changeEndDate(e);if(e.isEvent?xi.intersectSpans(t.startDate,t.endDate,e.startDate,e.endDate):xi.betweenLesser(n,t.startDate,t.endDate))return t.originalAllDayEventsScrollTo.call(t.allDayEvents,...arguments);t.date=n}updateAutoCreate(e){var t;const{_allDayEvents:n}=this;null===(t=super.updateAutoCreate)||void 0===t||t.call(this,e),n&&(n.autoCreate=!!e&&{newName:e.newName,gesture:e.gesture,startHour:0,duration:"1 day"})}updateWeekStartDay(e,t){var n;null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.weekStartDay=e)}updateEventStore(e,t){super.updateEventStore(e,t);const{dayTime:n}=this;n&&(null==e||e.registerDayIndex(n),null==t||t.unregisterDayIndex(n))}get overflowPopup(){var e;return(null===(e=this._allDayEvents)||void 0===e?void 0:e.overflowPopup)||this._overflowPopup}get description(){const e=this,{range:t,shortDateFormat:n}=e;return e.descriptionRenderer||e.fixedDuration||1===e.duration||1===(null==t?void 0:t.magnitude)&&"day"===t.unit?super.description:t&&!e.dateFilter?`${xi.format(e.startDate,n)}, ${t.magnitude} ${xi.getLocalizedNameOfUnit(t.unit,t.magnitude>1)}`:`${xi.format(e.startDate,n)} - ${xi.format(xi.add(e.endDate,-1,"d"),n)}`}get eventContentElement(){return this.dayContainerElement}getDateFromDomEvent(e,t=!1){let n=super.getDateFromDomEvent(e);const r=this,i=Yn.getEventElement(e);if(n&&i!==e&&r.dayContainerElement.contains(i)){const s=(e.clientY||i.getBoundingClientRect().y)-.5;n=xi.add(n,r.dayStartHour-r.dayStartShift/36e5+(s-r.scrollable.element.getBoundingClientRect().y+r.scrollable.y)/r.hourHeight,"hour"),t||(n=xi[r.timeSnapType](n,r.increment))}return n}getDateFromPosition(e,t,n=!1,r){const i=this,{eventContentElement:s,allDayEvents:o}=i,a=n?_k:Ot.fromScreen(s).roundPx().translate(-s.scrollLeft),l=s.scrollWidth,d=n?e:e-a.x,c=i.rtl?i.eventContentElement.offsetWidth-d:d,u=t-a.y,h=i.getDayElementFromX(e),g=(null==h?void 0:h.offsetHeight)||i.hourHeight*i.getDayLength("hour"),m=i.getDateFromElement(h,r)||i.date;return o&&(c<0||l<c||u<0||g<u)?o.getDateFromPosition(e,t,r):(xi.clearTime(m,!1),m.setMilliseconds(m.getMilliseconds()+i.dayStartMs+Math.floor(u/g*i.getDayLength())),xi[i.timeSnapType](m,i.increment))}doRefresh(){const e=this,{element:t,noMatchingDates:n}=e,r=e.resolveCallback(e.columnHeaderRenderer,e,!1);if(e.isVisible){var i,s;e.allowTransitionsOnRefresh||Yn.addTemporaryClass(t,"b-no-transitions",200,e),e.allowTransitionsOnRefresh=null;const o=[],a=[];e.today=e.dayTime.startOfDay((null===(i=e.calendar)||void 0===i?void 0:i.dateTimeNow)||new Date);for(let t=0,n=new Date(e.startDate);n<e.endDate;t++,n.setDate(n.getDate()+1)){const i=e.getDayDomConfig(n);if(i&&(a.push(i),r))if(a[t]){const t=e.dayTime.dateKey(n),i={dataset:{syncId:t},className:{"b-day-column-header-cell":1}},s=r.handler.call(r.thisObj,e.cellMap.get(t));s&&(i["string"==typeof s?"html":"children"]=s),o.push(i)}else o.push(null)}r?(t.classList.add("b-has-day-header"),ud.sync({targetElement:e.dayHeaderContentElement,domConfig:{onlyChildren:!0,children:o,syncOptions:{syncIdField:"syncId",releaseThreshold:0,strict:!0}}})):t.classList.remove("b-has-day-header"),t.classList.toggle("b-multidayview",a.length>1),t.style.setProperty("--visible-column-count",a.length),null===(s=e.onDayCellConfigGenerated)||void 0===s||s.call(e,a),ud.sync({targetElement:e.dayContainerElement,domConfig:{onlyChildren:!0,children:a.length?a:[{className:"b-empty-text",[null!=n&&n.includes("<")?"html":"text"]:n}],syncOptions:{syncIdField:"date",releaseThreshold:0,strict:a.length>0}}}),e.element.classList.toggle("b-no-days",!a.length),e.refreshDayBackground(),e.refreshCount=(e.refreshCount||0)+1,e.syncCurrentTimeIndicators(),e.trigger("refresh")}}getEventsForDay(e,t){var n;const r=this,i="string"==typeof e?e:r.dayTime.dateKey(e),{allDayEvents:s}=r;var o;t&&r.startDate-t&&(null===(o=r._cellMap)||void 0===o||o.clear(),r.startDate=t);const a=(null===(n=r.cellMap.get(i))||void 0===n||null===(n=n.events)||void 0===n?void 0:n.slice())||[];if(s){var l,d;if(s.startDate-r.startDate)null===(d=s._cellMap)||void 0===d||d.clear(),s.startDate=r.startDate;a.push.apply(a,(null===(l=s.cellMap.get(i))||void 0===l?void 0:l.renderedEvents)||Bk)}return a.map(Nk)}getBaseDayDomConfig(e){const t=this,{dateFilter:n,resource:r}=t,i=t.dayTime.dateKey(e),s=t.cellMap.get(i)||t.cellMap.set(i,t.createCellData(e)).get(i),{day:o}=s;if(!(t.hiddenNonWorkingDays[o]&&1!==t.duration||t.hideEmptyDays&&!t.getEventsForDay(i).length||n&&!t.callback(n,t,[s]))){var a;const n=t.nonWorkingDays||t.month.nonWorkingDays;return[s,{tabIndex:-1,role:"gridcell","aria-label":`${xi.format(e,"dddd Do MMMM")}${r?` ${r.name}`:""}, ${t.L("eventCount",(null===(a=s.events)||void 0===a?void 0:a.length)||0)}.`,dataset:{date:i},className:{"b-dayview-day-detail":1,[t.dayCellCls]:1,[t.nonWorkingDayCls]:n[o]||!1,[t.weekendCls]:xi.weekends[o],[t.todayCls]:!(e-t.today),"b-last-cell":!(e-t.lastVisibleDate),[`b-day-of-week-${o}`]:1,"b-past-date":e<t.today},style:{},children:{inset:{className:{"b-dayview-inset":1}},events:{className:{"b-dayview-event-container":1},children:[]},...t.renderTickBackground(s,r)},syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}}renderTickBackground(e,t){const n=this,r=n.resolveCallback(n.tickRenderer,n,!1),i={};if(r){const s=parseInt(Yn.getStyleValue(n.contentElement,"--subtick-count")),o=n.getDayLength("h"),a=o*s,l=o/a,{dayTime:d}=n,{startHour:c}=d;let u,h,g,m=new Date(e.date);for(m.setHours(c),h=0,g=0;h<a;h++){const n=m;if(m=xi.add(m,l,"h"),u=r.handler.call(r.thisObj,{events:e.events.filter((e=>xi.intersectSpans(n,m,e.startDate,e.endingDate))),startTime:n,endTime:m,tickIndex:h,subtickIndex:g,subTickCount:s,resourceRecord:t}),u){"string"==typeof u?u={text:u}:Array.isArray(u)&&(u={children:u.map(zk)});const e=!m.getMinutes(),t=u.rowspan||u.rowSpan;"string"==typeof u.style&&(u.style=Yn.parseStyle(u.style)),(u.style||(u.style={}))["--tick-index"]=h,t&&(u.style["--tick-rowspan"]=t,u.rowspan=u.rowSpan=null),u.className={...Vt.from(u.className,!0),"b-dayview-subtick":1,"b-last-in-hour":e},(u.dataset||(u.dataset={})).hour=n.getHours(),u.dataset.minute=n.getMinutes(),u.dataset.index=g++,e&&(g=0),i[`subtick-${h}`]=u}}}return i}getDayDomConfig(e){const t=this,n=t.getBaseDayDomConfig(e);if(n){const{dayCellRenderer:r}=t,[i,s]=n;return t.coreHours&&(s.style.backgroundImage=t.getCoreHoursGradient(t.getCoreHoursForDate(e))),t.renderEvents(i,s),Yn.normalizeChildren(r?t.callback(r,t,[s,i]):s)}}onCalendarKeyDown(e){var t,n,r;const{target:i}=e,{dayCellCls:s,allDayEvents:o}=this,{eventContentElement:a}=null!==(t=this.owner)&&void 0!==t&&t.isCalendarMixin?this.owner:this;if(a.contains(i)){var l;const t=`${i.matches(".b-dayview-day-detail")?".b-dayview-day-detail":""}.${s}`,c=i.closest(t)||i,u=null===(l=c.closest("[data-date]"))||void 0===l?void 0:l.dataset.date,h=c.matches(t),{resourceId:g}=c.dataset,m=g?` [data-resource-id="${g}"]`:"";switch(e.key){case"ArrowUp":if(h&&o){var d;e.preventDefault();let t=o.eventContentElement.querySelector(`.${o.dayCellCls}[data-date="${u}"]${m}`);Yn.isFocusable(t)&&Yn.isInView(t)||(t=o.headerCellContainer.querySelector(`[data-header-date="${u}"]`).focus()),null===(d=t)||void 0===d||d.focus()}return;case"ArrowLeft":return e.preventDefault(),void(null===(n=Eg.getVisitor(a,t).previous(c))||void 0===n||n.focus());case"ArrowRight":return e.preventDefault(),void(null===(r=Eg.getVisitor(a,t).next(c))||void 0===r||r.focus())}return super.onCalendarKeyDown(e)}}getCoreHoursGradient(e){if(!e)return"";const{dayTime:t}=this,n=t.duration("h"),r=["linear-gradient(to bottom"];e=nt.asArray(e);let i=0;for(let s=0,{length:o}=e;s<o;s++){const a=e[s],l=Math.max(t.delta(a.start,"h"),0)/n*100,d=Math.min(t.delta(a.end,"h"),n)/n*100;if(1===o&&0===l&&100===d)return"";i<l&&r.push(`var(--dayview-outside-core-hours-color) ${Yn.percentify(i)}, var(--dayview-outside-core-hours-color) ${Yn.percentify(l)}`),r.push(`transparent ${Yn.percentify(l)}, transparent ${Yn.percentify(d)}`),i=d}return i<100&&r.push(`var(--dayview-outside-core-hours-color) ${Yn.percentify(i)}, var(--dayview-outside-core-hours-color) 100%`),r.join(",")+")"}getCoreHoursForDate(e){const{coreHours:t}=this;return 7===t.length?t[e.getDay()]:"object"==typeof t?t.overlayDay?t:null:this.callback(t,this,[e])}refreshDayEvents(e){const t=this;e=t.changeEndDate(e),t.today=t.dayTime.startOfDay(new Date);const n=t.getDayDomConfig(e);Yn.addTemporaryClass(t.element,"b-no-transitions",200,t),n.onlyChildren=!0,ud.sync({targetElement:t.getDayElement(e),domConfig:n})}renderEvents(e,t){const n=this,r=n.eventLayout.layoutEvents(e,t),{items:i}=r,{eventSpacing:s,rtl:o}=n;for(const r of i){const i=n.createEventDomConfig({date:e.date,eventRecord:r.eventRecord});n.insertActionButtons(i.children[0].children[0].children,r.eventRecord,e),i.className["b-starts-above"]=r.startsBefore,i.className["b-ends-below"]=r.endsAfter,r.cluster.items.length>1&&(i.className["b-cal-in-cluster"]=1),Object.assign(i.style,{[s?"padding-bottom":""]:`${s}px`,...r.getStyles(o)}),t.children.events.children.push(i)}n.trigger("renderEvents",{context:r})}changeActionButtons(e){const t=Array.isArray(e);let n;return t&&e.forEach(((e,t)=>{"ref"in e||(e.ref=`action-button-${t+1}`)})),this._actionButtonsObject=t?W.transformArrayToNamedObject(e):e,new Proxy(e,{deleteProperty:(e,t)=>delete(n||(n=W.clone(e)))[t],get(e,t){return"$value"===t?n||e:"$reset"===t?()=>n=null:Array.isArray(e)&&"function"==typeof e[t]?(n||(n=W.clone(e)))[t].bind(n):Reflect.get(...arguments)},set:(e,t,r)=>Reflect.set(n||(n=W.clone(e)),t,r)})}insertActionButtons(e,t,n){const{actionButtons:r}=this;if(r){const{$value:t}=r,n=Array.isArray(t)?t:W.transformNamedObjectToArray(t);n.length&&e.push({className:"b-event-action-buttons",children:n.sort(oc.weightSortFn).map((({cls:e,tooltip:t,ref:n},r)=>({tag:"button",className:{"b-tool":1,"b-icon":1,[e]:1},dataset:{ref:n,btip:t},"aria-label":t})))}),r.$reset()}}onEventClick({domEvent:e}){const t=e.target.closest(".b-event-action-buttons button[data-ref]");if(t)return this.callback(this._actionButtonsObject[t.dataset.ref].handler,this,arguments),!1}get overflowElement(){return this.dayContentElement}get cellMap(){var e;return null!==(e=this._cellMap)&&void 0!==e&&e.populated?this._cellMap:this.createCellMap()}get bodyConfig(){const e=this,{allDayEvents:t,maxAllDayHeight:n}=e;return Object.assign(super.bodyConfig,{children:{alldayRowElement:t?{className:{"b-dayview-allday-row":1},style:{[n?"maxHeight":""]:Yn.setLength(n)},children:{cornerElement:{className:{"b-dayview-allday-row-start":1,"b-dayview-allday-autoheight":t.autoHeight},children:{allDayTextElement:{className:"b-dayview-allday-text",html:e.L("L{EventEdit.All day}")},allDayToggleIcon:{tag:"button",className:"b-expand-allday-button b-icon b-icon-expand-row",dataset:{btip:e.L("L{DayView.expandAllDayRow}")},"aria-label":e.L("L{DayView.expandAllDayRow}"),"aria-expanded":!1}}},allDayEvents:null==t?void 0:t.element,$scrollerPad:Yn.scrollBarPadElement}}:null,dayHeaderElement:{className:"b-day-column-header",children:{dayHeaderScrollerElement:{className:"b-day-column-header-scroller",children:{dayHeaderContentElement:{className:"b-day-column-content"}}},$scrollerPad:Yn.scrollBarPadElement}},dayContentElement:{role:"presentation",className:{"b-dayview-day-content":1},children:{timeAxisElement:{children:e.getTimeElementConfigs(),className:{"b-timeaxis-container":1},"aria-hidden":!0},dayContainerElement:{role:"row",className:{"b-dayview-day-container":1}}}},horizontalScrollerElement:{className:"b-virtual-scrollers b-hide-display",children:[{className:"b-virtual-scroller"},Yn.scrollBarPadElement]}}})}async onDayContentMousewheel(e){if(e.ctrlKey){e.preventDefault();const{zoomOnMouseWheel:t}=this,n="number"==typeof t?t:1,r=e.clientY-this.scrollable.element.getBoundingClientRect().y,i=-Math.min(Math.abs(e.deltaY),10)*Math.sign(e.deltaY);await this.zoomPromise,this.zoomPromise=this.zoomBy(i*n,r,this.allowZoomUnderflow)}}zoomIn(){this.zoomBy(2)}zoomOut(){this.zoomBy(-2,void 0,!0)}zoomBy(e,t=Math.min(this.scrollable.scrollHeight,this.scrollable.clientHeight)/2-1,n){return new Promise((r=>{const i=this,s=i.getDayLength("h"),o=i.hourHeight*s;i.updateElementLayout.cancel(),t=Math.min(t,o);const{scrollable:a,hourHeight:l}=i,{clientHeight:d}=a,{scrollTop:c}=a.element,u=e<0&&o>=d-5&&!n,h=xi.round("number"==typeof t?i.getDateFromPosition(i.dayContainerElement.offsetWidth/2,t+c,!0):xi.parse(t,"HH:mm:ss"),i.increment),g=u?i.dayContentClientHeight/s:i.minHourHeight,m=i.getPositionFromTime(h)-c,p=Math.max(Math.max(l+e,g),i.minHourHeight);if(u&&p*s<d)return i.fitHours=!0,r();l!==p?(a.overflowY=i.configuredOverflowY,i.ion({layoutUpdate:()=>{a.scrollTo(null,i.getPositionFromTime(h)-m),a.syncPartners(!1,!0),r()},once:!0,prio:1e3}),i.fitHours=!1,i.hourHeight=p):(i.configuredOverflowY=a.overflowY,p===g&&(a.overflowY="hidden"),r())}))}zoomTo(e,t){return this.zoomBy(e-this.hourHeight,t,!0)}async zoomToFit(e){const t=this,n=t.eventStore.getEvents({startDate:t.startDate,endDate:t.endDate,filter:e=>!e.isInterDay}),[r,i]=n.reduce(((e,t)=>{const n=xi.getTimeOfDay(xi.floor(t.startDate,"0.5h"),"h"),r=xi.getTimeOfDay(xi.ceil(t.endDate,"0.5h"),"h");return[n<e[0]?n:e[0],r>e[1]?r:e[1]]}),[24,0]);await t.zoomTo(Math.floor(t.scrollable.clientHeight/(i-r))),await t.scrollTo(r,e)}createCellMap(){const{showAllDayHeader:e}=this;return super.createCellMap({dayTime:this.dayTime,startOnly:e,allowPartial:!e,skipPropagate:!0,rawEvents:!0,filter:this.cellMapEventFilter})}cellMapEventFilter(e){const{dayTime:t,hiddenNonWorkingDays:n,showAllDayHeader:r}=this;return(!r||t.isIntraDay(e)&&!e.allDay)&&t.intersects(e)&&!n[t.dayOfWeek(e.startDate)]}getDayLength(e="ms"){return this.dayTime.duration(e)}changeIncrement(e){return"string"==typeof e?(e=xi.parseDuration(e),xi.as("ms",e.magnitude,e.unit)):e}get dayStartHour(){return null==this.dayStartTime?0:Math.floor(this.dayStartTime/Ik)}get dayEndHour(){return null==this.dayEndTime?24:Math.ceil(this.dayEndTime/Ik)}get dayStartMs(){return null==this.dayStartTime?0:this.dayStartTime}get dayEndMs(){return null==this.dayEndTime?24*Ik:this.dayEndTime}get dayStartOffset(){return this.dayTime.startTimeOffsetMs/Ik*this.hourHeight}changeEventFilter(e){return void 0===e&&(e=e=>!this.isAllDayEvent(e)),e}changeEventLayout(e,t){return xk.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateHideEmptyDays(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.hideEmptyDays=e)}updateDateFilter(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.dateFilter=e)}updateNonWorkingDays(e){var t;const n=this;var r;(null===(t=super.updateNonWorkingDays)||void 0===t||t.call(this,e),n._allDayEvents&&(n._allDayEvents.nonWorkingDays=e),n.isConfiguring)||(null===(r=n._cellMap)||void 0===r||r.clear(),n.refresh())}updateMaxAllDayHeight(e){this.alldayRowElement&&Yn.setLength(this.alldayRowElement,"max-height",e)}get hideNonWorkingDays(){return(!0!==this._hideNonWorkingDays||1!==this.duration)&&this._hideNonWorkingDays}set hideNonWorkingDays(e){super.hideNonWorkingDays=e}updateHideNonWorkingDays(e){const t=this,{_allDayEvents:n}=t;var r;(super.updateHideNonWorkingDays(e),n&&(n.hideNonWorkingDays=!(1===t.duration&&!n.fullWeek)&&t._hideNonWorkingDays),t.isConfiguring)||(null===(r=t._cellMap)||void 0===r||r.clear(),t.refresh())}updateSyncCalendarDate(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.syncCalendarDate=e)}syncHours(){var e;const t=this;null===(e=t._cellMap)||void 0===e||e.clear(),ud.sync({targetElement:t.timeAxisElement,domConfig:{onlyChildren:!0,children:t.getTimeElementConfigs()}}),t.updateElementLayout.now(),t.refresh()}syncCurrentTimeIndicators(){var e;const t=this,n=(null===(e=t.calendar)||void 0===e?void 0:e.dateTimeNow)||new Date,{showCurrentTime:r,dayTime:i,currentTimeIndicatorRenderer:s}=t,{style:o}=t.element,a=null!=r&&r.showTime?xi.round(n,{unit:"minute",magnitude:1}):n;if(i.contains(n)?(o.setProperty("--current-time",`"${xi.format(a,t.timeAxisTimeFormat)}"`),o.setProperty("--current-time-seconds",i.delta(a,"second"))):(o.setProperty("--current-time",""),o.setProperty("--current-time-seconds","")),r&&xi.betweenLesser(n,t.startDate,t.endDate)&&i.contains(n)){const{currentTimeElement:e,timeAxisElement:i}=t;var l;if(r.showTime?e.parentNode!==i&&(null==i||i.insertBefore(e,i.firstChild)):e.remove(),s)null===(l=t.getDayElement(n))||void 0===l||l.appendChild(t.currentTimeIndicator)}else{var d,c;null===(d=t._currentTimeIndicator)||void 0===d||d.remove(),null===(c=t._currentTimeElement)||void 0===c||c.remove()}}updateShowCurrentTime(e){const{dayContentElement:t}=this;t.classList.toggle("b-custom-current-time",Boolean(this.currentTimeIndicatorRenderer)),t.classList.toggle("b-hide-current-time",!Boolean(e)),t.classList.toggle("b-show-current-time",Boolean(null==e?void 0:e.showTime)),t.classList.toggle("b-show-time-full-width",Boolean(null==e?void 0:e.fullWidth)),t.classList.toggle("b-show-time-on-top",Boolean(null==e?void 0:e.onTop)),this.isConfiguring||this.syncCurrentTimeIndicators()}get currentTimeIndicator(){const e=this._currentTimeIndicator||(this._currentTimeIndicator=Yn.createElement(this.callback(this.currentTimeIndicatorRenderer,this)));return e.style.top="var(--current-time-position)",e}get currentTimeElement(){return this._currentTimeElement||(this._currentTimeElement=Yn.createElement({retainElement:!0,className:"b-time-axis-current-time",children:[{className:"b-current-time-text"}]}))}eachHour(e){const{dayTime:t}=this,{startHour:n}=t,r=t.duration("h");e=this.resolveCallback(e);for(let t=new Date(2e3,5,15,n,0,0),i=0;i<r;i++)e.handler.call(e.thisObj,t.getHours(),new Date(t),i),t.setHours(t.getHours()+1)}getTimeElementConfigs(){const e=this,{startHour:t}=e.dayTime,n=[];return e.eachHour(((r,i,s)=>{const o=e.createLeafTicks(i);!s&&e.showDayStartHour&&o.unshift({className:"b-dayview-timeaxis-tick b-dayview-hour-tick b-dayview-start-hour",text:xi.format(new Date(2e3,5,15,t,0,0),e.timeAxisTimeFormat)}),i.setHours(r=i.getHours()+1),i.setMinutes(0),n.push({className:`b-dayview-timeaxis-time b-dayview-timeaxis-time-${r<10?"0":""}${r}`,children:o.concat([{className:"b-dayview-timeaxis-tick b-dayview-hour-tick",text:xi.format(i,e.timeAxisTimeFormat)}])})})),e.coreHours&&e._simpleCoreHours&&n.unshift({className:"b-dayview-timeaxis-background",style:{backgroundImage:e.getCoreHoursGradient(e.coreHours)}}),n}createLeafTicks(e){return this[this.sixMinuteTicks?"createSixMinuteTicks":"createFiveMinuteTicks"](e)}createFiveMinuteTicks(e){const t=[];for(let n=1;n<12;n++)e.setMinutes(5*n),t.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-4":1,"b-dayview-tick-level-3":!(1&n),"b-dayview-tick-level-2":!(n%3),"b-dayview-tick-level-1":6===n},text:xi.format(e,this.timeAxisTimeFormat)});return t}createSixMinuteTicks(e){const t=[];for(let n=1;n<10;n++)e.setMinutes(6*n),t.push({className:{"b-dayview-timeaxis-tick":1,"b-dayview-tick-level-3":1,"b-dayview-tick-level-2":!(1&n),"b-dayview-tick-level-1":5===n},text:xi.format(e,this.timeAxisTimeFormat)});return t}changeCoreHours(e){const t=this;return t._simpleCoreHours=W.isObject(e)||Array.isArray(e)&&7!==e.length,t._simpleCoreHours&&((e=W.clone(e))._overlayDay=e.overlayDay,Object.defineProperty(e,"overlayDay",{set(e){this._overlayDay=e,t.updateCoreHours()},get(e){return this._overlayDay}})),e}updateCoreHours(){this.isConfiguring||this.syncHours()}changeScrollable(){this.refreshDayBackground();const e=super.changeScrollable(...arguments);return this.configuredOverflowY=null==e?void 0:e.overflowY,e}changeShowTime(e){return!0===e?{startTime:!0,endTime:!1}:e}updateShowTime(){this.isConfiguring||this.refresh()}changeStartDate(){return this.dayOfDate(super.changeStartDate(...arguments))}updateRange(e){!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.range=e),super.updateRange(...arguments)}updateShiftIncrement(e){var t;!this.isConfiguring&&this.allDayEvents&&(this.allDayEvents.shiftIncrement=e),null===(t=super.updateShiftIncrement)||void 0===t||t.call(this,...arguments)}updateStartDate(e){const{_allDayEvents:t}=this;if(t){const n=!this.range&&this.peekConfig("endDate"),r={startDate:e};n&&(r.endDate=n),null==t||t.setConfig(r)}super.updateStartDate(...arguments)}changeEndDate(){return this.dayOfDate(super.changeEndDate(...arguments))}updateEndDate(e){var t,n;(null===(t=super.updateEndDate)||void 0===t||t.call(this,...arguments),this.updatingRange)||(null===(n=this._allDayEvents)||void 0===n||n.setConfig({date:this.date,endDate:e}))}changeMinDayWidth(e){return"number"==typeof e?Math.max(e,50):"string"==typeof e?e:null}updateMinDayWidth(e){this.element.style.setProperty("--min-day-width",e?Yn.setLength(e):null),this._allDayEvents&&(this._allDayEvents.minDayWidth=e),this.updateElementLayout()}updateMinHourHeight(e){this.hourHeight=Math.max(this.hourHeight,e)}changeHourHeight(e){if(e)return Math.max(e,this.minHourHeight)}updateHourHeight(e){this.isConfiguring&&(this.milestoneHeight=Math.max(Math.min(e/2,this.shortEventHeight),22)),this.milestoneDuration=36e5/(e/this.milestoneHeight),this.shortEventDuration=36e5/(e/this.shortEventHeight),this.isConfiguring||(this.updateElementLayout(),this.fitHours&&this.refresh())}updateShortEventHeight(e){this.updateHourHeight(this.hourHeight)}updateMinEventHeight(e){this.contentElement.style.setProperty("--dayview-min-event-height",Yn.setLength(e))}get hourHeight(){return!this.isConfiguring&&this.fitHours?Math.max(this.dayContentClientHeight/this.getDayLength("hour"),this.minHourHeight):this._hourHeight}changeFitHours(e){const t=this;return e?t.configuredMinHourHeight=t.minHourHeight:t.configuredMinHourHeight&&(t.minHourHeight=t.configuredMinHourHeight),e}get dayContentClientHeight(){return Yn.floorPx(Ot.client(this.dayContentElement).height)}updateFitHours(e){const t=this;e&&(e.minHeight?t.minHourHeight=Math.max(e.minHeight,9):t.minHourHeight=17),t.isConfiguring||e&&(t.hourHeight=Math.max(t.dayContentClientHeight/t.getDayLength("hour"),t.minHourHeight)),t.element.classList.toggle("b-fit-hours",Boolean(e)),t.monitorResize=Yn.scrollBarWidth||e}updateEventSpacing(){var e;this.isConfiguring||(null===(e=this._cellMap)||void 0===e||e.clear(),this.refresh())}onInternalPaint({firstPaint:e}){var t;const n=this,{dayContainerElement:r,horizontalScrollerElement:i}=n,{scrollBarWidth:s}=Yn;if(null===(t=super.onInternalPaint)||void 0===t||t.call(this,...arguments),e){const{allDayEvents:e}=n;n.horizontalScroller=new Md({widget:n,element:r,overflowX:!s||"hidden-scroll",overflowY:"clip",propagateSync:!0,internalListeners:{overflowChange:"updateElementLayout",thisObj:n}}),n.dayHeaderScroller=new Md({_id:`${n.id}-dayheader-scroller`,widget:n,element:n.dayHeaderScrollerElement,overflowX:!s||"hidden-scroll",overflowY:"clip",propagateSync:!0}),n.horizontalScroller.addPartner(n.dayHeaderScroller),e&&(e.element.classList.remove("b-dayview-initializing"),n.horizontalScroller.addPartner(e.headerScroller)),fd.addResizeListener(n.dayContainerElement,n.onDayContainerResize.bind(n)),n.scrollbarScroller=new Md({_id:`${n.id}-scrollbar-scroller`,widget:n,element:i.firstChild,scrollWidth:r.scrollWidth-s,overflowX:!0,overflowY:!1}),n.horizontalScroller.addPartner(n.scrollbarScroller),n.updateElementLayout.now(),n.setInterval(n.syncCurrentTimeIndicators.bind(n),15e3,"syncCurrentTimeIndicators"),e&&(Jt.on({click:{element:n.cornerElement,handler:"onCornerClick"},mousemove:{element:n.allDayEvents.element.nextSibling,handler:Pk,capture:!0},thisObj:n}),n.scrollable.ion({overflowChange:"syncScrollbarPadding",thisObj:n}))}}afterInternalPaint({firstPaint:e}){var t;null===(t=super.afterInternalPaint)||void 0===t||t.call(this,...arguments),e&&this.refresh()}scrollToVisibleStartTime(e=!0){if(null!=this.visibleStartTime){const t=this,{scrollable:n,allDayEvents:r,eventStore:i}=t,s=t.getPositionFromTime(t.visibleStartTime),o=async()=>{var e;null===(e=n.scrollTo)||void 0===e||e.call(n,null,s,{animate:!1,block:"start"})};s&&(s>n.maxY&&r&&!1!==t.showAllDayHeader?e&&!i.storage.generation?i.ion({refresh:()=>t.scrollToVisibleStartTime(!1),once:!0,expires:{delay:2e3,alt:o}}):t.scrollToStartTimer=t.allDayEvents.ion({heightChange:o,once:!0,expires:{delay:500,alt:o}}):o())}}relayAllDayEvents(e){if(!Lk[e.type])return this.trigger(e.eventName,e)}async onCornerClick(){const{allDayEvents:e}=this;e.isAnimating||(await e.toggleExpandCollapse(),this.isDestroyed||(this.allDayToggleIcon.setAttribute("aria-label",e.expanded?this.L("L{collapseAllDayRow}"):this.L("L{expandAllDayRow}")),this.allDayToggleIcon.setAttribute("aria-expanded",e.expanded)))}syncScrollbarPadding(){if(!this.configuredHiddenVerticalScroll&&this.allDayEvents)if(Yn.scrollBarWidth){if(!this.allDayEvents.isAnimating){const{allDayEvents:e,alldayRowElement:t,dayHeaderElement:n,scrollable:r}=this,i=this.fitHours&&r.clientHeight/this.getDayLength("hour")>=this.minHourHeight,s=!i&&r.hasOverflow(),{headerElement:o,scrollable:a}=e,l=e.expanded||e.autoHeight,d=Boolean(l&&a.hasOverflow());n.classList[s||d?"add":"remove"]("b-show-yscroll-padding"),s&&d?(o.classList.add("b-show-yscroll-padding"),t.classList.remove("b-show-yscroll-padding"),r.overflowY=a.overflowY="auto"):d!==s?d?(o.classList.add("b-show-yscroll-padding"),a.overflowY="auto",r.overflowY="scroll"):(o.classList.remove("b-show-yscroll-padding"),t.classList.add("b-show-yscroll-padding"),a.overflowY="hidden",r.overflowY=!i&&"auto"):(t.classList.remove("b-show-yscroll-padding"),o.classList.remove("b-show-yscroll-padding"),r.overflowY=!i&&"auto",a.overflowY="hidden")}}else this.scrollable.overflowY=this.allDayEvents.scrollable.overflowY="auto"}onInternalResize(e,t,n,r,i){const{_allDayEvents:s}=this;var o;(super.onInternalResize(e,t,n,r,i),i)&&((null==s||null===(o=s.cellMap)||void 0===o?void 0:o.size)&&(null==s||s.performResizeRefresh(s.eventsPerCell,s.eventContainerTop)),n!==i&&(this.updateElementLayout(),this.syncScrollbarPadding()))}onThemeChange(){this.updateElementLayout()}onDayContainerResize(e,{height:t}={},{height:n}){t&&(n!==t||Yn.scrollBarWidth&&this.minDayWidth)&&(this.updateElementLayout(),this.fitHours&&this.updateFitHours(this.fitHours))}async updateElementLayout(){var e;if(null!==(e=this.owner)&&void 0!==e&&e.isDestroyed)return;const t=this,{dayHeaderContentElement:n,dayContainerElement:r,horizontalScrollerElement:i,dayHeaderScroller:s,horizontalScroller:o,scrollbarScroller:a,allDayEvents:l}=t,d=r.querySelectorAll("[data-date]"),{scrollBarWidth:c}=Yn;let u,h;if(l&&t.refreshCount){const e=t.cornerElement.classList;l.hasOverflow?(e.add("b-has-cell-overflow"),e.toggle("b-expanded",Boolean(l.expanded))):e.remove("b-has-cell-overflow")}for(t.refreshDayBackground.now(),u=0,h=d.length-1;u<=h;u++)d[u].classList.toggle("b-last-cell",u===h);if(l&&t.syncScrollbarPadding(),c&&i.classList.toggle("b-show-yscroll-padding",t.scrollable.hasOverflow()),d.length){const e=Ot.from(d[d.length-1],r),l=Yn.roundPx(Ot.client(r).width),c=Yn.roundPx(t.rtl?l-e.left:e.right-1);c>l?(i.classList.remove("b-hide-display"),s.scrollWidth=c,n.style.minWidth=`${c}px`,a.scrollWidth=c,o.overflowX="hidden-scroll"):(i.classList.add("b-hide-display"),s.scrollWidth=null,n.style.minWidth="",a.scrollWidth=null,o.overflowX=!1),t.peekConfig("visibleStartTime")&&t.scrollToVisibleStartTime()}t.hasPainted&&t.trigger("layoutUpdate")}refreshDayBackground(){var e;const t=this,{contentElement:n,hourHeight:r,dayStartOffset:i,_hourHeightLevel:s,hourHeightLevel:o}=t,a=new Vt(n.classList),l=t.getDayLength("hour"),d=r*l,c=r/3600,u=(r-2)/2,h=(r-4)/4,g=(r-5)/5,m=(r-6)/6,p=(r-10)/10,f=(r-12)/12,v=n.style,y=Math.ceil(xi.format(Ak,t.timeAxisTimeFormat).length/2);a.remove("b-dayview-hourheight-level-1","b-dayview-hourheight-level-2","b-dayview-hourheight-level-3","b-dayview-hourheight-level-4"),o.level&&a.add(`b-dayview-hourheight-level-${o.level}`),a.toggle("b-six-minute-ticks",Boolean(t.sixMinuteTicks)),Yn.syncClassList(n,a),t.element.style.setProperty("--time-axis-width",`${y}em`),v.setProperty("--day-length",l),v.setProperty("--day-height",`${d}px`),v.setProperty("--hour-height",`${r}px`),v.setProperty("--half-hour-height",`${u}px`),v.setProperty("--fifteen-minute-height",`${h}px`),v.setProperty("--twelve-minute-height",`${g}px`),v.setProperty("--ten-minute-height",`${m}px`),v.setProperty("--six-minute-height",`${p}px`),v.setProperty("--five-minute-height",`${f}px`),v.setProperty("--leaf-tick-height",`${t.sixMinuteTicks?p:f}px`),v.setProperty("--second-height",`${c}px`),v.setProperty("--day-start-offset",`${i}px`),v.setProperty("--short-event-height",`${Yn.setLength(t.shortEventHeight||"")}`),null===(e=t.onRefreshDayBackground)||void 0===e||e.call(t),o.level!==(null==s?void 0:s.level)&&(t.tickRenderer&&t.doRefresh(),t.trigger("tickChange",{old:s||$k,new:o}))}updateSixMinuteTicks(e){this.isConfiguring||this.updateElementLayout()}changeHourHeightBreakpoints(e){return Array.isArray(e)?e:Object.values(e)}updateHourHeightBreakpoints(){this.isConfiguring||this.updateElementLayout()}get hourHeightLevel(){const e=this,{hourHeight:t,hourHeightBreakpoints:n,sixMinuteTicks:r}=e,i=r?Vk:Hk;for(let s=r?2:3;s>=0;s--)if(t>=n[s])return e._hourHeightLevel={level:s+1,step:i[s]};return e._hourHeightLevel=$k}updateLocalization(){!this.isConfiguring&&this.allDayTextElement&&ud.sync({targetElement:this.allDayTextElement,domConfig:{text:this.L("L{EventEdit.All day}")}}),super.updateLocalization()}}jk.initClass(),jk._$name="DayView";const{MILLIS_PER_HOUR:Wk}=Dg,Uk=new Ot(0,0,0,0),Gk={column:"column",vertical:"column",row:"row",horizontal:"row"};class Yk extends jk{static $name="DayAgendaView";static type="dayagenda";static get delayable(){return{updateElementLayout:{type:"raf",cancelOutstanding:!0},refreshDayBackground:{type:"raf",cancelOutstanding:!0},scrollToVisibleStartTime:{type:"raf",cancelOutstanding:!0}}}static configurable={shortEventCls:"",increment:"1 h",showCurrentTime:!1,hourHeight:55,showTime:{startTime:!0,endTime:!0},hourSpacing:"0.5em",hideEmptyHours:null,hideTimeAxis:null,borderColor:null,hideBorders:null,title:"L{dayAgenda}",timeSnapType:"floor",gutterWidth:10,eventFlowDirection:null,eventSpacing:5,syncHourHeights:null,minEventWidth:null,overHour:null};allowDragCreate=!1;allowDragResizee=!1;getPositionFromTime(e){var t;if(Dg.parse(e)<Dg.parse(this.dayStartTime)-this.dayStartShift)return 0;const n=Dg.parse(e)/36e5,r=null===(t=this.eventContentElement.querySelector("[data-date]"))||void 0===t?void 0:t.querySelector(`[data-hour="${n}"]`);return r?r.offsetTop+r.offsetHeight:0}getDateFromDomEvent(e,t=!1){const n=this,r=Yn.getEventElement(e),i=this.getDateFromElement(r);if(i&&r!==e&&n.dayContainerElement.contains(r)){var s;let e=r.closest("[data-hour]"),t=parseInt((null===(s=e)||void 0===s?void 0:s.dataset.hour)||0);var o;if(!e)e=[...r.querySelectorAll("[data-hour]"+(n.hideEmptyHours?".b-has-events":""))].at(-1),t=Math.min(parseInt((null===(o=e)||void 0===o?void 0:o.dataset.hour)||-1)+1,n.dayEndHour-1);i.setHours(t)}return i}getDateFromPosition(e,t,n=!1,r){const i=this,{eventContentElement:s,allDayEvents:o}=i,a=n?Uk:Ot.fromScreen(s).roundPx().translate(-s.scrollLeft),l=s.scrollWidth,d=n?e:e-a.x,c=i.rtl?i.eventContentElement.offsetWidth-d:d,u=t-a.y,h=i.getDayElementFromX(e),g=h.offsetHeight,m=i.getDateFromElement(h,r)||i.date;if(o&&(c<0||l<c||u<0||g<u))return o.getDateFromPosition(e,t,r);xi.clearTime(m,!1);const p=[...h.querySelectorAll(".b-day-agenda-hour")];let f,v;for(v=0,f=p[v];v<p.length&&u>=f.offsetTop&&u>f.offsetTop+f.offsetHeight;f=p[v],v++);m.setHours(parseInt(f.dataset.hour));const y=(u-f.offsetTop)/f.offsetHeight;return m.setMilliseconds(m.getMilliseconds()+y*Wk),xi[i.timeSnapType](m,i.increment)}getBaseDayDomConfig(e){const t=this,{dateFilter:n,resource:r}=t,i=t.dayTime.dateKey(e),s=t.cellMap.get(i)||t.cellMap.set(i,t.createCellData(e)).get(i),{day:o}=s,a=t.hiddenNonWorkingDays[o]&&1!==t.duration||t.hideEmptyDays&&!t.getEventsForDay(i).length||n&&!t.callback(n,t,[s]);if(t.getConfig("showCurrentTime"),!a){var l;const n=t.nonWorkingDays||t.month.nonWorkingDays,a=[];return t.eachHour(((e,n)=>{n.setHours(e),a.push({className:{"b-day-agenda-hour":1,"b-has-events":0},dataset:{hour:e},children:{time:{className:{"b-day-agenda-hour-time":1},text:xi.format(n,t.timeAxisTimeFormat)},events:{className:{"b-day-agenda-hour-events":1},children:[]}}})})),[s,{tabIndex:-1,role:"gridcell","aria-label":`${xi.format(e,"dddd Do MMMM")}${r?` ${r.name}`:""}, ${t.L("L{eventCount}",(null===(l=s.events)||void 0===l?void 0:l.length)||0)}.`,dataset:{date:i},className:{"b-dayview-day-detail":1,[t.dayCellCls]:1,[t.nonWorkingDayCls]:n[o]||!1,[t.weekendCls]:xi.weekends[o],[t.todayCls]:!(e-t.today),"b-last-cell":!(e-t.lastVisibleDate),[`b-day-of-week-${o}`]:1},style:{},children:a,syncOptions:{syncIdField:"eventId",releaseThreshold:0,strict:!0}}]}}getDayDomConfig(e){const t=this,n=t.getBaseDayDomConfig(e);if(n){const{dayCellRenderer:e}=t,[r,i]=n;return t.renderEvents(r,i),Yn.normalizeChildren(e?t.callback(e,t,[i,r]):i)}}renderEvents(e,t){for(const n of e.events){const r=t.children[n.startDate.getHours()-this.dayTime.startHour];if(r){const t=this.createEventDomConfig({date:e.date,eventRecord:n});this.insertActionButtons(t.children[0].children[0].children,n,e),r.className["b-has-events"]=1,r.children.events.children.push(t)}}this.trigger("renderEvents",e)}onInternalResize(e,t,n,r){super.onInternalResize(...arguments),t!==r&&this.syncHourHeights&&this.syncHeights()}changeShowCurrentTime(){return!1}onDayContentMousewheel(){}zoomBy(){}zoomTo(){}async zoomToFit(){}get dayStartOffset(){return 0}changeEventLayout(){}syncCurrentTimeIndicators(){}updateEventSpacing(e){this.element.style.setProperty("--event-spacing",Yn.setLength(e)),this.refreshDayBackground()}updateMinEventWidth(e){this.element.style.setProperty("--min-event-width",Yn.setLength(e)),this.refreshDayBackground()}updateHourSpacing(e){this.element.style.setProperty("--hour-event-padding-top",Yn.setLength(e)),this.refreshDayBackground()}updateGutterWidth(e){this.element.style.setProperty("--gutter-width",Yn.setLength(e)),this.refreshDayBackground()}updateHideEmptyHours(e){this.element.classList.toggle("b-hide-empty-hours",Boolean(e)),this.refreshDayBackground()}updateHideTimeAxis(e){this.element.classList.toggle("b-hide-timeaxis",Boolean(e)),this.refreshDayBackground()}updateHideBorders(e){this.element.classList.toggle("b-hide-borders",Boolean(e)),this.refreshDayBackground()}updateBorderColor(e){this.element.style.setProperty("--hour-border-color",e)}changeEventFlowDirection(e){return Gk[e]}updateEventFlowDirection(e){this.element.style.setProperty("--event-flow-direction",e),this.element.classList.toggle("b-event-flow-row","row"===e),this.refreshDayBackground()}updateSyncHourHeights(e){this.element.classList.toggle("b-synced-hour-heights",Boolean(e)),this.refresh()}updateOverHour(e,t){var n,r;t&&(null===(n=this.getHourElement(t))||void 0===n||n.classList.toggle("b-hover-hour",!1)),e&&(null===(r=this.getHourElement(e))||void 0===r||r.classList.toggle("b-hover-hour",!0))}getHourElement(e){var t;return null===(t=this.getDayElement(e))||void 0===t?void 0:t.querySelector(`[data-hour="${e.getHours()}"]`)}onDayCellConfigGenerated(e){if(this.syncHourHeights){const{timeAxisElement:t}=this;this.eachHour(((n,r,i)=>{const s=e.some((e=>e.children[i].className["b-has-events"])),o=t.querySelector(`[data-hour="${n}"]`);e.forEach((e=>e.children[i].className["b-has-events"]=s)),o.classList.toggle("b-has-events",s)}))}}onRefreshDayBackground(){var e;null===(e=super.onRefreshDayBackground)||void 0===e||e.call(this),this.whenVisible("syncHeights")}syncHeights(){const e=this,{timeAxisElement:t,dayContainerElement:n,syncHourHeights:r}=e;e.contentElement.style.setProperty("--hour-height",e.hideEmptyHours&&e.hideBorders?"auto":`${e.hourHeight}px`),n.querySelectorAll(".b-day-agenda-hour").forEach((e=>e.style.minHeight="")),e.eachHour((e=>{const i=[...n.querySelectorAll(`.b-day-agenda-hour[data-hour="${e}"]`)],s=r?`${Math.max(...i.map((e=>e.offsetHeight)))}px`:"",o=t.querySelector(`[data-hour="${e}"]`);i.forEach((e=>{e.style.minHeight=s})),o.style.minHeight=s}))}getTimeElementConfigs(){const e=[];return this.eachHour(((t,n)=>{e.push({className:{"b-day-agenda-hour":1},dataset:{hour:t},children:[{className:"b-day-agenda-hour-time",text:xi.format(n,this.timeAxisTimeFormat)}]})})),e}}Yk.initClass(),Yk._$name="DayAgendaView";const qk=/^(\d+)ev$/,Kk={shrinkwrap:1,expand:1};class Xk extends(Fm.mixin(qM,JM,rk)){static $name="MonthView";static type="monthview";static get configurable(){return{eventSorter:WM.interDaySorterFn,localizableProperties:["title","stepUnit"],title:"L{Month}",stepUnit:"L{monthUnit}",dragUnit:"day",localeClass:this,descriptionFormat:"MMMM YYYY",dayNumberCentered:null,showWeekNumber:!0,eventHeight:20,minHeight:485,autoRowHeight:{$config:"lazy",value:!1},persistShrinkWrappedRows:null,maxEventsPerCell:100,minRowHeight:null,overflowClickAction:"popup",alwaysRefreshOnMonthChange:!0}}static delayable={syncCalendarWeekDaysWithScrollable:{type:"raf",cancelOutstanding:!0},onAllWeekElementsFlexed:{type:"raf",cancelOutstanding:!0}};onCalendarKeyDown(e){var t;const n=this,{dayTime:r,eventContentElement:i}=n,{target:s}=e,o=`.${this.dayCellCls}`,a=s.closest(o)||s,l=a.matches(o),d=l?"date":"header-date",c=a.dataset[l?"date":"headerDate"],u=r.parseKey(c);let h,g;switch(e.key){case"ArrowUp":e.preventDefault(),h=-7;break;case"ArrowDown":e.preventDefault(),h=7;break;case"ArrowLeft":e.preventDefault(),h=-1;break;case"ArrowRight":e.preventDefault(),h=1;break;default:return super.onCalendarKeyDown(e)}const m=xi.add(u,h,"d"),p=h>0?n.nextSibling:n.previousSibling;for(;n.hiddenNonWorkingDays[m.getDay()];)m.setDate(m.getDate()+Math.sign(h));if(g=i.querySelector(`${o}[data-${d}="${r.dateKey(m)}"]`),!g&&p){const e=h>0?n.firstVisibleDate:n.lastVisibleDate;g=p.eventContentElement.querySelector(`${o}[data-${d}="${r.dateKey(e)}"]`)}null===(t=g)||void 0===t||t.focus()}get eventContainerHeight(){const e=this,{classList:t}=e.weeksElement;return null==e._eventContainerHeight&&e.isVisible&&!e.isConfiguring&&(t.add("b-measuring-container-height"),e._eventContainerHeight=super.eventContainerHeight,t.remove("b-measuring-container-height")),e._eventContainerHeight}onCalendarStoreChange(){super.onCalendarStoreChange(...arguments),this.syncShrinkwrappedRows()}onDateChange({changes:e}){if(e.m){const e=this,{autoRowHeight:t}=e;t&&e.weekElements.forEach((({classList:e})=>e.add("b-shrinkwrapped"))),e.persistShrinkWrappedRows||t?e.syncShrinkwrappedRows():e.shrinkwrappedRows.forEach((t=>e.flexWeekRow(t)))}}onCellOverflowGesture({date:e}){Kk[this.overflowClickAction.toLowerCase()]?this.shrinkwrapWeekRow(e):super.onCellOverflowGesture(...arguments)}addCellHeaderContent(e,t){const n={className:{"b-day-name":!0},role:"button"};return e.children=[t.visibleColumnIndex||this.showWeekColumn?null:{tabIndex:0,role:"link","aria-label":this.L("L{Calendar.weekOfYear}",t.week),className:"b-week-num",text:t.week[1]},n],n}get shrinkwrappedRows(){return this.weeksElement.querySelectorAll(".b-shrinkwrapped")}get shrinkwrapRowHeights(){const e=this,t=[],{cellMap:n}=e;return e.month.eachWeek(((e,[r])=>{let i=0;for(let e=0;e<7;e++,r.setDate(r.getDate()+1)){const e=n.get(xi.makeKey(r));e&&(i=Math.max(i,e.renderedEvents.length))}t.push(i)})),t.map((t=>e.eventHeightInPixels*t+e.eventSpacing*(t+1)+Math.ceil(e._eventContainerTop)))}getEventsPerCell(e){const t=this;if(t.hasShrinkwrappedRows){const n=Math.floor(xi.diff(t.startDate,e,"d")/7);if(t.weekElements[n].classList.contains("b-shrinkwrapped"))return t.maxEventsPerCell;{const e=t.weekElements[n].querySelector(t.visibleCellSelector).offsetHeight-t.eventContainerTop;return Math.floor((e+t.eventSpacing)/(t.eventHeightInPixels+t.eventSpacing))}}return t.eventsPerCell}getMaxEventsForWeek(e){const{row:t}=this.getWeekContext(e);return Math.max(...Array.from(t.querySelectorAll(this.visibleCellSelector)).map((e=>{const t=this.cellMap.get(e.dataset.date);return(null==t?void 0:t.renderedEvents.length)||0})))}getWeekContext(e){let t,n,r,i=this;var s;if("number"==typeof e)r=e,t=xi.parseKey(null===(s=i.weekElements[e].querySelector("[data-date]"))||void 0===s?void 0:s.dataset.date);else if(1===e.nodeType){var o;t=xi.parseKey(null===(o=e.closest(".b-calendar-row").querySelector("[data-date]"))||void 0===o?void 0:o.dataset.date),r=Math.floor(xi.diff(i.startDate,t,"d")/7)}else{const n=(e.getDay(e)-i.weekStartDay+7)%7;t=xi.add(xi.clearTime(e),-n,"d"),r=Math.floor(xi.diff(i.startDate,e,"d")/7)}if(t)for(n=new Date(t);i.hiddenNonWorkingDays[n.getDay()];)n.setDate(t.getDate()+1);return{rowIndex:r,weekStart:t,visibleWeekStart:n,row:i.weekElements[r]}}shrinkwrapWeekRow(e,t=!0){const n=this,{weekStart:r,row:i}=n.getWeekContext(e),{maxEventsPerCell:s,eventContainerTop:o}=n,a=i.classList.contains("b-shrinkwrapped"),l=n.getMaxEventsForWeek(e),d=s?Math.min(s,l):l,c=n.eventHeightInPixels*d+n.eventSpacing*(d+1)+Math.ceil(o),u=l>n.eventsPerCell,h=i.querySelector(".b-week-toggle-tool");if(t&&(n.scrollable={overflowY:"auto"}),i.classList.add("b-shrinkwrapped"),i.classList.contains("b-empty-row")?i.style.flex="":(h&&(h.dataset.btip=n.L("L{WeekExpander.collapseTip}")),i.classList.remove("b-has-overflow"),i.classList.toggle("b-expanded",u),i.style.flex=u?`0 0 ${c}px`:`1 0 ${c}px`),n.hasShrinkwrappedRows=!0,t&&n.refresh(),a||n.trigger("weekShrinkwrap",{weekStart:r,element:i}),t)return n.isAnimating||(n.isAnimating=!0),new Promise((e=>{Jt.onTransitionEnd({element:i,property:"flex-basis",handler:"onAllWeekElementsExpanded",thisObj:n,args:[e]})}))}onAllWeekElementsExpanded(e,t,n){this.isAnimating=!1,this.syncCalendarWeekDaysWithScrollable(),n()}async flexWeekRow(e,t=!0,n=!1){const r=this,{weekStart:i,row:s}=r.getWeekContext(e),o=s.querySelector(".b-week-toggle-tool");s.classList.contains("b-shrinkwrapped")&&(s.style.flex="",s.classList.add("b-flexing"),o&&(o.dataset.btip=this.L("L{WeekExpander.expandTip}")),r.trigger("weekFlex",{weekStart:i,element:s}),r._autoRowHeight=!1,t&&!r.isAnimating&&await r.executeAndAwaitAnimations(r.element,(()=>r.isAnimating=!0)),t?r.onAllWeekElementsFlexed(s,n):r.onWeekElementFlexed(s))}onWeekElementFlexed(e){e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded")}onAllWeekElementsFlexed(e,t){const n=this;n.scrollable.overflowY=n.scrollable.hasOverflow("y"),t?n.shrinkwrappedRows.forEach((e=>e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"))):e.classList.remove("b-shrinkwrapped","b-flexing","b-expanded"),n.isAnimating=!1,n.hasShrinkwrappedRows=n.shrinkwrappedRows.length,n.refresh(),n.syncCalendarWeekDaysWithScrollable()}syncCalendarWeekDaysWithScrollable(){var e;this.weekdaysHeader.classList[null!==(e=this.scrollable)&&void 0!==e&&e.hasScrollbar()?"add":"remove"]("b-show-yscroll-padding")}updateHideOtherMonthCells(){super.updateHideOtherMonthCells(...arguments),this.refresh()}updateEventHeight(e,t){const n=this;if(super.updateEventHeight(e,t),!n.isConfiguring){var r;null!==(r=n.minRowHeight)&&void 0!==r&&r.match(qk)&&n.updateMinRowHeight(n._minRowHeight),n.syncShrinkwrappedRows();const e=Yn.getEdgeSize(n.element,"padding","tb");n.minHeight=6*(2*(n.eventHeightInPixels+1)+3*n.eventSpacing+Math.ceil(n.eventContainerTop))+n.weekdaysHeader.offsetHeight+7+e.height}}updateMinRowHeight(e){var t,n;const r=this,i=parseInt(null===(t=e)||void 0===t||null===(n=t.match)||void 0===n||null===(n=n.call(t,qk))||void 0===n?void 0:n[1]);if(!isNaN(i)){if(r.isConfiguring)return r.ion({paint:"updateMinRowHeight",args:[e],once:!0});e=r.eventHeightInPixels*i+r.eventSpacing*(i+1)+Math.ceil(r.eventContainerTop)}super.updateMinRowHeight(e),r.isAnimating?r.ion({animationEnd:"performResizeRefresh",thisObj:r,args:[r._eventsPerCell,r._eventContainerTop],once:!0}):r.performResizeRefresh(r._eventsPerCell,r._eventContainerTop)}changeMaxEventsPerCell(e){return null==e?this.constructor.configurable.maxEventsPerCell:e}updateMaxEventsPerCell(){this.isConfiguring||this.syncShrinkwrappedRows()}async updateAutoRowHeight(e,t){var n,r;if(this.initializingAutoRowHeight&&e===Boolean(t))return;const i=this,{visibleWeekCount:s}=i,o=null===(n=i.features||(null===(r=i.calendar)||void 0===r?void 0:r.features))||void 0===n?void 0:n.weekExpander;let a;if(o&&e&&(o.disabled=o.disabledByAutoRowHeight=!0),e)for(let e=0;e<s;e++)a=i.shrinkwrapWeekRow(e,e===s-1);else for(let e=0;e<s;e++)a=i.flexWeekRow(e,e===s-1,!0);await a,o&&e&&o.disabledByAutoRowHeight&&(o.disabled=o.disabledByAutoRowHeight=!1),e||(i._eventContainerHeight=i._eventsPerCell=null,i.refresh())}syncShrinkwrappedRows(){if(this.isVisible){const{shrinkwrappedRows:e}=this;for(let t=0,n=Math.min(e.length,this.visibleWeekCount);t<n;t++)this.shrinkwrapWeekRow(e[t],t===n-1)}else this.whenVisible("refreshNow"),this.whenVisible("syncShrinkwrappedRows")}changeScrollable(e,t){var n;return null!==(n=e=super.changeScrollable(e,t))&&void 0!==n&&n.overflowX&&(this.weekdaysScrollable||(this.weekdaysScrollable=new Md({widget:this,element:this.weekdaysHeader,overflowX:"hidden-scroll"})),e.addPartner(this.weekdaysScrollable,"x")),e}async scrollTo(e,t){const n=this,{scrollable:r}=n,i="string"==typeof e?xi.parse(e):new Date(e),s=!isNaN(i);if(await n.scrollPromise,!n.isDestroyed&&(await super.scrollTo(s?i:e,{x:!1,y:!1}),s&&r)){const{firstVisibleDate:s,lastVisibleDate:o}=n;o.setHours(23,59,59),i.setTime(xi.clamp(i,s,o));let a=i.getDay()===(n.weekStartDay+6)%7?-1:1;for(;!Yn.isVisible(n.getDayElement(i));){if((i<s||i>o)&&(a=-a,a<0))return;i.setDate(i.getDate()+a)}(e=n.getDayElement(i))&&r.scrollIntoView(e,W.assign({},n.defaultScrollOptions,"boolean"==typeof t?{animate:t}:t))}}collectEvents(e){if(this.hideOtherMonthCells){const{year:t,month:n}=this.month;e.startDate=new Date(t,n,1),e.endDate=new Date(t,n+1,1)}return e.getDateIndex=e=>Number(e)===Number(this.firstVisibleDate||this.startDate)?"date":"startDate",super.collectEvents(e)}getDayElement(e,t){if("string"!=typeof e&&(e=xi.makeKey(e)),!t||parseInt(e.substr(5,2))===this.month.month+1)return super.getDayElement(e)}calendarHitTest(e){const t=super.calendarHitTest(e),n=Yn.getEventElement(e);if(t){var r;if(t.date.getMonth()!==this.month.month&&(this.disableOtherMonthCells||this.hideOtherMonthCells))return;const e=n.closest(".b-calendar-week"),s=null==e||null===(r=e.dataset.week)||void 0===r?void 0:r.split(",").map(Number);var i;if(s)t.cell=t.cell||n.closest(".b-calendar-cell"),t.dayNumber=Number(null===(i=t.cell)||void 0===i?void 0:i.dataset.columnIndex),t.week=s,t.weekElement=e,t.weekNumber=s[1],t.weekOffset=s[1]-Number(this.weeksElement.firstElementChild.dataset.week.split(",")[1])}return t}getDateFromPosition(e,t){const n=this,r=n.weeksElement.childNodes;for(let i,s=0;s<r.length;++s)if(i=r[s].getBoundingClientRect(),i.top<=t&&t<i.bottom&&i.left<=e&&e<i.right){const t=n.rtl?i.right-e:e-i.x,o=Math.floor(t*n.weekLength/i.width);if(n.hideNonWorkingDays){return Array.from(r[s].querySelectorAll(n.visibleCellSelector)).map((e=>n.getDateFromElement(e)))[o]}{const e=n.getDateFromElement(r[s].querySelector(n.visibleCellSelector));return e.setDate(e.getDate()+o),e}}return null}getWeekElementFor(e){const t=Yn.getEventElement(e);return(null==t?void 0:t.closest(".b-calendar-week"))||null}updateEventStore(e,t){var n;null===(n=super.updateEventStore)||void 0===n||n.call(this,e,t),Fm.prototype.doRefresh.call(this)}updateOverflowClickAction(){this.refresh()}updateSixWeeks(){this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null,super.updateSixWeeks(...arguments)}onMonthDateChange({changes:e}){e.r&&!this.sixWeeks&&(this._eventsPerCell=this._eventContainerTop=this._eventContainerHeight=null),super.onMonthDateChange(...arguments)}doRefresh(){const e=this,{weekElements:t}=e;var n;e.isConfiguring||(e.getConfig("autoRowHeight"),null===(n=e._cellMap)||void 0===n||n.clear());const r=super.doRefresh();for(let n=0,{length:r}=t;n<r;n++){const r=t[n],i=Array.prototype.reduce.call(r.querySelectorAll(e.visibleCellSelector),((t,n)=>{const r=e.cellMap.get(n.dataset.date);return t+((null==r?void 0:r.renderedEvents.length)||0)}),0);r.classList.toggle("b-empty-row",!i)}return e.syncCalendarWeekDaysWithScrollable(),r}showEvent(e){this.setDate(e.startDate)}changeDayNumberCentered(e){return Boolean(e)}updateShowWeekColumn(e){e||this.element.querySelector(".b-week-num")||this.doRefresh(),super.updateShowWeekColumn(e)}updateShowWeekNumber(e){this.element.classList.toggle("b-show-week-number",e)}updateHideNonWorkingDays(e){var t;null===(t=super.updateHideNonWorkingDays)||void 0===t||t.call(this,e),this.isConfiguring||this.refresh()}updateDayNumberCentered(e){const t=this;t._dayNumberCentered||"nonCenteredDayNumShowWeekColumn"in t||(t.nonCenteredDayNumShowWeekColumn=t.showWeekColumn),t._dayNumberCentered=e,t.element.classList[e?"add":"remove"]("day-number-center"),t.showWeekColumn=!!e||t.nonCenteredDayNumShowWeekColumn}get dayNameSelector(){return this.showWeekColumn?".b-cal-cell-header":super.dayNameSelector}set dayNameSelector(e){this._dayNameSelector=e}set startDate(e){this.date=e}get startDate(){return super.startDate}next(){this.date=xi.add(this.date||this.startDate,1,"month")}previous(){this.date=xi.add(this.date||this.startDate,-1,"month")}}Xk.initClass(),Xk._$name="MonthView";class Zk extends jk{static $name="WeekView";static type="weekview";static get configurable(){return{localizableProperties:["title"],title:"L{Week}",range:{magnitude:1,unit:"week"},responsive:{small:{descriptionFormat:"Wp YYYY"},large:{descriptionFormat:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"]},"*":{descriptionFormat:["MMMM YYYY","S{MMM} - E{MMM YYYY}"]}},week:null,fixedDuration:!0}}calculateDuration(){return 7}updateWeekStartDay(e,t){var n;if(null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring){const n=new Date(this.startDate);n.setDate(n.getDate()+e-t),this.startDate=n}}changeMonth(){const e=super.changeMonth(...arguments);return e.ion({weekChange:"onMonthWeekChange",thisObj:this}),e}onMonthWeekChange({source:e,newDate:t}){var n;"week"===(null===(n=this.range)||void 0===n?void 0:n.unit)&&(this.week=e.getWeekNumber(t))}changeWeek(e,t){const n=this;if(e=Array.isArray(e)?e:[n.month.year,e],!W.isEqual(e,t)){var r,i;const t=n.minDate||(null===(r=n.calendar)||void 0===r?void 0:r.minDate),s=n.maxDate||(null===(i=n.calendar)||void 0===i?void 0:i.maxDate);if(!isNaN(t)||!isNaN(s)){const{month:r}=n,i=r.getWeekStart(e),o=xi.add(i,n.duration,"d");if(!isNaN(t)&&o<=t)return r.getWeekNumber(t);if(!isNaN(s)&&i>s)return r.getWeekNumber(s)}return e}}updateWeek(e){const t=this,{month:n,date:r,dayTime:i}=t;r&&W.isEqual(n.getWeekNumber(r),e)||(t.date=i.shiftDate(n.getWeekStart(e))),t.week=n.getWeekNumber(t.date)}}Zk.initClass(),Zk._$name="WeekView";const Jk={hover:1,mouseover:1},Qk=new String,eF=(e,t)=>e+t.renderedEvents.filter((e=>!e.isOverflow)).length;class tF extends(Xu.mixin(qM,JM,rk)){static $name="YearView";static type="yearview";static get configurable(){return{textContent:!1,localizableProperties:["title","stepUnit"],title:"L{Year}",scrollable:{overflowY:!0},stepUnit:"L{yearUnit}",dragUnit:"day",month:!0,date:{$config:{equal:"date"},value:null},descriptionFormat:"YYYY",year:null,monitorResize:!1,showWeekColumn:!0,hideWeekColumnCls:"b-hide-week-numbers",otherMonthCls:"b-other-month",sixWeeks:!0,dayCellRenderer:null,monthSelector:".b-yearview-month-name",focusable:!1,showEvents:"heatmap",maxDots:null,eventDots:{marginTop:4,max:4,gap:3,size:5},eventCountTip:null}}onCalendarKeyDown(e){var t,n,r,i,s,o,a,l,d,c,u,h,g,m,p;const{dayTime:f,eventContentElement:v}=this,{target:y}=e,b=`.${this.dayCellCls}:not(.b-other-month)`,C=`${b}>[tabIndex]`,w=`:is(.b-week-number-cell>[tabIndex],${C})`,S=y.closest(C)||y;var D;if("Escape"===e.key)return e.preventDefault(),void(null===(D=S.closest(".b-yearview-month"))||void 0===D||null===(D=D.querySelector(".b-yearview-month-name"))||void 0===D||D.focus());if(S.matches(C)){const a=f.parseKey(S.parentNode.dataset.date);switch(e.key){case"ArrowUp":e.preventDefault(),null===(t=v.querySelector(`${b}[data-date="${f.dateKey(xi.add(a,-7,"d"))}"]>[tabIndex]`))||void 0===t||t.focus();break;case"ArrowDown":e.preventDefault(),null===(n=v.querySelector(`${b}[data-date="${f.dateKey(xi.add(a,7,"d"))}"]>[tabIndex]`))||void 0===n||n.focus();break;case"ArrowLeft":e.preventDefault(),null===(r=Eg.getVisitor(v,w).previous(S))||void 0===r||r.focus();break;case"ArrowRight":e.preventDefault(),null===(i=Eg.getVisitor(v,w).next(S))||void 0===i||i.focus();break;case"PageUp":e.preventDefault(),a.setMonth(a.getMonth()-1),a.setDate(Math.min(a.getDate(),xi.getLastDateOfMonth(a))),null===(s=v.querySelector(`${b}[data-date="${f.dateKey(a)}"]>[tabIndex]`))||void 0===s||s.focus();break;case"PageDown":e.preventDefault(),a.setMonth(a.getMonth()+1),a.setDate(Math.min(a.getDate(),xi.getLastDateOfMonth(a))),null===(o=v.querySelector(`${b}[data-date="${f.dateKey(a)}"]>[tabIndex]`))||void 0===o||o.focus();break;default:return super.onCalendarKeyDown(e)}}else if(S.matches(".b-week-number-cell > [tabIndex]")){const t=f.parseKey(S.parentNode.nextSibling.dataset.date);let n,r;switch(e.key){case"ArrowUp":e.preventDefault(),n=xi.getWeekNumber(xi.add(t,-1,"w")),r=`[data-week="${n[0]},${n[1]}"]:not(.b-other-month)>.b-week-number-cell>[tabIndex]`,null===(a=S.closest(".b-yearview-month").querySelector(r)||v.querySelector(r))||void 0===a||a.focus();break;case"ArrowDown":e.preventDefault(),n=xi.getWeekNumber(xi.add(t,1,"w")),null===(l=v.querySelector(`[data-week="${n[0]},${n[1]}"]:not(.b-other-month)>.b-week-number-cell>[tabIndex]`))||void 0===l||l.focus();break;case"ArrowLeft":e.preventDefault(),null===(d=Eg.getVisitor(v,w).previous(S))||void 0===d||d.focus();break;case"ArrowRight":e.preventDefault(),null===(c=Eg.getVisitor(v,w).next(S))||void 0===c||c.focus();break;case"PageUp":e.preventDefault(),n=xi.getWeekNumber(xi.add(t,-6,"w")),null===(u=v.querySelector(`[data-week="${n[0]},${n[1]}"]>.b-week-number-cell>[tabIndex]`))||void 0===u||u.focus();break;case"PageDown":e.preventDefault(),n=xi.getWeekNumber(xi.add(t,6,"w")),null===(h=v.querySelector(`[data-week="${n[0]},${n[1]}"]>.b-week-number-cell>[tabIndex]`))||void 0===h||h.focus();break;default:return super.onCalendarKeyDown(e)}}else{if(!S.matches(".b-yearview-month-name"))return super.onCalendarKeyDown(e);{const t=f.parseKey(S.dataset.monthDate);switch(e.key){case"ArrowDown":e.preventDefault(),null===(g=S.parentElement.querySelector(w))||void 0===g||g.focus();break;case"ArrowLeft":e.preventDefault(),null===(m=v.querySelector(`[data-month-date="${f.dateKey(xi.add(t,-1,"M"))}"]`))||void 0===m||m.focus();break;case"ArrowRight":e.preventDefault(),null===(p=v.querySelector(`[data-month-date="${f.dateKey(xi.add(t,1,"M"))}"]`))||void 0===p||p.focus();break;default:return super.onCalendarKeyDown(e)}}}}createCellMap(e){const t=super.createCellMap(e={skipPropagate:!0,...e});for(const e of t.values())e.renderedEvents.setEvents(e.events);return t}get date(){return this._date||!this.isConfiguring&&this.firstEventDate||new Date(this.year,0,1)}next(){this.date=new Date(this.year+1,this.date.getMonth(),this.date.getDate())}previous(){this.date=new Date(this.year-1,this.date.getMonth(),this.date.getDate())}get firstEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[0].date}get lastEventDate(){const e=[...this.cellMap.values()];if(e.length)return e[e.length-1].date}onCalendarPointerInteraction(e){var t,n;const r=this,i=super.onCalendarPointerInteraction,{target:s,type:o}=e;if(("mousedown"===o||o.endsWith("click"))&&r.clearTimeout(r.cellOverflowTimer),"mousedown"===o&&null!==(t=r._overflowPopup)&&void 0!==t&&t.isVisible&&s.closest(".b-cal-cell-overflow")&&e.preventDefault(),"click"!==r.overflowPopupTrigger||"dblclick"!==(null===(n=r.autoCreate)||void 0===n?void 0:n.gesture)||"click"!==o||!s.closest(`.${r.emptyCellCls}`)||r.emptyCellRenderer)return i.apply(r,arguments);r.cellOverflowTimer=r.setTimeout({fn:i,delay:300,args:[e]})}changeMonth(e,t){const n=this,r={name:"yearChangeListener",yearChange:"onMonthYearChange",thisObj:n};return n.detachListeners("yearChangeListener"),e instanceof kg?(e.ion(r),n._year=e.year):e=new kg({date:new Date(n.year||(new Date).getFullYear(),0,1),weekStartDay:n.weekStartDay,hideNonWorkingDays:n.hideNonWorkingDays,nonWorkingDays:n.nonWorkingDays,sixWeeks:n.sixWeeks,internalListeners:r}),null==n.nonWorkingDays&&(n.nonWorkingDays=n._month.nonWorkingDays),n._year=e.year,e}onMonthYearChange({source:{year:e,date:t}}){const n=this;var r;(n._year=e,n.isConfiguring)||(null===(r=n._cellMap)||void 0===r||r.clear(),n.date=t,n.refresh())}scrollTo(e,t={animate:!0}){const n=this;if(e=n.ingestDate(e.isEventModel?e.startDate:e),xi.betweenLesser(e,n.startDate,n.endDate)&&n.getDayElement(e,!0)){const r=n.eventContentElement.querySelector(`[data-month-index="${e.getMonth()}"]`);r&&n.scrollable.scrollIntoView(r,t)}else n.date=e}get eventsPerCell(){return 0}get startDate(){return this.month.getOtherMonth(new Date(this.year,0,1)).startDate}get endDate(){return xi.add(this.month.getOtherMonth(new Date(this.year,11,1)).endDate,1,"day")}set startDate(e){this.date=e}updateDate(e){this.month.date=e,this.isVisible&&!this.isConfiguring&&this.scrollTo(e)}changeYear(e){return this.isConfiguring?e:(this.month.year=e,this.month.year)}changeShowEvents(e,t){return!0===e?"heatmap":e}updateShowEvents(e,t){const n=this,{classList:r}=n.contentElement;e&&r.add(`b-show-events-${e}`),r.remove(`b-show-events-${t}`),n.isConfiguring||n.whenVisible((()=>{n.doRefresh(),n.scrollTo(n.date)}))}changeEventDots(e){const t=this;return new Proxy(e,{set(e){const n=Reflect.set(...arguments);return t.updateEventDots(e),n}})}updateEventDots({marginTop:e,gap:t,size:n,stripe:r}){const{style:i,classList:s}=this.contentElement;i.setProperty("--event-count-margin-top",`${e}px`),i.setProperty("--event-count-dot-size",`${n}px`),i.setProperty("--event-count-dot-gap",`${t}px`),s[r?"add":"remove"]("b-event-count-dots-striped"),this.isConfiguring||this.refresh()}updatemaxDots(e){G.deprecate("calendar","7.0.0","maxDots property is deprecated in favor of eventDots"),this.eventDots.max=e,this.updateEventDots(this.eventDots)}updateShowWeekNumber(){this.bodyElement.classList[this.showWeekColumn?"remove":"add"](this.hideWeekColumnCls)}createCellData(e){return this.month.month=e.getMonth(),super.createCellData(e)}doRefresh(){var e;const t=this,{bodyElement:n,month:r,dayCellCls:i,otherMonthCls:s,weekendCls:o,todayCls:a,nonWorkingDayCls:l,emptyCellCls:d,cellMap:c,showEvents:u,eventCountTip:h}=t,g=[],m=(null===(e=t.calendar)||void 0===e?void 0:e.today)||new Date,p=xi.makeKey(m);for(let e=0;e<12;e++){r.month=e;const n=`${r.year}-${String(r.month+101).substring(1)}`,m=[...c.values()].filter((e=>e.key.startsWith(n))).reduce(eF,0),f=xi.getMonthName(e),v={tabIndex:0,role:"link",className:"b-yearview-month-name",html:f,"aria-label":`${f} ${t.year}. ${t.L("eventCount",m)}`,dataset:{monthDate:xi.makeKey(new Date(t.year,e,1))}},y=[{className:"b-week-number-cell"}],b={role:"grid",className:"b-calendar-weeks",children:[]},C={role:"presentation",className:"b-yearview-month",children:[v,{"aria-hidden":!0,className:"b-calendar-week b-calendar-weekdays",children:y},b],dataset:{monthIndex:e}},w=b.children;g.push(C);let S=0;r.eachWeek(((n,g,m,f)=>{if(1===y.length)for(let e=0;e<7;e++)y.push({className:{"b-yearview-weekday-cell":1,[l]:t.nonWorkingDays[r.canonicalDayNumbers[e]]},text:xi.format(g[e],"d1")});const v=0===e&&0===m,b=11===e&&f,C={role:"row",className:{"b-calendar-week":1},dataset:{week:`${n[0]},${n[1]}`}},D=C.children=[{role:"gridcell",className:"b-week-number-cell"}];w.push(C);let E=0,x=0;for(let e=0;e<7;e++){const n=g[e],m=n.getMonth()!==r.month,f=xi.makeKey(n),v=n.getDay(),y=!t.isConfiguring&&c.get(f),b=null==y?void 0:y.events,C=m?0:(null==b?void 0:b.length)||0,w=C,T={role:"gridcell",style:{},className:{"b-day-name":1,[i]:1,[d]:!C},dataset:{date:f,cellIndex:S,columnIndex:e}};E+=C;let M=String(n.getDate());if(Object.assign(T.className,{[o]:xi.weekends[v],[a]:f===p&&!m,[l]:t.nonWorkingDays[v],[s]:m,"b-cal-cell-overflow":w,[yM.getEventCountClass(C)]:w,[`b-day-of-week-${v}`]:1}),t.dayCellRenderer){var R;const e=t.callback(t.dayCellRenderer,t,[{cellConfig:T,date:n,events:(null==y||null===(R=y.events)||void 0===R?void 0:R.map((e=>e.eventRecord)))||[]}]);null!=e&&(M=e)}if(h&&!Jk[t.overflowPopupTrigger]){const e=C?t.L("L{ResourceInfoColumn.eventCountText}",C):h.showNoEvents?t.L("L{noEvents}"):null;if(e){const t=tm.encodeConfig(h);T.dataset={...T.dataset,...t,btip:e}}}if("dots"===u){const{max:e}=t.eventDots,r=[];for(let i=0;i<Math.min(C||0,e);i++){const s=t.createEventDomConfig({date:n,eventRecord:b[i].eventRecord,eventColor:e>1?null:Qk,minimal:!0});r.push(s)}M=["object"==typeof M?M:{tag:"span",html:M},{className:"b-cal-minimal-event-container",children:r}]}else if("count"===u){M=["object"==typeof M?M:{tag:"span",html:M},C?{dataset:{count:C},class:{"b-cell-events-badge":1},text:C}:null]}T.children=[{className:"b-calendar-cell-inner",["string"==typeof M?"html":"children"]:M}],m?x++:(T.children[0].role="link",T.children[0].tabIndex=-1,T.children[0]["aria-label"]=`${xi.format(n,"dddd Do MMMM")}, ${t.L("eventCount",C)}`),D.push(T),S++}7===x?D[0].text=n[1]:D[0].children=[{className:"b-calendar-cell-inner",tabIndex:-1,role:"link",text:n[1],"aria-label":`${t.L("L{Calendar.weekOfYear}",n)}, ${t.L("eventCount",E)}`}],C.className["b-other-month"]=7===x||x>3&&!v&&!b?1:0}))}ud.sync({targetElement:n,domConfig:{children:g}}),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}getDayElement(e,t){if("string"!=typeof e&&(e=xi.makeKey(e)),!t||parseInt(e.substr(0,4))===this.year)return this.contentElement.querySelector(`.b-calendar-cell[data-date="${e}"]:not(.b-other-month)`)}getCell(){return this.getDayElement(...arguments)}onInternalPaint({firstPaint:e}){e&&this.refresh(),this.setTimeout((()=>this.scrollTo(this.date,{animate:!1})),10)}}tF.initClass(),tF._$name="YearView";const nF=xi.startOf(new Date),rF=Object.freeze(new Map),iF={hourHeight:1,showAllDayHeader:1,dayStartTime:1,dayEndTime:1},sF=["range","shiftIncrement","allowOverlap","timeFormat","coreHours","fitHours","hourHeight","visibleStartTime","dateFormat","dayStartTime","dayEndTime","hideNonWorkingDays","nonWorkingDays","readOnly","zoomOnMouseWheel","filterEventResources","tickRenderer","project"],oF=(e,t,n)=>{if(t)for(const r of n)r in e||void 0===t[r]||(e[r]=t[r]);return e};class aF extends(Xu.mixin(qM)){static $name="ResourceView";static type="resourceview";static configurable={layout:"box",textContent:!1,scrollable:{overflowX:!0},date:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},view:{type:"weekview"},viewGap:"0.5em",stableResourceOrder:!0,resourceWidth:null,hideNonWorkingDays:null,viewCache:{$config:["lazy","nullify"],value:!0},avatarRendering:{},meta:null,showAvatars:!0,includeTimeRanges:null,responsiveRoot:!0,range:null};static properties={sharedConfigs:sF,timeAxisConfigs:["allDayEvents"].concat(sF)};construct(){var e;super.construct(...arguments),null===(e=this.calendar)||void 0===e||null===(e=e.sidebar)||void 0===e||null===(e=e.widgetMap.resourceFilter)||void 0===e||e.ion({change:"onResourceFilterSelectionChange",thisObj:this})}get isDateRangeOwner(){return this.viewType.isDateRangeOwner}snapDate(e){var t,n;return(null===(t=(n=this.views[0]).snapDate)||void 0===t?void 0:t.call(n,...arguments))||e}get isAnimating(){return super.isAnimating||this.items.some((e=>e.isAnimating))}changeScrollable(e){return(e=super.changeScrollable(...arguments))&&Object.defineProperty(e,"viewport",{get:this.getScrollingViewport.bind(this)}),e}getScrollingViewport(){const{dayViewTimeAxis:e,dayViewScroller:t}=this,n=t.isVisible?t.width:0,r=Ot.client(this.scrollable.element);return this.rtl?r.adjust(n,0,-e.width,0):r.adjust(e.width,0,-n,0)}changeView(e){const t=this,n=new Proxy(W.assign({},e),{set(e,n,r){const i=Reflect.set(...arguments);return t.syncViewConfig(n,r),i},deleteProperty(e,n){const r=Reflect.deleteProperty(...arguments);return t.syncViewConfig(n,null),r}});return t.viewType=bryntum.Calendar.Modes.resolveType(e.type),n}eachView(e,t,n=null){const r=null==t,i=[...this.viewCache];for(let s=0,{length:o}=i;s<o;s++){const o=i[s];if(r&&(t=[o,s]),!1===o.callback(e,n||o,t))return}}get views(){return[...this.viewCache]}updateResourceStore(e){var t;this.detachListeners("resourceViewResourceChange"),null===(t=super.updateResourceStore)||void 0===t||t.call(this,e),e.ion({name:"resourceViewResourceChange",change:"onResourceStoreChange",sort:"onResourceStoreSort",thisObj:this}),this.refreshSoon()}updateViewGap(e){this.element.style.setProperty("--view-gap",Yn.setLength(e||-1))}onResourceStoreChange(){this.refreshSoon()}onResourceStoreSort({source:e}){const t=this.items.filter((e=>e.isVisible&&!e.isResourceDayViewTimeAxis)),n=e.map((e=>this.createViewId(e))),r=t.map((e=>e.id));W.isEqual(n,r)||(this.remove(...t),this.refreshSoon())}onResourceFilterSelectionChange(){this.refreshSoon()}changeViewCache(e,t){if(e)return new po;t&&(t.forEach((e=>e.destroy())),t.clear())}getResourceView(e){return e=e.isResourceModel?e:this.resourceStore.getById(e),this.viewCache.get(this.createViewId(e))||this.createView(e)}doRefresh(){var e;const t=this,{scrollBarWidth:n}=Yn,{calendar:r,_items:i,resourceStore:s}=t,o=null==r?void 0:r.widgetMap.resourceFilter,a=t.resourceStore.records.filter((e=>(!o||o.value.includes(e))&&!e.isSpecialRow)),{length:l}=a,d=[],c=[],u={};if(!s.count){const{weekStartDay:e}=t,n=xi.getFirstDateOfMonth(t.date),r=xi.add(n,1,"month");t.eventStore.getEvents({startDate:xi.add(n,-(n.getDay()-e+7)%7,"d"),endDate:xi.add(r,7-(r.getDay()-e+7)%7,"d")})}t.refreshSoon.cancel();let h=0;for(let e=0;e<l;e++){const n=t.getResourceView(a[e]),r=i.includes(n);s.getById(n.resourceId)?(n.title=t.titleTemplate(n.resource),r?h++:d.push(n),u[n.id]=1):r&&c.push(n)}h<i.count&&(t.eachView((e=>{u[e.id]||c.push(e)})),t.remove(c)),t.viewType.isDayView&&(i.includes(t.dayViewTimeAxis)||d.unshift(t.dayViewTimeAxis),n&&!i.includes(t.dayViewScroller)&&d.push(t.dayViewScroller));const g=null===(e=t.items[0])||void 0===e||null===(e=e.scrollable)||void 0===e?void 0:e.y;if(t.add(...d),null!=g&&d.forEach((e=>{e.scrollable.element.scrollTop=g,e.removeListener("scrollToVisibleStartTime")})),d.length||c.length){let e;for(let n=0,{items:r}=t,{length:i}=r;n<i;n++){var m;const t=r[n],{scrollable:i}=t;t.element.classList.remove("b-last-resource-view"),t.isResourceDayViewTimeAxis||(t.element.classList[n>1?"remove":"add"]("b-first-resource-view"),e=t),i&&(i.clearPartners(),n&&t.scrollable.addPartner(r[n-1].scrollable,"y")),null===(m=t.allDayEvents)||void 0===m||m.refresh()}if(e&&e.element.classList.add("b-last-resource-view"),t.viewType.isDayView){const e=t.views.filter((e=>e.allDayEvents&&e.isVisible)),n=e.length&&Math.max(...e.map((e=>e.allDayEvents.cellContentHeight)));n&&i.forEach((e=>{var t;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(n,!1,!0)}))}}t.viewType.isDayView&&t.syncDayViewScrollerVisibility(),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}onCalendarPointerInteraction(){}onCalendarStoreChange(){}onChildAdd(e){super.onChildAdd(e),ee.before(e,"onConfigChange","onChildViewConfigChange",this,{return:!1})}onChildViewConfigChange({name:e,value:t,applied:n}){const r=this;2!==n||r.syncingChildViewConfigs||r.syncingViewConfig||!r.timeAxisConfigs.includes(e)||(r.viewSyncConfigs||(r.viewSyncConfigs={},r.queueMicrotask("flushViewSyncConfigs")),r.viewSyncConfigs[e]=t)}flushViewSyncConfigs(){var e;const t=this,{viewSyncConfigs:n}=t,r=W.copyProperties({},n,["startDate","endDate"]);delete n.startDate,delete n.endDate,Object.assign(r,n);const i=new Set(t.items.concat([...t.viewCache]));t.syncingChildViewConfigs=!0,i.forEach((e=>e.setConfig(r))),t.views.length&&(t.date=null===(e=t.views[0])||void 0===e?void 0:e.date),t.syncingChildViewConfigs=t.viewSyncConfigs=!1}createViewConfig(e){const t=this,{id:n}=e,{viewCache:r,viewType:i}=t,s=[...r][0]||t,o=C.merge({calendar:t.calendar,id:t.createViewId(e),cls:"b-resourceview-resource",defaultCalendar:n,resource:e,resourceId:n,includeTimeRanges:t.includeTimeRanges,weekStartDay:t.weekStartDay,parent:t,date:t.date,dateFormat:t.dateFormat,autoCreate:t.autoCreate,title:t.titleTemplate(e),syncCalendarDate:t.syncCalendarDate,showCurrentTime:{...t.showCurrentTime,showTime:!1}},t.view);return oF(o,s,t.sharedConfigs),i.isDateRangeOwner&&s._endDate&&(o.endDate=s._endDate),t.visibleStartTime&&(o.visibleStartTime=t.visibleStartTime),t.hasConfig("startDate")&&(o.startDate=t.startDate,t.timeAxisConfigs.unshift("startDate")),i.isDayView&&(null!==o.allDayEvents&&(o.allDayEvents={...o.allDayEvents,fullWeek:!1,resource:e}),Yn.scrollBarWidth&&(o.scrollable={overflowX:!1,overflowY:"hidden-scroll"})),o}createView(e){var t;const n=this,{resourceStore:r,viewCache:i}=n,{id:s}=e,o=n.createViewConfig(e),a=bryntum.Calendar.Modes.create(o);return a.range||n.timeAxisConfigs.unshift("endDate"),a.ion({catchAll:"onChildViewCatchAll",thisObj:n}),a.element.removeAttribute("tabIndex"),a.element.dataset.resourceId=s,null===(t=a.contentElement)||void 0===t||t.removeAttribute("tabIndex"),Object.defineProperties(a,{weight:{get:()=>n.stableResourceOrder?r.allIndexOf(s):0},resource:{get:()=>r.getById(s)},eventFilter:{get(){return e=>e.resources.includes(this.resource)}}}),i.add(a),n.trigger("viewCreate",{view:a}),a}onChildViewCatchAll(e){const t=this,{type:n}=e;e.resourceRecord||(e.resourceRecord=e.source.resource),"rangechange"===n?t.triggerRangeChangeTimer||(t.triggerRangeChangeTimer=t.queueMicrotask((()=>{t.triggerRangeChangeTimer=null,t.trigger(e.eventName,{...e,source:t})}))):"heightchange"===n?t.syncDayViewScrollerVisibility():"paint"!==n&&t.trigger(e.eventName,e)}changeAvatarRendering(e){if(e)return Sv.new({element:this.element},e)}titleTemplate(e){const t=this,{meta:n}=t,r="string"==typeof n?e[n]:null==n?void 0:n(e),i=Yn.isNamedColor(e.eventColor)&&e.eventColor,s=!i&&e.eventColor;return{class:{"b-resourceview-title":1,"b-has-meta":r},children:[t.showAvatars&&W.merge({class:{[`b-sch-foreground-${i}`]:i},style:{color:s||null},reference:"resourceAvatar"},t.getResourceAvatar(e)),{class:"b-resource-name",text:e.name,reference:"resourceName"},r&&{class:"b-resource-meta",text:r,reference:"resourceMeta"}]}}getEventElement(e,t=e.startDate,n){var r;return null===(r=this.getResourceView(e.resource||n))||void 0===r?void 0:r.getEventElement(e,t)}get dayViewTimeAxis(){const e=this;if(!e._dayViewTimeAxis){const t=oF({},e,e.timeAxisConfigs);oF(t,e.view,e.timeAxisConfigs),delete t.endDate,e._dayViewTimeAxis=lF.create({...t,weight:-1,project:e.project,type:"resourcedayviewtimeaxis",minWidth:0,cls:"b-resource-dayview-timeaxis",startDate:e.date,scrollable:{overflowX:!1,overflowY:"hidden-scroll"},onCornerClick(){const{expanded:t}=e.firstChild.allDayEvents,n=[];let r=null;e.eachView((({allDayEvents:e})=>{t?(!r||e.maxEventCount<r.maxEventCount)&&(r=e):(!r||e.maxEventCount>r.maxEventCount)&&(r=e)}));const i=r.refreshCount;r.expanded=!t,r.refreshCount===i&&n.push(r),e.items.forEach((e=>{if(e!==r){const{allDayEvents:r}=e,i=r.refreshCount;e.allDayEvents.expanded=!t,r.refreshCount===i&&n.push(r)}}));for(let e=0,{length:t}=n;e<t;e++)n[e].doRefresh()}},e),fd.addResizeListener(e._dayViewTimeAxis.timeAxisElement,e.syncDayViewScrollerVisibility.bind(e))}return e._dayViewTimeAxis}get dayViewScroller(){const e=this;if(!e._dayViewScroller){const t=oF({},e,e.timeAxisConfigs);oF(t,e.view,e.timeAxisConfigs),delete t.endDate,e._dayViewScroller=lF.create({...t,weight:999,project:e.project,type:"resourcedayviewtimeaxis",flex:`0 0 ${Yn.scrollBarWidth}px`,minWidth:Yn.scrollBarWidth,cls:"b-resource-dayview-scroller",startDate:nF,scrollable:{overflowX:!1,overflowY:"scroll"}},e),e._dayViewScroller.scrollable.addPartner(e.dayViewTimeAxis.scrollable,"y"),e.monitorResize=!0}return e._dayViewScroller}onElementResize(){super.onElementResize(),Yn.scrollBarWidth&&this.syncDayViewScrollerVisibility()}syncDayViewScrollerVisibility(){if(this._dayViewScroller){const e=this.dayViewTimeAxis.scrollable.hasOverflow("y");this.dayViewScroller.isVisible!==e&&this.dayViewScroller[e?"show":"hide"]()}}async scrollTo(e,t){const{views:n}=this;if(e.isEventModel){const r=n.find((t=>t.eventStore.includes(e)));if(null==r||r.scrollTo(...arguments),e=r.getEventElement(e))return this.scrollable.scrollIntoView(e,t)}return n[0].scrollTo(...arguments)}createViewId(e){return`${this.id}-resource${this.config.view.type}-${e.id}`}updateDate(e){const t=this,{_dayViewTimeAxis:n}=t;t.suspendVisibility(),t.viewCache.forEach((t=>{t.date=e})),t.resumeVisibility(),t.viewType.isDayView&&(t.items.forEach((e=>{var t,n;null===(t=e.allDayEvents)||void 0===t||t.setEventContentHeight(null===(n=e.allDayEvents)||void 0===n?void 0:n.cellContentHeight)})),n&&(n.showCurrentTime=t.showCurrentTime,n.date=e))}updateResourceWidth(e){this.contentElement.style.setProperty("--resource-width",Yn.setLength(e))}updateShowCurrentTime(e){this.dayViewTimeAxis&&(this.dayViewTimeAxis.showCurrentTime={showTime:null==e?void 0:e.showTime}),this.isConfiguring||this.syncViewConfig("showCurrentTime",{...e,showTime:!1})}updateWeekStartDay(e,t){var n;null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),this.isConfiguring||this.syncViewConfig("weekStartDay",e)}updateHideNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("hideNonWorkingDays",e)}updateNonWorkingDays(e){this.isConfiguring||this.syncViewConfig("nonWorkingDays",e)}updateIncludeTimeRanges(e){this.isConfiguring||this.syncViewConfig("includeTimeRanges",e)}updateSyncCalendarDate(e){this.isConfiguring||this.syncViewConfig("syncCalendarDate",e)}syncViewConfig(e,t){const n=n=>{n[e]=t};this.syncingViewConfig=!0,iF[e]?this.items.forEach(n):this.eachView(n),this.syncingViewConfig=!1}descriptionRenderer(){var e;return(null===(e=[...this.viewCache.items][0])||void 0===e?void 0:e.description)||"No resources"}updateRange(e){this.isConfiguring||this.views[0]&&(this.views[0].range=e)}set startDate(e){var t;const n=this;if(n._startDate=n.changeDate(e),null!==(t=n.views)&&void 0!==t&&t.length){const t={startDate:e},r=n.peekConfig("endDate");r&&(t.endDate=r),n.views[0].setConfig(t)}}get date(){var e;return(null===(e=this.views[0])||void 0===e?void 0:e.date)||this._date}get startDate(){const{views:e}=this;return e.length?e[0].startDate:this._startDate||this.date}changeEndDate(e){return this.changeDate(e)}updateEndDate(e){var t;null!==(t=this.views)&&void 0!==t&&t.length&&(this.views[0].endDate=e)}get endDate(){var e;const t=this,{viewType:n}=t;let r,i=(null===(e=t.views[0])||void 0===e?void 0:e.endDate)||t._endDate||(r=t.createViewConfig({id:"dummy"})).endDate;if(!i){const e=r.range||n.$meta.config.range;i=xi.add(t.startDate,n.prototype.parseRange(e))}return i}get fixedDuration(){const{viewType:e}=this;if(e.isDayView){const e=[...this.viewCache][0];if(e)return e.fixedDuration;const t=this.createViewConfig({id:"dummy"});return!(t.range||t.endDate)}return!e.isDateRangeOwner}set shiftIncrement(e){(this.view||(this.view={})).shiftIncrement=e}get shiftIncrement(){const e=[...this.viewCache][0];return null==e?void 0:e.shiftIncrement}get stepUnit(){const e=[...this.viewCache][0];return null==e?void 0:e.stepUnit}get firstChild(){return this.items.filter((e=>!e.isResourceDayViewTimeAxis))[0]}set tickRenderer(e){(this.view||(this.view={})).tickRenderer=e}set hourHeight(e){(this.view||(this.view={})).hourHeight=e}get hourHeight(){var e,t;return(null===(e=this.views)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.hourHeight)||(null===(t=this.view)||void 0===t?void 0:t.hourHeight)||jk.configurable.hourHeight}previous(){var e;null===(e=[...this.viewCache][0])||void 0===e||e.previous()}next(){var e;null===(e=[...this.viewCache][0])||void 0===e||e.next()}zoomTo(...e){var t;null!==(t=this.views)&&void 0!==t&&null!==(t=t[0])&&void 0!==t&&t.zoomTo&&this.eachView((t=>{t.isVisible&&t.zoomTo(...e)}))}zoomBy(...e){var t;null!==(t=this.views)&&void 0!==t&&null!==(t=t[0])&&void 0!==t&&t.zoomBy&&this.eachView((t=>{t.isVisible&&t.zoomBy(...e)}))}getDateFromPosition(e,t){for(const n of this.views){const r=n.getDateFromPosition(e,t);if(r)return r}}}class lF extends jk{static $name="ResourceDayViewTimeAxis";static type="resourcedayviewtimeaxis";static configurable={range:"1 day",allDayEvents:{type:"resourcedayviewalldayevents",disabled:"inert"}};compose(){return super.compose()}onCalendarStoreChange(){}doRefresh(){this.syncCurrentTimeIndicators()}scrollToVisibleStartTime(){}createCellMap(){return rF}calculateCellContentHeight(){return 0}getDateFromPosition(e,t,n=!1){const r=this,i=r.startDate,s=n?0:r.dayContentElement.getBoundingClientRect().y,o=r.timeAxisElement.offsetHeight,a=t-s;return xi.round(xi.add(xi.clearTime(i),r.dayStartMs+Math.floor(a/o*r.getDayLength()),"ms"),r.increment)}}(class extends ck{static $name="ResourceDayViewAllDayEvents";static type="resourcedayviewalldayevents";get hasOverflow(){return this.up("resourceview").views.some((e=>{var t;return null===(t=e.allDayEvents)||void 0===t?void 0:t.hasOverflow}))}createCellMap(){return rF}}).initClass(),lF.initClass(),aF.initClass(),aF._$name="ResourceView";class dF extends ck{static $name="DayResourceCalendarRow";static type="dayresourcecalendarrow";static configurable={showHeaderAvatars:!0,resourceHeaderRenderer:null,resourceHeaderExtraRenderer:null,responsive:{small:{dayNameFormat:"ddd",dayNumberCompress:!1}},autoRefresh:["hideEmptyResources","resourceDateFilter"],hideEmptyResources:null,resourceDateFilter:null};get eventContentElement(){return this.bodyElement}expandGutter(){}get viewResources(){var e;const{resourceStore:t}=this,n=null===(e=this.calendar)||void 0===e?void 0:e.widgetMap.resourceFilter;return t.records.filter((e=>(!n||n.value.includes(e))&&!e.isSpecialRow))}onCellOverflowGesture({resourceRecord:e,date:t}){const n=this.cellMap.get(xi.makeKey(t)),{renderedEvents:r}=n;n.renderedEvents=r.filter((t=>{var n;return null===(n=t.eventRecord.resources)||void 0===n?void 0:n.includes(e)})),super.onCellOverflowGesture(...arguments),n.renderedEvents=r}getCellFromEvent(e){return e.target.closest(".b-calendar-cell[data-date] [data-resource-id]")}createCellMap(){const e=super.createCellMap(...arguments),{viewResources:t}=this;return this.maxEventCount=0,e.forEach((e=>{for(let n=0,{length:r}=t;n<r;n++)this.maxEventCount=Math.max(this.maxEventCount,e.renderedEvents.filter((e=>{var r;return null===(r=e.eventRecord.resources)||void 0===r?void 0:r.includes(t[n])})).length)})),e}getCellDomConfig(e){var t,n;const r=this,{viewResources:i,eventsPerCell:s,showHeaderAvatars:o,hideEmptyResources:a,resourceDateFilter:l,resourceHeaderRenderer:d,resourceHeaderExtraRenderer:c}=r,{renderedEvents:u,date:h}=e,g=[],m=r.dayTime.startOfDay((null===(t=r.calendar)||void 0===t?void 0:t.dateTimeNow)||new Date),p=h.getTime()===m.getTime(),{maxRow:f,day:v}=e,y=r.nonWorkingDays||r.month.nonWorkingDays,b=a&&((null===(n=r.owner)||void 0===n?void 0:n.getEventsForDay(e.key,r.startDate))||u),C=i.reduce(((t,n)=>{var i;e.resource=n;const s=null==b||null===(i=b.filter)||void 0===i?void 0:i.call(b,(e=>{var t;return null===(t=e.resources)||void 0===t?void 0:t.includes(n)}));return a&&!(null!=s&&s.length)||l&&!r.callback(l,r,[e])||t.push(n),t}),[]);r.weekLength=1;for(let t=0,{length:n}=C;t<n;t++){const n=C[t];e.renderedEvents=u.filter((e=>{var t;return null===(t=e.eventRecord.resources)||void 0===t?void 0:t.includes(n)})),e.visibleColumnIndex=e.columnIndex=0,e.maxRow=e.renderedEvents.length>s?f:s;const r=super.getCellDomConfig(e);r.children[1].dataset={resourceId:n.id},g.push({className:"b-resourcecalendarrow-column-resource-cell",dataset:{resourceId:n.id},children:[r.children[1],e.hasOverflow&&e.renderedEvents.length>s?r.children[2]:null]})}g.length||g.push({className:"b-resourcecalendarrow-column-resource-cell"}),e&&(e.renderedEvents=u);const w={role:"gridcell",tabIndex:-1,className:{"b-dayresourcecalendarrow-column":1},style:{"--visible-resource-count":C.length},children:[{style:{"--visible-resource-count":C.length},role:"gridcell",tabIndex:-1,className:{"b-dayresource-allday":1,"b-cal-cell-header":1,[r.todayCls]:p,[r.nonWorkingDayCls]:y[v]||!1,[r.weekendCls]:xi.weekends[v],[`b-day-of-week-${v}`]:1},children:[{className:{"b-dayname-date":1}},...C.length?C.map((t=>{let n;if(d||c){const r=t.events.filter((t=>xi.intersectSpans(t.startDate,t.endDate,h,e.tomorrow)));n={...e,resourceDayEvents:r}}return{className:{"b-dayresourcecalendarrow-resource-header":1,"b-avatar-after":"last"===o,"b-has-info":Boolean(c)},html:d?r.callback(d,r,[t,n]):void 0,children:d?void 0:[o?r.getResourceAvatar(t):null,{className:"b-dayresourcecalendarrow-resource-name",text:r.resourceNameRenderer(t)},c?{className:"b-dayresourcecalendarrow-resource-info",html:r.callback(c,r,[t,n])}:void 0],dataset:{resourceId:t.id}}})):[r.dummyResourceHeader]]},...g],dataset:{}};return r.addCellHeaderContent(w.children[0].children[0],e),w}get dummyResourceHeader(){return{className:{"b-dayresourcecalendarrow-resource-header":1},children:[this.showHeaderAvatars?{class:"b-resource-avatar"}:null,{className:"b-dayresourcecalendarrow-resource-name",text:" "}]}}updateMinResourceWidth(e){const{scrollable:t,headerScroller:n}=this;this.element.style.setProperty("--cell-container-overflow",e?"visible":"hidden"),t.overflowX=n.overflowX=!!e&&"hidden-scroll"}resourceNameRenderer(e){return e.name}updateShowHeaderAvatars(e){e&&(this.avatarRendering||(this.avatarRendering=!0)),this.refresh()}changeFullWeek(){}}dF.initClass(),dF._$name="DayResourceCalendarRow";class cF extends jk{static $name="DayResourceView";static type="dayresource";static configurable={minResourceWidth:"4em",showAvatars:!0,title:"L{dayResourceView}",allDayEvents:{type:"dayresourcecalendarrow"},range:"1w",showHeaderAvatars:!0,autoRefresh:["hideEmptyResources","resourceDateFilter"],hideEmptyResources:null,resourceDateFilter:null,hideResourceNameWhenNarrow:null};changeAllDayEvents(){const e=super.changeAllDayEvents(...arguments);return e&&(e.hideEmptyResources=this.hideEmptyResources,e.resourceDateFilter=this.resourceDateFilter),e}checkAutoCreateGesture(e,t,n){if(n)return super.checkAutoCreateGesture(...arguments)}onLayoutUpdate(){var e;this.syncNarrowResourceWidth(),null===(e=super.onLayoutUpdate)||void 0===e||e.call(this,...arguments)}onDayContainerResize(){var e;return this.syncNarrowResourceWidth(),null===(e=super.onDayContainerResize)||void 0===e?void 0:e.call(this,...arguments)}syncNarrowResourceWidth(){const e=this.element.querySelector(".b-dayresourcecalendarrow-resource-header");e&&this.allDayEvents.element.classList.toggle("b-narrow-resource-header",e.offsetWidth<100)}updateHideResourceNameWhenNarrow(e){var t;null===(t=this.allDayEvents)||void 0===t||t.element.classList.toggle("b-hide-resource-name-when-narrow",Boolean(e))}updateHideEmptyResources(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.hideEmptyResources=e)}updateResourceDateFilter(e){this.isConfiguring||this._allDayEvents&&(this._allDayEvents.resourceDateFilter=e)}changeMinResourceWidth(e){return e||this.constructor.configurable.minResourceWidth}updateMinResourceWidth(e){var t;this.element.style.setProperty("--min-resource-width",Yn.setLength(e)),this.updateElementLayout(),null===(t=this.allDayEvents)||void 0===t||t.updateMinResourceWidth(e)}updateShowHeaderAvatars(e){const{allDayEvents:t}=this;t&&(t.resourceImagePath=this.resourceImagePath,t.showHeaderAvatars=e)}updateWeekStartDay(e,t){var n;if(null===(n=super.updateWeekStartDay)||void 0===n||n.call(this,e),!this.isConfiguring){const n=new Date(this.startDate);"week"===this.range.unit&&(n.setDate(n.getDate()+e-t),this.startDate=n)}}getDayDomConfig(e){const t=this,{hideEmptyDays:n,hideEmptyResources:r,dateFilter:i,resourceDateFilter:s}=t,o=t.dayTime.dateKey(e),a=e.getDay(),l=t.cellMap.get(o)||t.createCellData(e),d=(n||r)&&t.getEventsForDay(o);if(!(t.hiddenNonWorkingDays[a]&&1!==t.duration||t.hideEmptyDays&&!t.getEventsForDay(o).length||i&&!t.callback(i,t,[l]))){const i=t.dayTime.dateKey(e),o=l.events,a=[],{calendar:c,resourceStore:u}=t,h=null==c?void 0:c.widgetMap.resourceFilter,g=u.records.filter((e=>(!h||h.value.includes(e))&&!e.isSpecialRow));for(let n,i=0,{length:c}=g;i<c;i++){const c=t.resource=l.resource=g[i],u=e=>{var t;return null===(t=e.resources)||void 0===t?void 0:t.includes(c)},h=r&&!d.filter(u).length||s&&!t.callback(s,t,[l]);t.resourceId=c.id,l.events=o.filter(u),t._hideEmptyDays=!1,h||(n=super.getDayDomConfig(e),delete n.dataset.date,n.dataset.resourceId=c.id,a.push(n)),t.resource=t.resourceId=null}if(!a.length){l.events.length=0;const t=super.getDayDomConfig(e);delete t.dataset.date,a.push(t)}return l.events=o,t._hideEmptyDays=n,{className:{"b-dayresourceview-column":1,[`b-day-of-week-${l.day}`]:1},dataset:{date:i},children:a}}}}cF.initClass(),cF._$name="DayResourceView";const uF=e=>e.isCalendarMixin||e.isScheduler;var hF=e=>class extends(rx(e||Qe)){static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,datasetIdProperty:"eventId",itemsTabbable:!0,keys:{ArrowUp:null,ArrowDown:null,Escape:null,Tab:null,"SHIFT+Tab":null}}}}normalizeTarget(e){return e.eventRecord}processEvent(e){const{target:t}=e;if("Enter"===e.key){if(t.closest(".b-sch-event-wrap"))return;if("link"===t.role&&t.closest(".b-overflowpopup"))return Yn.triggerMouseEvent(t,"click"),e}return super.processEvent(...arguments)}changeNavigator(e){const t=this;return t.getConfig("eventCls"),super.changeNavigator(t.constructor.mergeConfigs({target:t.element,itemSelector:`.b-cal-cell-overflow,.b-cal-cell-no-content,${t.eventSelector}:not(.b-minimal),.b-sch-event-wrap`,skipScrollIntoView:!0},e))}onViewRefresh(){var e,t;const{activeItem:n}=this.navigator;if(null===(e=super.onViewRefresh)||void 0===e||e.call(this,...arguments),n&&(null===(t=this.activeView._overflowPopup)||void 0===t||!t.containsFocus)){const e=this.getEventRecord(n);this.navigator.updateActiveItem(e?this.getElementFromEventRecord(e):null,n)}}onCalendarStoreChange({action:e,records:t}){var n,r;const i=this,{navigator:s}=i,o=null==s?void 0:s.activeItem,a=null===(n=Ot.from(o))||void 0===n?void 0:n.center,{usingKeyboard:l}=Yn;if(o&&"eventId"in o.dataset&&!i.eventStore.includes(o.dataset.eventId)){const e=i.constructor.fromElement(o,uF)||i.activeView,{_overflowPopup:t,isScheduler:n}=e,r=n?e.navigator:i.navigator,s=r.next,d=Yn.findParent(o,Yn.isFocusable);if(n){const t=e.getCellElementFromDomEvent({target:o,clientY:a.y});return(s||r.previous||t).focus({preventScroll:!l})}if(s!==o.nextSibling||s.parentNode.syncIdMap){let c=s||r.previous;if(c&&d.contains(c)||(c=d),null!=t&&t.containsFocus&&!t.contentElement.contains(c)){const{target:e}=t.lastAlignSpec;c=r.getAdjacent(1,e.nextSibling)||r.getAdjacent(-1,e)}if(c&&i.element.contains(c)){const t=n?e.getDateFromXY([a.x,a.y],null,!1):e.getDateFromElement(c),s=c.dataset.eventId,d=i.constructor.fromElement(c).closest(uF);c.focus({preventScroll:!l}),d.ion({refresh:()=>{var e;s?(c=d.getEventElement(s,t),c&&(c===Yn.getActiveElement(c)?r.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:c},c):c.focus({preventScroll:!l})),r.updateActiveItem(c,o)):d.isCalendarRow&&null!==(e=d.parent)&&void 0!==e&&e.isDayView&&!d.cellMap.size&&d.requestAnimationFrame((()=>d.parent.focusDate(c.dataset.date)))},once:!0})}else i.widgetMap.viewContainer.revertFocus(!0)}else r.triggerNavigate({eventPhase:Event.BUBBLING_PHASE,target:s},s)}null===(r=super.onCalendarStoreChange)||void 0===r||r.call(this,...arguments)}onElementKeyDown(e){var t;e.target.closest(this.navigator.itemSelector)&&(null===(t=super.onElementKeyDown)||void 0===t||t.call(this,e))}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}get widgetClass(){}},gF=e=>class extends(XE(e||Qe)){static configurable={deselectAllOnScheduleClick:!0,eventSelectedCls:"b-selected"};normalizeTarget(e){return e.eventRecord}updateDeselectAllOnScheduleClick(e){this[e?"ion":"un"]({scheduleClick:"clearEventSelection"})}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedCollection,i=e||[],s=t||[];if(n.updateSelected(),!n.silent){const e=r.count>0?i.length>0&&s.length>0?"update":i.length>0?"select":"deselect":"clear";n.trigger("selectionChange",{action:e,selection:r.values,selected:i,deselected:s})}}onCalendarStoreChange({action:e,records:t}){var n;"remove"===e&&this.selectedCollection.remove(...t),null===(n=super.onCalendarStoreChange)||void 0===n||n.call(this,...arguments)}clearEventSelection(){this.selectedCollection.clear()}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(e){e=nt.asArray(e),this.selectedCollection.splice(0,this.selectedCollection.count,e)}isEventSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){this.selectEvent(e,t)}selectEvent(e,t=!1){const{selectedCollection:n}=this;this.isEventSelected(e)||!1===this.isEventSelectable(e)||(t?n.add(e):n.splice(0,n.count,e))}deselect(e){this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e.filter((e=>!1!==this.isEventSelectable(e))))}deselectEvents(e){this.selectedCollection.remove(e)}onEventSelectionClick(e){this.isEventSelected(e)?ir.ctrlKeyDown&&this.deselectEvent(e):this.selectEvent(e,this.multiEventSelect&&ir.ctrlKeyDown)}onEventNavigate({event:e,item:t}){if(t){const n=this.activeView.getEventRecord(t);if(n){if(2===e.button&&this.isEventSelected(n))return;this.onEventSelectionClick(n)}else this.deselectAllOnScheduleClick&&this.clearEventSelection()}}get widgetClass(){}};const mF={hide(){this.$overflowClone.hide()},show(){this.$overflowClone.show()}};class pF extends(Dc.mixin($h,gv,wv)){static $name="ModeSelector";static type="calendarmodeselector";static configurable={minifiable:!0,titleProperty:"title",minified:null,button:{ref:"modeSelectorButton",type:"button",icon:"b-icon-calendar-days",cls:"b-calendar-mode-button",menu:[],internalListeners:{beforeShowMenu:"up.onBeforeFirstShowModeMenu",once:!0}},buttonBar:{type:"buttongroup",ignoreParentReadOnly:!0},calendar:{value:"calendar",$config:"lazy"},includeWeekendsButton:{$config:"lazy",value:{ref:"weekendsButton",type:"button",cls:"b-calendar-fullweek-button",toggleGroup:"no",text:"L{ModeSelector.weekends}",tooltip:"L{ModeSelector.includeWeekends}",onToggle:"up.onToggleWorkingDaysButton",weight:-1}},includeWeekendsMenuItem:{$config:"lazy",value:{ref:"weekendsMenuItem",separator:!0,text:"L{ModeSelector.includeWeekends}",checked:!1,onToggle:"up.onToggleWorkingDaysMenu",weight:10}},layout:{type:"box",wrap:!1},overflowable:"none",responsive:{large:{minifiable:!0,minified:null},"*":{minifiable:!1,minified:!0}},responsiveTarget:"@calendar"};static fenced={onToggleButton:!0,onToggleMenuItem:!0,syncFullWeek:!0,syncActiveMode:{all:"syncActiveMode",lock:["onToggleButton","onToggleMenuItem","syncActiveMode"]}};get childItems(){const e=super.childItems,{_button:t}=this;return t&&e.push(t),e}get hideNonWorkingDays(){var e;return null===(e=this.calendar)||void 0===e?void 0:e.hideNonWorkingDays}set hideNonWorkingDays(e){const{calendar:t}=this;t&&(e||null!=t.hideNonWorkingDays)&&(t.hideNonWorkingDays=e)}configure(e={}){this.isConstructing&&"minified"in e&&!("minifiable"in e)&&(e=W.assign({minifiable:!1},e)),super.configure(e)}changeIncludeWeekendsButton(e,t){var n;const r=this,i=e&&(null===(n=r.calendar)||void 0===n?void 0:n.includeWeekendsButton);return i&&(e=Tu.mergeConfigs(e,i)),e&&!t?r.add(e):Tu.reconfigure(t,e,r)}updateIncludeWeekendsButton(e){e&&(e.toggleGroup=null),this.syncFullWeek()}changeIncludeWeekendsMenuItem(e,t){var n;const r=null==this||null===(n=this.button)||void 0===n?void 0:n.menu;return e&&!t?null==r?void 0:r.add(e):rh.reconfigure(t,e,r)}updateIncludeWeekendsMenuItem(){this.syncFullWeek()}onBeforeFirstShowModeMenu({menu:e}){const t=this,{calendar:n}=t,{activeView:r}=n,i=Object.values(n.modes);let s,o;for(o of i)s=o.$modeMenuItem,s.hidden=o.$modeSelectorItem.hidden,e.add(s),s.checked=o===r,s.onToggle="up.onToggleMenuItem";t.getConfig("includeWeekendsMenuItem"),t.syncFullWeek(),t.menuReady=!0}addMode(e,t,n){const r=this,{buttonBar:i,calendar:s}=r,o=t[r.titleProperty]||t.displayName||t.type,a=t.activationKey||o.charAt(0).toLowerCase(),l=o.toLowerCase().indexOf(a),d=t.$modeMenuItem=rh.reconfigure(t.$modeMenuItem,rh.mergeConfigs({type:rh,view:t,ref:`${e}ShowMenuItem`,checked:!1,closeParent:!0,toggleGroup:`${r.id}-modeSelectorMenuItem`,localizable:!1,text:[{text:o},{text:a.toUpperCase(),class:"b-menuitem-key"}],weight:0},n,t.selectorMenuItem)),c=t.$modeSelectorItem=d.$overflowClone=i.add(Tu.mergeConfigs({view:t,ref:`${e}ShowButton`,toggleGroup:`${r.id}-modeSelectorButton`,text:l<0?[o,{text:a.toUpperCase(),class:"b-button-key b-align-end"}]:[l?o.substring(0,l):null,{text:a[l?"toLowerCase":"toUpperCase"](),class:"b-button-key"},o.substring(l+1)],ariaLabel:o,localizable:!1,onBeforeToggle:"up.onBeforeToggleButton",onToggle:"up.onToggleButton",weight:0},n,t.selectorButton));t.$activateMode=e=>{var n;return s.setConfig({date:(null===(n=e.target.closest("[data-date]"))||void 0===n?void 0:n.dataset.date)||s.date,mode:t})},d.ion(mF),(r.ownedWidgets||(r.ownedWidgets={}))[d.id]=d,s.addKeyBinding(a,t.$activateMode),s.addDescendant(d),r.getConfig("includeWeekendsButton"),t.ion({thisObj:r,localized(){const e=t[r.titleProperty]||t.displayName||t.type,n=(t.activationKey||e.charAt(0)).toLowerCase(),i=e.toLowerCase().indexOf(n);n!==a&&(s.removeKeyBinding(a,t.$activateMode),s.addKeyBinding(n,t.$activateMode)),c.text=i<0?[{text:e},{text:n.toUpperCase(),class:"b-button-key"}]:[i?{text:e.substring(0,i)}:null,{text:n.toUpperCase(),class:"b-button-key"},{text:e.substring(i+1)}],d.text=[{text:e},{text:n.toUpperCase(),class:"b-menuitem-key"}]}})}onBeforeToggleButton({pressed:e}){if(e&&this.calendar.viewContainer.layout.isChangingCard)return!1}onToggleButton({source:e,pressed:t}){t&&(this.calendar.mode=e.view)}updateDisabled(e,t){super.updateDisabled(e,t),this.buttonBar.items.forEach((t=>{e&&t.containsFocus||(t.disabled=e)}))}onToggleMenuItem({source:e,checked:t}){t&&(this.calendar.mode=e.view)}onToggleWorkingDaysButton({pressed:e}){this.hideNonWorkingDays=!e}onToggleWorkingDaysMenu({checked:e}){this.hideNonWorkingDays=!e}syncActiveMode(e){const t=this,n=t.buttonBar.items;let r;for(r of(t.button.text=e.displayName,t.includeWeekendsButton.hidden=!e.hasNonWorkingDays,t.syncFullWeek(),n))r.view&&(r.pressed=r.view===e);if(t.menuReady)for(r of t.button.menu.items){var i;(null===(i=r.view)||void 0===i?void 0:i.$modeMenuItem)===r&&(r.checked=r.view===e)}t[n.length>1?"show":"hide"]()}syncFullWeek(){const{calendar:e,hideNonWorkingDays:t,_includeWeekendsButton:n,_includeWeekendsMenuItem:r}=this,i=!t;e.isConfiguring||(n&&(n.pressed=i),r&&(r.checked=i))}changeButton(e,t){return Tu.reconfigure(t,e)}updateButton(e){e&&this.add(e)}changeButtonBar(e,t){return Mm.reconfigure(t,e)}updateButtonBar(e){e&&this.add(e)}changeCalendar(e){return e&&!e.isWidget&&(e=this.up(e)),e}updateCalendar(e){this.detachListeners("cal"),this.syncFullWeek(),null==e||e.ion({name:"cal",changeHideNonWorkingDays:"syncFullWeek",thisObj:this})}}pF.initClass(),pF._$name="ModeSelector";class fF extends OR{static $name="EventCopyPaste";static type="eventCopyPaste";static get pluginConfig(){const e={};for(const t in super.pluginConfig)e[t]=[...super.pluginConfig[t]];return e.assign.push("beforeListRenderRow"),e}static configurable={allowNoAssignments:!0};constructor(e){super(e.client,e),this.client.ion({cellOverFlowClick:"onScheduleClick",thisObj:this}),Jt.on({element:this.client.element,focusmove:"onFocusMove",thisObj:this})}onFocusMove(e){const t=this,{client:n}=t,{_target:r}=e,i=n.getDateFromDomEvent(r);if(i){const s=n.getEventRecord(r.closest("[class*=-event-wrap]"));s?t.targetTime=s.startDate:t.targetTime&&xi.copyTimeValues(i,t.targetTime),t._cellClickedContext={date:i,domEvent:e,source:n.activeView,view:n.activeView,resourceRecord:t.client.resolveResourceRecord(r)}}else t._cellClickedContext}populateEventMenu(e){const{client:t}=this;this.fixEventData(e),super.populateEventMenu(e),t.activeView.isEventList&&!t.readOnly&&!1!==this.hasClipboardData()&&(e.items.pasteEvent={text:"L{pasteEvent}",localeClass:this,icon:"b-icon b-icon-paste",disabled:0===t.resourceStore.count||e.resourceRecord.readOnly,weight:110,onItem:({eventRecord:e})=>{this.pasteEvents(e.startDate)}})}onScheduleMenuPasteClick({date:e,resourceRecord:t,domEvent:n,feature:r}){const{activeView:i,constructor:s}=this.client,o=s.fromElement(r.menuContext.targetElement,(e=>e.isCalendarMixin));i.isResourceView||i.isDayResourceView||(t=null),null!=o&&o.parent&&o.parent.allDayEvents===o&&(this._isPastingIntoAllDay=!0),this.pasteEvents(e,t)}onEventDataGenerated(e){this.fixEventData(e),super.onEventDataGenerated(e)}fixEventData(e){if(!e.assignmentRecord){const{eventRecord:t,resourceRecord:n}=e;e.assignmentRecord=(n&&t.assignments.find((e=>e.eventId===t.id&&e.resourceId===n.id)))??t}}copyEvents(e,t){var n;return null!==(n=e)&&void 0!==n&&n[0].isAssignmentModel&&(e=e.map((e=>e.event))),super.copyEvents(e,t)}pasteEvents(e,t){const{_cellClickedContext:n}=this,{isResourceView:r,isDayResourceView:i}=this.client.activeView;return e&&(this.targetTime=e),e||t||!n||!r&&!i?super.pasteEvents(...arguments):super.pasteEvents(n.date,n.resourceRecord)}cloneData({data:e,isPaste:t}){var n;const r=super.cloneData({data:e,isPaste:t});var i;(r.assignmentRecords=e.assignmentRecords.map((t=>{const n=t.copy(),i=e.eventRecords.find((e=>e.id===n.eventId));return n.event=r.eventRecords.find((e=>e.originalInternalId===i.internalId)),n})),null===(n=r.eventRecords)||void 0===n||n.forEach((e=>delete e.meta.originalResourceId)),t&&this._isPastingIntoAllDay)&&(null===(i=r.eventRecords)||void 0===i||i.forEach((e=>e.allDay=!0)),this._isPastingIntoAllDay=!1);return r}refreshClient(){var e;const{activeView:t}=this.client;this.client.refresh(),null!==(e=t._overflowPopup)&&void 0!==e&&e.isVisible&&t._overflowPopup.refresh(),t.isResourceView&&t.eachView((e=>e.refresh()))}beforeListRenderRow({row:e,record:t}){e.cls["b-cut-item"]=t.assignments.some((e=>e.meta.isCut))}}IM.register(fF.type,fF),fF._$name="EventCopyPaste";class vF extends VR{static $name="EventEditor";static type="calendareventeditor";static configurable={align:{monitorResize:!0}};updateRecord(e){this.fixTimeFieldVisibility(e.allDay),super.updateRecord(e)}onAllDayChange({value:e,userAction:t}){this.fixTimeFieldVisibility(e,t)}fixTimeFieldVisibility(e,t){const n=e?"hide":"show",{startDateField:r,startTimeField:i,endDateField:s,endTimeField:o}=this.widgetMap;null==i||i[n](),null==o||o[n](),!e&&t&&(r&&(r.value=i.value=this.record.getData("startDate")),s&&(s.value=o.value=this.record.getData("endDate")))}onFocusOut(){super.onFocusOut(...arguments),this.owner=this.initialConfig.owner}}vF.initClass(),vF._$name="EventEditor";const yF=e=>e.isCalendar;class bF extends tT{static $name="EventEdit";static type="eventEdit";static configurable={editorConfig:{type:"calendareventeditor",items:{resourceField:{label:"L{Calendar}",showEventColor:!0},allDay:{type:"checkbox",cls:"b-match-label",name:"allDay",weight:250,label:"L{All day}",internalListeners:{change:"up.onAllDayChange"}}}}};construct(e){super.construct(e.client,e)}async onDragCreateEnd({eventRecord:e,resourceRecord:t}){e._dragCreated=!0,await this.editNewlyCreatedEvent(e,t),e._dragCreated=null}onEventAutoCreated({eventRecord:e}){this.editNewlyCreatedEvent(e)}editNewlyCreatedEvent(e,t){if(!this.disabled)return e.isCreating=!0,this.editEvent(e,t,null,!1)}async doEditEvent(e,t,n){var r,i;const s=this,{client:o}=s,{eventStore:a}=o,{startDate:l,endDate:d}=e;let c=o.eventSource||o.activeSubView;if(c.isScheduler)return s.client=c,await super.doEditEvent(...arguments),void(s.client=o);if(!c.isCalendarMixin||null!==(r=c.features)&&void 0!==r&&null!==(r=r.cellEdit)&&void 0!==r&&r.isEditing)return;if(e.startDate&&e.endDate&&!xi.intersectSpans(l,d,c.startDate,c.endDate)&&(o.date=e.startDate),c.allDayEvents&&c.isAllDayEvent(e)&&c.showAllDayHeader&&(c=c.allDayEvents),!e.isOccurrence){let t;a.includes(e)||(a.add(e),t=!0),(t||e._dragCreated)&&await c.afterRefresh({forceRefresh:!0})}const{_overflowPopup:u}=c,h=c.getDateFromElement(n);let g=null==u?void 0:u.isVisible,m=g?u.getEventElement(e):c.getEventElement(e,h);var p,f;(g&&(m?g=!1:m=u.getEventElement(e)),e.isCreating)&&(null===(p=o.onEventCreated)||void 0===p||p.call(o,e));!m&&c.isEventList&&(m=null===(f=c)||void 0===f||null===(f=f.rowManager)||void 0===f||null===(f=f.getRowFor(e))||void 0===f?void 0:f.element);if(g)m.focus();else if(m){const e=Yn.isInView(m);!e||e.height<100&&m.offsetHeight>Math.ceil(e.height)||e.width<m.getBoundingClientRect().width?await Md.scrollIntoView(m,{animate:!0,focus:!0,maxHeight:100}):m.focus({preventScroll:!0})}else{if(!c.isAllDayEvent(e)&&(!l||c.hiddenNonWorkingDays[l.getDay()]))return void s.internalShowEditor(e,null,{target:!0});!l||e.isCreating&&e._dragCreated||await c.scrollTo(e),m=c.getEventElement(e)}m||n||!c.isDayCellRenderer||(m=c.getCell(e.startDate)),s.isDestroyed||(s.internalShowEditor(e,null,{target:m||n,allowTargetOut:c.isAnimating}),null!==(i=s.editor)&&void 0!==i&&i.lastAlignSpec&&(s.editor.lastAlignSpec.allowTargetOut=!1))}async onSaveClick(){const e=this,{eventRecord:t}=e,{isCreating:n}=t.meta;e.isValid&&(t.isCreating=!1);const r=await super.onSaveClick(...arguments);var i;n&&r&&(e.eventStore.added.add(t),e.eventStore.usesSingleAssignment||e.assignmentStore.added.add(t.assignments),null===(i=e.client.crudManager)||void 0===i||i.onCrudStoreChange())}internalShowEditor(){var e,t;const{client:n,editor:r,startTimeField:i,endTimeField:s}=this,o=n.closest(yF)||n,a=(null===(e=o.activeView)||void 0===e?void 0:e.autoCreate)??(o.autoCreate||n.constructor.configurable.autoCreate),l=null==a?void 0:a.step,{activeSubView:d}=o,c=null==d?void 0:d._overflowPopup;null===(t=(n.isSchedulerBase?n.calendar:n).features.eventTooltip)||void 0===t||null===(t=t._tooltip)||void 0===t||t.hide(),r.owner=null!=c&&c.isVisible?c:d,!1!==super.internalShowEditor(...arguments)?l&&(i&&!i.initialConfig.step&&(i.step=l),s&&!s.initialConfig.step&&(s.step=l)):r.owner=r.initialConfig.owner}async finalizeStmCapture(e){}}IM.register(bF.type,bF),bF._$name="EventEdit";const CF=e=>e.eventStore;class wF extends rT{static $name="EventMenu";static type="eventMenu";static configurable={menu:{scrollAction:"realign"},items:{duplicate:{text:"L{EventMenu.duplicateEvent}",icon:"b-icon b-icon-copy",weight:400,onItem({eventRecord:e}){const t=e.copy(null,{skipFieldIdentifiers:!0}),{eventStore:n}=this.up(CF),{resources:r}=e;t.name=`${e.name} (${this.L("L{EventMenu.copy}")})`,t.recurrence=null,null!=r&&r.length&&n.assignmentStore.assignEventToResource(t,r),n.add(t)}}},triggerEvent:null};populateEventMenu({items:e,eventRecord:t,assignmentRecord:n}){super.populateEventMenu(...arguments);const{client:r}=this;e.duplicate={disabled:t.readOnly||(null==n?void 0:n.readOnly),hidden:r.readOnly}}getDataFromEvent(e){const{client:t}=this,{activeView:n}=t,{eventTooltip:r}=t.features;if("contextmenu"!==this.triggerEvent||"contextmenu"!==(null==r?void 0:r.showOn)||!r.enabled){var i;if(n.isScheduler)this.client=n;else null===(i=e.target.closest(".b-cal-event-wrap"))||void 0===i||i.focus();const r=super.getDataFromEvent(e);return this.client=t,r}e.preventDefault()}changeMenu(){const e=this,t=super.changeMenu(...arguments);return null==t||t.ion({beforeShow({source:t}){const{activeSubView:n}=e.client,{_overflowPopup:r}=n;t.owner=null!=r&&r.containsFocus?r:n}}),t}changeItems(e){return(e=super.changeItems(...arguments)).unassignEvent=null,e}}IM.register(wF.type,wF),wF._$name="EventMenu";const SF=e=>e.eventStore,DF=["activeElement","client","clientListeners","disabled","showOn","tooltip"];class EF extends IM{static $name="EventTooltip";static type="eventTooltip";static configurable={showOn:"click",closable:!0,axisLock:"flexible",tooltip:{$config:["lazy","nullify"],value:{type:"eventTip"}},titleRenderer:e=>N.encodeHtml(e.name),renderer:null,recurrenceConfirmation:{$config:["lazy","nullify"],value:{type:"recurrenceconfirmation"}},extendAllDayEndDay:null,align:null,revealEventsInCluster:!0,resources:null,clickDelay:null,alignToDomEvent:null};static get pluginConfig(){return{chain:["render"]}}get isVisible(){return!0}changeRecurrenceConfirmation(e,t){return e&&(e.rootElement=this.owner.rootElement),oc.reconfigure(t,e,{owner:this})}changeTooltip(e,t){const n=this,r=n.config;return e&&(e=BF.mergeConfigs({ownerFeature:n,forElement:n.client.element,id:`${n.client.id}-event-tip`,forSelector:"hover"===n.showOn&&".b-cal-event-wrap,.b-sch-event-wrap,.b-gantt-task-wrap,.b-taskboard-card",resources:n.resources,disabled:n.disabled,internalListeners:{thisObj:n,delete:"onDeleteClick",edit:"onEditClick",overTarget:"onTipPointerOver"}},e),Object.keys(r).forEach((t=>{DF[t]||!n.hasConfig(t)&&!(t in n.initialConfig)||(e[t]=r[t])}))),BF.reconfigure(t,e,n)}render(){const e=this,t={eventsPerCellChange:"onClientEventsPerCellChange",navigate:"onClientNavigate",renderEvents:"onRenderEvents",thisObj:e};"hover"===e.showOn?e.getConfig("tooltip"):("contextmenu"===e.showOn&&(e.alignToDomEvent=!0),t[`event${e.showOn}`]=t[`task${e.showOn}`]="onClientTooltipGesture"),e.client.ion(t)}get owner(){var e;return null!==(e=this.client.activeView._overflowPopup)&&void 0!==e&&e.containsFocus?this.client.activeView.overflowPopup:this.client}addListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.addListener(...e)}removeListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}onEditClick(){var e,t;const{client:n,activeClient:r,tooltip:i}=this,{overflowPopup:s}=r,o=(null==r||null===(e=r.features)||void 0===e?void 0:e.eventEdit)||n.features.eventEdit,a=(null==s||null===(t=s.element)||void 0===t?void 0:t.contains(i.activeTarget))?s.targetCell:i.activeTarget;o&&!o.disabled&&(o.editEvent(this.eventRecord,null,a,!1),i.hide())}onDeleteClick(){this.activeClient.calendar.removeEvents([this.eventRecord],(()=>{var e;return null===(e=this.tooltip)||void 0===e?void 0:e.hide()}),this.tooltip)}onClientEventsPerCellChange(){var e,t;null===(e=this._tooltip)||void 0===e||e.requestAnimationFrame(null===(t=this._tooltip)||void 0===t?void 0:t.hide)}onClientNavigate(e){var t;const{_tooltip:n}=this;null!=n&&n.activeTarget&&(!this.owner.owns(e.event)||e.item&&e.item!==n.activeTarget)&&!n.owns(null===(t=e.event)||void 0===t?void 0:t.relatedTarget)&&n.hide()}onRenderEvents(e){const{_tooltip:t}=this;null!=t&&t.activeTarget&&!this.activeClient.element.contains(this.tooltip.activeTarget)&&t.hide()}onClientTooltipGesture({domEvent:e,event:t,eventElement:n,eventRecord:r,source:i}){const{tooltip:s}=this;e=e||t,!1!==this.onTipPointerOver({event:e,newTarget:n,eventRecord:r,owningCalendarWidget:i})&&(n.classList.contains("b-cal-in-cluster")&&(this.alignToDomEvent||2===At(s.align.align).edgeAligned)?s.setTimeout({fn:"showByEvent",args:[e,n],delay:130}):s.showByEvent(e,n.closest("[data-event-id],[data-task-id]")))}onTipPointerOver({event:e,newTarget:t,owningCalendarWidget:n,eventRecord:r}){var i,s;const{tooltip:o,client:a}=this;var l;n||(n=null===(l=oc.fromElement(t))||void 0===l?void 0:l.closest(SF));return r||(r=n.getEventRecord(t)),!(null!==(i=a.features)&&void 0!==i&&null!==(i=i.eventEdit)&&void 0!==i&&i.isEditing||null!==(s=a.activeView.features)&&void 0!==s&&null!==(s=s.cellEdit)&&void 0!==s&&s.isEditing)&&(!a.floatRoot.querySelector(".b-eventeditor,.b-taskeditor")&&(n&&(e&&(o.triggeredByEvent=e,o.activeTarget=t),this.activeClient=n,r=n.getEventRecord(t),o.eventRecord=this.eventRecord=r),null!=r))}updateDisabled(e,t){super.updateDisabled(e,t),this._tooltip&&(this._tooltip.disabled=e)}}EF.initClass(),EF._$name="EventTooltip";const xF=e=>e.isCalendarMixin;class RF extends IM{static $name="ScheduleTooltip";static type="ScheduleTooltip";static configurable={showScheduleTip:e=>{var t;return(null==e?void 0:e.isDayView)||(null==e||null===(t=e.viewType)||void 0===t?void 0:t.isDayView)},tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",allowOver:!0,hoverDelay:0,hideDelay:100,forSelector:"*",showOnHover:!0,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,layoutStyle:"white-space:nowrap"}}};static get pluginConfig(){return{chain:["render"]}}changeTooltip(e,t){if(e){const n=this,{client:r}=n,i=tm.reconfigure(t,W.assign({},e,{id:`${r.id}-schedule-tip`,owner:r,forElement:r.viewContainer.element,getHtml:n.getHtml.bind(n),filterTarget:n.filterTarget.bind(n),internalListeners:{innerHtmlUpdate({source:e}){n.clockTemplate.updateDateIndicator(e.element,n.lastTime)}}}));return n.clockTemplate=new Gx({scheduler:r,mode:"hour"}),i}}filterTarget({target:e}){var t;if(!ir.isMouseDown()&&this.callback(this.showScheduleTip,this,[null===(t=oc.fromElement(e))||void 0===t?void 0:t.closest(xF)]))return e.closest(".b-cal-event-wrap")?null:e}getHtml({tip:e,event:t,activeTarget:n}){var r,i;const s=this,o=null===(r=oc.fromElement(n))||void 0===r?void 0:r.closest(xF),a=s.callback(s.showScheduleTip,s,[o])&&o.getDateFromDomEvent(t);if(a&&("pointermove"!==t.type||"touch"!==t.pointerType||!Object.values((null===(i=s.client.features.drag)||void 0===i?void 0:i.zones)||{}).some((e=>e.dragging)))){const{isDayView:e}=o,t=xi.format(a,`${o.dateFormat}${e?" "+(o.timeFormat||"LST"):""}`);return s.lastTime=a,e?s.clockTemplate.generateContent({date:a,text:t}):t}e.hide()}onCalendarScroll(){const{tooltip:e}=this;if(e.isVisible){const{triggeredByEvent:t}=e;Yn.elementFromPoint(t.clientX,t.clientY).dispatchEvent(new c.PointerEventConstructor("pointermove",t))}}render(){this.getConfig("tooltip"),Jt.on({element:this.client.element,scroll:"onCalendarScroll",thisObj:this,capture:!0})}updateDisabled(e,t){super.updateDisabled(e,t),this._tooltip&&(this._tooltip.disabled=e)}}IM.register(RF.type,RF,!0),RF._$name="ScheduleTooltip";const TF=e=>e.isCalendarMixin;class MF extends RT{static $name="ScheduleMenu";static type="scheduleMenu";static configurable={menu:{scrollAction:"realign"},triggerEvent:null};getDataFromEvent(e){const{client:t}=this,{activeView:n}=t,r=t.resolveResourceRecord(e)||t.defaultCalendar;n.isScheduler&&(this.client=n);const i=super.getDataFromEvent(e);return i.resourceRecord||(i.resourceRecord=r),this.client=t,i}shouldShowMenu({date:e,targetElement:t}){const{client:n}=this,{activeView:r}=n;if(r.isEventList&&!r.isAgendaView)return!1;if(r.isScheduler){this.client=r;const e=super.shouldShowMenu(...arguments);return this.client=n,e}return Boolean(e&&!t.closest(n.eventSelector))}populateScheduleMenu({items:e,domEvent:t,date:n}){super.populateScheduleMenu(...arguments);const{client:r}=this,{addEvent:i}=e,s=r.constructor.fromElement(this.menuContext.targetElement,TF);i&&(i.disabled=this.disableAddEvent,i.onItem=()=>{const e=r.activeView.getResourceRecord(t);!1!==r.activeView.trigger("beforeAutoCreate",{view:s,domEvent:t,date:n,resourceRecord:e})&&(s||r).createEvent(n,e,!0)})}get disableAddEvent(){const{resourceRecord:e,date:t}=this.menuContext;return!!e&&(e.readOnly||!e.isWorkingTime(t))}changeMenu(){const e=this,t=super.changeMenu(...arguments);return null==t||t.ion({beforeShow({source:t}){const{activeSubView:n}=e.client,{_overflowPopup:r}=n;t.owner=null!=r&&r.containsFocus?r:n}}),t}}IM.register(MF.type,MF,!0),MF._$name="ScheduleMenu";const kF=/^refresh$|.*event.*|.*resource.*|.*cell.*|.*row.*|.*schedule.*|daynumber.*|weeknumber.*|monthname.*|weekname.*$|beforedatechange|tickchange|.*showoverflowpopup|beforeautocreate|rangechange|weekflex|layoutupdate/,FF=e=>e.isCalendarMixin&&e.containsFocus,IF=Object.freeze([]),AF=e=>null!=e.weight,LF={weeknumberclick:1,monthnameclick:1},PF=e=>{var t;return e.isMonthView||"monthview"===(null===(t=e.view)||void 0===t?void 0:t.type)},OF=e=>{var t;return e.isWeekView||"weekview"===(null===(t=e.view)||void 0===t?void 0:t.type)},$F=e=>{var t;return"presentation"!==(null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"role"))&&Yn.isFocusable(e)},_F=(e,t)=>W.hasOwn(e,t)&&(null===e[t]||!1===e[t]);class HF extends(Xu.mixin(jM,VM,ag,sx,hF,gF,kE,wv,Yi,WC)){static $name="Calendar";static type="calendar";static get configurable(){return{layout:"hbox",enableRecurringEvents:!0,localizableProperties:["autoCreate.newName"],crudManager:null,features:{drag:{},eventCopyPaste:{},eventEdit:{},eventTooltip:{},scheduleMenu:{},eventMenu:{}},navigatorPlacement:null,eventContainerSelector:".b-eventrenderer,.b-overflowpopup",responsive:{small:{when:600,once:{mode:"day"},dateFormat:"MMM DD, YYYY"},medium:{when:800},large:{overlaySidebar:!1},"*":{overlaySidebar:!0,once:{mode:"week"}}},responsiveRoot:!0,stateful:["hideNonWorkingDays","mode"],tbar:{cls:"b-calendar-toolbar",items:{toggleSidebar:{icon:"b-icon-menu-vertical",cls:"b-sidebar-toggle b-borderless b-transparent",onClick:"up.onToggleSidebarClick",tooltip:"L{Calendar.toggleSidebar}",weight:100},todayButton:{text:"L{Calendar.Today}",cls:"b-cal-nav-item b-calendar-today-button",icon:"b-icon-calendar-day",onClick:"up.shiftToNow",weight:200},prevButton:{onClick:"up.shiftPrevious",cls:"b-cal-nav-item b-borderless b-transparent",icon:"b-icon-previous",weight:300},nextButton:{onClick:"up.shiftNext",cls:"b-cal-nav-item b-borderless b-transparent b-cal-nav-next",icon:"b-icon-next",weight:400},viewDescription:{cls:"b-calendar-view-desc",type:"widget",flex:"",html:" ",overflowable:"none",weight:500},spacer:{type:"widget",cls:"b-toolbar-fill",weight:600},modeSelector:{type:"calendarModeSelector",weight:700}}},items:{},viewContainer:{$config:"lazy",value:{type:"container",role:"presentation",weight:100,cls:{"b-calendar-viewcontainer":1},flex:"1 1 100%",layout:{type:"card"},scrollable:{overflowY:!0,overflowX:!0},suppressChildHeaders:!0,layoutStyle:{padding:0},internalListeners:{beforeActiveItemChange:"up.onBeforeViewContainerCardChange",activeItemChange:"up.onViewContainerCardChange"}}},includeWeekendsButton:!1,layoutStyle:{padding:0,flexFlow:"row nowrap"},modes:{day:{},week:{},month:{},year:{},agenda:{}},mode:{$config:"lazy",value:"week"},modeDefaults:{value:null},sidebar:{$config:{merge:"objects"},value:{type:"sidebar",side:"left",scrollable:{overflowY:!0},internalListeners:{dateChange:"up.onCalendarDateChange",collapse:"up.onCalendarSidebarToggle",expand:"up.onCalendarSidebarToggle"}}},datePicker:{$config:{merge:"objects"},value:{weight:100,dayNameFormat:"d1",editMonth:null,trapFocus:!1}},overlaySidebar:null,date:{$config:{equal:"date"},value:new Date},dateFormat:"MMMM DD, YYYY",scrollManager:{$config:["lazy","nullify"],value:{direction:"vertical"}},viewUpdateDelay:2e3,readOnly:null,allowOverlap:!0,testConfig:{viewUpdateDelay:5,loadMask:{text:"L{GridBase.loadMask}",showDelay:0}},highlightDate:null,autoCreate:{gesture:"dblclick",newName:"L{Object.newEvent}",step:"15 minutes",duration:"1 hour",startHour:8},focusable:!1,eventCls:"b-cal-event",weekStartDay:!1,hideNonWorkingDays:null,nonWorkingDays:!1,coreHours:null,contextMenuTriggerEvent:"contextmenu",enableUndoRedoKeys:!0,resourceImagePath:null,minDate:null,maxDate:null,filterEventResources:null,activeDateCls:null,keyMap:{Enter:"onEnterKey",Escape:"onEscapeKey",Home:"focusModeSelector",p:"shiftPrevious",n:"shiftNext",t:"shiftToNow",g:"gotoDate","Ctrl+d":"focusCurrentDate","/":"focusEventFilter",[/\d/]:"onDigitKey"},gotoDatePopup:{$config:"lazy",value:{cls:"b-calendar-goto-date-popup",type:"popup",title:"L{Calendar.gotoDate}",floating:!1,positioned:!0,centered:!0,items:{dateField:{type:"datefield"}},bbar:{items:{cancel:{text:"L{Object.Cancel}",onClick:"up.close"},go:{text:"L{Object.go}",onClick:"up.onGotoDateClick"}}},keyMap:{Enter:"up.onGotoDateClick"}}},propagatedConfigs:{value:["dateFormat","date","rtl","project","readOnly","weekStartDay","nonWorkingDays","hideNonWorkingDays","coreHours","timeZone","minDate","maxDate","resourceImagePath","visibleStartTime","visibleEndTime","filterEventResources"],$config:{merge:"distinct"}}}}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0},syncUIWithActiveView:{type:"buffer",delay:1,cancelOutstanding:!0}}}compose(){const{includeWeekendsButton:e,navigatorPlacement:t}=this;return{class:{[`b-calendar-nav-${t||"toolbar"}`]:1,"b-calendar-include-weekends-button":e}}}applyState(){this._hidden=!0,super.applyState(...arguments),this._hidden=!1,this.triggerPaint()}onPaintOverride(){}onInternalPaint(){this.onPaintOverride()||super.onInternalPaint()}onShowOverflowPopup({overflowPopup:e}){this.element.classList.add("b-overflow-popup-visible"),e.ion({hide:()=>this.element.classList.remove("b-overflow-popup-visible"),once:!0})}static getStartAndEndDates(e,t,n="dddd Do MMMM",r=e.timeFormat||"LT",i=(null==e?void 0:e.extendAllDayEndDay)){const s=e.dayTime||(e.dayTime=new Dg(0)),{allDay:o,startDate:a}=t,l=t.endDate||xi.add(a,t.fullDuration),d=o?i?xi.ceil(l,"1 day"):xi.add(l,-1,"day"):l,c=s.startOfDay(a)<s.startOfDay(d),u=!o&&xi.clearTime(a)<a||xi.clearTime(l)<d?c?`${n} ${r}`:r:n,h=t.isMilestone||o&&!c;return{multiDay:c,startDate:a,startText:xi.format(a,u),endDate:d,endText:h?null:xi.format(d,u)}}static get featureable(){return{factory:IM}}get dateTimeNow(){return null!=this.timeZone?Sh.toTimeZone(new Date,this.timeZone):new Date}get today(){const e=this.dateTimeNow;return e.setHours(0,0,0,0),e}finalizeInit(){var e;super.finalizeInit();const t=this,n=null===(e=t.activeView)||void 0===e?void 0:e.hideNonWorkingDays;null!=n&&null==t.hideNonWorkingDays&&(t.hideNonWorkingDays=n)}toggleEmptyText(){const{crudManager:e}=this,{eventStore:t}=e||this;Yn.toggleClasses(this.contentElement,"b-calendar-empty",!(t.count||null!=e&&e.isLoading))}refresh(){this.eachView((e=>{var t;return null===(t=e.refresh)||void 0===t?void 0:t.call(e)}))}get views(){const{modes:e}=this;return e?Object.values(e):[]}get activeView(){return this.viewContainer.layout.activeItem}get activeSubView(){var e;const{activeView:t}=this,{items:n}=t;return(null===(e=n.filter(FF))||void 0===e?void 0:e[0])||t}captureFocus(){return this.activeView.captureFocus()}getEventRecord(e){return this.activeView.getEventRecord(e)}resolveEventRecord(e){return this.getEventRecord(e)}onBeforeViewContainerCardChange({prevActiveItem:e,activeItem:t}){var n,r;if(!1===this.trigger("beforeActiveItemChange",arguments[0]))return!1;if(null===(n=e._overflowPopup)||void 0===n||null===(r=n.hide)||void 0===r||r.call(n),"date"in t&&!1!==t.syncViewDate){const n=this.date||e.date;n&&(t.isCalendarMixin?t.date=n:t.whenVisible((()=>t.date=n)))}}onViewContainerCardChange(e){if(this.trigger("activeItemChange",e),e.containedFocus){var t;const{activeItem:n}=e;null===(t=n.focusDate||n.focus)||void 0===t||t.call(n,this.date)}}onToggleSidebarClick(){const{sidebar:e}=this,{collapsible:t}=e;null!=t&&t.isPanelCollapserOverlay?t.revealing||t.toggleReveal(!e.revealed):e.toggleCollapsed()}onEnterKey(e){const{target:t}=e,n=HF.fromElement(t),{dayContentElement:r}=n,i=t.getAttribute("role"),s=n.isDayView?{clientY:r.getBoundingClientRect().top+n.hourHeight*n.autoCreate.startHour-r.scrollTop}:{};return("link"===i||"columnheader"===i||t.matches(".b-calendar-cell,.b-day-cell"))&&(Yn.triggerMouseEvent(t,"link"===i?"click":"dblclick",s),e.stopPropagation()),!1}onEscapeKey(e){var t;this.element.matches(".b-draghelper-active")||(null===(t=Yn.findParent(e.target,$F,this.element))||void 0===t||t.focus(),e.preventDefault(),e.stopPropagation());return!1}onDigitKey(e){return!Yn.isEditable(e.target)&&e.key.match(/\d/)&&(this.mode=this.viewContainer.items[Number(e.key)-1]),!1}focusModeSelector(){var e,t;const n=null===(e=this.widgetMap.modeSelector)||void 0===e?void 0:e.widgetMap;n&&(null===(t=[n[`${this.activeView.modeName}ShowButton`],n.modeSelectorButton].find((e=>null==e?void 0:e.isFocusable)))||void 0===t||t.focus())}gotoDate(){const{gotoDatePopup:e}=this;e.widgetMap.dateField.value=this.date,e.show()}changeGotoDatePopup(e){return eh.create(eh.mergeConfigs({appendTo:this.contentElement},e))}onGotoDateClick(){const{gotoDatePopup:e,activeView:t}=this,{dateField:n}=e.widgetMap;var r;(e.hide(),n.isValid)&&(this.date=n.value,null===(r=t.focusDate||t.focus)||void 0===r||r.call(t,this.date))}focusEventFilter(){var e;null===(e=this.widgetMap.eventFilter)||void 0===e||e.focus()}focusCurrentDate(){var e;const{activeView:t}=this;null===(e=t.focusDate||t.focus)||void 0===e||e.call(t,this.date)}shiftToNow(){var e,t;const n=this,{activeView:r}=n,i=null===(e=n.sidebar)||void 0===e?void 0:e.widgetMap.datePicker,{dayTime:s}=r,o=new Date,a=s?s.startOfDay(o):xi.clearTime(o);n.date=a,r.isScheduler?r.updateDate(a,a):r.scrollTo(a,{y:!r.isDayView}),i&&(i.date=a),n.updateViewDescription(),null===(t=r.focusDate||r.focus)||void 0===t||t.call(r,a)}shiftPrevious(e){const{activeItem:t}=this.viewContainer.layout,{startDate:n}=t;var r;null!=t&&t.previous&&(t.previous(),this.updateViewDescription(t),t.startDate-n&&t.animateTimeShift&&Yn.slideIn(t.contentElement,-1),null!=e&&e.type.startsWith("key")&&(null===(r=t.focusDate||t.focus)||void 0===r||r.call(t,this.date)))}shiftNext(e){const{activeItem:t}=this.viewContainer.layout,{startDate:n}=t;var r;null!=t&&t.next&&(t.next(),this.updateViewDescription(t),t.startDate-n&&t.animateTimeShift&&Yn.slideIn(t.contentElement,1),null!=e&&e.type.startsWith("key")&&(null===(r=t.focusDate||t.focus)||void 0===r||r.call(t,this.date)))}onCalendarSidebarToggle(e){e.source=this,this.trigger(`sidebar${N.capitalize(e.type)}`,e)}async onCalendarDateChange({date:e,oldDate:t,userAction:n}){const r=this,{layout:i}=r.viewContainer,{activeItem:s}=i.isChangingCard?i.animateDetacher.event:i,{highlightDate:o}=r;if(s&&!1!==s.syncViewDate&&"date"in s){const{getDayElement:t}=s;var a,l,d;if(!xi.betweenLesser(e,s.startDate,s.endDate))null===(a=s._overflowPopup)||void 0===a||null===(l=a.hide)||void 0===l||l.call(a);if(s.date=e,n&&!(s.isAgendaView||s.isYearView||s.isScheduler))null===(d=s.scrollTo)||void 0===d||d.call(s,e,{y:!s.isDayView});if(e=r.date=s.date,n&&o&&t){var c;s.scrollTo&&(await s.scrollTo(e),s.scrolledToDate&&(e=s.scrolledToDate));const t=null===(c=s.getDayElement)||void 0===c?void 0:c.call(s,e);t&&(isNaN(o)?r.callback(o,r,[t,r]):Yn.highlight(Ot.from(t)))}}r.syncViewActiveDates(t,e),r.trigger("dateChange",{oldDate:t,date:e})}updateActiveDateCls(e,t){this.syncViewActiveDates(this.date,this.date,t)}syncViewActiveDates(e,t=this.date,n=this.activeDateCls){const{activeDateCls:r}=this,{contentElement:i}=this.viewContainer;if(n){const t=e?i.querySelectorAll(`[data-date="${xi.makeKey(e)}"],[role="gridcell"][data-header-date="${xi.makeKey(e)}"]`):IF;for(let e=0,{length:r}=t;e<r;e++)t[e].classList.remove(n)}if(r){const e=i.querySelectorAll(`[data-date="${xi.makeKey(t)}"],[role="gridcell"][data-header-date="${xi.makeKey(t)}"]`);for(let t=0,{length:n}=e;t<n;t++)e[t].classList.add(r)}}updateViewDescription(e=this.activeView){const{tbar:t,widgetMap:n,element:r}=this,{viewDescription:i}=n,s=(null==e?void 0:e.description)||"Calendar",o=`<span class="b-calendar-view-desc-text">${s}</span>`;if(r.dataset.mode=this.activeView.modeName,r.setAttribute("aria-label",s),e){t&&i&&i.content!==o&&(i.content=o);const n=e.date||e.startDate;n&&(this.date=n)}}getStepUnitText(e=this.activeView){return e.stepUnit}syncUIWithActiveView(e=this.activeView){const t=this,{tbar:n,sidebar:r,widgetMap:i}=t;if(n&&null!=e&&e.isVisible){const{prevButton:n,nextButton:s,modeSelector:o}=i,a=t.getStepUnitText(e);null==o||o.syncActiveMode(e),r&&(r.stepUnitText=a),t.updateViewDescription(e),n&&(n.tooltip=a?t.L("L{previous}",a):"",n.disabled=!a||!e.previous),s&&(s.tooltip=a?t.L("L{next}",a):"",s.disabled=!a||!e.next)}}updateEventStore(e){this.detachListeners("eventStoreDateRange"),this.features.loadOnDemand,this.processConfiguredListeners(),e.ion({loadDateRange:"onEventStoreDateRangeRequested",name:"eventStoreDateRange",thisObj:this}),this.sidebar&&(this.sidebar.eventStore=e)}eachView(e,t,n=null){const r=null==t;for(const i of this.views)if(r&&(t=[i]),!1===i.callback(e,n||i,t))return}onEventStoreDateRangeRequested(e){e.changed&&this.trigger("dateRangeChange",e),this.trigger("dateRangeRequested",e)}async onModeSelectorToggle({source:e,pressed:t}){if(t){const t=this,{layout:n}=t.viewContainer,{view:r}=e;await t.modeSelectionPromise,t.modeSelectionPromise=n.setActiveItem(r).promise}}updateMode(e,t){const n=this,{isConfiguring:r}=n,{layout:i}=n.viewContainer,s=n.initialConfig||{};r||n._responsiveUpdating&&("mode"in s||"activeIndex"in s)||((e="string"==typeof e?n.modes[e]:e)?e!==n.activeView&&(i.setActiveItem(e,void 0,{animation:!n.isResponsiveUpdating}),r||i.activeItem===e||(n._mode=t,n.syncUIWithActiveView())):n._mode=t)}onEventStoreRefresh(){this.isConfiguring||this.syncUIWithActiveView(this.viewContainer.layout.activeItem)}handleViewRangeChange(){this.syncUIWithActiveView()}handleViewPaint({source:e}){this.syncUIWithActiveView(e),this._mode=e.modeName,this.trigger("viewPaint",{...arguments[0]})}onViewRefresh({source:e}){var t;null===(t=super.onViewRefresh)||void 0===t||t.call(this,...arguments),e.isVisible&&(e===this.activeView?this.updateViewDescription(e):this.activeView.owns(e)&&this.syncUIWithActiveView(this.activeView)),this.syncViewActiveDates()}updateEventCls(e){this.initialConfig.eventInnerSelector||(this.eventInnerSelector=`.${e}`),this.initialConfig.eventSelector||(this.eventSelector=`${this.eventInnerSelector}-wrap`)}changeModes(e,t){const n=this,{modeDefaults:r}=n,i=[];let s;n.getConfig("crudManager","defaultCalendar","eventCls");for(const t in e)s=e[t],s&&i.push(W.assign({modeType:t,weight:s.weight??(null==r?void 0:r.weight)??0},s));if(i.some(AF)){e={},i.sort(oc.weightSortFn);for(let t=0,{length:n}=i;t<n;t++)s=i[t],e[s.modeType]=s}const{tbar:o,element:a}=n,l={thisObj:n,descriptionChange:"onViewDescriptionChange",weekNumberClick:"onViewWeekNumberClick",monthNameClick:"onViewMonthNameClick",dayNumberClick:"onViewDayNumberClick",beforeEventAdd:"onViewBeforeEventAdd",catchAll:{fn:"onViewCatchAll",prio:1e4},dateRangeChange:"handleViewRangeChange",shiftIncrementChange:"handleViewRangeChange",rangeChange:"handleViewRangeChange",paint:"handleViewPaint",refresh:"onViewRefresh"},d=n.$modes||(n.$modes=new du({factory:VF,inferType:!0,owner:n,ownerName:"calendar",created(e,t){var r;if(e.modeName=t,e.isScheduler){const{features:t}=e,{eventEdit:r}=n.features;if(r&&(r.applyPluginConfig(e),e.editEvent=n.editEvent.bind(n)),e.ion({renderrow:()=>n.syncUIWithActiveView()}),!_F(t,"timeAxisHeaderMenu")){var i;const{listRangeMenu:r}=e;W.setPath(t.timeAxisHeaderMenu||(t.timeAxisHeaderMenu={}),"items.dateRange",!1),_F(t.timeAxisHeaderMenu.items,"setRange")||(t.timeAxisHeaderMenu.items.setRange={text:"L{Calendar.timeRange}",icon:"b-fw-icon b-icon-calendar",weight:300,menu:r}),null!==(i=n.sidebar)&&void 0!==i&&i.widgetMap.eventFilter&&(t.timeAxisHeaderMenu.items.eventsFilter=!1)}}a.classList.add(`b-cal-${t}`),e.ion(l),n.relayEvents(e,["eventPropagate"]),n.isConfiguring||n.trigger("addMode",{mode:e});const s=null==o||null===(r=o.widgetMap)||void 0===r?void 0:r.modeSelector;s&&(s.calendar=n,s.addMode(t,e)),W.getPropertyDescriptor(e,"eventCount")||Object.defineProperty(e,"eventCount",{get(){return this.eventStore.getEvents({startDate:this.startDate,endDate:this.endDate}).length}})},setup(e,t){const{defaultCalendar:i}=n,s=VF.resolveType(e.type);if(r&&(e=W.merge({},r,e)),s.isSchedulerBase){const t=e.features||(e.features={});t.eventTooltip=t.eventMenu=t.eventEdit=t.scheduleMenu=!1,"syncCalendarDate"in e||(e.syncCalendarDate=!0)}else e.eventSelector=n.eventSelector,e.eventInnerSelector=n.eventInnerSelector;return"list"===e.type&&(e.selectedRecordCollection=n.selectedCollection),"autoCreate"in n.initialConfig&&!("autoCreate"in e)&&(e.autoCreate=n.autoCreate),W.hasOwn(n,"_defaultCalendar")?e.defaultCalendar=n._defaultCalendar:null!=i&&(e.defaultCalendar=i),((e,t,n)=>{for(let r=0,{length:i}=n;r<i;r++){const i=n[r];i in e||void 0===t[i]||(e[i]=t[i])}})(e,n,n.propagatedConfigs),!1===n.trigger("beforeCreateMode",{config:e})?null:e}}));if(d.update(e),!t)return d.target}changeModeDefaults(e){const t=this,n=new Proxy({...e},{set(e,n,r){const i=Reflect.set(...arguments);return t.updateModeDefaults({[n]:r}),i},deleteProperty(e,n){const r=Reflect.deleteProperty(...arguments);return t.updateModeDefaults({[n]:null}),r}});return n}updateModeDefaults(e){this.isConfiguring||this.eachView((t=>t.setConfig(e)))}get collapsibleConfig(){const e=this.peekConfig("overlaySidebar"),t={type:e?"overlay":"inline",tool:null};return e&&(t.recollapseTool=null),t}updateOverlaySidebar(e){const{sidebar:t,collapsibleConfig:n}=this,r=null==t?void 0:t.collapsible;r&&(r.type!==n.type&&(t.collapsible=n),e?t.collapsed||(t.collapsed=!0,t.collapsedDueToOverlay=!0):(t.collapsedDueToOverlay||t.isVisible&&r.isPanelCollapserOverlay)&&(t.collapsed=!1,t.collapsedDueToOverlay=!1))}changeSidebar(e,t){const n=this,{datePicker:r,statefulId:i}=n;if(e){const s=e.items||(e.items={}),o=s.datePicker;return r?null!==o&&!1!==o&&(s.datePicker=HF.mergeConfigs(s.datePicker,r)):s.datePicker=null,HM.reconfigure(t,e,{owner:n,setup:(e,t)=>n.setupWidgetConfig(e,t),defaults:{stateId:i&&`${i}:sidebar`,eventStore:n.eventStore,date:n.date,weight:"right"===(null==e?void 0:e.side)||"end"===(null==e?void 0:e.side)?200:-10,collapsible:n.collapsibleConfig,items:{datePicker:{weekStartDay:n.weekStartDay}}}})}var s;null==t||t.destroy(),null===(s=n.tbar)||void 0===s||null===(s=s.widgetMap.toggleSidebar)||void 0===s||s.hide()}changeTbar(e){null!=e&&e.toggleSideBar&&!e.isWidget&&(G.deprecate("calendar","7.0.0","toggleSideBar ref is deprecated in favor of toggleSidebar"),e.toggleSidebar=e.toggleSideBar,delete e.toggleSideBar);const t=super.changeTbar(...arguments);var n;t&&!this.hasConfig("sidebar")&&(null===(n=t.widgetMap.toggleSidebar)||void 0===n||n.hide());return t}changeDatePicker(e){if(e)return Object.assign(e,{eventStore:this.eventStore,date:this.date,minDate:this.minDate,maxDate:this.maxDate})}get datePicker(){var e;return this.isConfiguring?this._datePicker:null===(e=this.sidebar)||void 0===e||null===(e=e.widgetMap)||void 0===e?void 0:e.datePicker}changeItems(e){const{modes:t,sidebar:n}=this;n&&(e.sidebar=n),e.viewContainer=this.viewContainer,e.viewContainer.items=t,e.viewContainer.activeIndex=Math.max(Object.keys(t).indexOf(this.mode),0),this.activeModeIndex&&(e.viewContainer.layout.activeIndex=this.activeModeIndex);const r=super.changeItems(e);return this._viewContainer=this.widgetMap.viewContainer,r}onViewCatchAll(e){const t=this,{fromOverflowPopup:n,type:r,source:i}=e;if(e.bubbles)return;let s,o,{domEvent:a}=e;if(!a&&Yn.isDOMEvent(e.event)&&(a=e.event),t.eventSource=i,!a||!1!==t.handleEvent(a)){var l;const d=r.startsWith("emptycell"),c=i.isEventList&&!i.range?"betweenLesserEqual":"betweenLesser";if(r.endsWith("click")&&!LF[r]&&(o=e.date||(null===(l=i.getDateFromDomEvent)||void 0===l?void 0:l.call(i,a)))){i.isDayView&&i.dayTime&&(o=i.dayTime.startOfDay(o));const e=n||"celloverflowclick"===r||a.target.closest(".b-cal-cell-overflow"),s=i.getDayElement&&!i.getDayElement(o,!0)||i.isDateRangeOwner&&!xi[c](o,i.startDate,i.endDate);i.syncCalendarDate&&(i.isCalendarRow||!(n&&s)&&!d&&!(i.isDateRangeOwner&&s)&&("daynumberclick"===r||!(s&&(e||r.startsWith("event")||r.startsWith("schedule")))))&&(i.preventScroll=!0,t.date=o,i.preventScroll=!1)}(d||kF.test(r))&&(!e.view&&(e.view=i),s=t.trigger(e.eventName,e))}return t.eventSource=null,s}onViewDescriptionChange(){this.updateViewDescription()}onViewWeekNumberClick({date:e,week:t}){const n=this.modes.week||this.viewContainer.query(OF);n&&(n.week=t,xi.betweenLesser(this.date,n.startDate,n.endDate)||(this.date=e),this.viewContainer.layout.activeItem=n)}onViewMonthNameClick({date:e}){const t=this.modes.month||this.viewContainer.query(PF);t?(t.getDayElement(e,!0)||(this.date=e),this.viewContainer.layout.activeItem=t):this.date=e}onViewDayNumberClick({source:e,date:t,cellData:n,fromOverflowPopup:r,domEvent:i}){var s;const{activeView:o}=this,a=e.isYearView&&("click"!==e.overflowPopupTrigger||r||!e.overflowPopup||n.isOtherMonth||!(null!==(s=n.events)&&void 0!==s&&s.length)&&!e.emptyCellRenderer);if((!o.isDayView||1!==o.duration)&&(e.isCalendarRow||e.isMonthView||a||e.isAgendaView)){const{viewContainer:n}=this,r=this.modes.day||n.query((e=>{var t;return"dayview"===(null===(t=e.view)||void 0===t?void 0:t.type.toLowerCase())}));if(r&&e!==r.allDayEvents){const{layout:e}=n,{activeItem:i}=e,{syncViewDate:s}=i;return i.syncViewDate=!1,this.date=t,n.layout.activeItem=r,i.syncViewDate=s,!1}}}onViewBeforeEventAdd({eventRecord:e,assignmentRecords:t}){const{eventEdit:n}=this.features,r=n&&!n.disabled;e.isCreating=r,null==t||t.forEach((e=>e.isCreating=r))}createEvent(e,t){this.doCreateEvent(e,t)}doCreateEvent(e,t,n=this.activeSubView,r){const{modes:i}=this,s=n.isYearView&&(i.week||i.month||i.day)||n;if(this.activeView.owns(s))n.doCreateEvent?n.doCreateEvent(e,t,s,r):n.createEvent(e,t,r);else{const{viewContainer:r}=this.widgetMap,{layout:i}=r;if(s)return r.ion({activeItemChange:"doCreateEvent",thisObj:n,once:!0,args:[e,t,s]}),e&&(this.date=e),i.activeItem=s,!1}}changeDate(e,t){if(e="string"==typeof e?xi.parse(e):new Date(e),isNaN(e))throw new Error("Calendar widget date ingestion must be passed a Date, or a YYYY-MM-DD date string");if(e=xi.clearTime(e),!t||e-t)return e}changeMinDate(e){return this.changeDate(e)}changeMaxDate(e){return this.changeDate(e)}updateMinDate(e){this.isConfiguring||(this.syncCommonConfig("minDate"),this.datePicker&&(this.datePicker.minDate=e))}updateMaxDate(e){this.isConfiguring||(this.syncCommonConfig("maxDate"),this.datePicker&&(this.datePicker.maxDate=e))}updateAutoCreate(){this.isConfiguring||this.syncCommonConfig("autoCreate")}updateDate(e,t){if(!this.isConfiguring){const{sidebar:n}=this;n?n.date=e:this.onCalendarDateChange({date:e,oldDate:t})}}updateDateFormat(){this.isConfiguring||this.syncCommonConfig("dateFormat")}changeIncludeWeekendsButton(e){return!0===e?{}:e}updateIncludeWeekendsButton(e){!this.isConstructing&&e&&W.isObject(e)&&(this.widgetMap.modeSelector.includeWeekendsButton=e)}changeScrollManager(e,t){if(null==t||t.destroy(),!this.isDestroying)return new Xg(Object.assign({element:this.element},e))}updateDefaultCalendar(){this.isConfiguring||this.syncCommonConfig("defaultCalendar")}changeWeekStartDay(e){return!1===e&&(e=xi.weekStartDay),e}updateReadOnly(){super.updateReadOnly(...arguments),this.isConfiguring||this.syncCommonConfig("readOnly")}updateWeekStartDay(e){var t;this.isConfiguring||(this.syncCommonConfig("weekStartDay"),null!==(t=this.sidebar)&&void 0!==t&&t.widgetMap.datePicker&&(this.sidebar.widgetMap.datePicker.weekStartDay=e))}changeHideNonWorkingDays(e){return Boolean(e)}updateHideNonWorkingDays(e,t){this.isConfiguring||(this.syncCommonConfig("hideNonWorkingDays"),this.trigger("changeHideNonWorkingDays",{value:e,was:t}))}changeNonWorkingDays(e){!1===e&&(e=xi.nonWorkingDays);const t=this,n=new Proxy({...e},{set(e){const n=Reflect.set(...arguments);return t.updateNonWorkingDays(e),n},deleteProperty(e){const n=Reflect.deleteProperty(...arguments);return t.updateNonWorkingDays(e),n}});return n}updateNonWorkingDays(){this.isConfiguring||this.syncCommonConfig("nonWorkingDays")}updateCoreHours(){this.isConfiguring||this.syncCommonConfig("coreHours")}syncCommonConfig(e){this.eachView((t=>{t[e]=this[e]}))}onCalendarStoreChange(){var e;if(this.isPainted){const{element:e,resourceStore:t}=this,{resourceFilter:n}=this.widgetMap,r=(n?t.records.filter((e=>n.value.includes(e))):t.records).length;e.classList.toggle("b-no-visible-resources",Boolean(n&&!r)),e.style.setProperty("--visible-resource-count",r)}null===(e=super.onCalendarStoreChange)||void 0===e||e.call(this,...arguments)}updateSelected(){const e=this.viewContainer.contentElement.querySelectorAll(".b-cal-event-wrap");for(let t=0,{length:n}=e;t<n;t++)e[t].classList.toggle(this.eventSelectedCls,this.isEventSelected(e[t].dataset.eventId))}getElementFromEventRecord(e,t){return this.activeView.getEventElement(e,void 0,t)}getElementsFromEventRecord(e,t){return[this.getElementFromEventRecord(e,t)]}updateLocalization(){const e=this;if(e.isPainted){let t=!1;"weekStartDay"in e.initialConfig||e.weekStartDay===xi.weekStartDay||(e.weekStartDay=xi.weekStartDay,t=!0),"nonWorkingDays"in e.initialConfig||W.isEqual(e.nonWorkingDays,xi.nonWorkingDays)||(e.nonWorkingDays=xi.nonWorkingDays,t=!0),t||e.refresh(),e.syncUIWithActiveView()}super.updateLocalization()}onEventDataGenerated(e,t){}}HF.initClass(),globalThis.bryntum&&(globalThis.bryntum.Calendar=HF);class VF extends(Qe.mixin(ds)){static get factoryable(){return{extends:oc}}}VF.register("agenda",wk),VF.register("year",tF),VF.register("month",Xk),VF.register("week",Zk),VF.register("day",jk),VF.register("dayagenda",Yk),VF.register("list",vk),VF.register("resource",aF),VF.register("dayresource",cF),HF.Modes=VF,G.setVersion("calendar","6.2.2"),HF._$name="Calendar";const NF=e=>e.eventStore;class BF extends tm{static $name="EventTip";static type="eventtip";static get configurable(){return{localizableProperties:["timeFormat"],align:{monitorResize:!0},dateFormat:"ll",eventRecord:{$config:"nullify",value:null},recurrenceHint:"",timeFormat:{value:"LST",$config:{localeKey:"L{timeFormat}"}},axisLock:"flexible",closable:null,forSelector:".b-cal-event-wrap",maxWidth:"30em",minWidth:"14em",scrollAction:"realign",cls:{"b-sch-event-tooltip":1},tools:{edit:{cls:"b-icon-edit",handler:"up.onEditClick",tooltip:"L{EventEdit.Edit event}",weight:100},delete:{cls:"b-icon-trash",handler:"up.onDeleteClick",tooltip:"L{SchedulerBase.Delete event}",weight:0},maximize:null},titleRenderer:e=>N.encodeHtml(e.name),renderer:null,extendAllDayEndDay:null,activeClient:null,revealEventsInCluster:!0}}static get delayable(){return{refreshContent:20}}clockTemplate=new Gx({});get owner(){return tm.fromElement(this.activeTarget)||this.ownerFeature.client}onEditClick(){this.trigger("edit")}onDeleteClick(){this.trigger("delete")}getHtml(e){const t=this,{eventRecord:n}=t;if(n)return e.eventRecord=n,t.title=t.titleRenderer?t.callback(t.titleRenderer,t,[n]):"",t.callback(t.renderer||t.internalRenderer,t,[{...e,eventRecord:n}])}internalRenderer({eventRecord:e}){var t;const{clockTemplate:n,recurrenceHint:r}=this,{allDay:i,recurrence:s}=e,o=(null===(t=tm.fromElement(this.activeTarget))||void 0===t?void 0:t.closest(NF))||this.owner.activeView,a=s?Ux.getLegend(s):r,l=xi.formatDelta(xi.diff(e.startDate,e.endDate),i?{precision:"d"}:null),{multiDay:d,startDate:c,startText:u,endDate:h,endText:g}=HF.getStartAndEndDates(o,e,this.dateFormat,this.timeFormat,this.extendAllDayEndDay);return n.mode=d?"day":"hour",n.template({date:c,text:u,cls:"b-sch-tooltip-startdate"})+(g?n.template({date:h,text:g,cls:"b-sch-tooltip-enddate"}):"")+(e.isMilestone?"":`<div class="b-cal-tooltip-duration b-icon b-icon-duration">${l}</div>`)+(a?`<div class="b-cal-tooltip-recurrence b-icon b-icon-recurring">${a}</div>`:"")}showByEvent(e,t=e.target){var n,r;const i=this,s=null===(n=i.ownerFeature)||void 0===n?void 0:n.clickDelay;if(i.activeTarget=t,i.pointerEvent=e,i.updateContent(),null!==(r=i.ownerFeature)&&void 0!==r&&r.alignToDomEvent&&(e.target.dataset.eventId=t.dataset.eventId,t={domEvent:e,anchor:!1,align:"s0-e100",axisLock:!0}),"click"!==e.type||!s)return i.showBy(t);i.hasTimeout("show")?i.clearTimeout("show"):(i.hoverDelay=s,e.type="pointerover",i.delayShow(t))}afterShowByTarget(){var e;const{delete:t}=this.tools;this.activeClient=null===(e=tm.fromElement(this.activeTarget))||void 0===e?void 0:e.closest(NF),super.afterShowByTarget(),t&&(t.disabled=this.ownerFeature.client.readOnly)}afterHide(){super.afterHide(...arguments),this.activeClient=null}updateActiveTarget(e,t){var n;null===(n=super.updateActiveTarget)||void 0===n||n.call(this,...arguments),null==t||t.classList.remove("b-cal-event-reveal"),e?e.classList.contains("b-cal-in-cluster")&&this.revealEventsInCluster&&e.classList.add("b-cal-event-reveal"):this.eventRecord=null}refreshContent(){this.eventRecord&&this.updateContent()}updateEventRecord(e){var t;const n=this;null===(t=n._changeHook)||void 0===t||t.call(n),n._changeHook=e&&ee.after(e,"afterChange",n.refreshContent,n),e&&(n.tools.delete&&(n.tools.delete.hidden=e.readOnly),n.tools.edit&&(n.tools.edit.hidden=e.readOnly))}updateContent(){const{clockTemplate:e,element:t,eventRecord:n}=this,r=super.updateContent(),i=t.querySelector(".b-sch-tooltip-startdate"),s=t.querySelector(".b-sch-tooltip-enddate"),{edit:o,delete:a}=this.tools,{client:l}=this.ownerFeature,{eventEdit:d}=l.features,c=l.readOnly||n.readOnly;if(i&&e.updateDateIndicator(i,n.startDate),s&&e.updateDateIndicator(s,n.endDate),o&&(o.hidden=c||!(null!=d&&d.enabled)),a&&(a.hidden=c),this.resources){var u;const{chipView:e}=this;e.items=n.resources,null===(u=this.contentElement.querySelector(".b-resourcechipview"))||void 0===u||u.remove(),this.contentElement.appendChild(e.element.cloneNode(!0))}return r}realign(){var e;const{lastAlignSpec:t}=this;this.isVisible&&null!=t&&t.aligningToElement&&t.target.dataset.eventId!==String(null===(e=this.eventRecord)||void 0===e?void 0:e.id)&&this.hide(),super.realign(...arguments)}updateActiveClient(e){this.detachListeners("clientOverflowChange"),e&&e.ion({name:"clientOverflowChange",eventsPerCellChange:"onClientOverflowChange",thisObj:this})}onClientOverflowChange(){Yn.isVisible(this.lastAlignSpec.target)||this.hide()}onDocumentMouseDown({event:e}){if(e.button||"click"!==this.ownerFeature.showOn||!this.activeTarget.contains(e.target))return super.onDocumentMouseDown(...arguments)}get chipView(){const e=this;return e._chipView||(e._chipView=new LM({parent:e}),Object.defineProperty(e.chipView,"isVisible",{get:()=>!0}),e.chipView.triggerPaint()),e._chipView}}BF.initClass(),BF._$name="EventTip";const zF=/^b-hover-(top|right|bottom|left)$/,jF=Symbol("eventDragMode"),WF=(e,t)=>{let n;return"b-cal-event-body"===e.className?e.children.push(n=t):Array.isArray(e.children)&&e.children.forEach((e=>{!n&&e&&(n=WF(e,t))})),n},UF=e=>Object.freeze({type:e,create:!1,move:!1,resize:!1,[e]:!0}),GF={create:{finisher:"finishDropCreate",mode:UF("create"),validatorFn:"validateCreateFn"},move:{finisher:"finishDropMove",mode:UF("move"),validatorFn:"validateMoveFn"},resize:{finisher:"finishDropResize",mode:UF("resize"),validatorFn:"validateResizeFn"}},YF={calendarrow:!0,monthview:!0,dayresourcecalendarrow:!0},qF=Symbol("meta");class KF extends(AM.mixin(sg,og,pg)){static $name="Zone";static get configurable(){return{droppableSelector:"*",droppable:!0,hoverable:null,hoverAnimationCls:"b-hover-anim",days:{$config:{equal:(e,t)=>W.isEqual(e,t)&&(null==e?void 0:e.resource)===(null==t?void 0:t.resource)},value:null},dragProxy:{type:"tip",tooltip:null},eventRecord:null,hit:null,dragItemSelector:".b-cal-event-wrap",overflow:{$config:"nullify",value:null},rootElement:null}}get dayTime(){var e;return null===(e=this.view)||void 0===e?void 0:e.dayTime}clearTime(e){return this.dayTime.startOfDay(e)}findRootElement(e){return e.contentElement}getDateFromPosition(e,t){return this.view.getDateFromPosition(e,t,!1,this.view.dayTime)}get dragEventer(){return this.owner}beforeDrag(e){const t=this,{owner:n}=t,r=t.hitTest(e),i=null==r?void 0:r.eventRecord,s=t.view.rtl?"right":"left";if(!r||null!=i&&i.readOnly||null!=i&&i.isCreating)return!1;let o,a;switch(r.date&&e.set("date",r.date),r.resource&&e.set("resource",r.resource),r.type){case"event":e.set("eventRecord",i),e.set("eventSourceHit",r),e.set("eventInset",r.eventElement.style[s]),e.set("eventWidth",r.eventElement.offsetWidth),o="move",a=!n.draggable||!i.isDraggable||!1===t.draggable,a||t.captureDragOffset(i,r,e);break;case"resize":e.set("eventRecord",i),e.set("eventSourceHit",r),e.set("eventInset",r.eventWrap.style[s]),e.set("eventWidth",r.eventWrap.offsetWidth),o="resize",a=!n.resizable||!i.resizable||!1===t.resizable;break;case"schedule":case"dayNumber":e.set("eventCreate",r),o="create",a=!n.creatable||!1===t.creatable;break;default:return!1}return!a&&(!1!==t.view[`allowDrag${N.capitalize(o)}`]&&void e.set("eventDragMode",e[jF]=GF[o].mode))}dragStart(){var e;const t=this,{dragging:n,owner:r,view:i}=t,{client:s}=r,o=()=>{n.lastMoveEvent&&n.move(n.lastMoveEvent)},a={scrollables:s.scrollManager?[{element:s.viewContainer.element,callback:o}]:[]};var l;((t.isResizing||t.isMoving)&&(t.refocus=r.client.captureFocus()),t.isResizing)&&(null===(l=n.itemElement)||void 0===l||l.classList.add("b-resizing"));i.scrollable&&a.scrollables.push({element:i.scrollable.element,callback:o}),i.horizontalScroller&&a.scrollables.push({element:i.horizontalScroller.element,callback:o}),null===(e=s.scrollManager)||void 0===e||e.startMonitoring(a)}captureDragOffset(){}cleanupDrag(){var e;const t=this,{dragProxy:n,dragging:r}=t,{tooltip:i}=n,s=t.view.isOverflowPopup?t.view.owner:t.view,{client:o}=t.owner,a=Yn.getActiveElement(o);null==r||null===(e=r.itemElement)||void 0===e||e.classList.remove("b-resizing"),null!=r&&r.aborted&&(t.days=null),s.afterRefresh((()=>{var e;(t.eventRecord&&(t.days=null),Yn.getActiveElement(o)===a)&&(null===(e=t.refocus)||void 0===e||e.call(t,!1,!0));t.refocus=null})),i&&(i.hide(),n.tooltip=null)}dragEnd(){var e;null===(e=this.owner.client)||void 0===e||null===(e=e._scrollManager)||void 0===e||e.stopMonitoring(),this.cleanupDrag()}makeDays(e,t){const{dayTime:n,firstVisibleDate:r,lastVisibleDate:i}=this.view,s=[];t=xi.add(t,-1,"d"),[e,t]=[e,t].map((e=>e<r?r:i<e?i:e));let o=n.startOfDay(e);for(const e=n.ceil(t);!(e<o);o=xi.add(o,1,"day"))s.push(n.dateKey(o));return s}onShowOverflowPopup({overflowPopup:e}){this.overflow||(this.overflow=new rI({owner:this.owner,view:e}))}get calendarCellSelector(){return this.view.visibleCellSelector}get calendarCells(){const e=this.dropRootElement;return e&&Yn.children(e,this.calendarCellSelector)}get isCreating(){var e;return null===(e=this.dropping)||void 0===e||null===(e=e[jF])||void 0===e?void 0:e.create}get isMoving(){var e,t,n;const r=(null===(e=this.dropping)||void 0===e?void 0:e[jF])||(null===(t=this.dragging)||void 0===t?void 0:t[jF]);return r?r.move:Boolean(null===(n=this.dropping)||void 0===n?void 0:n.peek("eventRecord"))}get isResizing(){var e;return null===(e=this.dragging)||void 0===e||null===(e=e[jF])||void 0===e?void 0:e.resize}get recurrable(){return this.isDayZone||this.isMonthZone}cleanupDrop(){this.eventRecord=this.eventDom=this.days=null,this.noTip=!1}createEvent(e,t=this.dropping){const n=(null==t?void 0:t[jF])||GF.create.mode;this.setupEvent(e,n.create)}async dragDrop(e){if(this.isResizing||e.target===this)return e.finalizer=this.finishDrop(e)}dragEnter(e){const t=this,n=e[jF],r=e.source===t&&e.peek("eventSourceHit")||t.hitTest(e);if(t.isMoving)t._hit=r,t.startMove(e.peek("eventRecord"));else{if(!n||e.source!==t)return!1;if(n.resize)t._hit=r,t.startResize(r);else{if(!n.create)return!1;t._hit=r,t.startCreate(e.peek("date"),e.peek("eventCreate"))}}}dragLeave(){this.isResizing||this.cleanupDrop()}dragMove(e){this.hit=this.pickDropTarget(e)}dropHitMove(e,t,n){const r=this,{endDate:i,startDate:s}=n.isScheduled?n:r.eventRecord,o=xi.diff(s,i,"s");let{date:a,resource:l}=t;a=r.clearTime(a),n.allDay||(a=xi.add(a,xi.diff(r.clearTime(s),s,"s"),"s")),a=r.applyDragOffset(a,e);const d={startDate:a,endDate:xi.add(a,o,"s")};null!=l&&l.eventColor&&(d.eventColor=l.eventColor),r.setEventData(d)}dropHitNowhere(){this.days=null}dropHitResize(e,t,n){const r=this,{eventRecord:i}=r,{startDate:s,endDate:o}=i,a=r.clearTime(t.date);let l,d;n.atEnd?(d=xi.add(a,1,"d"),l={startDate:s,endDate:s<d?d:xi.add(s,1,"d")}):l={startDate:a<o?a:xi.add(o,-1,"d"),endDate:o},l.duration=xi.diff(l.startDate,l.endDate,i.durationUnit),r.setEventData(l)}async finishDrop(e){const t=this,{eventRecord:n,owner:r,view:i}=t,{eventStore:s}=i,o=e[jF],a=GF[(null==o?void 0:o.type)||"move"];if(a&&t.hit){const l=!a.validatorFn||await r.callback(r[a.validatorFn],r,[{drag:e,eventRecord:n,event:e.event}]);!1!==l&&await t[a.finisher](e,r,n,s,l,(async(s,a,d)=>{let c={drag:e,eventRecord:n,newStartDate:n.startDate,newEndDate:n.endDate,resourceRecord:t.hit.resource||i.resource,validation:l,event:e.event,feature:r,view:e[t.isResizing?"source":"target"].view};return!1===await r.client.trigger("before"+N.capitalize(s),c)?(c=!1,await(null==d?void 0:d())):(i.allowTransitionsOnRefresh=!1,await(null==a?void 0:a()),delete c.newStartDate,delete c.newEndDate,"create"!==(null==o?void 0:o.type)&&(c.eventRecord=e.peek("eventRecord")||n),r.client.trigger(s,c)),c}))}t.isFinishing=!0,t.cleanupDrop()}async finishDropCreate(e,t,n,r,i,s){const o=!1!==(null==i?void 0:i.add);!1===await s("dragCreateEnd")?o&&r.remove(n):o&&!r.includes(n)&&r.add(n)}async finishDropMove(e,t,n,r,i,s){var o;let a=await e.get("eventRecord");const l=this,{view:d}=l,c=a.isOccurrence?a.recurringTimeSpan:a,{source:u}=e,h=await e.get("resource"),g=l.hit.resource,m=u!==l&&null!==(o=u.view)&&void 0!==o&&o.eventStore&&d.eventStore&&u.view.eventStore!==d.eventStore?u.view.eventStore:await e.get("sourceStore"),p=g&&g!==h;!p&&e.source===e.target&&xi.isEqual(n.startDate,a.startDate)&&xi.isEqual(n.endDate,a.endDate)&&a.eventStore===r||await s("dragMoveEnd",(async()=>{if(r.getByInternalId(c.internalId))a=await l.finishDropConfirm(a),a&&(await l.moveEventTo(e,a),p&&(a.isOccurrence&&a.convertToRealEvent(),a.assign(g),a.unassign(h)));else{m?l.owner.removeFromExternalStore?m.remove(a):a=a.copy():a=n,a.setData("resourceId",null),r.add(a),await l.moveEventTo(e,a);const t=g??(!p&&!d.project.resourceStore.includes(a.resource)&&l.owner.client.defaultCalendarId);null!=t&&d.project.resourceStore.includes(t)?a.assign(t):d.project.resourceStore.includes(a.resource)||(a.resources=[])}await d.project.commitAsync()}))}async finishDropResize(e,t,n,r,i,s){const{view:o}=this,{eventRecord:a,edge:l}=await e.get("eventSourceHit"),d=l.bottom||(o.rtl?l.left:l.right)?"endDate":"startDate";n[d]-a[d]&&await s("dragResizeEnd",(async()=>{const e=await this.finishDropConfirm(a);e&&e.set({startDate:n.startDate,endDate:n.endDate,duration:xi.diff(n.startDate,n.endDate,e.durationUnit)}),await o.project.commitAsync()}))}async finishDropConfirm(e){return e.isOccurrence||e.isRecurring?new Promise((t=>{const n=this.owner.client.recurrenceConfirmationPopup;n.owner=this.owner,n.confirm({actionType:"update",eventRecord:e,cancelFn(){t(null)},changerFn(e){t(e)}})})):e}async moveEventTo(e,t){const n=this;let r=n.view.getDateFromElement(e.targetElement);if(t.startDate&&(r=xi.copyTimeValues(n.clearTime(r),t.startDate)),r=n.applyDragOffset(r,e),e.peek("sourceStore")!==n.view.eventStore&&!t.startDate){const t=e.target.view.autoCreate||n.owner.client.autoCreate;r.setHours((null==t?void 0:t.startHour)||8)}await n.setStartDate(t,r)}pickDropTarget(e){var t;let n=this.hitTest(e);return!n&&this.isResizing&&(n=this.hit),null!==(t=n)&&void 0!==t&&t.date?n:null}setStartDate(e,t){return e.set({startDate:t,endDate:xi.add(t,e.fullDuration)})}getHoverHandleCls(e){return e?"":"b-gripper-vert"}hoverEnter(){var e,t;const n=this,r=n.hitTest(n.hoverTarget),{gripper:i}=n.owner,s=n.getHoverHandleCls(),o=n.getHoverHandleCls(!0);o&&i.classList.remove(o),!1===(null==r||null===(e=r.eventRecord)||void 0===e?void 0:e.resizable)||null!=r&&null!==(t=r.eventRecord)&&void 0!==t&&t.readOnly||(s&&i.classList.add(s),n.hoverTarget.appendChild(i))}hoverLeave(e){const{gripper:t}=this.owner,n=this.getHoverHandleCls();t.parentNode===e&&(n&&t.classList.remove(n),e.removeChild(t))}applyDragOffset(e,t){const n=t.peek("eventOffset");var r;e&&null!=n&&n[0]&&(t.source.constructor===(null===(r=t.target)||void 0===r?void 0:r.constructor)&&(e=xi.add(e,-n[0],n[1])));return e}hitTest(e){const t=this,n=null==e?void 0:e.isDragContext,r=n?e.event:e,i=n&&e.targetElement||Yn.getEventElement(r);let s,o,a=t.view,l=null;if(i){a.calendarHitTest||(a=t.owner.client);const e=a.rtl?"right":"left";l=a.calendarHitTest(i),l&&(l.eventWrap=o=i.closest(".b-cal-event-wrap"),i.classList.contains("b-gripper")?(l={type:"resize",cell:l.cell,date:l.date,edge:s={},eventRecord:l.eventRecord,resource:l.resource,eventWrap:o,gripper:i,view:l.view},Vt.normalize(o.className,"array").forEach((e=>{(e=zF.exec(e))&&(s[e[1]]=!0)})),l.atEnd=!(s.top||s[e])):l.eventRecord||(o=null),o&&(l.eventTop=o.style.top),i!==r&&(l.date=t.getDateFromPosition(r.clientX,r.clientY)||l.date))}return l}renderEvent(e,t,n){var r,i;const{view:s,owner:o}=this;Object.defineProperty(e,"assigned",this.assignmentsProperty);const a=s.createEventDomConfig({eventRecord:e,isAllDay:YF[s.type],asSelected:e.data.realEventId&&(null===(r=(i=o.client).isEventSelected)||void 0===r?void 0:r.call(i,e.data.realEventId))});if(a.className["b-cal-tentative-event"]=1,a.className["b-cal-tentative-event-first"]=t,a.className["b-cal-tentative-event-last"]=n,delete e.assigned,n){const{footer:t}=o;t&&!s.showTime.endTime&&WF(a,W.assign({html:xi.format(e.endDate,s.timeFormat)},t))}return a}setEventData(e,t){const n=this,{eventRecord:r,view:i}=n,{duration:s,startDate:o}=e;if(o&&null!=s&&!e.endDate&&(e={...e,endDate:xi.add(o,s,r.durationUnit)}),r.set(e),n.eventDom)n.eventDom.className[i.shortEventCls]=r.rawDurationMS<=i.shortEventDuration;else{if(t){let e,{newName:t}=n.owner;if(t){const s=n.view.resolveCallback(t,i,!1);e=(null==s?void 0:s.handler.call(i,r))||t}else t=i.autoCreate.newName,e=i.resolveCallback(t,i,!1)?i.callback(t,i,[i,r.startDate,i.resource||i.defaultCalendar]):t;r.name=e}n.eventDom=n.renderEvent(r)}}setupEvent(e,t){var n;const r=this,{owner:i}=r,{defaultCalendar:s,eventStore:o}=r.view,{tooltip:a}=i,l=r.eventRecord=i.eventRecord=o.createRecord({}),d=t?new Set([o.assignmentStore.createRecord({event:l,resource:s})]):e.assigned;r.assignmentsProperty={configurable:!0,value:d},delete e.assigned,e[qF]&&(l.meta=e[qF]),r.setEventData(e,t),r.isCreating&&s&&o.assignmentStore.assignEventToResource(l,s);const{eventDom:c}=r;return c.className["b-cal-tentative-event"]=1,r.noTip||a.disabled||null===(n=r.dragging)||void 0===n||!n.has("eventCreate")||(a.eventRecord=l,a.recurrenceHint=t&&r.recurrable?i.recurrenceTip:"",r.dragProxy.tooltip=a),c}startCreate(e){this.createEvent({allDay:!0,startDate:e,durationUnit:this.durationUnit,endDate:xi.add(e,1,"d")})}get durationUnit(){return this.view.dragUnit||qs.from(this.view.autoCreate.duration).unit||this.owner.durationUnit}startMove(e){var t,n;const r=this,i=W.clone(e.dataByFieldName),s=r.dropping,{hit:o}=r,a=(null==o||null===(t=o.resource)||void 0===t?void 0:t.eventColor)??(null===(n=s.peek("resource"))||void 0===n?void 0:n.eventColor);var l;(a&&!i.eventColor&&(i.eventColor=a),i.assigned=e.assigned,i.startDate||(i.startDate=(null==o?void 0:o.date)||new Date,i.endDate=xi.add(i.startDate,e.duration||1,e.durationUnit||"h")),null!=o&&o.resource&&(i.resourceId=o.resource.id),i.resourceId)||(i.resourceId=s.peek("resourceId")||(null===(l=r.owner.client)||void 0===l?void 0:l.defaultCalendarId));i.realEventId=i.id,delete i.id,i[qF]=W.clone(e.meta),r.setupEvent(i)}startResize(e){var t;const{eventRecord:n}=e,r=W.clone(n.dataByFieldName);r[qF]=W.clone(n.meta),this.createEvent({...r,assigned:n.assigned,id:`dragResize-event-${r.id}`,eventColor:r.eventColor||(null===(t=n.resource)||void 0===t?void 0:t.eventColor),recurrenceRule:null,realEventId:r.id})}configureListeners(e){const t=super.configureListeners(e);return t.element=this.view.rootElement,t}updateHit(e){const t=this,n=t.dropping,r=e&&n[jF];e?t.isMoving?t.dropHitMove(n,e,n.peek("eventRecord")):null!=r&&r.create?t.dropHitCreate(n,e,n.peek("eventCreate")):null!=r&&r.resize&&t.dropHitResize(n,e,n.peek("eventSourceHit")):t.dropHitNowhere(n)}updateDays(e){const t=this,{calendarCells:n,eventDom:r,dayValues:i}=t,s=n&&{};let o,a,l,d,c,u=!0;if(t.dayValues=s,n&&r){for(d=0;d<n.length;++d)o=n[d],null!=e&&e.includes(o.dataset.date)&&(c=o);for(d=0;d<n.length;++d)o=n[d],a=o.dataset.date,null!=e&&e.includes(a)&&((l=null==i?void 0:i[a])?delete i[a]:(l=t.includeDay(a,o,u,o===c)||!0,u=!1),s[a]=l);if(i){const n=()=>{for(d in i)t.removeDay(d,i[d],t.isCreating)};e||!t.isCreating||t.dragging.aborted?n():t.view.afterRefresh(n)}}}updateEventRecord(e){this.owner.eventRecord=e}updateOverflow(e,t){return!e&&t&&t.destroy(),e}updateOwner(e){this.hoverIgnoreElement=null==e?void 0:e.gripper}updateRootElement(e){const t=this;t.dragRootElement=e,t.dropRootElement=t.droppable?e:null,t.owner.resizable||(t.hoverable=!1),t.hoverRootElement=t.hoverable?e:null}updateView(e,t){var n;super.updateView(e,t);const r=this;r.rootElement=e?r.findRootElement(e):null,null===(n=r._overflowDetacher)||void 0===n||n.call(r),null!=e&&e.isDayCellRenderer&&(r._overflowDetacher=e.ion({thisObj:r,showOverflowPopup:"onShowOverflowPopup"}))}}KF.prototype._eventRecord=null;class XF extends KF{static $name="BaseDayZone";static get configurable(){return{hoverSelector:".b-cal-event-wrap",draggingClsSelector:".b-dayview-content"}}getHoverHandleCls(e){let t=this.isAllDayZone;return e&&(t=!t),"b-gripper-"+(t?"vert":"horz")}}class ZF extends XF{static $name="AllDayZone";static get configurable(){return{hoverEdges:"lr"}}dragEnter(e){return this.view.eventsPerCell||this.view.expandGutter(),super.dragEnter(e)}dragLeave(e){this.view.collapseGutter(),super.dragLeave(e)}captureDragOffset(e,t,n){n.set("eventOffset",[Math.max(Math.floor(xi.diff(e.startDate,t.date,"d")),0),"d"])}dropHitCreate(e,t,n){let r=this.clearTime(t.date),i=this.clearTime(n.date);r<i&&([i,r]=[r,i]),this.setEventData({startDate:i,duration:xi.as(this.eventRecord.durationUnit,xi.diff(i,r,"d")+1,"d")})}async moveEventTo(e,t){const n=this,r=n.hitTest(e),i=n.applyDragOffset(null==r?void 0:r.date,e),s=new Date(t.startDate);i&&(s.setFullYear(i.getFullYear()),s.setMonth(i.getMonth()),s.setDate(i.getDate()),n.view.dayTime.startShift?(s.setHours(i.getHours()),s.setMinutes(i.getMinutes()),s.setSeconds(i.getSeconds()),t.duration=1):n.view.isAllDayEvent(t)||(t.allDay=!0),await n.setStartDate(t,s))}setEventData(e,t){super.setEventData(e,t);const n=this,{eventRecord:r}=n,{startDate:i,endDate:s}=r;t&&!n.view.dayTime.startShift&&(r.allDay=!0),n.days=n.makeDays(i,s)}updateDays(e){const t=this;let{eventEl:n}=t;if(null!=e&&e.length){var r;n||(t.eventEl=n=Yn.createElement({...t.eventDom}),n.classList.add("b-allday"));const{dropRootElement:i}=t,{visibleCellSelector:s,weekLength:o}=t.view,a=null===(r=t.dragging)||void 0===r||null===(r=r.peek("eventSourceHit"))||void 0===r?void 0:r.eventTop,l=Yn.children(i,s),d=Yn.down(i,`${s}[data-date='${e[e.length-1]}']`);Yn.down(d,".b-cal-event-bar-container").appendChild(n),n.style[t.view.rtl?"right":"left"]=Yn.percentify(100*(l.indexOf(d)-e.length+1)/o),n.style.width=Yn.percentify(100*e.length/o),a&&(n.style.top=a),t.view.scrollable.scrollIntoView(n,!0)}else n&&(n.classList.contains("b-cal-tentative-event")&&n.remove(),t.eventEl=null)}updateView(e,t){if(e){const t=xi.diff(e.startDate,e.endDate,"d")>1;this.hoverable=t,this.draggable=t||this.view.owner.isDayView}super.updateView(e,t)}}class JF extends XF{static $name="DayZone";static configurable={dragEventId:null,hoverable:!0,hoverEdges:"tb",times:{$config:{equal:"array"},value:null},allDayZoneClass:ZF,constrainToDay:!1};construct(...e){super.construct(...e);const t=this,{allDayEvents:n}=t.view;n&&!1!==t.view.showAllDayHeader&&(t.allDayZone=new t.allDayZoneClass({owner:t.owner,view:n,resource:t.resource}))}syncDraggingElements(e,t){const{dragging:n}=this,{draggingItemCls:r}=n.source,i=n.itemElement.closest(".b-dayview-day-container"),s=(null==i?void 0:i.querySelectorAll(`[data-event-id="${e}"]`))??[];for(const e of s)e.classList.toggle(r,t)}hitTest(e){const{view:t,dragging:n}=this,{dayTime:r}=t,i=super.hitTest(e);if(i){const{date:s}=i,o=null!=e&&e.isDragContext?t.getDateFromPosition(e.event.clientX,Ot.fromScreen(t.dayContainerElement).y+1,!1,r):r.startOfDay(i.date);if(n&&!this.isMoving&&!1===t.interDayResize||this.isMoving&&!1===t.interDayDrag){const e=n.peek("date");s.setDate(e.getDate()),s.setMonth(e.getMonth()),s.setFullYear(e.getFullYear()),o&&(o.setDate(e.getDate()),o.setMonth(e.getMonth()),o.setFullYear(e.getFullYear()))}i.overDate=o}return i}updateDragEventId(e,t){t&&this.syncDraggingElements(t,!1),e&&this.syncDraggingElements(e,!0)}get eventRecord(){var e;return super.eventRecord||(null===(e=this.allDayZone)||void 0===e?void 0:e.eventRecord)}set eventRecord(e){super.eventRecord=e}get recurring(){var e;return this.isCreating&&null!=(null===(e=this.eventRecord)||void 0===e?void 0:e.recurrenceRule)}get droppingAllDay(){var e,t;const n=null===(e=this.dropping)||void 0===e?void 0:e.peek("eventRecord");return(null==n?void 0:n.startDate)&&(null===(t=this.view)||void 0===t?void 0:t.isAllDayEvent(n))||!1}get useAllDay(){return this.droppingAllDay&&this.view.showAllDayHeader&&this.dropping.source!==this.allDayZone}get wasAllDay(){return this.droppingAllDay&&this.dropping.source===this.allDayZone}doDestroy(){var e;null===(e=this.allDayZone)||void 0===e||e.destroy(),super.doDestroy()}dragStart(){var e;super.dragStart(),this.dragEventId=(null===(e=this.dragging.peek("eventRecord"))||void 0===e?void 0:e.id)??null}findRootElement(e){return e.eventContentElement}captureDragOffset(e,t,n){n.set("eventOffset",[Math.floor(xi.diff(e.startDate,t.date,"m")),"m"])}cleanupDrag(){var e;this.dragEventId=null,super.cleanupDrag(),null===(e=this.allDayZone)||void 0===e||e.cleanupDrag()}cleanupDrop(){var e,t;super.cleanupDrop(),null===(e=this.owner.client)||void 0===e||null===(e=e._scrollManager)||void 0===e||e.stopMonitoring(),null===(t=this.allDayZone)||void 0===t||t.cleanupDrop()}dropHitCreate(e,t){const n=this,{durationUnit:r}=n.eventRecord;let i,s,o=t.date,a=e.peek("eventCreate").date,l=o,d=a;const c=!(n.clearTime(a)-n.clearTime(o)),u=e.ctrlKey&&!c;u||c?(l=n.clearTime(o),d=n.clearTime(a),a-=d,o-=l,l<d&&([d,l]=[l,d]),o<a&&([a,o]=[o,a]),d.setTime(d.getTime()+a),i=xi.as(r,Math.max(n.view.increment,Math.floor(o-a))),u&&(s=xi.diff(n.clearTime(d),n.clearTime(l),"d")+1)):(l<d&&([d,l]=[l,d]),i=xi.as(r,Math.floor((l-d)/6e4),"m")),n.setEventData({startDate:d,duration:i,recurrenceRule:u?`FREQ=DAILY;COUNT=${s}`:null})}dropHitMove(e,t,n){let r=t.date;const i=this,{view:s}=i,o=s.dayTime.startOfDay(r);if(i.useAllDay)i.allDayZone.dropHitMove(e,t,n);else{if(n=i.eventRecord,r=i.applyDragOffset(r,e),s.showAllDayHeader&&r<o)r=o;else if(!s.snapRelativeToEventStartDate){const t=e.event.clientX>e.startEvent.clientX?"ceil":"floor";r=xi[t](r,s.increment)}i.setEventData({startDate:r,endDate:xi.add(r,n.duration,n.durationUnit),duration:n.duration})}}applyDragOffset(e,t){let n=super.applyDragOffset(e,t);if(this.constrainToDay){const{overDate:e}=this.hit;n=new Date(Math.max(Math.min(n,e.getTime()+this.view.dayTime.timeEnd-this.eventRecord.rawDurationMS),e))}return n}dropHitResize(e,t,n){const r=this,{eventRecord:i}=r,s=t.date;n.atEnd?i.startDate<s&&r.setEventData({endDate:s}):s<i.endDate&&r.setEventData({startDate:s})}async moveEventTo(e,t){const n=this,r=n.hitTest(e),i=null==r?void 0:r.date;if(i)if(n.useAllDay)await n.allDayZone.moveEventTo(e,t);else{const{view:r}=n,s=n.applyDragOffset(i,e),o=e.event.clientX>e.startEvent.clientX?"ceil":"floor",a=r.snapRelativeToEventStartDate?s:xi[o](s,r.increment);if(n.wasAllDay){const e=xi.add(r.dayTime.startOfDay(a),24,"h"),n=xi.add(a,t.duration,t.durationUnit);if(t.allDay=!1,n>e){const n=r.autoCreate||r.changeAutoCreate(!0),i=xi.parseDuration(n.duration),s=new Date(Math.min(xi.add(a,i.magnitude,i.unit),e)),o=xi.diff(a,s,t.durationUnit);t.setDuration(o,t.unit)}}await n.setStartDate(t,a)}}startCreate(e){this.createEvent({duration:0,durationUnit:this.durationUnit,startDate:e,isCreating:!0})}includeDay(e,t,n,r){return Yn.createElement({parent:t.querySelector(".b-dayview-event-container"),...this.renderEvent(this.eventRecord,n,r)})}removeDay(e,t){t.classList.contains("b-cal-tentative-event")&&t.remove()}setEventData(e,t){const n=this;if(n.useAllDay)return void n.allDayZone.setEventData(e,t);super.setEventData(e,t);const{eventRecord:r}=n,{endDate:i,startDate:s}=r,{dayTime:o}=n.view;let a=i;n.recurring&&(a=xi.add(a,r.recurrence.count-1,"d")),n.days=n.makeDays(s,a),n.times=[o.delta(s,"s"),o.delta(i,"s")]}setupEvent(e,t){const n=this;n.useAllDay?n.allDayZone.setupEvent(e,t):(this.wasAllDay&&(e.allDay=!1,e.endDate=xi.add(e.startDate,e.duration=1,e.durationUnit="hour")),super.setupEvent(e,t))}updateDays(e,t){super.updateDays(e,t),this.updateTimes(this.times,null)}updateTimes(e){if(!e)return;const t=this,{allDayZone:n,dayValues:r,dragging:i,eventRecord:s,isResizing:o,recurring:a,view:l}=t,{dayTime:d,eventSpacing:c}=l,{endDate:u,startDate:h}=s,[g,m]=e,p=!(null!=i&&i.aborted)&&(null==i?void 0:i.peek("eventInset")),f=!(null!=i&&i.aborted)&&(null==i?void 0:i.peek("eventWidth")),v=l.rtl?"right":"left",y=d.dateKey(h),b=d.dateKey(u),C=d.startOfDay(h)<d.startOfDay(u),w=100/d.duration("s");let S,D,E,x,R,T,M,k,{days:F}=t;if(F){for(S in r)D=r[S],E=S===y,M=D.style,k=g*w,x=(m-g)*w,ud.sync({targetElement:D,domConfig:t.renderEvent(t.eventRecord,E,S===F[F.length-1])}),!a&&C&&(x=E?100-k:S===b?k+x:100),M.top=a||E?Yn.percentify(k):0,M.height=Yn.percentify(x),M.paddingBottom=Yn.setLength(c),o&&(p&&(M[v]=p),f&&(M.width=`${f}px`)),R=Ot.from(D.querySelector(".b-cal-event-desc")),R&&(T=Ot.from(D.querySelector(".b-cal-event-footer")),T&&D.classList.toggle("b-cal-event-footer-desc-overlap",Boolean(R.intersect(T))));if(!F||F.length<2||a)null==n||n.cleanupDrop(),F=null;else if(n&&l.showAllDayHeader){if(!n.eventRecord){n.noTip=!0;const e={startDate:s.startDate,endDate:s.endDate};if(o){const t=i.peek("eventRecord");e.assigned=t.assigned,e.eventColor=t.eventColor}n.createEvent(e,t.dropping)}n.eventRecord.set({startDate:s.startDate,endDate:xi.add(s.startDate,F.length-1,"d")}),n.days=F}}}}class QF extends JF{static get $name(){return"DayAgendaZone"}static configurable={hoverable:!1,dragProxy:{type:"default",open(e){const t=this,{source:n}=e,r=e.element.closest(".b-cal-event-wrap");t.proxyEl=r.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width=`${r.offsetWidth}px`,t.proxyEl.style.setProperty("--cal-event-color",r.style.getPropertyValue("--cal-event-color")),t.proxyOffset=Jt.getClientPoint(e.startEvent).getDelta(Ot.from(r)),n.view.firstVisibleCell.appendChild(t.proxyEl)},dragMove(e){const{source:t}=e,{view:n,eventRecord:r}=t;t.hit&&this.proxyEl?(ud.sync({targetElement:this.proxyEl,domConfig:{...t.renderEvent(r),onlyChildren:!0}}),Yn.alignTo(this.proxyEl,Jt.getClientPoint(e.event).translate(20,20),{align:"t0-t0",constrainTo:t.dragRootElement}),n.overHour=t.hit.date):n.overHour=null},close(e){var t;e.source.view.overHour=null,null===(t=this.proxyEl)||void 0===t||t.remove()}}};findRootElement(){return this.view.eventContentElement}hitTest(e){const t=KF.prototype.hitTest.call(this,e);var n,r;t&&(t.hourElement=null===(n=(null===(r=e.event||e.domEvent)||void 0===r?void 0:r.target)||e)||void 0===n?void 0:n.closest("[data-hour]"));return t}setEventData(){return KF.prototype.setEventData.apply(this,arguments)}dropHitMove(e,t,n){let r=t.date;const i=this,{view:s}=i,o=s.dayTime.startOfDay(r);if(n=i.eventRecord,r<o)r=o;else if(!s.snapRelativeToEventStartDate){const t=e.event.clientX>e.startEvent.clientX?"ceil":"floor";r=xi[t](r,s.increment)}i.setEventData({startDate:r,endDate:xi.add(r,n.duration,n.durationUnit),duration:n.duration})}async moveEventTo(e,t){const n=this,{date:r,hourElement:i}=n.hitTest(e);if(r&&i){const{view:i}=n,s=e.event.clientX>e.startEvent.clientX?"ceil":"floor",o=i.snapRelativeToEventStartDate?r:xi[s](r,i.increment);if(n.wasAllDay){const e=xi.add(i.dayTime.startOfDay(o),24,"h"),n=xi.add(o,t.duration,t.durationUnit);if(t.allDay=!1,n>e){const n=i.autoCreate||i.changeAutoCreate(!0),r=xi.parseDuration(n.duration),s=new Date(Math.min(xi.add(o,r.magnitude,r.unit),e)),a=xi.diff(o,s,t.durationUnit);t.setDuration(a,t.unit)}}await n.setStartDate(t,o)}}}class eI extends ZF{static $name="ResourceCalendarRowZone";static configurable={droppableSelector:".b-calendarrow-cell-container,.b-dayresourcecalendarrow-cell-resources,.b-dayresource-allday.b-cal-cell-header"};syncHoverListeners(){}beforeDrag(e){const t=this.hitTest(e);return!(null==t||!t.resource||"resize"===t.type||"schedule"===t.type)&&super.beforeDrag(e)}setupEvent(){return this.view.defaultCalendar=(this.dragging||this.dropping).peek("resource"),super.setupEvent(...arguments)}updateHit(e,t){e&&!e.resource||super.updateHit(e,t)}makeDays(e){var t;const n=this,{isMoving:r}=n,i=n.dragging||n.dropping,s=r?new Date(Math.max(e,n.view.firstVisibleDate)):i.peek("date"),o=super.makeDays(s,xi.add(s,1,"d"));return o.resource=null===(t=n.hit)||void 0===t?void 0:t.resource,o}updateDays(e){const t=this;let{view:n,eventEl:r}=t;if(null!=e&&e.length){var i;r||(t.eventEl=r=Yn.createElement({...t.eventDom}),r.classList.add("b-allday"));const s=null===(i=t.dragging)||void 0===i||null===(i=i.peek("eventSourceHit"))||void 0===i?void 0:i.eventTop;Yn.down(t.dropRootElement,`${n.visibleCellSelector}:is(${e.map((e=>`[data-date="${e}"]`)).join(",")}) [data-resource-id="${e.resource.id}"] > .b-cal-event-bar-container`).appendChild(r),r.style.width="100%",s&&(r.style.top=s),n.scrollable.scrollIntoView(r,!0)}else r&&(r.classList.contains("b-cal-tentative-event")&&r.remove(),t.eventEl=null)}}class tI extends JF{static $name="DayResourceZone";static configurable={allDayZoneClass:eI};beforeDrag(e){const t=this.hitTest(e);return!(null==t||!t.resource)&&super.beforeDrag(e)}setupEvent(){return this.view.defaultCalendar=(this.dragging||this.dropping).peek("resource"),super.setupEvent(...arguments)}hitTest(e){const t=this.dragging||this.dropping,n=super.hitTest(e);if(n&&t&&!this.isMoving){const e=t.peek("date");n.resource=t.peek("resource"),n.date.setDate(e.getDate()),n.date.setMonth(e.getMonth()),n.date.setFullYear(e.getFullYear())}return n}updateHit(e,t){e&&!e.resource||super.updateHit(e,t)}makeDays(e,t){var n;const r=this,{isMoving:i}=r,s=r.dragging||r.dropping,o=i?e:s.peek("date"),a=super.makeDays(o,xi.add(o,1,"d"));return a.resource=null===(n=r.hit)||void 0===n?void 0:n.resource,a}updateDays(e){const t=this;let{eventEl:n}=t;if(null!=e&&e.length){const r=Yn.down(t.dropRootElement,`:is(${e.map((e=>`[data-date="${e}"]`)).join(",")}) ${t.view.visibleCellSelector}[data-resource-id="${e.resource.id}"] .b-dayview-event-container`);n||(t.eventEl=n=Yn.createElement({...t.eventDom})),r.appendChild(n)}else n&&(n.classList.contains("b-cal-tentative-event")&&t.view.setTimeout((()=>n.remove()),100),t.eventEl=null);t._times=null}updateTimes(e){if(!e||!this.days)return;const t=this,{dayTime:n,eventSpacing:r}=t.view,[i,s]=e,o=100/n.duration("s"),{style:a}=t.eventEl,l=i*o,d=(s-i)*o;ud.sync({targetElement:t.eventEl,domConfig:t.renderEvent(t.eventRecord,!0,!0)}),a.top=Yn.percentify(l),a.height=Yn.percentify(d),a.paddingBottom=Yn.setLength(r),a.width="100%"}}class nI extends KF{static $name="MonthZone";static get configurable(){return{coverage:{$config:{equal:W.isEqual},value:null},hoverable:!0,hoverEdges:"lr",hoverSelector:".b-cal-event-wrap.b-allday"}}findRootElement(e){return e.weeksElement}captureDragOffset(e,t,n){n.set("eventOffset",[Math.floor(xi.diff(this.clearTime(e.startDate),t.date,"d")),"d"])}cleanupDrag(){super.cleanupDrag();const e=()=>this.coverage=null;this.isCreating?this.view.afterRefresh(e):e()}cleanupDrop(){var e;super.cleanupDrop(),null===(e=this.owner.client)||void 0===e||null===(e=e._scrollManager)||void 0===e||e.stopMonitoring();const t=()=>this.coverage=null;this.isCreating?this.view.afterRefresh(t):t()}dropHitCreate(e,t){const n=this,r=e.ctrlKey,i=e.peek("eventCreate");let s,o,a,l,d,c,u,h=null;l=n.clearTime(t.date),d=n.clearTime(i.date),o=i.dayNumber,a=t.dayNumber,c=i.weekOffset,u=t.weekOffset,u<c&&([c,u]=[u,c]),r?(s=u-c+1,h=s>1?`FREQ=WEEKLY;COUNT=${s}`:null,l<d?(d=l,o<a&&(d=xi.add(d,o-a,"d"))):a<o&&(d=xi.add(d,a-o,"d")),a<o&&([o,a]=[a,o])):l<d&&([d,l]=[l,d],[o,a]=[a,o]),n.setEventData({startDate:d,duration:xi.as(n.eventRecord.durationUnit,(r?a-o:xi.diff(d,l,"d"))+1,"d"),recurrenceRule:h})}dropHitNowhere(e){super.dropHitNowhere(e),this.coverage=null}setEventData(e,t){super.setEventData(e,t);const{dropping:n,eventRecord:r,view:i}=this,{visibleCellSelector:s}=i,o=Yn.children(i.weeksElement,"> .b-calendar-week"),a={},l=e=>{const{startDate:t,endDate:n}=e;for(let e,r,l,d,c=0;c<o.length;++c){for(e=Yn.children(o[c],s),d=e.length,r="",l=0;l<d;++l){const s=i.getDateFromElement(e[l]),o=xi.add(s,1,"d");t<o&&s<n&&(!l&&t<s&&(r="<"),r+=l,l===d-1&&o<n&&(r+=">"))}r&&(a[c]||(a[c]=[])).push(r)}};null!=n&&n.has("eventRecord")||!r.recurrence?l(r):r.recurrence.forEachOccurrence(i.startDate,i.endDate,l),this.coverage=a}updateCoverage(e){const t=this,{dragging:n,weekValues:r,view:i}=t,{rtl:s}=i,{visibleCellSelector:o}=i,a=e&&(null==n?void 0:n.peek("eventSourceHit")),l=null==a?void 0:a.eventTop,d={},c=i.getWeekElementFor(null==a?void 0:a.eventElement),{weekElements:u}=i;let h,g,m,p,f,v,y,b,C,w,S;for(t.weekValues=d,C=0;C<u.length;++C)if(p=null==e?void 0:e[C])for(S=u[C],g=Yn.children(S,o),w=0;w<p.length;++w){var D;(v=null==r||null===(D=r[C])||void 0===D?void 0:D.shift())||(v=Yn.createElement(t.eventDom)),(d[C]||(d[C]=[])).push(v),m=p[w],y=m.includes("<")?1:0,b=m.includes(">")?1:0,m=m.substr(y,m.length-b-y),v.classList[y?"add":"remove"]("b-continues-past"),v.classList[b?"add":"remove"]("b-continues-future"),v.style[s?"right":"left"]=Yn.percentify(100*Number(m[0])/g.length),v.style.width=Yn.percentify(100*m.length/g.length),l&&S===c&&(v.style.top=l),h=g[Number(m[m.length-1])],f=Yn.down(h,".b-cal-event-bar-container"),f!==v.parentNode&&f.appendChild(v)}if(r)for(C in r)r[C].forEach((e=>{e.classList.contains("b-cal-tentative-event")&&e.remove()}))}}class rI extends KF{static $name="OverflowZone";static get configurable(){return{droppable:!1,dragProxy:{type:"default",open(e){const t=this,{owner:n}=e.source.view,r=e.element.closest(".b-cal-event-wrap");n.isYearView&&(t.proxyEl=r.cloneNode(!0),t.proxyEl.classList.add("b-cal-drag-proxy"),t.proxyEl.style.width=`${r.offsetWidth}px`,t.proxyOffset=Jt.getClientPoint(e.startEvent).getDelta(Ot.from(r)),n.contentElement.appendChild(t.proxyEl))},dragMove(e){this.proxyEl&&Yn.alignTo(this.proxyEl,Jt.getClientPoint(e.event).translate(15,15),{align:"t0-t0"})},close(){var e;null===(e=this.proxyEl)||void 0===e||e.remove()}}}}findRootElement(e){return e.contentElement}beforeDrag(e){const t=this.hitTest(e);if("event"!==(null==t?void 0:t.type)||!this.owner.draggable||!t.eventRecord.isDraggable)return!1;e.set("eventRecord",t.eventRecord),e.set("eventDragMode",e[jF]=GF.move.mode)}dragStart(){this.view.hide()}}class iI extends KF{static $name="YearZone";startCreate(){var e;null===(e=this.view._overflowPopup)||void 0===e||e.hide(),super.startCreate(...arguments)}dragEnter(e){const t=super.dragEnter(e);return!1!==t&&this.view.contentElement.classList.add(this.draggingCls),t}dragLeave(e){super.dragLeave(e),this.view.contentElement.classList.remove(this.draggingCls)}dropHitCreate(e,t,n){const r=this;let i=r.clearTime(t.date),s=r.clearTime(n.date);i<s&&([s,i]=[i,s]),r.setEventData({startDate:s,endDate:xi.add(i,1,"d")}),r.days=r.makeDayRange(s,i)}dropHitMove(e,t,n){super.dropHitMove(e,t,n);const r=this,i=r.eventRecord;let{endDate:s}=i;i.allDay&&(s=xi.add(s,-1,"d")),r.days=r.makeDayRange(i.startDate,s)}includeDay(e){const t=Yn.children(this.view.bodyElement,`[data-date='${e}']`);return t.forEach((e=>e.classList.add("b-cal-tentative-event"+(this.view.hideNonWorkingDays?":not(.b-nonworking-day)":"")))),t}makeDayRange(e,t){const n=[];for(let r=e;r<=t;r=xi.add(r,1,"d"))n.push(xi.format(r,"YYYY-MM-DD"));return n}removeDay(e,t){t.forEach((e=>e.classList.remove("b-cal-tentative-event")))}}class sI extends Qe{static get configurable(){return{view:null,zones:{$config:["nullify"],value:[]}}}updateView(e){e.eachView((e=>{this.onResourceViewViewCreate({view:e})})),e.ion({viewCreate:"onResourceViewViewCreate",thisObj:this})}onResourceViewViewCreate({view:e}){const{zones:t,owner:n}=this,r=n.client.constructor.Modes,i=n.getViewZoneType(r.resolveType(e.type));i&&t.push(n.createZone(i,{view:e,resource:e.defaultCalendar}))}changeZones(e,t){if(null!=t&&t.length&&!e)for(let e=0,{length:n}=t;e<n;e++)t[e].destroy();return e}}class oI extends IM{static $name="CalendarDrag";static type="drag";static get configurable(){return{disableOnReadOnly:!0,localizableProperties:["newName","recurrenceTip"],creatable:!0,draggable:!0,durationUnit:null,footer:{className:"b-cal-event-footer"},gripper:{class:"b-gripper"},newName:"L{newEvent}",recurrenceTip:"(L{holdCtrlForRecurrence})",resizable:!0,tooltip:{$config:["lazy","nullify"],value:{type:"eventTip",disabled:!0,forSelector:null,tools:null}},validateCreateFn:()=>{},validateMoveFn:()=>{},validateResizeFn:()=>{},zoneTypes:{day:JF,dayagenda:QF,month:nI,year:iI,resource:sI,dayresource:tI},removeFromExternalStore:!0}}callOnFunctions=!0;onBeforeDragStart(e){var t;const{client:n}=this,{drag:r,event:i}=e,{view:s}=r.source,o=r[jF].type,a=null===(t=s.getResourceRecord)||void 0===t?void 0:t.call(s,r.element),l=r.peek("date"),d={drag:r,domEvent:i,view:s,date:l,resourceRecord:a,eventRecord:r.peek("eventRecord"),feature:this.owner};return!1!==n.trigger(`beforeDrag${N.capitalize(o)}`,d)&&("create"===r.peek("eventDragMode").type?n.trigger("beforeAutoCreate",{view:s,domEvent:i,date:l,resourceRecord:a}):void 0)}changeGripper(e,t){return null==t||t.remove(),e&&Yn.createElement(e)}changeTooltip(e,t){return e&&(e=!0===e?this.constructor.configurable.tooltip.value:e,this.initialConfig.tooltip&&(e.disabled=!1),e.ownerFeature=this),oc.reconfigure(t,e,this)}}oI.initClass(),oI._$name="CalendarDrag";const aI={wrapStartDate:{get(){return xi.add(this.startDate,qs.from(this.preamble).negate())}},wrapEndDate:{get(){return xi.add(this.endDate,qs.from(this.postamble))}},outerStartDate:{get(){return this.wrapStartDate}},outerEndDate:{get(){return this.wrapEndDate}}};class lI extends IM{static $name="EventBuffer";static type="eventBuffer";static configurable={showDuration:!0,renderer:null};static get pluginConfig(){return{chain:["onEventDataGenerated"]}}onEventDataGenerated({eventRecord:e,resourceRecord:t,view:n},{children:r}){if(Object.getOwnPropertyDescriptor(e.constructor.prototype,"wrapStartDate")||Object.defineProperties(e.constructor.prototype,aI),this.enabled&&n.isDayView){var i,s;const{showDuration:o,renderer:a}=this,l={},d={};let c=qs.from(e.preamble),u=qs.from(e.postamble);a&&n.callback(a,n,[{eventRecord:e,resourceRecord:t,preambleConfig:l,postambleConfig:d}]),null!==(i=c)&&void 0!==i&&i.magnitude||(c=null),null!==(s=u)&&void 0!==s&&s.magnitude||(u=null);const h=c?xi.as("minute",c):0,g=u?xi.as("minute",u):0;if(c){const e={className:{"b-cal-event-buffer":1,"b-cal-preamble":1,[l.cls]:l.cls},style:{height:`calc(var(--hour-height) * ${h/60} + 1px)`},children:o?[{className:"b-travel-time-label",children:[l.icon?{tag:"i",className:l.icon}:void 0,{tag:"span",className:"b-buffer-label",text:l.text??c.toString()}]}]:void 0};o&&l.tooltip&&(e.children[0].dataset={btip:l.tooltip}),r.push(e)}if(u){const e={className:{"b-cal-event-buffer":1,"b-cal-postamble":1,[d.cls]:d.cls},style:{height:`calc(var(--hour-height) * ${g/60} + 1px)`},children:o?[{className:"b-travel-time-label",children:[d.icon?{tag:"i",className:d.icon}:void 0,{tag:"span",className:"b-buffer-label",text:d.text??u.toString()}]}]:void 0};o&&d.tooltip&&(e.children[0].dataset={btip:d.tooltip}),r.push(e)}}}updateShowDuration(){this.isConfiguring||this.client.eachView("refresh")}doDisable(){this.isConfiguring||this.client.eachView("refresh")}}IM.register(lI.type,lI),lI._$name="EventBuffer";const dI={magnitude:1,unit:"hour"};class cI extends(Qe.mixin(sg,og)){static $name="ExternalZone";static get configurable(){return{dragItemSelector:".b-grid-row",dragProxy:{type:"default",open(e){const t=this.owner.owner,n=t.openProxy(e);return e.cleaners.push((()=>{t.insertionPoint=null,n.remove()})),n},dragMove(e){return this.owner.owner.moveProxy(e)},close(){var e;null===(e=this.owner.owner.proxyEl)||void 0===e||e.remove()}}}}beforeDrag(e){return this.owner.onDragStart(e)}dragEnter(e){e.source.isMoving&&(e.element=e.targetElement,this.dragProxy.open(e))}dragMove(e){if(e.source.isMoving&&this.dragProxy.dragMove(e),e.source.isMoving||e.source.isExternalZone)return this.owner.onDragMove(e)}dragDrop(e){if(e.source.isMoving&&this.dragProxy.close(),e.target===this&&(e.source.isMoving||e.source.isExternalZone))return this.owner.onDragDrop(e)}}class uI extends(IM.mixin(Hi)){static $name="ExternalEventSource";static get delayable(){return{onCalendarPaint:"raf"}}static type="externalEventSource";static get configurable(){return{grid:{$config:["lazy"],value:null},dragRootElement:{$config:"lazy",value:null},dragItemSelector:null,getRecordFromElement:function(e){const t=this.grid||(this.grid=oc.fromElement(e,"grid"));return t?t.getRecordFromElement(e):e.innerText},hideExternalProxy:!0,draggable:{$config:["lazy"],value:{}},droppable:{$config:["lazy"],value:null},insertionPoint:null}}construct(){super.construct(...arguments),this.client.isPainted&&this.onCalendarPaint({source:this.client,firstPaint:!0})}onCalendarPaint({source:e,firstPaint:t}){if(t){const{draggable:e={},droppable:t={}}=this,n=new cI({view:this.grid,...e,...t});this._draggable&&(this._draggable=n),this._droppable&&(this._droppable=n)}e.ion({beforeDragMoveEnd:"onBeforeDragMoveEnd",dragMoveEnd:"onDragMoveEnd",thisObj:this})}onBeforeDragMoveEnd({drag:e}){if(e.source===this.draggable){var t;e.dropOnCalendar=!0;const n=null===(t=this.grid)||void 0===t?void 0:t.store,r=this.client.trigger("beforeDropExternal",e);return(null==n?void 0:n.isChained)&&n.fillFromMaster(),r}}onDragMoveEnd({drag:e}){if(e.source===this.draggable)return this.client.trigger("dropExternal",e)}onDragStart(e){var t;const n=this,{client:r,grid:i}=n,{eventStore:s}=r,{modelClass:o}=s;if(!e.itemElement)return!1;let a=n.callback(n.getRecordFromElement,n,[e.itemElement]);if(a.isModel)i&&e.set("sourceStore",i.store),a.isEventModel||(a=s.createRecord(a.data));else{if("string"==typeof a){const e=r.activeView.autoCreate||r.autoCreate,t=xi.parseDuration((null==e?void 0:e.duration)||dI);a={[o.getFieldDataSource("name")]:a,[o.getFieldDataSource("duration")]:t.magnitude,[o.getFieldDataSource("durationUnit")]:t.unit}}a=s.createRecord(a)}e.set("sourceStore",null===(t=n.grid)||void 0===t?void 0:t.store),e.set("eventRecord",a),e.eventRecord=a}onDragMove(e){const{grid:t}=this;if(t){const n=t.rowManager.getRowFor(e.targetElement),r=n&&t.store.getAt(n.index);if(n){const i=e.lastMoveEvent.clientY<n.getRectangle(Object.keys(t.subGrids)[0]).center.y;e.overIndex=n.index,e.overRecord=r,e.isAbove=i,this.insertionPoint=r===e.peek("eventRecord")?{}:{row:n,isAbove:i}}else if(t.contains(e.targetElement)){const n=t.headerContainer.classList,{bottomRow:r}=t.rowManager;e.overIndex=(null==r?void 0:r.index)||-1,e.overRecord=r?t.store.getById(r.id):null,e.isAbove=!1,this.insertionPoint={row:r||{addCls:e=>n.add(e),removeCls:e=>n.remove(e)}}}else e.overIndex=NaN,this.insertionPoint=null}e.eventRecord=e.data.get("eventRecord"),this.client.trigger("dragMoveExternal",e)}changeInsertionPoint(e,t){if((null==e?void 0:e.row)!==(null==t?void 0:t.row)||(null==e?void 0:e.isAbove)!==(null==t?void 0:t.isAbove))return e}updateInsertionPoint(e,t){var n,r;null==t||null===(n=t.row)||void 0===n||n.removeCls(t.isAbove?"b-drop-above":"b-drop-below"),null==e||null===(r=e.row)||void 0===r||r.addCls(e.isAbove?"b-drop-above":"b-drop-below")}async onDragDrop(e){const{client:t,grid:n}=this,{eventStore:r}=t,{eventRecord:i}=e,s=null==n?void 0:n.store,o=s===r||(null==s?void 0:s.masterStore)===r;!1!==t.trigger("beforeDropExternal",e)?(isNaN(e.overIndex)||(!r.includes(i)||o||e.source.view.resource||r.remove(i),o?r.move(i,r.getAt(e.overIndex+e.isAbove?1:0)):s.insert(e.overIndex+(e.isAbove?0:1),i),(null==s?void 0:s.isChained)&&s.fillFromMaster()),t.trigger("dropExternal",e)):(null==s?void 0:s.isChained)&&s.fillFromMaster()}openProxy(e){var t;const{grid:n,dragRootElement:r,client:i}=this,s=e.element.closest(this.draggable.dragItemSelector)||e.element,o=n?s.querySelector('[data-column="name"]'):s,a=this.proxyEl||(this.proxyEl=Yn.createElement({className:"b-grid-to-cal-drag-proxy"})),l=(null==n?void 0:n.element)||r.parentNode,d=i.element.contains(l)?i.element:l;return a.innerHTML=(null===(t=e.peek("eventRecord"))||void 0===t?void 0:t.name)||(null==o?void 0:o.innerHTML)||this.owner.L("L{newEvent}"),this.proxyOffset=Jt.getClientPoint(e.event).getDelta(Ot.from(s)),d.appendChild(a),a}moveProxy(e){const{proxyEl:t}=this,{targetElement:n}=e,{activeView:r}=this.client;if(t){var i;(r.eventContentElement.contains(n)||(null===(i=r.allDayEvents)||void 0===i?void 0:i.contains(n)))&&this.hideExternalProxy?t.classList.add("b-hide-display"):(t.classList.remove("b-hide-display"),Yn.alignTo(t,Jt.getClientPoint(e.event).translate(10,10),{align:"t0-t0"}))}}changeDragRootElement(e){return"string"==typeof e&&(e=document.querySelector(e)||document.getElementById(e)),e}changeDraggable(e){const{grid:t}=this,n=(null==t?void 0:t.contentElement)||this.dragRootElement,{dragItemSelector:r}=this;return e=uI.mergeConfigs({owner:this,grid:t},e),n&&(e.dragRootElement=n),r&&(e.dragItemSelector=r),e}changeDroppable(e){const{grid:t}=this,n=(null==t?void 0:t.contentElement)||this.dropRootElement;return e&&(e=uI.mergeConfigs({owner:this,grid:t},e),n&&(e.dropRootElement=n)),e}changeGrid(e){if(e){const t=typeof e,{resourceStore:n,project:r}=this.client;"string"===t&&(e=oc.getById(e)),e.setConfig({resourceStore:n,project:r})}return e}}uI.initClass(),uI._$name="ExternalEventSource";class hI extends oM{static $name="ExcelExporter";static type="excelExporter";constructor(e){super(e.client,e)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}IM.register(hI.type,hI),hI._$name="ExcelExporter";class gI extends IM{static $name="LoadOnDemand";static type="loadOnDemand";static configurable={startDateParamName:"startDate",endDateParamName:"endDate",dateFormat:"YYYY-MM-DD",beforeRequest:null,alwaysLoadNewRange:null,clearOnNewRange:null};construct(e){const{client:t}=e;t.eventStore.syncDataOnLoad=!1,t.ion({dateRangeRequested:"onClientDateRangeRequested",thisObj:this}),t.crudManager.ion({beforeLoadApply:"onCrudManagerBeforeApply",thisObj:this,prio:9999}),super.construct(...arguments)}hasOutstandingLoadFor(e,t){const{load:n}=this.client.crudManager.activeRequests;if(n){var r;const i=null===(r=n.options)||void 0===r?void 0:r.dateRangeRequested;if(i&&xi.timeSpanContains(i.startDate,i.endDate,e,t))return!0}}onCrudManagerBeforeApply({response:e,options:t}){this.lastRangeLoaded=e.success&&(null==t?void 0:t.dateRangeRequested)}onClientDateRangeRequested({new:{startDate:e,endDate:t},changed:n}){const r=this,{client:i}=r;if(!n&&r.alwaysLoadNewRange)return;const{lastRangeLoaded:s}=r;if(s&&!r.alwaysLoadNewRange){const{startDate:n,endDate:i}=r.lastRangeLoaded;if(xi.timeSpanContains(n,i,e,t))return}n&&(Yn.addTemporaryClass(i.element,"b-notransition",100,i),r.clearOnNewRange&&(i.eventStore.clear(!0),r.lastRangeLoaded=null)),r.disabled||r.hasOutstandingLoadFor(e,t)||r.loadDateRange(e,t)}refresh(){const{lastRangeLoaded:e}=this;e&&this.loadDateRange(e.startDate,e.endDate)}loadDateRange(e,t){const n=this,{pendingLoad:r,client:i}=n,{datePicker:s}=i;if(null!=s&&s.showEvents){const{activeView:n}=i;e=new Date(Math.min(n.startDate,s.startDate)),t=new Date(Math.max(n.endDate,s.endDate))}r?(r.startDate=xi.min(e,r.startDate),r.endDate=xi.max(t,r.endDate)):(n.pendingLoad={startDate:e,endDate:t},n.client.requestAnimationFrame((()=>n.load())))}async load(){const e=this,{client:t,beforeRequest:n,dateFormat:r}=e,{crudManager:i}=t,{load:s}=i.activeRequests,{startDate:o,endDate:a}=e.pendingLoad,l={dateRangeRequested:e.pendingLoad,request:{params:{[e.startDateParamName]:xi.format(o,r),[e.endDateParamName]:xi.format(a,r)}}};if(e.pendingLoad=null,n&&e.callback(n,t,[l]),s){if(e.hasOutstandingLoadFor(o,a))return;try{await i.cancelRequest(s.desc,s.reject)}catch(e){}}let d;try{d=await i.load(l)}catch(e){t.isDestroyed||e.cancelled||!1===t.trigger("loadOnDemandFail",e)||$f.alert({title:t.L("L{Calendar.loadFail}"),message:e.message})}d&&!t.isDestroyed&&t.trigger("dateRangeLoad",{response:d.response,options:l,startDate:o,endDate:a})}}gI.initClass(),gI._$name="LoadOnDemand";class mI extends fb{restoreState({client:e}){}saveState({client:e}){}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0))}pageTpl(e){const{config:t,title:n,header:r,footer:i,styles:s,htmlClasses:o,bodyStyle:a,bodyClasses:l=[`b-${this.constructor.type}`,...this.owner.bodyClasses,...oc.outerCls],paperHeight:d,paperWidth:u,html:h}=e,g=c.isSafari?"":"window.removeElement && window.removeElement();",m=null!=t&&t.debug?"":`<script type="text/javascript">window.addEventListener('load', function() { window.print(); ${g} });<\/script>`;return hh.tpl`
            <!DOCTYPE html>
            <html class="${o}" style="width: ${u}in; height: ${d}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${n}</title>
                    ${s.join("")}
                </head>
                <body class="b-print ${l.join(" ")}" style="width: ${u}in; height: ${d}in; ${a}">
                    <div class="b-print-content">
                        ${r&&`<div class="b-print-header" style="width: 100%">${r}</div>`}
                        <div class="b-print-body"><div class="b-print-viewport">${h}</div></div>
                        ${i&&`<div class="b-print-footer" style="width: 100%">${i}</div>`}
                    </div>
                    ${m}
                </body>
            </html>`}}mI._$name="Printer";const pI={configurable:!0,get:()=>Number.MAX_SAFE_INTEGER},fI=(e,t)=>e+t;class vI extends mI{static $name="CalendarPrinter";static type="calendar";getTotalHeight(e){const{activeView:t}=e;switch(e.mode){case"agenda":return t.virtualScrollHeight;case"day":case"week":return t.dayContentElement.scrollHeight+t.alldayRowElement.offsetHeight;case"month":if(this.owner.wysiwyg)return t.weeksElement.scrollHeight+t.weekdaysHeader.offsetHeight+10;break;case"year":return this.inchToPx(ib.A4.width)}}getTotalWidth(e){return"year"===e.mode?this.inchToPx(ib.A4.height):this.inchToPx(ib.A4.width)}async prepareComponent(e){const t=this,{owner:n}=t,{wysiwyg:r}=n,i=!r,{client:s}=e,{activeView:o}=s;if(t.exportMeta={title:n.callback(n.titleRenderer,n,[o]),totalWidth:t.getTotalWidth(s),totalHeight:t.getTotalHeight(s),subGrids:{}},"month"===s.mode&&i&&(Object.defineProperty(o,"eventsPerCell",pI),Object.defineProperty(o,"maxEventsPerCell",pI),o.doRefresh()),t.cloneElement(o.currentElement),"month"===s.mode){let e;i&&(e=o.shrinkwrapRowHeights,delete o.eventsPerCell,delete o.maxEventsPerCell,o.doRefresh(),t.exportMeta.totalHeight=e.reduce(fI,o.weekdaysHeader.offsetHeight)),o.weekElements.forEach(((n,s)=>{const o=t.element.querySelector(`[data-week="${n.dataset.week}"]`);o.style.minHeight="",o.style.flex=i?`0 0 ${e[s]}px`:r?`1 0 ${n.offsetHeight}px`:`1 0 ${250/6}mm`}))}}pxToInch(e){return(e/96).toFixed(2)}}vI.prototype.pagesExtractor=async function*(e){const t=this,{totalHeight:n,totalWidth:r,title:i}=t.exportMeta;yield{html:t.pageTpl({config:e,title:i,html:t.prepareExportElement(),styles:t.stylesheets,paperWidth:t.pxToInch(r),paperHeight:t.pxToInch(n)})}},vI._$name="CalendarPrinter";const yI=Object.freeze([]);class bI extends IM{static $name="Print";static type="print";static get configurable(){return{printer:{$config:["lazy","nullify"],value:{type:"calendar"}},wysiwyg:!1,titleRenderer:e=>e.description,printers:new Map([[vI.type,vI]]),gridPrintConfig:null}}construct(){super.construct(...arguments),this.client.print=this.print.bind(this)}changePrinter(e){const t=this,n=t.printersMap||(t.printersMap=new Map);if(e){let r;const{type:i}=e;if(n.has(i))r=n.get(i),r.setConfig(e);else{const s=t.printers.get(i);if(!s)throw new Error(`Printer type ${i} is not found. Make sure you've configured it`);(e=W.clone(e)).owner=t,r=new s(e),r.relayAll(t),n.set(i,r)}return r}n.forEach((e=>e.destroy()))}get bodyClasses(){return this.shrinkwrapRowHeights?["b-shrinkwrap-row-heights"]:yI}async print(e={}){const t=this,{client:n,printer:r}=t,i=`${n.id}-print-iframe`;if(!1!==n.trigger("beforePrint",{config:e,printer:r}))if(n.activeView.isEventList)await n.activeView.print(W.assign({exporterType:"multipagevertical",useRenderedColumnWidth:!0},this.gridPrintConfig||{})),n.trigger("print");else{e.client=n;const r=await t.printer.export(e);if(!e.debug){var s;null===(s=document.getElementById(i))||void 0===s||s.remove();const e=Yn.createElement({id:i,class:"b-calendar-print-iframe",tag:"iframe",parent:document.body});return e.contentWindow.removeElement=()=>{e.remove(),n.trigger("print",r)},e.contentWindow.document.write(r[0].html),e.contentWindow.document.close(),r}n.trigger("print",r)}}}bI.initClass(),bI._$name="Print";const CI=e=>({className:e.cls,style:e.style}),wI={end:"pos",start:"neg"},SI={end:"start",start:"end"},DI=Object.entries({alignment:"alignment",color:"color",footer:"footer",header:"name",rotation:"rotation"});class EI extends AM{static $name="DayZone";static configurable={viewListeners:{beforeLayoutEvents:"onBeforeLayoutEvents"}};onBeforeLayoutEvents({source:e,context:t}){const[n,r]=e.isDayView?[xi.add(t.cellData.date,e.dayStartMs),xi.add(t.cellData.date,e.dayEndMs)]:[t.cellData.date,t.cellData.tomorrow],i=e.getTimeRanges(n,r);if(i.length){const{layout:e}=t,n={},r={},s=[],o=[];let a,l;t.timeRangeHeaders=r,t.timeRanges=i;for(const d of i)l=e.createLayoutItem(d,t),l.values=Object.fromEntries(DI.map((([e,t])=>[e,d[t]]))),l.values.rotation=l.values.rotation||wI[l.values.alignment],e.clusterize(s,o,l,t),a=t.dayDomConfig.children.inset,a=a.children||(a.children=[]),a.push(this.renderTimeSpan(t,l,r,n));(r.end||n.end)&&(t.dayDomConfig.className["b-dayview-inset-after"]=1),(r.start||n.start)&&(t.dayDomConfig.className["b-dayview-inset-before"]=1)}}renderPart(e,t,n,r,i,s,o){var a,l,d;const c="footer"===r,{record:u}=n,h={timeRange:u};let g,m,p,f=n;if("string"==typeof r?(n[r]=f=W.merge({part:r,record:u,outer:n,cls:{[`b-cal-timerange-${r}`]:1}},o),p=n.values[r],null!=p&&(h.value=f.value=p)):(m=r,r="outer"),e=null===(a=e)||void 0===a?void 0:a[r],t=null===(l=t)||void 0===l?void 0:l[r],h.renderData=f,h.domConfig=m,t){f.style={};const e=t(h);"string"==typeof e?m=Object.assign({html:e},m):W.isObject(e)&&(g=e)}return g=g||(null===(d=e)||void 0===d?void 0:d(h)),m&&(g=W.merge(g||{},m)),i&&g&&(i[s=c&&SI[s]||s]=(i[s]||0)+1),f.domConfig=g,g}renderTimeSpan(e,t,n,r){const i=this,{owner:s}=i,{defaultRenderer:o,renderer:a}=s,l=t.eventRecord,d=isNaN(t.end)?0:Math.abs(t.end-t.start),c=d>1,u=!c,{rtl:h}=e.layout.owner,{values:g}=t,{alignment:m,color:p,rotation:f}=g,v={color:p,values:g,isLine:u,record:l,layoutContext:e,cls:{"b-readonly":l.readOnly,"b-rtl":h,"b-cal-timerange":1,"b-cal-timerange-line":u,"b-cal-timerange-narrow":c&&d<=60*s.narrowThreshold,[`b-cal-timerange-align-${m}`]:m,[`b-cal-timerange-rotate-${f}`]:c&&f}};c&&t.height.adjust(0,-1);const y=t.getStyles(h);return Yn.normalizeChildren(i.renderPart(o,a,v,{dataset:{"timerange-id":l.id,btip:u&&g.header||null},className:{[l.cls]:l.cls},elementData:{timeRange:l},style:{top:y.top,height:y.height},children:c&&{header:i.renderPart(o,a,v,"header",n,m,{cls:{[l.iconCls]:l.iconCls}}),body:i.renderPart(o,a,v,"body"),footer:i.renderPart(o,a,v,"footer",r,m)}}))}}class xI extends(IM.mixin(ax)){static $name="TimeRanges";static type="timeRanges";static configurable={defaultRenderer:{outer({renderData:e}){var t;const n=CI(e),{color:r}=e;return r&&(Yn.isNamedColor(r)?n.className[`b-cal-color-${r}`]=1:(n.style||(n.style={}))["--timerange-color"]=r),n.className["b-cal-timerange-has-header"]=null===(t=e.header)||void 0===t?void 0:t.domConfig,n},body:({renderData:e})=>CI(e),header:({renderData:e,value:t})=>t?{...CI(e),children:[{className:{"b-cal-timerange-header-text":1},text:t}]}:null,footer:({renderData:e,value:t})=>t?{...CI(e),children:[{className:{"b-cal-timerange-footer-text":1},text:t}]}:null},headerWidth:40,narrowThreshold:60,renderer:null,zoneTypes:{day:EI,resource:EI}};attachToProject(e){var t,n;super.attachToProject(e),this.detachListeners("project"),null===(t=e.timeRangeStore)||void 0===t||t.ion({name:"project",change:"refresh",thisObj:this}),null===(n=e.resourceTimeRangeStore)||void 0===n||n.ion({name:"project",change:"refresh",thisObj:this})}changeRenderer(e){return"function"==typeof e&&(e={header:e}),e}updateHeaderWidth(e){var t;const n=null===(t=this.owner)||void 0===t?void 0:t.element;var r;n&&n.style.setProperty("--timerange-header-width",null===(r=Dk.from(e))||void 0===r?void 0:r.toString())}refresh(){this.client.refresh()}}IM.register(xI.type,xI),xI._$name="TimeRanges";class RI extends IM{static $name="WeekExpander";static type="weekExpander";static get pluginConfig(){return{chain:["render"]}}render(){const{client:e}=this,t=this.monthView=e.isMonthView?e:e.modes.month;if(t){const{weekRenderer:e}=this;t.showWeekColumn=!0,t.weekRenderer=t.weekRenderer?ee.createSequence(t.weekRenderer,e):e,t.ion({weeknumberclick:"onWeekNumberClick",thisObj:this,prio:1e4})}}weekRenderer(e,[t,n]){e.querySelector(".b-week-toggle-tool-wrap")||Yn.createElement({parent:e,className:"b-week-toggle-tool-wrap",children:[{className:"b-icon b-week-toggle-tool",dataset:{btip:this.L("L{WeekExpander.expandTip}")}}]})}onWeekNumberClick({domEvent:e,date:t}){const n=e.target.closest(".b-week-toggle-tool");if(n&&!this.disabled){const r=e.target.closest(".b-calendar-row");return r.classList.contains("b-shrinkwrapped")?(this.monthView.flexWeekRow(t,!0),n.dataset.btip=this.L("L{expandTip}")):r.classList.contains("b-has-overflow")&&(this.monthView.shrinkwrapWeekRow(t),n.dataset.btip=this.L("L{collapseTip}")),!1}}updateDisabled(e,t){super.updateDisabled(e,t),this.client.element.classList.toggle("b-weekexpander",!e)}}RI.initClass(),RI._$name="WeekExpander";class TI extends(_M.mixin(qM)){static $name="MonthAgendaView";static type="monthagenda";static delayable={refresh:"raf"};static configurable={title:"L{MonthView.Month}",showEvents:"dots",tbar:null,animateTimeShift:!1,eventHeight:"auto",trapFocus:!1,focusable:!0,shiftIncrement:{unit:"day",magnitude:1},agendaDateFormat:"dddd DD MMMM YYYY",agendHeaderRenderer:null,agenda:{type:"agendaview"}};checkAutoCreateGesture(e){this.agenda.eventContentElement.contains(e.target)&&super.checkAutoCreateGesture(...arguments)}get description(){const{date:e}=this.agenda,t=xi.clearTime(new Date);return t-e?xi.diff(e,xi.add(t,1,"d"))?super.description:this.L("L{Calendar.Tomorrow}"):this.L("L{Calendar.Today}")}agendaHeaderRenderer(e){}changeShiftIncrement(e){return qs.from(e)}get stepUnit(){const{shiftIncrement:e}=this;return e?1===e.magnitude?xi.getLocalizedNameOfUnit(e.unit):`${e.magnitude} ${xi.getLocalizedNameOfUnit(e.unit,!0)}`:this.agenda.stepUnit}getEventElement(){return this.agenda.getEventElement(...arguments)}next(){const{date:e,animateTimeShift:t}=this,n=xi.add(e,qs.from(this.shiftIncrement));this.animateTimeShift=n.getMonth()!==e.getMonth(),this.date=n,this.animateTimeShift=t}previous(){const{date:e,animateTimeShift:t}=this,n=xi.add(e,qs.from(this.shiftIncrement).negate());this.animateTimeShift=n.getMonth()!==e.getMonth(),this.date=n,this.animateTimeShift=t}changeAgenda(e,t){if(t&&this.remove(t),e){const n=this,{date:r}=n;e=TI.reconfigure(t,TI.mergeConfigs({date:r,flex:1,project:n.project,title:n.callback(n.agendaHeaderRenderer,n,[r]),ref:"agenda",cls:{"b-monthagenda-agenda":1},range:"day",settingsButton:null,alwaysShowCurrentDate:!0,consumeGridPointerEvents:!1,defaultScrollOptions:{block:"start"},internalListeners:{topDateChange:"onAgendaTopDateChange",rangeChange:"onAgendaRangeChange",thisObj:n}},e),n),n.add(e),n.eventSorter=e.eventSorter;const{classList:i}=e.element;i.remove("b-slide-vertical"),i.add("b-slide-horizontal")}else null==t||t.destroy();return e}onAgendaTopDateChange({source:e,date:t}){e.scrollable.scrollAnimation||(e.preventScroll=!0,this.date=t,e.preventScroll=!1)}onAgendaRangeChange({source:e}){if(e.isAgendaView&&e.store.count>1){const t=new Date(Math.min(Math.max(this.date,e.store.first.date),e.store.last.date));e.scrollTo(t,{animate:!1,block:"start"})}}createCellData(){return this.agenda.createCellData(...arguments)}updateDate(e,t){const{agenda:n}=this;this.selection=e,super.updateDate(e),n&&(n.date=e,n.title=this.callback(this.agendaHeaderRenderer,this,[e]),1===n.duration&&Yn.slideIn(n.element,e-t))}getDateFromDomEvent(e){return super.getDateFromDomEvent(e)||this.agenda.getDateFromDomEvent(e)}}TI.initClass(),TI._$name="MonthAgendaView";class MI extends(globalThis.customElements?HTMLElement:Object){connectedCallback(){this.setup()}async setup(){const e=this;if(e.shadowRoot)return;let t,n;const r=e.tagName.substring(8).toLowerCase(),i=(!c.isChrome||!document.fonts.check('normal 14px "Font Awesome 6 Free"'))&&e.getAttribute("fa-path"),s=document.getElementById("bryntum-theme"),o=e.getAttribute("theme")||"stockholm",a=e.getAttribute("stylesheet")||(null==s?void 0:s.href)||`${r}.${o}.css`,l=e.getAttribute("mode")||"open",d=e._rootElement=e.attachShadow({mode:l}),u=e.linkTag=Yn.createElement({tag:"link",rel:"stylesheet",href:a,parent:d,dataset:{bryntumTheme:!0,loading:!0}}),h=[new Promise((e=>{t=e}))],g={appendTo:d,features:{}};e.convertDatasetToConfigs(e.dataset,g),u.onload=()=>{delete u.dataset.loading,t()},i&&(n=new FontFace(c.isFirefox?"FontAwesome5Free":"Font Awesome 6 Free",`url("${i}/fa-solid-900.woff2")`),document.fonts.add(n),h.push(n.load())),await h[0],e.ready=Promise.all(h);for(const t of e.children){const n=t.tagName;if("FEATURE"===n){const n=t.dataset.name,r=e.convertDatasetToConfigs(t.dataset);delete r.name,Object.keys(r).length?g.features[n]="false"!==r.use&&!1!==r.use&&r:g.features[n]="false"!==t.textContent}else if("TBAR"===n||"BBAR"===n)g[n.toLowerCase()]=Array.from(t.children).map((t=>e.convertDatasetToConfigs(t.dataset)));else if("INLINESTYLE"===n){const e=document.createElement("style");e.innerHTML=t.innerHTML,d.appendChild(e)}}e.widget=e.createInstance(g),e.dispatchEvent(new CustomEvent("ready"))}convertDatasetToConfigs(e,t={},n=!1){for(const r in e){let i=e[r];!n&&"string"==typeof i&&i.startsWith("{")?i=this.convertDatasetToConfigs(JSON.parse(i.replace(/'/g,'"'))):(i=N.safeJsonParse(i)??i,"null"===i&&(i=null)),t[r]=i}return t}destroy(){var e,t;const n=this;if(!n.widget)return;const{shadowRoot:r}=n,i=r.bryntum,s=n.widget.constructor,o=r.querySelector(".b-float-root");null==i||null===(e=i.tooltip)||void 0===e||null===(e=e.get(tm))||void 0===e||e.destroy(),null==i||null===(t=i.errorTooltip)||void 0===t||t.destroy(),n.widget.destroy(),null==o||o.remove(),s.removeFloatRoot(o),n.linkTag.remove(),n.widget=null}}MI._$name="WidgetTag";class kI extends MI{createInstance(e){const t=this,n=[],r=[],i=[],s=[],o=[];for(const a of t.children)if("COLUMN"===a.tagName){const e=Object.assign({},a.dataset);!e.text&&a.innerHTML&&(e.text=a.innerHTML),e.width&&(e.width=parseInt(e.width)),e.flex?e.flex=parseInt(e.flex):e.width||(e.flex=1),n.push(e)}else if("DATA"===a.tagName)for(const e of a.children)for(const n of e.children){const{tagName:a}=e;let l;"EVENTS"===a||"TASKS"===a?l=i:"RESOURCES"===a?l=r:"DEPENDENCIES"===a?l=o:"ASSIGNMENTS"===a&&(l=s),t.processRecord(n,l)}else"PROJECT"===a.tagName&&(e.project=new t.projectModelClass({autoLoad:!0,transport:{load:{url:a.dataset.loadUrl}}}));return n.length&&(e.columns=n),i.length&&(e.events=i),r.length&&(e.resources=r),o.length&&(e.dependencies=o),new this.widgetClass(e)}processRecord(e,t){const n={};if(Object.assign(n,this.convertDatasetToConfigs(e.dataset,{},!0)),e.children.length){n.children=[];for(const t of e.children)this.processRecord(t,n.children)}t.push(n)}}kI._$name="TimelineBaseTag";class FI extends kI{connectedCallback(){this.widgetClass=HF,this.projectModelClass=xE,super.connectedCallback()}createInstance(e){for(const t of this.children)if("MODES"===t.tagName){e.modes={};for(const n of t.children){const t=n.tagName.toLowerCase();"br"!==t&&("false"===n.getAttribute("data-use")||"false"===n.textContent||"null"===n.textContent?e.modes[t]=null:e.modes[t]={...this.convertDatasetToConfigs(n.dataset)})}}return super.createInstance(e)}}try{var II;null===(II=globalThis.customElements)||void 0===II||II.define("bryntum-calendar",FI)}catch(e){}FI._$name="CalendarTag",e.AbstractAssignmentStoreMixin=ZS,e.AbstractCalendarManagerStoreMixin=vE,e.AbstractCalendarMixin=pE,e.AbstractCrudManager=xD,e.AbstractCrudManagerMixin=bD,e.AbstractCrudManagerValidation=gD,e.AbstractDateRange=Ap,e.AbstractDependencyStoreMixin=lD,e.AbstractEventStoreMixin=$S,e.AbstractHasAssignmentsMixin=kS,e.AbstractPartOfProjectGenericMixin=xw,e.AbstractPartOfProjectModelMixin=Mw,e.AbstractPartOfProjectStoreMixin=Tw,e.AbstractRecurrenceIterator=cS,e.AbstractResourceStoreMixin=Ow,e.AbstractTimeRanges=uR,e.ActionBase=ua,e.ActionColumn=Fv,e.AddAction=$a,e.AgendaColumn=xM,e.AgendaView=wk,e.AggregateColumn=Av,e.AjaxHelper=vr,e.AjaxStore=$l,e.AjaxStoreLazyLoadPlugin=Al,e.AjaxTransport=CD,e.Animator=Pc,e.ArrayDataField=vs,e.ArrayHelper=nt,e.AssignmentModel=YS,e.AssignmentModelMixin=jS,e.AssignmentStore=tD,e.AssignmentStoreMixin=qS,e.AsyncHelper=dt,e.AttachToProjectMixin=ax,e.AvatarRendering=Sv,e.Badge=Su,e.Bag=po,e.Bar=Ib,e.Base=Qe,e.BooleanCombo=xm,e.BooleanDataField=ys,e.Box=Cu,e.BrowserHelper=c,e.Button=Tu,e.ButtonGroup=Mm,e.CI=uw,e.CIFromSetOrArrayOrValue=KS,e.CSSHelper=Nl,e.Calendar=HF,e.CalendarCache=iE,e.CalendarCacheInterval=aE,e.CalendarCacheIntervalMultiple=SM,e.CalendarCacheMultiple=DM,e.CalendarCacheSingle=gE,e.CalendarDatePicker=_M,e.CalendarDrag=oI,e.CalendarFeature=IM,e.CalendarIntervalMixin=JD,e.CalendarIntervalStore=QD,e.CalendarMixin=qM,e.CalendarPanel=Fm,e.CalendarRow=ck,e.CalendarStores=VM,e.CalendarTag=FI,e.Card=Zf,e.Carousel=qm,e.CellCopyPaste=Qv,e.CellEdit=iy,e.CellMenu=sy,e.CellTooltip=oy,e.CheckColumn=Ov,e.Checkbox=Xm,e.CheckboxGroup=ep,e.ChecklistFilterCombo=yy,e.ChipView=bm,e.ChronoMixinBase=class{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}},e.ClickRepeater=Oc,e.Clipboardable=Xh,e.ClockTemplate=Gx,e.CodeEditor=np,e.CollapseTool=jc,e.Collection=ho,e.CollectionFilter=Js,e.CollectionSorter=to,e.ColorColumn=$v,e.ColorField=ip,e.ColorPicker=rp,e.Column=Rv,e.ColumnAutoWidth=ly,e.ColumnDragToolbar=dy,e.ColumnLines=gR,e.ColumnPicker=cy,e.ColumnRename=uy,e.ColumnReorder=hy,e.ColumnResize=gy,e.ColumnStore=kv,e.Combo=Dm,e.ComboModel=_l,e.Config=ke,e.ConfirmationBar=up,e.Container=Dc,e.ContextMenuBase=ah,e.CopyPasteBase=Gv,e.CoreAssignmentMixin=US,e.CoreAssignmentStoreMixin=QS,e.CoreCalendarManagerStoreMixin=yE,e.CoreCalendarMixin=fE,e.CoreDependencyMixin=iD,e.CoreDependencyStoreMixin=cD,e.CoreEventMixin=MS,e.CoreEventStoreMixin=_S,e.CoreHasAssignmentsMixin=FS,e.CoreHasDependenciesMixin=IS,e.CorePartOfProjectGenericMixin=Rw,e.CorePartOfProjectModelMixin=kw,e.CorePartOfProjectStoreMixin=Lw,e.CoreResourceMixin=Fw,e.CoreResourceStoreMixin=$w,e.CrudManager=FM,e.CrudManagerView=sx,e.DailyRecurrenceIterator=uS,e.DataField=fs,e.DataGenerator=Mh,e.DateColumn=_v,e.DateDataField=bs,e.DateField=wp,e.DateHelper=xi,e.DatePicker=bp,e.DateRangeField=Vp,e.DateRangeOwner=ok,e.DateRangePicker=_p,e.DateStoreLazyLoadPlugin=Nw,e.DateTimeField=Bp,e.DayAgendaView=Yk,e.DayButtons=WR,e.DayCellCollecter=JM,e.DayCellRenderer=rk,e.DayLayout=xk,e.DayResourceCalendarRow=dF,e.DayResourceView=cF,e.DaySelectable=hk,e.DaySelector=uk,e.DayTime=Dg,e.DayView=jk,e.Delayable=Hi,e.DelayableWrapper=SE,e.DelayedRecordsRendering=lM,e.DemoBot=Fh,e.DemoCodeEditor=Qp,e.DemoHeader=nf,e.Dependencies=FR,e.DependencyBaseModel=rD,e.DependencyCreation=mR,e.DependencyEdit=AR,e.DependencyMenu=LR,e.DependencyModel=oD,e.DependencyStore=hD,e.DependencyStoreMixin=aD,e.DependencyTooltip=TR,e.Describable=AE,e.DisplayField=mp,e.DomClassList=Vt,e.DomDataStore=Vl,e.DomHelper=Yn,e.DomSync=ud,e.DragBase=Yx,e.DragContext=rg,e.DragCreateBase=eR,e.DragHelper=Zl,e.DragProxy=ig,e.DragTipProxy=nm,e.Draggable=sg,e.Droppable=og,e.Duration=qs,e.DurationColumn=RC,e.DurationField=rf,e.DurationUnitDataField=ws,e.DynamicObject=du,e.EditBase=oR,e.Editor=sf,e.ElementResizeHelper=Ju,e.ElementVisitor=Eg,e.EventBuffer=lI,e.EventColorColumn=Vx,e.EventColorField=Hx,e.EventColorPicker=_x,e.EventColumn=RM,e.EventCopyPaste=fF,e.EventDayIndex=Kw,e.EventDrag=$R,e.EventDragCreate=_R,e.EventDragSelect=HR,e.EventEdit=bF,e.EventEditor=vF,e.EventFilter=nT,e.EventHelper=Jt,e.EventList=vk,e.EventMenu=wF,e.EventModel=PS,e.EventModelMixin=TS,e.EventNavigation=hF,e.EventNonWorkingTime=sT,e.EventRenderer=OM,e.EventResize=Xx,e.EventSelection=gF,e.EventSlots=KM,e.EventSorter=WM,e.EventStore=VS,e.EventStoreMixin=zw,e.EventTip=BF,e.EventTooltip=EF,e.Events=lt,e.ExcelExporter=hI,e.ExportDialog=mb,e.ExportOrientationCombo=hb,e.ExportRowsCombo=ub,e.Exporter=fb,e.ExporterBase=pb,e.ExternalEventSource=uI,e.Factoryable=ds,e.Featureable=ag,e.Fencible=$h,e.Field=cm,e.FieldContainer=sm,e.FieldFilterPicker=Mf,e.FieldFilterPickerGroup=Ff,e.FieldSet=Zm,e.FileDrop=Mb,e.FileField=If,e.FileFormat=ab,e.FilePicker=Af,e.FillHandle=my,e.Filter=Sy,e.FilterBar=Ey,e.FilterField=Lf,e.Finalizable=Zh,e.Fit=um,e.FluidDayLayout=Fk,e.Footer=Ab,e.Formatter=zs,e.FormulaField=fm,e.FormulaProvider=ms,e.Fullscreen=hd,e.FunctionHelper=ee,e.GetEventsMixin=Ww,e.GlobalEvents=ir,e.Grid=SC,e.GridBase=wC,e.GridEditBase=ey,e.GridElementEvents=Gb,e.GridExcelExporter=Tb,e.GridFeatureManager=Jv,e.GridFeatures=qb,e.GridFieldFilterPicker=py,e.GridFieldFilterPickerGroup=fy,e.GridGroupSummary=Ty,e.GridLocation=Dv,e.GridLockRows=Ay,e.GridMultiPageExporter=vb,e.GridMultiPageVerticalExporter=yb,e.GridPdfExport=Cb,e.GridPrint=Sb,e.GridResponsive=Jb,e.GridRowModel=Wv,e.GridRowReorder=Uy,e.GridRowResize=Gy,e.GridSelection=tC,e.GridSinglePageExporter=bb,e.GridSplit=Iy,e.GridState=oC,e.GridSubGrids=hC,e.GridSummary=Qy,e.Group=xy,e.GroupBar=EC,e.GroupSummary=uT,e.Header=Nb,e.HeaderMenu=Ly,e.HeaderZoom=gT,e.Helpers=l,e.Hint=xg,e.HintFlow=Mg,e.Histogram=cv,e.HorizontalLayoutPack=VE,e.HorizontalLayoutStack=$E,e.HorizontalRendering=fx,e.HorizontalTimeAxis=Mx,e.Hoverable=pg,e.IdHelper=eo,e.Identifiable=Xi,e.InfinityAxis=Bh,e.InfinityScrollable=Yh,e.InfinityScroller=Gh,e.InsertAction=Ba,e.InsertChildAction=ka,e.InstancePlugin=Mr,e.IntegerDataField=Ss,e.IntervalCache=uE,e.IntervalSorterFn=oE,e.JsonEncoder=wD,e.KeyMap=Id,e.Label=kf,e.Labelable=rm,e.Labels=bT,e.Layout=lc,e.LayoutDim=Dk,e.LazyLoadCrudManager=ED,e.LazyLoadView=ox,e.List=gm,e.LoadMaskable=fg,e.LoadOnDemand=gI,e.LocaleHelper=yr,e.LocaleManager=Cr,e.Localizable=Tr,e.LockRows=OT,e.MAX_DATE=tE,e.MI=gw,e.MIN_DATE=eE,e.Mask=mc,e.Menu=sh,e.MenuItem=rh,e.MergeCells=Oy,e.MessageDialog=$f,e.Minifiable=gv,e.ModeSelector=pF,e.Model=_s,e.ModelDataField=Ds,e.ModelLink=ss,e.ModelStm=Qi,e.Month=kg,e.MonthAgendaView=TI,e.MonthPicker=hp,e.MonthView=Xk,e.MonthlyRecurrenceIterator=gS,e.MultiDatePicker=$p,e.MultiPageExporter=KT,e.MultiPageVerticalExporter=XT,e.Navigator=qh,e.NonWorkingTime=CT,e.NonWorkingTimeMixin=iT,e.NumberColumn=Iv,e.NumberDataField=Es,e.NumberField=lf,e.NumberFormat=Ys,e.ObjectDataField=xs,e.ObjectHelper=W,e.Objects=C,e.Orientation=ob,e.OverflowPopup=ek,e.Override=yg,e.PackMixin=HE,e.PagingToolbar=_f,e.Pan=wT,e.Panel=Xu,e.PanelCollapser=au,e.PanelCollapserOverlay=Up,e.PaperFormat=ib,e.Parser=Kg,e.PartOfBaseProject=e=>class extends e{static $name="PartOfBaseProject";get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},e.PartOfProject=aw,e.PasswordField=Hf,e.PdfExport=rM,e.PercentColumn=Hv,e.PickerField=ym,e.Pluggable=kr,e.Point=$t,e.Popup=eh,e.PresetManager=AC,e.PresetStore=IC,e.Print=bI,e.PrintMixin=wb,e.ProjectCombo=fM,e.ProjectConsumer=jE,e.ProjectCrudManager=SD,e.ProjectModel=kM,e.ProjectModelCommon=RD,e.ProjectModelMixin=LD,e.ProjectModelTimeZoneMixin=FD,e.Promissory=Cl,e.QuickFind=_y,e.RTL=Ad,e.Radio=Jm,e.RadioGroup=Qm,e.RandomGenerator=Rh,e.RangeMenu=mk,e.RatingColumn=Vv,e.Rectangle=Ot,e.RectangularPathFinder=bR,e.RecurrenceCombo=BR,e.RecurrenceConfirmationPopup=jC,e.RecurrenceDayRuleEncoder=iS,e.RecurrenceDaysButtonGroup=UR,e.RecurrenceDaysCombo=jR,e.RecurrenceEditor=ZR,e.RecurrenceEditorPanel=XR,e.RecurrenceFrequencyCombo=NR,e.RecurrenceLegend=Ux,e.RecurrenceLegendButton=zR,e.RecurrenceModel=SS,e.RecurrenceMonthDaysButtonGroup=GR,e.RecurrenceMonthsButtonGroup=YR,e.RecurrencePositionsCombo=KR,e.RecurrenceStopConditionCombo=qR,e.RecurringEventEdit=JR,e.RecurringEvents=WC,e.RecurringEventsMixin=tS,e.RecurringTimeSpan=RS,e.RecurringTimeSpansMixin=eS,e.RegionResize=Hy,e.RemoveAction=Ua,e.RemoveAllAction=qa,e.RemoveChildAction=La,e.Resizable=Qu,e.ResizeHelper=dh,e.ResizeMonitor=fd,e.ResourceCollapseColumn=Nx,e.ResourceCombo=QR,e.ResourceFilter=vM,e.ResourceHeader=kx,e.ResourceInfoColumn=Bx,e.ResourceMenu=ST,e.ResourceModel=Aw,e.ResourceModelMixin=lw,e.ResourceStore=Hw,e.ResourceStoreMixin=ow,e.ResourceTickModel=jx,e.ResourceTickStore=Wx,e.ResourceTimeRangeModel=TD,e.ResourceTimeRangeStore=MD,e.ResourceTimeRanges=DT,e.ResourceTimeRangesBase=aR,e.ResourceView=aF,e.Responsive=wv,e.RevisionException=jo,e.Ripple=uc,e.Rotatable=Vc,e.Row=Fb,e.RowCopyPaste=Ny,e.RowEdit=By,e.RowExpander=Wy,e.RowManager=$b,e.RowNumberColumn=Nv,e.RowReorder=ET,e.RowResize=xT,e.RowsRange=rb,e.Scale=hv,e.ScaleColumn=zx,e.ScheduleContext=PR,e.ScheduleMenu=MF,e.ScheduleRange=YT,e.ScheduleRangeCombo=ZT,e.ScheduleTableExporter=sM,e.ScheduleTooltip=RF,e.Scheduler=aM,e.SchedulerBase=$x,e.SchedulerCoreEvent=AS,e.SchedulerCoreProjectMixin=DE,e.SchedulerCrudManager=RE,e.SchedulerDatePicker=yM,e.SchedulerDom=LE,e.SchedulerDomEvents=PE,e.SchedulerEventCopyPaste=OR,e.SchedulerEventEdit=tT,e.SchedulerEventEditor=VR,e.SchedulerEventMenu=rT,e.SchedulerEventNavigation=rx,e.SchedulerEventRendering=BE,e.SchedulerEventSelection=XE,e.SchedulerEventTooltip=lT,e.SchedulerExcelExporter=oM,e.SchedulerExportDialog=JT,e.SchedulerPrint=iM,e.SchedulerProjectModel=xE,e.SchedulerRegions=YE,e.SchedulerResourceRendering=NE,e.SchedulerScheduleMenu=RT,e.SchedulerScheduleTooltip=MT,e.SchedulerScroll=GE,e.SchedulerState=KE,e.SchedulerStores=WE,e.SchedulerTimeRangeModel=ID,e.SchedulerTimeRangeStore=AD,e.SchedulerTimeRanges=zT,e.ScrollButtons=TT,e.ScrollManager=Xg,e.Scroller=Md,e.Search=qy,e.Sidebar=HM,e.SimpleEventEdit=kT,e.SinglePageExporter=QT,e.SlideToggle=Bf,e.Slider=Nf,e.Sort=Xy,e.SortedMap=cE,e.Split=AT,e.Splitter=Uf,e.State=Yi,e.StateBase=Go,e.StateProvider=Wi,e.StateStorage=Vi,e.StateTrackingManager=yl,e.StickyCells=Zy,e.StickyEvents=PT,e.Store=Il,e.StoreCRUD=vo,e.StoreChained=Po,e.StoreChanges=yo,e.StoreDataField=Ts,e.StoreFilter=bo,e.StoreGroup=Do,e.StoreLazyLoadPlugin=wl,e.StorePaging=xo,e.StoreProxy=Ro,e.StoreRelation=To,e.StoreSearch=Io,e.StoreSort=Ao,e.StoreState=Oo,e.StoreStm=bl,e.StoreSum=Mo,e.StoreSync=zo,e.StoreTimeZonePlugin=kD,e.StoreTree=Bo,e.StringDataField=Cs,e.StringHelper=N,e.Stripe=Jy,e.Styleable=e=>class extends(e||Qe){static $name="Styleable";static configurable={cssVarPrefix:"",css:{}};changeCssVarPrefix(e){return W.assertString(e,"prefix"),e&&!e.endsWith("-")&&(e+="-"),e||""}changeCss(e){W.assertObject(e,"css");const t=this;if(!globalThis.Proxy)throw new Error("Proxy not supported");const n=new Proxy({},{get(e,n){var r;return null===(r=getComputedStyle(t.element||document.documentElement).getPropertyValue(`--${t.cssVarPrefix}${N.hyphenate(n)}`))||void 0===r?void 0:r.trim()},set:(e,n,r)=>((t.element||document.documentElement).style.setProperty(`--${t.cssVarPrefix}${N.hyphenate(n)}`,r),!0)});return e&&(t._element?W.assign(n,e):t.$initialCSS=e),n}updateElement(e,...t){super.updateElement(e,...t),this.$initialCSS&&W.assign(this.css,this.$initialCSS)}get widgetClass(){}},e.SubGrid=uC,e.Summary=VT,e.Tab=Gf,e.TabBar=qf,e.TabPanel=Qf,e.TableExporter=Db,e.TaskEditStm=Zx,e.TaskEditTransactional=Jx,e.TemplateColumn=Bv,e.TemplateHelper=hh,e.TextAreaField=ev,e.TextAreaPickerField=tv,e.TextField=vm,e.TickCells=UT,e.TimeAxis=PC,e.TimeAxisColumn=Fx,e.TimeAxisHeaderMenu=BT,e.TimeAxisSubGrid=nw,e.TimeAxisViewModel=OC,e.TimeColumn=zv,e.TimeField=Ip,e.TimePicker=Ep,e.TimeRangeModel=TM,e.TimeRangeStore=MM,e.TimeRanges=xI,e.TimeSelection=jT,e.TimeSpan=kC,e.TimeSpanMenuBase=lR,e.TimeZoneHelper=Sh,e.TimeZonedDatesMixin=MC,e.TimelineBase=sw,e.TimelineBaseTag=kI,e.TimelineDateMapper=_C,e.TimelineDomEvents=VC,e.TimelineEventRendering=UC,e.TimelineHistogram=pM,e.TimelineHistogramBase=hM,e.TimelineHistogramGrouping=gM,e.TimelineHistogramScaleColumn=mM,e.TimelineScroll=ZC,e.TimelineState=ew,e.TimelineSummary=HT,e.TimelineViewPresets=NC,e.TimelineZoomable=BC,e.Toast=Dh,e.Tool=Nc,e.Toolable=gu,e.Toolbar=Hu,e.Tooltip=tm,e.TooltipBase=cR,e.Transaction=sl,e.TransactionalFeature=qx,e.TransactionalFeatureMixin=ix,e.Tree=tb,e.TreeColumn=jv,e.TreeCombo=xC,e.TreeGrid=DC,e.TreeGroup=nb,e.TreeNode=ns,e.TreeSummary=GT,e.UndoRedo=CM,e.UndoRedoBase=nv,e.UnspecifiedTimeIntervalModel=mE,e.UpdateAction=Da,e.VALUE_COUNT=vy,e.VBox=wu,e.Validatable=im,e.VersionHelper=G,e.VerticalRendering=Dx,e.VerticalTimeAxisColumn=Ax,e.ViewPreset=FC,e.ViewPresetCombo=wM,e.WalkHelper=Hs,e.Wbs=_o,e.WeekExpander=RI,e.WeekView=Zk,e.WeeklyRecurrenceIterator=hS,e.Widget=oc,e.WidgetColumn=Pv,e.WidgetHelper=Eh,e.WidgetTag=MI,e.WriteExcelFileProvider=Rb,e.XMLHelper=xh,e.XlsProviderBase=Eb,e.YearPicker=gp,e.YearView=tF,e.YearlyRecurrenceIterator=mS,e.binarySearch=lE,e.combineCalendars=e=>{const t=sE(e);if(0===t.length)throw new Error("No calendars to combine");t.sort(((e,t)=>e.internalId<t.internalId?-1:1));const n=t.map((e=>e.internalId+"/")).join(""),r=t.map((e=>e.version+"/")).join("");let i,s=EM.get(n);return i=s&&s.versionsHash===r?s.cache:new DM({calendarCaches:t.map((e=>e.calendarCache))}),i},e.delay=XS,e.format=(e,...t)=>e.replace(/{(\d+)}/g,((e,n)=>void 0!==t[n]?t[n]:e)),e.isDateFinite=e=>{if(!e)return!1;const t=e.getTime();return t!==eE.getTime()&&t!==tE.getTime()},e.isEqualEffectiveDirection=(e,t)=>!(e&&!t||!e&&t)&&(!e&&!t||e.direction===t.direction&&("own"===e.kind&&"own"===t.kind||"enforced"===e.kind&&"enforced"===t.kind&&e.enforcedBy===t.enforcedBy||"inherited"===e.kind&&"inherited"===t.kind&&e.inheritedFrom===t.inheritedFrom)),e.isNotNumber=e=>Number(e)!==e,e.later=_D,e.stripDuplicates=sE,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=calendar.umd.min.js.map